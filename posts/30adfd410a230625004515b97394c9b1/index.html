<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据表的关联关系 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据表的关联关系" />
<meta property="og:description" content="1.关联关系介绍 MySQL是⼀个关系型数据库，不仅可以存储数据，还可以维护数据与数据之间的关系——通过在数据表中添加字段建⽴外键约束
数据与数据之间的 关联关系 分为四种：
⼀对⼀关联
⼀对多关联
多对⼀关联
多对多关联
2. 一对一关联 一对多与多对一 班级 — 学⽣ （⼀对多） ⼀个班级包含多个学⽣
学⽣ — 班级 （多对⼀） 多个学⽣可以属于同⼀个班级
图书 — 分类 商品 ---- 商品类别
⽅案： 在多的⼀端添加外键 ，与⼀的⼀端主键进⾏关联
多对多关联 学⽣ — 课程 ⼀个学⽣可以选择多⻔课、⼀⻔课程也可以由多个学⽣选择
会员 — 社团 ⼀个会员可以参加多个社团、⼀个社团也可以招纳多个会员
⽅法：额外创建⼀张关系表来维护多对多关联——在关系表中定义两个外键，分别与两个数
据表的主键进⾏关联
外键约束 外键约束——将⼀个列添加外键约束与另⼀张表的主键(唯⼀列)进⾏关联之后，这个外键
约束的列添加的数据必须要在关联的主键字段中存在
案例 学生表与班级表
1.先创建班级表
create table classes( class_id int primary key auto_increment, class_name varchar(40) not null unique, class_remark varchar(200) ); 创建学⽣表（在学⽣表中添加外键与班级表的主键进⾏关联） # 【⽅式⼀】在创建表的时候，定义cid字段，并添加外键约束 # 由于cid 列 要与classes表的class_id进⾏关联，因此cid字段类型和⻓度要与 class_id⼀致 create table students( stu_num char(8) primary key, stu_name varchar(20) not null, stu_gender char(2) not null, stu_age int not null, cid int, constraint FK_STUDENTS_CLASSES foreign key(cid) references classes(class_id) ); #【⽅式⼆】先创建表，再添加外键约束 create table students( stu_num char(8) primary key, stu_name varchar(20) not null, stu_gender char(2) not null, stu_age int not null, cid int ); # 在创建表之后，为cid添加外键约束 alter table students add constraint FK_STUDENTS_CLASSES foreign key(cid) references classes(class_id); # 删除外键约束 alter table students drop foreign key FK_STUDENTS_CLASSES; 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/30adfd410a230625004515b97394c9b1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-02T17:48:55+08:00" />
<meta property="article:modified_time" content="2022-03-02T17:48:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据表的关联关系</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1.关联关系介绍</h3> 
<p>MySQL是⼀个关系型数据库，不仅可以存储数据，还可以维护数据与数据之间的关系——通过在数据表中添加字段建⽴外键约束<br> <img src="https://images2.imgbox.com/fe/cb/UIB4hUJL_o.png" alt="在这里插入图片描述"><br> 数据与数据之间的 关联关系 分为四种：<br> ⼀对⼀关联<br> ⼀对多关联<br> 多对⼀关联<br> 多对多关联</p> 
<h5><a id="2__8"></a>2. 一对一关联</h5> 
<p><img src="https://images2.imgbox.com/e8/f4/BRCkPWSx_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4f/e4/4xSYYd0m_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_11"></a>一对多与多对一</h3> 
<p>班级 — 学⽣ （⼀对多） ⼀个班级包含多个学⽣<br> 学⽣ — 班级 （多对⼀） 多个学⽣可以属于同⼀个班级<br> 图书 — 分类 商品 ---- 商品类别</p> 
<p>⽅案： 在多的⼀端添加外键 ，与⼀的⼀端主键进⾏关联<br> <img src="https://images2.imgbox.com/e6/31/4ifNrVqf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_18"></a>多对多关联</h3> 
<p>学⽣ — 课程 ⼀个学⽣可以选择多⻔课、⼀⻔课程也可以由多个学⽣选择<br> 会员 — 社团 ⼀个会员可以参加多个社团、⼀个社团也可以招纳多个会员</p> 
<p>⽅法：额外创建⼀张关系表来维护多对多关联——在关系表中定义两个外键，分别与两个数<br> 据表的主键进⾏关联<br> <img src="https://images2.imgbox.com/bf/23/1bPxSCRO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_25"></a>外键约束</h3> 
<p>外键约束——将⼀个列添加外键约束与另⼀张表的主键(唯⼀列)进⾏关联之后，这个外键<br> 约束的列添加的数据必须要在关联的主键字段中存在</p> 
<h5><a id="_29"></a>案例</h5> 
<p>学生表与班级表<br> 1.先创建班级表</p> 
<pre><code>create table classes(
class_id int primary key auto_increment,
class_name varchar(40) not null unique,
class_remark varchar(200)
);
</code></pre> 
<ol start="2"><li>创建学⽣表（在学⽣表中添加外键与班级表的主键进⾏关联）</li></ol> 
<pre><code># 【⽅式⼀】在创建表的时候，定义cid字段，并添加外键约束
# 由于cid 列 要与classes表的class_id进⾏关联，因此cid字段类型和⻓度要与
class_id⼀致
create table students(
stu_num char(8) primary key,
stu_name varchar(20) not null,
stu_gender char(2) not null,
stu_age int not null,
cid int,
constraint FK_STUDENTS_CLASSES foreign key(cid) references
classes(class_id)
);
#【⽅式⼆】先创建表，再添加外键约束
create table students(
stu_num char(8) primary key,
stu_name varchar(20) not null,
stu_gender char(2) not null,
stu_age int not null,
cid int
);
# 在创建表之后，为cid添加外键约束
alter table students add constraint FK_STUDENTS_CLASSES foreign
key(cid) references classes(class_id);
# 删除外键约束
alter table students drop foreign key FK_STUDENTS_CLASSES;
</code></pre> 
<p>3.向班级表添加班级信息</p> 
<pre><code>insert into classes(class_name,class_remark)
values('Java2104','...');
insert into classes(class_name,class_remark)
values('Java2105','...');
insert into classes(class_name,class_remark)
values('Java2106','...');
insert into classes(class_name,class_remark)
values('Python2106','...');
select * from classes;
+----------+------------+--------------+
| class_id | class_name | class_remark |
+----------+------------+--------------+
| 1 | Java2104 | ... |
| 2 | Java2105 | ... |
| 3 | Java2106 | ... |
| 4 | Python2106 | ... |
+----------+------------+--------------+
</code></pre> 
<ol start="4"><li>向学⽣表中添加学⽣信息</li></ol> 
<pre><code>insert into students(stu_num,stu_name,stu_gender,stu_age,cid)
values('20210102','李斯','⼥',20, 4 );
# 添加学⽣时，设置给cid外键列的值必须在其关联的主表classes的classs_id列存在
insert into students(stu_num,stu_name,stu_gender,stu_age,cid)
values('20210103','王五','男',20, 6 );
</code></pre> 
<h3><a id="6_99"></a>6.外键约束-级联</h3> 
<p>当学⽣表中存在学⽣信息关联班级表的某条记录时，就不能对班级表的这条记录进⾏修<br> 改ID和删除操作，如下：</p> 
<pre><code>mysql&gt; select * from classes;
+----------+------------+--------------+
| class_id | class_name | class_remark |
+----------+------------+--------------+
| 1 | Java2104 | ... | # 班级表中class_id=1的班级信息
被学⽣表中的记录关联了
| 2 | Java2105 | ... | # 我们就不能修改Java2104的
class_id,并且不能删除
| 3 | Java2106 | ... |
| 4 | Python2106 | ... |
+----------+------------+--------------+
mysql&gt; select * from students;
+----------+----------+------------+---------+------+
| stu_num | stu_name | stu_gender | stu_age | cid |
+----------+----------+------------+---------+------+
| 20210101 | 张三 | 男 | 18 | 1 |
| 20210102 | 李四 | 男 | 18 | 1 |
| 20210103 | 王五 | 男 | 18 | 1 |
| 20210104 | 赵柳 | ⼥ | 18 | 2 |
+----------+----------+------------+---------+------+
mysql&gt; update classes set class_id=5 where class_name='Java2104';
ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key
constraint fails (`db_test2`.`students`, CONSTRAINT
`FK_STUDENTS_CLASSES` FOREIGN KEY (`cid`) REFERENCES `classes`
(`class_id`))
mysql&gt; delete from classes where class_id=1;
ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key
constraint fails (`db_test2`.`students`, CONSTRAINT
`FK_STUDENTS_CLASSES` FOREIGN KEY (`cid`) REFERENCES `classes`
(`class_id`))

</code></pre> 
<p>如果⼀定要修改Java2104 的班级ID，该如何实现呢 ？<br> 将引⽤Java2104班级id的学⽣记录中的cid修改为 NULL<br> 在修改班级信息表中Java2104记录的 class_id<br> 将学⽣表中cid设置为NULL的记录的cid重新修改为 Java2104这个班级的新的id</p> 
<pre><code>1update students set cid=NULL where cid=1; # 结果如下：
+----------+----------+------------+---------+------+
| stu_num | stu_name | stu_gender | stu_age | cid |
+----------+----------+------------+---------+------+
| 20210101 | 张三 | 男 | 18 | NULL |
| 20210102 | 李四 | 男 | 18 | NULL |
| 20210103 | 王五 | 男 | 18 | NULL |
| 20210104 | 赵柳 | ⼥ | 18 | 2 |
+----------+----------+------------+---------+------+
2update classes set class_id=5 where class_name='Java2104'; # 结果如下
+----------+------------+--------------+
| class_id | class_name | class_remark |
+----------+------------+--------------+
| 2 | Java2105 | ... |
| 3 | Java2106 | ... |
| 4 | Python2106 | ... |
| 5 | Java2104 | ... |
+----------+------------+--------------+
3update students set cid=5 where cid IS NULL; # 结果如下
+----------+----------+------------+---------+------+
| stu_num | stu_name | stu_gender | stu_age | cid |
+----------+----------+------------+---------+------+
| 20210101 | 张三 | 男 | 18 | 5 |
| 20210102 | 李四 | 男 | 18 | 5 |
| 20210103 | 王五 | 男 | 18 | 5 |
| 20210104 | 赵柳 | ⼥ | 18 | 2 |
</code></pre> 
<p>我们可以使⽤级联操作来实现：</p> 
<ol><li>在添加外键时，设置级联修改 和 级联删除</li></ol> 
<pre><code># 删除原有的外键
alter table students drop foreign key FK_STUDENTS_CLASSES;
# 重新添加外键，并设置级联修改和级联删除
alter table students add constraint FK_STUDENTS_CLASSES foreign
key(cid) references classes(class_id) ON UPDATE CASCADE ON DELETE
CASCADE;
</code></pre> 
<ol start="2"><li>测试级联修改：</li></ol> 
<pre><code># 班级信息
+----------+------------+--------------+
| class_id | class_name | class_remark |
+----------+------------+--------------+
| 2 | Java2105 | ... |
| 3 | Java2106 | ... |
| 4 | Python2106 | ... |
| 5 | Java2104 | ... |
+----------+------------+--------------+
# 学⽣信息
+----------+----------+------------+---------+------+
| stu_num | stu_name | stu_gender | stu_age | cid |
+----------+----------+------------+---------+------+
| 20210101 | 张三 | 男 | 18 | 5 |
| 20210102 | 李四 | 男 | 18 | 5 |
| 20210103 | 王五 | 男 | 18 | 5 |
| 20210104 | 赵柳 | ⼥ | 18 | 2 |
+----------+----------+------------+---------+------+
# 直接修改Java2104的class_id,关联Java2104这个班级的学⽣记录的cid也会同步修
改
update classes set class_id=1 where class_name='Java2104';
# 班级信息
+----------+------------+--------------+
| class_id | class_name | class_remark 
+----------+------------+--------------+
| 2 | Java2105 | ... |
| 3 | Java2106 | ... |
| 4 | Python2106 | ... |
| 1 | Java2104 | ... |
+----------+------------+--------------+
# 学⽣信息
+----------+----------+------------+---------+------+
| stu_num | stu_name | stu_gender | stu_age | cid |
+----------+----------+------------+---------+------+
| 20210101 | 张三 | 男 | 18 | 1 |
| 20210102 | 李四 | 男 | 18 | 1 |
| 20210103 | 王五 | 男 | 18 | 1 |
| 20210104 | 赵柳 | ⼥ | 18 | 2 |
+----------+----------+------------+---------+------+
</code></pre> 
<p>3.测试级联删除</p> 
<pre><code># 删除class_id=1的班级信息，学⽣表引⽤此班级信息的记录也会被同步删除
delete from classes where class_id=1;
+----------+------------+--------------+
| class_id | class_name | class_remark |
+----------+------------+--------------+
| 2 | Java2105 | ... |
| 3 | Java2106 | ... |
| 4 | Python2106 | ... |
+----------+------------+--------------+
+----------+----------+------------+---------+------+
| stu_num | stu_name | stu_gender | stu_age | cid |
+----------+----------+------------+---------+------+
| 20210104 | 赵柳 | ⼥ | 18 | 2 |
+----------+----------+------------+---------+------+
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bca19853b06d21efc662917d453862e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">char data[0]用法总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/60063740f5191e40451dca47a3077a37/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【pytorch】nn.AvgPool2d()与AdaptiveAvgPool2d() 的区别</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>