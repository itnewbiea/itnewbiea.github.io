<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FCN网络详解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FCN网络详解" />
<meta property="og:description" content="参考视频：FCN网络结构详解(语义分割)_哔哩哔哩_bilibili
FCN是首个端对端的针对像素级预测的全卷积网络 这是作者提出的网络中的输出对比图，可以看到当FCN-8s效果接近真实分割图。
普通卷积分类网络与FCN对比 在这个模型提出之前，我们来看一下普通的卷积分类网络模型结构如下图。
图片中的数字表示的是输出图片的通道数，网络通过卷积下采样得到图片特征，从4096那层开始为全连接层，21是因为使用的PASCAL VOC数据集有20个种类，加上背景一共21个分类，再对这个输出进行上采样，得到与原图相同大小的图片，对它进行softmax处理，输出每一个像素的最大概率分类。
这个网络在当时有一个弊端就是输入图片大小必须相同。有人就想用卷积层去替代后面的三层全连接层，FCN也就是这样产生的。
FCN
如图，将全连接层替换为卷积层后，实际上最后一层4096那一层输出特征会是1000通道的二维图片，高和宽大于1，这样对于每一个通道的数据实际就是2D的数据，这样就能对其可视化了。
为了说明白是如何替换成卷积层的，我们先来看4096通道前面那部分模型结构，也就是VGG16模型，如下图：这里的VGG16指D的配置
分析：从224*224到7*7图片下采样了32倍
全连接层如何转化为卷积层 第一个全连接层转化为卷积层
为了方便连接我们忽略偏执：
如图上面为全连接层，有4096个结点，当上一层展平时得到7*7*512=25088个参数
下面为卷积层，使用的是7*7*4096的卷积核，这样得到1*1*4096的输出，对于一个卷积，参数也为25088
因为参数相同，所以我们可以对上面全连接层的参数进行reshape处理，这样就能构建卷积层，同时因为这样，卷积层处理过的特征相比全连接层保留了高和宽。
（注：图片中的padding可调是指可以对7*7*512输出图片进行处理，一般这个padding为3是为了防止全连接层之前的输出为1*1，这样padding后也能继续处理了。）
接下来的第二个第三个全连接层的处理一样。
FCN-32s、FCN-16s、FCN-8s模型详细讲解 我们先看一张原论文中的一张表如下：
从表中可以看到从FCN-32s到FCN-8s模型，准确率是逐渐提高的。
下图为一张FCN-32s、FCN-16s、FCN-8s的模型整体结构图
图中的FCN-32s其实是对输出的图片进行上采样32倍得到的，因此成为FCN-32s，其他同理也是上采样16倍和上采样8倍。
FCN-32s 分析：图中VGG16Backbone指7 * 7 * 512那一层包括那一层之前的网络结构，经过前面的网络我们得到的是下采样了32倍的特征图。FC6为全连接层改成的第一个卷积层，这一层会padding = 3，所以经过这层图像大小还是h/32,w/32,又采用了4096个卷积所以又4096个通道，然后经过1 * 1的卷积层，输出特征图大小不变，再输入一层大小为1*1卷积核为要分类个数大小的卷积层，接下来用转置卷积上采样32倍，这里括号里面有双线性插值（双线性插值_太阳花的小绿豆的博客-CSDN博客_双线性插值）来初始化转置卷积。
FCN-16s 分析：前面基本和FCN-32s一样，只是上面输出时先对其上采样2倍得到[h/16,w/16,num_cls]大小的特征图，下面Maxpool4（这是VGG16 14 * 14 *512那一层的输入特征图）的输出经过一个1*1num_cls大小的卷积层，得到[h/16,w/16, num_cls]大小的特征图，最后将上面和下面的输出相加进行16的上采样得到最后的heatmap。
FCN-8s 分析：前面基本与FCN-8s和FCN-16s基本相同，基本类似。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d1361069c214b87ffd01c35e146ad4ca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-31T22:08:59+08:00" />
<meta property="article:modified_time" content="2022-12-31T22:08:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FCN网络详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="">参考视频：<a class="kdocs-link" style="color:#0A6CFF;" href="https://www.bilibili.com/video/BV1J3411C7zd/?spm_id_from=333.788&amp;vd_source=6f62aba02fc9ac56aa9063bbce87d3a7" rel="nofollow noopener noreferrer" target="_blank">FCN网络结构详解(语义分割)_哔哩哔哩_bilibili</a></p> 
 <h2 style=""><span class="kdocs-bold" style="font-weight:bold;">FCN是首个端对端的针对像素级预测的全卷积网络</span></h2> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:579;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:41.968914%;height:0;"> 
    <img src="https://images2.imgbox.com/71/d0/HaLQhkba_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-41.968914%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">这是作者提出的网络中的输出对比图，可以看到当FCN-8s效果接近真实分割图。</p> 
 <p style=""> </p> 
 <h3 style="">普通卷积分类网络与FCN对比</h3> 
 <p style="">在这个模型提出之前，我们来看一下普通的卷积分类网络模型结构如下图。</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:639;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:60.406883%;height:0;"> 
    <img src="https://images2.imgbox.com/be/53/JNpwEgiU_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-60.406883%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">图片中的数字表示的是输出图片的通道数，网络通过卷积下采样得到图片特征，从4096那层开始为全连接层，21是因为使用的PASCAL VOC数据集有20个种类，加上背景一共21个分类，再对这个输出进行上采样，得到与原图相同大小的图片，对它进行softmax处理，输出每一个像素的最大概率分类。</p> 
 <p style="">这个网络在当时有一个弊端就是<span class="kdocs-bold" style="font-weight:bold;">输入图片大小必须相同</span>。有人就想用卷积层去替代后面的三层全连接层，FCN也就是这样产生的。</p> 
 <p style=""> </p> 
 <p style=""><span class="kdocs-fontSize" style="font-size:16pt;">FCN</span></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:767;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:72.35985%;height:0;"> 
    <img src="https://images2.imgbox.com/96/44/5kcz2pH3_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-72.35985%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">如图，将全连接层替换为卷积层后，实际上最后一层4096那一层输出特征会是1000通道的二维图片，高和宽大于1，这样对于<span class="kdocs-bold" style="font-weight:bold;">每一个通道的数据实际就是2D的数据，这样就能对其可视化了</span>。</p> 
 <p style="">为了说明白是如何替换成卷积层的，我们先来看4096通道前面那部分模型结构，也就是<span class="kdocs-bold" style="font-weight:bold;">VGG16模型</span>，如下图：这里的VGG16指D的配置</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:744;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.682796%;height:0;"> 
    <img src="https://images2.imgbox.com/7b/ee/J7pWhBsq_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-43.682796%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">分析：从224*224到7*7图片下采样了32倍</p> 
 <p style=""> </p> 
 <h3 style="">全连接层如何转化为卷积层</h3> 
 <p style="">第一个全连接层转化为卷积层</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:758;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:50.131927%;height:0;"> 
    <img src="https://images2.imgbox.com/45/21/jiv40ExH_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-50.131927%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">为了方便连接我们忽略偏执：</p> 
 <p style="">如图上面为全连接层，有4096个结点，当上一层展平时得到7*7*512=25088个参数</p> 
 <p style="">下面为卷积层，使用的是7*7*4096的卷积核，这样得到1*1*4096的输出，对于一个卷积，参数也为25088</p> 
 <p style="">因为<span class="kdocs-bold" style="font-weight:bold;">参数相同，所以我们可以对上面全连接层的参数进行reshape处理，这样就能构建卷积层，同时因为这样，卷积层处理过的特征相比全连接层保留了高和宽</span>。</p> 
 <p style="">（注：图片中的padding可调是指可以对7*7*512输出图片进行处理，一般这个padding为3是为了防止全连接层之前的输出为1*1，这样padding后也能继续处理了。）</p> 
 <p style="">接下来的第二个第三个全连接层的处理一样。</p> 
 <p style=""> </p> 
 <h2 style=""><span class="kdocs-bold" style="font-weight:bold;">FCN-32s、FCN-16s、FCN-8s模型详细讲解</span></h2> 
 <p style="">我们先看一张原论文中的一张表如下：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:750;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.6%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/bf/oJ1AH6k2_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-47.6%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">从表中可以看到从FCN-32s到FCN-8s模型，准确率是逐渐提高的。</p> 
 <p style="">下图为一张FCN-32s、FCN-16s、FCN-8s的模型整体结构图</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:817;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:38.67809%;height:0;"> 
    <img src="https://images2.imgbox.com/f0/63/JbslUC3Y_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-38.67809%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">图中的FCN-32s其实是对输出的图片进行上采样32倍得到的，因此成为FCN-32s，其他同理也是上采样16倍和上采样8倍。</p> 
 <p style=""> </p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">FCN-32s</span></h3> 
 <p style=""> </p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:811;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:30.456226%;height:0;"> 
    <img src="https://images2.imgbox.com/05/51/URbBXhkI_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-30.456226%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">分析：图中VGG16Backbone指7 * 7 * 512那一层包括那一层之前的网络结构，经过前面的网络我们得到的是下采样了32倍的特征图。FC6为全连接层改成的第一个卷积层，这一层会padding = 3，所以经过这层图像大小还是h/32,w/32,又采用了4096个卷积所以又4096个通道，然后经过1 * 1的卷积层，输出特征图大小不变，再输入一层大小为1*1卷积核为要分类个数大小的卷积层，接下来用转置卷积上采样32倍，这里括号里面有双线性插值（<a class="kdocs-link" style="color:#0A6CFF;" href="https://blog.csdn.net/qq_37541097/article/details/112564822" target="_blank" rel="noopener noreferrer">双线性插值_太阳花的小绿豆的博客-CSDN博客_双线性插值</a>）来初始化转置卷积。</p> 
 <p style=""> </p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">FCN-16s</span></h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:830;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:48.072292%;height:0;"> 
    <img src="https://images2.imgbox.com/15/f7/oGUiI3k5_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-48.072292%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">分析：前面基本和FCN-32s一样，只是上面输出时先对其上采样2倍得到[h/16,w/16,num_cls]大小的特征图，下面Maxpool4（这是VGG16 14 * 14 *512那一层的输入特征图）的输出经过一个1*1num_cls大小的卷积层，得到[h/16,w/16, num_cls]大小的特征图，最后将上面和下面的输出相加进行16的上采样得到最后的heatmap。</p> 
 <p style=""> </p> 
 <h3 style=""><span class="kdocs-bold" style="font-weight:bold;">FCN-8s</span></h3> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="background-color:#F5F7F9;flex-direction:column;max-width:100%;display:flex;width:829;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:45.95899%;height:0;"> 
    <img src="https://images2.imgbox.com/8a/76/ehRJDU39_o.png" style="margin-left:;display:block;width:100.0%;margin-top:-45.95899%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">分析：前面基本与FCN-8s和FCN-16s基本相同，基本类似。</p> 
 <p style=""></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ae737ef9bdab7ed21cdbdf4cff30a40b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vscode下载安装</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fe8dd3f5783ed23eae3e5f3a936a2778/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于CNN-Lstm负荷预测（Python代码实现）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>