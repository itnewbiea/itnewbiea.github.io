<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用EPPlus实现Excel导出功能 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用EPPlus实现Excel导出功能" />
<meta property="og:description" content="该示例是在APS.NET MVC使用EPPlus实现Excel导出功能，下面是导出Excel的demo：
前端代码 &lt;div style=&#34;float: left; margin-top: 10px; margin-right: 30px; &#34;&gt; &lt;button class=&#34;btn btn-primary&#34; type=&#34;button&#34; onclick=&#34;Export()&#34;&gt; 导出 &lt;/button&gt; &lt;/div&gt; &lt;script type=&#34;text/javascript&#34;&gt; function Export() { var data = {}; data[&#34;CODE&#34;] = $(&#34;#CODE&#34;).val(); data[&#34;FACTORYNAME&#34;] = $(&#34;#FACTORYNAME&#34;).val(); data[&#34;CREATEDON&#34;] = $(&#34;#CREATEDON&#34;).val(); data[&#34;CREATEDON1&#34;] = $(&#34;#CREATEDON1&#34;).val(); data[&#34;STATE&#34;] = $(&#34;#STATE&#34;).val(); $.ajax({ url: &#34;/PersonnelModule/YH_SPEED_APPLY/Export?r=&#34; &#43; Math.round(Math.random() * 10000), data: data, type: &#34;POST&#34;, cache: false, async: false, dataType: &#34;json&#34;, success: function (result) { if (result.url == &#34;&#34;) { alert(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d19f223e242181db1c5cc48cabc9263a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-19T11:22:02+08:00" />
<meta property="article:modified_time" content="2021-02-19T11:22:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用EPPlus实现Excel导出功能</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>该示例是在APS.NET MVC使用EPPlus实现Excel导出功能，下面是导出Excel的demo：</p> 
<h4><img alt="" height="554" src="https://images2.imgbox.com/ba/2a/5PqbapuY_o.png" width="1200">前端代码</h4> 
<pre><code class="language-html">&lt;div style="float: left; margin-top: 10px; margin-right: 30px; "&gt;
    &lt;button class="btn btn-primary" type="button" onclick="Export()"&gt;
        导出
    &lt;/button&gt;
&lt;/div&gt;
&lt;script type="text/javascript"&gt;
function Export() {
        var data = {};
        data["CODE"] = $("#CODE").val();
        data["FACTORYNAME"] = $("#FACTORYNAME").val();
        data["CREATEDON"] = $("#CREATEDON").val();
        data["CREATEDON1"] = $("#CREATEDON1").val();
        data["STATE"] = $("#STATE").val();

        $.ajax({
            url: "/PersonnelModule/YH_SPEED_APPLY/Export?r=" + Math.round(Math.random() * 10000),
            data: data,
            type: "POST",
            cache: false,
            async: false,
            dataType: "json",
            success: function (result) {
                if (result.url == "") {
                    alert("导出失败");
                }
                else {
                    window.location.href = result.url;
                }
            }
        });
    }
&lt;/script&gt;</code></pre> 
<h4>后端代码</h4> 
<pre><code class="language-cs">using OfficeOpenXml;
using OfficeOpenXml.Style;
using System.Drawing;

//Excel导出
public ActionResult Export(string CUSTOMERNAME, string CODE, string FACTORYNAME, string CREATEDON, string CREATEDON1, string STATE, bootstrapTableParam bootstrapTableParam)
{
    using (MiniPoco.Database db = new MiniPoco.Database("PDDA"))
    {
        try
        {
            string sqlWhere = " where 1 = 1 ";

            if (!string.IsNullOrEmpty(CODE))
            {
                sqlWhere += string.Format(@" and A.CODE like '%{0}%' ", CODE);
            }
            if (!string.IsNullOrEmpty(CUSTOMERNAME))
            {
                sqlWhere += string.Format(@" and A.CUSTOMERNAME like '%{0}%' ", CUSTOMERNAME);
            }
            if (!string.IsNullOrEmpty(FACTORYNAME))
            {
                sqlWhere += string.Format(@" and A.FACTORYNAME = '{0}' ", FACTORYNAME);
            }

            if (!string.IsNullOrEmpty(CREATEDON))
            {
                sqlWhere += string.Format(@" and to_date(to_char(A.CREATEDON,'yyyy-MM-dd'),'yyyy-MM-dd') &gt;= to_date('{0}','yyyy-MM-dd')", CREATEDON);
            }
            if (!string.IsNullOrEmpty(CREATEDON1))
            {
                sqlWhere += string.Format(@" and to_date(to_char(A.CREATEDON,'yyyy-MM-dd'),'yyyy-MM-dd') &lt;= to_date('{0}','yyyy-MM-dd')", CREATEDON1);
            }
            if (!string.IsNullOrEmpty(STATE))
            {
                sqlWhere += string.Format(@" and A.STATE ='{0}' ", STATE);
            }
            //加载要导出的数据
            List&lt;Hashtable&gt; ListData = new List&lt;Hashtable&gt;();
            string sql = string.Format(@"select A.* from YH_SPEED_APPLY A {0} order by A.CREATEDON desc", sqlWhere);
            ListData = db.GetHashtable(sql);
            //设置要导出的位置
            string fileName = string.Format("YH_SPEED_APPLY_{0}.xlsx", DateTime.Now.ToString("yyyyMMddHHmmss"));
            string serverPath = Server.MapPath("~/Upload/DownloadExcal/YH_SPEED_APPLY/");
            if (!Directory.Exists(serverPath))
            {
                Directory.CreateDirectory(serverPath);
            }
            string fileUrl = Path.Combine(serverPath, fileName);
            FileInfo info = new FileInfo(fileUrl);
            if (info.Exists)
            {
                info.Delete();
                info = new FileInfo(fileUrl);
            }

            using (ExcelPackage package = new ExcelPackage(info))
            {
                ExcelWorksheet worksheet = package.Workbook.Worksheets.Add("印花车速申请");
                ListToExcel(worksheet, ListData);
                package.Save();
            }

            string path = "/Upload/DownloadExcal/YH_SPEED_APPLY/" + fileName;
            Hashtable result = new Hashtable();
            result["url"] = path;
            return Json(result);
        }
        catch (Exception ex)
        {
            return Content(ex.Message);
        }
    }
}
//列表转为Excel
public void ListToExcel(ExcelWorksheet excelWorksheet, List&lt;Hashtable&gt; list)
{
    //定义Excel行数
    int lineNumber = 1, columnNumber = 1;
    //绘制Excel总标题
    excelWorksheet.Cells[lineNumber, 1, lineNumber, 14].Value = "印花车速申请";
    excelWorksheet.Cells[lineNumber, 1, lineNumber, 14].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
    excelWorksheet.Cells[lineNumber, 1, lineNumber, 14].Style.Font.SetFromFont(new Font("宋体", 20f, FontStyle.Regular));
    excelWorksheet.Cells[lineNumber, 1, lineNumber, 14].Merge = true;
    //绘制Excel列表标题
    lineNumber++; columnNumber = 0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "申请分厂";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "申请日期";
    excelWorksheet.Column(columnNumber).Width = 20.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "申请人";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "申请类型";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "申请机台";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "状态";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "客户名称";
    excelWorksheet.Column(columnNumber).Width = 25.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "色号";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "品名";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "米数";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "申请车速";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "磁棒";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "车速申请的原因";
    excelWorksheet.Column(columnNumber).Width = 25.0;
    excelWorksheet.Cells[lineNumber, ++columnNumber].Value = "其他备注";
    excelWorksheet.Column(columnNumber).Width = 15.0;
    excelWorksheet.Cells[lineNumber, 1, lineNumber, columnNumber].Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
    //绘制Excel列表
    lineNumber++; 
    if (list.Count &gt; 0)
    {
        foreach (var items in list)
        {
            columnNumber = 0;
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["FACTORYNAME"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["CREATEDON"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["CREATEDNAME"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["TYPE"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["MACHINE"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["STATE"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["CUSTOMERNAME"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["COLORCODE"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["PRODUCTNAME"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["METERS"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["SPEED"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["MAGNETICBAR"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["REASON"].ToString());
            DrawExcelListCell(excelWorksheet, lineNumber, ++columnNumber, items["REMARK"].ToString());

            excelWorksheet.Row(lineNumber).Height = 20.0;
            lineNumber++;
        }
    }
}
//绘制列表单元格
public void DrawExcelListCell(ExcelWorksheet excelWorksheet, int lineNumber, int columnNumber, string value)
{
    using (ExcelRange range = excelWorksheet.Cells[lineNumber, columnNumber])
    {
        range.Value = value;
        range.Style.Font.SetFromFont(new Font("宋体", 10f, FontStyle.Regular));
        range.Style.HorizontalAlignment = ExcelHorizontalAlignment.Center;
        range.Style.VerticalAlignment = ExcelVerticalAlignment.Center;
        range.Style.WrapText = true;
    }
 
}
</code></pre> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/403cac80a2f30c421063144811acce9a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">说一说will-change</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/34f069b5e4df899499e348c192d5017d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于css中height高度（100%与auto）使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>