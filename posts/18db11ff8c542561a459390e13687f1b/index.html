<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Oracle】VC6.0使用 odbc 访问 Oracle 存储过程 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Oracle】VC6.0使用 odbc 访问 Oracle 存储过程" />
<meta property="og:description" content="环境说明 系统环境 系统：Windows XP IDE： Microsoft Visual C&#43;&#43; 6.0 msado15.dll： 文件版本： 6.2.19041.3570产品版本： 10.0.19041.3570 数据源驱动程序：Oracle in OraClient11g_home1 - Oracle Datebase Client 11g Release 2 (11.2.0.1.0) for Microsoft Windows (32-Bit)
使用的对象 msado15.tlh _ConnectionPtr m_pConnection; HRESULT hr = m_pConnection.CreateInstance(“ADODB.Connection”);
_RecordsetPtr m_pRecordset; m_pRecordset.CreateInstance(“ADODB.Recordset”);
_CommandPtr m_pCommand; m_pCommand.CreateInstance(“ADODB.Command”);
_ParameterPtr pInputParam; pInputParam.CreateInstance(__uuidof(Parameter));
Oracle 存储过程 Procedures
CREATE OR REPLACE PROCEDURE PRO_DISPENSER_DISPENSING ( I_CHFM IN VARCHAR2 , ERR_NO OUT NUMBER , ERR_MSG OUT VARCHAR2 ) AS BEGIN ERR_NO := 1; ERR_MSG := I_CHFM; END PRO_DISPENSER_DISPENSING; 使用Oracle SQL Developer 调用存储过程 DECLARE v_err_no NUMBER; v_err_msg VARCHAR2(100); BEGIN PRO_DISPENSER_DISPENSING(&#39;少莫千华&#39;, v_err_no, v_err_msg); DBMS_OUTPUT." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/18db11ff8c542561a459390e13687f1b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-26T11:43:41+08:00" />
<meta property="article:modified_time" content="2023-10-26T11:43:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Oracle】VC6.0使用 odbc 访问 Oracle 存储过程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>环境说明</h2> 
<h3><a id="_1"></a>系统环境</h3> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> 系统：Windows XP</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> IDE： Microsoft Visual C++ 6.0</li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> msado15.dll： 
  <ul><li>文件版本： <code>6.2.19041.3570</code></li><li>产品版本： <code>10.0.19041.3570</code></li></ul> </li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> 数据源驱动程序：<code>Oracle in OraClient11g_home1</code> - <code>Oracle Datebase Client 11g Release 2 (11.2.0.1.0) for Microsoft Windows (32-Bit)</code><br> <img src="https://images2.imgbox.com/b0/42/FAlkdroC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/9c/38/vZYdXK3p_o.png" alt="在这里插入图片描述"></li></ul> 
<h3><a id="_msado15tlh_11"></a>使用的对象 msado15.tlh</h3> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <code>_ConnectionPtr</code> m_pConnection; 
  <blockquote> 
   <p>HRESULT hr = m_pConnection.CreateInstance(“ADODB.Connection”);</p> 
  </blockquote> </li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <code>_RecordsetPtr</code> m_pRecordset; 
  <blockquote> 
   <p>m_pRecordset.CreateInstance(“ADODB.Recordset”);</p> 
  </blockquote> </li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <code>_CommandPtr</code> m_pCommand; 
  <blockquote> 
   <p>m_pCommand.CreateInstance(“ADODB.Command”);</p> 
  </blockquote> </li><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> <code>_ParameterPtr</code> pInputParam; 
  <blockquote> 
   <p>pInputParam.CreateInstance(__uuidof(Parameter));</p> 
  </blockquote> </li></ul> 
<h2><a id="Oracle__20"></a>Oracle 存储过程</h2> 
<p>Procedures</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token operator">OR</span> <span class="token keyword">REPLACE</span> <span class="token keyword">PROCEDURE</span> PRO_DISPENSER_DISPENSING 
<span class="token punctuation">(</span>
  I_CHFM <span class="token operator">IN</span> VARCHAR2  
<span class="token punctuation">,</span> ERR_NO <span class="token keyword">OUT</span> NUMBER  
<span class="token punctuation">,</span> ERR_MSG <span class="token keyword">OUT</span> VARCHAR2  
<span class="token punctuation">)</span> <span class="token keyword">AS</span> 
<span class="token keyword">BEGIN</span>
  ERR_NO :<span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  ERR_MSG :<span class="token operator">=</span> I_CHFM<span class="token punctuation">;</span>
<span class="token keyword">END</span> PRO_DISPENSER_DISPENSING<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="Oracle_SQL_Developer__35"></a>使用Oracle SQL Developer 调用存储过程</h3> 
<pre><code class="prism language-sql">  <span class="token keyword">DECLARE</span>
    v_err_no NUMBER<span class="token punctuation">;</span>
    v_err_msg VARCHAR2<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">BEGIN</span>
    PRO_DISPENSER_DISPENSING<span class="token punctuation">(</span><span class="token string">'少莫千华'</span><span class="token punctuation">,</span> v_err_no<span class="token punctuation">,</span> v_err_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">'Error number: '</span> <span class="token operator">||</span> v_err_no<span class="token punctuation">)</span><span class="token punctuation">;</span>
    DBMS_OUTPUT<span class="token punctuation">.</span>PUT_LINE<span class="token punctuation">(</span><span class="token string">'Error message: '</span> <span class="token operator">||</span> v_err_msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">END</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/bb/W8pEk6Cq_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="VC60__49"></a>VC6.0 完整代码</h2> 
<p><strong>注意事项：以下代码可以会出现第一次调用成功，第二次调用失败的情况，建议每次调用都关闭链接，再重新打开链接再调用存储过程。</strong></p> 
<pre><code class="prism language-cpp">	CADOManage<span class="token operator">*</span> adb <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">CADOManage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    LONG errorCode <span class="token operator">=</span> adb<span class="token operator">-&gt;</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>errorCode <span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">continue</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 调用存储过程</span>
	errorCode <span class="token operator">=</span> adb<span class="token operator">-&gt;</span><span class="token function">execSQL2</span><span class="token punctuation">(</span><span class="token char">'入参1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>errorCode <span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		adb<span class="token operator">-&gt;</span><span class="token function">freeRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		adb<span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">continue</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	adb<span class="token operator">-&gt;</span><span class="token function">freeRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	adb<span class="token operator">-&gt;</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">long</span> <span class="token class-name">CADOManage</span><span class="token double-colon punctuation">::</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span>								
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//return open(param);</span>
	string connectMode <span class="token operator">=</span> configUtil<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span>cfghis_unMysql_DBConnectMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">try</span>
	<span class="token punctuation">{<!-- --></span>
		rootLogger<span class="token operator">-&gt;</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"function open start.............."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">CoInitialize</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		HRESULT hr <span class="token operator">=</span> m_pConnection<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token string">"ADODB.Connection"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">///创建Connection对象</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">SUCCEEDED</span><span class="token punctuation">(</span>hr<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
            <span class="token comment">//dbType = "MYSQL";</span>
			_bstr_t connStr<span class="token punctuation">;</span>
			m_pConnection<span class="token operator">-&gt;</span>CursorLocation<span class="token operator">=</span>adUseClient<span class="token punctuation">;</span>
				<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span> DBCMORA_NUM<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>egOracleCoonectUI<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> connectMode<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						string strConnect<span class="token punctuation">;</span>
						CString cstrConnect<span class="token punctuation">;</span>
						cstrConnect <span class="token operator">=</span><span class="token function">stringToCString</span><span class="token punctuation">(</span>egOracleCoonect<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">;</span>
						cstrConnect<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"myHost"</span><span class="token punctuation">,</span><span class="token function">stringToCString</span><span class="token punctuation">(</span>ADODBparam<span class="token punctuation">.</span>m_server<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						cstrConnect<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"myUser"</span><span class="token punctuation">,</span><span class="token function">stringToCString</span><span class="token punctuation">(</span>ADODBparam<span class="token punctuation">.</span>m_uid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						cstrConnect<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"myPassword"</span><span class="token punctuation">,</span><span class="token function">stringToCString</span><span class="token punctuation">(</span>ADODBparam<span class="token punctuation">.</span>m_pwd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						cstrConnect<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"myDSName"</span><span class="token punctuation">,</span><span class="token function">stringToCString</span><span class="token punctuation">(</span>ADODBparam<span class="token punctuation">.</span>m_data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>ADODBparam<span class="token punctuation">.</span>m_port <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>
							ADODBparam<span class="token punctuation">.</span>m_port <span class="token operator">=</span> <span class="token number">1433</span><span class="token punctuation">;</span>
						cstrConnect<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"myPort"</span><span class="token punctuation">,</span><span class="token function">stringToCString</span><span class="token punctuation">(</span>ADODBparam<span class="token punctuation">.</span>m_port<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

						strConnect <span class="token operator">=</span> <span class="token function">CStringTostring</span><span class="token punctuation">(</span>cstrConnect<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">==</span> DBCMORA_ODBC1 <span class="token operator">||</span> i<span class="token operator">==</span>DBCMORA_OLEDBMS13 <span class="token operator">||</span> i<span class="token operator">==</span>DBCMORA_OLEDBOracle1<span class="token punctuation">)</span>
						<span class="token punctuation">{<!-- --></span>
							m_pConnection<span class="token operator">-&gt;</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token function">_bstr_t</span><span class="token punctuation">(</span>strConnect<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>_bstr_t<span class="token punctuation">)</span>ADODBparam<span class="token punctuation">.</span>m_uid<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>_bstr_t<span class="token punctuation">)</span>ADODBparam<span class="token punctuation">.</span>m_pwd<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>adConnectUnspecified<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>i<span class="token operator">==</span> DBCMORA_ODBC3<span class="token punctuation">)</span>
						<span class="token punctuation">{<!-- --></span>
								m_pConnection<span class="token operator">-&gt;</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token function">_bstr_t</span><span class="token punctuation">(</span>strConnect<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>_bstr_t<span class="token punctuation">)</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>_bstr_t<span class="token punctuation">)</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>adModeUnknown<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
						<span class="token keyword">else</span>
						<span class="token punctuation">{<!-- --></span>
							m_pConnection<span class="token operator">-&gt;</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token function">_bstr_t</span><span class="token punctuation">(</span>strConnect<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>_bstr_t<span class="token punctuation">)</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">(</span>_bstr_t<span class="token punctuation">)</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">,</span>adConnectUnspecified<span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token punctuation">}</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>	
			bOpen<span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
			m_pRecordset<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token string">"ADODB.Recordset"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			m_pCommand<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token string">"ADODB.Command"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			m_pCommand<span class="token operator">-&gt;</span>ActiveConnection <span class="token operator">=</span> m_pConnection<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span><span class="token punctuation">(</span>_com_error e<span class="token punctuation">)</span><span class="token comment">///捕捉异常</span>
	<span class="token punctuation">{<!-- --></span>
		string errormessage<span class="token punctuation">;</span>
		errormessage <span class="token operator">=</span> <span class="token string">"连接ADO数据库失败!\r错误信息:"</span><span class="token punctuation">;</span>
		errormessage <span class="token operator">+=</span>e<span class="token punctuation">.</span><span class="token function">ErrorMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		rootLogger<span class="token operator">-&gt;</span><span class="token function">fatal</span><span class="token punctuation">(</span>errormessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//	AfxMessageBox(errormessage.c_str());///显示错误信息</span>
		<span class="token comment">//bOpen= false;</span>
        <span class="token keyword">return</span> ER_DB_CONNECT<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	rootLogger<span class="token operator">-&gt;</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"function open end.............."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>		
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">long</span> <span class="token class-name">CADOManage</span><span class="token double-colon punctuation">::</span><span class="token function">execSQL2</span><span class="token punctuation">(</span><span class="token keyword">const</span> string <span class="token operator">&amp;</span>sqlText<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>	
		rootLogger<span class="token operator">-&gt;</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"function execSQL start.............."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		mute<span class="token operator">-&gt;</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">int</span> nRet <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		
		<span class="token keyword">if</span> <span class="token punctuation">(</span>sqlText <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			rootLogger<span class="token operator">-&gt;</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">"no SQL text!.............."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			mute<span class="token operator">-&gt;</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> WM_NO_SQLTEXT<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		
		<span class="token function">freeRecord</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		rootLogger<span class="token operator">-&gt;</span><span class="token function">debug</span><span class="token punctuation">(</span><span class="token string">"sqlText = "</span> <span class="token operator">+</span> sqlText<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//设置命令类型</span>
		m_pCommand<span class="token operator">-&gt;</span>CommandType <span class="token operator">=</span> adCmdStoredProc<span class="token punctuation">;</span>
		<span class="token comment">//设置存储过程名称</span>
		m_pCommand<span class="token operator">-&gt;</span>CommandText <span class="token operator">=</span><span class="token function">_bstr_t</span><span class="token punctuation">(</span><span class="token string">"pro_dispenser_dispensing"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		m_pCommand<span class="token operator">-&gt;</span><span class="token function">put_CommandTimeout</span><span class="token punctuation">(</span><span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		_ParameterPtr pInputParam<span class="token punctuation">,</span>pOutputParam1<span class="token punctuation">,</span>pOutputParam2<span class="token punctuation">;</span>
		pInputParam<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token function">__uuidof</span><span class="token punctuation">(</span>Parameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pOutputParam1<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token function">__uuidof</span><span class="token punctuation">(</span>Parameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pOutputParam2<span class="token punctuation">.</span><span class="token function">CreateInstance</span><span class="token punctuation">(</span><span class="token function">__uuidof</span><span class="token punctuation">(</span>Parameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//设置入参 i_cfhm 名称、数据类型、输入/输出、长度、内容</span>
        pInputParam <span class="token operator">=</span> m_pCommand<span class="token operator">-&gt;</span><span class="token function">CreateParameter</span><span class="token punctuation">(</span><span class="token function">_bstr_t</span><span class="token punctuation">(</span><span class="token string">"i_cfhm"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> adVarChar<span class="token punctuation">,</span> adParamInput<span class="token punctuation">,</span> sqlText<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> sqlText<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pInputParam<span class="token operator">-&gt;</span>Value <span class="token operator">=</span> <span class="token function">_variant_t</span><span class="token punctuation">(</span>sqlText<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置出参1 err_no 名称、数据类型、输入/输出、长度</span>
		pOutputParam1 <span class="token operator">=</span> m_pCommand<span class="token operator">-&gt;</span><span class="token function">CreateParameter</span><span class="token punctuation">(</span><span class="token function">_bstr_t</span><span class="token punctuation">(</span><span class="token string">"err_no"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> adInteger<span class="token punctuation">,</span> adParamOutput<span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//设置出参2 err_msg 名称、数据类型、输入/输出、长度</span>
        pOutputParam2 <span class="token operator">=</span> m_pCommand<span class="token operator">-&gt;</span><span class="token function">CreateParameter</span><span class="token punctuation">(</span><span class="token function">_bstr_t</span><span class="token punctuation">(</span><span class="token string">"err_msg"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> adVarChar<span class="token punctuation">,</span> adParamOutput<span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pOutputParam2<span class="token operator">-&gt;</span>Size <span class="token operator">=</span> <span class="token number">1024</span><span class="token punctuation">;</span>
		<span class="token comment">//添加入参1 到 命令</span>
		m_pCommand<span class="token operator">-&gt;</span>Parameters<span class="token operator">-&gt;</span><span class="token function">Append</span><span class="token punctuation">(</span>pInputParam<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//添加入出参1 到 命令</span>
        m_pCommand<span class="token operator">-&gt;</span>Parameters<span class="token operator">-&gt;</span><span class="token function">Append</span><span class="token punctuation">(</span>pOutputParam1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//添加入出参2 到 命令</span>
        m_pCommand<span class="token operator">-&gt;</span>Parameters<span class="token operator">-&gt;</span><span class="token function">Append</span><span class="token punctuation">(</span>pOutputParam2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//以存储过程的形式adCmdStoredProc 执行命令</span>
		m_pRecordset <span class="token operator">=</span> m_pCommand<span class="token operator">-&gt;</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">,</span>adCmdStoredProc<span class="token punctuation">)</span><span class="token punctuation">;</span> 
		
		_variant_t errNoValue <span class="token operator">=</span> pOutputParam1<span class="token operator">-&gt;</span>Value<span class="token punctuation">;</span>
		_variant_t errMsgValue <span class="token operator">=</span> pOutputParam2<span class="token operator">-&gt;</span>Value<span class="token punctuation">;</span>

		<span class="token comment">// 转换为具体的类型</span>
		<span class="token keyword">long</span> errNo <span class="token operator">=</span> errNoValue<span class="token punctuation">.</span>lVal<span class="token punctuation">;</span>
		CString temp<span class="token punctuation">;</span>
		temp<span class="token punctuation">.</span><span class="token function">Format</span><span class="token punctuation">(</span><span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"%ld"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> errNo<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">MessageBox</span><span class="token punctuation">(</span><span class="token constant">NULL</span><span class="token punctuation">,</span> temp<span class="token punctuation">,</span> <span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"err_no"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> MB_OK<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>errMsgValue<span class="token punctuation">.</span>bstrVal <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			_bstr_t errMsg <span class="token operator">=</span> errMsgValue<span class="token punctuation">.</span>bstrVal<span class="token punctuation">;</span>
			string <span class="token function">temp</span><span class="token punctuation">(</span>errMsg<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		m_pCommand
		<span class="token operator">-&gt;</span>Parameters<span class="token operator">-&gt;</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pInputParam<span class="token operator">-&gt;</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pOutputParam1<span class="token operator">-&gt;</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pOutputParam2<span class="token operator">-&gt;</span><span class="token function">Release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		mute<span class="token operator">-&gt;</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		rootLogger<span class="token operator">-&gt;</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">"function execSQL end.............."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">catch</span> <span class="token punctuation">(</span>_com_error e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        string errormessage <span class="token operator">=</span> e<span class="token punctuation">.</span><span class="token function">ErrorMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        
		rootLogger<span class="token operator">-&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"failed to execute SQL:"</span> <span class="token operator">+</span> errormessage<span class="token punctuation">)</span><span class="token punctuation">;</span>
		rootLogger<span class="token operator">-&gt;</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"failed sql = "</span> <span class="token operator">+</span> sqlText<span class="token punctuation">)</span><span class="token punctuation">;</span>
		mute<span class="token operator">-&gt;</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> ER_EXECUTE_SQL<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="_213"></a>报错情况</h2> 
<p>使用 <code>m_pCommand-&gt;Execute(NULL, NULL,adCmdStoredProc)</code>调用Oracle存储过程时遇到了异常。</p> 
<ul><li class="task-list-item"><input type="checkbox" class="task-list-item-checkbox" checked disabled> 数据源驱动程序: <code>Oracle in OraClient12Home1_32bit</code></li></ul> 
<p>这种情况可能是由于不同版本的<code>Oracle</code>驱动与<code>msado15.dll</code>之间的兼容性问题导致的。不同版本的驱动程序和库文件可能具有不同的接口和行为，因此在使用不同版本的驱动程序时可能会出现不兼容的情况。<br> 解决此问题的一种方法是确保使用的<code>Oracle驱动程序</code>与<code>msado15.dll</code>版本兼容。您可以尝试以下解决方案：</p> 
<ol><li>更换<code>msado库</code> - 确认您的代码中使用的是与<code>Oracle驱动程序</code>版本相匹配的<code>msado15.dll</code>库文件。如果您使用的是<code>Oracle in OraClient12Home1_32bit</code>驱动程序，尝试使用与该驱动程序版本相对应的<code>msado15.dll</code>库文件。</li><li>如果您无法找到与Oracle驱动程序版本完全匹配的<code>msado15.dll</code>库文件，可以尝试升级或降级<code>Oracle驱动程序</code>版本,如：<code>Oracle in OraClient11g_home1</code>，以确保与可用的<code>msado15.dll</code>库文件兼容。</li><li>另外，您还可以考虑使用其他的数据库连接库或方法来连接和调用Oracle存储过程。例如，可以尝试使用<code>Oracle</code>提供的官方的<code>ODBC驱动程序</code>或其他<code>第三方的数据库连接库</code>，以避免与<code>msado15.dll</code>版本不兼容的问题。</li></ol> 
<h3><a id="Microsoft_C__long_224"></a>Microsoft C++ 异常: long，位于内存位置</h3> 
<blockquote> 
 <p>0x75FOD982 处(位于 OracleTest.exe 中)发的异常: Microsoft C++ 异常: long，位于内存位置 0x00E6D88C 处。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/8e/7a/g157vlFg_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>0x75FOD982 处(位于 OracleTest.exe 中)发的异常: Microsoft C++ 异常: long，位于内存位置 0x0133D9A4 处。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/c7/c7/VTn8B0FL_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ceb8e447329a90103369970ffcf0957b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">org.springframework.beans.factory.UnsatisfiedDependencyException: Error creating bean with name ‘use</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5a3f469035f7fb015532504d8f48d4e3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【js进阶】-深浅拷贝</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>