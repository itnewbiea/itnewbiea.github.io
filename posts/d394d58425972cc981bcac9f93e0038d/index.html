<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C语言结构体，共用体占用内存原理解析 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C语言结构体，共用体占用内存原理解析" />
<meta property="og:description" content="C语言结构体占用内存原理解析 结构体内存原理解析：共用体内存原理解析：sizeof计算结构体内存占用需要注意 结构体内存原理解析： 结构体在内存中的存储有以下规则：
结构体成员中的起始地址应该是该成员所占内存的整数倍，如果不足整数倍需要补齐结构体所占内存为结构体成员中最大的基础数据类型的整数倍。
这里说下基础类型：int,short,char,long,long long,double,float
规则1解析： typedef struct{ char a; int b; }Msg; 结构体Msg在内存中的存储方式如下图所示：
a占用了第0个字节，b并没有占用第一个字节，因为b的起始位置要是b的整数倍，所以b空了3个字节占用了4,5,6,7字节。所以这个结构体sizeof的结果就是8；
规则2解析：
typedef struct { int a; char c[6]; }Data; typedef struct{ double head; Data data; }Msg; 结构体Msg的存储方式如下：
head占用了0-7共8个字节，结构体Data中的成员a占用了8-11共4个字节字符串c占用了12-17共6个字节，此时该结构体共占内存18个字节，但是规则2中规定了结构所占内存为成员中最大基本类型的整数倍，最小基准类型为double,所以为8的整数倍2乘以8&lt;18&lt;3乘以8;故此结构体Msg占内存3*8=24个字节。如果子结构体中的成员类型为最大基本类型，那么结构体所占内存就是子结构体中最大基本类型的整数倍。下面举例：
typedef struct { double a; char c[3]; }Data; typedef struct{ int head; Data data; }Msg; 结构体Msg的存储方式如下：
head占用4个字节，子结构体成员a占用8个字节此时注意规则1，所以空4个字节从8-15存储a，字符串的基本类型是char所以不用空，共占用19个字节下面考虑对其补齐：
如果按照结构体成员最大类型int为最大基本类型算出来所占内存就是20字节；如果按照最大类型为子结构体（子结构体所占内存为16字节）为最大类型算出来所占内存就是就是32字节；如果按照子结构体和子结构体成员基本类型为最大类型（double为最大基本类型）那么算出所占内存就为24字节。
上面总结了三种对其方式，C语言中的补齐方式为第3种，前2种也是读者在计算结构体占用内存可能出现错误的地方。所以规则2中强调的是基本类型，不包括结构体，共用体这种。 通过上面的存储方式分析，希望读者在定义结构体时成员顺序要有考量，否则会导致无效的内存占用：
typedef struct{ char b; int head; char a; }Msg; 上面这么定义结构体占用内存空间为12字节；
下面两种定义方式结构体占用内存空间为8字节；
typedef struct{ int head; char b; char a; }Msg; typedef struct{ char b; char a; int head; }Msg; 共用体内存原理解析： 共用体多个数据成员只能同时存在一种，并不是将空间分配给每个成员，而是只按照最大成员的大小分配内存空间。如果共用体中出现结构体，那么就先算出结构体所占空间，和其他成员比较所占内存大小，按照最大的成员分配内存空间，同时需满足最大基本类型整数倍原则。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d394d58425972cc981bcac9f93e0038d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-12T13:32:48+08:00" />
<meta property="article:modified_time" content="2023-01-12T13:32:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C语言结构体，共用体占用内存原理解析</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>C语言结构体占用内存原理解析</h4> 
 <ul><li><a href="#_1" rel="nofollow">结构体内存原理解析：</a></li><li><a href="#_76" rel="nofollow">共用体内存原理解析：</a></li><li><a href="#sizeof_78" rel="nofollow">sizeof计算结构体内存占用需要注意</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>结构体内存原理解析：</h2> 
<p>结构体在内存中的存储有以下规则：</p> 
<ol><li>结构体成员中的起始地址应该是该成员所占内存的整数倍，如果不足整数倍需要补齐</li><li>结构体所占内存为结构体成员中最大的基础数据类型的整数倍。<br> 这里说下基础类型：int,short,char,long,long long,double,float<br> 规则1解析：</li></ol> 
<pre><code>typedef struct{
   char a;
   int b;
}Msg;
</code></pre> 
<p>结构体Msg在内存中的存储方式如下图所示：<br> <img src="https://images2.imgbox.com/c3/be/R6vnNZGJ_o.png" alt="在这里插入图片描述"><br> a占用了第0个字节，b并没有占用第一个字节，因为b的起始位置要是b的整数倍，所以b空了3个字节占用了4,5,6,7字节。所以这个结构体sizeof的结果就是8；<br> 规则2解析：</p> 
<pre><code>typedef struct {
    int a;
    char c[6];

}Data;
typedef struct{
    double head;
    Data data;
}Msg;
</code></pre> 
<p>结构体Msg的存储方式如下：<br> <img src="https://images2.imgbox.com/01/ea/60VQBusc_o.png" alt="在这里插入图片描述"><br> head占用了0-7共8个字节，结构体Data中的成员a占用了8-11共4个字节字符串c占用了12-17共6个字节，此时该结构体共占内存18个字节，但是规则2中规定了结构所占内存为成员中最大基本类型的整数倍，最小基准类型为double,所以为8的整数倍2乘以8&lt;18&lt;3乘以8;故此结构体Msg占内存3*8=24个字节。如果子结构体中的成员类型为最大基本类型，那么结构体所占内存就是子结构体中最大基本类型的整数倍。下面举例：</p> 
<pre><code>typedef struct {
    double a;
    char c[3];

}Data;
typedef struct{
     int head;
    Data data;
}Msg;
</code></pre> 
<p>结构体Msg的存储方式如下：<br> <img src="https://images2.imgbox.com/2e/0d/QERQTfVZ_o.png" alt="在这里插入图片描述"></p> 
<p>head占用4个字节，子结构体成员a占用8个字节此时注意规则1，所以空4个字节从8-15存储a，字符串的基本类型是char所以不用空，共占用19个字节下面考虑对其补齐：</p> 
<ol><li>如果按照结构体成员最大类型int为最大基本类型算出来所占内存就是20字节；</li><li>如果按照最大类型为子结构体（子结构体所占内存为16字节）为最大类型算出来所占内存就是就是32字节；</li><li>如果按照子结构体和子结构体成员基本类型为最大类型（double为最大基本类型）那么算出所占内存就为24字节。<br> 上面总结了三种对其方式，C语言中的补齐方式为第3种，前2种也是读者在计算结构体占用内存可能出现错误的地方。所以规则2中强调的是基本类型，不包括结构体，共用体这种。</li></ol> 
<p>通过上面的存储方式分析，希望读者在定义结构体时成员顺序要有考量，否则会导致无效的内存占用：</p> 
<pre><code>typedef struct{
    char b;
    int head;
    char a;
}Msg;
</code></pre> 
<p>上面这么定义结构体占用内存空间为12字节；<br> 下面两种定义方式结构体占用内存空间为8字节；</p> 
<pre><code>typedef struct{
    int head;
    char b;
    char a;
}Msg;
</code></pre> 
<pre><code>typedef struct{
    char b;
    char a;
    int head;
}Msg;
</code></pre> 
<h2><a id="_76"></a>共用体内存原理解析：</h2> 
<p>共用体多个数据成员只能同时存在一种，并不是将空间分配给每个成员，而是只按照最大成员的大小分配内存空间。如果共用体中出现结构体，那么就先算出结构体所占空间，和其他成员比较所占内存大小，按照最大的成员分配内存空间，同时需满足最大基本类型整数倍原则。</p> 
<h2><a id="sizeof_78"></a>sizeof计算结构体内存占用需要注意</h2> 
<p>计算结构体共用体所占内存大小大家一般都会使用sizeof关键字，但是大家需要注意sizeof计算的是在栈中占用的内存大小因此如果你声明的结构体中存在static成员那么sizeof计算出来的是不含static成员的大小，因为static变量存储在静态存储区。</p> 
<p>以上内容均是作者查阅资料加自己理解，如有疑问，望读者不吝赐教，谢谢！</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/85e6160f92527c504f49154f3c82b10d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">arthas热更新代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02a6dea55232cafaad001488c8fd37c6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何在Linux下使用git</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>