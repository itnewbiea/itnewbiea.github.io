<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>安装Oracle时，shmall、shmmax、kernel.sem的设置 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="安装Oracle时，shmall、shmmax、kernel.sem的设置" />
<meta property="og:description" content="最近因为拿到一个好配置的生产机器。在装完数据库后，需要对参数进行调优。 首先这个机器内存是128G的 ，而且/dev/shm 设置的是63G （物理内存的一半）。Oracle设置用的是AMM管理，那么就想是否能把这个内存设置大点。
首先这个参数文件在 vi /etc/sysctl.conf 里，重新加载生效是 sysctl -p
# System default settings live in /usr/lib/sysctl.d/00-system.conf. # To override those settings, enter new settings here, or in an /etc/sysctl.d/&lt;name&gt;.conf file # # For more information, see sysctl.conf(5) and sysctl.d(5). #ORACLE SETTING fs.aio-max-nr = 1048576 fs.file-max = 6815744 kernel.shmall = 15728640 kernel.shmmax = 64424509440 kernel.shmmni = 4096 kernel.sem = 5010 641280 5010 128 net.ipv4.ip_local_port_range = 9000 65500 net.core.rmem_default = 262144 net." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c96a93d725d1764e3564c9afd4fef20c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-08-24T16:51:36+08:00" />
<meta property="article:modified_time" content="2017-08-24T16:51:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">安装Oracle时，shmall、shmmax、kernel.sem的设置</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> 最近因为拿到一个好配置的生产机器。在装完<a target="_blank" href="http://lib.csdn.net/base/mysql" rel="nofollow noopener noreferrer" class="replace_word" title="MySQL知识库" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold">数据库</a>后，需要对参数进行调优。 <br style=""> 首先这个机器内存是128G的 ，而且/dev/shm 设置的是63G （物理内存的一半）。<a target="_blank" href="http://lib.csdn.net/base/oracle" rel="nofollow noopener noreferrer" class="replace_word" title="Oracle知识库" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold">Oracle</a>设置用的是AMM管理，那么就想是否能把这个内存设置大点。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> 首先这个参数文件在 vi /etc/sysctl.conf 里，重新加载生效是 sysctl -p</p> 
<pre class="prettyprint" name="code" style="white-space: nowrap; word-wrap: break-word; box-sizing: border-box; position: relative; overflow-y: hidden; overflow-x: auto; margin-top: 0px; margin-bottom: 1.1em; font-family: 'Source Code Pro', monospace; padding: 5px 5px 5px 60px; font-size: 14px; line-height: 1.45; word-break: break-all; color: rgb(51, 51, 51); border: 0px solid rgb(136, 136, 136); border-radius: 0px; background-color: rgba(128, 128, 128, 0.0470588);"><code class="hljs avrasm has-numbering" style="display: block; padding: 0px; color: inherit; box-sizing: border-box; font-family: 'Source Code Pro', monospace;font-size:undefined; white-space: pre; border-radius: 0px; word-wrap: normal; background: transparent;"><span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;"># System default settings live in /usr/lib/sysctl.d/00-system.conf.</span>
<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;"># To override those settings, enter new settings here, or in an /etc/sysctl.d/&lt;name&gt;.conf file</span>
<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">#</span>
<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;"># For more information, see sysctl.conf(5) and sysctl.d(5).</span>

<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">#ORACLE SETTING</span>
fs<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.aio</span>-max-nr = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">1048576</span>
fs<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.file</span>-max = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">6815744</span>
kernel<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.shmall</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">15728640</span>
kernel<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.shmmax</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">64424509440</span>
kernel<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.shmmni</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">4096</span>
kernel<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.sem</span> = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">5010</span> <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">641280</span> <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">5010</span> <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">128</span>
net<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.ipv</span>4<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.ip</span>_local_port_range = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">9000</span> <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">65500</span>
net<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.core</span><span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.rmem</span>_default = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">262144</span>
net<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.core</span><span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.rmem</span>_max = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">4194304</span>
net<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.core</span><span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.wmem</span>_default = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">262144</span>
net<span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.core</span><span class="hljs-preprocessor" style="color: rgb(68, 68, 68); box-sizing: border-box;">.wmem</span>_max = <span class="hljs-number" style="color: rgb(0, 102, 102); box-sizing: border-box;">1048586</span></code>
 
 </pre><ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); list-style: none; text-align: right; opacity: 0; background-color: rgb(238, 238, 238);"><li style="box-sizing: border-box; padding: 0px 5px;">1</li><li style="box-sizing: border-box; padding: 0px 5px;">2</li><li style="box-sizing: border-box; padding: 0px 5px;">3</li><li style="box-sizing: border-box; padding: 0px 5px;">4</li><li style="box-sizing: border-box; padding: 0px 5px;">5</li><li style="box-sizing: border-box; padding: 0px 5px;">6</li><li style="box-sizing: border-box; padding: 0px 5px;">7</li><li style="box-sizing: border-box; padding: 0px 5px;">8</li><li style="box-sizing: border-box; padding: 0px 5px;">9</li><li style="box-sizing: border-box; padding: 0px 5px;">10</li><li style="box-sizing: border-box; padding: 0px 5px;">11</li><li style="box-sizing: border-box; padding: 0px 5px;">12</li><li style="box-sizing: border-box; padding: 0px 5px;">13</li><li style="box-sizing: border-box; padding: 0px 5px;">14</li><li style="box-sizing: border-box; padding: 0px 5px;">15</li><li style="box-sizing: border-box; padding: 0px 5px;">16</li><li style="box-sizing: border-box; padding: 0px 5px;">17</li></ul>
 
 <ul class="pre-numbering" style="box-sizing: border-box; position: absolute; width: 50px; top: 0px; left: 0px; margin: 0px; padding: 6px 0px 40px; border-right-width: 1px; border-right-style: solid; border-right-color: rgb(221, 221, 221); list-style: none; text-align: right; background-color: rgb(238, 238, 238);"><li style="box-sizing: border-box; padding: 0px 5px;">1</li><li style="box-sizing: border-box; padding: 0px 5px;">2</li><li style="box-sizing: border-box; padding: 0px 5px;">3</li><li style="box-sizing: border-box; padding: 0px 5px;">4</li><li style="box-sizing: border-box; padding: 0px 5px;">5</li><li style="box-sizing: border-box; padding: 0px 5px;">6</li><li style="box-sizing: border-box; padding: 0px 5px;">7</li><li style="box-sizing: border-box; padding: 0px 5px;">8</li><li style="box-sizing: border-box; padding: 0px 5px;">9</li><li style="box-sizing: border-box; padding: 0px 5px;">10</li><li style="box-sizing: border-box; padding: 0px 5px;">11</li><li style="box-sizing: border-box; padding: 0px 5px;">12</li><li style="box-sizing: border-box; padding: 0px 5px;">13</li><li style="box-sizing: border-box; padding: 0px 5px;">14</li><li style="box-sizing: border-box; padding: 0px 5px;">15</li><li style="box-sizing: border-box; padding: 0px 5px;">16</li><li style="box-sizing: border-box; padding: 0px 5px;">17</li></ul> 
<p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> <span style="">kernel.shmall:</span> 共享内存页数的最大值 <br style=""> <a target="_blank" href="http://lib.csdn.net/base/linux" rel="nofollow noopener noreferrer" class="replace_word" title="Linux知识库" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold">Linux</a>共享内存页大小为4KB， 共享内存段的大小都是共享内存页大小的整数倍。一个共享内存段的最大大小是16G，需要共享内存页数是 <br style=""> 16GB/4KB=16777216KB/4KB=4194304(页)</p> 
<p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> <span style="">kernel.shmmax:</span>单个共享内存段的最大值 <br style=""> shmmax是核心参数中最重要的参数之一，用于定义单个共享内存段的最大值，shmmax设置应足够大，能在一个共享内存段下容纳下整个的SGA，设置的过低可能会导致需要创建多个共享内存段，可能导致系统性能的下降 。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> <span style="">kernel.shmmni:</span>共享内存段的最大数量 <br style=""> 注意该参数不是shmmin，是shmmni，shmmin 表示内存段最小大小 ） <br style=""> shmmni缺省值4096 足够。 <br style=""> shmmax(bytes) = shmmni(page size, default 4k) * shmall (page的个数）</p> 
<p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> 下面专门说说<span style="">kernel.sem</span>：对应4个值 <br style=""> SEMMSL、SEMMNS、SEMOPM、SEMMNI</p> 
<p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> <span style="">SEMMSL:</span> 每个信号集的最大信号数量 <br style=""> 数据库最大 PROCESS 实例参数的设置值再加上 10 。 <br style=""> <a target="_blank" href="http://lib.csdn.net/base/oracle" rel="nofollow noopener noreferrer" class="replace_word" title="Oracle知识库" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold">oracle</a> 建议将 SEMMSL 的值设置为不少于 100 。 <br style=""> <span style="">SEMMNS：</span>用于控制整个 <a target="_blank" href="http://lib.csdn.net/base/linux" rel="nofollow noopener noreferrer" class="replace_word" title="Linux知识库" style="color:rgb(223,52,52); text-decoration:none; font-weight:bold">linux</a> 系统中信号（而不是信号集）的最大数。 <br style=""> Oracle 建议将 SEMMNS 设置为：系统中每个数据库的 PROCESSES 实例参数设置值的总和，加上最大 PROCESSES 值的两倍，最后根据系统中 Oracle 数据库的数量，每个加 10 。 <br style=""> 使用以下计算式来确定在 Linux 系统中可以分配的信号的最大数量。它将是以下两者中较小的一个值：SEMMNS 或 (SEMMSL * SEMMNI)</p> 
<p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> <span style="">SEMOPM：</span> 内核参数用于控制每个 semop 系统调用可以执行的信号操作的数量。semop 系统调用（函数）提供了利用一个 semop 系统调用完成多项信号操作的功能。一个信号集能够拥有每个信号集中最大数量的SEMMSL 信号，因此建议设置 SEMOPM 等于SEMMSL 。 <br style=""> Oracle 建议将 SEMOPM 的值设置为不少于 100 。 <br style=""> <span style="">SEMMNI ：</span>内核参数用于控制整个 Linux 系统中信号集的最大数量。 <br style=""> Oracle 建议将 SEMMNI 的值设置为不少于 100 。</p> 
<p style="margin-top:0px; margin-bottom:1.1em; color:rgb(63,63,63); font-family:'microsoft yahei'; font-size:15px; line-height:26px"> 设计完这些之后可以 sysctl -p 生效.</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c630b7da819ec860cbe80fa5b163f958/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">for(let i = 0; i &lt; 10; i&#43;&#43;)和for(var i = 0; i &lt; 10; i&#43;&#43;)的思考</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/60145e6550ab0de08caf8084ec1882b6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">将博客搬至简书</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>