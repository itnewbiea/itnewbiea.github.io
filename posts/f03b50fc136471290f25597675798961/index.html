<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用ARIMA模型对时间序列进行分析的经典案例（详细代码） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用ARIMA模型对时间序列进行分析的经典案例（详细代码）" />
<meta property="og:description" content="因为之前在学数据分析课程的时候老师讲到时间序列这里，但只是简单的对这个经典的时间序列案例介绍了一下，并没有涉及对差分次数d的查找、找ARIMA模型的p、q值和模型检验 这三个步骤。
后来我搜寻了整个网络，终于结合各个文章的解释，对代码进行了重新的梳理，下面就是详细的整个代码过程（如果问题，欢迎提出来指正！）：
--------------------------------------------------我是修正线---------------------------------------------------
2021.11.24 第三次更新
大家对本文的疑问在👉最新一期时序的博客 👈中有提到相关解决方法，欢迎大家前去围观🤝。
--------------------------------------------------我是修正线---------------------------------------------------
--------------------------------------------------我是修正线---------------------------------------------------
2021.06.01再次更新
鉴于最近各位朋友提出的疑问（也感谢大家的提问 掌柜也学到很多😁），这里特再次更新🆑！！！
如果你遇到的时序是季节/周期性的时序，那么请移步👉最新博客！进行参考
如果你遇到的时序是季节/周期性的时序，那么请移步👉最新博客！进行参考
如果你遇到的时序是季节/周期性的时序，那么请移步👉最新博客！进行参考
重要事情说三遍😂，谢谢！
PS：本博客搭配👉这篇👈一起服用效果更佳！！！
--------------------------------------------------我是修正线---------------------------------------------------
--------------------------------------------------我是修正线---------------------------------------------------
10.20 更新
感谢网友提出的问题，进行了一个修正，当时的代码少了最后用ARIMA对原始序列的一个预测步骤。这里补充一下：
from statsmodels.tsa.arima_model import ARIMA #感谢网友的指正，这里直接用data即可，之前想太多了😅 #还原到原始序列（不用这个！！！❌） #ts_restored = pd.Series([data[0]], index=[data.index[0]]) .append(data1).cumsum() #第六步：使用ARIMA模型进行预测 model = ARIMA(data,order=(7,0,0)) #导入ARIMA模型 result = model.fit(disp=-1) #print(result.summary()) result.conf_int()#模型诊断，可以发现所有的系数置信区间都不为0；即在5%的置信水平下，所有的系数都是显著的，即模型通过检验。 #最后画出时序图 fig, ax = plt.subplots(figsize=(12, 10)) ax = data.loc[&#39;1901&#39;:].plot(ax=ax) #注意起点是从1901开始 fig = result.plot_predict(5, 100) #因为前面是90个数，所以加上预测的10个就是100 plt.show() #数据预测并画图 #预测原始序列的未来10年数据 pred = result.predict(start = 90, end = 99, dynamic = True) pred --------------------------------------------------我是修正线---------------------------------------------------" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f03b50fc136471290f25597675798961/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-23T21:33:39+08:00" />
<meta property="article:modified_time" content="2019-10-23T21:33:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用ARIMA模型对时间序列进行分析的经典案例（详细代码）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>因为之前在学数据分析课程的时候老师讲到时间序列这里，但只是简单的对这个经典的时间序列案例介绍了一下，并没有涉及<strong>对差分次数d的查找、找ARIMA模型的p、q值和模型检验 这三个步骤</strong>。<br> 后来我搜寻了整个网络，终于结合各个文章的解释，对代码进行了重新的梳理，下面就是详细的整个代码过程（如果问题，欢迎提出来指正！）：</p> 
<p>--------------------------------------------------我是修正线---------------------------------------------------<br> 2021.11.24 第三次更新<br> 大家对本文的疑问在👉<a href="https://blog.csdn.net/weixin_41013322/article/details/119983639">最新一期时序的博客</a> 👈中有提到相关解决方法，欢迎大家前去围观🤝。<br> --------------------------------------------------我是修正线---------------------------------------------------<br> --------------------------------------------------我是修正线---------------------------------------------------<br> 2021.06.01再次更新</p> 
<p>鉴于最近各位朋友提出的疑问（也感谢大家的提问 掌柜也学到很多😁），这里特再次更新🆑！！！</p> 
<p>如果你遇到的时序是<strong>季节/周期性的时序</strong>，那么请移步👉<a href="https://blog.csdn.net/weixin_41013322/article/details/116063395">最新博客</a>！进行参考<br> 如果你遇到的时序是<strong>季节/周期性的时序</strong>，那么请移步👉<a href="https://blog.csdn.net/weixin_41013322/article/details/116063395">最新博客</a>！进行参考<br> 如果你遇到的时序是<strong>季节/周期性的时序</strong>，那么请移步👉<a href="https://blog.csdn.net/weixin_41013322/article/details/116063395">最新博客</a>！进行参考</p> 
<p>重要事情说三遍😂，谢谢！</p> 
<p><strong>PS：本博客搭配👉<a href="https://blog.csdn.net/weixin_41013322/article/details/111221251">这篇</a>👈一起服用效果更佳！！！</strong><br> --------------------------------------------------我是修正线---------------------------------------------------<br> --------------------------------------------------我是修正线---------------------------------------------------<br> 10.20 更新<br> 感谢网友提出的问题，进行了一个修正，当时的代码少了最后用ARIMA对原始序列的一个预测步骤。这里补充一下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>arima_model <span class="token keyword">import</span> ARIMA

<span class="token comment">#感谢网友的指正，这里直接用data即可，之前想太多了😅</span>

<span class="token comment">#还原到原始序列（不用这个！！！❌）</span>
<span class="token comment">#ts_restored = pd.Series([data[0]], index=[data.index[0]]) .append(data1).cumsum()</span>

<span class="token comment">#第六步：使用ARIMA模型进行预测</span>
model <span class="token operator">=</span> ARIMA<span class="token punctuation">(</span>data<span class="token punctuation">,</span>order<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#导入ARIMA模型</span>
result <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>disp<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#print(result.summary())</span>
result<span class="token punctuation">.</span>conf_int<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#模型诊断，可以发现所有的系数置信区间都不为0；即在5%的置信水平下，所有的系数都是显著的，即模型通过检验。</span>

<span class="token comment">#最后画出时序图</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'1901'</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">)</span>   <span class="token comment">#注意起点是从1901开始</span>
fig <span class="token operator">=</span> result<span class="token punctuation">.</span>plot_predict<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment">#因为前面是90个数，所以加上预测的10个就是100</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#数据预测并画图</span>

<span class="token comment">#预测原始序列的未来10年数据</span>
pred <span class="token operator">=</span> result<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>start <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">,</span> dynamic <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
pred
</code></pre> 
<p>--------------------------------------------------我是修正线---------------------------------------------------<br> （完整的代码如下：）</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token comment"># 用 ARIMA 进行时间序列预测</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> statsmodels<span class="token punctuation">.</span>api <span class="token keyword">as</span> sm
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>arima_model <span class="token keyword">import</span> ARMA
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>arima_model <span class="token keyword">import</span> ARIMA
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>tsaplots <span class="token keyword">import</span> acf<span class="token punctuation">,</span>pacf<span class="token punctuation">,</span>plot_acf<span class="token punctuation">,</span>plot_pacf
<span class="token keyword">from</span> statsmodels<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>api <span class="token keyword">import</span> qqplot

<span class="token comment"># 1.创建数据</span>
data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">5922</span><span class="token punctuation">,</span> <span class="token number">5308</span><span class="token punctuation">,</span> <span class="token number">5546</span><span class="token punctuation">,</span> <span class="token number">5975</span><span class="token punctuation">,</span> <span class="token number">2704</span><span class="token punctuation">,</span> <span class="token number">1767</span><span class="token punctuation">,</span> <span class="token number">4111</span><span class="token punctuation">,</span> <span class="token number">5542</span><span class="token punctuation">,</span> <span class="token number">4726</span><span class="token punctuation">,</span> <span class="token number">5866</span><span class="token punctuation">,</span> <span class="token number">6183</span><span class="token punctuation">,</span> <span class="token number">3199</span><span class="token punctuation">,</span> <span class="token number">1471</span><span class="token punctuation">,</span> <span class="token number">1325</span><span class="token punctuation">,</span> <span class="token number">6618</span><span class="token punctuation">,</span> <span class="token number">6644</span><span class="token punctuation">,</span> <span class="token number">5337</span><span class="token punctuation">,</span> <span class="token number">7064</span><span class="token punctuation">,</span> <span class="token number">2912</span><span class="token punctuation">,</span> <span class="token number">1456</span><span class="token punctuation">,</span> <span class="token number">4705</span><span class="token punctuation">,</span> <span class="token number">4579</span><span class="token punctuation">,</span> <span class="token number">4990</span><span class="token punctuation">,</span> <span class="token number">4331</span><span class="token punctuation">,</span> <span class="token number">4481</span><span class="token punctuation">,</span> <span class="token number">1813</span><span class="token punctuation">,</span> <span class="token number">1258</span><span class="token punctuation">,</span> <span class="token number">4383</span><span class="token punctuation">,</span> <span class="token number">5451</span><span class="token punctuation">,</span> <span class="token number">5169</span><span class="token punctuation">,</span> <span class="token number">5362</span><span class="token punctuation">,</span> <span class="token number">6259</span><span class="token punctuation">,</span> <span class="token number">3743</span><span class="token punctuation">,</span> <span class="token number">2268</span><span class="token punctuation">,</span> <span class="token number">5397</span><span class="token punctuation">,</span> <span class="token number">5821</span><span class="token punctuation">,</span> <span class="token number">6115</span><span class="token punctuation">,</span> <span class="token number">6631</span><span class="token punctuation">,</span> <span class="token number">6474</span><span class="token punctuation">,</span> <span class="token number">4134</span><span class="token punctuation">,</span> <span class="token number">2728</span><span class="token punctuation">,</span> <span class="token number">5753</span><span class="token punctuation">,</span> <span class="token number">7130</span><span class="token punctuation">,</span> <span class="token number">7860</span><span class="token punctuation">,</span> <span class="token number">6991</span><span class="token punctuation">,</span> <span class="token number">7499</span><span class="token punctuation">,</span> <span class="token number">5301</span><span class="token punctuation">,</span> <span class="token number">2808</span><span class="token punctuation">,</span> <span class="token number">6755</span><span class="token punctuation">,</span> <span class="token number">6658</span><span class="token punctuation">,</span> <span class="token number">7644</span><span class="token punctuation">,</span> <span class="token number">6472</span><span class="token punctuation">,</span> <span class="token number">8680</span><span class="token punctuation">,</span> <span class="token number">6366</span><span class="token punctuation">,</span> <span class="token number">5252</span><span class="token punctuation">,</span> <span class="token number">8223</span><span class="token punctuation">,</span> <span class="token number">8181</span><span class="token punctuation">,</span> <span class="token number">10548</span><span class="token punctuation">,</span> <span class="token number">11823</span><span class="token punctuation">,</span> <span class="token number">14640</span><span class="token punctuation">,</span> <span class="token number">9873</span><span class="token punctuation">,</span> <span class="token number">6613</span><span class="token punctuation">,</span> <span class="token number">14415</span><span class="token punctuation">,</span> <span class="token number">13204</span><span class="token punctuation">,</span> <span class="token number">14982</span><span class="token punctuation">,</span> <span class="token number">9690</span><span class="token punctuation">,</span> <span class="token number">10693</span><span class="token punctuation">,</span> <span class="token number">8276</span><span class="token punctuation">,</span> <span class="token number">4519</span><span class="token punctuation">,</span> <span class="token number">7865</span><span class="token punctuation">,</span> <span class="token number">8137</span><span class="token punctuation">,</span> <span class="token number">10022</span><span class="token punctuation">,</span> <span class="token number">7646</span><span class="token punctuation">,</span> <span class="token number">8749</span><span class="token punctuation">,</span> <span class="token number">5246</span><span class="token punctuation">,</span> <span class="token number">4736</span><span class="token punctuation">,</span> <span class="token number">9705</span><span class="token punctuation">,</span> <span class="token number">7501</span><span class="token punctuation">,</span> <span class="token number">9587</span><span class="token punctuation">,</span> <span class="token number">10078</span><span class="token punctuation">,</span> <span class="token number">9732</span><span class="token punctuation">,</span> <span class="token number">6986</span><span class="token punctuation">,</span> <span class="token number">4385</span><span class="token punctuation">,</span> <span class="token number">8451</span><span class="token punctuation">,</span> <span class="token number">9815</span><span class="token punctuation">,</span> <span class="token number">10894</span><span class="token punctuation">,</span> <span class="token number">10287</span><span class="token punctuation">,</span> <span class="token number">9666</span><span class="token punctuation">,</span> <span class="token number">6072</span><span class="token punctuation">,</span> <span class="token number">5418</span><span class="token punctuation">]</span>

data <span class="token operator">=</span> pd<span class="token punctuation">.</span>Series<span class="token punctuation">(</span>data<span class="token punctuation">)</span>
data<span class="token punctuation">.</span>index <span class="token operator">=</span> pd<span class="token punctuation">.</span>Index<span class="token punctuation">(</span>sm<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>datetools<span class="token punctuation">.</span>dates_from_range<span class="token punctuation">(</span><span class="token string">'1901'</span><span class="token punctuation">,</span><span class="token string">'1990'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#绘制时序的数据图</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">#2.下面我们先对非平稳时间序列进行时间序列的差分，找出适合的差分次数d的值：</span>
<span class="token comment">#fig = plt.figure(figsize=(12, 8))</span>
<span class="token comment">#ax1 = fig.add_subplot(111)</span>
<span class="token comment">#diff1 = data.diff(1)</span>
<span class="token comment">#diff1.plot(ax=ax1)</span>
<span class="token comment">#这里是做了1阶差分，可以看出时间序列的均值和方差基本平稳，不过还是可以比较一下二阶差分的效果：</span>

<span class="token comment">#这里进行二阶差分</span>
<span class="token comment">#fig = plt.figure(figsize=(12, 8))</span>
<span class="token comment">#ax2 = fig.add_subplot(111)</span>
<span class="token comment">#diff2 = data.diff(2)</span>
<span class="token comment">#diff2.plot(ax=ax2)</span>
<span class="token comment">#由下图可以看出来一阶跟二阶的差分差别不是很大，所以可以把差分次数d设置为1，上面的一阶和二阶程序我们注释掉</span>

<span class="token comment">#这里我们使用一阶差分的时间序列</span>
<span class="token comment">#3.接下来我们要找到ARIMA模型中合适的p和q值：</span>
data1 <span class="token operator">=</span> data<span class="token punctuation">.</span>diff<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
data1<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment">#加上这一步，不然后面画出的acf和pacf图会是一条直线</span>

<span class="token comment">#第一步：先检查平稳序列的自相关图和偏自相关图</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax1 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
fig <span class="token operator">=</span> sm<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>plot_acf<span class="token punctuation">(</span>data1<span class="token punctuation">,</span>lags<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">)</span>
<span class="token comment">#lags 表示滞后的阶数</span>
<span class="token comment">#第二步：下面分别得到acf 图和pacf 图</span>
ax2 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">212</span><span class="token punctuation">)</span>
fig <span class="token operator">=</span> sm<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>plot_pacf<span class="token punctuation">(</span>data1<span class="token punctuation">,</span> lags<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>ax2<span class="token punctuation">)</span>

<span class="token comment">#由上图可知，我们可以分别用ARMA(7,0)模型、ARMA(7,1)模型、ARMA(8,0)模型等来拟合找出最佳模型：</span>
<span class="token comment">#第三步:找出最佳模型ARMA</span>
arma_mod1 <span class="token operator">=</span> sm<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>ARMA<span class="token punctuation">(</span>data1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arma_mod1<span class="token punctuation">.</span>aic<span class="token punctuation">,</span> arma_mod1<span class="token punctuation">.</span>bic<span class="token punctuation">,</span> arma_mod1<span class="token punctuation">.</span>hqic<span class="token punctuation">)</span>
arma_mod2 <span class="token operator">=</span> sm<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>ARMA<span class="token punctuation">(</span>data1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arma_mod2<span class="token punctuation">.</span>aic<span class="token punctuation">,</span> arma_mod2<span class="token punctuation">.</span>bic<span class="token punctuation">,</span> arma_mod2<span class="token punctuation">.</span>hqic<span class="token punctuation">)</span>
arma_mod3 <span class="token operator">=</span> sm<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>ARMA<span class="token punctuation">(</span>data1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fit<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arma_mod3<span class="token punctuation">.</span>aic<span class="token punctuation">,</span> arma_mod3<span class="token punctuation">.</span>bic<span class="token punctuation">,</span> arma_mod3<span class="token punctuation">.</span>hqic<span class="token punctuation">)</span>

<span class="token comment">#由上面可以看出ARMA(7,0)模型最佳</span>
<span class="token comment">#第四步：进行模型检验</span>
<span class="token comment">#首先对ARMA(7,0)模型所产生的残差做自相关图</span>
resid <span class="token operator">=</span> arma_mod1<span class="token punctuation">.</span>resid
<span class="token comment">#一定要加上这个变量赋值语句，不然会报错resid is not defined </span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax1 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">211</span><span class="token punctuation">)</span>
fig <span class="token operator">=</span> sm<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>plot_acf<span class="token punctuation">(</span>resid<span class="token punctuation">.</span>values<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lags<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>ax1<span class="token punctuation">)</span>
ax2 <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">212</span><span class="token punctuation">)</span>
fig <span class="token operator">=</span> sm<span class="token punctuation">.</span>graphics<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>plot_pacf<span class="token punctuation">(</span>resid<span class="token punctuation">,</span> lags<span class="token operator">=</span><span class="token number">40</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>ax2<span class="token punctuation">)</span>

<span class="token comment">#接着做德宾-沃森（D-W）检验</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sm<span class="token punctuation">.</span>stats<span class="token punctuation">.</span>durbin_watson<span class="token punctuation">(</span>arma_mod1<span class="token punctuation">.</span>resid<span class="token punctuation">.</span>values<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">#得出来结果是不存在自相关性的</span>

<span class="token comment">#再观察是否符合正态分布,这里用qq图</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>
fig <span class="token operator">=</span> qqplot<span class="token punctuation">(</span>resid<span class="token punctuation">,</span> line<span class="token operator">=</span><span class="token string">'q'</span><span class="token punctuation">,</span>ax<span class="token operator">=</span>ax<span class="token punctuation">,</span> fit<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment">#最后用Ljung-Box检验:检验的结果就是看最后一列前十二行的检验概率（一般观察滞后1~12阶），</span>
<span class="token comment">#如果检验概率小于给定的显著性水平，比如0.05、0.10等就拒绝原假设，其原假设是相关系数为零。</span>
<span class="token comment">#就结果来看，前12阶的P值都是大于0.05，所以在0.05的显著性水平下，不拒绝原假设，即残差为白噪声序列。</span>
r<span class="token punctuation">,</span>q<span class="token punctuation">,</span>p <span class="token operator">=</span> sm<span class="token punctuation">.</span>tsa<span class="token punctuation">.</span>acf<span class="token punctuation">(</span>resid<span class="token punctuation">.</span>values<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>qstat<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
data2 <span class="token operator">=</span> np<span class="token punctuation">.</span>c_<span class="token punctuation">[</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">,</span> r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> q<span class="token punctuation">,</span> p<span class="token punctuation">]</span>
table<span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>data2<span class="token punctuation">,</span> columns<span class="token operator">=</span><span class="token punctuation">[</span> <span class="token string">'lag'</span><span class="token punctuation">,</span><span class="token string">'AC'</span><span class="token punctuation">,</span><span class="token string">'Q'</span><span class="token punctuation">,</span><span class="token string">'Prob(&gt;Q)'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'lag'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#第五步：平稳模型预测,对未来十年进行预测</span>
predict_y <span class="token operator">=</span>arma_mod1<span class="token punctuation">.</span>predict<span class="token punctuation">(</span><span class="token string">'1990'</span><span class="token punctuation">,</span> <span class="token string">'2000'</span><span class="token punctuation">,</span> dynamic<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>predict_y<span class="token punctuation">)</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> data1<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'1901'</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">)</span>
predict_y<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">)</span>

<span class="token comment">#第六步：使用ARIMA模型对原始序列进行预测</span>
model <span class="token operator">=</span> ARIMA<span class="token punctuation">(</span>data<span class="token punctuation">,</span>order<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">#导入ARIMA模型</span>
result <span class="token operator">=</span> model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>disp<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token comment">#print(result.summary())</span>
result<span class="token punctuation">.</span>conf_int<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">#模型诊断，可以发现所有的系数置信区间都不为0；即在5%的置信水平下，所有的系数都是显著的，即模型通过检验。</span>

<span class="token comment">#画出时序图</span>
fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> data<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token string">'1901'</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">.</span>plot<span class="token punctuation">(</span>ax<span class="token operator">=</span>ax<span class="token punctuation">)</span>   <span class="token comment">#注意起点是从1901开始</span>
fig <span class="token operator">=</span> result<span class="token punctuation">.</span>plot_predict<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment">#因为前面是90个数，所以加上预测的10个就是100</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">#数据预测并画图</span>

<span class="token comment">#预测原始序列的未来10年数据</span>
pred <span class="token operator">=</span> result<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>start <span class="token operator">=</span> <span class="token number">90</span><span class="token punctuation">,</span> end <span class="token operator">=</span> <span class="token number">99</span><span class="token punctuation">,</span> dynamic <span class="token operator">=</span> <span class="token boolean">True</span><span class="token punctuation">)</span>
pred
</code></pre> 
<p>最后奉上整个代码运行过程种生成的所有可视化图和结果：<br> <em>（一开始的时序图）</em><br> <img src="https://images2.imgbox.com/58/13/lp5L5jjD_o.png" alt="一开始的时序图"><br> 下面是生成的自相关图（acf图）和偏自相关图（pacf图）：<br> <img src="https://images2.imgbox.com/e8/ee/oAam8vm6_o.png" alt="在这里插入图片描述"></p> 
<p>这是找出最佳模型ARMA的数据运行结果：</p> 
<pre><code class="prism language-python"><span class="token number">1580.3025343802506</span> <span class="token number">1602.70026170784</span> <span class="token number">1589.3304155123078</span>
<span class="token number">1581.741953757229</span> <span class="token number">1606.6283174545506</span> <span class="token number">1591.7729327928485</span>
<span class="token number">1582.0274262666355</span> <span class="token number">1606.913789963957</span> <span class="token number">1592.0584053022549</span>
</code></pre> 
<p>进行模型检验，首先对ARMA(7,0)模型所产生的残差做自相关和偏自相关图：<br> <img src="https://images2.imgbox.com/57/dd/opSGLRF8_o.png" alt="第二次"><br> 这里是德宾-沃森（D-W）检验后的结果：</p> 
<pre><code class="prism language-python"><span class="token number">2.0226619351807082</span>
</code></pre> 
<p>接着用qq图来观察是否符合正态分布：<br> <img src="https://images2.imgbox.com/23/14/pc8ayI6w_o.png" alt="在这里插入图片描述"><br> 然后是用Ljung-Box检验的结果:</p> 
<pre><code class="prism language-python">            AC          Q  Prob<span class="token punctuation">(</span><span class="token operator">&gt;</span>Q<span class="token punctuation">)</span>
lag                                
<span class="token number">1.0</span>  <span class="token operator">-</span><span class="token number">0.013620</span>   <span class="token number">0.017072</span>  <span class="token number">0.896043</span>
<span class="token number">2.0</span>  <span class="token operator">-</span><span class="token number">0.048111</span>   <span class="token number">0.232545</span>  <span class="token number">0.890232</span>
<span class="token number">3.0</span>   <span class="token number">0.094049</span>   <span class="token number">1.065538</span>  <span class="token number">0.785399</span>
<span class="token number">4.0</span>   <span class="token number">0.047719</span>   <span class="token number">1.282507</span>  <span class="token number">0.864336</span>
<span class="token number">5.0</span>   <span class="token number">0.157830</span>   <span class="token number">3.684276</span>  <span class="token number">0.595706</span>
<span class="token number">6.0</span>  <span class="token operator">-</span><span class="token number">0.015497</span>   <span class="token number">3.707712</span>  <span class="token number">0.716160</span>
<span class="token number">7.0</span>  <span class="token operator">-</span><span class="token number">0.241722</span>   <span class="token number">9.478707</span>  <span class="token number">0.220088</span>
<span class="token number">8.0</span>   <span class="token number">0.067333</span>   <span class="token number">9.932028</span>  <span class="token number">0.269829</span>
<span class="token number">9.0</span>  <span class="token operator">-</span><span class="token number">0.015059</span>   <span class="token number">9.954985</span>  <span class="token number">0.354142</span>
<span class="token number">10.0</span> <span class="token operator">-</span><span class="token number">0.250211</span>  <span class="token number">16.373227</span>  <span class="token number">0.089435</span>
<span class="token number">11.0</span> <span class="token operator">-</span><span class="token number">0.085557</span>  <span class="token number">17.133292</span>  <span class="token number">0.103994</span>
<span class="token number">12.0</span> <span class="token operator">-</span><span class="token number">0.066882</span>  <span class="token number">17.603796</span>  <span class="token number">0.128261</span>
<span class="token number">13.0</span> <span class="token operator">-</span><span class="token number">0.099118</span>  <span class="token number">18.650747</span>  <span class="token number">0.134337</span>
<span class="token number">14.0</span>  <span class="token number">0.183460</span>  <span class="token number">22.285305</span>  <span class="token number">0.072939</span>
<span class="token number">15.0</span> <span class="token operator">-</span><span class="token number">0.224821</span>  <span class="token number">27.817186</span>  <span class="token number">0.022742</span>
<span class="token number">16.0</span>  <span class="token number">0.013207</span>  <span class="token number">27.836539</span>  <span class="token number">0.033070</span>
<span class="token number">17.0</span>  <span class="token number">0.172933</span>  <span class="token number">31.200543</span>  <span class="token number">0.018879</span>
<span class="token number">18.0</span> <span class="token operator">-</span><span class="token number">0.054509</span>  <span class="token number">31.539470</span>  <span class="token number">0.024912</span>
<span class="token number">19.0</span> <span class="token operator">-</span><span class="token number">0.059218</span>  <span class="token number">31.945201</span>  <span class="token number">0.031702</span>
<span class="token number">20.0</span>  <span class="token number">0.038317</span>  <span class="token number">32.117537</span>  <span class="token number">0.042062</span>
<span class="token number">21.0</span>  <span class="token number">0.122530</span>  <span class="token number">33.905707</span>  <span class="token number">0.037090</span>
<span class="token number">22.0</span>  <span class="token number">0.105273</span>  <span class="token number">35.245351</span>  <span class="token number">0.036518</span>
<span class="token number">23.0</span> <span class="token operator">-</span><span class="token number">0.007281</span>  <span class="token number">35.251856</span>  <span class="token number">0.049095</span>
<span class="token number">24.0</span> <span class="token operator">-</span><span class="token number">0.147063</span>  <span class="token number">37.946657</span>  <span class="token number">0.035111</span>
<span class="token number">25.0</span>  <span class="token number">0.045061</span>  <span class="token number">38.203610</span>  <span class="token number">0.044187</span>
<span class="token number">26.0</span> <span class="token operator">-</span><span class="token number">0.029390</span>  <span class="token number">38.314649</span>  <span class="token number">0.056605</span>
<span class="token number">27.0</span>  <span class="token number">0.033956</span>  <span class="token number">38.465262</span>  <span class="token number">0.070798</span>
<span class="token number">28.0</span>  <span class="token number">0.125451</span>  <span class="token number">40.554803</span>  <span class="token number">0.058962</span>
<span class="token number">29.0</span> <span class="token operator">-</span><span class="token number">0.094511</span>  <span class="token number">41.760519</span>  <span class="token number">0.059003</span>
<span class="token number">30.0</span> <span class="token operator">-</span><span class="token number">0.035058</span>  <span class="token number">41.929231</span>  <span class="token number">0.072578</span>
<span class="token number">31.0</span>  <span class="token number">0.009097</span>  <span class="token number">41.940788</span>  <span class="token number">0.090824</span>
<span class="token number">32.0</span> <span class="token operator">-</span><span class="token number">0.016855</span>  <span class="token number">41.981152</span>  <span class="token number">0.111447</span>
<span class="token number">33.0</span> <span class="token operator">-</span><span class="token number">0.045631</span>  <span class="token number">42.282283</span>  <span class="token number">0.129112</span>
<span class="token number">34.0</span>  <span class="token number">0.000052</span>  <span class="token number">42.282284</span>  <span class="token number">0.155724</span>
<span class="token number">35.0</span> <span class="token operator">-</span><span class="token number">0.023147</span>  <span class="token number">42.362642</span>  <span class="token number">0.183158</span>
<span class="token number">36.0</span> <span class="token operator">-</span><span class="token number">0.004809</span>  <span class="token number">42.366176</span>  <span class="token number">0.215442</span>
<span class="token number">37.0</span> <span class="token operator">-</span><span class="token number">0.081576</span>  <span class="token number">43.402643</span>  <span class="token number">0.217174</span>
<span class="token number">38.0</span> <span class="token operator">-</span><span class="token number">0.086627</span>  <span class="token number">44.594344</span>  <span class="token number">0.214138</span>
<span class="token number">39.0</span>  <span class="token number">0.005819</span>  <span class="token number">44.599828</span>  <span class="token number">0.248019</span>
<span class="token number">40.0</span> <span class="token operator">-</span><span class="token number">0.066766</span>  <span class="token number">45.336624</span>  <span class="token number">0.259191</span>
<span class="token number">1990</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>   <span class="token operator">-</span><span class="token number">1224.754904</span>
<span class="token number">1991</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token number">3524.663640</span>
<span class="token number">1992</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token number">1267.491272</span>
<span class="token number">1993</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>     <span class="token number">661.201862</span>
<span class="token number">1994</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token operator">-</span><span class="token number">569.545994</span>
<span class="token number">1995</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token operator">-</span><span class="token number">636.202961</span>
<span class="token number">1996</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>   <span class="token operator">-</span><span class="token number">2249.722008</span>
<span class="token number">1997</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token operator">-</span><span class="token number">710.790841</span>
<span class="token number">1998</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>    <span class="token number">2719.687594</span>
<span class="token number">1999</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>     <span class="token number">970.876673</span>
<span class="token number">2000</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">31</span>     <span class="token number">279.806969</span>
Freq<span class="token punctuation">:</span> A<span class="token operator">-</span>DEC<span class="token punctuation">,</span> dtype<span class="token punctuation">:</span> float64
</code></pre> 
<p>生成的平稳序列的预测时序图：<br> <img src="https://images2.imgbox.com/6a/1e/OwWdyrKi_o.png" alt="在这里插入图片描述"><br> 最后原始数据的时序预测图：<br> <img src="https://images2.imgbox.com/1c/be/BSAVXLfb_o.png" alt="在这里插入图片描述"></p> 
<p>预测原始序列未来十年数据的结果：<br> <img src="https://images2.imgbox.com/fb/50/mYbicWQX_o.png" alt="在这里插入图片描述"></p> 
<p>可以看出预测数据跟原始序列趋势基本一致，但是准确度有待进一步优化！</p> 
<p>参考资料：<br> <a href="https://blog.csdn.net/u010414589/article/details/49622625">[python] 时间序列分析之ARIMA</a><br> <a href="https://blog.csdn.net/hal_sakai/article/details/51965657">Python_Statsmodels包_时间序列分析_ARIMA模型</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fed7ee917cb2b74055eb2822c1556bd0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">互斥锁</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e8c22126289a5d4faaba1261b1778718/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">网易电话面试经验——C  游戏服务器开发</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>