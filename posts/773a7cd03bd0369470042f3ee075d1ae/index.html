<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL修改最大连接数限制 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MySQL修改最大连接数限制" />
<meta property="og:description" content="随着现在大部分的工程结构都是微服务化，每个服务一般都有本服务独立的DB库，对MySQL的连接数要求也是越来越多。如果本地安装的测试数据，没有对MySQL默认连接数修改，测试时，多开几个微服务，可能就遇到数据库连接数过多的问题。对MySQl默认的最大连接数做修改就必不可少了。
一、前提条件 修改数据库是比较危险的动作，修改之前以开发测试的数据库为例，做好数据的备份。以防数据库误操作，丢失数据等等 。
修改MySQL的前提条件：
1、有Linux用户的管理员权限账号，需要对MySQL安装的配置问卷进行修改；
2、MySQL数据库的管理账号。
3、如果有运维，与运维和开发负责人员商量修改，数据是大事，以防数据丢失，做好数据的备份。
二、修改步骤 1、使用root用户登录和连接数据库 # mysql -uroot -p 输入命令后，提示输入root用户密码，输入密码后，成功登录数据库。
登录MySQL数据库
2、查看当前数据库的最大连接数 mysql&gt; show variables like &#39;max_connections&#39;; 如下图，MySQL的最大连接数才151，稍微多开几个微服务，基本都会报数据库连接数过多的异常。
查看数据库的最大连接数
3、修改MySQL配置文件 找到MySQL的配置文件并且修改：/etc/mysql/mysql.conf.d/mysqld.cnf
# view /etc/mysql/mysql.conf.d/mysqld.cnf 修改配置文件中的最大连接数，max_connections = 2000，修改完保存配置退出编辑状态。
[mysql] max_connections = 2000 修改配置文件中的最大连接数
4、查看系统limit限制 使用命令查询系统的文件限制
# 查询文件限制 $ ulimit -n 1024 如果查看的系统文件限制是65535，说明系统已经修改过了，不需要再修改。
5、修改系统文件限制 5.1、在/etc/security/limits.conf最后增加如下两行记录，编辑完保存配置 # 编辑系统文件配置文件 $ view /etc/security/limits.conf # 在/etc/security/limits.conf最后增加如下两行记录 * hard nofile 65535 * soft nofile 65535 最后增加如下两行记录
5.2、编辑/etc/pam.d/common-session，加入一行 session required pam_limits.so # 编辑/etc/pam." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/773a7cd03bd0369470042f3ee075d1ae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-21T08:45:00+08:00" />
<meta property="article:modified_time" content="2022-04-21T08:45:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL修改最大连接数限制</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>随着现在大部分的工程结构都是微服务化，每个服务一般都有本服务独立的DB库，对MySQL的连接数要求也是越来越多。如果本地安装的测试数据，没有对MySQL默认连接数修改，测试时，多开几个微服务，可能就遇到数据库连接数过多的问题。对MySQl默认的最大连接数做修改就必不可少了。</p> 
</blockquote> 
<h2>一、<strong>前提条件</strong></h2> 
<p>修改数据库是比较危险的动作，修改之前以开发测试的数据库为例，做好数据的备份。以防数据库误操作，丢失数据等等 。</p> 
<p>修改MySQL的前提条件：</p> 
<blockquote> 
 <p>1、有Linux用户的管理员权限账号，需要对MySQL安装的配置问卷进行修改；</p> 
 <p>2、MySQL数据库的管理账号。</p> 
 <p>3、如果有运维，与运维和开发负责人员商量修改，数据是大事，以防数据丢失，做好数据的备份。</p> 
</blockquote> 
<h2>二、<strong>修改步骤</strong></h2> 
<h3><strong>1、使用root用户登录和连接数据库</strong></h3> 
<pre><code># mysql -uroot -p</code></pre> 
<p>输入命令后，提示输入root用户密码，输入密码后，成功登录数据库。</p> 
<p><img alt="" class="left" height="249" src="https://images2.imgbox.com/bf/c2/eIO2Lg85_o.png" width="579"></p> 
<p style="text-align:center;">登录MySQL数据库</p> 
<h3><strong>2、查看当前数据库的最大连接数</strong></h3> 
<p></p> 
<pre><code>mysql&gt; show variables like 'max_connections';</code></pre> 
<p> 如下图，MySQL的最大连接数才151，稍微多开几个微服务，基本都会报数据库连接数过多的异常。</p> 
<p><img alt="" class="left" height="182" src="https://images2.imgbox.com/2f/68/PCgK4xiM_o.png" width="581"></p> 
<p style="text-align:center;">查看数据库的最大连接数</p> 
<h3><strong>3、修改MySQL配置文件</strong></h3> 
<p>找到MySQL的配置文件并且修改：<span style="color:#be191c;"><strong>/etc/mysql/mysql.conf.d/mysqld.cnf</strong></span></p> 
<pre><code># view /etc/mysql/mysql.conf.d/mysqld.cnf</code></pre> 
<p>修改配置文件中的最大连接数，<span style="color:#be191c;"><strong>max_connections = 2000</strong></span>，修改完保存配置退出编辑状态。</p> 
<pre><code>[mysql]
max_connections = 2000</code></pre> 
<p><img alt="" class="left" height="500" src="https://images2.imgbox.com/55/27/UMXCp76m_o.png" width="589"></p> 
<p style="text-align:center;">修改配置文件中的最大连接数</p> 
<h3><strong>4、查看系统limit限制</strong></h3> 
<p>使用命令查询系统的文件限制</p> 
<pre><code># 查询文件限制
$ ulimit -n
1024</code></pre> 
<p><strong>如果查看的<span style="color:#be191c;">系统文件限制是65535</span>，说明系统已经修改过了，不需要再修改。</strong></p> 
<h3><strong>5、修改系统文件限制</strong></h3> 
<h4><strong>5.1、在</strong><span style="color:#be191c;"><strong>/etc/security/limits.conf</strong></span><strong>最后增加如下两行记录，编辑完保存配置</strong></h4> 
<pre><code># 编辑系统文件配置文件
$ view /etc/security/limits.conf

# 在/etc/security/limits.conf最后增加如下两行记录
* hard nofile 65535
* soft nofile 65535</code></pre> 
<p><img alt="" class="left" height="314" src="https://images2.imgbox.com/e4/6e/1i3uhOBp_o.png" width="575"></p> 
<p style="text-align:center;">最后增加如下两行记录</p> 
<h4><strong>5.2、编辑/etc/pam.d/common-session，加入一行 </strong><strong>session required pam_limits.so</strong></h4> 
<pre><code># 编辑/etc/pam.d/common-session，
# 加入一行 session required pam_limits.so

$ view /etc/pam.d/common-session</code></pre> 
<p><img alt="" class="left" height="297" src="https://images2.imgbox.com/29/0a/rPQ54Iuv_o.png" width="623"></p> 
<p style="text-align:center;">编辑配置文件</p> 
<h4><strong>5.3、编辑</strong><strong>/etc/profile</strong><strong>，加入</strong><strong>ulimit -SHn 65535，</strong><strong>保存后</strong><strong>，</strong><strong>执行</strong><strong>scource</strong><strong>命令使配置生效，再次查看系统文件限制</strong></h4> 
<pre><code># 编辑/etc/profile，加入ulimit -SHn 65535
# 编辑完保存
$ view /etc/profile

# 执行scource 命令使配置生效，确认修改是否成功
$ source /etc/profile

# 再次查看系统limit限制，看配置文件是否生效
$ ulimit -n
65535</code></pre> 
<p><img alt="" class="left" height="67" src="https://images2.imgbox.com/5d/82/JmCCkpDc_o.png" width="577"></p> 
<p style="text-align:center;">系统配置文件已修改成功<br>  </p> 
<h3><strong>6、修改mysql配置</strong></h3> 
<p>查找<span style="color:#be191c;"><strong>mysql.service</strong></span> 启动文件</p> 
<pre><code>$ systemctl status mysql.service
● mysql.service - MySQL Community Server
 Loaded: loaded (/lib/systemd/system/mysql.service; enabled; vendor preset: enabled)
 Active: active (running) since Wed 2018-12-19 23:53:28 CST; 16min ago
 Process: 25857 ExecStartPost=/usr/share/mysql/mysql-systemd-start post (code=exited, status=0/SUCCESS)
Process: 25843 ExecStartPre=/usr/share/mysql/mysql-systemd-start pre (code=exited, status=0/SUCCESS)
 Main PID: 25856 (mysqld)
  Tasks: 28 (limit: 4915)
 Memory: 185.9M
    CPU: 1.577s
 CGroup: /system.slice/mysql.service
         └─25856 /usr/sbin/mysqld</code></pre> 
<p>进入目录<span style="color:#be191c;"><strong> /etc/systemd/system/multi-user.target.wants</strong></span>，找到文件<span style="color:#be191c;"><strong>mysql.service</strong></span>；</p> 
<p><span style="color:#be191c;"><strong>sudo vim mysql.service</strong></span>，在 [Service] 最后加入：</p> 
<pre><code>LimitNOFILE=65535
LimitNPROC=65535</code></pre> 
<p><img alt="" class="left" height="414" src="https://images2.imgbox.com/fd/58/aQ8SB4rG_o.png" width="565"></p> 
<p style="text-align:center;">修改mysql的启动配置文件</p> 
<h3><strong>7、执行下面命令使修改生效</strong></h3> 
<p>生效刚才修改的配置文件，重新启动MySQL服务。</p> 
<pre><code>$ systemctl daemon-reload
$ systemctl restart mysql.service</code></pre> 
<h3><strong>8、登录mysql，使用 </strong><strong>show variables like "%max_connections%";</strong><strong> 查看最大连接数，这时发现已经改成2000。</strong></h3> 
<p><img alt="" class="left" height="211" src="https://images2.imgbox.com/48/00/9sD7B9cB_o.png" width="595"></p> 
<p style="text-align:center;">最大连接数已修改成功</p> 
<h2><strong>三、结语</strong></h2> 
<p>至此MySQL的最大连接数已修改完成，在开发过程中，尽量合理使用数据库的连接数量。</p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a36606e86fc55f143cc8f003acc0f912/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">STM32LL库使用——SPI通信</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8c2daea2835811c81a5cf9852e68aa5f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">提取CNN模型中间层输出方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>