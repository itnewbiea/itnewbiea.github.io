<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux下KVM虚拟机基本管理及常用命令 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux下KVM虚拟机基本管理及常用命令" />
<meta property="og:description" content="https://www.cnblogs.com/EasonJim/p/8367022.html
https://blog.csdn.net/jks212454/article/details/128113480
查看KVM虚拟机配置文件
#Kvm虚拟机默认配置文件位置 [root@kvm qemu]# pwd /etc/libvirt/qemu [root@kvm qemu]# ll total 12 -rw------- 1 root root 3863 Nov 6 17:26 CentOS6.5.xml -rw------- 1 root root 3771 Nov 7 00:57 CentOS6u7.xml -rw------- 1 root root 3628 Nov 7 02:04 centos.xml drwx------ 3 root root 40 Nov 7 00:46 networks 启动与关闭
#显示正在运行的虚拟机 [root@kvm ~]# virsh list Id Name State ---------------------------------------------------- #显示所有虚拟机 [root@kvm ~]# virsh list --all Id Name State ---------------------------------------------------- - centos shut off - CentOS6." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/60ad155377ae90b4abf85ef45cd5b223/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-25T15:39:19+08:00" />
<meta property="article:modified_time" content="2023-03-25T15:39:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux下KVM虚拟机基本管理及常用命令</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style=""><a class="kdocs-link" style="color:#0A6CFF;" href="https://www.cnblogs.com/EasonJim/p/8367022.html" rel="nofollow noopener noreferrer" target="_blank">https://www.cnblogs.com/EasonJim/p/8367022.html</a></p> 
 <p style=""><a class="kdocs-link" style="color:#0A6CFF;" href="https://blog.csdn.net/jks212454/article/details/128113480" target="_blank" rel="noopener noreferrer">https://blog.csdn.net/jks212454/article/details/128113480</a></p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">查看KVM虚拟机配置文件</span></span></p></li></ol> 
 <pre class="kdocs-bash"><code class="language-bash">#Kvm虚拟机默认配置文件位置
[root@kvm qemu]# pwd
/etc/libvirt/qemu

[root@kvm qemu]# ll
total 12
-rw------- 1 root root 3863 Nov  6 17:26 CentOS6.5.xml
-rw------- 1 root root 3771 Nov  7 00:57 CentOS6u7.xml
-rw------- 1 root root 3628 Nov  7 02:04 centos.xml
drwx------ 3 root root   40 Nov  7 00:46 networks</code></pre> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">启动与关闭</span></span></p></li></ol> 
 <pre class="kdocs-bash"><code class="language-bash">#显示正在运行的虚拟机
[root@kvm ~]# virsh list
 Id    Name                           State
----------------------------------------------------
#显示所有虚拟机
[root@kvm ~]# virsh list --all
 Id    Name                           State
----------------------------------------------------
 -     centos                         shut off
 -     CentOS6.5                      shut off
 -     CentOS6u7                      shut off

#启动名字为CentOS6.5的虚拟机
[root@kvm ~]# virsh start CentOS6.5

#关闭名字为CentOS6.5的虚拟机
[root@kvm ~]# virsh shutdown CentOS6.5

#强制关闭名字为Centos6.5的虚拟机 
[root@kvm ~]# virsh destroy CentOS6.5

#移除名字为CentOS6.5的虚拟机 
[root@kvm ~]# virsh undefine CentOS6.5

#设置CentOS6.5虚拟机开机启动 
[root@kvm ~]# virsh autostart CentOS6.5

#默认情况下virsh工具不能对linux虚拟机进行关机操作
#linux操作系统需要开启与启动acpid服务。在安装KVM linux虚拟机必须配置此服务。
# yum -y install acpid
# /etc/init.d/acpid start</code></pre> 
 <ol start="3"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">通过配置文件启动虚拟机</span></span></p></li></ol> 
 <pre class="kdocs-bash"><code class="language-bash">[root@kvm ~]# virsh create /etc/libvirt/qemu/CentOS6.5.xml</code></pre> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">4、其它（挂起，恢复）virsh命令</span></span></p> 
 <pre class="kdocs-bash"><code class="language-bash">#挂起服务器
[root@kvm qemu]# virsh suspend CentOS6.5

#恢复服务器
[root@kvm qemu]# virsh resume CentOS6.5</code></pre> 
 <ol start="4"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">重命名虚拟机</span></span></p></li></ol> 
 <pre class="kdocs-bash"><code class="language-bash">#停止虚拟机
[root@kvm qemu]# virsh shutdown CentOS6u5

#导出虚拟机的配置文件
[root@kvm qemu]# pwd
/etc/libvirt/qemu
[root@kvm qemu-img]# virsh dumpxml CentOS6u5 &gt; test-CentOS6u5.xml
#更改配置文件
[root@kvm qemu]# sed -i 's/CentOS6u5/test-CentOS6u5/g' test-CentOS6u5.xml
#注 可以不用更改镜像名
#移除原有的虚拟机
[root@kvm qemu]# virsh undefine CentOS6u5

#加载新建的虚拟机
[root@kvm qemu]# virsh define test-CentOS6u5.xml
#启动虚拟机
[root@kvm qemu]# virsh start test-CentOS6u5</code></pre> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">二、常用命令</span></span></p> 
 <pre class="kdocs-bash"><code class="language-bash">列出所有的虚拟机
virsh list --all

显示虚拟机信息
virsh dominfo kvm-1

显示虚拟机内存和cpu的使用情况
yum install virt-top -y
virt-top

显示虚拟机分区信息
virt-df kvm-1

关闭虚拟机（shutodwn）
virsh shutdown kvm-1

启动虚拟机
virsh start kvm-1

设置虚拟机（kvm-1）跟随系统自启
virsh autostart kvm-1

关闭虚拟及自启
virsh autostart --disable kvm-1

删除虚拟机
virsh undefine kvm-1

通过控制窗口登录虚拟机
virsh console kvm-1

virsh shutdown centos        关闭centos虚拟机
virsh destroy centos            强制关闭centos虚拟机
virsh suspend centos        暂停centos虚拟机
vrish resume centos            恢复centos虚拟机
virsh reboot centos            重启centos虚拟机
virsh edit centos                编辑centos虚拟机
virsh vncdisplay  centos    vnc显示</code></pre> 
 <p style=""><span class="kdocs-fontSize" style="font-size:9pt;"><span class="kdocs-bold" style="font-weight:bold;">删除虚拟机</span></span></p> 
 <pre class="kdocs-bash"><code class="language-bash">第一步，停掉虚拟机
virsh shutdown kvm-1

第二步
virsh destroy kvm-1

第三步
virsh undefine kvm-1

第四步
rm /dev/vg_shkvm1/kvm-1  # 不建议删除硬盘</code></pre> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9dafa7691e2feef407668484273a25a1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue学习笔记——使用Vue脚手架</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3f35025a67dc0e0c89b52c07ab6af6d3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Typora字数过多造成卡顿问题（已解决）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>