<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>测试人不会这个？那回家种田吧——Jmeter使用beanshell对接口加密，调用AES代码的jar包，CBC模式，有偏移量。 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="测试人不会这个？那回家种田吧——Jmeter使用beanshell对接口加密，调用AES代码的jar包，CBC模式，有偏移量。" />
<meta property="og:description" content="工作中需要对接口进行AES加密，找开发要来了加密的代码（如下），记录下具体的使用方法：
在IDEA中新建一个AES1模块，在里面新建一个类（类的名字为AESu1）。
把下面的代码复制进去，
这样，AES加密的方法就构建好了。接下来就是导出为jar包了。文件-项目结构-工件-点击&#43;号，
3.1 点击构建-构建工件
3.2 再选中AES1.jar，点击构建，jar就创建好了
把生成的jar包，放到jmeter的lib路径下（有的文章说需要放到lib的ext路径下），不过我是放到lib就已经可以使用了。
在jmeter中，需要把jar包的路径，放到测试计划中。
在beanshell中import AES1.*;填入代码即可
这是AES加密代码
package AES1; import sun.misc.BASE64Encoder; import javax.crypto.Cipher; import javax.crypto.spec.IvParameterSpec; import javax.crypto.spec.SecretKeySpec; import java.io.UnsupportedEncodingException; import java.nio.charset.StandardCharsets; import java.security.AlgorithmParameters; import java.security.Key; public class AESu1{ private static final String ALGORITHM = &#34;AES/CBC/PKCS5PADDING&#34;;//加密模式,设置为CBC private static final String IV_SPEC = &#34;ZE*84J]YE@11a=?9&#34;;//偏移量,可自行更改。 public static String encrypt(String content, String token) throws UnsupportedEncodingException { //对content加密，token为加密的秘钥，长度要为16位 byte[] result = encryptByte(content.getBytes(StandardCharsets.UTF_8), token.substring(0, 16).getBytes(StandardCharsets.UTF_8)); //return Base64.encodeBase64URLSafeString(result); return new BASE64Encoder()." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/91cddc3757e9b23553e14b71cb97f3e3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-23T21:26:17+08:00" />
<meta property="article:modified_time" content="2023-02-23T21:26:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">测试人不会这个？那回家种田吧——Jmeter使用beanshell对接口加密，调用AES代码的jar包，CBC模式，有偏移量。</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>工作中需要对接口进行AES加密，找开发要来了加密的代码（如下），记录下具体的使用方法：</p> 
<ol><li> <p>在IDEA中新建一个AES1模块，在里面新建一个类（类的名字为AESu1）。</p> </li><li> <p>把下面的代码复制进去，</p> </li><li> <p>这样，AES加密的方法就构建好了。接下来就是导出为jar包了。文件-项目结构-工件-点击+号，</p> <p class="img-center"><img alt="" src="https://images2.imgbox.com/bc/08/Zojm6FR3_o.png"></p> <p class="img-center"><img alt="" src="https://images2.imgbox.com/fb/4f/Qs8RG79v_o.png"></p> <p class="img-center"><img alt="" src="https://images2.imgbox.com/fd/df/U20SjDfM_o.png"></p> <p><br> 3.1 点击构建-构建工件</p> <p class="img-center"><img alt="" src="https://images2.imgbox.com/cb/fe/Y88OrcxQ_o.png"></p> <p><br> 3.2 再选中AES1.jar，点击构建，jar就创建好了</p> <p class="img-center"><img alt="" src="https://images2.imgbox.com/5b/be/Zg8hULlf_o.png"></p> </li><li> <p>把生成的jar包，放到jmeter的lib路径下（有的文章说需要放到lib的ext路径下），不过我是放到lib就已经可以使用了。</p> </li><li> <p>在jmeter中，需要把jar包的路径，放到测试计划中。</p> </li><li> <p>在beanshell中<code>import AES1.*;</code>填入代码即可</p> </li></ol> 
<p>这是AES加密代码</p> 
<pre><code>package AES1;  
  
import sun.misc.BASE64Encoder;  
import javax.crypto.Cipher;  
import javax.crypto.spec.IvParameterSpec;  
import javax.crypto.spec.SecretKeySpec;  
import java.io.UnsupportedEncodingException;  
import java.nio.charset.StandardCharsets;  
import java.security.AlgorithmParameters;  
import java.security.Key;  
public class AESu1{  
  
    private static final String ALGORITHM = "AES/CBC/PKCS5PADDING";//加密模式,设置为CBC  
    private static final String IV_SPEC = "ZE*84J]YE@11a=?9";//偏移量,可自行更改。  
    public static String encrypt(String content, String token) throws UnsupportedEncodingException {  
        //对content加密，token为加密的秘钥，长度要为16位  
        byte[] result = encryptByte(content.getBytes(StandardCharsets.UTF_8), token.substring(0, 16).getBytes(StandardCharsets.UTF_8));  
        //return Base64.encodeBase64URLSafeString(result);  
        return new BASE64Encoder().encode(result);  
  
    }  
  
    static byte[] encryptByte(byte[] content, byte[] token) {  
        if (content == null || token == null) {  
            return null;  
        }  
        try {  
            Cipher cipher = initCipher(Cipher.ENCRYPT_MODE, token);  
            return cipher.doFinal(content);  
        } catch (Exception e) {  
            // log.error("AES encrypt failed", e);  
        }  
        return null;  
    }  
  
    private static Cipher initCipher(int mode, byte[] token) throws Exception {  
        if (token == null) {  
            return null;  
        }  
        Cipher cipher = Cipher.getInstance(ALGORITHM);  
        Key key = new SecretKeySpec(token, "AES");  
        AlgorithmParameters params = AlgorithmParameters.getInstance("AES");  
        params.init(new IvParameterSpec(IV_SPEC.getBytes(StandardCharsets.UTF_8)));  
        cipher.init(mode, key, params);  
        return cipher;  
    }  
  
    public static void main(String[] args) throws UnsupportedEncodingException {  
        String a2 = "1234";  
        String pswEncrypt = AESu1.encrypt(a2,"10b457959d4a7a30");  
        System.out.println(pswEncrypt);  
  
    }  
}

</code></pre> 
<hr> 
<p>beanshell中的脚本</p> 
<pre><code>import AES1.*;//导入AES1包
 
String a1 = AESu1.encrypt("1234","10b457959d4a7a31");	//1234是需要加密的字符，10b457959d4a7a31是加密的秘钥，长度需要为16位	
vars.put("a1",a1);//把a1的内容，赋值给jmeter的变量a1

log.info("a1是"+a1);//打印，显示为加密后的内容
</code></pre> 
<p>ps：当需要加密的字符有双引号时，如果直接定义<code>String r ="{"state":"FAILURE","code":"A000204","result":"验证码不正确"}",</code><br> ，可能jmeter会报错</p> 
<p>可以通过prev函数，把返回体中需要的部分，直接传给String，举例如下：</p> 
<pre><code>String r = prev.getResponseDataAsString();
String params= AESu1.encrypt(r,"10b457959d4a7a30")</code></pre> 
<p> <strong>最后感谢每一个阅读我文章的人，一点小心意，虽然不是啥值钱的，需要的话直接拿走：</strong></p> 
<p style="text-align:center;"><strong><img alt="" src="https://images2.imgbox.com/65/72/2i55RSYQ_o.jpg"></strong></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b0/7d/zRdVHd0K_o.jpg"></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bd52d72f1f01aeaae6433ec926c9a630/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">通过AI算法预测彩票</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8650f10ccc04472c46686119083a3af3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">信阳师范学院自动登录校园网</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>