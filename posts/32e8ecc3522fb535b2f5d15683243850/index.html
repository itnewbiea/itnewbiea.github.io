<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Linux碎知识点4】Linux自带的crontab定时任务 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Linux碎知识点4】Linux自带的crontab定时任务" />
<meta property="og:description" content="文章目录 Linux定时任务crontab（1）检查系统是否安装crontab（2）启停命令（3）系统定时调度和用户定时调度（4）crontab格式（5）用户定时常用命令（6）注意事项（7）经典案例 Linux定时任务crontab crontab的服务进程名为crond，英文意为周期任务。顾名思义，crontab在Linux主要用于周期定时任务管理。类似crontab的工具还有at和anacrontab，但具体使用场景不同。
允许用户提交、编辑或删除相应的作业。每一个用户都可以有一个crontab文件来保存调度信息。系统管理员可以通过==/etc/cron.deny== 和 /etc/cron.allow这两个文件来禁止或允许用户拥有自己的crontab文件。
当系统中有 /etc/cron.allow 文件时，只有写入此文件的用户可以使用 crontab 命令，没有写入的用户不能使用 crontab 命令。同样，如果有此文件，/etc/cron.deny 文件会被忽略，因为 /etc/cron.allow 文件的优先级更高。当系统中只有 /etc/cron.deny 文件时，写入此文件的用户不能使用 crontab 命令，没有写入文件的用户可以使用 crontab 命令。这个规则基本和 at 命令的规则一致，同样是 /etc/cron.allow 文件比 /etc/cron.deny 文件的优先级高，Linux 系统中默认只有 /etc/cron.deny 文件。 cron 系统调度进程，通常安装操作系统后，默认已启动crond服务。 可以使用它在每天的非高峰负荷时间段运行作业，或在一周或一月中的不同时段运行。cron是系统主要的调度进程，可以在无需人工干预的情况下运行作业。root用户进程。
关于crontab的用途很多，如
定时系统检测；定时数据采集；定时日志备份；定时更新数据缓存；定时生成报表；
… 当然，更多使用场景是要以视具体情况而定了。毕竟是工具通常都是常用规则总结而成的产物。
（1）检查系统是否安装crontab 检验是否安装 [root@hadoop04 ~]# rpm -qa | grep crontab crontabs-1.11-6.20121102git.el7.noarch [root@hadoop04 ~]# rpm -qa | grep cron cronie-anacron-1.4.11-19.el7.x86_64 crontabs-1.11-6.20121102git.el7.noarch cronie-1.4.11-19.el7.x86_64 安装（没操作） yum -y install vixie-cron yum -y install crontabs （2）启停命令 Centos7：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/32e8ecc3522fb535b2f5d15683243850/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-13T10:11:59+08:00" />
<meta property="article:modified_time" content="2022-08-13T10:11:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Linux碎知识点4】Linux自带的crontab定时任务</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#Linuxcrontab_1" rel="nofollow">Linux定时任务crontab</a></li><li><ul><li><a href="#1crontab_24" rel="nofollow">（1）检查系统是否安装crontab</a></li><li><a href="#2_44" rel="nofollow">（2）启停命令</a></li><li><a href="#3_67" rel="nofollow">（3）系统定时调度和用户定时调度</a></li><li><a href="#4crontab_108" rel="nofollow">（4）crontab格式</a></li><li><a href="#5_139" rel="nofollow">（5）用户定时常用命令</a></li><li><a href="#6_150" rel="nofollow">（6）注意事项</a></li><li><a href="#7_160" rel="nofollow">（7）经典案例</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="Linuxcrontab_1"></a>Linux定时任务crontab</h4> 
<p>crontab的服务进程名为crond，英文意为周期任务。顾名思义，crontab在Linux主要用于周期定时任务管理。类似crontab的工具还有at和anacrontab，但具体使用场景不同。</p> 
<p>允许用户提交、编辑或删除相应的作业。<mark>每一个用户都可以有一个crontab文件来保存调度信息</mark>。系统管理员可以通过==/etc/cron.deny== 和 <mark>/etc/cron.allow</mark>这两个文件来禁止或允许用户拥有自己的crontab文件。</p> 
<ul><li>当系统中有 /etc/cron.allow 文件时，只有写入此文件的用户可以使用 crontab 命令，没有写入的用户不能使用 crontab 命令。同样，如果有此文件，/etc/cron.deny 文件会被忽略，因为 /etc/cron.allow 文件的优先级更高。</li><li>当系统中只有 /etc/cron.deny 文件时，写入此文件的用户不能使用 crontab 命令，没有写入文件的用户可以使用 crontab 命令。</li><li>这个规则基本和 at 命令的规则一致，同样是 /etc/cron.allow 文件比 /etc/cron.deny 文件的优先级高，Linux 系统中默认只有 /etc/cron.deny 文件。</li></ul> 
<p>cron 系统调度进程，通常安装操作系统后，默认已启动crond服务。 可以使用它在每天的非高峰负荷时间段运行作业，或在一周或一月中的不同时段运行。cron是系统主要的调度进程，可以在无需人工干预的情况下运行作业。<mark>root用户进程</mark>。</p> 
<p>关于crontab的用途很多，如</p> 
<ul><li>定时系统检测；</li><li>定时数据采集；</li><li>定时日志备份；</li><li>定时更新数据缓存；</li><li>定时生成报表；<br> …</li></ul> 
<p>当然，更多使用场景是要以视具体情况而定了。毕竟是工具通常都是常用规则总结而成的产物。</p> 
<h5><a id="1crontab_24"></a>（1）检查系统是否安装crontab</h5> 
<ul><li>检验是否安装</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># rpm -qa | grep crontab</span>
crontabs-1.11-6.20121102git.el7.noarch
<span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># rpm -qa | grep cron</span>
cronie-anacron-1.4.11-19.el7.x86_64
crontabs-1.11-6.20121102git.el7.noarch
cronie-1.4.11-19.el7.x86_64
</code></pre> 
<ul><li>安装（没操作）</li></ul> 
<pre><code class="prism language-shell">yum -y <span class="token function">install</span> vixie-cron
yum -y <span class="token function">install</span> crontabs
</code></pre> 
<h5><a id="2_44"></a>（2）启停命令</h5> 
<p>Centos7：</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># systemctl status crond #查看状态</span>
● crond.service - Command Scheduler
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/crond.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Mon <span class="token number">2022</span>-08-08 <span class="token number">15</span>:24:10 CST<span class="token punctuation">;</span> 8min ago
 Main PID: <span class="token number">6896</span> <span class="token punctuation">(</span>crond<span class="token punctuation">)</span>
    Tasks: <span class="token number">1</span>
   CGroup: /system.slice/crond.service
           └─6896 /usr/sbin/crond -n

Aug 08 <span class="token number">15</span>:24:10 hadoop04 systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started Command Scheduler.
Aug 08 <span class="token number">15</span>:24:10 hadoop04 crond<span class="token punctuation">[</span><span class="token number">6896</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>RANDOM_DELAY will be scaled with factor <span class="token number">86</span>% <span class="token keyword">if</span> used.<span class="token punctuation">)</span>
Aug 08 <span class="token number">15</span>:24:10 hadoop04 crond<span class="token punctuation">[</span><span class="token number">6896</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>CRON<span class="token punctuation">)</span> INFO <span class="token punctuation">(</span>running with inotify support<span class="token punctuation">)</span>
<span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># systemctl status crond.service #查看状态</span>
<span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># systemctl start crond.service #启动进程</span>
<span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop crond.service #停止进程</span>
<span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># systemctl reload crond.service #重新加载配置</span>
</code></pre> 
<h5><a id="3_67"></a>（3）系统定时调度和用户定时调度</h5> 
<ul><li>系统定时调度</li></ul> 
<p>全局配置文件在/etc目录下：</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># ls -l /etc | grep "cron"</span>
-rw-------.  <span class="token number">1</span> root root      <span class="token number">541</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> anacrontab
drwxr-xr-x.  <span class="token number">2</span> root root       <span class="token number">54</span> Jul  <span class="token number">4</span>  <span class="token number">2021</span> cron.d	<span class="token comment">#系统自动定期需要做的任务</span>
drwxr-xr-x.  <span class="token number">2</span> root root       <span class="token number">57</span> Jul  <span class="token number">4</span>  <span class="token number">2021</span> cron.daily	<span class="token comment">#每天执行一次的job</span>
-rw-------.  <span class="token number">1</span> root root        <span class="token number">0</span> Apr <span class="token number">11</span>  <span class="token number">2018</span> cron.deny	<span class="token comment">#用于控制不让哪些用户使用Crontab的功能</span>
drwxr-xr-x.  <span class="token number">2</span> root root       <span class="token number">41</span> Jul  <span class="token number">4</span>  <span class="token number">2021</span> cron.hourly	<span class="token comment">#每小时执行一次的job</span>
drwxr-xr-x.  <span class="token number">2</span> root root        <span class="token number">6</span> Jun <span class="token number">10</span>  <span class="token number">2014</span> cron.monthly	<span class="token comment">#每月执行一次的job</span>
-rw-r--r--.  <span class="token number">1</span> root root      <span class="token number">451</span> Jun <span class="token number">10</span>  <span class="token number">2014</span> <span class="token function">crontab</span>	<span class="token comment">#设定系统定时任务执行文件</span>
drwxr-xr-x.  <span class="token number">2</span> root root        <span class="token number">6</span> Jun <span class="token number">10</span>  <span class="token number">2014</span> cron.weekly	<span class="token comment">#每周执行一次的job</span>
</code></pre> 
<ul><li>用户定时调度</li></ul> 
<p>每个用户都有自己的cron配置文件,通过crontab -e 就可以编辑。在crontab 文件都被保存在/var/spool/cron目录中。其文件名与用户名一致。</p> 
<ul><li>日志信息</li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># ll /var/log/cron</span>
-rw------- <span class="token number">1</span> root root <span class="token number">10397</span> Aug <span class="token number">10</span> <span class="token number">15</span>:06 /var/log/cron
<span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># tailf /var/log/cron</span>
Aug <span class="token number">10</span> <span class="token number">15</span>:01:01 hadoop04 run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">7811</span><span class="token punctuation">]</span>: starting 0anacron
Aug <span class="token number">10</span> <span class="token number">15</span>:01:01 hadoop04 anacron<span class="token punctuation">[</span><span class="token number">7826</span><span class="token punctuation">]</span>: Anacron started on <span class="token number">2022</span>-08-10
Aug <span class="token number">10</span> <span class="token number">15</span>:01:01 hadoop04 run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">7828</span><span class="token punctuation">]</span>: finished 0anacron
Aug <span class="token number">10</span> <span class="token number">15</span>:01:01 hadoop04 anacron<span class="token punctuation">[</span><span class="token number">7826</span><span class="token punctuation">]</span>: Will run job <span class="token variable"><span class="token variable">`</span>cron.daily' <span class="token keyword">in</span> <span class="token number">18</span> min.
Aug <span class="token number">10</span> <span class="token number">15</span>:01:01 hadoop04 anacron<span class="token punctuation">[</span><span class="token number">7826</span><span class="token punctuation">]</span>: Will run job <span class="token variable">`</span></span>cron.weekly' <span class="token keyword">in</span> <span class="token number">38</span> min.
Aug <span class="token number">10</span> <span class="token number">15</span>:01:01 hadoop04 anacron<span class="token punctuation">[</span><span class="token number">7826</span><span class="token punctuation">]</span>: Jobs will be executed sequentially
Aug <span class="token number">10</span> <span class="token number">15</span>:01:01 hadoop04 run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">7811</span><span class="token punctuation">]</span>: starting mcelog.cron
Aug <span class="token number">10</span> <span class="token number">15</span>:01:01 hadoop04 run-parts<span class="token punctuation">(</span>/etc/cron.hourly<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">7834</span><span class="token punctuation">]</span>: finished mcelog.cron
Aug <span class="token number">10</span> <span class="token number">15</span>:06:23 hadoop04 crontab<span class="token punctuation">[</span><span class="token number">7977</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>root<span class="token punctuation">)</span> LIST <span class="token punctuation">(</span>root<span class="token punctuation">)</span>
Aug <span class="token number">10</span> <span class="token number">15</span>:06:28 hadoop04 crontab<span class="token punctuation">[</span><span class="token number">7978</span><span class="token punctuation">]</span>: <span class="token punctuation">(</span>root<span class="token punctuation">)</span> LIST <span class="token punctuation">(</span>hadoop<span class="token punctuation">)</span>


</code></pre> 
<h5><a id="4crontab_108"></a>（4）crontab格式</h5> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@hadoop04 ~<span class="token punctuation">]</span><span class="token comment"># cat /etc/crontab</span>
<span class="token assign-left variable"><span class="token environment constant">SHELL</span></span><span class="token operator">=</span>/bin/bash
<span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span>/sbin:/bin:/usr/sbin:/usr/bin
<span class="token assign-left variable">MAILTO</span><span class="token operator">=</span>root

<span class="token comment"># For details see man 4 crontabs</span>

<span class="token comment"># Example of job definition:</span>
<span class="token comment"># .---------------- minute (0 - 59)</span>
<span class="token comment"># |  .------------- hour (0 - 23)</span>
<span class="token comment"># |  |  .---------- day of month (1 - 31)</span>
<span class="token comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span>
<span class="token comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span>
<span class="token comment"># |  |  |  |  |</span>
<span class="token comment"># *  *  *  *  * user-name  command to be executed</span>

前四行是用来配置crond任务运行的环境变量
第一行<span class="token environment constant">SHELL</span>变量指定了系统要使用哪个shell，这里是bash
第二行<span class="token environment constant">PATH</span>变量指定了系统执行命令的路径
第三行MAILTO变量指定了crond的任务执行信息将通过电子邮件发送给root用户；如果MAILTO变量的值为空，则表示不发送任务执行信息给用户

符号含义：
①星号（*）：代表每的意思，例如month字段如果是星号，则表示每月都执行该命令操作。
②逗号（,）：可以用逗号隔开的值指定一个列表范围，例如，“1,2,5,7,8,9”
③中杠（-）：可以用整数之间的中杠表示一个整数范围，例如“2-6”表示“2,3,4,5,6”
④正斜线（/）：可以用正斜线指定时间的间隔频率，例如“0-23/2”表示每两小时执行一次。同时正斜线可以和星号一起使用，例如*/10，如果用在minute字段，表示每十分钟执行一次。
</code></pre> 
<h5><a id="5_139"></a>（5）用户定时常用命令</h5> 
<pre><code class="prism language-shell"><span class="token function">crontab</span> -l	<span class="token comment">#展示该用户的定时任务清单</span>
<span class="token function">crontab</span> -e	<span class="token comment">#编辑该用户的定时任务</span>
<span class="token function">crontab</span> -r	<span class="token comment">#删除该用户的全部定时任务，相当于/var/spool/cron目录中删除用户的crontab文件</span>
<span class="token function">crontab</span> -i	<span class="token comment">#在删除用户的crontab文件时给确认提示</span>
<span class="token function">crontab</span> -l <span class="token operator">&gt;</span> <span class="token environment constant">$PATH</span>/mycron <span class="token comment">#相当于备份crontab文件</span>
<span class="token function">crontab</span> -u root -e	<span class="token comment">#-u指定用户编辑定时任务</span>
</code></pre> 
<h5><a id="6_150"></a>（6）注意事项</h5> 
<ul><li>①定时任务里面的程序脚本尽量用全路径</li><li>②定时任务要加注释</li><li>③避免不必要的程序以及命令输</li><li>④在定义时间时，日期和星期最好不要在一条定时任务中出现，因为它们都以天为单位</li><li>⑤当<code>crontab</code>突然失效时，可以尝试<code>/etc/init</code>.d<code>/crond` `restart解决问题。或者查看日志看某个job有没有执行/报错</code>tail<code> </code>-f <code>/var/log/cron</code>。</li><li>⑥千万别乱运行<code>crontab` `-r。它从Crontab目录（</code>/var/spool/cron<code>）中删除用户的Crontab文件。删除了该用户的所有</code>crontab``都没了。</li><li>⑦在<code>crontab</code>中%是有特殊含义的，表示换行的意思。如果要用的话必须进行转义%，如经常用的<code>date` `‘+%Y%m%d’在</code>crontab<code>里是不会执行的，应该换成</code>date<code> </code>‘+%Y%m%d’</li></ul> 
<h5><a id="7_160"></a>（7）经典案例</h5> 
<ul><li>①有一个/opt/backup.sh脚本，如何在10月的每天早上06到18每3小时执行并在13点单独执行一次。</li></ul> 
<pre><code class="prism language-shell">00 06-18,/3,13 * <span class="token number">10</span> * <span class="token function">sh</span> /opt/backup.sh <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre> 
<ul><li>②设计一个shell程序，每月第一天执行</li></ul> 
<pre><code class="prism language-shell">00 00 01 * *   shell.sh  <span class="token operator">&gt;</span>/dev/null <span class="token operator"><span class="token file-descriptor important">2</span>&gt;</span><span class="token file-descriptor important">&amp;1</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/581edcf2170ba60c7e23772ce5976a5e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">信息技术-简答汇总</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c22bfcc14912bb09b71e3cdd5a2a7710/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JS基础知识点合集</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>