<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java jpa 注解,Java  -  JPA  -  @Version注释 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java jpa 注解,Java  -  JPA  -  @Version注释" />
<meta property="og:description" content="How does @Version annotation work in JPA?
I found various answers whose extract is as follows:
JPA uses a version field in your entities to detect concurrent modifications to the same datastore record. When the JPA runtime detects an attempt to concurrently modify the same record, it throws an exception to the transaction attempting to commit last.
But I am still not sure how it works.
Also as from the following lines:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/74c7430be92baad8caf5d8c658146d7c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-16T05:20:09+08:00" />
<meta property="article:modified_time" content="2021-02-16T05:20:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java jpa 注解,Java  -  JPA  -  @Version注释</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p align="center"><img src="" alt=""></p> 
 <p>How does @Version annotation work in JPA?</p> 
 <p>I found various answers whose extract is as follows:</p> 
 <p>JPA uses a version field in your entities to detect concurrent modifications to the same datastore record. When the JPA runtime detects an attempt to concurrently modify the same record, it throws an exception to the transaction attempting to commit last.</p> 
 <p>But I am still not sure how it works.</p> 
 <p>Also as from the following lines:</p> 
 <p>You should consider version fields immutable. Changing the field value has undefined results.</p> 
 <p>Does it mean that we should declare our version field as final?</p> 
 <p>解决方案</p> 
 <p>But still I am not sure how it works?</p> 
 <p>Let's say an entity MyEntity has an annotated version property:</p> 
 <p>@Entity</p> 
 <p>public class MyEntity implements Serializable {<!-- --></p> 
 <p>@Id</p> 
 <p>@GeneratedValue</p> 
 <p>private Long id;</p> 
 <p>private String name;</p> 
 <p>@Version</p> 
 <p>private Long version;</p> 
 <p>//...</p> 
 <p>}</p> 
 <p>On update, the field annotated with @Version will be incremented and added to the WHERE clause, something like this:</p> 
 <p>UPDATE MYENTITY SET ..., VERSION = VERSION + 1 WHERE ((ID = ?) AND (VERSION = ?))</p> 
 <p>If the WHERE clause fails to match a record (because the same entity has already been updated by another thread), then the persistence provider will throw an OptimisticLockException.</p> 
 <p>Does it mean that we should declare our version field as final</p> 
 <p>No but you could consider making the setter protected as you're not supposed to call it.</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9ffd868b0d98c17c0e1c98800de15141/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Uncaught (in promise) Error: Request failed with status code 500</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/86aeb05b883947471353ff945001d7e2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">力扣561. 数组拆分 I-C语言实现-简单题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>