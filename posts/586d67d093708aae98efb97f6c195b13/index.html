<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pythonç¨‹åºæ—¥å¿—_å¦‚ä½•åœ¨pythonåº”ç”¨ç¨‹åºä¸­å®ç°æ—¥å¿—è®°å½• - ITå­¦ä¹ è€…åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pythonç¨‹åºæ—¥å¿—_å¦‚ä½•åœ¨pythonåº”ç”¨ç¨‹åºä¸­å®ç°æ—¥å¿—è®°å½•" />
<meta property="og:description" content="pythonç¨‹åºæ—¥å¿—
A practical guide to implementing logging
å®æ–½æ—¥å¿—çš„å®ç”¨æŒ‡å— Recently, I set about building a Python application to query a PostgreSQL database, process the data and push subsequent trigger events to a Kafka queue. However, before tackling the interesting aspects, I knew I needed to get the basics right. And one very important basic for any application is logging!
æœ€è¿‘ï¼Œæˆ‘ç€æ‰‹æ„å»ºä¸€ä¸ªPythonåº”ç”¨ç¨‹åºæ¥æŸ¥è¯¢PostgreSQLæ•°æ®åº“ï¼Œå¤„ç†æ•°æ®å¹¶å°†åç»­è§¦å‘äº‹ä»¶æ¨é€åˆ°Kafkaé˜Ÿåˆ—ã€‚ ä½†æ˜¯ï¼Œåœ¨è§£å†³æœ‰è¶£çš„æ–¹é¢ä¹‹å‰ï¼Œæˆ‘çŸ¥é“æˆ‘éœ€è¦æ­£ç¡®äº†è§£åŸºç¡€çŸ¥è¯†ã€‚ å¯¹äºä»»ä½•åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œä¸€ä¸ªéå¸¸é‡è¦çš„åŸºç¡€æ˜¯æ—¥å¿—è®°å½•ï¼ In this article Iâ€™ll first explain some of the key features of logging in Python and, more importantly, demonstrate how I implemented a logger in my application." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/586d67d093708aae98efb97f6c195b13/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-08-15T15:28:19+08:00" />
<meta property="article:modified_time" content="2020-08-15T15:28:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ITå­¦ä¹ è€…åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ITå­¦ä¹ è€…åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pythonç¨‹åºæ—¥å¿—_å¦‚ä½•åœ¨pythonåº”ç”¨ç¨‹åºä¸­å®ç°æ—¥å¿—è®°å½•</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <article style="font-size: 16px;"> 
 <p>pythonç¨‹åºæ—¥å¿—</p> 
 <div> 
  <section> 
   <div> 
    <div> 
     <p>A practical guide to implementing logging</p> 
     <p> å®æ–½æ—¥å¿—çš„å®ç”¨æŒ‡å— </p> 
     <p>Recently, I set about building a Python application to query a PostgreSQL database, process the data and push subsequent trigger events to a Kafka queue. However, before tackling the interesting aspects, I knew I needed to get the basics right. And one very important basic for any application is logging!</p> 
     <p> æœ€è¿‘ï¼Œæˆ‘ç€æ‰‹æ„å»ºä¸€ä¸ªPythonåº”ç”¨ç¨‹åºæ¥æŸ¥è¯¢PostgreSQLæ•°æ®åº“ï¼Œå¤„ç†æ•°æ®å¹¶å°†åç»­è§¦å‘äº‹ä»¶æ¨é€åˆ°Kafkaé˜Ÿåˆ—ã€‚ ä½†æ˜¯ï¼Œåœ¨è§£å†³æœ‰è¶£çš„æ–¹é¢ä¹‹å‰ï¼Œæˆ‘çŸ¥é“æˆ‘éœ€è¦æ­£ç¡®äº†è§£åŸºç¡€çŸ¥è¯†ã€‚ å¯¹äºä»»ä½•åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œä¸€ä¸ªéå¸¸é‡è¦çš„åŸºç¡€æ˜¯æ—¥å¿—è®°å½•ï¼ </p> 
     <p>In this article Iâ€™ll first explain some of the key features of logging in Python and, more importantly, demonstrate how I implemented a logger in my application.</p> 
     <p> åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†é¦–å…ˆè§£é‡ŠPythonæ—¥å¿—è®°å½•çš„ä¸€äº›å…³é”®åŠŸèƒ½ï¼Œæ›´é‡è¦çš„æ˜¯ï¼Œæ¼”ç¤ºå¦‚ä½•åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°è®°å½•å™¨ã€‚ </p> 
     <figure style="display:block;text-align:center;"> 
      <div> 
       <div> 
        <div> 
         <div> 
          <div style="text-align: center;"> 
           <img alt="Image for post" src="https://images2.imgbox.com/50/00/Xsi08nEf_o.png" width="1908" height="420" style="outline: none;"> 
          </div> 
         </div> 
        </div> 
       </div> 
      </div> 
      <figcaption>
        An example of an error log when connecting to PostgreSQL â€” Image from author 
      </figcaption> 
      <figcaption>
        è¿æ¥åˆ°PostgreSQLæ—¶çš„é”™è¯¯æ—¥å¿—çš„ç¤ºä¾‹â€”ç…§ç‰‡ä½œè€…ä½œè€… 
      </figcaption> 
     </figure> 
     <h2> æ‰“å°(â€œä¸ºä»€ä¹ˆä¸å‘¢ï¼Ÿâ€) <span style="font-weight: bold;">(</span>print(â€˜Why not?â€™)<span style="font-weight: bold;">)</span></h2> 
     <p>The first question to tackle: Why not just use <code>print()</code>? Itâ€™s tempting to take the easy route and add print statements all over your code. Weâ€™ve all written code thats looks a bit like this:</p> 
     <p> è¦è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼šä¸ºä»€ä¹ˆä¸åªä½¿ç”¨<code>print()</code> ï¼Ÿ é‡‡å–ç®€å•çš„æ–¹æ³•å¹¶åœ¨ä»£ç ä¸­æ·»åŠ æ‰“å°è¯­å¥å¾ˆè¯±äººã€‚ æˆ‘ä»¬éƒ½ç¼–å†™äº†å¦‚ä¸‹ä»£ç ï¼š </p> 
     <pre><code class="has">print("Getting some docs...")<br>docs = getDocs()<br>print("Doc count %s", len(docs))<br>print("Finished")</code></pre> 
     <p>Generally this is fine for small scripts, or if you need something quick and dirty while developing or debugging. However, <code>print()</code> is just not a viable logging solution for larger applications. Especially if you are planning on promoting your code into production environments.</p> 
     <p> é€šå¸¸ï¼Œè¿™é€‚ç”¨äºå°å‹è„šæœ¬ï¼Œæˆ–è€…åœ¨å¼€å‘æˆ–è°ƒè¯•æ—¶éœ€è¦å¿«é€Ÿåˆè‚®è„çš„ä¸œè¥¿ã€‚ ä½†æ˜¯ï¼Œå¯¹äºå¤§å‹åº”ç”¨ç¨‹åºï¼Œ <code>print()</code>å¹¶ä¸æ˜¯å¯è¡Œçš„æ—¥å¿—è®°å½•è§£å†³æ–¹æ¡ˆã€‚ ç‰¹åˆ«æ˜¯å¦‚æœæ‚¨æ‰“ç®—å°†ä»£ç æ¨å¹¿åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚ </p> 
     <p>To touch on a few of the reasons why print should be avoided. Firstly, It only gives you the option of logging to <code>stdout</code>. This is going to be problematic if you are logging lots of data. Really, you want to be writing your logs somewhere that can be easily persisted, backed up and queried at a later date. Another reason is that print statements are not configurable at run time. To switch on/off specific logs you will need to modify your code every single time. This will mean redeploying your code to production every time you need to turn on debug logging! On top of this, itâ€™s also much more difficult to include valuable information and context, such as the line number and the time the log message was generated.</p> 
     <p> è°ˆè°ˆåº”é¿å…æ‰“å°çš„ä¸€äº›åŸå› ã€‚ é¦–å…ˆï¼Œå®ƒä»…ä½¿æ‚¨å¯ä»¥é€‰æ‹©ç™»å½•åˆ°<code>stdout</code> ã€‚ å¦‚æœæ‚¨è¦è®°å½•å¤§é‡æ•°æ®ï¼Œè¿™å°†æ˜¯æœ‰é—®é¢˜çš„ã€‚ ç¡®å®ï¼Œæ‚¨å¸Œæœ›å°†æ—¥å¿—å†™å…¥å¯ä»¥è½»æ¾ä¿å­˜ï¼Œå¤‡ä»½å’Œç¨åæŸ¥è¯¢çš„åœ°æ–¹ã€‚ å¦ä¸€ä¸ªåŸå› æ˜¯åœ¨è¿è¡Œæ—¶æ— æ³•é…ç½®æ‰“å°è¯­å¥ã€‚ è¦æ‰“å¼€/å…³é—­ç‰¹å®šçš„æ—¥å¿—ï¼Œæ‚¨éœ€è¦æ¯æ¬¡éƒ½ä¿®æ”¹ä»£ç ã€‚ è¿™æ„å‘³ç€æ‚¨æ¯æ¬¡éœ€è¦æ‰“å¼€è°ƒè¯•æ—¥å¿—è®°å½•æ—¶ï¼Œéƒ½å°†ä»£ç é‡æ–°éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ï¼ æœ€é‡è¦çš„æ˜¯ï¼ŒåŒ…å«æœ‰ä»·å€¼çš„ä¿¡æ¯å’Œä¸Šä¸‹æ–‡(ä¾‹å¦‚è¡Œå·å’Œç”Ÿæˆæ—¥å¿—æ¶ˆæ¯çš„æ—¶é—´)ä¹Ÿè¦å›°éš¾å¾—å¤šã€‚ </p> 
     <p>I could go on, but hopefully you are already convinced!</p> 
     <p> æˆ‘å¯ä»¥ç»§ç»­ï¼Œä½†æ˜¯å¸Œæœ›æ‚¨å·²ç»è¯´æœäº†ï¼ </p> 
     <h2> è¾“å…¥Pythonçš„æ—¥å¿—è®°å½•æ¨¡å— <span style="font-weight: bold;">(</span>Enter Pythonâ€™s Logging Module<span style="font-weight: bold;">)</span></h2> 
     <p>Fortunately, the importance of logging is not a new phenomenon. Python ships with a ready made logging solution as part of the Python standard library. It solves all the afore mentioned problems with using print. For example:</p> 
     <p> å¹¸è¿çš„æ˜¯ï¼Œæµ‹äº•çš„é‡è¦æ€§å¹¶ä¸æ˜¯ä¸€ä¸ªæ–°ç°è±¡ã€‚ Pythonéšé™„äº†ç°æˆçš„æ—¥å¿—è®°å½•è§£å†³æ–¹æ¡ˆï¼Œä½œä¸ºPythonæ ‡å‡†åº“çš„ä¸€éƒ¨åˆ†ã€‚ å®ƒè§£å†³äº†ä½¿ç”¨æ‰“å°çš„æ‰€æœ‰ä¸Šè¿°é—®é¢˜ã€‚ ä¾‹å¦‚ï¼š </p> 
     <ul><li>Automatically add context, such as line number &amp; timestamps to logs<p class="nodelete"></p> è‡ªåŠ¨å°†ä¸Šä¸‹æ–‡(ä¾‹å¦‚è¡Œå·å’Œæ—¶é—´æˆ³)æ·»åŠ åˆ°æ—¥å¿—ä¸­ </li><li>Itâ€™s possible to update our logger at runtime by passing a configuration file to the app<p class="nodelete"></p> é€šè¿‡å°†é…ç½®æ–‡ä»¶ä¼ é€’ç»™åº”ç”¨ç¨‹åºï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ–°è®°å½•å™¨ </li><li>It is easy to customise the log severity and configure different logging levels for different environments<p class="nodelete"></p> è‡ªå®šä¹‰æ—¥å¿—ä¸¥é‡æ€§å¹¶é’ˆå¯¹ä¸åŒç¯å¢ƒé…ç½®ä¸åŒçš„æ—¥å¿—è®°å½•çº§åˆ«å¾ˆå®¹æ˜“ </li></ul> 
     <p>Lets try it out and set up a very basic logger:</p> 
     <p> è®©æˆ‘ä»¬å°è¯•ä¸€ä¸‹å¹¶è®¾ç½®ä¸€ä¸ªéå¸¸åŸºæœ¬çš„è®°å½•å™¨ï¼š </p> 
     <figure style="display:block;text-align:center;"></figure> 
     <p>Running this gives:</p> 
     <p> è¿è¡Œæ­¤å‘½ä»¤å¯è·å¾—ï¼š </p> 
     <pre><code class="has">INFO:__main__:Getting some docs...<br>INFO:__main__:Doc count 2<br>INFO:__main__:Finished</code></pre> 
     <p>Easy peasy! âœ… ğŸ‘</p> 
     <p> ååˆ†ç®€å•ï¼ ğŸ‘ </p> 
     <p>Here, we have imported the logging module from the Python standard library. We then updated the default basic log level to log <code>INFO</code> messages. Next, <code>logger = logging.getLogger(__name__)</code> instantiates our logging instance. Finally, we passed an event to the logger with a log level of <code>INFO</code> by calling<code>logger.info("")</code>.</p> 
     <p> åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä»Pythonæ ‡å‡†åº“ä¸­å¯¼å…¥äº†æ—¥å¿—è®°å½•æ¨¡å—ã€‚ ç„¶åï¼Œæˆ‘ä»¬æ›´æ–°äº†é»˜è®¤çš„åŸºæœ¬æ—¥å¿—çº§åˆ«ä»¥è®°å½•<code>INFO</code>æ¶ˆæ¯ã€‚ æ¥ä¸‹æ¥ï¼Œ <code>logger = logging.getLogger(__name__)</code>å®ä¾‹åŒ–æˆ‘ä»¬çš„æ—¥å¿—è®°å½•å®ä¾‹ã€‚ æœ€åï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨<code>logger.info("")</code>å°†äº‹ä»¶ä¼ é€’ç»™æ—¥å¿—çº§åˆ«ä¸º<code>INFO</code>çš„è®°å½•å™¨ã€‚ </p> 
     <p>At first glance, this output might appear suspiciously similar to using <code>print()</code>. Next, weâ€™ll expand our example logger to demonstrate some of the more powerful features that the Python standard logging modules provides.</p> 
     <p> ä¹ä¸€çœ‹ï¼Œæ­¤è¾“å‡ºçœ‹èµ·æ¥å¯ç–‘åœ°ç±»ä¼¼äºä½¿ç”¨<code>print()</code> ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æ‰©å±•ç¤ºä¾‹è®°å½•å™¨ï¼Œä»¥æ¼”ç¤ºPythonæ ‡å‡†è®°å½•æ¨¡å—æä¾›çš„ä¸€äº›æ›´å¼ºå¤§çš„åŠŸèƒ½ã€‚ </p> 
     <h3> æ—¥å¿—çº§åˆ« <span style="font-weight: bold;">(</span>Log Levels<span style="font-weight: bold;">)</span></h3> 
     <p>We can configure the severity of the logs being output and filter out unimportant ones. The module defines five constants throughout the spectrum, making it easy to differentiate between messages. The numeric values of logging levels are given in the following table.</p> 
     <p> æˆ‘ä»¬å¯ä»¥é…ç½®è¾“å‡ºæ—¥å¿—çš„ä¸¥é‡æ€§ï¼Œå¹¶è¿‡æ»¤æ‰ä¸é‡è¦çš„æ—¥å¿—ã€‚ è¯¥æ¨¡å—åœ¨æ•´ä¸ªé¢‘è°±ä¸­å®šä¹‰äº†äº”ä¸ªå¸¸æ•°ï¼Œä»è€Œå¯ä»¥è½»æ¾åŒºåˆ†æ¶ˆæ¯ã€‚ ä¸‹è¡¨ä¸­ç»™å‡ºäº†æ—¥å¿—è®°å½•çº§åˆ«çš„æ•°å€¼ã€‚ </p> 
     <figure style="display:block;text-align:center;"> 
      <div> 
       <div> 
        <div> 
         <div style="text-align: center;"> 
          <img alt="Image for post" src="https://images2.imgbox.com/fd/a7/eNqc7LLs_o.png" width="622" height="576" style="outline: none;"> 
         </div> 
        </div> 
       </div> 
      </div> 
      <figcaption> 
       <a href="https://docs.python.org/3/library/logging.html#logging-levels" rel="noopener nofollow noopener noreferrer" target="_blank">https://docs.python.org/3/library/logging.html#logging-levels</a> 
       <a href="https://docs.python.org/3/library/logging.html#logging-levels" rel="noopener nofollow noopener noreferrer" target="_blank">https://docs.python.org/3/library/logging.html#logging-levelsçš„</a>æ—¥å¿—è®°å½•çº§åˆ« 
      </figcaption> 
     </figure> 
     <p>Itâ€™s important not to flood your logs with lots of messages. To achieve concise logs, we should be careful to define the correct log level for each event.</p> 
     <p> é‡è¦çš„æ˜¯ä¸è¦åœ¨æ—¥å¿—ä¸­å……æ–¥å¤§é‡æ¶ˆæ¯ã€‚ ä¸ºäº†è·å¾—ç®€æ´çš„æ—¥å¿—ï¼Œæˆ‘ä»¬åº”è¯¥ä¸ºæ¯ä¸ªäº‹ä»¶å®šä¹‰æ­£ç¡®çš„æ—¥å¿—çº§åˆ«ã€‚ </p> 
     <pre><code class="has">logger.critical("Really bad event"<br>logger.error("An error")<br>logger.warning("An unexpected event")<br>logger.info("Used for tracking normal application flow")<br>logger.debug("Log data or variables for developing")</code></pre> 
     <p>I tend to use the debug level to log the data being passed around the app. Here is an example of using 3 different log levels in the few lines of code responsible for sending events to Kafka.</p> 
     <p> æˆ‘å€¾å‘äºä½¿ç”¨è°ƒè¯•çº§åˆ«æ¥è®°å½•åœ¨åº”ç”¨ç¨‹åºå‘¨å›´ä¼ é€’çš„æ•°æ®ã€‚ è¿™æ˜¯åœ¨å‡ è¡Œä»£ç ä¸­ä½¿ç”¨3ç§ä¸åŒæ—¥å¿—çº§åˆ«çš„ç¤ºä¾‹ï¼Œè¿™äº›ä»£ç è´Ÿè´£å°†äº‹ä»¶å‘é€åˆ°Kafkaã€‚ </p> 
     <figure style="display:block;text-align:center;"></figure> 
     <h3> æ ¼å¼åŒ–æ—¥å¿— <span style="font-weight: bold;">(</span>Formatting Logs<span style="font-weight: bold;">)</span></h3> 
     <p>The default formatter of the Python logging module doesnâ€™t provide a great amount of detail. Fortunately, it is easy to configure the log format to add all the context we need to produce super useful log messages.</p> 
     <p> Pythonæ—¥å¿—è®°å½•æ¨¡å—çš„é»˜è®¤æ ¼å¼åŒ–ç¨‹åºæœªæä¾›å¤§é‡è¯¦ç»†ä¿¡æ¯ã€‚ å¹¸è¿çš„æ˜¯ï¼Œå¾ˆå®¹æ˜“é…ç½®æ—¥å¿—æ ¼å¼ä»¥æ·»åŠ ç”Ÿæˆè¶…çº§æœ‰ç”¨çš„æ—¥å¿—æ¶ˆæ¯æ‰€éœ€çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ã€‚ </p> 
     <p>For example, here we add a timestamp and the log level to the log message.</p> 
     <p> ä¾‹å¦‚ï¼Œåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬åœ¨æ—¥å¿—æ¶ˆæ¯ä¸­æ·»åŠ æ—¶é—´æˆ³å’Œæ—¥å¿—çº§åˆ«ã€‚ </p> 
     <pre><code class="has">formatter = logging.Formatter('%(asctime)s - %(levelname)s - %(message)s')</code></pre> 
     <p>Itâ€™s best practice to add as much context as possible to your logs. This can easily be achieved by adding structured data to the log messageâ€™s metadata. For example, you may have scaled your application to run with multiple workers. In this case it might be important to know which worker was logging each event when youâ€™re debugging so lets add a worker id context to the log metadata.</p> 
     <p> æœ€ä½³åšæ³•æ˜¯åœ¨æ—¥å¿—ä¸­æ·»åŠ å°½å¯èƒ½å¤šçš„ä¸Šä¸‹æ–‡ã€‚ é€šè¿‡å°†ç»“æ„åŒ–æ•°æ®æ·»åŠ åˆ°æ—¥å¿—æ¶ˆæ¯çš„å…ƒæ•°æ®ä¸­ï¼Œå¯ä»¥è½»æ¾å®ç°è¿™ä¸€ç‚¹ã€‚ ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å·²ç¼©æ”¾åº”ç”¨ç¨‹åºä»¥ä¸å¤šä¸ªå·¥ä½œç¨‹åºä¸€èµ·è¿è¡Œã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè°ƒè¯•æ—¶çŸ¥é“å“ªä¸ªå·¥ä½œç¨‹åºæ­£åœ¨è®°å½•æ¯ä¸ªäº‹ä»¶å¯èƒ½å¾ˆé‡è¦ï¼Œå› æ­¤è®©æˆ‘ä»¬å°†å·¥ä½œç¨‹åºIDä¸Šä¸‹æ–‡æ·»åŠ åˆ°æ—¥å¿—å…ƒæ•°æ®ä¸­ã€‚ </p> 
     <pre><code class="has"># Create the log formatterformatter = <br>handler.setFormatter(formatter)logger.info('Querying database for docs...', extra={'worker': <br>'id_1'})</code></pre> 
     <p>The output becomes:</p> 
     <p> è¾“å‡ºå˜ä¸ºï¼š </p> 
     <pre><code class="has">2020-09-02 22:06:18,170 - id_1 - INFO - Querying database for docs...</code></pre> 
     <h3> æ—¥å¿—å¤„ç†ç¨‹åº <span style="font-weight: bold;">(</span>Log Handlers<span style="font-weight: bold;">)</span></h3> 
     <p>Now we have perfectly formatted logs being fired at us from all over our application code, we need to consider where those logs are ending up. By default the logs are being written to stdout, but Pythonâ€™s logging module provides us with the functionality to push logs to alternative locations. For example, to save logs to <code>example.log</code> file on disk.</p> 
     <p> ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»ä»æ‰€æœ‰åº”ç”¨ç¨‹åºä»£ç ä¸­å‘æˆ‘ä»¬å‘å°„äº†æ ¼å¼æ­£ç¡®çš„æ—¥å¿—ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘è¿™äº›æ—¥å¿—åœ¨å“ªé‡Œç»“æŸã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œæ—¥å¿—ä¼šå†™å…¥stdoutï¼Œä½†æ˜¯Pythonçš„æ—¥å¿—è®°å½•æ¨¡å—ä¸ºæˆ‘ä»¬æä¾›äº†å°†æ—¥å¿—æ¨é€åˆ°å…¶ä»–ä½ç½®çš„åŠŸèƒ½ã€‚ ä¾‹å¦‚ï¼Œå°†æ—¥å¿—ä¿å­˜åˆ°ç£ç›˜ä¸Šçš„<code>example.log</code>æ–‡ä»¶ä¸­ã€‚ </p> 
     <pre><code class="has"># create a file handler<br>handler = logging.FileHandler('example.log')<br>handler.setLevel(logging.INFO)</code></pre> 
     <p>There are several types of handlers that can be used. For the complete list, see the <a href="https://docs.python.org/3/library/logging.handlers.html#module-logging.handlers" rel="noopener nofollow noopener noreferrer" target="_blank">documentation for handlers</a>. It is also possible to define custom logging handlers for different use cases. For example, <a href="https://pypi.org/project/slacker-log-handler/" rel="noopener nofollow noopener noreferrer" target="_blank">here</a> is a library that defines a log handler for pushing logs to Slack!</p> 
     <p> å¯ä»¥ä½¿ç”¨å‡ ç§ç±»å‹çš„å¤„ç†ç¨‹åºã€‚ æœ‰å…³å®Œæ•´åˆ—è¡¨ï¼Œè¯·å‚è§<a href="https://docs.python.org/3/library/logging.handlers.html#module-logging.handlers" rel="noopener nofollow noopener noreferrer" target="_blank">å¤„ç†ç¨‹åº</a>çš„<a href="https://docs.python.org/3/library/logging.handlers.html#module-logging.handlers" rel="noopener nofollow noopener noreferrer" target="_blank">æ–‡æ¡£</a> ã€‚ ä¹Ÿå¯ä»¥ä¸ºä¸åŒç”¨ä¾‹å®šä¹‰è‡ªå®šä¹‰æ—¥å¿—è®°å½•å¤„ç†ç¨‹åºã€‚ ä¾‹å¦‚ï¼Œ <a href="https://pypi.org/project/slacker-log-handler/" rel="noopener nofollow noopener noreferrer" target="_blank">è¿™</a>æ˜¯ä¸€ä¸ªåº“ï¼Œè¯¥åº“å®šä¹‰äº†ç”¨äºå°†æ—¥å¿—æ¨é€åˆ°Slackçš„æ—¥å¿—å¤„ç†ç¨‹åºï¼ </p> 
     <p>To summarise. Weâ€™ve set up the Python standard logging module and configured it to log to different locations with custom log formats. You can find the final code for the example logger below:</p> 
     <p> æ€»ç»“ä¸€ä¸‹ã€‚ æˆ‘ä»¬å·²ç»è®¾ç½®äº†Pythonæ ‡å‡†æ—¥å¿—è®°å½•æ¨¡å—ï¼Œå¹¶å°†å…¶é…ç½®ä¸ºä½¿ç”¨è‡ªå®šä¹‰æ—¥å¿—æ ¼å¼è®°å½•åˆ°å…¶ä»–ä½ç½®ã€‚ æ‚¨å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°ç¤ºä¾‹è®°å½•å™¨çš„æœ€ç»ˆä»£ç ï¼š </p> 
     <figure style="display:block;text-align:center;"></figure> 
    </div> 
   </div> 
  </section> 
  <section> 
   <div> 
    <div> 
     <h2> å®ä½œ <span style="font-weight: bold;">(</span>Implementation<span style="font-weight: bold;">)</span></h2> 
     <p>Hopefully, by now you should have a good idea of some of the key features of the Python logging module. Thatâ€™s all well and good, but how should you implement all this different configuration and manage importing logging modules in your application files? Itâ€™s a point often over looked by many guides. Here is how I decided to handle it.</p> 
     <p> å¸Œæœ›åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ‚¨åº”è¯¥å¯¹Pythonæ—¥å¿—è®°å½•æ¨¡å—çš„ä¸€äº›å…³é”®åŠŸèƒ½æœ‰æ‰€äº†è§£ã€‚ å¾ˆå¥½ï¼Œä½†æ˜¯æ‚¨åº”è¯¥å¦‚ä½•å®ç°æ‰€æœ‰è¿™äº›ä¸åŒçš„é…ç½®å¹¶ç®¡ç†åº”ç”¨ç¨‹åºæ–‡ä»¶ä¸­çš„å¯¼å…¥æ—¥å¿—è®°å½•æ¨¡å—ï¼Ÿ è®¸å¤šæŒ‡å—ç»å¸¸å¿½ç•¥è¿™ä¸€ç‚¹ã€‚ è¿™æ˜¯æˆ‘å†³å®šå¤„ç†çš„æ–¹å¼ã€‚ </p> 
     <p>First up, I decided to extract all the logging configuration into a config file called <code>logging.ini</code>. You can find all the information you need on how to format the log file in the <a href="https://docs.python.org/3/library/logging.config.html#configuration-file-format" rel="noopener nofollow noopener noreferrer" target="_blank">official docs</a>, so I wonâ€™t go over it all here. Currently, my logging.ini is super basic. When the application is out of development and ready for deployment Iâ€™ll be extending the logging configuration to handle different environments, rotate logs on disk and sent alerts to a Slack channel.</p> 
     <p> é¦–å…ˆï¼Œæˆ‘å†³å®šå°†æ‰€æœ‰æ—¥å¿—è®°å½•é…ç½®æå–åˆ°ä¸€ä¸ªåä¸º<code>logging.ini</code>çš„é…ç½®æ–‡ä»¶ä¸­ã€‚ æ‚¨å¯ä»¥åœ¨<a href="https://docs.python.org/3/library/logging.config.html#configuration-file-format" rel="noopener nofollow noopener noreferrer" target="_blank">å®˜æ–¹æ–‡æ¡£ä¸­</a>æ‰¾åˆ°æœ‰å…³å¦‚ä½•æ ¼å¼åŒ–æ—¥å¿—æ–‡ä»¶æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤åœ¨æ­¤ä¸å†èµ˜è¿°ã€‚ ç›®å‰ï¼Œæˆ‘çš„logging.iniè¶…çº§åŸºç¡€ã€‚ å½“åº”ç”¨ç¨‹åºåœæ­¢å¼€å‘å¹¶å‡†å¤‡éƒ¨ç½²æ—¶ï¼Œæˆ‘å°†æ‰©å±•æ—¥å¿—è®°å½•é…ç½®ä»¥å¤„ç†ä¸åŒçš„ç¯å¢ƒï¼Œæ—‹è½¬ç£ç›˜ä¸Šçš„æ—¥å¿—å¹¶å°†è­¦æŠ¥å‘é€åˆ°Slacké€šé“ã€‚ </p> 
     <figure style="display:block;text-align:center;"></figure> 
     <p>The great thing is, this really simplifies the implementation from a code point of view because you need <em>much</em> less boilerplate to set up log handlers and formatters. Above, we had 15 lines of code setting up just one formatter and one handler - itâ€™s easy to imagine how this could become a lot bigger with more complex use cases. Now all that complexity has been abstracted away to the config file. The resultâ€¦to implement your logger you just need two extra lines of code in your app!</p> 
     <p> ä¼Ÿå¤§çš„äº‹æƒ…æ˜¯ï¼Œè¿™çœŸçš„æ˜¯ä»ä¸€ä¸ªç ç‚¹ç®€åŒ–äº†å®ç°ï¼Œå› ä¸ºä½ éœ€è¦å°‘<em>å¾—å¤š</em>çš„æ ·æ¿è®¾ç½®æ—¥å¿—å¤„ç†ç¨‹åºå’Œæ ¼å¼åŒ–ã€‚ ä¸Šé¢ï¼Œæˆ‘ä»¬æœ‰15è¡Œä»£ç ä»…è®¾ç½®äº†ä¸€ä¸ªæ ¼å¼åŒ–ç¨‹åºå’Œä¸€ä¸ªå¤„ç†ç¨‹åº-å¯ä»¥æƒ³è±¡ï¼Œå¦‚æœä½¿ç”¨æ›´å¤æ‚çš„ç”¨ä¾‹ï¼Œä»£ç å¯èƒ½ä¼šå˜å¾—æ›´å¤§ã€‚ ç°åœ¨ï¼Œæ‰€æœ‰è¿™äº›å¤æ‚æ€§å·²è¢«æŠ½è±¡åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚ ç»“æœâ€¦â€¦è¦å®ç°è®°å½•å™¨ï¼Œæ‚¨åªéœ€è¦åœ¨åº”ç”¨ç¨‹åºä¸­å¤šæ·»åŠ ä¸¤è¡Œä»£ç å³å¯ï¼ </p> 
     <pre><code class="has">import logging.configlogging.config.fileConfig(fname='logger.ini')</code></pre> 
     <p>Pretty neat! But where should this code live exactly?</p> 
     <p> æ¼‚äº®æ•´é½ï¼ ä½†æ˜¯æ­¤ä»£ç åº”å‡†ç¡®åœ°å­˜æ”¾åœ¨å“ªé‡Œï¼Ÿ </p> 
     <p>My application is structured with a <code>__main__.py</code> as the entry point. I decided to implement my logger inside this file in order to not distract from the main functionality contained within app.py. The below <code>__main__.py</code> will handle reading the config file and applying the configuration to your logger.</p> 
     <p> æˆ‘çš„åº”ç”¨ç¨‹åºçš„ç»“æ„æ˜¯ä¸€ä¸ª<code>__main__.py</code>ä½œä¸ºå…¥å£ç‚¹ã€‚ æˆ‘å†³å®šåœ¨æ­¤æ–‡ä»¶ä¸­å®ç°æˆ‘çš„è®°å½•å™¨ï¼Œä»¥å…åˆ†æ•£app.pyä¸­åŒ…å«çš„ä¸»è¦åŠŸèƒ½ã€‚ ä¸‹é¢çš„<code>__main__.py</code>å°†å¤„ç†è¯»å–é…ç½®æ–‡ä»¶å¹¶å°†é…ç½®åº”ç”¨äºè®°å½•å™¨çš„æ“ä½œã€‚ </p> 
     <figure style="display:block;text-align:center;"></figure> 
     <p>Finally, we need to make use of our creation, by firing off some logs! But these messages arenâ€™t going to be generated by the<code>__main__</code>function, so how should we handle passing our logger to other files and functions within the application?</p> 
     <p> æœ€åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡é‡Šæ”¾ä¸€äº›æ—¥å¿—æ¥åˆ©ç”¨æˆ‘ä»¬çš„åˆ›é€ ï¼ ä½†æ˜¯è¿™äº›æ¶ˆæ¯ä¸ä¼šç”±<code>__main__</code>å‡½æ•°ç”Ÿæˆï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥å¦‚ä½•å¤„ç†å°†è®°å½•å™¨ä¼ é€’ç»™åº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–æ–‡ä»¶å’Œå‡½æ•°å‘¢ï¼Ÿ </p> 
     <p>Again this becomes trivial. To use the logger in another file, we only need to import the logging module and instantiate it. It will automatically inherit the configuration that we passed to it in <code>__main__</code>. For example, to start logging messages in <code>app.py</code>:</p> 
     <p> å†æ¬¡ï¼Œè¿™å˜å¾—å¾®ä¸è¶³é“ã€‚ è¦åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨è®°å½•å™¨ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¼å…¥è®°å½•æ¨¡å—å¹¶å°†å…¶å®ä¾‹åŒ–å³å¯ã€‚ å®ƒå°†è‡ªåŠ¨ç»§æ‰¿æˆ‘ä»¬åœ¨<code>__main__</code>ä¼ é€’ç»™å®ƒçš„é…ç½®ã€‚ ä¾‹å¦‚ï¼Œè¦å¼€å§‹åœ¨<code>app.py</code>è®°å½•æ¶ˆæ¯ï¼š </p> 
     <figure style="display:block;text-align:center;"></figure> 
     <p>The above debug message will be handled based on the logging configuration read from<code>logging.ini</code>. And the same will be true for every other python file in you application, as long as you <code>import logging</code> at the top. Yes, it is really that simple!</p> 
     <p> ä»¥ä¸Šè°ƒè¯•æ¶ˆæ¯å°†æ ¹æ®ä»<code>logging.ini</code>è¯»å–çš„æ—¥å¿—é…ç½®è¿›è¡Œå¤„ç†ã€‚ åªè¦æ‚¨åœ¨é¡¶éƒ¨<code>import logging</code> ï¼Œåº”ç”¨ç¨‹åºä¸­çš„å…¶ä»–æ‰€æœ‰pythonæ–‡ä»¶éƒ½ä¸€æ ·ã€‚ æ˜¯çš„ï¼ŒçœŸçš„å°±æ˜¯è¿™ä¹ˆç®€å•ï¼ </p> 
     <p>To recap, not only have you seen some of the features that make the Python logging module an awesome tool to have in your armoury, you have also seen how easy it is to implement.</p> 
     <p> å›é¡¾ä¸€ä¸‹ï¼Œæ‚¨ä¸ä»…çœ‹åˆ°äº†ä½¿Pythonæ—¥å¿—è®°å½•æ¨¡å—æˆä¸ºå¼ºå¤§å·¥å…·çš„æŸäº›åŠŸèƒ½ï¼Œè€Œä¸”è¿˜çœ‹åˆ°äº†å®ç°çš„éš¾æ˜“ç¨‹åº¦ã€‚ </p> 
     <p>Thank you for reading and I hope you found this guide useful. Happy logging!</p> 
     <p> æ„Ÿè°¢æ‚¨çš„é˜…è¯»ï¼Œå¸Œæœ›æœ¬æŒ‡å—å¯¹æ‚¨æœ‰æ‰€å¸®åŠ©ã€‚ ç¥æ‚¨ç™»å½•æ„‰å¿«ï¼ </p> 
    </div> 
   </div> 
  </section> 
 </div> 
 <blockquote> 
  <p>ç¿»è¯‘è‡ª: <a href="https://medium.com/@leo.brack/how-to-implement-logging-in-your-python-application-1730315003c4" rel="nofollow">https://medium.com/@leo.brack/how-to-implement-logging-in-your-python-application-1730315003c4</a></p> 
 </blockquote> 
 <p>pythonç¨‹åºæ—¥å¿—</p> 
</article>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b63f2fe50c006ded210defded8c2c7ca/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ä¸ºä»€ä¹ˆè¦ç”¨æ·±æµ…æ‹·è´ã€ä»€ä¹ˆæ˜¯æ·±æµ…æ‹·è´ã€ä»¥åŠå¦‚ä½•å®ç°</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f6e49c50b4731cbd2c7ab02120563a77/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">æ“ä½œç³»ç»Ÿâ€”â€”è¿›ç¨‹ç®¡ç†çš„åŠŸèƒ½</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ITå­¦ä¹ è€…åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>