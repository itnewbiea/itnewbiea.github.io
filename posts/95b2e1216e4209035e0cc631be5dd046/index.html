<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>haproxy笔记 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="haproxy笔记" />
<meta property="og:description" content="文章目录 场景haproxy配置文档地址 场景 还得先从场景说起。
生产环境redis检查，发现配置的redis地址不对。 redis有3个节点。
192.168.0.1
192.168.0.2
192.168.0.3
但是配置的是 192.168.0.9 端口是16379。
好奇怪有没有，是不是配错了?
问了下部署大神，才确认部署的没问题。 说是走的haproxy。
那么问题来了，haproxy是什么?
还是那句话，做程序员即使不会用，也必须听说过。
google了下，才发现haproxy是redis负载均衡。 那么走起，一探究竟吧。
haproxy配置 如果只是使用的话，不需要深入了解(学习成本太高)。
好在主配置就是最后几行，大概明白什么意思就行。
当然，haproxy实际是很复杂的，我们只简单使用。
global log 127.0.0.1 local0 notice maxconn 10240 daemon defaults mode http log global option tcplog option dontlognull option http-server-close option redispatch retries 3 maxconn 10240 timeout http-request 10s timeout queue 1m timeout connect 10s timeout client 1m timeout server 1m timeout http-keep-alive 10s timeout check 10s listen stats bind 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/95b2e1216e4209035e0cc631be5dd046/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T13:54:45+08:00" />
<meta property="article:modified_time" content="2024-01-03T13:54:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">haproxy笔记</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">场景</a></li><li><a href="#haproxy_16" rel="nofollow">haproxy配置</a></li><li><a href="#_79" rel="nofollow">文档地址</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>场景</h3> 
<p>还得先从场景说起。<br> 生产环境redis检查，发现配置的redis地址不对。 redis有3个节点。<br> 192.168.0.1<br> 192.168.0.2<br> 192.168.0.3<br> 但是配置的是 192.168.0.9 端口是16379。<br> 好奇怪有没有，是不是配错了?</p> 
<p>问了下部署大神，才确认部署的没问题。 说是走的haproxy。<br> 那么问题来了，haproxy是什么?<br> 还是那句话，做程序员即使不会用，也必须听说过。</p> 
<p>google了下，才发现haproxy是redis负载均衡。 那么走起，一探究竟吧。</p> 
<h3><a id="haproxy_16"></a>haproxy配置</h3> 
<p>如果只是使用的话，不需要深入了解(学习成本太高)。<br> 好在主配置就是最后几行，大概明白什么意思就行。<br> 当然，haproxy实际是很复杂的，我们只简单使用。</p> 
<pre><code class="prism language-bash">global
    log <span class="token number">127.0</span>.0.1 local0 notice
    maxconn     <span class="token number">10240</span>
    daemon

defaults
    mode http
    log global
    option tcplog
    option dontlognull
    option http-server-close
    option  redispatch
    retries <span class="token number">3</span>
    maxconn <span class="token number">10240</span>
    <span class="token function">timeout</span> http-request 10s  
    <span class="token function">timeout</span> queue 1m  
    <span class="token function">timeout</span> connect 10s  
    <span class="token function">timeout</span> client 1m  
    <span class="token function">timeout</span> server 1m  
    <span class="token function">timeout</span> http-keep-alive 10s  
    <span class="token function">timeout</span> check 10s  

listen stats
    <span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0:1082           <span class="token comment">#监听端口  </span>
    stats refresh 30s           <span class="token comment">#统计页面自动刷新时间  </span>
    stats uri /                 <span class="token comment">#统计页面url</span>
    stats realm Haproxy Manager <span class="token comment">#统计页面密码框上提示文本  </span>
    stats auth admin:PfTFu@zcd6R3U4T      <span class="token comment">#统计页面用户名和密码设置  </span>
    <span class="token comment">#stats hide-version         #隐藏统计页面上HAProxy的版本信息</span>

<span class="token comment">########tcp配置#################  </span>
listen redis
    <span class="token builtin class-name">bind</span> <span class="token number">0.0</span>.0.0:16379
    mode tcp
    maxconn <span class="token number">10240</span>
    balance roundrobin

    option tcp-check
<span class="token comment">#   tcp-check connect</span>
    tcp-check send AUTH<span class="token punctuation">\</span> Bw-redis@2023<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    tcp-check <span class="token function">expect</span> string +OK
    tcp-check send PING<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    tcp-check <span class="token function">expect</span> string +PONG
    tcp-check send info<span class="token punctuation">\</span> replication<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    tcp-check <span class="token function">expect</span> string role:master
    tcp-check send QUIT<span class="token punctuation">\</span>r<span class="token punctuation">\</span>n
    tcp-check <span class="token function">expect</span> string +OK

<span class="token comment">########负载配置#################</span>

server redis1 <span class="token number">10.168</span>.0.1:6379 check inter <span class="token number">2000</span> rise <span class="token number">3</span> fall <span class="token number">3</span> weight <span class="token number">30</span>

server redis2 <span class="token number">10.168</span>.0.2:6379 check inter <span class="token number">2000</span> rise <span class="token number">3</span> fall <span class="token number">3</span> weight <span class="token number">30</span>

server redis3 <span class="token number">10.168</span>.0.3:6379 check inter <span class="token number">2000</span> rise <span class="token number">3</span> fall <span class="token number">3</span> weight <span class="token number">30</span>

</code></pre> 
<h3><a id="_79"></a>文档地址</h3> 
<p>http://haproxy.1wt.eu/<br> 非官网，但是感觉这个网站也很不错，从版本到文档都比较全。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6af1ef8b370869af266ee303d86e0cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">机器学习在缺陷检测中的突破与实践</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f010ee2b75a502a532e614c375397bac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">编程笔记 html5&amp;css&amp;js 016 HTML表格</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>