<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C/C&#43;&#43; 连接访问 MySQL数据库 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C/C&#43;&#43; 连接访问 MySQL数据库" />
<meta property="og:description" content="前面我们已经讲述了MySQL的基础使用，现在我们来看一下如何使用语言来操作数据库。在实际开发中，语言连接MySQL是为了能够在编程语言中与MySQL数据库进行交互和操作。大部分情况我们都是通过语言连接MySQL，建立与MySQL数据库的连接，可以向MySQL数据库发送更新请求，如插入、更新或删除数据。本篇文章主要讲解使用C语言连接MySQL数据库，当然在C&#43;&#43;中也能够使用，因为C&#43;&#43;兼容C语言的。
文章目录
一、连接MySQL
1、1 MySQL官网下载库
1、2 安装对应开发库
二、MySQL接口介绍
2、1 创建和释放 MYSQL 对象
2、2 连接mysql
2、3 发送sql语句
🙋‍♂️ 作者：@Ggggggtm 🙋‍♂️
👀 专栏：MySQL 👀
💥 标题：C/C&#43;&#43; 连接访问 MySQL💥
❣️ 寄语：与其忙着诉苦，不如低头赶路，奋路前行，终将遇到一番好风景 ❣️ 一、连接MySQL 1、1 MySQL官网下载库 要使用C语言连接mysql，需要使用mysql官网提供的库。MySQL官网：MySQL。如下图：
然后点击DOWNLOADS，如下图：
往下寻找MySQL Community Downloads，如下图：
因为我们使用C语言连接MySQL，所以查找C API，如下图：
然后点击如下图：
我个人所用的是Linux，所以选择Linux的安装包。可根据自己的环境进行选择，如下图：
再次选择OS合适的版本，如下图：
当我们下载后，采用rz -E的方法可将压缩包传输到我们的Linux上。然后再使用 tar -xzf进行解压即可。解压后我们再看其中的文件，如下图：
其中对我们有用的就是头文件和库函数了。具体怎么进行使用该头文件和库函数，可以参照文章：动静态库的原理与制作详解。这里就不再过多解释。
但是我们也不建议使用以上方法，因为其中可能会产生兼容性等问题。我们接着往下看。
1、2 安装对应开发库 当我们再Linux安装了mysql的开发环境时，就会自动给我们安装对应的语言连接mysql 的头文件与库函数。我们可以进行查看。具体查看方法如下：
查看头文件：查看对应的库： 如果上述都能够查看到，证明就已经安装了对应的开发库。一般情况下都是有的，如果没有的话，可以进行自己安装，如下图：
我这里已经安装过了，所以最后显示的是Nothing to do。下面我们来验证一下看是否安装成功。代码如下：
#include &lt;iostream&gt; #include &lt;mysql/mysql.h&gt; int main() { printf(&#34;mysql client Version: %s\n&#34;, mysql_get_client_info()); return 0; } 运行结果如下图：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7ca5b1b6b2f2760df4079c2b018ed5c6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-23T21:14:44+08:00" />
<meta property="article:modified_time" content="2023-12-23T21:14:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C/C&#43;&#43; 连接访问 MySQL数据库</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/13/12/CQdtdciX_o.gif"> </p> 
<blockquote> 
 <p>  前面我们已经讲述了MySQL的基础使用，现在我们来看一下如何使用语言来操作数据库。在实际开发中，语言连接MySQL是为了能够在编程语言中与MySQL数据库进行交互和操作。大部分情况我们都是通过语言连接MySQL，建立与MySQL数据库的连接，可以向MySQL数据库发送更新请求，如插入、更新或删除数据。<strong>本篇文章主要讲解使用C语言连接MySQL数据库，当然在C++中也能够使用，因为C++兼容C语言的</strong>。</p> 
</blockquote> 
<blockquote> 
 <p id="main-toc"><strong>文章目录</strong></p> 
 <p id="%E4%B8%80%E3%80%81%E8%BF%9E%E6%8E%A5MySQL-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E8%BF%9E%E6%8E%A5MySQL" rel="nofollow">一、连接MySQL</a></p> 
 <p id="1%E3%80%811%20MySQL%E5%AE%98%E7%BD%91%E4%B8%8B%E8%BD%BD%E5%BA%93-toc" style="margin-left:40px;"><a href="#1%E3%80%811%20MySQL%E5%AE%98%E7%BD%91%E4%B8%8B%E8%BD%BD%E5%BA%93" rel="nofollow">1、1 MySQL官网下载库</a></p> 
 <p id="1%E3%80%812%20%E5%AE%89%E8%A3%85%E5%AF%B9%E5%BA%94%E5%BC%80%E5%8F%91%E5%BA%93-toc" style="margin-left:40px;"><a href="#1%E3%80%812%20%E5%AE%89%E8%A3%85%E5%AF%B9%E5%BA%94%E5%BC%80%E5%8F%91%E5%BA%93" rel="nofollow">1、2 安装对应开发库</a></p> 
 <p id="%E4%BA%8C%E3%80%81MySQL%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81MySQL%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D" rel="nofollow">二、MySQL接口介绍</a></p> 
 <p id="2%E3%80%811%20%E5%88%9B%E5%BB%BA%E5%92%8C%E9%87%8A%E6%94%BE%20MYSQL%20%E5%AF%B9%E8%B1%A1-toc" style="margin-left:40px;"><a href="#2%E3%80%811%20%E5%88%9B%E5%BB%BA%E5%92%8C%E9%87%8A%E6%94%BE%20MYSQL%20%E5%AF%B9%E8%B1%A1" rel="nofollow">2、1 创建和释放 MYSQL 对象</a></p> 
 <p id="2%E3%80%812%20%E8%BF%9E%E6%8E%A5mysql-toc" style="margin-left:40px;"><a href="#2%E3%80%812%20%E8%BF%9E%E6%8E%A5mysql" rel="nofollow">2、2 连接mysql</a></p> 
 <p id="2%E3%80%813%20%E5%8F%91%E9%80%81sql%E8%AF%AD%E5%8F%A5-toc" style="margin-left:40px;"><a href="#2%E3%80%813%20%E5%8F%91%E9%80%81sql%E8%AF%AD%E5%8F%A5" rel="nofollow">2、3 发送sql语句</a></p> 
 <hr id="hr-toc"> 
 <p><span style="color:#fe2c24;"><strong>🙋‍♂️ 作者：@Ggggggtm 🙋‍♂️</strong></span></p> 
 <p><span style="color:#fe2c24;"><strong>👀 专栏：MySQL  👀</strong></span></p> 
 <p><span style="color:#fe2c24;"><strong>💥 标题：C/C++ 连接访问 MySQL💥</strong></span></p> 
 <p><span style="color:#fe2c24;"><strong> ❣️ 寄语：与其忙着诉苦，不如低头赶路，奋路前行，终将遇到一番好风景 ❣️</strong> </span></p> 
</blockquote> 
<h2 id="%E4%B8%80%E3%80%81%E8%BF%9E%E6%8E%A5MySQL">一、连接MySQL</h2> 
<h3 id="1%E3%80%811%20MySQL%E5%AE%98%E7%BD%91%E4%B8%8B%E8%BD%BD%E5%BA%93">1、1 MySQL官网下载库</h3> 
<blockquote> 
 <p>  <span style="color:#333333;">要使用</span><span style="color:#333333;">C</span><span style="color:#333333;">语言连接</span><span style="color:#333333;">mysql</span><span style="color:#333333;">，需要使用</span><span style="color:#333333;">mysql官网提供的库。MySQL官网：</span><a href="https://www.mysql.com/cn/" rel="nofollow" title="MySQL">MySQL</a>。如下图：</p> 
 <p><img alt="" height="990" src="https://images2.imgbox.com/2d/49/pc1Be8O8_o.png" width="1200"></p> 
 <p>  然后点击DOWNLOADS，如下图：</p> 
 <p><img alt="" height="647" src="https://images2.imgbox.com/eb/09/mFmaQLr8_o.png" width="1200"></p> 
 <p>  往下寻找MySQL Community Downloads，如下图：</p> 
 <p><img alt="" height="848" src="https://images2.imgbox.com/7b/12/YvflKr6Y_o.png" width="1200"></p> 
 <p>  因为我们使用C语言连接MySQL，所以查找C API，如下图：</p> 
 <p><img alt="" height="624" src="https://images2.imgbox.com/18/08/9NmFNoWG_o.png" width="1084"></p> 
 <p>  然后点击如下图：</p> 
 <p><img alt="" height="477" src="https://images2.imgbox.com/05/8a/KqgTxMkS_o.png" width="862"></p> 
</blockquote> 
<blockquote> 
 <p>  我个人所用的是Linux，所以选择Linux的安装包。可根据自己的环境进行选择，如下图：</p> 
 <p><img alt="" height="659" src="https://images2.imgbox.com/ea/80/j8dCuLLM_o.png" width="1133"></p> 
 <p>  再次选择OS合适的版本，如下图：</p> 
 <p><img alt="" height="465" src="https://images2.imgbox.com/2e/9e/SnhkXDp2_o.png" width="1081"></p> 
 <p>  当我们下载后，采用rz -E的方法可将压缩包传输到我们的Linux上。然后再使用 tar -xzf进行解压即可。解压后我们再看其中的文件，如下图：</p> 
 <p><img alt="" height="261" src="https://images2.imgbox.com/99/91/xJOr1BAx_o.png" width="790"></p> 
 <p>  其中对我们有用的就是头文件和库函数了。具体怎么进行使用该头文件和库函数，可以参照文章：<a href="https://blog.csdn.net/weixin_67596609/article/details/132334838" title="动静态库的原理与制作详解">动静态库的原理与制作详解</a>。这里就不再过多解释。</p> 
 <p>  但是我们也不建议使用以上方法，因为其中可能会产生兼容性等问题。我们接着往下看。</p> 
</blockquote> 
<h3 id="1%E3%80%812%20%E5%AE%89%E8%A3%85%E5%AF%B9%E5%BA%94%E5%BC%80%E5%8F%91%E5%BA%93">1、2 安装对应开发库</h3> 
<blockquote> 
 <p>  当我们再Linux安装了mysql的开发环境时，就会自动给我们安装对应的语言连接mysql 的头文件与库函数。我们可以进行查看。具体查看方法如下：</p> 
 <ol><li>查看头文件：<img alt="" height="273" src="https://images2.imgbox.com/a2/1a/oFYGi19F_o.png" width="1200"></li><li>查看对应的库：<img alt="" height="149" src="https://images2.imgbox.com/cb/72/9y7zmNY0_o.png" width="1200"></li></ol> 
 <p>  如果上述都能够查看到，证明就已经安装了对应的开发库。一般情况下都是有的，如果没有的话，可以进行自己安装，如下图：</p> 
 <p><img alt="" height="477" src="https://images2.imgbox.com/ff/ac/WScs6U2a_o.png" width="1200"></p> 
 <p>  我这里已经安装过了，所以最后显示的是Nothing to do。下面我们来验证一下看是否安装成功。代码如下：</p> 
 <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;mysql/mysql.h&gt;

int main()
{
    printf("mysql client Version: %s\n", mysql_get_client_info());
    return 0;
}</code></pre> 
 <p>  运行结果如下图：</p> 
 <p><img alt="" height="157" src="https://images2.imgbox.com/74/1a/BS1qt7GG_o.png" width="541"></p> 
 <p>  到这里就证明已经安装成功对应的开发库了，且可以正常使用了。这里再说明一下：</p> 
 <ul><li>我们再包含头文件时，只需要包含mysql.h即可。但是需要添加上对应的mysql/mysql.h。因为g++编译器只会去include路径下寻找，而我们的头文件在include路径下的mysql文件夹中。</li><li>mysql_get_client_info()函数就是过去自身版本信息的一个函数。</li><li>我们在使用g++进行编译时，还需要指明对应的库文件的搜索路径和所使用的库名称。g++编译器在编译时，只会寻找C++相关的库和系统自带的库。而我们自己安装的需要指明库的搜索路径和所用到的库名称。简单理解，就是告诉g++，我们所用到的库的路径。代码如下： <pre><code class="language-bash">g++ -o mytest mytest.cc -std=c++11 -L /lib64/mysql -lmysqlclient</code></pre> </li></ul> 
</blockquote> 
<h2 id="%E4%BA%8C%E3%80%81MySQL%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D">二、MySQL接口介绍</h2> 
<h3 id="2%E3%80%811%20%E5%88%9B%E5%BB%BA%E5%92%8C%E9%87%8A%E6%94%BE%20MYSQL%20%E5%AF%B9%E8%B1%A1">2、1 创建和释放 MYSQL 对象</h3> 
<blockquote> 
 <p>  函数原型：</p> 
 <pre><code class="language-cpp">MYSQL *mysql_init(MYSQL *mysql)
</code></pre> 
 <p>  <strong>该函数接受一个MYSQL类型的指针作为参数，一般我们都设置为NULL</strong>。<strong>并返回一个MYSQL类型的指针，这个指针指向初始化后的MySQL连接句柄</strong>。</p> 
 <p>  具体来说，mysql_init()函数完成以下几个任务：</p> 
 <ol><li> <p>分配内存空间：它会为MYSQL结构体类型的变量分配足够的内存空间。MYSQL结构体包含了与MySQL服务器通信所需的各种信息和状态。</p> </li><li> <p>初始化结构体成员：它会将MYSQL结构体中的各个成员初始化为默认值。这些成员包括连接属性、错误信息等。</p> </li><li> <p>返回连接句柄：它会返回指向初始化后的MYSQL结构体的指针，我们可以将这个指针保存下来，在后续的MySQL操作中使用。</p> </li></ol> 
 <p>  MYSQL结构体中包含了众多属性信息，具体如下：</p> 
 <pre><code class="language-cpp">typedef struct st_mysql {
	NET net;			/* Communication parameters */
    unsigned char	*connector_fd;		/* ConnectorFd for SSL */
    char *host,*user,*passwd,*unix_socket,*server_version,*host_info;
    char *info, *db;
    struct charset_info_st *charset;
    MYSQL_FIELD	*fields;
    MEM_ROOT field_alloc;
    my_ulonglong affected_rows;
    my_ulonglong insert_id;		/* id if insert on table with NEXTNR */
    my_ulonglong extra_info;		/* Not used */
    unsigned long thread_id;		/* Id for connection in server */
    unsigned long packet_length;
    unsigned int port;
    unsigned long client_flag,server_capabilities;
    unsigned int protocol_version;
    unsigned int field_count;
    unsigned int server_status;
    unsigned int server_language;
    unsigned int warning_count;
    struct st_mysql_options options;
    enum mysql_status status;
    my_bool	free_me;		/* If free in mysql_close */
    my_bool	reconnect;		/* set to 1 if automatic reconnect */

    /* session-wide random string */
    char scramble[SCRAMBLE_LENGTH+1];
    my_bool unused1;
    void *unused2, *unused3, *unused4, *unused5;

    LIST *stmts;                     /* list of all statements */
    const struct st_mysql_methods *methods;
    void *thd;
    /*
      Points to boolean flag in MYSQL_RES  or MYSQL_STMT. We set this flag
      from mysql_stmt_close if close had to cancel result set of this object.
    */
    my_bool *unbuffered_fetch_owner;
    /* needed for embedded server - no net buffer to store the 'info' */
    char *info_buffer;
    void *extension;
} MYSQL;
</code></pre> 
 <p>  需要注意的是，mysql_init()函数不会创建实际的连接；只是初始化了一个连接句柄，我们还需要通过其他函数（如mysql_real_connect()）来建立与MySQL服务器的实际连接。后续会详细解释。</p> 
</blockquote> 
<blockquote> 
 <p>  在<strong>连接使用完成后，我们还需要通过mysql_close()函数关闭连接并释放内存</strong>。函数原型如下：</p> 
 <pre><code class="language-cpp">void mysql_close(MYSQL *connection);
</code></pre> 
 <p>参数：</p> 
 <ul><li>connection：指向一个已经打开的<code>MYSQL</code>对象的指针。该对象代表与MySQL服务器的连接。</li></ul> 
 <p>  该函数没有返回值。注意事项：</p> 
 <ol><li>在调用mysql_close之前，确保已经完成了与数据库的所有操作，包括查询和事务等。</li><li>关闭连接后，将无法再使用该连接对象执行任何操作，除非重新使用mysql_real_connect建立新的连接。</li><li>对于多个线程同时共享一个连接对象的情况，应该确保在多个线程之间正确地协调和同步连接的打开和关闭操作，以避免出现竞态条件和意外错误。</li></ol> 
</blockquote> 
<h3 id="2%E3%80%812%20%E8%BF%9E%E6%8E%A5mysql">2、2 连接mysql</h3> 
<blockquote> 
 <p><span style="color:#494949;">  初始化完毕之后，必须先链接数据库，在进行后续操作。（mysql网络部分是基于TCP/IP的） </span></p> 
 <p><span style="color:#494949;">  <strong>函数原型：</strong></span></p> 
 <pre><code class="language-cpp">MYSQL *mysql_real_connect(MYSQL *mysql, const char *host,
    const char *user,
    const char *passwd,
    const char *db,
    unsigned int port,
    const char *unix_socket,
    unsigned long clientflag);</code></pre> 
 <p> <strong> 参数说明：</strong></p> 
 <ul><li><code>mysql</code>：一个预先分配和初始化的MYSQL对象指针。该指针用于保存与MySQL服务器的连接相关信息。</li><li><code>host</code>：MySQL服务器的主机名或IP地址。</li><li><code>user</code>：连接MySQL服务器所使用的用户名。</li><li><code>passwd</code>：连接MySQL服务器所使用的密码。</li><li><code>db</code>：连接成功后要使用的默认数据库名。</li><li><code>port</code>：MySQL服务器的端口号。</li><li><code>unix_socket</code>：Unix域套接字路径，用于本地连接Unix系统上的MySQL服务器，一般情况都属设置为nullptr。</li><li><code>client_flag</code>：客户端标志位，用于指定连接选项。</li></ul> 
 <p>  <strong>返回值：</strong></p> 
 <ul><li>连接成功时，返回一个新的MYSQL对象指针，该对象与第一个参数的值相同，用于后续的MySQL操作。</li><li>连接失败时，返回NULL，并通过调用mysql_errno()和mysql_error()函数获取错误代码和错误信息。</li></ul> 
 <p><strong>  使用mysql_real_connect函数，可以实现以下功能：</strong></p> 
 <ol><li>与MySQL服务器建立起连接。</li><li>指定要连接的数据库。</li></ol> 
</blockquote> 
<blockquote> 
 <p>  接下来我们就来看一个实际的连接mysql的例子，代码如下： </p> 
 <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;mysql/mysql.h&gt;

using namespace std;

const string Host = "127.0.0.1";
const string User = "gtm";
const string Passwd = "123654";
const string Db = "test";
unsigned int Port = 3306;

int main()
{
    MYSQL* my = mysql_init(NULL);
    if(my == nullptr)
    {
        cerr &lt;&lt; "mysql init error!" &lt;&lt; endl;
        exit(1);
    }
    cout &lt;&lt; "mysql init success!" &lt;&lt; endl;

    if(mysql_real_connect(my, Host.c_str(), User.c_str(), Passwd.c_str(), Db.c_str(), Port, nullptr, 0) ==nullptr)
    {
        cerr &lt;&lt; "mysql connect error!" &lt;&lt; endl;
        exit(2);
    }
    cout &lt;&lt; "mysql connect success!" &lt;&lt; endl;

    mysql_close(my);
    cout &lt;&lt; "mysql close success!" &lt;&lt; endl;    
    return 0;
}
</code></pre> 
 <p>  我们来看一下运行结果，如下图：</p> 
 <p><img alt="" height="295" src="https://images2.imgbox.com/a4/aa/6kaOqOYd_o.png" width="807"></p> 
</blockquote> 
<h3 id="2%E3%80%813%20%E5%8F%91%E9%80%81sql%E8%AF%AD%E5%8F%A5" style="background-color:transparent;">2、3 发送sql语句</h3> 
<blockquote> 
 <p>  前面都是准备工作，现在我们可以向mysql发送sql指令了。函数原型：</p> 
 <pre><code class="language-cpp">int mysql_query(MYSQL *mysql, const char *query)</code></pre> 
 <p>  该函数接受两个参数：一个是MYSQL结构体指针，代表与MySQL服务器的连接；另一个是一个字符串指针，代表要执行的SQL查询语句。</p> 
 <p>  函数返回一个整数值，用于表示查询执行的结果。如果执行成功，返回0；如果执行失败，返回非零值，表示出错的类型。在执行过程中，可以通过调用mysql_error()函数获取错误信息。</p> 
 <p>  稍微总结一下，使用mysql_query()函数执行SQL查询的一般步骤如下：</p> 
 <ol><li> <p>建立与MySQL服务器的连接，可以使用mysql_init()函数初始化一个MYSQL结构体，并通过mysql_real_connect()函数建立连接。</p> </li><li> <p>构造要执行的SQL语句，以字符串形式传递给mysql_query()函数。</p> </li><li> <p>调用mysql_query()函数执行SQL语句。</p> </li><li> <p>根据返回值判断查询执行结果，如果返回0，则表示执行成功；如果返回非零值，则表示执行失败。</p> </li></ol> 
 <p>  我们现在查看一下gtm用户下test数据库中都有哪些表，如下图：</p> 
 <p><img alt="" height="300" src="https://images2.imgbox.com/94/da/c8uuVWFf_o.png" width="271"></p> 
 <p>  test库正式我们所连接的库。我们现在通过mysql_query函数向t1表中插入数据，我们先来看一下t1表中现有的数据，如下图：</p> 
 <p><img alt="" height="300" src="https://images2.imgbox.com/90/a5/vDGzEkpW_o.png" width="368"></p> 
 <p>  我们再来插入数据，代码如下：</p> 
 <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;string&gt;
#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;mysql/mysql.h&gt;

using namespace std;

const string Host = "127.0.0.1";
const string User = "gtm";
const string Passwd = "gao520918";
const string Db = "test";
unsigned int Port = 3306;

int main()
{
    MYSQL* my = mysql_init(NULL);
    if(my == nullptr)
    {
        cerr &lt;&lt; "mysql init error!" &lt;&lt; endl;
        exit(1);
    }
    cout &lt;&lt; "mysql init success!" &lt;&lt; endl;
    if(mysql_real_connect(my, Host.c_str(), User.c_str(), Passwd.c_str(), Db.c_str(), Port, nullptr, 0) ==nullptr)
    {
        cerr &lt;&lt; "mysql connect error!" &lt;&lt; endl;
        exit(2);
    }
    cout &lt;&lt; "mysql connect success!" &lt;&lt; endl;
    const char* sql = "insert into t1 values(18,'xiaogao','男')";
    int n = mysql_query(my, sql);
    if(n != 0)
    {
        cout &lt;&lt; "mysql query error!" &lt;&lt; endl;
        exit(3);
    }
    cout &lt;&lt; "mysql query success!" &lt;&lt; endl;
    mysql_close(my);
    cout &lt;&lt; "mysql close success!" &lt;&lt; endl;    
    return 0;
}
</code></pre> 
 <p>  我们再来看插入的结果，如下图：</p> 
 <p><img alt="" height="110" src="https://images2.imgbox.com/c3/d7/Mn59T5WF_o.png" width="601"></p> 
 <p>  通过上图可以看到，连接成功了但是下达指令失败了。我们检查了语法并没有错误，那是什么原因呢？注意：我们使用的语言插入数据时，还需要设置客户端与服务器之间的字符集。设置字符集函数原型如下：</p> 
 <pre><code class="language-cpp">int mysql_set_character_set(MYSQL *mysql, const char *charset)</code></pre> 
 <p>参数说明：</p> 
 <ul><li><code>mysql</code>：已初始化的MYSQL结构体指针，表示与MySQL服务器的连接。</li><li><code>charset</code>：一个字符串，表示要设置的字符集名称。</li></ul> 
 <p>返回值：</p> 
 <ul><li>设置成功返回0，否则返回非零值。</li></ul> 
 <p>  我们知道，远端的mysql的字符集时utf8，那么在来接成功后设置一下字符集即可。代码如下：</p> 
 <pre><code class="language-cpp">mysql_set_character_set(my, "utf8");</code></pre> 
 <p>  我们再次进行插入，如下图：</p> 
 <p><img alt="" height="151" src="https://images2.imgbox.com/0e/b6/CfZogYkE_o.png" width="565"></p> 
 <p>  我们看到，现在就可以插入成功了。再看一下数据是否插入到对应的表中，如下图：</p> 
 <p><img alt="" height="300" src="https://images2.imgbox.com/db/bc/0YuAW0Hk_o.png" width="385"></p> 
 <p>  其实删除和更新的sql语句都与插入语句相同，直接以字符串形式传递给mysql_query()函数。但是我们想查询呢？同时还需要获取查询结果该怎么办呢？</p> 
</blockquote> 
<blockquote> 
 <p>  mysql_store_result 函数用于将查询结果保存在一个客户端可访问的缓冲区中。它用于处理从数据库中检索的结果集。函数原型如下：</p> 
 <pre><code class="language-cpp">MYSQL_RES* mysql_store_result(MYSQL *mysql);</code></pre> 
 <p>  <strong>参数说明：</strong></p> 
 <ul><li><code>mysql</code>：一个指向MYSQL结构体的指针，表示与MySQL服务器的连接。</li></ul> 
 <p> <strong> 返回值：</strong></p> 
 <ul><li>成功时，返回一个指向MYSQL_RES结构体的指针，表示查询结果集。</li><li>失败时，返回NULL。</li></ul> 
 <p>  使用mysql_store_result函数的具体步骤如下：</p> 
 <ol><li>在执行查询语句后，调用mysql_store_result函数来获取查询结果集。</li><li>判断返回值是否为NULL，如果为NULL，则表示查询出错。</li><li>通过返回的MYSQL_RES指针，可以使用其他函数来获取和处理结果集的数据。</li></ol> 
 <p>  MYSQL_RES变量中保存了查询得到的各种信息，其类型定义如下：</p> 
 <pre><code class="language-cpp">typedef struct st_mysql_res {
	my_ulonglong  row_count;
	MYSQL_FIELD	*fields;
	MYSQL_DATA	*data;
	MYSQL_ROWS	*data_cursor;
	unsigned long *lengths;		/* column lengths of current row */
	MYSQL		*handle;		/* for unbuffered reads */
    const struct st_mysql_methods *methods;
    MYSQL_ROW	row;			/* If unbuffered read */
    MYSQL_ROW	current_row;		/* buffer to current row */
    MEM_ROOT	field_alloc;
    unsigned int	field_count, current_field;
    my_bool	eof;			/* Used by mysql_fetch_row */
    /* mysql_stmt_close() had to cancel this result */
    my_bool       unbuffered_fetch_cancelled;
    void *extension;
} MYSQL_RES;
</code></pre> 
 <p>  我们知道查询的结果会保存在MYSQL_RES变量中，但是怎么提取其中的数据呢？我们知道在MySQL中查询的结果是一张二维表，如下图：</p> 
 <p><img alt="" height="300" src="https://images2.imgbox.com/d9/5c/uqjZZvaB_o.png" width="398"></p> 
 <p>  那么我们首先要做的就是获取表中数据的行数和列数。其函数原型如下：</p> 
 <pre><code class="language-cpp">//获取查询结果的行数
my_ulonglong mysql_num_rows(MYSQL_RES *res);

//获取查询结果的列数
unsigned int mysql_num_fields(MYSQL_RES *res);</code></pre> 
 <ul><li>  mysql_num_fields函数是一个用于获取结果集中字段（列）的数量的MySQL函数。它的作用是返回一个结果集中字段的数量，可以用于确定查询结果集中有多少列。</li><li>  mysql_num_fields函数的返回值是一个整数，表示结果集中的字段数量。如果发生错误或结果集为空，则返回0。</li><li>  mysql_num_rows函数是一个用于获取结果集中行的数量的MySQL函数。它的作用是返回一个结果集中行的数量，可以用于确定查询结果集中有多少行数据。</li><li>  mysql_num_rows函数的返回值是一个整数，表示结果集中的行数量。如果发生错误或结果集为空，则返回0。</li></ul> 
 <p>  这两个函数的参数均是mysql_store_result 函数的返回值。也就是我们所获取的查询结果集。只有行数和列数不够，我们还需要能够获取其中的内容，我们再来看一个函数，函数原型如下：</p> 
 <pre><code class="language-cpp">MYSQL_ROW mysql_fetch_row(MYSQL_RES *result);</code></pre> 
 <p>参数解释：</p> 
 <ul><li><code>result</code>：<code>MYSQL_RES</code> 结构体指针，表示查询结果集。</li></ul> 
 <p>返回值：</p> 
 <ul><li><code>MYSQL_ROW</code>：结果集中下一行的数据，以字符串数组的形式返回。如果已经读取完所有行，则返回NULL。</li></ul> 
 <p>  实际上MYSQL_ROW就是一个char**的类型，其类型定义如下：</p> 
 <pre><code class="language-cpp">typedef char **MYSQL_ROW;		/* return data as array of strings */</code></pre> 
 <p>  mysql_fetch_row函数也很像迭代器，当我们查找一行数据后，mysql_fetch_row会自动的向后移动一行，并不需要使用者自己去操作关心。接下来我们看一个查询的实例，具体代码如下：</p> 
 <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;cstdlib&gt;
#include &lt;string&gt;
#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;mysql/mysql.h&gt;

using namespace std;

const string Host = "127.0.0.1";
const string User = "gtm";
const string Passwd = "gao520918";
const string Db = "test";
unsigned int Port = 3306;

int main()
{
    MYSQL* my = mysql_init(NULL);
    if(my == nullptr)
    {
        cerr &lt;&lt; "mysql init error!" &lt;&lt; endl;
        exit(1);
    }
    cout &lt;&lt; "mysql init success!" &lt;&lt; endl;
    if(mysql_real_connect(my, Host.c_str(), User.c_str(), Passwd.c_str(), Db.c_str(), Port, nullptr, 0) ==nullptr)
    {
        cerr &lt;&lt; "mysql connect error!" &lt;&lt; endl;
        exit(2);
    }
    cout &lt;&lt; "mysql connect success!" &lt;&lt; endl;
    mysql_set_character_set(my, "utf8");
    const char* sql = "select * from t1";
    int n = mysql_query(my, sql);

    int n = mysql_query(my, sql);
    if(n != 0)
    {
        cout &lt;&lt; "mysql query error!" &lt;&lt; endl;
        exit(3);
    }
    cout &lt;&lt; "mysql query success!" &lt;&lt; endl;

    MYSQL_RES* res = mysql_store_result(my);
    int row = mysql_num_rows(res);
    int col = mysql_num_fields(res);

    for(int i = 0; i &lt; row; i++)
    {
        MYSQL_ROW line = mysql_fetch_row(res);
        for(int j = 0; j &lt; col; j++)
        {
            cout &lt;&lt; line[j] &lt;&lt; "\t";
        }
        cout &lt;&lt; endl;
    }
    mysql_free_result(res);
    mysql_close(my);
    cout &lt;&lt; "mysql close success!" &lt;&lt; endl;    
    return 0;
}</code></pre> 
 <p>  运行结果如下图：</p> 
 <p><img alt="" height="300" src="https://images2.imgbox.com/fe/98/vqZQPd9S_o.png" width="498"></p> 
 <p>  但是上述获取行信息中，并没有获取到列的名字。看起来并不完整，我们在看如下函数：</p> 
 <pre><code class="language-cpp">MYSQL_FIELD* mysql_fetch_fields(MYSQL_RES *res);</code></pre> 
 <p> 参数：</p> 
 <ul><li><code>res</code>：一个指向MYSQL_RES类型的结果集指针。该结果集通常通过调用<code>mysql_store_result()</code>或<code>mysql_use_result()</code>函数从MySQL服务器获得。</li></ul> 
 <p>  返回值：</p> 
 <ul><li>如果成功，返回一个指向MYSQL_FIELD结构体数组的指针，其中每个元素代表结果集的一个字段。</li><li>如果失败，返回NULL。</li></ul> 
 <p>  mysql_fetch_fields函数返回一个指向MYSQL_FIELD结构体数组的指针。MYSQL_FIELD结构体包含每个列相关字段的详细信息，如字段名、字段类型、字段长度等。结构体具体内容如下：</p> 
 <pre><code class="language-cpp">typedef struct st_mysql_field {
	char *name;                 /* Name of column */
	char *org_name;             /* Original column name, if an alias */
	char *table;                /* Table of column if column was a field */
	char *org_table;            /* Org table name, if table was an alias */
	char *db;                   /* Database for table */
	char *catalog;	      /* Catalog for table */
	char *def;                  /* Default value (set by mysql_list_fields) */
	unsigned long length;       /* Width of column (create length) */
	unsigned long max_length;   /* Max width for selected set */
	unsigned int name_length;
	unsigned int org_name_length;
	unsigned int table_length;
	unsigned int org_table_length;
	unsigned int db_length;
	unsigned int catalog_length;
	unsigned int def_length;
	unsigned int flags;         /* Div flags */
	unsigned int decimals;      /* Number of decimals in field */
	unsigned int charsetnr;     /* Character set */
	enum enum_field_types type; /* Type of field. See mysql_com.h for types */
	void *extension;
} MYSQL_FIELD;
</code></pre> 
 <p>  其用法也相当简单，我们获取到了列数，那么就可以直接打印即可，用法如下：</p> 
 <pre><code class="language-cpp">    MYSQL_FIELD* fields = mysql_fetch_fields(res);
    for(int i = 0; i &lt; col; i++)
    {
        cout &lt;&lt; fields[i].name &lt;&lt; "\t\t";
    }
    cout &lt;&lt; endl;</code></pre> 
 <p>  我们再来看一下运行结果，如下图;</p> 
 <p><img alt="" height="406" src="https://images2.imgbox.com/db/50/LcjbLz7h_o.png" width="645"></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a636c249c72fc064761f1de231733cd6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">中汽研实习面试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cdb08808a58898e6d9e7917bba4f72f9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【K8S in Action】服务：让客户端发现pod 并与之通信（2）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>