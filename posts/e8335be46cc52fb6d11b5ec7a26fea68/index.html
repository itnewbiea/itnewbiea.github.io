<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>prism RegionContext（区域上下文） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="prism RegionContext（区域上下文）" />
<meta property="og:description" content="1 按照《prism项目搭建》搭建prism项目
2 新建用户控件库ModuleA，并为其创建Views，ViewModels，Model目录
3 在Model里面新建类
using Prism.Mvvm; using System; using System.Collections.Generic; using System.Linq; using System.Text; using System.Threading.Tasks; namespace ModuleA.Model { public class Person:BindableBase { private string _firstName; public string FirstName { get { return _firstName; } set { _firstName = value; SetProperty(ref _firstName, value); } } private string _lastName; public string LastName { get { return _lastName; } set { _lastName = value; SetProperty(ref _lastName, value); } } private int _age; public int Age { get { return _age; } set { _age = value; SetProperty(ref _age, value); } } public override string ToString() { return String." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e8335be46cc52fb6d11b5ec7a26fea68/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-31T07:09:42+08:00" />
<meta property="article:modified_time" content="2021-10-31T07:09:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">prism RegionContext（区域上下文）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1 按照《prism项目搭建》搭建prism项目</p> 
<p>2 新建用户控件库ModuleA，并为其创建Views，ViewModels，Model目录</p> 
<p>3 在Model里面新建类</p> 
<pre><code>using Prism.Mvvm;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ModuleA.Model
{
    public class Person:BindableBase
    {

        private string _firstName;
        public string FirstName
        {
            get { return _firstName; }
            set
            {
                _firstName = value;
                SetProperty(ref _firstName, value);
            }
        }

        private string _lastName;
        public string LastName
        {
            get { return _lastName; }
            set
            {
                _lastName = value;
                SetProperty(ref _lastName, value);
            }
        }

        private int _age;
        public int Age
        {
            get { return _age; }
            set
            {
                _age = value;
                SetProperty(ref _age, value);
            }
        }

        public override string ToString()
        {
            return String.Format("{0}, {1}", LastName, FirstName);
        }

    }
}
</code></pre> 
<p>4 在Views里面创建PersonListView，PersonDetailView用户控件，在PersonListView定义Region的同时，将RegionContext绑定到ListBox的SelectedItem属性</p> 
<pre><code>&lt;UserControl x:Class="ModuleA.Views.PersonListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ModuleA.Views"
             xmlns:prism="http://prismlibrary.com/"
             prism:ViewModelLocator.AutoWireViewModel="True"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"&gt;
    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height="100" /&gt;
            &lt;RowDefinition /&gt;
        &lt;/Grid.RowDefinitions&gt;
        &lt;ListBox x:Name="lstOfPerson" ItemsSource="{Binding LstPerson}"/&gt;
        &lt;ContentControl Grid.Row="1" prism:RegionManager.RegionName="DetailRegion" 
                        prism:RegionManager.RegionContext="{Binding SelectedItem, ElementName=lstOfPerson}"/&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;
</code></pre> 
<pre><code>&lt;UserControl x:Class="ModuleA.Views.PersonDetailView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ModuleA.Views"
             xmlns:prism="http://prismlibrary.com/"
             prism:ViewModelLocator.AutoWireViewModel="True"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="800"&gt;
    &lt;Grid x:Name="LayoutRoot" Background="White"&gt;
        &lt;Grid.ColumnDefinitions&gt;
            &lt;ColumnDefinition Width="Auto"/&gt;
            &lt;ColumnDefinition /&gt;
        &lt;/Grid.ColumnDefinitions&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height="Auto"/&gt;
            &lt;RowDefinition Height="Auto"/&gt;
            &lt;RowDefinition Height="Auto"/&gt;
        &lt;/Grid.RowDefinitions&gt;

        &lt;!-- First Name --&gt;
        &lt;TextBlock Text="First Name:" Margin="5" /&gt;
        &lt;TextBlock Grid.Column="1" Margin="5" Text="{Binding SelectedPerson.FirstName}" /&gt;

        &lt;!-- Last Name --&gt;
        &lt;TextBlock Grid.Row="1" Text="Last Name:" Margin="5" /&gt;
        &lt;TextBlock Grid.Row="1" Grid.Column="1"  Margin="5" Text="{Binding SelectedPerson.LastName}" /&gt;

        &lt;!-- Age --&gt;
        &lt;TextBlock Grid.Row="2" Text="Age:" Margin="5"/&gt;
        &lt;TextBlock Grid.Row="2" Grid.Column="1"  Margin="5" Text="{Binding SelectedPerson.Age}"/&gt;
    &lt;/Grid&gt;
&lt;/UserControl&gt;
</code></pre> 
<p>5 在ViewModels目录里面新建PersonListViewModel，PersonDetailViewModel</p> 
<pre><code>using ModuleA.Model;
using Prism.Mvvm;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ModuleA.ViewModels
{
    public class PersonListViewModel:BindableBase
    {
        private ObservableCollection&lt;Person&gt; _lstPerson = new ObservableCollection&lt;Person&gt;();


        public ObservableCollection&lt;Person&gt; LstPerson
        {
            get { return _lstPerson; }
            set { SetProperty(ref _lstPerson, value); }
        
        }

        public PersonListViewModel()
        {
            for (int i = 0; i &lt; 10; i++)
            {
                _lstPerson.Add(new Person()
                {
                    FirstName = String.Format("First {0}", i),
                    LastName = String.Format("Last {0}", i),
                    Age = i
                });
            }
        }

    }
}
</code></pre> 
<pre><code>using ModuleA.Model;
using Prism.Mvvm;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ModuleA.ViewModels
{
    public class PersonDetailViewModel:BindableBase
    {

        private Person _selectedPerson = new Person();

        public Person SelectedPerson
        {
            get { return _selectedPerson; }
            set { SetProperty(ref _selectedPerson, value); }
        }

    }
}
</code></pre> 
<p>7 在ModuleA中新建类ModuleAEntity，并将View注册到对应的Region</p> 
<pre><code>using ModuleA.Views;
using Prism.Ioc;
using Prism.Modularity;
using Prism.Regions;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace ModuleA
{
    public class ModuleAEntity : IModule
    {
        public void OnInitialized(IContainerProvider containerProvider)
        {
            var regionManager = containerProvider.Resolve&lt;IRegionManager&gt;();
            regionManager.RegisterViewWithRegion("ContentRegion", typeof(PersonListView));
            regionManager.RegisterViewWithRegion("DetailRegion", typeof(PersonDetailView));
        }

        public void RegisterTypes(IContainerRegistry containerRegistry)
        {
            
        }
    }
}
</code></pre> 
<p>8 在App里面添加Module</p> 
<pre><code> protected override void ConfigureModuleCatalog(IModuleCatalog moduleCatalog)
        {
            moduleCatalog.AddModule&lt;ModuleAEntity&gt;();
        }</code></pre> 
<p>9 此时运行发现选定LstBox的项时，DetailView没有变化</p> 
<p>10 此时需要修改PersonDetailView代码，监控DataContext的变化</p> 
<pre><code>using ModuleA.Model;
using ModuleA.ViewModels;
using Prism.Common;
using Prism.Regions;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Data;
using System.Windows.Documents;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using System.Windows.Navigation;
using System.Windows.Shapes;

namespace ModuleA.Views
{
    /// &lt;summary&gt;
    /// PersonDetailView.xaml 的交互逻辑
    /// &lt;/summary&gt;
    public partial class PersonDetailView : UserControl
    {
        public PersonDetailView()
        {
            InitializeComponent();
            RegionContext.GetObservableContext(this).PropertyChanged += PersonDetailView_PropertyChanged;
        }

        private void PersonDetailView_PropertyChanged(object sender, System.ComponentModel.PropertyChangedEventArgs e)
        {
            var context = (ObservableObject&lt;object&gt;)sender;
            var selectedPerson = (Person)context.Value;
            (DataContext as PersonDetailViewModel).SelectedPerson = selectedPerson;
        }
    }
}
</code></pre> 
<p>11 运行 </p> 
<p><img alt="" height="450" src="https://images2.imgbox.com/32/a0/2KQCjrWA_o.png" width="800"></p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5f373a02d6887bb284995b9d8cb73f50/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Debian11 安装Chromium浏览器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e18ca3b2dedd9382443b3815413eeb65/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">10个有用的css编辑网站</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>