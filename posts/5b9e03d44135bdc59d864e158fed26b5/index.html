<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>改写jtopo滚轮缩放代码 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="改写jtopo滚轮缩放代码" />
<meta property="og:description" content="问题 原生的jtopo滚轮缩放在mac上用触控板触发时，会出现疯狂缩放的现象，同时还会触发浏览器的默认事件（页面前进、页面后退） 参考 地址：https://adom.as/javascript-mouse-wheel/
/** This is high-level function. * It must react to delta being more/less than zero. */ function handle(delta) { if (delta &lt; 0) …; else …; } /** Event handler for mouse wheel event. */ function wheel(event){ var delta = 0; if (!event) /* For IE. */ event = window.event; if (event.wheelDelta) { /* IE/Opera. */ delta = event.wheelDelta/120; } else if (event.detail) { /** Mozilla case." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5b9e03d44135bdc59d864e158fed26b5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-11-15T11:53:08+08:00" />
<meta property="article:modified_time" content="2017-11-15T11:53:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">改写jtopo滚轮缩放代码</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5 id="问题">问题</h5> 
<pre><code>原生的jtopo滚轮缩放在mac上用触控板触发时，会出现疯狂缩放的现象，同时还会触发浏览器的默认事件（页面前进、页面后退）
</code></pre> 
<h5 id="参考">参考</h5> 
<p>地址：<a href="https://adom.as/javascript-mouse-wheel/" rel="nofollow noopener noreferrer" target="_blank">https://adom.as/javascript-mouse-wheel/</a></p> 
<pre class="prettyprint"><code class=" hljs scala"><span class="hljs-javadoc">/** This is high-level function.
 * It must react to delta being more/less than zero.
 */</span>
function handle(delta) {
        <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>)
        …;
        <span class="hljs-keyword">else</span>
        …;
}

<span class="hljs-javadoc">/** Event handler for mouse wheel event.
 */</span>
function wheel(event){
        <span class="hljs-keyword">var</span> delta = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (!event) <span class="hljs-comment">/* For IE. */</span>
                event = window.event;
        <span class="hljs-keyword">if</span> (event.wheelDelta) { <span class="hljs-comment">/* IE/Opera. */</span>
                delta = event.wheelDelta/<span class="hljs-number">120</span>;
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.detail) { <span class="hljs-javadoc">/** Mozilla case. */</span>
                <span class="hljs-javadoc">/** In Mozilla, sign of delta is different than in IE.
                 * Also, delta is multiple of 3.
                 */</span>
                delta = -event.detail/<span class="hljs-number">3</span>;
        }
        <span class="hljs-javadoc">/** If delta is nonzero, handle it.
         * Basically, delta is now positive if wheel was scrolled up,
         * and negative, if wheel was scrolled down.
         */</span>
        <span class="hljs-keyword">if</span> (delta)
                handle(delta);
        <span class="hljs-javadoc">/** Prevent default actions caused by mouse wheel.
         * That might be ugly, but we handle scrolls somehow
         * anyway, so don't bother here..
         */</span>
        <span class="hljs-keyword">if</span> (event.preventDefault)
                event.preventDefault();
    event.returnValue = <span class="hljs-keyword">false</span>;
}

<span class="hljs-javadoc">/** Initialization code. 
 * If you use your own event management code, change it as required.
 */</span>
<span class="hljs-keyword">if</span> (window.addEventListener)
        <span class="hljs-javadoc">/** DOMMouseScroll is for mozilla. */</span>
        window.addEventListener(<span class="hljs-string">'DOMMouseScroll'</span>, wheel, <span class="hljs-keyword">false</span>);
<span class="hljs-javadoc">/** IE/Opera. */</span>
window.onmousewheel = document.onmousewheel = wheel;</code></pre> 
<h5 id="改变">改变</h5> 
<p>修改后不会出现疯狂缩放，同时也不会触发浏览器事件</p> 
<pre class="prettyprint"><code class=" hljs cs">                    <span class="hljs-comment">// 改写 滚轮缩放</span>
                    <span class="hljs-keyword">var</span> <span class="hljs-keyword">event</span> = a;
                    <span class="hljs-comment">// retrieve delta</span>
                    <span class="hljs-keyword">var</span> delta = <span class="hljs-number">0</span>;
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.wheelDelta) {
                        <span class="hljs-comment">/* IE/Opera. */</span>
                        delta = <span class="hljs-keyword">event</span>.wheelDelta / <span class="hljs-number">120</span>;
                    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.detail) {
                        <span class="hljs-comment">/* Mozilla case. */</span>
                        <span class="hljs-comment">// In Mozilla, sign of delta is different than in IE.</span>
                        <span class="hljs-comment">// Also, delta is multiple of 3.</span>
                        delta = -<span class="hljs-keyword">event</span>.detail / <span class="hljs-number">3</span>;
                    }

                    <span class="hljs-comment">// If delta is nonzero, handle it.</span>
                    <span class="hljs-comment">// Basically, delta is now positive if wheel was scrolled up,</span>
                    <span class="hljs-comment">// and negative, if wheel was scrolled down.</span>
                    <span class="hljs-keyword">if</span> (delta !== <span class="hljs-number">0</span>) {

                        <span class="hljs-comment">// calculate the new scale</span>
                        <span class="hljs-keyword">var</span> scale = mytest.scene.scaleX;
                        <span class="hljs-keyword">var</span> zoom = delta / <span class="hljs-number">10</span>;
                        <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) {
                            zoom = zoom / (<span class="hljs-number">1</span> - zoom);
                        }
                        scale *= <span class="hljs-number">1</span> + zoom;

                        <span class="hljs-comment">// apply the new scale</span>
                        mytest.scene.zoom(scale, scale);
                    }

                    <span class="hljs-comment">// Prevent default actions caused by mouse wheel.</span>
                    <span class="hljs-keyword">event</span>.preventDefault();


                <span class="hljs-comment">//     原滚轮缩放</span>
                <span class="hljs-comment">//    a.preventDefault();</span>
                <span class="hljs-comment">//    n.dispatchEventToScenes("mousewheel", b),  // 注意： 这段代码注释的话将不会触发jtopo的mousewheel事件</span>
                <span class="hljs-comment">//        n.dispatchEvent("mousewheel", b), // scene </span>
                <span class="hljs-comment">//    null != n.wheelZoom &amp;&amp; (a.preventDefault ? a.preventDefault() : (a = a || window.event, a.returnValue = !1), 1 == n.eagleEye.visible &amp;&amp; n.eagleEye.update()) // 鹰眼的缩放</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6c117fce73ff0fe1c6e8d9ba83a2a7e4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">输入输出隔离的半/全双工RS-485/RS-422接口隔离芯片电路</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1a7bb89ecc059d81d884e81e95230c71/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java.lang.NoClassDefFoundError: org/apache/commons/collections/map/MultiKeyMap</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>