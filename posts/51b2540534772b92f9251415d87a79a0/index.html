<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>LINUX用户管理 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="LINUX用户管理" />
<meta property="og:description" content="LINUX用户管理 用户的基本概述:
用户:能够正常登录操作系统
为什么需要用户?
1.系统的每一进程(运行的程序)都需要一个特定的用户运行
2root用户的操作权限过大,容易造成故障这时就需要新建普通用户管理服务器
用户分类:
UID 系统中约定的含义
0 超级管理员
1-200 系统账户,用来运行系统自带的进程默认已经创建
201-999 系统用户,用来运行用户安装的程序,所以此类用户无需登录系统
1000 普通用户,正常可以登录系统的用户权限比较小,能执行的任务有限
查看用户ID信息
使用id命令查询当前前登录用户的信息
用户相关配置文件
当我们创建一个新的用户,系统将用户的信息存放在/etc/passwd中,而密码单独存下
/etc/shadow 中也就是说这两个文件非常重要
passwd文件
cat /etc/passwd | head -1 root:x:0:0:root:/root:/bin/bash
用户名称:root
密码占位符:x
UID:0
GID:0
注释信息:root
家目录:/root
登录的bash:/bin/bash
shadow文件
/etc/shadow 配置文件解释如下图,或者使用命令
添加用户 命令: useradd
必须在root账号下才能添加
-u 指定UID进行创建用户
-g 指定要创建的基本组
-G指定要添加的附加组
-d指定要创建的家目录
-s 指定要创建用户的bash shell
-c指定要创建用户的注释信息
-M不指定家目录
-r创建系统账户,默认无家目录
添加用户的例子:
[root@localhost ~]# useradd -u 5001 -g ops -G dev -c &#34;whoami&#34; -s /bin/bash oldxie ##创建用户 uid 5001 基本组 ops 附加组 dev 注释信息 “whoami” bash shell 为 /bin/bash 名称 oldxie" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/51b2540534772b92f9251415d87a79a0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-12T21:03:06+08:00" />
<meta property="article:modified_time" content="2021-07-12T21:03:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">LINUX用户管理</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="LINUX_0"></a>LINUX用户管理</h3> 
<p><strong>用户的基本概述:</strong><br> 用户:能够正常登录操作系统</p> 
<p>为什么需要用户?<br> 1.系统的每一进程(运行的程序)都需要一个特定的用户运行<br> 2root用户的操作权限过大,容易造成故障这时就需要新建普通用户管理服务器</p> 
<p>用户分类:<br> UID 系统中约定的含义<br> 0 超级管理员<br> 1-200 系统账户,用来运行系统自带的进程默认已经创建<br> 201-999 系统用户,用来运行用户安装的程序,所以此类用户无需登录系统<br> 1000 普通用户,正常可以登录系统的用户权限比较小,能执行的任务有限</p> 
<p><strong>查看用户ID信息</strong><br> 使用id命令查询当前前登录用户的信息<br> <img src="https://images2.imgbox.com/c9/08/yxhVuJTj_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b5/fd/xPNVzAVN_o.png" alt="在这里插入图片描述"></p> 
<p>用户相关配置文件</p> 
<p>当我们创建一个新的用户,系统将用户的信息存放在/etc/passwd中,而密码单独存下<br> /etc/shadow 中也就是说这两个文件非常重要</p> 
<p><strong>passwd文件</strong></p> 
<p><img src="https://images2.imgbox.com/ee/67/o941tUVr_o.png" alt="在这里插入图片描述"><code>cat /etc/passwd | head -1 root:x:0:0:root:/root:/bin/bash</code><br> 用户名称:root<br> 密码占位符:x<br> UID:0<br> GID:0<br> 注释信息:root<br> 家目录:/root<br> 登录的bash:/bin/bash</p> 
<p><strong>shadow文件</strong><br> /etc/shadow 配置文件解释如下图,或者使用命令<br> <img src="https://images2.imgbox.com/83/f2/Z3ZxsyKC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_50"></a>添加用户</h3> 
<p>命令: useradd</p> 
<p>必须在root账号下才能添加<br> -u 指定UID进行创建用户<br> -g 指定要创建的基本组<br> -G指定要添加的附加组<br> -d指定要创建的家目录<br> -s 指定要创建用户的bash shell<br> -c指定要创建用户的注释信息<br> -M不指定家目录<br> -r创建系统账户,默认无家目录</p> 
<p>添加用户的例子:</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@localhost ~<span class="token punctuation">]</span><span class="token comment"># useradd  -u 5001  -g  ops  -G  dev  -c  "whoami" -s /bin/bash  oldxie</span>

</code></pre> 
<p>##创建用户 uid 5001 基本组 ops 附加组 dev 注释信息 “whoami” bash shell 为 /bin/bash 名称 oldxie</p> 
<p>例2:<br> 创建一个mysql 用户<br> 不需要家目录<br> 该用户不需要登录系统</p> 
<pre><code class="prism language-bash"><span class="token function">useradd</span>   -r   mysql  -M   -s /sbin/nologin

</code></pre> 
<p>##创建了一个没有家目录 /sbin/nologin 不需要登录系统的mysql账号</p> 
<h3><a id="_83"></a><strong>修改用户</strong></h3> 
<p>命令:usermod<br> 必须在root用户下才能使用</p> 
<p>-u 指定修改用户的UID<br> -g指定修改用户的基本组<br> -G指定修改用户的附加组<br> -d 指定修改用户的家目录<br> -s指定修改bash shell<br> -c 指定要修改用户的注释信息<br> -l指定要修改用户的登录名<br> -L指定要锁定的用户<br> -U指定解锁的用户</p> 
<p>修改用户的例子:<br> 修改oldxie用户:<br> uid =5008<br> 基本组为network 附加组为ops dev sa<br> 注释信息为student 登录名称new_oldxie</p> 
<p><img src="https://images2.imgbox.com/d7/b5/za9BRw6h_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bashuseradd"> groupadd  network  -f
 usermod  oldxie  -c   "change" -g  network  -G  ops,dev  -l  new_oldxie
 id new_oldxie

</code></pre> 
<p>例2:<br> 修改new_oldxie<br> 为new_oldxie配置密码<br> 锁定该用户<br> 解锁该用户然后再次测试远程连接登录</p> 
<p>锁定用户<br> usermod -L new_oldxie<br> 解锁用户<br> usermod -U new_oldxie</p> 
<p>unlocking the user’s password would result in a passwordless account.<br> You should set a password with usermod -p to unlock this user’s password.<br> 解锁用户将导致一个没有密码的用户<br> 最好再重新设置密码</p> 
<h3><a id="_133"></a>删除用户</h3> 
<p>命令:userdel<br> -r连同家目录一起删除<br> userdel 会删除用户但不会删除用户的家目录要想彻底删除就加-r<br> userdel -r new_oldxie</p> 
<p>例子1:<br> 批量删除此前创建过的所有无用的用户<br> 使用awk 提取无用的用户名称<br> 使用sed拼接删除用户的命令<br> 调用userdel命令,连同加目录一起全部删除<br> 提示:此处指的无用的用户为UID&gt;1000的用户<br> 首先需要整理出大于uid&gt;1000的用户</p> 
<p><img src="https://images2.imgbox.com/c8/d9/8eMjatjT_o.png" alt="在这里插入图片描述">然后在添加userdel -r 再 bash</p> 
<p><img src="https://images2.imgbox.com/fd/95/PLLaEweE_o.png" alt="在这里插入图片描述"><br> 最后我们可以将这两条命令合并下</p> 
<pre><code class="prism language-bash"><span class="token function">awk</span>  -F <span class="token string">':'</span>   <span class="token string">'<span class="token variable">$3</span>&gt;1000{print <span class="token variable">$1</span>}'</span>  /etc/passwd <span class="token operator">|</span> <span class="token function">sed</span>   -r  <span class="token string">'s#(.*)#userdel -r <span class="token entity" title="\1">\1</span>#g'</span> <span class="token operator">|</span> <span class="token function">bash</span> 
</code></pre> 
<h3><a id="_161"></a>密码设置</h3> 
<p>普通用户只能变更自己的密码<br> root 可以变更所有用户的密码</p> 
<p>密码变更方式分为一下两种:<br> 交互式设定密码: passwd userID<br> <img src="https://images2.imgbox.com/d9/10/9SIBKCgy_o.png" alt="在这里插入图片描述">非交互式模式设定密码:</p> 
<p>echo ‘199688’ | passwd --stdin AGAN<br> <img src="https://images2.imgbox.com/24/69/7SPGlYjj_o.png" alt="在这里插入图片描述">扩展:<br> 非交互式设定随机密码:<br> 需要pack: expect<br> yum install -y expect</p> 
<p>mkpasswd 扩展项:<br> -l # (密码的长度定义, 默认是 9)<br> -d # (数字个数, 默认是 2)<br> -c # (小写字符个数, 默认是 2)<br> -C # (大写字符个数, 默认是 2)<br> -s # (特殊字符个数, 默认是 1)<br> -v (详细。。。)<br> -p prog (程序设置密码, 默认是 passwd)</p> 
<p><img src="https://images2.imgbox.com/d5/1e/m4iB6ho8_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span>  <span class="token variable"><span class="token variable">$(</span>mkpasswd -l <span class="token number">9</span>  -d <span class="token number">2</span>  -c <span class="token number">2</span>  -s <span class="token number">1</span> -C <span class="token number">4</span> <span class="token variable">)</span></span> <span class="token operator">|</span> <span class="token function">tee</span>  passwd.txt <span class="token operator">|</span> <span class="token function">passwd</span>  --stdin  AGAN
</code></pre> 
<p>扩展内容:<br> 编辑一个脚本批量设置随机密码并且创建用户:<br> <img src="https://images2.imgbox.com/44/88/JUsNJsxc_o.png" alt="在这里插入图片描述"><code>1 #!/usr/bin/bash 2 for i in {1..100} 3 do 4 password=$(mkpasswd -l 9 -d 2 -c 2 -s 1 -C 4) 5 useradd $i 6 echo "$i is creat OK" 7 echo "$password" | passwd --stdin $i 8 echo "$i key is ctreat ok" 9 10 done</code></p> 
<h3><a id="_204"></a>系统创建用户流程</h3> 
<p>用户在创建系统的时候会参考两个配置文件:<br> 1 /etc/login.defs<br> 2 /etc/default/useradd</p> 
<p>login.defs 主要定义了创建用户时 UID划分规则,密码加密类型,是否创建家目录</p> 
<p>添加个小知识:</p> 
<pre><code class="prism language-bash"><span class="token function">grep</span>   -E <span class="token string">'^#|^'</span>  /etc/default/useradd
</code></pre> 
<p>效果和-v 的效果一样</p> 
<pre><code class="prism language-bash"> <span class="token function">grep</span>   -Ev <span class="token string">'^#'</span>  /etc/default/useradd

</code></pre> 
<p>都能查看如下内容<br> GROUP=100<br> HOME=/home #把用户的家目录创建在/home 下<br> INACTIVE=-1 #是否启用账号过期提权 -1表示不启用<br> EXPIRE= #账号终止日期,不设置表示不启用<br> SHELL=/bin/bash #新用户默认所有的shell 的类型<br> SKEL=/etc/skel #配置新用户家目录的默认文件的存放位置<br> CREATE_MAIL_SPOOL=yes #创建mail文件</p> 
<h3><a id="_232"></a>用户环境变量丢失案例</h3> 
<p>如上所描述,如果我们把家目录中的环境配置文件删除了,然后再登录系统会出现如下的问题:</p> 
<p><img src="https://images2.imgbox.com/e3/25/9vkfHE7K_o.png" alt="在这里插入图片描述">解决办法:</p> 
<pre><code class="prism language-bash"><span class="token function">cp</span>  -a /etc/skel/.bash*  ~
</code></pre> 
<h3><a id="_242"></a>用户组基本概述</h3> 
<p>组是一种逻辑层面上的定义<br> 逻辑上将多个用户归纳至一个组,当我们对组操作时其实就相当于对组中所有的用户进行操作</p> 
<p>可以分为如下几类:<br> 默认组:创建用户时不指定组则默认创建与用户同名的组<br> 基本组:用户有且只能有一个基本组,创建时可通过-g指定(亲爹)</p> 
<p>附加组:用户可以 有多个附加组,创建时通过-G指定(干爹)<br> 相关配置文件:<br> 组账户的信息保存在/etc/group和/etc/gshadow两个文件中,重点关注group</p> 
<p>以第一行的组为例做如下解释(针对group配置文件)<br> <img src="https://images2.imgbox.com/a9/00/fn7F6ZUV_o.png" alt="在这里插入图片描述"></p> 
<p>gshadow 文件:<br> <img src="https://images2.imgbox.com/0c/bc/d7aD4iRi_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_260"></a>用户组相关命令</h3> 
<p>添加用户组:<br> groupadd<br> -f 如果租已经存在,会提示创建成功的状态<br> -g为新组设置GID,若GID已经存在会提示GID已经存在<br> -r创建一个系统组</p> 
<p><strong>添加例子</strong><br> 添加一个salary 的组<br> GID=1000<br> <img src="https://images2.imgbox.com/b1/af/g98ZuZx5_o.png" alt="在这里插入图片描述"><br> 添加一个salary_2的组<br> 添加为系统组<br> <img src="https://images2.imgbox.com/62/9e/egRQzHKI_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_275"></a>修改组</h3> 
<p>命令:groupmod<br> 只能在root下使用</p> 
<p>-f 如果组已经存在,会提成功创建的状态<br> -g 为新组设置GID 若GID已经存在会提示GID已经存在<br> -r 创建一个系统组<br> -n 改名为新的组</p> 
<p>例子:<br> 修改salary用户组为system<br> groupmod -n system salary</p> 
<p><img src="https://images2.imgbox.com/11/ef/2jNZl2GU_o.png" alt="在这里插入图片描述">例子2:<br> 修改system用户组GID=5000</p> 
<p><img src="https://images2.imgbox.com/b2/a4/ffdrHXuf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_294"></a>删除组</h3> 
<p>命令:groupdel<br> 例子:删除salary_2系统用户组<br> groupdel salary_2</p> 
<p>例2:<br> 创建tom 用户,设置主组为system 然后测试删除system 组<br> <img src="https://images2.imgbox.com/45/4a/fqbhstOl_o.png" alt="在这里插入图片描述"><code>groupdel system groupdel: cannot remove the primary group of user 'tom'</code></p> 
<p>注意:如果组中还存在用户则不能删除组</p> 
<h3><a id="_308"></a>用户与用户组场景</h3> 
<p>创建dev 与ops 两个组;</p> 
<pre><code class="prism language-bash"><span class="token function">groupadd</span>  dev<span class="token punctuation">;</span><span class="token function">groupadd</span>  ops 
</code></pre> 
<p>创建bob用户,设定基本组为dev 密码为123;</p> 
<pre><code class="prism language-bash"> <span class="token function">useradd</span>  bob  -g dev <span class="token punctuation">;</span> <span class="token builtin class-name">echo</span>  <span class="token string">"123"</span> <span class="token operator">|</span> <span class="token function">passwd</span>  --stdin  bob
</code></pre> 
<p>创建alice用户,设定基本组ops 密码为123</p> 
<pre><code class="prism language-bash"><span class="token function">useradd</span>  alice -g ops  <span class="token punctuation">;</span> <span class="token builtin class-name">echo</span>  <span class="token string">'123'</span>  <span class="token operator">|</span> <span class="token function">passwd</span>  --stdin alice

</code></pre> 
<p>创建/opt /resource文件,然后修改属组为 ops权限为664</p> 
<pre><code class="prism language-bash"><span class="token function">touch</span>  /opt/resource
<span class="token function">chgrp</span>   /opt/resource  ops
<span class="token function">chmod</span>   <span class="token number">664</span>  /opt/resource 
</code></pre> 
<p>通过测试:<br> bob只能看看文件不能修改<br> alice 能执行读写操作</p> 
<p>然后继续我们怎么实现也能使得bob也能读写操作?<br> 思路 :我们可以再给alice 添加新的组也就是附加组就能实现要求</p> 
<pre><code class="prism language-bash"><span class="token function">usermod</span>  bob  -G   ops
</code></pre> 
<p><img src="https://images2.imgbox.com/a4/1f/rxKRUdSQ_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f065fcead4999e98fabd1a43b809a941/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">安装visio2019Pro提示报错“0xC004F017“具体解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5cba0b820cf5547eafff7db48b51e363/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">px是什么意思计算机二级,px是什么意思？照片中的px是什么的缩写？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>