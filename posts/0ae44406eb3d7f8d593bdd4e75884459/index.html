<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java实现连接SQL Server解决方案及代码 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java实现连接SQL Server解决方案及代码" />
<meta property="og:description" content="下面展示了连接SQL Server数据库的整个流程：
加载数据库驱动建立数据库连接执行SQL语句处理结果关闭连接 在连接之前，前提是确保数据库成功的下载，创建，配置好账号密码。
运行成功的代码：
import java.sql.*; public class sqlserverConnection { //驱动 private static String cxDriver = &#34;com.microsoft.sqlserver.jdbc.SQLServerDriver&#34;; //连接地址 private static String cxUrl = &#34;jdbc:sqlserver://172.16.100.1:1433;databaseName=abc;encrypt=false&#34;; //用户名 private static String cxUser = &#34;abc&#34;; //用户密码:数据库的密码 private static String cxPassword = &#34;abc&#34;; public static void main(String[] args) { try{ Class.forName(cxDriver); //加载sqlserver的驱动类 System.out.println(&#34;加载SQLServer驱动类成功!&#34;); } catch(ClassNotFoundException a){ System.out.println(&#34;加载SQLServer驱动失败!&#34;); a.printStackTrace(); } Connection dbcon=null; //处理与特定数据库的连接 try{ dbcon=DriverManager.getConnection(cxUrl,cxUser,cxPassword); System.out.println(&#34;数据库连接成功!&#34;); dbcon.close(); } catch(SQLException e){ System.out.println(&#34;数据库连接失败!&#34;); e.printStackTrace(); } } } 报错：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0ae44406eb3d7f8d593bdd4e75884459/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-24T17:06:56+08:00" />
<meta property="article:modified_time" content="2023-10-24T17:06:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java实现连接SQL Server解决方案及代码</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>下面展示了连接SQL Server数据库的整个流程：</p> 
<ul><li>加载数据库驱动</li><li>建立数据库连接</li><li>执行SQL语句</li><li>处理结果</li><li>关闭连接</li></ul> 
<p>在连接之前，前提是确保数据库成功的下载，创建，配置好账号密码。</p> 
<p>运行成功的代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>sql<span class="token punctuation">.</span></span><span class="token operator">*</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> sqlserverConnection <span class="token punctuation">{<!-- --></span>
	
	<span class="token comment">//驱动</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> cxDriver <span class="token operator">=</span> <span class="token string">"com.microsoft.sqlserver.jdbc.SQLServerDriver"</span><span class="token punctuation">;</span>
    <span class="token comment">//连接地址</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> cxUrl <span class="token operator">=</span> <span class="token string">"jdbc:sqlserver://172.16.100.1:1433;databaseName=abc;encrypt=false"</span><span class="token punctuation">;</span>
    <span class="token comment">//用户名</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> cxUser <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>
    <span class="token comment">//用户密码:数据库的密码</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token class-name">String</span> cxPassword <span class="token operator">=</span> <span class="token string">"abc"</span><span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>cxDriver<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//加载sqlserver的驱动类</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"加载SQLServer驱动类成功!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">ClassNotFoundException</span> a<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"加载SQLServer驱动失败!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            a<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Connection</span> dbcon<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">;</span>           <span class="token comment">//处理与特定数据库的连接</span>
        <span class="token keyword">try</span><span class="token punctuation">{<!-- --></span>
            dbcon<span class="token operator">=</span><span class="token class-name">DriverManager</span><span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span>cxUrl<span class="token punctuation">,</span>cxUser<span class="token punctuation">,</span>cxPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数据库连接成功!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            dbcon<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">catch</span><span class="token punctuation">(</span><span class="token class-name">SQLException</span> e<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"数据库连接失败!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p>报错：</p> 
<pre><code class="prism language-bash">Exception <span class="token keyword">in</span> thread <span class="token string">"main"</span> java.lang.UnsupportedClassVersionError: com/microsoft/sqlserver/jdbc/SQLServerDriver has been compiled by a <span class="token function">more</span> recent version of the Java Runtime <span class="token punctuation">(</span>class <span class="token function">file</span> version <span class="token number">55.0</span><span class="token punctuation">)</span>, this version of the Java Runtime only recognizes class <span class="token function">file</span> versions up to <span class="token number">52.0</span>
	at java.lang.ClassLoader.defineClass1<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
	at java.lang.ClassLoader.defineClass<span class="token punctuation">(</span>ClassLoader.java:763<span class="token punctuation">)</span>
	at java.security.SecureClassLoader.defineClass<span class="token punctuation">(</span>SecureClassLoader.java:142<span class="token punctuation">)</span>
	at java.net.URLClassLoader.defineClass<span class="token punctuation">(</span>URLClassLoader.java:468<span class="token punctuation">)</span>
	at java.net.URLClassLoader.access<span class="token variable">$100</span><span class="token punctuation">(</span>URLClassLoader.java:74<span class="token punctuation">)</span>
	at java.net.URLClassLoader<span class="token variable">$1</span>.run<span class="token punctuation">(</span>URLClassLoader.java:369<span class="token punctuation">)</span>
	at java.net.URLClassLoader<span class="token variable">$1</span>.run<span class="token punctuation">(</span>URLClassLoader.java:363<span class="token punctuation">)</span>
	at java.security.AccessController.doPrivileged<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
	at java.net.URLClassLoader.findClass<span class="token punctuation">(</span>URLClassLoader.java:362<span class="token punctuation">)</span>
	at java.lang.ClassLoader.loadClass<span class="token punctuation">(</span>ClassLoader.java:424<span class="token punctuation">)</span>
	at sun.misc.Launcher<span class="token variable">$AppClassLoader</span>.loadClass<span class="token punctuation">(</span>Launcher.java:349<span class="token punctuation">)</span>
	at java.lang.ClassLoader.loadClass<span class="token punctuation">(</span>ClassLoader.java:357<span class="token punctuation">)</span>
	at java.lang.Class.forName0<span class="token punctuation">(</span>Native Method<span class="token punctuation">)</span>
	at java.lang.Class.forName<span class="token punctuation">(</span>Class.java:264<span class="token punctuation">)</span>
	at timeunit_test.sqlserverConnection.main<span class="token punctuation">(</span>sqlserverConnection.java:17<span class="token punctuation">)</span>
</code></pre> 
<p>问题在于用较高版本的jdk编译的class文件在低版本的JVM上运行所导致的，通俗讲就是编译运行版本不匹配。</p> 
<p>可惜我不是<br> 看下jar包目录下是否存在多余的，不需要的版本，去除<br> 我第一次jre8,jre11版本的都导入了，导致驱动加载失败<br> 使用cmd <code>java -version</code> 查看java javac版本 是否都匹配<br> <img src="https://images2.imgbox.com/39/b3/8p2gBFLj_o.png" alt="在这里插入图片描述"></p> 
<p>加载驱动成功，但是连接又失败了</p> 
<pre><code class="prism language-bash">com.microsoft.sqlserver.jdbc.SQLServerException: <span class="token string">"encrypt"</span> property is <span class="token builtin class-name">set</span> to <span class="token string">"true"</span> and <span class="token string">"trustServerCertificate"</span> property is <span class="token builtin class-name">set</span> to <span class="token string">"false"</span> but the driver could not establish a secure connection to SQL Server by using Secure Sockets Layer <span class="token punctuation">(</span>SSL<span class="token punctuation">)</span> encryption: Error: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to <span class="token function">find</span> valid certification path to requested target. ClientConnectionId:f903a939-f589-4052-89f8-580442a86a1b
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.terminate<span class="token punctuation">(</span>SQLServerConnection.java:4026<span class="token punctuation">)</span>
	at com.microsoft.sqlserver.jdbc.TDSChannel.enableSSL<span class="token punctuation">(</span>IOBuffer.java:1954<span class="token punctuation">)</span>
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.connectHelper<span class="token punctuation">(</span>SQLServerConnection.java:3552<span class="token punctuation">)</span>
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.login<span class="token punctuation">(</span>SQLServerConnection.java:3172<span class="token punctuation">)</span>
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.connectInternal<span class="token punctuation">(</span>SQLServerConnection.java:3014<span class="token punctuation">)</span>
	at com.microsoft.sqlserver.jdbc.SQLServerConnection.connect<span class="token punctuation">(</span>SQLServerConnection.java:1836<span class="token punctuation">)</span>
	at com.microsoft.sqlserver.jdbc.SQLServerDriver.connect<span class="token punctuation">(</span>SQLServerDriver.java:1246<span class="token punctuation">)</span>
	at java.sql.DriverManager.getConnection<span class="token punctuation">(</span>DriverManager.java:664<span class="token punctuation">)</span>
	at java.sql.DriverManager.getConnection<span class="token punctuation">(</span>DriverManager.java:247<span class="token punctuation">)</span>
	at timeunit_test.sqlserverConnection.main<span class="token punctuation">(</span>sqlserverConnection.java:26<span class="token punctuation">)</span>
Caused by: javax.net.ssl.SSLHandshakeException: sun.security.validator.ValidatorException: PKIX path building failed: sun.security.provider.certpath.SunCertPathBuilderException: unable to <span class="token function">find</span> valid certification path to requested target
	<span class="token punctuation">..</span>.
</code></pre> 
<p>这个问题最有效的办法是在连接地址<code>Url</code>后面加上<code>encrypt=false</code>。</p> 
<p>执行SQL语句:</p> 
<pre><code class="prism language-java"><span class="token class-name">Statement</span> statement <span class="token operator">=</span> connection<span class="token punctuation">.</span><span class="token function">createStatement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">String</span> sql <span class="token operator">=</span> <span class="token string">"SELECT * FROM mytable"</span><span class="token punctuation">;</span>
<span class="token class-name">ResultSet</span> resultSet <span class="token operator">=</span> statement<span class="token punctuation">.</span><span class="token function">executeQuery</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>上述代码中，statement对象用于执行SQL语句。sql是要执行的SQL语句，这里是一个简单的查询语句。executeQuery()方法用于执行查询语句，并返回一个ResultSet对象，用于获取查询结果。</p> 
<p>处理结果</p> 
<pre><code class="prism language-java"><span class="token keyword">while</span> <span class="token punctuation">(</span>resultSet<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> id <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">String</span> name <span class="token operator">=</span> resultSet<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 处理每一条查询结果</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述代码中，通过resultSet.next()方法判断是否还有下一条查询结果，然后使用getInt()和getString()等方法获取查询结果中的具体字段值。</p> 
<p>关闭连接</p> 
<pre><code class="prism language-java">resultSet<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
statement<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
connection<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>上述代码中，分别关闭resultSet、statement和connection对象，释放相关资源。</p> 
<blockquote> 
 <p>参考大家的文档<br> https://blog.csdn.net/qq243920161/article/details/78971861<br> https://blog.csdn.net/m0_46669582/article/details/111685213<br> https://blog.csdn.net/qq_42759370/article/details/103350930<br> https://blog.csdn.net/qq_37917691/article/details/108262286<br> https://blog.csdn.net/Green_Hand_is_me/article/details/122272151<br> https://blog.csdn.net/qq_45835014/article/details/128268932<br> https://blog.csdn.net/qq_51391437/article/details/121051234</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/743baf1148392344262fcc1e9367e4ce/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">进阶JAVA篇-深入了解 Stream 流对象的创建与中间方法、终结方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/175bfe3ecbe11bb7849d2ca9f2b972cf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux系统编程学习 NO.8 ——make和Makefile、进度条程序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>