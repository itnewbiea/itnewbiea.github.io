<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CL210红帽OpenStack平台架构--介绍容器服务 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CL210红帽OpenStack平台架构--介绍容器服务" />
<meta property="og:description" content="🎹 个人简介：大家好，我是 金鱼哥，CSDN运维领域新星创作者，华为云·云享专家，阿里云社区·专家博主
📚个人资质：CCNA、HCNP、CSNA（网络分析师），软考初级、中级网络工程师、RHCSA、RHCE、RHCA、RHCI、ITIL😜
💬格言：努力不一定成功，但要想成功就必须努力🔥
🎈支持我：可点赞👍、可收藏⭐️、可留言📝
文章目录 📜容器服务介绍📜容器镜像和注册📑稳定📑安全📑生命周期管理📑服务位置📑可伸缩性 📜填充本地容器仓库📜容器的命令📑docker ps📑docker stats📑docker images📑docker inspect📑docker logs📑docker exec 📜日志文件和配置文件📑日志文件位置📑配置文件位置 📜课本练习 💡总结 📜容器服务介绍 与红帽OpenStack平台的早期版本不同，后期版本使用容器来运行服务。容器化的体系结构确保每个OpenStack服务与主机隔离。主要的OpenStack服务都使用容器。容器是使用从Red Hat客户门户中提取的镜像构建的。容器服务管理由docker命令处理，替换systemd命令。底层Linux系统继续使用systemd命令。容器通过拉取新镜像并替换现有镜像来更新，并且使用Kolla工具集构建这些容器。
📜容器镜像和注册 Red Hat OpenStack Platform 12是第一个实现了容器化控制平面的发行版。每个服务容器运行一个独立的堆栈，不依赖于其他容器。运行容器化OpenStack服务的一些主要好处如下所述：
使用容器化控制平面服务的好处
📑稳定 因为每个服务容器都是隔离的，不依赖于其他容器，所以它减少了单个服务失败时的级联失败。
📑安全 容器镜像在设计上是不可变的。通过从原始镜像重新部署，可以很容易地重新构建损坏或修改的容器。
📑生命周期管理 管理这些服务容器的生命周期很容易，因为它们是独立的单元。因为可以独立地对每个服务容器进行升级和回滚，所以您不必担心在升级或回滚时破坏依赖关系。
📑服务位置 管理员可以根据需要在主机之间移动服务容器。
📑可伸缩性 每个服务容器都可以快速而轻松地伸缩。目前，由于对主机文件系统和网络的潜在依赖关系，只能在单个节点上放置一个服务容器实例。
推荐使用在undercloud上确认的本地仓库方法。在安装undercloud时，镜像仓库在端口8787上被确认。该部署同步来自远程仓库的镜像，并将它们推到docker-distribution服务。
(undercloud) [stack@director ~]$ systemctl status docker-distribution.service ● docker-distribution.service - v2 Registry server for Docker Loaded: loaded (/usr/lib/systemd/system/docker-distribution.service; enabled; vendor preset: disabled) Active: active (running) since Mon 2020-10-12 16:12:56 UTC; 1 day 10h ago Main PID: 1418 (registry) Tasks: 7 CGroup: /system." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8af001cf2cbfe3e8758c6ceecb9eff1c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-15T09:00:00+08:00" />
<meta property="article:modified_time" content="2022-05-15T09:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CL210红帽OpenStack平台架构--介绍容器服务</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>🎹 个人简介：大家好，我是 <strong>金鱼哥，CSDN运维领域新星创作者，华为云·云享专家，阿里云社区·专家博主</strong><br> 📚个人资质：<strong>CCNA、HCNP、CSNA（网络分析师），软考初级、中级网络工程师、RHCSA、RHCE、RHCA、RHCI、ITIL</strong>😜<br> 💬格言：努力不一定成功，但要想成功就必须努力🔥</p> 
 <p>🎈支持我：可点赞👍、可收藏⭐️、可留言📝</p> 
</blockquote> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_7" rel="nofollow">📜容器服务介绍</a></li><li><a href="#_13" rel="nofollow">📜容器镜像和注册</a></li><li><ul><li><a href="#_21" rel="nofollow">📑稳定</a></li><li><a href="#_27" rel="nofollow">📑安全</a></li><li><a href="#_33" rel="nofollow">📑生命周期管理</a></li><li><a href="#_39" rel="nofollow">📑服务位置</a></li><li><a href="#_45" rel="nofollow">📑可伸缩性</a></li></ul> 
    </li><li><a href="#_70" rel="nofollow">📜填充本地容器仓库</a></li><li><a href="#_97" rel="nofollow">📜容器的命令</a></li><li><ul><li><a href="#docker_ps_128" rel="nofollow">📑docker ps</a></li><li><a href="#docker_stats_202" rel="nofollow">📑docker stats</a></li><li><a href="#docker_images_212" rel="nofollow">📑docker images</a></li><li><a href="#docker_inspect_233" rel="nofollow">📑docker inspect</a></li><li><a href="#docker_logs_278" rel="nofollow">📑docker logs</a></li><li><a href="#docker_exec_294" rel="nofollow">📑docker exec</a></li></ul> 
    </li><li><a href="#_322" rel="nofollow">📜日志文件和配置文件</a></li><li><ul><li><a href="#_324" rel="nofollow">📑日志文件位置</a></li><li><a href="#_332" rel="nofollow">📑配置文件位置</a></li></ul> 
    </li><li><a href="#_340" rel="nofollow">📜课本练习</a></li></ul> 
   </li><li><a href="#_354" rel="nofollow">💡总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_7"></a>📜容器服务介绍</h4> 
<p>与红帽OpenStack平台的早期版本不同，后期版本使用容器来运行服务。容器化的体系结构确保每个OpenStack服务与主机隔离。主要的OpenStack服务都使用容器。容器是使用从Red Hat客户门户中提取的镜像构建的。容器服务管理由docker命令处理，替换systemd命令。底层Linux系统继续使用systemd命令。容器通过拉取新镜像并替换现有镜像来更新，并且使用Kolla工具集构建这些容器。</p> 
<hr> 
<h4><a id="_13"></a>📜容器镜像和注册</h4> 
<p>Red Hat OpenStack Platform 12是第一个实现了容器化控制平面的发行版。每个服务容器运行一个独立的堆栈，不依赖于其他容器。运行容器化OpenStack服务的一些主要好处如下所述：</p> 
<p>使用容器化控制平面服务的好处</p> 
<hr> 
<h5><a id="_21"></a>📑稳定</h5> 
<p>因为每个服务容器都是隔离的，不依赖于其他容器，所以它减少了单个服务失败时的级联失败。</p> 
<hr> 
<h5><a id="_27"></a>📑安全</h5> 
<p>容器镜像在设计上是不可变的。通过从原始镜像重新部署，可以很容易地重新构建损坏或修改的容器。</p> 
<hr> 
<h5><a id="_33"></a>📑生命周期管理</h5> 
<p>管理这些服务容器的生命周期很容易，因为它们是独立的单元。因为可以独立地对每个服务容器进行升级和回滚，所以您不必担心在升级或回滚时破坏依赖关系。</p> 
<hr> 
<h5><a id="_39"></a>📑服务位置</h5> 
<p>管理员可以根据需要在主机之间移动服务容器。</p> 
<hr> 
<h5><a id="_45"></a>📑可伸缩性</h5> 
<p>每个服务容器都可以快速而轻松地伸缩。目前，由于对主机文件系统和网络的潜在依赖关系，只能在单个节点上放置一个服务容器实例。</p> 
<hr> 
<p>推荐使用在undercloud上确认的本地仓库方法。在安装undercloud时，镜像仓库在端口8787上被确认。该部署同步来自远程仓库的镜像，并将它们推到docker-distribution服务。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">(</span>undercloud<span class="token punctuation">)</span> <span class="token punctuation">[</span>stack@director ~<span class="token punctuation">]</span>$ systemctl status docker-distribution.service 
● docker-distribution.service - v2 Registry server <span class="token keyword">for</span> Docker
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/docker-distribution.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Mon <span class="token number">2020</span>-10-12 <span class="token number">16</span>:12:56 UTC<span class="token punctuation">;</span> <span class="token number">1</span> day 10h ago
 Main PID: <span class="token number">1418</span> <span class="token punctuation">(</span>registry<span class="token punctuation">)</span>
    Tasks: <span class="token number">7</span>
   CGroup: /system.slice/docker-distribution.service
           └─1418 /usr/bin/registry serve /etc/docker-distribution/registry/config.yml

Warning: Journal has been rotated since unit was started. Log output is incomplete or unavailable.
</code></pre> 
<p>undercloud 仓库中填充了overcloud中包含的每个服务所需的镜像。在overcloud部署期间，将从这个本地仓库中心提取镜像。使用本地仓库中心可以加速部署并缓解网络拥塞，但是提供了有限的生命周期管理。在没有人工干预的情况下，镜像在部署的overcloud的生命周期中保持不变。</p> 
<hr> 
<h4><a id="_70"></a>📜填充本地容器仓库</h4> 
<p>默认情况下，使用/usr/share/openstack-tripleo-common-containers/containers-imaqes/overcloud_ containers.yaml文件中定义的远程仓库提取容器镜像。要使用undercloud作为本地容器仓库，需要生成一个模板文件，其中包含overcloud部署所需的所有容器镜像，从而从远程仓库提取镜像。使用以下命令生成模板文件：</p> 
<pre><code class="prism language-shell"><span class="token punctuation">(</span>undercloud<span class="token punctuation">)</span> <span class="token punctuation">[</span>stack@director ~<span class="token punctuation">]</span>$ openstack overcloud container image prepare <span class="token punctuation">\</span>
-e /usr/share/openstack-tripleo-heat-templates/environments/ceph-ansible/ceph-ansible.yaml <span class="token punctuation">\</span>
--namespace<span class="token operator">=</span>registry.access.redhat.com/rhosp13 <span class="token punctuation">\</span>
--prefix<span class="token operator">=</span>openstack- <span class="token punctuation">\</span>
--tag-from-label <span class="token punctuation">{<!-- --></span>version<span class="token punctuation">}</span>-<span class="token punctuation">{<!-- --></span>release<span class="token punctuation">}</span> <span class="token punctuation">\</span>
--output-images-file /home/stack/local_registry_images.yaml
</code></pre> 
<p>local_registry_images.yaml文件上传容器镜像到本地容器仓库。使用openstack overcloud image upload命令来上传容器镜像。使用以下命令列出上传到本地仓库的容器镜像：</p> 
<pre><code class="prism language-shell"><span class="token punctuation">(</span>undercloud<span class="token punctuation">)</span> <span class="token punctuation">[</span>stack@director -<span class="token punctuation">]</span>$ <span class="token function">docker</span> images --format<span class="token operator">=</span><span class="token string">"{<!-- -->{.Repository}}"</span>
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-neutron-server-ovn
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-neutron-metadata-agent-ovn
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-rabbitmq
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-api
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-ceilometer-central
…………
</code></pre> 
<hr> 
<h4><a id="_97"></a>📜容器的命令</h4> 
<p>所有容器命令都需要root权限。（因为是用root权限运行）</p> 
<p>使用docker version命令查找正在使用的docker版本。同时显示客户端和服务器版本</p> 
<pre><code class="prism language-shell"><span class="token function">docker</span> version
<span class="token punctuation">(</span>undercloud<span class="token punctuation">)</span> <span class="token punctuation">[</span>stack@director ~<span class="token punctuation">]</span>$ <span class="token function">docker</span> version
Client:
 Version:         <span class="token number">1.13</span>.1
 API version:     <span class="token number">1.26</span>
 Package version: docker-1.13.1-68.gitdded712.el7.x86_64
 Go version:      go1.9.2
 Git commit:      dded712/1.13.1
 Built:           Tue Jun <span class="token number">12</span> <span class="token number">18</span>:30:09 <span class="token number">2018</span>
 OS/Arch:         linux/amd64

Server:
 Version:         <span class="token number">1.13</span>.1
 API version:     <span class="token number">1.26</span> <span class="token punctuation">(</span>minimum version <span class="token number">1.12</span><span class="token punctuation">)</span>
 Package version: docker-1.13.1-68.gitdded712.el7.x86_64
 Go version:      go1.9.2
 Git commit:      dded712/1.13.1
 Built:           Tue Jun <span class="token number">12</span> <span class="token number">18</span>:30:09 <span class="token number">2018</span>
 OS/Arch:         linux/amd64
 Experimental:    <span class="token boolean">false</span>
</code></pre> 
<hr> 
<h5><a id="docker_ps_128"></a>📑docker ps</h5> 
<p>docker ps命令列出了所有的容器。注意，容器可能同时存在于控制节点和计算节点上。您可以使用grep命令来优化搜索，也可以使用–format选项和docker ps命令来生成可读性更好的输出。选项-a列出了所有容器。默认情况下，只列出正在运行的容器。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">docker</span> <span class="token function">ps</span>
Got permission denied <span class="token keyword">while</span> trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Get http://%2Fvar%2Frun%2Fdocker.sock/v1.26/containers/json: dial unix /var/run/docker.sock: connect: permission denied
<span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">ps</span>
CONTAINER ID        IMAGE                                                                  COMMAND                  CREATED             STATUS                    PORTS               NAMES
93d806a63af1        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-manila-share:pcmklatest          <span class="token string">"/bin/bash /usr/lo..."</span>   <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   openstack-manila-share-docker-0
bb5228ae1d0a        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-volume:pcmklatest         <span class="token string">"/bin/bash /usr/lo..."</span>   <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   openstack-cinder-volume-docker-0
9314ea858667        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-ovn-northd:latest                <span class="token string">"/bin/bash /usr/lo..."</span>   <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   ovn-dbs-bundle-docker-0
b5b9a671dbbd        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-haproxy:pcmklatest               <span class="token string">"/bin/bash /usr/lo..."</span>   <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   haproxy-bundle-docker-0
28bfeb90f1b5        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-redis:pcmklatest                 <span class="token string">"/bin/bash /usr/lo..."</span>   <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   redis-bundle-docker-0
9b470324ad68        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-mariadb:pcmklatest               <span class="token string">"/bin/bash /usr/lo..."</span>   <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   galera-bundle-docker-0
2c297a0596f3        <span class="token number">172.25</span>.249.200:8787/rhceph/rhceph-3-rhel7:latest                       <span class="token string">"/entrypoint.sh"</span>         <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   ceph-mgr-controller0
40fd01c5c03e        <span class="token number">172.25</span>.249.200:8787/rhceph/rhceph-3-rhel7:latest                       <span class="token string">"/entrypoint.sh"</span>         <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   ceph-mds-controller0
66a57bd58a9b        <span class="token number">172.25</span>.249.200:8787/rhceph/rhceph-3-rhel7:latest                       <span class="token string">"/entrypoint.sh"</span>         <span class="token number">35</span> hours ago        Up <span class="token number">35</span> hours                                   ceph-mon-controller0
…………

<span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> nova
5bfcf5bbf99b        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-nova-api:latest                  <span class="token string">"kolla_start"</span>            <span class="token number">24</span> months ago       Up <span class="token number">35</span> hours                                   nova_metadata
457d4ace92a0        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-nova-api:latest                  <span class="token string">"kolla_start"</span>            <span class="token number">24</span> months ago       Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>                       nova_api
3a98c43a04f7        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-nova-scheduler:latest            <span class="token string">"kolla_start"</span>            <span class="token number">24</span> months ago       Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>                       nova_scheduler
35f522ad5783        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-nova-novncproxy:latest           <span class="token string">"kolla_start"</span>            <span class="token number">24</span> months ago       Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>                       nova_vnc_proxy
eb5d4133cd70        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-nova-consoleauth:latest          <span class="token string">"kolla_start"</span>            <span class="token number">24</span> months ago       Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>                       nova_consoleauth
a39f81aa4a8b        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-nova-api:latest                  <span class="token string">"kolla_start"</span>            <span class="token number">24</span> months ago       Up <span class="token number">35</span> hours                                   nova_api_cron
8ffb511c9318        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-nova-conductor:latest            <span class="token string">"kolla_start"</span>            <span class="token number">24</span> months ago       Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>                       nova_conductor
53d487974cc1        <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-nova-placement-api:latest        <span class="token string">"kolla_start"</span>            <span class="token number">24</span> months ago       Up <span class="token number">35</span> hours

<span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">ps</span> -a --format<span class="token operator">=</span><span class="token string">"{<!-- -->{.Names}}<span class="token entity" title="\t">\t</span>{<!-- -->{.Status}}"</span> <span class="token operator">|</span> <span class="token function">grep</span> nova
nova_api_discover_hosts	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
nova_metadata	Up <span class="token number">35</span> hours
nova_api	Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>
nova_scheduler	Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>
nova_vnc_proxy	Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>
nova_consoleauth	Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>
nova_api_cron	Up <span class="token number">35</span> hours
nova_conductor	Up <span class="token number">35</span> hours <span class="token punctuation">(</span>unhealthy<span class="token punctuation">)</span>
nova_db_sync	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
nova_api_ensure_default_cell	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
nova_api_map_cell0	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
nova_placement	Up <span class="token number">35</span> hours
nova_api_db_sync	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
nova_placement_init_log	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
nova_metadata_init_log	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
nova_api_init_logs	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
</code></pre> 
<p><strong>注意：当特定服务启动、执行其必要的任务，然后退出时，会出现退出Exited状态。它不会推断该服务存在任何类型的问题。状态为Exited的容器留在内存中，以便可以访问它们的日志文件和配置。</strong></p> 
<hr> 
<p>–filter选项用于减少docker ps命令的输出。有许多参数可以与筛选器选项一起使用。示例参数包括名称、运行状况和状态。为了更好地管理输出，可以组合使用–filter和–format选项。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">ps</span> --filter <span class="token assign-left variable">status</span><span class="token operator">=</span>running --format<span class="token operator">=</span><span class="token string">"{<!-- -->{.ID}}<span class="token entity" title="\t">\t</span>{<!-- -->{.Names}}<span class="token entity" title="\t">\t</span>{<!-- -->{.Status}}"</span>
93d806a63af1	openstack-manila-share-docker-0	Up <span class="token number">35</span> hours
bb5228ae1d0a	openstack-cinder-volume-docker-0	Up <span class="token number">35</span> hours
9314ea858667	ovn-dbs-bundle-docker-0	Up <span class="token number">35</span> hours
b5b9a671dbbd	haproxy-bundle-docker-0	Up <span class="token number">35</span> hours
28bfeb90f1b5	redis-bundle-docker-0	Up <span class="token number">35</span> hours
9b470324ad68	galera-bundle-docker-0	Up <span class="token number">35</span> hours
2c297a0596f3	ceph-mgr-controller0	Up <span class="token number">36</span> hours
40fd01c5c03e	ceph-mds-controller0	Up <span class="token number">36</span> hours
66a57bd58a9b	ceph-mon-controller0	Up <span class="token number">36</span> hours
………

<span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">docker</span> <span class="token function">ps</span> --filter <span class="token assign-left variable">status</span><span class="token operator">=</span>running --format<span class="token operator">=</span><span class="token string">"{<!-- -->{.ID}}<span class="token entity" title="\t">\t</span>{<!-- -->{.Names}}<span class="token entity" title="\t">\t</span>{<!-- -->{.Status}}"</span> <span class="token operator">|</span> <span class="token function">grep</span> horizon
0f4f1f8f772a	horizon	Up <span class="token number">36</span> hours
</code></pre> 
<hr> 
<h5><a id="docker_stats_202"></a>📑docker stats</h5> 
<p>docker stats命令显示特定容器的资源使用情况的实时统计数据。可以将stats命令与Linux平台上的top命令进行比较。您可以将一个空格分隔的容器列表传递给docker stats命令，以查询多个容器。可以查询状态为已停止和已退出的容器，但不会返回数据。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@demo -<span class="token punctuation">]</span><span class="token comment"># docker stats nova_api keystone</span>
</code></pre> 
<hr> 
<h5><a id="docker_images_212"></a>📑docker images</h5> 
<p>使用docker images命令来显示镜像仓库名称。所有可用镜像的大小、tags、镜像id和创建日期。添加image-name选项，以只显示来自指定的仓库。还可以使用–format选项定制输出。latest 标记会自动附加到每个仓库镜像的最高版本。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">docker</span> images
REPOSITORY                                                      TAG                 IMAGE ID            CREATED             SIZE
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-api                latest              f7d7cbcfa600        <span class="token number">2</span> years ago         <span class="token number">991</span> MB
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-volume             latest              e7a690608f11        <span class="token number">2</span> years ago         <span class="token number">1.02</span> GB
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-volume             pcmklatest          e7a690608f11        <span class="token number">2</span> years ago         <span class="token number">1.02</span> GB
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-scheduler          latest              6d0b487a321a        <span class="token number">2</span> years ago         <span class="token number">908</span> MB
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-glance-api                latest              bc037202b6b2        <span class="token number">2</span> years ago         <span class="token number">887</span> MB
<span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">docker</span> images <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-api
REPOSITORY                                         TAG                 IMAGE ID            CREATED             SIZE
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-api   latest              f7d7cbcfa600        <span class="token number">2</span> years ago         <span class="token number">991</span> MB
<span class="token punctuation">[</span>heat-admin@controller0 ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">docker</span> images <span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-api --format<span class="token operator">=</span><span class="token string">"{<!-- -->{.Repository}}<span class="token entity" title="\t">\t</span>{<!-- -->{.Tag}}"</span> 
<span class="token number">172.25</span>.249.200:8787/rhosp13/openstack-cinder-api	latest
</code></pre> 
<hr> 
<h5><a id="docker_inspect_233"></a>📑docker inspect</h5> 
<p>docker inspect命令检查容器的配置。结果以JSON格式呈现。可以从JSON输出中提取任何字段。使用jq命令过滤JSON输出。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller0 ~<span class="token punctuation">]</span><span class="token comment"># docker inspect horizon</span>
<span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Id"</span><span class="token builtin class-name">:</span> <span class="token string">"0f4f1f8f772aac108cb094f33d18d370947a1a25e271c23f82258da7cb7ccf30"</span>,
        <span class="token string">"Created"</span><span class="token builtin class-name">:</span> <span class="token string">"2018-10-23T15:06:03.128216544Z"</span>,
        <span class="token string">"Path"</span><span class="token builtin class-name">:</span> <span class="token string">"kolla_start"</span>,
        <span class="token string">"Args"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"State"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Status"</span><span class="token builtin class-name">:</span> <span class="token string">"running"</span>,
            <span class="token string">"Running"</span><span class="token builtin class-name">:</span> true,
            <span class="token string">"Paused"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Restarting"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"OOMKilled"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Dead"</span><span class="token builtin class-name">:</span> false,
            <span class="token string">"Pid"</span><span class="token builtin class-name">:</span> <span class="token number">5075</span>,
            <span class="token string">"ExitCode"</span><span class="token builtin class-name">:</span> <span class="token number">0</span>,
            <span class="token string">"Error"</span><span class="token builtin class-name">:</span> <span class="token string">""</span>,
            <span class="token string">"StartedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2020-10-12T16:20:38.841251452Z"</span>,
            <span class="token string">"FinishedAt"</span><span class="token builtin class-name">:</span> <span class="token string">"2020-10-12T16:19:27.369012909Z"</span>
        <span class="token punctuation">}</span>,
…………
<span class="token punctuation">[</span>root@controller0 ~<span class="token punctuation">]</span><span class="token comment"># docker inspect horizon | jq .[0].Mounts</span>
<span class="token punctuation">[</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token string">"Propagation"</span><span class="token builtin class-name">:</span> <span class="token string">"rprivate"</span>,
    <span class="token string">"RW"</span><span class="token builtin class-name">:</span> false,
    <span class="token string">"Mode"</span><span class="token builtin class-name">:</span> <span class="token string">"ro"</span>,
    <span class="token string">"Destination"</span><span class="token builtin class-name">:</span> <span class="token string">"/etc/ssh/ssh_known_hosts"</span>,
    <span class="token string">"Source"</span><span class="token builtin class-name">:</span> <span class="token string">"/etc/ssh/ssh_known_hosts"</span>,
    <span class="token string">"Type"</span><span class="token builtin class-name">:</span> <span class="token string">"bind"</span>
  <span class="token punctuation">}</span>,
…………

<span class="token comment"># 要显示hosts path实例参数的值，请使用--format选项。</span>
<span class="token punctuation">[</span>root@controller0 ~<span class="token punctuation">]</span><span class="token comment"># docker inspect --format="{<!-- -->{.HostsPath}}"  horizon</span>
/etc/hosts
</code></pre> 
<hr> 
<h5><a id="docker_logs_278"></a>📑docker logs</h5> 
<p>docker logs命令显示STDOUT的启动输出。此命令仅适用于由日志记录驱动程序启动的容器。docker 1ogs命令支持一系列选项。–since选项显示在给定日期之后生成的容器日志。–tail选项显示日志文件末尾指定的行数。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller0 ~<span class="token punctuation">]</span><span class="token comment"># docker logs horizon</span>
<span class="token punctuation">[</span>Mon Oct <span class="token number">12</span> <span class="token number">16</span>:23:49.569171 <span class="token number">2020</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>so:warn<span class="token punctuation">]</span> <span class="token punctuation">[</span>pid <span class="token number">1</span><span class="token punctuation">]</span> AH01574: module systemd_module is already loaded, skipping
<span class="token punctuation">[</span>Mon Oct <span class="token number">12</span> <span class="token number">16</span>:23:49.570745 <span class="token number">2020</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>so:warn<span class="token punctuation">]</span> <span class="token punctuation">[</span>pid <span class="token number">1</span><span class="token punctuation">]</span> AH01574: module cgi_module is already loaded, skipping
<span class="token punctuation">[</span>Mon Oct <span class="token number">12</span> <span class="token number">16</span>:23:49.571331 <span class="token number">2020</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>so:warn<span class="token punctuation">]</span> <span class="token punctuation">[</span>pid <span class="token number">1</span><span class="token punctuation">]</span> AH01574: module wsgi_module is already loaded, skipping
<span class="token punctuation">[</span>Mon Oct <span class="token number">12</span> <span class="token number">16</span>:23:49.589953 <span class="token number">2020</span><span class="token punctuation">]</span> <span class="token punctuation">[</span>alias:warn<span class="token punctuation">]</span> <span class="token punctuation">[</span>pid <span class="token number">1</span><span class="token punctuation">]</span> AH00671: The Alias directive <span class="token keyword">in</span> /etc/httpd/conf.d/autoindex.conf at line <span class="token number">21</span> will probably never match because it overlaps an earlier Alias.
</code></pre> 
<p><strong>注意：当容器被停止时，它们仍然留在内存中。此行为允许管理员在容器停止运行后对容器日志进行故障排除。</strong></p> 
<hr> 
<h5><a id="docker_exec_294"></a>📑docker exec</h5> 
<p>要访问容器，使用docker exec命令启动/bin/bash。这提供了一个bash提示符，可以从该提示符直接在容器本身中运行命令。容器必须已经启动并运行，才能在其中执行进一步的命令。暂停或停止的容器将返回一个错误。该命令在容器的默认目录中执行。或者，您可以在容器中以非交互方式运行命令。</p> 
<p>docker exec命令需要-i或交互式选项。–detach选项在后台运行该命令。要设置环境变量，请使用–env选项。一起运行一串命令，使用shell构造。例如docker-compose exec sh -c ' &amp;&amp; &amp;&amp; ’</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller0 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -it keystone /bin/bash</span>
<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>root@controller0 /<span class="token punctuation">]</span><span class="token comment"># ls</span>
bin   dev  home  lib64  mnt        opt   root  run_command  srv  tmp  var
boot  etc  lib   media  openstack  proc  run   sbin         sys  usr

<span class="token punctuation">[</span>root@controller0 ~<span class="token punctuation">]</span><span class="token comment"># docker exec -t keystone /openstack/healthcheck</span>
<span class="token punctuation">{<!-- --></span><span class="token string">"versions"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">"values"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"status"</span><span class="token builtin class-name">:</span> <span class="token string">"stable"</span>, <span class="token string">"updated"</span><span class="token builtin class-name">:</span> <span class="token string">"2018-02-28T00:00:00Z"</span>, <span class="token string">"media-types"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"base"</span><span class="token builtin class-name">:</span> <span class="token string">"application/json"</span>, <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"application/vnd.openstack.identity-v3+json"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>, <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token string">"v3.10"</span>, <span class="token string">"links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"href"</span><span class="token builtin class-name">:</span> <span class="token string">"http://controller0.internalapi.overcloud.example.com:5000/v3/"</span>, <span class="token string">"rel"</span><span class="token builtin class-name">:</span> <span class="token string">"self"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span>, <span class="token punctuation">{<!-- --></span><span class="token string">"status"</span><span class="token builtin class-name">:</span> <span class="token string">"deprecated"</span>, <span class="token string">"updated"</span><span class="token builtin class-name">:</span> <span class="token string">"2016-08-04T00:00:00Z"</span>, <span class="token string">"media-types"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"base"</span><span class="token builtin class-name">:</span> <span class="token string">"application/json"</span>, <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"application/vnd.openstack.identity-v2.0+json"</span><span class="token punctuation">}</span><span class="token punctuation">]</span>, <span class="token string">"id"</span><span class="token builtin class-name">:</span> <span class="token string">"v2.0"</span>, <span class="token string">"links"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span><span class="token string">"href"</span><span class="token builtin class-name">:</span> <span class="token string">"http://controller0.internalapi.overcloud.example.com:5000/v2.0/"</span>, <span class="token string">"rel"</span><span class="token builtin class-name">:</span> <span class="token string">"self"</span><span class="token punctuation">}</span>, <span class="token punctuation">{<!-- --></span><span class="token string">"href"</span><span class="token builtin class-name">:</span> <span class="token string">"https://docs.openstack.org/"</span>, <span class="token string">"type"</span><span class="token builtin class-name">:</span> <span class="token string">"text/html"</span>, <span class="token string">"rel"</span><span class="token builtin class-name">:</span> <span class="token string">"describedby"</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token number">300</span> <span class="token number">172.24</span>.1.1:5000 <span class="token number">0.021</span> seconds
</code></pre> 
<p>使用docker命令stop、start和restart来控制容器的运行。使用docker ps命令来验证容器的状态。</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@controller0 ~<span class="token punctuation">]</span><span class="token comment"># docker stop horizon</span>
<span class="token punctuation">[</span>root@controller0 ~<span class="token punctuation">]</span><span class="token comment"># docker ps -a --format="{<!-- -->{.Names}}\t{<!-- -->{.Status}}" | grep horizon</span>
horizon	Up About an hour
horizon_fix_perms	Exited <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token number">24</span> months ago
</code></pre> 
<hr> 
<h4><a id="_322"></a>📜日志文件和配置文件</h4> 
<h5><a id="_324"></a>📑日志文件位置</h5> 
<p>以前版本的Red Hat OpenStack将log文件存储在/var/log/service-name中，例如/var/log/cinder。在容器化架构中，日志文件存储在/var/log/containers/service-name中，例如/var/log/containers/ cinder。</p> 
<p><strong>注意：在容器化架构中，/var/log/service日志目录仍然存在，但是除了名为readme.txt的文件外，这些目录都是空的。</strong></p> 
<hr> 
<h5><a id="_332"></a>📑配置文件位置</h5> 
<p>与日志文件一样，配置文件也改变了位置。以前它们存储在/ etc/service中。在容器化体系结构中，配置存储在 /var/lib/config-data/puppet-generated/service-name目录中。</p> 
<p><strong>注意：/etc/service目录仍然存在，并且包含该服务的配置文件。但是，重要的是要知道，在这些配置文件中所做的任何更改都不会改变docker容器的配置。所有容器配置更改必须使用/ var/lib/config-data/puppet-generated/service/etc/service中的配置文件进行。</strong></p> 
<hr> 
<h4><a id="_340"></a>📜课本练习</h4> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>student@workstation ~<span class="token punctuation">]</span>$ lab architecture-containerization setup 
Setting up workstation <span class="token keyword">for</span> lab exercise work:

 <span class="token builtin class-name">.</span> Verifying <span class="token function">node</span> reachable: director<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>  SUCCESS
 <span class="token builtin class-name">.</span> Verifying <span class="token function">node</span> reachable: controller0<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.  SUCCESS
</code></pre> 
<p>章节内容已有相关演示，就不再进行操作。</p> 
<hr> 
<h3><a id="_354"></a>💡总结</h3> 
<p>RHCA认证需要经历5门的学习与考试，还是需要花不少时间去学习与备考的，好好加油，可以噶🤪。</p> 
<p><img src="https://images2.imgbox.com/2f/6c/YKia0xOP_o.png" alt=""></p> 
<p>以上就是【金鱼哥】对 <strong>第一章 红帽OpenStack平台架构–介绍容器服务</strong> 的简述和讲解。希望能对看到此文章的小伙伴有所帮助。</p> 
<blockquote> 
 <p>💾<strong>红帽认证</strong>专栏系列：<br> RHCSA专栏：<a href="https://blog.csdn.net/qq_41765918/category_11687066.html">戏说 RHCSA 认证</a><br> RHCE专栏：<a href="https://blog.csdn.net/qq_41765918/category_11687098.html">戏说 RHCE 认证</a><br> 此文章收录在RHCA专栏：<a href="https://blog.csdn.net/qq_41765918/category_11532281.html">RHCA 回忆录</a></p> 
</blockquote> 
<p>如果这篇【文章】有帮助到你，希望可以给【金鱼哥】点个赞👍，创作不易，相比官方的陈述，我更喜欢用【通俗易懂】的文笔去讲解每一个知识点。</p> 
<p>如果有对【运维技术】感兴趣，也欢迎关注❤️❤️❤️ 【金鱼哥】❤️❤️❤️，我将会给你带来巨大的【收获与惊喜】💕💕！</p> 
<p><img src="https://images2.imgbox.com/4c/41/2K5wAEBp_o.png" alt=""></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a3674eccf77e3b0c2ea80e8248a5731f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">warn - Attempted to load @next/swc-darwin-x64, but it was not installed</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9cb4cf75ea51b795c6d83fbd14fef010/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VMware安装Windows11专业版详细教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>