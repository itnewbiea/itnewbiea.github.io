<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>新一代爬取JavaScript渲染页面的利器-playwright（一） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="新一代爬取JavaScript渲染页面的利器-playwright（一）" />
<meta property="og:description" content="Playwright的使用 Playwright是微软在2020年初开源的一款新一代自动化测试工具，其功能和**Selenium**、Pyppeteer类似，都可以驱动浏览器进行自动化操作，但是也具备了Selenium、Pyppeteer不具备的更好的API，是新一代爬取JavaScrip渲染页面的利器。
1.Playwright的特点 Playwright支持当前所有的主流浏览器，提供完善的自动化控制API。Playwright支持移动端页面测试，使用设备模拟技术，可以在移动web浏览器中测试响应式的web应用程序。Playwright支持所有浏览器的无头模式和非无头模式。Playwright安装配置比较简单，安装过程中会自动安装对应的驱动，无需额外配置WebDriver等。Playwright提供和自动等待相关的API，在页面加载时会自动等待对应的节点加载，大大减少了API编写的复杂度。 2.安装 首先，确保python版本大于或等于3.7。
pip3 install playwright 安装完成后执行初始化操作。
playwright install 这是会自动安装Chromium、Firefox、WebKit浏览器和一些驱动。
3。基本使用 Playwright支持两种编写模式，一种是和Pyppetter一样的异步模式，一种是和Selenium一样的同步模式，可以根据不同的实际需求来进行选择。
# 同步模式 # 调用了sync_playwright方法，该方法返回值是PlaywrightContext,可以理解为浏览器上下文管理器 from playwright.sync_api import sync_playwright with sync_playwright() as p: for browser_type in [p.chromium,p.firefox,p.webkit]: # 不把lauch的headless设置为False，默认为无头浏览器 browser = browser_type.launch(headless=False) # 新建选项卡，返回page对象 page = browser.new_page() page.goto(&#39;http://www.baidu.com/&#39;) # 截图并定义文件名称 page.screenshot(path=f&#39;screenshot-{browser_type.name}.png&#39;) # title方法返回页面标题 print(page.title()) browser.close() 运行上面代码可以看到chromium、firefox、webkit三个浏览器依次启动，启动后加载百度首页，加载完成后生成截图，然后打印页面标题到控制台。
当然，除了同步模式，playwright还提供了支持异步模式的API，如果项目中使用了asyncio关键字，就应该使用异步模式。
import asyncio from playwright.async.api import async_playwright async def main(): async with async_playwright() as p: for browser_type in [p.chromium,p.firefox,p.webkit]: browser = await browser_type." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/592d3b7c6fe004ad5679af5a58f958f8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T17:23:06+08:00" />
<meta property="article:modified_time" content="2024-01-04T17:23:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">新一代爬取JavaScript渲染页面的利器-playwright（一）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Playwright_0"></a>Playwright的使用</h2> 
<p>  <strong>Playwright</strong>是微软在2020年初开源的一款新一代自动化测试工具，其功能和**<a href="https://blog.csdn.net/chen626721/article/details/135188440">Selenium</a>**、<strong>Pyppeteer</strong>类似，都可以驱动浏览器进行自动化操作，但是也具备了Selenium、Pyppeteer不具备的更好的API，是新一代爬取JavaScrip渲染页面的利器。</p> 
<h3><a id="1Playwright_2"></a>1.Playwright的特点</h3> 
<ul><li>Playwright支持当前所有的主流浏览器，提供完善的自动化控制API。</li><li>Playwright支持移动端页面测试，使用设备模拟技术，可以在移动web浏览器中测试响应式的web应用程序。</li><li>Playwright支持所有浏览器的无头模式和非无头模式。</li><li>Playwright安装配置比较简单，安装过程中会自动安装对应的驱动，无需额外配置WebDriver等。</li><li>Playwright提供和自动等待相关的API，在页面加载时会自动等待对应的节点加载，大大减少了API编写的复杂度。</li></ul> 
<h3><a id="2_9"></a>2.安装</h3> 
<p>  首先，确保python版本大于或等于3.7。</p> 
<pre><code class="prism language-python">pip3 install playwright
</code></pre> 
<p>  安装完成后执行初始化操作。</p> 
<pre><code class="prism language-python">playwright install
</code></pre> 
<p>  这是会自动安装Chromium、Firefox、WebKit浏览器和一些驱动。</p> 
<h4><a id="3_21"></a>3。基本使用</h4> 
<p>  Playwright支持两种编写模式，一种是和Pyppetter一样的异步模式，一种是和Selenium一样的同步模式，可以根据不同的实际需求来进行选择。</p> 
<pre><code class="prism language-python"><span class="token comment"># 同步模式</span>
<span class="token comment"># 调用了sync_playwright方法，该方法返回值是PlaywrightContext,可以理解为浏览器上下文管理器</span>
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> sync_playwright

<span class="token keyword">with</span> sync_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
    <span class="token keyword">for</span> browser_type <span class="token keyword">in</span> <span class="token punctuation">[</span>p<span class="token punctuation">.</span>chromium<span class="token punctuation">,</span>p<span class="token punctuation">.</span>firefox<span class="token punctuation">,</span>p<span class="token punctuation">.</span>webkit<span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token comment"># 不把lauch的headless设置为False，默认为无头浏览器</span>
        browser <span class="token operator">=</span> browser_type<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
        <span class="token comment"># 新建选项卡，返回page对象</span>
        page <span class="token operator">=</span> browser<span class="token punctuation">.</span>new_page<span class="token punctuation">(</span><span class="token punctuation">)</span>
        page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com/'</span><span class="token punctuation">)</span>
        <span class="token comment"># 截图并定义文件名称</span>
        page<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span>path<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'screenshot-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>browser_type<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">.png'</span></span><span class="token punctuation">)</span>
        <span class="token comment"># title方法返回页面标题</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>  运行上面代码可以看到chromium、firefox、webkit三个浏览器依次启动，启动后加载百度首页，加载完成后生成截图，然后打印页面标题到控制台。<br>   当然，除了同步模式，playwright还提供了支持异步模式的API，如果项目中使用了asyncio关键字，就应该使用异步模式。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> asyncio
<span class="token keyword">from</span> playwright<span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">.</span>api <span class="token keyword">import</span> async_playwright

<span class="token keyword">async</span> <span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">async</span> <span class="token keyword">with</span> async_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
        <span class="token keyword">for</span> browser_type <span class="token keyword">in</span> <span class="token punctuation">[</span>p<span class="token punctuation">.</span>chromium<span class="token punctuation">,</span>p<span class="token punctuation">.</span>firefox<span class="token punctuation">,</span>p<span class="token punctuation">.</span>webkit<span class="token punctuation">]</span><span class="token punctuation">:</span>
            browser <span class="token operator">=</span> <span class="token keyword">await</span> browser_type<span class="token punctuation">.</span>launch<span class="token punctuation">(</span><span class="token punctuation">)</span>
            page <span class="token operator">=</span> <span class="token keyword">await</span> browser<span class="token punctuation">.</span>new_page<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string">'https://www.baidu.com'</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> page<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span>path<span class="token operator">=</span><span class="token string-interpolation"><span class="token string">f'screenshot-</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>browser_type<span class="token punctuation">.</span>name<span class="token punctuation">}</span></span><span class="token string">.png'</span></span><span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token keyword">await</span> page<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">await</span> browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>

asyncio<span class="token punctuation">.</span>run<span class="token punctuation">(</span>main<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>  可以看到和同步模式基本一样，只不过导入方法改为async_playwright方法，不再是sync_playwright<br> 方法，以及添加了async/await关键字，最后运行的效果是一样的。<br>   <strong>(对于async和await关键字的使用可以参考，<a href="https://blog.csdn.net/chen626721/article/details/135339549">异步爬虫-协程的基本使用</a>这篇文章。)</strong></p> 
<h3><a id="4_66"></a>4.代码生成</h3> 
<p>  playwright还有一个强大的功能，那就是可以录制我们在浏览器当中的操作并且生成相对应的代码。这个功能可以通过playwright命令行调用codegen实现。比如输入以下命令：</p> 
<pre><code class="prism language-python">playwright codegen <span class="token operator">-</span><span class="token operator">-</span><span class="token builtin">help</span>
</code></pre> 
<p>结果如下：<br> <img src="https://images2.imgbox.com/fb/f2/VRGM557f_o.png" alt="在这里插入图片描述"><br>   了解这些后我们可以尝试启动一个Firebox浏览器，然后将操作结果输出到script.py文件中。命令如下：</p> 
<pre><code class="prism language-python">playwright codegen <span class="token operator">-</span>o script<span class="token punctuation">.</span>py <span class="token operator">-</span>b firebox
</code></pre> 
<p>  运行后会弹出一个Firebox浏览器，右侧有个脚本窗口。<br> <img src="https://images2.imgbox.com/20/a3/75bxQVpY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c9/db/S2S3SiBI_o.png" alt="在这里插入图片描述"><br>   我们在弹出的浏览器打开百度，在搜索框输入nba，然后点击搜索，这时脚本窗口就会生成如下代码。而且我们可以看到会高亮显示我们正在操作的节点。</p> 
<p>  在我们操作浏览器的过程中，该窗口的代码会跟着实时变化。所有操作完毕后，关闭浏览器，playwright会生成目标文件，内容如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> Playwright<span class="token punctuation">,</span> sync_playwright<span class="token punctuation">,</span> expect


<span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>playwright<span class="token punctuation">:</span> Playwright<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
    browser <span class="token operator">=</span> playwright<span class="token punctuation">.</span>firefox<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    context <span class="token operator">=</span> browser<span class="token punctuation">.</span>new_context<span class="token punctuation">(</span><span class="token punctuation">)</span>
    page <span class="token operator">=</span> context<span class="token punctuation">.</span>new_page<span class="token punctuation">(</span><span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string">"https://www.baidu.com/"</span><span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>locator<span class="token punctuation">(</span><span class="token string">"#kw"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fill<span class="token punctuation">(</span><span class="token string">"nba"</span><span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>get_by_role<span class="token punctuation">(</span><span class="token string">"button"</span><span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">"百度一下"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>click<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment"># ---------------------</span>
    context<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">with</span> sync_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> playwright<span class="token punctuation">:</span>
    run<span class="token punctuation">(</span>playwright<span class="token punctuation">)</span>


</code></pre> 
<p>  由此可见，有了代码生成功能，只通过简单的可视化点击操作就能生成代码，可谓非常方便。<br>   但是，观察生成的代码就会发现，这里的new_page不是通过browser调用的，而是通过context，这个context是由browser调用new_context方法生成的。这里context变量是一个BrowserContext对象，这是一个类似隐身模式的独立上下文环境，其运行资源是单独隔离的。在一些自动化测试中，我们可以为每个测试用例单独创建一个BrowserContext对象，这样可以保障各个测试用例之间互不干扰。</p> 
<h3><a id="5_111"></a>5.支持移动端浏览器</h3> 
<p>  Playwright另一个特色就是可以支持模拟移动端浏览器，例如模拟打开iphone 13 Pro上的Safari浏览器。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> playwright<span class="token punctuation">.</span>sync_api <span class="token keyword">import</span> sync_playwright

<span class="token keyword">with</span> sync_playwright<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> p<span class="token punctuation">:</span>
    iphone_13_pro <span class="token operator">=</span> p<span class="token punctuation">.</span>devices<span class="token punctuation">[</span><span class="token string">'iPhone 13 Pro'</span><span class="token punctuation">]</span>
    browser <span class="token operator">=</span> p<span class="token punctuation">.</span>webkit<span class="token punctuation">.</span>launch<span class="token punctuation">(</span>headless<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    context <span class="token operator">=</span> browser<span class="token punctuation">.</span>new_context<span class="token punctuation">(</span>
        <span class="token operator">**</span>iphone_13_pro<span class="token punctuation">,</span>
        locale<span class="token operator">=</span><span class="token string">'zh-CN'</span>
    <span class="token punctuation">)</span>
    page <span class="token operator">=</span> context<span class="token punctuation">.</span>new_page<span class="token punctuation">(</span><span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>goto<span class="token punctuation">(</span><span class="token string">'https://www.whatismybrowser.com/'</span><span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>wait_for_load_state<span class="token punctuation">(</span>state<span class="token operator">=</span><span class="token string">'networkidle'</span><span class="token punctuation">)</span>
    page<span class="token punctuation">.</span>screenshot<span class="token punctuation">(</span>path<span class="token operator">=</span><span class="token string">'browser-iphone.png'</span><span class="token punctuation">)</span>
    browser<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>  运行代码后我们就会发现，弹出一个浏览器窗口，然后加载出了对应页面。<br> <img src="https://images2.imgbox.com/89/16/POe4EfUR_o.png" alt="在这里插入图片描述"><br>   这里我们先用PlaywrightContextManager对象的devices属性指定了一台移动设备，参数为设备的型号。<br>   我们创建了一个移动端BrowserContext对象初始化一些设备的信息等，最后把返回的BrowserContext赋值给context变量。<br>   接着，调用context的new_page方法创建一个新的选项卡，调动wait_for_load_state方法等待页面某个状态完成。netwoidle指网络空闲状态，即当前页面初始化和数据加载完成。</p> 
<p><strong>关于页面节点选择器得使用放在下个文章。<br> <a href="https://blog.csdn.net/chen626721/article/details/135374491">新一代爬取JavaScript渲染页面的利器-playwright（二）</a></strong></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/86353c410cc938ab1b6355b0c1049fc3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">新一代爬取JavaScript渲染页面的利器-playwright（二）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c17df543ec27add8e375f7cc355bdb6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">入门Python笔记详细介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>