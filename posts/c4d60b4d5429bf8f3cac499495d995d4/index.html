<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>platform下的js分析_3 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="platform下的js分析_3" />
<meta property="og:description" content="目录
主要包含 CCSAXParser.js CCSAXParser.jspreprocess-class.jsCCClass.js CCClass.js中 使用较多的函数. 主要包含 CCSAXParser.js CCSAXParser.js 主要用于 解析 xml
如: cocos2d/tilemap/CCTMXXMLParser.js 文件中解析 tilemap的方法.
具体解析方式见 其中的 parseXMLString (xmlStr, tilesetFirstGid) 方法.
preprocess-class.js 增加预处理属性这个步骤的目的是降低 CCClass 的实现难度，将比较稳定的通用逻辑和一些需求比较灵活的属性需求分隔开。
主要方法是 preprocessAttrs(properties, className, cls, es6) 这个方法.
SerializableAttrs
表示可序列话的属性
parseNotify (val, propName, notify, properties)
处理 properties 中, 属性为 propName 中的 notify 参数.
参见 https://docs.cocos.com/creator/2.1/manual/zh/scripting/reference/attributes.html
checkUrl (val, className, propName, url)
检查 url 属性
parseType (val, type, className, propName)
检查 type 属性
postCheckType (val, type, className, propName)" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c4d60b4d5429bf8f3cac499495d995d4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-05T18:46:08+08:00" />
<meta property="article:modified_time" content="2019-07-05T18:46:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">platform下的js分析_3</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body cnblogs-markdown"> 
 <div class="toc"> 
  <p class="toc-title">目录</p> 
  <div class="toc-list"> 
   <ul><li><a href="#%E4%B8%BB%E8%A6%81%E5%8C%85%E5%90%AB-ccsaxparser.js" rel="nofollow">主要包含 CCSAXParser.js</a> 
     <ul><li><a href="#ccsaxparser.js" rel="nofollow">CCSAXParser.js</a></li><li><a href="#preprocess-class.js" rel="nofollow">preprocess-class.js</a></li><li><a href="#ccclass.js" rel="nofollow">CCClass.js</a> 
       <ul><li><a href="#ccclass.js%E4%B8%AD-%E4%BD%BF%E7%94%A8%E8%BE%83%E5%A4%9A%E7%9A%84%E5%87%BD%E6%95%B0." rel="nofollow">CCClass.js中 使用较多的函数.</a></li></ul></li></ul></li></ul> 
  </div> 
 </div> 
 <h2 id="主要包含-ccsaxparser.js">主要包含 CCSAXParser.js</h2> 
 <h3 id="ccsaxparser.js">CCSAXParser.js</h3> 
 <p>主要用于 解析 xml<br> 如: cocos2d/tilemap/CCTMXXMLParser.js 文件中解析 tilemap的方法.<br> 具体解析方式见 其中的 parseXMLString (xmlStr, tilesetFirstGid) 方法.</p> 
 <h3 id="preprocess-class.js">preprocess-class.js</h3> 
 <p>增加预处理属性这个步骤的目的是降低 CCClass 的实现难度，将比较稳定的通用逻辑和一些需求比较灵活的属性需求分隔开。<br> 主要方法是 preprocessAttrs(properties, className, cls, es6) 这个方法.</p> 
 <ol><li><p>SerializableAttrs<br> 表示可序列话的属性</p></li><li><p>parseNotify (val, propName, notify, properties)<br> 处理 properties 中, 属性为 propName 中的 notify 参数.<br> 参见 <a href="https://docs.cocos.com/creator/2.1/manual/zh/scripting/reference/attributes.html" rel="nofollow" class="uri">https://docs.cocos.com/creator/2.1/manual/zh/scripting/reference/attributes.html</a></p></li><li><p>checkUrl (val, className, propName, url)<br> 检查 url 属性</p></li><li><p>parseType (val, type, className, propName)<br> 检查 type 属性</p></li><li><p>postCheckType (val, type, className, propName)<br> type属性的后置 检查</p></li><li><p>getFullFormOfProperty (options, propname_dev, classname_dev)<br> 获得 properties[propname_dev] 的描述. 是一个对象,包含各种属性参数.</p></li><li><p>preprocessAttrs(properties, className, cls, es6)<br> 解析 CCClass() 参数中 properties属性时调用.</p></li><li><p>validateMethodWithProps(func, funcName, className, cls, base)<br> 检查 CCClass() 参数中 extends properties statics ctor是否正确.</p></li></ol> 
 <h3 id="ccclass.js">CCClass.js</h3> 
 <p>这是creator里面比较复杂的一个类. 这里简单过一次处理过程.<br> 处理流程如下:</p> 
 <pre><code>function CCClass (options) {
    options = options || {};

    var name = options.name;
    var base = options.extends/* || CCObject*/;
    var mixins = options.mixins;

    // create constructor
    var cls = define(name, base, mixins, options);
    if (!name) {
        name = cc.js.getClassName(cls);
    }

    cls._sealed = true;
    if (base) {
        base._sealed = false;
    }

    // define Properties
    var properties = options.properties;
    if (typeof properties === 'function' ||
        (base &amp;&amp; base.__props__ === null) ||
        (mixins &amp;&amp; mixins.some(function (x) {
            return x.__props__ === null;
        }))
    ) {
        if (CC_DEV &amp;&amp; options.__ES6__) {
            cc.error('not yet implement deferred properties for ES6 Classes');
        }
        else {
            deferredInitializer.push({cls: cls, props: properties, mixins: mixins});
            cls.__props__ = cls.__values__ = null;
        }
    }
    else {
        declareProperties(cls, name, properties, base, options.mixins, options.__ES6__);
    }

    // define statics
    var statics = options.statics;
    if (statics) {
        var staticPropName;
        if (CC_DEV) {
            for (staticPropName in statics) {
                if (INVALID_STATICS_DEV.indexOf(staticPropName) !== -1) {
                    cc.errorID(3642, name, staticPropName,
                        staticPropName);
                }
            }
        }
        for (staticPropName in statics) {
            cls[staticPropName] = statics[staticPropName];
        }
    }

    // define functions
    for (var funcName in options) {
        if (BUILTIN_ENTRIES.indexOf(funcName) &gt;= 0) {
            continue;
        }
        var func = options[funcName];
        if (!preprocess.validateMethodWithProps(func, funcName, name, cls, base)) {
            continue;
        }
        // use value to redefine some super method defined as getter
        js.value(cls.prototype, funcName, func, true, true);
    }


    var editor = options.editor;
    if (editor) {
        if (js.isChildClassOf(base, cc.Component)) {
            cc.Component._registerEditorProps(cls, editor);
        }
        else if (CC_DEV) {
            cc.warnID(3623, name);
        }
    }

    return cls;
}</code></pre> 
 <ol><li><p>define(name, base, mixins, options)<br> 此函数会调用 doDefine(className, baseClass, mixins, options) 函数,<br> 返回我们创建的 类的 constructor, 记作 cls.</p></li><li><p>declareProperties(cls, name, properties, base, options.mixins, options.__ES6__)<br> 此函数会使用 preprocess-class.js 里面的 preprocessAttrs(properties, className, cls, es6)方法,<br> 对 properties 进行处理. 然后将 properties 里面的属性 放到 cls.__props__ 数组里.</p></li><li><p>处理 statics 变量和函数.</p></li><li><p>处理普通 属性和函数.<br> 注意,这里面处理的普通属性是放到 cls.prototype 上.</p></li><li><p>处理 editor<br> 参考: <a href="https://docs.cocos.com/creator/2.1/manual/zh/scripting/class.html" rel="nofollow" class="uri">https://docs.cocos.com/creator/2.1/manual/zh/scripting/class.html</a></p></li></ol> 
 <h4 id="ccclass.js中-使用较多的函数.">CCClass.js中 使用较多的函数.</h4> 
 <ol><li>fastDefine</li></ol> 
 <pre><code>_fastDefine (className, constructor, serializableFields)

/*
此函数给 constructor 添加上__values__,__props__, __attrs__属性.
并且还会给 constructor.prototype 加上__classname__和__cid__ 属性.

Q1: 我们通过 cc.Class 创建的类,属性中__values__和__props__ 区别和用途.
__values__ 属性是 __props__ 的一个子集,__props__中包含所有的属性, __values__ 中包含所有可序列化的属性.
*/</code></pre> 
</div> 
<p>转载于:https://www.cnblogs.com/daihanlong/p/10328638.html</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4bba099d3575fa68aaef09c6f26ca767/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">angular入门--自定义过滤器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b9015254452a0850717d1144005ef1a2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">http://cnblogs.com/rickie/archive/2005/07/02/184927.aspx</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>