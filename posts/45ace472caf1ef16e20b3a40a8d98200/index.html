<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>IP组播配置与管理实战——1 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="IP组播配置与管理实战——1" />
<meta property="og:description" content="IGMP配置与管理
IGMP（InternetGroup Management Protocol，因特网组管理协议）是TCP/IP协议族中负责IPv4组播成员管理的协议，需要在组播组成员主机和与之相连的组播路由器上运行，用来在组播组成员主机和与其直接相邻的组播路由器之间建立、维护组播组成员关系。
IGMP有3个版本：IGMPv1版本（由RFC1112定义）、IGMPv2版本（由RFC2236定义）和IGMPv3（由RFC3376定义）版本。所有IGMP版本都支持ASM（任意源组播）。运行IGMPv3的主机可以直接应用于SSM（指定源组播）模型，而运行IGMPv1和IGMPv2的主机则需要与在IGMP交换机上运行的SSM Mapping结合才能应用于SSM模型中。
组播配置中，凡同时支持全局配置（即IGMP配置）和接口配置，则最终的配置生效原则如下：
（1）在IGMP视图下的配置全局有效，在接口视图下的配置只对该接口有效。
（2）如果接口视图和IGMP视图下都配置了命令，则优先选择接口视图下配置的值。接口视图下没有配置时，IGMP视图下配置的值有效。
（3）如果IGMP视图下配置非缺省值，则接口视图下配置的缺省值无效。
一、IGMP特性的产品支持
在交换机上配置IGMP协议时，可以配置的功能特性包括IGMP基本功能、IGMP性能调整（包括Router-Alert选项、IGMP查询控制器、快速离开和IGMP报文过滤等）、SSM-Mapping、IGMP组成员关系个数限制等。
IGMP是三层组播协议，需要运行在配置了IP地址的三层接口上，但华为S系列交换机的物理以太网端口是不能直接配置IP地址的，所有在配置IGMP协议时只能选择可以配置IP地址的VLANIF接口或Loopback接口（在S9300/9300E/9700中还支持POS接口和IP-Trunk接口）。本配置中，接口的配置一般选择VLANIF接口，但需要事先将对应的物理接口加入到该VLAN中。
1、IGMP基本功能
华为S系列交换机中的IGMP基本功能配置包括以下几个方面：
（1）IGMP版本配置：支持IGMPv1、IGMPv2和IGMPv3，版本可配置。交换机侧的高版本可以兼容主机侧的低版本。
（2）配置静态加入组播组：当网络中存在稳定的组播成员时，通过配置交换机用户侧接口静态加入指定的组播组，可以实现组播数据的快速、稳定转发。
（3）配置接口允许加入的组播组范围：通过在交换机用户侧对应接口上设置一个ACL规则作为过滤器，就可以限制该接口所服务的组播组范围，从而控制组播数据的安全发送。
2、IGMP性能调整
在IGMP性能调整方面，可配置以下功能：
（1）Router-Alert选项：配置设备仅接收包含Router-Alert选项的IGMP报文，提高安全性。
（2）查询器：对IGMP查询器的参数进行合理配置，既可以使成员关系得到及时的更新维护，又可以避免报文发送过多造成网络拥塞。
（3）快速离开：使IGMP协议可以快速响应成员主机的Leave（离开）报文。
（4）IGMPOn-Demand：可根据组播成员的实际需求维护组成员之间的关系，减少了报文交互，降低网络流量。
（5）IGMP报文过滤：可根据组播报文中源IP地址来过滤用户侧IGMP接口收到的IGMP报文，提高安全性。
3、SSM Mapping
SSM是一种在IGMPv3协议支持的情况下，能够在用户侧IGMP接口上指定组播源的传输服务。但有时组播组成员主机却只能运行IGMPv1或IGMPv2，这时就可以通过在交换机上配置SSM Mapping功能，向运行IGMPv1或IGMPv2的组成员提供SSM服务。
4、IGMP Limit
IGMP协议规定，成员可以在任意时间、任意位置、成员总数不受限制的加入或退出组播组。但是当大量用户同时收看多套节目时，需要占用组播设备的大量带宽，可能会造成组播性能下降。为避免这种情况的发生，交换机支持IGMP Limit功能，通过限制全局和用户侧IGMP接口下的组播组个数，使加入组播组的用户收看更加清晰稳定的节目。
二、配置IGMP基本功能
在成员主机和与之相连的交换机上配置IGMP，“使能IGMP功能”和“配置IGMP版本”为必选配置。
1、IGMP配置任务
通过在与用户网段相连的组播设备接口上使能IGMP基本功能，用户主机可以接入组播网络，接收组播报文。但在配置IGMP基本功能之前，需配置单播路由协议，使各节点间IP路由可达。主要配置任务如下：
（1）使能IGMP功能。配置IGMP协议之前，必须先使能IP组播路由功能，因为它是配置一切组播功能的前提。IGMP应该配置在与组成员相连的接口上。
（2）配置IGMP版本。运行IGMP高版本的交换机可以识别低版本的成员报告，但低版本的交换机不能识别高版本的成员报告。为了保证IGMP的正常运行，建议在交换机上配置与组播组成员主机上运行相同，或高于组播组成员主机的版本。
如果在主机侧共享网段上有多个交换机，由于不同版本的IGMP协议报文结构不同，为了保证IGMP的正常运行，必须在所有交换机接口配置相同的IGMP版本。
此项配置同时支持全局配置（即IGMP视图）和接口配置。
（3）（可选）配置静态组播组。在以下应用场景中，可在交换机的用户侧接口上配置静态组播组。
①网络中存在稳定的组播组成员。
②某网段内没有组播组成员或组播组成员主机无法发送Report报文，但是又需要将组播数据转发到该网段，可以在接口上配置静态组播组，将组播数据“拉”到接口上。
在接口上配置静态组播组后，交换机就认为此接口网段上一直存在该组播组的成员，从而转发改组的组播数据。
（4）（可选）配置接口加入的组播组范围。为了让IGMP接口所在网段的组播组成员主机加入指定的组播组，并接收这些组的报文，可以在该接口上设置ACL规则，对收到的成员Report报文进行过滤，使交换机只对该规则中允许的组播组维护组成员关系。
2、配置步骤
示例1：在与用户相连的VLANIF100接口（先要把对应物理接口加入VLAN100中）配置静态组播组224.1.1.1。
示例2：配置VLANIF100接口加入组播源IP地址为192.168.10.1，组播组IP地址为232.1.1.1的组播组（192.168.10.1,232.1.1.1）中。
示例3：配置VLANIF100接口加入以225.1.1.1位起始组播组IP地址，组播组地址递增掩码长度为8（相当于组播组子网掩码为255.255.255.0），组播组地址数量限制为10的批量组播组中。
示例4：配置VLANIF100接口加入以232.1.1.1位起始组播组IP地址，组播源IP地址为192.168.11.1，组播组地址递增掩码为0.0.255.255，组地址数量限制为10的批量组播组中。
示例5：创建编号为2005的ACL，允许主机接收来自组播组225.1.1.1的数据，然后在VLANIF100接口应用过滤策略，以限定该接口下的主机只能加入组播组225.1.1.1。
三、调整IGMP性能
使能IGMP后，缺省情况下可以正常工作。也可根据安全性和网络性能优化的要求适当调整相关参数。可以调整的IGMP性能参数包括以下几个方面
1、配置Router-Alert选项
通常情况下，网络设备收到报文时，只有目的IP地址为本设备接口地址的报文才会上送给相应的协议模块处理。这样就会存在一个问题，如果协议报文的目的地址不为本设备的接口地址，比如IGMP协议报文，由于其目的地址为组播地址，这种情况下就无法上送给IGMP协议模块处理，导致正常的组成员关系不能维护。为解决此类问题，Router-Alert选项应运而生。如果IP报文头携带Router-Alert选项，设备在接收到此类报文后会直接上送给相应的协议模块处理，而不检查目的地址。
缺省情况下，出于兼容性考虑，当前交换机在收到IGMP报文后，无论其IP报文头是否包含Router-Alert选项都会上送给IGMP协议模块处理。交换机在发送IGMP报文时，也可以选择是否需要携带Router-Alert选项。缺省情况下，组播设备发送的IGMP报文中携带Router-Alert选项。
——这里提到一个只有目的IP地址为本设备接口地址的报文才会上送给相应的协议模块处理，对于普通的IP报文，在经过路由器时，报文的目的地址应该不是设备接口的地址，难道不送给IP协议模块处理？
2、配置IGMP查询器参数
IGMP通过查询/响应报文维护组成员关系。当同一网段上有多台组播设备时，是由IGMP查询器负责发送IGMP查询报文，这时就需要指定IGMP查询器（在IGMPv1中，查询器是由PIM协议指定的，IGMPv2和IGMPv3可以手工配置）。
在实际配置中，要确保“IGMP查询报文最大响应时间”&lt;“IGMP普遍组查询报文发送间隔”&lt;“其他IGMP查询器存活时间”。在共享网段内，如果多台设备的用户侧接口都使能了IGMP，应确保设备上配置的查询器参数一致，否则有可能导致IGMP协议无法正常运行。
3、配置IGMP快速离开
在某些应用中，IGMP查询器的一个接口下只能连接着一台成员主机（这是前提条件），当主机需要在多个组播组间频繁切换时，为了快速响应主机的离开组报文，可以在IGMP查询器上配置IGMP快速离开功能。这样，当查询器收到来自主机的Leave（离开）报文时，不再发送特定组查询报文，而是直接向上游发送离开通告。这样可减小响应延迟，也节省网络带宽。
IGMP快速离开功能仅适用于IGMPv2和IGMPv3版本。
4、配置IGMP On-Demand
在标准的IGMP工作机制中，查询器通过周期性发送查询报文并接收成员反馈的Report和Leave报文来了解组播组成员信息，组成员收到查询时都会进行回应。为了减少这个过程中的报文交互，降低网络流量，可以在查询器上配置IGMP On-Demand功能。使能了IGMP On-Demand功能后，查询器可根据组播组成员的要求来维护成员关系，不再主动发送查询报文来收集成员状态。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/45ace472caf1ef16e20b3a40a8d98200/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-08T08:24:30+08:00" />
<meta property="article:modified_time" content="2019-05-08T08:24:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">IP组播配置与管理实战——1</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0cm;"><strong><span style="color:#FF0000;">IGMP</span></strong><strong><span style="color:#FF0000;">配置与管理</span></strong></p> 
<p style="margin-left:0cm;">IGMP（InternetGroup Management Protocol，因特网组管理协议）是<span style="color:#FF0000;">TCP/IP</span><span style="color:#FF0000;">协议族</span>中负责IPv4<span style="color:#FF0000;">组播成员管理</span>的协议，需要<span style="color:#FF0000;">在组播组成员主机和与之相连的组播路由器</span>上运行，用来在组播组成员主机和与其直接相邻的组播路由器之间建立、维护组播组成员关系。</p> 
<p style="margin-left:0cm;">IGMP有3个版本：IGMPv1版本（由RFC1112定义）、IGMPv2版本（由RFC2236定义）和IGMPv3（由RFC3376定义）版本。所有IGMP版本都支持ASM（任意源组播）。运行IGMPv3的主机可以直接应用于SSM（指定源组播）模型，而运行IGMPv1和IGMPv2的主机则需要与在IGMP交换机上运行的SSM Mapping结合才能应用于SSM模型中。</p> 
<p style="margin-left:0cm;">组播配置中，凡同时支持全局配置（即IGMP配置）和接口配置，则最终的配置生效原则如下：</p> 
<p style="margin-left:0cm;">（1）在IGMP视图下的配置全局有效，在接口视图下的配置只对该接口有效。</p> 
<p style="margin-left:0cm;">（2）如果接口视图和IGMP视图下都配置了命令，则优先选择接口视图下配置的值。接口视图下没有配置时，IGMP视图下配置的值有效。</p> 
<p style="margin-left:0cm;">（3）如果IGMP视图下配置非缺省值，则接口视图下配置的缺省值无效。</p> 
<p style="margin-left:0cm;"><strong>一、IGMP</strong><strong>特性的产品支持</strong></p> 
<p style="margin-left:0cm;">在<span style="color:#FF0000;">交换机</span>上配置IGMP协议时，可以配置的功能特性包括IGMP基本功能、IGMP性能调整（包括Router-Alert选项、IGMP查询控制器、快速离开和IGMP报文过滤等）、SSM-Mapping、IGMP组成员关系个数限制等。</p> 
<p style="margin-left:0cm;"><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">是三层组播协议</span>，<strong><span style="color:#FF0000;">需要运行在配置了</span></strong><strong><span style="color:#FF0000;">IP</span></strong><strong><span style="color:#FF0000;">地址的三层接口上</span></strong>，但华为S系列<span style="color:#FF0000;">交换机的物理以太网端口是不能直接配置</span><span style="color:#FF0000;">IP</span><span style="color:#FF0000;">地址</span>的，所有在配置IGMP协议时<span style="color:#FF0000;">只能选择可以配置</span><span style="color:#FF0000;">IP</span><span style="color:#FF0000;">地址的</span><span style="color:#FF0000;">VLANIF</span><span style="color:#FF0000;">接口或</span><span style="color:#FF0000;">Loopback</span><span style="color:#FF0000;">接口</span>（在S9300/9300E/9700中还支持POS接口和IP-Trunk接口）。本配置中，接口的配置一般选择VLANIF接口，但需要事先将对应的物理接口加入到该VLAN中。</p> 
<p style="margin-left:0cm;">1、IGMP基本功能</p> 
<p style="margin-left:0cm;">华为S系列<span style="color:#FF0000;">交换机中的</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">基本功能配置</span>包括以下几个方面：</p> 
<p style="margin-left:0cm;">（1）<span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">版本配置</span>：支持IGMPv1、IGMPv2和IGMPv3，版本可配置。交换机侧的高版本可以兼容主机侧的低版本。</p> 
<p style="margin-left:0cm;">（2）<span style="color:#FF0000;">配置静态加入组播组</span>：当网络中存在稳定的组播成员时，通过<span style="color:#FF0000;">配置交换机用户侧接口静态加入指定的组播组</span>，可以<span style="color:#FF0000;">实现组播数据的快速、稳定转发</span>。</p> 
<p style="margin-left:0cm;">（3）<span style="color:#FF0000;">配置接口允许加入的组播组范围</span>：通过在<span style="color:#FF0000;">交换机用户侧对应接口上设置一个</span><span style="color:#FF0000;">ACL</span><span style="color:#FF0000;">规则</span>作为过滤器，就可以限制该接口所服务的组播组范围，从而控制组播数据的安全发送。</p> 
<p style="margin-left:0cm;">2、IGMP性能调整</p> 
<p style="margin-left:0cm;">在IGMP性能调整方面，可配置以下功能：</p> 
<p style="margin-left:0cm;">（1）<span style="color:#FF0000;">Router-Alert</span><span style="color:#FF0000;">选项</span>：配置设备仅接收包含Router-Alert选项的IGMP报文，提高安全性。</p> 
<p style="margin-left:0cm;">（2）<span style="color:#FF0000;">查询器</span>：对IGMP查询器的参数进行合理配置，既可以使成员关系得到及时的更新维护，又可以避免报文发送过多造成网络拥塞。</p> 
<p style="margin-left:0cm;">（3）<span style="color:#FF0000;">快速离开</span>：使IGMP协议可以快速响应成员主机的Leave（离开）报文。</p> 
<p style="margin-left:0cm;">（4）<span style="color:#FF0000;">IGMPOn-Demand</span>：可根据组播成员的实际需求维护组成员之间的关系，减少了报文交互，降低网络流量。</p> 
<p style="margin-left:0cm;">（5）<span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">报文过滤</span>：可根据组播报文中源IP地址来过滤用户侧IGMP接口收到的IGMP报文，提高安全性。</p> 
<p style="margin-left:0cm;">3、SSM Mapping</p> 
<p style="margin-left:0cm;">SSM是一种在IGMPv3协议支持的情况下，能够在用户侧IGMP接口上指定组播源的传输服务。但有时组播组成员主机却只能运行IGMPv1或IGMPv2，这时就可以<span style="color:#FF0000;">通过在交换机上配置</span><span style="color:#FF0000;">SSM Mapping</span><span style="color:#FF0000;">功能，向运行</span><span style="color:#FF0000;">IGMPv1</span><span style="color:#FF0000;">或</span><span style="color:#FF0000;">IGMPv2</span><span style="color:#FF0000;">的组成员提供</span><span style="color:#FF0000;">SSM</span><span style="color:#FF0000;">服务</span>。</p> 
<p style="margin-left:0cm;">4、IGMP Limit</p> 
<p style="margin-left:0cm;">IGMP协议规定，成员可以在任意时间、任意位置、成员总数不受限制的加入或退出组播组。但是当大量用户同时收看多套节目时，需要占用组播设备的大量带宽，可能会造成组播性能下降。为避免这种情况的发生，交换机支持IGMP Limit功能，通过限制全局和用户侧IGMP接口下的组播组个数，使加入组播组的用户收看更加清晰稳定的节目。</p> 
<p style="margin-left:0cm;"><strong>二、配置IGMP</strong><strong>基本功能</strong></p> 
<p style="margin-left:0cm;">在成员主机和与之相连的交换机上配置IGMP，<span style="color:#FF0000;">“使能</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">功能”和“配置</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">版本”为必选配置</span>。</p> 
<p style="margin-left:0cm;">1、IGMP配置任务</p> 
<p style="margin-left:0cm;">通过<span style="color:#FF0000;">在与用户网段相连的组播设备接口上使能</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">基本功能</span>，用户主机可以接入组播网络，接收组播报文。但<span style="color:#FF0000;">在配置</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">基本功能之前，需配置单播路由协议</span>，使各节点间IP路由可达。主要配置任务如下：</p> 
<p style="margin-left:0cm;">（1）<span style="color:#FF0000;">使能</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">功能</span>。配置IGMP协议之前，必须<span style="color:#FF0000;">先使能</span><span style="color:#FF0000;">IP</span><span style="color:#FF0000;">组播路由功能</span>，因为它是配置一切组播功能的前提。IGMP应该配置在与组成员相连的接口上。</p> 
<p style="margin-left:0cm;">（2）<span style="color:#FF0000;">配置</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">版本</span>。运行IGMP高版本的交换机可以识别低版本的成员报告，但低版本的交换机不能识别高版本的成员报告。为了保证IGMP的正常运行，建议在交换机上配置与组播组成员主机上运行相同，或高于组播组成员主机的版本。</p> 
<p style="margin-left:0cm;">如果在主机侧共享网段上有多个交换机，由于不同版本的IGMP协议报文结构不同，为了保证IGMP的正常运行，必须在所有交换机接口配置相同的IGMP版本。</p> 
<p style="margin-left:0cm;">此项配置同时支持全局配置（即IGMP视图）和接口配置。</p> 
<p style="margin-left:0cm;">（3）<span style="color:#FF0000;">（可选）配置静态组播组</span>。在以下应用场景中，可在交换机的用户侧接口上配置静态组播组。</p> 
<p style="margin-left:0cm;">①网络中存在稳定的组播组成员。</p> 
<p style="margin-left:0cm;">②某网段内没有组播组成员或组播组成员主机无法发送Report报文，但是又需要将组播数据转发到该网段，可以在接口上配置静态组播组，将组播数据“拉”到接口上。</p> 
<p style="margin-left:0cm;">在接口上配置静态组播组后，交换机就认为此接口网段上一直存在该组播组的成员，从而转发改组的组播数据。</p> 
<p style="margin-left:0cm;">（4）<span style="color:#FF0000;">（可选）配置接口加入的组播组范围</span>。为了让IGMP接口所在网段的组播组成员主机加入指定的组播组，并接收这些组的报文，可以在该接口上设置ACL规则，对收到的成员Report报文进行过滤，使交换机只对该规则中允许的组播组维护组成员关系。</p> 
<p style="margin-left:0cm;">2、配置步骤</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="402" src="https://images2.imgbox.com/fc/34/2DLE7t3g_o.png" width="794"><br><img alt="" class="has" height="1154" src="https://images2.imgbox.com/77/59/jgy1nCiJ_o.png" width="794"><br><img alt="" class="has" height="1200" src="https://images2.imgbox.com/f1/24/9NNHmFox_o.png" width="794"><br><img alt="" class="has" height="260" src="https://images2.imgbox.com/08/c9/bQXXWQ2P_o.png" width="796"></p> 
<p style="margin-left:0cm;">示例1：在与用户相连的VLANIF100接口（先要把对应物理接口加入VLAN100中）配置静态组播组224.1.1.1。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/b2/8f/OMujxoGc_o.png"></p> 
<p style="margin-left:0cm;">示例2：配置VLANIF100接口加入组播源IP地址为192.168.10.1，组播组IP地址为232.1.1.1的组播组（192.168.10.1,232.1.1.1）中。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="119" src="https://images2.imgbox.com/26/19/Th6xpC53_o.png" width="648"></p> 
<p style="margin-left:0cm;">示例3：配置VLANIF100接口加入以225.1.1.1位起始组播组IP地址，组播组地址递增掩码长度为8（相当于组播组子网掩码为255.255.255.0），组播组地址数量限制为10的批量组播组中。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="115" src="https://images2.imgbox.com/f4/35/HuH0Lw3L_o.png" width="645"></p> 
<p style="margin-left:0cm;">示例4：配置VLANIF100接口加入以232.1.1.1位起始组播组IP地址，组播源IP地址为192.168.11.1，组播组地址递增掩码为0.0.255.255，组地址数量限制为10的批量组播组中。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="199" src="https://images2.imgbox.com/61/65/GALjIArQ_o.png" width="651"></p> 
<p style="margin-left:0cm;">示例5：创建编号为2005的ACL，允许主机接收来自组播组225.1.1.1的数据，然后在VLANIF100接口应用过滤策略，以限定该接口下的主机只能加入组播组225.1.1.1。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="163" src="https://images2.imgbox.com/6b/bd/DnB0xryW_o.png" width="646"></p> 
<p style="margin-left:0cm;"><strong>三、调整IGMP</strong><strong>性能</strong></p> 
<p style="margin-left:0cm;">使能IGMP后，缺省情况下可以正常工作。也可根据安全性和网络性能优化的要求适当调整相关参数。可以调整的IGMP性能参数包括以下几个方面</p> 
<p style="margin-left:0cm;">1、配置Router-Alert选项</p> 
<p style="margin-left:0cm;">通常情况下，网络设备收到报文时，<span style="color:#FF0000;">只有目的</span><span style="color:#FF0000;">IP</span><span style="color:#FF0000;">地址为本设备接口地址的报文才会上送给相应的协议模块处理</span>。这样就会存在一个问题，如果协议报文的目的地址不为本设备的接口地址，比如IGMP协议报文，由于其目的地址为组播地址，这种情况下就无法上送给IGMP协议模块处理，导致正常的组成员关系不能维护。为解决此类问题，Router-Alert选项应运而生。<span style="color:#FF0000;">如果</span><span style="color:#FF0000;">IP</span><span style="color:#FF0000;">报文头携带</span><span style="color:#FF0000;">Router-Alert</span><span style="color:#FF0000;">选项，设备在接收到此类报文后会直接上送给相应的协议模块处理，而不检查目的地址</span>。</p> 
<p style="margin-left:0cm;">缺省情况下，出于兼容性考虑，当前交换机在收到IGMP报文后，无论其IP报文头是否包含Router-Alert选项都会上送给IGMP协议模块处理。交换机在发送IGMP报文时，也可以选择是否需要携带Router-Alert选项。缺省情况下，组播设备发送的IGMP报文中携带Router-Alert选项。</p> 
<p style="margin-left:0cm;">——<span style="color:#00b0f0;">这里提到一个只有目的</span><span style="color:#00b0f0;">IP</span><span style="color:#00b0f0;">地址为本设备接口地址的报文才会上送给相应的协议模块处理，对于普通的</span><span style="color:#00b0f0;">IP</span><span style="color:#00b0f0;">报文，在经过路由器时，报文的目的地址应该不是设备接口的地址，难道不送给</span><span style="color:#00b0f0;">IP</span><span style="color:#00b0f0;">协议模块处理？</span></p> 
<p style="margin-left:0cm;">2、配置IGMP查询器参数</p> 
<p style="margin-left:0cm;">IGMP通过查询/响应报文维护组成员关系。当同一网段上有多台组播设备时，是由IGMP查询器负责发送IGMP查询报文，这时就需要指定IGMP查询器（在IGMPv1中，查询器是由PIM协议指定的，IGMPv2和IGMPv3可以手工配置）。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/98/37/oki48jw2_o.png"></p> 
<p style="margin-left:0cm;">在实际配置中，要确保<span style="color:#FF0000;">“</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">查询报文最大响应时间”</span><span style="color:#FF0000;">&lt;</span><span style="color:#FF0000;">“</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">普遍组查询报文发送间隔”</span><span style="color:#FF0000;">&lt;</span><span style="color:#FF0000;">“其他</span><span style="color:#FF0000;">IGMP</span><span style="color:#FF0000;">查询器存活时间”</span>。在共享网段内，如果多台设备的用户侧接口都使能了IGMP，应确保设备上配置的查询器参数一致，否则有可能导致IGMP协议无法正常运行。</p> 
<p style="margin-left:0cm;">3、配置IGMP快速离开</p> 
<p style="margin-left:0cm;">在某些应用中，IGMP查询器的一个接口下只能连接着一台成员主机（这是前提条件），当主机需要在多个组播组间频繁切换时，为了快速响应主机的离开组报文，可以在IGMP查询器上配置IGMP快速离开功能。这样，当查询器收到来自主机的Leave（离开）报文时，不再发送特定组查询报文，而是直接向上游发送离开通告。这样可减小响应延迟，也节省网络带宽。</p> 
<p style="margin-left:0cm;">IGMP快速离开功能仅适用于IGMPv2和IGMPv3版本。</p> 
<p style="margin-left:0cm;">4、配置IGMP On-Demand</p> 
<p style="margin-left:0cm;">在标准的IGMP工作机制中，查询器通过周期性发送查询报文并接收成员反馈的Report和Leave报文来了解组播组成员信息，组成员收到查询时都会进行回应。为了减少这个过程中的报文交互，降低网络流量，可以在查询器上配置IGMP On-Demand功能。使能了IGMP On-Demand功能后，查询器可根据组播组成员的要求来维护成员关系，不再主动发送查询报文来收集成员状态。</p> 
<p style="margin-left:0cm;">IGMP On-Demand只适应于IGMPv2和IGMPv3</p> 
<p style="margin-left:0cm;">5、配置根据源地址过滤IGMP报文</p> 
<p style="margin-left:0cm;">为了提高安全性，可以在交换机的接口上对IGMP报文（包括Query报文、Report和Leave报文）进行过滤。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/9e/83/qpHHtswD_o.png"><br><img alt="" class="has" height="1200" src="https://images2.imgbox.com/9e/83/lBVjeOad_o.png" width="861"><br><img alt="" class="has" src="https://images2.imgbox.com/41/f9/SY7IaqjT_o.png"><br><img alt="" class="has" height="1200" src="https://images2.imgbox.com/38/9d/oPPFMaQm_o.png" width="866"><br><img alt="" class="has" src="https://images2.imgbox.com/3a/54/cwK4pBAV_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/4a/3a/YLwOeo9n_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/5f/1d/y6fIckdE_o.png"></p> 
<p style="margin-left:0cm;">上面的拓扑，配置后，PC1可以向交换机发送成员报告报文，但是一直抓不到普遍组查询报文。——后来知道配置有问题。</p> 
<p style="margin-left:0cm;"><strong>四、配置IGMP SSM Mapping</strong></p> 
<p style="margin-left:0cm;">在SSM模型PIM-SM组播网络中，要求组播设备接口运行IGMPv3，但某些组播用户主机只能运行IGMPv1或IGMPv2。为了向这些用户同样提供SSM服务，需要在组播设备上配置SSM Mapping静态映射功能。</p> 
<p style="margin-left:0cm;">SSM Mapping是通过给SSM组播组地址映射一个或多个组播源地址，将IGMPv1或IGMPv2 Report报文中（*，G）信息转换为一组（S,G）信息来实现SSM服务的。缺省情况下，SSM组播地址范围为232.0.0.0~232.255.255.255，但可通过配置来扩展SSM组地址范围。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/18/d0/hFHdFV4P_o.png"></p> 
<p style="margin-left:0cm;"><strong>五、配置IGMP Limit</strong></p> 
<p style="margin-left:0cm;">IGMP Limit提供了<span style="color:#FF0000;">对组成员关系的个数限制功能</span>。配置了组成员关系个数限制功能后，当收到IGMP报文时，首先判断是否超过配置的个数限制，如果没有超过就建立组成员关系，给用户转发该组的数据流。</p> 
<p style="margin-left:0cm;">组成员关系的计数规则如下：</p> 
<p style="margin-left:0cm;">（1）每个（*，G）组成员关系计为一个表项。</p> 
<p style="margin-left:0cm;">（2）每个（S,G）源组成员关系计为一个表项。</p> 
<p style="margin-left:0cm;">（3）使用SSMMapping的每个（*，G）组成员关系计为一个表项，按照映射生成的（S,G）表项不进行计数。</p> 
<p style="margin-left:0cm;">IGMP Limit功能可以在全局或具体IGMP接口上配置。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/c3/c0/FWYPMPkz_o.png"></p> 
<p style="margin-left:0cm;">——<span style="color:#00b0f0;">通过上面的描述，限制的不是接收端主机的个数，限制的是组播组的个数</span>。</p> 
<p style="margin-left:0cm;">对前面的实验进行继续配置和测试，先点击离开按钮，抓包到离开报文：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/79/a2/bEvJXanC_o.png"></p> 
<p style="margin-left:0cm;">交换机一直没有发送查询报文，后来查询状态</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/eb/fd/NILpCbi7_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="173" src="https://images2.imgbox.com/cb/da/uKGbjaEp_o.png" width="649"></p> 
<p style="margin-left:0cm;">然后对VLANIF100进行IP地址配置，配置一个IP地址后，在链路上开始能够抓到查询包了：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/f6/a3/r3mBr3ss_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/d3/75/NFsnBuSq_o.png"></p> 
<p style="margin-left:0cm;"><strong>六、IGMP基本功能配置示例</strong></p> 
<p style="margin-left:0cm;"><strong><img alt="" class="has" src="https://images2.imgbox.com/49/61/Nvw12Aye_o.png"></strong></p> 
<p style="margin-left:0cm;">如上图所示，在主机侧存在两个主机网段N1和N2，HostA和HostC分别为N1和N2中的组播组成员。网络中传播组播数据使用的组播组地址为225.1.1.1~225.1.1.5，组播组成员HostA只购买了组255.1.1.1对应的节目，HostC则没有限制。</p> 
<p style="margin-left:0cm;">1、基本配置思路</p> 
<p style="margin-left:0cm;">从图中的网络结构可看出，不仅涉及IGMP协议，还涉及PIM协议。</p> 
<p style="margin-left:0cm;">（1）配置网络中的单播路由协议（如可采用单播静态路由、RIP、OSPF之类的动态路由等），实现网络层互通。为实现这一步，需要在各Switch的接口配置IP地址和单播路由协议。单播路由正常是组播路由协议正常工作的基础。</p> 
<p style="margin-left:0cm;">（2）配置基本组播功能：全局使能组播路由功能，在与组播组成员连接的接口上使能PIM和IGMP，指定RP，以实现组播数据可以在网络中转发。</p> 
<p style="margin-left:0cm;">（3）通过ACL配置对HostA能接收的组播数据进行过滤，以实现对HostA接收的组播数据进行限制。</p> 
<p style="margin-left:0cm;">2、具体配置步骤</p> 
<p style="margin-left:0cm;">（1）配置各Switch接口IP地址和单播路由协议</p> 
<p style="margin-left:0cm;">按上图配置各VLAN接口的IP地址和掩码，并配置各Switch之间采用OSPF进行互联，确保网络中各Switch间能够在网络层互通。</p> 
<p style="margin-left:0cm;">（2）全局使能组播路由功能，在各组播交换机的所有接口上使能PIM-SM功能（需要先把物理接口加入到对应的VLAN中），并配置以SwitchD的VLANIF40为静态RP。因为SwitchA、SwitchB、SwitchC、SwitchD上的配置相同，以SwitchA为例：</p> 
<p style="margin-left:0cm;">[SwitchA]vlan batch 10 11</p> 
<p style="margin-left:0cm;">[SwitchA]interface gigabitethernet 0/0/1</p> 
<p style="margin-left:0cm;">[SwitchA-GigabitEthernet0/0/1]portlink-type access</p> 
<p style="margin-left:0cm;">[SwitchA-GigabitEthernet0/0/1]port defaultvlan 10</p> 
<p style="margin-left:0cm;">[SwitchA-GigabitEthernet0/0/1]quit</p> 
<p style="margin-left:0cm;">[SwitchA]interface gigabitethernet 0/0/2</p> 
<p style="margin-left:0cm;">[SwitchA-GigabitEthernet0/0/2]portlink-type access</p> 
<p style="margin-left:0cm;">[SwitchA-GigabitEthernet0/0/2]port defaultvlan 11</p> 
<p style="margin-left:0cm;">[SwitchA-GigabitEthernet0/0/2]quit</p> 
<p style="margin-left:0cm;">[SwitchA]multicast routing-enable   #--全局使能组播路由功能</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif10</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]pim sm #--在VLAN10接口上（GE0/0/1接口上）启用PIM-SM</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]quit</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif11</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif11]pim sm</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif11]quit</p> 
<p style="margin-left:0cm;">[SwitchA]pim</p> 
<p style="margin-left:0cm;">[SwitchA-pim]static-rp 192.168.4.1 #---配置SwitchD的GE0/0/4接口为静态RP</p> 
<p style="margin-left:0cm;">[SwitchA-pim]quit</p> 
<p style="margin-left:0cm;">（3）在SwitchA、SwitchB、SwitchC组播组成员侧接口上使能IGMP功能。以SwitchA为例：</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif10</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]igmp enable</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]quit</p> 
<p style="margin-left:0cm;">（4）通过IGMP报文过滤功能配置SwitchA的VLANIF10接口只能加入组播组225.1.1.1。要先创建一个允许以组播组地址225.1.1.1为源地址报文通过的基本ACL，然后在SwitchA的VLANIF10接口上应用该策略。</p> 
<p style="margin-left:0cm;">[SwitchA]acl number 2001</p> 
<p style="margin-left:0cm;">[SwitchA-acl-basic-2001]rule permit source225.1.1.1 0</p> 
<p style="margin-left:0cm;">[SwitchA-acl-basic-2001]quit</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif10</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]igmp group-policy 2001</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]quit</p> 
<p style="margin-left:0cm;">配置好后，可通过display igmp interface查看各接口上IGMP的配置和运行情况。</p> 
<p style="margin-left:0cm;">模拟器模拟实验：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/98/20/Yzt19ncg_o.png"></p> 
<p style="margin-left:0cm;">按照如上图示，进行基本端口、vlan和ip的设置：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/8a/76/x60B3fCu_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/63/4d/UOp2Xnjq_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/28/99/gSTWu5zS_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/64/6c/C6oa8VdI_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/49/e8/k1CpXXzh_o.png"></p> 
<p style="margin-left:0cm;">配置单播路由，互相连通，使用ospf协议：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/47/1e/WD2dit8V_o.png"></p> 
<p style="margin-left:0cm;">这个拓扑图是有问题的，从中可以看出，LSWD——LSWC——LSW5——LSWB形成了环路，在LSW5上查看STP：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="125" src="https://images2.imgbox.com/57/50/SaZlDEaF_o.png" width="651"></p> 
<p style="margin-left:0cm;">可见e0/0/1端口已经是DISCARDING状态，被阻塞了，所以此条链路不通。</p> 
<p style="margin-left:0cm;">而LSWD中ospf形成路由将到达10.110.2.0网段的两条链路做成等价链路，且192.168.2.1在前，所以报文到了这里因为STP阻塞就无法通过了。</p> 
<p style="margin-left:0cm;">在LSWD上配置静态路由，提高VLAN31链路的优先级，</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/79/bf/e4QDdWTz_o.png"></p> 
<p style="margin-left:0cm;">全局使能组播路由功能，在各组播交换机的所有接口上使能PIM-SM功能（需要先把物理接口加入到对应的VLAN中），并配置以SwitchD的VLANIF40为静态RP。</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/14/88/7MMz756J_o.png"></p> 
<p style="margin-left:0cm;">在PC1点击加入组前后各查询一次</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/aa/1b/Kt7fwaCX_o.png"></p> 
<p style="margin-left:0cm;">然后设置VLC：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/fe/39/XwZmw9qu_o.png"></p> 
<p style="margin-left:0cm;">使用了百度影音播放器作为VLC，不好用，后来下载了一个VLC播放器，然后在LSWD中少设置了一步，需要设置静态RP，</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/1d/d4/2SlkJ54j_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/a6/b6/ou2zNFoS_o.png"></p> 
<p style="margin-left:0cm;">在做一个测试，如下</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/96/3c/t8IvPe29_o.png"></p> 
<p style="margin-left:0cm;">增加几个组播源，在PIM SM模式下，同一个组中的多个组播源，哪一个最后点击的运行，在客户端点击启动VLC时接收的就是哪个源的信息。</p> 
<p style="margin-left:0cm;">所以对于接收多个组播源的接收端，需要有一个机制来区分不同的源，就像电视机的频道转换一样。</p> 
<p style="margin-left:0cm;">对于PC3和PC4，相当于共同接在LSWC上，效果一样。</p> 
<p style="margin-left:0cm;"><strong>静态加入组播组配置示例</strong></p> 
<p style="margin-left:0cm;">如上图拓扑，在主机侧存在两个主机网段N1和N2，N1中有一个组播组成员HostA，N2中有HostC和HostD两个组播组成员。现希望HostA长期稳定的接收组播组225.1.1.3的数据，HostC和HostD对所接收的组播组数据没有要求。</p> 
<p style="margin-left:0cm;">本例与上例唯一不同是上例是通过IGMP报文过滤方式来限定HostA主机加入的组播组，本例要求HostA接收主机静态加入组播组225.1.1.3。</p> 
<p style="margin-left:0cm;">HostA主机静态加入组播组225.1.1.3的配置方法如下：</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif 10</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]igmp static-group225.1.1.3  #---静态加入到IP为225.1.1.3的组播组中</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]quit</p> 
<p style="margin-left:0cm;">即在LSWA上配置静态加入的组播组225.1.1.3即可。</p> 
<p style="margin-left:0cm;"><strong>七、IGMP SSM Mapping</strong><strong>配置示例</strong></p> 
<p style="margin-left:0cm;"><strong><img alt="" class="has" src="https://images2.imgbox.com/50/61/NEGGhuBd_o.png"></strong></p> 
<p style="margin-left:0cm;">如上图拓扑，同时采用ASM和SSM模式提供组播服务。由于与组播组成员相连的Switch接口上运行IGMPv3，组播组成员主机上运行的是IGMPv2，且不能升级到IGMPv3，因此，该主机在加入组播组时无法指定组播源，必须依靠SSM Mapping来实现。</p> 
<p style="margin-left:0cm;">当前网络中的SSM组播组地址范围是232.1.1.0/24，Source1、Source2和Source3都向该范围内的组播组发送组播数据，而组播组成员想接收来自Source1和Source3的组播数据。</p> 
<p style="margin-left:0cm;">1、基本配置思路分析</p> 
<p style="margin-left:0cm;">本例有两项基本要求：一是通过SSMMapping实现运行IGMPv2的组播组成员可以使用SSM服务；二是通过SSM Mapping的组播组和组播源映射功能，使组播组成员仅可接收特定的指定源组播组数据。当然，首先要进行的也是一个基本组播网络的基本功能配置，如各交换机接口上的PIM-SM功能的使能，并指定相同的RP，以及与组播组成员连接的交换机接口上的IGMP功能。</p> 
<p style="margin-left:0cm;">2、具体配置步骤</p> 
<p style="margin-left:0cm;">（1）配置IP地址和单播路由协议。按照上图标注配置各VLAN接口的IP地址和掩码，并配置各Switch之间采用OSPF进行互连，确保网络中各Switch间能够在网络层互通。</p> 
<p style="margin-left:0cm;">（2）在SwitchD上全局使能组播路由功能，并在各VLAN接口上配置PIM-SM，并在主机侧VLANIF13接口上配置运行IGMPv3。</p> 
<p style="margin-left:0cm;">[SwitchD]multicast routing-enable</p> 
<p style="margin-left:0cm;">[SwitchD]interface vlanif 13</p> 
<p style="margin-left:0cm;">[SwitchD-VLanif13]pim sm</p> 
<p style="margin-left:0cm;">[SwitchD-VLanif13]igmp enable</p> 
<p style="margin-left:0cm;">[SwitchD-VLanif13]igmp version 3</p> 
<p style="margin-left:0cm;">[SwitchD-VLanif13]quit</p> 
<p style="margin-left:0cm;">[SwitchD]interface vlanif21</p> 
<p style="margin-left:0cm;">[SwitchD-VLanif21]pim sm</p> 
<p style="margin-left:0cm;">[SwitchD-VLanif21]quit</p> 
<p style="margin-left:0cm;">[SwitchD]interface vlanif30</p> 
<p style="margin-left:0cm;">[SwitchD-VLanif30]pim sm</p> 
<p style="margin-left:0cm;">[SwitchD-VLanif30]quit</p> 
<p style="margin-left:0cm;">（3）在SwitchA、SwitchB和SwitchC上全局使能组播路由功能，并在各VLAN接口上使能PIM-SM。</p> 
<p style="margin-left:0cm;">[SwitchA]multicast routing-enable</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif 10</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]pim sm</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]quit</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif 20</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif20]pim sm</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif20]quit</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif 30</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif30]pim sm</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif30]quit</p> 
<p style="margin-left:0cm;">（4）在SwitchD上配置VLANIF30为C-BSR和C-RP。因为本网络中只配置了一个C-BSR和一个C-RP，所以VLANIF30最终会直接成为BSR和RP。</p> 
<p style="margin-left:0cm;">[SwitchD]pim</p> 
<p style="margin-left:0cm;">[SwitchD-pim]c-bsr vlanif 30</p> 
<p style="margin-left:0cm;">[SwitchD-pim]c-rp vlanif 30</p> 
<p style="margin-left:0cm;">[SwitchD-pim]quit</p> 
<p style="margin-left:0cm;">（5）在SwitchD的VLANIF13上使能SSMMapping功能。</p> 
<p style="margin-left:0cm;">[SwitchD]interface vlanif 13</p> 
<p style="margin-left:0cm;">[SwitchD-Vlanif13]igmp SSM-Mapping enable</p> 
<p style="margin-left:0cm;">[SwitchD-Vlanif13]quit</p> 
<p style="margin-left:0cm;">（6）在所有Switch上配置SSM组播组地址范围，以限定组播数据的发送。</p> 
<p style="margin-left:0cm;">[SwitchA]acl number 2000</p> 
<p style="margin-left:0cm;">[SwitchA-acl-basic-2000]rule permit source232.1.1.0 0.0.0.255</p> 
<p style="margin-left:0cm;">[SwitchA-acl-basic-2000]quit</p> 
<p style="margin-left:0cm;">[SwitchA]pim</p> 
<p style="margin-left:0cm;">[SwitchA-pim]ssm-policy 2000</p> 
<p style="margin-left:0cm;">[SwitchA-pim]quit</p> 
<p style="margin-left:0cm;">（7）在连接主机的Switch上配置SSMMapping映射规则，将232.1.1.0/24范围内的组播组映射到组播源Source1和Source3上，以实现组播组成员接收到Source1和Source3发来的组播数据。</p> 
<p style="margin-left:0cm;">[SwitchD]igmp</p> 
<p style="margin-left:0cm;">[SwitchD-igmp]ssm-mapping 232.1.1.0 2410.10.1.1</p> 
<p style="margin-left:0cm;">[SwitchD-igmp]ssm-mapping 232.1.1.0 24 10.10.3.1</p> 
<p style="margin-left:0cm;">[SwitchD-igmp]quit</p> 
<p style="margin-left:0cm;">配置好后，可通过display igmpssm-mapping group命令查看Switch上源和组的映射关系。通过display igmp group ssm-mapping命令查看Switch特定源/组地址的信息。</p> 
<p style="margin-left:0cm;">模拟器实战：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/62/d0/dJ4TpvJp_o.png"></p> 
<p style="margin-left:0cm;">1、首先进行基础配置，配置vlan、端口、IP</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/6c/6e/Q8CvQagt_o.png"></p> 
<p style="margin-left:0cm;">2、启动ospf，使单播路由连通：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/40/b7/VbApSp8f_o.png"><br><img alt="" class="has" src="https://images2.imgbox.com/4f/da/9y30gVB3_o.png"><br><img alt="" class="has" src="https://images2.imgbox.com/61/36/HyNC1rdG_o.png"><br><img alt="" class="has" src="https://images2.imgbox.com/47/f0/zWZjj4cg_o.png"></p> 
<p style="margin-left:0cm;">通过IP路由表和STP树，可以看到，在有环路的网络中，STP自动进行了环路的避免，LSWA至LSWB的链路在STP中是DISCARDING，LSWA上的IP路由表中，到10.10.2.0网段是从LSWD走的。</p> 
<p style="margin-left:0cm;">3、配置各路由器的组播路由功能，配置各VLAN接口的PIM-SM，在D路由器上主机侧配置运行IGMPv3</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/6a/b9/8jif6QCn_o.png"></p> 
<p style="margin-left:0cm;">4、在D上配置VLANIF30为C-BSR和C-RP，在VLANIF13上使能SSM Mapping功能：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="130" src="https://images2.imgbox.com/55/fd/WtOXd1YV_o.png" width="649"></p> 
<p style="margin-left:0cm;">5、在所有Switch上配置SSM组播组地址范围，以限定组播数据的发送：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/40/cf/wRqB4wun_o.png"></p> 
<p style="margin-left:0cm;">6、在连接主机的Switch上配置SSM Mapping映射规则</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="81" src="https://images2.imgbox.com/7a/bc/0VgINe7L_o.png" width="649"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/de/e9/A0bXhZFd_o.png"></p> 
<p style="margin-left:0cm;"><strong>八、IGMP Limit</strong><strong>配置示例</strong></p> 
<p style="margin-left:0cm;"><strong><img alt="" class="has" src="https://images2.imgbox.com/9d/49/O5utG5ZB_o.png"></strong></p> 
<p style="margin-left:0cm;">如上拓扑，该网络中的用户主机通过组播方式接收视频节目。现假设与SwitchA相连网段的HostA上订购了一个长期的组地址为225.1.1.3的节目，要求当网络中的用户主机点播的节目数量达到限制值时不允许再点播新的节目，保证用户已订购节目的接收质量。</p> 
<p style="margin-left:0cm;">1、基本配置思路分析</p> 
<p style="margin-left:0cm;">有两项主要配置</p> 
<p style="margin-left:0cm;">（1）为组播组成员HostA配置静态加入组播组225.1.1.3，使该用户能长期接收发往组播组225.1.1.3的数据。</p> 
<p style="margin-left:0cm;">（2）采用IGMP Limit功能来限制连接订购节目的用户的交换机上配置的组成员关系数量，以保证用户已订购节目的接收质量。</p> 
<p style="margin-left:0cm;">2、具体配置步骤</p> 
<p style="margin-left:0cm;">（1）配置各Switch接口IP地址和单播路由协议。按照上图标注，配置各VLAN接口的IP地址和掩码，并配置各Switch之间采用OSPF进行互连，确保网络中各Switch间能够在网络层互通。</p> 
<p style="margin-left:0cm;">（2）全局使能组播路由功能，并在所有VLAN接口上使能PIM-SM功能，同时以SwitchD上的GE0/0/4接口为静态RP。</p> 
<p style="margin-left:0cm;">[SwitchA]multicast routing-enable</p> 
<p style="margin-left:0cm;">[SwitchA]interface valnif 10</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]pim sm</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]quit</p> 
<p style="margin-left:0cm;">[SwitchA]interface valnif 11</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif11]pim sm</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif11]quit</p> 
<p style="margin-left:0cm;">[SwitchA]pim</p> 
<p style="margin-left:0cm;">[SwitchA-pim]static-rp 192.168.4.1</p> 
<p style="margin-left:0cm;">[SwitchA-pim]quit</p> 
<p style="margin-left:0cm;">（3）配置SwitchA、SwitchB和SwitchC的组播组成员侧接口使能IGMP。</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif 10</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]igmp enable</p> 
<p style="margin-left:0cm;">（4）将SwitchA的组播组成员侧接口静态加入组播组225.1.1.3，使用户能长期接收发往组播组225.1.1.3的数据。</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]igmp static-group225.1.1.3</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]quit</p> 
<p style="margin-left:0cm;">（5）在连接已订阅节目用户的最后一跳交换机上配置IGMP组成员关系个数限制。本例需在SwitchA上配置，假设总共可以创建50个IGMP组成员关系。</p> 
<p style="margin-left:0cm;">[SwitchA]igmp global limit 50</p> 
<p style="margin-left:0cm;">还可以在具体的接口（如VLANIF10）上配置总共可以创建的IGMP组成员关系数量，假设为30个（肯定要小于SWitchA上全局的成员关系限制数）。</p> 
<p style="margin-left:0cm;">[SwitchA]interface vlanif 10</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]igmp limit 30</p> 
<p style="margin-left:0cm;">[SwitchA-Vlanif10]quit</p> 
<p style="margin-left:0cm;">如果还要保证SwitchB和SwitchC上已订阅节目用户的接收质量，可按照上面SwitchA上HostA配置方法配置静态加入组播组，并配置IGMP Limit功能。</p> 
<p style="margin-left:0cm;">配置好后，可通过命令查看交换机接口上IGMP的配置和运行情况：</p> 
<p style="margin-left:0cm;">模拟：</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="103" src="https://images2.imgbox.com/66/db/RxKxPPnZ_o.png" width="590"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/d9/63/5RyG37rh_o.png"></p> 
<p style="margin-left:0cm;"><img alt="" class="has" src="https://images2.imgbox.com/ec/fa/WH5V3Gwa_o.png"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/320d9d7455eebd91462d3699d08b0a16/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js-xlsx，table_to_book导出数据取消自动加工</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2b7a4c7ef8c2d902fd4be145e2d9d11c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">字符串转化的最小操作数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>