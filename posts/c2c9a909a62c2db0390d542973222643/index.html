<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Pytorch深度学习-----完整的模型验证套路 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Pytorch深度学习-----完整的模型验证套路" />
<meta property="og:description" content="系列文章目录 PyTorch深度学习——Anaconda和PyTorch安装
Pytorch深度学习-----数据模块Dataset类
Pytorch深度学习------TensorBoard的使用
Pytorch深度学习------Torchvision中Transforms的使用（ToTensor，Normalize，Resize ，Compose，RandomCrop）
Pytorch深度学习------torchvision中dataset数据集的使用（CIFAR10）
Pytorch深度学习-----DataLoader的用法
Pytorch深度学习-----神经网络的基本骨架-nn.Module的使用
Pytorch深度学习-----神经网络的卷积操作
Pytorch深度学习-----神经网络之卷积层用法详解
Pytorch深度学习-----神经网络之池化层用法详解及其最大池化的使用
Pytorch深度学习-----神经网络之非线性激活的使用(ReLu、Sigmoid)
Pytorch深度学习-----神经网络之线性层用法
Pytorch深度学习-----神经网络之Sequential的详细使用及实战详解
Pytorch深度学习-----损失函数（L1Loss、MSELoss、CrossEntropyLoss）
Pytorch深度学习-----优化器详解（SGD、Adam、RMSprop）
Pytorch深度学习-----现有网络模型的使用及修改（VGG16模型）
Pytorch深度学习-----神经网络模型的保存与加载(VGG16模型)
Pytorch深度学习-----完整神经网络模型训练套路
Pytorch深度学习-----实现神经网络模型在GPU上进行训练的方法
文章目录 系列文章目录一、完整的模型验证套路步骤1.步骤1：导入必要的库2.步骤2：加载和预处理图像3.步骤3：定义神经网络模型4.步骤4：加载预训练模型5.步骤5：为模型推理准备图像6.步骤6：模型评估和预测 二、代码演示 一、完整的模型验证套路步骤 1.步骤1：导入必要的库 import torch import torchvision from PIL import Image from torch import nn 这里，导入了用于深度学习任务的torch和torchvision，用于图像处理的PIL中的Image，以及torch中的nn模块用于神经网络层。
2.步骤2：加载和预处理图像 image_path = &#34;../imgs/airplane.png&#34; image = Image.open(image_path) print(image) image = image.convert(&#39;RGB&#39;) 从给定路径加载一张图像，并将其转换为RGB格式，确保与大多数预训练模型的兼容性，这些模型期望有三个颜色通道。
transform = torchvision.transforms.Compose([ torchvision.transforms.Resize((32, 32)), torchvision.transforms.ToTensor() ]) image = transform(image) print(image.shape) 图像被调整为32x32像素的尺寸，并转换为张量。使其符合要求。
3.步骤3：定义神经网络模型 class Lgl(nn.Module): def __init__(self): super(Lgl, self)." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c2c9a909a62c2db0390d542973222643/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-01T15:32:37+08:00" />
<meta property="article:modified_time" content="2024-01-01T15:32:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Pytorch深度学习-----完整的模型验证套路</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>系列文章目录</h2> 
<p><a href="https://blog.csdn.net/weixin_46371813/article/details/131735244">PyTorch深度学习——Anaconda和PyTorch安装</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/131856034">Pytorch深度学习-----数据模块Dataset类</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/131870365">Pytorch深度学习------TensorBoard的使用</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/131879284">Pytorch深度学习------Torchvision中Transforms的使用（ToTensor，Normalize，Resize ，Compose，RandomCrop）</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/131918319">Pytorch深度学习------torchvision中dataset数据集的使用（CIFAR10）</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/131939010?spm=1001.2014.3001.5501">Pytorch深度学习-----DataLoader的用法</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/131961233?spm=1001.2014.3001.5502">Pytorch深度学习-----神经网络的基本骨架-nn.Module的使用</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/131972719">Pytorch深度学习-----神经网络的卷积操作</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/131996356">Pytorch深度学习-----神经网络之卷积层用法详解</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132019777?spm=1001.2014.3001.5502">Pytorch深度学习-----神经网络之池化层用法详解及其最大池化的使用</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132027401?spm=1001.2014.3001.5502">Pytorch深度学习-----神经网络之非线性激活的使用(ReLu、Sigmoid)</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132053196?spm=1001.2014.3001.5501">Pytorch深度学习-----神经网络之线性层用法</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132067617?spm=1001.2014.3001.5501">Pytorch深度学习-----神经网络之Sequential的详细使用及实战详解</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132113720?spm=1001.2014.3001.5501">Pytorch深度学习-----损失函数（L1Loss、MSELoss、CrossEntropyLoss）</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132150843?spm=1001.2014.3001.5501">Pytorch深度学习-----优化器详解（SGD、Adam、RMSprop）</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132190063?spm=1001.2014.3001.5502">Pytorch深度学习-----现有网络模型的使用及修改（VGG16模型）</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132197165?spm=1001.2014.3001.5502">Pytorch深度学习-----神经网络模型的保存与加载(VGG16模型)</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132207390?spm=1001.2014.3001.5501">Pytorch深度学习-----完整神经网络模型训练套路</a><br> <a href="https://blog.csdn.net/weixin_46371813/article/details/132256385">Pytorch深度学习-----实现神经网络模型在GPU上进行训练的方法</a></p> 
<hr> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_0" rel="nofollow">系列文章目录</a></li><li><a href="#_27" rel="nofollow">一、完整的模型验证套路步骤</a></li><li><ul><li><a href="#11_29" rel="nofollow">1.步骤1：导入必要的库</a></li><li><a href="#22_38" rel="nofollow">2.步骤2：加载和预处理图像</a></li><li><a href="#33_59" rel="nofollow">3.步骤3：定义神经网络模型</a></li><li><a href="#44_83" rel="nofollow">4.步骤4：加载预训练模型</a></li><li><a href="#55_91" rel="nofollow">5.步骤5：为模型推理准备图像</a></li><li><a href="#66_98" rel="nofollow">6.步骤6：模型评估和预测</a></li></ul> 
  </li><li><a href="#_114" rel="nofollow">二、代码演示</a></li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_27"></a>一、完整的模型验证套路步骤</h2> 
<h3><a id="11_29"></a>1.步骤1：导入必要的库</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> torch
<span class="token keyword">import</span> torchvision
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
</code></pre> 
<p>这里，导入了用于深度学习任务的torch和torchvision，用于图像处理的PIL中的Image，以及torch中的nn模块用于神经网络层。</p> 
<h3><a id="22_38"></a>2.步骤2：加载和预处理图像</h3> 
<pre><code class="prism language-python">image_path <span class="token operator">=</span> <span class="token string">"../imgs/airplane.png"</span>
image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>
image <span class="token operator">=</span> image<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">)</span>

</code></pre> 
<p>从给定路径加载一张图像，并将其转换为RGB格式，确保与大多数预训练模型的兼容性，这些模型期望有三个颜色通道。</p> 
<pre><code class="prism language-python">transform <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
    torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>
image <span class="token operator">=</span> transform<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>
</code></pre> 
<p>图像被调整为32x32像素的尺寸，并转换为张量。使其符合要求。</p> 
<h3><a id="33_59"></a>3.步骤3：定义神经网络模型</h3> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Lgl</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Lgl<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">64</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>
        <span class="token punctuation">)</span>
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

</code></pre> 
<p>Lgl类定义了一个CNN，包含三个卷积层，接着是最大池化、展平操作以及两个线性层。该模型设计用于图像分类。</p> 
<h3><a id="44_83"></a>4.步骤4：加载预训练模型</h3> 
<pre><code class="prism language-python">model <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"tudui_0.pth"</span><span class="token punctuation">,</span> map_location<span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>

</code></pre> 
<p>加载保存在文件tudui_0.pth中的预训练模型。map_location参数指定模型加载到CPU上。</p> 
<h3><a id="55_91"></a>5.步骤5：为模型推理准备图像</h3> 
<pre><code class="prism language-python">image <span class="token operator">=</span> torch<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>图像张量被重塑以匹配模型期望的输入形状，即一批图像。这里，它是一个包含3个颜色通道和32x32维度的单个图像。</p> 
<h3><a id="66_98"></a>6.步骤6：模型评估和预测</h3> 
<pre><code class="prism language-python">model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  
    output <span class="token operator">=</span> model<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>

</code></pre> 
<p>将模型设置为评估模式，并使用torch.no_grad()关闭梯度计算</p> 
<pre><code class="prism language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>最后，打印得分概率最高的类别，这是模型对输入图像的分类预测。</p> 
<h2><a id="_114"></a>二、代码演示</h2> 
<pre><code class="prism language-python"><span class="token comment"># 导入所需的库  </span>
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torchvision
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn

<span class="token comment"># 定义图像路径  </span>
image_path <span class="token operator">=</span> <span class="token string">"../imgs/airplane.png"</span>

<span class="token comment"># 使用PIL库打开图像  </span>
image <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>image_path<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>image<span class="token punctuation">)</span>

<span class="token comment"># 将图像转换为RGB格式，这是PyTorch和torchvision需要的格式  </span>
image <span class="token operator">=</span> image<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">)</span>

<span class="token comment"># 定义图像转换流程，包括调整大小和转换为Tensor  </span>
transform <span class="token operator">=</span> torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>Compose<span class="token punctuation">(</span><span class="token punctuation">[</span>
    torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>Resize<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 将图像大小调整为32x32  </span>
    torchvision<span class="token punctuation">.</span>transforms<span class="token punctuation">.</span>ToTensor<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 将图像转换为Tensor格式，并归一化到[0,1]范围  </span>
<span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># 对图像应用转换流程  </span>
image <span class="token operator">=</span> transform<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># 输出转换后的图像Tensor的形状，应为(1, 3, 32, 32)  </span>


<span class="token comment"># 定义一个简单的卷积神经网络模型（Lgl）  </span>
<span class="token keyword">class</span> <span class="token class-name">Lgl</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Lgl<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>model <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>
            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 第一个卷积层，输入通道数为3（RGB），输出通道数为32，卷积核大小为5x5，步长为1，填充为2  </span>
            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 最大池化层，池化核大小为2x2  </span>
            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 同上，但输出通道数仍为32  </span>
            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 同上  </span>
            nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 第三个卷积层，输出通道数为64，其他参数同上  </span>
            nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 同上  </span>
            nn<span class="token punctuation">.</span>Flatten<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 将多维的输入一维化，用于全连接层  </span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">64</span> <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 全连接层，输入特征数为64 * 4 * 4（经过前面卷积和池化操作后的特征数），输出特征数为64  </span>
            nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span>  <span class="token comment"># 全连接层，输出特征数为10（假设这是一个10类分类问题）  </span>
        <span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> self<span class="token punctuation">.</span>model<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># 通过模型进行前向传播，得到输出结果x  </span>
        <span class="token keyword">return</span> x

   

<span class="token comment"># 加载预训练的模型权重文件</span>
model <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">"tudui_0.pth"</span><span class="token punctuation">,</span> map_location<span class="token operator">=</span>torch<span class="token punctuation">.</span>device<span class="token punctuation">(</span><span class="token string">'cpu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span>  <span class="token comment"># 打印加载的模型结构信息，以确认模型是否正确加载  </span>

<span class="token comment"># 将图像Tensor调整为模型需要的输入形状（这里假设模型的输入形状为(1, 3, 32, 32)）  </span>
image <span class="token operator">=</span> torch<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>image<span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># 输出调整后的图像Tensor的形状，应为(1, 3, 32, 32)  </span>

<span class="token comment"># 将模型设置为评估模式，关闭梯度计算（用于推理阶段）  </span>
model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 将模型设置为评估模式  </span>
<span class="token keyword">with</span> torch<span class="token punctuation">.</span>no_grad<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 在这个with语句块内，不会计算梯度，节省内存并加速推理过程  </span>
    <span class="token comment"># 通过模型进行推理，得到输出结果output（即模型对输入图像的预测结果）  </span>
    output <span class="token operator">=</span> model<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span>  <span class="token comment"># 打印推理结果output的形状和值范围等信息，以确认推理过程是否正常进行  </span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>output<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 使用argmax函数获取预测概率最大的类别索引（即模型的预测结果），输出一个包含每个预测类别的索引的数组。例如，[0]表示第一类。</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cbc6b746c76447902e20a465e5a570fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">R语言【base】——table()：使用交叉分类因子来构建每个因子水平组合的计数列联表。</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/af705b51fb96da667c4efbbb5f8e3465/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java项目:户政电子档案管理平台(java&#43;SpringBoot&#43;Vue&#43;axios&#43;Mybaits&#43;mysql)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>