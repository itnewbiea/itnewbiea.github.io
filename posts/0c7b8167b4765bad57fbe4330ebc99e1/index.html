<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Aop&amp;ThreadLocal实现动态数据源切换 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Aop&amp;ThreadLocal实现动态数据源切换" />
<meta property="og:description" content="文章目录 @[toc]AOP（面向切面编程）概述集成到Spring-boot导入依赖：注解及使用 多数据源流程图yml配置多数据源连接信息配置常量类多数据源的注册设置ThreaLocal工具类实现多数据源接口自定义注解AOP切换数据源方法中的使用 AOP（面向切面编程） 概述 面向切面编程（AOP，Aspect-Oriented Programming）是一种编程范式，它允许开发者在不改变业务逻辑的情况下，通过切面（Aspect）来模块化横切关注点。横切关注点是那些存在于应用程序中多个模块中、并且通常分散在各个模块中的功能，例如日志、事务管理、安全性等。
AOP 主要通过以下几个概念来实现：
切面（Aspect）： 切面是一个模块化的单元，它封装了与横切关注点相关的行为。通常，一个切面由一个或多个通知（Advice）和一个切入点（Pointcut）组成。通知（Advice）： 通知定义了在什么时候、在何处以及如何应用切面的行为。常见的通知类型包括前置通知（Before）、后置通知（After）、返回通知（After Returning）、异常通知（After Throwing）和环绕通知（Around）。切入点（Pointcut）： 切入点是一个表达式，它定义了在哪里应用切面的行为。切入点表达式可以匹配一个或多个连接点（Join Point）。连接点（Join Point）： 连接点是应用程序执行过程中的一个特定点，例如方法的调用或异常的抛出。切入点定义了在哪里匹配连接点。目标对象（Target Object）： 目标对象是被一个或多个切面所通知的对象。它是应用程序中的真正业务逻辑。织入（Weaving）： 织入是将切面与目标对象关联起来的过程。织入可以发生在编译时、类加载时、运行时，或者在方法调用时。 AOP 的优势在于它可以将横切关注点从业务逻辑中分离出来，提高了代码的模块化、可维护性和可重用性。典型的应用场景包括日志记录、事务管理、权限控制等。在 Java 中，Spring 框架提供了强大的 AOP 支持，使得开发者能够方便地实现面向切面编程。
集成到Spring-boot 导入依赖： &lt;!--&gt;简单满足基础使用 &lt;/--&gt; &lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-aop&lt;/artifactId&gt; &lt;/dependency&gt; &lt;!--&gt;功能更加强大&lt;/--&gt; &lt;dependency&gt; &lt;groupId&gt;org.aspectj&lt;/groupId&gt; &lt;artifactId&gt;aspectjweaver&lt;/artifactId&gt; &lt;/dependency&gt; spring-boot-starter-aop 是 Spring Boot 提供的一个 Starter（启动器），它简化了在 Spring Boot 项目中使用 AOP 的配置过程。aspectjweaver是AspectJ框架的一部分，它是用于支持 Java 编程语言的 AOP 框架。AspectJ 提供了更丰富的切面表达式语言和更强大的切面功能，包括编译时植入和运行时植入等。 本次的功能使用只需要最简单高效的spring-boot-starter-aop就能实现
注解及使用 **@Aspect：**切面
作用： 用于定义一个切面类，将类标识为切面，可以在类里面定义各种增强操作。
示例：
@Aspect public class MyAspect { // 切面类的定义 } **@Pointcut：**切入点" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0c7b8167b4765bad57fbe4330ebc99e1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-30T18:03:19+08:00" />
<meta property="article:modified_time" content="2023-12-30T18:03:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Aop&amp;ThreadLocal实现动态数据源切换</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="toc_0"></a> 
 <div class="toc"> 
  <h3>文章目录</h3> 
  <ul><li><ul><li><a href="#toc_0" rel="nofollow">@[toc]</a></li><li><a href="#AOP_5" rel="nofollow">AOP（面向切面编程）</a></li><li><ul><li><a href="#_7" rel="nofollow">概述</a></li><li><a href="#Springboot_22" rel="nofollow">集成到Spring-boot</a></li><li><ul><li><a href="#_24" rel="nofollow">导入依赖：</a></li><li><a href="#_46" rel="nofollow">注解及使用</a></li></ul> 
    </li></ul> 
    </li><li><a href="#_150" rel="nofollow">多数据源</a></li><li><ul><li><a href="#_154" rel="nofollow">流程图</a></li><li><a href="#yml_158" rel="nofollow">yml配置多数据源连接信息</a></li><li><a href="#_181" rel="nofollow">配置常量类</a></li><li><a href="#_199" rel="nofollow">多数据源的注册</a></li><li><a href="#ThreaLocal_282" rel="nofollow">设置ThreaLocal工具类</a></li><li><a href="#_313" rel="nofollow">实现多数据源接口</a></li><li><a href="#_328" rel="nofollow">自定义注解</a></li><li><a href="#AOP_370" rel="nofollow">AOP切换数据源</a></li><li><a href="#_416" rel="nofollow">方法中的使用</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </div></h3> 
<h3><a id="AOP_5"></a>AOP（面向切面编程）</h3> 
<h4><a id="_7"></a>概述</h4> 
<p>面向切面编程（AOP，Aspect-Oriented Programming）是一种编程范式，它允许开发者在不改变业务逻辑的情况下，通过切面（Aspect）来模块化横切关注点。横切关注点是那些存在于应用程序中多个模块中、并且通常分散在各个模块中的功能，例如日志、事务管理、安全性等。</p> 
<p>AOP 主要通过以下几个概念来实现：</p> 
<ol><li><strong>切面（Aspect）：</strong> 切面是一个模块化的单元，它封装了与横切关注点相关的行为。通常，一个切面由一个或多个通知（Advice）和一个切入点（Pointcut）组成。</li><li><strong>通知（Advice）：</strong> 通知定义了在什么时候、在何处以及如何应用切面的行为。常见的通知类型包括前置通知（Before）、后置通知（After）、返回通知（After Returning）、异常通知（After Throwing）和环绕通知（Around）。</li><li><strong>切入点（Pointcut）：</strong> 切入点是一个表达式，它定义了在哪里应用切面的行为。切入点表达式可以匹配一个或多个连接点（Join Point）。</li><li><strong>连接点（Join Point）：</strong> 连接点是应用程序执行过程中的一个特定点，例如方法的调用或异常的抛出。切入点定义了在哪里匹配连接点。</li><li><strong>目标对象（Target Object）：</strong> 目标对象是被一个或多个切面所通知的对象。它是应用程序中的真正业务逻辑。</li><li><strong>织入（Weaving）：</strong> 织入是将切面与目标对象关联起来的过程。织入可以发生在编译时、类加载时、运行时，或者在方法调用时。</li></ol> 
<p>AOP 的优势在于它可以将横切关注点从业务逻辑中分离出来，提高了代码的模块化、可维护性和可重用性。典型的应用场景包括日志记录、事务管理、权限控制等。在 Java 中，Spring 框架提供了强大的 AOP 支持，使得开发者能够方便地实现面向切面编程。</p> 
<h4><a id="Springboot_22"></a>集成到Spring-boot</h4> 
<h5><a id="_24"></a>导入依赖：</h5> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--&gt;简单满足基础使用 &lt;/--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-aop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--&gt;功能更加强大&lt;/--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.aspectj<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aspectjweaver<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<ul><li><code>spring-boot-starter-aop</code> 是 Spring Boot 提供的一个 Starter（启动器），它简化了在 Spring Boot 项目中使用 AOP 的配置过程。</li><li><code>aspectjweaver</code>是AspectJ框架的一部分，它是用于支持 Java 编程语言的 AOP 框架。AspectJ 提供了更丰富的<strong>切面表达式语言</strong>和更强大的切面功能，包括<strong>编译时植入和运行时植入</strong>等。</li></ul> 
<p>本次的功能使用只需要最简单高效的spring-boot-starter-aop就能实现</p> 
<h5><a id="_46"></a>注解及使用</h5> 
<ol><li> <p>**<code>@Aspect</code>：**切面</p> 
  <ul><li> <p><strong>作用：</strong> 用于定义一个切面<strong>类</strong>，将类标识为切面，可以在类里面定义各种增强操作。</p> </li><li> <p>示例：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyAspect</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 切面类的定义</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> </li><li> <p>**<code>@Pointcut</code>：**切入点</p> 
  <ul><li> <p><strong>作用：</strong> 用于定义可重用的切入点表达式，将方法标识为切入点，把要切入的位置与方法进行绑定，方便后面的通知（before，after等）绑定</p> </li><li> <p>示例：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"execution(* com.example.service.*.*(..))"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">myPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 切入点表达式</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> </li><li> <p>**<code>@Before</code>：**通知</p> 
  <ul><li> <p><strong>作用：</strong> 在目标方法执行之前执行增强逻辑。</p> </li><li> <p>示例：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"myPointcut()"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeServiceMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 增强逻辑</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> </li><li> <p>**<code>@After</code>：**通知</p> 
  <ul><li> <p><strong>作用：</strong> 在目标方法执行之后执行增强逻辑（不论方法是否正常完成）。</p> </li><li> <p>示例：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"myPointcut()"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterServiceMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 增强逻辑</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> </li><li> <p>**<code>@AfterReturning</code>：**通知</p> 
  <ul><li> <p><strong>作用：</strong> 在目标方法成功执行后执行增强逻辑。</p> </li><li> <p>示例：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span>pointcut <span class="token operator">=</span> <span class="token string">"myPointcut()"</span><span class="token punctuation">,</span> returning <span class="token operator">=</span> <span class="token string">"result"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturningServiceMethod</span><span class="token punctuation">(</span><span class="token class-name">Object</span> result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 增强逻辑</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> </li><li> <p>**<code>@AfterThrowing</code>：**通知</p> 
  <ul><li> <p><strong>作用：</strong> 在目标方法抛出异常后执行增强逻辑。</p> </li><li> <p>示例：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span>pointcut <span class="token operator">=</span> <span class="token string">"myPointcut()"</span><span class="token punctuation">,</span> throwing <span class="token operator">=</span> <span class="token string">"exception"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowingServiceMethod</span><span class="token punctuation">(</span><span class="token class-name">Exception</span> exception<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 增强逻辑</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> </li><li> <p>**<code>@Around</code>：**通知</p> 
  <ul><li> <p><strong>作用：</strong> 在目标方法执行前后进行增强，可以控制目标方法的执行流程。</p> </li><li> <p>示例：</p> <pre><code class="prism language-java"><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">"myPointcut()"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">aroundServiceMethod</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 前置逻辑</span>
    <span class="token class-name">Object</span> result <span class="token operator">=</span> joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用目标方法</span>
    <span class="token comment">// 后置逻辑</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li></ul> </li></ol> 
<p>这些注解可以组合使用，根据实际需要来实现不同的切面逻辑。例如，可以通过 <code>@Around</code> 注解来实现完全控制目标方法的执行流程。在 AOP 中，这些注解提供了灵活的方式来定义切面，以便实现横切关注点的模块化和可重用。</p> 
<hr> 
<h3><a id="_150"></a>多数据源</h3> 
<p>在我的实习的工作中，其中有一次涉及到的一个需求就是将其他不同数据库中的内容同步到当前的一个数据库中来，所以涉及到多个数据源来回切换。具体实现就是实现<code>AbstractRoutingDataSource</code>接口，将当前的数据源与当前线程局部副本<code>ThreadLocal</code>进行绑定。通过Aop面向切面编程设置线程副本变量的值，来切换数据源。</p> 
<h4><a id="_154"></a>流程图</h4> 
<p><img src="https://images2.imgbox.com/bc/32/sbdS0Ohe_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="yml_158"></a>yml配置多数据源连接信息</h4> 
<p>可以配置多个数据源，我这里只配置了本地的两个数据源</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">type</span><span class="token punctuation">:</span> com.alibaba.druid.pool.DruidDataSource
    <span class="token key atrule">druid</span><span class="token punctuation">:</span>
      <span class="token key atrule">master</span><span class="token punctuation">:</span>
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>3306/test  <span class="token comment"># 我自己本地的mysql数据库</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> abc123
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
      <span class="token key atrule">slave</span><span class="token punctuation">:</span>
        <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//192.168.1.107<span class="token punctuation">:</span>3306/test  <span class="token comment"># 自己本地的Ubuntu上的数据库</span>
        <span class="token key atrule">username</span><span class="token punctuation">:</span> root
        <span class="token key atrule">password</span><span class="token punctuation">:</span> abc123
        <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver
</code></pre> 
<h4><a id="_181"></a>配置常量类</h4> 
<p>编写常量类，防止拼写错误或者失误修改</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicDataSources</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 主库名称
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">MASTER</span> <span class="token operator">=</span> <span class="token string">"master"</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 从库名称
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">SLAVE</span> <span class="token operator">=</span> <span class="token string">"slave"</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_199"></a>多数据源的注册</h4> 
<p>将ymal配置的多个数据源进行注入，<strong>也可以使用一个数据库来专门的存储多个数据库的连接信息</strong>，然后直接统一的进行查询注册。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token class-name">SqlSessionFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DataSourceConfig</span>  <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 获取yml中主库数据源信息
     */</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.master.password}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> masterPassword<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.master.username}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> masterUserName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.master.url}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> masterUrl<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.master.driver-class-name}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> masterDriverClassName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">masterDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DruidDataSource</span> masterDruidDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        masterDruidDataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>masterUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        masterDruidDataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>masterUserName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        masterDruidDataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>masterPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        masterDruidDataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>masterDriverClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> masterDruidDataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 获取yml中从库数据源信息
     */</span>
    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.slave.password}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> slavePassword<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.slave.username}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> slaveUserName<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.slave.url}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> slaveUrl<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Value</span><span class="token punctuation">(</span><span class="token string">"${spring.datasource.druid.slave.driver-class-name}"</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> slaveDriverClassName<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">slaveDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DruidDataSource</span> slaveDruidDataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DruidDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        slaveDruidDataSource<span class="token punctuation">.</span><span class="token function">setUrl</span><span class="token punctuation">(</span>slaveUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        slaveDruidDataSource<span class="token punctuation">.</span><span class="token function">setUsername</span><span class="token punctuation">(</span>slaveUserName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        slaveDruidDataSource<span class="token punctuation">.</span><span class="token function">setPassword</span><span class="token punctuation">(</span>slavePassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
        slaveDruidDataSource<span class="token punctuation">.</span><span class="token function">setDriverClassName</span><span class="token punctuation">(</span>slaveDriverClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> slaveDruidDataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 配置数据源交给spring管理
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">DataSource</span> <span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DynamicDataSource</span> dataSource <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DynamicDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">DataSource</span> masterDataSource <span class="token operator">=</span> <span class="token function">masterDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">final</span> <span class="token class-name">DataSource</span> slaveDataSource <span class="token operator">=</span> <span class="token function">slaveDataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> dataSourceMap  <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">DynamicDataSources</span><span class="token punctuation">.</span><span class="token constant">MASTER</span><span class="token punctuation">,</span> masterDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSourceMap<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token class-name">DynamicDataSources</span><span class="token punctuation">.</span><span class="token constant">SLAVE</span><span class="token punctuation">,</span> slaveDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setTargetDataSources</span><span class="token punctuation">(</span>dataSourceMap<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置默认数据源</span>
        dataSource<span class="token punctuation">.</span><span class="token function">setDefaultTargetDataSource</span><span class="token punctuation">(</span>masterDataSource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> dataSource<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 创建JdbcTemplate交给spring管理
     */</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token class-name">JdbcTemplate</span> <span class="token function">jdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">JdbcTemplate</span><span class="token punctuation">(</span><span class="token function">dataSource</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="ThreaLocal_282"></a>设置ThreaLocal工具类</h4> 
<p>利用ThreadLocal的技术，保证线程切换数据源的安全性，不会去影响其他线程甚至整个程序的数据源调整。通过设置ThreadLocal来将当前线程与目标的数据库进行绑定</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicDataSourceContextHolder</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/**
     * 每一个线程都可以独立地改变自己的副本，而不会影响其它线程所对应的副本。
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> <span class="token constant">CONTEXT_HOLDER</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThreadLocal</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/**
     * 设置当前线程需要使用的数据源id(和当前线程绑定)
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">setDataSourceId</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">String</span>  dataSourceId<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token constant">CONTEXT_HOLDER</span><span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>dataSourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 获取当前线程使用的数据源id
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">getDataSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token constant">CONTEXT_HOLDER</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">/**
     * 清空当前线程使用的数据源id
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span>  <span class="token keyword">void</span> <span class="token function">clearDataSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token constant">CONTEXT_HOLDER</span><span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_313"></a>实现多数据源接口</h4> 
<p><code>AbstractRoutingDataSource</code> 是 Spring Framework 提供的一个抽象类，它实现了 Spring 的 <code>javax.sql.DataSource</code> 接口，并且支持动态地切换目标数据源。<code>AbstractRoutingDataSource</code> 的子类需要实现一个方法，即 <code>determineCurrentLookupKey()</code>，该方法返回当前线程应该使用的数据源的标识。Spring 将根据这个标识来选择具体的数据源。</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicDataSource</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRoutingDataSource</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token class-name">Object</span> <span class="token function">determineCurrentLookupKey</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">getDataSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_328"></a>自定义注解</h4> 
<p>自定义注解是方便我们切换数据源，只需要在需要切换数据源的方法上添加自定义注解并且设置dataSourceId的值，便可以动态的切换数据源。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span><span class="token class-name">RetentionPolicy</span><span class="token punctuation">.</span><span class="token constant">RUNTIME</span><span class="token punctuation">)</span> <span class="token comment">// 指定注解的保留策略</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">TYPE</span><span class="token punctuation">,</span><span class="token class-name">ElementType</span><span class="token punctuation">.</span><span class="token constant">METHOD</span><span class="token punctuation">}</span><span class="token punctuation">)</span>  <span class="token comment">// 用于指定自定义注解可以应用的程序元素类型</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">DataSourceDynamicSwitch</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span>  <span class="token function">dataSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token class-name">DynamicDataSources</span><span class="token punctuation">.</span><span class="token constant">MASTER</span><span class="token punctuation">;</span> <span class="token comment">// 设置了一个默认的数据值为主数据库</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><code>@Retention</code> 是 Java 中的一个元注解，用于指定注解的保留策略，即该注解应该在什么级别保存。<code>@Retention</code> 可以有三个取值：</p> 
<ol><li><strong>SOURCE：</strong> 
  <ul><li>注解仅在源代码级别保留，编译器将丢弃这种注解，不会包含在编译后的类文件中。</li><li>这意味着在运行时无法通过反射获取这种注解。</li></ul> </li><li><strong>CLASS：</strong> 
  <ul><li>注解在编译时保留，会包含在编译后的类文件中，但在运行时无法通过反射获取。</li><li>默认值为 <code>CLASS</code>。</li></ul> </li><li><strong>RUNTIME：</strong> 
  <ul><li>注解在运行时保留，可以通过反射获取。</li><li>这是最常用的保留策略，用于在运行时处理注解。</li></ul> </li></ol> 
<p><code>@Target</code> 是 Java 中的一个元注解，用于指定自定义注解可以应用的程序元素类型，即注解可以放在哪些地方使用。<code>@Target</code> 可以有多个取值，每个取值表示一种程序元素类型。以下是常见的 <code>@Target</code> 取值：</p> 
<ol><li><strong>ElementType.TYPE：</strong> 
  <ul><li>表示注解可以应用在类、接口（包括注解类型）或枚举声明。</li></ul> </li><li><strong>ElementType.FIELD：</strong> 
  <ul><li>表示注解可以应用在字段（包括枚举常量）声明。</li></ul> </li><li><strong>ElementType.METHOD：</strong> 
  <ul><li>表示注解可以应用在方法声明。</li></ul> </li><li><strong>ElementType.PARAMETER：</strong> 
  <ul><li>表示注解可以应用在参数声明。</li></ul> </li><li><strong>ElementType.CONSTRUCTOR：</strong> 
  <ul><li>表示注解可以应用在构造方法声明。</li></ul> </li><li><strong>ElementType.LOCAL_VARIABLE：</strong> 
  <ul><li>表示注解可以应用在局部变量声明。</li></ul> </li><li><strong>ElementType.ANNOTATION_TYPE：</strong> 
  <ul><li>表示注解可以应用在注解类型声明（即元注解）。</li></ul> </li><li><strong>ElementType.PACKAGE：</strong> 
  <ul><li>表示注解可以应用在包声明。</li></ul> </li></ol> 
<h4><a id="AOP_370"></a>AOP切换数据源</h4> 
<p>使用AOP操作，当我们在调用被<strong>自定义注解</strong>修饰的方法时候，进行数据源的切换。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicDataSourceSwitchAspect</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">"@annotation(com.test.aop.ano.DataSourceDynamicSwitch)"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">pointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">/**
     * 通过切面切换数据源 通过threadlocal 一个方法会绑定一个线程 数据源存储在此线程里面
     **/</span>
    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">"pointcut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doBefore</span><span class="token punctuation">(</span><span class="token class-name">JoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"开始切换数据源 ....."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodSignature</span><span class="token punctuation">)</span> joinPoint<span class="token punctuation">.</span><span class="token function">getSignature</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//先获取方法上注解</span>
        <span class="token class-name">DataSourceDynamicSwitch</span> annotation <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">DataSourceDynamicSwitch</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>annotation <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//方法上没有，再获取类上的注解</span>
            annotation <span class="token operator">=</span> method<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAnnotation</span><span class="token punctuation">(</span><span class="token class-name">DataSourceDynamicSwitch</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>annotation <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//获取注解上指定切换的数据源</span>
        <span class="token class-name">String</span> dataSourceId <span class="token operator">=</span> annotation<span class="token punctuation">.</span><span class="token function">dataSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//通过DynamicDataSourceContextHolder上下文对象设置数据源ID</span>
        <span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">setDataSourceId</span><span class="token punctuation">(</span>dataSourceId<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     *  清除掉当前线程数据源，下次线程进来防止干扰默认数据源
     **/</span>
    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">"pointcut()"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">doAfter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">DynamicDataSourceContextHolder</span><span class="token punctuation">.</span><span class="token function">clearDataSourceId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_416"></a>方法中的使用</h4> 
<p>在调用不同数据库的方法头上，使用自定义的注解，并且将<code>dataSourceId</code>的值设置为常量类的设置对应的常量成员。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/user"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>

   <span class="token annotation punctuation">@Resource</span>
   <span class="token class-name">AgentServiceImpl</span> agentService<span class="token punctuation">;</span>

   <span class="token annotation punctuation">@Resource</span>
   <span class="token class-name">UserServiceImpl</span> userService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/master"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@DataSourceDynamicSwitch</span><span class="token punctuation">(</span>dataSourceId <span class="token operator">=</span> <span class="token string">"master"</span><span class="token punctuation">)</span>  <span class="token comment">// 切换数据源</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">masterTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"userService.getById(1) = "</span> <span class="token operator">+</span> userService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"success !"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/slave"</span><span class="token punctuation">)</span>
    <span class="token annotation punctuation">@DataSourceDynamicSwitch</span><span class="token punctuation">(</span>dataSourceId <span class="token operator">=</span> <span class="token string">"slave"</span><span class="token punctuation">)</span>  <span class="token comment">// 切换数据源</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">slaveTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"agentService.getById(1) = "</span> <span class="token operator">+</span> agentService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token string">"success !"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4da6b8949addde0dbf969aa498a3766c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">苹果CMS超级播放器专业版无授权全开源，附带安装教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/27be1285f9c7fee558d712c4af7b4966/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">centos 7.9 升级系统默认的python2.7到python 2.7.18</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>