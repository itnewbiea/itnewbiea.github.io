<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>有屏RV1126部署QT应用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="有屏RV1126部署QT应用" />
<meta property="og:description" content="之前写过一篇在RV1126上移植QT的文章，当时只是重点记录了项目移植的方法及交叉编译的配置等。RV1126只有buildroot系统，因此想要编译有界面的app需要借助QT和framebuffer实现。
下面记录一下如何通过buildroot的方式构建有界面的qt程序
首先在buildroot中添加QT5的内容
source envsetup.sh //选择rockchip_rv1126_rv1109 make menuconfig Target packages-&gt;Graphic libraries and applications (graphic/text)
开启 Qt5 下的 gui module 和 widgets module
保存退出
make savedefconfig ./build.sh rootfs 随后在 SDK/buildroot/package/rockchip/ 目录下，新建工程文件夹（QT Creator创建的项目名称，我的项目名称是qhyccd，下文提到的项目名称都是指这个），在文件夹中添加两个文件， Config.in 和 项目文件名.mk 。
Config.in
config BR2_PACKAGE_QHYCCD bool &#34;qhyccd&#34; help hya qt demo qhyccd.mk
################################################################################ # # qhyccd # ################################################################################ QHYCCD_VERSION = 1.0 QHYCCD_SITE = $(TOPDIR)/../app/qhyccd QHYCCD_SITE_METHOD = local TEST_LICENSE = Apache V2.0 TEST_LICENSE_FILES = NOTICE define TEST_CONFIGURE_CMDS cd $(@D); $(TARGET_MAKE_ENV) ~/workspace/rv1126SDK0/buildroot/output/rockchip_rv1126_rv1109/host/bin/qmake endef define QHYCCD_BUILD_CMDS $(TARGET_MAKE_ENV) $(MAKE) -C $(@D) endef define QHYCCD_INSTALL_TARGET_CMDS $(INSTALL) -D -m 0755 $(@D)/qhyccd $(TARGET_DIR)/usr/bin/qhyccd endef $(eval $(generic-package)) 2）移植源码" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/65c741d33ecefe3b89a27898181594c7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-20T15:35:37+08:00" />
<meta property="article:modified_time" content="2023-11-20T15:35:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">有屏RV1126部署QT应用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>之前写过一篇在RV1126上移植QT的文章，当时只是重点记录了项目移植的方法及交叉编译的配置等。RV1126只有buildroot系统，因此想要编译有界面的app需要借助QT和framebuffer实现。</p> 
<p>下面记录一下如何通过buildroot的方式构建有界面的qt程序</p> 
<p></p> 
<p>首先在buildroot中添加QT5的内容</p> 
<pre><code>source envsetup.sh  //选择rockchip_rv1126_rv1109
make menuconfig</code></pre> 
<p>Target packages-&gt;Graphic libraries and applications (graphic/text)</p> 
<p>开启 Qt5 下的 gui module 和 widgets module</p> 
<p>保存退出</p> 
<pre><code>make savedefconfig
./build.sh rootfs</code></pre> 
<p>随后在 SDK/buildroot/package/rockchip/ 目录下，新建工程文件夹（QT Creator创建的项目名称，我的项目名称是qhyccd，下文提到的项目名称都是指这个），在文件夹中添加两个文件， Config.in 和 项目文件名.mk 。</p> 
<p></p> 
<p>Config.in</p> 
<pre><code>config BR2_PACKAGE_QHYCCD
    bool "qhyccd"
    help
    hya qt demo</code></pre> 
<p>qhyccd.mk</p> 
<pre><code>################################################################################
#
# qhyccd
#
################################################################################

QHYCCD_VERSION = 1.0
QHYCCD_SITE = $(TOPDIR)/../app/qhyccd
QHYCCD_SITE_METHOD = local

TEST_LICENSE = Apache V2.0
TEST_LICENSE_FILES = NOTICE
define TEST_CONFIGURE_CMDS
cd $(@D); $(TARGET_MAKE_ENV) ~/workspace/rv1126SDK0/buildroot/output/rockchip_rv1126_rv1109/host/bin/qmake
endef
define QHYCCD_BUILD_CMDS
$(TARGET_MAKE_ENV) $(MAKE) -C $(@D) 
endef

define QHYCCD_INSTALL_TARGET_CMDS
$(INSTALL) -D -m 0755 $(@D)/qhyccd $(TARGET_DIR)/usr/bin/qhyccd
endef
$(eval $(generic-package))
</code></pre> 
<p>2）移植源码</p> 
<p>在SDK/app/目录下建立项目文件夹qhyccd</p> 
<p>在qt里简单的构建了一个工程，随后将.pro .cpp .h .ui 文件移动到虚拟机SDK/app/项目文件夹下</p> 
<p>给工程文件夹权限</p> 
<p>3）编译工程</p> 
<p>在SDK根目录下，make 项目名-build</p> 
<p>编译完成后，在对应的output的target/usr/bin下面可以找到可执行文件</p> 
<p>假如对源码进行了修改，可以使用make 项目名-rebuild进行重新编译</p> 
<pre><code>make qhyccd-rebuild
./build.sh rootfs
./build.sh updateimg</code></pre> 
<p>把镜像烧录到开发板</p> 
<p>4）测试可执行程序</p> 
<p>运行可执行程序报错如下，是因为开发板没有配置QT的环境</p> 
<pre><code>Could not find the Qt platform plugin "eglfs" in ""</code></pre> 
<p><img alt="" height="148" src="https://images2.imgbox.com/a9/fe/EPjAxq1P_o.png" width="1048"></p> 
<pre><code>vi /etc/profile

#QT 配置
export QT_QPA_PLATFORM_PLUGIN_PATH=/usr/lib/qt/plugins
export QT_QPA_PLATFORM=linuxfb:tty=/dev/fb0
export QT_QPA_FONTDIR=/usr/lib/fonts</code></pre> 
<p>之后报错如下，是因为没有/dev/fb0设备</p> 
<p><img alt="" height="69" src="https://images2.imgbox.com/66/9c/Gwht9HbF_o.png" width="546"><img alt="" height="111" src="https://images2.imgbox.com/18/13/vmWRyNPN_o.png" width="528"></p> 
<p></p> 
<p>重新配置内核，打开framebuffer驱动</p> 
<p>在kernel目录下</p> 
<pre><code>make ARCH=arm rv1126_defconfig
make ARCH=arm menuconfig

//配置如下
Devices Drivers &gt; 
    Graphics support &gt; 
        Frame buffer Devices &gt;
         Support for frame buffer devices &gt;
             [*] Enable Video Mode Handling Helpers
             ********
             &lt;*&gt; ARM PrimeCell PL110 support
             
Devices Drivers &gt; 
    Graphics support &gt; 
        Direct Rendering Manager &gt;
            [*] Enable legacy fbdev support for your modesetting driver

退出保存
make ARCH=arm savedefconfig // 将.config 保存为 deconfig
cp defconfig arch/arm/configs/rv1126_defconfig
cd ..
./build.sh kernel</code></pre> 
<p>报错信息如下，找不到字体库</p> 
<p>Cannot find font directory /usr/lib/fonts</p> 
<p><img alt="" height="309" src="https://images2.imgbox.com/9d/23/Pp2zhTbd_o.png" width="993"></p> 
<p>在Windows下此路径，把其中的字体库文件拷贝到开发板target/usr/lib/fonts文件夹下</p> 
<p><img alt="" height="646" src="https://images2.imgbox.com/1a/e4/ULIM0Kwf_o.png" width="869"></p> 
<p>在SDK根目录下</p> 
<pre><code>./build.sh rootfs
./build.sh updateimg</code></pre> 
<p>随后烧录测试，运行可执行程序，屏幕成功显示界面</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0579e8c09576907cbf3251df878194d7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AKStream部署</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6a74836eadd01b109ff4d40ff54ae1ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu Setforeground 前台应用切换</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>