<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python数据爬取超详细讲解（零基础入门，老年人都看的懂） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python数据爬取超详细讲解（零基础入门，老年人都看的懂）" />
<meta property="og:description" content="本文已收录至Github，推荐阅读 👉 Java随想录
转载于：https://www.bilibili.com/video/BV12E411A7ZQ?spm_id_from=333.337.search-card.all.click
本文是根据视频教程记录的学习笔记，建议结合视频观看。
先看后赞，养成习惯。
点赞收藏，人生辉煌。
讲解我们的爬虫之前，先概述关于爬虫的简单概念（毕竟是零基础教程）
爬虫 网络爬虫（又被称为网页蜘蛛，网络机器人）就是模拟浏览器发送网络请求，接收请求响应，一种按照一定的规则，自动地抓取互联网信息的程序。
原则上,只要是浏览器(客户端)能做的事情，爬虫都能够做。
为什么我们要使用爬虫 互联网大数据时代，给予我们的是生活的便利以及海量数据爆炸式的出现在网络中。
过去，我们通过书籍、报纸、电视、广播或许信息，这些信息数量有限，且是经过一定的筛选，信息相对而言比较有效，但是缺点则是信息面太过于狭窄了。不对称的信息传导，以致于我们视野受限，无法了解到更多的信息和知识。
互联网大数据时代，我们突然间，信息获取自由了，我们得到了海量的信息，但是大多数都是无效的垃圾信息。
例如新浪微博，一天产生数亿条的状态更新，而在百度搜索引擎中，随意搜一条——减肥100,000,000条信息。
在如此海量的信息碎片中，我们如何获取对自己有用的信息呢？
答案是筛选！
通过某项技术将相关的内容收集起来，在分析删选才能得到我们真正需要的信息。
这个信息收集分析整合的工作，可应用的范畴非常的广泛，无论是生活服务、出行旅行、金融投资、各类制造业的产品市场需求等等……都能够借助这个技术获取更精准有效的信息加以利用。
网络爬虫技术，虽说有个诡异的名字，让能第一反应是那种软软的蠕动的生物，但它却是一个可以在虚拟世界里，无往不前的利器。
爬虫准备工作 我们平时都说Python爬虫，其实这里可能有个误解，爬虫并不是Python独有的，可以做爬虫的语言有很多例如：PHP,JAVA,C#,C&#43;&#43;,Python，选择Python做爬虫是因为Python相对来说比较简单，而且功能比较齐全。
首先我们需要下载python，我下载的是官方最新的版本 3.8.3
其次我们需要一个运行Python的环境，我用的是pychram
也可以从官方下载，
我们还需要一些库来支持爬虫的运行（有些库Python可能自带了）
差不多就是这几个库了，良心的我已经在后面写好注释了
（爬虫运行过程中，不一定就只需要上面几个库，看你爬虫的一个具体写法了，反正需要库的话我们可以直接在setting里面安装）
爬虫项目讲解 我们的爬取的内容是：电影详情链接，图片链接，影片中文名，影片外国名，评分，评价数，概况，相关信息。
代码分析 先把代码发放上来，然后我根据代码逐步解析
# -*- codeing = utf-8 -*- from bs4 import BeautifulSoup # 网页解析，获取数据 import re # 正则表达式，进行文字匹配` import urllib.request, urllib.error # 制定URL，获取网页数据 import xlwt # 进行excel操作 #import sqlite3 # 进行SQLite数据库操作 findLink = re.compile(r&#39;&lt;a href=&#34;(.*?)&#34;&gt;&#39;) # 创建正则表达式对象，标售规则 影片详情链接的规则 findImgSrc = re." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1f6eaf2b7574ce3ab57107fb04f28ebb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-20T22:05:11+08:00" />
<meta property="article:modified_time" content="2023-07-20T22:05:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python数据爬取超详细讲解（零基础入门，老年人都看的懂）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文已收录至Github，推荐阅读 👉 <a href="https://github.com/ZhengShuHai/JavaRecord">Java随想录</a></p> 
<p>转载于：<a href="https://www.bilibili.com/video/BV12E411A7ZQ?spm_id_from=333.337.search-card.all.click" rel="nofollow">https://www.bilibili.com/video/BV12E411A7ZQ?spm_id_from=333.337.search-card.all.click</a></p> 
<p>本文是根据视频教程记录的学习笔记，建议结合视频观看。</p> 
<blockquote> 
 <p>先看后赞，养成习惯。<br> 点赞收藏，人生辉煌。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/38/24/gHAYbYDr_o.png" alt="在这里插入图片描述"></p> 
<p><mark>讲解我们的爬虫之前，先概述关于爬虫的简单概念（毕竟是零基础教程）</mark></p> 
<h3><a id="_14"></a>爬虫</h3> 
<p>网络爬虫（又被称为网页蜘蛛，网络机器人）就是模拟浏览器发送网络请求，接收请求响应，一种按照一定的规则，自动地抓取互联网信息的程序。<br> 原则上,只要是浏览器(客户端)能做的事情，爬虫都能够做。</p> 
<h3><a id="_18"></a>为什么我们要使用爬虫</h3> 
<p>互联网大数据时代，给予我们的是生活的便利以及海量数据爆炸式的出现在网络中。<br> 过去，我们通过书籍、报纸、电视、广播或许信息，这些信息数量有限，且是经过一定的筛选，信息相对而言比较有效，但是缺点则是信息面太过于狭窄了。不对称的信息传导，以致于我们视野受限，无法了解到更多的信息和知识。<br> 互联网大数据时代，我们突然间，信息获取自由了，我们得到了海量的信息，但是大多数都是无效的垃圾信息。<br> 例如新浪微博，一天产生数亿条的状态更新，而在百度搜索引擎中，随意搜一条——减肥100,000,000条信息。<br> 在如此海量的信息碎片中，我们如何获取对自己有用的信息呢？<br> 答案是筛选！<br> 通过某项技术将相关的内容收集起来，在分析删选才能得到我们真正需要的信息。<br> 这个信息收集分析整合的工作，可应用的范畴非常的广泛，无论是生活服务、出行旅行、金融投资、各类制造业的产品市场需求等等……都能够借助这个技术获取更精准有效的信息加以利用。<br> 网络爬虫技术，虽说有个诡异的名字，让能第一反应是那种软软的蠕动的生物，但它却是一个可以在虚拟世界里，无往不前的利器。</p> 
<h3><a id="_30"></a>爬虫准备工作</h3> 
<p><mark>我们平时都说Python爬虫，其实这里可能有个误解，爬虫并不是Python独有的，可以做爬虫的语言有很多例如：PHP,JAVA,C#,C++,Python，选择Python做爬虫是因为Python相对来说比较简单，而且功能比较齐全。</mark><br> 首先我们需要下载python，我下载的是官方最新的版本 3.8.3<br> 其次我们需要一个运行Python的环境，我用的是pychram<br> <img src="https://images2.imgbox.com/35/90/hg4EwrwJ_o.png" alt="在这里插入图片描述"><br> 也可以从官方下载，<br> 我们还需要一些库来支持爬虫的运行（有些库Python可能自带了）<br> <img src="https://images2.imgbox.com/21/2b/9tWkizE5_o.png" alt="在这里插入图片描述"><br> 差不多就是这几个库了，良心的我已经在后面写好注释了<br> <img src="https://images2.imgbox.com/de/1a/fOCEUd44_o.png" alt="在这里插入图片描述"><br> <mark>（爬虫运行过程中，不一定就只需要上面几个库，看你爬虫的一个具体写法了，反正需要库的话我们可以直接在setting里面安装）</mark></p> 
<h3><a id="_43"></a>爬虫项目讲解</h3> 
<p>我们的爬取的内容是：<mark>电影详情链接，图片链接，影片中文名，影片外国名，评分，评价数，概况，相关信息。</mark></p> 
<h3><a id="_48"></a>代码分析</h3> 
<p>先把代码发放上来，然后我根据代码逐步解析</p> 
<pre><code class="prism language-python"><span class="token comment"># -*- codeing = utf-8 -*-</span>
<span class="token keyword">from</span> bs4 <span class="token keyword">import</span> BeautifulSoup  <span class="token comment"># 网页解析，获取数据</span>
<span class="token keyword">import</span> re  <span class="token comment"># 正则表达式，进行文字匹配`</span>
<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">,</span> urllib<span class="token punctuation">.</span>error  <span class="token comment"># 制定URL，获取网页数据</span>
<span class="token keyword">import</span> xlwt  <span class="token comment"># 进行excel操作</span>
<span class="token comment">#import sqlite3  # 进行SQLite数据库操作</span>

findLink <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;a href="(.*?)"&gt;'</span><span class="token punctuation">)</span>  <span class="token comment"># 创建正则表达式对象，标售规则   影片详情链接的规则</span>
findImgSrc <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;img.*src="(.*?)"'</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>
findTitle <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;span class="title"&gt;(.*)&lt;/span&gt;'</span><span class="token punctuation">)</span>
findRating <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;span class="rating_num" property="v:average"&gt;(.*)&lt;/span&gt;'</span><span class="token punctuation">)</span>
findJudge <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;span&gt;(\d*)人评价&lt;/span&gt;'</span><span class="token punctuation">)</span>
findInq <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;span class="inq"&gt;(.*)&lt;/span&gt;'</span><span class="token punctuation">)</span>
findBd <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;p class=""&gt;(.*?)&lt;/p&gt;'</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>




<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    baseurl <span class="token operator">=</span> <span class="token string">"https://movie.douban.com/top250?start="</span>  <span class="token comment">#要爬取的网页链接</span>
    <span class="token comment"># 1.爬取网页</span>
    datalist <span class="token operator">=</span> getData<span class="token punctuation">(</span>baseurl<span class="token punctuation">)</span>
    savepath <span class="token operator">=</span> <span class="token string">"豆瓣电影Top250.xls"</span>    <span class="token comment">#当前目录新建XLS，存储进去</span>
    <span class="token comment"># dbpath = "movie.db"              #当前目录新建数据库，存储进去</span>
    <span class="token comment"># 3.保存数据</span>
    saveData<span class="token punctuation">(</span>datalist<span class="token punctuation">,</span>savepath<span class="token punctuation">)</span>      <span class="token comment">#2种存储方式可以只选择一种</span>
    <span class="token comment"># saveData2DB(datalist,dbpath)</span>



<span class="token comment"># 爬取网页</span>
<span class="token keyword">def</span> <span class="token function">getData</span><span class="token punctuation">(</span>baseurl<span class="token punctuation">)</span><span class="token punctuation">:</span>
    datalist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment">#用来存储爬取的网页信息</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 调用获取页面信息的函数，10次</span>
        url <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span>
        html <span class="token operator">=</span> askURL<span class="token punctuation">(</span>url<span class="token punctuation">)</span>  <span class="token comment"># 保存获取到的网页源码</span>
        <span class="token comment"># 2.逐一解析数据</span>
        soup <span class="token operator">=</span> BeautifulSoup<span class="token punctuation">(</span>html<span class="token punctuation">,</span> <span class="token string">"html.parser"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> soup<span class="token punctuation">.</span>find_all<span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> class_<span class="token operator">=</span><span class="token string">"item"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 查找符合要求的字符串</span>
            data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 保存一部电影所有信息</span>
            item <span class="token operator">=</span> <span class="token builtin">str</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            link <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>findLink<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># 通过正则表达式查找</span>
            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>link<span class="token punctuation">)</span>
            imgSrc <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>findImgSrc<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>imgSrc<span class="token punctuation">)</span>
            titles <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>findTitle<span class="token punctuation">,</span> item<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>titles<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                ctitle <span class="token operator">=</span> titles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>ctitle<span class="token punctuation">)</span>
                otitle <span class="token operator">=</span> titles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>  <span class="token comment">#消除转义字符</span>
                data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>otitle<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>titles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>
            rating <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>findRating<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rating<span class="token punctuation">)</span>
            judgeNum <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>findJudge<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>judgeNum<span class="token punctuation">)</span>
            inq <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>findInq<span class="token punctuation">,</span> item<span class="token punctuation">)</span>
            <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>inq<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                inq <span class="token operator">=</span> inq<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"。"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>
                data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>inq<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span>
            bd <span class="token operator">=</span> re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span>findBd<span class="token punctuation">,</span> item<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            bd <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'&lt;br(\s+)?/&gt;(\s+)?'</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> bd<span class="token punctuation">)</span>
            bd <span class="token operator">=</span> re<span class="token punctuation">.</span>sub<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> bd<span class="token punctuation">)</span>
            data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>bd<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            datalist<span class="token punctuation">.</span>append<span class="token punctuation">(</span>data<span class="token punctuation">)</span>

    <span class="token keyword">return</span> datalist


<span class="token comment"># 得到指定一个URL的网页内容</span>
<span class="token keyword">def</span> <span class="token function">askURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 模拟浏览器头部信息，向豆瓣服务器发送消息</span>
        <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla / 5.0(Windows NT 10.0; Win64; x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 80.0.3987.122  Safari / 537.36"</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 用户代理，表示告诉豆瓣服务器，我们是什么类型的机器、浏览器（本质上是告诉浏览器，我们可以接收什么水平的文件内容）</span>

    request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>head<span class="token punctuation">)</span>
    html <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        html <span class="token operator">=</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> urllib<span class="token punctuation">.</span>error<span class="token punctuation">.</span>URLError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">"reason"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token keyword">return</span> html


<span class="token comment"># 保存数据到表格</span>
<span class="token keyword">def</span> <span class="token function">saveData</span><span class="token punctuation">(</span>datalist<span class="token punctuation">,</span>savepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"save......."</span><span class="token punctuation">)</span>
    book <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">,</span>style_compression<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">#创建workbook对象</span>
    sheet <span class="token operator">=</span> book<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span><span class="token string">'豆瓣电影Top250'</span><span class="token punctuation">,</span> cell_overwrite_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#创建工作表</span>
    col <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"电影详情链接"</span><span class="token punctuation">,</span><span class="token string">"图片链接"</span><span class="token punctuation">,</span><span class="token string">"影片中文名"</span><span class="token punctuation">,</span><span class="token string">"影片外国名"</span><span class="token punctuation">,</span><span class="token string">"评分"</span><span class="token punctuation">,</span><span class="token string">"评价数"</span><span class="token punctuation">,</span><span class="token string">"概况"</span><span class="token punctuation">,</span><span class="token string">"相关信息"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>col<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#列名</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># print("第%d条" %(i+1))       #输出语句，用来测试</span>
        data <span class="token operator">=</span> datalist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token punctuation">,</span>data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#数据</span>
    book<span class="token punctuation">.</span>save<span class="token punctuation">(</span>savepath<span class="token punctuation">)</span> <span class="token comment">#保存</span>

<span class="token comment"># def saveData2DB(datalist,dbpath):</span>
<span class="token comment">#     init_db(dbpath)</span>
<span class="token comment">#     conn = sqlite3.connect(dbpath)</span>
<span class="token comment">#     cur = conn.cursor()</span>
<span class="token comment">#     for data in datalist:</span>
<span class="token comment">#             for index in range(len(data)):</span>
<span class="token comment">#                 if index == 4 or index == 5:</span>
<span class="token comment">#                     continue</span>
<span class="token comment">#                 data[index] = '"'+data[index]+'"'</span>
<span class="token comment">#             sql = '''</span>
<span class="token comment">#                     insert into movie250(</span>
<span class="token comment">#                     info_link,pic_link,cname,ename,score,rated,instroduction,info)</span>
<span class="token comment">#                     values (%s)'''%",".join(data)</span>
<span class="token comment">#             # print(sql)     #输出查询语句，用来测试</span>
<span class="token comment">#             cur.execute(sql)</span>
<span class="token comment">#             conn.commit()</span>
<span class="token comment">#     cur.close</span>
<span class="token comment">#     conn.close()</span>


<span class="token comment"># def init_db(dbpath):</span>
<span class="token comment">#     sql = '''</span>
<span class="token comment">#         create table movie250(</span>
<span class="token comment">#         id integer  primary  key autoincrement,</span>
<span class="token comment">#         info_link text,</span>
<span class="token comment">#         pic_link text,</span>
<span class="token comment">#         cname varchar,</span>
<span class="token comment">#         ename varchar ,</span>
<span class="token comment">#         score numeric,</span>
<span class="token comment">#         rated numeric,</span>
<span class="token comment">#         instroduction text,</span>
<span class="token comment">#         info text</span>
<span class="token comment">#         )</span>
<span class="token comment">#</span>
<span class="token comment">#</span>
<span class="token comment">#     '''  #创建数据表</span>
<span class="token comment">#     conn = sqlite3.connect(dbpath)</span>
<span class="token comment">#     cursor = conn.cursor()</span>
<span class="token comment">#     cursor.execute(sql)</span>
<span class="token comment">#     conn.commit()</span>
<span class="token comment">#     conn.close()</span>

<span class="token comment"># 保存数据到数据库</span>







<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>  <span class="token comment"># 当程序执行时</span>
    <span class="token comment"># 调用函数</span>
     main<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># init_db("movietest.db")</span>
     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"爬取完毕！"</span><span class="token punctuation">)</span>

</code></pre> 
<p><strong>下面我根据代码，从下到下给大家讲解分析一遍</strong><br> <img src="https://images2.imgbox.com/5b/7a/i8EQwl9C_o.png" alt="在这里插入图片描述"></p> 
<p>-<em>- codeing = utf-8 -</em>-，开头的这个是设置编码为utf-8 ，写在开头，防止乱码。<br> 然后下面 <mark>import</mark>就是导入一些库，做做准备工作，（sqlite3这库我并没有用到所以我注释起来了）。<br> 下面一些<mark>find</mark>开头的是正则表达式，是用来我们筛选信息的。<br> （正则表达式用到 re 库，也可以不用正则表达式，不是必须的。）<br> 大体流程分三步走：</p> 
<p><strong>1. 爬取网页<br> 2.逐一解析数据<br> 3. 保存网页</strong></p> 
<p>先分析流程1，爬取网页，baseurl 就是我们要爬虫的网页网址，往下走，调用了 getData（baseurl) ,<br> 我们来看 getData方法</p> 
<pre><code class="prism language-python">  <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 调用获取页面信息的函数，10次</span>
        url <span class="token operator">=</span> baseurl <span class="token operator">+</span> <span class="token builtin">str</span><span class="token punctuation">(</span>i <span class="token operator">*</span> <span class="token number">25</span><span class="token punctuation">)</span>
</code></pre> 
<p>这段大家可能看不懂，其实是这样的：<br> 因为电影评分Top250，每个页面只显示25个，所以我们需要访问页面10次，25*10=250。</p> 
<pre><code class="prism language-python">baseurl <span class="token operator">=</span> <span class="token string">"https://movie.douban.com/top250?start="</span>
</code></pre> 
<p>我们只要在baseurl后面加上数字就会跳到相应页面，<mark>比如i=1时</mark></p> 
<p><a href="https://movie.douban.com/top250?start=25" rel="nofollow">https://movie.douban.com/top250?start=25</a></p> 
<p>我放上超链接，大家可以点击看看会跳到哪个页面，毕竟实践出真知。<br> <img src="https://images2.imgbox.com/8e/02/V6DWz50w_o.png" alt="在这里插入图片描述"></p> 
<p>然后又调用了askURL来请求网页，这个方法是请求网页的主体方法，<br> 怕大家翻页麻烦，我再把代码复制一遍，让大家有个直观感受</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">askURL</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment"># 模拟浏览器头部信息，向豆瓣服务器发送消息</span>
        <span class="token string">"User-Agent"</span><span class="token punctuation">:</span> <span class="token string">"Mozilla / 5.0(Windows NT 10.0; Win64; x64) AppleWebKit / 537.36(KHTML, like Gecko) Chrome / 80.0.3987.122  Safari / 537.36"</span>
    <span class="token punctuation">}</span>
    <span class="token comment"># 用户代理，表示告诉豆瓣服务器，我们是什么类型的机器、浏览器（本质上是告诉浏览器，我们可以接收什么水平的文件内容）</span>

    request <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>head<span class="token punctuation">)</span>
    html <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        response <span class="token operator">=</span> urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        html <span class="token operator">=</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> urllib<span class="token punctuation">.</span>error<span class="token punctuation">.</span>URLError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>code<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">hasattr</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> <span class="token string">"reason"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
    <span class="token keyword">return</span> html
</code></pre> 
<p>这个askURL就是用来向网页发送请求用的，<mark>那么这里就有老铁问了，为什么这里要写个head呢？</mark><br> <img src="https://images2.imgbox.com/cd/12/LnWFkWFx_o.png" alt="在这里插入图片描述"></p> 
<p>这是因为我们要是不写的话，访问某些网站的时候会被认出来爬虫，显示错误，错误代码</p> 
<h3><a id="418_279"></a>418</h3> 
<p>这是一个梗大家可以百度下，</p> 
<blockquote> 
 <p>418 I’m a teapot</p> 
 <p>The HTTP 418 I’m a teapot client error response code indicates that<br> the server refuses to brew coffee because it is a teapot. This error<br> is a reference to Hyper Text Coffee Pot Control Protocol which was an<br> April Fools’ joke in 1998.</p> 
</blockquote> 
<p><strong>我是一个茶壶</strong></p> 
<p><img src="https://images2.imgbox.com/de/ec/ykAIlJdo_o.png" alt="在这里插入图片描述"></p> 
<p>所以我们需要 “装” ，装成我们就是一个浏览器，这样就不会被认出来，<br> 伪装一个身份。<br> <img src="https://images2.imgbox.com/b8/0e/2SXZPfOE_o.png" alt="在这里插入图片描述"></p> 
<p>来，我们继续往下走，</p> 
<pre><code class="prism language-python">  html <span class="token operator">=</span> response<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">"utf-8"</span><span class="token punctuation">)</span>
</code></pre> 
<p>这段就是我们读取网页的内容，设置编码为utf-8，目的就是为了防止乱码。<br> 访问成功后，来到了第二个流程：</p> 
<p><strong>2.逐一解析数据</strong></p> 
<p>解析数据这里我们用到了 BeautifulSoup（靓汤） 这个库，这个库是几乎是做爬虫必备的库，无论你是什么写法。</p> 
<p>下面就开始查找符合我们要求的数据，用BeautifulSoup的方法以及 re 库的<br> 正则表达式去匹配，</p> 
<pre><code class="prism language-python">findLink <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;a href="(.*?)"&gt;'</span><span class="token punctuation">)</span>  <span class="token comment"># 创建正则表达式对象，标售规则   影片详情链接的规则</span>
findImgSrc <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;img.*src="(.*?)"'</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>
findTitle <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;span class="title"&gt;(.*)&lt;/span&gt;'</span><span class="token punctuation">)</span>
findRating <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;span class="rating_num" property="v:average"&gt;(.*)&lt;/span&gt;'</span><span class="token punctuation">)</span>
findJudge <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;span&gt;(\d*)人评价&lt;/span&gt;'</span><span class="token punctuation">)</span>
findInq <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;span class="inq"&gt;(.*)&lt;/span&gt;'</span><span class="token punctuation">)</span>
findBd <span class="token operator">=</span> re<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span><span class="token string">r'&lt;p class=""&gt;(.*?)&lt;/p&gt;'</span><span class="token punctuation">,</span> re<span class="token punctuation">.</span>S<span class="token punctuation">)</span>
</code></pre> 
<p>匹配到符合我们要求的数据，然后存进 <mark>dataList <mark>， 所以</mark> dataList</mark> 里就存放着我们需要的数据了。</p> 
<p>最后一个流程：</p> 
<p><strong>3.保存数据</strong></p> 
<pre><code class="prism language-python">    <span class="token comment"># 3.保存数据</span>
    saveData<span class="token punctuation">(</span>datalist<span class="token punctuation">,</span>savepath<span class="token punctuation">)</span>      <span class="token comment">#2种存储方式可以只选择一种</span>
    <span class="token comment"># saveData2DB(datalist,dbpath)</span>
</code></pre> 
<p>保存数据可以选择保存到 xls 表， 需要（xlwt库支持）<br> 也可以选择保存数据到 sqlite数据库， 需要（sqlite3库支持）</p> 
<p><mark>这里我选择保存到 xls 表 ，这也是为什么我注释了一大堆代码，注释的部分就是保存到 sqlite 数据库的代码，二者选一就行</mark></p> 
<p>保存到 xls 的主体方法是 saveData <mark>（下面的saveData2DB方法是保存到sqlite数据库）</mark>：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">saveData</span><span class="token punctuation">(</span>datalist<span class="token punctuation">,</span>savepath<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"save......."</span><span class="token punctuation">)</span>
    book <span class="token operator">=</span> xlwt<span class="token punctuation">.</span>Workbook<span class="token punctuation">(</span>encoding<span class="token operator">=</span><span class="token string">"utf-8"</span><span class="token punctuation">,</span>style_compression<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment">#创建workbook对象</span>
    sheet <span class="token operator">=</span> book<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span><span class="token string">'豆瓣电影Top250'</span><span class="token punctuation">,</span> cell_overwrite_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#创建工作表</span>
    col <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"电影详情链接"</span><span class="token punctuation">,</span><span class="token string">"图片链接"</span><span class="token punctuation">,</span><span class="token string">"影片中文名"</span><span class="token punctuation">,</span><span class="token string">"影片外国名"</span><span class="token punctuation">,</span><span class="token string">"评分"</span><span class="token punctuation">,</span><span class="token string">"评价数"</span><span class="token punctuation">,</span><span class="token string">"概况"</span><span class="token punctuation">,</span><span class="token string">"相关信息"</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>i<span class="token punctuation">,</span>col<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#列名</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">250</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># print("第%d条" %(i+1))       #输出语句，用来测试</span>
        data <span class="token operator">=</span> datalist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            sheet<span class="token punctuation">.</span>write<span class="token punctuation">(</span>i<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span>j<span class="token punctuation">,</span>data<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#数据</span>
    book<span class="token punctuation">.</span>save<span class="token punctuation">(</span>savepath<span class="token punctuation">)</span> <span class="token comment">#保存</span>
</code></pre> 
<p>创建工作表，创列（会在当前目录下创建），</p> 
<pre><code class="prism language-python">   sheet <span class="token operator">=</span> book<span class="token punctuation">.</span>add_sheet<span class="token punctuation">(</span><span class="token string">'豆瓣电影Top250'</span><span class="token punctuation">,</span> cell_overwrite_ok<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span> <span class="token comment">#创建工作表</span>
    col <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"电影详情链接"</span><span class="token punctuation">,</span><span class="token string">"图片链接"</span><span class="token punctuation">,</span><span class="token string">"影片中文名"</span><span class="token punctuation">,</span><span class="token string">"影片外国名"</span><span class="token punctuation">,</span><span class="token string">"评分"</span><span class="token punctuation">,</span><span class="token string">"评价数"</span><span class="token punctuation">,</span><span class="token string">"概况"</span><span class="token punctuation">,</span><span class="token string">"相关信息"</span><span class="token punctuation">)</span>
</code></pre> 
<p>然后把 dataList里的数据一条条存进去就行。</p> 
<p>最后运作成功后，会在左侧生成这么一个文件<br> <img src="https://images2.imgbox.com/a3/59/YcVSXnxi_o.png" alt="在这里插入图片描述"></p> 
<p>打开之后看看是不是我们想要的结果</p> 
<p><strong>成了，成了！</strong></p> 
<p><img src="https://images2.imgbox.com/e0/86/jURs5Qco_o.png" alt="在这里插入图片描述"></p> 
<p><mark>如果我们需要以数据库方式存储，可以先生成 xls 文件，再把 xls 文件导入数据库中，就可以啦</mark></p> 
<blockquote> 
 <p>本篇文章讲解到这里啦，我感觉我讲的还算细致吧，爬虫我也是最近才可以学，对这个比较有兴趣，我肯定有讲的不好的地方，欢迎各位大佬来指正我 。</p> 
</blockquote> 
<p><strong>我也在不断的学习中，学到新东西第一时间会跟大家分享<br> 大家可以动动小手，点波关注不迷路。</strong></p> 
<p><mark>如果关于本篇文章有不懂的地方，欢迎大家下面留言，我知道的都会给大家一 一解答。</mark></p> 
<p><font color="red">最后给大家放波福利，博主最近在搞阿里云推广，<br> <font color="red">活动折扣价：全网最低价87元/年，261元/3年，比学生9.9每月还便宜(只阿里云新用户可用)<br> 新用户可以入手试试，有一台属于自己的服务器，前期用来部署和学习都很方便</font></font></p> 
<p>阿里云 【<a href="https://www.aliyun.com/minisite/goods?userCode=d8tcn0bz" rel="nofollow">点击购买</a>】<br> <img src="https://images2.imgbox.com/6f/9e/2C13Q2Je_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<blockquote> 
 <p><strong>白嫖不好，创作不易</strong>。各位的点赞就是我创作的最大动力，如果我有哪里写的不对，欢迎评论区留言进行指正。<br> 老铁，如果有收获，请点个免费的赞鼓励一下博主呗</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/4e/21/7quXj5Vz_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/00236eacccba70480d1b2255b7a4a48c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Springboot实现微信公众号模板消息发送</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/18f5bb92bd04204cb49b48015ef10e8b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue中如何让el-date-picker时间选择器组件结束时间不早于开始时间？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>