<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>el-table表格自动滚动 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="el-table表格自动滚动" />
<meta property="og:description" content="实现效果如下：
功能点：
1. 当表格内容超出时，自动滚动，滚动到最后一条之后在从头滚动。
2. 表格中的数据会定时刷新，刷新后数据更新。
3. 鼠标移入表格中，停止滚动；移出后，继续滚动。
4. 点击表格中的排序功能，拉取后端数据，从头滚动。
先说一说实现过程中遇到的大坑吧 坑1： vue-seamless-scroll依赖的使用 1. 安装并对应引入
yarn add vue-seamless-scroll 局部引入：
import vueSeamlessScroll from &#34;vue-seamless-scroll&#34;; components: { vueSeamlessScroll }, 2. 使用
用该组件包住要滚动的表格，并将表格数据传进去
参数：tableData是我的表格数据数组，defineScroll是滚动的参数，参考如下：
代码：
classOption() { return { step: 0.5, // 数值越大速度滚动越快 limitMoveNum: 5, // 开始无缝滚动的数据量 hoverStop: true, // 是否开启鼠标悬停stop direction: 1, // 0向下 1向上 2向左 3向右 openWatch: true, // 开启数据实时监控刷新dom singleHeight: 0, // 单步运动停止的高度(默认值0是无缝不停止的滚动) direction =&gt; 0/1 singleWidth: 0, // 单步运动停止的宽度(默认值0是无缝不停止的滚动) direction =&gt; 2/3 waitTime: 500, // 单步运动停止的时间(默认值1000ms) }; }, 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/dcf795af98da6034d84258c4f5b1dc1a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-26T11:09:49+08:00" />
<meta property="article:modified_time" content="2023-07-26T11:09:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">el-table表格自动滚动</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>实现效果如下：</strong></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/7c/3b/KWYZ6Eo0_o.gif"></p> 
<p><strong>功能点：</strong></p> 
<p><strong>1. 当表格内容超出时，自动滚动，滚动到最后一条之后在从头滚动。</strong></p> 
<p><strong>2. 表格中的数据会定时刷新，刷新后数据更新。</strong></p> 
<p><strong>3. 鼠标移入表格中，停止滚动；移出后，继续滚动。</strong></p> 
<p><strong>4. 点击表格中的排序功能，拉取后端数据，从头滚动。</strong></p> 
<p>先说一说实现过程中遇到的大坑吧 </p> 
<h4><strong><span style="color:#fe2c24;">坑1：</span> </strong>vue-seamless-scroll依赖的使用</h4> 
<p><strong>1. 安装并对应引入</strong></p> 
<pre><code class="language-javascript">yarn add vue-seamless-scroll</code></pre> 
<p>局部引入：</p> 
<p class="img-center"><img alt="" height="198" src="https://images2.imgbox.com/6a/70/F1qqwcaL_o.png" width="433"></p> 
<pre><code class="language-javascript">import vueSeamlessScroll from "vue-seamless-scroll";

components: { vueSeamlessScroll },</code></pre> 
<p><strong>2. 使用</strong></p> 
<p>用该组件包住要滚动的表格，并将表格数据传进去</p> 
<p class="img-center"><img alt="" height="134" src="https://images2.imgbox.com/12/d9/2Fcgk8TM_o.png" width="365"></p> 
<p>参数：tableData是我的表格数据数组，defineScroll是滚动的参数，参考如下：</p> 
<p><img alt="" height="264" src="https://images2.imgbox.com/bb/a0/RSf7LkI5_o.png" width="677"></p> 
<p> 代码：</p> 
<pre><code class="language-javascript">classOption() {
      return {
        step: 0.5, // 数值越大速度滚动越快
        limitMoveNum: 5, // 开始无缝滚动的数据量
        hoverStop: true, // 是否开启鼠标悬停stop
        direction: 1, // 0向下 1向上 2向左 3向右
        openWatch: true, // 开启数据实时监控刷新dom
        singleHeight: 0, // 单步运动停止的高度(默认值0是无缝不停止的滚动) direction =&gt; 0/1
        singleWidth: 0, // 单步运动停止的宽度(默认值0是无缝不停止的滚动) direction =&gt; 2/3
        waitTime: 500, // 单步运动停止的时间(默认值1000ms)
      };
    },</code></pre> 
<p>3. 实际效果：<img alt="" height="272" src="https://images2.imgbox.com/c4/8b/m24BlOiY_o.gif" width="809"></p> 
<p>表头也会跟着滚动，要想表头不滚动很简单，利用两个表格组件，</p> 
<p>        a. 需要滚动的表格去掉表头，用<strong>vueSeamlessScroll </strong>组件包着，        </p> 
<p>        b. 将另一个表格放在<strong>vueSeamlessScroll </strong>组件外边，只显示表格标题。</p> 
<p>除此之外这个组件有个缺陷：数据更新的时候，dom却不会更新。</p> 
<p>如上图，当数据量从17变为15时，滚动的dom的高度依旧是17的高度。为了解决这个问题，可以利用v-if的强制刷新。在数据有更新时先将<strong>updateFlag</strong>设为false,过100毫秒再设为true。</p> 
<p class="img-center"><img alt="" height="164" src="https://images2.imgbox.com/a0/77/Qec5Gx8T_o.png" width="405"></p> 
<p class="img-center"><img alt="" height="76" src="https://images2.imgbox.com/a7/f6/2up03F8v_o.png" width="232"></p> 
<p> 如此，基本上能保证正常显示所有的数据。但强制刷新会使得滚动进度刷新，从头开始滚。</p> 
<p>看似很完美，但是坑在业务场景了，我们这边的数据刷新频率在10秒左右，也就意味着在我们的业务场景中只会看到前几条数据，因为每次数据更新，都会从头滚动。</p> 
<p>基于此我放弃了该依赖的使用。</p> 
<p> <strong><span style="color:#fe2c24;">坑2：</span> </strong>使用scrollTop属性，找不到表格的bodyWrapper</p> 
<p>看了好多文章，都说直接取用this.$refs.myTable.bodyWrapper，搁我这就直接报错，就找不着这个bodyWrapper。</p> 
<h4>实际实现步骤</h4> 
<p>主要实现逻辑使用的是操作表格体的滚动条，也就是坑2中找不到的bodyWrapper。</p> 
<p><strong>1. 找到要操作的dom节点</strong></p> 
<p><img alt="" height="739" src="https://images2.imgbox.com/4f/7a/6AzGz259_o.gif" width="1200"></p> 
<p> 具体操作如上图，找到表格体的外层dom节点，有滚动条属性。然后点击右键将该节点显示在控制台上，修改该节点的scrollTop值，发现表格内容上移了，说明我们找对了节点。</p> 
<p>接下来就是在代码中找到该节点，给表格加一个<strong>ref="tableData"</strong>，然后你可以打印一下<strong>this.$refs.tableData</strong>，手动找一下刚刚在控制台操作的那个元素，我的是<strong>this.$refs.tableData.$refs.bodyWrapperScrollbar.$refs.wrap</strong>，然后操作一下该元素的<strong>scrollTop</strong>属性，看是否能操作表格的滚动条，这里有一个<strong>坑：</strong>直接操作可能不会生效，需要一个定时器改动。</p> 
<p><strong>2. 控制该节点的scrollTop属性</strong></p> 
<p><strong>整体代码如下：</strong></p> 
<p class="img-center"><img alt="" height="344" src="https://images2.imgbox.com/57/cd/p8b1vxqy_o.png" width="613"></p> 
<p>封装了方法之后，在<strong>created</strong>或<strong>mounted</strong>调用该方法即可。</p> 
<p>其中定时器中(1000 / 60) * 3是定时执行的时间，控制滚动的快慢，可以自定义时间。</p> 
<p>除此之外还有个需求就是：<strong>鼠标移入表格区，暂停移动，鼠标移出表格区继续移动。</strong></p> 
<p>封装一个停止移动的方法，同时给表格增加方法：鼠标移入停止移动，出来之后继续移动。</p> 
<p class="img-center"><img alt="" height="77" src="https://images2.imgbox.com/e6/e2/yUwHvqpT_o.png" width="326"></p> 
<p class="img-center"><img alt="" height="290" src="https://images2.imgbox.com/6b/98/e8D4X1ga_o.png" width="452"></p> 
<p>除此之外，还有一个需求是：手动点击某一列的排序时，需要从头滚动，则需要一个参数scrollInitFlag，用来判断是否从头滚动，初始值为true，在排序方法中将该值设置为true，同时在autoScrollFn方法中增加逻辑，如下图：</p> 
<p class="img-center"><img alt="" height="554" src="https://images2.imgbox.com/7a/ca/68HDXXXY_o.png" width="610"></p> 
<p> 完整代码如下：</p> 
<pre><code class="language-javascript">// 表格自动滚动
    autoScrollFn() {
      clearInterval(this.scrollTimer);
      this.$nextTick(() =&gt; {
        const tBody =
          this.$refs.tableData.$refs.bodyWrapperScrollbar.$refs.wrap;
        // 当可视窗口高度大于表格高度时，不滚动
        if (tBody.clientHeight &gt; tBody.scrollHeight) {
          return;
        }
        if (this.scrollInitFlag) {
          tBody.scrollTop = 0;
          this.scrollInitFlag = false;
        }
        this.scrollTimer = setInterval(() =&gt; {
          tBody.scrollTop += 1; // 每次上滑一个像素
          // 当滚动到最底部(可视高度+距离顶部=整个高度)时，从头开始滚
          if (tBody.clientHeight + tBody.scrollTop === tBody.scrollHeight) {
            tBody.scrollTop = 0;
          }
        }, (1000 / 60) * 3); // 1000 / 60
      });
    },


stopScrollFn() {
      clearInterval(this.scrollTimer);
      this.scrollTimer = null;
    },


// 排序
    sortChangeFn({ column, prop, order }) {
      console.log(column, prop, order);
      // 调用后端接口
      this.getDataFn();
      this.scrollInitFlag = true;
    },</code></pre> 
<p>基本上完了，做完之后我发现文字滚动的时候会抖动，暂时还没有啥好的想法，还有页面缩放之后滚动也不生效了，后面再解决吧。</p> 
<p>从实际应用来看，若是没有我这么频繁的数据刷新，还是用vue-seamless-scroll依赖吧</p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3f8d3539ff7781f003ca1d708b9997a1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">yolov5 6.1 关于 tensorrt 加速的使用以及问题说明</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a7e941830d74f06cd76054924807b036/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Cilium Host Routing Mode</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>