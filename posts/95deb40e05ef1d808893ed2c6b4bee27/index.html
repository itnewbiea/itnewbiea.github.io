<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ROS环境下采用PCL点云库对PCD格式点云进行滤波、旋转和平移等处理，并用RVIZ实时显示 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ROS环境下采用PCL点云库对PCD格式点云进行滤波、旋转和平移等处理，并用RVIZ实时显示" />
<meta property="og:description" content="一、环境配置
操作系统: Ubuntu 18.04
ROS版本: ROS Melodic Morenia
说明: 我仅仅在上述环境下进行了验证调试，其它版本应该也是可以用的。
二、安装教程
1. 安装好ubuntu系统和ROS环境
2. 打开终端，并在终端命令行输入以下指令:
3. git clone https://gitee.com/wccworld/read_pcd.git
4. cd read_pcd/catkin_ws
5. catkin_make
6. source devel/setup.bash
7. roslaunch read_pcd read_pcd.launch
三、核心代码
1. 读取.pcd格式点云文件，并转化为ROS可发布点云格式PointCloud2
/********************************PCD点云获取**********************************************/ pcl::PointCloud&lt;PointType&gt;::Ptr pcd_cloud_in (new pcl::PointCloud&lt;PointType&gt;); if (pcl::io::loadPCDFile&lt;PointType&gt; (pcd_doc_path, *pcd_cloud_in) == -1) { PCL_ERROR (&#34;Couldn&#39;t read file: %s \n&#34;, pcd_doc_path.c_str()); return (-1); } sensor_msgs::PointCloud2 input_cloud; pcl::toROSMsg(*pcd_cloud_in,input_cloud); input_cloud.header.frame_id = output_frame_id; // read_pcd_pub.publish(input_cloud); /****************************************************************************************/ 2. 直通滤波器对X轴进行滤波（ PCL点云滤波的主要内容、原理和详细使用说明可参考此篇文章 https://zhuanlan.zhihu.com/p/102748557 ）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/95deb40e05ef1d808893ed2c6b4bee27/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-19T16:32:09+08:00" />
<meta property="article:modified_time" content="2022-05-19T16:32:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ROS环境下采用PCL点云库对PCD格式点云进行滤波、旋转和平移等处理，并用RVIZ实时显示</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>一、环境配置</strong><br>       操作系统: Ubuntu 18.04<br>       ROS版本: <a href="http://wiki.ros.org/cn/melodic/Installation" rel="nofollow" title="ROS Melodic Morenia">ROS Melodic Morenia</a></p> 
<p><span style="color:#fe2c24;">      说明: </span>我仅仅在上述环境下进行了验证调试，其它版本应该也是可以用的。</p> 
<p><strong>二、安装教程</strong><br>        1.  安装好ubuntu系统和ROS环境<br>        2.  打开终端，并在终端命令行输入以下指令:<br>        3.  git clone https://gitee.com/wccworld/read_pcd.git<br>        4.  cd read_pcd/catkin_ws<br>        5.  catkin_make<br>        6.  source devel/setup.bash<br>        7.  roslaunch read_pcd read_pcd.launch</p> 
<p><strong>三、核心代码</strong></p> 
<p>       1.  读取.pcd格式点云文件，并转化为ROS可发布点云格式PointCloud2</p> 
<pre><code class="language-cpp">/********************************PCD点云获取**********************************************/
    pcl::PointCloud&lt;PointType&gt;::Ptr pcd_cloud_in (new pcl::PointCloud&lt;PointType&gt;);
    if (pcl::io::loadPCDFile&lt;PointType&gt; (pcd_doc_path, *pcd_cloud_in) == -1)
    {
    PCL_ERROR ("Couldn't read file: %s \n", pcd_doc_path.c_str());
    return (-1);
    }

    sensor_msgs::PointCloud2 input_cloud;
    pcl::toROSMsg(*pcd_cloud_in,input_cloud);
    input_cloud.header.frame_id = output_frame_id;
    // read_pcd_pub.publish(input_cloud);
/****************************************************************************************/</code></pre> 
<p>       2.  直通滤波器对X轴进行滤波（  PCL点云滤波的主要内容、原理和详细使用说明可参考此篇文章  <a class="link-info" href="https://zhuanlan.zhihu.com/p/102748557" rel="nofollow" title="https://zhuanlan.zhihu.com/p/102748557">https://zhuanlan.zhihu.com/p/102748557</a>  ）</p> 
<pre><code class="language-cpp"> //  直通滤波器 X 轴滤波 
    pcl::PointCloud&lt;PointType&gt;::Ptr filter_x (new pcl::PointCloud&lt;PointType&gt;);
    pcl::PassThrough&lt;PointType&gt; ptx;
    ptx.setInputCloud(pcd_cloud_in);                 //输入点云
    ptx.setFilterFieldName("x");                     //对x轴进行操作
    ptx.setFilterLimits(pass_x_min, pass_x_max);     //设置直通滤波器操作范围
    // ptx.setFilterLimitsNegative(true);              //设置保留范围内，还是过滤掉范围内
    ptx.filter(*filter_x);                           //执行滤波，过滤结果保存在filter_x</code></pre> 
<p>       3.  VoxelGrid滤波器对点云进行下采样</p> 
<pre><code class="language-cpp">//  体素降采样
    pcl::PointCloud&lt;PointType&gt;::Ptr vox_cloud(new pcl::PointCloud&lt;PointType&gt;);
    pcl::VoxelGrid&lt;PointType&gt; vox_grid;
    vox_grid.setInputCloud(filter_z);
    vox_grid.setLeafSize(voxel_size, voxel_size, voxel_size); //设置滤波时创建的体素立方体(m)
    vox_grid.filter(*vox_cloud);</code></pre> 
<p>       4.  statisticalOutlierRemoval滤波器移除离群点</p> 
<pre><code class="language-cpp">//  statisticalOutlierRemoval滤波器移除离群点
    pcl::PointCloud&lt;PointType&gt;::Ptr filtered_cloud(new pcl::PointCloud&lt;PointType&gt;);
	pcl::StatisticalOutlierRemoval&lt;PointType&gt; sor;   
	sor.setInputCloud(vox_cloud);                                                 
	sor.setMeanK(sor_nearby_number);                            //设置在进行统计时考虑查询点临近点数                                              
	sor.setStddevMulThresh(sor_thresh_value);                   //设置判断是否为离群点的阀值                                           
	sor.filter(*filtered_cloud);  </code></pre> 
<p>       5.  点云旋转和平移操作</p> 
<pre><code class="language-cpp">//  点云旋转和平移操作
    for(int i = 0; i &lt; filtered_cloud-&gt;points.size(); i++) 
    {
        PointType new_point;
        double rx_x,rx_y,rx_z,ry_x,ry_y,ry_z,rz_x,rz_y,rz_z;

        double px = filtered_cloud-&gt;points[i].x;
        double py = filtered_cloud-&gt;points[i].y;
        double pz = filtered_cloud-&gt;points[i].z;
        double pi = filtered_cloud-&gt;points[i].intensity;
        
        //  点云绕 X 旋转
        rx_x = px;
        rx_y = cos(rad(x_rotate_value))*py + (-sin(rad(x_rotate_value)))*pz;
        rx_z = sin(rad(x_rotate_value))*py + cos(rad(x_rotate_value))*pz;

        //  点云绕 Y 旋转
        ry_x = cos(rad(y_rotate_value))*rx_x + (-sin(rad(y_rotate_value)))*rx_z;
        ry_y = rx_y;
        ry_z = sin(rad(y_rotate_value))*rx_x + cos(rad(y_rotate_value))*rx_z;

        //  点云绕 Z 旋转
        rz_x = cos(rad(z_rotate_value))*ry_x + (-sin(rad(z_rotate_value)))*ry_y;
        rz_y = sin(rad(z_rotate_value))*ry_x + cos(rad(z_rotate_value))*ry_y;
        rz_z = ry_z;

        //  点云整体平移
        new_point.x = rz_x + x_trans_value;
        new_point.y = rz_y + y_trans_value;
        new_point.z = rz_z + z_trans_value;
        
        new_point.intensity = pi;
        handle_cloud-&gt;points.push_back(new_point);
    }</code></pre> 
<p><strong>四、使用说明</strong><br>        找到所下载源码里的read_pcd.launch文件，只需对相应参数进行修改，便可实现PCL点云的滤波、体素降采样、移除离群点、旋转以及平移等操作，具体参数代表的内容如下所示:</p> 
<pre><code class="language-XML">&lt;launch&gt;
  &lt;param name="output_frame_id" value = "map" /&gt;                   # 设置frame_id
  &lt;param name="pointCloud_pubTopic" value = "/handle_point" /&gt;     # 设置处理后点云的输出话题名
  &lt;param name="pcd_doc_path" value = "/home/wcc/SLAM/map_result/lio_sam/GlobalMap.pcd" /&gt;       # 设置所要加载的PCD文件路径，此处需要用自己的PCD文件路径替换此路径
  &lt;param name="output_pcd_path" value = "/home/wcc/csdn/read_pcd/catkin_ws/pcd/output.pcd" /&gt;   # 设置处理完之后点云输出的PCD文件路径，此处需根据自己的路径进行修改

  &lt;param name="pass_x_min" value = "-100.0" /&gt;      # 设置直通滤波器进行X轴滤波时X的最小值
  &lt;param name="pass_x_max" value = "100.0" /&gt;       # 设置直通滤波器进行X轴滤波时X的最大值
  &lt;param name="pass_y_min" value = "-100.0" /&gt;      # 设置直通滤波器进行Y轴滤波时Y的最小值
  &lt;param name="pass_y_max" value = "100.0" /&gt;       # 设置直通滤波器进行Y轴滤波时Y的最大值
  &lt;param name="pass_z_min" value = "-1.0" /&gt;        # 设置直通滤波器进行Z轴滤波时Z的最小值
  &lt;param name="pass_z_max" value = "30.0" /&gt;        # 设置直通滤波器进行Z轴滤波时Z的最大值
  &lt;param name="voxel_size" value = "0.1" /&gt;         # 设置滤波时创建的体素体积值，单位(M)
  &lt;param name="sor_nearby_number" value = "10" /&gt;   # 设置在进行统计时考虑查询点临近点数
  &lt;param name="sor_thresh_value" value = "5.0" /&gt;   # 设置判断是否为离群点的阀值
  &lt;param name="x_rotate_value" value = "0.0" /&gt;     # 设置整体点云绕X轴旋转的角度值
  &lt;param name="y_rotate_value" value = "0.0" /&gt;     # 设置整体点云绕y轴旋转的角度值
  &lt;param name="z_rotate_value" value = "0.0" /&gt;     # 设置整体点云绕z轴旋转的角度值
  &lt;param name="x_trans_value" value = "0.0" /&gt;      # 设置整体点云绕x轴平移的距离值
  &lt;param name="y_trans_value" value = "20.0" /&gt;     # 设置整体点云绕y轴平移的距离值
  &lt;param name="z_trans_value" value = "0.0" /&gt;      # 设置整体点云绕z轴平移的距离值

  &lt;node pkg="read_pcd" name="read_pcd" type="read_pcd" output="screen" /&gt;
  &lt;node pkg="rviz" type="rviz" name="rviz" args="-d $(find read_pcd)/rviz/read_pcd.rviz" /&gt;
&lt;/launch&gt;</code></pre> 
<p><strong>五、结果展示</strong></p> 
<div style="text-align:center;"> 
 <div class="img-center"> 
  <figure class="image"> 
   <img alt="" height="450" src="https://images2.imgbox.com/c7/f3/Cd15OkrT_o.png" width="800"> 
   <figcaption> 
    <strong>rviz显示.pcd格式原始点云</strong> 
   </figcaption> 
  </figure> 
 </div> 
</div> 
<div style="text-align:center;"> 
 <div class="img-center"> 
  <figure class="image"> 
   <img alt="" height="450" src="https://images2.imgbox.com/4d/0b/Ru0HhQXa_o.png" width="800"> 
   <figcaption> 
    <strong>rviz显示.pcd格式处理之后的点云</strong> 
   </figcaption> 
  </figure> 
 </div> 
</div> 
<p><br><strong>六、源码链接</strong></p> 
<p><a class="link-info" href="https://gitee.com/wccworld/read_pcd" rel="nofollow" title="        https://gitee.com/wccworld/read_pcd">        https://gitee.com/wccworld/read_pcd</a></p> 
<p><strong>七、总结</strong></p> 
<p><strong>       创作不易，代码完全开源，可随意更改学习和使用！</strong></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/44603e7166dbfad3894017e39a4f8721/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">接口测试之Postman使用全指南(原来使用 Postman测试API接口如此简单)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/56217c03444e42a4c8e445b3f82dbd70/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">matlab中geoshow函数的使用/属性设置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>