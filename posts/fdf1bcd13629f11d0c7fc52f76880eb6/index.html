<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>R语言中连接数据库——Mongodb - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="R语言中连接数据库——Mongodb" />
<meta property="og:description" content="R语言中连接数据库——Mongodb 文章目录 R语言中连接数据库——Mongodb一、项目环境二、mongolite 包安装三、mongolite 包的使用四、mongolite 包相关函数1、$aggregate2、$count3、$disconnect4、$distinct5、$drop6、$export7、$find8、$import9、$index10、$info11、$insert12、$iterate13、$mapreduce14、$remove15、$rename16、$replace17、$run18、$update 一、项目环境 开发工具：RStudioR：3.6.1相关包：mongolite 二、mongolite 包安装 # 方法一：直接通过CRAN进行安装 install.packages(&#34;mongolite&#34;) # 方法二：从github上安装 devtools::install_github(&#34;jeroen/mongolite&#34;) 三、mongolite 包的使用 library(mongolite) # 连接mongodb数据库 con &lt;- mongo(&#34;mtcars&#34;, url = &#34;mongodb://readwrite:test@mongo.opencpu.org:43942/jeroen_test&#34;) # collection：要连接的集合（数据表）的名称。默认为&#34;test&#34;。 # db：要连接的数据库的名称。默认为&#34;test&#34;。 # url：标准URI格式的MongoDB服务器的地址。 # verbose：如果TRUE，发出一些额外的输出 # options：其他连接选项，例如SSL密钥/证书。 # 如果数据表是空的，就自己插入一下 data(mtcars) con$insert(mtcars) [注]： 该url参数包含特殊的URI格式，该格式定义服务器地址和其他连接选项。格式如下：
mongodb://[用户名:密码@]数据库地址[:端口号][,数据库地址2[:端口号2],...[/[数据库名称][?其他连接选项]]
具体的url格式可以参考 《Mongo连接字符串手册》
# mongolite的一些具体操作 # 直接输出连接成功后数据库的变量，会输出mongodb常见操作的公式，及使用方法 print(con) # &lt;Mongo collection&gt; &#39;mtcars&#39; # $aggregate(pipeline = &#34;{}&#34;, options = &#34;{\&#34;allowDiskUse\&#34;:true}&#34;, handler = NULL, pagesize = 1000, iterate = FALSE) # $count(query = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/fdf1bcd13629f11d0c7fc52f76880eb6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-31T15:00:35+08:00" />
<meta property="article:modified_time" content="2023-05-31T15:00:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">R语言中连接数据库——Mongodb</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="RMongodb_1"></a>R语言中连接数据库——Mongodb</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#RMongodb_1" rel="nofollow">R语言中连接数据库——Mongodb</a></li><li><ul><li><a href="#_4" rel="nofollow">一、项目环境</a></li><li><a href="#mongolite__10" rel="nofollow">二、mongolite 包安装</a></li><li><a href="#mongolite__22" rel="nofollow">三、mongolite 包的使用</a></li><li><a href="#mongolite__73" rel="nofollow">四、mongolite 包相关函数</a></li><li><ul><li><a href="#1aggregate_77" rel="nofollow">1、$aggregate</a></li><li><a href="#2count_109" rel="nofollow">2、$count</a></li><li><a href="#3disconnect_123" rel="nofollow">3、$disconnect</a></li><li><a href="#4distinct_132" rel="nofollow">4、$distinct</a></li><li><a href="#5drop_144" rel="nofollow">5、$drop</a></li><li><a href="#6export_153" rel="nofollow">6、$export</a></li><li><a href="#7find_203" rel="nofollow">7、$find</a></li><li><a href="#8import_225" rel="nofollow">8、$import</a></li><li><a href="#9index_236" rel="nofollow">9、$index</a></li><li><a href="#10info_260" rel="nofollow">10、$info</a></li><li><a href="#11insert_299" rel="nofollow">11、$insert</a></li><li><a href="#12iterate_309" rel="nofollow">12、$iterate</a></li><li><a href="#13mapreduce_323" rel="nofollow">13、$mapreduce</a></li><li><a href="#14remove_357" rel="nofollow">14、$remove</a></li><li><a href="#15rename_370" rel="nofollow">15、$rename</a></li><li><a href="#16replace_379" rel="nofollow">16、$replace</a></li><li><a href="#17run_399" rel="nofollow">17、$run</a></li><li><a href="#18update_409" rel="nofollow">18、$update</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_4"></a>一、项目环境</h3> 
<ul><li>开发工具：RStudio</li><li>R：3.6.1</li><li>相关包：mongolite</li></ul> 
<h3><a id="mongolite__10"></a>二、mongolite 包安装</h3> 
<pre><code class="prism language-ruby"><span class="token comment"># 方法一：直接通过CRAN进行安装</span>
install<span class="token punctuation">.</span>packages<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"mongolite"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 方法二：从github上安装</span>

devtools<span class="token double-colon punctuation">::</span>install_github<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"jeroen/mongolite"</span></span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="mongolite__22"></a>三、mongolite 包的使用</h3> 
<pre><code class="prism language-ruby">library<span class="token punctuation">(</span>mongolite<span class="token punctuation">)</span>
<span class="token comment"># 连接mongodb数据库</span>

con <span class="token operator">&lt;</span><span class="token operator">-</span> mongo<span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"mtcars"</span></span><span class="token punctuation">,</span> url <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"mongodb://readwrite:test@mongo.opencpu.org:43942/jeroen_test"</span></span><span class="token punctuation">)</span>
<span class="token comment"># collection：要连接的集合（数据表）的名称。默认为"test"。</span>
<span class="token comment"># db：要连接的数据库的名称。默认为"test"。</span>
<span class="token comment"># url：标准URI格式的MongoDB服务器的地址。</span>
<span class="token comment"># verbose：如果TRUE，发出一些额外的输出</span>
<span class="token comment"># options：其他连接选项，例如SSL密钥/证书。</span>


<span class="token comment"># 如果数据表是空的，就自己插入一下</span>
data<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span>
con<span class="token variable">$insert</span><span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>[注]： 该<code>url</code>参数包含特殊的URI格式，该格式定义服务器地址和其他连接选项。格式如下：</p> 
 <p><code>mongodb://[用户名:密码@]数据库地址[:端口号][,数据库地址2[:端口号2],...[/[数据库名称][?其他连接选项]]</code></p> 
 <p>具体的url格式可以参考 <a href="https://docs.mongodb.com/manual/reference/connection-string/" rel="nofollow">《Mongo连接字符串手册》</a></p> 
</blockquote> 
<pre><code class="prism language-ruby"><span class="token comment"># mongolite的一些具体操作</span>
<span class="token comment"># 直接输出连接成功后数据库的变量，会输出mongodb常见操作的公式，及使用方法</span>
print<span class="token punctuation">(</span>con<span class="token punctuation">)</span>
<span class="token comment"># &lt;Mongo collection&gt; 'mtcars' </span>
<span class="token comment"># $aggregate(pipeline = "{}", options = "{\"allowDiskUse\":true}", handler = NULL, pagesize = 1000, iterate = FALSE) </span>
<span class="token comment"># $count(query = "{}") </span>
<span class="token comment"># $disconnect(gc = TRUE) </span>
<span class="token comment"># $distinct(key, query = "{}") </span>
<span class="token comment"># $drop() </span>
<span class="token comment"># $export(con = stdout(), bson = FALSE, query = "{}", fields = "{}", sort = "{\"_id\":1}") </span>
<span class="token comment"># $find(query = "{}", fields = "{\"_id\":0}", sort = "{}", skip = 0, limit = 0, handler = NULL, pagesize = 1000) </span>
<span class="token comment"># $import(con, bson = FALSE) </span>
<span class="token comment"># $index(add = NULL, remove = NULL) </span>
<span class="token comment"># $info() </span>
<span class="token comment"># $insert(data, pagesize = 1000, stop_on_error = TRUE, ...) </span>
<span class="token comment"># $iterate(query = "{}", fields = "{\"_id\":0}", sort = "{}", skip = 0, limit = 0) </span>
<span class="token comment"># $mapreduce(map, reduce, query = "{}", sort = "{}", limit = 0, out = NULL, scope = NULL) </span>
<span class="token comment"># $remove(query, just_one = FALSE) </span>
<span class="token comment"># $rename(name, db = NULL) </span>
<span class="token comment"># $replace(query, update = "{}", upsert = FALSE) </span>
<span class="token comment"># $run(command = "{\"ping\": 1}", simplify = TRUE) </span>
<span class="token comment"># $update(query, update = "{\"$set\":{}}", filters = NULL, upsert = FALSE, multiple = FALSE)  </span>
</code></pre> 
<h3><a id="mongolite__73"></a>四、mongolite 包相关函数</h3> 
<p>​ 接下来我们就根据官方给我们提供的常见函数表，一个一个进行讲解：</p> 
<h4><a id="1aggregate_77"></a>1、$aggregate</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># aggregate函数可以说是我使用最多的函数，很多操作都可以用这个函数实现</span>
con<span class="token variable">$aggregate</span><span class="token punctuation">(</span>'<span class="token punctuation">[</span>
                  <span class="token punctuation">{<!-- --></span>
                    <span class="token string-literal"><span class="token string">"$match"</span></span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-literal"><span class="token string">"cyl"</span></span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span>
                  <span class="token punctuation">}</span><span class="token punctuation">,</span>
                  <span class="token punctuation">{<!-- --></span>
                    <span class="token string-literal"><span class="token string">"$limit"</span></span><span class="token operator">:</span><span class="token number">3</span>
                  <span class="token punctuation">}</span> 
                <span class="token punctuation">]</span>'<span class="token punctuation">)</span>
<span class="token comment"># 该代码实现的功能用sql语句实现就是：</span>
<span class="token comment"># select * from mtcars where cyl = 4 limit 0, 3</span>
</code></pre> 
<table><thead><tr><th>SQL 操作/函数</th><th>mongodb aggregate操作</th></tr></thead><tbody><tr><td>select * from mtcars <font color="red">where</font> cyl = 4</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>match" : {“cyl” : 4}} ]')</td></tr><tr><td>select cyl as _id from mtcars <font color="red">group by</font> cyl</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>group" : {“_id” : “$cyl”}}]')</td></tr><tr><td><font color="red">select</font> cyl from mtcars</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>project“:{”_id" : 0, “cyl” : 1}}]')</td></tr><tr><td>select * from mtcars <font color="red">order by</font> cyl</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>sort" : {“cyl” : 1}}]')</td></tr><tr><td>select * from mtcars <font color="red">limit</font> 0, 4</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>limit" : 4}]')</td></tr><tr><td>select cyl as _id, <font color="red">count(1)</font> as count from mtcars group by cyl</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: aggregate('[{"</span>group" : {“_id” : “<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>sum” : 1}}}]')</td></tr><tr><td>select cyl as _id, <font color="red">sum(mpg)</font> as sum from mtcars group by cyl</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: aggregate('[{"</span>group" : {“_id”:“<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>sum”:“$mpg”}}}]')</td></tr><tr><td>select * from services, flows inner <font color="red">join</font> services.flow = flows.name</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>lookup": {“from” : “flows”,“localField” : “flow”, “foreignField” : “name”, “as” : “flow_detail”}} ]') <font color="red"> (没试过，不确定)</font></td></tr><tr><td>select * from mtcars order by <font color="red">rand()</font> limit 20</td><td>con<span class="katex--inline">KaTeX parse error: Expected '}', got 'EOF' at end of input: …nt color="red"&gt;</span>sample" : {“size” : 20}}]')</td></tr></tbody></table> 
<hr> 
<h4><a id="2count_109"></a>2、$count</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># $count()可以输出该数据表中有多少的数据</span>
<span class="token comment"># 在还不确定数据表大小的时候，可以先用这个函数看一下大小</span>
con<span class="token variable">$count</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># [1] 32</span>

con<span class="token variable">$count</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'{"cyl":4}'</span></span><span class="token punctuation">)</span>
<span class="token comment"># [1] 11</span>
</code></pre> 
<hr> 
<h4><a id="3disconnect_123"></a>3、$disconnect</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 断开连接用的</span>
con<span class="token variable">$disconnect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h4><a id="4distinct_132"></a>4、$distinct</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 去重，返回该字段的唯一值。</span>
con<span class="token variable">$distinct</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"mpg"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 可在后面增加其他条件加以限制。</span>
con<span class="token variable">$distinct</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"mpg"</span></span><span class="token punctuation">,</span> <span class="token string-literal"><span class="token string">'{"cyl":4}'</span></span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h4><a id="5drop_144"></a>5、$drop</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 删除数据表（警告：不要拿公司数据库试这个函数）</span>
con<span class="token variable">$drop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h4><a id="6export_153"></a>6、$export</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 将数据以json的形式输出，当bson = TRUE时，它会输出二进制bson格式。</span>
con<span class="token variable">$export</span><span class="token punctuation">(</span>query <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'{"mpg":19.2}'</span></span><span class="token punctuation">)</span>

<span class="token comment">#{ "_id" : { "$oid" : "5dd29754e9280000e8000fbd" }, "mpg" : 19.199999999999999289, "cyl" : 6.0, "disp" : 167.59999999999999432, "hp" : 123.0, "drat" : 3.9199999999999999289, "wt" : 3.4399999999999999467, "qsec" : 18.300000000000000711, "vs" : 1.0, "am" : 0.0, "gear" : 4.0, "carb" : 4.0, "_row" : "Merc 280" }</span>
<span class="token comment">#{ "_id" : { "$oid" : "5dd29754e9280000e8000fcc" }, "mpg" : 19.199999999999999289, "cyl" : 8.0, "disp" : 400.0, "hp" : 175.0, "drat" : 3.0800000000000000711, "wt" : 3.8450000000000001954, "qsec" : 17.050000000000000711, "vs" : 0.0, "am" : 0.0, "gear" : 3.0, "carb" : 2.0, "_row" : "Pontiac Firebird" }</span>
</code></pre> 
<pre><code class="prism language-json"># 整理后的json长这样
<span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"$oid"</span><span class="token operator">:</span> <span class="token string">"5dd29754e9280000e8000fbd"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"mpg"</span><span class="token operator">:</span> <span class="token number">19.199999999999999289</span><span class="token punctuation">,</span>
    <span class="token string-property property">"cyl"</span><span class="token operator">:</span> <span class="token number">6.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"disp"</span><span class="token operator">:</span> <span class="token number">167.59999999999999432</span><span class="token punctuation">,</span>
    <span class="token string-property property">"hp"</span><span class="token operator">:</span> <span class="token number">123.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"drat"</span><span class="token operator">:</span> <span class="token number">3.9199999999999999289</span><span class="token punctuation">,</span>
    <span class="token string-property property">"wt"</span><span class="token operator">:</span> <span class="token number">3.4399999999999999467</span><span class="token punctuation">,</span>
    <span class="token string-property property">"qsec"</span><span class="token operator">:</span> <span class="token number">18.300000000000000711</span><span class="token punctuation">,</span>
    <span class="token string-property property">"vs"</span><span class="token operator">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"am"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"gear"</span><span class="token operator">:</span> <span class="token number">4.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"carb"</span><span class="token operator">:</span> <span class="token number">4.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"_row"</span><span class="token operator">:</span> <span class="token string">"Merc 280"</span>
<span class="token punctuation">}</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"_id"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"$oid"</span><span class="token operator">:</span> <span class="token string">"5dd29754e9280000e8000fcc"</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"mpg"</span><span class="token operator">:</span> <span class="token number">19.199999999999999289</span><span class="token punctuation">,</span>
    <span class="token string-property property">"cyl"</span><span class="token operator">:</span> <span class="token number">8.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"disp"</span><span class="token operator">:</span> <span class="token number">400.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"hp"</span><span class="token operator">:</span> <span class="token number">175.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"drat"</span><span class="token operator">:</span> <span class="token number">3.0800000000000000711</span><span class="token punctuation">,</span>
    <span class="token string-property property">"wt"</span><span class="token operator">:</span> <span class="token number">3.8450000000000001954</span><span class="token punctuation">,</span>
    <span class="token string-property property">"qsec"</span><span class="token operator">:</span> <span class="token number">17.050000000000000711</span><span class="token punctuation">,</span>
    <span class="token string-property property">"vs"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"am"</span><span class="token operator">:</span> <span class="token number">0.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"gear"</span><span class="token operator">:</span> <span class="token number">3.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"carb"</span><span class="token operator">:</span> <span class="token number">2.0</span><span class="token punctuation">,</span>
    <span class="token string-property property">"_row"</span><span class="token operator">:</span> <span class="token string">"Pontiac Firebird"</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<h4><a id="7find_203"></a>7、$find</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 查询函数，也是一个非常常用的函数，和$aggregate一样都能完成查询的工作</span>
<span class="token comment"># 但至于哪个查询速度更快，目前没看出来。望大神指教。</span>
con<span class="token variable">$find</span><span class="token punctuation">(</span>
  query <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'{"cyl" : 4}'</span></span><span class="token punctuation">,</span> <span class="token comment"># 查询条件</span>
  fields <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'{"mpg" : true, "cyl" : true, "disp" : true}'</span></span><span class="token punctuation">,</span> <span class="token comment"># 那些列需要显示出来</span>
  limit <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token comment"># 查询出几条数据</span>
  skip <span class="token operator">=</span> <span class="token number">1</span> <span class="token comment"># 跳过几条数据，skip = 1 表示跳过一条数据。也就是函数从第二条数据开始查询5条符合条件的函数.</span>
<span class="token punctuation">)</span>

<span class="token comment">#                        _id  mpg cyl  disp</span>
<span class="token comment"># 1 5dd29754e9280000e8000fbb 24.4   4 146.7</span>
<span class="token comment"># 2 5dd29754e9280000e8000fbc 22.8   4 140.8</span>
<span class="token comment"># 3 5dd29754e9280000e8000fc5 32.4   4  78.7</span>
<span class="token comment"># 4 5dd29754e9280000e8000fc6 30.4   4  75.7</span>
<span class="token comment"># 5 5dd29754e9280000e8000fc7 33.9   4  71.1</span>
</code></pre> 
<hr> 
<h4><a id="8import_225"></a>8、$import</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 说明中可以导入json格式的数据，但实际测试没有成功。实际作用为止</span>
<span class="token comment">#（帮助文档的例子都没法运行成功）</span>
con<span class="token variable">$import</span><span class="token punctuation">(</span>con<span class="token punctuation">,</span> bson <span class="token operator">=</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span>

</code></pre> 
<hr> 
<h4><a id="9index_236"></a>9、$index</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 为数据文件创建索引，来加快数据的查询速度（不知道为啥有时候加了索引反而更慢）</span>
system<span class="token punctuation">.</span>time<span class="token punctuation">(</span>con<span class="token variable">$find</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'{"cyl":5}'</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 用户 系统 流逝 </span>
<span class="token comment"># 0.00 0.00 2.47 </span>

con<span class="token variable">$index</span><span class="token punctuation">(</span>add <span class="token operator">=</span> <span class="token string-literal"><span class="token string">'{"qsec":1}'</span></span><span class="token punctuation">)</span>
<span class="token comment">#   v key._id key.qsec   name                 ns</span>
<span class="token comment"># 1 2       1       NA   _id_ jeroen_test.mtcars</span>
<span class="token comment"># 2 2      NA        1 qsec_1 jeroen_test.mtcars</span>

system<span class="token punctuation">.</span>time<span class="token punctuation">(</span>con<span class="token variable">$find</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'{"cyl":5}'</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 用户 系统 流逝 </span>
<span class="token comment"># 0.00 0.00 0.73 </span>

con<span class="token variable">$index</span><span class="token punctuation">(</span>remove <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"qsec_1"</span></span><span class="token punctuation">)</span>
<span class="token comment">#   v _id name                 ns</span>
<span class="token comment"># 1 2   1 _id_ jeroen_test.mtcars</span>
</code></pre> 
<hr> 
<h4><a id="10info_260"></a>10、$info</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 输出服务器的信息（如果有的话，例子来自官网）</span>
col<span class="token variable">$info</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#&gt; List of 4</span>
<span class="token comment">#&gt;  $ collection: chr "test"</span>
<span class="token comment">#&gt;  $ db        : NULL</span>
<span class="token comment">#&gt;  $ stats     : NULL</span>
<span class="token comment">#&gt;  $ server    :List of 25</span>
<span class="token comment">#&gt;   ..$ host                     : chr "Jeroens-MBP.fritz.box"</span>
<span class="token comment">#&gt;   ..$ version                  : chr "4.0.1"</span>
<span class="token comment">#&gt;   ..$ process                  : chr "mongod"</span>
<span class="token comment">#&gt;   ..$ pid                      : num 64577</span>
<span class="token comment">#&gt;   ..$ uptime                   : num 5625</span>
<span class="token comment">#&gt;   ..$ uptimeMillis             : num 5625324</span>
<span class="token comment">#&gt;   ..$ uptimeEstimate           : num 5625</span>
<span class="token comment">#&gt;   ..$ localTime                : POSIXct[1:1], format: "2018-08-09 22:18:01"</span>
<span class="token comment">#&gt;   ..$ asserts                  :List of 5</span>
<span class="token comment">#&gt;   ..$ connections              :List of 3</span>
<span class="token comment">#&gt;   ..$ extra_info               :List of 2</span>
<span class="token comment">#&gt;   ..$ freeMonitoring           :List of 1</span>
<span class="token comment">#&gt;   ..$ globalLock               :List of 3</span>
<span class="token comment">#&gt;   ..$ locks                    :List of 3</span>
<span class="token comment">#&gt;   ..$ logicalSessionRecordCache:List of 11</span>
<span class="token comment">#&gt;   ..$ network                  :List of 7</span>
<span class="token comment">#&gt;   ..$ opLatencies              :List of 3</span>
<span class="token comment">#&gt;   ..$ opcounters               :List of 6</span>
<span class="token comment">#&gt;   ..$ opcountersRepl           :List of 6</span>
<span class="token comment">#&gt;   ..$ storageEngine            :List of 5</span>
<span class="token comment">#&gt;   ..$ transactions             :List of 3</span>
<span class="token comment">#&gt;   ..$ wiredTiger               :List of 17</span>
<span class="token comment">#&gt;   ..$ mem                      :List of 6</span>
<span class="token comment">#&gt;   ..$ metrics                  :List of 10</span>
<span class="token comment">#&gt;   ..$ ok                       : num 1</span>
</code></pre> 
<hr> 
<h4><a id="11insert_299"></a>11、$insert</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 插入数据（如果又不小心把数据删了，可以执行这个语句）</span>
data<span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span>
con<span class="token variable">$insert</span><span class="token punctuation">(</span>mtcars<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h4><a id="12iterate_309"></a>12、$iterate</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 作用不明（待完善）</span>
con<span class="token variable">$iterate</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'{"cyl":4}'</span></span><span class="token punctuation">,</span>limit <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">#&lt;Mongo iterator&gt; </span>
<span class="token comment"># $batch(size = 1000) </span>
<span class="token comment"># $json(size = 1000) </span>
<span class="token comment"># $one() </span>
<span class="token comment"># $page(size = 1000) </span>
</code></pre> 
<hr> 
<h4><a id="13mapreduce_323"></a>13、$mapreduce</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># mapreduce 是一种编程模型，用于大规模数据集（大于1TB）的并行运算。</span>
<span class="token comment"># 可以将其分为用于映射的 Map 和用于组合的 Reduce。可以根据例子进行简单的理解</span>
con<span class="token variable">$mapreduce</span><span class="token punctuation">(</span>
      <span class="token comment">#  map = "function() {emit(key,value);}", </span>
      <span class="token comment"># 映射函数 (生成键值对序列,作为 reduce 函数参数)(在函数中调用字段需要用到 this.*)</span>
       map <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"function(){emit(Math.floor(this.disp/100)*100, 1)}"</span></span><span class="token punctuation">,</span>
     <span class="token comment"># reduce = "function(key,values) {return reduceFunction},</span>
      <span class="token comment">#           {<!-- --></span>
      <span class="token comment">#             out: collection,</span>
      <span class="token comment">#             query: document,</span>
      <span class="token comment">#             sort: document,</span>
      <span class="token comment">#             limit: number</span>
      <span class="token comment">#           }"</span>
      <span class="token comment"># reduce函数的任务就是将key-values变成key-value，也就是把values数组变成一个单一的值value</span>
       reduce <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"function(id, counts){return Array.sum(counts)}"</span></span>
    
      <span class="token comment"># 整个函数的作用就是将字段 cyl 进行百分位向下取整，并进行分组统计</span>
   <span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>[注]： 由于 mapreduce 函数相对与其他函数而言比较不好理解，如果实在没理解的可以查&gt;看下列配图解释，或者查阅菜鸟教程和mongodb官方的解释，网站连接和配图如下：</p> 
 <p>菜鸟教程：https://www.runoob.com/mongodb/mongodb-map-reduce.html</p> 
 <p>mongodb官方：https://docs.mongodb.com/manual/reference/command/mapReduce/index.html</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/05/3d/ezOtBrdF_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<h4><a id="14remove_357"></a>14、$remove</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 删除查询出来的结果</span>

<span class="token comment"># 删除前</span>
con<span class="token variable">$find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
con<span class="token variable">$remove</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'{"cyl":4}'</span></span><span class="token punctuation">)</span>
<span class="token comment"># 删除后</span>
con<span class="token variable">$find</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h4><a id="15rename_370"></a>15、$rename</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 修改集合的名称（也可以修改数据库的，但是比较麻烦）</span>
con<span class="token variable">$rename</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"mtcars1"</span></span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h4><a id="16replace_379"></a>16、$replace</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 替换数据（在单表的处理上与 update 功能基本相同。但是修改的时候需要将完整的数据输入进去，建议用 update）</span>
con<span class="token variable">$replace</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'{"wt": 2.620,"qsec":16.46}'</span></span><span class="token punctuation">,</span>
            '<span class="token punctuation">{<!-- --></span><span class="token string-literal"><span class="token string">"mpg"</span></span><span class="token operator">:</span> <span class="token number">21</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"cyl"</span></span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"disp"</span></span><span class="token operator">:</span><span class="token number">160</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"hp"</span></span><span class="token operator">:</span><span class="token number">110</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"drat"</span></span><span class="token operator">:</span><span class="token number">3.9</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"wt"</span></span><span class="token operator">:</span><span class="token number">2.00</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"qsec"</span></span><span class="token operator">:</span><span class="token number">16.00</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"vs"</span></span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"am"</span></span><span class="token operator">:</span><span class="token number">1</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"gear"</span></span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">,</span>
              <span class="token string-literal"><span class="token string">"carb"</span></span><span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">}</span>'<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h4><a id="17run_399"></a>17、$run</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 允许使用最原始的mongodb命令，simplify = TRUE 表示同意简化输出</span>
<span class="token comment"># 下面的操作用于检查服务器链接是否正常</span>
con<span class="token variable">$run</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'{"ping" : 1}'</span></span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<h4><a id="18update_409"></a>18、$update</h4> 
<pre><code class="prism language-ruby"><span class="token comment"># 更新数据（与 replace 的不同在于，需要叫上 "$set" 来修改部分数据）</span>
con<span class="token variable">$update</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">'{"wt": 2.875,"qsec":17.02}'</span></span><span class="token punctuation">,</span>
             '<span class="token punctuation">{<!-- --></span><span class="token string-literal"><span class="token string">"$set"</span></span> <span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
               <span class="token string-literal"><span class="token string">"wt"</span></span><span class="token operator">:</span><span class="token number">2.62</span><span class="token punctuation">,</span>
               <span class="token string-literal"><span class="token string">"qsec"</span></span><span class="token operator">:</span><span class="token number">16.46</span><span class="token punctuation">}</span><span class="token punctuation">}</span>'<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<p>很长一段时间没有在csdn中写文章了，事实上后面自己学习过程中的大部分文档都是在语雀中完成的，基本都是自己写自己看。后续文章都会分享到自己的个人博客上，感兴趣的话可以关注一下。<a href="https://chenshaolang.gitee.io/personal-blog/" rel="nofollow">个人博客地址</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a41a523fedce4ae2d2b3845fe83b5551/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">manjaro踩坑记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4838b4fd56540027f0b215ae442fb5fe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">第三方图像打标系统汇总</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>