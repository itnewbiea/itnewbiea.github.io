<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据共享程序【推送与拉取】设计方案探讨 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据共享程序【推送与拉取】设计方案探讨" />
<meta property="og:description" content="目录
1、对外数据对接方案
2、代码实现
3、 总结
1、对外数据对接方案 一般者对外提供数据的方式通常有如下两种方案：
1、提供接口让接收数据方使用定时任务进行调用接口拉取数据【Pull方式】。
2、数据提供方使用定时任务Push数据到数据使用的第三方。【Push方式】
具体情况如下图所示： 2、代码实现 public void pushOverdueUserInfoToWaterSupply() throws Exception { //1、查询当前同步任务方法 上一次开始执行时间用于获得最新同步数据时间起点 DateTimeFormatter format = DateTimeFormatter.ofPattern(&#34;yyyy-MM-dd HH:mm:ss&#34;); SysTimedTaskSyncDataLog sysTimedTaskSyncDataLog = sysTimedTaskSyncDataLogService. selectTimeTaskSyncDataLogSomeOneLatestOne(BusinessConstant.SYNC_OVERDUE_TYPE); String lastSynDateTime = LocalDateTime.now(ZoneOffset.of(&#34;&#43;8&#34;)).format(format); LocalDateTime taskStartTime =sysTimedTaskSyncDataLog==null? LocalDateTime.now(ZoneOffset.of(&#34;&#43;8&#34;)):sysTimedTaskSyncDataLog.getTaskStartTime(); System.out.println(taskStartTime.format(format)); List&lt;OverdueUserInfoDto&gt; overdueUserInfoList = selectSynOverdueUserInfoList(lastSynDateTime); //2、从本地业务数据库之中获得同步失败部分数据，同时同步成功后把中间表之中记录删除 processPushMistakeRecordOverdueUserInfoData(); //3、获得当前最后一次同步时间点到当前时间节点内的数据到供水一体化平台之中【数据来源saas】 progressPushOverdueUserInfoData(overdueUserInfoList); } 3、 总结 两种方式共享数据的时候在我们日常开发过程之中可能都会遇见，我本人是已经遇见了两种实现方式，Push方式在广东某项目之中实现过，目前正在实现的数据共享方式通过数据接收方Pull拉取接口。
注意事项：任何一种方式都得考虑实际情况之中一些容错状况，比如Pull方式最好限制每次拉取数据记录比如limitPageSize=1000，最长拉取数据时间未15天等等。必须传入开始时间startDate，和结束时间endDate等等。
/** * 验证共享数据参数 * @param reqVO * @param reqParam * @return */ private String validReqParamsBetweenDays(DataSharePageReqVO reqVO, DataSharePageMapperReqVO reqParam){ String startDate=reqVO." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7634f62acf345c7510007f98d89bcf43/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-11T08:50:07+08:00" />
<meta property="article:modified_time" content="2023-03-11T08:50:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据共享程序【推送与拉取】设计方案探讨</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1%E3%80%81%E5%AF%B9%E5%A4%96%E6%95%B0%E6%8D%AE%E5%AF%B9%E6%8E%A5%E6%96%B9%E6%A1%88-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E5%AF%B9%E5%A4%96%E6%95%B0%E6%8D%AE%E5%AF%B9%E6%8E%A5%E6%96%B9%E6%A1%88" rel="nofollow">1、对外数据对接方案</a></p> 
<p id="2%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" rel="nofollow">2、代码实现</a></p> 
<p id="3%E3%80%81%20%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#3%E3%80%81%20%E6%80%BB%E7%BB%93" rel="nofollow">3、 总结</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="1%E3%80%81%E5%AF%B9%E5%A4%96%E6%95%B0%E6%8D%AE%E5%AF%B9%E6%8E%A5%E6%96%B9%E6%A1%88">1、对外数据对接方案</h3> 
<p>        一般者对外提供数据的方式通常有如下两种方案：</p> 
<p>         1、提供接口让接收数据方使用定时任务进行调用接口拉取数据【Pull方式】。</p> 
<p>          2、数据提供方使用定时任务Push数据到数据使用的第三方。【Push方式】</p> 
<p>具体情况如下图所示：             <img alt="" height="666" src="https://images2.imgbox.com/5d/d3/608fsxSE_o.png" width="1032"></p> 
<h3 id="2%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">2、代码实现</h3> 
<pre><code class="language-java">    public void pushOverdueUserInfoToWaterSupply() throws Exception {
        //1、查询当前同步任务方法 上一次开始执行时间用于获得最新同步数据时间起点
        DateTimeFormatter format = DateTimeFormatter.ofPattern("yyyy-MM-dd HH:mm:ss");
        SysTimedTaskSyncDataLog sysTimedTaskSyncDataLog = sysTimedTaskSyncDataLogService.
                selectTimeTaskSyncDataLogSomeOneLatestOne(BusinessConstant.SYNC_OVERDUE_TYPE);
        String lastSynDateTime = LocalDateTime.now(ZoneOffset.of("+8")).format(format);
        LocalDateTime taskStartTime =sysTimedTaskSyncDataLog==null?
                LocalDateTime.now(ZoneOffset.of("+8")):sysTimedTaskSyncDataLog.getTaskStartTime();
        System.out.println(taskStartTime.format(format));
        List&lt;OverdueUserInfoDto&gt; overdueUserInfoList = selectSynOverdueUserInfoList(lastSynDateTime);
        //2、从本地业务数据库之中获得同步失败部分数据，同时同步成功后把中间表之中记录删除
        processPushMistakeRecordOverdueUserInfoData();
        //3、获得当前最后一次同步时间点到当前时间节点内的数据到供水一体化平台之中【数据来源saas】
        progressPushOverdueUserInfoData(overdueUserInfoList);
    }</code></pre> 
<h3 id="3%E3%80%81%20%E6%80%BB%E7%BB%93">3、 总结</h3> 
<p>     两种方式共享数据的时候在我们日常开发过程之中可能都会遇见，我本人是已经遇见了两种实现方式，Push方式在广东某项目之中实现过，目前正在实现的数据共享方式通过数据接收方Pull拉取接口。</p> 
<p>     注意事项：任何一种方式都得考虑实际情况之中一些容错状况，比如Pull方式最好限制每次拉取数据记录比如limitPageSize=1000，最长拉取数据时间未15天等等。必须传入开始时间startDate，和结束时间endDate等等。</p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91"><img alt="" height="270" src="https://images2.imgbox.com/9b/13/kWSWQvlk_o.png" width="1031"></p> 
<p></p> 
<pre><code class="language-java">    /**
     * 验证共享数据参数
     * @param reqVO
     * @param reqParam
     * @return
     */
    private String validReqParamsBetweenDays(DataSharePageReqVO reqVO, DataSharePageMapperReqVO reqParam){
        String startDate=reqVO.getStartDate();
        String endDate= reqVO.getEndDate();
        LocalDateTime startLocalDate =LocalDateTimeUtil.parse(startDate,"yyyy-MM-dd HH:mm:ss");
        LocalDateTime endLocalDate = LocalDateTimeUtil.parse(endDate,"yyyy-MM-dd HH:mm:ss");;
        Duration between = LocalDateTimeUtil.between(startLocalDate, endLocalDate);
        long betweenDays = between.toDays();
        String validResult="";
        if(!endLocalDate.isAfter(startLocalDate)){
            validResult="参数[endDate] 必须在 参数[startDate] 时间之后";
        }
        else if(betweenDays&gt;shareDataLimitDays){
            validResult="接口访问数据查询开始和结束时间不超过: "+shareDataLimitDays+ "天";
        }else {
            BeanUtil.copyProperties(reqVO,reqParam);
            reqParam.setStartDate(startDate);
            reqParam.setEndDate(endDate);
            Long beginIndex=(reqVO.getPageNo()-1)* reqVO.getPageSize();
            reqParam.setBeginIndex(beginIndex);
            validResult="";
        }
        return validResult;
    }</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c0ec13fedc72b7e6c59ad31231f8adc7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Jackson 返回前端的 Response结果字段大小问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e7f18498cca8a1b6db0da803e9038f72/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java并发编程78讲--70 第70讲：有哪些解决死锁问题的策略？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>