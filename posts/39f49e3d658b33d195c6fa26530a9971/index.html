<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Xilinx SDK Menu 程序 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Xilinx SDK Menu 程序" />
<meta property="og:description" content="该代码为Xilinx SDK Zynq平台下的裸机程序，使用该程序可以实现通过串口敲指令读写寄存器操作，方便调试使用。
menu.h
//******************************************************************************/ #ifndef XHDMI_MENU_H_ #define XHDMI_MENU_H_ /**&lt; Prevent circular inclusions * by using protection macros */ #include &#34;xil_types.h&#34; void MenuProcess(); u8 CharisNum(u8 data); u32 CalcChar(u8* bufptr); u8 char_2_hex(u8 src); #endif /* End of protection macro */ menu.c
#include &#34;menu.h&#34; #include &#34;xparameters.h&#34; #include &#34;xil_printf.h&#34; #include &#34;xuartps.h&#34; #include &#34;xil_io.h&#34; #include &#34;xpseudo_asm.h&#34; void MenuProcess() { u8 Data; u8 IsValid = TRUE; int i; u8 Addr[8]; u8 Dat[8]; u32 addr_c; u32 data_c; // Check if the uart has any data if (XUartPs_IsReceiveData(STDIN_BASEADDRESS)) { // Read data from uart Data = XUartPs_RecvByte(STDIN_BASEADDRESS); //XUartPs_SendByte(STDOUT_BASEADDRESS, Data); switch(Data){ case &#39;W&#39;	: case &#39;w&#39;	:{ xil_printf(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/39f49e3d658b33d195c6fa26530a9971/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-22T08:27:20+08:00" />
<meta property="article:modified_time" content="2022-09-22T08:27:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Xilinx SDK Menu 程序</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>该代码为Xilinx SDK Zynq平台下的裸机程序，使用该程序可以实现通过串口敲指令读写寄存器操作，方便调试使用。</p> 
<p></p> 
<p>menu.h</p> 
<pre><code>//******************************************************************************/
#ifndef XHDMI_MENU_H_
#define XHDMI_MENU_H_  /**&lt; Prevent circular inclusions
*  by using protection macros */
#include "xil_types.h"

void MenuProcess();
u8 CharisNum(u8 data);
u32 CalcChar(u8* bufptr);
u8 char_2_hex(u8 src);
#endif /* End of protection macro */
</code></pre> 
<p>menu.c</p> 
<pre><code>#include "menu.h"
#include "xparameters.h"
#include "xil_printf.h"
#include "xuartps.h"
#include "xil_io.h"
#include "xpseudo_asm.h"
void MenuProcess() {
	u8 Data;
	u8 IsValid = TRUE;
	int i;
	u8 Addr[8];
	u8 Dat[8];
	u32 addr_c;
	u32 data_c;
	// Check if the uart has any data
	if (XUartPs_IsReceiveData(STDIN_BASEADDRESS)) {
		// Read data from uart
		Data = XUartPs_RecvByte(STDIN_BASEADDRESS);

		//XUartPs_SendByte(STDOUT_BASEADDRESS, Data);

		switch(Data){

			case 'W'	:
			case 'w'	:{
				xil_printf("Setting Write Addr =&gt; 0x");
				for(i=0;i&lt;8;i++){
					Addr[i] = XUartPs_RecvByte(STDIN_BASEADDRESS);
					XUartPs_SendByte(STDOUT_BASEADDRESS, Addr[i]);
					if(!CharisNum(Addr[i])){
						IsValid = FALSE;
						xil_printf("\r\nUnknown Value\r\n");
						break;
					}
				}

				if(IsValid == FALSE){
					break;
				}

				xil_printf("    Setting Write Data =&gt; 0x");
				for(i=0;i&lt;8;i++){
					Dat[i] = XUartPs_RecvByte(STDIN_BASEADDRESS);
					XUartPs_SendByte(STDOUT_BASEADDRESS, Dat[i]);
					if(!CharisNum(Dat[i])){
						IsValid = FALSE;
						xil_printf("\r\nUnknown Value\r\n");
						break;
					}
				}

				if(IsValid == FALSE){
					break;
				}

				addr_c =  CalcChar(Addr);
				data_c =  CalcChar(Dat);

				Xil_Out32(addr_c,data_c);
				//XStl_RegUpdate(addr_c, data_c);
				xil_printf("\n\rwaddr:0x%x    wdata:0x%x\n\r",addr_c,data_c);
				IsValid = TRUE;
				break;
			}

			case 'R'	:
			case 'r'	:{
				xil_printf("Setting Read Addr =&gt; 0x");
				for(i=0;i&lt;8;i++){
					Addr[i] = XUartPs_RecvByte(STDIN_BASEADDRESS);
					XUartPs_SendByte(STDOUT_BASEADDRESS, Addr[i]);
					if(!CharisNum(Addr[i])){
						IsValid = FALSE;
						xil_printf("\r\nUnknown Value\r\n");
						break;
					}
				}

				if(IsValid == FALSE){
					break;
				}

				addr_c =  CalcChar(Addr);


				data_c = Xil_In32(addr_c);
				xil_printf("\n\rraddr:0x%x    rdata:0x%x\n\r",addr_c,data_c);

				IsValid = TRUE;
				break;
			}

			case '\r':{//╗╗ллич
				XUartPs_SendByte(STDOUT_BASEADDRESS, '\n');
				break;
			}
			default :
				xil_printf("Unknown option\r\n");
				IsValid = FALSE;
				break;


		}
	}

}



u8 CharisNum(u8 data){

	u8 isnum = 0;

	if((data &gt;=0x30 &amp;&amp; data &lt;= 0x39)||(data &gt;=0x41 &amp;&amp; data &lt;= 0x46)||(data &gt;= 0x61 &amp;&amp; data &lt;= 0x66)){
		isnum =  1;
	}
	else{
		isnum =  0;
	}
	return isnum;
}

u8 char_2_hex(u8 src)
{
    uint8_t desc;

    if((src &gt;= '0') &amp;&amp; (src &lt;= '9'))
        desc = src - 0x30;
    else if((src &gt;= 'a') &amp;&amp; (src &lt;= 'f'))
        desc = src - 0x57;
    else if((src &gt;= 'A') &amp;&amp; (src &lt;= 'F'))
        desc = src - 0x37;

    return desc;
}

u32 CalcChar(u8* bufptr){
	u8 dstbuf[8];
	u32 calcdata = 0;


	for(int i=0;i&lt;8;i++){
		dstbuf[i] = char_2_hex(bufptr[i]);
	}

	for(int i=0;i&lt;8;i++){
		calcdata = calcdata + (dstbuf[i]&lt;&lt;((7-i)*4));
	}

	return calcdata;
}







</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d9b72b2dacfc85b3b194a00a8cfeddee/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【leetcode速通java版】01——数组入门</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a70ea722878dd5c93f2a92556f6f1b90/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python 字符串的搜索匹配与替换（详细）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>