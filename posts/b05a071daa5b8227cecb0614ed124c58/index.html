<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>gin 多结构体嵌套 效验范例 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="gin 多结构体嵌套 效验范例" />
<meta property="og:description" content="作者工作中遇到需求，需要多级别效验 结构体，但是范例很少，特意留下范例，写得不好，请轻喷
版本： github.com/go-playground/validator/v10
主结构体
type SceneProcessUpdateRequest struct { Chat *Chat `json:&#34;chat&#34; form:&#34;chat&#34; binding:&#34;required_without=Name&#34;` // 流程json UpdateNote *NodeList `json:&#34;update_note&#34; form:&#34;update_note&#34; binding:&#34;required_without_all=Name DeleteNote&#34;` // 需要更新的节点 ,Name DeleteNote 不存在时必传 DeleteNote *DeleteNote `json:&#34;delete_note&#34; form:&#34;delete_note&#34; binding:&#34;required_without_all=Name UpdateNote&#34;` // 需要删除的节点 ID string `json:&#34;id&#34; form:&#34;id&#34; binding:&#34;required&#34;` // 流程ID SceneID string `json:&#34;scene_id&#34; form:&#34;scene_id&#34; binding:&#34;required&#34;` // 场景ID Name string `json:&#34;name&#34; form:&#34;name&#34; binding:&#34;required_without=Chat&#34;` // 名称 IsComplete int32 `json:&#34;is_complete&#34; form:&#34;is_complete&#34; binding:&#34;required_with=Chat,omitempty,oneof=1 2&#34;` // &#34;是否完整，1是 2否&#34; Chat存在时必须存在，不存在时，可为空 } type Chat struct { NodeList []NodeList `json:&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b05a071daa5b8227cecb0614ed124c58/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-02T11:25:24+08:00" />
<meta property="article:modified_time" content="2022-06-02T11:25:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">gin 多结构体嵌套 效验范例</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>作者工作中遇到需求，需要多级别效验 结构体，但是范例很少，特意留下范例，写得不好，请轻喷<br> 版本： github.com/go-playground/validator/v10</p> 
<p>主结构体</p> 
<pre><code class="prism language-go"><span class="token keyword">type</span> SceneProcessUpdateRequest <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Chat       <span class="token operator">*</span>Chat       <span class="token string">`json:"chat" form:"chat" binding:"required_without=Name"`</span>                                <span class="token comment">// 流程json</span>
	UpdateNote <span class="token operator">*</span>NodeList   <span class="token string">`json:"update_note" form:"update_note" binding:"required_without_all=Name DeleteNote"`</span>   <span class="token comment">// 需要更新的节点 ,Name DeleteNote 不存在时必传</span>
	DeleteNote <span class="token operator">*</span>DeleteNote <span class="token string">`json:"delete_note" form:"delete_note" binding:"required_without_all=Name UpdateNote"`</span>   <span class="token comment">// 需要删除的节点</span>
	ID         <span class="token builtin">string</span>      <span class="token string">`json:"id" form:"id" binding:"required"`</span>                                                 <span class="token comment">// 流程ID</span>
	SceneID    <span class="token builtin">string</span>      <span class="token string">`json:"scene_id" form:"scene_id" binding:"required"`</span>                                     <span class="token comment">// 场景ID</span>
	Name       <span class="token builtin">string</span>      <span class="token string">`json:"name" form:"name" binding:"required_without=Chat"`</span>                                <span class="token comment">// 名称</span>
	IsComplete <span class="token builtin">int32</span>       <span class="token string">`json:"is_complete" form:"is_complete" binding:"required_with=Chat,omitempty,oneof=1 2"`</span> <span class="token comment">// "是否完整，1是 2否" Chat存在时必须存在，不存在时，可为空</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Chat <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	NodeList <span class="token punctuation">[</span><span class="token punctuation">]</span>NodeList <span class="token string">`json:"node_list" form:"node_list" binding:"required,gte=1,dive,required"`</span> <span class="token comment">// 节点 数组</span>
	LineList <span class="token punctuation">[</span><span class="token punctuation">]</span>LineList <span class="token string">`json:"line_list" form:"line_list" binding:"required,gte=1,dive,required"`</span> <span class="token comment">// 前端定义</span>
	ID       <span class="token builtin">string</span>     <span class="token string">`json:"id" form:"id" binding:"required"`</span>                                   <span class="token comment">// 流程ID</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> LineList <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	From <span class="token builtin">string</span> <span class="token string">`json:"from" form:"from" binding:"required"`</span> <span class="token comment">// 来源 ID</span>
	To   <span class="token builtin">string</span> <span class="token string">`json:"to" form:"to" binding:"required"`</span>     <span class="token comment">// 跳转 ID</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> NodeList <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	TalkData       <span class="token operator">*</span>ai_scene_node_repo<span class="token punctuation">.</span>TalkData       <span class="token string">`json:"talk_data" form:"talk_data" binding:"required_if=Type talk"`</span>                                <span class="token comment">// 对话节点 数据</span>
	KeyData        <span class="token operator">*</span>ai_scene_node_repo<span class="token punctuation">.</span>KeyData        <span class="token string">`json:"key_data" form:"key_data" binding:"required_if=Type key"`</span>                                   <span class="token comment">// 按键节点 数据</span>
	ArtificialData <span class="token operator">*</span>ai_scene_node_repo<span class="token punctuation">.</span>ArtificialData <span class="token string">`json:"artificial_data" form:"artificial_data" binding:"required_if=Type artificial"`</span>              <span class="token comment">// 人工节点 数据</span>
	NoteData       <span class="token operator">*</span>ai_scene_node_repo<span class="token punctuation">.</span>NoteData       <span class="token string">`json:"note_data" form:"note_data" binding:"required_if=Type note"`</span>                                <span class="token comment">// 短信节点 数据</span>
	StartData      <span class="token operator">*</span>ai_scene_node_repo<span class="token punctuation">.</span>StartData      <span class="token string">`json:"start_data" form:"start_data" binding:"required_if=Type start"`</span>                             <span class="token comment">// 开始节点 数据</span>
	JumpData       <span class="token operator">*</span>ai_scene_node_repo<span class="token punctuation">.</span>JumpData       <span class="token string">`json:"jump_data" form:"jump_data" binding:"required_if=Type jump"`</span>                                <span class="token comment">// 跳转节点 数据</span>
	EndData        <span class="token operator">*</span>ai_scene_node_repo<span class="token punctuation">.</span>EndData        <span class="token string">`json:"end_data" form:"end_data" binding:"required_if=Type end"`</span>                                   <span class="token comment">// 结束节点 数据</span>
	Type           <span class="token builtin">string</span>                             <span class="token string">`json:"type" form:"type" binding:"required,eq=talk|eq=artificial|eq=note|eq=start|eq=jump|eq=end"`</span> <span class="token comment">// 节点类型 start：开始 talk:对话   artificial:人工  note:短信  key:按键  jump:跳转 end:结束</span>
	Tag            <span class="token builtin">string</span>                             <span class="token string">`json:"tag" form:"tag" binding:"required"`</span>                                                         <span class="token comment">// 节点标记(标签)</span>
	Name           <span class="token builtin">string</span>                             <span class="token string">`json:"name" form:"name" binding:"required"`</span>                                                       <span class="token comment">// 节点名称</span>
	ID             <span class="token builtin">string</span>                             <span class="token string">`json:"id" form:"id" binding:"required"`</span>                                                           <span class="token comment">// 节点ID</span>
	Left           <span class="token builtin">string</span>                             <span class="token string">`json:"left" form:"left"`</span>                                                                          <span class="token comment">// 前端自定义</span>
	Top            <span class="token builtin">string</span>                             <span class="token string">`json:"top" form:"top"`</span>                                                                            <span class="token comment">// 前端自定义</span>
	Ico            <span class="token builtin">string</span>                             <span class="token string">`json:"ico" form:"ico"`</span>                                                                            <span class="token comment">// 前端自定义</span>
	State          <span class="token builtin">string</span>                             <span class="token string">`json:"state" form:"state"`</span>                                                                        <span class="token comment">// 前端自定义</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> DeleteNote <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	ID  <span class="token builtin">string</span> <span class="token string">`json:"id" form:"id" binding:"required"`</span>   <span class="token comment">// 节点ID</span>
	Tag <span class="token builtin">string</span> <span class="token string">`json:"tag" form:"tag" binding:"required"`</span> <span class="token comment">// 节点标签</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-go"><span class="token keyword">package</span> ai_scene_node_repo

<span class="token comment">// 开始</span>
<span class="token keyword">type</span> StartData <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	JumpNodeID <span class="token builtin">string</span> <span class="token string">`json:"jump_node_id" form:"jump_node_id" binding:"required"`</span> <span class="token comment">// 跳转至</span>
<span class="token punctuation">}</span>

<span class="token comment">// 对话</span>
<span class="token keyword">type</span> TalkData <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Rule            <span class="token punctuation">[</span><span class="token punctuation">]</span>NodeRule <span class="token string">`json:"rule" form:"rule" binding:"required,dive,required"`</span>           <span class="token comment">// 跳转规则</span>
	ExceptionTag    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>   <span class="token string">`json:"exception_tag" form:"exception_tag"`</span>                          <span class="token comment">// 异常标签</span>
	Words           <span class="token builtin">string</span>     <span class="token string">`json:"words" form:"words" binding:"required"`</span>                       <span class="token comment">// 节点话术</span>
	RepeatWords     <span class="token builtin">string</span>     <span class="token string">`json:"repeat_words" form:"repeat_words"`</span>                            <span class="token comment">// 重新播报话术</span>
	ExceptionAnswer <span class="token builtin">string</span>     <span class="token string">`json:"exception_answer" form:"exception_answer" binding:"required"`</span> <span class="token comment">// 发生异常时，机器人回答</span>
	ExceptionNum    <span class="token builtin">int16</span>      <span class="token string">`json:"exception_num" form:"exception_num" binding:"required"`</span>       <span class="token comment">// 异常会话次数</span>
	ExceptionHand   <span class="token builtin">int8</span>       <span class="token string">`json:"exception_hand" form:"exception_hand" binding:"required"`</span>     <span class="token comment">// 异常处理方式 1、人工 2、挂机</span>
	IsInterrupt     <span class="token builtin">int8</span>       <span class="token string">`json:"is_interrupt" form:"is_interrupt" binding:"required"`</span>         <span class="token comment">// 是否打断 1、是 2、否</span>
<span class="token punctuation">}</span>

<span class="token comment">// 人工</span>
<span class="token keyword">type</span> ArtificialData <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Words          <span class="token builtin">string</span> <span class="token string">`json:"words" form:"words" binding:"required"`</span>                             <span class="token comment">// 机器人回答</span>
	Phone          <span class="token builtin">int32</span>  <span class="token string">`json:"phone" form:"phone" binding:"required_if=ArtificialType 1"`</span>         <span class="token comment">// 呼叫转移</span>
	Extension      <span class="token builtin">int32</span>  <span class="token string">`json:"extension" form:"extension" binding:"required_if=ArtificialType 2"`</span> <span class="token comment">// 分机号</span>
	ArtificialType <span class="token builtin">int8</span>   <span class="token string">`json:"artificial_type" form:"artificial_type" binding:"required"`</span>         <span class="token comment">// 1、呼叫转移 2、转接分机</span>
<span class="token punctuation">}</span>

<span class="token comment">// 短信</span>
<span class="token keyword">type</span> NoteData <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Words    <span class="token builtin">string</span> <span class="token string">`json:"words" form:"words" binding:"required"`</span>         <span class="token comment">// 机器人回答</span>
	NoteWord <span class="token builtin">string</span> <span class="token string">`json:"note_word" form:"note_word" binding:"required"`</span> <span class="token comment">//短信内容</span>
<span class="token punctuation">}</span>

<span class="token comment">// 按键</span>
<span class="token keyword">type</span> KeyData <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Rule            <span class="token punctuation">[</span><span class="token punctuation">]</span>KeyRule <span class="token string">`json:"rule" form:"rule" binding:"required,dive,required"`</span>           <span class="token comment">// 跳转规则</span>
	ExceptionTag    <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>  <span class="token string">`json:"exception_tag" form:"exception_tag"`</span>                          <span class="token comment">// 异常标签</span>
	Words           <span class="token builtin">string</span>    <span class="token string">`json:"words" form:"words" binding:"required"`</span>                       <span class="token comment">// 节点话术</span>
	RepeatWords     <span class="token builtin">string</span>    <span class="token string">`json:"repeat_words" form:"repeat_words" binding:"required"`</span>         <span class="token comment">// 重新播报话术</span>
	ExceptionAnswer <span class="token builtin">string</span>    <span class="token string">`json:"exception_answer" form:"exception_answer" binding:"required"`</span> <span class="token comment">// 发生异常时，机器人回答</span>
	ExceptionNum    <span class="token builtin">int16</span>     <span class="token string">`json:"exception_num" form:"exception_num" binding:"required"`</span>       <span class="token comment">// 异常会话次数</span>
	ExceptionHand   <span class="token builtin">int8</span>      <span class="token string">`json:"exception_hand" form:"exception_hand" binding:"required"`</span>     <span class="token comment">// 异常处理方式 1、人工 2、挂机</span>
	IsInterrupt     <span class="token builtin">int8</span>      <span class="token string">`json:"is_interrupt" form:"is_interrupt" binding:"required"`</span>         <span class="token comment">// 是否打断 1、是 2、否</span>
<span class="token punctuation">}</span>

<span class="token comment">// 跳转子流程</span>
<span class="token keyword">type</span> JumpData <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	JumpNodeID <span class="token builtin">string</span> <span class="token string">`json:"jump_node_id" form:"jump_node_id" binding:"required"`</span> <span class="token comment">// 跳转至</span>
<span class="token punctuation">}</span>

<span class="token comment">// 结束</span>
<span class="token keyword">type</span> EndData <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Words <span class="token builtin">string</span> <span class="token string">`json:"words" form:"words" binding:"required"`</span> <span class="token comment">// 机器人回答</span>
<span class="token punctuation">}</span>

<span class="token comment">// 节点规则</span>
<span class="token keyword">type</span> NodeRule <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Conditions <span class="token punctuation">[</span><span class="token punctuation">]</span>Conditions <span class="token string">`json:"conditions" form:"conditions" binding:"required,dive,required"`</span> <span class="token comment">// 以下条件跳转</span>
	Tag        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>     <span class="token string">`json:"tag" form:"tag" `</span>                                               <span class="token comment">// 标签</span>
	JumpNodeID <span class="token builtin">string</span>       <span class="token string">`json:"jump_node_id" form:"jump_node_id" binding:"required"`</span>           <span class="token comment">// 跳转至</span>
	JumpName   <span class="token builtin">string</span>       <span class="token string">`json:"jump_name" form:"jump_name" binding:"required"`</span>                 <span class="token comment">// 跳转名称</span>
	Conform    <span class="token builtin">int8</span>         <span class="token string">`json:"conform" form:"conform" binding:"required"`</span>                     <span class="token comment">// 符合 1、任意 2、全部</span>

<span class="token punctuation">}</span>

<span class="token comment">// 条件</span>
<span class="token keyword">type</span> Conditions <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	IntentionID <span class="token builtin">string</span> <span class="token string">`json:"intention_id" form:"intention_id" binding:"required"`</span> <span class="token comment">// 意图ID -1 全部异常意图</span>
	If          <span class="token builtin">int8</span>   <span class="token string">`json:"if" form:"if" binding:"required"`</span>                     <span class="token comment">// 如果 1、意图</span>
	Compare     <span class="token builtin">int8</span>   <span class="token string">`json:"compare" form:"compare" binding:"required"`</span>           <span class="token comment">// 比较方式 1、等于</span>
	Content     <span class="token builtin">int8</span>   <span class="token string">`json:"content" form:"content" binding:"required"`</span>           <span class="token comment">// 内容 1、自定义意图 2、异常意图</span>
<span class="token punctuation">}</span>

<span class="token comment">// 按键规则</span>
<span class="token keyword">type</span> KeyRule <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Conditions <span class="token punctuation">[</span><span class="token punctuation">]</span>KeyConditions <span class="token string">`json:"conditions" form:"conditions" binding:"required,dive,required"`</span> <span class="token comment">// 以下条件跳转</span>
	Tag        <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span>        <span class="token string">`json:"tag" form:"tag"`</span>                                                <span class="token comment">// 标签</span>
	JumpNodeID <span class="token builtin">string</span>          <span class="token string">`json:"jump_node_id" form:"jump_node_id" binding:"required"`</span>           <span class="token comment">// 跳转至</span>
	JumpName   <span class="token builtin">string</span>          <span class="token string">`json:"jump_name" form:"jump_name" binding:"required"`</span>                 <span class="token comment">// 跳转名称</span>
	Conform    <span class="token builtin">int8</span>            <span class="token string">`json:"conform" form:"conform" binding:"required"`</span>                     <span class="token comment">// 符合 1、任意 2、全部</span>

<span class="token punctuation">}</span>

<span class="token keyword">type</span> KeyConditions <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
	Key     <span class="token builtin">string</span> <span class="token string">`json:"key" form:"key" binding:"required"`</span>         <span class="token comment">// 内容</span>
	If      <span class="token builtin">int8</span>   <span class="token string">`json:"if" form:"if" binding:"required"`</span>           <span class="token comment">// 如果 1、按键</span>
	Compare <span class="token builtin">int8</span>   <span class="token string">`json:"compare" form:"compare" binding:"required"`</span> <span class="token comment">// 比较方式 1、等于</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d82878bbd52d76b8abdc17cc77c59d7b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OAuth2相关知识和理解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f70a00e31f02ac6731abca757121ce4e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java培训SpringBoot 实现 Office 各种格式在线预览</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>