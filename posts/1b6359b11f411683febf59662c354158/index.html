<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>相机标定详解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="相机标定详解" />
<meta property="og:description" content="相机标定： 目的： 还原摄像头成像的物体在真实世界的位置就需要知道世界中的物体到计算机图像平面是如何变换的，相机标定的目的之一就是为了搞清楚这种变换关系，求解内外参数矩阵
摄像机的透视投影有个很大的问题——畸变。摄像头标定的另一个目的就是求解畸变系数，然后用于图像矫正
坐标系介绍： 世界坐标系(Xw,Yw,Zw)：目标物体位置的参考系。除了无穷远，世界坐标可以根据运算方便与否自由放置，单位为长度单位如mm。在双目视觉中世界坐标系主要有三个用途：
标定时确定标定物的位置
作为双目视觉的系统参考系，给出两个摄像机相对世界坐标系的关系，从而求出相机之间的相对关系；
作为重建得到三维坐标的容器，存放重建后的物体的三维坐标。世界坐标系是将看见中物体纳入运算的第一站。
摄像机坐标系(Xc,Yc,Zc)：摄像机站在自己角度上衡量的物体的坐标系。摄像
机坐标系的原点在摄像机的光心上，z轴与摄像机光轴平行。它是与拍摄物体发生联系的桥头堡，世界坐标系下的物体需先经历刚体变化转到摄像机坐标系，然后在和图像坐标系发生关系。它是图像坐标与世界坐标之间发生关系的纽带，沟通了世界上最远的距离。单位为长度单位如mm。
图像坐标系(x,y)：以CCD 图像平面的中心为坐标原点，为了描述成像过程中物体从相机坐标系到图像坐标系的投影透射关系而引入，方便进一步得到像素坐标系下的坐标。图像坐标系是用物理单位（例如毫米）表示像素在图像中的位置。
像素坐标系(u,v)：以 CCD 图像平面的左上角顶点为原点，为了描述物体成像后的像点在数字图像上（相片）的坐标而引入，是我们真正从相机内读取到的信息所在的坐标系。像素坐标系就是以像素为单位的图像坐标系。
图像坐标系转换像素坐标系： 像素坐标系和图像坐标系都在成像平面上，如图。 以图像左上角为原点建立以像素（pixel）为单位的像素坐标系u-v。像素的横坐标u与纵坐标v分别是在其图像数组中所在的列数与所在行数，描述一个像素点都是几行几列。图像坐标系的原点为相机光轴与成像平面的交点O（u0，v0），通常情况下是成像平面的中点或者叫principal point。图像坐标系的单位是mm，属于物理单位。dx，dy表示每个像素在横轴x和纵轴y上的物理尺寸（单位为：mm/像素，单位像素的距离）。
则图像中的每个像素在u-v坐标系中的坐标和在x-y坐标系中的坐标之间都存在如下的关系（为了方便使用，用齐次坐标与矩阵形式表示）：
例如：设CCD大小为8 x 6mm，拍摄的图像大小为640 x 480，则dx = 1/80（mm/像素）dy = 1/80（mm/像素）， u0=320，v0=240
三大坐标系： 世界坐标系通过刚体变换到达摄像机坐标系，然后摄像机坐标系通过透视投影变换到达图像坐标系。可以看出，世界坐标与图像坐标的关系建立在刚体变换和透视投影变换的基础上。
世界坐标系转换摄像机坐标系： 刚体变换(regidbody motion)：三维空间中， 当物体不发生形变时，对一个几何物体作旋转， 平移的运动，称之为刚体变换。
世界坐标系和摄像机坐标都是右手坐标系，所以其不会发生形变。我们想把世界坐标系下的坐标转换到摄像机坐标下的坐标，如下图所示，可以通过刚体变换的方式。空间中一个坐标系，总可以通过刚体变换转换到另外一个个坐标系的。
世界坐标系与摄像机坐标系之间的刚体转换表达式为：
R是3×3的正交单位矩阵（即旋转矩阵），t为平移向量，R、t与摄像机无关，所以称这两个参数为摄像机的外参数(extrinsicparameter)，可以理解为两个坐标原点之间的距离，因其受x,y,z三个方向上的分量共同控制，所以其具有三个自由度。假定在世界坐标系中物点所在平面过世界坐标系原点且与Zw轴垂（也即棋盘平面与Xw-Yw平面重合，目的在于方便后续计算），Zw=0。
摄像机坐标系转换图像坐标系： 透视投影(perspective projection)： 用中心投影法将形体投射到投影面上，从而获得的一种较为接近视觉效果的单面投影图。有一点像皮影戏。它符合人们心理习惯，即离视点近的物体大，离视点远的物体小，不平行于成像平面的平行线会相交于消隐点(vanish point)
透视投影与小孔成像相似，下图为针孔摄像机的模型，平面π称为摄像机的像平面，点Oc称为摄像机中心（或光心），f成为摄像机的焦距，Oc为端点且垂直于像平面的射线成为光轴或主轴，主轴与像平面的交点p是摄像机的主点
图像坐标系为O-xy，摄像机坐标系为Oc-XcYcZc。记空间点Xc摄像机坐标系中的齐次坐标为:
像点m在图像坐标系中的齐次坐标为：
根据三角形相似原理：
矩阵表示为（齐次坐标伸缩不变性Zc[x y 1]T和[x y 1]T表示同一点）：
合并：
将世界坐标系转换到像素坐标系，将上诉式子联系起来，写在一起得到如下矩阵（注意符号对应u—&gt;像素坐标、x—&gt;图像坐标、Xc—&gt;摄像机坐标、Xw—&gt;世界坐标）：
世界坐标到像素坐标变换矩阵P如下：
P表示一个投影相机：
总结：世界坐标系到像素坐标系（不考虑畸变）的转换关系
图片矫正： 我们在摄像机坐标系到图像坐标系变换时谈到透视投影。摄像机拍照时通过透镜把实物投影到像平面上，但是透镜由于制造精度以及组装工艺的偏差会引入畸变，导致原始图像的失真。因此我们需要考虑成像畸变的问题。
透镜的畸变主要分为径向畸变和切向畸变，还有薄透镜畸变等等，但都没有径向和切向畸变影响显著，所以我们在这里只考虑径向和切向畸变
径向畸变：
径向畸变就是沿着透镜半径方向分布的畸变，产生原因是光线在远离透镜中心的地方比靠近中心的地方更加弯曲，这种畸变在普通廉价的镜头中表现更加明显，径向畸变主要包括桶形畸变和枕形畸变两种。以下分别是枕形和桶形畸变示意图：
像平面中心的畸变为0，沿着镜头半径方向向边缘移动，畸变越来越严重。畸变的数学模型可以用主点（principle point）周围的泰勒级数展开式的前几项进行描述，通常使用前两项，即k1和k2，对于畸变很大的镜头，如鱼眼镜头，可以增加使用第三项k3来进行描述，成像仪上某点根据其在径向方向上的分布位置，调节公式为：
式中(x0,y0)是畸变点在像平面的原始位置，(x,y)是畸变较正后新的位置，下图是距离光心不同距离上的点经过透镜径向畸变后点位的偏移示意图，可以看到，距离光心越远，径向位移越大，表示畸变也越大，在光心附近，几乎没有偏移。
切向畸变：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1b6359b11f411683febf59662c354158/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-03T17:34:24+08:00" />
<meta property="article:modified_time" content="2023-03-03T17:34:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">相机标定详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <h2 style="text-align:null;">相机标定：</h2> 
 <h4 style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">目的：</span></h4> 
 <p style="text-indent:1.4em;text-align:null;">还原摄像头成像的物体在真实世界的位置就需要知道世界中的物体到计算机图像平面是如何变换的，相机标定的目的之一就是为了搞清楚这种变换关系，求解内外参数矩阵</p> 
 <p style="text-align:null;"> 摄像机的透视投影有个很大的问题——畸变。摄像头标定的另一个目的就是求解畸变系数，然后用于图像矫正</p> 
 <p style="text-align:null;"> </p> 
 <h4 style="text-align:null;">坐标系介绍：</h4> 
 <p style="text-indent:1.4em;text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">世界坐标系(Xw,Yw,Zw)</span>：目标物体位置的参考系。除了无穷远，世界坐标可以根据运算方便与否自由放置，单位为长度单位如mm。在双目视觉中世界坐标系主要有三个用途：</p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:null;"><p>标定时确定标定物的位置</p></li></ol> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:null;"><p>作为双目视觉的系统参考系，给出两个摄像机相对世界坐标系的关系，从而求出相机之间的相对关系；</p></li></ol> 
 <ol start="3"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:null;"><p>作为重建得到三维坐标的容器，存放重建后的物体的三维坐标。世界坐标系是将看见中物体纳入运算的第一站。</p></li></ol> 
 <p style="padding-left:1.4em;text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">摄像机坐标系(Xc,Yc,Zc)</span>：摄像机站在自己角度上衡量的物体的坐标系。摄像</p> 
 <p style="text-align:null;">机坐标系的原点在摄像机的光心上，z轴与摄像机光轴平行。它是与拍摄物体发生联系的桥头堡，世界坐标系下的物体需先经历刚体变化转到摄像机坐标系，然后在和图像坐标系发生关系。它是图像坐标与世界坐标之间发生关系的纽带，沟通了世界上最远的距离。单位为长度单位如mm。</p> 
 <p style="text-align:null;"> <span class="kdocs-bold" style="font-weight:bold;">图像坐标系(x,y)</span>：以CCD 图像平面的中心为坐标原点，为了描述成像过程中物体从相机坐标系到图像坐标系的投影透射关系而引入，方便进一步得到像素坐标系下的坐标。图像坐标系是用物理单位（例如毫米）表示像素在图像中的位置。</p> 
 <p style="text-align:null;"> <span class="kdocs-bold" style="font-weight:bold;">像素坐标系(u,v)</span>：以 CCD 图像平面的左上角顶点为原点，为了描述物体成像后的像点在数字图像上（相片）的坐标而引入，是我们真正从相机内读取到的信息所在的坐标系。像素坐标系就是以像素为单位的图像坐标系。</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:338px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:78.106514%;height:0;"> 
    <img src="https://images2.imgbox.com/31/6b/1O24HNqk_o.png" style="margin-left:;display:block;width:338px;margin-top:-78.106514%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="text-align:null;">图像坐标系转换像素坐标系：</h3> 
 <p style="text-indent:1.4em;text-align:null;">像素坐标系和图像坐标系都在成像平面上，如图。 以图像左上角为原点建立以像素（pixel）为单位的像素坐标系u-v。像素的横坐标u与纵坐标v分别是在其图像数组中所在的列数与所在行数，描述一个像素点都是几行几列。图像坐标系的原点为相机光轴与成像平面的交点O（<span class="kdocs-italic" style="font-style:italic;">u0，v0</span>），通常情况下是成像平面的中点或者叫principal point。图像坐标系的单位是mm，属于物理单位。<span class="kdocs-color" style="background-color:#FBF5B3;color:#C21C13;">dx，dy表示每个像素在横轴x和纵轴y上的物理尺寸（单位为：mm/像素，单位像素的距离）。</span></p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:377px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:87.798416%;height:0;"> 
    <img src="https://images2.imgbox.com/0b/1f/LEBqM7UR_o.png" style="margin-left:;display:block;width:377px;margin-top:-87.798416%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:null;">则图像中的每个像素在u-v坐标系中的坐标和在x-y坐标系中的坐标之间都存在如下的关系（为了方便使用，用齐次坐标与矩阵形式表示）：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:636px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:22.012579%;height:0;"> 
    <img src="https://images2.imgbox.com/1c/50/OYny71nW_o.jpg" style="margin-left:;display:block;width:636px;margin-top:-22.012579%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;">例如：设CCD大小为8 x 6mm，拍摄的图像大小为640 x 480，则dx = 1/80（mm/像素）dy = 1/80（mm/像素）， <span class="kdocs-italic" style="font-style:italic;">u0=320，v0=240</span></p> 
 <h3 style="text-align:null;">三大坐标系：</h3> 
 <p style="text-indent:1.4em;text-align:null;">世界坐标系通过刚体变换到达摄像机坐标系，然后摄像机坐标系通过透视投影变换到达图像坐标系。可以看出，世界坐标与图像坐标的关系建立在<span class="kdocs-color" style="color:#C21C13;">刚体变换和透视投影变换</span>的基础上。</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:503px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:21.272367%;height:0;"> 
    <img src="https://images2.imgbox.com/ff/17/HFT9XP9O_o.png" style="margin-left:;display:block;width:503px;margin-top:-21.272367%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="text-align:null;">世界坐标系转换摄像机坐标系：</h3> 
 <p style="text-indent:1.4em;text-align:null;">刚体变换(regidbody motion)：三维空间中， 当物体不发生形变时，对一个几何物体作旋转， 平移的运动，称之为刚体变换。</p> 
 <p style="text-indent:1.4em;text-align:null;">世界坐标系和摄像机坐标都是右手坐标系，所以其不会发生形变。我们想把世界坐标系下的坐标转换到摄像机坐标下的坐标，如下图所示，可以通过刚体变换的方式。空间中一个坐标系，总可以通过刚体变换转换到另外一个个坐标系的。</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:937px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:52.508003%;height:0;"> 
    <img src="https://images2.imgbox.com/0d/58/lVM74wCT_o.png" style="margin-left:;display:block;width:937px;margin-top:-52.508003%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">世界坐标系与摄像机坐标系之间的刚体转换表达式为：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:708px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.59887%;height:0;"> 
    <img src="https://images2.imgbox.com/25/bc/uHedjYKC_o.jpg" style="margin-left:;display:block;width:708px;margin-top:-47.59887%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">R是3×3的正交单位矩阵（即旋转矩阵），t为平移向量，R、t与摄像机无关，所以称这两个参数为摄像机的外参数(extrinsicparameter)，可以理解为两个坐标原点之间的距离，因其受x,y,z三个方向上的分量共同控制，所以其具有三个自由度。假定在世界坐标系中物点所在平面过世界坐标系原点且与Zw轴垂（也即棋盘平面与Xw-Yw平面重合，目的在于方便后续计算），Zw=0。</p> 
 <p style=""></p> 
 <h3 style="text-align:left;">摄像机坐标系转换图像坐标系：</h3> 
 <p style="text-indent:1.4em;text-align:left;">透视投影(perspective projection)： 用中心投影法将形体投射到投影面上，从而获得的一种较为接近视觉效果的单面投影图。有一点像皮影戏。它符合人们心理习惯，即离视点近的物体大，离视点远的物体小，不平行于成像平面的平行线会相交于消隐点(vanish point)</p> 
 <p style="text-indent:1.4em;text-align:left;">透视投影与小孔成像相似，下图为针孔摄像机的模型，平面π称为摄像机的像平面，点Oc称为摄像机中心（或光心），f成为摄像机的焦距，Oc为端点且垂直于像平面的射线成为光轴或主轴，主轴与像平面的交点p是摄像机的主点</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:615px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:43.902443%;height:0;"> 
    <img src="https://images2.imgbox.com/db/05/49swINoG_o.png" style="margin-left:;display:block;width:615px;margin-top:-43.902443%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">图像坐标系为O-xy，摄像机坐标系为Oc-XcYcZc。记空间点Xc摄像机坐标系中的齐次坐标为:</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:265px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:18.867924%;height:0;"> 
    <img src="https://images2.imgbox.com/31/3d/KAes66YF_o.png" style="margin-left:;display:block;width:265px;margin-top:-18.867924%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">像点m在图像坐标系中的齐次坐标为：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:227px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:22.026432%;height:0;"> 
    <img src="https://images2.imgbox.com/94/7d/CKHjz25G_o.png" style="margin-left:;display:block;width:227px;margin-top:-22.026432%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">根据三角形相似原理：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:157px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:105.73248%;height:0;"> 
    <img src="https://images2.imgbox.com/aa/6b/uEYh8Ezu_o.png" style="margin-left:;display:block;width:157px;margin-top:-105.73248%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">矩阵表示为（齐次坐标伸缩不变性Zc[x y 1]T和[x y 1]T表示同一点）：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:701px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:17.40371%;height:0;"> 
    <img src="https://images2.imgbox.com/83/92/O8SSr98T_o.png" style="margin-left:;display:block;width:701px;margin-top:-17.40371%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">合并：</p> 
 <p style="text-align:left;"> 将世界坐标系转换到像素坐标系，将上诉式子联系起来，写在一起得到如下矩阵（注意符号对应u—&gt;像素坐标、x—&gt;图像坐标、Xc—&gt;摄像机坐标、Xw—&gt;世界坐标）：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:795px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:34.71698%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/e3/1RT5Vskj_o.png" style="margin-left:;display:block;width:795px;margin-top:-34.71698%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:left;">世界坐标到像素坐标变换矩阵P如下：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:582px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:25.257732%;height:0;"> 
    <img src="https://images2.imgbox.com/4a/36/2YU6zzew_o.png" style="margin-left:;display:block;width:582px;margin-top:-25.257732%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">P表示一个投影相机：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:303px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:40.264027%;height:0;"> 
    <img src="https://images2.imgbox.com/ee/62/A3NevwhA_o.png" style="margin-left:;display:block;width:303px;margin-top:-40.264027%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:null;">总结：世界坐标系到像素坐标系（不考虑畸变）的转换关系</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:548px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:123.357666%;height:0;"> 
    <img src="https://images2.imgbox.com/f7/b5/OfI13rkw_o.png" style="margin-left:;display:block;width:548px;margin-top:-123.357666%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h3 style="text-align:left;">图片矫正：</h3> 
 <p style="text-indent:1.4em;text-align:left;">我们在摄像机坐标系到图像坐标系变换时谈到透视投影。摄像机拍照时通过透镜把实物投影到像平面上，但是透镜由于制造精度以及组装工艺的偏差会引入畸变，导致原始图像的失真。因此我们需要考虑成像畸变的问题。</p> 
 <p style="text-indent:1.4em;text-align:left;">透镜的畸变主要分为径向畸变和切向畸变，还有薄透镜畸变等等，但都没有径向和切向畸变影响显著，所以我们在这里只考虑径向和切向畸变</p> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">径向畸变：</span></p> 
 <p style="text-align:left;"> 径向畸变就是沿着透镜半径方向分布的畸变，<span class="kdocs-color" style="color:#080F17;">产生原因是光线在远离透镜中心的地方比靠近中心的地方更加弯曲</span>，这种畸变在普通廉价的镜头中表现更加明显，径向畸变主要包括桶形畸变和枕形畸变两种。以下分别是枕形和桶形畸变示意图：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:715px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:47.83217%;height:0;"> 
    <img src="https://images2.imgbox.com/ac/17/it8iJpiP_o.png" style="margin-left:;display:block;width:715px;margin-top:-47.83217%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style="text-align:left;">像平面中心的畸变为0，沿着镜头半径方向向边缘移动，畸变越来越严重。畸变的数学模型可以用主点（principle point）周围的泰勒级数展开式的前几项进行描述，通常使用前两项，即k1和k2，对于畸变很大的镜头，如鱼眼镜头，可以增加使用第三项k3来进行描述，成像仪上某点根据其在径向方向上的分布位置，调节公式为：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:361px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:27.97784%;height:0;"> 
    <img src="https://images2.imgbox.com/af/6d/H2TdrG3C_o.png" style="margin-left:;display:block;width:361px;margin-top:-27.97784%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">式中(x0,y0)是畸变点在像平面的原始位置，(x,y)是畸变较正后新的位置，下图是距离光心不同距离上的点经过透镜径向畸变后点位的偏移示意图，可以看到，距离光心越远，径向位移越大，表示畸变也越大，在光心附近，几乎没有偏移。</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:472px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:76.694916%;height:0;"> 
    <img src="https://images2.imgbox.com/8a/8a/4RTzCuKm_o.png" style="margin-left:;display:block;width:472px;margin-top:-76.694916%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">切向畸变：</span></p> 
 <p style="text-indent:1.4em;text-align:left;">切向畸变是由于透镜本身与相机传感器平面（像平面）或图像平面不平行而产生的，这种情况多是由于透镜被贴到镜头模组上的安装偏差导致。畸变模型可以用两个额外的参数p1和p2来描述：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:328px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:25.304878%;height:0;"> 
    <img src="https://images2.imgbox.com/36/ac/H0u5YPDo_o.png" style="margin-left:;display:block;width:328px;margin-top:-25.304878%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">下图显示某个透镜的切向畸变示意图，大体上畸变位移相对于左下——右上角的连线是对称的，说明该镜头在垂直于该方向上有一个旋转角度。</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:465px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:81.075264%;height:0;"> 
    <img src="https://images2.imgbox.com/c7/69/8EMxOrBc_o.png" style="margin-left:;display:block;width:465px;margin-top:-81.075264%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">径向畸变和切向畸变模型中一共有5个畸变参数，在Opencv中他们被排列成一个5×1的矩阵，依次包含k1、k2、p1、p2、k3，经常被定义为Mat矩阵的形式，如Mat distCoeffs=Mat（1,5，CV_32FC1，Scalar::all（0））；这5个参数就是相机标定中需要确定的相机的5个畸变系数。求得这5个参数后，就可以校正由于镜头畸变引起的图像的变形失真。</p> 
 <h3 style="">张氏标定法：</h3> 
 <p style="text-align:left;"> 相机标定的目的就是建立摄像机图像像素位置与物体空间位置之间的关系，即世界坐标系与图像坐标系之间的关系。方法就是根据摄像机模型，<span class="kdocs-color" style="color:#C21C13;">由已知特征点的坐标求解摄像机的模型参数（从三维坐标即棋盘格求解参数），从而可以从图像出发恢复出空间点三维坐标，即三维重建（参数已知后，从图像坐标求解世界坐标）。</span>所以要求解的参数包括4个内参数和5个畸变参数，还有外部参数旋转矩阵和平移矩阵。</p> 
 <p style="text-indent:1.4em;text-align:left;">“张氏标定”是指张正友教授于1998年提出的单平面棋盘格的摄像机标定方法。张氏标定法已经作为工具箱或封装好的函数被广泛应用。张氏标定的原文为“A Flexible New Technique forCamera Calibration”。此文中所提到的方法，为相机标定提供了很大便利，并且具有很高的精度。从此标定可以不需要特殊的标定物，只需要一张打印出来的棋盘格。</p> 
 <p style="text-indent:1.4em;text-align:left;">上文中我们已经得到了像素坐标系和世界坐标系下的坐标映射关系，我们假设标定棋盘位于世界坐标中Zw=0平面，则化简前文中的公式：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:993px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:27.190332%;height:0;"> 
    <img src="https://images2.imgbox.com/dc/1c/px20IBx3_o.png" style="margin-left:;display:block;width:993px;margin-top:-27.190332%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-indent:1.4em;text-align:left;">其中，u，v表示像素坐标系中的坐标，fx=f/dx，fy=f/dy，u0，x0，γ(由于制造误差产生的两个坐标轴偏斜参数，通常很小，如果按上文中矩阵运算得到的值即为0）表示5个相机内参，R，t示相机外参,Xw，Yw，Zw 表示世界坐标系中的坐标。</p> 
 <p style="text-indent:1.4em;text-align:left;">fx，fy和物理焦距f之间的关系为：fx=fsx和fy=fsy。其中sx=1/dx表示x方向上的1毫米长度所代表像素值，即像素/单位毫米，fx，fy是在相机标定中整体计算的，而不是通过该公式计算的。</p> 
 <p style="">单应性(在计算机视觉中被定义为一个平面到另一个平面的投影映射)矩阵定义为：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:660px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:18.939394%;height:0;"> 
    <img src="https://images2.imgbox.com/e2/ff/J9qSSFHd_o.jpg" style="margin-left:;display:block;width:660px;margin-top:-18.939394%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="text-align:left;">我们如果求取H的值？</p> 
 <p style="text-align:left;"> 可以分析一下，H是一个3×3的矩阵，并且有一个元素是作为齐次坐标因此，H有8个未知量待解。(Xw,Yw)作为标定物的空间坐标，可以由设计者</p> 
 <p style="text-align:left;">人为控制，是已知量。(u,v)是像素坐标，我们可以直接通过摄像机获得。</p> 
 <p style="text-align:left;"> </p> 
 <p style="text-align:left;"> 对于一组对应(Xw,Yw)-(u,v)我们可以获得两组方程。现在有8个未知量需要求解，所以我们至少需要八个方程。所以需要四个对应点。四点即可算出，图像平面到世界平面的单应性矩阵H。这也是张氏标定采用四个角点的棋盘格作为标定物的一个原因。张氏标定就是利用一张打印的棋盘格，然后对每个角点进行标记其在像素坐标系的像素点坐标，以及在世界坐标系的坐标，张氏标定证明通过4组以上的点就可以</p> 
 <p style="text-align:left;">求解出H矩阵的值，但是为了减少误差，具有更强的鲁棒性，我们一般会拍摄许多张照片，选取大量的角点进行标定。具体过程如下：</p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:left;"><p>打印一张棋盘格标定图纸，将其贴在平面物体的表面</p></li></ol> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:left;"><p>拍摄一组不同方向棋盘格的图片，可以通过移动相机来实现，也可以移动标定图片来实现。</p></li></ol> 
 <ol start="3"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:left;"><p>对于每张拍摄的棋盘图片，检测图片中所有棋盘格的特征点（角点，也就是下图中黑白棋盘交叉点，中间品红色的圆圈内就是一个角点）。我们定义打印的棋盘图纸位于世界坐标系Zw=0的平面上，世界坐标系的原点位于棋盘图纸的固定一角（比如下图中黄色点）。像素坐标系原点位于图片左上角。</p></li></ol> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:553px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:36.70886%;height:0;"> 
    <img src="https://images2.imgbox.com/b8/00/Sd2tGrrN_o.png" style="margin-left:;display:block;width:553px;margin-top:-36.70886%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <ol start="4"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;text-align:left;"><p>因为棋盘标定图纸中所有角点的空间坐标是已知的，这些角点对应在拍摄的标定图片中的角点的像素坐标也是已知的，如果我们得到这样的N&gt;=4个匹配点对（越多计算结果越鲁棒），就可以根据LM等优化方法得到单应性矩阵H。</p></li></ol> 
 <p style="text-align:left;">张正友教授从数学推导上证明了张氏标定算法的可行性。但在实际标定过程中，一般使用最大似然估计进行优化。假设我们拍摄了n张标定图片，每张图片里有m个棋盘格角点。三维空间点Xj(Xw,Yw,Zw)经过相机内参M，外参R，t变换后得到的二维像素为x′(u,v)假设噪声是独立同分布的，我们通过最小化Xij(实际值：棋盘格角点在像素坐标系下的实际值), x′(估计值)的位置来求解上述最大似然估计问题：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:358px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:25.418995%;height:0;"> 
    <img src="https://images2.imgbox.com/2a/7f/EbOMRqDb_o.png" style="margin-left:;display:block;width:358px;margin-top:-25.418995%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="padding-left:1.4em;text-align:left;">现在我们来考虑透镜畸变的影响，由于径向畸变的影响相对较明显，所以主要考虑径向畸变参数，根据经验，通常只考虑径向畸变的前两个参数k1,k2就可以（增加更多的参数会使得模型变的复杂且不稳定）。实际求解中，通常把k1,k2也作为参数加入上述函数一起进行优化，待优化函数如下所示：</p> 
 <div class="kdocs-line-container" style="display:flex;justify-content:center;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:398px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:17.085428%;height:0;"> 
    <img src="https://images2.imgbox.com/24/e7/21Hr8f4I_o.png" style="margin-left:;display:block;width:398px;margin-top:-17.085428%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <p style=""></p> 
 <p style="">文章参考于：<a class="kdocs-link" style="color:#0A6CFF;" href="https://www.cnblogs.com/zyly/p/9366080.html" rel="nofollow noopener noreferrer" target="_blank">https://www.cnblogs.com/zyly/p/9366080.html</a></p> 
 <p style=""></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d37f0bbbc351e84c8938d18dc9bb9bfa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">从0到1实现单机记账APP原理与细节uniApp内含源码 (二)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9e070dcee90f4c91cda03787f2b5c253/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL45讲笔记04深入浅出索引上</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>