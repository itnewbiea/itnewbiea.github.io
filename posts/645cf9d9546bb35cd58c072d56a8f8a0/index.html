<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>es查询修改 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="es查询修改" />
<meta property="og:description" content="1.正则查询
GET ip:端口号/process_node/_search { &#34;from&#34; : 0, &#34;size&#34; : 100, &#34;query&#34;: { &#34;bool&#34;: { &#34;must&#34;: [ { &#34;term&#34;:{ &#34;robotId&#34; : { &#34;value&#34; : 1234 } } }, { &#34;term&#34;:{ &#34;type&#34; : { &#34;value&#34; : &#34;START&#34; } } }, { &#34;regexp&#34;: { &#34;config&#34;: { &#34;value&#34;: &#34;.*TOPIC.*&#34; } } } ] } } } //通配符查询，相当于like { &#34;from&#34; : 0, &#34;size&#34; : 100, &#34;query&#34;: { &#34;bool&#34;: { &#34;must&#34;: [ { &#34;term&#34;:{ &#34;type&#34; : { &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/645cf9d9546bb35cd58c072d56a8f8a0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-16T20:09:48+08:00" />
<meta property="article:modified_time" content="2023-11-16T20:09:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">es查询修改</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1.正则查询</p> 
<blockquote> 
 <pre><code>GET  ip:端口号/process_node/_search


{

 "from" : 0,

 "size" : 100,

"query": {

    "bool": {

      "must": [
        
        {

            "term":{

                "robotId" : {

                                "value" : 1234

                                }

            }

        },

         {

            "term":{

                "type" : {

                                "value" : "START"

                                }

            }

        },

        {

          "regexp": {

            "config": {

              "value": ".*TOPIC.*"

            }

          }

        }

      ]

    }

  }

}</code></pre> 
 <pre><code> //通配符查询，相当于like
{
 "from" : 0,
 "size" : 100,
"query": {
    "bool": {
      "must": [
        
         {
            "term":{
                "type" : {
                                "value" : "START"
                                }
            }
        },
        {
           "wildcard": {
            "expandNodeConfig": {
                "value":"*"aaa"*"
            }
          }
        }
      ]
    }
  }
}</code></pre> 
 <p></p> 
</blockquote> 
<p>2. 只查询某个字段，去重排序</p> 
<blockquote> 
 <p> ip:端口号/process_node/_search<br> {<!-- --><br>  "_source": ["robotId"], <br>  "from" : 0,<br>  "size" : 400,<br> "query": {<!-- --><br>     "bool": {<!-- --><br>       "must": [<br>         {<!-- --><br>           "regexp": {<!-- --><br>             "expandNodeConfig": {<!-- --><br>               "value": ".*系统_.*"<br>             }<br>           }<br>         }<br>       ]<br>     }<br>   },<br>   "collapse":{<!-- --><br>         "field":"robotId"<br>     },<br>     "sort": { "robotId": { "order": "asc" }}<br><br> }</p> 
</blockquote> 
<p>3. 修改字段的值</p> 
<blockquote> 
 <p>post ip:端口号/process_node/_update_by_query<br> {<!-- --><br>   "query": {<!-- --><br>     "match": {<!-- --><br>       "_id": "123456"<br>     }<br>   },<br>   "script": {<!-- --><br>     "source": "ctx._source['expandNodeConfig'] = params['new_expandNodeConfig']",<br>     "params": {<!-- --><br>       "new_expandNodeConfig":"你好"<br>     }<br>   }<br> } </p> 
</blockquote> 
<p> 4. 分组查询</p> 
<pre><code>{
 "aggs": {
		"ageGroup": {
			"terms": {
				"field": "age",
				"order": {
				  "_count": "desc"
				}
			}
		}
	},
	"size": 0
}</code></pre> 
<p>5. 查询所有的索引：</p> 
<pre><code>a、查询所有index与index相关信息

GET _cat/indices

b、只查询index名称

GET _cat/indices?h=idx</code></pre> 
<p> 6. 删除和新建索引</p> 
<pre><code>1. 先删除原索引
DELETE /my_index

2.新建索引
 PUT /my_index
{
  {

   "mappings": {
            "properties": {
               
                "addTime": {
                    "type": "date"
                },
                "answerIds": {
                    "type": "keyword"
                },
                "categoryId": {
                    "type": "long"
                },
                "effectiveEndTime": {
                    "type": "date"
                },
                "effectiveStartTime": {
                    "type": "date"
                },
                "effectiveType": {
                    "type": "integer"
                },
                "enable": {
                    "type": "boolean"
                },
                "hits": {
                    "type": "long"
                },
                "id": {
                    "type": "keyword"
                },
                "modifyTime": {
                    "type": "date"
                },
                "parentId": {
                    "type": "long"
                },
                "question": {
                    "type": "text",
                    "analyzer": "ik_max_word"
                },
                "relateQuestionIds": {
                    "type": "keyword"
                },
                "robotId": {
                    "type": "long"
                },
                "similarQuestionIds": {
                    "type": "keyword"
                },
                "sourceType": {
                    "type": "long"
                },
                "termQuestion": {
                    "type": "text",
                    "fields": {
                        "keyword": {
                            "type": "keyword",
                            "ignore_above": 256
                        }
                    }
                },
                "userId": {
                    "type": "long"
                }
            }
        }
  }
}
</code></pre> 
<p>7. 新增字段并设置默认值</p> 
<pre><code>//先新增字段，设置字段类型

PUT /{index}/_mapping
{
  "properties": {
      "new_field": {
        "type": "keyword"
      }
    }
}


//更新字段的值

POST /{index}/_update_by_query
{
    "script": {
        "inline": "ctx._source.new_field = 'value'"
    },
    "query": {
      "bool": {
      "must_not": {
        "exists": { "field": "date_field" }
      }
    }
  }
}</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ba229b683bc47bf321b805d59a55be48/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">html表单和（横向）导航栏</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02dd908b503e2648735e2e2ac1f39af6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">通俗理解信号量</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>