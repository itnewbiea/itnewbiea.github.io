<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>多数据源配置下，解决org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)问题 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="多数据源配置下，解决org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)问题" />
<meta property="og:description" content="1、检查mybatis.xml文件namespace名称是否和Mapper接口的全限定名是否一致
2、检查Mapper接口的方法在mybatis.xml中的每个语句的id是否一致
3、检查Mapper接口方法返回值是否匹配select元素配置的ResultMap,或者只配置ResultType
4、检查yml文件中的mapper的XML配置路径是否正确
5、Mybatis中接口与映射文件一定要同名或者必须在同一个包下，这个我没试过，好像是可以不同名的。
6、配置数据源的SqlSessionFactoryBean要使用MyBatisSqlSessionFactoryBean，这个也是鬼扯，MybatisPlus和Mybatis分清楚再说
7、编译没有把XML拷贝过来，可以用这招：
&lt;build&gt; &lt;resources&gt; &lt;resource&gt; &lt;directory&gt;src/main/java&lt;/directory&gt; &lt;includes&gt; &lt;include&gt;**/*.xml&lt;/include&gt; &lt;/includes&gt; &lt;/resource&gt; &lt;/resources&gt; &lt;/build&gt; 8、 启动会默认通过org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration * 类，我们是自定义的，所以需要排除MybatisAutoConfiguration
@SpringBootApplication(exclude = MybatisAutoConfiguration.class) 9、Mapper接口文件，不同数据源需要放置在不同包下面。
可能的原因都在这里了，各位慢用！！！ 附上SqlSessionFactoryBean代码
ds1.java:
package com.****.****.Configurer; import org.mybatis.spring.SqlSessionFactoryBean; import org.mybatis.spring.annotation.MapperScan; import org.springframework.beans.factory.annotation.Qualifier; import org.springframework.boot.context.properties.ConfigurationProperties; import org.springframework.boot.jdbc.DataSourceBuilder; import org.springframework.context.annotation.Bean; import org.springframework.context.annotation.Configuration; import org.springframework.context.annotation.Primary; import org.springframework.core.io.support.PathMatchingResourcePatternResolver; import org.springframework.jdbc.datasource.DataSourceTransactionManager; import org.springframework.transaction.PlatformTransactionManager; import javax.sql.DataSource; @Configuration @MapperScan(basePackages = {&#34;com.***.***.Mapper.ds1&#34;}, sqlSessionFactoryRef = &#34;ds1SqlSessionFactory&#34;) public class MybatisDS1Config { @Bean(name = &#34;ds1DataSource&#34;) @ConfigurationProperties(prefix = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/411bd0b91bfb4e4338d5cdafed48b408/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-26T17:00:19+08:00" />
<meta property="article:modified_time" content="2022-07-26T17:00:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">多数据源配置下，解决org.apache.ibatis.binding.BindingException: Invalid bound statement (not found)问题</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1、检查mybatis.xml文件namespace名称是否和Mapper接口的全限定名是否一致<br> 2、检查Mapper接口的方法在mybatis.xml中的每个语句的id是否一致<br> 3、检查Mapper接口方法返回值是否匹配select元素配置的ResultMap,或者只配置ResultType<br> 4、检查yml文件中的mapper的XML配置路径是否正确<br> 5、Mybatis中接口与映射文件一定要同名或者必须在同一个包下，<span style="color:#fe2c24;">这个我没试过，好像是可以不同名的。</span></p> 
<p>6、配置数据源的SqlSessionFactoryBean要使用MyBatisSqlSessionFactoryBean，这个也是鬼扯，MybatisPlus和Mybatis分清楚再说</p> 
<p><img alt="" src="https://images2.imgbox.com/58/89/kMQGsFIM_o.png"></p> 
<p>7、编译没有把XML拷贝过来，可以用这招：</p> 
<pre><code>&lt;build&gt;      
    &lt;resources&gt;          
        &lt;resource&gt;               
            &lt;directory&gt;src/main/java&lt;/directory&gt;               
            &lt;includes&gt;                   
                &lt;include&gt;**/*.xml&lt;/include&gt;            
            &lt;/includes&gt;
        &lt;/resource&gt;
    &lt;/resources&gt;
&lt;/build&gt;
</code></pre> 
<p>8、 启动会默认通过org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration * 类，我们是自定义的，所以需要排除MybatisAutoConfiguration</p> 
<pre><code>@SpringBootApplication(exclude = MybatisAutoConfiguration.class)</code></pre> 
<p>9、Mapper接口文件，不同数据源需要放置在不同包下面。</p> 
<p>可能的原因都在这里了，各位慢用！！！ </p> 
<p>附上SqlSessionFactoryBean代码</p> 
<p>ds1.java:</p> 
<pre><code>package com.****.****.Configurer;

import org.mybatis.spring.SqlSessionFactoryBean;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.boot.jdbc.DataSourceBuilder;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.context.annotation.Primary;
import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
import org.springframework.jdbc.datasource.DataSourceTransactionManager;
import org.springframework.transaction.PlatformTransactionManager;

import javax.sql.DataSource;

@Configuration
@MapperScan(basePackages = {"com.***.***.Mapper.ds1"}, sqlSessionFactoryRef = "ds1SqlSessionFactory")
public class MybatisDS1Config {

    @Bean(name = "ds1DataSource")
    @ConfigurationProperties(prefix = "spring.datasource.ds1")
    public DataSource dataSource() {
        return DataSourceBuilder.create().build();
    }
    /**
     * 配置事务管理器，不然事务不起作用
     *
     * @return
     */
    @Bean
    public PlatformTransactionManager transactionManagerDS1() {
        return new DataSourceTransactionManager(this.dataSource());
    }
    @Primary
    @Bean(name = "ds1SqlSessionFactory")
    public SqlSessionFactoryBean ds1sqlSessionFactory(@Qualifier("ds1DataSource") DataSource dataSource) throws Exception {
        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();
        sqlSessionFactoryBean.setDataSource(dataSource);
        sqlSessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver()
                .getResources("classpath*:mapping/ds1/*.xml"));
        sqlSessionFactoryBean.setTypeAliasesPackage("com.***.***.Entity");
        sqlSessionFactoryBean.getObject().getConfiguration().setMapUnderscoreToCamelCase(true);
        return sqlSessionFactoryBean;

        /**
         * 这里在applications.properties里面配置了
         * mybatis.type-aliases-package=com.jwt.springboot.dao
         * mybatis.mapper-locations=classpath:mapper/*Mapper.xml
         * 但多数据源情况下执行sql总会报：org.apache.ibatis.binding.BindingException:
         * Invalid bound statement (not found)........
         * 原因是 this.mapperLocations 为null
         *
         * 注！！！！这里有大坑， 因为这里是自定义的sqlSessionFactoryBean，所以导致
         * 没有启动时没有通过org.mybatis.spring.boot.autoconfigure.MybatisAutoConfiguration
         * 类的sqlSessionFactory(DataSource dataSource)方法自动装配sqlSessionFactoryBean
         * 自定义的sqlSessionFactoryBean所以也没设置mapperLocations
         * 故自定义实例化sqlSessionFactoryBean这里需要手动设置mapperLocations
         * 可参考：https://developer.aliyun.com/article/754124
         */
    }
}
</code></pre> 
<p> ds2,java</p> 
<pre><code>package com.***.***.Configurer;

import com.baomidou.mybatisplus.extension.spring.MybatisSqlSessionFactoryBean;
import org.apache.ibatis.session.SqlSessionFactory;
import org.mybatis.spring.SqlSessionFactoryBean;
import org.mybatis.spring.annotation.MapperScan;
import org.springframework.beans.factory.annotation.Qualifier;
import org.springframework.boot.context.properties.ConfigurationProperties;
import org.springframework.boot.jdbc.DataSourceBuilder;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.core.io.support.PathMatchingResourcePatternResolver;
import org.springframework.jdbc.datasource.DataSourceTransactionManager;
import org.springframework.transaction.PlatformTransactionManager;

import javax.sql.DataSource;

@Configuration
@MapperScan(basePackages = "com.***.***.Mapper.ds2", sqlSessionFactoryRef = "ds2SqlSessionFactory")
public class MybatisDS2Config {

    @Bean(name = "ds2DataSource")
    @ConfigurationProperties(prefix = "spring.datasource.ds2")
    public DataSource dataSource() {
        return DataSourceBuilder.create().build();
    }
    /**
     * 配置事务管理器，不然事务不起作用
     *
     * @return
     */
    @Bean
    public PlatformTransactionManager transactionManagerDS2() {
        return new DataSourceTransactionManager(this.dataSource());
    }

    @Bean("ds2SqlSessionFactory")
    public SqlSessionFactory ds2sqlSessionFactory(@Qualifier("ds2DataSource") DataSource dataSource) throws Exception {
        SqlSessionFactoryBean sqlSessionFactoryBean = new SqlSessionFactoryBean();
        sqlSessionFactoryBean.setDataSource(dataSource);
        sqlSessionFactoryBean.setMapperLocations(new PathMatchingResourcePatternResolver()
                .getResources("classpath*:mapping/ds2/*.xml"));
        sqlSessionFactoryBean.setTypeAliasesPackage("com.***.***.Entity");
        sqlSessionFactoryBean.getObject().getConfiguration().setMapUnderscoreToCamelCase(true);
        return sqlSessionFactoryBean.getObject();

    }
}
</code></pre> 
<p>yml配置： </p> 
<pre><code>spring:
  datasource:
    ds1: #主数据库，生产数据库
      username: ***
      password: ***
      #url中database为对应的数据库名称   //数据库名字
      jdbc-url: jdbc:mysql://***:3306/crmdb?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC
      driver-class-name: com.mysql.cj.jdbc.Driver

    ds2: #从数据库，分析数据库
      username: ***
      password: ***
      #url中database为对应的数据库名称   //数据库名字
      jdbc-url: jdbc:mysql://***:3306/jmsns?useUnicode=true&amp;characterEncoding=utf-8&amp;useSSL=true&amp;serverTimezone=UTC
      driver-class-name: com.mysql.cj.jdbc.Driver</code></pre> 
<p>文件目录结构： </p> 
<p><img alt="" height="436" src="https://images2.imgbox.com/e0/ca/aQKPQV5Y_o.png" width="481"></p> 
<p>另外，在Linux环境下：</p> 
<pre><code>new PathMatchingResourcePatternResolver().getResources("classpath*:mapping/ds2/*.xml"));</code></pre> 
<p>可能出现找不到配置文件的问题，我用的替代方法是：</p> 
<pre><code>new ClassPathResource[]{new ClassPathResource("/mapping/ds1/UserMapper.xml")}</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/51c3dee7763c08ac97ce2d8af4cbf427/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">龙迅HDMI2.0/1.4 开关具有一个符合 HDMI2.0/1.4 规范</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3e71ba0dce005fa5bb943a79d75b7d9f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【JavaScript】期约与异步函数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>