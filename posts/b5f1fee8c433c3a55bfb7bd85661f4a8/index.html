<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Helm扩展 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Helm扩展" />
<meta property="og:description" content="一、概述 Helm 针对 Kubernetes 的 Helm 包管理器。Helm 的一般操作：
helm search: 搜索 chart
helm pull: 下载 chart 到本地目录查看
helm install: 上传 chart 到 Kubernetes
helm list: 列出已发布的 chart
# 查看帮助 helm --help 官方文档：https://helm.sh/zh/docs/helm/helm/ 二、Helm仓库（helm repo） 添加、列出、删除、更新和索引 chart 仓库。
1）添加 chart 仓库 helm repo add bitnami https://charts.bitnami.com/bitnami 2）列出已添加的仓库 helm repo list 3）从 chart 仓库中更新本地可用 chart 的信息 helm repo update bitnami 4）删除一个或多个仓库 helm repo remove bitnami 三、创建 chart（helm create） 使用给定名称创建新的 chart，该命令创建 chart 目录和 chart 用到的公共文件目录。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b5f1fee8c433c3a55bfb7bd85661f4a8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-31T17:38:11+08:00" />
<meta property="article:modified_time" content="2022-10-31T17:38:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Helm扩展</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、概述</h2> 
<p>Helm 针对 Kubernetes 的 Helm 包管理器。Helm 的一般操作：</p> 
<ul><li> <p>helm search:    搜索 chart</p> </li><li> <p>helm pull:     下载 chart 到本地目录查看</p> </li><li> <p>helm install:    上传 chart 到 Kubernetes</p> </li><li> <p>helm list:      列出已发布的 chart</p> </li></ul> 
<pre><code># 查看帮助
helm --help</code></pre> 
<p><img alt="" height="756" src="https://images2.imgbox.com/f7/b7/QEpBtZmu_o.png" width="1200"></p> 
<blockquote> 
 <p>官方文档：https://helm.sh/zh/docs/helm/helm/ </p> 
</blockquote> 
<h2>二、Helm仓库（helm repo）</h2> 
<blockquote> 
 <p> 添加、列出、删除、更新和索引 chart 仓库。</p> 
</blockquote> 
<h4>1）添加 chart 仓库</h4> 
<pre><code>helm repo add bitnami https://charts.bitnami.com/bitnami
</code></pre> 
<h4>2）列出已添加的仓库</h4> 
<pre><code>helm repo list
</code></pre> 
<h4>3）从 chart 仓库中更新本地可用 chart 的信息</h4> 
<pre><code>helm repo update bitnami
</code></pre> 
<h4>4）删除一个或多个仓库</h4> 
<pre><code>helm repo remove bitnami</code></pre> 
<h2> 三、创建 chart（helm create）</h2> 
<blockquote> 
 <p>使用给定名称创建新的 chart，该命令创建 chart 目录和 chart 用到的公共文件目录。</p> 
</blockquote> 
<p> 比如'helm create foo'会创建一个目录结构看起来像这样：</p> 
<pre><code>$ helm create foo
foo/
├── .helmignore   # Contains patterns to ignore when packaging Helm charts.
├── Chart.yaml    # Information about your chart
├── values.yaml   # The default values for your templates
├── charts/       # Charts that this chart depends on
└── templates/    # The template files
    └── tests/    # The test files</code></pre> 
<p></p> 
<p><img alt="" height="404" src="https://images2.imgbox.com/58/b4/IqqykiMO_o.png" width="1099"></p> 
<h2> 四、chart 包安装（helm install）</h2> 
<blockquote> 
 <p>该命令用于<strong>安装 chart 包</strong>。安装参数必须是 chart 的引用，一个<strong>打包后的 chart 路径</strong>，<strong>未打包的 chart 目录或者是一个 URL</strong>。</p> 
</blockquote> 
<p>要重写 chart 中的值，使用<code>--values</code>参数传递一个文件或者使用<code>--set</code>参数在命令行传递配置，强制使用字符串要用<code>--set-string</code>。当值本身对于命令行太长或者是动态生成的时候，可以使用<code>--set-file</code>设置独立的值。</p> 
<pre><code>helm install -f myvalues.yaml myredis ./redis

helm install --set name=prod myredis ./redis

helm install --set-string long_int=1234567890 myredis ./redis

helm install --set-file my_script=dothings.sh myredis ./redis</code></pre> 
<h2>五、管理 chart 依赖（helm dependency）</h2> 
<p>Helm chart 将依赖存储在'charts/'。对于 chart 开发者，管理依赖比声明了所有依的'Chart.yaml'文件更容易。<br> 依赖命令对该文件进行操作，使得存储在'charts/'目录的需要的依赖和实际依赖之间同步变得很容易。<br> 比如 Chart.yaml 声明了两个依赖：</p> 
<pre><code># Chart.yaml
dependencies:
- name: nginx
    version: "1.2.3"
    repository: "https://example.com/charts"
- name: memcached
    version: "3.2.1"
    repository: "https://another.example.com/charts"
</code></pre> 
<ul><li> <p><code>name</code> 是 chart 名称，<strong>必须匹配<code>Chart.yaml</code>文件中名称</strong>。</p> </li><li> <p><code>version</code> 字段应该包含一个语义化的版本或版本范围。</p> </li></ul> 
<p>从 2.2.0 开始，仓库可以被定义为本地存储的依赖 chart 的目录路径。路径应该以"file://"前缀开头，比如：</p> 
<pre><code># Chart.yaml
dependencies:
- name: nginx
    version: "1.2.3"
    repository: "file://../dependency_chart/nginx"
</code></pre> 
<h4>1）列举指定 chart 的依赖</h4> 
<pre><code># helm dependency list CHART
helm dependency list wordpress
</code></pre> 
<h4>2）依赖升级</h4> 
<p>基于 Chart.yaml 内容升级 charts/</p> 
<pre><code># helm dependency update CHART [flags]
helm dependency update wordpress
</code></pre> 
<h2>六、Helm 列表（helm list）</h2> 
<ul><li> <p><strong>列举发布版本</strong>，该命令会列举出指定命名空间的所有发布版本，(如果没有指定命名空间，会使用当前命名空间)。</p> </li><li> <p><strong>默认</strong>情况下，只会<strong>列举出部署的或者失败的发布</strong>，像<code>--uninstalled</code>或者<code>--all</code>会修改默认行为。这些参数可以组合使用：<code>--uninstalled --failed</code>。</p> </li><li> <p>默认情况下，最多返回<code>256</code>项，使用<code>--max</code>限制数量，<code>--max</code>设置为<strong>0 不会返回所有结果</strong>，而是返回服务器默认值，可能要比 256 更多。同时使用<code>--max</code>和<code>--offset</code>参数可以<strong>翻页</strong>显示。</p> </li></ul> 
<pre><code># -A显示所有
helm list --max=10 --offset=2 -A
</code></pre> 
<h2>七、升级版本（helm upgrade）</h2> 
<blockquote> 
 <p>该命令将发布升级到新版的 chart。升级参数必须是发布和 chart。chart 参数可以是：<code>chart引用('example/mariadb')</code>，<code>chart目录路径</code>，打包的 chart 或者完整 URL。对于 chart 引用，除非使用'--version'参数指定，否则会使用最新版本。</p> 
</blockquote> 
<pre><code>helm upgrade --set foo=bar --set foo=newbar redis ./redis
</code></pre> 
<h2>八、发布历史（helm history）</h2> 
<blockquote> 
 <p>检索发布历史，打印给定版本的历史修订。<strong>默认</strong>会返回最大的<code>256</code>个历史版本。设置<code>--max</code>配置返回历史列表的最大长度。</p> 
</blockquote> 
<p>历史发布集合会被打印成格式化的表格，例如：</p> 
<pre><code>$ helm history angry-bird
REVISION    UPDATED                     STATUS          CHART             APP VERSION     DESCRIPTION
1           Mon Oct 3 10:15:13 2016     superseded      alpine-0.1.0      1.0             Initial install
2           Mon Oct 3 10:15:13 2016     superseded      alpine-0.1.0      1.0             Upgraded successfully
3           Mon Oct 3 10:15:13 2016     superseded      alpine-0.1.0      1.0             Rolled back to 2
4           Mon Oct 3 10:15:13 2016     deployed        alpine-0.1.0      1.0             Upgraded successfully
</code></pre> 
<h2>九、回滚版本（helm rollback）</h2> 
<blockquote> 
 <p>回滚发布到上一个版本，回滚命令的第一个参数是发布的名称，第二是修订（版本）号，如果省略此参数，会回滚到上一个版本。</p> 
</blockquote> 
<pre><code># helm rollback &lt;RELEASE&gt; [REVISION] [flags]
# 先查看历史版本
helm history myharbor -n harbor
# 不指定版本就回退上个版本
helm rollback myharbor 1 -n harbor
helm rollback myharbor -n harbor
</code></pre> 
<h3>十、展示 chart（helm show）</h3> 
<pre><code># helm show all [CHART] [flags]
# 该命令检查chart(目录、文件或URL)并显示所有的内容（values.yaml, Chart.yaml, README）
helm show all mysql

# helm show values [CHART] [flags]
# 该命令检查chart(目录、文件或URL)并显示values.yaml文件的内容
helm show values mysql
</code></pre> 
<h2>十一、拉取 chart（helm pull）</h2> 
<p>从仓库下载并（可选）在本地目录解压。</p> 
<pre><code># helm pull [chart URL | repo/chartname] [...] [flags]
# 仅下载
helm pull bitnami/redis
# 下载并解压到当前目录
helm pull bitnami/redis --untar</code></pre> 
<h2>十二、Helm 打包（helm package）</h2> 
<ul><li> <p><strong>将 chart 目录打包到 chart 归档中</strong>，该命令将 chart 打包成一个 chart 版本包文件。如果给定路径，就会在该路径中查找 chart（必须包含 Chart.yaml 文件）然后将目录打包。</p> </li><li> <p>要签名一个 chart，使用<code>--sign</code>参数，在大多数场景中，也要提供<code>--keyring path/to/secret/keys</code>和<code>--key keyname</code>。</p> </li></ul> 
<pre><code>helm package mysql/
# Successfully packaged chart and saved it to: /opt/k8s/helm/mysql-9.3.1.tgz
</code></pre> 
<blockquote> 
 <p>如果<strong>想忽略 helm 中的文件</strong>，可以在<code>.helmignore</code>进行匹配，该.helmignore 文件支持 Unix shell 全局匹配，相对路径匹配和否定（以！前缀反向匹配）。每行仅考虑一种模式。示例如下：</p> 
</blockquote> 
<pre><code># .helmignore
.git
*/temp*
*/*/temp*
temp?
</code></pre> 
<h2>十三、推送 chart 到 harbor（helm cm-push）</h2> 
<blockquote> 
 <p>将 chart 推送到远程。</p> 
</blockquote> 
<h4>1）在线安装</h4> 
<pre><code>helm plugin install https://github.com/chartmuseum/helm-push
</code></pre> 
<h4>2）离线安装</h4> 
<p>下载地址：https://github.com/chartmuseum/helm-push/tags</p> 
<pre><code># 1、下载安装包
wget https://github.com/chartmuseum/helm-push/releases/tag/v0.10.3

# 2、查看helm的plugin路径：helm env
helm env

# 3、在该路径下创建helm-push文件夹，并将安装包拷贝到该文件夹下解压即可
mkdir /root/.local/share/helm/plugins/helm-push

wget https://github.com/chartmuseum/helm-push/releases/download/v0.10.3/helm-push_0.10.3_linux_amd64.tar.gz

tar zxvf /root/.local/share/helm/plugins/helm-push/helm-push_0.10.3_linux_amd64.tar.gz -C /root/.local/share/helm/plugins/helm-push
</code></pre> 
<p>查看插件</p> 
<pre><code>helm plugin list
</code></pre> 
<h4>3）helm 增加 harbor repo</h4> 
<pre><code># chartrepo，固定参数，bigdata自定义项目
helm repo add local-harbor --username=admin --password=Harbor12345 https://myharbor.com/chartrepo/bigd</code></pre> 
<p> 证书直接在 harbor 上下载</p> 
<p> <img alt="" height="312" src="https://images2.imgbox.com/2a/3e/9cU9an4j_o.png" width="823"> </p> 
<p></p> 
<h4>4）示例演示</h4> 
<pre><code># 查看帮助
helm cm-push --help

# 推送，接【目录】
helm cm-push mysql/ local-harbor --ca-file /opt/k8s/helm/ca.crt

# 推送，接【压缩包】
helm cm-push wordpress-15.1.5.tgz local-harbor --ca-file /opt/k8s/helm/ca.crt

# 推送，指定版本，--version
helm cm-push mychart/ --version="1.2.3" local-harbor --ca-file /opt/k8s/helm/ca.crt

# 强制推送，--force
helm cm-push --force mychart-0.3.2.tgz local-harbor
</code></pre> 
<p>查看</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/47/e5/aguOyVgd_o.png"></p> 
<h2>十四、搜索 hub（helm search hub）</h2> 
<p>在Artifact Hub或自己的 hub 实例中搜索 chart。</p> 
<p><code>Artifact Hub</code> 是<strong>基于 web 页面的应用</strong>，支持 CNCF 项目的查找、安装和发布包及配置项，包括了公开发布的 Helm chart。它是 CNCF 的沙盒项目。可以访问https://artifacthub.io/</p> 
<pre><code># 不带参数，列出所有
helm search hub

# 指定chart
helm search hub mysql
</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a0/f9/sPI8dFhl_o.png"></p> 
<h2>十五、搜索仓库（helm search repo）</h2> 
<blockquote> 
 <p>用 chart 中关键字搜索仓库，搜索会读取系统上配置的所有仓库，并查找匹配。搜索这些仓库会使用存储在系统中的元数据。它会展示找到<strong>最新稳定版本的 chart</strong>。如果指定了<code>--devel</code>参数，输出会包括预发布版本。</p> 
</blockquote> 
<pre><code># Search for stable release versions matching the keyword "nginx"
$ helm search repo nginx

# Search for release versions matching the keyword "nginx", including pre-release versions
$ helm search repo nginx --devel

# Search for the latest stable release for nginx-ingress with a major version of 1
$ helm search repo nginx-ingress --version ^1.0.0
</code></pre> 
<h2>十六、验证 chart（helm lint）</h2> 
<blockquote> 
 <p>该命令使用一个 chart 路径并运行一系列的<strong>测试来验证 chart 的格式是否正确</strong>。如果遇到引起 chart 安装失败的情况，会触发[ERROR]信息，如果遇到违反惯例或建议的问题，会触发[WARNING]。</p> 
</blockquote> 
<pre><code># helm lint PATH [flags]
helm lint ./mysql
</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e6/37/ydQrl3Vf_o.png"></p> 
<h2>十七、常用命令总结</h2> 
<pre><code>helm version                            // 查看helm版本
helm create xxx                         // 创建一个xxx charts
helm lint ./xxx                         // 检查包的格式或信息是否有问题
helm install xxx1 ./xxx                 // 部署安装xxx，设置名称为xxx1
helm list                               // 列出已经部署的charts
helm history                            // 发布历史
helm upgrade                            // 更新版本
helm rollback                           // 回滚版本
helm package ./xxx                      // 打包charts
helm repo add --username admin --password password myharbor xxx  // 增加repo
helm uninstall xxx1                     // 卸载删除xxx1
helm pull                                // 拉取chart包
helm cm-push                            // 推送chart包
helm repo update                        // 更新仓库资源
helm search hub                         // 从 Artifact Hub 中查找并列出 helm charts。Artifact Hub中存放了大量不同的仓库
helm search repo                        // 从你添加（使用 helm repo add）到本地 helm 客户端中的仓库中进</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1c2d5620d182311858ef92e8b82856c1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">K8S的安全机制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cd15f40639760aa804554e0ea47cc783/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Hive配置参数解释</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>