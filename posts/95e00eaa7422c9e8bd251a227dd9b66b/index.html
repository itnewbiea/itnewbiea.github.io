<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uniapp中sqlite数据库常用操作的简单封装 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uniapp中sqlite数据库常用操作的简单封装" />
<meta property="og:description" content="参考HTML5联盟
SQLite模块用于操作本地数据库文件，可实现数据库文件的创建，执行SQL语句等功能。
// 监听数据是否打开 function isOpenDB(name, path = &#34;&#34;) { let dbName = name; let dbPath = path || `_doc/${name}.db`; //数据库打开了就返回true,否则返回false let isopen = plus.sqlite.isOpenDatabase({ name: dbName, path: dbPath }) return isopen } // 创建数据库/打开数据库 function openDB(name, path = &#34;&#34;) { return new Promise((resolve, reject) =&gt; { plus.sqlite.openDatabase({ name: name || &#39;test&#39;, path: path || `_doc/${name}.db`, success: async function(res) { let a = await closeDB(name) resolve(&#39;success!&#39;) }, fail: async (e) =&gt;{ let a = await closeDB(name) console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/95e00eaa7422c9e8bd251a227dd9b66b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-09T10:38:33+08:00" />
<meta property="article:modified_time" content="2022-06-09T10:38:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uniapp中sqlite数据库常用操作的简单封装</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>参考<a href="https://www.html5plus.org/doc/zh_cn/sqlite.html" rel="nofollow">HTML5联盟</a></p> 
<blockquote> 
 <p>SQLite模块用于操作本地数据库文件，可实现数据库文件的创建，执行SQL语句等功能。</p> 
</blockquote> 
<pre><code class="prism language-javascript"><span class="token comment">// 监听数据是否打开</span>
<span class="token keyword">function</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span> dbName <span class="token operator">=</span> name<span class="token punctuation">;</span>
	<span class="token keyword">let</span> dbPath <span class="token operator">=</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
	<span class="token comment">//数据库打开了就返回true,否则返回false</span>
	<span class="token keyword">let</span> isopen <span class="token operator">=</span> plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">isOpenDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
		<span class="token literal-property property">path</span><span class="token operator">:</span> dbPath
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">return</span> isopen
<span class="token punctuation">}</span>
<span class="token comment">// 创建数据库/打开数据库</span>
<span class="token keyword">function</span> <span class="token function">openDB</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> name <span class="token operator">||</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
			<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
			<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'success!'</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
				<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
				<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 查询所有数据库表名</span>
<span class="token keyword">function</span> <span class="token function">queryDBTable</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
				<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token string">"select * FROM sqlite_master where type='table'"</span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> name <span class="token operator">||</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
				<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
						<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token string">"select * FROM sqlite_master where type='table'"</span><span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
							<span class="token function">resolve</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
							console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
					
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>


	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 创建表
 * data={dbname,tablename,describe}
 */</span>
<span class="token keyword">function</span> <span class="token function">createTable</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">// 注意：tabName不能用数字作为表格名的开头</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>dbname <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>tablename <span class="token operator">&amp;&amp;</span> data<span class="token punctuation">.</span>describe<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">let</span> <span class="token punctuation">{<!-- --></span>
				dbname<span class="token punctuation">,</span>
				tablename<span class="token punctuation">,</span>
				describe
			<span class="token punctuation">}</span> <span class="token operator">=</span> data
			<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>dbname<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> dbname<span class="token punctuation">,</span>
					<span class="token comment">// sql: 'create table if not exists dataList("list" INTEGER PRIMARY KEY AUTOINCREMENT,"id" TEXT,"name" TEXT,"gender" TEXT,"avatar" TEXT)',</span>
					<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">create table if not exists </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tablename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>describe<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbname<span class="token punctuation">)</span>
						<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">创建表</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tablename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">完成</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbname<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> dbname<span class="token punctuation">,</span>
					<span class="token literal-property property">path</span><span class="token operator">:</span> data<span class="token punctuation">.</span>path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>dbname<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">name</span><span class="token operator">:</span> dbname<span class="token punctuation">,</span>
							<span class="token comment">// sql: 'create table if not exists dataList("list" INTEGER PRIMARY KEY AUTOINCREMENT,"id" TEXT,"name" TEXT,"gender" TEXT,"avatar" TEXT)',</span>
							<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">create table if not exists </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tablename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>describe<span class="token punctuation">)</span> <span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
							<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbname<span class="token punctuation">)</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">创建表</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tablename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">完成</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
							<span class="token function-variable function">fail</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbname<span class="token punctuation">)</span>
								<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbname<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'打开数据库失败： '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"参数不满足条件"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 查询表是否存在</span>
<span class="token keyword">function</span> <span class="token function">isTable</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> tabName<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
				<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select count(*) as isTable FROM sqlite_master where type='table' and name='</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tabName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isTable <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>

				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
				<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span>  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
						<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select count(*) as isTable FROM sqlite_master where type='table' and name='</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tabName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">'</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
							<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>isTable <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>

						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'failed: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>

				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 添加数据
 * @param {String} name
 * @param {String} tabName
 * @param {Object} obj
 */</span>
<span class="token keyword">function</span> <span class="token function">addSaveData</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> tabName<span class="token punctuation">,</span> obj<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">let</span> keys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
			<span class="token keyword">let</span> keyStr <span class="token operator">=</span> keys<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token keyword">let</span> valStr <span class="token operator">=</span> <span class="token string">''</span>
			keys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>keys<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">==</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					valStr <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'"'</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'"'</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
					valStr <span class="token operator">+=</span> <span class="token punctuation">(</span><span class="token string">'"'</span> <span class="token operator">+</span> obj<span class="token punctuation">[</span>item<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'",'</span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token comment">// console.log(valStr)</span>
			<span class="token keyword">let</span> sqlStr <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">insert into </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tabName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>keyStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">) values(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>valStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">)</span><span class="token template-punctuation string">`</span></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sqlStr<span class="token punctuation">)</span>
			<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
					<span class="token literal-property property">sql</span><span class="token operator">:</span> sqlStr<span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>

						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
					<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
							<span class="token literal-property property">sql</span><span class="token operator">:</span> sqlStr<span class="token punctuation">,</span>
							<span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
							<span class="token function-variable function">fail</span><span class="token operator">:</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
								<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>

					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">'failed: '</span> <span class="token operator">+</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>


		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * 简单查询，selectSql为复杂查询
 * @param {String} name
 * @param {String} tabName
 * @param {Object} setData 
 * @param {String} byName 排序值
 * @param {String} byType 正序倒序
 */</span>
<span class="token keyword">function</span> <span class="token function">selectDataList</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> tabName<span class="token punctuation">,</span> setData<span class="token punctuation">,</span> byName<span class="token punctuation">,</span> byType<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span> setStr <span class="token operator">=</span> <span class="token string">''</span>
	<span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">''</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'{}'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">let</span> dataKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span>
		dataKeys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>setData<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span>
			setStr <span class="token operator">+=</span> <span class="token punctuation">(</span>
				<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>setData<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>dataKeys<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">!==</span> index <span class="token operator">?</span> <span class="token string">" and "</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tabName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> where </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>setStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tabName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">}</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>byName <span class="token operator">&amp;&amp;</span> byType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// desc asc</span>
		sql <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> order by </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>byName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>byType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">}</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span>

	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>tabName <span class="token operator">!==</span> <span class="token keyword">undefined</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
					<span class="token literal-property property">sql</span><span class="token operator">:</span> sql<span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> name <span class="token operator">||</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
					<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
							<span class="token literal-property property">sql</span><span class="token operator">:</span> sql<span class="token punctuation">,</span>
							<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
							<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
								console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
								<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>

					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">// 获取数据库分页数据</span>
<span class="token comment">/**
 * 
 * @param {*} name 
 * @param {*} tabName 
 * @param {*} num 页码
 * @param {*} size 页面大小返回条数
 * @param {*} byName 排序主键字段
 * @param {*} byType 排序类型 desc倒序 / asc正序
 */</span>
<span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">queryDataList</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> tabName<span class="token punctuation">,</span> num<span class="token punctuation">,</span> size<span class="token punctuation">,</span> byName<span class="token punctuation">,</span> byType<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">let</span> count <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">let</span> sql <span class="token operator">=</span> <span class="token string">''</span>
	<span class="token keyword">let</span> numindex <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token keyword">await</span> <span class="token function">queryCount</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> tabName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resNum</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		count <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">ceil</span><span class="token punctuation">(</span>resNum<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>num <span class="token operator">/</span> size<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		numindex <span class="token operator">=</span> <span class="token number">0</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		numindex <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> size<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span>
	<span class="token punctuation">}</span>
	sql <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">select * from </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tabName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>byName <span class="token operator">&amp;&amp;</span> byType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// desc asc</span>
		sql <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> order by </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>byName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>byType<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
	<span class="token punctuation">}</span>
	sql <span class="token operator">+=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string"> limit </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>numindex<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>size<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>count <span class="token operator">&lt;</span> num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"无数据"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
					<span class="token comment">// sql: "select * from userInfo limit 3 offset 3",</span>
					<span class="token literal-property property">sql</span><span class="token operator">:</span> sql<span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
					<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
							<span class="token comment">// sql: "select * from userInfo limit 3 offset 3",</span>
							<span class="token literal-property property">sql</span><span class="token operator">:</span> sql<span class="token punctuation">,</span>
							<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
							<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
								<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token comment">// 查询表数据总条数</span>
<span class="token keyword">function</span> <span class="token function">queryCount</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> tabName<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
				<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token string">"select count(*) as num from "</span> <span class="token operator">+</span> tabName<span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
				<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
						<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token string">"select count(*) as num from "</span> <span class="token operator">+</span> tabName<span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
							<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span>

				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 修改（更新）数据</span>
<span class="token comment">// 示例：UPDATE COMPANY SET ADDRESS = 'Texas' WHERE ID = 6;</span>
<span class="token comment">// UPDATE 表名 SET 要修改字段 = '修改内容' WHERE 筛选条件 = 6;</span>
<span class="token comment">/**
 * 简单更新
 * @param {*} name 数据库名
 * @param {*} tabName 表名
 * @param {*} setData 设置值 （修改字段 + 修改内容）
 * @param {*} setName 筛选条件
 * @param {*} setVal 筛选值
 * @returns 
 */</span>
<span class="token keyword">function</span> <span class="token function">updateSqlData</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> tabName<span class="token punctuation">,</span> setData<span class="token punctuation">,</span> setName<span class="token punctuation">,</span> setVal<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token string">'{}'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">let</span> dataKeys <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>setData<span class="token punctuation">)</span>
			<span class="token keyword">let</span> setStr <span class="token operator">=</span> <span class="token string">''</span>
			dataKeys<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// console.log(item, setData[item])</span>
				setStr <span class="token operator">+=</span> <span class="token punctuation">(</span>
					<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>item<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>setData<span class="token punctuation">[</span>item<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>dataKeys<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">!==</span> index <span class="token operator">?</span> <span class="token string">","</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
				<span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span>
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>setStr<span class="token punctuation">)</span>
			<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
					<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">update </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tabName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> set </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>setStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> where </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>setName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>setVal<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
					<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
					<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>name<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
					<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
							<span class="token literal-property property">name</span><span class="token operator">:</span> name<span class="token punctuation">,</span>
							<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">update </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>tabName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> set </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>setStr<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> where </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>setName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> = "</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>setVal<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">"</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
							<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
								<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span><span class="token punctuation">,</span>
							<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
								<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
								<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
							<span class="token punctuation">}</span>
						<span class="token punctuation">}</span><span class="token punctuation">)</span>

					<span class="token punctuation">}</span><span class="token punctuation">,</span>
					<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
						<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
						<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			<span class="token function">reject</span><span class="token punctuation">(</span><span class="token string">"错误"</span><span class="token punctuation">)</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">//删除表</span>
<span class="token keyword">function</span> <span class="token function">deleteTable</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> table<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">let</span> isOpen <span class="token operator">=</span> <span class="token function">isOpenDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>isOpen<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
				<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">DROP TABLE </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>table<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">删除表 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>table<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，成功</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//如果数据库存在则打开，不存在则创建。</span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
				<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>dbName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库打开成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">//执行 增\删\改 操作的SQL语句</span>
					plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
						<span class="token literal-property property">sql</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">DROP TABLE </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>table<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
							<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">删除表 </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>table<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">，成功</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * @param {Object} dbName
 * @param {Object} dbsql 执行 增\删\改 操作的SQL语句
 */</span>
<span class="token keyword">function</span> <span class="token function">executeSql</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> dbsql<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dbsql<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// //判断数据库是否打开</span>
		<span class="token keyword">let</span> bool <span class="token operator">=</span> plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">isOpenDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
			<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>dbName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
				<span class="token literal-property property">sql</span><span class="token operator">:</span> dbsql<span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//如果数据库存在则打开，不存在则创建。</span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
				<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>dbName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库打开成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">//执行 增\删\改 操作的SQL语句</span>
					console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dbsql<span class="token punctuation">)</span><span class="token punctuation">;</span>
					plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">executeSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
						<span class="token literal-property property">sql</span><span class="token operator">:</span> dbsql<span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
							<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 * @param {Object} dbName
 * @param {Object} selectNcDuli
 */</span>
<span class="token keyword">function</span> <span class="token function">selectSql</span><span class="token punctuation">(</span>dbName<span class="token punctuation">,</span> selectNcDuli<span class="token punctuation">,</span> path <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">let</span> bool <span class="token operator">=</span> plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">isOpenDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
			<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>dbName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span>
		console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
				<span class="token literal-property property">sql</span><span class="token operator">:</span> selectNcDuli<span class="token punctuation">,</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
			plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">openDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
				<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span> <span class="token comment">//这里是数据库的名称</span>
				<span class="token literal-property property">path</span><span class="token operator">:</span> path <span class="token operator">||</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">_doc/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${<!-- --></span>dbName<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">.db</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token comment">//_doc是相对路径的应用私有文档目录</span>
				<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token comment">//查询数据</span>
					plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">selectSql</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
						<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
						<span class="token literal-property property">sql</span><span class="token operator">:</span> selectNcDuli<span class="token punctuation">,</span>
						<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
							<span class="token function">resolve</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
						<span class="token punctuation">}</span><span class="token punctuation">,</span>
						<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
							<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
							<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">,</span>
				<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
					<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">closeDB</span><span class="token punctuation">(</span>dbName<span class="token punctuation">)</span>
					<span class="token function">reject</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">//关闭数据库</span>
<span class="token keyword">function</span> <span class="token function">closeDB</span><span class="token punctuation">(</span><span class="token parameter">dbName</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
		plus<span class="token punctuation">.</span>sqlite<span class="token punctuation">.</span><span class="token function">closeDatabase</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
			<span class="token literal-property property">name</span><span class="token operator">:</span> dbName<span class="token punctuation">,</span>
			<span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库关闭成功'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">resolve</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span>
			<span class="token function-variable function">fail</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'数据库关闭失败'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token function">reject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> db <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	openDB<span class="token punctuation">,</span>
	closeDB<span class="token punctuation">,</span>
	isOpenDB<span class="token punctuation">,</span>
	queryDBTable<span class="token punctuation">,</span>
	createTable<span class="token punctuation">,</span>
	isTable<span class="token punctuation">,</span>
	deleteTable<span class="token punctuation">,</span>
	addSaveData<span class="token punctuation">,</span>
	selectDataList<span class="token punctuation">,</span>
	queryCount<span class="token punctuation">,</span>
	updateSqlData<span class="token punctuation">,</span>
	queryDataList<span class="token punctuation">,</span>
	executeSql<span class="token punctuation">,</span>
	selectSql<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6b840ef63f72a35d206d07bed8fe378/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">机器视觉——相机标定</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/65596101b5a34e5d80f2ec5a349d28c5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">netty源码之Channel：注重NioServerSockerChannel和NioSocketChannel</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>