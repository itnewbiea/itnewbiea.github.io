<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>原生php导出csv格式的Excel文件 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="原生php导出csv格式的Excel文件" />
<meta property="og:description" content="效果图 源码分析 index.php
&lt;?php require_once &#34;./Export.php&#34;; //测试数据 $headerList= [&#39;列名1&#39;,&#39;列名2&#39;,&#39;列名3&#39;]; $data = [ [&#39;值1&#39;,&#39;值2&#39;,&#39;值3&#39;], [&#39;值11&#39;,&#39;值22&#39;,&#39;值33&#39;], [&#39;值111&#39;,&#39;值222&#39;,&#39;值333&#39;] ]; $fileName = &#34;测试导出文件名&#34;; $tmp = [&#39;备份字段1&#39;,&#39;备份值1&#39;,&#39;&#39;,&#39;备份字段2&#39;,&#39;备份值2&#39;]; $export = new Export(); $result = $export-&gt;exportToCsv($headerList,$data,$fileName,$tmp); Export.php
&lt;?php class export{ /** * params $headerList 头部列表信息(一维数组) 必传 * params $data 导出的数据(二维数组) 必传 * params $filename 文件名称转码 必传 * params $tmp 备用信息(二维数组) 选传 * PS:出现数字格式化情况，可添加看不见的符号，使其正常，如:&#34;\t&#34; **/ public function exportToCsv($headerList = [] , $data = [] , $fileName = &#39;&#39; , $tmp = []){ //文件名称转码 $fileName = iconv(&#39;UTF-8&#39;, &#39;GBK&#39;, $fileName); //设置header头 header(&#39;Content-Type: application/vnd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e99ed3a3ec18d95bf4dc853b320ff68a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-09T10:57:30+08:00" />
<meta property="article:modified_time" content="2018-08-09T10:57:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">原生php导出csv格式的Excel文件</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4 id="效果图">效果图</h4> 
<p><img src="https://images2.imgbox.com/12/ff/iIgQWzEf_o.png" alt="这里写图片描述" title=""></p> 
<h4 id="源码分析">源码分析</h4> 
<p><strong>index.php</strong></p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-keyword">require_once</span> <span class="hljs-string">"./Export.php"</span>;
<span class="hljs-comment">//测试数据</span>
<span class="hljs-variable">$headerList</span>= [<span class="hljs-string">'列名1'</span>,<span class="hljs-string">'列名2'</span>,<span class="hljs-string">'列名3'</span>];
<span class="hljs-variable">$data</span> = [
    [<span class="hljs-string">'值1'</span>,<span class="hljs-string">'值2'</span>,<span class="hljs-string">'值3'</span>],
    [<span class="hljs-string">'值11'</span>,<span class="hljs-string">'值22'</span>,<span class="hljs-string">'值33'</span>],
    [<span class="hljs-string">'值111'</span>,<span class="hljs-string">'值222'</span>,<span class="hljs-string">'值333'</span>]
];
<span class="hljs-variable">$fileName</span> = <span class="hljs-string">"测试导出文件名"</span>;
<span class="hljs-variable">$tmp</span> = [<span class="hljs-string">'备份字段1'</span>,<span class="hljs-string">'备份值1'</span>,<span class="hljs-string">''</span>,<span class="hljs-string">'备份字段2'</span>,<span class="hljs-string">'备份值2'</span>];
<span class="hljs-variable">$export</span> = <span class="hljs-keyword">new</span> Export();
<span class="hljs-variable">$result</span> = <span class="hljs-variable">$export</span>-&gt;exportToCsv(<span class="hljs-variable">$headerList</span>,<span class="hljs-variable">$data</span>,<span class="hljs-variable">$fileName</span>,<span class="hljs-variable">$tmp</span>);</span></code></pre> 
<p><strong>Export.php</strong></p> 
<pre class="prettyprint"><code class=" hljs php"><span class="hljs-preprocessor">&lt;?php</span>
<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">export</span>{<!-- --></span>
    <span class="hljs-comment">/**
     * params $headerList 头部列表信息(一维数组) 必传
     * params $data 导出的数据(二维数组)    必传
     * params $filename 文件名称转码 必传
     * params $tmp 备用信息(二维数组) 选传
     * PS:出现数字格式化情况，可添加看不见的符号，使其正常，如:"\t"
     **/</span>
    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exportToCsv</span><span class="hljs-params">(<span class="hljs-variable">$headerList</span> = [] , <span class="hljs-variable">$data</span> = [] , <span class="hljs-variable">$fileName</span> = <span class="hljs-string">''</span> , <span class="hljs-variable">$tmp</span> = [])</span>{<!-- --></span>
        <span class="hljs-comment">//文件名称转码</span>
        <span class="hljs-variable">$fileName</span> = iconv(<span class="hljs-string">'UTF-8'</span>, <span class="hljs-string">'GBK'</span>, <span class="hljs-variable">$fileName</span>);
        <span class="hljs-comment">//设置header头</span>
        header(<span class="hljs-string">'Content-Type: application/vnd.ms-excel'</span>);
        header(<span class="hljs-string">'Content-Disposition: attachment;filename='</span> . <span class="hljs-variable">$fileName</span> . <span class="hljs-string">'.csv'</span>);
        header(<span class="hljs-string">'Cache-Control: max-age=0'</span>);
        <span class="hljs-comment">//打开PHP文件句柄,php://output,表示直接输出到浏览器</span>
        <span class="hljs-variable">$fp</span> = fopen(<span class="hljs-string">"php://output"</span>,<span class="hljs-string">"a"</span>);
        <span class="hljs-comment">//备用信息</span>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$tmp</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) {
            <span class="hljs-variable">$tmp</span>[<span class="hljs-variable">$key</span>] = iconv(<span class="hljs-string">"UTF-8"</span>, <span class="hljs-string">'GBK'</span>, <span class="hljs-variable">$value</span>);
        }
        <span class="hljs-comment">//使用fputcsv将数据写入文件句柄</span>
        fputcsv(<span class="hljs-variable">$fp</span>, <span class="hljs-variable">$tmp</span>);
        <span class="hljs-comment">//输出Excel列表名称信息</span>
        <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$headerList</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) {
            <span class="hljs-variable">$headerList</span>[<span class="hljs-variable">$key</span>] = iconv(<span class="hljs-string">'UTF-8'</span>, <span class="hljs-string">'GBK'</span>, <span class="hljs-variable">$value</span>);<span class="hljs-comment">//CSV的EXCEL支持BGK编码，一定要转换，否则乱码</span>
        }
        <span class="hljs-comment">//使用fputcsv将数据写入文件句柄</span>
        fputcsv(<span class="hljs-variable">$fp</span>, <span class="hljs-variable">$headerList</span>);
        <span class="hljs-comment">//计数器</span>
        <span class="hljs-variable">$num</span> = <span class="hljs-number">0</span>;
        <span class="hljs-comment">//每隔$limit行，刷新一下输出buffer,不要太大亦不要太小</span>
        <span class="hljs-variable">$limit</span> = <span class="hljs-number">100000</span>;
        <span class="hljs-comment">//逐行去除数据,不浪费内存</span>
        <span class="hljs-variable">$count</span> = count(<span class="hljs-variable">$data</span>);
        <span class="hljs-keyword">for</span>(<span class="hljs-variable">$i</span> = <span class="hljs-number">0</span> ; <span class="hljs-variable">$i</span> &lt; <span class="hljs-variable">$count</span> ; <span class="hljs-variable">$i</span>++){
            <span class="hljs-variable">$num</span>++;
            <span class="hljs-comment">//刷新一下输出buffer，防止由于数据过多造成问题</span>
            <span class="hljs-keyword">if</span>(<span class="hljs-variable">$limit</span> == <span class="hljs-variable">$num</span>){
                ob_flush();
                flush();
                <span class="hljs-variable">$num</span> = <span class="hljs-number">0</span>;
            }
            <span class="hljs-variable">$row</span> = <span class="hljs-variable">$data</span>[<span class="hljs-variable">$i</span>];
            <span class="hljs-keyword">foreach</span> (<span class="hljs-variable">$row</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$key</span> =&gt; <span class="hljs-variable">$value</span>) {
                <span class="hljs-variable">$row</span>[<span class="hljs-variable">$key</span>] = iconv(<span class="hljs-string">'UTF-8'</span>, <span class="hljs-string">'GBK'</span>, <span class="hljs-variable">$value</span>);
            }
            fputcsv(<span class="hljs-variable">$fp</span>, <span class="hljs-variable">$row</span>);
        }
    }
}</code></pre> 
<p>链接：<a href="https://pan.baidu.com/s/1e9BK6l5fY4aDDgYS7CLUig" rel="nofollow">https://pan.baidu.com/s/1e9BK6l5fY4aDDgYS7CLUig</a> 密码：v120</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1c834f08d83445a59316a0c04a2b5bb0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL之将查询结果生成新表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/44ef9147fcfdf1abe0d8609fd4ce2b43/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">今天在做微信分享功能的时候，遇到项目部署后出现 config:invalid url domain 弹窗提示的解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>