<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java，excel大量百万数据导出优化措施，SXSSFWorkbook流式、分批次导出示例 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java，excel大量百万数据导出优化措施，SXSSFWorkbook流式、分批次导出示例" />
<meta property="og:description" content="在导出百万级的数据时，如果不采用适当的优化措施，确实可能会造成死机和内存崩溃等问题。
为避免这些问题，可以采用以下优化措施：
分批次读取数据：将需要导出的数据分成多个批次进行读取和写入，每次读取部分数据，写入 Excel 后即时清除内存。这样可以避免一次性加载全部数据导致内存占用过大的问题。使用流式写入方式：在遍历结果集的同时，使用流式写入方式（如 SXSSF）将数据写入 Excel 表格中，避免一次性将所有数据都写入内存中。关闭不必要的连接：在写代码时应当及时关闭 ResultSet、Statement 和 Connection 连接，以释放资源，减轻系统负担。使用合适的服务器硬件配置: 导出数据量较大的情况下，建议使用高性能的服务器，如配备更多的 CPU和内存， 以提高系统处理能力和速度。合理设置 JVM 内存分配：如果 JVM 内存分配不合理，则可能会导致内存溢出等问题。可以通过调整-Xmx、-Xms 等参数，来合理设置 JVM 的内存分配。 在 pom.xml 文件中添加以下依赖：
&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi&lt;/artifactId&gt; &lt;version&gt;4.1.2&lt;/version&gt; &lt;/dependency&gt; &lt;dependency&gt; &lt;groupId&gt;org.apache.poi&lt;/groupId&gt; &lt;artifactId&gt;poi-ooxml&lt;/artifactId&gt; &lt;version&gt;4.1.2&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; public void exportExcel() throws Exception{ // 加载驱动程序 Class.forName(&#34;com.mysql.cj.jdbc.Driver&#34;); // 连接数据库 Connection conn = DriverManager.getConnection(url, username, password); // 查询语句 String sql = &#34;SELECT * FROM user&#34;; Statement stmt = conn.createStatement(); ResultSet rs = null; // 创建一个 Excel 文档 SXSSFWorkbook workbook = new SXSSFWorkbook(100); try { // 设置表格格式 Sheet sheet = workbook." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6c78ec925bf396e609bdb9c8e3eaf3e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-25T06:30:00+08:00" />
<meta property="article:modified_time" content="2023-04-25T06:30:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java，excel大量百万数据导出优化措施，SXSSFWorkbook流式、分批次导出示例</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;"><span style="color:rgba(0,0,0,.87);"><span style="background-color:#ffffff;">在导出百万级的数据时，如果不采用适当的优化措施，确实可能会造成死机和内存崩溃等问题。</span></span></p> 
<p style="margin-left:0;"><span style="color:rgba(0,0,0,.87);"><span style="background-color:#ffffff;">为避免这些问题，可以采用以下优化措施：</span></span></p> 
<ol style="margin-left:0;"><li>分批次读取数据：将需要导出的数据分成多个批次进行读取和写入，每次读取部分数据，写入 Excel 后即时清除内存。这样可以避免一次性加载全部数据导致内存占用过大的问题。</li><li>使用流式写入方式：在遍历结果集的同时，使用流式写入方式（如 SXSSF）将数据写入 Excel 表格中，避免一次性将所有数据都写入内存中。</li><li>关闭不必要的连接：在写代码时应当及时关闭 ResultSet、Statement 和 Connection 连接，以释放资源，减轻系统负担。</li><li>使用合适的服务器硬件配置: 导出数据量较大的情况下，建议使用高性能的服务器，如配备更多的 CPU和内存， 以提高系统处理能力和速度。</li><li>合理设置 JVM 内存分配：如果 JVM 内存分配不合理，则可能会导致内存溢出等问题。可以通过调整-Xmx、-Xms 等参数，来合理设置 JVM 的内存分配。</li></ol> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><span style="color:rgba(0,0,0,.87);"><span style="background-color:#ffffff;">在 pom.xml 文件中添加以下依赖：</span></span></p> 
<p style="margin-left:0;"></p> 
<pre style="margin-left:0;"><span style="color:rgba(0,0,0,.87);"><span style="background-color:#ffffff;"><code class="language-xml"><span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>dependencies</strong></span>&gt;</span>
    <span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>dependency</strong></span>&gt;</span>
        <span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>groupId</strong></span>&gt;</span>org.apache.poi<span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>groupId</strong></span>&gt;</span>
        <span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>artifactId</strong></span>&gt;</span>poi<span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>artifactId</strong></span>&gt;</span>
        <span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>version</strong></span>&gt;</span>4.1.2<span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>version</strong></span>&gt;</span>
    <span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>dependency</strong></span>&gt;</span>
    <span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>dependency</strong></span>&gt;</span>
        <span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>groupId</strong></span>&gt;</span>org.apache.poi<span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>groupId</strong></span>&gt;</span>
        <span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>artifactId</strong></span>&gt;</span>poi-ooxml<span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>artifactId</strong></span>&gt;</span>
        <span style="color:rgba(68,68,68,.667);">&lt;<span style="color:#444444;"><strong>version</strong></span>&gt;</span>4.1.2<span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>version</strong></span>&gt;</span>
    <span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>dependency</strong></span>&gt;</span>
<span style="color:rgba(68,68,68,.667);">&lt;/<span style="color:#444444;"><strong>dependencies</strong></span>&gt;</span>
</code></span></span></pre> 
<pre style="margin-left:0;"><span style="color:rgba(0,0,0,.87);"><span style="background-color:#ffffff;"><code class="language-java"><span style="color:#a71d5d;"><strong>public</strong></span> <span style="color:#a71d5d;"><strong>void</strong></span> <span style="color:#880000;"><strong>exportExcel</strong></span>() <span style="color:#a71d5d;"><strong>throws</strong></span> Exception{
    <span style="color:#697070;">// 加载驱动程序</span>
    Class.forName(<span style="color:#880000;">"com.mysql.cj.jdbc.Driver"</span>);

    <span style="color:#697070;">// 连接数据库</span>
    <span style="color:#880000;">Connection</span> <span style="color:#ab5656;">conn</span> <span style="color:#ab5656;">=</span> DriverManager.getConnection(url, username, password);

    <span style="color:#697070;">// 查询语句</span>
    <span style="color:#880000;">String</span> <span style="color:#ab5656;">sql</span> <span style="color:#ab5656;">=</span> <span style="color:#880000;">"SELECT * FROM user"</span>;
    <span style="color:#880000;">Statement</span> <span style="color:#ab5656;">stmt</span> <span style="color:#ab5656;">=</span> conn.createStatement();
    <span style="color:#880000;">ResultSet</span> <span style="color:#ab5656;">rs</span> <span style="color:#ab5656;">=</span> <span style="color:#669955;">null</span>;

    <span style="color:#697070;">// 创建一个 Excel 文档</span>
    <span style="color:#880000;">SXSSFWorkbook</span> <span style="color:#ab5656;">workbook</span> <span style="color:#ab5656;">=</span> <span style="color:#a71d5d;"><strong>new</strong></span> <span style="color:#880000;"><strong>SXSSFWorkbook</strong></span>(<span style="color:#880000;">100</span>);

    <span style="color:#a71d5d;"><strong>try</strong></span> {
        <span style="color:#697070;">// 设置表格格式</span>
        <span style="color:#880000;">Sheet</span> <span style="color:#ab5656;">sheet</span> <span style="color:#ab5656;">=</span> workbook.createSheet(<span style="color:#880000;">"数据导出"</span>);
        <span style="color:#880000;">Row</span> <span style="color:#ab5656;">headerRow</span> <span style="color:#ab5656;">=</span> sheet.createRow(<span style="color:#880000;">0</span>);
        String[] headers = {<!-- --><span style="color:#880000;">"ID"</span>, <span style="color:#880000;">"姓名"</span>, <span style="color:#880000;">"年龄"</span>};
        <span style="color:#a71d5d;"><strong>for</strong></span> (<span style="color:#880000;">int</span> <span style="color:#ab5656;">i</span> <span style="color:#ab5656;">=</span> <span style="color:#880000;">0</span>; i &lt; headers.length; i++) {
            <span style="color:#880000;">Cell</span> <span style="color:#ab5656;">cell</span> <span style="color:#ab5656;">=</span> headerRow.createCell(i);
            cell.setCellValue(headers[i]);
        }
        
        <span style="color:#880000;">int</span> <span style="color:#ab5656;">rownum</span> <span style="color:#ab5656;">=</span> <span style="color:#880000;">1</span>;
        <span style="color:#a71d5d;"><strong>while</strong></span> (<span style="color:#669955;">true</span>) {
            rs = stmt.executeQuery(sql + <span style="color:#880000;">" LIMIT "</span> + rownum + <span style="color:#880000;">", 10000"</span>); <span style="color:#697070;">// 每次查询10000条数据</span>

            <span style="color:#a71d5d;"><strong>if</strong></span> (!rs.next()) { <span style="color:#697070;">// 数据已经读取完</span>
                rs.close();
                <span style="color:#a71d5d;"><strong>break</strong></span>;
            }

            <span style="color:#a71d5d;"><strong>do</strong></span> {
                <span style="color:#880000;">Row</span> <span style="color:#ab5656;">row</span> <span style="color:#ab5656;">=</span> sheet.createRow(rownum++);
                <span style="color:#880000;">String</span> <span style="color:#ab5656;">id</span> <span style="color:#ab5656;">=</span> rs.getString(<span style="color:#880000;">"id"</span>);
                <span style="color:#880000;">String</span> <span style="color:#ab5656;">name</span> <span style="color:#ab5656;">=</span> rs.getString(<span style="color:#880000;">"name"</span>);
                <span style="color:#880000;">String</span> <span style="color:#ab5656;">age</span> <span style="color:#ab5656;">=</span> rs.getString(<span style="color:#880000;">"age"</span>);

                row.createCell(<span style="color:#880000;">0</span>).setCellValue(id);
                row.createCell(<span style="color:#880000;">1</span>).setCellValue(name);
                row.createCell(<span style="color:#880000;">2</span>).setCellValue(age);
            } <span style="color:#a71d5d;"><strong>while</strong></span> (rs.next());

            ((SXSSFSheet) sheet).flushRows();
            ((SXSSFSheet) sheet).clearRowBreaks();
        }

        <span style="color:#697070;">// 保存 Excel 文件</span>
        <span style="color:#880000;">FileOutputStream</span> <span style="color:#ab5656;">out</span> <span style="color:#ab5656;">=</span> <span style="color:#a71d5d;"><strong>new</strong></span> <span style="color:#880000;"><strong>FileOutputStream</strong></span>(<span style="color:#880000;">"数据导出.xlsx"</span>);
        workbook.write(out);
        out.close();

    } <span style="color:#a71d5d;"><strong>finally</strong></span> {
        <span style="color:#697070;">// 关闭连接</span>
        <span style="color:#a71d5d;"><strong>if</strong></span> (rs != <span style="color:#669955;">null</span>) { rs.close(); }
        stmt.close();
        conn.close();

        <span style="color:#697070;">// 释放资源</span>
        workbook.dispose();
    }

}
</code></span></span></pre> 
<p style="margin-left:0;"><span style="color:rgba(0,0,0,.87);"><span style="background-color:#ffffff;">分批次读取数据、使用流式写入方式、设置合理的缓存大小以及关闭不必要的连接等优化措施，大大提高了代码效率和稳定性。同时也建议尽量避免在导出时一次性导出所有数据，对于百万级别的数据可以采用类似以上示例所示的方式进行分页导出。</span></span></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/eeaf7322e1168ed4e3a6ff9506f6cb74/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">互相关运算和卷积运算</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4b84173bbb344c03afada8a6ffbc9869/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【uni-app】uni-app实现聊天页面功能——功能篇（上）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>