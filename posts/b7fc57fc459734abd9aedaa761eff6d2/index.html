<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux下安装Nginx服务并设置开机自启动 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux下安装Nginx服务并设置开机自启动" />
<meta property="og:description" content="目录
一、安装Nginx
二、开机自启动服务配置
一、安装Nginx 系统平台：CentOS Linux release 7.9.2009 (Core) 64位
Nginx安装版本（liunx-64位）：nginx-1.20.2 .tar.gz 安装包下载地址
1、上传安装包
在/data下创建目录：/data/nginx/nginx 并把 nginx-1.20.2 .tar.gz 上传到此目录下
[root@MiWiFi-R3-srv /]# mkdir data
[root@MiWiFi-R3-srv /]# cd /data/
[root@MiWiFi-R3-srv data]# mkdir nginx
[root@MiWiFi-R3-srv data]# mkdir nginx/nginx
[root@MiWiFi-R3-srv data]# cd nginx/nginx
2、安装包解压
[root@MiWiFi-R3-srv nginx]# tar -zxvf nginx-1.20.2.tar.gz
3、进入安装包目录
[root@MiWiFi-R3-srv nginx]# cd nginx-1.20.2
4、编译及安装
查看pre版本及安装路径
[root@MiWiFi-R3-srv /]# pcre-config --version
[root@MiWiFi-R3-srv /]# rpm -ql pcre
配置configure执行配置命令
[root@MiWiFi-R3-srv nginx-1.20.2]# ./configure --prefix=/data/nginx/nginx --with-http_stub_status_module --with-http_ssl_module --with-pcre=/data/pcre/pcre-8.32" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b7fc57fc459734abd9aedaa761eff6d2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-10T16:58:53+08:00" />
<meta property="article:modified_time" content="2022-06-10T16:58:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux下安装Nginx服务并设置开机自启动</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85Nginx-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E5%AE%89%E8%A3%85Nginx" rel="nofollow">一、安装Nginx</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE" rel="nofollow">二、开机自启动服务配置</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2>一、安装Nginx</h2> 
<p> 系统平台：CentOS Linux release 7.9.2009 (Core) 64位</p> 
<p><img alt="" height="420" src="https://images2.imgbox.com/fe/94/1DImE9j2_o.png" width="1200"></p> 
<p>Nginx安装版本（liunx-64位）：nginx-1.20.2 .tar.gz <a class="link-info" href="http://nginx.org/download/" rel="nofollow" title="安装包下载地址">安装包下载地址</a></p> 
<p>1、上传安装包</p> 
<p>        在/data下创建目录：/data/nginx/nginx 并把 nginx-1.20.2 .tar.gz 上传到此目录下</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv /]# mkdir data<br> [root@MiWiFi-R3-srv /]# cd /data/<br> [root@MiWiFi-R3-srv data]# mkdir nginx<br> [root@MiWiFi-R3-srv data]# mkdir nginx/nginx<br> [root@MiWiFi-R3-srv data]# cd nginx/nginx</p> 
</blockquote> 
<p><img alt="" height="792" src="https://images2.imgbox.com/d5/64/ZBG9OktV_o.png" width="1200"></p> 
<p>2、安装包解压</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv nginx]# tar -zxvf nginx-1.20.2.tar.gz</p> 
</blockquote> 
<p><img alt="" height="680" src="https://images2.imgbox.com/b4/aa/1KB5hfdL_o.png" width="1200"></p> 
<p> 3、进入安装包目录</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv nginx]# cd nginx-1.20.2</p> 
</blockquote> 
<p><img alt="" height="481" src="https://images2.imgbox.com/a3/d0/v3CEwUUX_o.png" width="1198"></p> 
<p> 4、编译及安装</p> 
<p>查看pre版本及安装路径</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv /]# pcre-config --version</p> 
</blockquote> 
<p><img alt="" height="128" src="https://images2.imgbox.com/96/3d/krjuAvsc_o.png" width="1116"></p> 
<blockquote> 
 <p> [root@MiWiFi-R3-srv /]# rpm -ql pcre</p> 
</blockquote> 
<p><img alt="" height="406" src="https://images2.imgbox.com/ca/ee/KAvm2IPs_o.png" width="963"></p> 
<p>配置configure执行配置命令</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv nginx-1.20.2]# ./configure --prefix=/data/nginx/nginx --with-http_stub_status_module --with-http_ssl_module --with-pcre=/data/pcre/pcre-8.32</p> 
</blockquote> 
<p><img alt="" height="843" src="https://images2.imgbox.com/34/d2/yT2rKdSq_o.png" width="1200"></p> 
<p><img alt="" height="583" src="https://images2.imgbox.com/a4/25/XMZVdfqB_o.png" width="1173"></p> 
<p>编译及安装</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv nginx-1.20.2]# make &amp;&amp; make install</p> 
</blockquote> 
<p>出现以下几个文件说明安装成功</p> 
<p><img alt="" height="655" src="https://images2.imgbox.com/be/d7/6HyCmrgJ_o.png" width="1200"></p> 
<p> 查看Nginx版本</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv nginx-1.20.2]# cd /data/nginx/nginx/sbin<br> [root@MiWiFi-R3-srv sbin]# ./nginx -v</p> 
</blockquote> 
<p><img alt="" height="304" src="https://images2.imgbox.com/c5/34/QZzP8hWe_o.png" width="1027"></p> 
<p>启动nginx并查看进程</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv sbin]# ./nginx<br> [root@MiWiFi-R3-srv sbin]# ps -ef |grep nginx</p> 
</blockquote> 
<p><img alt="" height="170" src="https://images2.imgbox.com/57/6f/RkpTK2vm_o.png" width="842"></p> 
<p> <img alt="" height="537" src="https://images2.imgbox.com/b1/c0/hSMWXRUR_o.png" width="1191"></p> 
<p><span style="color:#fe2c24;"> </span>Nginx 常用的几个命令：</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv sbin]# ./nginx -s reload            # 重新载入配置文件<br> [root@MiWiFi-R3-srv sbin]# ./nginx -s reopen           # 重启 Nginx<br> [root@MiWiFi-R3-srv sbin]# ./nginx -s stop               # 停止 Nginx</p> 
</blockquote> 
<p><span style="color:#fe2c24;">注意：</span></p> 
<p><span style="color:#fe2c24;">问题1：当我们通过命令：rpm -ql pcre查找pcre安装目录是显示目录为/usr/share/doc/pcre-8.32<br> 在通过configurer配置nginx选项时，指定pcre目录为--with-pcre=/usr/share/doc/pcre-8.32，不会出错，但是make时就出现如下所示错误</span></p> 
<p><img alt="" height="114" src="https://images2.imgbox.com/22/9b/mTW6iU5M_o.png" width="1200"></p> 
<p><img alt="" height="287" src="https://images2.imgbox.com/b2/41/P6Y9V3tK_o.png" width="990"> <span style="color:#fe2c24;">这个错误的原因是通过--with-pcre是需要指定pcre的源码目录，而不是安装目录，如本pcre的源码目录是/data/pcre/pcre-8.32</span></p> 
<p><span style="color:#fe2c24;">问题2：安装完成Nginx后无法站外访问</span></p> 
<p>[root@MiWiFi-R3-srv ~]# telnet xxx.xxx.xx.xx 80 报：正在连接到192.168.0.xxx...不能打开到主机的连接， 在端口 80: 连接失败</p> 
<p>如果是以上的故障现象，很可能是被CentOS的防火墙把80端口拦住了，尝试执行以下命令，打开80端口就可以正常访问：</p> 
<blockquote> 
 <p>[root@MiWiFi-R3-srv ~]# iptables -I INPUT -p tcp --dport 80 -j ACCEPT</p> 
</blockquote> 
<p><img alt="" height="124" src="https://images2.imgbox.com/e8/85/vyYCjtg5_o.png" width="736"></p> 
<p> <span style="color:#fe2c24;">问题3：已经安装了openssl，但是执行 ./configure时还是一直报：./configure: error: SSL modules require the OpenSSL library.时报如下错误</span></p> 
<p> <img alt="" height="569" src="https://images2.imgbox.com/f5/ab/Ct8437ZP_o.png" width="1164"></p> 
<p>需要指定openssl的源码位置</p> 
<pre><code>[root@MiWiFi-R3-srv nginx-1.20.2]# ./configure --prefix=/data/nginx/nginx --with-http_stub_status_module --with-http_ssl_module --with-pcre=/data/pcre/pcre-8.32 --with-openssl=/data/openssl/openssl-1.1.1f</code></pre> 
<p><span style="color:#fe2c24;">问题4：已经安装了zlib，但是执行 ./configure时还是一直报：如下错误：</span></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/9e/fd/AybeSEWc_o.png" width="1200"></p> 
<p>需要指定zlib的源码位置</p> 
<pre><code>[root@MiWiFi-R3-srv nginx-1.20.2]# ./configure --prefix=/data/nginx/nginx --with-http_stub_status_module --with-http_ssl_module --with-pcre=/data/pcre/pcre-8.32 --with-zlib=/data/zlib/zlib-1.2.11 --with-openssl=/data/openssl/openssl-1.1.1f</code></pre> 
<p><span style="color:#fe2c24;">问题5：如果报如下错误，则需要安装openssl：</span></p> 
<p>./configure: error: the HTTP cache module requires md5 functions<br> from OpenSSL library.  You can either disable the module by using<br> --without-http-cache option, or install the OpenSSL library into the system,<br> or build the OpenSSL library statically from the source with nginx by using<br> --with-http_ssl_module --with-openssl=&lt;path&gt; options.</p> 
<p><span style="color:#fe2c24;">问题6：如果报如下错误，则需要安装gcc-c++：</span></p> 
<p><img alt="" height="334" src="https://images2.imgbox.com/0f/e1/dqDcAq67_o.png" width="1005"></p> 
<p><img alt="" height="294" src="https://images2.imgbox.com/b4/a8/hvODK98J_o.png" width="879"></p> 
<p>CentOS 7需要安装以下文件，注意不同操作系统安装的版本不一样。</p> 
<h2 id="%E4%BA%8C%E3%80%81%E5%BC%80%E6%9C%BA%E8%87%AA%E5%90%AF%E5%8A%A8%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE">二、开机自启动服务配置</h2> 
<p>1、在linux系统的/etc/init.d/目录下创建nginx_start脚本文件</p> 
<blockquote> 
 <p>touch /etc/init.d/nginx_start-----------------创建脚本文件</p> 
 <p>chmod a+x /etc/init.d/nginx_start---------设置执行权限</p> 
</blockquote> 
<p> 在nginx_start脚本文件中添加以下命令<a class="link-info" href="https://www.nginx.com/resources/wiki/start/topics/examples/redhatnginxinit/" rel="nofollow" title="（内容主要参考官方文档）">（内容主要参考官方文档）</a></p> 
<blockquote> 
 <p>vim /etc/init.d/nginx</p> 
</blockquote> 
<pre><code class="language-bash">#!/bin/sh
#
# nginx - this script starts and stops the nginx daemon
#
# chkconfig:   - 85 15
# description:  NGINX is an HTTP(S) server, HTTP(S) reverse \
#               proxy and IMAP/POP3 proxy server
# processname: nginx
# config:      /etc/nginx/nginx.conf
# config:      /etc/sysconfig/nginx
# pidfile:     /var/run/nginx.pid
# Source function library.
. /etc/rc.d/init.d/functions
# Source networking configuration.
. /etc/sysconfig/network
# Check that networking is up.
[ "$NETWORKING" = "no" ] &amp;&amp; exit 0
nginx="/data/nginx/sbin/nginx"
prog=$(basename $nginx)
NGINX_CONF_FILE="/data/nginx/conf/nginx.conf"
[ -f /etc/sysconfig/nginx ] &amp;&amp; . /etc/sysconfig/nginx
lockfile=/var/lock/subsys/nginx
make_dirs() {
   # make required directories
   user=`$nginx -V 2&gt;&amp;1 | grep "configure arguments:.*--user=" | sed 's/[^*]*--user=\([^ ]*\).*/\1/g' -`
   if [ -n "$user" ]; then
      if [ -z "`grep $user /etc/passwd`" ]; then
         useradd -M -s /bin/nologin $user
      fi
      options=`$nginx -V 2&gt;&amp;1 | grep 'configure arguments:'`
      for opt in $options; do
          if [ `echo $opt | grep '.*-temp-path'` ]; then
              value=`echo $opt | cut -d "=" -f 2`
              if [ ! -d "$value" ]; then
                  # echo "creating" $value
                  mkdir -p $value &amp;&amp; chown -R $user $value
              fi
          fi
       done
    fi
}
start() {
    [ -x $nginx ] || exit 5
    [ -f $NGINX_CONF_FILE ] || exit 6
    make_dirs
    echo -n $"Starting $prog: "
    daemon $nginx -c $NGINX_CONF_FILE
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; touch $lockfile
    return $retval
}
stop() {
    echo -n $"Stopping $prog: "
    killproc $prog -QUIT
    retval=$?
    echo
    [ $retval -eq 0 ] &amp;&amp; rm -f $lockfile
    return $retval
}
restart() {
    configtest || return $?
    stop
    sleep 1
    start
}
reload() {
    configtest || return $?
    echo -n $"Reloading $prog: "
    killproc $prog -HUP
    retval=$?
    echo
}
force_reload() {
    restart
}
configtest() {
  $nginx -t -c $NGINX_CONF_FILE
}
rh_status() {
    status $prog
}
rh_status_q() {
    rh_status &gt;/dev/null 2&gt;&amp;1
}
case "$1" in
    start)
        rh_status_q &amp;&amp; exit 0
        $1
        ;;
    stop)
        rh_status_q || exit 0
        $1
        ;;
    restart|configtest)
        $1
        ;;
    reload)
        rh_status_q || exit 7
        $1
        ;;
    force-reload)
        force_reload
        ;;
    status)
        rh_status
        ;;
    condrestart|try-restart)
        rh_status_q || exit 0
            ;;
    *)
        echo $"Usage: $0 {start|stop|status|restart|condrestart|try-restart|reload|force-reload|configtest}"
        exit 2
esac</code></pre> 
<p><span style="color:#fe2c24;">其中，nginx="/data/nginx/sbin/nginx" 修改成自己对应nginx执行程序的路径。<br> NGINX_CONF_FILE="/data/nginx/conf/nginx.conf"  修改成自己对应配置文件的路径。</span></p> 
<p><span style="color:#0d0016;">2、脚本测试</span></p> 
<p><span style="color:#0d0016;">执行以下命令：</span></p> 
<blockquote> 
 <p><span style="color:#0d0016;">/etc/init.d/nginx_start start</span></p> 
</blockquote> 
<p><span style="color:#fe2c24;">如果出现以下错误：</span></p> 
<p><img alt="" height="22" src="https://images2.imgbox.com/07/5b/04Jf5Jp0_o.png" width="700"></p> 
<p>按照提示执行以下命令即可：<br> systemctl daemon-reload<br> 设置成服务并开机自启动<br> chkconfig --add /etc/init.d/nginx         #将nginx服务加入chkconfig管理列表<br> chkconfig nginx on                            #设置终端模式开机启动<br> chkconfig nginx off                            #关闭开机启动</p> 
<p>加完这个之后，就可以使用service对nginx进行启动，重启等操作了。<br> service nginx start<br> service nginx restart<br> service nginx stop<br> service nginx status</p> 
<p>以上就是在Linux下安装Nginx及配置开机自启动全过程，希望对大家有所帮助。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/803d2e6f560fc51ff23e646b3a3b053a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python--如何进行去重</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c75458fa9bde46248eeb0ed856609dcb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">论文汇报--SIGIR2022--基于用户价格偏好及兴趣偏好的会话推荐</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>