<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【C Primer Plus第六版 学习笔记】 第十六章 C预处理器和C库 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【C Primer Plus第六版 学习笔记】 第十六章 C预处理器和C库" />
<meta property="og:description" content="有基础，进阶用，个人查漏补缺
第十五章的内容之前学过，跳过
预处理之前，编译器必须对该程序进行一些翻译处理
首先把源代码中出现的字符映射到原字符集
其次编译器定位每个反斜杠后面跟着换行符的实例，并删除它们（把由于写代码时，一行太长，会用反斜杠\把一行逻辑行变成两个物理行）
然后编译器把文本划分为预处理记号序列、空白序列和注释序列。此处需要注意的是，编译器将用一个空格字符替换每一条注释，如
int/* 注释*/fox; //将变成 int fox;//中间的注释变成了一个空格 C预处理器在程序执行之前查看程序，故称之为预处理器。根据程序中的预处理器指令，预处理器把符号缩写替换成其表达的内容。
明示常量：#define
指令从#开始运行，到第1个换行符结束，针对的是一个逻辑行（可以用\进行物理换行）
类对象宏定义的组成：宏的名称中不允许有空格，需要遵循C变量的命名规则
#define PX printf(&#34;x is %d\n&#34;, x) //预处理指令 宏 替换体 预处理器不做计算，不对表达式求值，只进行替换
记号：可以把宏的替换体看作是记号（token）型字符串
#define FOUR 2*2 //有一个记号2*2，但对于C编译器来说是3个记号 #define six 2 * 3 //有三个记号2、*、3，额外的空格也是替换体的一部分 重定义常量：假设先把LIMIT定义为20，稍后在该文件中又把它定义为25。
//ANSI标准在新定义和旧定义完全相同时才允许重定义 #define six 2 * 3 #define six 2 * 3 在#define中使用参数，即类函数宏：
为保证运算顺序，要多使用圆括号
#define SQUARE(X) X*X #define SQUARE1(X) (X*X) #define SQUARE2(X) (X)*(X) int x = 5; z = SQUARE(x);//z=25 z = SQUARE(x&#43;2);//z= x&#43;2*x&#43;2 = 5&#43;2*5&#43;2 = 17 z = 100 / SQUARE(2);//z = 100/2*2 = 100/2*2 = 100 z = SQUARE1(2);//z = 100 / (2*2) = 25 z = SQUARE2(x&#43;2);//z = (x&#43;2)*(x&#43;2) 避免使用&#43;&#43;x等这种递增或者递减" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f42399e3e948c38f0f4cea7b0b54729d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-01T21:12:00+08:00" />
<meta property="article:modified_time" content="2024-01-01T21:12:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【C Primer Plus第六版 学习笔记】 第十六章 C预处理器和C库</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>有基础，进阶用，个人查漏补缺</p> 
<p>第十五章的内容之前学过，跳过</p> 
<ol><li> <p>预处理之前，编译器必须对该程序进行一些翻译处理</p> 
  <ol><li> <p>首先把源代码中出现的字符映射到原字符集</p> </li><li> <p>其次编译器定位每个反斜杠后面跟着换行符的实例，并删除它们（把由于写代码时，一行太长，会用反斜杠\把一行逻辑行变成两个物理行）</p> </li><li> <p>然后编译器把文本划分为预处理记号序列、空白序列和注释序列。此处需要注意的是，编译器将用一个空格字符替换每一条注释，如</p> <pre><code class="prism language-c"><span class="token keyword">int</span><span class="token comment">/* 注释*/</span>fox<span class="token punctuation">;</span>
<span class="token comment">//将变成</span>
<span class="token keyword">int</span> fox<span class="token punctuation">;</span><span class="token comment">//中间的注释变成了一个空格</span>
</code></pre> </li></ol> </li><li> <p>C预处理器在程序执行之前查看程序，故称之为预处理器。根据程序中的预处理器指令，预处理器把符号缩写替换成其表达的内容。</p> </li><li> <p>明示常量：#define</p> 
  <ol><li> <p>指令从#开始运行，到第1个换行符结束，针对的是一个逻辑行（可以用\进行物理换行）</p> </li><li> <p>类对象宏定义的组成：宏的名称中不允许有空格，需要遵循C变量的命名规则</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">PX</span> <span class="token expression"><span class="token function">printf</span><span class="token punctuation">(</span></span><span class="token string">"x is %d\n"</span><span class="token expression"><span class="token punctuation">,</span> x<span class="token punctuation">)</span></span></span>
<span class="token comment">//预处理指令 宏 替换体</span>
</code></pre> </li><li> <p>预处理器不做计算，不对表达式求值，只进行替换</p> </li><li> <p>记号：可以把宏的替换体看作是记号（token）型字符串</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">FOUR</span> <span class="token expression"><span class="token number">2</span><span class="token operator">*</span><span class="token number">2</span>    </span><span class="token comment">//有一个记号2*2，但对于C编译器来说是3个记号</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">six</span> <span class="token expression"><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3</span>   </span><span class="token comment">//有三个记号2、*、3，额外的空格也是替换体的一部分</span></span>
</code></pre> </li><li> <p>重定义常量：假设先把LIMIT定义为20，稍后在该文件中又把它定义为25。</p> <pre><code class="prism language-c"><span class="token comment">//ANSI标准在新定义和旧定义完全相同时才允许重定义</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">six</span> <span class="token expression"><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">six</span> <span class="token expression"><span class="token number">2</span> <span class="token operator">*</span> <span class="token number">3</span></span></span>
</code></pre> </li><li> <p>在#define中使用参数，即类函数宏：</p> 
    <ol><li> <p>为保证运算顺序，要多使用圆括号</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> X<span class="token operator">*</span>X</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE1</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token punctuation">(</span>X<span class="token operator">*</span>X<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SQUARE2</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span></span></span>
<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
z <span class="token operator">=</span> <span class="token function">SQUARE</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//z=25</span>
z <span class="token operator">=</span> <span class="token function">SQUARE</span><span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//z= x+2*x+2 = 5+2*5+2 = 17</span>
z <span class="token operator">=</span> <span class="token number">100</span> <span class="token operator">/</span> <span class="token function">SQUARE</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//z = 100/2*2 = 100/2*2 = 100</span>

z <span class="token operator">=</span> <span class="token function">SQUARE1</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//z = 100 / (2*2) = 25</span>

z <span class="token operator">=</span> <span class="token function">SQUARE2</span><span class="token punctuation">(</span>x<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//z = (x+2)*(x+2)</span>

</code></pre> </li><li> <p>避免使用++x等这种递增或者递减</p> </li><li> <p>用宏参数创建字符串：#运算符</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PSQR</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span></span><span class="token string">"The square of X is %d.\n"</span><span class="token expression"><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token function">PSQR</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出The square of X is 64.**注意双引号中的X被视为普通文本，不是记号**</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PSQR</span><span class="token expression"><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token function">printf</span><span class="token punctuation">(</span></span><span class="token string">"The square of "</span> <span class="token expression"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">x</span> </span></span><span class="token string">" is %d.\n"</span><span class="token expression"><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">*</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
<span class="token function">PSQR</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出The square of y is 25</span>
<span class="token function">PSQR</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//输出The square of  2 + 4 is 36</span>
</code></pre> </li><li> <p>预处理黏合剂：##运算符</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">XNAME</span><span class="token expression"><span class="token punctuation">(</span>n<span class="token punctuation">)</span> x </span><span class="token punctuation">##</span> <span class="token expression">n</span></span>
<span class="token keyword">int</span> <span class="token function">XNAME</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">14</span><span class="token punctuation">;</span><span class="token comment">//变成int x1 = 14</span>
</code></pre> </li><li> <p>变宏参：…和__VA_ARGS__</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PR</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">prinf</span><span class="token punctuation">(</span>__VA_ARGS__<span class="token punctuation">)</span></span></span>
<span class="token function">pr</span><span class="token punctuation">(</span><span class="token string">"Hoedy"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等于 prinf("Hoedy")</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">PR</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token function">prinf</span><span class="token punctuation">(</span></span><span class="token string">"Message "</span> <span class="token expression"><span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">X </span></span></span><span class="token string">": "</span> <span class="token expression">__VA_ARGS__<span class="token punctuation">)</span></span></span>
<span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token function">PR</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"x = %d\n"</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//即prinf("Message " "1" ": " "x = %d\n", x)</span>
<span class="token comment">//输出Message 1: x = 2</span>
</code></pre> </li></ol> </li></ol> </li><li> <p>宏和函数的选择</p> 
  <ol><li> <p>宏生成内联代码，即在程序中生成语句，调用20次宏就生成20行代码。而调用函数20次，在程序中只有一份函数语句的副本，节省空间</p> </li><li> <p>调用函数时，程序控制必须跳转到函数内，再返回主调程序，比内联代码更费时间</p> </li><li> <p>宏不用担心变量类型</p> </li><li> <p>在嵌套循环中使用宏更有助于提高效率</p> </li><li> <p>对于简单的函数，通常使用宏</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MAX</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token punctuation">(</span>Y<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">ABS</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token expression">DEFINE </span><span class="token macro-name function">ISSIGN</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span>  <span class="token operator">==</span> </span><span class="token char">'+'</span> <span class="token expression"><span class="token operator">||</span> <span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token operator">==</span> </span><span class="token char">'-'</span> <span class="token expression"><span class="token operator">?</span> <span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span>
</code></pre> </li></ol> </li><li> <p>文件包含：#include</p> 
  <ol><li> <p>当预处理器发现#include指令时会查看后面的文件名并把文件的内容包含到当前文件中，即替换源文件中的#include指令。这相当于把被包含文件的全部内容输入到源文件#include指令所在的位置。</p> </li><li> <p>#include指令有两种形式：文件名在尖括号或者双引号中</p> <pre><code class="prism language-c"><span class="token comment">//在unix系统中</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span>              <span class="token comment">//查找系统目录</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"mystuff.h"</span>            <span class="token comment">//查找当前工作目录</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"/usr/biff/mystuff.h"</span>  <span class="token comment">//查找/usr/biff/目录</span></span>
</code></pre> </li><li> <p>头文件实例</p> 
    <ol><li> <p>names_st.h————names_st结构的头文件</p> <pre><code class="prism language-c"><span class="token comment">// 常量</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SLEN</span> <span class="token expression"><span class="token number">32</span></span></span>

<span class="token comment">// 结构声明</span>
<span class="token keyword">struct</span> <span class="token class-name">names_st</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> first<span class="token punctuation">[</span>SLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> last<span class="token punctuation">[</span>SLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 类型定义</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">names_st</span> names<span class="token punctuation">;</span>

<span class="token comment">// 函数原型</span>
<span class="token keyword">void</span> <span class="token function">get_names</span><span class="token punctuation">(</span>names <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">show_names</span><span class="token punctuation">(</span><span class="token keyword">const</span> names <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">s_gets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> st<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>names_st.c————定义names_st.h中的函数</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"names_st.h"</span>     <span class="token comment">//包含头文件</span></span>

<span class="token comment">//函数定义</span>
<span class="token keyword">void</span> <span class="token function">get_names</span><span class="token punctuation">(</span>names <span class="token operator">*</span> pn<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter your first name: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">s_gets</span><span class="token punctuation">(</span>pn<span class="token operator">-&gt;</span>first<span class="token punctuation">,</span> SLEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Please enter your last name: "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">s_gets</span><span class="token punctuation">(</span>pn<span class="token operator">-&gt;</span>last<span class="token punctuation">,</span> SLEN<span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">show_names</span><span class="token punctuation">(</span><span class="token keyword">const</span> names <span class="token operator">*</span> pn<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s %s"</span><span class="token punctuation">,</span> pn<span class="token operator">-&gt;</span>first<span class="token punctuation">,</span> pn<span class="token operator">-&gt;</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">s_gets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> st<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> <span class="token operator">*</span> ret_val<span class="token punctuation">;</span>
    <span class="token keyword">char</span> <span class="token operator">*</span> find<span class="token punctuation">;</span>
    
    ret_val <span class="token operator">=</span> <span class="token function">fgets</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> n<span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ret_val<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        find <span class="token operator">=</span> <span class="token function">strchr</span><span class="token punctuation">(</span>st<span class="token punctuation">,</span> <span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//查找换行符</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>find<span class="token punctuation">)</span>                  <span class="token comment">//如果地址不是NULL,</span>
            <span class="token operator">*</span>find <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>          <span class="token comment">//在此处放一个空字符</span>
        <span class="token keyword">else</span>
            <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span class="token punctuation">;</span>          <span class="token comment">//处理输入行中的剩余字符</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> ret_val<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> </li><li> <p>useheader.c————使用names_st结构</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"names_st.h"</span></span>
<span class="token comment">//记得链接names_st.c</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    names candidate<span class="token punctuation">;</span>
    
    <span class="token function">get_names</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Let's welcome "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">show_names</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">" to this program!\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>注意：</p> 
      <ol><li>两个源文件.c都使用names_st类型结构，所以它们都必须包含names_st.h头文件</li><li>必须编译和链接names_st.c和useheader.c源代码文件</li><li>声明和指令放在names_st.h头文件中，函数定义放在names_st.c源代码文件中</li></ol> </li></ol> </li><li> <p>使用头文件</p> <p>头文件中最常用的形式如下：</p> 
    <ol><li>明示常量</li><li>宏函数</li><li>函数声明</li><li>类型定义</li><li>使用头文件声明外部变量供其他文件共享</li></ol> </li></ol> </li><li> <p>#undef 指令</p> <p>用于取消已定义的 #define 指令</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIMIT</span> <span class="token expression"><span class="token number">40</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">undef</span> <span class="token expression">LIMIT      </span><span class="token comment">//可以移除上面的定义</span></span>
</code></pre> <p>现在可以将LIMIT重新定义为一个新值，即使原来没有定义LIMIT，该取消也依旧有效；</p> <p>如果想使用一个名称，又不确定是否之前已经用过，为安全起见，可以使用 #undef 取消该名称的定义</p> </li><li> <p>条件编译——#ifdef、#else、#endif</p> <p>预处理器不识别用于标记块的花括号{}</p> <p>缩进与否看个人风格</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">MAVIS          </span><span class="token comment">//如果已经用#define定义了MAVIS，则执行下面的指令</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"horse.h"</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STABLE</span> <span class="token expression"><span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span>                 <span class="token comment">//如果没有用#define定义了MAVIS，则执行下面的指令</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"cow.h"</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">STABLE</span> <span class="token expression"><span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span>                <span class="token comment">//必须存在</span></span>
</code></pre> <p>也可以用这些指令标记C语句块</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">JUST_CHECKING</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">LIMIT</span> <span class="token expression"><span class="token number">4</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i<span class="token punctuation">;</span>
    <span class="token keyword">int</span> total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> LIMIT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        total <span class="token operator">+=</span> <span class="token number">2</span><span class="token operator">*</span>i<span class="token operator">*</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifdef</span> <span class="token expression">JUST_CHECKING</span></span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"i=%d, running total = %d\n"</span><span class="token punctuation">,</span> i<span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
    <span class="token punctuation">}</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Grand total = %d\n"</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>输出：</p> <pre><code class="prism language-c">i<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> running total <span class="token operator">=</span> <span class="token number">3</span>
i<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> running total <span class="token operator">=</span> <span class="token number">12</span>
i<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> running total <span class="token operator">=</span> <span class="token number">31</span>
i<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span> running total <span class="token operator">=</span> <span class="token number">64</span>
Grand total <span class="token operator">=</span> <span class="token number">64</span>
</code></pre> <p>如果省略JUST_CHECKING定义（把#define JUST_CHECKING放在注释中，或者使用#undef指令取消它的定义），并重新编译该程序，只会输出最后一行。该方法可用来调试程序。</p> </li><li> <p>条件编译——#ifndef 指令</p> <p>#ifndef 和#ifdef 用法类似，也是和#else、#endif一起使用，只是它们的逻辑相反</p> <p>有arrays.h</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">SIZE</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SIZE</span> <span class="token expression"><span class="token number">100</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> <p>有代码</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SIZE</span> <span class="token expression"><span class="token number">10</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"arrays.h"</span> <span class="token comment">//当执行到该行时，跳过了#define SIZE 100，故SIZE为10</span></span>
</code></pre> <p>故可以使用#ifndef 技巧避免重复包含</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">NAMES_H_</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">NAMES_H_</span></span>

<span class="token comment">// constants</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">SLEN</span> <span class="token expression"><span class="token number">32</span></span></span>

<span class="token comment">// structure declarations</span>
<span class="token keyword">struct</span> <span class="token class-name">names_st</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">char</span> first<span class="token punctuation">[</span>SLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span> last<span class="token punctuation">[</span>SLEN<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// typedefs</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">names_st</span> names<span class="token punctuation">;</span>

<span class="token comment">// function prototypes</span>
<span class="token keyword">void</span> <span class="token function">get_names</span><span class="token punctuation">(</span>names <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">show_names</span><span class="token punctuation">(</span><span class="token keyword">const</span> names <span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">char</span> <span class="token operator">*</span> <span class="token function">s_gets</span><span class="token punctuation">(</span><span class="token keyword">char</span> <span class="token operator">*</span> st<span class="token punctuation">,</span> <span class="token keyword">int</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> <p>用以下代码进行测试，是没有问题的。但是如果把上面的.h中的#ifndef 删除，程序会无法通过编译</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"names.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"names.h"</span>   <span class="token comment">//不小心第2次包含头文件</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    names winner <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Less"</span><span class="token punctuation">,</span> <span class="token string">"Ismoor"</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"The winner is %s %s.\n"</span><span class="token punctuation">,</span> winner<span class="token punctuation">.</span>first<span class="token punctuation">,</span> winner<span class="token punctuation">.</span>last<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>条件编译——#if 和 #elif</p> <p>类似于if语句。#if 后面跟着整型常量表达式</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">SYS <span class="token operator">==</span> <span class="token number">1</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"a.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">SYS <span class="token operator">==</span> <span class="token number">2</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"b.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression">SYS <span class="token operator">==</span> <span class="token number">3</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"c.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"d.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> <p>另一个新的用法测试名称是否已经定义</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token function">defined</span> <span class="token punctuation">(</span>ABC<span class="token punctuation">)</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"a.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span> <span class="token punctuation">(</span>DE<span class="token punctuation">)</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"b.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">elif</span> <span class="token expression"><span class="token function">defined</span> <span class="token punctuation">(</span>FG<span class="token punctuation">)</span></span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"c.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">else</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"d.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> </li><li> <p>预定义宏</p> <p><img src="https://images2.imgbox.com/a5/b6/fYx7SIKt_o.png" alt="在这里插入图片描述"></p> </li><li> <p>#line 和 #error</p> <p>#1ine 指令重置__LINE__和__FILE__宏报告的行号和文件名。可以这样使用Iine：</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">line</span> <span class="token expression"><span class="token number">1000</span> <span class="token number">11</span>      </span><span class="token comment">//把当前行号重置为1000</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">line</span> <span class="token expression"><span class="token number">10</span> </span><span class="token string">"cool.c"</span>  <span class="token comment">//把行号重置为10，把文件名重置为 cool.c</span></span>
</code></pre> <p>#error 指令让预处理器发出一条错误消息，该消息包含指令中的文本。如果可能的话，编译过程应该中断。可以这样使用#error 指令：</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression">__STDC_VERSION__<span class="token operator">!=</span> <span class="token number">201112L</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">error</span> <span class="token expression">Not C11</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token comment">//编译以上代码生成后，输出如下：</span>
$ gcc newish<span class="token punctuation">.</span>c
newish<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">2</span><span class="token operator">:</span> error<span class="token operator">:</span> #error Not C11
$ gcc <span class="token operator">-</span>std<span class="token operator">=</span>c11 zewish<span class="token punctuation">.</span>c
$
</code></pre> <p>如果编译器只支持旧标准，则会编译失败，如果支持 CI1 标准，就能成功编译。</p> </li><li> <p>#pragma</p> <p>在现在的编译器中，可以通过命令行参数或 IDE 菜单修改编译器的一些设置。#pragma 把编译器指令放入源代码中。例如，在开发 C99 时，标准被称为 C9X，可以使用下面的编译指示 （pragma）让编译器支持 C9X：</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression">c9x On</span></span>
</code></pre> </li><li> <p>泛型选择（C11)</p> <p>在程序设计中，泛型编程(generic programming）指那些没有特定类型，但是一旦指定一种类型，就可以转换成指定类型的代码。</p> <p>例如，C++在模板中可以创建泛型算法，然后编译器根据指定的类型自动使用实例化代码。C没有这种功能。然而，C11 新增了一种表达式，叫作泛型选择表达式(generic selection expression)，可根据表达式的类型（即表达式的类型是int、double 还是其他类型）选择一个值。泛型选择表达式不是预处理器指令，但是在一些泛型编程中它常用作#define 宏定义的一部分。</p> <p>下面是一个泛型选择表达式的示例：</p> <pre><code class="prism language-c"><span class="token keyword">_Generic</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">float</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token keyword">double</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token keyword">default</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">)</span>
</code></pre> <p>_Generic 是C11 的关键宇。_Generic 后面的國括号中包含多个用逗号分隔的项。</p> 
  <ol><li>第1个项是一个表达式，后面的每个项都由一个类型、一个冒号和一个值组成，如float：1</li><li>第1个项的类型匹配哪个标签，整个表达式的值是该标签后面的值。例如，假设上面表达式中× 是int 类型的变量，× 的类型匹配int :标签，那么整个表达式的值就是0。</li><li>如果没有与类型匹配的标签，表达式的值就是 default：标签后面的值。</li><li>泛型选择语句与 switch 语句类似，只是前者用表达式的类型匹配标签，而后者用表达式的值匹配标签。</li></ol> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">MYTYPE</span><span class="token expression"><span class="token punctuation">(</span>X<span class="token punctuation">)</span> <span class="token keyword">_Generic</span><span class="token punctuation">(</span><span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span></span><span class="token punctuation">\</span>
<span class="token expression"><span class="token keyword">int</span><span class="token operator">:</span> </span><span class="token string">"int"</span><span class="token expression"><span class="token punctuation">,</span></span><span class="token punctuation">\</span>
<span class="token expression"><span class="token keyword">float</span> <span class="token operator">:</span> </span><span class="token string">"float"</span><span class="token expression"><span class="token punctuation">,</span></span><span class="token punctuation">\</span>
<span class="token expression"><span class="token keyword">double</span><span class="token operator">:</span> </span><span class="token string">"double"</span><span class="token expression"><span class="token punctuation">,</span></span><span class="token punctuation">\</span>
<span class="token expression"><span class="token keyword">default</span><span class="token operator">:</span> </span><span class="token string">"other"</span><span class="token punctuation">\</span>
<span class="token expression"><span class="token punctuation">)</span></span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> d <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token function">MYTYPE</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//d是int类型，输出int</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token function">MYTYPE</span><span class="token punctuation">(</span><span class="token number">2.0</span><span class="token operator">*</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//2.0*d是double类型，输出double</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token function">MYTYPE</span><span class="token punctuation">(</span><span class="token number">3L</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//3L是long类型，输出other</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%s\n"</span><span class="token punctuation">,</span> <span class="token function">MYTYPE</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//&amp;d是int * 类型输出other</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>内联函数（C99）</p> <p>通常，函数调用都有一定的开销，因为函数的调用过程包括建立调用、传递参数、跳转到函数代码并返回。使用宏使代码内联，可以避免这样的开销。</p> <p>C99还提供另一种方法：内联函数(inline function)。把函数变成内联函数，编译器可能会用内联代码替换函数调用，并（或）执行一些其他的优化，但是也可能不起作用。</p> <p>标准规定具有内部链接的函数可以成为内联函数，还规定了内联函数的定义与调用该函数的代码必须在同一个文件中。</p> <p>因此，最简单的方法是使用函数说明符inline和存储类别说明符static。通常，内联函数应定义在首次使用它的文件中，所以内联函数也相当于函数原型。如下所示：</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">eatline</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// 内联函数定义/原型</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'\n'</span><span class="token punctuation">)</span>
		<span class="token keyword">continue</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token function">eatline</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//函数调用</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <p>编译器查看内联函数的定义（也是原型)，可能会用函数体中的代码替换 eatline)函数调用。也就是说，效果相当于在西数调用的位置输入函数体中的代码：</p> <pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">eatline</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// 内联函数定义/原型</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token char">'In'</span><span class="token punctuation">)</span>
		<span class="token keyword">continue</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">//函数调用之处相当于插入代码块</span>
	<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">getchar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> "\n'<span class="token punctuation">)</span>
		<span class="token keyword">continue</span><span class="token punctuation">;</span>              
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre> <p>由于并未给内联函数预留单独的代码块，所以无法获得内联函数的地址（实际上可以获得地址，不过这样做之后，编译器会生成一个非内联函数）。另外，内联函数无法在调试器中显示。</p> <p>内联函数应该比较短小。把较长的函数变成内联并未节约多少时间，因为执行函数体的时间比调用函数的时间长得多。</p> <p>编译器优化内联函数必须知道该函数定义的内容。这意味着内联函数定义与函数调用必须在同一个文件中。鉴于此，一般情况下内联函数都具有内部链接。</p> <p>因此，如果程序有多个文件都要使用某个内联函数，那么这些文件中都必须包含该内联函数的定义。最简单的做法是，把内联函数定义放入头文件，并在使用该内联函数的文件中包含该头文件即可。</p> <p>一般都不在头文件中放置可执行代码，内联函数是个特例。因为内联两数具有内部链接，所以在多个文件中定义同一个内联函数不会产生什么问题。</p> <p>与C++不同的是，C还允许混合使用内联函数定义和外部函数定义（具有外部链接的两数定义）。例如，一个程序中使用下面了个文件：</p> <pre><code class="prism language-c"><span class="token comment">//  file1.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">inline</span> <span class="token keyword">static</span> <span class="token keyword">double</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> x<span class="token operator">*</span>x<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">spam</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">masp</span><span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> q <span class="token operator">=</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token number">1.3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2f\n"</span><span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">spam</span><span class="token punctuation">(</span><span class="token number">12.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">masp</span><span class="token punctuation">(</span><span class="token number">1.6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <pre><code class="prism language-c"><span class="token comment">//  file2.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">double</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>x<span class="token operator">*</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">spam</span><span class="token punctuation">(</span><span class="token keyword">double</span> v<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> kv <span class="token operator">=</span> <span class="token function">square</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2f\n"</span><span class="token punctuation">,</span> kv<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <pre><code class="prism language-c"><span class="token comment">//  file3.c</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">inline</span> <span class="token keyword">double</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token keyword">double</span> x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>x <span class="token operator">*</span> x <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">masp</span><span class="token punctuation">(</span><span class="token keyword">double</span> w<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">double</span> kw <span class="token operator">=</span> <span class="token function">square</span><span class="token punctuation">(</span>w<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%.2f\n"</span><span class="token punctuation">,</span> kw<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <p>如上述代码所示，3 个文件中都定义了square() 函数。</p> 
  <ol><li>file1.c文件中是 inline static定义</li><li>file2.c 文件中是普通的函数定义（因此具有外部链接）</li><li>file3.c 文件中是 inline 定义，省路了static</li></ol> 
  <ul><li>3个文件中的函数都调用了 sguare() 函数，这会发生什么情况？ 
    <ol><li>file1.c文件中的main()使用square()的局部static 定义。由于该定义也是inline 定义，所以编译器有可能优化代码，也许会内联该函数。</li><li>file2.c文件中spam函数使用该文件中square()函数的定义，该定义具有外部链接，其他文件也可见。</li><li>file3.c 文件中，编译器既可以使用该文件中square()函数的内联定义，也可以使用file2.c文件中的外部链接定义。如果像 file3.c 那样，省路file1.c 文件 inline 定中的 static，那么该 inline 定义被视为可替换的外部定义。</li></ol> </li></ul> </li><li> <p>关于库以及一些函数的使用跳过</p> </li></ol>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/93e88f4b9c88e6c2cd952c2982b7c0d9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">媒体捕捉-拍照</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e80be4ae1f1fb822228f36684b34627a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据结构OJ实验12-静态查找</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>