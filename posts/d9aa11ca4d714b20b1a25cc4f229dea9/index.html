<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[carla入门教程]-4 carla中的地图(附:鸟瞰图和道路图) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[carla入门教程]-4 carla中的地图(附:鸟瞰图和道路图)" />
<meta property="og:description" content="本专栏教程将记录从安装carla到调用carla的pythonAPI进行车辆操控并采集数据的全流程,带领大家从安装carla开始,到最终能够熟练使用carla仿真环境进行传感器数据采集和车辆控制.
第四节 介绍carla中的地图 本小节的主要内容是介绍carla中的地图的种类和修改方法.
章节内容介绍：
第1小节介绍了carla中包含的地图。第2小节介绍了地图的加载方法。第3小节介绍了闪退问题及其解决方法。附录部分展示了鸟瞰图和道路图。 1.carla0.9.12中包含的地图 运行carla服务器之后,再通过下面的脚本可以打印出地图.
从其中关键的函数是调用get_available_maps().
# 生成汽车流 import glob import os import sys # ============================================================================== # -- Find CARLA module --------------------------------------------------------- # ============================================================================== try: sys.path.append(glob.glob(&#39;../carla/dist/carla-*%d.%d-%s.egg&#39; % ( sys.version_info.major, sys.version_info.minor, &#39;win-amd64&#39; if os.name == &#39;nt&#39; else &#39;linux-x86_64&#39;))[0]) except IndexError: pass # ============================================================================== # -- Add PythonAPI for release mode -------------------------------------------- # ============================================================================== try: sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))) &#43; &#39;/carla&#39;) sys.path.append(&#34;../examples/&#34;) except IndexError: pass import carla # Connect to the client and retrieve the world object try: client = carla." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d9aa11ca4d714b20b1a25cc4f229dea9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-02T20:38:33+08:00" />
<meta property="article:modified_time" content="2022-11-02T20:38:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[carla入门教程]-4 carla中的地图(附:鸟瞰图和道路图)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本专栏教程将记录从安装carla到调用carla的pythonAPI进行车辆操控并采集数据的全流程,带领大家从安装carla开始,到最终能够熟练使用carla仿真环境进行传感器数据采集和车辆控制.</p> 
<h2><a id="_carla_1"></a>第四节 介绍carla中的地图</h2> 
<p>本小节的主要内容是介绍carla中的地图的种类和修改方法.</p> 
<ul><li>章节内容介绍：<br> 第1小节介绍了carla中包含的地图。第2小节介绍了地图的加载方法。第3小节介绍了闪退问题及其解决方法。附录部分展示了鸟瞰图和道路图。</li></ul> 
<h3><a id="1carla0912_7"></a>1.carla0.9.12中包含的地图</h3> 
<p>运行carla服务器之后,再通过下面的脚本可以打印出地图.<br> 从其中关键的函数是调用<code>get_available_maps()</code>.</p> 
<pre><code class="prism language-python"><span class="token comment"># 生成汽车流</span>
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys
<span class="token comment"># ==============================================================================</span>
<span class="token comment"># -- Find CARLA module ---------------------------------------------------------</span>
<span class="token comment"># ==============================================================================</span>

<span class="token keyword">try</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'../carla/dist/carla-*%d.%d-%s.egg'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>
        sys<span class="token punctuation">.</span>version_info<span class="token punctuation">.</span>major<span class="token punctuation">,</span>
        sys<span class="token punctuation">.</span>version_info<span class="token punctuation">.</span>minor<span class="token punctuation">,</span>
        <span class="token string">'win-amd64'</span> <span class="token keyword">if</span> os<span class="token punctuation">.</span>name <span class="token operator">==</span> <span class="token string">'nt'</span> <span class="token keyword">else</span> <span class="token string">'linux-x86_64'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token comment"># ==============================================================================</span>
<span class="token comment"># -- Add PythonAPI for release mode --------------------------------------------</span>
<span class="token comment"># ==============================================================================</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'/carla'</span><span class="token punctuation">)</span>
    sys<span class="token punctuation">.</span>path<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">"../examples/"</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>

<span class="token keyword">import</span> carla

<span class="token comment"># Connect to the client and retrieve the world object</span>
<span class="token keyword">try</span><span class="token punctuation">:</span>
    client <span class="token operator">=</span> carla<span class="token punctuation">.</span>Client<span class="token punctuation">(</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>get_available_maps<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
         <span class="token keyword">print</span><span class="token punctuation">(</span>client<span class="token punctuation">.</span>get_available_maps<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">except</span> IndexError<span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
</code></pre> 
<ul><li>carla0.9.12中的地图:</li></ul> 
<pre><code class="prism language-bash">/Game/Carla/Maps/Town06_Opt
/Game/Carla/Maps/Town01
/Game/Carla/Maps/Town07
/Game/Carla/Maps/Town05_Opt
/Game/Carla/Maps/Town07_Opt
/Game/Carla/Maps/Town06
/Game/Carla/Maps/Town03
/Game/Carla/Maps/Town10HD
/Game/Carla/Maps/Town04
/Game/Carla/Maps/Town03_Opt
/Game/Carla/Maps/Town02
/Game/Carla/Maps/Town10HD_Opt
/Game/Carla/Maps/Town05
/Game/Carla/Maps/Town01_Opt
/Game/Carla/Maps/Town02_Opt
/Game/Carla/Maps/Town04_Opt
/Game/Carla/Maps/Town11/Town11
</code></pre> 
<p>可以看到,carla中的地图分成两类,一类是Non-layered maps的,另一类是Layered maps.两者的区别在于,前者的贴图是不可分层的,而后者贴图可以分层,可以根据需要去掉一些图层.</p> 
<h4><a id="11__Nonlayered_maps_74"></a>1.1 Non-layered maps</h4> 
<p>不可分层的地图一共有Town01~Town07,Town10HD.共计8个地图.</p> 
<pre><code>Town	Summary
Town01	基础城镇,由很多T字路口组成.
Town02	和Town01相似,但是比town01小
Town03	最复杂的Town,5车道,迂回,不均衡,地下通道等
Town04	无穷循环的高速+一个小城镇
Town05	具有十字路口和桥的方形城镇.单方向有很多车道.
Town06	 具有很多公路出入口的长公路.
Town07	乡村环境,具有狭窄的道路,大棚,几乎没有红绿灯.
Town10HD	城市环境,具有不同环境（如大道或长廊）和更逼真纹理.
</code></pre> 
<p>具体地图的鸟瞰图和路网地图请跳转到 附录查看.<br> Town10HD打开需要很大显存,我的电脑显卡是2060,6GB版本,打开时存在闪退问题.</p> 
<h4><a id="12__Layered_maps_89"></a>1.2 Layered maps</h4> 
<p>分层贴图的布局与非分层贴图相同，但可以在贴图的图层上切换和关闭。有一个不可切换的最小布局，由道路、人行道、红绿灯和交通标志组成。分层地图可以用后缀_Opt标识，例如Town01_Opt。carla0.9.12中一共有Town01_Opt~Town07_Opt,以及Town10HD_Opt.</p> 
<p>可以通过Python API加载和卸载层：</p> 
<pre><code class="prism language-python">    <span class="token comment"># Load layered map for Town 01 with minimum layout plus buildings and parked vehicles</span>
    world <span class="token operator">=</span> client<span class="token punctuation">.</span>load_world<span class="token punctuation">(</span><span class="token string">'Town01_Opt'</span><span class="token punctuation">,</span> carla<span class="token punctuation">.</span>MapLayer<span class="token punctuation">.</span>Buildings <span class="token operator">|</span> carla<span class="token punctuation">.</span>MapLayer<span class="token punctuation">.</span>ParkedVehicles<span class="token punctuation">)</span>

    <span class="token comment"># Toggle all buildings off</span>
    world<span class="token punctuation">.</span>unload_map_layer<span class="token punctuation">(</span>carla<span class="token punctuation">.</span>MapLayer<span class="token punctuation">.</span>Buildings<span class="token punctuation">)</span>

    <span class="token comment"># Toggle all buildings on   </span>
    world<span class="token punctuation">.</span>load_map_layer<span class="token punctuation">(</span>carla<span class="token punctuation">.</span>MapLayer<span class="token punctuation">.</span>Buildings<span class="token punctuation">)</span>
</code></pre> 
<p>如图所示,图1是带有建筑物图层的,图2是去掉建筑物图层的.<br> <img src="https://images2.imgbox.com/49/ef/myficYXV_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/99/cd/L0aRF7VT_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_109"></a>2.修改地图</h3> 
<p>通过<code>load_world('Townxx')</code>加载地图.</p> 
<pre><code class="prism language-python">    client<span class="token punctuation">.</span>load_world<span class="token punctuation">(</span><span class="token string">'Townxx'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3_115"></a>3.闪退问题</h3> 
<h4><a id="31__116"></a>3.1 低精度渲染引起的闪退问题</h4> 
<p>当我们采用低精度方式渲染服务器时,也就是使用<code>./CarlaUE4.sh -quality-level=Low</code>命令运行服务器时.通过脚本切换地图会出现如下的错误<br> <img src="https://images2.imgbox.com/c0/a9/oSr3zDKj_o.png" alt="在这里插入图片描述"><br> 然后carla服务器会闪退.</p> 
<ul><li>解决方法:</li></ul> 
<p>目前没有搞明白闪退原因,不过经过测试发现,把渲染脚本改会默认值,也就是<code>./CarlaUE4.sh</code>启动时,切换地图就不会出现闪退了.</p> 
<h4><a id="32__125"></a>3.2 添加图层地图引起的闪退问题</h4> 
<p>载入可变图层地图时.当去除图层后,再添加图层的时候,总是会导致carla服务器闪退,也不知道为什么.</p> 
<p>终端显示的错误如下:</p> 
<pre><code class="prism language-bash"><span class="token number">4.26</span>.2-0+++UE4+Release-4.26 <span class="token number">522</span> <span class="token number">0</span>
Disabling core dumps.
Signal <span class="token number">11</span> caught.
Malloc <span class="token assign-left variable">Size</span><span class="token operator">=</span><span class="token number">65538</span> <span class="token assign-left variable">LargeMemoryPoolOffset</span><span class="token operator">=</span><span class="token number">65554</span> 
CommonUnixCrashHandler: <span class="token assign-left variable">Signal</span><span class="token operator">=</span><span class="token number">11</span>
Malloc <span class="token assign-left variable">Size</span><span class="token operator">=</span><span class="token number">131160</span> <span class="token assign-left variable">LargeMemoryPoolOffset</span><span class="token operator">=</span><span class="token number">196744</span> 
Malloc <span class="token assign-left variable">Size</span><span class="token operator">=</span><span class="token number">131160</span> <span class="token assign-left variable">LargeMemoryPoolOffset</span><span class="token operator">=</span><span class="token number">327928</span> 
Engine crash handling finished<span class="token punctuation">;</span> re-raising signal <span class="token number">11</span> <span class="token keyword">for</span> the default handler. Good bye.
Segmentation fault <span class="token punctuation">(</span>core dumped<span class="token punctuation">)</span>
</code></pre> 
<ul><li>解决方法</li></ul> 
<p>未找到根本解决方法.这里建议大家只运行一次去除命令,不要运行添加图层命令.</p> 
<h2><a id="__148"></a>附录: 地图鸟瞰图和道路图</h2> 
<p>carla 的主要地图(Town01-Town07,Town10)都可以在官方找到对应的路网地图:<br> <a href="https://carla.readthedocs.io/en/latest/core_map/#non-layered-maps" rel="nofollow">https://carla.readthedocs.io/en/latest/core_map/#non-layered-maps</a></p> 
<h3><a id="Town01_153"></a>Town01</h3> 
<p><img src="https://images2.imgbox.com/9e/f8/Ushm6bD3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2a/2b/lzvg8HkD_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Town02_157"></a>Town02</h3> 
<p><img src="https://images2.imgbox.com/c6/4f/NrY11wQD_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/93/58/8jGjR1Ia_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Town03_161"></a>Town03</h3> 
<p><img src="https://images2.imgbox.com/0f/ec/jdtfjj0m_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/71/be/28RdLyo6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Town04_164"></a>Town04</h3> 
<p><img src="https://images2.imgbox.com/d9/26/smhV5aq2_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/8d/12/jUYXIYWf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Town05_169"></a>Town05</h3> 
<p><img src="https://images2.imgbox.com/9c/6b/sQsnXsxe_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/01/88/TQFcWxW6_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Town06_172"></a>Town06</h3> 
<p><img src="https://images2.imgbox.com/8b/2e/PuVThdSW_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f5/59/k5ZCOKxF_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Town07_178"></a>Town07</h3> 
<p><img src="https://images2.imgbox.com/4c/93/Ny54IVfw_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/8d/b2/42J7nEEl_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/64e88a829860d0c2490188fc248e1122/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">unity自学第一天</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1818e29f34b98746a1371c4a27b8eb00/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">PointRCNN：3D Object Proposal Generation and Detection from Point Cloud</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>