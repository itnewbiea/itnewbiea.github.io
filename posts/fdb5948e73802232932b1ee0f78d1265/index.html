<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å‰ç«¯ï¼ˆäºŒåä¸€ï¼‰â€”â€”WebSocketï¼šå®ç°å®æ—¶åŒå‘æ•°æ®ä¼ è¾“çš„Webé€šä¿¡åè®® - ITå­¦ä¹ è€…åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="å‰ç«¯ï¼ˆäºŒåä¸€ï¼‰â€”â€”WebSocketï¼šå®ç°å®æ—¶åŒå‘æ•°æ®ä¼ è¾“çš„Webé€šä¿¡åè®®" />
<meta property="og:description" content="ğŸ¤¨åšä¸»ï¼šå°çŒ«å¨ƒæ¥å•¦
ğŸ¤¨æ–‡ç« æ ¸å¿ƒï¼šWebSocketï¼šå®ç°å®æ—¶åŒå‘æ•°æ®ä¼ è¾“çš„Webé€šä¿¡åè®®
æ–‡ç« ç›®å½• å‰è¨€WebSocketåŸç†å¦‚ä½•ä½¿ç”¨WebSocketå»ºç«‹WebSocketè¿æ¥:æ•°æ®ä¼ è¾“: WebSocketçš„çœŸå®ä½¿ç”¨åœºæ™¯å³æ—¶é€šè®¯:å¤šäººåä½œ:å®æ—¶æ•°æ®æ›´æ–°: WebSocketçš„ä¼˜åŠ¿ä¸å±€é™æ€§ç»“è®º å‰è¨€ åœ¨å½“ä»Šäº’è”ç½‘æ—¶ä»£ï¼Œå®æ—¶é€šä¿¡å·²æˆä¸ºå¾ˆå¤šåº”ç”¨çš„éœ€æ±‚ã€‚ä¸ºäº†æ»¡è¶³è¿™ç§éœ€æ±‚ï¼ŒWebSocketåè®®è¢«è®¾è®¡å‡ºæ¥ã€‚WebSocketæ˜¯ä¸€ç§åŸºäºTCPè®®çš„å…¨åŒå·¥é€šä¿¡åè®®ï¼Œé€šè¿‡WebSocketï¼ŒWebåº”ç”¨ç¨‹åºå¯ä»¥ä¸æœåŠ¡å™¨å»ºç«‹æŒä¹…çš„è¿æ¥ï¼Œå®ç°å®æ—¶åŒå‘æ•°æ®è¾“ï¼Œæä¾›æä½çš„å»¶è¿Ÿå’Œé«˜æ•ˆçš„æ•°æ®ä¼ è¾“ã€‚
WebSocketåŸç† HTTPè¯·æ±‚-å“åº”åè®® åœ¨ç†è§£WebSocketåŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£HTTPè¯·æ±‚-å“åº”åè®®ã€‚HTTPæ˜¯ä¸€ç§æ— çŠ¶æ€çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®¢æˆ·ç«¯é€šè¿‡å‘é€HTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥æ”¶å¹¶å¤„ç†è¯·æ±‚ï¼Œå¹¶è¿”å›HTTPå“åº”ç»™å®¢æˆ·ç«¯ã€‚ä½†æ˜¯ï¼Œåœ¨ä¼ ç»Ÿçš„HTTPåè®®ä¸­ï¼Œå®¢æˆ·ç«¯åªèƒ½å‘é€è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨åªèƒ½é€šè¿‡å“åº”æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚
WebSocketåè®® WebSocketåè®®æ˜¯åœ¨HTTPåè®®çš„åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•çš„ã€‚åœ¨å»ºç«‹WebSocketè¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯é¦–å…ˆå‘é€ä¸€ä¸ªHTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œå¹¶å°†Upgradeå¤´éƒ¨å­—æ®µè®¾ç½®ä¸º&#34;websocket&#34;ï¼Œè¡¨ç¤ºå¸Œæœ›å‡çº§åˆ°WebSocketåè®®ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œå¦‚æœæ”¯æŒWebSocketåè®®ï¼Œä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç 101 Switching Protocolsçš„HTTPå“åº”ï¼Œå¹¶é€šè¿‡Upgradeå¤´éƒ¨å­—æ®µå°†è¿æ¥å‡çº§ä¸ºWebSocketè¿æ¥ã€‚
å‡çº§å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ä¸å†éµå¾ªHTTPè¯·æ±‚-å“åº”æ¨¡å¼ï¼Œè€Œæ˜¯é€šè¿‡WebSocketåè®®è¿›è¡ŒåŒå‘çš„å®æ—¶é€šä¿¡ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ç›´æ¥å‘é€æ¶ˆæ¯ç»™å¯¹æ–¹ï¼Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹çš„è¯·æ±‚ã€‚
å¦‚ä½•ä½¿ç”¨WebSocket å»ºç«‹WebSocketè¿æ¥: è¦å»ºç«‹WebSocketè¿æ¥ï¼Œéœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œç³»åˆ—çš„æ¡æ‰‹æ“ä½œã€‚ä¸‹é¢æ˜¯è¯¦ç»†çš„ä»£ç æ•™ç¨‹ï¼Œç¤ºäº†å¦‚ä½•åœ¨Webåº”ç”¨ç¨‹åºä¸­å»ºç«‹WebSocketè¿æ¥ã€‚
åœ¨æˆ·ç«¯ï¼ˆJavaScriptï¼‰ï¼š
// åˆ›å»ºWebSocketå¯¹è±¡å¹¶æŒ‡å®šæœåŠ¡å™¨åœ°å€ var socket = new WebSocket(&#34;ws://example.com/socket&#34;); // ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶ socket.onopen = function() { console.log(&#34;WebSocketè¿æ¥å·²å»ºç«‹&#34;); // åœ¨è¿æ¥å»ºç«‹åï¼Œå¯ä»¥å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨ socket.send(&#34;Hello Server!&#34;); }; // ç›‘å¬æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ socket.onmessage = function(event) { var message = event.data; console.log(&#34;æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼š&#34; &#43; message); }; // ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶ socket.onclose = function(event) { console.log(&#34;WebSocketè¿æ¥å·²å…³é—­&#34;); }; // ç›‘å¬è¿æ¥é”™è¯¯äº‹ä»¶ socket.onerror = function(event) { console.error(&#34;WebSocketè¿æ¥é”™è¯¯ï¼š&#34; &#43; event}; åœ¨æœåŠ¡å™¨ç«¯ï¼ˆç¤ºä¾‹ä½¿ç”¨Node." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/fdb5948e73802232932b1ee0f78d1265/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-24T10:24:44+08:00" />
<meta property="article:modified_time" content="2023-10-24T10:24:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ITå­¦ä¹ è€…åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ITå­¦ä¹ è€…åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å‰ç«¯ï¼ˆäºŒåä¸€ï¼‰â€”â€”WebSocketï¼šå®ç°å®æ—¶åŒå‘æ•°æ®ä¼ è¾“çš„Webé€šä¿¡åè®®</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/a1/56/rCCyqPae_o.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ğŸ¤¨åšä¸»ï¼šå°çŒ«å¨ƒæ¥å•¦<br> ğŸ¤¨æ–‡ç« æ ¸å¿ƒï¼š<strong>WebSocketï¼šå®ç°å®æ—¶åŒå‘æ•°æ®ä¼ è¾“çš„Webé€šä¿¡åè®®</strong></p> 
<p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#_7" rel="nofollow">å‰è¨€</a></li><li><a href="#WebSocket_11" rel="nofollow">WebSocketåŸç†</a></li><li><a href="#WebSocket_22" rel="nofollow">å¦‚ä½•ä½¿ç”¨WebSocket</a></li><li><ul><li><a href="#WebSocket_23" rel="nofollow">å»ºç«‹WebSocketè¿æ¥:</a></li><li><a href="#_84" rel="nofollow">æ•°æ®ä¼ è¾“:</a></li></ul> 
  </li><li><a href="#WebSocket_118" rel="nofollow">WebSocketçš„çœŸå®ä½¿ç”¨åœºæ™¯</a></li><li><ul><li><a href="#_119" rel="nofollow">å³æ—¶é€šè®¯:</a></li><li><a href="#_197" rel="nofollow">å¤šäººåä½œ:</a></li><li><a href="#_286" rel="nofollow">å®æ—¶æ•°æ®æ›´æ–°:</a></li></ul> 
  </li><li><a href="#WebSocket_367" rel="nofollow">WebSocketçš„ä¼˜åŠ¿ä¸å±€é™æ€§</a></li><li><a href="#_394" rel="nofollow">ç»“è®º</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_7"></a>å‰è¨€</h2> 
<p>åœ¨å½“ä»Šäº’è”ç½‘æ—¶ä»£ï¼Œå®æ—¶é€šä¿¡å·²æˆä¸ºå¾ˆå¤šåº”ç”¨çš„éœ€æ±‚ã€‚ä¸ºäº†æ»¡è¶³è¿™ç§éœ€æ±‚ï¼ŒWebSocketåè®®è¢«è®¾è®¡å‡ºæ¥ã€‚WebSocketæ˜¯ä¸€ç§åŸºäºTCPè®®çš„å…¨åŒå·¥é€šä¿¡åè®®ï¼Œé€šè¿‡WebSocketï¼ŒWebåº”ç”¨ç¨‹åºå¯ä»¥ä¸æœåŠ¡å™¨å»ºç«‹æŒä¹…çš„è¿æ¥ï¼Œå®ç°å®æ—¶åŒå‘æ•°æ®è¾“ï¼Œæä¾›æä½çš„å»¶è¿Ÿå’Œé«˜æ•ˆçš„æ•°æ®ä¼ è¾“ã€‚</p> 
<hr> 
<h2><a id="WebSocket_11"></a>WebSocketåŸç†</h2> 
<ul><li>HTTPè¯·æ±‚-å“åº”åè®®</li></ul> 
<p>åœ¨ç†è§£WebSocketåŸç†ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£HTTPè¯·æ±‚-å“åº”åè®®ã€‚HTTPæ˜¯ä¸€ç§æ— çŠ¶æ€çš„è¯·æ±‚-å“åº”åè®®ï¼Œå®¢æˆ·ç«¯é€šè¿‡å‘é€HTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨æ¥æ”¶å¹¶å¤„ç†è¯·æ±‚ï¼Œå¹¶è¿”å›HTTPå“åº”ç»™å®¢æˆ·ç«¯ã€‚ä½†æ˜¯ï¼Œåœ¨ä¼ ç»Ÿçš„HTTPåè®®ä¸­ï¼Œå®¢æˆ·ç«¯åªèƒ½å‘é€è¯·æ±‚ï¼Œè€ŒæœåŠ¡å™¨åªèƒ½é€šè¿‡å“åº”æ¥å¤„ç†å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p> 
<ul><li>WebSocketåè®®</li></ul> 
<p>WebSocketåè®®æ˜¯åœ¨HTTPåè®®çš„åŸºç¡€ä¸Šè¿›è¡Œæ‰©å±•çš„ã€‚åœ¨å»ºç«‹WebSocketè¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯é¦–å…ˆå‘é€ä¸€ä¸ªHTTPè¯·æ±‚åˆ°æœåŠ¡å™¨ï¼Œå¹¶å°†Upgradeå¤´éƒ¨å­—æ®µè®¾ç½®ä¸º"websocket"ï¼Œè¡¨ç¤ºå¸Œæœ›å‡çº§åˆ°WebSocketåè®®ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°è¿™ä¸ªè¯·æ±‚åï¼Œå¦‚æœæ”¯æŒWebSocketåè®®ï¼Œä¼šè¿”å›ä¸€ä¸ªçŠ¶æ€ç 101 Switching Protocolsçš„HTTPå“åº”ï¼Œå¹¶é€šè¿‡Upgradeå¤´éƒ¨å­—æ®µå°†è¿æ¥å‡çº§ä¸ºWebSocketè¿æ¥ã€‚</p> 
<p>å‡çº§å®Œæˆåï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´çš„é€šä¿¡ä¸å†éµå¾ªHTTPè¯·æ±‚-å“åº”æ¨¡å¼ï¼Œè€Œæ˜¯é€šè¿‡WebSocketåè®®è¿›è¡ŒåŒå‘çš„å®æ—¶é€šä¿¡ã€‚å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥ç›´æ¥å‘é€æ¶ˆæ¯ç»™å¯¹æ–¹ï¼Œä¸éœ€è¦ç­‰å¾…å¯¹æ–¹çš„è¯·æ±‚ã€‚</p> 
<hr> 
<h2><a id="WebSocket_22"></a>å¦‚ä½•ä½¿ç”¨WebSocket</h2> 
<h3><a id="WebSocket_23"></a>å»ºç«‹WebSocketè¿æ¥:</h3> 
<p>è¦å»ºç«‹WebSocketè¿æ¥ï¼Œéœ€è¦åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œç³»åˆ—çš„æ¡æ‰‹æ“ä½œã€‚ä¸‹é¢æ˜¯è¯¦ç»†çš„ä»£ç æ•™ç¨‹ï¼Œç¤ºäº†å¦‚ä½•åœ¨Webåº”ç”¨ç¨‹åºä¸­å»ºç«‹WebSocketè¿æ¥ã€‚</p> 
<p>åœ¨æˆ·ç«¯ï¼ˆJavaScriptï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token comment">// åˆ›å»ºWebSocketå¯¹è±¡å¹¶æŒ‡å®šæœåŠ¡å™¨åœ°å€</span>
<span class="token keyword">var</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"ws://example.com/socket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å»ºç«‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åœ¨è¿æ¥å»ºç«‹åï¼Œå¯ä»¥å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨</span>
  socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello Server!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> message <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥é”™è¯¯äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥é”™è¯¯ï¼š"</span> <span class="token operator">+</span> event<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨æœåŠ¡å™¨ç«¯ï¼ˆç¤ºä¾‹ä½¿ç”¨Node.jsï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> WebSocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"ws"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»ºWebSocketæœåŠ¡å™¨</span>
<span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span>
wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"connection"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å»ºç«‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span>
    socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello Client!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡åˆ›å»ºWebSocketå¯¹è±¡ï¼Œå¹¶æŒ‡å®šæœåŠ¡å™¨åœ°å€"ws://example.com/socket"æ¥å»ºç«‹WebSocketè¿æ¥ã€‚åŒæ—¶ï¼Œå®¢æˆ·ç«¯é€šè¿‡ç›‘å¬onopenäº‹ä»¶ï¼Œå¯ä»¥åœ¨è¿æ¥å»ºç«‹åå‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨ã€‚æœåŠ¡å™¨ç«¯ä½¿ç”¨WebSocket.Serverç±»åˆ›å»ºWebSocketæœåŠ¡å™¨ï¼Œå¹¶ç›‘å¬"connectionäº‹ä»¶æ¥å¤„ç†è¿æ¥å»ºç«‹åçš„æ“ä½œã€‚æœåŠ¡å™¨ç«¯é€šè¿‡socket.on(â€œmessageâ€)æ¥ç›‘å¬æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶é€šè¿‡socket.send()å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚</p> 
<h3><a id="_84"></a>æ•°æ®ä¼ è¾“:</h3> 
<p>å»ºç«‹WebSocketè¿æ¥åï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡WebSocketå¯¹è±¡è¿›è¡ŒåŒå‘çš„å®æ—¶æ•°æ®ä¼ è¾“ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªç¤ºä¾‹ä»£ç ï¼Œæ¼”ç¤ºäº†å¦‚ä½•åœ¨å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚</p> 
<p>åœ¨å®¢æˆ·ç«¯ï¼ˆJavaScriptï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token comment">// å‘é€æ¶ˆæ¯åˆ°æœåŠ¡å™¨</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello Server!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> message <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨æœåŠ¡å™¨ç«¯ï¼ˆç¤ºä¾‹ä½¿ç”¨Node.jsï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token comment">// å‘å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span>
socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">"Hello Client!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</span>
socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨ä»¥ä¸Šä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡è°ƒç”¨<code>socket.send()</code>æ–¹æ³•å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡å™¨ï¼ŒæœåŠ¡å™¨é€šè¿‡<code>socket.send()</code>æ–¹æ³•å°†æ¶ˆæ¯å‘é€åˆ°å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯é€šè¿‡ç›‘å¬<code>socket.onmessage</code>äº‹ä»¶æ¥æ¥æ”¶æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼ŒæœåŠ¡å™¨é€šè¿‡ç›‘å¬<code>socket.on("message")</code>äº‹ä»¶æ¥æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ã€‚</p> 
<p>é€šè¿‡ä»¥ä¸Šä»£ç ç¤ºä¾‹ï¼Œä½ å¯ä»¥è¯¦ç»†äº†è§£å¦‚ä½•ä½¿ç”¨WebSocketå»ºç«‹è¿æ¥å¹¶è¿›è¡Œæ•°æ®ä¼ è¾“ã€‚è¯·æ³¨æ„ï¼Œç¤ºä¾‹ä»£ç ä¸­ä½¿ç”¨çš„æœåŠ¡å™¨åœ°å€å’Œç«¯å£å·éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œä¿®æ”¹ã€‚åŒæ—¶ï¼Œä½ è¿˜å¯ä»¥åœ¨å…·ä½“åº”ç”¨ä¸­æ ¹æ®éœ€è¦ä½¿ç”¨WebSocketçš„å…¶ä»–æ–¹æ³•å’Œäº‹ä»¶æ¥å®ç°æ›´å¤æ‚çš„åŠŸèƒ½ã€‚</p> 
<hr> 
<h2><a id="WebSocket_118"></a>WebSocketçš„çœŸå®ä½¿ç”¨åœºæ™¯</h2> 
<h3><a id="_119"></a>å³æ—¶é€šè®¯:</h3> 
<p>WebSocketéå¸¸é€‚åˆç”¨äºå³æ—¶é€šè®¯åº”ç”¨ï¼Œå› ä¸ºå®ƒèƒ½å¤Ÿå®ç°å®æ—¶åŒå‘é€šä¿¡ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„å³æ—¶èŠå¤©åº”ç”¨çš„ä»£ç æ•™ç¨‹ã€‚</p> 
<p>åœ¨å®¢æˆ·ç«¯ï¼ˆJavaScriptï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token comment">// åˆ›å»ºWebSocketå¯¹è±¡å¹¶æŒ‡å®šæœåŠ¡å™¨åœ°å€</span>
<span class="token keyword">var</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"ws://example.com/socket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å»ºç«‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ç›‘å¬æ–‡æœ¬æ¡†è¾“å…¥ï¼ŒæŒ‰ä¸‹Enteré”®æ—¶å‘é€æ¶ˆæ¯</span>
  <span class="token keyword">var</span> input <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"input"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  input<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"keyup"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>keyCode <span class="token operator">===</span> <span class="token number">13</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">var</span> message <span class="token operator">=</span> input<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
      socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
      input<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> message <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯æ˜¾ç¤ºåœ¨èŠå¤©çª—å£ä¸­</span>
  <span class="token keyword">var</span> chatWindow <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"chatWindow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  chatWindow<span class="token punctuation">.</span>innerHTML <span class="token operator">+=</span> <span class="token string">"&lt;p&gt;"</span> <span class="token operator">+</span> message <span class="token operator">+</span> <span class="token string">"&lt;/p&gt;"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥é”™è¯¯äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥é”™è¯¯ï¼š"</span> <span class="token operator">+</span> event<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨æœåŠ¡å™¨ç«¯ï¼ˆç¤ºä¾‹ä½¿ç”¨Node.jsï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> WebSocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"ws"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»ºWebSocketæœåŠ¡å™¨</span>
<span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span>
wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"connection"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å»ºç«‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span>
    wss<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡åˆ›å»ºWebSocketå¯¹è±¡è¿æ¥åˆ°æœåŠ¡å™¨ã€‚è¾“å…¥æ¡†ä¸­çš„æ–‡æœ¬æ¡†ç”¨äºå½•å…¥è¦å‘é€çš„æ¶ˆæ¯ï¼ŒæŒ‰ä¸‹Enteré”®æ—¶ä¼šå°†æ¶ˆæ¯å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°æ¶ˆæ¯åï¼Œé€šè¿‡éå†æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œå‘æ¯ä¸ªå®¢æˆ·ç«¯å‘é€æ¶ˆæ¯ã€‚</p> 
<p>è¿™æ ·ï¼Œå¤šä¸ªå®¢æˆ·ç«¯å°±å¯ä»¥å®æ—¶åœ°è¿›è¡ŒèŠå¤©ï¼Œå¹¶ä¸”æ‰€æœ‰çš„æ¶ˆæ¯éƒ½ä¼šå®æ—¶åœ°åœ¨å„ä¸ªå®¢æˆ·ç«¯ä¹‹é—´åŒæ­¥æ˜¾ç¤ºã€‚</p> 
<h3><a id="_197"></a>å¤šäººåä½œ:</h3> 
<p>WebSocketè¿˜å¯ç”¨äºå¤šäººåä½œåº”ç”¨ï¼Œè®©å¤šä¸ªç”¨æˆ·å¯ä»¥å®æ—¶åœ°ååŒç¼–è¾‘æ–‡æ¡£æˆ–ç”»å¸ƒã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç æ•™ç¨‹ã€‚</p> 
<p>åœ¨å®¢æˆ·ç«¯ï¼ˆJavaScriptï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token comment">// åˆ›å»ºWebSocketå¯¹è±¡å¹¶æŒ‡å®šæœåŠ¡å™¨åœ°å€</span>
<span class="token keyword">var</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"ws://example.com/socket"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å»ºç«‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç›‘å¬æ–‡æœ¬æ¡†è¾“å…¥ï¼ŒæŒ‰ä¸‹Enteré”®æ—¶å‘é€ç»˜ç”»æŒ‡ä»¤</span>
  <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">"mousedown"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// ç»˜ç”»æŒ‡ä»¤çš„æ•°æ®æ ¼å¼å¯ä»¥è‡ªå®šä¹‰ï¼Œè¿™é‡Œä½¿ç”¨äº†ç®€å•çš„ç¤ºä¾‹</span>
    <span class="token keyword">var</span> instruction <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">"draw"</span><span class="token punctuation">,</span>
      <span class="token literal-property property">position</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">x</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientX<span class="token punctuation">,</span>
        <span class="token literal-property property">y</span><span class="token operator">:</span> event<span class="token punctuation">.</span>clientY
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>instruction<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ ¹æ®æ¶ˆæ¯æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œç¤ºä¾‹ä¸­å¤„ç†äº†ç»˜ç”»æŒ‡ä»¤</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>message<span class="token punctuation">.</span>type <span class="token operator">===</span> <span class="token string">"draw"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> canvas <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"canvas"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> ctx <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">beginPath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">arc</span><span class="token punctuation">(</span>message<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x<span class="token punctuation">,</span> message<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token constant">PI</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span><span class="token function">fill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥é”™è¯¯äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥é”™è¯¯ï¼š"</span> <span class="token operator">+</span> event<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨æœåŠ¡å™¨ç«¯ï¼ˆç¤ºä¾‹ä½¿ç”¨Node.jsï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> WebSocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"ws"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»ºWebSocketæœåŠ¡å™¨</span>
<span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span>
wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"connection"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å»ºç«‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"message"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">message</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å‘é€æ¶ˆæ¯</span>
    wss<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡åˆ›å»ºWebSocketå¯¹è±¡è¿æ¥åˆ°æœåŠ¡å™¨ã€‚å½“é¼ æ ‡åœ¨ç”»å¸ƒä¸ŠæŒ‰ä¸‹æ—¶ï¼Œå°†ç»˜ç”»æŒ‡ä»¤å‘é€ç»™æœåŠ¡å™¨ã€‚æœåŠ¡å™¨æ¥æ”¶åˆ°ç»˜ç”»æŒ‡ä»¤åï¼Œå°†æŒ‡ä»¤å¹¿æ’­ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œå¹¶åœ¨å„ä¸ªå®¢æˆ·ç«¯ä¸Šè¿›è¡Œç»˜ç”»æ“ä½œã€‚</p> 
<p>è¿™æ ·ï¼Œå¤šä¸ªç”¨æˆ·å°±å¯ä»¥å®æ—¶åœ°ååŒç¼–è¾‘åŒä¸€ä¸ªç”»å¸ƒæˆ–æ–‡æ¡£ï¼Œæ‰€æœ‰çš„ç»˜ç”»æŒ‡ä»¤éƒ½ä¼šå³æ—¶åŒæ­¥åœ¨å„ä¸ªå®¢æˆ·ç«¯ä¹‹é—´ã€‚</p> 
<h3><a id="_286"></a>å®æ—¶æ•°æ®æ›´æ–°:</h3> 
<p>WebSocketè¿˜å¯ä»¥ç”¨äºå®æ—¶æ•°æ®æ›´æ–°åº”ç”¨ï¼Œä¾‹å¦‚è‚¡ç¥¨äº¤æ˜“åº”ç”¨ä¸­çš„å®æ—¶è‚¡ç¥¨ä»·æ ¼æ›´æ–°ã€‚ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ä»£ç æ•™ç¨‹ã€‚</p> 
<p>åœ¨å®¢æˆ·ç«¯ï¼ˆJavaScriptï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token comment">// åˆ›å»ºWebSocketå¯¹è±¡å¹¶æŒ‡å®šæœåŠ¡å™¨åœ°å€</span>
<span class="token keyword">var</span> socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">"é“¾æ¥"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å»ºç«‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> message <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼š"</span> <span class="token operator">+</span> message<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// å¯¹æ¥æ”¶åˆ°çš„å®æ—¶æ•°æ®è¿›è¡Œå¤„ç†</span>
  <span class="token keyword">var</span> stockPriceElement <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"stockPrice"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  stockPriceElement<span class="token punctuation">.</span>innerText <span class="token operator">=</span> message<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥é”™è¯¯äº‹ä»¶</span>
socket<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥é”™è¯¯ï¼š"</span> <span class="token operator">+</span> event<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨æœåŠ¡å™¨ç«¯ï¼ˆç¤ºä¾‹ä½¿ç”¨Node.jsï¼‰ï¼š</p> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> WebSocket <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"ws"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// åˆ›å»ºWebSocketæœåŠ¡å™¨</span>
<span class="token keyword">const</span> wss <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket<span class="token punctuation">.</span>Server</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">port</span><span class="token operator">:</span> <span class="token number">8080</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// æ¨¡æ‹Ÿå®æ—¶è‚¡ç¥¨ä»·æ ¼æ›´æ–°</span>
<span class="token function">setInterval</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">var</span> stockPrice <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
  
  <span class="token comment">// å‘æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯å‘é€å®æ—¶æ•°æ®</span>
  wss<span class="token punctuation">.</span>clients<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">client</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">price</span><span class="token operator">:</span> stockPrice
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ç›‘å¬è¿æ¥å»ºç«‹äº‹ä»¶</span>
wss<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"connection"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">socket</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å»ºç«‹"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 
  <span class="token comment">// åˆå§‹åŒ–å‘é€å®æ—¶æ•°æ®</span>
  <span class="token keyword">var</span> stockPrice <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">price</span><span class="token operator">:</span> stockPrice
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  socket<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// ç›‘å¬è¿æ¥å…³é—­äº‹ä»¶</span>
  socket<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"close"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"WebSocketè¿æ¥å·²å…³é—­"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼Œå®¢æˆ·ç«¯é€šè¿‡åˆ›å»ºWebSocketå¯¹è±¡è¿æ¥æœåŠ¡å™¨ã€‚æœåŠ¡å™¨ä½¿ç”¨setIntervalå‡½æ•°æ¨¡æ‹Ÿå®æ—¶è‚¡ç¥¨ä»·æ ¼çš„æ›´æ–°ï¼Œå¹¶å°†æ›´æ–°çš„æ•°æ®å‘é€ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯ã€‚å®¢æˆ·ç«¯ç›‘å¬æ¥æ”¶åˆ°æœåŠ¡å™¨å‘é€çš„æ¶ˆæ¯ï¼Œå¹¶å¤„ç†æ¥æ”¶åˆ°çš„å®æ—¶æ•°æ®ã€‚</p> 
<p>è¿™æ ·ï¼Œåœ¨è‚¡ç¥¨äº¤æ˜“åº”ç”¨ä¸­ï¼Œå¤šä¸ªç”¨æˆ·å¯ä»¥å®æ—¶åœ°æ¥æ”¶å’Œæ˜¾ç¤ºè‚¡ç¥¨ä»·æ ¼çš„æ›´æ–°ä¿¡æ¯ã€‚åŒ…æ‹¬æ‰“æ¸¸æˆçš„æ—¶å€™ï¼Œé˜Ÿå‹ä¹‹é—´äº’ç›¸æ²Ÿé€šï¼Œæ‰“å­—äº¤æµï¼Œæˆ–è€…èµ°ä½ï¼Œæ”¾æŠ€èƒ½ç­‰ç­‰ï¼Œéƒ½æ˜¯å³æ—¶çš„ã€‚</p> 
<hr> 
<h2><a id="WebSocket_367"></a>WebSocketçš„ä¼˜åŠ¿ä¸å±€é™æ€§</h2> 
<ul><li><strong>WebSocketçš„ä¼˜åŠ¿:</strong></li></ul> 
<blockquote> 
 <ul><li> <p>åŒå‘å®æ—¶é€šä¿¡ï¼šWebSocketæä¾›äº†åŒå‘çš„å®æ—¶ä¿¡èƒ½åŠ›ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å¯ä»¥é€šè¿‡è¯¥åè®®è¿›è¡ŒåŒå‘æ•°æ®ä¼ è¾“ï¼Œå®æ—¶åé¦ˆæ›´æ–°ä¿¡æ¯ï¼Œå®ç°å³æ—¶é€šè®¯ã€å®æ—¶æ•°æ®æ¨é€ç­‰åŠŸèƒ½ã€‚</p> </li><li> <p>è¾ƒä½çš„å»¶è¿Ÿï¼šä¸ä¼ ç»Ÿçš„HTTPè¯·æ±‚ç›¸æ¯”ï¼ŒWebSocketé™ä½äº†é€šä¿¡çš„å¼€é”€ï¼Œå‡å°‘äº†ä¼ è¾“å’Œå¤„ç†æ•°æ®çš„å»¶è¿Ÿï¼Œå› æ­¤å¯ä»¥æ›´å¿«è¿›è¡Œå®æ—¶æ•°æ®ä¼ è¾“ã€‚</p> </li><li> <p>æ›´é«˜çš„æ€§èƒ½ï¼šç”±äºWebSocketä½¿ç”¨è¾ƒå°‘çš„å¤´éƒ¨ä¿¡æ¯å’Œæ›´æœ‰æ•ˆçš„æ¶ˆæ¯ä¼ è¾“æ ¼å¼ï¼Œå› æ­¤åœ¨ç›¸åŒå¸¦å®½ä¸‹å¯ä»¥ä¼ è¾“æ›´å¤šçš„æ•°æ®ï¼Œæé«˜äº†æ€§èƒ½å’Œæ•ˆç‡ã€‚</p> </li><li> <p>å¹¿æ³›çš„æµè§ˆå™¨æ”¯æŒï¼šWebSocketæ˜¯HTML5çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”å¾—åˆ°äº†å¤§å¤šæ•°ç°ä»£æµè§ˆå™¨çš„æ”¯æŒï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨å„ç§å¹³å°å’Œè®¾å¤‡ä¸Šä½¿ç”¨ã€‚</p> </li><li> <p>è¿æ¥ä¿æŒï¼šä¸ä¼ ç»Ÿçš„HTTPè¯·æ±‚ä¸åŒï¼ŒWebSocketè¿æ¥ä¿æŒåœ¨å»ºç«‹ä¹‹åï¼ŒåŒæ–¹å¯ä»¥éšæ—¶è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œé¿å…äº†ä¸å¿…è¦çš„è¿æ¥å’Œæ–­å¼€æ“ä½œã€‚</p> </li></ul> 
</blockquote> 
<ul><li><strong>WebSocketçš„å±€é™æ€§</strong>:</li></ul> 
<blockquote> 
 <ul><li> <p>å…¼å®¹æ€§é—®é¢˜ï¼šè™½ç„¶ç°ä»£æµè§ˆå™¨å¹¿æ³›æ”¯æŒWebSocketï¼Œä½†åœ¨æŸäº›æ—§ç‰ˆæœ¬æˆ–ç‰¹å®šè®¾å¤‡ä¸Šå¯èƒ½å­˜åœ¨å…¼å®¹æ€§é—®é¢˜ã€‚ä¸ºäº†å…¼å®¹æ€§ï¼Œå¯ä»¥ä½¿ç”¨è½®è®­æŠ€æœ¯ï¼ˆå¦‚é•¿è½®è¯¢ï¼‰ä½œä¸ºå¤‡é€‰æ–¹æ¡ˆã€‚</p> </li><li> <p>éƒ¨ç½²å’Œç»´æŠ¤å¤æ‚æ€§ï¼šWebSocketæœåŠ¡å™¨çš„è®¾ç½®å’Œé…ç½®å¯èƒ½æ¯”ä¼ ç»Ÿçš„WebæœåŠ¡å™¨å¤æ‚ä¸€äº›ï¼Œéœ€è¦ä¸“é—¨çš„æœåŠ¡å™¨ç¯å¢ƒå’Œé…ç½®ã€‚</p> </li><li> <p>å®‰å…¨æ€§é—®é¢˜ï¼šç”±äºWebSocketæ˜¯åœ¨HTTPåè®®çš„åŸºç¡€ä¸Šå»ºç«‹çš„ï¼Œå®ƒä»¬å…±äº«ç›¸åŒçš„å®‰å…¨é£é™©ï¼Œä¾‹å¦‚è·¨ç«™ç‚¹è„šæœ¬ï¼ˆXSSï¼‰å’Œè·¨ç«™è¯·æ±‚ä¼ªé€ ï¼ˆCSRFï¼‰ã€‚å› æ­¤ï¼Œåœ¨ä½¿ç”¨WebSocketæ—¶éœ€è¦è€ƒè™‘åˆ°å®‰å…¨æ€§ï¼Œå¹¶é‡‡å–é€‚å½“çš„å®‰å…¨æªæ–½ã€‚</p> </li><li> <p>æ‰©å±•é—®é¢˜ï¼šWebSocketåè®®è¿˜ä¸æ”¯æŒåƒHTTP/2é‚£æ ·çš„ä¸€äº›é«˜çº§ç‰¹æ€§ï¼Œä¾‹å¦‚å¤´éƒ¨å‹ç¼©å’Œæµé‡æ§åˆ¶ã€‚åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œå¯èƒ½éœ€è¦é€šè¿‡å…¶ä»–æ–¹å¼å®ç°è¿™äº›åŠŸèƒ½ã€‚</p> </li></ul> 
</blockquote> 
<p>å°½ç®¡WebSocketå…·æœ‰ä¸Šè¿°å±€é™æ€§ï¼Œä½†å®ƒä»ç„¶æ˜¯å®æ—¶é€šè®¯ã€å®æ—¶æ•°æ®ä¼ è¾“å’Œå®æ—¶åä½œç­‰åœºæ™¯ä¸‹çš„é¦–é€‰åè®®ï¼Œå› ä¸ºå®ƒå…·å¤‡äº†åŒå‘å®æ—¶é€šä¿¡å’Œè¾ƒä½å»¶è¿Ÿç­‰ä¸€ç³»åˆ—çš„ä¼˜åŠ¿ã€‚åœ¨å¼€å‘æ—¶ï¼Œéœ€è¦æ ¹æ®å…·ä½“éœ€æ±‚å’Œé™åˆ¶ï¼Œç»¼åˆè€ƒè™‘ä½¿ç”¨WebSocketçš„é€‚ç”¨æ€§ã€‚</p> 
<hr> 
<h2><a id="_394"></a>ç»“è®º</h2> 
<p>WebSocketæ˜¯ä¸€ç§èƒ½å¤Ÿæä¾›åŒå‘å®æ—¶é€šä¿¡çš„åè®®ï¼Œé€‚ç”¨äºéœ€è¦å®æ—¶æ•°æ®ä¼ è¾“å’ŒåŒå‘é€šä¿¡çš„åœºæ™¯ã€‚å®ƒå…·æœ‰è¾ƒä½çš„å»¶è¿Ÿã€æ›´é«˜çš„æ€§å’Œå¹¿æ³›çš„æµè§ˆå™¨æŒç­‰ä¼˜åŠ¿ï¼Œèƒ½å¤Ÿå®ç°å³æ—¶é€šè®¯ã€å¤šäººåå’Œå®æ—¶æ•°æ®æ›´æ–°ç­‰åŠŸèƒ½ã€‚</p> 
<p>ç„¶è€Œï¼ŒWebSocketä¹Ÿå­˜åœ¨å…¼å®¹æ€§ã€éƒ¨ç½²å’Œç»´æŠ¤å¤æ‚æ€§ã€å®‰å…¨æ€§é—®é¢˜ä»¥åŠç¼ºä¹ä¸€äº›é«˜çº§ç‰¹æ€§ç­‰å±€é™æ€§ã€‚åœ¨å¼€å‘æ—¶ï¼Œéœ€è¦ä»”ç»†è€ƒè™‘å…·ä½“éœ€æ±‚å’Œé™åˆ¶ï¼Œå¹¶å¿…è¦æ—¶é‡‡å–é€‚å½“çš„è§£å†³æ–¹æ¡ˆã€‚</p> 
<p>æ€»çš„æ¥è¯´ï¼ŒWebSocketåœ¨å®æ—¶é€šä¿¡å’Œå®æ—¶æ•°æ®ä¼ è¾“æ–¹é¢å…·æœ‰æ˜æ˜¾çš„ä¼˜åŠ¿ï¼Œæ˜¯æ„å»ºç°ä»£Webåº”ç”¨çš„é‡è¦å·¥å…·ä¹‹ä¸€ã€‚</p> 
<p><img src="https://images2.imgbox.com/04/0b/YneMir5e_o.gif" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<hr>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8e7db5b8dc4ad218b8d4b95495b8d996/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">æºç ç¼–è¯‘å®‰è£…Apache</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c2a18d415342132b358b8efc59b48d15/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">npmæŠ¥é”™npm ERR! A complete log of this run can be found in</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ITå­¦ä¹ è€…åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>