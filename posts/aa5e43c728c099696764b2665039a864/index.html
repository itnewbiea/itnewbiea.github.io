<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>IPV6 | 华为思科配置 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="IPV6 | 华为思科配置" />
<meta property="og:description" content="目录
一. 前言：为什么需要IPV6地址
二. IPV4 与IPV6地址
1.IPV4地址
2.IPV6地址
三．IPV6地址的分类
1.单播地址
2.组播地址
3.任意播地址
四．NDP（邻居发现协议）
1.什么是邻居发现协议NDP？
2.ICMPv6（Internet控制报文协议）
3.IPV6 MAC地址解析
4.跟踪邻居状态（邻居可达性检测）
5.重复地址检测DAD
6.路由器发现
7.重定向
一. 前言：为什么需要IPV6地址 IPV4地址短缺
IPV6（Internet Protocol Version 6）是IPV4的升级版本。
世界上的每一粒沙子都能分配到一个IPV6地址，有趣故事：棋盘上的麦粒
二. IPV4 与IPV6地址 1.IPV4地址 (1) IPV4地址总长度为32bit，每8bit为一组，分为4组，采用点分十进制表示
(2）IPV4地址分为网络位和主机位部分，例如：192.168.1.1/24
（3）IPV4的报文格式
2.IPV6地址 （1）IPV6地址长度为128bit，每16bit为一组，分为8组，采用冒号十六进制表示
（2）IPV6提供了压缩格式，书写方便
每组的前导0都可以省略地址中包含的连续两个或多个均为0的组，可以用双冒号“：：”来代替，但只能使用一次 习题：
缩写
2001:FE00:0014:0000:0000:0000:0101:1000
解：2001:FE00:14::101:1000
FCC0:0000:0000:0010:0000:0000:0001:0002
解：FCC0::10:0:0:1:2
复原
2003::3030:1:2
解：2003:0000:0000:0000:0000:3030:0001:0002
FF00:99::10:101:1110
解：FF00:0099:0000:0000:0000:0010:0101:1110
（3）IPV6地址由网络前缀，接口标识组成
例如：FC00:0000:130F:0000:0000:09C0:876A:130B/96
96/16=6 前6组为网络前缀，后两组为接口标识
网络前缀不动，接口标识的取值从0到F
该IPV6地址的取值范围为:
FC00:0000:130F:0000:0000:09C0: 0000 0000 0000 0000 ：0000 0000 0000 0000
~
FC00:0000:130F:0000:0000:09C0: 1111 1111 1111 1111 ：1111 1111 1111 1111" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/aa5e43c728c099696764b2665039a864/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-29T16:19:51+08:00" />
<meta property="article:modified_time" content="2022-12-29T16:19:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">IPV6 | 华为思科配置</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80.%E5%89%8D%E8%A8%80%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81IPV6%E5%9C%B0%E5%9D%80-toc" style="margin-left:0px;"><a href="#%E4%B8%80.%E5%89%8D%E8%A8%80%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81IPV6%E5%9C%B0%E5%9D%80" rel="nofollow">一. 前言：为什么需要IPV6地址</a></p> 
<p id="%E4%BA%8C.IPV4%20%E4%B8%8EIPV6%E5%9C%B0%E5%9D%80-toc" style="margin-left:0px;"><a href="#%E4%BA%8C.IPV4%20%E4%B8%8EIPV6%E5%9C%B0%E5%9D%80" rel="nofollow">二. IPV4 与IPV6地址</a></p> 
<p id="1.IPV4%E5%9C%B0%E5%9D%80-toc" style="margin-left:40px;"><a href="#1.IPV4%E5%9C%B0%E5%9D%80" rel="nofollow">1.IPV4地址</a></p> 
<p id="2.IPV6%E5%9C%B0%E5%9D%80-toc" style="margin-left:40px;"><a href="#2.IPV6%E5%9C%B0%E5%9D%80" rel="nofollow">2.IPV6地址</a></p> 
<p id="%E4%B8%89%EF%BC%8EIPV6%E5%9C%B0%E5%9D%80%E7%9A%84%E5%88%86%E7%B1%BB-toc" style="margin-left:0px;"><a href="#%E4%B8%89%EF%BC%8EIPV6%E5%9C%B0%E5%9D%80%E7%9A%84%E5%88%86%E7%B1%BB" rel="nofollow">三．IPV6地址的分类</a></p> 
<p id="1.%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80-toc" style="margin-left:40px;"><a href="#1.%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80" rel="nofollow">1.单播地址</a></p> 
<p id="2.%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80-toc" style="margin-left:40px;"><a href="#2.%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80" rel="nofollow">2.组播地址</a></p> 
<p id="3.%E4%BB%BB%E6%84%8F%E6%92%AD%E5%9C%B0%E5%9D%80-toc" style="margin-left:40px;"><a href="#3.%E4%BB%BB%E6%84%8F%E6%92%AD%E5%9C%B0%E5%9D%80" rel="nofollow">3.任意播地址</a></p> 
<p id="%E5%9B%9B%EF%BC%8ENDP%EF%BC%88%E9%82%BB%E5%B1%85%E5%8F%91%E7%8E%B0%E5%8D%8F%E8%AE%AE%EF%BC%89-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%EF%BC%8ENDP%EF%BC%88%E9%82%BB%E5%B1%85%E5%8F%91%E7%8E%B0%E5%8D%8F%E8%AE%AE%EF%BC%89" rel="nofollow">四．NDP（邻居发现协议）</a></p> 
<p id="1.%E4%BB%80%E4%B9%88%E6%98%AF%E9%82%BB%E5%B1%85%E5%8F%91%E7%8E%B0%E5%8D%8F%E8%AE%AENDP%EF%BC%9F-toc" style="margin-left:40px;"><a href="#1.%E4%BB%80%E4%B9%88%E6%98%AF%E9%82%BB%E5%B1%85%E5%8F%91%E7%8E%B0%E5%8D%8F%E8%AE%AENDP%EF%BC%9F" rel="nofollow">1.什么是邻居发现协议NDP？</a></p> 
<p id="2.ICMPv6%EF%BC%88Internet%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE%EF%BC%89-toc" style="margin-left:40px;"><a href="#2.ICMPv6%EF%BC%88Internet%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE%EF%BC%89" rel="nofollow">2.ICMPv6（Internet控制报文协议）</a></p> 
<p id="3.IPV6%20MAC%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90-toc" style="margin-left:40px;"><a href="#3.IPV6%20MAC%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90" rel="nofollow">3.IPV6 MAC地址解析</a></p> 
<p id="4.%E8%B7%9F%E8%B8%AA%E9%82%BB%E5%B1%85%E7%8A%B6%E6%80%81%EF%BC%88%E9%82%BB%E5%B1%85%E5%8F%AF%E8%BE%BE%E6%80%A7%E6%A3%80%E6%B5%8B%EF%BC%89-toc" style="margin-left:40px;"><a href="#4.%E8%B7%9F%E8%B8%AA%E9%82%BB%E5%B1%85%E7%8A%B6%E6%80%81%EF%BC%88%E9%82%BB%E5%B1%85%E5%8F%AF%E8%BE%BE%E6%80%A7%E6%A3%80%E6%B5%8B%EF%BC%89" rel="nofollow">4.跟踪邻居状态（邻居可达性检测）</a></p> 
<p id="5.%E9%87%8D%E5%A4%8D%E5%9C%B0%E5%9D%80%E6%A3%80%E6%B5%8BDAD-toc" style="margin-left:40px;"><a href="#5.%E9%87%8D%E5%A4%8D%E5%9C%B0%E5%9D%80%E6%A3%80%E6%B5%8BDAD" rel="nofollow">5.重复地址检测DAD</a></p> 
<p id="6.%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8F%91%E7%8E%B0-toc" style="margin-left:40px;"><a href="#6.%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8F%91%E7%8E%B0" rel="nofollow">6.路由器发现</a></p> 
<p id="7.%E9%87%8D%E5%AE%9A%E5%90%91-toc" style="margin-left:40px;"><a href="#7.%E9%87%8D%E5%AE%9A%E5%90%91" rel="nofollow">7.重定向</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80.%E5%89%8D%E8%A8%80%EF%BC%9A%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81IPV6%E5%9C%B0%E5%9D%80" style="text-align:justify;">一. 前言：为什么需要IPV6地址</h2> 
<p style="margin-left:.0001pt;text-align:justify;">IPV4地址短缺</p> 
<p style="margin-left:.0001pt;text-align:justify;">IPV6（Internet Protocol Version 6）是IPV4的升级版本。</p> 
<p style="margin-left:.0001pt;text-align:justify;">世界上的每一粒沙子都能分配到一个IPV6地址，有趣故事：棋盘上的麦粒</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="%E4%BA%8C.IPV4%20%E4%B8%8EIPV6%E5%9C%B0%E5%9D%80" style="text-align:justify;">二. IPV4 与IPV6地址</h2> 
<h3 id="1.IPV4%E5%9C%B0%E5%9D%80" style="margin-left:.0001pt;text-align:justify;">1.IPV4地址</h3> 
<p style="text-align:justify;">   (1)  IPV4地址总长度为32bit，每8bit为一组，分为4组，采用点分十进制表示</p> 
<p style="text-align:justify;">   (2）IPV4地址分为网络位和主机位部分，例如：192.168.1.1/24</p> 
<p style="text-align:justify;"> （3）IPV4的报文格式</p> 
<h3 id="2.IPV6%E5%9C%B0%E5%9D%80" style="margin-left:.0001pt;text-align:justify;">2.IPV6地址</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）IPV6地址长度为128bit，每16bit为一组，分为8组，采用冒号十六进制表示</p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）IPV6提供了压缩格式，书写方便</p> 
<ol><li style="text-align:justify;">每组的前导0都可以省略</li><li style="text-align:justify;">地址中包含的连续两个或多个均为0的组，可以用双冒号“：：”来代替，但只能使用一次</li></ol> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">习题：</p> 
 <p style="margin-left:.0001pt;text-align:justify;">缩写</p> 
 <p style="margin-left:.0001pt;text-align:justify;">2001:FE00:0014:0000:0000:0000:0101:1000</p> 
 <p style="margin-left:.0001pt;text-align:justify;">解：2001:FE00:14::101:1000</p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;">FCC0:0000:0000:0010:0000:0000:0001:0002</p> 
 <p style="margin-left:.0001pt;text-align:justify;">解：FCC0::10:0:0:1:2</p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;">复原</p> 
 <p style="margin-left:.0001pt;text-align:justify;">2003::3030:1:2</p> 
 <p style="margin-left:.0001pt;text-align:justify;">解：2003:0000:0000:0000:0000:3030:0001:0002</p> 
 <p style="margin-left:.0001pt;text-align:justify;"></p> 
 <p style="margin-left:.0001pt;text-align:justify;">FF00:99::10:101:1110</p> 
 <p style="margin-left:.0001pt;text-align:justify;">解：FF00:0099:0000:0000:0000:0010:0101:1110</p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（3）IPV6地址由<strong><span style="color:#ff0000;"><strong>网络前缀，接口标识</strong></span></strong>组成</p> 
<p style="margin-left:.0001pt;text-align:justify;">例如：<span style="background-color:#ffff00;">FC00:0000:130F:0000:0000:09C0:</span><span style="background-color:#00ff00;">876A:130B</span>/96</p> 
<p style="margin-left:.0001pt;text-align:justify;">96/16=6 前6组为网络前缀，后两组为接口标识</p> 
<p style="margin-left:.0001pt;text-align:justify;">网络前缀不动，接口标识的取值从0到F</p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">该IPV6地址的取值范围为:</p> 
 <p style="margin-left:.0001pt;text-align:justify;">FC00:0000:130F:0000:0000:09C0: 0000 0000 0000 0000 ：0000 0000 0000 0000</p> 
 <p style="margin-left:.0001pt;text-align:justify;">~</p> 
 <p style="margin-left:.0001pt;text-align:justify;">FC00:0000:130F:0000:0000:09C0: 1111 1111 1111 1111 ：1111 1111 1111 1111</p> 
 <p style="margin-left:.0001pt;text-align:justify;">即FC00:0000:130F:0000:0000:09C0:FFFF:FFFF</p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（4）IPV6接口生成的方法</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#fe2c24;">手工配置，系统通过软件自动生成或者IEEE EUI-64规范生成</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">EUI-64规范生成步骤：EUI-64规范是将接口的MAC地址转换为IPV6接口标识的过程</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="%E4%B8%89%EF%BC%8EIPV6%E5%9C%B0%E5%9D%80%E7%9A%84%E5%88%86%E7%B1%BB" style="margin-left:.0001pt;text-align:justify;">三．IPV6地址的分类</h2> 
<h3 id="1.%E5%8D%95%E6%92%AD%E5%9C%B0%E5%9D%80" style="margin-left:.0001pt;text-align:justify;">1.单播地址</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）特殊地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">0:0:0:0:0:0:0:0/128或者 ：：/128 <span style="color:#ff0000;">未知地址</span>，表示某个接口或者节点还没有IP地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">0:0:0:0:0:0:0:1/128或者：：1/128<span style="color:#ff0000;"> 环回地址</span>，用于测试连通性类似于IPV4的127.0.0.1/8</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（2）全球单播地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">类似于IPv4的<span style="color:#5b9bd5;">公网地址</span>，在Internet 上唯一，全球唯一</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">固定前3位为001，所以前缀为2000：：/3</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（3）唯一本地地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">类似于IPV4的<span style="color:#5b9bd5;">私有地址</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">固定前7位为1111110，所以前缀为FC00：：/7</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">唯一本地地址只能在本地网络内部被路由转发而不会在全球网络中被路由转发</p> 
<p style="margin-left:.0001pt;text-align:justify;">作用：IPV6中有时需要VPN的私有连接</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（4）链路本地地址（Link-Local Address）</p> 
<p style="margin-left:.0001pt;text-align:justify;">链路本地地址是自动生成的（生成条件：思科：启动IPV6  华为：接口配置IPV6地址）</p> 
<p style="margin-left:.0001pt;text-align:justify;">“链路本地”顾名思义，<span style="color:#ff0000;">只是在同一个二层内传播，不会被路由转发</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#ff0000;">固定前10位是1111111010，所以前缀是FE80：：/10</span>,接口标识（64bit）通过使用EUI-64或手工配置</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">作用：</p> 
<ol><li style="text-align:justify;">当接口没有配置IPV6地址的时候可以通信，</li><li style="text-align:justify;">邻居发现协议（若无状态自动地址分配）</li><li style="text-align:justify;">路由</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="2.%E7%BB%84%E6%92%AD%E5%9C%B0%E5%9D%80" style="margin-left:.0001pt;text-align:justify;">2.组播地址</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）IPV6组播地址的前缀是<span style="color:#ff0000;">FF00：：/8</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）Well-know组播地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">以下是常用的组播地址：</p> 
<table border="1" cellspacing="0"><tbody><tr><td style="background-color:#9cc2e5;width:69.65pt;"> <p style="margin-left:.0001pt;text-align:center;">多播地址</p> </td><td style="background-color:#9cc2e5;width:73.2pt;"> <p style="margin-left:.0001pt;text-align:center;">范围</p> </td><td style="background-color:#9cc2e5;width:105pt;"> <p style="margin-left:.0001pt;text-align:center;">含义</p> </td><td style="background-color:#9cc2e5;width:178.25pt;"> <p style="margin-left:.0001pt;text-align:center;">描述</p> </td></tr><tr><td style="vertical-align:top;width:69.65pt;"> <p style="margin-left:.0001pt;text-align:justify;">FF01::1</p> </td><td style="vertical-align:top;width:73.2pt;"> <p style="margin-left:.0001pt;text-align:justify;">节点</p> </td><td style="vertical-align:top;width:105pt;"> <p style="margin-left:.0001pt;text-align:justify;">所有节点</p> </td><td style="vertical-align:top;width:178.25pt;"> <p style="margin-left:.0001pt;text-align:justify;">在本地接口范围内的所有节点</p> </td></tr><tr><td style="vertical-align:top;width:69.65pt;"> <p style="margin-left:.0001pt;text-align:justify;">FF01::2</p> </td><td style="vertical-align:top;width:73.2pt;"> <p style="margin-left:.0001pt;text-align:justify;">节点</p> </td><td style="vertical-align:top;width:105pt;"> <p style="margin-left:.0001pt;text-align:justify;">所有路由器</p> </td><td style="vertical-align:top;width:178.25pt;"> <p style="margin-left:.0001pt;text-align:justify;">在本地接口范围内的所有路由器</p> </td></tr><tr><td style="vertical-align:top;width:69.65pt;"> <p style="margin-left:.0001pt;text-align:justify;">FF02::1</p> </td><td style="vertical-align:top;width:73.2pt;"> <p style="margin-left:.0001pt;text-align:justify;">本地链路</p> </td><td style="vertical-align:top;width:105pt;"> <p style="margin-left:.0001pt;text-align:justify;">所有节点</p> </td><td style="vertical-align:top;width:178.25pt;"> <p style="margin-left:.0001pt;text-align:justify;">在本地链路范围的所有节点</p> </td></tr><tr><td style="vertical-align:top;width:69.65pt;"> <p style="margin-left:.0001pt;text-align:justify;">FF02::2</p> </td><td style="vertical-align:top;width:73.2pt;"> <p style="margin-left:.0001pt;text-align:justify;">本地链路</p> </td><td style="vertical-align:top;width:105pt;"> <p style="margin-left:.0001pt;text-align:justify;">所有路由器</p> </td><td style="vertical-align:top;width:178.25pt;"> <p style="margin-left:.0001pt;text-align:justify;">在本地链路范围的所有路由器</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（3）被请求节点组播地址</p> 
<ol><li style="text-align:justify;"><span style="color:#ff0000;">由前缀FF02::1:FF/104和IPV6单播地址的最后24位组成</span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">例如：IPv6 地址是FC00::0000:0001,被请求节点组播地址：FF02::1:FF00:1</p> 
<ol><li style="text-align:justify;">IPv6没有广播，只有多播,IPv6中请求MAC地址的时候目的地为被请求节点地址</li><li style="text-align:justify;">每生成一个ipv6地址，都会对应生成一个被请求节点多播地址</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（4）IPv6组播MAC地址</p> 
<p style="margin-left:.0001pt;text-align:justify;">A.<span style="color:#ff0000;">固定前缀33:33+组播地址后32bit</span></p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">例如：</p> 
 <p style="margin-left:.0001pt;text-align:justify;">FF02::1 —&gt; 3333:0000:0001</p> 
 <p style="margin-left:.0001pt;text-align:justify;">FF02::FFAB:CDEF —&gt; 3333:FFAB:CDEF</p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">B.IPv4组播地址：规定IPv4 组播 MAC 地址的高 24 位为 01-00-5e，第 25 位为 0，低 23 位为 IPv4组播地址的低 23 位，例如：224.0.1.1 对应的组播 MAC地址为 01-00-5e-00-01-01</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="3.%E4%BB%BB%E6%84%8F%E6%92%AD%E5%9C%B0%E5%9D%80" style="margin-left:.0001pt;text-align:justify;">3.任意播地址</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）概念：</p> 
<ol><li style="text-align:justify;">一个任意播地址表示的是某种服务，它可能是多台设备，只有最近的节点接受IPV6数据包</li><li style="text-align:justify;">IPV6中没有为任意播规定单独的地址空间，任意播地址和单播地址使用相同的地址空间；</li><li style="text-align:justify;">只有一个节点（路由最近的节点）接口IPV6数据包，使用任意播地址的好处冗余及提高访问速率</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">注意：IPV6任意播地址仅可以被分配个路由设备，不能应用于手机。任意播地址不能作为IPV6报文的源地址</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">适用场景：DNS，HTTP</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="%E5%9B%9B%EF%BC%8ENDP%EF%BC%88%E9%82%BB%E5%B1%85%E5%8F%91%E7%8E%B0%E5%8D%8F%E8%AE%AE%EF%BC%89" style="text-align:justify;"><strong>四．NDP（邻居发现协议）</strong></h2> 
<p style="text-align:center;"><strong><img alt="" src="https://images2.imgbox.com/37/95/B6Zdx7lA_o.png"></strong></p> 
<p> </p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="1.%E4%BB%80%E4%B9%88%E6%98%AF%E9%82%BB%E5%B1%85%E5%8F%91%E7%8E%B0%E5%8D%8F%E8%AE%AENDP%EF%BC%9F" style="margin-left:.0001pt;text-align:justify;">1.什么是邻居发现协议NDP？</h3> 
<p style="margin-left:.0001pt;text-align:justify;">知识串通：</p> 
<p style="margin-left:.0001pt;text-align:justify;">首先我们要让R1与R2 ping通，在IPV4中要进行MAC地址解析/ARP解析,将MAC地址解析为IP地址。在IPV4里面我们的ARP解析的目的地址是全F，为广播地址。但是<span style="color:#0000ff;">在IPV6里面没有广播地址</span>，我们就要靠邻居发现协议NDP封装二层报文来发现目的地址。</p> 
<p style="margin-left:.0001pt;text-align:justify;">注：IPV6的二层报文格式</p> 
<p style="margin-left:.0001pt;text-align:justify;">SMAC：fe80::2e0:fcff:fef5:1e87  DMAC：fe80::2e0:fcff:feaf:63c2  |SIP：2012：：1 DIP：2012：：2|ICMP request</p> 
<p style="margin-left:.0001pt;text-align:center;"><img alt="" src="https://images2.imgbox.com/ea/1c/W2Z8tbZX_o.png"></p> 
<p> </p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="2.ICMPv6%EF%BC%88Internet%E6%8E%A7%E5%88%B6%E6%8A%A5%E6%96%87%E5%8D%8F%E8%AE%AE%EF%BC%89" style="margin-left:.0001pt;text-align:justify;">2.ICMPv6（Internet控制报文协议）</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）概念：Internet Control Message Protocol for the IPv6，Internet控制报文协议，是IPv6的基础协议。</p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）作用：</p> 
<p style="margin-left:.0001pt;text-align:justify;">在IPv4中，Internet控制报文协议ICMP（Internet Control Message Protocol）向源节点报告关于向目的地传输IP数据包过程中的错误和信息。它为诊断、信息和 管理目的定义了一些消息，如：目的不可达、数据包超长、超时、回应请求和回应应答等。</p> 
<p style="margin-left:.0001pt;text-align:justify;">在IPv6中，ICMPv6除了提供ICMPv4常用的功能之外，还是其它一些功能的 基础，如邻接点发现、无状态地址配置（包括重复地址检测）等。</p> 
<p style="text-align:justify;">（3）报文格式：（该图来自华为官网）</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/11/22/TB4ndUJV_o.png"></p> 
<p> </p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">注：ICMPv6差错报文用于报告在转发IPV6数据包过程中出现的错误，例如：<span style="color:#0000ff;">目标不可达</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">    ICMPv6消息报文用于<span style="color:#0000ff;">ping ；邻居发现</span>……</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（4）邻居发现协议（NDP）在ICMPv6中的类型</p> 
<table border="1" cellspacing="0"><tbody><tr><td style="background-color:#e7e6e6;width:79.45pt;"> <p style="margin-left:.0001pt;text-align:center;">ICMPv6类型</p> </td><td style="background-color:#e7e6e6;width:346.65pt;"> <p style="margin-left:.0001pt;text-align:center;">消息名称</p> </td></tr><tr><td style="background-color:#9cc2e5;width:79.45pt;"> <p style="margin-left:.0001pt;text-align:center;">Type = 133</p> </td><td style="background-color:#9cc2e5;width:346.65pt;"> <p style="margin-left:.0001pt;text-align:justify;">                                RS——（Router Solicitation，路由器请求）</p> </td></tr><tr><td style="background-color:#9cc2e5;width:79.45pt;"> <p style="margin-left:.0001pt;text-align:center;">Type = 134</p> </td><td style="background-color:#9cc2e5;width:346.65pt;"> <p style="margin-left:.0001pt;text-align:center;">RA——（Router Advertisement，路由器公告）</p> </td></tr><tr><td style="background-color:#ffd965;width:79.45pt;"> <p style="margin-left:.0001pt;text-align:center;">Type = 135</p> </td><td style="background-color:#ffd965;width:346.65pt;"> <p style="margin-left:.0001pt;text-align:justify;">                                NS——（Neighbor Solicitation，邻居请求）</p> </td></tr><tr><td style="background-color:#ffd965;width:79.45pt;"> <p style="margin-left:.0001pt;text-align:center;">Type = 136</p> </td><td style="background-color:#ffd965;width:346.65pt;"> <p style="margin-left:.0001pt;text-align:center;">NA——（Neighbor Advertisement，邻居公告）</p> </td></tr><tr><td style="background-color:#538135;width:79.45pt;"> <p style="margin-left:.0001pt;text-align:center;">Type = 137</p> </td><td style="background-color:#538135;width:346.65pt;"> <p style="margin-left:.0001pt;text-align:justify;">                                Redirect——（重定向消息）</p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="3.IPV6%20MAC%E5%9C%B0%E5%9D%80%E8%A7%A3%E6%9E%90" style="margin-left:.0001pt;text-align:justify;">3.IPV6 MAC地址解析</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）目的：保证数据链路层正确封装MAC地址，类似IPv4的地址解析</p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）ICMPv6报文类型：</p> 
<ul><li style="text-align:justify;">NS（Neighbor Solicitation）报文，Type=135，在地址解析中的作用类似于IPv4中的ARP请求报文。</li><li style="margin-left:.0001pt;text-align:justify;"><li style="text-align:justify;">NA（Neighbor Advertisement）报文，Type=136，在地址解析中的作用类似于IPv4中的ARP应答报文。</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;">（3）工作过程（例如HostA访问HostB）：</p> 
<ol><li style="text-align:justify;">HostA发送一个NS报文，请求Host B的MAC地址</li><li style="text-align:justify;">HostB收到NS报文后，看到Taget add为自己，HostB将对端的IP地址和MAC地址绑定到自己的邻居表并回应NA报文</li><li style="text-align:justify;">Host A收到NA后将对应IPv6地址和MAC地址绑定到自己的邻居表中，完成解析</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">（4）查看命令</p> 
<pre><code class="hljs">华为：

Display ipv6 neighbor //查看IPv6地址对应的MAC地址

reset ipv6 nei all //清楚邻居相关信息表项



思科：

show ipv6 neighbors

clear ipv6 neighbors</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="4.%E8%B7%9F%E8%B8%AA%E9%82%BB%E5%B1%85%E7%8A%B6%E6%80%81%EF%BC%88%E9%82%BB%E5%B1%85%E5%8F%AF%E8%BE%BE%E6%80%A7%E6%A3%80%E6%B5%8B%EF%BC%89" style="margin-left:.0001pt;text-align:justify;">4.跟踪邻居状态（邻居可达性检测）</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）目的：维护IPV6和MAC地址的对应关系，使邻居之间能够建立一种双向可信的连接。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）邻居状态：</p> 
<ul><li style="text-align:justify;">EMPTY：空</li><li style="margin-left:.0001pt;text-align:justify;"><li style="text-align:justify;">Incomplete：未完成；刚刚发送NS，还没有收到NA报文</li><li style="margin-left:.0001pt;text-align:justify;"><li style="text-align:justify;">Reachable：可达；收到NA，进入此状态，已经得到MAC地址；如果没有回应，连续发三次NS报文（每隔1s），即删除表项</li><li style="margin-left:.0001pt;text-align:justify;"><li style="text-align:justify;">Stale：陈旧 。如果一直没有通信，30s后进入陈旧状态；或者在Reachable状态下，收到邻居发送的报文，MAC地址不一致，马上进入陈旧状态。</li><li style="margin-left:.0001pt;text-align:justify;"><li style="text-align:justify;">Delay：延迟。如果发送数据，需要进行测试，发送一个报文给邻居测试是否可达。如果收到NA的回应，回到reachable状态；如果默认5s都没有收到回应，就进入Probe状态</li><li style="margin-left:.0001pt;text-align:justify;"><li style="text-align:justify;">Probe ：探查。进行三次解析（每1秒发送NS），等待对方回应，如果3s内收到NA报文回复，进入Reachable状态，否则邻居表删除这个邻居。</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="5.%E9%87%8D%E5%A4%8D%E5%9C%B0%E5%9D%80%E6%A3%80%E6%B5%8BDAD" style="margin-left:.0001pt;text-align:justify;">5.重复地址检测DAD</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）目的：避免IPV6地址冲突，类似IPV4的免费ARP</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）ICMPv6报文类型：</p> 
<p style="margin-left:.0001pt;text-align:justify;">NS（Neighbor Solicitation）报文，Type=135</p> 
<p style="margin-left:.0001pt;text-align:justify;">NA（Neighbor Advertisement）报文，Type=136</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（3）试验地址（Tentative Address）：通过DAD之前的地址</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（4）工作原理：发送一个ICMPv6 135的NS报文，请求自身设置的IPV6地址，如果收到NA报文，说明地址冲突，如果没有收到NA报文，说明地址不冲突可用。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="6.%E8%B7%AF%E7%94%B1%E5%99%A8%E5%8F%91%E7%8E%B0" style="margin-left:.0001pt;text-align:justify;">6.路由器发现</h3> 
<p style="margin-left:.0001pt;text-align:justify;">（1）概述：路由器发现又叫无状态地址自动配置（Stateless address autoconfiguration）。</p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）目的：目的：主机自动获取IPv6地址的前缀，然后主机自己生成接口标识，从而自动获取IPv6地址。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（3）ICMPv6报文类型</p> 
<ul><li style="text-align:justify;">RS（Router Solicitation），路由器请求报文，type=133。主机请求网络前缀</li><li style="text-align:justify;">RA（Router Advertisement），路由器通告报文，type=134。RA发送网络前缀、网关等信息</li></ul> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（4）工作原理：</p> 
<p style="text-align:justify;">A.根据接口标识产生链路本地地址。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">B.发出邻居请求，进行重复地址检测。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">C.如地址冲突，则停止自动配置，需要手工配置。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">D.如不冲突，链路本地地址生效，节点具备本地链路通信能力。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">E.主机会发送RS报文（或接收到设备定期发送的RA报文）。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">F.根据RA报文中的前缀信息和接口标识得到IPv6地址。</p> 
<p style="text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（5）配置命令</p> 
<pre><code class="hljs">华为配置：

路由器端配置：

[R1-GigabitEthernet0/0/1]undo ipv6 nd ra halt //路由器开启发布RA报文功能，默认未开启



主机端配置：

interface GigabitEthernet0/0/0

ipv6 enable

ipv6 address auto global //主机端开启无状态自动生成IPv6全局地址，默认未开启



思科配置：

路由器端配置：

ipv6 unicast-routing //此条命令一定要开启，否则主机侧无法获取IP地址 interface FastEthernet0/0

ipv6 enable

ipv6 address 2001::2/64

no shutdown

ipv6 nd ra suppress//路由器关闭RA报文功能，思科默认开启



主机端配置：

interface FastEthernet0/0

ipv6 enable

ipv6 address autoconfig default

no shutdown //主机侧开启无状态自动汇总</code></pre> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">注意：理论RS报文的的目的地址为FF02::2(代表所有路由器)，但是华为模拟器抓出的报文目的地址为FF02::1；思科没错。</p> 
</blockquote> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="7.%E9%87%8D%E5%AE%9A%E5%90%91" style="text-align:justify;">7.重定向</h3> 
<p style="text-align:justify;">（1）目的：当PC去往一个网段需要经过网关设备，网关需要将报文转发给同网段的某个路由器时触发。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（2）ICMPv6类型 ：Redirect,type=137</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="text-align:justify;">（3）工作原理：网关设备发送重定向消息给PC，PC将去往这个目的的下一跳地址改为重定向报文中的更优先下一跳。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6df612ed5ffd9b2cbc5b34cd4033637f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【OpenStack实战—keystone04】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/14aa238a31d072ca0d24169e0e986d43/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">终极.NET混淆器丨.NET Reactor产品介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>