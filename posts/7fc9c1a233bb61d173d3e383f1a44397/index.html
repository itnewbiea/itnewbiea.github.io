<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Prometheus安装、配置、维护及日常使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Prometheus安装、配置、维护及日常使用" />
<meta property="og:description" content="一、Prometheus快速部署 1、服务器信息
Linux操作系统版本：CentOS Linux release 7.5.1804（Core）x86_64。
主机IP地址：172.16.60.63。
Prometheus选择下载版本：prometheus-2.44.0.linux-amd64.tar.gz。
2、软件下载
在官方网站下载页面地址https://prometheus.io/download/中找到Prometheus下载列表。在这里可以下载适用于各平台的二进制文件最新版本。
3、 使用二进制文件快速部署
1）官网下载Prometheus完成后，获取软件包的哈希值：
# sha256sum prometheus-2.44.0.linux-amd64.tar.gz
与官网提供的软件包类表中“SHA256 Checksum”列里的哈希值进行核对，保证下载的Prometheus软件包的完整性。
2）解压缩二进制软件包到指定的安装目录，运行Prometheus，操作如下：
# tar -zxvf prometheus-2.4.0.linux-amd64.tar.gz -C /data
# 这里安装在/data目录下
# cd /data # 注意核对个人安装目录
# chown -R root:root prometheus-2.4.0.linux-amd64
# ln -sv prometheus-2.4.0.linux-amd64 prometheus
3）启动Prometheus。
# cd /data/prometheus # 进入安装目录下找到prometheus服务程序
# ./prometheus # 先在终端界面直接启动prometheus服务
可以看到以下输出信息，由于篇幅缘故，这里只截取了Prometheus启动时输出日志的部分内容，
ts=2023-05-22T06:16:59.289Z caller=main.go:531 level=info msg=&#34;No time or size retention was set so using the default time retention&#34; duration=15d" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7fc9c1a233bb61d173d3e383f1a44397/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-23T14:46:47+08:00" />
<meta property="article:modified_time" content="2023-05-23T14:46:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Prometheus安装、配置、维护及日常使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一、Prometheus快速部署</h3> 
<p>1、服务器信息<br> Linux操作系统版本：CentOS Linux release 7.5.1804（Core）x86_64。<br> 主机IP地址：172.16.60.63。<br> Prometheus选择下载版本：prometheus-2.44.0.linux-amd64.tar.gz。</p> 
<p></p> 
<p>2、软件下载</p> 
<p>在官方网站下载页面地址https://prometheus.io/download/中找到Prometheus下载列表。在这里可以下载适用于各平台的二进制文件最新版本。</p> 
<p><img alt="" height="783" src="https://images2.imgbox.com/4c/a2/bHOgWHzU_o.png" width="1162"></p> 
<p></p> 
<p>3、 使用二进制文件快速部署</p> 
<p>1）官网下载Prometheus完成后，获取软件包的哈希值：</p> 
<p># sha256sum prometheus-2.44.0.linux-amd64.tar.gz</p> 
<p>与官网提供的软件包类表中“SHA256 Checksum”列里的哈希值进行核对，保证下载的Prometheus软件包的完整性。</p> 
<p>2）解压缩二进制软件包到指定的安装目录，运行Prometheus，操作如下：<br> # tar -zxvf prometheus-2.4.0.linux-amd64.tar.gz -C /data<br> # 这里安装在/data目录下<br> # cd /data    # 注意核对个人安装目录<br> # chown -R root:root prometheus-2.4.0.linux-amd64<br> # ln -sv prometheus-2.4.0.linux-amd64 prometheus</p> 
<p>3）启动Prometheus。</p> 
<p># cd /data/prometheus # 进入安装目录下找到prometheus服务程序<br> # ./prometheus # 先在终端界面直接启动prometheus服务</p> 
<p>可以看到以下输出信息，由于篇幅缘故，这里只截取了Prometheus启动时输出日志的部分内容，<br> ts=2023-05-22T06:16:59.289Z caller=main.go:531 level=info msg="No time or size retention was set so using the default time retention" duration=15d<br> ts=2023-05-22T06:16:59.289Z caller=main.go:575 level=info msg="Starting Prometheus Server" mode=server version="(version=2.44.0, branch=HEAD, revision=1ac5131f698ebc60f13fe2727f89b115a41f6558)"<br> ts=2023-05-22T06:16:59.289Z caller=main.go:580 level=info build_context="(go=go1.20.4, platform=linux/amd64, user=root@739e8181c5db, date=20230514-06:18:11, tags=netgo,builtinassets,stringlabels)"<br> ts=2023-05-22T06:16:59.289Z caller=main.go:581 level=info host_details="(Linux 3.10.0-693.el7.x86_64 #1 SMP Tue Aug 22 21:09:27 UTC 2017 x86_64 promethus (none))"<br> ts=2023-05-22T06:16:59.289Z caller=main.go:582 level=info fd_limits="(soft=4096, hard=4096)"<br> ts=2023-05-22T06:16:59.289Z caller=main.go:583 level=info vm_limits="(soft=unlimited, hard=unlimited)"<br> ts=2023-05-22T06:16:59.293Z caller=web.go:562 level=info component=web msg="Start listening for connections" <span style="color:#fe2c24;"><strong>address=0.0.0.0:9090</strong></span><br> ts=2023-05-22T06:16:59.294Z caller=main.go:1016 level=info msg="Starting TSDB ..."<br> ts=2023-05-22T06:16:59.298Z caller=tls_config.go:232 level=info component=web msg="Listening on" <span style="color:#fe2c24;"><strong>address=[::]:9090</strong></span><br> ts=2023-05-22T06:16:59.298Z caller=tls_config.go:235 level=info component=web msg="TLS is disabled." http2=false address=[::]:9090<br> ts=2023-05-22T06:16:59.300Z caller=head.go:588 level=info component=tsdb msg="Replaying on-disk memory mappable chunks if any"<br> ts=2023-05-22T06:16:59.300Z caller=head.go:669 level=info component=tsdb msg="On-disk memory mappable chunks replay completed" duration=5.382µs<br> ts=2023-05-22T06:16:59.300Z caller=head.go:677 level=info component=tsdb msg="Replaying WAL, this may take a while"<br> ts=2023-05-22T06:16:59.300Z caller=head.go:748 level=info component=tsdb msg="WAL segment loaded" segment=0 maxSegment=0<br> ts=2023-05-22T06:16:59.300Z caller=head.go:785 level=info component=tsdb msg="WAL replay completed" checkpoint_replay_duration=18.178µs wal_replay_duration=446.57µs wbl_replay_duration=300ns total_replay_duration=497.453µs<br> ts=2023-05-22T06:16:59.301Z caller=main.go:1037 level=info fs_type=XFS_SUPER_MAGIC<br> ts=2023-05-22T06:16:59.301Z caller=main.go:1040 level=info msg="TSDB started"<br> ts=2023-05-22T06:16:59.301Z caller=main.go:1220 level=info msg="Loading configuration file" filename=prometheus.yml<br> ts=2023-05-22T06:16:59.304Z caller=main.go:1257 level=info msg="Completed loading of configuration file" filename=prometheus.yml totalDuration=2.292321ms db_storage=2.615µs remote_storage=3.003µs web_handler=665ns query_engine=918ns scrape=1.94575ms scrape_sd=31.408µs notify=40.726µs notify_sd=10.054µs rules=3.103µs tracing=16.347µs<br> ts=2023-05-22T06:16:59.304Z caller=main.go:1001 level=info msg="Server is ready to receive web requests."<br> ts=2023-05-22T06:16:59.304Z caller=manager.go:995 level=info component="rule manager" msg="Starting rule manager..."<br>  </p> 
<p>从截取的日志中，我们找到加粗标记字体的信息，可以看到prometheus服务已经成功启动，且默认监听端口9090已经开启，如果想更换默认监控端口，需要启动时添加配置参数信息，例如，--<br> web.listen-address="0.0.0.0:端口号"，更多方法可以使用./prometheus-h查看相关帮助信息。</p> 
<p></p> 
<p>4）添加Prometheus为系统服务开机启动。<br> 此时，当终端关闭或按下Ctrl+C时，Prometheus服务会自动关闭，这不是我们想要的工作方式。我们要对进程执行关闭、重新启动、查看进程状态等操作时，还需配合各种Linux命令才能完成。这里为了方便，将Prometheus添加为系统服务且开机自启动。</p> 
<p>可以使用CentOS Linux release 7操作系统中的命令systemctl来管理守护进程Prometheus服务。在/usr/lib/systemd/system目录下添加一个系统服务启动文件，用配置文件prometheus.service：</p> 
<p># vi /usr/lib/systemd/system/prometheus.service # 参考内容如下：<br> [Unit]<br> Description=Prometheus server daemon<br> After=network.target</p> 
<p>[Service]<br> Type=simple<br> User=root<br> Group=root<br> ExecStart=/data/prometheus/prometheus \<br> --config.file "/data/prometheus/prometheus.yml" \<br> --storage.tsdb.path "/data/prometheus/data" \<br> --storage.tsdb.retention=15d \<br> --web.console.templates="/data/prometheus/consoles" \<br> --web.console.libraries="/data/prometheus/console_libraries" \<br> --web.max-connections=512 \<br> --web.external-url"http://172.16.60.63:9090" \<br> --web.listen-address "0.0.0.0:9090"<br> Restart=on-failure</p> 
<p>[Install]<br> WantedBy=multi-user.target</p> 
<p>最后，配置文件完成且保存退出，需要通知systemd重新加载配置文件：</p> 
<p># systemctl daemon-reload # 通知systemd重新加载配置文件<br> # systemctl enable prometheus.service # 设置为开机自启动<br> # systemctl disable prometheus.service # 如果不想设置为开机自启动，可以关闭<br> # systemctl start prometheus.service # 开启服务<br> # systemctl status prometheus.service # 查看状态为Active: active (running)</p> 
<p># systemctl restart prometheus.service # 重启服务<br> # systemctl stop prometheus.service # 停止服务</p> 
<p></p> 
<p>4、Prometheus Web UI登录</p> 
<p>在浏览器中输入http://IP:9090格式便可进行访问，如下图</p> 
<p><img alt="" height="403" src="https://images2.imgbox.com/62/d3/iWIQM4e9_o.png" width="839"></p> 
<p> 最后，通过访问http://172.16.60.63:9090/targets地址，可以查看页面中的Targets信息。示例中使用默认配置文件，仅仅对Prometheus本机进行监控，如图所示。</p> 
<p><img alt="" height="302" src="https://images2.imgbox.com/8a/bb/L4zbjdsu_o.png" width="1057"></p> 
<p> Prometheus内部默认提供许多metric（指标）用于监控操作，这些指标都可以在Web UI中输入查询。如果将Prometheus默认配置文件中的“localhost”修改为主机IP地址，我们直接点击图2-6中提供的链接即可访问Metrics信息，但示例中是默认配置文件，需要在浏览器中输入示例地址http://172.16.60.63:9090/metrics，才可以看到所有指标信息。由于内容比较多，这里仅展示部分输出信息：</p> 
<p># HELP go_gc_duration_seconds A summary of the GC invocation durations.<br> # TYPE go_gc_duration_seconds summary<br> go_gc_duration_seconds{quantile="0"} 0.000136642<br> go_gc_duration_seconds{quantile="0.25"} 0.000200511<br> ……此处省略部分信息……<br> prometheus_build_info{branch="HEAD",goversion="go1.10.3",revision="068eaa<br> 5dbfce6c08f3d05d3d3c0bfd96267cfed2",version="2.4.0"} 1<br> # HELP prometheus_config_last_reload_success_timestamp_seconds Timestamp<br> of the last successful configuration reload.<br> # TYPE prometheus_config_last_reload_success_timestamp_seconds gauge<br> prometheus_conf?ig_last_reload_success_timestamp_seconds<br> 1.553934655140825e+09<br> # HELP prometheus_config_last_reload_successful Whether the last conf?<br> iguration reload attempt was successful.<br> # TYPE prometheus_config_last_reload_successful gauge<br> ……此处省略部分信息……<br> # HELP promhttp_metric_handler_requests_in_f?light Current number of<br> scrapes being served.<br> # TYPE promhttp_metric_handler_requests_in_f?light gauge<br> promhttp_metric_handler_requests_in_f?light 1<br> # HELP promhttp_metric_handler_requests_total Total number of scrapes by<br> HTTP status code.<br> # TYPE promhttp_metric_handler_requests_total counter<br> promhttp_metric_handler_requests_total{code="200"} 72<br> promhttp_metric_handler_requests_total{code="500"} 0<br> promhttp_metric_handler_requests_total{code="503"} 0</p> 
<p></p> 
<h3>二、Prometheus监控主机、服务</h3> 
<p>1、Linux主机监控</p> 
<p>由于Linux操作系统自身并不直接支持Prometheus，所以Prometheus官方提供了Go语言编写的Node exporter来实现对Linux操作系统主机的监控数据采集。它提供了系统内几乎所有的标准指标，如CPU、内存、磁盘空间、磁盘I/O、系统负载和网络带宽。另外，它还提供了由内核公开的大量额外监控指标，从负载平均到主板温度等。</p> 
<p>在安装之前，首先在官方下载页面https://prometheus.io/download/找到Node exporter列表，下载最新版本中特定平台的二进制文件。然后开始Nodeexporter的安装部署以及使用。</p> 
<p><img alt="" height="218" src="https://images2.imgbox.com/7b/1e/5WpubyY6_o.png" width="1155"></p> 
<p>应用信息如下：<br> ·被监控的Linux操作系统版本为CentOS Linux release 7.5.1804（Core）x86_64。<br> ·主机IP地址为172.16.60.63。<br> ·Node exporter选择下载版本是node_exporter-1.5.0.linuxamd64.tar.gz。</p> 
<p></p> 
<p>1.1 下载部署<br> 大致步骤如下：<br> 1）官网站下载Node exporter完成后，获取软件包的哈希值，与官网所提供的软件包类表中“SHA256 Checksum”列里的哈希值进行核对，确保下载的Node exporter软件包完整性。</p> 
<p>2）解压缩软件包到指定的安装目录。由于Node exporter采用Go语言编写而成，不依赖于第三方，所以下载完成后，只需解压缩二级制软件包后运行node_exporter即可。</p> 
<p>3）启动node_exporter，代码如下：</p> 
<p># ./node_exporter</p> 
<p>这里，先在终端界面启动node_exporter，成功启动后可以看到默认监听端口是9100，其中“Enabled collectors”列是node_exporter默认情况下启用的功能。如果想更换默认监控端口，需要启动时添加参数--web.listen-address=":9200"即可，更多方法可以使用#./node_exporter-h查看相关帮助信息。</p> 
<p>4）添加node_exporter为系统服务开机启动。此时，当终端关闭或按下Ctrl+C时，node_exporter服务会自动关闭，这不是我们想要的操作方式。我们要关闭进程、重新启动进程、查看进程状态时，还得配合各种Linux命令才能完成。为了方便操作，可以将node_exporter程序添加为系统服务且开机自启动。该系统服务启动时使用的配置文件node_exporter.service内容如下：</p> 
<p># vi /usr/lib/systemd/system/node_exporter.service # 参考内容如下：<br> [Unit]<br> Description=node_exporter<br> Documentation=https:// prometheus.io/<br> After=network-online.target<br> [Service]<br> Type=simple<br> User=root<br> Group=root<br> ExecStart=/data/node_exporter/node_exporter<br> Restart=on-failure<br> [Install]<br> WantedBy=multi-user.target</p> 
<p></p> 
<p>最后可以通过systemctl命令进行如下操作：</p> 
<p># systemctl daemon-reload # 通知systemd重新加载配置文件<br> # systemctl enable node_exporter.service # 设置为开机自启动<br> # systemctl start node_exporter.service # 启动服务<br> # systemctl status node_exporter.service # 状态为Active: active(running)时已正常启动<br> # systemctl restart node_exporter.service # 重启服务<br> # systemctl stop node_exporter.service # 停止服务</p> 
<p>至此，我们完成了对node_exporter的下载安装，并对其进行了系统服务添加和开机自启动设置。</p> 
<p>1.2 与Prometheus集成</p> 
<p>当启动node_exporter在后台开始工作时，node_exporter和Prometheus还没有进行对接关联，此时，二者只是各自独立运行的应用程序。现在需要将已安装部署好的node_exporter添加到Prometheus服务器中。可以在Prometheus主机目录中，找到主配置文件，使用其中的静态配置功能static_configs来采集node_exporter提供的数据。</p> 
<p>编辑prometheus.yml文件，添加job与node_exporter进行关联的参考配置内容如下：</p> 
<p># vi prometheus.yml<br> scrape_configs:<br>    - job_name: 'prometheus'<br>         static_configs:<br>        - targets: ['172.16.60.63:9090']<br>  - job_name: 'node_exporter'<br>        static_configs:<br>      - targets: ['172.16.60.63:9100']</p> 
<p>配置完成后，需要我们重新启动prometheus或进行动态热加载操作，使修改后的配置文件加载生效。现在，可以在浏览器中输入Prometheus示例页面地址http://172.16.60.63:9090，访Prometheus web UI提供的页面内容，再点击“Status”中的“Targets”，如图所示。</p> 
<p><img alt="" height="302" src="https://images2.imgbox.com/47/06/A8DYU7Sy_o.png" width="1050"></p> 
<p> 进入Targets页面后，可以在列表中看到刚才配置好的node_exporter的状态为“UP”，说明Prometheus最后一次从Nodeexporter中采集数据是成功的，此刻，被监控的服务器主机工作运行<br> 状态是正常的</p> 
<p><img alt="" height="508" src="https://images2.imgbox.com/55/28/2Fugmdzq_o.png" width="951"></p> 
<p></p> 
<p>2、Windows主机监控</p> 
<p>应用信息如下：<br> ·被监控的Windows操作系统版本，Windows Server 2016 R2 Enterprise x86_64。<br> ·Windows服务器主机IP地址，172.16.61.75。<br> ·wmi_exporter选择下载版本，windows_exporter-0.22.0-amd64.msi。</p> 
<p>1） 软件下载与部署<br> 下载页面地址：<br> https://github.com/martinlindhe/wmi_exporter/releases。</p> 
<p>选择当前最新版本：windows_exporter-0.22.0-amd64.msi 下载到被监控主机。</p> 
<p>直接双击文件进行快速安装即可。wmi_exporter会自动安装到C:\Program Files\windows_exporter目录下。在命令提示符中输入命令：netstat-ab，可以看到windows_exporter.exe开启默认端口9182进行监听。此时，可以使用浏览器访问http://192.168.24.16:9182/metrics页面地址，若看到<br> windows_exporter各项采集指标，说明wmi_exporter已经成功安装</p> 
<p>2）与Prometheus集成</p> 
<p>在Prometheus的配置文件prometheus.yml中继续追加static_configs来采集wmi_exporter提供的数据。添加的参考配置内容如下：</p> 
<p>- job_name: 'wmi_exporter'<br>   scrape_interval: 10s<br>   static_configs:<br>    - targets: ['172.16.61.75:9182']</p> 
<p>配置完成后，需要我们重新启动Prometheus或动态热加载，使配置文件加载生效。现在，可以在浏览器中输入Prometheus示例页面地址http://172.16.60.63:9090来访问Prometheus Web UI<br> 提供的页面内容。点击“Status”中的“Targets”后，在Targets页面列表中新增了windows_exporter显示项目，且windows_exporter状态为“UP”，如图所示。</p> 
<p><img alt="" height="380" src="https://images2.imgbox.com/f2/00/RkI1jyeL_o.png" width="947"></p> 
<p></p> 
<p>3、MySQL数据库监控</p> 
<p>应用信息如下：<br> ·Linux操作系统版本，CentOS Linux release 7.5.1804（Core）<br> x86_64。<br> ·MySQL主机IP地址，172.16.61.69。<br> ·MySQL版本，mysql-5.7.20。<br> ·mysqld_exporter选择下载版本，mysqld_exporter-0.11.0.linuxamd64.tar.gz。</p> 
<p>3.1 软件下载与部署</p> 
<p>在官方下载页面https://prometheus.io/download/中找到mysqld_exporter列表，下<br> 载最新版本中特定平台的二进制文件</p> 
<p><img alt="" height="336" src="https://images2.imgbox.com/67/b9/EDhIAIBt_o.png" width="1155"></p> 
<p>部署可分为以下6个步骤。<br> 1）下载mysqld_exporter完成后，获取软件包的哈希值，与官网提供的软件包列表中“SHA256 Checksum”列里的哈希值进行核对，保证所下载的mysqld_exporter软件包的完整性。<br> 2）解压缩软件包到指定的安装目录。<br> mysqld_exporter同样也采用Go语言编写而成，不依赖于第三方，<br> 所以下载完成后，只需解压缩二级制软件包后运行mysqld_exporter即可。<br> 3）创建MySQL授权用户。<br> 连接到MySQL服务器，创建一个用户，例如<br> “mysqld_exporter”。该用户需要拥有PROCESS，SELECT，REPLICATION CLIENT授权，且为了避免有些高负载MySQL服务器过载，为用户设置最大连接限制。可以进行如下操作：</p> 
<p>mysql&gt;CREATE USER 'mysqld_exporter'@'localhost' IDENTIFIED BY<br> 'YourStrongPassword' WITH \<br> MAX_USER_CONNECTIONS 2; #注意MySQL5.5版本时去掉MAX_USER_CONNECTIONS选<br> 项<br> mysql&gt;GRANT PROCESS, REPLICATION CLIENT, SELECT ON *.* TO<br> 'mysqld_exporter'@'localhost';<br> mysql&gt;FLUSH PRIVILEGES;<br> mysql&gt; select Host,User from mysql.user; # 核查用户是否已经创建完成</p> 
<p>4）配置数据库认证。<br> mysqld_exports需要连接数据库服务器的用户名和密码<br> 在与“mysqld_exports”文件同目录下创建“.mysqld_exporter.cnf”文件，并添加如下内容：</p> 
<p># vi .mysqld_exporter.cnf<br> [client]<br> user=mysqld_exporter<br> password=YourStrongPassword</p> 
<p># tree -a mysqld_exporter # 查看mysqld_exporter目录<br> 下内容<br> mysqld_exporter<br> ├── LICENSE<br> ├── .mysqld_exporter.cnf<br> ├──mysqld_exporter<br> └── NOTICE</p> 
<p>5）启动mysqld_exporter。<br> 启动时需要指定配置文件路径<br> # ./mysqld_exporter --config.my-cnf=".mysqld_exporter.cnf" </p> 
<p>mysqld_exporter成功启动后，默认监听端口是9104，其中，“Enabled collectors”列是mysqld_exporter默认情况下启用的功能。</p> 
<p>6）添加mysqld_exporter，为系统服务启动。<br> 创建系统服务启动配置文件mysqld_exporter.service：</p> 
<p># vi /usr/lib/systemd/system/mysqld_exporter.service # 参考内容如下：</p> 
<p>[Unit]<br> Description=Prometheus MySQL Exporter<br> After=network.target<br> User=root<br> Group=root</p> 
<p>[Service]<br> Type=simple<br> Restart=always<br> ExecStart=/data/mysqld_exporter/mysqld_exporter \<br> --config.my-cnf=/data/mysqld_exporter/.mysqld_exporter.cnf \<br> --collect.global_status \<br> --collect.auto_increment.columns \<br> --collect.info_schema.processlist \<br> --collect.binlog_size \<br> --collect.info_schema.tablestats \<br> --collect.global_variables \<br> --collect.info_schema.innodb_metrics \<br> --collect.info_schema.query_response_time \<br> --collect.info_schema.userstats \<br> --collect.info_schema.tables \<br> --collect.perf_schema.tablelocks \<br> --collect.perf_schema.file_events \<br> --collect.perf_schema.eventswaits \<br> --collect.perf_schema.indexiowaits \<br> --collect.perf_schema.tableiowaits \<br> --collect.slave_status \<br> --web.listen-address=0.0.0.0:9104</p> 
<p>[Install]<br> WantedBy=multi-user.target</p> 
<p></p> 
<p>最后可以通过systemctl命令进行各种操作，例如：</p> 
<p># systemctl daemon-reload # 通知systemd重新加载配置文件<br> # systemctl enable mysqld_exporter.service # 设置为开机自启动<br> # systemctl start mysqld_exporter.service # 开启服务<br> # systemctl status mysqld_exporter.service # 状态为Active: active(running)时已正常启动<br> # systemctl restart mysqld_exporter.service # 重启服务<br> # systemctl stop mysqld_exporter.service # 停止服务</p> 
<p>7）与Prometheus集成</p> 
<p>在Prometheus的配置文件prometheus.yml中的static_configs模块内，继续追加配置内容来采集mysqld_exporter提供的数据。添加的参考配置内容如下：</p> 
<p>- job_name: 'mysqld_exporter'<br>     scrape_interval: 10s<br>     static_configs:<br>      - targets: ['172.16.61.69:9104']</p> 
<p>配置完成后，需要重新启动Prometheus或进行动态热加载操作，可以在浏览器中输入Prometheus示例页面地址http://172.16.60.63:9090，访问Prometheus Web UI提供的内容，可以看到在Targets页面列表中已经新增了mysqld_exporter显示项，且mysqld_exporter状态为“UP”。</p> 
<p><img alt="" height="514" src="https://images2.imgbox.com/b2/41/ibE0lmKC_o.png" width="1008"></p> 
<p> </p> 
<p>4、Redis数据库监控</p> 
<p>应用信息如下：<br> ·Linux操作系统版本为CentOS Linux release 7.5.1804（Core）x86_64。<br> ·Redis主机IP地址为172.16.61.69。<br> ·Redis版本为redis-4.0.9。<br> ·redis_exporter选择下载版本为redis_exporter-v1.50.0.linux-amd64.tar</p> 
<p>4.1 1.软件下载与部署<br> 1）下载redis_exporter。<br> 下载地址为https://github.com/oliver006/redis_exporter/releases。选择最新版本redis_exporter-v1.50.0.linux-amd64.tar</p> 
<p>2）解压缩软件包到指定的安装目录：</p> 
<p># 进入安装目录下，在终端启动查看信息，成功启动，默认监听端口是9121。<br> # ./redis_exporter -redis.addr localhost:6379 -redis.password<br> YourStrongPassword</p> 
<p>3）添加redis_exporter为系统服务开机启动配置文件<br> redis_exporter.service：</p> 
<p># vi /usr/lib/systemd/system/redis_exporter.service # 参考内容如下：<br> [Unit]<br> Description=Prometheus Redis Exporter<br> After=network.target<br> [Service]<br> Type=simple<br> Restart=always<br> ExecStart=/data/redis_exporter/redis_exporter \<br> -redis.addr localhost:6379 \<br> -redis.password YourStrongPassword \<br> [Install]<br> WantedBy=multi-user.target</p> 
<p>最后可以通过systemctl命令进行各种操作，例如：</p> 
<p># systemctl daemon-reload # 通知systemd重新加载配置文件<br> # systemctl enable redis_exporter.service # 设置为开机自启动<br> # systemctl start redis_exporter.service # 开启服务<br> # systemctl status redis_exporter.service # 状态为Active: active(running)时已正常启动<br> # systemctl restart redis_exporter.service # 重启服务<br> # systemctl stop redis_exporter.service # 停止服务</p> 
<p>4）与Prometheus集成</p> 
<p>在Prometheus的配置文件prometheus.yml中的static_configs模块内，继续追加配置内容来采集redis_exporter提供的数据。参考配置内容如下：</p> 
<p>- job_name: 'redis_exporter'<br>      scrape_interval: 10s<br>      static_conf?igs:<br>      - targets: ['172.16.61.69:9121']</p> 
<p>配置完成后，需要重新启动Prometheus或动态热加载，对配置文件进行加载生效操作。现在，可以在浏览器中输入Prometheus示例页面地址http://172.16.60.63:9090，访问Prometheus Web UI提供的内容，可以看到在Targets页面列表中已经新增了redis_exporter显示项，且redis_exporter状态为“UP”。</p> 
<p><img alt="" height="546" src="https://images2.imgbox.com/b8/92/LVskUAcF_o.png" width="961"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/61851d6a3873b106e0d7dc3b40890704/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">详细讲解u-boot之网络移植与调试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7e40ba266cd90cdf5c916388a5115843/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【arxiv】论文找 idea ： 关于 OVD 的论文扫读（四）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>