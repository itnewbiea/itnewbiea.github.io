<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Redis集群-哨兵（笔记） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Redis集群-哨兵（笔记）" />
<meta property="og:description" content="哨兵 定义： 哨兵（sentinel）是一个分布式系统，用于对主从复制的每一台服务器进行监控，当出现故障投票选出新的master其他slave进行连接。
相关配置 port 26379 (sentinel的端口)
sentinel monitor mymaster 127.0.0.1 6379 2
(mymaster是名字 必须统一，127是master的地址，6379是端口 ，2指的是sentinel为3个的时候2个认为挂掉的了就是挂掉了)
sentinel down-after-millisecands mymaster 3000
sentinel paralled-syncs mymaster 1 （1是挂了后同步越大服务器压力越大）
sentinel failover-time mymaster 18000 （挂了后同步的超时时间）
3个哨兵这个配置文件复制3份修改一下就可以
架构图 哨兵们相互通信 每一个哨兵都监视所有的节点
工作原理 监控阶段 step1. sentinel1连接master
step2.master返回所有slave节点信息
step3.sentinel1 分别连接master下的所有slave
多哨兵都重复之前1-3的步骤
在sentinel1连接后，sentinel2连接的时候会从master中获取master已经连接sentinel1
这时候sentinel1与sentinel2开始通信，发布订阅模式消息共享
通知阶段 保持通信
故障转移 step1.发现异常
step2.竞选sentinel负责人 投票选出
step3.sentinel负责人选取新的master
（在线的，响应快的，原master断开时间短的 slave offset大的都一样选runid小的）
step4.其他slave
连接新的master
故障恢复 故障恢复的时候已经有新的slave担任master 原来挂掉的master变成slave 去连接新上任的master" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7f682983d71ded9ae1b4f4f84ee3bc13/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-06T17:37:16+08:00" />
<meta property="article:modified_time" content="2021-04-06T17:37:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Redis集群-哨兵（笔记）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>哨兵</h2> 
<h3><a id="_1"></a>定义：</h3> 
<blockquote> 
 <p>哨兵（sentinel）是一个分布式系统，用于对主从复制的每一台服务器进行监控，当出现故障投票选出新的master其他slave进行连接。</p> 
</blockquote> 
<h3><a id="_5"></a>相关配置</h3> 
<blockquote> 
 <p>port 26379 (sentinel的端口)<br> sentinel monitor mymaster 127.0.0.1 6379 2<br> (mymaster是名字 必须统一，127是master的地址，6379是端口 ，2指的是sentinel为3个的时候2个认为挂掉的了就是挂掉了)<br> sentinel down-after-millisecands mymaster 3000<br> sentinel paralled-syncs mymaster 1 （1是挂了后同步越大服务器压力越大）<br> sentinel failover-time mymaster 18000 （挂了后同步的超时时间）</p> 
</blockquote> 
<p>3个哨兵这个配置文件复制3份修改一下就可以</p> 
<h3><a id="_17"></a>架构图</h3> 
<p><img src="https://images2.imgbox.com/a8/2c/kY9CgYgY_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>哨兵们相互通信 每一个哨兵都监视所有的节点</p> 
</blockquote> 
<h3><a id="_23"></a>工作原理</h3> 
<h4><a id="_24"></a>监控阶段</h4> 
<blockquote> 
 <p>step1. sentinel1连接master<br> step2.master返回所有slave节点信息<br> step3.sentinel1 分别连接master下的所有slave<br> 多哨兵都重复之前1-3的步骤<br> 在sentinel1连接后，sentinel2连接的时候会从master中获取master已经连接sentinel1<br> 这时候sentinel1与sentinel2开始通信，发布订阅模式消息共享</p> 
</blockquote> 
<h4><a id="_33"></a>通知阶段</h4> 
<blockquote> 
 <p>保持通信</p> 
</blockquote> 
<h4><a id="_37"></a>故障转移</h4> 
<blockquote> 
 <p>step1.发现异常<br> step2.竞选sentinel负责人 投票选出<br> step3.sentinel负责人选取新的master<br> （在线的，响应快的，原master断开时间短的 slave offset大的都一样选runid小的）<br> step4.其他slave<br> 连接新的master</p> 
</blockquote> 
<h4><a id="_46"></a>故障恢复</h4> 
<blockquote> 
 <p>故障恢复的时候已经有新的slave担任master 原来挂掉的master变成slave 去连接新上任的master</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6c231f5747d87e2b45ce4b08f8041497/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于学生课程分数的SQL查询</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7de3c10dd58cb57f823d0c723b67a722/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">十分钟读完《金字塔原理》</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>