<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据毕设分享 flink大数据淘宝用户行为数据实时分析与可视化 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大数据毕设分享 flink大数据淘宝用户行为数据实时分析与可视化" />
<meta property="og:description" content="文章目录 0 前言1、环境准备1.1 flink 下载相关 jar 包1.2 生成 kafka 数据1.3 开发前的三个小 tip 2、flink-sql 客户端编写运行 sql2.1 创建 kafka 数据源表2.2 指标统计：每小时成交量2.2.1 创建 es 结果表， 存放每小时的成交量2.2.2 执行 sql ，统计每小时的成交量 2.3 指标统计：每10分钟累计独立用户数2.3.1 创建 es 结果表，存放每10分钟累计独立用户数2.3.2 创建视图2.3.3 执行 sql ，统计每10分钟的累计独立用户数 2.4 指标统计：商品类目销量排行2.4.1 创建商品类目维表2.4.1 创建 es 结果表，存放商品类目排行表2.4.2 创建视图2.4.3 执行 sql , 统计商品类目销量排行 3、最终效果与体验心得3.1 最终效果3.2 体验心得3.2.1 执行3.2.2 存储 4 最后 0 前言 🔥 这两年开始毕业设计和毕业答辩的要求和难度不断提升，传统的毕设题目缺少创新和亮点，往往达不到毕业答辩的要求，这两年不断有学弟学妹告诉学长自己做的项目系统达不到老师的要求。
为了大家能够顺利以及最少的精力通过毕设，学长分享优质毕业设计项目，今天要分享的是
🚩 flink大数据淘宝用户行为数据实时分析与可视化
🥇学长这里给一个题目综合评分(每项满分5分)
难度系数：3分工作量：3分创新点：4分 1、环境准备 1.1 flink 下载相关 jar 包 flink-sql 连接外部系统时，需要依赖特定的 jar 包，所以需要事先把这些 jar 包准备好。说明与下载入口" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/66b13fd5a5d2753ecb7d0225e14498d0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T13:16:29+08:00" />
<meta property="article:modified_time" content="2024-01-04T13:16:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据毕设分享 flink大数据淘宝用户行为数据实时分析与可视化</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#0__4" rel="nofollow">0 前言</a></li><li><a href="#1_23" rel="nofollow">1、环境准备</a></li><li><ul><li><a href="#11_flink__jar__25" rel="nofollow">1.1 flink 下载相关 jar 包</a></li><li><a href="#12__kafka__40" rel="nofollow">1.2 生成 kafka 数据</a></li><li><a href="#13___tip_60" rel="nofollow">1.3 开发前的三个小 tip</a></li></ul> 
  </li><li><a href="#2flinksql__sql_72" rel="nofollow">2、flink-sql 客户端编写运行 sql</a></li><li><ul><li><a href="#21__kafka__79" rel="nofollow">2.1 创建 kafka 数据源表</a></li><li><a href="#22__103" rel="nofollow">2.2 指标统计：每小时成交量</a></li><li><ul><li><a href="#221__es___105" rel="nofollow">2.2.1 创建 es 结果表， 存放每小时的成交量</a></li><li><a href="#222__sql__123" rel="nofollow">2.2.2 执行 sql ，统计每小时的成交量</a></li></ul> 
   </li><li><a href="#23_10_133" rel="nofollow">2.3 指标统计：每10分钟累计独立用户数</a></li><li><ul><li><a href="#231__es_10_135" rel="nofollow">2.3.1 创建 es 结果表，存放每10分钟累计独立用户数</a></li><li><a href="#232__152" rel="nofollow">2.3.2 创建视图</a></li><li><a href="#233__sql_10_163" rel="nofollow">2.3.3 执行 sql ，统计每10分钟的累计独立用户数</a></li></ul> 
   </li><li><a href="#24__172" rel="nofollow">2.4 指标统计：商品类目销量排行</a></li><li><ul><li><a href="#241__174" rel="nofollow">2.4.1 创建商品类目维表</a></li><li><a href="#241__es__194" rel="nofollow">2.4.1 创建 es 结果表，存放商品类目排行表</a></li><li><a href="#242___211" rel="nofollow">2.4.2 创建视图</a></li><li><a href="#243__sql___220" rel="nofollow">2.4.3 执行 sql , 统计商品类目销量排行</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3_230" rel="nofollow">3、最终效果与体验心得</a></li><li><ul><li><a href="#31__232" rel="nofollow">3.1 最终效果</a></li><li><a href="#32__238" rel="nofollow">3.2 体验心得</a></li><li><ul><li><a href="#321__240" rel="nofollow">3.2.1 执行</a></li><li><a href="#322__251" rel="nofollow">3.2.2 存储</a></li></ul> 
  </li></ul> 
  </li><li><a href="#4__257" rel="nofollow">4 最后</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="0__4"></a>0 前言</h2> 
<p>🔥 这两年开始毕业设计和毕业答辩的要求和难度不断提升，传统的毕设题目缺少创新和亮点，往往达不到毕业答辩的要求，这两年不断有学弟学妹告诉学长自己做的项目系统达不到老师的要求。</p> 
<p>为了大家能够顺利以及最少的精力通过毕设，学长分享优质毕业设计项目，今天要分享的是</p> 
<p>🚩 <strong>flink大数据淘宝用户行为数据实时分析与可视化</strong></p> 
<p>🥇学长这里给一个题目综合评分(每项满分5分)</p> 
<ul><li>难度系数：3分</li><li>工作量：3分</li><li>创新点：4分</li></ul> 
<h2><a id="1_23"></a>1、环境准备</h2> 
<h3><a id="11_flink__jar__25"></a>1.1 flink 下载相关 jar 包</h3> 
<p>flink-sql 连接外部系统时，需要依赖特定的 jar 包，所以需要事先把这些 jar 包准备好。<a href="https://ci.apache.org/projects/flink/flink-docs-release-1.10/dev/table/connect.html" rel="nofollow">说明与下载入口</a></p> 
<p>本项目使用到了以下的 jar 包 ，下载后直接放在了 flink/lib 里面。</p> 
<blockquote> 
 <p>需要注意的是 flink-sql 执行时，是转化为 flink-job 提交到集群执行的，所以 flink 集群的每一台机器都要添加以下的 jar 包。</p> 
</blockquote> 
<table><thead><tr><th>外部</th><th>版本</th><th>jar</th></tr></thead><tbody><tr><td>kafka</td><td>4.1</td><td>flink-sql-connector-kafka_2.11-1.10.2.jar <br>flink-json-1.10.2-sql-jar.jar</td></tr><tr><td>elasticsearch</td><td>7.6</td><td>flink-sql-connector-elasticsearch7_2.11-1.10.2.jar</td></tr><tr><td>mysql</td><td>5.7</td><td>flink-jdbc_2.11-1.10.2.jar <br>mysql-connector-java-8.0.11.jar</td></tr></tbody></table> 
<h3><a id="12__kafka__40"></a>1.2 生成 kafka 数据</h3> 
<p>用户行为数据来源： <a href="https://tianchi.aliyun.com/dataset/dataDetail?dataId=649" rel="nofollow">阿里云天池公开数据集</a></p> 
<blockquote> 
 <p>网盘：https://pan.baidu.com/s/1wDVQpRV7giIlLJJgRZAInQ 提取码：gja5</p> 
</blockquote> 
<p>商品类目纬度数据来源: <a href="https://github.com/TurboWay/pybigdata/blob/master/flink-sql/category.sql">category.sql</a></p> 
<p>数据生成器：<a href="https://github.com/TurboWay/pybigdata/blob/master/flink-sql/datagen.py">datagen.py</a></p> 
<blockquote> 
 <p>有了数据文件之后，使用 python 读取文件数据，然后并发写入到 kafka。</p> 
</blockquote> 
<blockquote> 
 <p>修改生成器中的 kafka 地址配置，然后运行 以下命令，开始不断往 kafka 写数据</p> 
</blockquote> 
<pre><code class="prism language-shell"><span class="token comment"># 5000 并发</span>
<span class="token function">nohup</span> python3 datagen.py <span class="token number">5000</span> <span class="token operator">&amp;</span>                  
</code></pre> 
<h3><a id="13___tip_60"></a>1.3 开发前的三个小 tip</h3> 
<ul><li> <p>生成器往 kafka 写数据，会自动创建主题，无需事先创建</p> </li><li> <p>flink 往 elasticsearch 写数据，会自动创建索引，无需事先创建</p> </li><li> <p>Kibana 使用索引模式从 Elasticsearch 索引中检索数据，以实现诸如可视化等功能。</p> </li></ul> 
<blockquote> 
 <p>使用的逻辑为：创建索引模式 》Discover (发现) 查看索引数据 》visualize（可视化）创建可视化图表》dashboards（仪表板）创建大屏，即汇总多个可视化的图表</p> 
</blockquote> 
<h2><a id="2flinksql__sql_72"></a>2、flink-sql 客户端编写运行 sql</h2> 
<pre><code class="prism language-shell"><span class="token comment"># 进入 flink-sql 客户端, 需要指定刚刚下载的 jar 包目录</span>
./bin/sql-client.sh embedded <span class="token parameter variable">-l</span> lib
</code></pre> 
<h3><a id="21__kafka__79"></a>2.1 创建 kafka 数据源表</h3> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建 kafka 表, 读取 kafka 数据</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> user_behavior <span class="token punctuation">(</span>
    user_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    item_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    category_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    behavior STRING<span class="token punctuation">,</span>
    ts <span class="token keyword">TIMESTAMP</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    proctime <span class="token keyword">as</span> PROCTIME<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    WATERMARK <span class="token keyword">FOR</span> ts <span class="token keyword">as</span> ts <span class="token operator">-</span> <span class="token keyword">INTERVAL</span> <span class="token string">'5'</span> <span class="token keyword">SECOND</span>  
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
    <span class="token string">'connector.type'</span> <span class="token operator">=</span> <span class="token string">'kafka'</span><span class="token punctuation">,</span> 
    <span class="token string">'connector.version'</span> <span class="token operator">=</span> <span class="token string">'universal'</span><span class="token punctuation">,</span>  
    <span class="token string">'connector.topic'</span> <span class="token operator">=</span> <span class="token string">'user_behavior'</span><span class="token punctuation">,</span>  
    <span class="token string">'connector.startup-mode'</span> <span class="token operator">=</span> <span class="token string">'earliest-offset'</span><span class="token punctuation">,</span> 
    <span class="token string">'connector.properties.zookeeper.connect'</span> <span class="token operator">=</span> <span class="token string">'172.16.122.24:2181'</span><span class="token punctuation">,</span> 
    <span class="token string">'connector.properties.bootstrap.servers'</span> <span class="token operator">=</span> <span class="token string">'172.16.122.17:9092'</span><span class="token punctuation">,</span> 
    <span class="token string">'format.type'</span> <span class="token operator">=</span> <span class="token string">'json'</span>  
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> user_behavior<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="22__103"></a>2.2 指标统计：每小时成交量</h3> 
<h4><a id="221__es___105"></a>2.2.1 创建 es 结果表， 存放每小时的成交量</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> buy_cnt_per_hour <span class="token punctuation">(</span>
    hour_of_day <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    buy_cnt <span class="token keyword">BIGINT</span>
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
    <span class="token string">'connector.type'</span> <span class="token operator">=</span> <span class="token string">'elasticsearch'</span><span class="token punctuation">,</span> 
    <span class="token string">'connector.version'</span> <span class="token operator">=</span> <span class="token string">'7'</span><span class="token punctuation">,</span>  
    <span class="token string">'connector.hosts'</span> <span class="token operator">=</span> <span class="token string">'http://172.16.122.13:9200'</span><span class="token punctuation">,</span>  
    <span class="token string">'connector.index'</span> <span class="token operator">=</span> <span class="token string">'buy_cnt_per_hour'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.document-type'</span> <span class="token operator">=</span> <span class="token string">'user_behavior'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.bulk-flush.max-actions'</span> <span class="token operator">=</span> <span class="token string">'1'</span><span class="token punctuation">,</span>
    <span class="token string">'update-mode'</span> <span class="token operator">=</span> <span class="token string">'append'</span><span class="token punctuation">,</span>
    <span class="token string">'format.type'</span> <span class="token operator">=</span> <span class="token string">'json'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="222__sql__123"></a>2.2.2 执行 sql ，统计每小时的成交量</h4> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> buy_cnt_per_hour
<span class="token keyword">SELECT</span> <span class="token keyword">HOUR</span><span class="token punctuation">(</span>TUMBLE_START<span class="token punctuation">(</span>ts<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1'</span> <span class="token keyword">HOUR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token keyword">FROM</span> user_behavior
<span class="token keyword">WHERE</span> behavior <span class="token operator">=</span> <span class="token string">'buy'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> TUMBLE<span class="token punctuation">(</span>ts<span class="token punctuation">,</span> <span class="token keyword">INTERVAL</span> <span class="token string">'1'</span> <span class="token keyword">HOUR</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="23_10_133"></a>2.3 指标统计：每10分钟累计独立用户数</h3> 
<h4><a id="231__es_10_135"></a>2.3.1 创建 es 结果表，存放每10分钟累计独立用户数</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> cumulative_uv <span class="token punctuation">(</span>
    time_str STRING<span class="token punctuation">,</span>
    uv <span class="token keyword">BIGINT</span>
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
    <span class="token string">'connector.type'</span> <span class="token operator">=</span> <span class="token string">'elasticsearch'</span><span class="token punctuation">,</span> 
    <span class="token string">'connector.version'</span> <span class="token operator">=</span> <span class="token string">'7'</span><span class="token punctuation">,</span>  
    <span class="token string">'connector.hosts'</span> <span class="token operator">=</span> <span class="token string">'http://172.16.122.13:9200'</span><span class="token punctuation">,</span>  
    <span class="token string">'connector.index'</span> <span class="token operator">=</span> <span class="token string">'cumulative_uv'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.document-type'</span> <span class="token operator">=</span> <span class="token string">'user_behavior'</span><span class="token punctuation">,</span>    
    <span class="token string">'update-mode'</span> <span class="token operator">=</span> <span class="token string">'upsert'</span><span class="token punctuation">,</span>
    <span class="token string">'format.type'</span> <span class="token operator">=</span> <span class="token string">'json'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="232__152"></a>2.3.2 创建视图</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> uv_per_10min <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span>
  <span class="token function">MAX</span><span class="token punctuation">(</span>SUBSTR<span class="token punctuation">(</span>DATE_FORMAT<span class="token punctuation">(</span>ts<span class="token punctuation">,</span> <span class="token string">'HH:mm'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">'0'</span><span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> time_str<span class="token punctuation">,</span>
  <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token keyword">DISTINCT</span> user_id<span class="token punctuation">)</span> <span class="token keyword">OVER</span> w <span class="token keyword">AS</span> uv
<span class="token keyword">FROM</span> user_behavior
WINDOW w <span class="token keyword">AS</span> <span class="token punctuation">(</span><span class="token keyword">ORDER</span> <span class="token keyword">BY</span> proctime <span class="token keyword">ROWS</span> <span class="token operator">BETWEEN</span> <span class="token keyword">UNBOUNDED</span> <span class="token keyword">PRECEDING</span> <span class="token operator">AND</span> <span class="token keyword">CURRENT</span> <span class="token keyword">ROW</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="233__sql_10_163"></a>2.3.3 执行 sql ，统计每10分钟的累计独立用户数</h4> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> cumulative_uv
<span class="token keyword">SELECT</span> time_str<span class="token punctuation">,</span> <span class="token function">MAX</span><span class="token punctuation">(</span>uv<span class="token punctuation">)</span>
<span class="token keyword">FROM</span> uv_per_10min
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> time_str<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="24__172"></a>2.4 指标统计：商品类目销量排行</h3> 
<h4><a id="241__174"></a>2.4.1 创建商品类目维表</h4> 
<p>先在 mysql 创建一张商品类目的维表，然后配置 flink 读取 mysql。</p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> category_dim <span class="token punctuation">(</span>
    sub_category_id <span class="token keyword">BIGINT</span><span class="token punctuation">,</span>
    parent_category_name STRING
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
    <span class="token string">'connector.type'</span> <span class="token operator">=</span> <span class="token string">'jdbc'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.url'</span> <span class="token operator">=</span> <span class="token string">'jdbc:mysql://172.16.122.25:3306/flink'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.table'</span> <span class="token operator">=</span> <span class="token string">'category'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.driver'</span> <span class="token operator">=</span> <span class="token string">'com.mysql.jdbc.Driver'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.username'</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.password'</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.lookup.cache.max-rows'</span> <span class="token operator">=</span> <span class="token string">'5000'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.lookup.cache.ttl'</span> <span class="token operator">=</span> <span class="token string">'10min'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="241__es__194"></a>2.4.1 创建 es 结果表，存放商品类目排行表</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> top_category  <span class="token punctuation">(</span>
    category_name  STRING<span class="token punctuation">,</span>
    buy_cnt  <span class="token keyword">BIGINT</span>
<span class="token punctuation">)</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>
    <span class="token string">'connector.type'</span> <span class="token operator">=</span> <span class="token string">'elasticsearch'</span><span class="token punctuation">,</span> 
    <span class="token string">'connector.version'</span> <span class="token operator">=</span> <span class="token string">'7'</span><span class="token punctuation">,</span>  
    <span class="token string">'connector.hosts'</span> <span class="token operator">=</span> <span class="token string">'http://172.16.122.13:9200'</span><span class="token punctuation">,</span>  
    <span class="token string">'connector.index'</span> <span class="token operator">=</span> <span class="token string">'top_category'</span><span class="token punctuation">,</span>
    <span class="token string">'connector.document-type'</span> <span class="token operator">=</span> <span class="token string">'user_behavior'</span><span class="token punctuation">,</span>
    <span class="token string">'update-mode'</span> <span class="token operator">=</span> <span class="token string">'upsert'</span><span class="token punctuation">,</span>
    <span class="token string">'format.type'</span> <span class="token operator">=</span> <span class="token string">'json'</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="242___211"></a>2.4.2 创建视图</h4> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">VIEW</span> rich_user_behavior <span class="token keyword">AS</span>
<span class="token keyword">SELECT</span> U<span class="token punctuation">.</span>user_id<span class="token punctuation">,</span> U<span class="token punctuation">.</span>item_id<span class="token punctuation">,</span> U<span class="token punctuation">.</span>behavior<span class="token punctuation">,</span> C<span class="token punctuation">.</span>parent_category_name <span class="token keyword">as</span> category_name
<span class="token keyword">FROM</span> user_behavior <span class="token keyword">AS</span> U <span class="token keyword">LEFT</span> <span class="token keyword">JOIN</span> category_dim <span class="token keyword">FOR</span> SYSTEM_TIME <span class="token keyword">AS</span> <span class="token keyword">OF</span> U<span class="token punctuation">.</span>proctime <span class="token keyword">AS</span> C
<span class="token keyword">ON</span> U<span class="token punctuation">.</span>category_id <span class="token operator">=</span> C<span class="token punctuation">.</span>sub_category_id<span class="token punctuation">;</span>
</code></pre> 
<h4><a id="243__sql___220"></a>2.4.3 执行 sql , 统计商品类目销量排行</h4> 
<pre><code class="prism language-sql"><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> top_category
<span class="token keyword">SELECT</span> category_name<span class="token punctuation">,</span> <span class="token function">COUNT</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span> buy_cnt
<span class="token keyword">FROM</span> rich_user_behavior
<span class="token keyword">WHERE</span> behavior <span class="token operator">=</span> <span class="token string">'buy'</span>
<span class="token keyword">GROUP</span> <span class="token keyword">BY</span> category_name<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="3_230"></a>3、最终效果与体验心得</h2> 
<h3><a id="31__232"></a>3.1 最终效果</h3> 
<p>整个开发过程，只用到了 flink-sql ，无需写 java 或者其它代码，就完成了这样一个实时报表。</p> 
<p><img src="https://images2.imgbox.com/2c/df/vTkSEQvm_o.png" alt="image-20201201175438743"></p> 
<h3><a id="32__238"></a>3.2 体验心得</h3> 
<h4><a id="321__240"></a>3.2.1 执行</h4> 
<ul><li> <p>flink-sql 的 ddl 语句不会触发 flink-job , 同时创建的表、视图仅在会话级别有效。</p> </li><li> <p>对于连接表的 insert、select 等操作，则会触发相应的流 job， 并自动提交到 flink 集群，无限地运行下去，直到主动取消或者 job 报错。</p> </li><li> <p>flink-sql 客户端关闭后，对于已经提交到 flink 集群的 job 不会有任何影响。</p> </li></ul> 
<blockquote> 
 <p>本次开发，执行了 3 个 insert , 因此打开 flink 集群面板，可以看到有 3 个无限的流 job 。即使 kafka 数据全部写入完毕，关闭 flink-sql 客户端，这个 3 个 job 都不会停止。<br> <img src="https://images2.imgbox.com/ae/ef/IRZnXmY6_o.png" alt="image-20201201175523916"></p> 
</blockquote> 
<h4><a id="322__251"></a>3.2.2 存储</h4> 
<ul><li> <p>flnik 本身不存储业务数据，只作为流批一体的引擎存在，所以主要的用法为读取外部系统的数据，处理后，再写到外部系统。</p> </li><li> <p>flink 本身的元数据，包括表、函数等，默认情况下只是存放在内存里面，所以仅会话级别有效。但是，似乎可以存储到 Hive Metastore 中，关于这一点就留到以后再实践。</p> </li></ul> 
<h2><a id="4__257"></a>4 最后</h2>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e5809721a152b044dd97496ba12b647d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【设计模式】观察者模式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/80063a7ff7d3f6b82f0f7ce51f704599/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Keras常用的激活函数详细介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>