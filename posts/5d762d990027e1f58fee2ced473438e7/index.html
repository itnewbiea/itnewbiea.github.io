<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【SRE笔记 2022.9.30 集群知识及Centos基础优化】 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【SRE笔记 2022.9.30 集群知识及Centos基础优化】" />
<meta property="og:description" content="SRE笔记 2022.9.30 集群内服务软件集群模板机创建Linux系统优化用户优化ssh远程连接效率提升配置yum源常用软件安装安全优化中文字符集（非必要）时间同步提升命令行安全（可选）加大文件描述符优化内核扩展优化关键文件锁定清楚多余虚拟账户（可选）grub引导加密禁ping（内核参数）补丁升级开机自启精简生产企业最小化原则扩展优化创建规范目录检查端口 集群IP规划配置内网解析安装及配置路径规划拍摄快照克隆 rsync复制软件简介及特性增量复制原理版本三种工作模式local(本地)Access via remote shell(隧道）远程shell企业场景无隧道有隧道 access via rsync daemon(CS架构)(常用)服务端配置文件配置密码文件创建相关备份目录启动服务端客户端配置方法一方法二 测试客户端命令参数 客户端复制报错案例多模块复制排除文件复制 主机之间数据无差异复制断点限速 优缺点优点缺点 集群内服务软件 防火墙：深信服，天融信，华为，思科CDN服务: 阿里CDN，腾讯CDN，网宿CDNDNS服务：阿里云DNS，腾讯DNS,硬件F5,bind，powerDNS负载均衡：ngingx(L4tcp和L7http)，lvs，Haproxy(L4 和L7)高可用：keepalived heartbeat静态web服务：Nginx，Apache IIS动态web服务：php(php-fpm)，java(tomcat，resinm,weblogic)，python(python)关系型数据库服务：mysql(mariadb)，oracle，postgresql非关系型数据库：Mongodb,Redis，hbase存储服务：NFS,MFS,FASTDFS,CEPH,HADOOP复制备份 ：sersync，rsync 定时备份（crond&#43;rsync）实时备份（rsync&#43;sersync）ELFK分布式日志集群
Elasticsearch 数据存储
Filebeat 数据收集
Logstash 数据处理
Kibana 数据分析和展示
Kafaka消息队列服务
Zookeeper集群
Hadoop大数据存储VPN服务：硬件VPN,openvpn，pptp跳板机服务:硬件跳板机，jumperver（可视化、图形化、记录日志）批量管理服务: ssh（key）服务，ansible服务（常用），saltstak，cfengine，expect,ssh-pass,SecureCRT监控服务：nagios(早期的)，zabbix，promothous(普罗米修斯)，grafana(可视化工具)时间服务数据仓库：yum仓库，rpm包变更管理:jira版本管理:git gitlab代码及配置发布：jenkins ants maven代码质量检测：sonarqube代码发布流程：办公室测试-idc测试-idc1/2服务器组-余下的服务器（发布一个地区，灰度发布）运维开发平台，将变更管理、版本管理、代码发布及配置，代码质量检测，监控服务等所有组件整合到一起Vmware workstation:学习使用虚拟主机：xen、kvm云计算服务 ：openstack(私有云)，python语言开发容器化：docker&#43;k8 go语言开发公有云服务：阿里云，腾讯云。未来就是公有云和容器化时代！ 集群模板机创建 使用标准分区配置两个网卡，第二块网卡无需配置网关
Linux系统优化 以下优化方面有部分需要在服务稳定后再进行操作，避免环境出现问题 用户优化 安装系统最后一步将oldboy加了管理员的设置方法。是将新用户加入了wheel组。
[root@zhk ~]# grep wheel /etc/sudoers ## Allows people in group wheel to run all commands %wheel	ALL=(ALL)	ALL #%wheel代表wheel组 # %wheel	ALL=(ALL)	NOPASSWD: ALL 如果没有上述操作，需要新建用户加入sudo管理禁止root远程登录，使用新增的用户登录，并配置xshell连接（复制之前成功会话，无需新建）ssh端口也可修改" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5d762d990027e1f58fee2ced473438e7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-07T13:52:26+08:00" />
<meta property="article:modified_time" content="2022-12-07T13:52:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【SRE笔记 2022.9.30 集群知识及Centos基础优化】</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>SRE笔记 2022.9.30</h4> 
 <ul><li><a href="#_1" rel="nofollow">集群内服务软件</a></li><li><a href="#_40" rel="nofollow">集群模板机创建</a></li><li><a href="#Linux_44" rel="nofollow">Linux系统优化</a></li><li><ul><li><a href="#_46" rel="nofollow">用户优化</a></li><li><a href="#ssh_64" rel="nofollow">ssh远程连接效率提升</a></li><li><a href="#yum_76" rel="nofollow">配置yum源</a></li><li><a href="#_81" rel="nofollow">常用软件安装</a></li><li><a href="#_86" rel="nofollow">安全优化</a></li><li><a href="#_110" rel="nofollow">中文字符集（非必要）</a></li><li><a href="#_129" rel="nofollow">时间同步</a></li><li><a href="#_135" rel="nofollow">提升命令行安全（可选）</a></li><li><a href="#_156" rel="nofollow">加大文件描述符</a></li><li><a href="#_166" rel="nofollow">优化内核</a></li><li><a href="#_218" rel="nofollow">扩展优化</a></li><li><a href="#_236" rel="nofollow">关键文件锁定</a></li><li><a href="#_257" rel="nofollow">清楚多余虚拟账户（可选）</a></li><li><a href="#grub_259" rel="nofollow">grub引导加密</a></li><li><a href="#ping_271" rel="nofollow">禁ping（内核参数）</a></li><li><a href="#_277" rel="nofollow">补丁升级</a></li><li><a href="#_282" rel="nofollow">开机自启精简</a></li><li><a href="#_295" rel="nofollow">生产企业最小化原则</a></li><li><a href="#_302" rel="nofollow">扩展优化</a></li><li><a href="#_308" rel="nofollow">创建规范目录</a></li><li><a href="#_313" rel="nofollow">检查端口</a></li></ul> 
  </li><li><a href="#IP_331" rel="nofollow">集群IP规划</a></li><li><ul><li><a href="#_346" rel="nofollow">配置内网解析</a></li><li><a href="#_377" rel="nofollow">安装及配置路径规划</a></li><li><a href="#_388" rel="nofollow">拍摄快照</a></li><li><a href="#_390" rel="nofollow">克隆</a></li></ul> 
  </li><li><a href="#rsync_398" rel="nofollow">rsync复制软件</a></li><li><ul><li><a href="#_399" rel="nofollow">简介及特性</a></li><li><a href="#_411" rel="nofollow">增量复制原理</a></li><li><a href="#_413" rel="nofollow">版本</a></li><li><a href="#_416" rel="nofollow">三种工作模式</a></li><li><ul><li><a href="#local_419" rel="nofollow">local(本地)</a></li><li><a href="#Access_via_remote_shell_476" rel="nofollow">Access via remote shell(隧道）</a></li><li><ul><li><a href="#shell_480" rel="nofollow">远程shell企业场景</a></li><li><a href="#_525" rel="nofollow">无隧道</a></li><li><a href="#_541" rel="nofollow">有隧道</a></li></ul> 
    </li><li><a href="#access_via_rsync_daemonCS_546" rel="nofollow">access via rsync daemon(CS架构)(常用)</a></li><li><ul><li><a href="#_552" rel="nofollow">服务端配置文件</a></li><li><a href="#_562" rel="nofollow">配置密码文件</a></li><li><a href="#_568" rel="nofollow">创建相关备份目录</a></li><li><a href="#_570" rel="nofollow">启动服务端</a></li><li><a href="#_589" rel="nofollow">客户端配置</a></li><li><ul><li><a href="#_590" rel="nofollow">方法一</a></li><li><a href="#_605" rel="nofollow">方法二</a></li></ul> 
     </li><li><a href="#_612" rel="nofollow">测试</a></li><li><ul><li><a href="#_625" rel="nofollow">客户端命令参数</a></li></ul> 
     </li><li><a href="#_654" rel="nofollow">客户端复制报错案例</a></li><li><ul><li><a href="#_670" rel="nofollow">多模块复制</a></li><li><a href="#_672" rel="nofollow">排除文件复制</a></li></ul> 
    </li></ul> 
   </li></ul> 
   </li><li><a href="#_704" rel="nofollow">主机之间数据无差异复制</a></li><li><a href="#_728" rel="nofollow">断点</a></li><li><a href="#_730" rel="nofollow">限速</a></li></ul> 
  </li><li><a href="#_732" rel="nofollow">优缺点</a></li><li><ul><li><a href="#_733" rel="nofollow">优点</a></li><li><a href="#_737" rel="nofollow">缺点</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>集群内服务软件</h2> 
<ul><li>防火墙：深信服，天融信，华为，思科</li><li>CDN服务: 阿里CDN，腾讯CDN，网宿CDN</li><li>DNS服务：阿里云DNS，腾讯DNS,硬件F5,bind，powerDNS</li><li>负载均衡：ngingx(L4tcp和L7http)，lvs，Haproxy(L4 和L7)</li><li>高可用：keepalived heartbeat</li><li>静态web服务：Nginx，Apache IIS</li><li>动态web服务：php(php-fpm)，java(tomcat，resinm,weblogic)，python(python)</li><li>关系型数据库服务：mysql(mariadb)，oracle，postgresql</li><li>非关系型数据库：Mongodb,Redis，hbase</li><li>存储服务：NFS,MFS,FASTDFS,CEPH,HADOOP</li><li>复制备份 ：sersync，rsync 定时备份（crond+rsync）实时备份（rsync+sersync）</li><li>ELFK分布式日志集群<br> Elasticsearch 数据存储<br> Filebeat 数据收集<br> Logstash 数据处理<br> Kibana 数据分析和展示<br> Kafaka消息队列服务<br> Zookeeper集群<br> Hadoop大数据存储</li><li>VPN服务：硬件VPN,openvpn，pptp</li><li>跳板机服务:硬件跳板机，jumperver（可视化、图形化、记录日志）</li><li>批量管理服务: ssh（key）服务，ansible服务（常用），saltstak，cfengine，expect,ssh-pass,SecureCRT</li><li>监控服务：nagios(早期的)，zabbix，promothous(普罗米修斯)，grafana(可视化工具)</li><li>时间服务</li><li>数据仓库：yum仓库，rpm包</li><li>变更管理:jira</li><li>版本管理:git gitlab</li><li>代码及配置发布：jenkins ants maven</li><li>代码质量检测：sonarqube</li><li>代码发布流程：办公室测试-idc测试-idc1/2服务器组-余下的服务器（发布一个地区，灰度发布）</li><li>运维开发平台，将变更管理、版本管理、代码发布及配置，代码质量检测，监控服务等所有组件整合到一起</li><li>Vmware workstation:学习使用</li><li>虚拟主机：xen、kvm</li><li>云计算服务 ：openstack(私有云)，python语言开发</li><li>容器化：docker+k8 go语言开发</li><li>公有云服务：阿里云，腾讯云。</li><li><strong>未来就是公有云和容器化时代！</strong></li></ul> 
<h2><a id="_40"></a>集群模板机创建</h2> 
<ul><li>使用标准分区</li><li>配置两个网卡，第二块网卡无需配置网关<br> <img src="https://images2.imgbox.com/31/d3/E7XwASIi_o.png" alt="在这里插入图片描述"></li></ul> 
<h2><a id="Linux_44"></a>Linux系统优化</h2> 
<ul><li><strong>以下优化方面有部分需要在服务稳定后再进行操作，避免环境出现问题</strong></li></ul> 
<h3><a id="_46"></a>用户优化</h3> 
<ul><li>安装系统最后一步将oldboy加了管理员的设置方法。是将新用户加入了wheel组。<br> <img src="https://images2.imgbox.com/41/97/V1s5IbEp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/97/f6/W6txhHLj_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># grep wheel /etc/sudoers</span>
<span class="token comment">## Allows people in group wheel to run all commands</span>
%wheel	<span class="token assign-left variable">ALL</span><span class="token operator">=</span><span class="token punctuation">(</span>ALL<span class="token punctuation">)</span>	ALL <span class="token comment">#%wheel代表wheel组</span>
<span class="token comment"># %wheel	ALL=(ALL)	NOPASSWD: ALL</span>
</code></pre> 
<ul><li>如果没有上述操作，需要新建用户加入sudo管理</li><li>禁止root远程登录，使用新增的用户登录，并配置xshell连接（复制之前成功会话，无需新建）</li><li>ssh端口也可修改<br> <img src="https://images2.imgbox.com/cc/28/ytZJxU49_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># vi /etc/ssh/sshd_config </span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f1/ac/bwDPqNt4_o.png" alt="-"></p> 
<h3><a id="ssh_64"></a>ssh远程连接效率提升</h3> 
<ul><li>修改为no<br> <img src="https://images2.imgbox.com/57/1f/tnqjTT4S_o.png" alt="在这里插入图片描述"></li><li>修改为no<br> <img src="https://images2.imgbox.com/f0/0d/96aZcNaS_o.png" alt="在这里插入图片描述"></li><li>修改为no<br> <img src="https://images2.imgbox.com/8a/fe/1JtJYGY5_o.png" alt="在这里插入图片描述"></li><li>监听IP修改（内网，避免外网探测及连接），默认SSH的22端口监听所有IP<br> <img src="https://images2.imgbox.com/82/2a/guX3S4Gk_o.png" alt="在这里插入图片描述"><br> -修改位置（练习模板机未修改，生产环境需要修改）<br> <img src="https://images2.imgbox.com/40/1c/X9SBY7zF_o.png" alt="在这里插入图片描述"></li><li>修改完成后，外网IP无法连接</li></ul> 
<h3><a id="yum_76"></a>配置yum源</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># curl -s -o /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-7.repo</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># curl -s -o /etc/yum.repos.d/epel.repo http://mirrors.aliyun.com/repo/epel-7.repo</span>
</code></pre> 
<h3><a id="_81"></a>常用软件安装</h3> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> net-tools tree nmap dos2unix lrzsz <span class="token function">nc</span> <span class="token function">lsof</span> <span class="token function">wget</span> tcpdump <span class="token function">htop</span> iftop sysstat nethogs psmisc bash-completion vim-enhanced
</code></pre> 
<p><img src="https://images2.imgbox.com/58/91/owfTkdpJ_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_86"></a>安全优化</h3> 
<ul><li>selinux关闭</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># sed -i 's#SELINUX=enforcing#SELINUX=disable#g' /etc/selinux/config</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># grep -i selinux /etc/selinux/config</span>
<span class="token comment"># This file controls the state of SELinux on the system.</span>
<span class="token comment"># SELINUX= can take one of these three values:</span>
<span class="token comment">#     enforcing - SELinux security policy is enforced.</span>
<span class="token comment">#     permissive - SELinux prints warnings instead of enforcing.</span>
<span class="token comment">#     disabled - No SELinux policy is loaded.</span>
<span class="token assign-left variable">SELINUX</span><span class="token operator">=</span>disable
<span class="token comment"># SELINUXTYPE= can take one of three values:</span>
<span class="token assign-left variable">SELINUXTYPE</span><span class="token operator">=</span>targeted 
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># setenforce 0</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># getenforce </span>
Permissive
</code></pre> 
<ul><li>防火墙关闭</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># systemctl stop firewalld</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># systemctl disable firewalld</span>
Removed symlink /etc/systemd/system/multi-user.target.wants/firewalld.service.
Removed symlink /etc/systemd/system/dbus-org.fedoraproject.FirewallD1.service.
</code></pre> 
<h3><a id="_110"></a>中文字符集（非必要）</h3> 
<ul><li>方法一</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/locale.conf /etc/locale.conf.ori</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># echo 'LANG="zh_CN.UTF-8"' &gt; /etc/locale.conf</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># source /etc/locale.conf</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># echo $LANG</span>
zh_CN.UTF-8
</code></pre> 
<ul><li>方法二</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># cp /etc/locale.conf /etc/locale.conf.ori</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># localectl set-locale LANG="zh_CN.UTF-8"</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># echo $LANG</span>
en_US.UTF-8
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># source /etc/locale.conf</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># echo $LANG</span>
zh_CN.UTF-8
</code></pre> 
<h3><a id="_129"></a>时间同步</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment">#  crontab -e</span>
<span class="token comment">#时间同步</span>
*/30 * * * * /usr/sbin/ntpdate ntp5.aliyun.com <span class="token operator">&amp;&gt;</span> /devl/null
</code></pre> 
<h3><a id="_135"></a>提升命令行安全（可选）</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># echo 'export TMOUT=300' &gt;&gt; /etc/profile</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># echo 'export HISTSIZE=5' &gt;&gt; /etc/profile</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># echo 'export HISTFILESIZE=5' &gt;&gt; /etc/profile</span>
您在 /var/spool/mail/root 中有邮件
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># tail -f /etc/pr</span>
prelink.conf.d/ <span class="token function">printcap</span>        profile         profile.d/      protocols
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># tail -f /etc/profile</span>
            <span class="token builtin class-name">.</span> <span class="token string">"<span class="token variable">$i</span>"</span> <span class="token operator">&gt;</span>/dev/null
        <span class="token keyword">fi</span>
    <span class="token keyword">fi</span>
<span class="token keyword">done</span>

<span class="token builtin class-name">unset</span> i
<span class="token builtin class-name">unset</span> <span class="token parameter variable">-f</span> pathmunge
<span class="token builtin class-name">export</span> <span class="token assign-left variable">TMOUT</span><span class="token operator">=</span><span class="token number">300</span> <span class="token comment">#300s无操作超时断开</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HISTSIZE</span></span><span class="token operator">=</span><span class="token number">5</span><span class="token comment"># 控制内存中保存的历史命令5条，默认1000条</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">HISTFILESIZE</span></span><span class="token operator">=</span><span class="token number">5</span>
<span class="token punctuation">[</span>root@zhk etc<span class="token punctuation">]</span><span class="token comment"># . /etc/profile</span>
</code></pre> 
<h3><a id="_156"></a>加大文件描述符</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk etc<span class="token punctuation">]</span><span class="token comment"># ulimit -n</span>
<span class="token number">1024</span>
<span class="token punctuation">[</span>root@zhk etc<span class="token punctuation">]</span><span class="token comment"># echo '* - nofile 65535' &gt;&gt; /etc/security/limits.conf </span>
<span class="token punctuation">[</span>root@zhk etc<span class="token punctuation">]</span><span class="token comment"># ulimit -SHn 65535</span>
<span class="token punctuation">[</span>root@zhk etc<span class="token punctuation">]</span><span class="token comment"># ulimit -n</span>
<span class="token number">65535</span>
</code></pre> 
<ul><li>之后退出重新登录生效</li></ul> 
<h3><a id="_166"></a>优化内核</h3> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/sysctl.conf <span class="token operator">&lt;&lt;</span> <span class="token string">EOF
#针对网络
net.ipv4.tcp_fin_timeout = 2
net.ipv4.tcp_max_orphans = 16384
net.ipv4.ip_local_port_range = 2000 65000
net.ipv4.tcp_max_syn_backlog = 16384
net.core.somaxconn = 16384
net.ipv4.tcp_max_tw_buckets = 36000
net.ipv4.tcp_syn_retries = 1
net.ipv4.tcp_synack_retries = 1
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_tw_recycle = 1
net.ipv4.tcp_syncookies = 1
net.ipv4.tcp_keepalive_time = 600
net.ipv4.route.gc_timeout = 100
net.core.netdev_max_backlog = 16384

#针对iptables，防火墙如果关闭不会提示
net.nf_conntrack_max  =25000000  # 防火墙最大连接数
net.netfilter.nf_conntrack_max = 25000000 net.netfilter.nf_conntrack_tcp_timeout_established = 180 net.netfilter.nf_conntrack_tcp_timeout_time_wait = 120
net.netfilter.nf_conntrack_tcp_timeout_close_wait = 60 net.netfilter.nf_conntrack_tcp_timeout_fin_wait = 120
#nfs 共享存储优化
net.core.wmem_default = 8388608
net.core.rmem_default = 8388608
net.core.wmem_max = 16777216
net.core.rmem_max
EOF</span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># sysctl -p</span>
net.ipv4.tcp_fin_timeout <span class="token operator">=</span> <span class="token number">2</span>   
net.ipv4.tcp_max_orphans <span class="token operator">=</span> <span class="token number">16384</span>  <span class="token comment">#</span>
net.ipv4.ip_local_port_range <span class="token operator">=</span> <span class="token number">2000</span> <span class="token number">65000</span>
net.ipv4.tcp_max_syn_backlog <span class="token operator">=</span> <span class="token number">16384</span>
net.core.somaxconn <span class="token operator">=</span> <span class="token number">16384</span>
net.ipv4.tcp_max_tw_buckets <span class="token operator">=</span> <span class="token number">36000</span>
net.ipv4.tcp_syn_retries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_synack_retries <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_tw_reuse <span class="token operator">=</span> <span class="token number">1</span> 
net.ipv4.tcp_tw_recycle <span class="token operator">=</span> <span class="token number">1</span> 
net.ipv4.tcp_syncookies <span class="token operator">=</span> <span class="token number">1</span>
net.ipv4.tcp_keepalive_time <span class="token operator">=</span> <span class="token number">600</span>
net.ipv4.route.gc_timeout <span class="token operator">=</span> <span class="token number">100</span>
net.core.netdev_max_backlog <span class="token operator">=</span> <span class="token number">16384</span>
sysctl: cannot <span class="token function">stat</span> /proc/sys/net/nf_conntrack_max: 没有那个文件或目录
sysctl: cannot <span class="token function">stat</span> /proc/sys/net/netfilter/nf_conntrack_max: 没有那个文件或目录
sysctl: cannot <span class="token function">stat</span> /proc/sys/net/netfilter/nf_conntrack_tcp_timeout_close_wait: 没有那个文件或目录
net.core.wmem_default <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.rmem_default <span class="token operator">=</span> <span class="token number">8388608</span>
net.core.wmem_max <span class="token operator">=</span> <span class="token number">16777216</span>
sysctl: /etc/sysctl.conf<span class="token punctuation">(</span><span class="token number">35</span><span class="token punctuation">)</span>: invalid syntax, continuing<span class="token punctuation">..</span>
</code></pre> 
<h3><a id="_218"></a>扩展优化</h3> 
<p>-为以后意见安装网站集群留好rpm及依赖工具包</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk /<span class="token punctuation">]</span><span class="token comment"># sed -i 's@keepcache=0@keepcache=1@g' /etc/yum.conf </span>
<span class="token punctuation">[</span>root@zhk /<span class="token punctuation">]</span><span class="token comment"># cat /etc/yum.conf </span>
<span class="token punctuation">[</span>main<span class="token punctuation">]</span>
<span class="token assign-left variable">cachedir</span><span class="token operator">=</span>/var/cache/yum/<span class="token variable">$basearch</span>/<span class="token variable">$releasever</span>
<span class="token assign-left variable">keepcache</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">debuglevel</span><span class="token operator">=</span><span class="token number">2</span>
<span class="token assign-left variable">logfile</span><span class="token operator">=</span>/var/log/yum.log
<span class="token assign-left variable">exactarch</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">obsoletes</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">plugins</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">installonly_limit</span><span class="token operator">=</span><span class="token number">5</span>
<span class="token assign-left variable">bugtracker_url</span><span class="token operator">=</span>http://bugs.centos.org/set_project.php?project_id<span class="token operator">=</span><span class="token number">23</span><span class="token operator">&amp;</span><span class="token assign-left variable">ref</span><span class="token operator">=</span>http://bugs.centos.org/bug_report_page.php?category<span class="token operator">=</span>yum
<span class="token assign-left variable">distroverpkg</span><span class="token operator">=</span>centos-release
</code></pre> 
<h3><a id="_236"></a>关键文件锁定</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># chattr +i  /etc/passwd /etc/shadow /etc/gshadow /etc/group /etc/inittab </span>
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># lsattr  /etc/passwd /etc/shadow /etc/gshadow /etc/group /etc/inittab </span>
----i----------- /etc/passwd
----i----------- /etc/shadow
----i----------- /etc/gshadow
----i----------- /etc/group
----i----------- /etc/inittab
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span><span class="token comment"># </span>
<span class="token punctuation">[</span>root@zhk bin<span class="token punctuation">]</span><span class="token comment"># mv chattr hd01</span>
<span class="token punctuation">[</span>root@zhk bin<span class="token punctuation">]</span><span class="token comment"># mv lsattr hd02</span>
</code></pre> 
<ul><li>锁定并给相关命令改名</li><li>以后添加用户需要先解锁，然后再加锁，可写脚本处理<br> 如</li></ul> 
<pre><code class="prism language-bash">hd01 <span class="token parameter variable">-i</span>   /etc/passwd /etc/shadow /etc/gshadow /etc/group /etc/initta
<span class="token function">useradd</span> <span class="token variable">$1</span>
hd02 +i  /etc/passwd /etc/shadow /etc/gshadow /etc/group /etc/inittab                                                                     
</code></pre> 
<h3><a id="_257"></a>清楚多余虚拟账户（可选）</h3> 
<ul><li>也可加注释屏蔽</li></ul> 
<h3><a id="grub_259"></a>grub引导加密</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk bin<span class="token punctuation">]</span><span class="token comment"># grub2-setpassword </span>
Enter password: 
Confirm password: 
</code></pre> 
<ul><li>修改后查看grub配置文件</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk bin<span class="token punctuation">]</span><span class="token comment"># cat /boot/grub2/user.cfg </span>
<span class="token assign-left variable">GRUB2_PASSWORD</span><span class="token operator">=</span>grub.pbkdf2.sha512.10000.824CCD028FD9910D276A77D9FEBB4DA88264057C146F31C6AB7C0C803C6B8D7C81D81195694E1014EEB8ED5F7E339F07CA8000990CDE4BE2FE2129A30B0B1B64.2A404210EC0FE108FDA011CBEF594820E382FC4E2B54A6B96FDD0A1C4721C987579CBD6D9ED8563360EB1B46B7BCA71ADC9244F3D371888530C53C3D202E61D9
</code></pre> 
<ul><li><strong>重启未生效，待处理</strong>…</li></ul> 
<h3><a id="ping_271"></a>禁ping（内核参数）</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk bin<span class="token punctuation">]</span><span class="token comment"># echo "net.ipv4.icmp_echo_ignore_all=1" &gt;&gt; /etc/sysctl.conf </span>
<span class="token punctuation">[</span>root@zhk bin<span class="token punctuation">]</span><span class="token comment"># sysctl -p</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/fb/laS5yV1i_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_277"></a>补丁升级</h3> 
<ul><li>环境部署好后升级，生产后不要操作</li></ul> 
<pre><code class="prism language-bash">yum update <span class="token parameter variable">-y</span>
</code></pre> 
<h3><a id="_282"></a>开机自启精简</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ systemctl list-unit-files <span class="token operator">|</span> <span class="token function">grep</span> <span class="token builtin class-name">enable</span><span class="token operator">|</span><span class="token function">egrep</span> <span class="token parameter variable">-v</span> <span class="token string">"sshd.service|crond.service|sysstat|rsyslo^NetworkManager.service|irqbalance,service"</span><span class="token operator">|</span><span class="token function">awk</span> <span class="token string">'{print "systemctl disable",$1}'</span><span class="token operator">|</span><span class="token function">bash</span>
</code></pre> 
<ul><li>保留以上服务</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ systemctl list-unit-files <span class="token operator">|</span> <span class="token function">grep</span> <span class="token builtin class-name">enable</span>
autovt@.service                               enabled 
crond.service                                 enabled 
getty@.service                                enabled 
sshd.service                                  enabled 
sysstat.service                               enabled 
</code></pre> 
<h3><a id="_295"></a>生产企业最小化原则</h3> 
<ul><li>安装软件包最小化</li><li>用户权限最小化</li><li>目录文件权限最小化</li><li>自启动服务最小化</li><li>服务运行用户权限最小化</li><li>服务运行用户权限最小化</li></ul> 
<h3><a id="_302"></a>扩展优化</h3> 
<pre><code class="prism language-bash"><span class="token builtin class-name">echo</span> <span class="token string">"PS1='\[<span class="token entity" title="\e">\e</span>[32;1m\] [\u@\h \W]<span class="token entity" title="\\">\\</span>$ \[<span class="token entity" title="\e">\e</span>[0m\]'"</span> <span class="token operator">&gt;&gt;</span> /etc/profile
<span class="token builtin class-name">source</span> /etc/profile
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/53/UaOCxVZs_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_308"></a>创建规范目录</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /server/scripts
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /server/tools
</code></pre> 
<h3><a id="_313"></a>检查端口</h3> 
<ul><li>剩余ssh端口是最安全的状态</li><li>postfix服务需要重启才能生效</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ <span class="token function">netstat</span> <span class="token parameter variable">-lntup</span>
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1214</span>/sshd           
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">127.0</span>.0.1:25            <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1371</span>/master         
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::22                   :::*                    LISTEN      <span class="token number">1214</span>/sshd           
tcp6       <span class="token number">0</span>      <span class="token number">0</span> ::1:25                  :::*                    LISTEN      <span class="token number">1371</span>/master         
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ systemctl stop postfix
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ <span class="token function">netstat</span> <span class="token parameter variable">-lntup</span>
Active Internet connections <span class="token punctuation">(</span>only servers<span class="token punctuation">)</span>
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:22              <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">1214</span>/sshd           
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::22                   :::*                    LISTEN      <span class="token number">1214</span>/sshd           
</code></pre> 
<h2><a id="IP_331"></a>集群IP规划</h2> 
<table><thead><tr><th>服务器说明</th><th>eth0 外网IP(NAT)</th><th>eth1 内网IP(NAT)</th><th>主机名称规则</th></tr></thead><tbody><tr><td>A1-负载服务器 01</td><td>10.0.0.5/24</td><td>172.16.1.5/16</td><td>lb01</td></tr><tr><td>A2-负载服务器 02</td><td>10.0.0.6/24</td><td>172.16.1.6/16</td><td>lb02</td></tr><tr><td>b1-web 服务器 1</td><td>10.0.0.7/24</td><td>172.16.1.7/16</td><td>web01</td></tr><tr><td>b2-web 服务器 2</td><td>10.0.0.8/24</td><td>172.16.1.8/16</td><td></td></tr><tr><td>SB1-web 服务器 1</td><td>10.0.0.9/24</td><td>172.16.1.9/16</td><td>sweb01</td></tr><tr><td>SB2-web 服务器 2</td><td>10.0.0.10/24</td><td>172.16.1.10/16</td><td>sweb02</td></tr><tr><td>C1-NFS 存储服务器</td><td>10.0.0.31/24</td><td>172.16.1.31/16</td><td>nfs01</td></tr><tr><td>C2-rsync 备份服务器</td><td>10.0.0.41/24</td><td>172.16.1.41/16</td><td>backup</td></tr><tr><td>C3-msyql 数据库服务器</td><td>10.0.0.51/24</td><td>172.16.1.51/16</td><td>db01</td></tr><tr><td>X-管理服务器</td><td>10.0.0.61/24</td><td>172.16.1.61/16</td><td>m01</td></tr></tbody></table> 
<p>记得两个网卡要设置开机自启</p> 
<h3><a id="_346"></a>配置内网解析</h3> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> <span class="token operator">&gt;&gt;</span> /etc/hosts <span class="token operator">&lt;&lt;</span> EOF
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.5  lb01          
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.6   lb02         
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.7     web01       
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.8    web02        
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.9    sweb01     
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.10   sweb02
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.31   nfs01
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.41   backup
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.51  db01
<span class="token operator">&gt;</span> <span class="token number">172.16</span>.1.61   m01
<span class="token operator">&gt;</span> EOF
<span class="token punctuation">[</span>root@zhk ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/hosts
<span class="token number">127.0</span>.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
<span class="token number">172.16</span>.1.5  lb01          
<span class="token number">172.16</span>.1.6   lb02         
<span class="token number">172.16</span>.1.7     web01       
<span class="token number">172.16</span>.1.8    web02        
<span class="token number">172.16</span>.1.9    sweb01     
<span class="token number">172.16</span>.1.10   sweb02
<span class="token number">172.16</span>.1.31   nfs01
<span class="token number">172.16</span>.1.41   backup
<span class="token number">172.16</span>.1.51  db01
<span class="token number">172.16</span>.1.61   m01
</code></pre> 
<ul><li>eth网卡的LAN区段要修改为172<br> <img src="https://images2.imgbox.com/7a/f5/U23MAYFM_o.png" alt="在这里插入图片描述"></li><li>内网区段网卡不必配置DNS</li></ul> 
<h3><a id="_377"></a>安装及配置路径规划</h3> 
<table><thead><tr><th>目录说明</th><th>目录结构说明</th></tr></thead><tbody><tr><td>/server/scripts</td><td>服务器本地存放脚本程序的目录</td></tr><tr><td>/server/tools</td><td>服务器本地存放软件安装包的目录</td></tr><tr><td>/application/软件名</td><td>服务器本地软件安装的根目录，软件名不带版本号，例如/application/nginx</td></tr><tr><td>/application/nginx/html</td><td>web服务器站点目录(bbs.blog.www.edu)</td></tr><tr><td>/application/nginx/log</td><td>web服务器日志(bbs</td></tr><tr><td>/back</td><td>服务器本地数据备份目录，也是备份服务器RSYC的备份目录</td></tr><tr><td>/data</td><td>NFS共享存储共享文件目录</td></tr></tbody></table> 
<h3><a id="_388"></a>拍摄快照</h3> 
<ul><li>拍摄优化后的集群模板机快照</li></ul> 
<h3><a id="_390"></a>克隆</h3> 
<ul><li>链接克隆，节省空间</li><li>克隆web01 nfs01 backup三台。<br> <img src="https://images2.imgbox.com/35/56/byYLin4R_o.png" alt="在这里插入图片描述"></li><li>先开启backup</li><li>通过脚本修改IP和主机名，节省时间<br> <img src="https://images2.imgbox.com/b4/1d/itYYzmSY_o.png" alt="在这里插入图片描述"></li><li>配置xshell会话</li></ul> 
<h2><a id="rsync_398"></a>rsync复制软件</h2> 
<h3><a id="_399"></a>简介及特性</h3> 
<ul><li>全称是Remote sync hronization，是开源的，高速的，可实现本地及远程，全量以及增量的数据复制拷贝工具。</li><li>rsync工作在网络层</li><li>wget工作在应用层</li><li>支持复制链接、设备、所有者、组和权限</li><li>exclude和exclude-from类似于GNU tar的选项</li><li>不需要超级用户权限</li><li>文件传输流水线以最小化延迟成本</li><li>可以使用任何透明的远程shell 包括ssh rsh，借助ssh隧道加密</li><li>不需要超级用户权限</li><li>文件传输流水线以最小化延迟成本</li><li>支持匿名或经过身份验证的rsync守护进程(有服务端)</li></ul> 
<h3><a id="_411"></a>增量复制原理</h3> 
<ul><li>使用quick check算法，只对增量的部分进行复制，该算法查找大小或上次修改时间已更改的文件进行增量复制</li></ul> 
<h3><a id="_413"></a>版本</h3> 
<ul><li>2.x 比对差异后复制</li><li>3.x 一边比对一边复制</li></ul> 
<h3><a id="_416"></a>三种工作模式</h3> 
<ul><li>参数 avg</li><li>expect工具帮助人工交互省的输入密码了。</li></ul> 
<h4><a id="local_419"></a>local(本地)</h4> 
<p>rsync [选项] src [dest]</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avz</span> /etc /tmp/  <span class="token comment"># a=rtopg</span>
</code></pre> 
<ul><li>注意etc目录如果不带斜线是把整个目录直接拷贝过去，</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ <span class="token function">ls</span> /tmp/
etc
</code></pre> 
<ul><li>带斜线是把目录下所有的内容拷贝过去</li><li>删除文件内容</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup /<span class="token punctuation">]</span>$ <span class="token function">touch</span> null.txt
<span class="token punctuation">[</span>root@backup /<span class="token punctuation">]</span>$ ll
总用量 <span class="token number">44</span>
-rw-r--r--.   <span class="token number">1</span> root root   <span class="token number">12</span> <span class="token number">10</span>月  <span class="token number">4</span> <span class="token number">11</span>:42 aa.txt
lrwxrwxrwx.   <span class="token number">1</span> root root    <span class="token number">7</span> <span class="token number">10</span>月  <span class="token number">3</span> <span class="token number">22</span>:12 bin -<span class="token operator">&gt;</span> usr/bin
dr-xr-xr-x.   <span class="token number">5</span> root root <span class="token number">4096</span> <span class="token number">10</span>月  <span class="token number">4</span> <span class="token number">11</span>:57 boot
drwxr-xr-x.  <span class="token number">19</span> root root <span class="token number">3180</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">17</span>:33 dev
drwxr-xr-x.  <span class="token number">82</span> root root <span class="token number">8192</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">17</span>:33 etc
drwxr-xr-x.   <span class="token number">3</span> root root   <span class="token number">17</span> <span class="token number">10</span>月  <span class="token number">3</span> <span class="token number">22</span>:17 home
lrwxrwxrwx.   <span class="token number">1</span> root root    <span class="token number">7</span> <span class="token number">10</span>月  <span class="token number">3</span> <span class="token number">22</span>:12 lib -<span class="token operator">&gt;</span> usr/lib
lrwxrwxrwx.   <span class="token number">1</span> root root    <span class="token number">9</span> <span class="token number">10</span>月  <span class="token number">3</span> <span class="token number">22</span>:12 lib64 -<span class="token operator">&gt;</span> usr/lib64
drwxr-xr-x.   <span class="token number">2</span> root root    <span class="token number">6</span> <span class="token number">4</span>月  <span class="token number">11</span> <span class="token number">2018</span> media
drwxr-xr-x.   <span class="token number">3</span> root root   <span class="token number">18</span> <span class="token number">10</span>月  <span class="token number">4</span> <span class="token number">11</span>:54 mnt
-rw-r--r--.   <span class="token number">1</span> root root    <span class="token number">0</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">18</span>:58 null.txt
drwxr-xr-x.  <span class="token number">82</span> root root <span class="token number">8192</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">17</span>:33 opt
dr-xr-xr-x. <span class="token number">100</span> root root    <span class="token number">0</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">17</span>:32 proc
dr-xr-x---.   <span class="token number">2</span> root root  <span class="token number">164</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">17</span>:31 root
drwxr-xr-x.  <span class="token number">21</span> root root  <span class="token number">500</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">17</span>:33 run
lrwxrwxrwx.   <span class="token number">1</span> root root    <span class="token number">8</span> <span class="token number">10</span>月  <span class="token number">3</span> <span class="token number">22</span>:12 sbin -<span class="token operator">&gt;</span> usr/sbin
drwxr-xr-x.   <span class="token number">4</span> root root   <span class="token number">34</span> <span class="token number">10</span>月  <span class="token number">4</span> <span class="token number">21</span>:22 server
drwxr-xr-x.   <span class="token number">2</span> root root    <span class="token number">6</span> <span class="token number">4</span>月  <span class="token number">11</span> <span class="token number">2018</span> srv
dr-xr-xr-x.  <span class="token number">13</span> root root    <span class="token number">0</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">17</span>:33 sys
drwxr-xr-x.  <span class="token number">88</span> root root <span class="token number">8192</span> <span class="token number">10</span>月  <span class="token number">5</span> <span class="token number">18</span>:51 tmp
drwxr-xr-x.  <span class="token number">13</span> root root  <span class="token number">155</span> <span class="token number">10</span>月  <span class="token number">3</span> <span class="token number">22</span>:12 usr
drwxr-xr-x.  <span class="token number">19</span> root root  <span class="token number">267</span> <span class="token number">10</span>月  <span class="token number">3</span> <span class="token number">22</span>:18 var
<span class="token punctuation">[</span>root@backup /<span class="token punctuation">]</span>$ <span class="token function">cat</span> aa.txt 
<span class="token comment">#UseDNS yes</span>
<span class="token punctuation">[</span>root@backup /<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">--delete</span> null.txt aa.txt <span class="token comment"># 参数改为avg也可以</span>
sending incremental <span class="token function">file</span> list
null.txt

sent <span class="token number">90</span> bytes  received <span class="token number">35</span> bytes  <span class="token number">250.00</span> bytes/sec
total size is <span class="token number">0</span>  speedup is <span class="token number">0.00</span>
<span class="token punctuation">[</span>root@backup /<span class="token punctuation">]</span>$ <span class="token function">cat</span> aa.txt 
</code></pre> 
<ul><li>删除目录</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup /<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">--delete</span> /null/ /opt
</code></pre> 
<ul><li>查看文件属性</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup /<span class="token punctuation">]</span>$ <span class="token function">rsync</span> aa.txt 
-rw-r--r--              <span class="token number">0</span> <span class="token number">2022</span>/10/05 <span class="token number">18</span>:58:46 aa.txt
</code></pre> 
<h4><a id="Access_via_remote_shell_476"></a>Access via remote shell(隧道）</h4> 
<ul><li>pull rsync [选项] [user@]host:src…[dest]</li><li>push rsync [ 选项] src… [user@]host:dest</li><li>企业场景 需要加密的重要数据 未搭建服务端的</li></ul> 
<h5><a id="shell_480"></a>远程shell企业场景</h5> 
<ul><li>配合ssh+免秘钥连接登录(单向从私钥到公钥)，进行文件备份传输工作</li><li>ssh-keygen</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ ssh-keygen 
Generating public/private rsa key pair.
Enter <span class="token function">file</span> <span class="token keyword">in</span> <span class="token function">which</span> to save the key <span class="token punctuation">(</span>/root/.ssh/id_rsa<span class="token punctuation">)</span>: 
Enter passphrase <span class="token punctuation">(</span>empty <span class="token keyword">for</span> no passphrase<span class="token punctuation">)</span>: 
Enter same passphrase again: 
Your identification has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.
Your public key has been saved <span class="token keyword">in</span> /root/.ssh/id_rsa.pub.
The key fingerprint is:
SHA256:R6xmtpOtWSm//wSdnG/7/sB1bj29VEG4bnNm+6UAfkA root@nfs01
The key's randomart image is:
+---<span class="token punctuation">[</span>RSA <span class="token number">2048</span><span class="token punctuation">]</span>----+
<span class="token operator">|</span>              <span class="token punctuation">..</span> <span class="token operator">|</span>
<span class="token operator">|</span>         <span class="token builtin class-name">.</span>   <span class="token punctuation">..</span>  <span class="token operator">|</span>
<span class="token operator">|</span>          E   <span class="token punctuation">..</span> <span class="token operator">|</span>
<span class="token operator">|</span>         +   + o.<span class="token operator">|</span>
<span class="token operator">|</span>        S + o <span class="token operator">=</span> +<span class="token operator">|</span>
<span class="token operator">|</span>       + * + * <span class="token assign-left variable">B</span><span class="token operator">=</span><span class="token operator">|</span>
<span class="token operator">|</span>        <span class="token operator">=</span> <span class="token operator">=</span> + OoX<span class="token operator">|</span>
<span class="token operator">|</span>         B <span class="token builtin class-name">.</span> o.*<span class="token operator">=</span><span class="token operator">|</span>
<span class="token operator">|</span>        o oo<span class="token punctuation">..</span>o+O<span class="token operator">|</span>
+----<span class="token punctuation">[</span>SHA256<span class="token punctuation">]</span>-----+
</code></pre> 
<ul><li>密钥对存放位置，其中rsa相当于钥匙(私钥)，pub文件相当于锁(公钥)</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span> ~/.ssh/
id_rsa  id_rsa.pub  known_hosts
</code></pre> 
<ul><li>把锁放在目标机上（需要把之前的root远程登录打开）</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ ssh-copy-id <span class="token parameter variable">-i</span> ~/.ssh/id_rsa.pub <span class="token number">10.0</span>.0.41
/bin/ssh-copy-id: INFO: Source of key<span class="token punctuation">(</span>s<span class="token punctuation">)</span> to be installed: <span class="token string">"/root/.ssh/id_rsa.pub"</span>
/bin/ssh-copy-id: INFO: attempting to log <span class="token keyword">in</span> with the new key<span class="token punctuation">(</span>s<span class="token punctuation">)</span>, to filter out any that are already installed
/bin/ssh-copy-id: INFO: <span class="token number">1</span> key<span class="token punctuation">(</span>s<span class="token punctuation">)</span> remain to be installed -- <span class="token keyword">if</span> you are prompted now it is to <span class="token function">install</span> the new keys
root@10.0.0.41<span class="token string">'s password: 
Number of key(s) added: 1
Now try logging into the machine, with:   "ssh '</span><span class="token number">10.0</span>.0.41'"
and check to <span class="token function">make</span> sure that only the key<span class="token punctuation">(</span>s<span class="token punctuation">)</span> you wanted were added.
</code></pre> 
<ul><li>公钥位置，文件权限为600，该目录权限为700(满足以上的条件才能使用)<br> <img src="https://images2.imgbox.com/26/90/IEL1bRTr_o.png" alt="在这里插入图片描述"></li><li>之后操作有无隧道传输都可以免密</li></ul> 
<h5><a id="_525"></a>无隧道</h5> 
<ul><li>命令如下，root已禁用远程登录</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avz</span> /etc/hosts zhk@10.0.0.31:/tmp/
The authenticity of <span class="token function">host</span> <span class="token string">'10.0.0.31 (10.0.0.31)'</span> can<span class="token string">'t be established.
ECDSA key fingerprint is SHA256:cARYRR8mqmyHRJezuHO1GTiFEwHKwdV6WMEPOWE/NRI.
ECDSA key fingerprint is MD5:17:88:0a:02:e5:60:01:f0:40:72:94:86:96:28:ad:f2.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added '</span><span class="token number">10.0</span>.0.31<span class="token string">' (ECDSA) to the list of known hosts.
zhk@10.0.0.31'</span>s password: 
sending incremental <span class="token function">file</span> list
hosts

sent <span class="token number">225</span> bytes  received <span class="token number">35</span> bytes  <span class="token number">57.78</span> bytes/sec
total size is <span class="token number">392</span>  speedup is <span class="token number">1.51</span>
</code></pre> 
<h5><a id="_541"></a>有隧道</h5> 
<ul><li>参数e</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avz</span> /etc <span class="token parameter variable">-e</span> <span class="token string">'ssh -p 22'</span> zhk@10.0.0.31:/tmp/
</code></pre> 
<h4><a id="access_via_rsync_daemonCS_546"></a>access via rsync daemon(CS架构)(常用)</h4> 
<ul><li>pull rsync [选项] [user@]host:src…[dest] 或<br> rsync [选项] rsync://[user@]host:[:port]/src…[dest]</li><li>push rsync [ 选项] src… [user@]host:dest 或<br> rsync [选项] src … rsync://[user@]host[:port]/dest</li><li>服务器启动rsync服务，客户端执行推拉命令。主动发起</li></ul> 
<h5><a id="_552"></a>服务端配置文件</h5> 
<ul><li>修改之前记得做备份</li><li>/etc/rsync.conf<br> <img src="https://images2.imgbox.com/8a/33/VhvP1tHL_o.png" alt="在这里插入图片描述"></li><li>**上图配置文件折腾了半天也没完成测试，清空重新配置一遍，问题就在于配置后面的#和注释，会引起问题。如密码文件后还有空格，那认证会出现问题。</li><li>做上下注释<br> <img src="https://images2.imgbox.com/53/f6/l7NDA8r2_o.png" alt="在这里插入图片描述"></li><li>下图清空了注释**<br> <img src="https://images2.imgbox.com/59/41/P1uwltSO_o.png" alt="在这里插入图片描述"></li><li>hosts allow 和denny最好不要同时用，容易有冲突；二选一进行配置。默认允许，且白名单优先级高于黑名单。</li></ul> 
<h5><a id="_562"></a>配置密码文件</h5> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">"rsync_backup:1"</span> <span class="token operator">&gt;</span> /etc/rsync.password
<span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/rsync.password
rsync_backup:1
</code></pre> 
<h5><a id="_568"></a>创建相关备份目录</h5> 
<ul><li>并授权back目录的用户组合主为rsync</li></ul> 
<h5><a id="_570"></a>启动服务端</h5> 
<ul><li>端口号 873</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ systemctl start rsyncd
<span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ systemctl <span class="token builtin class-name">enable</span> rsyncd
Created symlink from /etc/systemd/system/multi-user.target.wants/rsyncd.service to /usr/lib/systemd/system/rsyncd.service.
<span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ systemctl status rsyncd
● rsyncd.service - fast remote <span class="token function">file</span> copy program daemon
   Loaded: loaded <span class="token punctuation">(</span>/usr/lib/systemd/system/rsyncd.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: disabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since 四 <span class="token number">2022</span>-10-06 <span class="token number">10</span>:07:43 CST<span class="token punctuation">;</span> 1h 8min ago
 Main PID: <span class="token number">3918</span> <span class="token punctuation">(</span>rsync<span class="token punctuation">)</span>
   CGroup: /system.slice/rsyncd.service
           └─3918 /usr/bin/rsync <span class="token parameter variable">--daemon</span> --no-detach

<span class="token number">10</span>月 06 <span class="token number">10</span>:07:43 backup systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started fast remote <span class="token function">file</span> copy program daemon.
<span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ <span class="token function">netstat</span> <span class="token parameter variable">-lntup</span> <span class="token operator">|</span> <span class="token function">grep</span> <span class="token function">rsync</span>
tcp        <span class="token number">0</span>      <span class="token number">0</span> <span class="token number">0.0</span>.0.0:873             <span class="token number">0.0</span>.0.0:*               LISTEN      <span class="token number">3918</span>/rsync          
tcp6       <span class="token number">0</span>      <span class="token number">0</span> :::873                  :::*                    LISTEN      <span class="token number">3918</span>/rsync  
</code></pre> 
<h5><a id="_589"></a>客户端配置</h5> 
<h6><a id="_590"></a>方法一</h6> 
<ul><li>配置密码文件</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">'1'</span> <span class="token operator">&gt;</span> /etc/rsync.password
<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">cat</span> /etc/rsync.password
<span class="token number">1</span>
</code></pre> 
<ul><li>配置密码文件权限</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ ll /etc/rsync.password
-rw-r--r--. <span class="token number">1</span> root root <span class="token number">2</span> <span class="token number">10</span>月  <span class="token number">6</span> <span class="token number">11</span>:18 /etc/rsync.password
<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">chmod</span> <span class="token parameter variable">-R</span> 0600 /etc/rsync.password
<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ ll /etc/rsync.password
-rw-------. <span class="token number">1</span> root root <span class="token number">2</span> <span class="token number">10</span>月  <span class="token number">6</span> <span class="token number">11</span>:18 /etc/rsync.password
</code></pre> 
<h6><a id="_605"></a>方法二</h6> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token string">' export RSYNC_PASSWORD=1'</span> <span class="token operator">&gt;&gt;</span> /etc/bashrc 
<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">tail</span> <span class="token parameter variable">-1</span> /etc/bashrc 
<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">.</span> /etc/bashrc 
<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token builtin class-name">echo</span> <span class="token variable">$RSYNC_PASSWORD</span>
</code></pre> 
<h5><a id="_612"></a>测试</h5> 
<ul><li>客户端拉取</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avz</span> rsync_backup@172.16.1.41::backup /data --password-file<span class="token operator">=</span>/etc/rsync.password
receiving incremental <span class="token function">file</span> list

sent <span class="token number">24</span> bytes  received <span class="token number">271</span> bytes  <span class="token number">590.00</span> bytes/sec
total size is <span class="token number">0</span>  speedup is <span class="token number">0.00</span>
</code></pre> 
<ul><li>客户端推送 注意目录后的斜线</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avz</span> /data/  rsync_backup@172.16.1.41::backup  --password-file<span class="token operator">=</span>/etc/rsync.password
</code></pre> 
<h6><a id="_625"></a>客户端命令参数</h6> 
<ul><li>v --verbose 显示输出过程</li><li>z --compress 压缩</li><li>a --archive 多参数集合(-rtopgDl)</li><li>r --recursive 递归</li><li>t --times 保持修改时间属性</li><li>o --owner 保持属主不变</li><li>p – perms 保持权限不变</li><li>g --group 保持用户组不变</li><li>l --links 保持拷贝软链接</li><li>q --quiet 静默拷贝</li><li>–delete 删除</li><li>–exclude 排除</li><li>–exclude-from 从文件中排除</li><li>–bwlimit=KBPS 限制I/O带宽，KBbytes per Second</li><li><strong>查看帮助</strong></li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@backup ~<span class="token punctuation">]</span>$ <span class="token function">man</span> /etc/rsyncd.conf 
<span class="token comment"># /etc/rsyncd: configuration file for rsync daemon mode</span>
<span class="token comment"># See rsyncd.conf man page for more options.</span>
<span class="token comment"># configuration example:</span>
<span class="token comment">#  uid  =  nobody # gid = nobody # use chroot = yes # max connec‐</span>
tions  <span class="token operator">=</span>  <span class="token number">4</span>  <span class="token comment">#  pid  file  =  /var/run/rsyncd.pid  #  exclude   =</span>
lost+found/  <span class="token comment">#  transfer  logging  = yes # timeout = 900 # ignore</span>
nonreadable <span class="token operator">=</span> <span class="token function">yes</span> <span class="token comment"># dont compress   = *.gz *.tgz  *.zip  *.z  *.Z</span>
*.rpm *.deb *.bz2
<span class="token comment">#  [ftp]  #        path = /home/ftp #        comment = ftp export</span>
</code></pre> 
<h5><a id="_654"></a>客户端复制报错案例</h5> 
<ul><li>客户端连接服务端时报错如下，是服务端没有rsync用户</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avz</span> /etc  zhk@10.0.0.41:/backup/ 
zhk@10.0.0.41's password: 
sending incremental <span class="token function">file</span> list
rsync: recv_generator: <span class="token function">mkdir</span> <span class="token string">"/backup/etc"</span> failed: Permission denied <span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span>
*** Skipping any contents from this failed directory ***
etc/

sent <span class="token number">52,559</span> bytes  received <span class="token number">781</span> bytes  <span class="token number">21,336</span>.00 bytes/sec
total size is <span class="token number">33,179</span>,085  speedup is <span class="token number">622.03</span>
<span class="token function">rsync</span> error: some files/attrs were not transferred <span class="token punctuation">(</span>see previous errors<span class="token punctuation">)</span> <span class="token punctuation">(</span>code <span class="token number">23</span><span class="token punctuation">)</span> at main.c<span class="token punctuation">(</span><span class="token number">1179</span><span class="token punctuation">)</span> <span class="token punctuation">[</span>sender<span class="token operator">=</span><span class="token number">3.1</span>.2<span class="token punctuation">]</span>
</code></pre> 
<ul><li>需要额外添加参数，允许root以外的用户存储文件的完整属性：fake super = yes</li></ul> 
<h6><a id="_670"></a>多模块复制</h6> 
<ul><li>rsyncd.conf的配置文件中，如果参数不在模块内，默认全局生效，也可单独放在某些模块内。</li></ul> 
<h6><a id="_672"></a>排除文件复制</h6> 
<ul><li>排除文件</li></ul> 
<pre><code class="prism language-bash">root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avg</span> <span class="token parameter variable">--exclude</span><span class="token operator">=</span><span class="token punctuation">{<!-- --></span>a.1,a.3<span class="token punctuation">}</span>.txt rsync_backup@172.16.1.41::backup /data
Password: 
receiving incremental <span class="token function">file</span> list
./
a.10.txt
a.2.txt
a.4.txt
a.5.txt
a.6.txt
a.7.txt
a.8.txt
a.9.txt
sent <span class="token number">209</span> bytes  received <span class="token number">525</span> bytes  <span class="token number">293.60</span> bytes/sec
total size is <span class="token number">0</span>  speedup is <span class="token number">0.00</span>
</code></pre> 
<ul><li>从文件中排除</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avg</span> --exclude-from<span class="token operator">=</span>/root/test.txt rsync_backup@172.16.1.41::backup /data
Password: 
receiving incremental <span class="token function">file</span> list
./
a10.txt
a6.txt
a7.txt
a8.txt
a9.txt
sent <span class="token number">186</span> bytes  received <span class="token number">360</span> bytes  <span class="token number">218.40</span> bytes/sec
total size is <span class="token number">0</span>  speedup is <span class="token number">0.00</span>
</code></pre> 
<h3><a id="_704"></a>主机之间数据无差异复制</h3> 
<ul><li>目录演示，注意目录后的斜线</li><li>使data目录和null目录保持一直，相当于清空。</li></ul> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">mkdir</span> /null <span class="token parameter variable">-p</span>

<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span> /data/
a10.txt  a6.txt  a7.txt  a8.txt  a9.txt

<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">rsync</span> <span class="token parameter variable">-avg</span> <span class="token parameter variable">--delete</span> /null/  /data/
sending incremental <span class="token function">file</span> list
deleting null/
deleting a9.txt
deleting a8.txt
deleting a7.txt
deleting a6.txt
deleting a10.txt
./

sent <span class="token number">47</span> bytes  received <span class="token number">79</span> bytes  <span class="token number">252.00</span> bytes/sec
total size is <span class="token number">0</span>  speedup is <span class="token number">0.00</span>
<span class="token punctuation">[</span>root@nfs01 ~<span class="token punctuation">]</span>$ <span class="token function">ls</span> /data/
</code></pre> 
<ul><li>守护进程模式和远程模式同样可执行。</li></ul> 
<h3><a id="_728"></a>断点</h3> 
<ul><li>-partial 保留部分传输过的文件，使该文件剩余部分传输更快速</li></ul> 
<h3><a id="_730"></a>限速</h3> 
<ul><li>–bwlimit=BPS</li></ul> 
<h2><a id="_732"></a>优缺点</h2> 
<h3><a id="_733"></a>优点</h3> 
<ul><li>增量备份，支持socket(daemon)守护进程模式，集中备份(支持推拉模式备份)</li><li>远程shell通道模式还可以加密(SSH)传输</li><li>socket(daemon)需要加密传输，可以利用VPN服务或IPSEC服务</li></ul> 
<h3><a id="_737"></a>缺点</h3> 
<ul><li>大量小文件复制的时候，rsnc可能会停止僵死或效率不高。</li><li>一次性远程拷贝可以使用scp，如果大量小文件可打成压缩包再拷贝。</li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/31937fe14551f422203247aa75ec05dc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深度学习--卷积神经网络</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b7eb9e9e066614fb1bc7cc3def58e8b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">大雪节气___</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>