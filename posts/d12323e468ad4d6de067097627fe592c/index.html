<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>usb转8路串口模块 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="usb转8路串口模块" />
<meta property="og:description" content="开源USB转8路串口PCB设计 文章目录 开源USB转8路串口PCB设计1. 简介2. 说明3. 一种跨电脑跨USB口的端口号自动识别方法4.开源地址 今天给大家介绍一款USB转8路串口的PCB设计，并提供一种跨电脑跨USB口的端口号自动识别方法。 1. 简介 芯片采用沁恒的CH348Q，不需要写程序，其中4路串口支持流控，另外的4路不支持。
开发板设计如下：
原理图：
pcb图：
3d图：
2. 说明 基于沁恒的CH348Q芯片设计的usb转8路串口模块，不需要额外的程序，同时支持win系统和linux系统，驱动已经放到立创附件中。每一路串口都有指示灯，增加使用的方便性。因为我平时就是用这个工具调程序，因此我usb接口使用的TYPE-B接口，这样的接口更耐用也跟那个稳定。开发板每路串口都带有TX、RX指示灯，这样在调试的时候就会非常方便。开发板另外还有两颗指示灯，一个是power，用来指示设备上电，另一个是ACT，用来指示CH348q可以正常工作，当驱动未安装，ACT不会亮，表明CH348q不可以正常工作，当驱动安装好，ACT会亮起，表示设备可以正常工作。 产品实物图如下：
3. 一种跨电脑跨USB口的端口号自动识别方法 在平时我们使用的usb转串口模块，按照更换usb口串口号是否会改变分为usb口改变设备和usb口不改变设备(其实根本原因是支持)。
比如我们常使用的ch340，它就是一款更换usb口后，会重新生成COM口编号的设备，这种设备的优点是对于大部分PC是免驱的, 缺点是当电脑同时接入多个串口，需要挨个插拔来确定端口号。
比如我们常用的cp21xx，它就是一款更换usb口后，依旧会沿用上一次端口号的设备，这种设备的优点是在更换usb口后不需要在从新确认端口号，方便了，缺点是需要驱动，因此在linux上使用的时候，一定要确保有驱动。
但是不管上面的哪一种，当跨PC来接入的时候，谁也保证不了COM不会发生改变。这样其实就有一个问题，当我们写了一个上位机程序的时候，我们必须留出一个可以设置COM口的地方，因为当存在多个COM的时候，程序无法自动识别，需要用户指定,那这样对于那些自动化测试、无人值守项目就会很崩溃。下面我们讲解使用CH348完美解决这个问题的方法。
我们先分析一下实现的原理，我们将设备插入电脑，然后打开的猫猫串口助手(推荐使用的一个串口助手)，下载链接，当点击串口号的时候，在输出测输出了这8个串口，如下：
我们会发现这8个串口都有对应的名字，如WCH USB-SERIAL Ch B (COM26)中，COM26就是com口，前面那一段就是串口的名字，巧合的是在不同的电脑上，com口可能不同，但是名字是相同的，如：这WCH USB-SERIAL Ch A、B、C、D、E、F、G、H对应的就是8个串口的名字，这些名字和开发板上面的串口一一对应，正如我画的pcb那样，我画的PCB，不是写的串口1、串口2，而是以ABCDEFGH来定义串口的，现在我们使用python来自动找到A串口对应的端口号：
# 通过串口的名称找到对应的串口，并打开 # pip install pyserial import serial import serial.tools.list_ports # 举例：比如我们要查找WCH USB-SERIAL Ch A对应的端口号 my_serial_1 = &#34;WCH USB-SERIAL Ch A&#34; if __name__ == &#34;__main__&#34;: pass # 判断存在用户输入的串口 ports = list(serial.tools.list_ports.comports(include_links=False)) # 打印所有的port if not ports: print(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d12323e468ad4d6de067097627fe592c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-26T01:13:54+08:00" />
<meta property="article:modified_time" content="2023-06-26T01:13:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">usb转8路串口模块</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="USB8PCB_0"></a>开源USB转8路串口PCB设计</h2> 
<p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#USB8PCB_0" rel="nofollow">开源USB转8路串口PCB设计</a></li><li><ul><li><a href="#1__5" rel="nofollow">1. 简介</a></li><li><a href="#2__24" rel="nofollow">2. 说明</a></li><li><a href="#3_USB_38" rel="nofollow">3. 一种跨电脑跨USB口的端口号自动识别方法</a></li><li><a href="#4_95" rel="nofollow">4.开源地址</a></li></ul> 
 </li></ul> 
</div> 
<br> 今天给大家介绍一款USB转8路串口的PCB设计，并提供一种跨电脑跨USB口的端口号自动识别方法。 
<p></p> 
<h3><a id="1__5"></a>1. 简介</h3> 
<p>芯片采用沁恒的CH348Q，不需要写程序，其中4路串口支持流控，另外的4路不支持。</p> 
<p>开发板设计如下：</p> 
<p>原理图：<br> <img src="https://images2.imgbox.com/8a/81/DzIUH9nC_o.png" alt="在这里插入图片描述" width="600"></p> 
<p>pcb图：<br> <img src="https://images2.imgbox.com/e8/02/MEPTryGy_o.png" alt="在这里插入图片描述" width="500"></p> 
<p>3d图：<br> <img src="https://images2.imgbox.com/82/a9/v1BlUnuM_o.png" alt="在这里插入图片描述" width="500"></p> 
<h3><a id="2__24"></a>2. 说明</h3> 
<ul><li>基于沁恒的CH348Q芯片设计的usb转8路串口模块，不需要额外的程序，同时支持win系统和linux系统，驱动已经放到立创附件中。</li><li>每一路串口都有指示灯，增加使用的方便性。</li><li>因为我平时就是用这个工具调程序，因此我usb接口使用的TYPE-B接口，这样的接口更耐用也跟那个稳定。</li><li>开发板每路串口都带有TX、RX指示灯，这样在调试的时候就会非常方便。</li><li>开发板另外还有两颗指示灯，一个是power，用来指示设备上电，另一个是ACT，用来指示CH348q可以正常工作，当驱动未安装，ACT不会亮，表明CH348q不可以正常工作，当驱动安装好，ACT会亮起，表示设备可以正常工作。</li></ul> 
<p>产品实物图如下：<br> <img src="https://images2.imgbox.com/3e/bd/GSUhN1V2_o.png" alt="在这里插入图片描述" width="500"><br> <img src="https://images2.imgbox.com/c6/de/TGPUYbW1_o.png" alt="在这里插入图片描述" width="400"></p> 
<h3><a id="3_USB_38"></a>3. 一种跨电脑跨USB口的端口号自动识别方法</h3> 
<p>在平时我们使用的usb转串口模块，按照更换usb口串口号是否会改变分为usb口改变设备和usb口不改变设备(其实根本原因是支持)。</p> 
<p>比如我们常使用的ch340，它就是一款更换usb口后，会重新生成COM口编号的设备，这种设备的优点是对于大部分PC是免驱的, 缺点是当电脑同时接入多个串口，需要挨个插拔来确定端口号。</p> 
<p>比如我们常用的cp21xx，它就是一款更换usb口后，依旧会沿用上一次端口号的设备，这种设备的优点是在更换usb口后不需要在从新确认端口号，方便了，缺点是需要驱动，因此在linux上使用的时候，一定要确保有驱动。</p> 
<p>但是不管上面的哪一种，当跨PC来接入的时候，谁也保证不了COM不会发生改变。这样其实就有一个问题，当我们写了一个上位机程序的时候，我们必须留出一个可以设置COM口的地方，因为当存在多个COM的时候，程序无法自动识别，需要用户指定,那这样对于那些自动化测试、无人值守项目就会很崩溃。下面我们讲解使用CH348完美解决这个问题的方法。</p> 
<p>我们先分析一下实现的原理，我们将设备插入电脑，然后打开的<a href="http://www.amaocom.com/" rel="nofollow">猫猫串口助手(推荐使用的一个串口助手)，下载链接</a>，当点击串口号的时候，在输出测输出了这8个串口，如下：<br> <img src="https://images2.imgbox.com/08/46/fHSnsYsf_o.png" alt="在这里插入图片描述" width="600"></p> 
<p>我们会发现这8个串口都有对应的名字，如WCH USB-SERIAL Ch B (COM26)中，COM26就是com口，前面那一段就是串口的名字，巧合的是在不同的电脑上，com口可能不同，但是名字是相同的，如：这WCH USB-SERIAL Ch A、B、C、D、E、F、G、H对应的就是8个串口的名字，这些名字和开发板上面的串口一一对应，正如我画的pcb那样，我画的PCB，不是写的串口1、串口2，而是以ABCDEFGH来定义串口的，现在我们使用python来自动找到A串口对应的端口号：</p> 
<pre><code class="prism language-python"><span class="token comment"># 通过串口的名称找到对应的串口，并打开</span>
<span class="token comment"># pip install pyserial</span>

<span class="token keyword">import</span> serial
<span class="token keyword">import</span> serial<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>list_ports


<span class="token comment"># 举例：比如我们要查找WCH USB-SERIAL Ch A对应的端口号</span>
my_serial_1 <span class="token operator">=</span> <span class="token string">"WCH USB-SERIAL Ch A"</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
    <span class="token comment"># 判断存在用户输入的串口</span>
    ports <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>serial<span class="token punctuation">.</span>tools<span class="token punctuation">.</span>list_ports<span class="token punctuation">.</span>comports<span class="token punctuation">(</span>include_links<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 打印所有的port</span>
    <span class="token keyword">if</span> <span class="token keyword">not</span> ports<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"err: no port"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"PC link all port:"</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> port <span class="token keyword">in</span> ports<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>port<span class="token punctuation">.</span>description<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------------"</span><span class="token punctuation">)</span>
        <span class="token comment"># 连接用户指定的串口</span>
        <span class="token keyword">for</span> port <span class="token keyword">in</span> ports<span class="token punctuation">:</span> 
            <span class="token keyword">if</span> port<span class="token punctuation">.</span>description<span class="token punctuation">.</span>find<span class="token punctuation">(</span>my_serial_1<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>my_serial_1 <span class="token operator">+</span> <span class="token string">" find "</span> <span class="token operator">+</span> port<span class="token punctuation">.</span>name<span class="token punctuation">)</span>
                this_serial <span class="token operator">=</span> serial<span class="token punctuation">.</span>Serial<span class="token punctuation">(</span>port<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token number">9600</span><span class="token punctuation">,</span> timeout <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">)</span> 
                <span class="token keyword">break</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># 用户输入的端口不存在</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"err: %s port does not exist."</span> <span class="token operator">%</span>my_serial_1<span class="token punctuation">)</span>
</code></pre> 
<p>上面这段程序是寻找"WCH USB-SERIAL Ch A"对应的com口，我们会发现port里面有串口名称信息，我们只需要用python的find判断就可以找到com了，如下：</p> 
<p><img src="https://images2.imgbox.com/fc/89/bWJQbnxK_o.png" alt="在这里插入图片描述" width="600"></p> 
<p>我们更换了电脑后，com号有可能会改变，但是串口的名称不会改变，也就是我们时刻知道A和CH348的那个串口是对应的，我们通过A找到对应的串口，然后打开，这样就能自动识别每一路串口了，这对自动化来说非常有用。</p> 
<p>当然这个也是有缺点的，当用户同时插入两个，就会出现两个"WCH USB-SERIAL Ch A"，这种情况就要借助沁恒加自带的工具，来修改开发板的信息了，这种情况就不再深入讨论，毕竟8个串口已经足够多了。</p> 
<h3><a id="4_95"></a>4.开源地址</h3> 
<ul><li> <p>立创开源链接：<a href="https://oshwhub.com/zhang0819/ch348q_usb_uartx8" rel="nofollow">链接</a>；</p> </li><li> <p>更多实用的开源设计请访问微信公众号“FunIO”，感兴趣的可以关注一下。</p> </li><li> <p>懒人链接：这个板子我也打了一些样品，咸鱼搜索“我是哈搭石”购买。</p> </li><li> <p>同时我还基于CH348Q设计了一个usb转4路RS422+4路RS485，因为成本没控制好，这个就没开源，需要的也可以咸鱼搜索“我是哈搭石”用户购买。</p> </li><li> <p>在b站有关于开发板的详细介绍：<a href="https://t.bilibili.com/810829489793663031?share_source=pc_native" rel="nofollow">链接</a></p> </li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1ffa6e3088a1323f0d93c1ead25453d7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">专业CPU信息检测工具：CPU-Z</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/027323040ebf8147d6c8528aab6fb3cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UE5 与 C&#43;&#43; 入门教程·第一课：角色与 Enhanced Input</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>