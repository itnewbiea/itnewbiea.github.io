<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>torch_geometric获取datasets（解决连不了外网的问题） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="torch_geometric获取datasets（解决连不了外网的问题）" />
<meta property="og:description" content="文章目录 1. torch_geometric.data介绍2. 使用Planetoid下载Cora数据集的代码3. 解决程序运行的机器无法联网的问题3.1 尝试运行，查看数据集下载链接3.2 放置到对应文件夹下3.3 重新运行之前写的程序 4. 一点感慨 1. torch_geometric.data介绍 torch_geometric，简称pyg，是基于pytorch实现的图神经网络库。本文暂时不讲图神经网络的搭建，先介绍一下如何基于这个库获取官方已经集成的数据集。
torch_geometric.datasets这个子包下包含这些类，每个类可以用于下载一个或者几个相关的数据集：
datasets.AMiner( datasets.PascalPF( datasets.gemsec datasets.AQSOL( datasets.PascalVOCKeypoints( datasets.geometry datasets.Actor( datasets.Planetoid( datasets.github datasets.AirfRANS( datasets.PolBlogs( datasets.gnn_benchmark_dataset datasets.Airports( datasets.QM7b( datasets.graph_generator datasets.Amazon( datasets.QM9( datasets.heterophilous_graph_dataset datasets.AmazonProducts( datasets.RandomPartitionGraphDataset( datasets.hgb_dataset datasets.AttributedGraphDataset( datasets.Reddit( datasets.hydro_net datasets.BA2MotifDataset( datasets.Reddit2( datasets.icews datasets.BAMultiShapesDataset( datasets.RelLinkPredDataset( datasets.imdb datasets.BAShapes( datasets.S3DIS( datasets.infection_dataset datasets.BitcoinOTC( datasets.SHREC2016( datasets.jodie datasets.CitationFull( datasets.SNAPDataset( datasets.karate datasets.CoMA( datasets.ShapeNet( datasets.last_fm datasets.Coauthor( datasets.StochasticBlockModelDataset( datasets.lastfm_asia datasets.CoraFull( datasets.SuiteSparseMatrixCollection( datasets.linkx_dataset datasets.DBLP( datasets.TOSCA( datasets.lrgb datasets.DBP15K( datasets.TUDataset( datasets.malnet_tiny datasets.DGraphFin( datasets." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6ab734bb6a80169843b098cc980a6106/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-12T11:15:10+08:00" />
<meta property="article:modified_time" content="2023-05-12T11:15:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">torch_geometric获取datasets（解决连不了外网的问题）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1_torch_geometricdata_1" rel="nofollow">1. torch_geometric.data介绍</a></li><li><a href="#2_PlanetoidCora_67" rel="nofollow">2. 使用Planetoid下载Cora数据集的代码</a></li><li><a href="#3__93" rel="nofollow">3. 解决程序运行的机器无法联网的问题</a></li><li><ul><li><a href="#31__96" rel="nofollow">3.1 尝试运行，查看数据集下载链接</a></li><li><a href="#32__102" rel="nofollow">3.2 放置到对应文件夹下</a></li><li><a href="#33__127" rel="nofollow">3.3 重新运行之前写的程序</a></li></ul> 
  </li><li><a href="#4__137" rel="nofollow">4. 一点感慨</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_torch_geometricdata_1"></a>1. torch_geometric.data介绍</h2> 
<p>torch_geometric，简称pyg，是基于pytorch实现的图神经网络库。本文暂时不讲图神经网络的搭建，先介绍一下如何基于这个库获取官方已经集成的数据集。<br> torch_geometric.datasets这个子包下包含这些类，每个类可以用于下载一个或者几个相关的数据集：</p> 
<pre><code class="prism language-sh">datasets.AMiner(                       datasets.PascalPF(                     datasets.gemsec
datasets.AQSOL(                        datasets.PascalVOCKeypoints(           datasets.geometry
datasets.Actor(                        datasets.Planetoid(                    datasets.github
datasets.AirfRANS(                     datasets.PolBlogs(                     datasets.gnn_benchmark_dataset
datasets.Airports(                     datasets.QM7b(                         datasets.graph_generator
datasets.Amazon(                       datasets.QM9(                          datasets.heterophilous_graph_dataset
datasets.AmazonProducts(               datasets.RandomPartitionGraphDataset(  datasets.hgb_dataset
datasets.AttributedGraphDataset(       datasets.Reddit(                       datasets.hydro_net
datasets.BA2MotifDataset(              datasets.Reddit2(                      datasets.icews
datasets.BAMultiShapesDataset(         datasets.RelLinkPredDataset(           datasets.imdb
datasets.BAShapes(                     datasets.S3DIS(                        datasets.infection_dataset
datasets.BitcoinOTC(                   datasets.SHREC2016(                    datasets.jodie
datasets.CitationFull(                 datasets.SNAPDataset(                  datasets.karate
datasets.CoMA(                         datasets.ShapeNet(                     datasets.last_fm
datasets.Coauthor(                     datasets.StochasticBlockModelDataset(  datasets.lastfm_asia
datasets.CoraFull(                     datasets.SuiteSparseMatrixCollection(  datasets.linkx_dataset
datasets.DBLP(                         datasets.TOSCA(                        datasets.lrgb
datasets.DBP15K(                       datasets.TUDataset(                    datasets.malnet_tiny
datasets.DGraphFin(                    datasets.Taobao(                       datasets.md17
datasets.DeezerEurope(                 datasets.Twitch(                       datasets.mixhop_synthetic_dataset
datasets.DynamicFAUST(                 datasets.UPFD(                         datasets.mnist_superpixels
datasets.EllipticBitcoinDataset(       datasets.WILLOWObjectClass(            datasets.modelnet
datasets.EmailEUCore(                  datasets.WebKB(                        datasets.molecule_net
datasets.Entities(                     datasets.WikiCS(                       datasets.motif_generator
datasets.ExplainerDataset(             datasets.WikipediaNetwork(             datasets.movie_lens
datasets.FAUST(                        datasets.WordNet18(                    datasets.nell
datasets.FB15k_237(                    datasets.WordNet18RR(                  datasets.ogb_mag
datasets.FacebookPagePage(             datasets.Yelp(                         datasets.omdb
datasets.FakeDataset(                  datasets.ZINC(                         datasets.pascal
datasets.FakeHeteroDataset(            datasets.actor                         datasets.pascal_pf
datasets.Flickr(                       datasets.airfrans                      datasets.pcpnet_dataset
datasets.GDELT(                        datasets.airports                      datasets.planetoid
datasets.GEDDataset(                   datasets.amazon                        datasets.polblogs
datasets.GNNBenchmarkDataset(          datasets.amazon_products               datasets.ppi
datasets.GemsecDeezer(                 datasets.aminer                        datasets.qm7
datasets.GeometricShapes(              datasets.aqsol                         datasets.qm9
datasets.GitHub(                       datasets.attributed_graph_dataset      datasets.reddit
datasets.HGBDataset(                   datasets.ba2motif_dataset              datasets.reddit2
datasets.HeterophilousGraphDataset(    datasets.ba_multi_shapes               datasets.rel_link_pred_dataset
datasets.HydroNet(                     datasets.ba_shapes                     datasets.s3dis
datasets.ICEWS18(                      datasets.bitcoin_otc                   datasets.sbm_dataset
datasets.IMDB(                         datasets.citation_full                 datasets.shapenet
datasets.InfectionDataset(             datasets.classes                       datasets.shrec2016
datasets.JODIEDataset(                 datasets.coauthor                      datasets.snap_dataset
datasets.KarateClub(                   datasets.coma                          datasets.suite_sparse
datasets.LINKXDataset(                 datasets.dblp                          datasets.taobao
datasets.LRGBDataset(                  datasets.dbp15k                        datasets.torch_geometric
datasets.LastFM(                       datasets.deezer_europe                 datasets.tosca
datasets.LastFMAsia(                   datasets.dgraph                        datasets.tu_dataset
datasets.MD17(                         datasets.dynamic_faust                 datasets.twitch
datasets.MNISTSuperpixels(             datasets.elliptic                      datasets.upfd
datasets.MalNetTiny(                   datasets.email_eu_core                 datasets.utils
datasets.MixHopSyntheticDataset(       datasets.entities                      datasets.webkb
datasets.ModelNet(                     datasets.explainer_dataset             datasets.wikics
datasets.MoleculeNet(                  datasets.facebook                      datasets.wikipedia_network
datasets.MovieLens(                    datasets.fake                          datasets.willow_object_class
datasets.NELL(                         datasets.faust                         datasets.word_net
datasets.OGB_MAG(                      datasets.flickr                        datasets.yelp
datasets.OMDB(                         datasets.freebase                      datasets.zinc
datasets.PCPNetDataset(                datasets.gdelt                         
datasets.PPI(                          datasets.ged_dataset  
</code></pre> 
<h2><a id="2_PlanetoidCora_67"></a>2. 使用Planetoid下载Cora数据集的代码</h2> 
<p>这里以常用的datasets.Planetoid为例，介绍如何下载和使用数据集：</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> torch_geometric<span class="token punctuation">.</span>datasets <span class="token keyword">import</span> Planetoid
dataset <span class="token operator">=</span> Planetoid<span class="token punctuation">(</span>root<span class="token operator">=</span><span class="token string">'./testdata/Cora'</span><span class="token punctuation">,</span>name<span class="token operator">=</span><span class="token string">'Cora'</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> dataset<span class="token punctuation">.</span>_data
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token comment"># 节点表示</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>edge_index<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>y<span class="token punctuation">)</span>
</code></pre> 
<p>这里下载了Cora数据集，这是一个表示论文引用网络的数据集，每个节点为1433维，是一个用one-hot表示词袋的向量。通过对Planetoid类说明的阅读，可以看到这个类还可以用于下载Cite Seer和PubMed两个数据集，使用方法相同。</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">Planetoid</span><span class="token punctuation">(</span>InMemoryDataset<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">r"""The citation network datasets :obj:`"Cora"`, :obj:`"CiteSeer"` and
    :obj:`"PubMed"` from the `"Revisiting Semi-Supervised Learning with Graph
    Embeddings" &lt;https://arxiv.org/abs/1603.08861&gt;`_ paper.
    Nodes represent documents and edges represent citation links.
    Training, validation and test splits are given by binary masks.

    Args:
        root (str): Root directory where the dataset should be saved.
        name (str): The name of the dataset (:obj:`"Cora"`, :obj:`"CiteSeer"`,
            :obj:`"PubMed"`).
    ...
    """</span>
</code></pre> 
<h2><a id="3__93"></a>3. 解决程序运行的机器无法联网的问题</h2> 
<p>在上面的代码中，我们传入了两个参数，第一个参数root表示数据集要下载的位置，第二个参数表示数据集名称（如果该类只能下载一个数据集，一般没有name参数）。这里国内用户常常遇到的问题是，程序会自动从github等网站上下载数据集，但我们的机器常常因为网络问题而无法连接，这个时候我们可以手动把数据集下载，然后传到服务器的对应目录。<br> 具体做法分为三步：</p> 
<h3><a id="31__96"></a>3.1 尝试运行，查看数据集下载链接</h3> 
<p>运行程序会看到这样一行输出：<br> <code>Downloading https://github.com/kimiyoung/planetoid/raw/master/data/ind.cora.x</code><br> 那我们就来看一看<code>https://github.com/kimiyoung/planetoid/raw/master/data/</code>下面有哪些内容吧。<br> <img src="https://images2.imgbox.com/03/c7/TmulX00P_o.png" alt="在这里插入图片描述"><br> 可以看到这里包含了Cora、PubMed、CiteSeer相关的数据，我们可以先把Cora相关的文件下载下来。</p> 
<h3><a id="32__102"></a>3.2 放置到对应文件夹下</h3> 
<p>实际上，torch_geometric.datasets中的类会先检测指定位置是否有所需文件，如果没有才会去下载，如果有则直接处理使用。我们第一步下载的文件，必须放到对应文件夹下，Planetoid类才能找到数据，不再从网络上下载。<br> 观察一下Planetoid源码，raw_dir和raw_file_names就是决定Planetoid类对象寻找对象的位置：</p> 
<pre><code class="prism language-python">	<span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">raw_dir</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>split <span class="token operator">==</span> <span class="token string">'geom-gcn'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> osp<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'geom-gcn'</span><span class="token punctuation">,</span> <span class="token string">'raw'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> osp<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'raw'</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">processed_dir</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token builtin">str</span><span class="token punctuation">:</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>split <span class="token operator">==</span> <span class="token string">'geom-gcn'</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> osp<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'geom-gcn'</span><span class="token punctuation">,</span> <span class="token string">'processed'</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> osp<span class="token punctuation">.</span>join<span class="token punctuation">(</span>self<span class="token punctuation">.</span>root<span class="token punctuation">,</span> self<span class="token punctuation">.</span>name<span class="token punctuation">,</span> <span class="token string">'processed'</span><span class="token punctuation">)</span>

    <span class="token decorator annotation punctuation">@property</span>
    <span class="token keyword">def</span> <span class="token function">raw_file_names</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> List<span class="token punctuation">[</span><span class="token builtin">str</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">,</span> <span class="token string">'tx'</span><span class="token punctuation">,</span> <span class="token string">'allx'</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">,</span> <span class="token string">'ty'</span><span class="token punctuation">,</span> <span class="token string">'ally'</span><span class="token punctuation">,</span> <span class="token string">'graph'</span><span class="token punctuation">,</span> <span class="token string">'test.index'</span><span class="token punctuation">]</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token string-interpolation"><span class="token string">f'ind.</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>name<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">.</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>name<span class="token punctuation">}</span></span><span class="token string">'</span></span> <span class="token keyword">for</span> name <span class="token keyword">in</span> names<span class="token punctuation">]</span>
    
</code></pre> 
<p>可以看到raw_dir是self.root、self.name和<code>'raw'</code>拼起来的路径，我们上面传入的root是<code>'./testdata/Cora'</code>，name是<code>'Cora'</code>，所以raw_dir就是<code>'./testdata/Cora/Cora/raw'</code>。<br> raw_file_names返回值包含正则表达式，容易看出要找的就是：<code>'ind.cora.x'</code>、<code>'ind.cora.tx'</code>、<code>'ind.cora.allx'</code>、<code>'ind.cora.y'</code>、<code>'ind.cora.ty'</code>、<code>'ind.cora.ally'</code>、<code>'ind.cora.graph'</code>、<code>'ind.cora.test.index'</code>这几个文件。看一眼上一步的文件列表，正好都有，我们把这些下载好的文件放在<code>'./testdata/Cora/Cora/raw'</code>这个目录下即可。<br> <img src="https://images2.imgbox.com/b4/4f/pAyAybOO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__127"></a>3.3 重新运行之前写的程序</h3> 
<p>程序会检测到数据已经在所需目录下，跳过下载步骤，直接开始处理数据，成功的话，我们会看到：</p> 
<pre><code class="prism language-sh">$ python planetoid.py 
Processing...
Done!
</code></pre> 
<p>这里的Processing我们不用管具体过程，大体上就是从数据集繁杂的文件中读取数据并处理成我们最终需要的格式。最终输出的格式为torch_geometric.data.Data类型，包含x（节点特征）、edge_index（稀疏矩阵）、y（节点标签）等信息。这个类型已经可以直接装入dataloader处理成batch进行深度学习。<br> 处理之后的数据保存在3.2我们看到的<code>processed_dir</code>中，在本文中也就是<code>'./testdata/Cora/Cora/processed'</code>。如果程序发现该目录下有处理之后的文件，再次运行也会跳过Processing，不再重复处理。</p> 
<h2><a id="4__137"></a>4. 一点感慨</h2> 
<p>torch_geometric.datasets真的方便，基本集成了常见所有的图数据集，不需要手动下载处理，直接到位！</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/64b4ab7ef56aeacc6d34c378f1f60e4f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java将一个集合的每个对象依次赋值给另一个对象的字段值</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/489476c3b71838815062d5d86b1bd5ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于SSM&#43;MySQL的校园共享单车管理系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>