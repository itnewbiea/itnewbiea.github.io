<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenWrt 4G路由器DIY - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenWrt 4G路由器DIY" />
<meta property="og:description" content="文章目录 前言PCB板刷固件4G上网设置无线配置NTP修改微信公众号 前言 OpenWrt 硬件 环境配置编译
OpenWrt 固件定制
第一节讲了下OpenWrt的硬件, 源码下载, 编译, 第二节照猫画虎自己定制了DQ7688的固件(如何换Logo自己查去), 还差一个自己的OpenWrt的板子就可以去骗经费了, 嗯, 硬件它来了&lt;-&gt;_&lt;-&gt;
PCB板 铛铛铛, 先是正面照:
现成Mini PCIe接口的移远EC20(Main口插4G天线)左边4个LAN口右边1个WAN口USB Type-C供电&#43;调试接口(CP2104转串口接到MT7688的调试串口上):贴上DQ7688的Logo 背面:
左下角CP2104(USB转串口)左边5V-&gt;3.3V(MT7688)&#43;3.9V(4G)电源中间 HiLink普通OpenWrt版的MT7688A , 某宝50多元, 开盖是 MT7688AN, NT5TU64M16HG 128MB RAM, W25Q256FVE 32MB Flash, 上节固件定制的16MB的也能用, 可以改一下Flash配置重新编译一遍右上角插Micro-SIM卡 两层板轻轻松松搞下来, 不过不建议, 最好4层板, 性能好一点, 遗憾的忘记把复位键搞上去, 需要复位的时候自己焊了杜邦针, 复位的时候点下地, 有点麻烦.
别忘记接4G天线和2.4G WiFi天线, 有外壳的话固定到外壳正好.
HLK-7688A默认引脚图:
刷固件 上篇 OpenWrt 固件定制 中因为下载太慢去掉了luci-app-samba和 luci-app-qos, 用make V=99编译, 中间又联网下载了其他东西, 花费了大概3个小时最终生成了bin文件: /bin/targets/ramips/mt76x8/openwrt-ramips-mt76x8-dq7688-squashfs-sysupgrade.bin, 大小5.8MB. 拷贝这个文件到Windows电脑桌面.
刷固件的方式参考上上篇: OpenWrt 硬件 环境配置编译 , 下面再啰嗦一下, 注意PCB板子和Windows电脑各自连到局域网中.
USB Type-C线连接PCB板到Windows电脑, 设备管理器查看串口号COM68, 打开Putty, 串口连接类型, 波特率57600:" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6759d2498fc15cd071f7a1fb405ad3f5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-28T22:58:38+08:00" />
<meta property="article:modified_time" content="2019-11-28T22:58:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenWrt 4G路由器DIY</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#PCB_6" rel="nofollow">PCB板</a></li><li><a href="#_29" rel="nofollow">刷固件</a></li><li><a href="#4G_56" rel="nofollow">4G上网设置</a></li><li><a href="#_77" rel="nofollow">无线配置</a></li><li><a href="#NTP_88" rel="nofollow">NTP修改</a></li><li><a href="#_93" rel="nofollow">微信公众号</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>前言</h3> 
<p><a href="https://blog.csdn.net/weifengdq/article/details/103262921">OpenWrt 硬件 环境配置编译</a><br> <a href="https://blog.csdn.net/weifengdq/article/details/103284684">OpenWrt 固件定制</a><br> 第一节讲了下OpenWrt的硬件, 源码下载, 编译, 第二节照猫画虎自己定制了DQ7688的固件(如何换Logo自己查去), 还差一个自己的OpenWrt的板子就可以去<code>骗经费</code>了, 嗯, 硬件它来了&lt;-&gt;_&lt;-&gt;</p> 
<h3><a id="PCB_6"></a>PCB板</h3> 
<p>铛铛铛, 先是正面照:</p> 
<ul><li>现成Mini PCIe接口的移远EC20(Main口插4G天线)</li><li>左边4个LAN口</li><li>右边1个WAN口</li><li>USB Type-C供电+调试接口(CP2104转串口接到MT7688的调试串口上):</li><li>贴上DQ7688的Logo</li></ul> 
<p><img src="https://images2.imgbox.com/97/c8/vOr5I3Fa_o.png" alt="在这里插入图片描述"><br> 背面:</p> 
<ul><li>左下角CP2104(USB转串口)</li><li>左边5V-&gt;3.3V(MT7688)+3.9V(4G)电源</li><li>中间 <a href="https://detail.tmall.com/item.htm?spm=a1z10.5-b-s.w4011-22147825289.60.790b57841qO79I&amp;id=597619548455&amp;rn=95ee7e304365f496048c535d851e66e7&amp;abbucket=3&amp;skuId=4188392189727" rel="nofollow">HiLink普通OpenWrt版的MT7688A</a> , 某宝50多元, 开盖是 MT7688AN, NT5TU64M16HG 128MB RAM, W25Q256FVE 32MB Flash, 上节固件定制的16MB的也能用, 可以改一下Flash配置重新编译一遍</li><li>右上角插Micro-SIM卡</li></ul> 
<p><img src="https://images2.imgbox.com/b6/73/bcn99xWg_o.png" alt="在这里插入图片描述"><br> 两层板轻轻松松搞下来, 不过不建议, 最好4层板, 性能好一点, 遗憾的忘记把复位键搞上去, 需要复位的时候自己焊了杜邦针, 复位的时候点下地, 有点麻烦.</p> 
<p>别忘记接<code>4G天线</code>和<code>2.4G WiFi天线</code>, 有外壳的话固定到外壳正好.</p> 
<p>HLK-7688A默认引脚图:<br> <img src="https://images2.imgbox.com/2b/e8/N5gMUt7Z_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_29"></a>刷固件</h3> 
<p>上篇 <a href="https://blog.csdn.net/weifengdq/article/details/103284684">OpenWrt 固件定制</a> 中因为下载太慢去掉了<code>luci-app-samba</code>和 <code>luci-app-qos</code>, 用<code>make V=99</code>编译, 中间又联网下载了其他东西, 花费了大概3个小时最终生成了bin文件: <code>/bin/targets/ramips/mt76x8/openwrt-ramips-mt76x8-dq7688-squashfs-sysupgrade.bin</code>, 大小5.8MB. 拷贝这个文件到Windows电脑桌面.</p> 
<p>刷固件的方式参考上上篇: <a href="https://blog.csdn.net/weifengdq/article/details/103262921">OpenWrt 硬件 环境配置编译</a> , 下面再啰嗦一下, 注意PCB板子和Windows电脑各自连到局域网中.</p> 
<p>USB Type-C线连接PCB板到Windows电脑, 设备管理器查看串口号COM68, 打开Putty, 串口连接类型, 波特率57600:<br> <img src="https://images2.imgbox.com/52/90/dIV7rXsH_o.png" alt="在这里插入图片描述"><br> 打开后, 打个回车, 进入到OpenWrt, 路由器板子插上局域网网线, 可以<code>LAN/WAN</code>口都试试, <code>ifconfig</code>看下IP, 假设为: <code>192.168.3.175</code>.</p> 
<p>Windows电脑cmd中输入<code>ipconfig</code>查看下局域网IP, 假设为<code>192.168.3.139</code>.</p> 
<p>Windows电脑打开<code>tftpd64</code>软件, 设置bin文件路径和IP:<br> <img src="https://images2.imgbox.com/51/0b/w9ZKfGiM_o.png" alt="在这里插入图片描述"><br> 复位路由器板子, Putty界面输入2, 然后填入板子的IP和电脑的IP, 粘贴bin文件名:<br> <img src="https://images2.imgbox.com/16/b8/HTEbIXhF_o.png" alt="在这里插入图片描述"><br> 一开始显示<code>T T</code>, 后来把板子的网线从WAN口拔掉插到LAN1口才可以正常刷机了, 嗯, 瞎试, 估计是厂家改uboot了.</p> 
<p>刷机完成后, 按照提示修改密码:<br> <img src="https://images2.imgbox.com/c9/8b/yiQve8hX_o.png" alt="在这里插入图片描述"><br> 默认用户名root, 没有密码, 需要输入<code>passwd</code>自己修改密码才能正常使用.</p> 
<p>密码修改完后, 可以把Windows电脑网线从局域网中移除, 插到板子的LAN口, 局域网的网线插到PCB板子的WAN口, 这样, Windows电脑通过DHCP获取的网络IP段应该变为了192.168.1.x, 打开浏览器, 输入192.168.1.1, 可以看到熟悉的OpenWrt界面:<br> <img src="https://images2.imgbox.com/85/bd/JPvcCkiI_o.png" alt="在这里插入图片描述"><br> 得益于上篇luci的配置, 这里直接是中文界面, 输入刚才在<code>putty</code>中修改的密码, 点击登录, 是我们的DQ7688:<br> <img src="https://images2.imgbox.com/4c/74/K2TdIo0s_o.png" alt="在这里插入图片描述"><br> 怎么把左上角<code>OpenWrt</code>的Logo换了, 自己搜去.</p> 
<h3><a id="4G_56"></a>4G上网设置</h3> 
<p>现在是通过局域网的WAN口上的网, 默认4G还不能用, 注意插手机卡的时候断电, 插上后再上电.</p> 
<p>4G上网可以在<code>putty</code>(串口或者ssh登录)中用uci命令设置, 也可以直接<code>vi</code>改<code>/etc/config</code>中的网络/防火墙等的配置, 这里简单点, 操作的方式直观点, 直接在浏览器LuCI界面修改.</p> 
<p>顶部菜单栏, 网络 -&gt; 接口 -&gt; 添加新接口, 填入接口名称, 接口协议选择<code>QMI蜂窝</code>, 点击<code>提交</code>按钮:<br> <img src="https://images2.imgbox.com/c8/b6/4coAH0EA_o.png" alt="在这里插入图片描述"><br> 基本设置里面, <code>调制解调器设备</code>选择<code>/dev/cdc-wdm0</code>:<br> <img src="https://images2.imgbox.com/37/3b/idZWCAzl_o.png" alt="在这里插入图片描述"><br> 右边的防火墙设置, 区域直接选和wan口一样的配置, 保存并应用:<br> <img src="https://images2.imgbox.com/e1/99/TbpY9Y6e_o.png" alt="在这里插入图片描述"><br> 自动刷新后接口界面变为:<br> <img src="https://images2.imgbox.com/d2/fe/E5nEgUSC_o.png" alt="在这里插入图片描述"><br> 此时因为WAN口插着办公室的局域网网线, 网络仍然不是4G, 拔掉WAN口网线, 此时发现连着PCB板LAN口的Windows电脑不能上网了, 重启下路由器, 可以正常上网, 此时用的就是4G了. 搜一下测网速, 随便选一个, 比如<code>speedtest.cn</code>, 移动的手机卡, 页面显示的移动的IP, 点击测速:<br> <img src="https://images2.imgbox.com/db/5d/z17v3A4F_o.png" alt="在这里插入图片描述"><br> 权当开心了…</p> 
<p>此时如果插上WAN口的办公室局域网网线, 网络会回到WAN口(测速网刷新下变联通了), 然后再拔掉WAN口网线, 发现4G不好使了, 并不能像想象中的4G/有线无缝切换, 有兴趣和时间的可以去研究下, 继续用4G可以简单粗暴的重启路由器.</p> 
<p>网络 -&gt; 负载均衡 那里可以通过<code>mwan</code>管理多个wan口, 有兴趣自己搜下相关资料.</p> 
<h3><a id="_77"></a>无线配置</h3> 
<p><code>OpenWrt</code>默认WiFi不打开, LuCI界面顶部菜单栏, 网络 -&gt; 无线, 点击编辑:<br> <img src="https://images2.imgbox.com/19/f5/26Mfp8kh_o.png" alt="在这里插入图片描述"><br> 拉到下面接口配置, ESSID是WiFi的名字:<br> <img src="https://images2.imgbox.com/28/0d/y5uvmXId_o.png" alt="在这里插入图片描述"><br> 然后无线安全, 加密选择<code>WPA2-PSK</code>, 密码里面就是WiFi密码, 然后点击<code>保存并应用</code>:<br> <img src="https://images2.imgbox.com/9a/8d/XqBxvsyg_o.png" alt="在这里插入图片描述"><br> 稍等界面刷新, 点击启用:<br> <img src="https://images2.imgbox.com/7b/8e/zrJwlH8l_o.png" alt="在这里插入图片描述"><br> 然后就可以掏出手机, 连上<code>OpenWrt</code>的WiFi, 输入密码, 愉快上网.</p> 
<h3><a id="NTP_88"></a>NTP修改</h3> 
<p><code>putty</code>(串口或ssh)连接路由器, 输入<code>date</code>, 发现时间和本地对不上, 因为OpenWrt默认用UTC时间, 我们在东八区, 可以LuCI界面顶部菜单栏, 系统 -&gt; 系统, <code>时区</code>把默认的UTC改成上海的, <code>候选NTP服务器</code>把默认的<code>0~3.openwrt.pool.ntp.org</code>换成阿里云的:<br> <img src="https://images2.imgbox.com/c1/8e/RwKAruS3_o.png" alt="在这里插入图片描述"><br> 想把界面改成英文的可以在右边的语言和界面中设置.</p> 
<h3><a id="_93"></a>微信公众号</h3> 
<p>欢迎扫描二维码关注本人微信公众号, 及时获取或者发送给我最新消息:<br> <img src="https://images2.imgbox.com/14/2b/5AQmRaUH_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fab4c95f7c616c6b58f5a9e44bb83d62/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">27报网MM爬虫福利一</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f8803850811ab95ded35518d1a24813f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决httpServletRequest.getParameter获取不到参数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>