<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【MySQL】数据库之主从复制和读写分离 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【MySQL】数据库之主从复制和读写分离" />
<meta property="og:description" content="目录
一、什么是读写分离？
二、为甚要读写分离？
三、什么时候需要读写分离？
四、主从复制与读写分离
五、MySQL支持的二进制日志格式
六、主从复制的工作原理
七、MySQL读写分离的原理
八、MySQL读写分离的方式有哪些
九、实验一：实操主从复制
步骤一：完成所有服务器的时间同步
步骤二：完成主服务器的配置
步骤三：完成从服务器的配置
步骤四：测试
十、实验二：实操主从复制之半同步复制
十一、实验三：实操基于amoeba的读写分离
步骤一：先完成三台mysql服务器的账号和用户设置，并进行授权
步骤二：jdk配置和amoeba安装和配置
​编辑 测试 读写分离测试
一、什么是读写分离？ 读写分离，基本的原理是让主数据库处理事务性增、改、删操作（INSERT、UPDATE、DELETE），而从数据库处理SELECT查询操作。数据库复制被用来把事务性操作导致的变更同步到集群中的从数据库。
二、为甚要读写分离？ 因为数据库的“写”（写10000条数据可能要3分钟）操作是比较耗时的。
但是数据库的“读”（读10000条数据可能只要5秒钟）。
所以读写分离，解决的是，数据库的写入，影响了查询的效率。
三、什么时候需要读写分离？ 数据库不一定要读写分离，如果程序使用数据库较多时，而更新少，查询多的情况下会考虑使用。利用数据库主从同步，再通过读写分离可以分担数据库压力，提高性能。
四、主从复制与读写分离 在实际的生产环境中，对数据库的读和写都在同一个数据库服务器中，是不能满足实际需求的。无论是在安全性、高可用性还是高并发等各个方面都是完全不能满足实际需求的。因此，通过主从复制的方式来同步数据，再通过读写分离来提升数据库的并发负载能力。有点类似于rsync，但是不同的是rsync是对磁盘文件做备份，而mysql主从复制是对数据库中的数据、语句做备份。
五、MySQL支持的二进制日志格式 （1）STATEMENT：基于语句的复制。在服务器上执行sql语句，在从服务器上执行同样的语句，mysql默认采用基于语句的复制，执行效率高。
（2）ROW：基于行的复制。把改变的内容复制过去，而不是把命令在从服务器上执行一遍。
（3）MIXED：混合类型的复制。默认采用基于语句的复制，一旦发现基于语句无法精确复制时，就会采用基于行的复制。
六、主从复制的工作原理 两个日志（主：binlog二进制日志，从：relay-log中继日志）
三个线程（主：dump线程，从：IO线程和SQL线程）
（1）Master节点将数据的改变记录成二进制日志（bin log），当Master上的数据发生改变时，则将其改变写入二进制日志中。
（2）Slave节点会在一定时间间隔内对Master的二进制日志进行探测其是否发生改变，如果发生改变，则开始一个I/O线程请求 Master的二进制事件。
（3）同时Master节点为每个I/O线程启动一个dump线程，用于向其发送二进制事件，并保存至Slave节点本地的中继日志（Relay log）中，Slave节点将启动SQL线程从中继日志中读取二进制日志，在本地重放，即解析成 sql 语句逐一执行，使得其数据和 Master节点的保持一致，最后I/O线程和SQL线程将进入睡眠状态，等待下一次被唤醒。
注：
●中继日志通常会位于 OS 缓存中，所以中继日志的开销很小。
●复制过程有一个很重要的限制，即复制在 Slave上是串行化的，也就是说 Master上的并行更新操作不能在 Slave上并行操作。
七、MySQL读写分离的原理 读写分离就是只在主服务器上写，只在从服务器上读。基本的原理是让主数据库处理事务性操作，而从数据库处理 select 查询。数据库复制被用来把主数据库上事务性操作导致的变更同步到集群中的从数据库。
八、MySQL读写分离的方式有哪些 1）基于程序代码内部实现
在代码中根据 select、insert 进行路由分类，这类方法也是目前生产环境应用最广泛的。
优点是性能较好，因为在程序代码中实现，不需要增加额外的设备为硬件开支；缺点是需要开发人员来实现，运维人员无从下手。
但是并不是所有的应用都适合在程序代码中实现读写分离，像一些大型复杂的Java应用，如果在程序代码中实现读写分离对代码改动就较大。
2）基于中间代理层实现
代理一般位于客户端和服务器之间，代理服务器接到客户端请求后通过判断后转发到后端数据库，有以下代表性程序。
（1）MySQL-Proxy。MySQL-Proxy 为 MySQL 开源项目，通过其自带的 lua 脚本进行SQL 判断。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f0af3f286cc112e1e27a632638e05a22/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T18:08:57+08:00" />
<meta property="article:modified_time" content="2024-01-02T18:08:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【MySQL】数据库之主从复制和读写分离</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F-toc" style="margin-left:0px;"><a href="#%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F" rel="nofollow">一、什么是读写分离？</a></p> 
<p id="%E4%BA%8C%E3%80%81%E4%B8%BA%E7%94%9A%E8%A6%81%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F-toc" style="margin-left:0px;"><a href="#%E4%BA%8C%E3%80%81%E4%B8%BA%E7%94%9A%E8%A6%81%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F" rel="nofollow">二、为甚要读写分离？</a></p> 
<p id="%E4%B8%89%E3%80%81%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F-toc" style="margin-left:0px;"><a href="#%E4%B8%89%E3%80%81%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F" rel="nofollow">三、什么时候需要读写分离？</a></p> 
<p id="%E5%9B%9B%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB-toc" style="margin-left:0px;"><a href="#%E5%9B%9B%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB" rel="nofollow">四、主从复制与读写分离</a></p> 
<p id="%E4%BA%94%E3%80%81MySQL%E6%94%AF%E6%8C%81%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F-toc" style="margin-left:0px;"><a href="#%E4%BA%94%E3%80%81MySQL%E6%94%AF%E6%8C%81%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F" rel="nofollow">五、MySQL支持的二进制日志格式</a></p> 
<p id="%E5%85%AD%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#%E5%85%AD%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86" rel="nofollow">六、主从复制的工作原理</a></p> 
<p id="%E4%B8%83%E3%80%81MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E7%9A%84%E5%8E%9F%E7%90%86-toc" style="margin-left:0px;"><a href="#%E4%B8%83%E3%80%81MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E7%9A%84%E5%8E%9F%E7%90%86" rel="nofollow">七、MySQL读写分离的原理</a></p> 
<p id="%E5%85%AB%E3%80%81MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B-toc" style="margin-left:0px;"><a href="#%E5%85%AB%E3%80%81MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B" rel="nofollow">八、MySQL读写分离的方式有哪些</a></p> 
<p id="%E4%B9%9D%E3%80%81%E5%AE%9E%E9%AA%8C%E4%B8%80%EF%BC%9A%E5%AE%9E%E6%93%8D%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6-toc" style="margin-left:0px;"><a href="#%E4%B9%9D%E3%80%81%E5%AE%9E%E9%AA%8C%E4%B8%80%EF%BC%9A%E5%AE%9E%E6%93%8D%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6" rel="nofollow">九、实验一：实操主从复制</a></p> 
<p id="%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%AE%8C%E6%88%90%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5-toc" style="margin-left:40px;"><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%AE%8C%E6%88%90%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5" rel="nofollow">步骤一：完成所有服务器的时间同步</a></p> 
<p id="%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E5%AE%8C%E6%88%90%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E5%AE%8C%E6%88%90%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE" rel="nofollow">步骤二：完成主服务器的配置</a></p> 
<p id="%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E5%AE%8C%E6%88%90%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E5%AE%8C%E6%88%90%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE" rel="nofollow">步骤三：完成从服务器的配置</a></p> 
<p id="%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E6%B5%8B%E8%AF%95" rel="nofollow">步骤四：测试</a></p> 
<p id="%E5%8D%81%E3%80%81%E5%AE%9E%E9%AA%8C%E4%BA%8C%EF%BC%9A%E5%AE%9E%E6%93%8D%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B9%8B%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6-toc" style="margin-left:0px;"><a href="#%E5%8D%81%E3%80%81%E5%AE%9E%E9%AA%8C%E4%BA%8C%EF%BC%9A%E5%AE%9E%E6%93%8D%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B9%8B%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6" rel="nofollow">十、实验二：实操主从复制之半同步复制</a></p> 
<p id="%E5%8D%81%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E4%B8%89%EF%BC%9A%E5%AE%9E%E6%93%8D%E5%9F%BA%E4%BA%8Eamoeba%E7%9A%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB-toc" style="margin-left:0px;"><a href="#%E5%8D%81%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E4%B8%89%EF%BC%9A%E5%AE%9E%E6%93%8D%E5%9F%BA%E4%BA%8Eamoeba%E7%9A%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB" rel="nofollow">十一、实验三：实操基于amoeba的读写分离</a></p> 
<p id="%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%85%88%E5%AE%8C%E6%88%90%E4%B8%89%E5%8F%B0mysql%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E8%B4%A6%E5%8F%B7%E5%92%8C%E7%94%A8%E6%88%B7%E8%AE%BE%E7%BD%AE%EF%BC%8C%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%8E%88%E6%9D%83-toc" style="margin-left:40px;"><a href="#%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%85%88%E5%AE%8C%E6%88%90%E4%B8%89%E5%8F%B0mysql%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E8%B4%A6%E5%8F%B7%E5%92%8C%E7%94%A8%E6%88%B7%E8%AE%BE%E7%BD%AE%EF%BC%8C%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%8E%88%E6%9D%83" rel="nofollow">步骤一：先完成三台mysql服务器的账号和用户设置，并进行授权</a></p> 
<p id="%C2%A0%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9Ajdk%E9%85%8D%E7%BD%AE%E5%92%8Camoeba%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE-toc" style="margin-left:40px;"><a href="#%C2%A0%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9Ajdk%E9%85%8D%E7%BD%AE%E5%92%8Camoeba%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE" rel="nofollow"> 步骤二：jdk配置和amoeba安装和配置</a></p> 
<p id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E6%B5%8B%E8%AF%95%C2%A0-toc" style="margin-left:40px;"><a href="#%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E6%B5%8B%E8%AF%95%C2%A0" rel="nofollow">​编辑 测试 </a></p> 
<p id="%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%B5%8B%E8%AF%95-toc" style="margin-left:40px;"><a href="#%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%B5%8B%E8%AF%95" rel="nofollow">读写分离测试</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="%E4%B8%80%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AF%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F">一、什么是读写分离？</h2> 
<p>读写分离，<strong><span style="color:#fe2c24;">基本的原理是让主数据库处理事务性增、改、删操作（INSERT、UPDATE、DELETE），而从数据库处理SELECT查询操作</span></strong>。<span style="background-color:#ffd900;">数据库复制被用来把事务性操作导致的变更同步到集群中的从数据库。</span></p> 
<h2 id="%E4%BA%8C%E3%80%81%E4%B8%BA%E7%94%9A%E8%A6%81%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F">二、为甚要读写分离？</h2> 
<p>因为数据库的“写”（写10000条数据可能要3分钟）操作是比较耗时的。<br> 但是数据库的“读”（读10000条数据可能只要5秒钟）。<br> 所以读写分离，解决的是，数据库的写入，影响了查询的效率。</p> 
<h2 id="%E4%B8%89%E3%80%81%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E9%9C%80%E8%A6%81%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%EF%BC%9F">三、什么时候需要读写分离？</h2> 
<p>数据库不一定要读写分离，如果<span style="background-color:#ffd900;">程序使用数据库较多时，而更新少，查询多的情况下会考虑使用</span>。利用数据库主从同步，再通过读写分离可以分担数据库压力，提高性能。</p> 
<h2 id="%E5%9B%9B%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B8%8E%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB">四、主从复制与读写分离</h2> 
<p>在实际的生产环境中，对数据库的读和写都在同一个数据库服务器中，是不能满足实际需求的。无论是在安全性、高可用性还是高并发等各个方面都是完全不能满足实际需求的。因此，<span style="color:#1a439c;"><strong><span style="background-color:#ffd900;">通过主从复制的方式来同步数据</span></strong></span>，再<span style="color:#1a439c;"><strong><span style="background-color:#ffd900;">通过读写分离来提升数据库的并发负载能力</span></strong></span>。有点类似于rsync，但是不同的是rsync是对磁盘文件做备份，而mysql主从复制是对数据库中的数据、语句做备份。</p> 
<h2 id="%E4%BA%94%E3%80%81MySQL%E6%94%AF%E6%8C%81%E7%9A%84%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%97%A5%E5%BF%97%E6%A0%BC%E5%BC%8F">五、MySQL支持的二进制日志格式</h2> 
<p>（1）STATEMENT：<span style="background-color:#ffd900;">基于语句的复制</span>。在服务器上执行sql语句，在从服务器上执行同样的语句，mysql默认采用基于语句的复制，执行效率高。<br> （2）ROW：<span style="background-color:#ffd900;">基于行的复制</span>。把改变的内容复制过去，而不是把命令在从服务器上执行一遍。<br> （3）MIXED：<span style="background-color:#ffd900;">混合类型的复制</span>。默认采用基于语句的复制，<strong><span style="color:#fe2c24;">一旦发现基于语句无法精确复制时，就会采用基于行的复制。</span></strong></p> 
<h2 id="%E5%85%AD%E3%80%81%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">六、主从复制的工作原理</h2> 
<p><strong><span style="background-color:#ffd900;">两个日志（主：binlog二进制日志，从：relay-log中继日志）</span></strong></p> 
<p><strong><span style="background-color:#ffd900;">三个线程（主：dump线程，从：IO线程和SQL线程）</span></strong></p> 
<p>（1）Master节点将数据的改变记录成二进制日志（bin log），当Master上的数据发生改变时，则将其改变写入二进制日志中。<br> （2）Slave节点会在一定时间间隔内对Master的二进制日志进行探测其是否发生改变，如果发生改变，则开始一个I/O线程请求 Master的二进制事件。<br> （3）同时Master节点为每个I/O线程启动一个dump线程，用于向其发送二进制事件，并保存至Slave节点本地的中继日志（Relay log）中，Slave节点将启动SQL线程从中继日志中读取二进制日志，在本地重放，即解析成 sql 语句逐一执行，使得其数据和 Master节点的保持一致，最后I/O线程和SQL线程将进入睡眠状态，等待下一次被唤醒。</p> 
<p>注：<br> ●中继日志通常会位于 OS 缓存中，所以中继日志的开销很小。<br> ●复制过程有一个很重要的限制，即<span style="color:#fe2c24;"><span style="background-color:#ffd900;">复制在 Slave上是串行化的，也就是说 Master上的并行更新操作不能在 Slave上并行操作。</span></span></p> 
<h2 id="%E4%B8%83%E3%80%81MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E7%9A%84%E5%8E%9F%E7%90%86">七、MySQL读写分离的原理</h2> 
<p>读写分离就是只在主服务器上写，只在从服务器上读。基本的原理是让主数据库处理事务性操作，而从数据库处理 select 查询。数据库复制被用来把主数据库上事务性操作导致的变更同步到集群中的从数据库。<br>  </p> 
<h2 id="%E5%85%AB%E3%80%81MySQL%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B">八、MySQL读写分离的方式有哪些</h2> 
<p><strong><span style="background-color:#ffd900;">1）基于程序代码内部实现</span></strong><br> 在代码中根据 select、insert 进行路由分类，这类方法也是目前生产环境应用最广泛的。<br> 优点是性能较好，因为在程序代码中实现，不需要增加额外的设备为硬件开支；缺点是需要开发人员来实现，运维人员无从下手。<br> 但是并不是所有的应用都适合在程序代码中实现读写分离，像一些大型复杂的Java应用，如果在程序代码中实现读写分离对代码改动就较大。</p> 
<p><strong><span style="background-color:#ffd900;">2）基于中间代理层实现</span></strong><br> 代理一般位于客户端和服务器之间，代理服务器接到客户端请求后通过判断后转发到后端数据库，有以下代表性程序。<br><strong><span style="color:#fe2c24;">（1）MySQL-Proxy</span></strong>。MySQL-Proxy 为 MySQL 开源项目，通过其自带的 lua 脚本进行SQL 判断。<br><span style="color:#fe2c24;"><strong>（2）Atlas</strong></span>。是由奇虎360的Web平台部基础架构团队开发维护的一个基于MySQL协议的数据中间层项目。它是在mysql-proxy 0.8.2版本的基础上，对其进行了优化，增加了一些新的功能特性。360内部使用Atlas运行的mysql业务，每天承载的读写请求数达几十亿条。支持事物以及存储过程。<br><span style="color:#fe2c24;"><strong>（3）Amoeba</strong></span>。由陈思儒开发，作者曾就职于阿里巴巴。该程序由Java语言进行开发，阿里巴巴将其用于生产环境。但是它不支持事务和存储过程。<br><span style="color:#fe2c24;"><strong>（4）Mycat。</strong></span>是一款流行的基于Java语言编写的数据库中间件，是一个实现了MySql协议的服务器，其核心功能是分库分表。配合数据库的主从模式还可以实现读写分离。</p> 
<p>由于使用MySQL Proxy 需要写大量的Lua脚本，这些Lua并不是现成的，而是需要自己去写。这对于并不熟悉MySQL Proxy 内置变量和MySQL Protocol 的人来说是非常困难的。<br><strong><span style="background-color:#ffd900;">Amoeba是一个非常容易使用、可移植性非常强的软件。因此它在生产环境中被广泛应用于数据库的代理层。</span></strong></p> 
<h2 id="%E4%B9%9D%E3%80%81%E5%AE%9E%E9%AA%8C%E4%B8%80%EF%BC%9A%E5%AE%9E%E6%93%8D%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6">九、实验一：实操主从复制</h2> 
<h3 id="%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%AE%8C%E6%88%90%E6%89%80%E6%9C%89%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5">步骤一：完成所有服务器的时间同步</h3> 
<p><img alt="" height="133" src="https://images2.imgbox.com/c5/c7/Qb8205fH_o.png" width="1137"></p> 
<p><img alt="" height="565" src="https://images2.imgbox.com/6d/3e/xGpchRqC_o.png" width="1089"> </p> 
<p><img alt="" height="301" src="https://images2.imgbox.com/74/a8/O4XgarIg_o.png" width="1180"><img alt="" height="249" src="https://images2.imgbox.com/47/8f/SccivNXW_o.png" width="1200"></p> 
<p><img alt="" height="198" src="https://images2.imgbox.com/51/85/cKQyVsso_o.png" width="1200"></p> 
<h3 id="%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9A%E5%AE%8C%E6%88%90%E4%B8%BB%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE">步骤二：完成主服务器的配置</h3> 
<p><span style="color:#1a439c;">1、修改配置文件，设置server-id，开启binlog日志收集，设置日志格式为mixed，完成双“1”配置，重启mysqld服务；</span></p> 
<p><img alt="" height="585" src="https://images2.imgbox.com/9d/e4/zQpSeFMX_o.png" width="1200"></p> 
<pre><code class="hljs">server-id = 1
log-bin=mysql_bin
binlog_format=mixed
expire_logs_days=15
max_binlog_size=500M
skip_slave_start=1
innodb_flush_log_at_trx_commit=1
sync_binlog=1</code></pre> 
<p><span style="color:#1a439c;">2、登录MySQL，创建从服务器用户和密码，并授予从服务器权限；</span></p> 
<p><span style="color:#1a439c;">3、查看主服务器的状态（master_log_file和master_log_pos）；</span></p> 
<p><img alt="" height="469" src="https://images2.imgbox.com/22/99/VRraS7JJ_o.png" width="1200"></p> 
<h3 id="%E6%AD%A5%E9%AA%A4%E4%B8%89%EF%BC%9A%E5%AE%8C%E6%88%90%E4%BB%8E%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E9%85%8D%E7%BD%AE">步骤三：完成从服务器的配置</h3> 
<p><span style="color:#1a439c;">1、修改配置文件，设置server-id（每一个服务器的id都不相同），开启中继日志收集</span></p> 
<p><img alt="" height="702" src="https://images2.imgbox.com/a5/79/PG6mO02Q_o.png" width="1200"></p> 
<pre><code class="hljs">server-id = 2
relay-log=relay-log-bin
relay-log-index=relay-log-bin.index
innodb_buffer_pool_size=1024M
sync_binlog=0
innodb_flush_log_at_trx_commit=2
log-slave-updates=0
relay_log_recovery=1
</code></pre> 
<p><span style="color:#1a439c;">2、登录MySQL，使用change master to 关联主服务的地址、用户、密码以及二进制文件和偏移量与主服务器完成配置同步；start slave；启动同步；</span></p> 
<p><img alt="" height="196" src="https://images2.imgbox.com/d2/b9/1vvKRnyY_o.png" width="1200"></p> 
<p><span style="color:#1a439c;">3、最后从服务器使用show slave status查看IO和SQL线程的状态为yes说明配置完成，可以进行测试了。</span></p> 
<p><img alt="" height="829" src="https://images2.imgbox.com/99/f2/MZMS8xGR_o.png" width="1200"></p> 
<h3 id="%E6%AD%A5%E9%AA%A4%E5%9B%9B%EF%BC%9A%E6%B5%8B%E8%AF%95">步骤四：测试</h3> 
<p>1、主从复制测试</p> 
<p><img alt="" height="810" src="https://images2.imgbox.com/29/5c/HOlR8W0A_o.png" width="1200"></p> 
<p><img alt="" height="292" src="https://images2.imgbox.com/43/b8/dxa4gysK_o.png" width="1161"> </p> 
<p><img alt="" height="361" src="https://images2.imgbox.com/54/1b/7KpNIcDZ_o.png" width="1045"> </p> 
<p> 2、从服务器写入测试</p> 
<p><strong><span style="background-color:#ffd900;">说明：在从服务器上写入数据 是并不会同步到主服务器的，只能在从服务器上自身查看到！</span></strong></p> 
<p><img alt="" height="285" src="https://images2.imgbox.com/2b/46/TjsJF8p2_o.png" width="921"></p> 
<p><img alt="" height="315" src="https://images2.imgbox.com/0a/7e/ssvlSnvY_o.png" width="981"></p> 
<p><img alt="" height="406" src="https://images2.imgbox.com/55/96/5Dp9hRSL_o.png" width="1200"></p> 
<h2 id="%E5%8D%81%E3%80%81%E5%AE%9E%E9%AA%8C%E4%BA%8C%EF%BC%9A%E5%AE%9E%E6%93%8D%E4%B8%BB%E4%BB%8E%E5%A4%8D%E5%88%B6%E4%B9%8B%E5%8D%8A%E5%90%8C%E6%AD%A5%E5%A4%8D%E5%88%B6">十、实验二：实操主从复制之半同步复制</h2> 
<p>主服务器配置：</p> 
<p><img alt="" height="231" src="https://images2.imgbox.com/83/89/dqUvayPt_o.png" width="888"></p> 
<p><img alt="" height="661" src="https://images2.imgbox.com/80/d0/apAmiOHa_o.png" width="1200"></p> 
<p><img alt="" height="54" src="https://images2.imgbox.com/3f/87/V7pYvyYx_o.png" width="949"> <img alt="" height="424" src="https://images2.imgbox.com/70/58/dAv2kHJ9_o.png" width="1200"></p> 
<p>从服务器配置：</p> 
<p><img alt="" height="757" src="https://images2.imgbox.com/14/4b/K7d2nFKC_o.png" width="1200"> <img alt="" height="124" src="https://images2.imgbox.com/25/be/Hz6me8pv_o.png" width="973"></p> 
<p><img alt="" height="769" src="https://images2.imgbox.com/27/da/lvQo8Q8q_o.png" width="1200"></p> 
<p><img alt="" height="619" src="https://images2.imgbox.com/55/be/nUQ46SZu_o.png" width="1200"> <img alt="" height="766" src="https://images2.imgbox.com/60/73/5ySZY4FW_o.png" width="1200"></p> 
<p>测试：</p> 
<p><img alt="" height="1096" src="https://images2.imgbox.com/70/33/MRQ7NAHI_o.png" width="1194"></p> 
<h2 id="%E5%8D%81%E4%B8%80%E3%80%81%E5%AE%9E%E9%AA%8C%E4%B8%89%EF%BC%9A%E5%AE%9E%E6%93%8D%E5%9F%BA%E4%BA%8Eamoeba%E7%9A%84%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB">十一、实验三：实操基于amoeba的读写分离</h2> 
<h3 id="%E6%AD%A5%E9%AA%A4%E4%B8%80%EF%BC%9A%E5%85%88%E5%AE%8C%E6%88%90%E4%B8%89%E5%8F%B0mysql%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E8%B4%A6%E5%8F%B7%E5%92%8C%E7%94%A8%E6%88%B7%E8%AE%BE%E7%BD%AE%EF%BC%8C%E5%B9%B6%E8%BF%9B%E8%A1%8C%E6%8E%88%E6%9D%83"><span style="color:#1a439c;">步骤一：先完成三台mysql服务器的账号和用户设置，并进行授权</span></h3> 
<p><img alt="" height="177" src="https://images2.imgbox.com/80/82/bImmNUeh_o.png" width="958"></p> 
<p><img alt="" height="213" src="https://images2.imgbox.com/1e/5c/eNy25Rzc_o.png" width="1140"> <img alt="" height="202" src="https://images2.imgbox.com/40/a0/SRXMP0iz_o.png" width="1104"></p> 
<h3 id="%C2%A0%E6%AD%A5%E9%AA%A4%E4%BA%8C%EF%BC%9Ajdk%E9%85%8D%E7%BD%AE%E5%92%8Camoeba%E5%AE%89%E8%A3%85%E5%92%8C%E9%85%8D%E7%BD%AE"><span style="color:#1a439c;"> 步骤二：jdk配置和amoeba安装和配置</span></h3> 
<p><span style="color:#1a439c;"><strong>1、jdk配置，完成java环境</strong></span></p> 
<p><img alt="" height="291" src="https://images2.imgbox.com/02/61/8DNyxzyA_o.png" width="1200"></p> 
<p><img alt="" height="331" src="https://images2.imgbox.com/f4/8a/PJmGsctP_o.png" width="1200"></p> 
<pre><code class="hljs">##安装 Java 环境##
因为 Amoeba 基于是 jdk1.5 开发的，所以官方推荐使用 jdk1.5 或 1.6 版本，高版本不建议使用。
cd /opt/
cp jdk-6u14-linux-x64.bin /usr/local/
cd /usr/local/
chmod +x jdk-6u14-linux-x64
./jdk-6u14-linux-x64.bin
//按yes，按enter

mv jdk1.6.0_14/ /usr/local/jdk1.6

vim /etc/profile
export JAVA_HOME=/usr/local/jdk1.6
export CLASSPATH=.:$JAVA_HOME/lib:$JAVA_HOME/jre/lib
export PATH=$JAVA_HOME/bin:$JAVA_HOME/jre/bin:$PATH
export AMOEBA_HOME=/usr/local/amoeba
export PATH=$PATH:$AMOEBA_HOME/bin

source /etc/profile
java -version</code></pre> 
<p><span style="color:#1a439c;"><strong>2、amoeba配置</strong></span></p> 
<p><img alt="" height="145" src="https://images2.imgbox.com/6a/09/MPy2abUe_o.png" width="1200"></p> 
<pre><code class="hljs">mkdir /usr/local/amoeba
tar zxvf amoeba-mysql-binary-2.2.0.tar.gz -C /usr/local/amoeba/
chmod -R 755 /usr/local/amoeba/
/usr/local/amoeba/bin/amoeba
//如显示amoeba start|stop说明安装成功
</code></pre> 
<p><span style="color:#1a439c;"><strong><span style="background-color:#ffd900;">修改amoeba的配置文件 </span></strong></span></p> 
<p><img alt="" height="136" src="https://images2.imgbox.com/52/ed/W8NdvbRj_o.png" width="1200"></p> 
<p><img alt="" height="238" src="https://images2.imgbox.com/68/b1/QfRePyTJ_o.png" width="1200"></p> 
<p><img alt="" height="360" src="https://images2.imgbox.com/f8/c9/laDjcGEk_o.png" width="1200"></p> 
<p><img alt="" height="238" src="https://images2.imgbox.com/bc/18/7xxfI9Mb_o.png" width="1200"></p> 
<p><span style="color:#1a439c;"><strong><span style="background-color:#ffd900;"> 修改数据库的配置文件</span></strong></span><img alt="" height="49" src="https://images2.imgbox.com/d4/ca/WdoOESdj_o.png" width="1200"></p> 
<p><img alt="" height="819" src="https://images2.imgbox.com/34/f9/koN82t53_o.png" width="1200"></p> 
<h3 id="%E2%80%8B%E7%BC%96%E8%BE%91%C2%A0%E6%B5%8B%E8%AF%95%C2%A0"><img alt="" height="58" src="https://images2.imgbox.com/c9/44/8gWqHL6X_o.png" width="1200"><span style="color:#1a439c;"><span style="background-color:#ffd900;"> 测试</span><strong><span style="background-color:#ffd900;"> </span></strong></span></h3> 
<h3 id="%E8%AF%BB%E5%86%99%E5%88%86%E7%A6%BB%E6%B5%8B%E8%AF%95"><span style="color:#1a439c;"><strong><span style="background-color:#ffd900;">读写分离测试</span></strong></span></h3> 
<p><img alt="" height="448" src="https://images2.imgbox.com/a1/bf/0cC1d84y_o.png" width="796"></p> 
<p><img alt="" height="621" src="https://images2.imgbox.com/1c/6e/ZhU1PsYk_o.png" width="1156"></p> 
<p><img alt="" height="394" src="https://images2.imgbox.com/12/51/n3LfSHOo_o.png" width="877"></p> 
<p> <img alt="" height="330" src="https://images2.imgbox.com/31/b2/JdmuX5uf_o.png" width="1051"></p> 
<p><img alt="" height="376" src="https://images2.imgbox.com/94/a7/uDKUObPd_o.png" width="1081"></p> 
<p><img alt="" height="382" src="https://images2.imgbox.com/dc/1f/c4jn2Uez_o.png" width="1026"></p> 
<p></p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/229c7a6546ce2393a1e5454df3c06e39/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Flink-【时间语义、窗口、水位线】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0c4c0fbabf0bb1ba1c0ffb67ce7648df/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">白话机器学习的数学-3-评估</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>