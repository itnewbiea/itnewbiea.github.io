<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>H3C交换机堆叠配置（四台交换机配置堆叠） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="H3C交换机堆叠配置（四台交换机配置堆叠）" />
<meta property="og:description" content="最近需要扩大公司新项目环境，新买够了，四台二层交换机和两台三层交换机，二层交换机型号为H3C S5120，三层交换机为H3C S5500，因为项目有关于国家项目，必须使用国产网络设备，现在需要对四台交换机做两组堆叠，但是我们尝试使用四台交换机进行做堆叠结果也是成功，没有什么问题，但是配置有一些差异，需要对堆叠逻辑端口进行理解。
IRF（ Intelligent Resilient Framework，智能弹性架构）是 H3C 自主研发的软件虚拟化技术。它的核心思想是将多台设备通过 IRF 物理端口连接在一起，进行必要的配置后，虚拟化成一台“分布式设备”。使用这种虚拟化技术可以集合多台设备的硬件资源和软件处理能力，实现多台设备的协同工作、统一管理和不间断维护。为了便于描述，这个“虚拟设备”也称为 IRF。所以，本文中的 IRF 有两层意思，一个是指 IRF 技术，一个是指 IRF 设备。
IRF 主要具有以下优点：
简化管理： IRF 形成之后，用户通过任意成员设备的任意端口都可以登录 IRF 系统，对 IRF内所有成员设备进行统一管理。高可靠性：IRF 的高可靠性体现在多个方面，例如： IRF 由多台成员设备组成， Master 设备负责 IRF 的运行、管理和维护， Slave 设备在作为备份的同时也可以处理业务。一旦 Master 设备故障，系统会迅速自动选举新的 Master，以保证业务中断，从而实现了设备的 1:N 备份；此外，成员设备之间的 IRF 链路支持聚合功能， IRF 和上、下层设备之间的物理链路也支持聚合功能，多条链路之间可以互为备份也可以进行负载分担，从而进一步提高了 IRF 的可靠性。强大的网络扩展能力：通过增加成员设备，可以轻松自如的扩展 IRF 的端口数、带宽。因为各成员设备都有 CPU，能够独立处理协议报文、进行报文转发，所以 IRF 还能够轻松自如的扩展处理能力。 两台配置堆叠流程
两台二层交换机堆叠网络拓扑图
1. master配置 1.设置端口号，因为堆叠是将两台交换机逻辑上变成一台交换机需要将交换机设置不同的端口 号如G0/0/1，G1/0/1,他们就是两台交换机同一位置的端口号，默认为0，看个人习惯，可以将0改为1，后面交换机以此类推。
需要进行重启，服务生效
[H3C] irf member 0 renumber 1 &lt;H3C&gt;save &lt;H3C&gt;reboot 2.设置irf成员优先级，在S5120型号下，优先级被限制于1-32，不同交换机有所不同，优先级越高，成为master的机会越大。
需要进行重启生效
#配置irf成员及优先级 [H3C]irf member 1 priority 30 [H3C]quit [H3C]save &lt;H3C&gt;reboot 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/68323c0b377d0bda4e98b486d1f746e6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-03T15:25:33+08:00" />
<meta property="article:modified_time" content="2023-12-03T15:25:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">H3C交换机堆叠配置（四台交换机配置堆叠）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>        最近需要扩大公司新项目环境，新买够了，四台二层交换机和两台三层交换机，二层交换机型号为H3C S5120，三层交换机为H3C S5500，因为项目有关于国家项目，必须使用国产网络设备，现在需要对四台交换机做两组堆叠，但是我们尝试使用四台交换机进行做堆叠结果也是成功，没有什么问题，但是配置有一些差异，需要对堆叠逻辑端口进行理解。</p> 
<p><img alt="" height="1080" src="https://images2.imgbox.com/63/54/4LJUMR72_o.jpg" width="1200"></p> 
<blockquote> 
 <p>        IRF（ Intelligent Resilient Framework，智能弹性架构）是 H3C 自主研发的软件虚拟化技术。它的核心思想是将多台设备通过 IRF 物理端口连接在一起，进行必要的配置后，虚拟化成一台“分布式设备”。使用这种虚拟化技术可以集合多台设备的硬件资源和软件处理能力，实现多台设备的协同工作、统一管理和不间断维护。为了便于描述，这个“虚拟设备”也称为 IRF。所以，本文中的 IRF 有两层意思，一个是指 IRF 技术，一个是指 IRF 设备。</p> 
</blockquote> 
<p>IRF 主要具有以下优点：</p> 
<ol><li>简化管理： IRF 形成之后，用户通过任意成员设备的任意端口都可以登录 IRF 系统，对 IRF内所有成员设备进行统一管理。</li><li>高可靠性：IRF 的高可靠性体现在多个方面，例如： IRF 由多台成员设备组成， Master 设备负责 IRF 的运行、管理和维护， Slave 设备在作为备份的同时也可以处理业务。一旦 Master 设备故障，系统会迅速自动选举新的 Master，以保证业务中断，从而实现了设备的 1:N 备份；此外，成员设备之间的 IRF 链路支持聚合功能， IRF 和上、下层设备之间的物理链路也支持聚合功能，多条链路之间可以互为备份也可以进行负载分担，从而进一步提高了 IRF 的可靠性。</li><li>强大的网络扩展能力：通过增加成员设备，可以轻松自如的扩展 IRF 的端口数、带宽。因为各成员设备都有 CPU，能够独立处理协议报文、进行报文转发，所以 IRF 还能够轻松自如的扩展处理能力。</li></ol> 
<p>两台配置堆叠流程</p> 
<p>        两台二层交换机堆叠网络拓扑图</p> 
<p><img alt="" height="397" src="https://images2.imgbox.com/52/94/sYsQ0Ffk_o.png" width="1200"></p> 
<h2>1. master配置</h2> 
<p>        1.设置端口号，因为堆叠是将两台交换机逻辑上变成一台交换机需要将交换机设置不同的端口 号如G0/0/1，G1/0/1,他们就是两台交换机同一位置的端口号，默认为0，看个人习惯，可以将0改为1，后面交换机以此类推。</p> 
<p>        需要进行重启，服务生效</p> 
<pre><code class="language-bash">[H3C] irf member 0 renumber 1
&lt;H3C&gt;save
&lt;H3C&gt;reboot</code></pre> 
<p>        2.设置irf成员优先级，在S5120型号下，优先级被限制于1-32，不同交换机有所不同，优先级越高，成为master的机会越大。</p> 
<p>        需要进行重启生效</p> 
<pre><code class="language-bash">#配置irf成员及优先级
[H3C]irf member 1 priority 30
[H3C]quit
[H3C]save
&lt;H3C&gt;reboot</code></pre> 
<p>        3.进行对要设置为irf端口的端口进行down，开启状态无法设备irf </p> 
<pre><code class="language-bash">#临时关闭需要irf的相关物理接口
[H3C]interface range FortyGigE 1/0/23 to FortyGigE 1/0/24
[H3C-if-range]shutdown 
[H3C-if-range]quit</code></pre> 
<p>        4.进入irf逻辑端口，将端口进行加入到irf逻辑端口，这个逻辑端口有点不好理解，下面我给大家详细说一下规则。</p> 
<p>        简单来说，在1/2的第一个数字是端口号的数字，第二个数字是irf的端口号，现在配置时如果master使用1/2那么slave必须配置2/1，如果master是1/1，那么slave需要是2/2。如果在多太交换机的情况下，就是按照此规律进行往后推。</p> 
<pre><code class="language-bash">#配置irf接口并将对应的物理接口加入
[H3C]irf-port 1/2
[H3C-irf-port1/2]port group interface FortyGigE 1/0/23
[H3C-irf-port1/2]port group interface FortyGigE 1/0/24
[H3C-irf-port1/2]quit</code></pre> 
<p>        5.然后进入物理接口进行开启端口</p> 
<pre><code class="language-bash">#启用物理接口
[H3C]interface range FortyGigE 1/0/23 to FortyGigE 1/0/24
[H3C-if-range]undo shutdown 
[H3C-if-range]quit
[H3C]save</code></pre> 
<p>        6.然后将irf进行开启即可</p> 
<pre><code class="language-bash">#启用irf配置
[H3C]irf-port-configuration active</code></pre> 
<h2>2.对slave交换机配置</h2> 
<p>        配置与master命令相同，但是需要注意，将优先级设置为比master小，和端口号进行区分</p> 
<p>          1.设置端口</p> 
<p>        需要进行重启，服务生效</p> 
<pre><code class="language-bash">[H3C] irf member 0 renumber 2
&lt;H3C&gt;save
&lt;H3C&gt;reboot</code></pre> 
<p>        2.设置irf成员优先级</p> 
<p>        需要进行重启生效</p> 
<pre><code class="language-bash">#配置irf成员及优先级
[H3C]irf member 2 priority 20
[H3C]quit
[H3C]save
&lt;H3C&gt;reboot</code></pre> 
<p>        3.进行对要设置为irf端口的端口进行down，开启状态无法设备irf </p> 
<pre><code class="language-bash">#临时关闭需要irf的相关物理接口
[H3C]interface range FortyGigE 1/0/23 to FortyGigE 1/0/24
[H3C-if-range]shutdown 
[H3C-if-range]quit</code></pre> 
<p>        4.进入irf逻辑端口</p> 
<pre><code class="language-bash">#配置irf接口并将对应的物理接口加入
[H3C]irf-port 2/1
[H3C-irf-port1/2]port group interface FortyGigE 1/0/23
[H3C-irf-port1/2]port group interface FortyGigE 1/0/24
[H3C-irf-port1/2]quit</code></pre> 
<p>        5.然后进入物理接口进行开启端口</p> 
<pre><code class="language-bash">#启用物理接口
[H3C]interface range FortyGigE 1/0/23 to FortyGigE 1/0/24
[H3C-if-range]undo shutdown 
[H3C-if-range]quit
[H3C]save</code></pre> 
<p>        6.然后将irf进行开启即可</p> 
<pre><code class="language-bash">#启用irf配置
[H3C]irf-port-configuration active</code></pre> 
<p>        现在就配置完成了，接入网线或者光纤之后，回发现slave会自动重启，然后通过display irf进行查看irf的状态，就可以查看是否配置成功了。</p> 
<p></p> 
<h2>3.四台交换机进行堆叠</h2> 
<p>        其实配置都差不多，还是需要注意的是端口的划分，还有就是irf端口的划分，可以详细看一下下面这个拓扑图。</p> 
<p><img alt="" height="809" src="https://images2.imgbox.com/21/0f/sjfGfBW3_o.png" width="1200"></p> 
<p>物理端口连接：</p> 
<p>        G1/0/23 --&gt; G2/0/24</p> 
<p>        G2/0/23 --&gt; G3/0/24</p> 
<p>        G3/0/23 --&gt; G4/0/24</p> 
<p>        G4/0/23 --&gt; G1/0/24</p> 
<p>irf端口连接</p> 
<p>        G1/2 --&gt; G2/1</p> 
<p>        G2/2 --&gt; G3/1</p> 
<p>        G3/2 --&gt; G4/1</p> 
<p>        G4/2 --&gt; G1/1</p> 
<p>基本就是这个情况，配置与二台相同</p> 
<p></p> 
<h2>4.如果同一个局域网内有第二组交换机需要对irf的domain进行修改</h2> 
<p><a name="struct_0_x2076_17954_x443296702">        为了适应各种组网应用，同一个网络里可以部署多个IRF</a>。IRF之间使用不同的域编号以示区别。</p> 
<p><a name="struct_0_x2076_17954_x1512745718">        在LACP MAD</a>和ARP MAD检测组网中，如果中间设备本身也是一个IRF系统，则必须配置该命令确保本IRF和中间设备组成的IRF的域编号不同，否则可能造成检测异常，甚至导致业务中断。</p> 
<p><a name="struct_0_x2076_17954_x71481123">        IRF</a>域编号是一个全局变量，IRF中的所有成员设备都共用这个IRF域编号。在任何成员设备上通过<strong>irf domain</strong>、<strong>mad enable</strong>、<strong>mad arp enable</strong>或者<strong>mad nd enable</strong>命令均可修改全局IRF域编号。因此，请按照网络规划来修改IRF域编号，不要随意修改。</p> 
<p>        命令：<a name="struct_0_x2076_17954_603358983"><strong>irf domain </strong><em>domain-id</em></a></p> 
<p><em>注意：如果局域网内只有一组irf，就无需更改保持默认即可。</em></p> 
<p></p> 
<h2><em>参考文章：</em></h2> 
<p><a href="https://blog.csdn.net/sjj222sjj/article/details/122727542" title="H3C交换机堆叠（IRF）配置实例_h3c交换机堆叠配置_蛋黄酱拌饭的博客-CSDN博客">H3C交换机堆叠（IRF）配置实例_h3c交换机堆叠配置_蛋黄酱拌饭的博客-CSDN博客</a></p> 
<p><a href="https://zhiliao.h3c.com/Theme/details/45543" rel="nofollow" title="S5120系列交换机IRF2堆叠配置方法（命令行版） - 知了社区 (h3c.com)">S5120系列交换机IRF2堆叠配置方法（命令行版） - 知了社区 (h3c.com)</a></p> 
<p><a href="https://blog.csdn.net/weixin_48215755/article/details/122045347" title="多台华三交换机堆叠_四台交换机堆叠-CSDN博客">多台华三交换机堆叠_四台交换机堆叠-CSDN博客</a></p> 
<p><a href="https://zhiliao.h3c.com/questions/dispcont/156589" rel="nofollow" title="IRF的Domain ID是什么 - 知了社区 (h3c.com)">IRF的Domain ID是什么 - 知了社区 (h3c.com)</a></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3035abba13837f6981192a8d5449c6d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">页面表格高度自适应</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3ef08bbd30b13f130eaa87cb4109d2df/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue管理系统模版</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>