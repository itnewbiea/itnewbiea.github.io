<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python3进阶篇（三）——多线程 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python3进阶篇（三）——多线程" />
<meta property="og:description" content="python3进阶篇（三）——多线程 前言：
阅读这篇文章我能学到什么？
一个应用程序就相当于一个进程，该进程创建时就具有一个主线程(内核线程)，主线程可以创建其他子线程（用户线程），当存在子线程时就形成了多线程。多线程可以使得运行程序在宏观上同时执行多个任务，在一定程度上加快软件执行速度。线程的操作涉及到：线程创建、同步、退让、抢占等。请阅读这篇文章学习它。
——如果你觉得这是一篇不错的博文，希望你能给一个小小的赞，感谢您的支持。
1 了解并创建线程 1.1 了解线程 当进程被创建时，操作系统将会为它创建一个主线程，也即内核线程，注意它是操作系统创建的。用户可以通过主线程创建子线程，或称用户线程。不论主线程还是子线程，每个独立的线程都有一个程序的入口，对应在代码中就是入口函数。一个进程可以有多个线程，线程是进程的执行单元。宏观上各个线程可以是同时执行的，微观上依然是CPU分时间片执行。Python3为我们提供了操作线程的类，这简化了线程开发的步骤。旧的线程模块是_thread，Python3提供了新的模块’threading’操作线程。
1.2 创建线程 我们尝试通过模块’_thread’进行线程创建。
代码示例：
import _thread import time def Run(ThreadName, Speed): while True: time.sleep(Speed) #延迟一定时间，单位为s print(ThreadName, &#34;----&#34;, time.ctime(time.time())) _thread.start_new_thread(Run, (&#34;Thread-1&#34;, 3)) _thread.start_new_thread(Run, (&#34;Thread-2&#34;, 5)) Run(&#34;ThreadMain&#34;, 4) 运行结果：
Thread-1 ---- Sun Jun 21 13:02:44 2020 ThreadMain ---- Sun Jun 21 13:02:45 2020 Thread-2 ---- Sun Jun 21 13:02:46 2020 Thread-1 ---- Sun Jun 21 13:02:47 2020 ThreadMain ---- Sun Jun 21 13:02:49 2020 Thread-1 ---- Sun Jun 21 13:02:50 2020 Thread-2 ---- Sun Jun 21 13:02:51 2020 ThreadMain ---- Sun Jun 21 13:02:53 2020 Thread-1 ---- Sun Jun 21 13:02:53 2020 Thread-2 ---- Sun Jun 21 13:02:56 2020 Thread-1 ---- Sun Jun 21 13:02:56 2020 ThreadMain ---- Sun Jun 21 13:02:57 2020 Thread-1 ---- Sun Jun 21 13:02:59 2020 该示例中总共有三个线程，函数start_new_thread()用于创建线程并指定线程的入口函数，并且开始开始运行线程。最后别忘了主线程也在运行。从打印的时间信息可以看出，三个线程是各自独立运行的。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ed55e9bf38f57c405ccea5b74eb695aa/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-25T11:33:43+08:00" />
<meta property="article:modified_time" content="2020-06-25T11:33:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python3进阶篇（三）——多线程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="centerpython3center_0"></a> 
 <center>
   python3进阶篇（三）——多线程 
 </center></h2> 
<p><em>前言：</em><br> <em>阅读这篇文章我能学到什么？</em><br> <em>  一个应用程序就相当于一个进程，该进程创建时就具有一个主线程(内核线程)，主线程可以创建其他子线程（用户线程），当存在子线程时就形成了多线程。多线程可以使得运行程序在宏观上同时执行多个任务，在一定程度上加快软件执行速度。线程的操作涉及到：线程创建、同步、退让、抢占等。请阅读这篇文章学习它。</em></p> 
<p align="right">——如果你觉得这是一篇不错的博文，希望你能给一个小小的赞，感谢您的支持。</p> 
<h3><a id="1__7"></a>1 了解并创建线程</h3> 
<h4><a id="11__8"></a>1.1 了解线程</h4> 
<p>  当进程被创建时，操作系统将会为它创建一个主线程，也即内核线程，注意它是操作系统创建的。用户可以通过主线程创建子线程，或称用户线程。不论主线程还是子线程，每个独立的线程都有一个程序的入口，对应在代码中就是入口函数。一个进程可以有多个线程，线程是进程的执行单元。宏观上各个线程可以是同时执行的，微观上依然是CPU分时间片执行。Python3为我们提供了操作线程的类，这简化了线程开发的步骤。旧的线程模块是<code>_thread</code>，Python3提供了新的模块’threading’操作线程。</p> 
<h4><a id="12__11"></a>1.2 创建线程</h4> 
<p>  我们尝试通过模块’_thread’进行线程创建。<br>   代码示例：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> _thread
<span class="token keyword">import</span> time

<span class="token keyword">def</span> <span class="token function">Run</span><span class="token punctuation">(</span>ThreadName<span class="token punctuation">,</span> Speed<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>Speed<span class="token punctuation">)</span>                       <span class="token comment">#延迟一定时间，单位为s</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>ThreadName<span class="token punctuation">,</span> <span class="token string">"----"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

_thread<span class="token punctuation">.</span>start_new_thread<span class="token punctuation">(</span>Run<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"Thread-1"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
_thread<span class="token punctuation">.</span>start_new_thread<span class="token punctuation">(</span>Run<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">"Thread-2"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

Run<span class="token punctuation">(</span><span class="token string">"ThreadMain"</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
</code></pre> 
<p>  运行结果：</p> 
<pre><code>Thread-1 ---- Sun Jun 21 13:02:44 2020
ThreadMain ---- Sun Jun 21 13:02:45 2020
Thread-2 ---- Sun Jun 21 13:02:46 2020
Thread-1 ---- Sun Jun 21 13:02:47 2020
ThreadMain ---- Sun Jun 21 13:02:49 2020
Thread-1 ---- Sun Jun 21 13:02:50 2020
Thread-2 ---- Sun Jun 21 13:02:51 2020
ThreadMain ---- Sun Jun 21 13:02:53 2020
Thread-1 ---- Sun Jun 21 13:02:53 2020
Thread-2 ---- Sun Jun 21 13:02:56 2020
Thread-1 ---- Sun Jun 21 13:02:56 2020
ThreadMain ---- Sun Jun 21 13:02:57 2020
Thread-1 ---- Sun Jun 21 13:02:59 2020
</code></pre> 
<p>  该示例中总共有三个线程，函数<code>start_new_thread()</code>用于创建线程并指定线程的入口函数，并且开始开始运行线程。最后别忘了主线程也在运行。从打印的时间信息可以看出，三个线程是各自独立运行的。</p> 
<h4><a id="13__46"></a>1.3 创建线程类</h4> 
<p>  通常为了更好的封装性和代码重用性，我们会将线程类进行二次封装。这里我们尝试通过模块<code>threading</code>封装一个线程类。<br>   代码示例：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token keyword">class</span> <span class="token class-name">myThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Speed<span class="token punctuation">)</span><span class="token punctuation">:</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>             <span class="token comment">#调用父类构造函数</span>
        self<span class="token punctuation">.</span>Name <span class="token operator">=</span> Name
        self<span class="token punctuation">.</span>Speed <span class="token operator">=</span> Speed

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                                  <span class="token comment">#重载run函数</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始线程："</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
        EntryFunction<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>Speed<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"结束子线程："</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">EntryFunction</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> Speed<span class="token punctuation">)</span><span class="token punctuation">:</span>                     <span class="token comment">#线程入口函数</span>
    <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>Speed<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> <span class="token string">"----"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

Thread1 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread-1"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
Thread2 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread-2"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>

Thread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
Thread2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">#等待子线程结束</span>
Thread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
Thread2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"主线程结束"</span><span class="token punctuation">)</span>
</code></pre> 
<p>  运行结果：</p> 
<pre><code>开始线程： Thread-1
开始线程： Thread-2
Thread-1 ---- Sun Jun 21 14:35:59 2020
Thread-2 ---- Sun Jun 21 14:36:01 2020
Thread-1 ---- Sun Jun 21 14:36:02 2020
Thread-1 ---- Sun Jun 21 14:36:05 2020
Thread-2 ---- Sun Jun 21 14:36:06 2020
Thread-1 ---- Sun Jun 21 14:36:08 2020
Thread-2 ---- Sun Jun 21 14:36:11 2020
Thread-1 ---- Sun Jun 21 14:36:11 2020
结束子线程： Thread-1
Thread-2 ---- Sun Jun 21 14:36:16 2020
Thread-2 ---- Sun Jun 21 14:36:21 2020
结束子线程： Thread-2
主线程结束
</code></pre> 
<p>  线程对象示例化后通过调用<code>start()</code>函数可启动线程，其将从线程<code>run()</code>函数开始执行，我们重载了父类的<code>run()</code>函数。<code>join()</code>函数使得主线程会等待子线程结束。</p> 
<h3><a id="2__100"></a>2 线程同步</h3> 
<p>  一些数据资源需要被多个线程操作，多个线程同时对同一块数据修改，可能出现不可预料的结果。因为线程操作数据是需要时间的，若在数据修改完成之前其他线程也进行修改则导致数据出现预料之外的情况。可以通过线程锁实现线程同步，线程锁有两种状态，即锁定和未锁定。<br>   代码示例：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

<span class="token comment">#1~5 5组数据及其有效标志，Couter表示剩余有效数据数，Length表示数据总个数</span>
Data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"Counter"</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">"Length"</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">:</span><span class="token boolean">True</span><span class="token punctuation">}</span>     <span class="token comment">#用于测试的线程共享数据</span>

ThreadLock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                <span class="token comment">#创建线程锁</span>

<span class="token keyword">class</span> <span class="token class-name">myThread</span><span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> Speed<span class="token punctuation">)</span><span class="token punctuation">:</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>                                      <span class="token comment">#调用父类构造函数</span>
        self<span class="token punctuation">.</span>Name <span class="token operator">=</span> Name
        self<span class="token punctuation">.</span>Speed <span class="token operator">=</span> Speed

    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>                                                           <span class="token comment">#重载run函数</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始线程："</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
        GetData<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>Speed<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"结束子线程："</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">GetData</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> Speed<span class="token punctuation">)</span><span class="token punctuation">:</span>                                                    <span class="token comment">#线程入口函数</span>
    <span class="token keyword">while</span> Data<span class="token punctuation">[</span><span class="token string">"Counter"</span><span class="token punctuation">]</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span>Speed<span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> <span class="token string">"----"</span><span class="token punctuation">,</span> time<span class="token punctuation">.</span>ctime<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        ThreadLock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                 <span class="token comment">#获取线程锁，拿不到锁则等待</span>
        <span class="token keyword">for</span> n <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> Data<span class="token punctuation">[</span><span class="token string">"Length"</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> Data<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
                Data<span class="token punctuation">[</span>n<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
                Data<span class="token punctuation">[</span><span class="token string">"Counter"</span><span class="token punctuation">]</span> <span class="token operator">-=</span> <span class="token number">1</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> <span class="token string">"----"</span><span class="token punctuation">,</span> <span class="token string">"Get: "</span><span class="token punctuation">,</span> n<span class="token punctuation">)</span>
                <span class="token keyword">break</span>
        ThreadLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>                                                 <span class="token comment">#释放线程锁</span>

Thread1 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread-1"</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
Thread2 <span class="token operator">=</span> myThread<span class="token punctuation">(</span><span class="token string">"Thread-2"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>

Thread1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
Thread2<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
Thread1<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>
Thread2<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"主线程结束"</span><span class="token punctuation">)</span>
</code></pre> 
<p>  运行结果：</p> 
<pre><code>开始线程： Thread-1
开始线程： Thread-2
Thread-1 ---- Sun Jun 21 17:24:55 2020
Thread-1 ---- Get:  1
Thread-2 ---- Sun Jun 21 17:24:57 2020
Thread-2 ---- Get:  2
Thread-1 ---- Sun Jun 21 17:24:58 2020
Thread-1 ---- Get:  3
Thread-1 ---- Sun Jun 21 17:25:01 2020
Thread-1 ---- Get:  4
Thread-2 ---- Sun Jun 21 17:25:02 2020
Thread-2 ---- Get:  5
结束子线程： Thread-2
Thread-1 ---- Sun Jun 21 17:25:04 2020
结束子线程： Thread-1
主线程结束
</code></pre> 
<p>  我们创建了一个字典，字典内有5组数据，通过线程去将数据挨个置为失效，为了保证同一组数据不会被多个线程重复操作，并且是按顺序失效这5组数据，我们需要给数据操作的代码段加上线程锁，以此来保证每次只能有一个线程操作这5组数据。<code>acquire()</code>函数使得每次只有一个线程能获得线程锁，即进行后续的数据操作，其他线程则会等待，知道其他线程释放锁后并且自己获得锁，<code>release()</code>函数使得线程释放获得的锁。</p> 
<h3><a id="3__167"></a>3 线程优先级队列</h3> 
<p>  通过上面的线程锁，我们不光可以实现一些数据单次只允许一个线程访问，其他线程进行阻塞等待，我们也可以将一些代码段的执行加上线程锁，使得一些操作单次只能由一个线程执行。另外，结合队列先入先出的特性，我们可以实现多个线程操作，按照队列顺序执行，也即优先级。<br>   代码示例：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> queue
<span class="token keyword">import</span> threading
<span class="token keyword">import</span> time

exitFlag <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">class</span> <span class="token class-name">myThread</span> <span class="token punctuation">(</span>threading<span class="token punctuation">.</span>Thread<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> Name<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
        threading<span class="token punctuation">.</span>Thread<span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>Name <span class="token operator">=</span> Name
        self<span class="token punctuation">.</span>q <span class="token operator">=</span> q
    <span class="token keyword">def</span> <span class="token function">run</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"开启线程："</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>
        process_data<span class="token punctuation">(</span>self<span class="token punctuation">.</span>Name<span class="token punctuation">,</span> self<span class="token punctuation">.</span>q<span class="token punctuation">)</span>
        <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"退出线程："</span> <span class="token operator">+</span> self<span class="token punctuation">.</span>Name<span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">process_data</span><span class="token punctuation">(</span>Name<span class="token punctuation">,</span> q<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">while</span> <span class="token operator">not</span> exitFlag<span class="token punctuation">:</span>                                          <span class="token comment">#线程退出标志</span>
        queueLock<span class="token punctuation">.</span>acquire<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token operator">not</span> workQueue<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                                <span class="token comment">#队列非空</span>
            data <span class="token operator">=</span> q<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"%s processing %s"</span> <span class="token operator">%</span> <span class="token punctuation">(</span>Name<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span>
        queueLock<span class="token punctuation">.</span>release<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>                                            <span class="token comment">#为了演示短暂延迟，防止一个线程全部执行完</span>

threadList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"Thread-1"</span><span class="token punctuation">,</span> <span class="token string">"Thread-2"</span><span class="token punctuation">,</span> <span class="token string">"Thread-3"</span><span class="token punctuation">]</span>
PriorityList <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"One"</span><span class="token punctuation">,</span> <span class="token string">"Two"</span><span class="token punctuation">,</span> <span class="token string">"Three"</span><span class="token punctuation">,</span> <span class="token string">"Four"</span><span class="token punctuation">,</span> <span class="token string">"Five"</span><span class="token punctuation">]</span>
queueLock <span class="token operator">=</span> threading<span class="token punctuation">.</span>Lock<span class="token punctuation">(</span><span class="token punctuation">)</span>
workQueue <span class="token operator">=</span> queue<span class="token punctuation">.</span>Queue<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
threads <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
threadID <span class="token operator">=</span> <span class="token number">1</span>

<span class="token comment"># 创建新线程</span>
<span class="token keyword">for</span> ThreadName <span class="token keyword">in</span> threadList<span class="token punctuation">:</span>
    thread <span class="token operator">=</span> myThread<span class="token punctuation">(</span>ThreadName<span class="token punctuation">,</span> workQueue<span class="token punctuation">)</span>                 <span class="token comment">#创建线程</span>
    thread<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>                                      <span class="token comment">#执行线程</span>
    threads<span class="token punctuation">.</span>append<span class="token punctuation">(</span>thread<span class="token punctuation">)</span>                              <span class="token comment">#添加到线程队列</span>
    threadID <span class="token operator">+=</span> <span class="token number">1</span>

<span class="token comment"># 填充队列</span>
<span class="token keyword">for</span> Priority <span class="token keyword">in</span> PriorityList<span class="token punctuation">:</span>                                   <span class="token comment">#主线程进行队列填充</span>
    workQueue<span class="token punctuation">.</span>put<span class="token punctuation">(</span>Priority<span class="token punctuation">)</span>                                 <span class="token comment">#添加到队列中</span>

<span class="token comment"># 等待队列清空</span>
<span class="token keyword">while</span> <span class="token operator">not</span> workQueue<span class="token punctuation">.</span>empty<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                            <span class="token comment">#主线程等待直到队列为空</span>
    <span class="token keyword">pass</span>

<span class="token comment"># 通知线程是时候退出</span>
exitFlag <span class="token operator">=</span> <span class="token number">1</span>                                            <span class="token comment">#主线程通知子线程结束</span>

<span class="token comment"># 等待所有线程完成</span>
<span class="token keyword">for</span> t <span class="token keyword">in</span> threads<span class="token punctuation">:</span>                                       <span class="token comment">#主线程等待所有子线程结束后结束</span>
    t<span class="token punctuation">.</span>join<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">print</span> <span class="token punctuation">(</span><span class="token string">"退出主线程"</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行结果：</p> 
<pre><code>开启线程：Thread-1
开启线程：Thread-2
开启线程：Thread-3
Thread-2 processing One
Thread-3 processing Two
Thread-1 processing Three
Thread-2 processing Four
Thread-3 processing Five
退出线程：Thread-1
退出线程：Thread-2
退出线程：Thread-3
退出主线程
</code></pre> 
<p>  上面例子通过三个线程去访问队列，不管线程谁先执行，最终访问的顺序都是<code>One</code>到<code>Five</code>。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/861795afc58174edbb68b147076c6ceb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据就是由一个个表格内容组成的</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/06fcd18202a1f93ab0f37d2a04d216bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数字图像处理（冈萨雷斯版）学习笔记(2)第2-3章</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>