<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>轻松实现ESP01S下载HTTP文件的两种方法 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="轻松实现ESP01S下载HTTP文件的两种方法" />
<meta property="og:description" content="一、简介 文章使用ESP01S模块为例，直接访问HTTP链接下载文件并保存到Flash中，可扩展完成网络资源获取、WIFI OTA升级等操作，文章以ESP01S通过WIFI下载BIN文件为例。
实现方法：
方法1：串口AT指令获取方法2：Arduino IDE编程获取 硬件准备：
ESP01S模块（必需）W25Q32（仅用于ArduinoIDE开发时保存文件） 二、ESP01S 1. 简介 ESP01S是一款基于ESP8266的紧凑型通信模块，集成 Wi-Fi MAC/ BB/RF/PA/LNA。支持标准的 IEEE802.11 b/g/n 协议，完整的 TCP/IP 协议栈，可以使设备接入网络平台，实现WIFI或4G通信等功能，淘宝售价5-8元不等。
2.HTTP文件 首先确保浏览器可以访问地址：www.funiot.xyz/upload/test.bin
访问上述链接后能够下载文件，如下所示：
三、下载文件 1. AT指令下载 (1) AT 发送AT测试，收到响应OK
(2) AT&#43;CWMODE=1 配置Station模式，即作为客户端连接到wifi
(3) AT&#43;CWJAP=“funiot”,“funiot.xyz” 连接wifi，wifi名称：funiot，wifi密码：funiot.xyz
(4) AT&#43;CIPSTART=“TCP”,“www.funiot.xyz”,80 建立www.funiot.xyz地址80端口的TCP连接
(5) AT&#43;CIPMODE=1 设置传输模式，1为透传
(6) AT&#43;CIPSEND 进入透传指令传输
(7) HEAD 请求 直接发送：
HEAD /upload/test.bin HTTP/1.1 Host: www.funiot.xyz 注意按照上述换行格式，HTTP的分隔符为两个换行，在编辑框中添加一个新行并勾选“发送新行”，请求成功的话可以看到下图：
这是我们文件下载的请求头，上面我们比较关注的是Content-Length:4672，这个指明了文件的大小。
(8) Get请求 直接发送：
GET /upload/test.bin HTTP/1.1 Host: www.funiot.xyz 这个就是实际的文件内容，我们可以打开之前下载的文件：
(9) Get请求文件的部分数据 可以给GET请求添加限制范围：
GET /upload/test.bin HTTP/1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c0634d22c860f42f950780878784da7c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-28T12:02:24+08:00" />
<meta property="article:modified_time" content="2023-12-28T12:02:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">轻松实现ESP01S下载HTTP文件的两种方法</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/cb/f2/zkAgvxme_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_2"></a>一、简介</h2> 
<p>文章使用ESP01S模块为例，直接访问HTTP链接下载文件并保存到Flash中，可扩展完成网络资源获取、WIFI OTA升级等操作，文章以ESP01S通过WIFI下载BIN文件为例。<br> <strong>实现方法：</strong></p> 
<ul><li>方法1：串口AT指令获取</li><li>方法2：Arduino IDE编程获取</li></ul> 
<p><strong>硬件准备：</strong></p> 
<ul><li>ESP01S模块（必需）</li><li>W25Q32（仅用于ArduinoIDE开发时保存文件）</li></ul> 
<h2><a id="ESP01S_11"></a>二、ESP01S</h2> 
<h3><a id="1__12"></a>1. 简介</h3> 
<p>ESP01S是一款基于ESP8266的紧凑型通信模块，集成 Wi-Fi MAC/ BB/RF/PA/LNA。支持标准的 IEEE802.11 b/g/n 协议，完整的 TCP/IP 协议栈，可以使设备接入网络平台，实现WIFI或4G通信等功能，淘宝售价5-8元不等。<br> <img src="https://images2.imgbox.com/ee/b0/u4s3wGPr_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="2HTTP_15"></a>2.HTTP文件</h3> 
<p>首先确保浏览器可以访问地址：www.funiot.xyz/upload/test.bin<br> 访问上述链接后能够下载文件，如下所示：<br> <img src="https://images2.imgbox.com/d3/da/9oqxcMfT_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_19"></a>三、下载文件</h2> 
<h3><a id="1_AT_20"></a>1. AT指令下载</h3> 
<h4><a id="1_AT_21"></a>(1) AT</h4> 
<p>发送AT测试，收到响应OK</p> 
<h4><a id="2_ATCWMODE1_23"></a>(2) AT+CWMODE=1</h4> 
<p>配置Station模式，即作为客户端连接到wifi</p> 
<h4><a id="3_ATCWJAPfuniotfuniotxyz_25"></a>(3) AT+CWJAP=“funiot”,“funiot.xyz”</h4> 
<p>连接wifi，wifi名称：funiot，wifi密码：funiot.xyz</p> 
<h4><a id="4_ATCIPSTARTTCPwwwfuniotxyz80_27"></a>(4) AT+CIPSTART=“TCP”,“www.funiot.xyz”,80</h4> 
<p>建立www.funiot.xyz地址80端口的TCP连接</p> 
<h4><a id="5_ATCIPMODE1_29"></a>(5) AT+CIPMODE=1</h4> 
<p>设置传输模式，1为透传</p> 
<h4><a id="6_ATCIPSEND_31"></a>(6) AT+CIPSEND</h4> 
<p>进入透传指令传输</p> 
<h4><a id="7_HEAD__33"></a>(7) HEAD 请求</h4> 
<p>直接发送：</p> 
<pre><code>HEAD /upload/test.bin HTTP/1.1 
Host: www.funiot.xyz

</code></pre> 
<p>注意按照上述换行格式，HTTP的分隔符为两个换行，在编辑框中添加一个新行并勾选“发送新行”，请求成功的话可以看到下图：<br> <img src="https://images2.imgbox.com/a0/b3/xAsXySmM_o.png" alt="在这里插入图片描述"><br> 这是我们文件下载的请求头，上面我们比较关注的是<strong>Content-Length:4672</strong>，这个指明了文件的大小。<br> <img src="https://images2.imgbox.com/99/e5/RtS7CJ08_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="8_Get_45"></a>(8) Get请求</h4> 
<p>直接发送：</p> 
<pre><code>GET /upload/test.bin HTTP/1.1 
Host: www.funiot.xyz

</code></pre> 
<p><img src="https://images2.imgbox.com/5b/53/4o5U6C4Z_o.png" alt="在这里插入图片描述"><br> 这个就是实际的文件内容，我们可以打开之前下载的文件：<br> <img src="https://images2.imgbox.com/1e/42/qMibNINj_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="9_Get_57"></a>(9) Get请求文件的部分数据</h4> 
<p>可以给GET请求添加限制范围：<br> GET /upload/test.bin HTTP/1.1<br> Host: www.funiot.xyz<br> <strong>Range: bytes=0-99</strong><br> <img src="https://images2.imgbox.com/ff/f4/LCRVRyXc_o.png" alt="在这里插入图片描述"><br> AT指令完整流程：<br> <img src="https://images2.imgbox.com/d8/5a/akQMi7Of_o.png" alt="在这里插入图片描述"><br> 然后大家就可以使用MCU去接收处理这些下载的数据了。</p> 
<h3><a id="2_Arduino_IDE_66"></a>2. Arduino IDE编程实现文件下载并保存</h3> 
<p>方法2时使用Arduino IDE开发时，可以用编程实现文件的下载并保存，但是保存文件时，ESP01S模块的板载FLASH又比较小（8Mbit的Flash），因此首先进行Flash更换：</p> 
<h4><a id="1_Flash_68"></a>(1) 更换Flash</h4> 
<p>W25Q32 是一个32Mbit(4M)的Flash芯片，大家可以根据自己的需要替换不同大小的Flash，用热风枪吹下原来的Flash后替换大容量的即可，例如：<br> </p> 
<div class="csdn-video-box"> 
 <iframe id="bX8fmhHz-1703594047168" frameborder="0" src="https://live.csdn.net/v/embed/354564" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>ESP01S替换FLASH</p> 
</div> 
<p></p> 
<h4><a id="2_ArduinoIDE_71"></a>(2) 烧录固件【ArduinoIDE开发可跳过】</h4> 
<p>在更换Flash之后，如果需要进行AT指令的控制，需要重新烧录官方固件，烧录软件下载：<a href="https://docs.ai-thinker.com/tools" rel="nofollow">烧录WiFi固件工具</a><br> ①下载固件：<a href="https://docs.ai-thinker.com/%E5%9B%BA%E4%BB%B6%E6%B1%87%E6%80%BB" rel="nofollow">安信可科技/固件汇总</a><br> <img src="https://images2.imgbox.com/1e/29/CNhvMrGQ_o.png" alt="在这里插入图片描述"><br> ②烧录<br> 连接VCC 、GND、RXD、TXD，并上电前将IO0拉低<br> <img src="https://images2.imgbox.com/ce/97/46dtwBlQ_o.png" alt="在这里插入图片描述"><br> 下载完成后，将IO0恢复悬空，重新上电或复位</p> 
<h4><a id="3_ArduinoIDE_79"></a>(3) 测试固件【ArduinoIDE开发可跳过】</h4> 
<p>打开串口调试助手，波特率115200，重新上电可以查看下面的信息，并且换行发送"AT"，可以收到”OK“，即表明固件烧录成功。<br> <img src="https://images2.imgbox.com/7b/19/8WdXDd3R_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4_Arduino_IDE_82"></a>(4) Arduino IDE编程</h4> 
<p>Arduino IDE编程部分主要实现的是HTTP文件下载、JSON解析以及创建文件系统进行文件的读写操作。</p> 
<h5><a id="a_Flash_Size_84"></a>a. 配置Flash Size</h5> 
<p>由于更换了4M Flash，所以Flash Size需要调整为：<br> <img src="https://images2.imgbox.com/37/c0/wUpF7qzL_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="b_HTTP_88"></a>b. HTTP文件下载与解析</h5> 
<p>主要使用的HTTP操作使用的库是：<br> #include &lt;ESP8266WiFi.h&gt;<br> 数据解析的JSON库采用的是：<br> #include &lt;ArduinoJson.h&gt;</p> 
<h5><a id="c_FS_93"></a>c. FS文件系统的读写操作</h5> 
<p>对于SPI FLASH的驱动以及文件系统的创建使用的库是：<br> #include &lt;Wire.h&gt;<br> #include &lt;FS.h&gt;</p> 
<h5><a id="d__97"></a>d. 完整代码下载</h5> 
<p>点击下载：<a href="https://gitee.com/funiot/esp01s-http-download-file" rel="nofollow">【Gitee】IOT趣制作 / ESP01s-HttpDownload-File</a><br> <img src="https://images2.imgbox.com/aa/20/f7GlSjK1_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="e_100"></a>e.运行结果</h5> 
<p>注意：下载文件会有1-2s左右的处理时间<br> <img src="https://images2.imgbox.com/b5/e9/S2dUEpfY_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_103"></a>四、总结</h2> 
<p>通过上面的两方法可以简单的实现网络文件的下载，可以后续用于OTA升级、网络文件资源下载的等，所有操作步骤和工程代码已经在上面给出，如有相关疑问和建议，可在公众 号【IOT趣制作】进行留言。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/36f7b18b7faf032ebd1802d32fd78c30/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">搭建简单的GPT聊天机器人</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/182cc2d0481f5913e6dd8bfc73de92dd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于element ui封装table组件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>