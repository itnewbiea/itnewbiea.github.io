<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot启动控制台的banner是怎么回事 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot启动控制台的banner是怎么回事" />
<meta property="og:description" content="前言 每次启动SpringBoot项目时，总是能看到控制台打印了一串字符，隐约能辨认出是“Spring”，不知大家是否也好奇过是怎么实现的，是直接打印固定的字符串，还是根据什么算法去生成的？于是闲暇无事，探究一番。
只想修改banner可以跳到文末查看
SpringBoot是怎么打印的 Banner默认实现类 SpringBootBanner 1、根据控制台打印的字符进行全局搜索，笔者选取:: Spring Boot ::进行搜索，定位到了org.springframework.boot.SpringBootBanner。
IDEA全局搜索：CTRL &#43; SHIFT &#43; R
2、进入SpringBootBanner类，先看下注释Default Banner implementation which writes the &#39;Spring&#39; banner.，说了两个信息：1、当前类是SpringBoot Banner的默认实现；2、打印的字符是“Spring”。
3、往下看，SpringBootBanner实现了Banner接口。Banner包括printBanner方法和枚举Mode。
根据Mode中的注释和枚举值可以看出，Banner有三种状态：关闭、打印到控制台、打印到日志。具体使用场景留待后续分析。
Banner源码
/** * Interface class for writing a banner programmatically. */ @FunctionalInterface public interface Banner { /** * Print the banner to the specified print stream. * @param environment the spring environment * @param sourceClass the source class for the application * @param out the output print stream */ void printBanner(Environment environment, Class&lt;?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/bbdd39d1fd300e664c5bfa0adb61b81f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-16T09:55:45+08:00" />
<meta property="article:modified_time" content="2023-03-16T09:55:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot启动控制台的banner是怎么回事</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>前言</h3> 
<p>每次启动SpringBoot项目时，总是能看到控制台打印了一串字符，隐约能辨认出是“Spring”，不知大家是否也好奇过是怎么实现的，是直接打印固定的字符串，还是根据什么算法去生成的？于是闲暇无事，探究一番。<br> <img src="https://images2.imgbox.com/23/a7/AY2uXhof_o.png" alt="image"></p> 
<blockquote> 
 <p>只想修改banner可以跳到文末查看</p> 
</blockquote> 
<h3><a id="SpringBoot_6"></a>SpringBoot是怎么打印的</h3> 
<h4><a id="Banner_SpringBootBanner_7"></a>Banner默认实现类 SpringBootBanner</h4> 
<p>1、根据控制台打印的字符进行全局搜索，笔者选取<code>:: Spring Boot ::</code>进行搜索，定位到了<code>org.springframework.boot.SpringBootBanner</code>。</p> 
<blockquote> 
 <p>IDEA全局搜索：CTRL + SHIFT + R</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/3b/06/szOhent5_o.png" alt="image"></p> 
<p>2、进入<code>SpringBootBanner</code>类，先看下注释<code>Default Banner implementation which writes the 'Spring' banner.</code>，说了两个信息：1、当前类是SpringBoot Banner的默认实现；2、打印的字符是“Spring”。</p> 
<p>3、往下看，<code>SpringBootBanner</code>实现了<code>Banner</code>接口。<code>Banner</code>包括<code>printBanner</code>方法和枚举<code>Mode</code>。<br> 根据<code>Mode</code>中的注释和枚举值可以看出，<code>Banner</code>有三种状态：关闭、打印到控制台、打印到日志。具体使用场景留待后续分析。</p> 
<p><strong>Banner源码</strong></p> 
<pre><code>/**
 * Interface class for writing a banner programmatically.
 */
@FunctionalInterface
public interface Banner {

	/**
	 * Print the banner to the specified print stream.
	 * @param environment the spring environment
	 * @param sourceClass the source class for the application
	 * @param out the output print stream
	 */
	void printBanner(Environment environment, Class&lt;?&gt; sourceClass, PrintStream out);

	/**
	 * An enumeration of possible values for configuring the Banner.
	 */
	enum Mode {
		/**
		 * Disable printing of the banner.
		 */
		OFF,

		/**
		 * Print the banner to System.out.
		 */
		CONSOLE,

		/**
		 * Print the banner to the log file.
		 */
		LOG
	}

}
</code></pre> 
<p>4、往下看到类的属性<code>BANNER</code>和<code>SPRING_BOOT</code>，也能辨认出是控制台打印的那些字符。</p> 
<p>类里面只有一个方法<code>printBanner</code>，负责打印Banner字符。逻辑比较清晰，第一部分逐行打印<code>BANNER</code>形成图案；第二部分打印SpringBoot版本号，总长度由<code>STRAP_LINE_SIZE</code>控制。</p> 
<p><strong>SpringBootBanner完整代码</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * Default Banner implementation which writes the 'Spring' banner.
 */</span>
<span class="token keyword">class</span> <span class="token class-name">SpringBootBanner</span> <span class="token keyword">implements</span> <span class="token class-name">Banner</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> BANNER <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token string">"  .   ____          _            __ _ _"</span><span class="token punctuation">,</span>
			<span class="token string">" /\\\\ / ___'_ __ _ _(_)_ __  __ _ \\ \\ \\ \\"</span><span class="token punctuation">,</span> <span class="token string">"( ( )\\___ | '_ | '_| | '_ \\/ _` | \\ \\ \\ \\"</span><span class="token punctuation">,</span>
			<span class="token string">" \\\\/  ___)| |_)| | | | | || (_| |  ) ) ) )"</span><span class="token punctuation">,</span> <span class="token string">"  '  |____| .__|_| |_|_| |_\\__, | / / / /"</span><span class="token punctuation">,</span>
			<span class="token string">" =========|_|==============|___/=/_/_/_/"</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> SPRING_BOOT <span class="token operator">=</span> <span class="token string">" :: Spring Boot :: "</span><span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">int</span> STRAP_LINE_SIZE <span class="token operator">=</span> <span class="token number">42</span><span class="token punctuation">;</span>

	<span class="token annotation punctuation">@Override</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> sourceClass<span class="token punctuation">,</span> <span class="token class-name">PrintStream</span> printStream<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> line <span class="token operator">:</span> BANNER<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			printStream<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token class-name">String</span> version <span class="token operator">=</span> <span class="token class-name">SpringBootVersion</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		version <span class="token operator">=</span> <span class="token punctuation">(</span>version <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token string">" (v"</span> <span class="token operator">+</span> version <span class="token operator">+</span> <span class="token string">")"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">;</span>
		<span class="token class-name">StringBuilder</span> padding <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>padding<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> STRAP_LINE_SIZE <span class="token operator">-</span> <span class="token punctuation">(</span>version<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> SPRING_BOOT<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			padding<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		printStream<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token class-name">AnsiOutput</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token class-name">AnsiColor</span><span class="token punctuation">.</span>GREEN<span class="token punctuation">,</span> SPRING_BOOT<span class="token punctuation">,</span> <span class="token class-name">AnsiColor</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">,</span> padding<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token class-name">AnsiStyle</span><span class="token punctuation">.</span>FAINT<span class="token punctuation">,</span> version<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		printStream<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="Banner_SpringApplicationBannerPrinter_99"></a>Banner核心控制类 SpringApplicationBannerPrinter</h4> 
<p>1、上节找到了负责存储和打印Banner字符的类<code>SpringBootBanner</code>，现在向调用链上方继续寻找，通过<code>CTRL + B</code>或者全局搜索可以发现<code>SpringBootBanner</code>在<code>SpringApplicationBannerPrinter</code>类中作为类变量，大概能猜测出这个<code>SpringApplicationBannerPrinter</code>类是Banner打印的核心控制器。<br> <br><br> 2、进入<code>SpringApplicationBannerPrinter</code>类，照例先看注释<code>Class used by SpringApplication to print the application banner.</code>，意思是当前类被<code>SpringApplication</code>用来打印banner。</p> 
<p>这个<code>SpringApplication</code>好像有点眼熟，名字和我们SpringBoot项目的启动类有点相似，翻翻启动类的代码，想起我们就是通过<code>SpringApplication</code>的<code>run</code>方法启动项目，banner打印调用也是由<code>SpringApplication</code>控制的，后续会详细分析。（占坑，后续SpringBoot启动流程也会出一篇博客去探讨一下）<br> <img src="https://images2.imgbox.com/48/02/iXYjLXPD_o.png" alt="image"></p> 
<p>回归正题，继续从类的属性开始看，根据名字猜测大概含义，留待后续验证：</p> 
<ol><li><code>BANNER_LOCATION_PROPERTY</code>：Spring配置，大概是banner文件的路径。</li><li><code>BANNER_IMAGE_LOCATION_PROPERTY</code>：Spring配置，banner图片的路径（存疑，控制台难道能打印图片？）。</li><li><code>DEFAULT_BANNER_LOCATION = "banner.txt"</code>：取值是txt文件，猜测是banner文件的默认位置。</li><li><code>String[] IMAGE_EXTENSION = { "gif", "jpg", "png" }</code>：取值是常见图片的后缀，结合第二个属性猜测是用来对banner图片类型做限制。</li><li><code>DEFAULT_BANNER = new SpringBootBanner()</code>：把上节分析的<code>SpringBootBanner</code>当做Banner默认实现类</li><li><code>ResourceLoader resourceLoader</code>：<code>ResourceLoader</code>简单来说是Spring加载资源的统一抽象，由实现类提供具体逻辑。<br> 在Spring中读取xml配置文件加载应用上下文的<code>ClassPathXmlApplicationContext</code>，就是<code>ResourceLoader</code>的子类。</li><li><code>Banner fallbackBanner</code>：翻译过来是<code>回退banner</code>，暂时猜不出作用，等待后续填坑。<br> <br></li></ol> 
<p>3、往下看方法，只有两个非私有方法，都是<code>print</code>的重载方法，差别在于第三个参数，分别是<code>Log logger</code>和<code>PrintStream out</code>，代表这两个方法分别负责日志打印和控制台打印。</p> 
<p>紧扣主题，先看负责控制台打印的方法。</p> 
<pre><code class="prism language-java">	<span class="token class-name">Banner</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> sourceClass<span class="token punctuation">,</span> <span class="token class-name">PrintStream</span> out<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">Banner</span> banner <span class="token operator">=</span> <span class="token function">getBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">;</span>
		banner<span class="token punctuation">.</span><span class="token function">printBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> sourceClass<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">PrintedBanner</span><span class="token punctuation">(</span>banner<span class="token punctuation">,</span> sourceClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>代码很精简，第一行获取<code>Banner</code>类，第二行调用<code>Banner</code>的<code>print</code>方法打印banner图案，最后生成<code>PrintedBanner</code>并返回。</p> 
<hr> 
<p><strong>1. getBanner</strong></p> 
<p><strong>getBanner源码</strong></p> 
<pre><code class="prism language-java"> <span class="token keyword">private</span> <span class="token class-name">Banner</span> <span class="token function">getBanner</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token class-name">Banners</span> banners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Banners</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  banners<span class="token punctuation">.</span><span class="token function">addIfNotNull</span><span class="token punctuation">(</span><span class="token function">getImageBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  banners<span class="token punctuation">.</span><span class="token function">addIfNotNull</span><span class="token punctuation">(</span><span class="token function">getTextBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>banners<span class="token punctuation">.</span><span class="token function">hasAtLeastOneBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> banners<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>fallbackBanner <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>fallbackBanner<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> DEFAULT_BANNER<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>查看<code>getBanner</code>方法，首先创建<code>Banners</code>，底层就是<code>Banner</code>数组，由于存在控制台、日志两种打印方式，使用此类方便批量处理。</p> 
<p><strong>Banners源码</strong></p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * {@link Banner} comprised of other {@link Banner Banners}.
 */</span>
<span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Banners</span> <span class="token keyword">implements</span> <span class="token class-name">Banner</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Banner</span><span class="token punctuation">&gt;</span></span> banners <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">addIfNotNull</span><span class="token punctuation">(</span><span class="token class-name">Banner</span> banner<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>banner <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>banners<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>banner<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">boolean</span> <span class="token function">hasAtLeastOneBanner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>banners<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> sourceClass<span class="token punctuation">,</span> <span class="token class-name">PrintStream</span> out<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Banner</span> banner <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>banners<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            banner<span class="token punctuation">.</span><span class="token function">printBanner</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> sourceClass<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>接着就是调用<code>getImageBanner</code>和<code>getTextBanner</code>方法获取Banner，如果<code>Banner</code>数组不为空则返回，否则检查<code>fallbackBanner</code>。</p> 
<p>这个<code>fallbackBanner</code>光看名字看不出是什么，使用<code>CTRL+B</code>查看引用，发现是在<code>SpringApplication#printBanner</code>里注入进来的，如下图。<br> <img src="https://images2.imgbox.com/92/bf/4TUQ0VbV_o.png" alt="image"></p> 
<p>继续查找<code>this.banner</code>会发现，最终<code>Banner</code>只能通过<code>SpringApplicationBuilder#banner</code>注入。<br> <img src="https://images2.imgbox.com/98/28/269N8Yvp_o.png" alt="image"></p> 
<p><code>SpringApplicationBuilder</code>是通过Constructor(构造器)模式实现的<code>SpringApplication</code>构造器。<br> 查看<code>banner</code>方法的注释，我们可以知道这里注入的<code>Banner</code>实例会在<strong>没有静态banner文件时使用</strong>。<br> 回过头来，<code>fallbackBanner</code>的坑填上了，它是在<code>SpringApplicationBannerPrinter</code>找不到txt文件或者图片作为banner素材的时候使用。</p> 
<p>如果<code>fallbackBanner</code>也为空，则最终返回兜底方案-<code>SpringBootBanner</code>。</p> 
<p><code>getBanner</code>的结构分析完了，实际情况我们知道走的是兜底方案，也就是只要我们能让<code>getImageBanner</code>、<code>getTextBanner</code>或者<code>fallbackBanner</code>不为空，就能改变banner打印的图案。<br> 带着这个想法，我们就去看看<code>getImageBanner</code>和<code>getTextBanner</code>是咋回事。</p> 
<hr> 
<p><strong>2、getImageBanner</strong><br> 查看源码，首先<code>environment.getProperty</code>读取配置<code>spring.banner.image.location</code>获取图片位置。</p> 
<p>配置文件读取若为空则遍历图片后缀数组<code>IMAGE_EXTENSION</code>，采用<code>"banner." + ext</code>拼接方式得到图片相对路径，并尝试加载。加载成功后会生成<code>ImageBanner</code>并返回。</p> 
<p>接收图片资源并处理打印的逻辑都封装在<code>ImageBanner</code>中，后续单独写一篇文章尝试分析图片打印逻辑。</p> 
<p>按照我们的分析，只要在配置文件中添加<code>spring.banner.image.location</code>并赋值正确的图片路径，或者在resources目录下存放一张名字为“banner”、后缀是<code>gif,jpg, png</code>其中之一的图片，<code>SpringApplicationBannerPrinter</code>就会打印出来。<br> <strong>注：</strong> 为什么没加前缀<code>classpath:</code>也可以放在resources目录下，可以查看<code>DefaultResourceLoader#getResource</code>对于<code>banner.jpg</code>这种location的处理逻辑。</p> 
<p>后续章节会有打印效果。</p> 
<p><strong>getImageBanner源码</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">Banner</span> <span class="token function">getImageBanner</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> location <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>BANNER_IMAGE_LOCATION_PROPERTY<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> resource<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">new</span> <span class="token class-name">ImageBanner</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">String</span> ext <span class="token operator">:</span> IMAGE_EXTENSION<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span><span class="token string">"banner."</span> <span class="token operator">+</span> ext<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ImageBanner</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<hr> 
<p><strong>3、getTextBanner</strong><br> 查看源码，同样是先从配置文件中读取banner文件的location并尝试加载资源，和<code>getImageBanner</code>不同的是，这里读取不到会使用默认值<code>banner.txt</code>。</p> 
<p>加载资源后有一个<code>Resource</code>的限制条件<code>!resource.getURL().toExternalForm().contains("liquibase-core")</code>，这里不明白这个条件的含义，只查询到了<code>Liquibase</code>是一个用于跟踪、管理和应用数据库变化的开源工具。</p> 
<p>资源校验通过后生成<code>ResourceBanner</code>并返回。</p> 
<p><strong>getTextBanner源码</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">Banner</span> <span class="token function">getTextBanner</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">String</span> location <span class="token operator">=</span> environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span>BANNER_LOCATION_PROPERTY<span class="token punctuation">,</span> DEFAULT_BANNER_LOCATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Resource</span> resource <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader<span class="token punctuation">.</span><span class="token function">getResource</span><span class="token punctuation">(</span>location<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>resource<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span>resource<span class="token punctuation">.</span><span class="token function">getURL</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toExternalForm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"liquibase-core"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ResourceBanner</span><span class="token punctuation">(</span>resource<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// Ignore</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>接下来进入<code>ResourceBanner</code>看下打印细节。<br> <code>printBanner</code>结构比较简单，第一部分设置banner字符集，优先读取配置<code>spring.banner.charset</code>，无配置则默认设置为<code>UTF-8</code>。<br> 第二部分去解析banner字符，比如将<code>${xxx}</code>占位符解析成实际的值。<br> 第三部分就是调用流打印输出。</p> 
<p><strong>ResourceBanner#printBanner</strong></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token class-name">Environment</span> environment<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> sourceClass<span class="token punctuation">,</span> <span class="token class-name">PrintStream</span> out<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 设置banner字符集</span>
        <span class="token class-name">String</span> banner <span class="token operator">=</span> <span class="token class-name">StreamUtils</span><span class="token punctuation">.</span><span class="token function">copyToString</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                environment<span class="token punctuation">.</span><span class="token function">getProperty</span><span class="token punctuation">(</span><span class="token string">"spring.banner.charset"</span><span class="token punctuation">,</span> <span class="token class-name">Charset</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">StandardCharsets</span><span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">// 解析banner</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PropertyResolver</span> resolver <span class="token operator">:</span> <span class="token function">getPropertyResolvers</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> sourceClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            banner <span class="token operator">=</span> resolver<span class="token punctuation">.</span><span class="token function">resolvePlaceholders</span><span class="token punctuation">(</span>banner<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>banner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        logger<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token class-name">LogMessage</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"Banner not printable: %s (%s: '%s')"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resource<span class="token punctuation">,</span> ex<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                ex<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<br> 
<h4><a id="bannerSpringApplication_286"></a>banner打印调用方-SpringApplication</h4> 
<p>上节看完<code>SpringApplicationBannerPrinter</code>，这节来寻找打印banner的调用方。</p> 
<p><code>CTRL+B</code>查看<code>SpringApplicationBannerPrinter#print</code>的引用，定位到了<code>SpringApplication#printBanner</code>。源码如下。</p> 
<p>从整体结构来看，<code>printBanner</code>方法根据<code>this.bannerMode</code>取值不同，执行不同的打印策略：不打印、打印到日志、打印到控制台。</p> 
<blockquote> 
 <p>那么这个<code>bannerMode</code>是怎么设置的？查看初始化的代码，默认值是<code>CONSOLE</code>。<br> <img src="https://images2.imgbox.com/bc/75/L2NMWh5i_o.png" alt="image"><br> 继续寻找，最终定位到了<code>SpringApplicationBuilder#bannerMode</code>，意味着<code>bannerMode</code>只能通过构造器进行注入。</p> 
</blockquote> 
<p>继续寻找<code>printBanner</code>的调用方，定位到了<code>SpringApplication#run(String...)</code>。</p> 
<p>上面有提到过，通常我们SpringBoot项目都是去调用<code>SpringApplication#run(Class&lt;?&gt;, String...)</code>去启动项目，底层是通过<code>new</code>关键字创建<code>SpringApplication</code>对象，最后调用<code>SpringApplication#run(String...)</code>完成一系列的资源初始化。</p> 
<p>所以这就可以解释大多数情况下，我们的SpringBoot项目启动时都会打印那个默认的“Spring”字符。</p> 
<p><strong>SpringApplication#printBanner源码</strong></p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token class-name">Banner</span> <span class="token function">printBanner</span><span class="token punctuation">(</span><span class="token class-name">ConfigurableEnvironment</span> environment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bannerMode <span class="token operator">==</span> <span class="token class-name">Banner<span class="token punctuation">.</span>Mode</span><span class="token punctuation">.</span>OFF<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token class-name">ResourceLoader</span> resourceLoader <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourceLoader
            <span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">DefaultResourceLoader</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">SpringApplicationBannerPrinter</span> bannerPrinter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SpringApplicationBannerPrinter</span><span class="token punctuation">(</span>resourceLoader<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>banner<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>bannerMode <span class="token operator">==</span> <span class="token class-name">Mode</span><span class="token punctuation">.</span>LOG<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> bannerPrinter<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass<span class="token punctuation">,</span> logger<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> bannerPrinter<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span>environment<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>mainApplicationClass<span class="token punctuation">,</span> <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<br> 
<h3><a id="banner_322"></a>如何修改项目启动的banner</h3> 
<h4><a id="banner_323"></a>修改banner打印策略</h4> 
<p>经上分析，banner打印策略包括<strong>控制台</strong>、<strong>日志</strong>、<strong>不打印</strong>。</p> 
<p><strong>1. 隐式</strong><br> 默认策略是<code>控制台</code>，只需大多数情况一样，项目启动类通过<code>SpringApplication.run(DistinctAppUserServiceApplication.class, args);</code>启动，无需指定。</p> 
<p><strong>2. 显式注入</strong><br> 通过<code>SpringApplicationBuilder</code>构造器显式注入banner打印策略。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DemoApplication</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">new</span> <span class="token class-name">SpringApplicationBuilder</span><span class="token punctuation">(</span><span class="token class-name">DemoApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
		<span class="token comment">// Banner.Mode.LOG 打印到日志</span>
		<span class="token comment">// Banner.Mode.OFF 不打印</span>
                <span class="token punctuation">.</span><span class="token function">bannerMode</span><span class="token punctuation">(</span><span class="token class-name">Banner<span class="token punctuation">.</span>Mode</span><span class="token punctuation">.</span>CONSOLE<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>打印效果</strong><br> 打印到控制台<br> <img src="https://images2.imgbox.com/db/5d/o3B4jn4S_o.png" alt="image"></p> 
<p>打印到日志：<code>INFO</code>级别<br> <img src="https://images2.imgbox.com/f6/8e/hnm3PhZI_o.png" alt="image"></p> 
<h4><a id="banner_352"></a>修改banner内容</h4> 
<h5><a id="_353"></a>文本</h5> 
<p>方式一：在<code>src/main/resources</code>下新建<code>banner.txt</code>，里面放入想要打印的内容即可。</p> 
<p>方式二：修改配置文件</p> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">banner</span><span class="token punctuation">:</span>
    <span class="token key atrule">location</span><span class="token punctuation">:</span> file/bannerText.txt <span class="token comment">#文件位置 src/main/resources/file/bannerText.txt</span>
</code></pre> 
<blockquote> 
 <p>内容生成网站<br> 文字转换成符号：http://patorjk.com/software/taag<br>                            http://life.chacuo.net/convertfont2char<br> 图片转换成符号：https://www.bootschool.net/ascii-art</p> 
</blockquote> 
<h5><a id="_367"></a>图片</h5> 
<p>和文本方式相同，但是图片类型有限制，只能是以下三种<code>gif,、jpg、png</code>。<br> 方式一：在<code>src/main/resources</code>下新建<code>banner.png</code>，里面放入想要打印的内容即可。</p> 
<p>方式二：修改配置文件</p> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">banner</span><span class="token punctuation">:</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span>
      <span class="token key atrule">location</span><span class="token punctuation">:</span> file/bannerImage.png <span class="token comment">#文件位置 src/main/resources/file/bannerImage.png</span>
</code></pre> 
<p><strong>打印效果</strong><br> <img src="https://images2.imgbox.com/be/2b/bbEjwVLx_o.png" alt="image"></p> 
<h3><a id="_382"></a>后语</h3> 
<p>本篇文章干货不多，主要记录探究问题的心路历程，锻炼文笔，若观看文章过程有任何不适，敬请斧正。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c7d436d9b2c5a5eb7cf7d2c98c8351ff/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【华为云-玩转云耀云服务器HECS】使用HECS搭建WordPress博客平台</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f5cfec357d3c8c8139731607c9c5518d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">shell查看进程指令</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>