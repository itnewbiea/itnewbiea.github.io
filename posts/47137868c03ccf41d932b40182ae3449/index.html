<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ubuntu16 PL-SLAM编译 踩坑 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ubuntu16 PL-SLAM编译 踩坑" />
<meta property="og:description" content="首先贴出pl-slam readme的第一句话：对pl-slam的精度不要有太高要求。 Notice that this repository is only an open-source version of PL-SLAM released with the aim of being useful for the community, however, it is far from being optimized and we are not including some features of PL-SLAM.
stvo-pl plsvo plslam 保存轨迹 完整ref： https://zhuanlan.zhihu.com/p/157900327 apt-get安装依赖 yaml 出现 ros路径下的yaml/init.py中 不存在import error问题：
取消anaconda的环境路径后，就没有问题了
编译安装wxwidgets-2.8: opengl library not available， 无法找到opengl的GL和mesa库，无法完成编译。
采用apt-get下载的wxWidgets2.8库： 完成了mrpt-stvo-pl和plslam的编译，单运行时候出现，ABI 1004编译的情况与现在的编译(c&#43;&#43; ABI 1009)不符合，没有找到解决办法，于是
于是autoremove 卸载了 和libwxWidgets-dev有关的库 编译安装wxwidgets-3.1: 在make mrpt时候出现error 修改script_opencv选择 opencv344" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/47137868c03ccf41d932b40182ae3449/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-18T00:02:59+08:00" />
<meta property="article:modified_time" content="2020-02-18T00:02:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ubuntu16 PL-SLAM编译 踩坑</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>首先贴出pl-slam readme的第一句话：对pl-slam的精度不要有太高要求。</h4> 
<p>Notice that this repository is only an open-source version of PL-SLAM released with the aim of being useful for the community, however, it is far from being optimized and we are not including some features of PL-SLAM.</p> 
<p> </p> 
<h4>stvo-pl  plsvo  plslam 保存轨迹 完整ref：</h4> 
<h4><a href="https://zhuanlan.zhihu.com/p/157900327" rel="nofollow">https://zhuanlan.zhihu.com/p/157900327</a></h4> 
<p> </p> 
<h4>apt-get安装依赖</h4> 
<h4>yaml  </h4> 
<p>出现 ros路径下的yaml/init.py中 不存在import error问题：</p> 
<p>取消anaconda的环境路径后，就没有问题了</p> 
<p> </p> 
<h4>编译安装wxwidgets-2.8:</h4> 
<p>opengl library not available， 无法找到opengl的GL和mesa库，无法完成编译。</p> 
<h4>采用apt-get下载的wxWidgets2.8库：</h4> 
<p>完成了mrpt-stvo-pl和plslam的编译，单运行时候出现，ABI 1004编译的情况与现在的编译(c++ ABI 1009)不符合，没有找到解决办法，于是</p> 
<p>于是autoremove 卸载了 和libwxWidgets-dev有关的库 </p> 
<p> </p> 
<h4>编译安装wxwidgets-3.1: 在make mrpt时候出现error</h4> 
<p>修改script_opencv选择 opencv344</p> 
<p>选择wxWidgets3.1 但是无法找到</p> 
<p>查看了cmakemodules/ script_wxWidgets.cmake, 按照cmake中find_package的原理，这里优先采用mudule模式，在当前的cmakemodules文件夹和/usr/share/cmake-3.5/Module中寻找FindwxWidgets.cmake，由于没有wxWidgets-config.cmake或者wxWidgetsConfig.cmake，故不能采用config模式进行find_package，通过</p> 
<p>打开查看FindwxWidgets.cmake，用message("...，${...} ")输出查看变量，发现会通过一个/usr/bin/wx-config的可执行文件获取cxx_flags准备查找合适版本的wx库，判断这个wx-config可能是之前安装wxWidgets2.8留下的，导致出现的问题。</p> 
<p>发现/usr/bin/wx-config根本不存在</p> 
<p>运行locate wx-config</p> 
<p>/home/lincent/slam_sota/pl_slam/wxWidgets-3.1.2/wx-config<br> /home/lincent/slam_sota/pl_slam/wxWidgets-3.1.2/wx-config-inplace.in<br> /home/lincent/slam_sota/pl_slam/wxWidgets-3.1.2/wx-config.in<br> /usr/local/bin/wx-config<br> 把这个拷贝到/usr/bin 下面一份 ，解决</p> 
<p>再次cmake报错：</p> 
<p>_filename, /usr/include/wx-2.8/wx/version.h<br> CMake Error at /usr/share/cmake-3.5/Modules/FindwxWidgets.cmake:880 (file):<br>   file failed to open for reading (No such file or directory):</p> 
<p>    /usr/include/wx-2.8/wx/version.h<br> Call Stack (most recent call first):<br>   cmakemodules/script_wxwidgets.cmake:32 (FIND_PACKAGE)<br>   CMakeLists.txt:257 (include)<br> 解决：</p> 
<p>/usr/include/wx-2.8/wx/version.h这个文件不存在</p> 
<p>在880行自己设置一下：</p> 
<p>  SET(_filename "${wxWidgets_INCLUDE_DIRS}/wx/version.h")</p> 
<h4>安装mrpt</h4> 
<h4>stvo-pl</h4> 
<h4>pl-slam</h4> 
<p>配置数据集，</p> 
<p>在bashrc写数据集的环境变量</p> 
<p>运行</p> 
<p>Options:<br> -c Config file<br> -o Offset (number of frames to skip in the dataset directory<br> -n Number of frames to process the sequence<br> -s Parameter to skip s-1 frames (default 1)<br> A full command would be:<br> ./plslam_dataset kitti/00 -c ../config/config_kitti.yaml -o 100 -s 2 -n 1000<br>  </p> 
<pre><code>./plslam_dataset /KITTI/07 -c ../config/config/config_kitti.yaml -n 1100
// 1101 段错误
</code></pre> 
<h4>plslam: 为了保存轨迹txt</h4> 
<p>在plslam/src/slamScene.cpp 251行  bool slamScene::updateScene()中 增加：  并开头增加头文件&lt;fstream&gt;</p> 
<pre><code>ofstream f;
    f.open("../pl_pose.txt", ios::app);
    f &lt;&lt; fixed;
    Eigen::Vector3d poseTran;
    Eigen::Vector3d t(pose.x(), pose.y(), pose.z());
    poseTran = t;
 
    Eigen::Matrix3d rotMat = pose.getRotationMatrix();
    Eigen::Quaterniond poseQuat(rotMat);

    f &lt;&lt; setprecision(7)\
    &lt;&lt; rotMat(0,0) &lt;&lt; " " &lt;&lt; rotMat(0,1) &lt;&lt; " " &lt;&lt; rotMat(0,2) &lt;&lt; " " &lt;&lt; poseTran.x() &lt;&lt; " " \
    &lt;&lt; rotMat(1,0) &lt;&lt; " " &lt;&lt; rotMat(1,1) &lt;&lt; " " &lt;&lt; rotMat(1,2) &lt;&lt; " " &lt;&lt; poseTran.y() &lt;&lt; " " \
    &lt;&lt; rotMat(2,0) &lt;&lt; " " &lt;&lt; rotMat(2,1) &lt;&lt; " " &lt;&lt; rotMat(2,2) &lt;&lt; " " &lt;&lt; poseTran.z() &lt;&lt; endl;
    f &lt;&lt; flush;
    f.close(); </code></pre> 
<pre><code>//重新编译
cd build; make </code></pre> 
<p>补充：这样保存后看了07的轨迹，发现完全没有回环的痕迹，查看代码流程可以发现，这里保存的是stvo的每一帧位姿，没有经过全局优化和回环检测。</p> 
<p>所以这里需要重新看一下</p> 
<p> </p> 
<p>在 plslam/src/slamScene.cpp 807行updateSceneGraphs( const MapHandler* map )函数 增加在全局优化后的关键帧位姿保存，如下</p> 
<pre><code>ofstream f;
    f.open("../plslam_keyframe_pose.txt", ios::out);
    f &lt;&lt; fixed;
    for( vector&lt;KeyFrame*&gt;::const_iterator it = map-&gt;map_keyframes.begin(); it!=map-&gt;map_keyframes.end(); it++)
    {
        if( (*it)!=NULL )
        {
            Eigen::Matrix4d rotMat= (*it)-&gt;T_kf_w;
            f &lt;&lt; setprecision(7)\
            &lt;&lt; rotMat(0,0) &lt;&lt; " " &lt;&lt; rotMat(0,1) &lt;&lt; " " &lt;&lt; rotMat(0,2) &lt;&lt; " " &lt;&lt; rotMat(0,3) &lt;&lt; " " \
            &lt;&lt; rotMat(1,0) &lt;&lt; " " &lt;&lt; rotMat(1,1) &lt;&lt; " " &lt;&lt; rotMat(1,2) &lt;&lt; " " &lt;&lt; rotMat(1,3) &lt;&lt; " " \
            &lt;&lt; rotMat(2,0) &lt;&lt; " " &lt;&lt; rotMat(2,1) &lt;&lt; " " &lt;&lt; rotMat(2,2) &lt;&lt; " " &lt;&lt; rotMat(2,3) &lt;&lt; endl;
            f &lt;&lt; flush;
        }
    }
    f.close(); </code></pre> 
<p> </p> 
<p>问题：</p> 
<p>pl-slam在kitti 07的1067帧 段错误停止</p> 
<p>很玄学。。偶尔的 ， 加了cout没事了又</p> 
<p> </p> 
<h4>同样的道理，可以直接运行stvo-pl。</h4> 
<pre><code>./imagesStVO /KITTI/07 -c ../config/config/config_kitti.yaml -n 1100
</code></pre> 
<h4>在bool sceneRepresentation::updateScene(list&gt; matched_pt, list&gt; matched_ls )函数内部，pose = pose + x_aux;（513行左右）及初始化部分后添加上面相同的代码：（注意，必须保证每次更新轨迹时trajout.txt不存在或者为空）</h4> 
<h4> </h4> 
<h4>问题：</h4> 
<p>偶尔启动出现段错误，重新运行就好，原因未知</p> 
<p><strong>跑数据集中途弹出，显示内存不足。</strong><br> 解决办法：把mrpt、plslam编译为debug模式<br>   1）对于mrpt，cmake mrpt时使用 cmake -DCMAKE_BUILD_TYPE=DEBUG ..<br>   2）对于plslam，需要在IDE中</p> 
<p>注意：同时需要将~/config文件夹内的kitti00-02.yaml复制到/home/xxx/Desktop/data/kitti/00，并修改其名为dataset_params.yaml（读程序plslam_dataset.cpp可知原因.）<br> 如果你的数据集图片文件夹名字有区别，请做相应修改.（灰度图片为image_0和image_1，去kitti00-02.yaml内修改.） </p> 
<p><strong>Invalid vocabulary for points</strong><br>  vocabulary路径问题<br> 解决办法：找到这个pl-slam/src/slamConfig.cpp，把里面的 vocabulary_p 和 vocabulary_l 换成你自己的路径。</p> 
<p><strong>为什么我在ubuntu中删除一个文件夹后，还能用locate找到它：</strong></p> 
<p>sudo updatedb 更新即可</p> 
<p><strong>编译mrpt时候采用了opencv344,但是有一些关于opencv2/core/type_c.h的opencv源代码的错误，考虑可能是opencv版本太高</strong></p> 
<p><strong>于是用ros的opencv3.3.1重新编译mrpt，stvo-pl，pl-slam都顺利通过</strong></p> 
<p>备注：造成问题的原因是ximgproc模块在opencv的扩展模块opencv_contrib中，opencv在3.2版本之后引入了ximgproc模块，模块主要进行线特征的操作（分割，提取）。</p> 
<p><strong>cmake原理以及find_package：</strong></p> 
<p><a href="https://blog.csdn.net/sen873591769/article/details/90183015">https://blog.csdn.net/sen873591769/article/details/90183015</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03faa82f26f03d6e03b686ab3c079143/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">RESLAM/ REVO 编译  实时RGBD基于边缘的slam系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c51dd14a9a9366c6f8f09737d88efde2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">重定向</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>