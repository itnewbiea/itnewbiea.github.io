<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何给TWaver中的Node对象加右键菜单项 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何给TWaver中的Node对象加右键菜单项" />
<meta property="og:description" content="选中树节点，多出一个按钮，可以用tree.iconsComponentsFunction（用法参考AlarmMappingDemo）。 菜单用Menu.createMenu（用法参考Flex如何定制Menu的Icon） 如果右键点击树节点时，让此节点选中最好，不过现在还没有通过ContextMenuEvent或者MouseEvent获得TreeData的方法，可以考虑先自己继承twaver.Tree，添加如下方法（TWaver Flex 1.5版本将添加）： 代码: public function getTreeDataByContextMenuEvent(event:ContextMenuEvent):TreeData{ var itemRenderer:IListItemRenderer; var target:DisplayObject = event.mouseTarget; while (target &amp;&amp; target != this) { if (target is IListItemRenderer &amp;&amp; target.parent == listContent) { if (target.visible) { itemRenderer = IListItemRenderer(target); } break; } if (target is IUIComponent){ target = IUIComponent(target).owner; } else { target = target.parent; } } if(itemRenderer != null){ return this.getTreeDataByIndex(this.itemRendererToIndex(itemRenderer)); } return null; } public function getTreeDataByMouseEvent(event:MouseEvent):TreeData{ var itemRenderer:IListItemRenderer = this." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d388f8b9c500b6fe6d2ed74874de95fc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2011-05-04T00:51:35+08:00" />
<meta property="article:modified_time" content="2011-05-04T00:51:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何给TWaver中的Node对象加右键菜单项</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    选中树节点，多出一个按钮，可以用tree.iconsComponentsFunction（用法参考AlarmMappingDemo）。 
<br>菜单用Menu.createMenu（用法参考Flex如何定制Menu的Icon） 
<br> 
<br>如果右键点击树节点时，让此节点选中最好，不过现在还没有通过ContextMenuEvent或者MouseEvent获得TreeData的方法，可以考虑先自己继承twaver.Tree，添加如下方法（TWaver Flex 1.5版本将添加）： 
<br>代码: 
<br> public function getTreeDataByContextMenuEvent(event:ContextMenuEvent):TreeData{ 
<br> var itemRenderer:IListItemRenderer; 
<br> var target:DisplayObject = event.mouseTarget; 
<br> while (target &amp;&amp; target != this) { 
<br> if (target is IListItemRenderer &amp;&amp; target.parent == listContent) { 
<br> if (target.visible) { 
<br> itemRenderer = IListItemRenderer(target); 
<br> } 
<br> break; 
<br> } 
<br> 
<br> if (target is IUIComponent){ 
<br> target = IUIComponent(target).owner; 
<br> } else { 
<br> target = target.parent; 
<br> } 
<br> } 
<br> 
<br> if(itemRenderer != null){ 
<br> return this.getTreeDataByIndex(this.itemRendererToIndex(itemRenderer)); 
<br> } 
<br> return null; 
<br> } 
<br> 
<br> public function getTreeDataByMouseEvent(event:MouseEvent):TreeData{ 
<br> var itemRenderer:IListItemRenderer = this.mouseEventToItemRenderer(event); 
<br> if(itemRenderer != null){ 
<br> return this.getTreeDataByIndex(this.itemRendererToIndex(itemRenderer)); 
<br> } 
<br> return null; 
<br> } 
<br>默认Menu上的Icon必须通过iconField和iconFunction去指定，但是这两种方式都必须用嵌入资源Class名字去指定Icon，如果想用动态的图片（比如URL）作为Menu的Icon，就必须定制一把MenuItemRenderer。 
<br> 
<br> 
<br>首先写个类CustomMenuItemRenderer继承MenuItemRenderer，里面增加一个如下变量作为自定义Icon的组件： 
<br> 
<br>1 
<br>private var image:UIComponent = new UIComponent(); 
<br>然后里面重写measure方法（计算MenuItem的宽高）： 
<br> 
<br>01 
<br>override protected function measure():void { 
<br>02 
<br> super.measure(); 
<br>03 
<br> 
<br>04 
<br> if (separatorIcon || listData == null) { 
<br>05 
<br> return; 
<br>06 
<br> } 
<br>07 
<br> 
<br>08 
<br> var imageAsset:IImageAsset = Utils.getImageAsset(data.@iconName); 
<br>09 
<br> if(imageAsset == null){ 
<br>10 
<br> return; 
<br>11 
<br> } 
<br>12 
<br> measuredWidth += imageAsset.width; 
<br>13 
<br> if(imageAsset.height &gt; measuredHeight){ 
<br>14 
<br> measuredHeight = imageAsset.height; 
<br>15 
<br> } 
<br>16 
<br>} 
<br>重写commitProperties方法（重画并增加Icon，指定Icon宽高）： 
<br> 
<br>查看源代码打印帮助 
<br> 
<pre><code class="language-java">override protected function commitProperties():void {<!-- --><br>	super.commitProperties();<br><br>	if (separatorIcon || listData == null) {<!-- --><br>		return;<br>	}<br><br>	var imageAsset:IImageAsset = Utils.getImageAsset(data.@iconName);<br>	if(imageAsset == null){<!-- --><br>		return;<br>	}<br>	image.width = imageAsset.width;<br>	image.height = imageAsset.height;<br>	image.graphics.beginBitmapFill(imageAsset.getBitmapData());<br>	image.graphics.drawRect(0, 0, image.width, image.height);<br>	image.graphics.endFill();<br>	if(!this.contains(image)){<!-- --><br>		this.addChild(image);<br>	}<br>}<br></code></pre> 
<br>重写updateDisplayList方法（指定Icon的位置，由于Icon在左边，所以super一把后，再移动Labe等的位置）： 
<pre><code class="language-java">override protected function updateDisplayList(unscaledWidth:Number, unscaledHeight:Number):void{<!-- --><br>	super.updateDisplayList(unscaledWidth, unscaledHeight);<br><br>	if (separatorIcon || listData == null) {<!-- --><br>		return;<br>	}<br><br>	var imageAsset:IImageAsset = Utils.getImageAsset(data.@iconName);<br>	if(imageAsset == null){<!-- --><br>		return;<br>	}<br>	if(typeIcon){<!-- --><br>		typeIcon.x += imageAsset.width;<br>	}<br>	if(label){<!-- --><br>		label.x += imageAsset.width;<br>	}<br>}<br></code></pre> 
<br>重写measuredIconWidth方法（计算Icon的宽度）：[code="java"][/code] 
<br>1 
<br>override public function get measuredIconWidth():Number { 
<br>2 
<br> var imageAsset:IImageAsset = Utils.getImageAsset(data.@iconName); 
<br>3 
<br> if(imageAsset == null){ 
<br>4 
<br> return 0 ; 
<br>5 
<br> }else{ 
<br>6 
<br> var horizontalGap:Number = getStyle("horizontalGap"); 
<br>7 
<br> return imageAsset.width + horizontalGap; 
<br>8 
<br> } 
<br>9 
<br>} 
<br>最后用自定义的CustomMenuItemRenderer指定Menu的ItemRenderer，注意使用iconName指定icon的名字（这里为TWaver注册图片的名字）。也可以用别的名字，注意把CustomMenuItemRenderer里面的@iconName换一下 
<br> 
<br>1 
<br>var menu:Menu = Menu.createMenu(network, myMenuData, false); 
<br>2 
<br>menu.labelField = "@label"; 
<br>3 
<br>menu.itemRenderer = new ClassFactory(CustomMenuItemRenderer); 
<br>4 
<br>var point:Point = network.getLogicalPoint(event.mouseEvent); 
<br>5 
<br>network.callLater(function():void{ 
<br>6 
<br> menu.show(point.x, point.y); 
<br>7 
<br>}); 
<br>指定Menu数据的XML文件如下： 
<br> 
<br>查看源代码打印帮助 
<br>01 
<br> &lt;mx:XML format="e4x" id="myMenuData"&gt; 
<br>02 
<br> &lt;root&gt; 
<br>03 
<br> &lt;menuitem label="www.servasoftware.com" iconName="databox_icon"&gt; 
<br>04 
<br> &lt;menuitem label="TWaver" type="check" toggled="true"&gt; 
<br>05 
<br> &lt;menuitem label="Java" type="radio" groupName="one"/&gt; 
<br>06 
<br> &lt;menuitem label="Web" type="radio" groupName="one" toggled="true"/&gt; 
<br>07 
<br> &lt;menuitem label="Flex" type="radio" groupName="one" iconName="bus_icon"/&gt; 
<br>08 
<br> &lt;menuitem label="Silverlight" type="radio" groupName="one"/&gt; 
<br>09 
<br> &lt;/menuitem&gt; 
<br>10 
<br> &lt;menuitem type="separator"/&gt; 
<br>11 
<br> &lt;menuitem label="2BizBox" iconName="data_icon"/&gt; 
<br>12 
<br> &lt;/menuitem&gt; 
<br>13 
<br> &lt;menuitem label="www.2bizbox.com"/&gt; 
<br>14 
<br> &lt;menuitem label="twaver.servasoft.com"/&gt; 
<br>15 
<br> &lt;/root&gt; 
<br>16 
<br> &lt;/mx:XML&gt; 
<br>17 
<br>&lt;/code&gt; 
<br>源代码见TWa
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/466d970e8689d69617d7257fdb2b4d76/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">TWaver中的Node对象加右键菜单项</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0e9afa72af9b91e4c129026e92f91ba7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">窗口置顶,并且屏蔽系统按键</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>