<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[浅析]UE4材质基础总结 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[浅析]UE4材质基础总结" />
<meta property="og:description" content="图形学基础知识 除了自发光物体，成像皆由视网膜接收物体各尺度平面反射的光线构成
光照效果一般可分为漫反射和镜面反射（高光）两部分
漫反射：凹凸不平的表面反射的没有方向性的光
镜面反射：若反射面比较光滑，当平行入射的光线射到这个反射面时，仍会平行地向一个方向反射出来
光源照射物体时，将会与物体产生多种交互现象，反馈大致为：
光源到达物体表面时、物体原子会将光子部分吸收partially absorbed，能量守恒转化为热能，反射的部分较弱；且根据折射率具有不同角度微平面散射scattered，
穿透的部分将会产生折射Refraction、次表面散射Subsurface Scattering、半透明透射Transmission，
经过散射、微平面镜面反射的部分，称为 漫反射Diffuse，
被相对镜面反射，称为 镜面反射Specular
材质和材质实例概念 材质实例由材质继承而来，对父材质外观的参数化
游戏里只有父体材质会被编译，材质实例可降低渲染开销，在场景中高速渲染和实时反馈
材质资产为绿色，实例深绿色
材质中右键节点转换参数后创建实例，实例中产生配置参数，勾选后可设置
层级可以查看继承层级关系，可以直接定位到材质查看图表和细节面板，实例只有参数可配
动态材质实例概念 参数化的材质 &#43; 蓝图 = 动态材质实例
作用：在游戏运行中动态改变材质，如角色走进某个范围后某个物体切换随机颜色，或自发光等效果
蓝图继承自Actor，构造脚本中create dynamic material，并保存动态材质的变量引用
事件图表
set vector parameter value： 按材质的参数名设置值
材质细节面板关键参数 物理材质
关联的物理材质，如碰撞产生的弹力将保留多少能力，不影响外观
应用：不同材质类型，不同反馈的实现
如：角色踩在不同材质上发出不同音效（射线检测 &#43; 物理材质）
又如：子弹击中不同材质产生不同特效和音效（hitEvent &#43; 物理材质）
材质域
材质的作用类型：会影响节点基础参数
表面材质域时，可设置用途Usage, 标记可控制材质应用对象的类型，引擎为每个应用程序编译特殊版本
如结合骨架网格体使用，结合粒子spirate使用等
混合模式
不透明（最常用）
遮罩Mask（部分固体可见部分不可见，如铁丝网围栏等）
细节面板参数：不透明蒙版剪切值
半透明（如玻璃类材质等）
纹理
即：材质贴图
着色模型
默认光照，大部分实心物体
次表面，如冰
预整合皮肤，用于人类皮肤
双面植物，如树上的树叶
毛发，用于逼真的头发材质
布料，用于逼真的布料和绒毛
眼睛，用于人类眼睛
双面，用于植物（法线将被翻转到背面，同时计算正面和背面的光照）
from材质表达式，用于单一材质处理多个着色模型
[注] 混合模式和着色模型详见官方文档：图形和渲染 - 材质 - 材质属性 材质属性|虚幻引擎文档" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9358bbdb6226f02e6c7512bd7a85fa8d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-09-03T10:43:53+08:00" />
<meta property="article:modified_time" content="2021-09-03T10:43:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[浅析]UE4材质基础总结</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>图形学基础知识</h3> 
<p>除了自发光物体，成像皆由视网膜接收物体各尺度平面反射的光线构成</p> 
<p>光照效果一般可分为漫反射和镜面反射（高光）两部分</p> 
<p>漫反射：凹凸不平的表面反射的没有方向性的光</p> 
<p>镜面反射：若反射面比较光滑，当平行入射的光线射到这个反射面时，仍会平行地向一个方向反射出来</p> 
<p><img src="https://images2.imgbox.com/d9/4b/7thAtzjV_o.jpg" alt="请添加图片描述"><br> 光源照射物体时，将会与物体产生多种交互现象，反馈大致为：</p> 
<p>光源到达物体表面时、物体原子会将光子<strong>部分吸收partially absorbed</strong>，能量守恒转化为热能，反射的部分较弱；且根据折射率具有不同角度微平面<strong>散射scattered</strong>，</p> 
<p>穿透的部分将会产生<strong>折射Refraction</strong>、<strong>次表面散射Subsurface Scattering</strong>、<strong>半透明透射Transmission</strong>，</p> 
<p>经过散射、微平面镜面反射的部分，称为 <strong>漫反射Diffuse</strong>，</p> 
<p>被相对镜面反射，称为 <strong>镜面反射Specular</strong></p> 
<h3><a id="_22"></a>材质和材质实例概念</h3> 
<p>材质实例由材质继承而来，对父材质外观的<strong>参数化</strong></p> 
<p>游戏里只有父体材质会被编译，材质实例可<strong>降低渲染开销</strong>，在场景中高速渲染和实时反馈</p> 
<p>材质资产为绿色，实例<strong>深绿色</strong></p> 
<p>材质中右键节点<strong>转换参数</strong>后创建实例，实例中产生配置参数，勾选后可设置</p> 
<p><strong>层级</strong>可以查看继承层级关系，可以直接定位到材质查看图表和细节面板，实例只有参数可配</p> 
<h3><a id="_36"></a>动态材质实例概念</h3> 
<p><strong>参数化的材质 + 蓝图 = 动态材质实例</strong></p> 
<p>作用：在游戏运行中动态改变材质，如角色走进某个范围后某个物体切换随机颜色，或自发光等效果</p> 
<p>蓝图继承自Actor，构造脚本中<strong>create dynamic material</strong>，并保存动态材质的变量引用</p> 
<p>事件图表</p> 
<p><strong>set vector parameter value</strong>： 按材质的参数名设置值</p> 
<h3><a id="_48"></a>材质细节面板关键参数</h3> 
<p><strong>物理材质</strong></p> 
<p>关联的物理材质，如碰撞产生的弹力将保留多少能力，不影响外观</p> 
<p>应用：<strong>不同材质类型，不同反馈的实现</strong></p> 
<p>如：角色踩在不同材质上发出不同音效（<strong>射线检测 + 物理材质</strong>）</p> 
<p>又如：子弹击中不同材质产生不同特效和音效（<strong>hitEvent + 物理材质</strong>）</p> 
<p><strong>材质域</strong></p> 
<p>材质的作用类型：会影响节点基础参数</p> 
<p>表面材质域时，<strong>可设置用途Usage</strong>, 标记可控制材质应用对象的类型，引擎为每个应用程序编译特殊版本</p> 
<p>如结合骨架网格体使用，结合粒子spirate使用等</p> 
<p><strong>混合模式</strong></p> 
<p>不透明（最常用）</p> 
<p>遮罩Mask（部分固体可见部分不可见，如铁丝网围栏等）</p> 
<p>细节面板参数：不透明蒙版剪切值</p> 
<p>半透明（如玻璃类材质等）</p> 
<p><strong>纹理</strong></p> 
<p>即：材质贴图</p> 
<p><strong>着色模型</strong></p> 
<p>默认光照，大部分实心物体</p> 
<p>次表面，如冰</p> 
<p>预整合皮肤，用于人类皮肤</p> 
<p>双面植物，如树上的树叶</p> 
<p>毛发，用于逼真的头发材质</p> 
<p>布料，用于逼真的布料和绒毛</p> 
<p>眼睛，用于人类眼睛</p> 
<p>双面，用于植物（法线将被翻转到背面，同时计算正面和背面的光照）</p> 
<p>from材质表达式，用于单一材质处理多个着色模型</p> 
<p>[注] 混合模式和着色模型详见官方文档：图形和渲染 - 材质 - 材质属性 <a href="https://docs.unrealengine.com/zh-CN/RenderingAndGraphics/Materials/MaterialProperties/index.html" rel="nofollow">材质属性|虚幻引擎文档</a></p> 
<h3><a id="PBRPhysically_based_rendering_106"></a>PBR基础(Physically based rendering)</h3> 
<p>模拟物理表面特性的参数化</p> 
<p>PBR可以根据环境光照的反射呈现不同效果</p> 
<p><strong>UE4中有两种工作流</strong>，第一种更常用，参数含义详见后一部分</p> 
<p><strong>金属粗糙度工作流（Metal – Roughness Workflow）节点</strong>：BaseColor基色、Roughness粗糙度、Metallic金属度</p> 
<p><strong>反射光泽度工作流（Specular – Glossiness Workflow）节点</strong>：Diffuse漫反射、Glossiness光泽度、Specular镜面反射</p> 
<p>上述两种工作流的公共常用参数：AO环境光遮蔽、Normal法线</p> 
<h3><a id="_122"></a>材质节点基础参数</h3> 
<p><strong>BaseColor基础色</strong>（PBR工作流1）</p> 
<p>材质固有色</p> 
<p>Constant4Vector设置，4维向量RGBA （快捷键4）</p> 
<p><strong>Metallic金属性</strong>（PBR工作流1）</p> 
<p>镜面反射与漫反射的光线占比，值越大镜面反射越多，越接近金属</p> 
<p>值限定在0-1， 一般不会取中间值</p> 
<p><strong>Roughness粗糙度</strong>（PBR工作流1）</p> 
<p>材质表面的粗糙程度</p> 
<p>值限定在0~1，越粗糙材质漫反射越明显，向更多方向反射</p> 
<p><strong>Diffuse漫反射</strong>（PBR工作流2）</p> 
<p>定义漫反射</p> 
<p><strong>Specular高光度</strong>（PBR工作流2）</p> 
<p>定义镜面反射</p> 
<p>和Diffuse共同决定固有色</p> 
<p>Specular + Diffuse共同作用类似工作流1中的Metallic + Roughness</p> 
<p><strong>Glossiness光泽度</strong>（PBR工作流2）</p> 
<p>定义光滑程度，类似工作流1中的Roughness</p> 
<p><strong>Normal法线</strong>（PBR工作流公共常用）</p> 
<p>高分辨率建模创建的贴图，用于呈现更多表面凹凸层次细节</p> 
<p>应用于如人脸、武器等精细模型</p> 
<p><strong>AO环境光遮蔽</strong>（PBR工作流公共常用）</p> 
<p><strong>屏幕空间环境光遮挡</strong>（SSAO）是一种近似计算因遮蔽而造成的光线衰减的效果。通常是在标准全局光照的基础上增添细微效果，例如让角落、裂缝或其他生物变暗，以形成一种更加自然真实的视觉效果。</p> 
<p>其他参数</p> 
<p><strong>各向异性与切线</strong>（用于金属拉丝效果）、<strong>自发光、不透明度</strong>（混合模式为半透明激活该参数）</p> 
<p>[注] 具体说明详见官方文档：图形和渲染 - 材质 - 材质输入 <a href="https://docs.unrealengine.com/zh-CN/RenderingAndGraphics/Materials/MaterialInputs/index.html" rel="nofollow">材质输入|虚幻引擎文档</a></p> 
<h3><a id="_175"></a>材质图表的计算节点</h3> 
<p>最常用的技巧</p> 
<p><strong>Multiply正片叠底</strong>：如对纹理和白色三维向量相乘后作为baseColor的参数</p> 
<p><strong>Lerp线性插值</strong>：如粗糙度的最小最大值通过lerp限定在0~1后作为参数</p> 
<p>常用节点&amp;快捷键一览</p> 
<p><strong>【A】Add加法</strong>：接受两个输入，将它们相加并输出结果。</p> 
<p><strong>【B】BumpOffset 凹凸偏移</strong>：输入使用灰阶高度贴图（Height Texture）链接高度Height输入引脚提供深度信息；输出链接至贴图UVs输入引脚实现凹凸信息输出。</p> 
<p><strong>【C】Comment注释板</strong>：节点注释板，用以归类节点。</p> 
<p><strong>【D】Divide除法</strong>：接受两个输入，将第一个输入除以第二个输入，并输出结果。</p> 
<p><strong>【E】Power幂强化</strong>：幂函数节点。</p> 
<p><strong>【F】MaterialFunctionCall材质函数调用</strong>：使用来自另一材质或函数的外部材质函数。</p> 
<p><strong>【I】if比较节点</strong>：比较两个输入，然后根据比较的结果传递其他三个输入值中的一个。</p> 
<p><strong>【L】LinearInterpolate线性差值</strong>：根据用作蒙版的第三个输入值，在两个输入值之间进行混合。</p> 
<p><strong>【M】Multiply乘法</strong>：接受两个输入，将它们相乘，然后输出结果。</p> 
<p><strong>【N】Normalize归一化</strong>：计算并输出其输入的归一化值。归一化矢量（也称“单位矢量”）的整体长度为1.0。这意味着输入的每个分量都除以矢量的总大小（长度）。</p> 
<p><strong>【O】OneMinus一减</strong>：接受输入值“X”并输出“1 - X”。此操作逐通道执行。</p> 
<p><strong>【P】Panner平移</strong>：输出可用于创建平移（或移动）纹理的 UV 纹理坐标。</p> 
<p><strong>【R】ReflectionVector反射矢量</strong>：该值表示通过表面法线反射的摄像机方向。ReflectionVector通常用于环境贴图，其中反射矢量的x/y分量被用作UV输入立方体贴图纹理。</p> 
<p><strong>【S】ScalarParameter标量参数</strong>：输出单个浮点值 (Constant常量)，这个值可在材质实例中访问和更改，或者由代码快速访问和更改。</p> 
<p><strong>【T】TextureSample纹理采样</strong>：输出纹理中的颜色值。贴图用。</p> 
<p><strong>【U】TexCoord纹理坐标</strong>：UV节点。UV倍率设置必须是2次幂。</p> 
<p><strong>【V】VectorParameter矢量参数</strong>：与 Constant4Vector功能相同，可在材质实例中以及通过代码来修改的参数。</p> 
<p><strong>【1】Constant常量</strong>：输出R单个通道浮点值，可以设定为一个目标的单通道输入值。</p> 
<p><strong>【2】Constant2Vector常量2矢量</strong>：输出RG两个通道浮点值。</p> 
<p><strong>【3】Constant3Vector常量3矢量</strong>：输出RGB三通道浮点值。</p> 
<p><strong>【4】Constant4Vector常量4矢量</strong>：输出RGBA四通道浮点值。</p> 
<p><strong>AppendVector</strong>：低维到高维向量</p> 
<p><strong>Mask</strong>：蒙版组件，可以指定选择输出多个通道中的几个</p> 
<h3><a id="PBR_233"></a>使用贴图制作PBR材质</h3> 
<p>使用fbx模型贴图制作PBR材质</p> 
<p>贴图通道对应参数关系：</p> 
<p>diffuse/baseColor贴图 — BaseColor</p> 
<p>normal贴图 — normal</p> 
<p>occlusion_roughness_metal贴图（复合贴图） — AO 、 Roughness 、 metallic（标准顺序）</p> 
<p>diffuse固有色贴图以及复合贴图取消勾选sRGB，其他默认设置</p> 
<p>normal贴图的纹理界面设置</p> 
<p><img src="https://images2.imgbox.com/7f/9b/ZNV0CTd1_o.png" alt="请添加图片描述"><br> 导入时不新建材质和纹理，手工创建材质</p> 
<p>转换参数将贴图作为实例化的可配参数</p> 
<p>使用lerp控制粗糙度为0~1可配参数</p> 
<p>使用SubStance Painter等材质软件导出模型贴图并制作PBR材质</p> 
<p>文件 - 导出贴图 - 匹配 - UE4 packed （标准的通道顺序）</p> 
<p>将贴图导入UE4引擎，使用贴图创建材质</p> 
<h3><a id="_264"></a>玻璃&amp;水材质制作（初级）</h3> 
<p>玻璃</p> 
<p>材质域：表面， 混合模式：半透明， 折射模式（Refraction）：折射率</p> 
<p>玻璃的基础属性：基础色偏浅蓝，高金属度，低粗糙度，标准折射率1.53</p> 
<p>使用Fresnel菲涅尔节点过渡：表面入射点到相机向量 和 该点法线向量的夹角越大，亮度越大；夹角越小亮度越暗<br> <img src="https://images2.imgbox.com/e4/a5/CU31rQhF_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/1b/7e/rjDnmMgu_o.png" alt="请添加图片描述"><br> 水</p> 
<p>基础属性设置与玻璃接近</p> 
<p>折射模式（Refraction）：像素正常偏移</p> 
<p>Normal贴图Multiply放大，增强水面波纹效果</p> 
<p>UV divide进行放大</p> 
<p>使用panner修改UV坐标使水波纹动起来</p> 
<p>使用lerp将两个UV移动的normal叠加，实现不同方向的水面波动效果<br> <img src="https://images2.imgbox.com/b1/85/NLxBBfAr_o.png" alt="请添加图片描述"></p> 
<h3><a id="_290"></a>角色皮肤、毛发材质制作（初级）</h3> 
<p>人物皮肤</p> 
<p>基于父材质创建实例便于调整</p> 
<p><strong>着色模型：次表面轮廓</strong>（专为皮肤设计）；<strong>次表面轮廓profile</strong></p> 
<p>启用<strong>伯力算法（Burley Normalized）</strong></p> 
<p><strong>高光（Dual Specular）</strong></p> 
<p>NormalMap贴图</p> 
<p>粗糙度贴图</p> 
<p>人物毛发</p> 
<p>混合模式：遮罩</p> 
<p>着色模型：头发 双面</p> 
<p>人物眼球（可以迁移epic digital human工程的眼球）</p> 
<h3><a id="_316"></a>材质函数</h3> 
<p><strong>材质函数</strong> 是材质图的一些小片段，它们可以保存在包中，并在多个材质之间重复使用。</p> 
<p>对单个函数的编辑会传遍使用该函数的所有网络</p> 
<p>在材质编辑器中可以像编辑普通材质一样编辑函数，但是在可以使用哪些节点方面存在一些限制。正确使用函数可降低材质冗余度</p> 
<p>创建材质函数完成后，应该将其发布到<strong>材质函数库</strong>，以方便创建材质期间进行访问。材质函数库是材质编辑器中的一个窗口，其中包含经过分类且可过滤的可用材质函数列表</p> 
<p>发布到库： <strong>Expose to Library</strong> 属性被设置为 True</p> 
<p>材质函数列表：<br> <img src="https://images2.imgbox.com/d0/7c/l2OwmAYK_o.png" alt="请添加图片描述"></p> 
<h3><a id="UV_332"></a>材质UV计算技巧</h3> 
<p>uv两通道渐变数值0-1，通过基础运算可以得到矩形渐变，环形(极坐标)渐变，棋盘格等效果</p> 
<p><strong>UV计算常用节点</strong></p> 
<p>重映射范围：<strong>remap</strong></p> 
<p>其他范围控制类节点：<strong>abs ceil claimp min max</strong></p> 
<p>向量计算：<strong>normalize mask</strong></p> 
<p>过渡节点：线性插值<strong>lerp</strong></p> 
<p>基本数学计算节点：<strong>multiply divide add sub 1-x power</strong></p> 
<p>三角函数：正反切<strong>atange</strong>+uv = 极坐标渐变 正余弦<strong>sin cos</strong></p> 
<p>分数节点：取小数<strong>frac</strong> 四舍五入<strong>round</strong></p> 
<p>法线坐标节点：顶点法线<strong>vertexNorma</strong>l 像素法线<strong>pixelNormal</strong></p> 
<p>坐标系变换：<strong>transfomVector</strong>，用于屏幕材质</p> 
<p>材质动画节点：<strong>panner</strong> <strong>time</strong> <strong>flipbook</strong></p> 
<p><strong>time节点</strong>结合不同曲线，接材质<strong>世界位置偏移</strong>属性，产生<strong>材质动画效果</strong></p> 
<p>波形曲线sin cos</p> 
<p>x y轴一个sin 一个cos — 圆周运动<br> <img src="https://images2.imgbox.com/d4/21/dbt3MM06_o.jpg" alt="请添加图片描述"><br> 折形线frac<br> <img src="https://images2.imgbox.com/ca/30/QNFTHIZK_o.jpg" alt="请添加图片描述"></p> 
<h3><a id="_368"></a>材质常用属性设置&amp;节点</h3> 
<p>【属性】材质<strong>lighting mode</strong></p> 
<p>无光照常用于自发光材质</p> 
<p>subsurface即3s材质，常用于皮肤、玉石、蜡烛等</p> 
<p>【属性】<strong>Translucency Volume</strong></p> 
<p>surface forwarding：前向渲染，效果最好开销最大</p> 
<p>Volumetric NonDirection：不会使用法线，光照无方向</p> 
<p>Volumetric Direction：会使用法线，光照有方向</p> 
<p>Volumetric PerVetex NonDirection、Volumetric PerVetex Direction：性能最cheap的方式</p> 
<p>【节点】<strong>feature Level Switch节点</strong></p> 
<p>ES为移动平台，SM为PC等高性能平台，用于区分平台优化性能</p> 
<p>【节点】<strong>time节点</strong>实现简单的材质动画效果，常用于light function</p> 
<p>【节点】<strong>panner节点</strong>对UV平移</p> 
<p>【属性】半透明材质<strong>render after DOF选项</strong>，在景深后渲染</p> 
<p>常用于解决材质不受sequencer焦距影响的问题</p> 
<p>【属性】<strong>曲面细分Tessellation</strong></p> 
<p><strong>PN三角形</strong>相对于<strong>Flat Tessellation</strong>在细分时会进行平滑</p> 
<p>常结合<strong>displacement</strong>（置换贴图）使用</p> 
<p>置换贴图 —&gt; world displacement</p> 
<p>Tesselation multiplier —&gt; 曲面细分强度参数化</p> 
<p>【属性】UE4的PBR：<strong>金属度Metalic</strong>一般非黑即白，一般结合<strong>粗糙度Roughness</strong>调整高光，不用<strong>高光specular</strong></p> 
<p>【属性】3s材质中<strong>opacity</strong>含义有变，表示通透度，即光线穿透后散射的颜色及强弱</p> 
<p>【节点】<strong>vertex normal iws节点</strong>：顶点法线转世界坐标</p> 
<p>【节点】<strong>fresnel function节点</strong>：菲涅尔现象材质函数</p> 
<p>【属性】法线贴图一般<strong>RG通道有信息，B通道表示强弱</strong></p> 
<p>【属性】PBR纹理一般可以把<strong>AO，金属度，粗糙度****放在一张贴图的不同通道(复合贴图)</strong>，通过<strong>mask节点</strong>获取</p> 
<p>【节点】嵌套使用<strong>blend corrected normal节点</strong>可以叠加多张normal map</p> 
<p>【节点】<strong>材质函数</strong>使用input节点输入参数，make material attrs节点打包输出参数，主材质使用use material attrs解决材质函数单个输出端的问题，多级材质函数使用break material attrs节点接收上一级材质函数的输入</p> 
<p>【节点】使用材质函数实现分层材质中的材质layer，使用<strong>material blend standard节点</strong>进行<strong>分层材质混合</strong>（地形分层材质中使用landscape开头的blend节点）</p> 
<p>【节点】<strong>Dither temporalAA节点</strong>常用于蒙版半透明，各向异性效果（金属拉丝/头发高光）、风格化等场景</p> 
<p>使用masked材质域 + Dither temporalAA实现半透明材质能减少性能消耗，关键属性opacity mask<br> <img src="https://images2.imgbox.com/11/77/uRtGDO1W_o.png" alt="请添加图片描述"></p> 
<h3><a id="_431"></a>后处理材质基础</h3> 
<p>关于后期处理的重要基础知识</p> 
<p><strong>材质模式设置为postprocess</strong></p> 
<p><strong>Scene texture节点:</strong></p> 
<p>texture-id选择渲染后的不同信息，如PostprocessInput，输出4维数据</p> 
<p>texture-id选择normal能够获取方向信息</p> 
<p>R(X)G(Y)B(Z)选择场景中的不同方向面</p> 
<p>texture-id选择scene depth获取场景深度信息</p> 
<p>divide一个常数参数控制深度</p> 
<p><strong>blend position参数控制调色时机</strong></p> 
<p>GPU Visualizer窗口：ctrl + shift +‘ ,’ 调出窗口展示如何渲染一帧</p> 
<p>材质details中搜索blend</p> 
<p>一般选择before tonemaping，在后期盒子调色之前混合后处理材质，避免抖动</p> 
<p><strong>后期排序</strong></p> 
<p>场景中多个后期盒子叠加，可以设置优先级</p> 
<p>blend position设置的渲染管线顺序&gt;后期优先级设置</p> 
<p>后期盒子中添加了多个后处理材质，材质会按先后顺序计算并叠加</p> 
<p><strong>custom depth /stencil扣图后期</strong></p> 
<p>模型的<strong>Render CustomDepth Pass选项</strong><br> <img src="https://images2.imgbox.com/1f/7d/m8Acv5za_o.png" alt="请添加图片描述"><br> <strong>buffer视口</strong>：Lit - BufferVisualizer 选择各个GBuffer通道查看</p> 
<p>选择custome depth可以查看勾选了Render CustomDepth Pass选项的模型</p> 
<p><strong>实例1 - 场景调色</strong></p> 
<p><strong>按深度上色</strong>：取深度信息的一个通道作为alpha, 对场景进行后期调色</p> 
<p>使用黑色和场景后处理输出lerp叠加，实现恐怖效果</p> 
<p><img src="https://images2.imgbox.com/b1/9a/0YxDdvSw_o.png" alt="请添加图片描述"><br> <strong>用深度驱动曲线分层上色</strong>：Curve + Curve Atlas</p> 
<p>新建线性颜色曲线：Miscellaneous - Curve - <strong>curveLinearColor</strong>，设置颜色曲线分布</p> 
<p>新建曲线图集：Miscellaneous - <strong>Curve Atlas</strong>（曲线管理工具），关联颜色曲线</p> 
<p>材质中CurveAtlasRowParameter节点，深度信息作为CurveTime输入，曲线输出和后处理输出叠加后给EmissiveColor<br> <img src="https://images2.imgbox.com/7e/15/pyeuiDG0_o.png" alt="请添加图片描述"><br> <strong>实例2 - 扰动和模糊</strong></p> 
<p>根据<strong>水normal+噪波图纹理扰动UV</strong>，实现屏幕水波纹效果<br> <img src="https://images2.imgbox.com/88/ba/dX0g3QnH_o.png" alt="请添加图片描述"><br> <strong>一些屏幕相关节点</strong>:</p> 
<p><strong>Field Of View / Screen Resolution</strong>屏幕大小信息</p> 
<p><strong>Screen Postion</strong>屏幕空间位置</p> 
<p><strong>Screen Aligned UV</strong>屏幕空间UV</p> 
<p><strong>CheapContrast</strong>对比度调节</p> 
<p><strong>使用DitherTemporalAA节点叠加UV实现噪波模糊效果</strong></p> 
<p>DitherTemporalAA节点每一个像素介于0-1之间波动，带透明效果</p> 
<p>UV坐标sub0.5后和DitherTemporalAA相乘实现飞奔时的屏幕模糊效果<br> <img src="https://images2.imgbox.com/9c/62/yRf8jiOL_o.png" alt="请添加图片描述"><br> <strong>实例3 - 描边</strong></p> 
<p>法1：SceneTexture-<strong>Normal通道 + 卷积</strong>（相邻像素的法向量距离越大，叠加颜色越明显）</p> 
<p>法2：SceneTexture-<strong>Depth通道 + 卷积</strong>（相邻像素的深度值距离越大，叠加颜色越明显）<br> <img src="https://images2.imgbox.com/0c/8e/hCpoJKkF_o.png" alt="请添加图片描述"><br> <strong>实例4 - CustomDepth/CustomStencil抠图处理</strong></p> 
<p><strong>CustomDepth抠图高亮</strong></p> 
<p>使用SceneTexture-CustomDepth通道叠加颜色后和后处理输出叠加</p> 
<p>场景中勾选了Render CustomDepth Pass选项的所有物体将被高亮<br> <img src="https://images2.imgbox.com/8d/45/gHw5XurO_o.png" alt="请添加图片描述"><strong>CustomDepth Stencil指定场景物体，不同颜色高亮</strong></p> 
<p>项目设置里<strong>custom Depth-Stencil Pass</strong>选择<strong>Enabled with stencil</strong></p> 
<p>模型中<strong>cutomDepth stencel value</strong>参数设置不同值</p> 
<p>后处理材质中<strong>使用SceneTexture-CustomDepth通道获取</strong>，用<strong>if节点</strong>判断值区分物体<br> <img src="https://images2.imgbox.com/7c/95/9oa9ZSKp_o.png" alt="请添加图片描述"><br> <strong>实例5 - 蓝图中控制后期材质，如高亮或描边</strong></p> 
<p>法1、<strong>MPC（材质参数集）</strong></p> 
<p>MPC创建：Materials - Material Parameter Collection</p> 
<p>后期材质中拖入MPC，使用MPC中的参数替代原参数</p> 
<p>任意蓝图中可以直接指定MPC并修改参数：</p> 
<p><strong>set vector parameter value</strong>（3维的参数）</p> 
<p><strong>set scaler parameter value</strong>（1维的参数）</p> 
<p><strong>MPC是全局参数集，若多个蓝图同时修改该参数集会有竞争问题，此时应该使用MID方法</strong></p> 
<p>法2、<strong>MID（动态材质实例）</strong></p> 
<p>蓝图中<strong>添加postprocess组件</strong>, 用box包裹该组件可控制后处理影响范围</p> 
<p>Construct Script中指定后处理材质<strong>create dynamic material</strong>并保存（隐藏的有点深。。如下图）</p> 
<p>设置postprocess组件中的material为保存的动态材质实例<br> <img src="https://images2.imgbox.com/a5/71/Csh4Iy9M_o.png" alt="请添加图片描述"><br> 蓝图中修改动态材质实例的参数，节点名与MPC相同：</p> 
<p><strong>set vector parameter value</strong>（3维的参数）</p> 
<p><strong>set scaler parameter value</strong>（1维的参数）<br> <img src="https://images2.imgbox.com/60/3c/ZRh2le7M_o.png" alt="请添加图片描述"><br> 蓝图控制节点补充：控制模型的customDepth参数</p> 
<p><strong>set custom depth stencil value节点</strong>：设置stencil value</p> 
<p><strong>set render custom depth节点</strong>：设置Render CustomDepth Pass选项<br> ————————————————<br> 版权声明：本文为CSDN博主「Ctrlturtle」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br> 原文链接：https://blog.csdn.net/hechao3225/article/details/113530401</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dc6706a867aea28ac01a382690d344cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">超越阿里云，华为云服务器究竟有多厉害！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/57502a4924bc689613d36dd4e9b75a69/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">阿里云elasticsearch实践（最大限度提高写入速度）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>