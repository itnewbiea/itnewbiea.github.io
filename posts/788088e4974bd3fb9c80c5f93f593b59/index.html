<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RK3568笔记七：yolov5-seg实例分割测试验证 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RK3568笔记七：yolov5-seg实例分割测试验证" />
<meta property="og:description" content="若该文为原创文章，转载请注明原文出处。
记录的目的是想在RK3568上实现实例分割，在github的rknn_mode_zoo仓库里看到了例子，带着疑问测试了一下，结果跑通了，这里记录下全过程。
一、环境 1、硬件：正点原子ATK-DLRK3568板子
2、虚拟：使用正点提供的虚拟机
3、需要安装的工具（参考03【正点原子】ATK-DLRK3568_AI例程测试手册V1.0.pdf）：
安装交叉编译工具链
anaconda 的安装与环境配置
更新 NPU 驱动 安装 rknn-toolkit2 以上自行安装，手册里有详细的説明
二、模型转换 １、下載rknn_model_zoo https://github.com/airockchip/rknn_model_zoo 本人使用的是git方式，直接在虚拟机下操作的
git clone https://github.com/airockchip/rknn_model_zoo.git 没有VPN很难下载，自行处理。
看下目录，有很多，这里只测试yolov5_seg，也测试了ｙｏｌｏｖ８是正常的。
２、环境及模型下载 转换是在py3.8下转换的，先激活conda環境
conda activate rknn2_env rknn2_env是根据手册创建的虚拟环境
进入yolov5_seg的model目录
cd /home/alientek/rknn_model_zoo/examples/yolov5_seg/model 下載onnx模型,获取yolov5s-seg.onnx模型，模型訓練和获取会用一篇文章记录。
chmod &#43;x download_model.sh ./download_model.sh 3、rknn模型转换 进入目录/home/alientek/rknn_model_zoo/examples/yolov5_seg/python，里面有个convert.py文件，会把onnx模型转成rknn
这里要注意，rknn-toolkit2一定要安装，py3.8一定要切换。
执行
python convert.py ../model/yolov5s-seg.onnx rk3568 i8 转换成功后的rknn在model目录下。
三、Dｅｍｏ编译 rknn_model_zoo提供了两个测试方法，一个是python, 一个是python, python可以验证onnx模型
cpp直接部署到rk3568上。
这里直接测试cpp
所以编译demo，在readme里也有介绍
即先设置交叉工具链，执行编译。
先执行下面命令，设置交叉工具链：
export GCC_COMPILER=/opt/atk-dlrk356x-toolchain/usr/bin/aarch64-buildroot-linux-gnu 返回rknn_model_zoo目录
执行执行下面命令编译demo
./build-linux.sh -t rk356x -a aarch64 -d yolov5_seg 结果保存在install目录下" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/788088e4974bd3fb9c80c5f93f593b59/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-31T14:07:40+08:00" />
<meta property="article:modified_time" content="2023-12-31T14:07:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RK3568笔记七：yolov5-seg实例分割测试验证</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>若该文为原创文章，转载请注明原文出处。</p> 
<p>记录的目的是想在RK3568上实现实例分割，在github的rknn_mode_zoo仓库里看到了例子，带着疑问测试了一下，结果跑通了，这里记录下全过程。</p> 
<h2><strong>一、环境</strong></h2> 
<p>1、硬件：正点原子ATK-DLRK3568板子</p> 
<p>2、虚拟：使用正点提供的虚拟机</p> 
<p>3、需要安装的工具（参考03【正点原子】ATK-DLRK3568_AI例程测试手册V1.0.pdf）：</p> 
<p>        <span style="color:#000000;"><strong>安装交叉编译工具链</strong></span></p> 
<p><span style="color:#000000;"><strong>        anaconda 的安装与环境配置</strong></span></p> 
<div> 
 <span style="color:#000000;"><strong>        更新 NPU </strong></span> 
 <span style="color:#000000;"><strong>驱动</strong></span> 
</div> 
<div></div> 
<div> 
 <span style="color:#000000;"><strong>        安装 </strong></span> 
 <span style="color:#000000;"><strong>rknn-toolkit2</strong></span> 
</div> 
<p>以上自行安装，手册里有详细的説明</p> 
<h2>二、模型转换</h2> 
<h3>１、下載rknn_model_zoo</h3> 
<pre><code class="hljs">https://github.com/airockchip/rknn_model_zoo</code></pre> 
<p>本人使用的是git方式，直接在虚拟机下操作的</p> 
<pre><code class="hljs">git clone https://github.com/airockchip/rknn_model_zoo.git</code></pre> 
<p>没有VPN很难下载，自行处理。</p> 
<p>看下目录，有很多，这里只测试yolov5_seg，也测试了ｙｏｌｏｖ８是正常的。</p> 
<p><img alt="" height="842" src="https://images2.imgbox.com/de/fc/d7uB5O8p_o.png" width="432"></p> 
<h3>２、环境及模型下载</h3> 
<p>转换是在py3.8下转换的，先激活conda環境</p> 
<pre><code class="hljs">conda activate rknn2_env</code></pre> 
<p>rknn2_env是根据手册创建的虚拟环境</p> 
<p>进入yolov5_seg的model目录</p> 
<pre><code class="hljs">cd /home/alientek/rknn_model_zoo/examples/yolov5_seg/model
</code></pre> 
<p>下載onnx模型,获取yolov5s-seg.onnx模型，模型訓練和获取会用一篇文章记录。</p> 
<pre><code class="hljs">chmod +x download_model.sh
./download_model.sh
</code></pre> 
<h3><img alt="" height="141" src="https://images2.imgbox.com/b4/14/reQU2PZQ_o.png" width="747"></h3> 
<h3>3、rknn模型转换</h3> 
<p>进入目录/home/alientek/rknn_model_zoo/examples/yolov5_seg/python，里面有个convert.py文件，会把onnx模型转成rknn</p> 
<p>这里要注意，rknn-toolkit2一定要安装，py3.8一定要切换。</p> 
<p>执行</p> 
<pre><code class="hljs">python convert.py ../model/yolov5s-seg.onnx rk3568 i8</code></pre> 
<p><img alt="" height="251" src="https://images2.imgbox.com/51/39/MHUErevS_o.png" width="786"></p> 
<p><img alt="" height="304" src="https://images2.imgbox.com/ef/7f/vvvTvT38_o.png" width="838"></p> 
<p>转换成功后的rknn在model目录下。</p> 
<h2>三、Dｅｍｏ编译</h2> 
<p>rknn_model_zoo提供了两个测试方法，一个是python, 一个是python, python可以验证onnx模型</p> 
<p>cpp直接部署到rk3568上。</p> 
<p>这里直接测试cpp</p> 
<p>所以编译demo，在readme里也有介绍</p> 
<p><img alt="" height="419" src="https://images2.imgbox.com/f7/f0/vNdGIaKh_o.png" width="929"></p> 
<p>即先设置交叉工具链，执行编译。</p> 
<p>先执行下面命令，设置交叉工具链：</p> 
<pre><code class="hljs">export GCC_COMPILER=/opt/atk-dlrk356x-toolchain/usr/bin/aarch64-buildroot-linux-gnu</code></pre> 
<p>返回rknn_model_zoo目录</p> 
<p>执行执行下面命令编译demo</p> 
<pre><code class="hljs"> ./build-linux.sh -t rk356x -a aarch64 -d yolov5_seg</code></pre> 
<p><img alt="" height="569" src="https://images2.imgbox.com/9c/bf/ZW2BSC9K_o.png" width="809"></p> 
<p>结果保存在install目录下</p> 
<p><img alt="" height="108" src="https://images2.imgbox.com/3b/ec/fTLVgqMU_o.png" width="863"></p> 
<p>rknn_yolov5_seg_demo 会有模型和可执行文件</p> 
<p><img alt="" height="62" src="https://images2.imgbox.com/10/21/8HdtptNx_o.png" width="819"></p> 
<h2>四、Dｅｍｏ测试及验证</h2> 
<p>通过ADB把rknn_yolov5_seg_demo上传到板子</p> 
<pre><code class="hljs">adb push rknn_yolov5_seg_demo/ /userdata/aidemo</code></pre> 
<p>打开开发板终端，</p> 
<p>执行</p> 
<pre><code class="hljs">./rknn_yolov5_seg_demo model/yolov5s-seg.rknn model/bus.jpg</code></pre> 
<p>执行出错</p> 
<p><img alt="" height="552" src="https://images2.imgbox.com/ec/2f/8Djoc7SJ_o.png" width="1108"></p> 
<p>错误感觉是rga和rknnrt版本过低。</p> 
<p>更新一下，直接拷贝lib下的librga.so和librknnrt.so到/usr/lib目录下</p> 
<pre><code class="hljs">#进入lib目录
cd rknn_yolov5_seg_demo/lib
# 拷贝
cp * /usr/lib</code></pre> 
<p>重新运行，输出正常，并输出out.png图片<br><img alt="" height="220" src="https://images2.imgbox.com/9a/88/u6zmEZju_o.png" width="864"></p> 
<p>通过adb把out.png图片下载到虚拟机。</p> 
<p>在虚拟机执行下面命令，下载图片</p> 
<pre><code class="hljs">adb pull /userdata/aidemo/rknn_yolov5_seg_demo/out.png ./</code></pre> 
<p><img alt="" height="655" src="https://images2.imgbox.com/af/4d/7NT1TEIm_o.png" width="647"></p> 
<p>后续将训练自己的数据集并部署。</p> 
<p>如有侵权，或需要完整代码，请及时联系博主。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c3bf36d94c41e3e27be223f1fc5f27a7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">探秘“万年历”: 久远新科技的灵感源泉</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6d427dcfb39c3d9f76cc391e737700d6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Megatron-LM源码系列(六)：Distributed-Optimizer分布式优化器实现Part1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>