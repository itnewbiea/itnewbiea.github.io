<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Linux系统移植】NXP 官方开发板 kernel内核 编译与烧录 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Linux系统移植】NXP 官方开发板 kernel内核 编译与烧录" />
<meta property="og:description" content="1、下载
NXP 官方 I.MX6ULL EVK 开发板的kernel ：linux-imx-rel_imx_4.1.15_2.1.0_ga.tar.bz2
2、使用 FileZilla Client 将 uboot拷贝到ubuntu
3、解压
tar -xjvf linux-imx-rel_imx_4.1.15_2.1.0_ga.tar.bz2
解压出来的文件：
4、安装 库 （1）安装 lzop 库，否则内核编译会失败！ sudo apt-get install lzop （2）uboot 或 Linux 内核可以通过输入“make menuconfig”来打开图形化配置界面，menuconfig 是一套图形化的配置工具，需要 ncurses 库支持，使用以下命令安装 ncurses 库： sudo apt-get install build-essential sudo apt-get install libncurses5-dev 5、编译kernel
（1）新建mx6ull_iot_emmc.sh 的 shell 脚本文件
vim mx6ull_iot_emmc.sh （2）写入以下内容。shell 脚本要求第一行必须是“#!/bin/bash”或者“#!/bin/sh”。
#!/bin/sh make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v7_mfg_defconfig make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- menuconfig make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- all -j12 （2）给脚本文件可执行权限" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a0c7563d870a83db1dbc13c633d2fdad/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-12T16:23:40+08:00" />
<meta property="article:modified_time" content="2020-04-12T16:23:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Linux系统移植】NXP 官方开发板 kernel内核 编译与烧录</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>1、下载</strong></p> 
<p style="text-indent:33px;">NXP 官方 I.MX6ULL EVK 开发板的kernel ：linux-imx-rel_imx_4.1.15_2.1.0_ga.tar.bz2</p> 
<p>2、使用 FileZilla Client 将 uboot拷贝到ubuntu</p> 
<p><strong>3、解压</strong></p> 
<p>tar -xjvf linux-imx-rel_imx_4.1.15_2.1.0_ga.tar.bz2<br> 解压出来的文件：</p> 
<p><img alt="" height="88" src="https://images2.imgbox.com/ac/b7/IWWosT9E_o.png" width="800"></p> 
<div> 
 <strong><span style="color:#000000;">4、安装</span></strong> 
 <span style="color:#000000;"><strong>库</strong></span> 
</div> 
<div> 
 <span style="color:#000000;">（1）安装 </span> 
 <span style="color:#000000;">lzop </span> 
 <span style="color:#000000;">库，否则内核编译会失败！</span> 
</div> 
<div> 
 <pre><code>sudo apt-get install lzop</code></pre> 
 <p><span style="color:#000000;">（2）uboot </span><span style="color:#000000;">或 </span><span style="color:#000000;">Linux </span><span style="color:#000000;">内核可以通过输入“</span><span style="color:#000000;">make menuconfig</span><span style="color:#000000;">”来打开图形化配置界面，</span><span style="color:#000000;">menuconfig 是一套图形化的配置工具，需要 ncurses 库支持，使用以下命令安装 </span><span style="color:#000000;">ncurses </span><span style="color:#000000;">库：</span> </p> 
 <pre><code>sudo apt-get install build-essential
sudo apt-get install libncurses5-dev</code></pre> 
 <p><strong>5、编译kernel</strong></p> 
 <p>（1）新建mx6ull_iot_emmc.sh 的 shell 脚本文件</p> 
 <pre><code>vim mx6ull_iot_emmc.sh</code></pre> 
 <p>（2）写入以下内容。shell 脚本要求第一行必须是“#!/bin/bash”或者“#!/bin/sh”。</p> 
 <pre><code>#!/bin/sh
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- distclean
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- imx_v7_mfg_defconfig
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- menuconfig
make ARCH=arm CROSS_COMPILE=arm-linux-gnueabihf- all -j12</code></pre> 
 <p>（2）给脚本文件可执行权限</p> 
 <pre><code>chmod 777 mx6ull_iot_emmc.sh</code></pre> 
 <p>（3）执行脚本文件</p> 
 <pre><code>./mx6ull_iot_emmc.sh</code></pre> 
 <p>（4）编译过程中弹出图形配置界面，<span style="color:#000000;">按两下 ESC 键可退出</span></p> 
 <p><img alt="" height="478" src="https://images2.imgbox.com/7b/45/JF6PmcOh_o.png" width="731"></p> 
 <p> （5）编译成功</p> 
 <div> 
  <span style="color:#000000;">1&gt; arch/arm/boot </span> 
  <span style="color:#000000;">目录下生成 </span> 
  <span style="color:#000000;">zImage </span> 
  <span style="color:#000000;">文件，即</span> Linux 镜像文件。 
 </div> 
 <div>
   2&gt; arch/arm/boo/dts 下生成很多.dtb 文件， 
  <span style="color:#000000;">即设备树文件</span> 
 </div> 
 <div>
     
 </div> 
 <p><img alt="" height="442" src="https://images2.imgbox.com/af/fd/jfy0pUk6_o.png" width="733"></p> 
 <p>（6）可以修改顶层Makefile，使用以下命令编译：</p> 
 <p>“<span style="color:#000000;">make distclean</span>”：<span style="color:#000000;">清理工程</span></p> 
 <p>“make <span style="color:#000000;">imx_v7_defconfig</span>”：<span style="color:#000000;">配置工程</span></p> 
 <p>“make <span style="color:#000000;">menuconfig</span>”：配置图形界面</p> 
 <p>“make <span style="color:#000080;"><strong>-</strong></span><span style="color:#000000;">j12</span>”：编译</p> 
 <p>如图：</p> 
 <p><img alt="" height="341" src="https://images2.imgbox.com/b7/3a/FwR3oDXh_o.png" width="605"></p> 
 <p> </p> 
 <p><strong>6、烧录并启动kernel</strong></p> 
 <p>（1）开发板终端设置<span style="color:#000000;">uboot </span><span style="color:#000000;">中环境变量 </span><span style="color:#000000;">bootargs</span></p> 
 <pre><code>setenv bootargs 'console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw'
saveenv</code></pre> 
 <p><img alt="" height="69" src="https://images2.imgbox.com/75/88/Zh6TlVwa_o.png" width="767"></p> 
 <p>（2）<span style="color:#000000;">将 </span><span style="color:#000000;">zImage </span><span style="color:#000000;">和 </span><span style="color:#000000;">imx6ull-14x14-evk.dtb </span><span style="color:#000000;">复制到 </span><span style="color:#000000;">Ubuntu </span><span style="color:#000000;">中的 </span><span style="color:#000000;">tftp </span><span style="color:#000000;">目录下</span></p> 
 <pre><code>cp arch/arm/boot/zImage /home/pjw/linux/tftpboot/
cp arch/arm/boot/dts/imx6ull-14x14-evk.dtb /home/pjw/linux/tftpboot/
</code></pre> 
 <p>（3）开发板终端使用以下命令下载启动内核</p> 
 <pre><code>tftp 80800000 zImage 
tftp 83000000 imx6ull-14x14-evk.dtb
bootz 80800000 – 83000000</code></pre> 
 <p>（4）如图，内核启动成功： </p> 
 <p><img alt="" height="605" src="https://images2.imgbox.com/29/6c/W65tAqXx_o.png" width="648"></p> 
 <p><img alt="" height="396" src="https://images2.imgbox.com/64/8c/Oq9MY7nb_o.png" width="669"></p> 
 <p>（5）如果没有烧录文件系统，会提示以下错误：</p> 
 <p><span style="color:#f33b45;">Kernel panic - not syncing: VFS: Unable to mount root fs on unknown-block(0,0)</span></p> 
 <p>即<span style="color:#000000;">提示内核崩溃，因为 VFS(</span><span style="color:#000000;">虚拟文件系统</span><span style="color:#000000;">)</span><span style="color:#000000;">不能挂载根文件系统，因为根文件系统目录不存在。即使根文件系统目录存在，如果根文件系统目录里面是空的依旧会提示内核崩溃。这个就是根文件系统缺失导致的内核崩溃，但是内核是启动了的，只是根文件系统不存在而已。</span></p> 
 <p><span style="color:#000000;">之前boot环境变量设置   console=ttymxc0,115200 root=/dev/mmcblk1p2 rootwait rw</span></p> 
 <ul><li><span style="color:#000000;">console </span><span style="color:#000000;">设置 </span><span style="color:#000000;">linux 终端，串口 </span><span style="color:#000000;">1 的</span><span style="color:#000000;">设备文件是</span><span style="color:#000000;">/dev/ttymxc0</span></li><li><span style="color:#000000;">115200 </span><span style="color:#000000;">设置串口的波特率</span></li><li><span style="color:#f33b45;">root=/dev/mmcblk1p2</span><span style="color:#000000;">  根文件系统存放在 mmcblk1 设备的分区 </span><span style="color:#000000;">2 ，</span><span style="color:#000000;">即EMMC 的分区 2 。</span></li><li><span style="color:#000000;">rootwait 表示等待 </span><span style="color:#000000;">mmc </span><span style="color:#000000;">设备初始化完成以后再挂载，否则的话 mmc 设备还没初始化完成就挂载根文件系统会出错的。</span></li><li><span style="color:#000000;">rw </span><span style="color:#000000;">表示根文件系统是可以读写的，不加 rw 的话可能无法在根文件系统中进行写操作，只能进行读操作。</span></li></ul> 
 <div>
     
 </div> 
 <p> </p> 
 <h4><span style="color:#f33b45;"><strong>编译过程遇到的错误问题解决：</strong></span></h4> 
 <p><span style="color:#f33b45;"><strong>错误一：</strong></span></p> 
 <blockquote> 
  <p>gcc: error: unrecognized argument in option ‘-mabi=aapcs-linux’<br> gcc: note: valid arguments to ‘-mabi=’ are: ms sysv<br> gcc: error: unrecognized command line option ‘-mlittle-endian’<br> gcc: error: unrecognized command line option ‘-mno-thumb-interwork’<br> gcc: error: unrecognized command line option ‘-mfpu=vfp’<br> scripts/Makefile.build:258: recipe for target 'scripts/mod/empty.o' failed<br> make[2]: *** [scripts/mod/empty.o] Error 1<br> make[2]: *** 正在等待未完成的任务....<br><img alt="" height="409" src="https://images2.imgbox.com/ce/22/bluCyuIp_o.png" width="672"></p> 
  <p>***<br> *** Can't find default configuration "arch/x86/configs/imx_v7_mfg_defconfig"!<br> ***<br> scripts/kconfig/Makefile:105: recipe for target 'imx_v7_mfg_defconfig' failed<br> make[1]: *** [imx_v7_mfg_defconfig] Error 1<br> Makefile:541: recipe for target 'imx_v7_mfg_defconfig' failed<br> make: *** [imx_v7_mfg_defconfig] Error 2</p> 
  <p><img alt="" height="172" src="https://images2.imgbox.com/c9/e2/ckBCQCpJ_o.png" width="673"></p> 
  <p><span style="color:#f33b45;"><strong>解决：</strong></span></p> 
  <p><img alt="" height="177" src="https://images2.imgbox.com/bb/8f/iKR5sfBT_o.png" width="671"></p> 
  <p>使用了默认的 ubuntu自带的gcc编译 ，或者是修改Makefile时没有保存成功。</p> 
 </blockquote> 
 <p> </p> 
 <p><span style="color:#f33b45;"><strong>错误二：</strong></span></p> 
 <blockquote> 
  <p>  HOSTCC  scripts/kconfig/mconf.o<br> In file included from scripts/kconfig/mconf.c:23:0:<br> scripts/kconfig/lxdialog/dialog.h:38:20: fatal error: curses.h: 没有那个文件或目录<br> compilation terminated.<br> scripts/Makefile.host:108: recipe for target 'scripts/kconfig/mconf.o' failed<br> make[1]: *** [scripts/kconfig/mconf.o] Error 1<br> Makefile:541: recipe for target 'menuconfig' failed<br> make: *** [menuconfig] Error 2<br> scripts/kconfig/conf  --silentoldconfig Kconfig</p> 
  <p><img alt="" height="303" src="https://images2.imgbox.com/4f/8b/J6trrI07_o.png" width="671"></p> 
  <p><span style="color:#f33b45;"><strong>解决：</strong></span></p> 
  <div> 
   <span style="color:#000000;">uboot </span> 
   <span style="color:#000000;">或 </span> 
   <span style="color:#000000;">Linux </span> 
   <span style="color:#000000;">内核可以通过输入“</span> 
   <span style="color:#000000;">make menuconfig</span> 
   <span style="color:#000000;">”来打开图形化配置界面，</span> 
   <span style="color:#000000;">menuconfig 是一套图形化的配置工具，需要 ncurses 库支持，使用以下命令安装 </span> 
   <span style="color:#000000;">ncurses </span> 
   <span style="color:#000000;">库：</span> 
  </div> 
  <pre><code>sudo apt-get install libncurses5-dev</code></pre> 
 </blockquote> 
 <p> </p> 
 <p><span style="color:#f33b45;"><strong>错误三：</strong></span></p> 
 <blockquote> 
  <div> 
   <span style="color:#000000;">recipe for target ‘arch/arm/boot/compressed/piggy.lzo’ failed</span> 
  </div> 
  <p><img alt="" height="127" src="https://images2.imgbox.com/8d/c0/46LAq3Kx_o.png" width="862"></p> 
  <p><span style="color:#f33b45;"><strong>解决：</strong></span></p> 
  <div> 
   <span style="color:#000000;">使用以下命令安装 </span> 
   <span style="color:#000000;">lzop </span> 
   <span style="color:#000000;">库。</span> 
  </div> 
  <div> 
   <pre><code>sudo apt-get install lzop</code></pre> 
  </div> 
  <p> </p> 
 </blockquote> 
 <p> </p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a47efb932b9f4122e2746bd605ab8a00/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">github报错：Your branch is ahead of &#39;origin/master&#39; by 1 commit. 无法上传代码的解决办法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/74c175407995848c1e323bd46db60284/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vant picker 选择器 多级联动小白教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>