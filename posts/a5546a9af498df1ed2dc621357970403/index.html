<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Keil C中的sprintf函数 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Keil C中的sprintf函数" />
<meta property="og:description" content="在写VC&#43;&#43;及标准C程序时，我们常用sprint函数来将数值转换为字符串。可在Keil C中使用这个函数时就要注意了。请看下面例程：
/*main.c Designed by Bill Liu Version 0.0 Modified last by Bill Liu on 12/19/2021 */ #include &#34;main.h&#34; ui8 tem; ui16 tem1; float tem2; void main() { STCIO_InitPortsBits(P0|P1|P2|P3|P4, 0xFF, BI_IO); P3 = 0xFF; P0 = 0xFF; UartS1_Init(VBAUD_8BITS,G1,T2,9600); STCIO_InitP3Bit(SCT_BIT1, PP_OUT); SundBuzzerx10ms(50); Delay10xms(50, FSCLK); SundBuzzerx10ms(50); tem = 123; tem1 = 123; tem2 = 123; while(1) { memset(mstr,0,strlen(mstr)); sprintf(mstr,&#34;%d\r\n&#34;, tem); UartS1_SendString(mstr); memset(mstr,0,strlen(mstr)); sprintf(mstr,&#34;%d\r\n&#34;, tem1); UartS1_SendString(mstr); memset(mstr,0,strlen(mstr)); sprintf(mstr,&#34;%d\r\n&#34;, tem2); UartS1_SendString(mstr); Delay10xms(200, FSCLK); } } //End of main() //********************************************* void SundBuzzerx10ms(ui8 x) { BUZZER = 0; Delay10xms(x, FSCLK); BUZZER = 1; } //End of SundBuzzerx10ms(ui8 x) 看下在串口助手上的输出结果：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a5546a9af498df1ed2dc621357970403/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-19T16:50:16+08:00" />
<meta property="article:modified_time" content="2021-12-19T16:50:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Keil C中的sprintf函数</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>       在写VC++及标准C程序时，我们常用sprint函数来将数值转换为字符串。可在Keil C中使用这个函数时就要注意了。请看下面例程：</p> 
<pre><code>/*main.c
  Designed by Bill Liu
  Version 0.0 
  Modified last by Bill Liu on 12/19/2021
*/


#include "main.h" 
ui8 tem;
ui16 tem1;
float tem2;
void main()
{
	
  STCIO_InitPortsBits(P0|P1|P2|P3|P4, 0xFF, BI_IO);
	P3 = 0xFF;
	P0 = 0xFF;
  UartS1_Init(VBAUD_8BITS,G1,T2,9600);
	STCIO_InitP3Bit(SCT_BIT1, PP_OUT);
	
	SundBuzzerx10ms(50);
	Delay10xms(50, FSCLK);
	SundBuzzerx10ms(50);
	tem = 123;
  tem1 = 123;
  tem2 = 123;
  while(1)
  {
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", tem);
    UartS1_SendString(mstr);
    
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", tem1);
    UartS1_SendString(mstr);
    
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", tem2);
    UartS1_SendString(mstr);
    Delay10xms(200, FSCLK);
    
  }
}
//End of main()

//*********************************************
void SundBuzzerx10ms(ui8 x)
{
	BUZZER = 0;
	Delay10xms(x, FSCLK);
	BUZZER = 1;
}
//End of SundBuzzerx10ms(ui8 x)</code></pre> 
<p>看下在串口助手上的输出结果：</p> 
<p><img alt="" height="269" src="https://images2.imgbox.com/c3/e5/9Wgh1Mno_o.png" width="354"></p> 
<p>显然只有在变量类型为ui16时，结果正确。也就是说只能正确解析16位数。再看下面例程：</p> 
<pre><code>/*main.c
  Designed by Bill Liu
  Version 0.0 
  Modified last by Bill Liu on 12/19/2021
*/


#include "main.h" 
ui8 tem;
ui16 tem1;
float tem2;
void main()
{
	
  STCIO_InitPortsBits(P0|P1|P2|P3|P4, 0xFF, BI_IO);
	P3 = 0xFF;
	P0 = 0xFF;
  UartS1_Init(VBAUD_8BITS,G1,T2,9600);
	STCIO_InitP3Bit(SCT_BIT1, PP_OUT);
	
	SundBuzzerx10ms(50);
	Delay10xms(50, FSCLK);
	SundBuzzerx10ms(50);
	tem = 123;
  tem1 = 123;
  tem2 = 123;
  while(1)
  {
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", 123);
    UartS1_SendString(mstr);
    
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", tem1);
    UartS1_SendString(mstr);
    /*
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", tem2);
    UartS1_SendString(mstr);
    */
    Delay10xms(200, FSCLK);
    
  }
}
//End of main()

//*********************************************
void SundBuzzerx10ms(ui8 x)
{
	BUZZER = 0;
	Delay10xms(x, FSCLK);
	BUZZER = 1;
}
//End of SundBuzzerx10ms(ui8 x)</code></pre> 
<p> 再看下在串口助手上的输出结果：</p> 
<p><img alt="" height="240" src="https://images2.imgbox.com/d1/6a/aXJaBl7A_o.png" width="333"></p> 
<p> 显然直接输入数字也不能被正确解析。再看一个例程：</p> 
<pre><code>/*main.c
  Designed by Bill Liu
  Version 0.0 
  Modified last by Bill Liu on 12/19/2021
*/


#include "main.h" 
ui8 tem;
ui16 tem1;
float tem2;
void main()
{
	
  STCIO_InitPortsBits(P0|P1|P2|P3|P4, 0xFF, BI_IO);
	P3 = 0xFF;
	P0 = 0xFF;
  UartS1_Init(VBAUD_8BITS,G1,T2,9600);
	STCIO_InitP3Bit(SCT_BIT1, PP_OUT);
	
	SundBuzzerx10ms(50);
	Delay10xms(50, FSCLK);
	SundBuzzerx10ms(50);
	tem = 123;
  tem1 = 123;
  tem2 = 123;
  while(1)
  {
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", 305);
    UartS1_SendString(mstr);
    
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", tem1);
    UartS1_SendString(mstr);
    /*
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%d\r\n", tem2);
    UartS1_SendString(mstr);
    */
    Delay10xms(200, FSCLK);
    
  }
}
//End of main()

//*********************************************
void SundBuzzerx10ms(ui8 x)
{
	BUZZER = 0;
	Delay10xms(x, FSCLK);
	BUZZER = 1;
}
//End of SundBuzzerx10ms(ui8 x)</code></pre> 
<p>串口助手上的输出结果：</p> 
<p><img alt="" height="244" src="https://images2.imgbox.com/00/dc/C6Z9yPmN_o.png" width="338"></p> 
<p>可以看出输入的305可以被正确解析。也就是说如果输入的是一个为声明类型的数值必须是个16位数据才能被解析。 再看下面例程：</p> 
<pre><code>/*main.c
  Designed by Bill Liu
  Version 0.0 
  Modified last by Bill Liu on 12/19/2021
*/


#include "main.h" 
ui8 tem;
ui16 tem1;
float tem2;
void main()
{
	
  STCIO_InitPortsBits(P0|P1|P2|P3|P4, 0xFF, BI_IO);
	P3 = 0xFF;
	P0 = 0xFF;
  UartS1_Init(VBAUD_8BITS,G1,T2,9600);
	STCIO_InitP3Bit(SCT_BIT1, PP_OUT);
	
	SundBuzzerx10ms(50);
	Delay10xms(50, FSCLK);
	SundBuzzerx10ms(50);
	tem = 123;
  tem1 = 123;
  tem2 = 123;
  while(1)
  {
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%.2f\r\n", 305);
    UartS1_SendString(mstr);
    
    memset(mstr,0,strlen(mstr));
    sprintf(mstr,"%.2f\r\n", tem2);
    UartS1_SendString(mstr);
    Delay10xms(200, FSCLK);
    
  }
}
//End of main()

//*********************************************
void SundBuzzerx10ms(ui8 x)
{
	BUZZER = 0;
	Delay10xms(x, FSCLK);
	BUZZER = 1;
}
//End of SundBuzzerx10ms(ui8 x)</code></pre> 
<p> 串口助手上的输出结果：</p> 
<p><img alt="" height="248" src="https://images2.imgbox.com/5e/f6/X4NXYTHa_o.png" width="351"></p> 
<p>直接输入数305，不能被正确解析。 由此可见Keil C中的sprintf用作将数值装换位字符串并不是很好用，有必要自己写一个库函数程序来完成这一工作。函数声明如下:</p> 
<pre><code>/***********************************************************************
Function: FloatString(f64 src, i8* desString, ui8 mplace);
Return value: void
Discription: covert decimal digit &amp; decimal places of an  float data  to string
Example:
  ui8 tem = 12345;
  ui8 mstr[12] = {0};
  FloatString(tem,mstr,2); //"12345.00"
***********************************************************************/
void FloatString(f64 src, i8* desString, ui8 mplace);</code></pre> 
<p>实现代码:</p> 
<pre><code>void FloatString(f64 src, i8* desString, ui8 mplace)
{
 f64 ftem = fabs( src);
 ui8 iplaces = 1;
 ui8 i = 0;
 if(ftem&gt;= 10.0)
 {
   while(ftem&gt;= 10.0)
   {
      iplaces++;
     ftem /= 10;
   }
 }
 if(src &lt; 0)
 {
   desString[0] = '-';
   i = 1;
   iplaces++;
 } 
 for(; i &lt; iplaces + mplace + 1; i++)
 {
   if(i == iplaces)
   {
     if(mplace)
     {
       desString[i] = '.';
       continue;
     }
     else
       break;
   }
   else
   {
     desString[i] = (ui8)ftem;
     ftem -= desString[i];
     desString[i] += '0';
     ftem *= 10;
   }
 }
}
//End of FloatString(f64 src, i8* desString, ui8 mplace)</code></pre> 
<p>使用示例:</p> 
<p>头文件</p> 
<pre><code>/*main.h
  Designed by Bill Liu
  Version 0.0 
  Modified last by Bill Liu on 12/19/2021
*/

#ifndef __MAIN_H_
#define __MAIN_H_

#include "mtype.h"
#include "delay.h"
#include "stcuart.h"
#include "stcio.h"
#include "myport.h"

 
const FSYSCLOCK FSCLK = F30MHz; //define system clock frequency 30MHz, FSYSCLOCK was defined in mtype.h
const ui32  FSCLK1 = 30000000L; //define system clock frequency 30MHz
ui16 code Vbg_ROM _at_ 0xf3f7;  //band gap voltage stord at memory end address -8

i8 mstr[25] ="";


void SundBuzzerx10ms(ui8 x);



#endif</code></pre> 
<p>源文件:</p> 
<pre><code>/*main.c
  Designed by Bill Liu
  Version 0.0 
  Modified last by Bill Liu on 12/19/2021
*/


#include "main.h" 
ui8 tem;
ui16 tem1;
float tem2;
void main()
{
	
  STCIO_InitPortsBits(P0|P1|P2|P3|P4, 0xFF, BI_IO);
	P3 = 0xFF;
	P0 = 0xFF;
  UartS1_Init(VBAUD_8BITS,G1,T2,9600);
	STCIO_InitP3Bit(SCT_BIT1, PP_OUT);
	
	SundBuzzerx10ms(50);
	Delay10xms(50, FSCLK);
	SundBuzzerx10ms(50);
	tem = 123;
  tem1 = 123;
  tem2 = -123.123;
  while(1)
  {
    memset(mstr,0,strlen(mstr));
    FloatString(tem, mstr, 0);
    UartS1_SendString(mstr);
    UartS1_SendString("\r\n");
    
    memset(mstr,0,strlen(mstr));
    FloatString(tem1, mstr, 1);
    UartS1_SendString(mstr);
    UartS1_SendString("\r\n");
    
    memset(mstr,0,strlen(mstr));
    FloatString(tem2, mstr, 3);
    UartS1_SendString(mstr);
    UartS1_SendString("\r\n");
    Delay10xms(200, FSCLK);
  }
}
//End of main()

//*********************************************
void SundBuzzerx10ms(ui8 x)
{
	BUZZER = 0;
	Delay10xms(x, FSCLK);
	BUZZER = 1;
}
//End of SundBuzzerx10ms(ui8 x)</code></pre> 
<p>串口助手上的输出结果：</p> 
<p><img alt="" height="295" src="https://images2.imgbox.com/a9/a0/vN8mMhBo_o.png" width="348"></p> 
<p> 有了这个函数，要将数值输出为字符串显示就很方便了。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/897e9e9ec4fcfb6b316a2ffe0f99f450/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js过滤器filter的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/72faf71af4f435294ae46f6227f9ce27/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python入门1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>