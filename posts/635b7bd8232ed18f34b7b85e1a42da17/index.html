<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32 中断函数SysTick_Handler理解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32 中断函数SysTick_Handler理解" />
<meta property="og:description" content="目的 滴答定时器整理（STM32F103）。用了一段时间的滴答定时器，突然忘记其中配置方法，重新翻阅手册及博文，在此记录备忘。 SysTick的重装寄存器决定了定时器频率，若SysTick的时钟源是72M, SystemFrequency = 72000000Hz
//1ms时基 //HCLK_Frequency = 72000000Hz; //#define OS_TICKS_PER_SEC 1000 SysTick_SetReload((u32)RCC_Clocks.HCLK_Frequency / OS_TICKS_PER_SEC); 时钟树 寄存器 寄存器名称和地址 STK_CSR, 0xE000E010 – 控制寄存器 STK_LOAD, 0xE000E014 – 重载寄存器 STK_VAL, 0xE000E018 – 当前值寄存器 STK_CALRB, 0xE000E01C – 校准值寄存器 寄存器描述 STK_CSR控制寄存器：寄存器低4位含义 第0位：ENABLE，Systick 使能位 （0：关闭Systick功能；1：开启Systick功能）第1位：TICKINT，Systick 中断使能位（0：关闭Systick中断；1：开启Systick中断） 第2位：CLKSOURCE，Systick时钟源选择 （0：使用HCLK/8 作为Systick时钟；1：使用HCLK作为Systick时钟） 第3位：COUNTFLAG，Systick计数比较标志，如果在上次读取本寄存器后，SysTick 已经数到了0，则该位为1。如果读取该位，该位将自动清零 STK_LOAD 重载寄存器： Systick是一个递减的定时器，当定时器递减至0时，重载寄存器中的值就会被重装载，继续开始递减。STK_LOAD 重载寄存器是个24位的寄存器最大计数0xFFFFFF。 STK_VAL当前值寄存器： 也是个24位的寄存器，读取时返回当前倒计数的值，写它则使之清零，同时还会清除在SysTick 控制及状态寄存器中的COUNTFLAG 标志。 STK_CALRB校准值寄存器：
位31 NOREF ：1=没有外部参考时钟（STCLK 不可用）0=外部参考时钟可用位30 SKEW：1=校准值不是准确的1ms 0=校准值是准确的1ms 位[23:0] ：Calibration value Indicates the calibration value when the SysTick counter runs on HCLK max/8 as external clock." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/635b7bd8232ed18f34b7b85e1a42da17/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-11-27T16:57:20+08:00" />
<meta property="article:modified_time" content="2017-11-27T16:57:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32 中断函数SysTick_Handler理解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4 id="目的">目的</h4> 
<p>滴答定时器整理（STM32F103）。用了一段时间的滴答定时器，突然忘记其中配置方法，重新翻阅手册及博文，在此记录备忘。 <br> SysTick的重装寄存器决定了定时器频率，若SysTick的时钟源是72M, SystemFrequency = 72000000Hz</p> 
<pre class="prettyprint"><code class=" hljs rust"><span class="hljs-comment">//1ms时基</span>
<span class="hljs-comment">//HCLK_Frequency = 72000000Hz;</span>
<span class="hljs-comment">//#define OS_TICKS_PER_SEC 1000</span>
SysTick_SetReload((<span class="hljs-keyword">u32</span>)RCC_Clocks.HCLK_Frequency / OS_TICKS_PER_SEC);</code></pre> 
<h4 id="时钟树">时钟树</h4> 
<p><img src="https://images2.imgbox.com/f6/08/uIHXL4yT_o.png" alt="时钟树" title=""></p> 
<h4 id="寄存器">寄存器</h4> 
<h5 id="寄存器名称和地址">寄存器名称和地址</h5> 
<ul><li>STK_CSR, 0xE000E010 – 控制寄存器 </li><li>STK_LOAD, 0xE000E014 – 重载寄存器 </li><li>STK_VAL, 0xE000E018 – 当前值寄存器 </li><li>STK_CALRB, 0xE000E01C – 校准值寄存器 </li></ul> 
<h5 id="寄存器描述">寄存器描述</h5> 
<ul><li>STK_CSR控制寄存器：寄存器低4位含义 <br> 
  <ul><li>第0位：ENABLE，Systick 使能位 （0：关闭Systick功能；1：开启Systick功能）</li><li>第1位：TICKINT，Systick 中断使能位（0：关闭Systick中断；1：开启Systick中断） </li><li>第2位：CLKSOURCE，Systick时钟源选择 （0：使用HCLK/8 作为Systick时钟；1：使用HCLK作为Systick时钟） </li><li>第3位：COUNTFLAG，Systick计数比较标志，如果在上次读取本寄存器后，SysTick 已经数到了0，则该位为1。如果读取该位，该位将自动清零 </li></ul></li><li><p>STK_LOAD 重载寄存器： <br> Systick是一个递减的定时器，当定时器递减至0时，重载寄存器中的值就会被重装载，继续开始递减。STK_LOAD 重载寄存器是个24位的寄存器最大计数0xFFFFFF。 </p></li><li><p>STK_VAL当前值寄存器： <br> 也是个24位的寄存器，读取时返回当前倒计数的值，写它则使之清零，同时还会清除在SysTick 控制及状态寄存器中的COUNTFLAG 标志。 </p></li><li><p>STK_CALRB校准值寄存器：</p> 
  <ul><li>位31 NOREF ：1=没有外部参考时钟（STCLK 不可用）0=外部参考时钟可用</li><li>位30 SKEW：1=校准值不是准确的1ms 0=校准值是准确的1ms </li><li>位[23:0] ：Calibration value Indicates the calibration value when the SysTick counter runs on HCLK max/8 as external clock. The value is product dependent, please refer to the Product Reference Manual, SysTick Calibration Value section. When HCLK is programmed at the maximum frequency, the SysTick period is 1ms. If calibration information is not known, calculate the calibration value required from the frequency of the processor clock or external clock. </li></ul></li></ul> 
<h4 id="代码块">代码块</h4> 
<h5 id="systick配置代码">SysTick配置代码</h5> 
<pre class="prettyprint"><code class=" hljs perl">    /*
     * SystemFrequency / <span class="hljs-number">1000</span>    <span class="hljs-number">1</span>ms中断一次
     * SystemFrequency / <span class="hljs-number">100000</span>  <span class="hljs-number">10</span>us中断一次
     * SystemFrequency / <span class="hljs-number">1000000</span> <span class="hljs-number">1</span>us中断一次
     <span class="hljs-variable">*/</span>
void SysTick_Configuration(void)
{
<span class="hljs-comment">#if defined(__STM32F10x_LIB_H)</span>
    RCC_ClocksTypeDef RCC_Clocks;

    RCC_GetClocksFre<span class="hljs-string">q(&amp;RCC_Clocks)</span>;
        SysTick_SetReload((u32)RCC_Clocks.HCLK_Frequency / OS_TICKS_PER_SEC);<span class="hljs-regexp">//</span><span class="hljs-comment">#define OS_TICKS_PER_SEC 1000u</span>
    SysTick_CLKSourceConfig(SysTick_CLKSource_HCLK);
    SysTick_CounterCmd(SysTick_Counter_Enable);
    SysTick_ITConfig(ENABLE);
<span class="hljs-comment">#elif   defined(__STM32F4xx_H)</span>
    RCC_ClocksTypeDef RCC_Clocks;
    RCC_GetClocksFre<span class="hljs-string">q(&amp;RCC_Clocks)</span>;
  SysTick_Config(RCC_Clocks.HCLK_Frequency / OS_TICKS_PER_SEC);
<span class="hljs-comment">#else</span>
 <span class="hljs-comment">#error   SysTick_Configuration</span>
<span class="hljs-comment">#endif  </span>
}</code></pre> 
<h5 id="systickhandler">SysTickHandler</h5> 
<pre class="prettyprint"><code class=" hljs scss">void <span class="hljs-function">SysTickHandler(void)</span><span class="hljs-comment">// 1ms 时间基准</span>
{
  OS_CPU_SR cpu_sr;
    g_tickCount++;
    <span class="hljs-function">OS_ENTER_CRITICAL()</span>;
    OSIntNesting++;
    <span class="hljs-function">OS_EXIT_CRITICAL()</span>;
    <span class="hljs-function">OSTimeTick()</span>;
    <span class="hljs-function">OSIntExit()</span>;
}</code></pre> 
<h5 id="systickconfig">SysTick_Config</h5> 
<pre class="prettyprint"><code class=" hljs livecodeserver">static __INLINE uint32_t SysTick_Config(uint32_t <span class="hljs-built_in">ticks</span>)
{ 
  <span class="hljs-keyword">if</span> (<span class="hljs-built_in">ticks</span> &gt; SysTick_LOAD_RELOAD_Msk)  <span class="hljs-constant">return</span> (<span class="hljs-number">1</span>);            <span class="hljs-comment">/* Reload value impossible */</span>

  SysTick-&gt;LOAD  = (<span class="hljs-built_in">ticks</span> &amp; SysTick_LOAD_RELOAD_Msk) - <span class="hljs-number">1</span>;      <span class="hljs-comment">/* set reload register */</span>
  NVIC_SetPriority (SysTick_IRQn, (<span class="hljs-number">1</span>&lt;&lt;__NVIC_PRIO_BITS) - <span class="hljs-number">1</span>);  <span class="hljs-comment">/* set Priority for Cortex-M0 System Interrupts */</span>
  SysTick-&gt;VAL   = <span class="hljs-number">0</span>;                                          <span class="hljs-comment">/* Load the SysTick Counter Value */</span>
  SysTick-&gt;CTRL  = SysTick_CTRL_CLKSOURCE_Msk | 
                   SysTick_CTRL_TICKINT_Msk   | 
                   SysTick_CTRL_ENABLE_Msk;                    <span class="hljs-comment">/* Enable SysTick IRQ and SysTick Timer */</span>
  <span class="hljs-constant">return</span> (<span class="hljs-number">0</span>);                                                  <span class="hljs-comment">/* Function successful */</span>
}</code></pre> 
<blockquote> 
 <p>参考：<a href="http://blog.csdn.net/yueguang_16/article/details/7094678">http://blog.csdn.net/yueguang_16/article/details/7094678</a></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4a8955bb0ce5b97b14132f0c0fb4b444/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python3 判断列表是一个空列表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c4578abe193d1f3e796ab5bf8dff2dcf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux 安装mysql数据库——yum安装法2</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>