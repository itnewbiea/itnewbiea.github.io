<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ROS-Unity连接教程 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ROS-Unity连接教程" />
<meta property="og:description" content="本篇文章主要介绍基于ROS-TCP-Connector、ROS-TCP-Endpoint两个Unity接口与ROS进行通信的环境配置，并对官方给出的Unity和ROS相互通信示例中的消息部分做了说明
一、环境配置 参考：Unity-Robotics-Hub/setup.md at main · Unity-Technologies/Unity-Robotics-Hub (github.com)
Ununtu环境下
1.成功配置ros环境 2.下载ROS-TCP-Endpoint放在工作空间编译 ROS-TCP-Endpoint下载地址：Unity-Technologies/ROS-TCP-Endpoint: ROS package used to create an endpoint to accept ROS messages sent from a Unity scene using the ROS TCP Connector scripts (github.com)
Unity环境下
1.创建新项目，在Window/Package Manager下导入两个包(方式有两个，本地导入和URL导入) URL导入：
两个包：
https://github.com/Unity-Technologies/ROS-TCP-Connector.git?path=/com.unity.robotics.ros-tcp-connector https://github.com/Unity-Technologies/ROS-TCP-Connector.git?path=/com.unity.robotics.visualizations 导入成功结果如下：
因为URL是在线下载，可能会连接失败(但我多试了几次也成功了)。选择本地的方式也可以，把整个包下载到本地，然后选择这两个com包：
下载上面画的这两个，然后路径选择本地磁盘，点击之后，导入com文件夹下的package.json即可：
这个时候发现Unity上多了一个选项：
点击Robotics下面的ROS Settings进行配置，主要是两个ROS IP Address和ROS Port，关于ROS IP Address在ubuntu下用ifconfig查一下设置，然后端口任意了默认10000了
到目前为止，两方的环境配置就结束了。
二、demo环境配置 Ubuntu环境
下载这两个到同一个工作空间，然后catkin_make一下
下载路径：Unity-Robotics-Hub/tutorials/ros_unity_integration/ros_packages at main · Unity-Technologies/Unity-Robotics-Hub (github.com)
Unity环境下
点击“Robotics -&gt; Generate ROS Messages…”" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/612c70b45ce326bc254fe7c01e5ae060/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-25T11:33:54+08:00" />
<meta property="article:modified_time" content="2022-11-25T11:33:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ROS-Unity连接教程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>  本篇文章主要介绍基于ROS-TCP-Connector、ROS-TCP-Endpoint两个Unity接口与ROS进行通信的环境配置，并对官方给出的Unity和ROS相互通信示例中的消息部分做了说明</p> 
<h2><a id="_2"></a>一、环境配置</h2> 
<p>参考：<a href="https://github.com/Unity-Technologies/Unity-Robotics-Hub/blob/main/tutorials/ros_unity_integration/setup.md">Unity-Robotics-Hub/setup.md at main · Unity-Technologies/Unity-Robotics-Hub (github.com)</a></p> 
<p>  <mark>Ununtu环境下</mark></p> 
<h4><a id="emspemsp1ros_6"></a>  1.成功配置ros环境</h4> 
<h4><a id="emspemsp2ROSTCPEndpoint_7"></a>  2.下载ROS-TCP-Endpoint放在工作空间编译</h4> 
<p>  ROS-TCP-Endpoint下载地址：<a href="https://github.com/Unity-Technologies/ROS-TCP-Endpoint">Unity-Technologies/ROS-TCP-Endpoint: ROS package used to create an endpoint to accept ROS messages sent from a Unity scene using the ROS TCP Connector scripts (github.com)</a></p> 
<p>  <mark>Unity环境下</mark></p> 
<h4><a id="emspemsp1WindowPackage_ManagerURL_11"></a>  1.创建新项目，在Window/Package Manager下导入两个包(方式有两个，本地导入和URL导入)</h4> 
<p>  URL导入：<br> <img src="https://images2.imgbox.com/66/21/uQjdOOw1_o.png" alt="在这里插入图片描述"><br>   两个包：</p> 
<pre><code class="prism language-javascript"><span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>Unity<span class="token operator">-</span>Technologies<span class="token operator">/</span><span class="token constant">ROS</span><span class="token operator">-</span><span class="token constant">TCP</span><span class="token operator">-</span>Connector<span class="token punctuation">.</span>git<span class="token operator">?</span>path<span class="token operator">=</span><span class="token operator">/</span>com<span class="token punctuation">.</span>unity<span class="token punctuation">.</span>robotics<span class="token punctuation">.</span>ros<span class="token operator">-</span>tcp<span class="token operator">-</span>connector
<span class="token literal-property property">https</span><span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>github<span class="token punctuation">.</span>com<span class="token operator">/</span>Unity<span class="token operator">-</span>Technologies<span class="token operator">/</span><span class="token constant">ROS</span><span class="token operator">-</span><span class="token constant">TCP</span><span class="token operator">-</span>Connector<span class="token punctuation">.</span>git<span class="token operator">?</span>path<span class="token operator">=</span><span class="token operator">/</span>com<span class="token punctuation">.</span>unity<span class="token punctuation">.</span>robotics<span class="token punctuation">.</span>visualizations
</code></pre> 
<p>  导入成功结果如下：<br> <img src="https://images2.imgbox.com/38/93/C3ynvcjk_o.png" alt="在这里插入图片描述"><br>   因为URL是在线下载，可能会连接失败(但我多试了几次也成功了)。选择本地的方式也可以，把整个包下载到本地，然后选择这两个com包：<br> <img src="https://images2.imgbox.com/b9/5a/zEDTBTVZ_o.png" alt="在这里插入图片描述"><br>   下载上面画的这两个，然后路径选择本地磁盘，点击之后，导入com文件夹下的package.json即可：<br> <img src="https://images2.imgbox.com/f5/23/GqrBjnsk_o.png" alt="在这里插入图片描述"><br>   这个时候发现Unity上多了一个选项：<br> <img src="https://images2.imgbox.com/b5/59/RQEybAWN_o.png" alt="在这里插入图片描述"><br>   点击Robotics下面的ROS Settings进行配置，主要是两个ROS IP Address和ROS Port，关于ROS IP Address在ubuntu下用ifconfig查一下设置，然后端口任意了默认10000了<br> <img src="https://images2.imgbox.com/f9/6c/pplkXRr2_o.png" alt="在这里插入图片描述"><br>   到目前为止，两方的环境配置就结束了。</p> 
<h2><a id="demo_31"></a>二、demo环境配置</h2> 
<p>  <mark>Ubuntu环境</mark><br>   下载这两个到同一个工作空间，然后catkin_make一下<br>   下载路径：<a href="https://github.com/Unity-Technologies/Unity-Robotics-Hub/tree/main/tutorials/ros_unity_integration/ros_packages">Unity-Robotics-Hub/tutorials/ros_unity_integration/ros_packages at main · Unity-Technologies/Unity-Robotics-Hub (github.com)</a><br> <img src="https://images2.imgbox.com/53/6b/oW1IvnAy_o.png" alt="在这里插入图片描述"><br>   <mark>Unity环境下</mark><br>   点击“Robotics -&gt; Generate ROS Messages…”<br> <img src="https://images2.imgbox.com/8d/60/yFiUbPM4_o.png" alt="在这里插入图片描述"><br>   那个ROS message path是把整个项目下载下来，然后选择tutorials/ros_unity_integration/ros_packages/unity_robotics_demo_msgs文件夹，最后再Build两个一下(为了换成C#文件)</p> 
<h2><a id="Unityros_41"></a>三、实例：Unity发布，ros订阅</h2> 
<h4><a id="emspemsp1ubuntuIPIP_42"></a>  1.ubuntu端先查一下IP(根据自己的IP地址实际替换)</h4> 
<p>  然后执行：</p> 
<pre><code class="prism language-javascript">roslaunch ros_tcp_endpoint endpoint<span class="token punctuation">.</span>launch tcp_ip<span class="token operator">:</span><span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.178</span><span class="token number">.134</span> <span class="token literal-property property">tcp_port</span><span class="token operator">:</span><span class="token operator">=</span><span class="token number">10000</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/55/e9/cR3ze4HF_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="emspemsp2UnityRosPublisherExampleCubeCube_48"></a>  2.Unity端建立空物体挂载文件（命名：RosPublisherExample）把以下代码放进去，再新建一个Cube，把Cube做参数传入文件</h4> 
<pre><code class="prism language-javascript">using UnityEngine<span class="token punctuation">;</span>
using Unity<span class="token punctuation">.</span>Robotics<span class="token punctuation">.</span>ROSTCPConnector<span class="token punctuation">;</span>
using RosMessageTypes<span class="token punctuation">.</span>UnityRoboticsDemo<span class="token punctuation">;</span>

<span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">///</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RosPublisherExample</span> <span class="token operator">:</span> MonoBehaviour
<span class="token punctuation">{<!-- --></span>
    ROSConnection ros<span class="token punctuation">;</span>
    <span class="token keyword">public</span> string topicName <span class="token operator">=</span> <span class="token string">"pos_rot"</span><span class="token punctuation">;</span>

    <span class="token comment">// The game object</span>
    <span class="token keyword">public</span> GameObject cube<span class="token punctuation">;</span>
    <span class="token comment">// Publish the cube's position and rotation every N seconds</span>
    <span class="token keyword">public</span> float publishMessageFrequency <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">.</span>5f<span class="token punctuation">;</span>

    <span class="token comment">// Used to determine how much time has elapsed since the last message was published</span>
    <span class="token keyword">private</span> float timeElapsed<span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// start the ROS connection</span>
        ros <span class="token operator">=</span> ROSConnection<span class="token punctuation">.</span><span class="token function">GetOrCreateInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ros<span class="token punctuation">.</span>RegisterPublisher<span class="token operator">&lt;</span>PosRotMsg<span class="token operator">&gt;</span><span class="token punctuation">(</span>topicName<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">Update</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        timeElapsed <span class="token operator">+=</span> Time<span class="token punctuation">.</span>deltaTime<span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>timeElapsed <span class="token operator">&gt;</span> publishMessageFrequency<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            cube<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation <span class="token operator">=</span> Random<span class="token punctuation">.</span>rotation<span class="token punctuation">;</span>

            PosRotMsg cubePos <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PosRotMsg</span><span class="token punctuation">(</span>
                cube<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
                cube<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
                cube<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>position<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
                cube<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>x<span class="token punctuation">,</span>
                cube<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>y<span class="token punctuation">,</span>
                cube<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>z<span class="token punctuation">,</span>
                cube<span class="token punctuation">.</span>transform<span class="token punctuation">.</span>rotation<span class="token punctuation">.</span>w
            <span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// Finally send the message to server_endpoint.py running in ROS</span>
            ros<span class="token punctuation">.</span><span class="token function">Publish</span><span class="token punctuation">(</span>topicName<span class="token punctuation">,</span> cubePos<span class="token punctuation">)</span><span class="token punctuation">;</span>

            timeElapsed <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="3unity_104"></a>3.unity运行</h4> 
<p>  运行时出现下面的框，为蓝色时代表连接成功，红色是失败<br> <img src="https://images2.imgbox.com/56/39/ZO60QIse_o.png" alt="在这里插入图片描述"><br>   同时ubuntu那边也有显示：<br> <img src="https://images2.imgbox.com/2f/31/3TmiLW4x_o.png" alt="在这里插入图片描述"><br>   然后rostopic echo pos_rot，可以看到输出</p> 
<h2><a id="rosUnity_111"></a>四、实例：ros发布，Unity订阅</h2> 
<h4><a id="emspemsp1_ubuntuIPIP_112"></a>  1. ubuntu端先查一下IP(根据自己的IP地址实际替换)</h4> 
<p>  然后执行：</p> 
<pre><code class="prism language-javascript">roslaunch ros_tcp_endpoint endpoint<span class="token punctuation">.</span>launch tcp_ip<span class="token operator">:</span><span class="token operator">=</span><span class="token number">192.168</span><span class="token number">.178</span><span class="token number">.134</span> <span class="token literal-property property">tcp_port</span><span class="token operator">:</span><span class="token operator">=</span><span class="token number">10000</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/8f/uLULZw7d_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="emspemsp2UnityRosSubscriberExampleCubeCube_118"></a>  2.Unity端建立空物体挂载文件（命名：RosSubscriberExample）把以下代码放进去，再新建一个Cube，把Cube做参数传入文件</h4> 
<pre><code class="prism language-javascript">using UnityEngine<span class="token punctuation">;</span>
using Unity<span class="token punctuation">.</span>Robotics<span class="token punctuation">.</span>ROSTCPConnector<span class="token punctuation">;</span>
using RosColor <span class="token operator">=</span> RosMessageTypes<span class="token punctuation">.</span>UnityRoboticsDemo<span class="token punctuation">.</span>UnityColorMsg<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RosSubscriberExample</span> <span class="token operator">:</span> MonoBehaviour
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> GameObject cube<span class="token punctuation">;</span>

    <span class="token keyword">void</span> <span class="token function">Start</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        ROSConnection<span class="token punctuation">.</span><span class="token function">GetOrCreateInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Subscribe<span class="token operator">&lt;</span>RosColor<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token string">"color"</span><span class="token punctuation">,</span> ColorChange<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">void</span> <span class="token function">ColorChange</span><span class="token punctuation">(</span><span class="token parameter">RosColor colorMessage</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        cube<span class="token punctuation">.</span>GetComponent<span class="token operator">&lt;</span>Renderer<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>material<span class="token punctuation">.</span>color <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Color32</span><span class="token punctuation">(</span><span class="token punctuation">(</span>byte<span class="token punctuation">)</span>colorMessage<span class="token punctuation">.</span>r<span class="token punctuation">,</span> <span class="token punctuation">(</span>byte<span class="token punctuation">)</span>colorMessage<span class="token punctuation">.</span>g<span class="token punctuation">,</span> <span class="token punctuation">(</span>byte<span class="token punctuation">)</span>colorMessage<span class="token punctuation">.</span>b<span class="token punctuation">,</span> <span class="token punctuation">(</span>byte<span class="token punctuation">)</span>colorMessage<span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="emspemsp3unity_139"></a>  3.unity运行</h4> 
<p>  运行时出现下面的框，为蓝色时代表连接成功，红色是失败<br> <img src="https://images2.imgbox.com/41/58/PHUjW0JS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="emspemsp4ubuntu_142"></a>  4.ubuntu端再执行：</h4> 
<pre><code class="prism language-javascript">rosrun unity_robotics_demo color_publisher<span class="token punctuation">.</span>py
</code></pre> 
<p>  运行一次Unity中物体改变一次颜色</p> 
<p>完活~</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/803babeecd9fe7287feca2b56d69e210/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【精】简单 就一个类 ---使用MyBatis Generator自动生成代码(com.baomidou.mybatisplus)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b92c592a4630c59a683f77edffaf8350/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【linux】物理磁盘挂载目录——(分区、格式化、重启自动挂载)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>