<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>责任链模式及其使用场景 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="责任链模式及其使用场景" />
<meta property="og:description" content="责任链模式及其使用场景 1.责任链模式定义2. 责任链模式使用场景3. 责任链模式实现3.1 简单实现3.2 扩展实现 4. 责任链模式实战5. 总结 1.责任链模式定义 责任链模式(Iterator Pattern), 是行为型设计模式之一。这种模型结构有点类似现实生活中铁链，由一个个铁环首尾相接构成一条链，如果这种结构用在编程领域，则每个节点可以看做一个对象，每个对象有不同的处理逻辑，将一个请求从链的首端发出，沿着链的路径依次传递每个节点对象，直到有对象处理这个请求为止，我们将这样一种模式称为责任链模式。
2. 责任链模式使用场景 1.多个对象可以处理同一个请求，但具体由哪个对象处理则在运行时动态决定。
2. 在请求处理者不明确的情况下向对个对象中的一个提交一个请求。
3. 需要动态处理一组对象处理请求。
3. 责任链模式实现 3.1 简单实现 下图是简单实现的责任链模式类UML图
角色介绍
AbsHandler：抽象处理者角色，声明一个请求处理的方法，并在其中保持一个对下一个处理节点Handler对象的引用。
ConcreteHandler：具体处理者角色，对请求进行处理，如果不能处理则将该请求转发给下一个节点上的处理对象。
定义抽象Handler public abstract class AbsHandler { protected AbsHandler successor; public abstract void handleRequest(String condition); } 定义具体实现ConcreteHandler1 及ConcreteHandler2 public class ConcreteHandler1 extends AbsHandler { @Override public void handleRequest(String condition) { if(condition.equals(&#34;ConcreteHandler1&#34;)){ return; }else{ successor.handleRequest(condition); } } } public class ConcreteHandler2 extends AbsHandler { @Override public void handleRequest(String condition) { if(condition." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e78b7edd0bd9e95a1f5ec3c0dc830f5e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-22T17:37:06+08:00" />
<meta property="article:modified_time" content="2019-04-22T17:37:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">责任链模式及其使用场景</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>责任链模式及其使用场景</h4> 
 <ul><li><a href="#1_2" rel="nofollow">1.责任链模式定义</a></li><li><a href="#2__4" rel="nofollow">2. 责任链模式使用场景</a></li><li><a href="#3__8" rel="nofollow">3. 责任链模式实现</a></li><li><ul><li><a href="#31__9" rel="nofollow">3.1 简单实现</a></li><li><a href="#32__69" rel="nofollow">3.2 扩展实现</a></li></ul> 
  </li><li><a href="#4__242" rel="nofollow">4. 责任链模式实战</a></li><li><a href="#5__361" rel="nofollow">5. 总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1_2"></a>1.责任链模式定义</h2> 
<p>责任链模式(Iterator Pattern), 是行为型设计模式之一。这种模型结构有点类似现实生活中铁链，由一个个铁环首尾相接构成一条链，如果这种结构用在编程领域，则每个节点可以看做一个对象，每个对象有不同的处理逻辑，将一个请求从链的首端发出，沿着链的路径依次传递每个节点对象，直到有对象处理这个请求为止，我们将这样一种模式称为责任链模式。</p> 
<h2><a id="2__4"></a>2. 责任链模式使用场景</h2> 
<p>1.多个对象可以处理同一个请求，但具体由哪个对象处理则在运行时动态决定。<br> 2. 在请求处理者不明确的情况下向对个对象中的一个提交一个请求。<br> 3. 需要动态处理一组对象处理请求。</p> 
<h2><a id="3__8"></a>3. 责任链模式实现</h2> 
<h3><a id="31__9"></a>3.1 简单实现</h3> 
<p>下图是简单实现的责任链模式类UML图<br> <img src="https://images2.imgbox.com/11/e5/GpfYYBpz_o.png" alt="在这里插入图片描述"><br> 角色介绍<br> AbsHandler：抽象处理者角色，声明一个请求处理的方法，并在其中保持一个对下一个处理节点Handler对象的引用。<br> ConcreteHandler：具体处理者角色，对请求进行处理，如果不能处理则将该请求转发给下一个节点上的处理对象。</p> 
<ol><li>定义抽象Handler</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbsHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">protected</span> AbsHandler successor<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>String condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>定义具体实现<code>ConcreteHandler1</code> 及<code>ConcreteHandler2</code></li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteHandler1</span> <span class="token keyword">extends</span> <span class="token class-name">AbsHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>String condition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"ConcreteHandler1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            successor<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConcreteHandler2</span> <span class="token keyword">extends</span> <span class="token class-name">AbsHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>String condition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>condition<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"ConcreteHandler2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            successor<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>condition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>Client端调用</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handlerRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        AbsHandler handler1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteHandler1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AbsHandler handler2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ConcreteHandler2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        handler1<span class="token punctuation">.</span>successor <span class="token operator">=</span> handler2<span class="token punctuation">;</span>
        handler2<span class="token punctuation">.</span>successor <span class="token operator">=</span> handler1<span class="token punctuation">;</span>

        handler1<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token string">"ConcreteHandler2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>传入的"ConcreteHandler2"最终有Handler2完成处理。</p> 
<h3><a id="32__69"></a>3.2 扩展实现</h3> 
<p>简化版实现中我们的请求对象只是一个字符串，多数情况下，责任链中请求和对应处理规则是不尽相同的，在这种情况下可以将请求进行封装，同时对请求的处理规则也进行封装作为一个独立的对象。<br> 下图是扩展后的责任链模式的类UML图<br> <img src="https://images2.imgbox.com/d4/08/anO1NgHS_o.png" alt="在这里插入图片描述"><br> 在AbstractHandler抽象处理者中，其声明了处理者对象处理请求的方法和获取处理级别的方法，并对具体处理转发逻辑进行实现。</p> 
<ol><li>定义<code>AbstractHandler</code></li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">protected</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String TAG <span class="token operator">=</span> AbstractHandler<span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> AbstractHandler nextHandler<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">final</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span>AbstractRequest request<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getHandleLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> request<span class="token punctuation">.</span><span class="token function">getRequestLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">handle</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>nextHandler<span class="token operator">!=</span>null<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                nextHandler<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                <span class="token comment">//当所有处理者对象均不能处理该请求时输出</span>
                Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span><span class="token string">"All of handler can not handle the request"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">getHandleLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>AbstractRequest request<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>定义<code>AbstractRequest</code>类</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbstractRequest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> Object object<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">AbstractRequest</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>object <span class="token operator">=</span> object<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> Object <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> object<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">int</span> <span class="token function">getRequestLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>定义Handler类具体实现</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Handler1</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">getHandleLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>AbstractRequest request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Handler1 handler request:"</span><span class="token operator">+</span>request<span class="token punctuation">.</span><span class="token function">getRequestLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Handler2</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">getHandleLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>AbstractRequest request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Handler2 handler request:"</span><span class="token operator">+</span>request<span class="token punctuation">.</span><span class="token function">getRequestLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Handler3</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">int</span> <span class="token function">getHandleLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">handle</span><span class="token punctuation">(</span>AbstractRequest request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"Handler3 handler request:"</span><span class="token operator">+</span>request<span class="token punctuation">.</span><span class="token function">getRequestLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>定义Request类具体实现</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Request1</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRequest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getRequestLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">Request1</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Object <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Request2</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRequest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getRequestLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">Request2</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Object <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Request3</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractRequest</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getRequestLevel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">3</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">Request3</span><span class="token punctuation">(</span>Object object<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> Object <span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="5"><li>Client建立责任链处理请求</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">handleRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        AbstractHandler handler1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AbstractHandler handler2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AbstractHandler handler3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        handler1<span class="token punctuation">.</span>nextHandler <span class="token operator">=</span> handler2<span class="token punctuation">;</span>
        handler2<span class="token punctuation">.</span>nextHandler <span class="token operator">=</span> handler3<span class="token punctuation">;</span>

        <span class="token comment">//构造三个请求者对象</span>
        AbstractRequest request1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request1</span><span class="token punctuation">(</span><span class="token string">"Request1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AbstractRequest request2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request2</span><span class="token punctuation">(</span><span class="token string">"Request2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        AbstractRequest request3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Request3</span><span class="token punctuation">(</span><span class="token string">"Request3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//总是从链式的首端发起请求</span>
        handler1<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>request1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        handler1<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>request2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        handler1<span class="token punctuation">.</span><span class="token function">handleRequest</span><span class="token punctuation">(</span>request3<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="4__242"></a>4. 责任链模式实战</h2> 
<p>在实际开发中，经常会出现在一个DbusReceiver或者BroadcastReceiver中处理所有的Signals或者Actions，通过if…else来区分不同的signal或者Action，这样虽然简单，但是将所有的业务处理方法一个类中处理，不免会造成业务结构不清晰、代码冗长难懂。一种可行的方法就是通过责任链模式设计，将业务做拆分，将同一类型的业务放到一个单独类中处理，这样的处理能极大优化代码结构，使得业务逻辑更加清晰。DbusReceiver及BroadcastReceiver只作为消息的分发中心，每接收到一个信号或者action，将其交给责任链处理，各个责任链只负责处理自己关心的Signal或者Action。</p> 
<p>对于Dbus的接收的责任链模式实现如下：</p> 
<ol><li>定义处理Signal的AbstractHandler</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">AbsDbusHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">protected</span> <span class="token keyword">final</span> Context mContext<span class="token punctuation">;</span>

    <span class="token keyword">protected</span> Handler mHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Handler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> AbsDbusHandler nextHandler<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">AbsDbusHandler</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mContext <span class="token operator">=</span> context<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">boolean</span> <span class="token function">handle</span><span class="token punctuation">(</span>String sigName<span class="token punctuation">,</span> <span class="token keyword">int</span> argLength<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>DbusObj<span class="token punctuation">&gt;</span></span> argList<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">protected</span> String <span class="token function">getTag</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getSimpleName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<ol start="2"><li>定义处理Signal的具体Handler</li></ol> 
<pre><code class="prism language-java"><span class="token comment">处理Upgrade相关的Signal</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UpgradeSignalsHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbsDbusHandler</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token function">UpgradeSignalsHandler</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">handle</span><span class="token punctuation">(</span>String sigName<span class="token punctuation">,</span> <span class="token keyword">int</span> argLength<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>DbusObj<span class="token punctuation">&gt;</span></span> argList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>sigName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>DbusSignal<span class="token punctuation">.</span>SIGNAL_UPGEADE<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//do some thing</span>
           
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
              <span class="token comment">// other thing</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nextHandler <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> nextHandler<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>sigName<span class="token punctuation">,</span> argLength<span class="token punctuation">,</span> argList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//处理MetaSwitch相关的Signal</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MetaSwitchSignalsHandler</span> <span class="token keyword">extends</span> <span class="token class-name">AbsDbusHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> Thread checkDevState<span class="token punctuation">;</span>


    <span class="token keyword">public</span> <span class="token function">MetaSwitchSignalsHandler</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">handle</span><span class="token punctuation">(</span>String sigName<span class="token punctuation">,</span> <span class="token keyword">int</span> argLength<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>DbusObj<span class="token punctuation">&gt;</span></span> argList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>sigName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>DbusSignal<span class="token punctuation">.</span>SIGNAL_METASWITCH_REQ_LOGIN<span class="token punctuation">)</span><span class="token operator">||</span>
        sigName<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>DbusSignal<span class="token punctuation">.</span>SIGNAL_METASWITCH_LOGIN_ERROR<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//do some thing</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nextHandler <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> nextHandler<span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>sigName<span class="token punctuation">,</span> argLength<span class="token punctuation">,</span> argList<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li>通过一个简单工厂方法创建一个责任链</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HandlerChainFactory</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> AbsDbusHandler dbusHandler<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> AbsDbusHandler <span class="token function">productDbusChain</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

        <span class="token keyword">if</span><span class="token punctuation">(</span>dbusHandler <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            AbsDbusHandler metaSwitchSignalsHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MetaSwitchSignalsHandler</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            AbsDbusHandler audioSignalsHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioSignalsHandler</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            AbsDbusHandler upgradeSignalsHandler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UpgradeSignalsHandler</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
            metaSwitchSignalsHandler<span class="token punctuation">.</span>nextHandler <span class="token operator">=</span> audioSignalsHandler<span class="token punctuation">;</span>
            audioSignalsHandler<span class="token punctuation">.</span>nextHandler <span class="token operator">=</span> upgradeSignalsHandler<span class="token punctuation">;</span>
            dbusHandler <span class="token operator">=</span> metaSwitchSignalsHandler<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> dbusHandler<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<ol start="4"><li>Client调用责任链处理Signal</li></ol> 
<pre><code class="prism language-java"><span class="token keyword">private</span> DbusCallback dbusCallback <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DbusCallback</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onCallback</span><span class="token punctuation">(</span><span class="token keyword">int</span> sigId<span class="token punctuation">,</span> String sigName<span class="token punctuation">,</span> <span class="token keyword">int</span> argNum<span class="token punctuation">,</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>DbusObj<span class="token punctuation">&gt;</span></span> argList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">getDbusHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">handle</span><span class="token punctuation">(</span>sigName<span class="token punctuation">,</span> argNum<span class="token punctuation">,</span> argList<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//责任没有处理的信号在这里处理</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>对于Action的接收的责任链模式实现：<br> 基本思路和Dbus Signal处理类似，Receiver只是作为一个消息分发中心，每次接收到一个Intent，将其传入到责任链中进行处理。</p> 
<h2><a id="5__361"></a>5. 总结</h2> 
<p>责任链中一个处理者对象，其中只有两个行为，一是处理请求，二是将请求转送给下一个节点，不允许某个处理者对象在处理了请求后又将请求转送给上一个节点的情况。对于一条责任链来说，一个请求最终只有两种情况，一是被某个处理对象所处理，另一个是所有对象均未对其处理，前一种情况称该责任链为纯的责任链，对于后一种情况称为不纯的责任链，实际应用中，多为不纯的责任链。</p> 
<p>责任链在Android源码中比较类似的实现莫过于View的事件分发处理，对于触摸事件，Android总是从VIewTree最顶端，从上而下处理，具体处理流程主要通过<code>dispatchTouchEvent</code> 、<code>onTouchEvent</code> 等函数处理，具体可以查看相关源码。ViewGroup事件投递的递归调用类似一条责任链，一旦其寻找到责任者，那么将有责任者持有并消费掉该次事件，具体体现在View的onTouchEvent方法中返回值的设置，如果onTouchEvent返回False，那么意味着当前View不会是该次事件的责任人，将不会对其持有：如果为true则相反，此时View会持有该事件并不再向外传递。</p> 
<p>另外，著名的OKHttp3框架及Netty NIO框架也都使用了责任链模式设计。OkHttp3中Interceptor以及Netty中ChannelInboundHandlerAdapter都是责任链模式设计的典型。那么可以总结为责任链模式是处理数据流比较好的模式设计。<br> 附一张OkHttp实现原理图<br> <img src="https://images2.imgbox.com/6c/e5/IsI96KZa_o.jpg" alt="在这里插入图片描述"></p> 
<p>如果你愿意，所有的if…else语句及switc…case语句你都可以使用责任链模式进行改造，但是大部分情况下，这样做都是不必要的。而只有当过多的if…else分支导致代码难以维护时，考虑使用责任链模式进行业务拆分。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3e0151e44cc9a0a7f2dcf34a62e5b578/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">postcss-px2rem配置</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8380bc0a860f2e923a9c0c65145235a1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Volatile与CAS的底层原理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>