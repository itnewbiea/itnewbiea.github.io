<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>5.FastAPI显式声明参数 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="5.FastAPI显式声明参数" />
<meta property="og:description" content="5.FastAPI显式声明参数 FastAPI允许显式声明参数属于查询参数、路径参数或者请求体；同时还可以为参数声明默认值、额外的信息及校验；也允许显式声明可选参数；
5.1可选参数 可选参数的显式声明使用 typing. Optional来声明；代码如下：
# coding: utf-8 ​ from typing import Optional from fastapi import FastAPI ​ app = FastAPI() ​ @app.get(path=&#39;/add/{vara}/{varb}&#39;) async def add(vara: int, varb: int, x: Optional[int]=2, y: Optional[int] = 5): return {&#39;added&#39;: vara &#43; varb, &#39;multiply&#39;: x * y} 执行请求：
curl http://127.0.0.1:8000/add/1/2 {&#34;added&#34;:3,&#34;multiply&#34;:10} 5.2查询参数 查询参数使用fastapi的Query来声明，声明时可以指定默认值，代码如下：
from typing import Optional from fastapi import FastAPI from fastapi import Query ​ app = FastAPI() ​ @app.get(path=&#39;/add/{vara}/{varb}&#39;) async def add(vara: int, varb: int, x: Optional[int]=Query(2), y: Optional[int]=Query(5)): return {&#39;added&#39;: vara &#43; varb, &#39;multiply&#39;: x * y} 上面的代码中使用 Query(2) 替换默认值 2，Query 的第一个参数也是用于定义默认值的，当使用Query声明必须参数时，可以将 ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8bce6c0bd2bd00931f5ed10db8847292/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-12T15:28:28+08:00" />
<meta property="article:modified_time" content="2022-01-12T15:28:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">5.FastAPI显式声明参数</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>5.FastAPI显式声明参数</h2> 
<p>FastAPI允许显式声明参数属于查询参数、路径参数或者请求体；同时还可以为参数声明默认值、额外的信息及校验；也允许显式声明可选参数；</p> 
<h3>5.1可选参数</h3> 
<p>可选参数的显式声明使用 typing. Optional来声明；代码如下：</p> 
<pre># coding: utf-8
​
from typing import Optional
from fastapi import FastAPI
​
app = FastAPI()
​
@app.get(path='/add/{vara}/{varb}')
async def add(vara: int, varb: int, x: Optional[int]=2, y: Optional[int] = 5):
    return {'added': vara + varb, 'multiply': x * y}</pre> 
<p>执行请求：</p> 
<pre>curl http://127.0.0.1:8000/add/1/2
{"added":3,"multiply":10}</pre> 
<h3>5.2查询参数</h3> 
<p>查询参数使用fastapi的Query来声明，声明时可以指定默认值，代码如下：</p> 
<pre>from typing import Optional
from fastapi import FastAPI
from fastapi import Query
​
app = FastAPI()
​
@app.get(path='/add/{vara}/{varb}')
async def add(vara: int, varb: int, x: Optional[int]=Query(2), y: Optional[int]=Query(5)):
    return {'added': vara + varb, 'multiply': x * y}</pre> 
<p>上面的代码中使用 Query(2) 替换默认值 2，Query 的第一个参数也是用于定义默认值的，当使用Query声明必须参数时，可以将 ... 用作第一个参数值，代码如下：</p> 
<pre>from fastapi import FastAPI
from fastapi import Query
​
app = FastAPI()
​
@app.get(path='/add/{vara}/{varb}')
async def add(vara: int, varb: int, x: int=Query(...), y: int=Query(...)):
    return {'added': vara + varb, 'multiply': x * y}</pre> 
<p>执行请求：</p> 
<pre>curl http://127.0.0.1:8000/add/1/2
{
    "detail":[
        {
            "loc":["query","x"],
            "msg":"field required",
            "type":"value_error.missing"
        },{
            "loc":["query","y"],
            "msg":"field required",
            "type":"value_error.missing"
        }
    ]
}</pre> 
<h3>5.3路径参数</h3> 
<p>路径参数使用fastapi的Path来声明。由于路径参数是路径的一部分，所以路径参数一定是必需的。在声明路径参数时使用 ... 将其标记为必需参数。但实际上，即使使用 None 声明路径参数或设置一个其他默认值也不会有任何影响，仍然会是必需参数。代码如下：</p> 
<pre>from typing import Optional
from fastapi import FastAPI
from fastapi import Query
from fastapi import Path
​
app = FastAPI()
​
@app.get(path='/add/{vara}/{varb}')
async def add(vara: int=Path(...), varb: int=Path(...), x: Optional[int]=Query(2), y: Optional[int]=Query(5)):
    return {'added': vara + varb, 'multiply': x * y}</pre> 
<p>执行请求：</p> 
<pre>curl http://127.0.0.1:8000/add/1/2
{"added":3,"multiply":10}</pre> 
<h3>5.4请求体</h3> 
<p>路径参数使用fastapi的Body来声明。当在请求体中出现单一值而不是对象时，使用Body显式声明为请求体是有必要的。代码如下：</p> 
<pre>from fastapi import FastAPI
from pydantic import BaseModel
​
class Add(BaseModel):
    a: int
    b: int
​
class Mul(BaseModel):
    x: int
    y: int
​
app = FastAPI()
​
@app.post(path='/calc')
async def calc(add: Add, mul: Mul, index: int):
    return {'added': add.a + add.b, 'multiply': mul.x * mul.y, index: index}</pre> 
<p>执行请求：</p> 
<pre>curl -H "Content-Type: application/json" -X POST -d "{\"add\": {\"a\":2, \"b\":3}, \"mul\": {\"x\":2, \"y\":3}, \"index\": 1018}" http://127.0.0.1:8000/calc
{
    "detail":[
        {
            "loc":["query","index"],
            "msg":"field required",
            "type":"value_error.missing"
        }
    ]
}</pre> 
<p>上面的代码中，index参数被解析为查询参数，所以在执行请求时会报错，将代码修改如下：</p> 
<pre>from fastapi import FastAPI
from fastapi import Body
from pydantic import BaseModel
​
class Add(BaseModel):
    a: int
    b: int
​
class Mul(BaseModel):
    x: int
    y: int
​
app = FastAPI()
​
@app.post(path='/calc')
async def calc(add: Add, mul: Mul, index: int=Body(...)):
    return {'added': add.a + add.b, 'multiply': mul.x * mul.y, index: index}</pre> 
<p>执行请求：</p> 
<pre>curl -H "Content-Type: application/json" -X POST -d "{\"add\": {\"a\":2, \"b\":3}, \"mul\": {\"x\":2, \"y\":3}, \"index\": 1018}" http://127.0.0.1:8000/calc
{"added":5,"multiply":6,"1018":1018}</pre> 
<p>对于单个请求体来说，路由的请求体直接使用字段的key/value即可，但对于多个请求体，就向上面的例子，路由的请求体必须是嵌套式的，具体如下：</p> 
<p>单个请求体，类似于：</p> 
<pre>{ 
    "key1": "value1",    
    "key2": "value2",
    ......    
} </pre> 
<p>多个请求体，类似于：</p> 
<pre>{
    "key_1":{ 
        "key1": "value1",    
        "key2": "value2",
        ......    
    },
    "key_2":{ 
        "key1": "value1",    
        "key2": "value2",
        ......    
    },
    ......
}</pre> 
<p>如果希望单个请求体也使用嵌套式，则在声明Body时，使用embed参数，代码如下：</p> 
<pre>from fastapi import FastAPI
from fastapi import Body
from pydantic import BaseModel
​
class Add(BaseModel):
    a: int
    b: int
​
app = FastAPI()
​
@app.post(path='/calc')
async def calc(add: Add=Body(..., embed=True)):
    return {'added': add.a + add.b}</pre> 
<p>执行请求：</p> 
<pre>curl -H "Content-Type: application/json" -X POST -d "{\"a\":2, \"b\":3}" http://127.0.0.1:8000/calc
{
    "detail":[
        {
            "loc":["body","add"],
            "msg":"field required",
            "type":"value_error.missing"
        }
    ]
}
curl -H "Content-Type: application/json" -X POST -d "{\"add\": {\"a\":2, \"b\":3}}" http://127.0.0.1:8000/calc
{"added":5}</pre> 
<h3>5.5请求体字段的显式声明</h3> 
<p>请求体中的字段可以使用Pydantic的Field在Pydantic模型定义时声明。 Field 是直接从pydantic导入的，而不像Query、Path和Body 都从 fastapi 导入的。</p> 
<pre>from typing import Optional
from fastapi import FastAPI
from fastapi import Body
from pydantic import BaseModel
from pydantic import Field
​
class Add(BaseModel):
    a: Optional[int] = Field(1)
    b: int = Field(...)
​
app = FastAPI()
​
@app.post(path='/calc')
async def calc(add: Add=Body(..., embed=True)):
    return {'added': add.a + add.b}</pre> 
<p>执行请求：</p> 
<pre>curl -H "Content-Type: application/json" -X POST -d "{\"add\": {\"b\":5}}" http://127.0.0.1:8000/calc
{"added":6}</pre> 
<p></p> 
<h3>5.6参数的附加信息</h3> 
<p>参数的附加信息主要用于API文档。</p> 
<p>元数据：</p> 
<ul><li> <p>alias 别名，当参数名称是一个非 有效的 Python 变量名称时，可以使用alias标识别名</p> </li><li> <p>title 标题</p> </li><li> <p>description 描述</p> </li><li> <p>deprecated 启用，当参数在一段时间内保留，但希望文档中标识为已弃用时使用</p> </li></ul> 
<p>代码示例：</p> 
<pre>from typing import Optional
from fastapi import FastAPI
from fastapi import Body
from pydantic import BaseModel
from pydantic import Field
​
class Add(BaseModel):
    a: Optional[int] = Field(1, title='参数a', description='加数', alias='x')
    b: int = Field(..., title='参数b', description='被加数', alias='y')
​
app = FastAPI()
​
@app.post(path='/calc')
async def calc(add: Add=Body(..., embed=True)):
    return {'added': add.a + add.b}</pre> 
<p>API文档</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/de/ed/AqXQJujj_o.png"></p> 
<p></p> 
<p></p> 
<p>执行请求：</p> 
<pre>curl -H "Content-Type: application/json" -X POST -d "{\"add\": {\"x\":2,\"y\":5}}" http://127.0.0.1:8000/calc
{"added":7}</pre> 
<p></p> 
<h3>5.7参数的校验</h3> 
<p>声明字符串校验：</p> 
<ul><li> <p>min_length 最大长度</p> </li><li> <p>max_length 最小长度</p> </li><li> <p>regex 正则表达式</p> </li></ul> 
<p>声明数值校验：</p> 
<ul><li> <p>gt：大于（greater than）</p> </li><li> <p>ge：大于等于（greater than or equal）</p> </li><li> <p>lt：小于（less than）</p> </li><li> <p>le：小于等于（less than or equal）</p> </li></ul> 
<p>代码示例：</p> 
<pre>from typing import Optional
from fastapi import FastAPI
from fastapi import Body
from fastapi import Query
from pydantic import BaseModel
from pydantic import Field
​
class Add(BaseModel):
    a: Optional[int] = Field(1, title='参数a', description='加数', alias='x', gt=100)
    b: int = Field(..., title='参数b', description='被加数', alias='y', ge=200)
​
app = FastAPI()
​
@app.post(path='/calc')
async def calc(add: Add=Body(..., embed=True), desc:str=Query(..., min_length=3, max_length=10)):
    return {desc: add.a + add.b}</pre> 
<p>执行请求：</p> 
<pre>curl -H "Content-Type: application/json" -X POST -d "{\"add\": {\"x\":2,\"y\":5}}" http://127.0.0.1:8000/calc?desc=ad
{
    "detail":[
        {
            "loc":["query","desc"],
            "msg":"ensure this value has at least 3 characters",
            "type":"value_error.any_str.min_length",
            "ctx":{
                "limit_value":3
            }
        },
        {
            "loc":["body","add","x"],
            "msg":"ensure this value is greater than 100",
            "type":"value_error.number.not_gt",
            "ctx":{
                "limit_value":100
            }
        },{
            "loc":["body","add","y"],
            "msg":"ensure this value is greater than or equal to 200",
            "type":"value_error.number.not_ge",
            "ctx":{
                "limit_value":200
            }
        }
    ]
}
curl -H "Content-Type: application/json" -X POST -d "{\"add\": {\"x\":260,\"y\":500}}" http://127.0.0.1:8000/calc?desc=add
{"add":760}</pre> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4d348982d4030cb46c38abc2df57ede0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Nginx 静态服务器作为下载服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a64f6b58fdc07c2f23a34164a67cc494/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IIS服务器部署ASP.NET MVC网站时报错 HTTP 错误 403.14 - Forbidden 解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>