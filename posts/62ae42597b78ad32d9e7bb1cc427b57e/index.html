<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL按年/月/周/日/小时分组查询、排序、limit、判空用法 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MySQL按年/月/周/日/小时分组查询、排序、limit、判空用法" />
<meta property="og:description" content="一、按年/月/周/日/小时分组查询（日期时间类型为date或者datetime） 在DATE_FORMAT(create_time,&#39;%Y%m%d&#39;)中设置需要分组的类型和格式，如下：
&#39;%Y%m%d&#39;表示：20221122
&#39;%Y-%m-%d&#39;表示：2022-11-22
可根据自己的需要设置，年月日都是如此
如下图user表
user idnameagebirthdaygendercreate_time1张三202000-01-01男2022-11-22 11:11:112李四212001-02-02男2022-11-19 00:00:003王五231999-05-06女2022-11-20 23:59:59 按日分组查询并排序 SELECT DATE_FORMAT(create_time,&#39;%Y-%m-%d&#39;) days,COUNT(id) FROM user WHERE create_time &gt; &#34;2022-11-11 00:00:00&#34; AND create_time &lt; &#34;2022-12-01 00:00:00&#34; GROUP BY days ORDER BY days DESC; 按周分组查询 SELECT DATE_FORMAT(create_time,&#39;%Y-%u&#39;) weeks,COUNT(id) FROM user GROUP BY weeks; 按月分组查询 SELECT DATE_FORMAT(create_time,&#39;%Y-%m&#39;) months,COUNT(id) FROM user GROUP BY months 按年分组查询 SELECT DATE_FORMAT(create_time,&#39;%Y&#39;) months,COUNT(id) FROM user GROUP BY years 按小时分组查询 SELECT DATE_FORMAT(create_time,&#39;%Y-%m-%d %H&#39;) hours,COUNT(id) FROM user WHERE create_time &gt; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/62ae42597b78ad32d9e7bb1cc427b57e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-22T16:06:21+08:00" />
<meta property="article:modified_time" content="2022-11-22T16:06:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL按年/月/周/日/小时分组查询、排序、limit、判空用法</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>一、按年/月/周/日/小时分组查询（日期时间类型为date或者datetime）</h3> 
<blockquote> 
 <p>在<strong>DATE_FORMAT(create_time,'%Y%m%d')</strong>中设置需要分组的类型和格式，如下：</p> 
 <p>'%Y%m%d'表示：20221122</p> 
 <p>'%Y-%m-%d'表示：2022-11-22</p> 
 <p>可根据自己的需要设置，年月日都是如此</p> 
</blockquote> 
<p> 如下图<strong>user</strong>表</p> 
<table align="center" border="1" cellpadding="0" cellspacing="1" style="width:650px;"><caption> 
  <strong>user</strong> 
 </caption><tbody><tr><td>id</td><td>name</td><td>age</td><td>birthday</td><td>gender</td><td>create_time</td></tr><tr><td>1</td><td>张三</td><td>20</td><td>2000-01-01</td><td>男</td><td>2022-11-22 11:11:11</td></tr><tr><td>2</td><td>李四</td><td>21</td><td>2001-02-02</td><td>男</td><td>2022-11-19 00:00:00</td></tr><tr><td>3</td><td>王五</td><td>23</td><td>1999-05-06</td><td>女</td><td>2022-11-20 23:59:59</td></tr></tbody></table> 
<ul><li>按日分组查询并排序</li></ul> 
<pre><code>SELECT DATE_FORMAT(create_time,'%Y-%m-%d') days,COUNT(id) 
FROM user 
WHERE create_time &gt; "2022-11-11 00:00:00" 
  AND create_time &lt; "2022-12-01 00:00:00" 
GROUP BY days
ORDER BY days DESC;</code></pre> 
<ul><li>按周分组查询 </li></ul> 
<pre><code>SELECT DATE_FORMAT(create_time,'%Y-%u') weeks,COUNT(id) FROM user GROUP BY weeks;</code></pre> 
<ul><li> 按月分组查询</li></ul> 
<pre><code>SELECT DATE_FORMAT(create_time,'%Y-%m') months,COUNT(id) FROM user GROUP BY months</code></pre> 
<ul><li>按年分组查询</li></ul> 
<pre><code>SELECT DATE_FORMAT(create_time,'%Y') months,COUNT(id) FROM user GROUP BY years</code></pre> 
<ul><li>按小时分组查询</li></ul> 
<pre><code>SELECT DATE_FORMAT(create_time,'%Y-%m-%d %H') hours,COUNT(id) 
FROM user 
WHERE create_time &gt; "2022-11-11 00:00:00" 
  AND create_time &lt; "2022-12-01 00:00:00" 
GROUP BY hours;</code></pre> 
<blockquote> 
 <p><strong>DATE_FORMAT()</strong>需要传入一个特定的占位符，mysql常用的占位符可参考下表:</p> 
</blockquote> 
<table align="center" border="1" cellpadding="0" cellspacing="1" style="width:690px;"><thead><tr><th style="text-align:center;">占位符</th><th style="text-align:center;">说明</th></tr></thead><tbody><tr><td style="text-align:center;">%Y</td><td style="text-align:center;">年(4位)</td></tr><tr><td style="text-align:center;">%y</td><td style="text-align:center;">年(2位)</td></tr><tr><td style="text-align:center;">%M</td><td style="text-align:center;">月（英文名，如January）</td></tr><tr><td style="text-align:center;">%m</td><td style="text-align:center;">月（数字，如01）</td></tr><tr><td style="text-align:center;">%D</td><td style="text-align:center;">日（英文名，如1st）</td></tr><tr><td style="text-align:center;">%d</td><td style="text-align:center;">日（数字，如01）</td></tr><tr><td style="text-align:center;">%e</td><td style="text-align:center;">日（数字，如1）</td></tr><tr><td style="text-align:center;">%U</td><td style="text-align:center;">一年中的第几周，从0开始 ，周日是第一天</td></tr><tr><td style="text-align:center;">%u</td><td style="text-align:center;">一年中的第几周，从0开始，周一是第一天</td></tr><tr><td style="text-align:center;">%H</td><td style="text-align:center;">时，24小时制，例如15</td></tr><tr><td style="text-align:center;">%h</td><td style="text-align:center;">时，12小时制，例如01</td></tr><tr><td style="text-align:center;">%i</td><td style="text-align:center;">分</td></tr><tr><td style="text-align:center;">%s</td><td style="text-align:center;">秒</td></tr></tbody></table> 
<h3><strong>二、MySQL排序</strong></h3> 
<h4>1.排序规则</h4> 
<ul><li> <p>使用ORDER BY 字句排序,在其后面加所需字段</p> 
  <ul><li> <p><strong>ASC(ascend): 升序</strong></p> </li><li> <p><strong>DESC(descend): 降序</strong></p> </li></ul></li><li> <p>ORDER BY 字句在SELECT语句的结尾</p> </li></ul> 
<blockquote> 
 <p><strong>注意:</strong></p> 
 <p>数据库中默认按照先后添加顺序存储数据,在查询时,也按照添加顺序<a href="https://so.csdn.net/so/search?q=%E9%81%8D%E5%8E%86&amp;spm=1001.2101.3001.7020" title="遍历">遍历</a>显示结果.因此当我们需要一些特定的数据排列时就要使用到排序</p> 
</blockquote> 
<h4>2.单列排序</h4> 
<p>根据上述用户user表查询：</p> 
<p>#练习1：根据年龄降序（从大到小）排序</p> 
<pre><code>SELECT * FROM user ORDER BY age DESC;</code></pre> 
<p>#练习2：根据出生日期升序（从小到大）排序</p> 
<pre><code>SELECT * FROM user ORDER BY birthday ASC;</code></pre> 
<blockquote> 
 <p>注意:</p> 
 <p>如果在ORDER BY 后面没有显示指明排序方式的话,则默认按照升序排列排序，有WHERE 和 ORDER BY 同时出现的地方,一定要把WHERE放在FRON语句后面,ORDER BY 往后放</p> 
</blockquote> 
<pre><code>SELECT *
FROM user 
WHERE age &gt; 20 
ORDER BY age DESC;</code></pre> 
<h3>三.limit 详细用法</h3> 
<h4>1、用于强制返回指定的记录行数</h4> 
<p>在查询中，经常要返回前几条或者中间某几行数据时，用到limit</p> 
<p>语法如下：</p> 
<pre><code>select * from table_name limit [offset，] rows
</code></pre> 
<p>参数说明：<br><strong>offset：</strong>指定第一个返回记录行的偏移量（即从哪一行开始返回），注意：初始行的偏移量为0。<br><strong>rows：</strong>返回具体行数。</p> 
<p>总结：如果limit后面是一个参数，就是检索前多少行。如果limit后面是2个参数，就是从offset+1行开始，检索rows行记录。<br> 举例：</p> 
<pre><code>select * from table_name limit 10;//检索前10行记录
select * from table_name limit 5 ，10;//从第6行开始，检索10行记录，即：检索记录行 6-15
</code></pre> 
<h4>2、分页</h4> 
<p>客户端通过传递page(页码)，pageSize(每页显示的条数)两个参数去分页查询数据库表中的数据，那我们知道MySql数据库提供了分页的函数limit m,n，但是该函数的用法和我们的需求不一样，所以就需要我们根据实际情况去改写适合我们自己的分页语句，具体的分析如下：<br> 比如：</p> 
<ul><li>查询第1条到第10条的数据的sql是：select * from table limit 0,10; -&gt;对应我们的需求就是查询第一页的数据：select * from table limit (1-1)*10,10;</li><li>查询第10条到第20条的数据的sql是：select * from table limit 10,10; -&gt;对应我们的需求就是查询第二页的数据：select * from table limit (2-1)*10,10;</li><li>查询第20条到第30条的数据的sql是：select * from table limit 20,10; -&gt;对应我们的需求就是查询第三页的数据：select * from table limit (3-1)*10,10;</li></ul> 
<p><strong>总结：</strong><br> 通过上面的分析，可以得出符合我们需求的分页sql格式是：</p> 
<pre><code>select * from table limit (page-1)*pageSize,pageSize; 
</code></pre> 
<h3>四.ifnull()函数的使用</h3> 
<h4>1、ifnull()的语法</h4> 
<blockquote> 
 <p>ifnull(a,b)函数解释：</p> 
 <ul><li>如果value1不是空，结果返回a</li><li>如果value1是空，结果返回b</li></ul> 
</blockquote> 
<h4>2、ifnull()的使用</h4> 
<p>如下表：分数表score</p> 
<table border="1" style="width:700px;"><caption>
   score 
 </caption><tbody><tr><td>id</td><td>Chinese</td><td>English</td><td>Physics</td></tr><tr><td>1</td><td>99</td><td>98</td><td>null</td></tr><tr><td>2</td><td>88</td><td>99</td><td>null</td></tr></tbody></table> 
<p>1、 在统计数据时如果没有值返回，给结果置为0</p> 
<p>举例：统计物理科目分数总和时，如果该列为null，返回0，如果不使用ifnull(),正常返回值为null</p> 
<pre><code>SELECT ifnull(SUM(Physics),0) FROM score;</code></pre> 
<p>2、在查询数据需要计算遇到null值时 </p> 
<p>举例：查询id为1的学生的语文和物理的总分</p> 
<ul><li>错误写法（在数据库没有指定为空时的默认值时）</li></ul> 
<pre><code>SELECT Chinese+Physics FROM score;</code></pre> 
<p>数据为null不能参与运算，否则会直接报错。</p> 
<ul><li>正确写法</li></ul> 
<p>SELECT ifnull(Chinese,0)+ifnull(Physics,0) FROM score;</p> 
<blockquote> 
 <p>还有就是使用SUM()等函数，可以忽略计算中的空值。</p> 
 <p>SELECT SUM(Chinese，Physics) FROM score;</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b40ee93f22d7437eea9d73df87d076ea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">android源码学习-Toast实现原理讲解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/943d7a1c7ff2d5f560101f6d23cb0b77/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue3&#43;vite 项目中配置prettier</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>