<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>idea 使用docker插件，实现一键自动化部署 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="idea 使用docker插件，实现一键自动化部署" />
<meta property="og:description" content="环境： ​ jdk1.8及以上。
Maven 3.2&#43;
​ idea
​ docker
一、 docker开启远程连接访问 首先我们要开启docker的远程连接访问。保证不是docker所在的服务器，也能够远程访问docker。
Linux版的docker：
1.修改docker.service文件，添加监听端口 -H tcp://0.0.0.0:2375
vi /usr/lib/systemd/system/docker.service 找到 ExecStart，在最后面添加 -H tcp://0.0.0.0:2375，如下图所示
2.重启docker
systemctl daemon-reload systemctl start docker 3.如果我们有防火前记得添加防火墙策略或者关闭防火墙。
window版docker
在电脑左下角找到docker图标，鼠标右键选择settings。 将General菜单下的Expose daemon on tcp://localhost:2375 without TLS勾选。无需重启。
安装配置idea的docker插件 1.在File --&gt; Settings --&gt; Plugins 在输入框中搜索Docker，选择并安装。安装完成后重启Docker。
2.配置docker
在File–&gt; Settings–&gt;Build,Execution,Deployment中找到Docker
新建一个docker实例，然后在Engine API URL中将docker所在ip端口号填上，填完如果下面显示Connection successful证明连接docker成功。如果失败，可能是我们上一步docker开启远程连接未成功。
我们设置完成后，回到idea主界面，可以看到页面下面有一个docker窗口。点击绿色箭头，连接docker。连接上后显示Containers和Images就是我们现在docker中已经有的容器和镜像。
创建项目，并配置 一 、 创建项目 我就以一个简单的Eureka项目演示。
File–&gt; New --&gt;Project --&gt; Spring Initializr
二、 配置项目 1.修改pom.xml文件，引入docker-maven-plugin插件相关配置. 改配置在标签内
&lt;!--使用docker-maven-plugin插件--&gt; &lt;plugin&gt; &lt;groupId&gt;com." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/378e1c4943dd9b077dda479730dc0cf7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-07T16:46:03+08:00" />
<meta property="article:modified_time" content="2022-12-07T16:46:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">idea 使用docker插件，实现一键自动化部署</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_0"></a>环境：</h5> 
<p>​ jdk1.8及以上。</p> 
<p>Maven 3.2+</p> 
<p>​ idea</p> 
<p>​ docker</p> 
<h5><a id="_docker_8"></a>一、 docker开启远程连接访问</h5> 
<p>首先我们要开启docker的远程连接访问。保证不是docker所在的服务器，也能够远程访问docker。</p> 
<p>Linux版的docker：</p> 
<p>1.修改docker.service文件，添加监听端口 -H tcp://0.0.0.0:2375</p> 
<pre><code class="prism language-bash">  <span class="token function">vi</span> /usr/lib/systemd/system/docker.service
</code></pre> 
<p>找到 ExecStart，在最后面添加 -H tcp://0.0.0.0:2375，如下图所示<br> <img src="https://images2.imgbox.com/f4/ae/KHSKoBR8_o.png" alt="在这里插入图片描述"><br> 2.重启docker</p> 
<pre><code class="prism language-bash"> systemctl daemon-reload
 systemctl start <span class="token function">docker</span>
</code></pre> 
<p>3.如果我们有防火前记得添加防火墙策略或者关闭防火墙。<br> window版docker</p> 
<p>在电脑左下角找到docker图标，鼠标右键选择settings。 将General菜单下的Expose daemon on tcp://localhost:2375 without TLS勾选。无需重启。<br> <img src="https://images2.imgbox.com/b9/04/1HJu14Co_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="ideadocker_31"></a>安装配置idea的docker插件</h5> 
<p>1.在File --&gt; Settings --&gt; Plugins 在输入框中搜索Docker，选择并安装。安装完成后重启Docker。<br> <img src="https://images2.imgbox.com/f8/65/ojNnn31I_o.png" alt="在这里插入图片描述"><br> 2.配置docker<br> 在File–&gt; Settings–&gt;Build,Execution,Deployment中找到Docker</p> 
<p>新建一个docker实例，然后在Engine API URL中将docker所在ip端口号填上，填完如果下面显示Connection successful证明连接docker成功。如果失败，可能是我们上一步docker开启远程连接未成功。<br> <img src="https://images2.imgbox.com/fa/e2/YyVCdIV2_o.png" alt="在这里插入图片描述"><br> 我们设置完成后，回到idea主界面，可以看到页面下面有一个docker窗口。点击绿色箭头，连接docker。连接上后显示Containers和Images就是我们现在docker中已经有的容器和镜像。<br> <img src="https://images2.imgbox.com/24/50/lLieBdXe_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_41"></a>创建项目，并配置</h4> 
<h5><a id="___42"></a>一 、 创建项目</h5> 
<p>我就以一个简单的Eureka项目演示。</p> 
<p>File–&gt; New --&gt;Project --&gt; Spring Initializr<br> <img src="https://images2.imgbox.com/88/29/9hLRHWpt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/88/f5/3eW09W4p_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4a/a7/x5qMBQhq_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c1/05/hpHMOiNs_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="__50"></a>二、 配置项目</h5> 
<p>1.修改pom.xml文件，引入docker-maven-plugin插件相关配置. 改配置在标签内</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--使用docker-maven-plugin插件--&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.spotify<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>docker-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--将插件绑定在某个phase执行--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>build-image<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!--将插件绑定在package这个phase上。也就是说，
                用户只需执行mvn package ，就会自动执行mvn docker:build--&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>build<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--指定生成的镜像名,这里是我们的项目名--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>imageName</span><span class="token punctuation">&gt;</span></span>${project.artifactId}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>imageName</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!--指定标签 这里指定的是镜像的版本，我们默认版本是latest--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>imageTags</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>imageTag</span><span class="token punctuation">&gt;</span></span>latest<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>imageTag</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>imageTags</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 指定我们项目中Dockerfile文件的路径--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dockerDirectory</span><span class="token punctuation">&gt;</span></span>${project.basedir}/src/main/resources<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dockerDirectory</span><span class="token punctuation">&gt;</span></span>

            <span class="token comment">&lt;!--指定远程docker 地址--&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dockerHost</span><span class="token punctuation">&gt;</span></span>http://127.0.0.1:2375<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dockerHost</span><span class="token punctuation">&gt;</span></span>

            <span class="token comment">&lt;!-- 这里是复制 jar 包到 docker 容器指定目录配置 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resources</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>resource</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>targetPath</span><span class="token punctuation">&gt;</span></span>/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>targetPath</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!--jar包所在的路径  此处配置的即对应项目中target目录--&gt;</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>directory</span><span class="token punctuation">&gt;</span></span>${project.build.directory}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>directory</span><span class="token punctuation">&gt;</span></span>
                    <span class="token comment">&lt;!-- 需要包含的 jar包 ，这里对应的是 Dockerfile中添加的文件名　--&gt;</span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>${project.build.finalName}.jar<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resource</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>resources</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2.配置项目的基本配置。( 这里不是重点，一笔带过)<br> ①修改application.properties，添加项目相关信息。</p> 
<pre><code class="prism language-xml">#项目启动的端口号和IP地址
server.port=9090
eureka.instance.hostname=127.0.0.1

# 是否将其注册到注册中心， 如果不是集群环境，false
eureka.client.register-with-eureka=false
# 是否检索服务，单机情况下为false
eureka.client.fetch-registry=false

eureka.client.service-url.defaultZone=http://${eureka.instance.hostname}:${server.port}/eureka/
</code></pre> 
<p>② 找到项目启动类,添加@EnableEurekaServer注解</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@EnableEurekaServer</span>
<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EurekaserverApplication</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">EurekaserverApplication</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>3.添加Dockerfile文件。<br> 我们在EeurekaServer\src\main\resources目录下，添加文件<br> <img src="https://images2.imgbox.com/53/97/ryC9omWU_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="dockerjava8_docker_pull_java8_131"></a>如果我们docker中没有java:8 这个镜像，请先使用docker pull java:8,将镜像先拉下来。</h6> 
<pre><code class="prism language-java"><span class="token constant">FROM</span> java<span class="token operator">:</span><span class="token number">8</span>
<span class="token constant">VOLUME</span> <span class="token operator">/</span>tmp
<span class="token constant">ADD</span> <span class="token operator">*</span><span class="token punctuation">.</span>jar app<span class="token punctuation">.</span>jar
<span class="token constant">EXPOSE</span> <span class="token number">9090</span>
<span class="token constant">ENTRYPOINT</span> <span class="token punctuation">[</span> <span class="token string">"java"</span><span class="token punctuation">,</span> <span class="token string">"-Djava.security.egd=file:/dev/./urandom"</span><span class="token punctuation">,</span> <span class="token string">"-jar"</span><span class="token punctuation">,</span> <span class="token string">"/app.jar"</span> <span class="token punctuation">]</span>
</code></pre> 
<p>我们添加了一个VOLUME指向“/ tmp”的内容，因为这是Spring Boot应用程序默认为Tomcat创建工作目录的地方。效果是在“/var/lib/docker”下的主机上创建一个临时文件，并将其链接到“/ tmp”下的容器。对于我们在此处编写的简单应用程序，此步骤是可选的，但如果需要在文件系统中实际编写，则对于其他Spring Boot应用程序可能是必需的。</p> 
<p>为了减少Tomcat的启动时间，我们添加了一个指向“/dev/urandom”的系统属性作为熵源。如果您使用Tomcat（或任何其他Web服务器）的“标准”版本，则不需要更新版本的Spring Boot。</p> 
<h5><a id="maven_144"></a>maven打包，生成镜像</h5> 
<p>使用maven打包。我们在pom.xml中配置过，如果我们是用maven的package，那么就会自动使用Dockerfile文件进行构建。<br> <img src="https://images2.imgbox.com/0d/57/mdhswfbx_o.png" alt="在这里插入图片描述"><br> 我们从控制台可以看到，已经给我构建了一个和我们项目名相同的镜像文件。<br> <img src="https://images2.imgbox.com/69/c0/CxKahL4p_o.png" alt="在这里插入图片描述"><br> 我们在docker窗口可以看到，我们的镜像库中多个一个eurekaserver:latest镜像。<br> <img src="https://images2.imgbox.com/5d/cf/leHiY3gK_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="docker_151"></a>创建容器，项目部署到docker</h5> 
<p>我们在docker窗口中，找到我们刚才创建的镜像文件，鼠标右键，选择Create container，我们修改创建容器所需要的配置。<br> <img src="https://images2.imgbox.com/34/6a/zZ7VraiQ_o.png" alt="在这里插入图片描述"><br> 在Create Docker Configuration弹窗中修改Container name（容器名称） Bind ports（Ip和端口映射）</p> 
<p>我在这里添加127.0.0.1:8080:9090. 使用本地8080端口，去访问容器的9090.</p> 
<p><img src="https://images2.imgbox.com/5e/0c/YKr5R5iC_o.png" alt="在这里插入图片描述"><br> 我们点击Run之后，就会自动创建容器并启动。</p> 
<p>我们可以看到在docker插件中，多出了一个eurekaServer的容器，并且启动成功，端口号为9090.<br> <img src="https://images2.imgbox.com/3e/b1/EqFaZlCR_o.png" alt="在这里插入图片描述"><br> 访问容器中的项目</p> 
<p>我们在前面设置的是使用8080端口，访问容器9090的项目。</p> 
<p>我们使用127.0.0.1:8080访问项目，出现如下页面，证明项目启动成功。<br> <img src="https://images2.imgbox.com/61/4c/d7nQIne5_o.png" alt="在这里插入图片描述"><br> 在这里我们基本上已经完成了所有的配置。</p> 
<h5><a id="_170"></a>修改项目，一键部署</h5> 
<p>以后，我们启动项目可以按照下图所示，一键启动我们项目就会在docker容器中运行。<br> <img src="https://images2.imgbox.com/ef/5d/iwpSHD1h_o.png" alt="在这里插入图片描述"><br> 如果我们修改了项目，在使用在docker插件中启动项目，会发现在启动依然还是修改前的项目，因为我们只是启动了容器，并没有将修改后的项目重新打包并生成docker的images。 如果我们想在启动时直接用运行打包并启动项目可以按照下面的操作。<br> 1.我们修改在前面我们创建的Docker Images 的配置。<br> <img src="https://images2.imgbox.com/47/d2/jBBCrHGv_o.png" alt="在这里插入图片描述"><br> 2…在配置启动项中找到Before launch：Activate tool window，在这里我们新增一个Run Maven Gold。<br> <img src="https://images2.imgbox.com/d6/87/7ksYmeUw_o.png" alt="在这里插入图片描述"><br> 3.我们在这里的Command line 中添加一个命令 package。<br> <img src="https://images2.imgbox.com/af/c9/mCUdO36X_o.png" alt="在这里插入图片描述"><br> 配置完成后保存。以后我们启动项目时都会执行maven的package命令，自动将我们打包并把项目生成docker镜像文件启动。</p> 
<p>以后，如果我们修改项目后，都可以使用下图所示去启动。 它会自动打包创建docker镜像并启动项目。<br> <img src="https://images2.imgbox.com/19/83/trQJvet6_o.png" alt="在这里插入图片描述"><br> 如果我们只需要启动项目，到docker插件窗口，启动对应项目的容器就可以了。</p> 
<p>参考 https://www.cnblogs.com/hsz-csy/p/9488469.html</p> 
<p>​ https://spring.io/guides/gs/spring-boot-docker/</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5cf04ddb49195625062a7235183607da/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于实体类的日期转换中使用@DateTimeFormat、@Pattern()、@JsonFormat</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8104ec0bd68b4e9c025012612b97b911/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">《六》实际应用——如何优雅的关闭线程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>