<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>静态服务器显示固定页面,02-静态web服务器搭建之显示固定的内容 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="静态服务器显示固定页面,02-静态web服务器搭建之显示固定的内容" />
<meta property="og:description" content="1 statichttpserver.py
采用[Python网络编程之TCP]章节中多路复用selector的做法，创建TcpServer。 这里需要注意的是每个请求发送给服务器都建立一条tcp连接，服务器处理完成该请求之后，即断开连接。
# -*- coding: utf-8 -*-
# @Author : 江河
# @Email : 2516638426@qq.com
# @Time : 2020/4/22 7:29
# @File : statichttpserver
# @Project: python高级项目
import selectors
import socket
from http_parsed import BaseRequest
class StaticHttpServer(object):
def __init__(self,host,port):
self.selector = selectors.DefaultSelector()
self.sock = socket.socket()
self.address = (host,port)
self.request_queue_size = 5
self.open_socket()
def accept(self,sock,mask):
sel = self.selector
conn,addr = sock.accept() # Should be ready
conn.setblocking(False)
sel.register(conn,selectors.EVENT_READ,self.read)
def write(self,sock,mask):" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0ba32af9a0a95660daad4afdb1eb958a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-06T10:13:45+08:00" />
<meta property="article:modified_time" content="2021-08-06T10:13:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">静态服务器显示固定页面,02-静态web服务器搭建之显示固定的内容</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>1 statichttpserver.py</p> 
 <p>采用[Python网络编程之TCP]章节中多路复用selector的做法，创建TcpServer。 这里需要注意的是每个请求发送给服务器都建立一条tcp连接，服务器处理完成该请求之后，即断开连接。</p> 
 <p># -*- coding: utf-8 -*-</p> 
 <p># @Author : 江河</p> 
 <p># @Email : 2516638426@qq.com</p> 
 <p># @Time : 2020/4/22 7:29</p> 
 <p># @File : statichttpserver</p> 
 <p># @Project: python高级项目</p> 
 <p>import selectors</p> 
 <p>import socket</p> 
 <p>from http_parsed import BaseRequest</p> 
 <p>class StaticHttpServer(object):</p> 
 <p>def __init__(self,host,port):</p> 
 <p>self.selector = selectors.DefaultSelector()</p> 
 <p>self.sock = socket.socket()</p> 
 <p>self.address = (host,port)</p> 
 <p>self.request_queue_size = 5</p> 
 <p>self.open_socket()</p> 
 <p>def accept(self,sock,mask):</p> 
 <p>sel = self.selector</p> 
 <p>conn,addr = sock.accept() # Should be ready</p> 
 <p>conn.setblocking(False)</p> 
 <p>sel.register(conn,selectors.EVENT_READ,self.read)</p> 
 <p>def write(self,sock,mask):</p> 
 <p>print('write')</p> 
 <p>sel = self.selector</p> 
 <p># 组织相应的头信息(header)</p> 
 <p>response_headers = "HTTP/1.1 200 OK\r\n" # 200表示找到这个资源</p> 
 <p>response_headers += "\r\n" # 用一个空的行与body进行隔开</p> 
 <p># 组织 内容(body)</p> 
 <p>response_body = "Hello World"</p> 
 <p>response = response = response_headers + response_body</p> 
 <p>sock.send(response.encode("utf-8"))</p> 
 <p>self.unregister(sock)</p> 
 <p>sock.close()</p> 
 <p>def read(self,conn,mask):</p> 
 <p>sel = self.selector</p> 
 <p>data = conn.recv(1000) # should be ready</p> 
 <p>if data:</p> 
 <p>conn.setblocking(False)</p> 
 <p>sel.unregister(conn)</p> 
 <p># print('echoing',repr(data))</p> 
 <p>s = data.decode('utf-8')</p> 
 <p>self.req = BaseRequest(s)</p> 
 <p># print(self.req.headers)</p> 
 <p>print(self.req.url)</p> 
 <p>print(self.req.method)</p> 
 <p>sel.register(conn,selectors.EVENT_WRITE,self.write)</p> 
 <p>else:</p> 
 <p>print('closing',conn)</p> 
 <p>sel.unregister(conn)</p> 
 <p>conn.close()</p> 
 <p>def server_close(self):</p> 
 <p>self.sock.close()</p> 
 <p>self.selector.close()</p> 
 <p>def server_bind(self):</p> 
 <p>"""</p> 
 <p>绑定</p> 
 <p>:return:</p> 
 <p>"""</p> 
 <p>sock = self.sock</p> 
 <p>sock.bind(self.address)</p> 
 <p>self.server_address = sock.getsockname()</p> 
 <p>def server_listen(self):</p> 
 <p>"""</p> 
 <p>监听</p> 
 <p>:return:</p> 
 <p>"""</p> 
 <p>self.sock.listen(self.request_queue_size)</p> 
 <p>def open_socket(self):</p> 
 <p>sock = self.sock</p> 
 <p>self.server_bind()</p> 
 <p>self.server_listen()</p> 
 <p>sock.setblocking(False)</p> 
 <p>def server_forever(self):</p> 
 <p>sock = self.sock</p> 
 <p>sel = self.selector</p> 
 <p>sel.register(sock,selectors.EVENT_READ,self.accept)</p> 
 <p>try:</p> 
 <p>while True:</p> 
 <p>events = sel.select()</p> 
 <p>for key,mask in events:</p> 
 <p>callback = key.data</p> 
 <p>callback(key.fileobj,mask)</p> 
 <p>finally:</p> 
 <p>print('close')</p> 
 <p>self.server_close()</p> 
 <p>if __name__ == '__main__':</p> 
 <p>host = '127.0.0.1'</p> 
 <p>port = 5001</p> 
 <p>print('running http://{}:{}'.format(host.port))</p> 
 <p>httpd = StaticHttpServer(host,port)</p> 
 <p>httpd.server_forever()</p> 
 <p>2 http_parsed.py</p> 
 <p>BaseRequest类主要用来对客户端发过来的http请求进行封装与解析。</p> 
 <p># -*- coding: utf-8 -*-</p> 
 <p># @Author : 江河</p> 
 <p># @Email : 2516638426@qq.com</p> 
 <p># @Time : 2020/4/22 7:42</p> 
 <p># @File : http_parsed</p> 
 <p># @Project: python高级项目</p> 
 <p>class BaseRequest(object):</p> 
 <p>"""</p> 
 <p>base request class</p> 
 <p>"""</p> 
 <p>def __init__(self,request):</p> 
 <p>self.request = request</p> 
 <p># print(request)</p> 
 <p>self._parsed_request()</p> 
 <p>def _parsed_request(self):</p> 
 <p>"""</p> 
 <p>解析 request</p> 
 <p>:param request()</p> 
 <p>:return:</p> 
 <p>"""</p> 
 <p>self._parsed_header()</p> 
 <p>self._parsed_body()</p> 
 <p>def _parsed_header(self):</p> 
 <p>"""</p> 
 <p>GET /favicon.ico HTTP/1.1</p> 
 <p>Host: 127.0.0.1:5001</p> 
 <p>Connection: keep-alive</p> 
 <p>User-Agent: Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.108 Safari/537.36</p> 
 <p>Accept: image/webp,image/apng,image/*,*/*;q=0.8</p> 
 <p>Referer: http://127.0.0.1:5001/</p> 
 <p>Accept-Encoding: gzip, deflate, br</p> 
 <p>Accept-Language: zh-CN,zh;q=0.9</p> 
 <p>"""</p> 
 <p>headers = self.request.split('\r\n\r\n',1)[0].split('\r\n')[1:]</p> 
 <p>query = {}</p> 
 <p>for h in headers:</p> 
 <p>k,v = h.split(':',1)</p> 
 <p>query[k] = v</p> 
 <p>self.headers = query</p> 
 <p>def _parsed_body(self):</p> 
 <p>"""</p> 
 <p>解析body</p> 
 <p>：param request：</p> 
 <p>:return:</p> 
 <p>"""</p> 
 <p>self.body = self.request.split('\r\n\r\n',1)[1]</p> 
 <p>@property</p> 
 <p>def method(self):</p> 
 <p>self._method = self.request.split()[0]</p> 
 <p>return self._method</p> 
 <p>@property</p> 
 <p>def url(self):</p> 
 <p>self._url = self.request.split()[1]</p> 
 <p>return self._url</p> 
 <p>@property</p> 
 <p>def protocol(self):</p> 
 <p>self._protocol = self.request.split()[2]</p> 
 <p>return self._protocol</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a1e3882f519f30d7aeea2bb7cb60725d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">给服务器系统盘格式化,云服务器格式化系统盘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98712897b9e8d255a55bba21647a89e6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">探测服务器操作系统,3.9  操作系统探测技术</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>