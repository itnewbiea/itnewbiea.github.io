<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Loadrunner进行文件的上传和下载 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用Loadrunner进行文件的上传和下载" />
<meta property="og:description" content="最近使用loadrunner中需要录制文件的上传和下载，上传功能模块利用录制可以直接实现，下载无法实现，在网上找到了一段代码，自己动手试验了下，发现没有用
辛苦找到的，还是记录下吧
（1）LoadRunner上传文件
web_submit_data(&#34;importStudent.do&#34;,
&#34;Action=https://testserver/console/importStudent.do&#34;,
&#34;Method=POST&#34;,
&#34;EncType=multipart/form-data&#34;,
&#34;RecContentType=text/html&#34;,
&#34;Referer=https://testserver/console/displayStudentList.do&#34;,
&#34;Snapshot=t12.inf&#34;,
&#34;Mode=HTTP&#34;,
ITEMDATA,
&#34;Name=uploadFile&#34;, &#34;Value=D://Excel//data161955.zip&#34;, &#34;File=yes&#34;, ENDITEM,
LAST);
注：脚本录制使用Http/Html协议或Click and Script协议均可，以上是使用Http/Html录制的的脚本。需要特别注意的是，无论使用哪种协议录制，待上传的文件路径及文件名称只能为英文字符，而不能为中文字符。否则，可能将文件上传的二进制流同时录制到LR的脚本中。
这个问题同时也说明，LR对中文的支持还远不够。
下面是该应用更详细的示例。
Action()
{
//定义double类型的变量trans_time，用来保存事务的执行时间。
double trans_time;
//定义int类型的变量status，用来保存事务执行的返回的值。
int status;
lr_start_transaction(&#34;测试&#34;);
//使用内置函数lr_get_transaction_duration获取事务的执行时间。
trans_time=lr_get_transaction_duration(&#34;测试&#34;);
status= web_submit_data(&#34;importStudent.do&#34;,
&#34;Action=https://testserver/console/importStudent.do&#34;,
&#34;Method=POST&#34;,
&#34;EncType=multipart/form-data&#34;,
&#34;RecContentType=text/html&#34;,
&#34;Referer=https://testserver/console/displayStudentList.do&#34;,
&#34;Snapshot=t12.inf&#34;,
&#34;Mode=HTTP&#34;,
ITEMDATA,
&#34;Name=uploadFile&#34;, &#34;Value=E://datafile//data01.zip&#34;, &#34;File=yes&#34;, ENDITEM,
LAST);
//增加手工事务，如果该测试事务执行返回值为0，则事务执行成功，否则执行失败。
if (status == 0) lr_end_transaction(&#34;测试&#34;, LR_PASS);
else lr_end_transaction(&#34;测试&#34;, LR_FAIL);
//打印事务执行时间。
if (trans_time) lr_output_message(&#34;事务执行时间为：%f 秒&#34;,trans_time); else lr_output_message(&#34;事务执行时间未知!&#34;);
return 0;
}
以下是LR的帮助文档中的web_submit_data函数的一个应用示例，从该示例中也可见一斑。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a08046fed1cb2c8da42a61bf1ff52846/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-08-28T16:35:55+08:00" />
<meta property="article:modified_time" content="2012-08-28T16:35:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Loadrunner进行文件的上传和下载</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近使用loadrunner中需要录制文件的上传和下载，上传功能模块利用录制可以直接实现，下载无法实现，在网上找到了一段代码，自己动手试验了下，发现没有用</p> 
<p>辛苦找到的，还是记录下吧</p> 
<p><br> </p> 
<p><strong>（1）LoadRunner上传文件</strong></p> 
<p> </p> 
<p>         web_submit_data("importStudent.do",</p> 
<p>                   "Action=https://testserver/console/importStudent.do",</p> 
<p>                   "Method=POST",</p> 
<p>                   "EncType=multipart/form-data",</p> 
<p>                   "RecContentType=text/html",</p> 
<p>                   "Referer=https://testserver/console/displayStudentList.do",</p> 
<p>                   "Snapshot=t12.inf",</p> 
<p>                   "Mode=HTTP",</p> 
<p>                   ITEMDATA,</p> 
<p>                   "Name=uploadFile", "Value=D://Excel//data161955.zip", "File=yes", ENDITEM,</p> 
<p>                   LAST);</p> 
<p>注：脚本录制使用Http/Html协议或Click and Script协议均可，以上是使用Http/Html录制的的脚本。需要特别注意的是，无论使用哪种协议录制，待上传的<strong>文件路径及文件名称只能为英文字符</strong>，而不能为中文字符。否则，可能将文件上传的二进制流同时录制到LR的脚本中。</p> 
<p>这个问题同时也说明，LR对中文的支持还远不够。</p> 
<p>下面是该应用更详细的示例。</p> 
<p>Action()</p> 
<p>{<!-- --></p> 
<p>         //定义double类型的变量trans_time，用来保存事务的执行时间。</p> 
<p>         double trans_time;</p> 
<p>         //定义int类型的变量status，用来保存事务执行的返回的值。</p> 
<p>         int status;</p> 
<p> </p> 
<p>         lr_start_transaction("测试");</p> 
<p>         </p> 
<p>//使用内置函数lr_get_transaction_duration获取事务的执行时间。</p> 
<p>         trans_time=lr_get_transaction_duration("测试");</p> 
<p>         status=     web_submit_data("importStudent.do",</p> 
<p>                                     "Action=https://testserver/console/importStudent.do",</p> 
<p>                                     "Method=POST",</p> 
<p>                                     "EncType=multipart/form-data",</p> 
<p>                                     "RecContentType=text/html",</p> 
<p>                   "Referer=https://testserver/console/displayStudentList.do",</p> 
<p>                                     "Snapshot=t12.inf",</p> 
<p>                                     "Mode=HTTP",</p> 
<p>                                     ITEMDATA,</p> 
<p>                                     "Name=uploadFile", "Value=E://datafile//data01.zip", "File=yes", ENDITEM,</p> 
<p>                                     LAST);</p> 
<p>         //增加手工事务，如果该测试事务执行返回值为0，则事务执行成功，否则执行失败。</p> 
<p>         if (status == 0) </p> 
<p>                   lr_end_transaction("测试", LR_PASS);</p> 
<p>    else </p> 
<p>                   lr_end_transaction("测试", LR_FAIL);</p> 
<p> </p> 
<p>         //打印事务执行时间。</p> 
<p>         if (trans_time) </p> 
<p>                   lr_output_message("事务执行时间为：%f 秒",trans_time);    </p> 
<p>    else </p> 
<p>                   lr_output_message("事务执行时间未知!");</p> 
<p>    </p> 
<p>         return 0;</p> 
<p>}</p> 
<p> </p> 
<p> </p> 
<p>以下是LR的帮助文档中的web_submit_data函数的一个应用示例，从该示例中也可见一斑。</p> 
<p>         web_submit_data("Attachments", </p> 
<p>       "Action=http://barton.cottage@.Devonshire.uk/Attachments?YY=45434", </p> 
<p>       "Method=POST", </p> 
<p>       "EncType=multipart/form–data", </p> 
<p>       "TargetFrame=", </p> 
<p>       "RecContentType=text/html", </p> 
<p>       "Referer=http:///barton.cottage@.Devonshire.uk/Compose?YY=20435", </p> 
<p>       "Snapshot=t5.inf", </p> 
<p>       "Mode=HTML", </p> 
<p>       ITEMDATA, </p> 
<p>           "Name=userFile0", </p> 
<p>           "Value=E://sense_sensibility//Elinor.txt", </p> 
<p>           "File=yes", </p> 
<p>           "ContentType=text/html", // Override default "text/plain" for .txt files </p> 
<p>       ENDITEM, </p> 
<p>           "Name=userFile1", </p> 
<p>           "Value=E://sense_sensibility//Marianne.jpg", </p> 
<p>           "File=yes", </p> 
<p>       ENDITEM, </p> 
<p>       LAST);</p> 
<p><strong>（2）LoadRunner下载文件</strong></p> 
<p> </p> 
<p>Action()</p> 
<p>{<!-- --></p> 
<p> </p> 
<p>       /*下载帮助文档*/</p> 
<p> </p> 
<p>       //定义一个整型变量保存获得文件的大小</p> 
<p>       int flen;</p> 
<p> </p> 
<p>    //保存文件句柄</p> 
<p>       long filedes;</p> 
<p> </p> 
<p>    //保存文件路径及文件名</p> 
<p>    char file[256]="/0";</p> 
<p> </p> 
<p>       //定义一个随机数</p> 
<p>    char * strNumber;</p> 
<p> </p> 
<p>       //Returns the string argument after evaluating embedded parameters.</p> 
<p>    strNumber=lr_eval_string("{RandomNum}");</p> 
<p> </p> 
<p>       //将路径保存到file变量中</p> 
<p>       strcat(file,"D://Excel//");</p> 
<p> </p> 
<p>       //将获得的随机数拼接在file变量之后</p> 
<p>    strcat(file,strNumber);</p> 
<p> </p> 
<p>       //将下载的文件后缀名.rar拼接在file变量之后</p> 
<p>    strcat(file,".rar");</p> 
<p> </p> 
<p>       //到此为止一个LoadRunner已经获得了一个完整的文件名</p> 
<p> </p> 
<p> </p> 
<p>       //设置参数的最大长度，注意该值必须大于文件的大小</p> 
<p>       web_set_max_html_param_len("20000");</p> 
<p> </p> 
<p>       //使用关联函数获取下载文件的内容，在这里不定义左右边界，获得服务器响应的所有内容</p> 
<p>       web_reg_save_param("fcontent", </p> 
<p>     "LB=", </p> 
<p>     "RB=", </p> 
<p>     "SEARCH=BODY", </p> 
<p>     LAST);</p> 
<p> </p> 
<p> </p> 
<p>       /*下载帮助文件*/</p> 
<p> </p> 
<p>       lr_start_transaction("下载帮助文件");  </p> 
<p> </p> 
<p>       //发送下载帮助文件的请求</p> 
<p> </p> 
<p>       web_url("DownLoadServlet", </p> 
<p>              "URL=https://testserver3/servlet/DownLoadServlet?filename=help", </p> 
<p>              "Resource=1", </p> 
<p>              "RecContentType=application/x-msdownload", </p> 
<p>              "Referer=", </p> 
<p>              "Snapshot=t41.inf", </p> 
<p>              LAST);</p> 
<p> </p> 
<p>       //获取响应中的文件长度</p> 
<p>       flen = web_get_int_property(HTTP_INFO_DOWNLOAD_SIZE);</p> 
<p> </p> 
<p>       if(flen &gt; 0)  </p> 
<p>       {<!-- --></p> 
<p>              //以写方式打开文件</p> 
<p>              if((filedes = fopen(file, "wb")) == NULL)</p> 
<p>              {<!-- --></p> 
<p>                     lr_output_message("打开文件失败!");</p> 
<p>                     return -1;</p> 
<p>              }</p> 
<p>              //写入文件内容</p> 
<p>              fwrite(lr_eval_string("{fcontent}"), flen, 1, filedes);</p> 
<p>              //关闭文件</p> 
<p>              fclose(filedes);</p> 
<p>       }</p> 
<p> </p> 
<p>       lr_end_transaction("下载帮助文件",LR_AUTO);</p> 
<p> </p> 
<p>       return 0;</p> 
<p>}</p> 
<br>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2eb536b2e3e8a1229361f6366f5dd55/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">电脑玩游戏花屏怎么办，显卡花屏解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/aea3967a4ce32aac30a1eee7bab711ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">简单的比较C语言下交换a,b数值的代码效率</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>