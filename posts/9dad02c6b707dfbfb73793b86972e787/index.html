<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis——动态SQL讲解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBatis——动态SQL讲解" />
<meta property="og:description" content="MyBatis的动态SQL是基于OGNL表达式的，它可以帮助我们方便的在SQL语句中实现某些逻辑。 MyBatis中用于实现动态SQL的元素主要有：
ifwheresetchoose（when，otherwise）trimforeach 1、if标签 if标签可用在许多类型的sql语句中，我们以查询为例。首先看一个很普通的查询：
&lt;!-- 查询学生list，like姓名 --&gt; &lt;select id=&#34;getStudentListLikeName&#34; parameterType=&#34;StudentEntity&#34; resultMap=&#34;studentResultMap&#34;&gt; SELECT * from STUDENT_TBL ST WHERE ST.STUDENT_NAME LIKE CONCAT(CONCAT(&#39;%&#39;, #{studentName}),&#39;%&#39;) &lt;/select&gt; 但是此时如果studentName为null，此语句很可能报错或查询结果为空。此时我们使用if动态sql语句先进行判断，如果值为null或等于空字符串，我们就不进行此条件的判断，增加灵活性。 参数为实体类StudentEntity。将实体类中所有的属性均进行判断，如果不为空则执行判断条件。
&lt;!-- 2 if(判断参数) - 将实体类不为空的属性作为where条件 --&gt; &lt;select id=&#34;getStudentList_if&#34; resultMap=&#34;resultMap_studentEntity&#34; parameterType=&#34;liming.student.manager.data.model.StudentEntity&#34;&gt; SELECT ST.STUDENT_ID, ST.STUDENT_NAME, ST.STUDENT_SEX, ST.STUDENT_BIRTHDAY, ST.STUDENT_PHOTO, ST.CLASS_ID, ST.PLACE_ID FROM STUDENT_TBL ST WHERE &lt;if test=&#34;studentName !=null &#34;&gt; ST.STUDENT_NAME LIKE CONCAT(CONCAT(&#39;%&#39;, #{studentName, jdbcType=VARCHAR}),&#39;%&#39;) &lt;/if&gt; &lt;if test=&#34;studentSex != null and studentSex != &#39;&#39; &#34;&gt; AND ST.STUDENT_SEX = #{studentSex, jdbcType=INTEGER} &lt;/if&gt; &lt;if test=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9dad02c6b707dfbfb73793b86972e787/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-09-01T11:25:09+08:00" />
<meta property="article:modified_time" content="2016-09-01T11:25:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis——动态SQL讲解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>MyBatis的动态SQL是基于OGNL表达式的，它可以帮助我们方便的在SQL语句中实现某些逻辑。 <br> MyBatis中用于实现动态SQL的元素主要有：</p> 
<ul><li>if</li><li>where</li><li>set</li><li>choose（when，otherwise）</li><li>trim</li><li>foreach</li></ul> 
<h4 id="1if标签"><strong>1、if标签</strong></h4> 
<p>if标签可用在许多类型的sql语句中，我们以查询为例。首先看一个很普通的查询：</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-comment">&lt;!-- 查询学生list，like姓名 --&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">select</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"getStudentListLikeName"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"StudentEntity"</span> <span class="hljs-attribute">resultMap</span>=<span class="hljs-value">"studentResultMap"</span>&gt;</span>  
    SELECT * from STUDENT_TBL ST   
WHERE ST.STUDENT_NAME LIKE CONCAT(CONCAT('%', #{studentName}),'%')  
<span class="hljs-tag">&lt;/<span class="hljs-title">select</span>&gt;</span>  </code></pre> 
<p>但是此时如果studentName为null，此语句很可能报错或查询结果为空。此时我们使用if动态sql语句先进行判断，如果值为null或等于空字符串，我们就不进行此条件的判断，增加灵活性。 <br> 参数为实体类StudentEntity。将实体类中所有的属性均进行判断，如果不为空则执行判断条件。</p> 
<pre class="prettyprint"><code class=" hljs avrasm">&lt;!-- <span class="hljs-number">2</span> if(判断参数) - 将实体类不为空的属性作为where条件 --&gt;  
&lt;select id=<span class="hljs-string">"getStudentList_if"</span> resultMap=<span class="hljs-string">"resultMap_studentEntity"</span> parameterType=<span class="hljs-string">"liming.student.manager.data.model.StudentEntity"</span>&gt;  
    SELECT <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_ID,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_NAME,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_SEX,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_BIRTHDAY,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_PHOTO,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID  
      FROM STUDENT_TBL <span class="hljs-keyword">ST</span>   
     WHERE  
    &lt;if test=<span class="hljs-string">"studentName !=null "</span>&gt;  
        <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_NAME LIKE CONCAT(CONCAT(<span class="hljs-string">'%'</span>, <span class="hljs-preprocessor">#{studentName, jdbcType=VARCHAR}),'%')  </span>
    &lt;/if&gt;  
    &lt;if test=<span class="hljs-string">"studentSex != null and studentSex != '' "</span>&gt;  
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_SEX = <span class="hljs-preprocessor">#{studentSex, jdbcType=INTEGER}  </span>
    &lt;/if&gt;  
    &lt;if test=<span class="hljs-string">"studentBirthday != null "</span>&gt;  
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_BIRTHDAY = <span class="hljs-preprocessor">#{studentBirthday, jdbcType=DATE}  </span>
    &lt;/if&gt;  
    &lt;if test=<span class="hljs-string">"classId != null and classId!= '' "</span>&gt;  
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID = <span class="hljs-preprocessor">#{classId, jdbcType=VARCHAR}  </span>
    &lt;/if&gt;  
    &lt;if test=<span class="hljs-string">"classEntity != null and classEntity.classId !=null and classEntity.classId !=' ' "</span>&gt;  
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID = <span class="hljs-preprocessor">#{classEntity.classId, jdbcType=VARCHAR}  </span>
    &lt;/if&gt;  
    &lt;if test=<span class="hljs-string">"placeId != null and placeId != '' "</span>&gt;  
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID = <span class="hljs-preprocessor">#{placeId, jdbcType=VARCHAR}  </span>
    &lt;/if&gt;  
    &lt;if test=<span class="hljs-string">"placeEntity != null and placeEntity.placeId != null and placeEntity.placeId != '' "</span>&gt;  
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID = <span class="hljs-preprocessor">#{placeEntity.placeId, jdbcType=VARCHAR}  </span>
    &lt;/if&gt;  
    &lt;if test=<span class="hljs-string">"studentId != null and studentId != '' "</span>&gt;  
        <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_ID = <span class="hljs-preprocessor">#{studentId, jdbcType=VARCHAR}  </span>
    &lt;/if&gt;   
&lt;/select&gt;  </code></pre> 
<p>使用时比较灵活， new一个这样的实体类，我们需要限制那个条件，只需要附上相应的值就会where这个条件，相反不去赋值就可以不在where中判断。</p> 
<pre class="prettyprint"><code class=" hljs avrasm">public void select_test_2_1() {  
    StudentEntity entity = new StudentEntity()<span class="hljs-comment">;  </span>
    entity<span class="hljs-preprocessor">.setStudentName</span>(<span class="hljs-string">""</span>)<span class="hljs-comment">;  </span>
    entity<span class="hljs-preprocessor">.setStudentSex</span>(<span class="hljs-number">1</span>)<span class="hljs-comment">;  </span>
    entity<span class="hljs-preprocessor">.setStudentBirthday</span>(DateUtil<span class="hljs-preprocessor">.parse</span>(<span class="hljs-string">"1985-05-28"</span>))<span class="hljs-comment">;  </span>
    entity<span class="hljs-preprocessor">.setClassId</span>(<span class="hljs-string">"20000001"</span>)<span class="hljs-comment">;  </span>
    //entity<span class="hljs-preprocessor">.setPlaceId</span>(<span class="hljs-string">"70000001"</span>)<span class="hljs-comment">;  </span>
    List&lt;StudentEntity&gt; list = this<span class="hljs-preprocessor">.dynamicSqlMapper</span><span class="hljs-preprocessor">.getStudentList</span>_if(entity)<span class="hljs-comment">;  </span>
    for (StudentEntity e : list) {  
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(e<span class="hljs-preprocessor">.toString</span>())<span class="hljs-comment">;  </span>
    }  
}  </code></pre> 
<h4 id="2if-where-的条件判断"><strong>2、if + where 的条件判断</strong></h4> 
<p>当where中的条件使用的if标签较多时，这样的组合可能会导致错误。我们以在1中的查询语句为例子，当java代码按如下方法调用时：</p> 
<pre class="prettyprint"><code class=" hljs cs">@Test  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">select_test_2_1</span>() {  
    StudentEntity entity = <span class="hljs-keyword">new</span> StudentEntity();  
    entity.setStudentName(<span class="hljs-keyword">null</span>);  
    entity.setStudentSex(<span class="hljs-number">1</span>);  
    List&lt;StudentEntity&gt; list = <span class="hljs-keyword">this</span>.dynamicSqlMapper.getStudentList_if(entity);  
    <span class="hljs-keyword">for</span> (StudentEntity e : list) {  
        System.<span class="hljs-keyword">out</span>.println(e.toString());  
    }  
}  </code></pre> 
<p>如果上面例子，参数studentName为null，将不会进行STUDENT_NAME列的判断，则会直接导“WHERE AND”关键字多余的错误SQL。</p> 
<p>这时我们可以使用where动态语句来解决。这个“where”标签会知道如果它包含的标签中有返回值的话，它就插入一个‘where’。此外，如果标签返回的内容是以AND 或OR 开头的，则它会剔除掉。 <br> 上面例子修改为：</p> 
<pre class="prettyprint"><code class=" hljs avrasm">&lt;!-- <span class="hljs-number">3</span> select - where/if(判断参数) - 将实体类不为空的属性作为where条件 --&gt;  
&lt;select id=<span class="hljs-string">"getStudentList_whereIf"</span> resultMap=<span class="hljs-string">"resultMap_studentEntity"</span> parameterType=<span class="hljs-string">"liming.student.manager.data.model.StudentEntity"</span>&gt;  
    SELECT <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_ID,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_NAME,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_SEX,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_BIRTHDAY,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_PHOTO,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID  
      FROM STUDENT_TBL <span class="hljs-keyword">ST</span>   
    &lt;where&gt;  
        &lt;if test=<span class="hljs-string">"studentName !=null "</span>&gt;  
            <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_NAME LIKE CONCAT(CONCAT(<span class="hljs-string">'%'</span>, <span class="hljs-preprocessor">#{studentName, jdbcType=VARCHAR}),'%')  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"studentSex != null and studentSex != '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_SEX = <span class="hljs-preprocessor">#{studentSex, jdbcType=INTEGER}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"studentBirthday != null "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_BIRTHDAY = <span class="hljs-preprocessor">#{studentBirthday, jdbcType=DATE}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"classId != null and classId!= '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID = <span class="hljs-preprocessor">#{classId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"classEntity != null and classEntity.classId !=null and classEntity.classId !=' ' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID = <span class="hljs-preprocessor">#{classEntity.classId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"placeId != null and placeId != '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID = <span class="hljs-preprocessor">#{placeId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"placeEntity != null and placeEntity.placeId != null and placeEntity.placeId != '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID = <span class="hljs-preprocessor">#{placeEntity.placeId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"studentId != null and studentId != '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_ID = <span class="hljs-preprocessor">#{studentId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
    &lt;/where&gt;    
&lt;/select&gt;  </code></pre> 
<h4 id="3if-set-的更新语句"><strong>3、if + set 的更新语句</strong></h4> 
<p>当update语句中没有使用if标签时，如果有一个参数为null，都会导致错误。 <br> 当在update语句中使用if标签时，如果前面的if没有执行，则或导致逗号多余错误。使用set标签可以将动态的配置SET 关键字，和剔除追加到条件末尾的任何不相关的逗号。<strong>如果set包含的内容为空的话则会出错。</strong></p> 
<p>使用if+set标签修改后，如果某项为null则不进行更新，而是保持数据库原值。如下示例：</p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-comment">&lt;!-- 4 if/set(判断参数) - 将实体类不为空的属性更新 --&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">update</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"updateStudent_if_set"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"liming.student.manager.data.model.StudentEntity"</span>&gt;</span>  
    UPDATE STUDENT_TBL  
    <span class="hljs-tag">&lt;<span class="hljs-title">set</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"studentName != null and studentName != '' "</span>&gt;</span>  
            STUDENT_TBL.STUDENT_NAME = #{studentName},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"studentSex != null and studentSex != '' "</span>&gt;</span>  
            STUDENT_TBL.STUDENT_SEX = #{studentSex},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"studentBirthday != null "</span>&gt;</span>  
            STUDENT_TBL.STUDENT_BIRTHDAY = #{studentBirthday},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"studentPhoto != null "</span>&gt;</span>  
            STUDENT_TBL.STUDENT_PHOTO = #{studentPhoto, javaType=byte[], jdbcType=BLOB, typeHandler=org.apache.ibatis.type.BlobTypeHandler},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"classId != '' "</span>&gt;</span>  
            STUDENT_TBL.CLASS_ID = #{classId}  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"placeId != '' "</span>&gt;</span>  
            STUDENT_TBL.PLACE_ID = #{placeId}  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
    <span class="hljs-tag">&lt;/<span class="hljs-title">set</span>&gt;</span>  
    WHERE STUDENT_TBL.STUDENT_ID = #{studentId};      
<span class="hljs-tag">&lt;/<span class="hljs-title">update</span>&gt;</span>  </code></pre> 
<h4 id="4choose-when-otherwise"><strong>4、choose (when, otherwise)</strong></h4> 
<p>有时候我们并不想应用所有的条件，而只是想从多个选项中选择一个。而使用if标签时，只要test中的表达式为true，就会执行if标签中的条件。MyBatis提供了choose 元素。if标签是与(and)的关系，而choose标签是或（or）的关系。</p> 
<p>choose标签是按顺序判断其内部when标签中的test条件出否成立，<strong>如果有一个成立，则choose结束。</strong>当choose中所有when的条件都不满则时，则执行otherwise中的sql。类似于Java 的switch 语句，choose为switch，when为case，otherwise则为default。</p> 
<p>例如下面例子，同样把所有可以限制的条件都写上，方面使用。choose会从上到下选择一个when标签的test为true的sql执行。安全考虑，我们使用where将choose包起来，放置关键字多于错误。</p> 
<pre class="prettyprint"><code class=" hljs avrasm">&lt;!-- <span class="hljs-number">6</span> choose(判断参数) - 按顺序将实体类第一个不为空的属性作为where条件 --&gt;  
&lt;select id=<span class="hljs-string">"getStudentList_choose"</span> resultMap=<span class="hljs-string">"resultMap_studentEntity"</span> parameterType=<span class="hljs-string">"liming.student.manager.data.model.StudentEntity"</span>&gt;  
    SELECT <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_ID,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_NAME,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_SEX,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_BIRTHDAY,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_PHOTO,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID  
      FROM STUDENT_TBL <span class="hljs-keyword">ST</span>   
    &lt;where&gt;  
        &lt;choose&gt;  
            &lt;when test=<span class="hljs-string">"studentName !=null "</span>&gt;  
                <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_NAME LIKE CONCAT(CONCAT(<span class="hljs-string">'%'</span>, <span class="hljs-preprocessor">#{studentName, jdbcType=VARCHAR}),'%')  </span>
            &lt;/when &gt;  
            &lt;when test=<span class="hljs-string">"studentSex != null and studentSex != '' "</span>&gt;  
                <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_SEX = <span class="hljs-preprocessor">#{studentSex, jdbcType=INTEGER}  </span>
            &lt;/when &gt;  
            &lt;when test=<span class="hljs-string">"studentBirthday != null "</span>&gt;  
                <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_BIRTHDAY = <span class="hljs-preprocessor">#{studentBirthday, jdbcType=DATE}  </span>
            &lt;/when &gt;  
            &lt;when test=<span class="hljs-string">"classId != null and classId!= '' "</span>&gt;  
                <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID = <span class="hljs-preprocessor">#{classId, jdbcType=VARCHAR}  </span>
            &lt;/when &gt;  
            &lt;when test=<span class="hljs-string">"classEntity != null and classEntity.classId !=null and classEntity.classId !=' ' "</span>&gt;  
                <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID = <span class="hljs-preprocessor">#{classEntity.classId, jdbcType=VARCHAR}  </span>
            &lt;/when &gt;  
            &lt;when test=<span class="hljs-string">"placeId != null and placeId != '' "</span>&gt;  
                <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID = <span class="hljs-preprocessor">#{placeId, jdbcType=VARCHAR}  </span>
            &lt;/when &gt;  
            &lt;when test=<span class="hljs-string">"placeEntity != null and placeEntity.placeId != null and placeEntity.placeId != '' "</span>&gt;  
                <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID = <span class="hljs-preprocessor">#{placeEntity.placeId, jdbcType=VARCHAR}  </span>
            &lt;/when &gt;  
            &lt;when test=<span class="hljs-string">"studentId != null and studentId != '' "</span>&gt;  
                <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_ID = <span class="hljs-preprocessor">#{studentId, jdbcType=VARCHAR}  </span>
            &lt;/when &gt;  
            &lt;otherwise&gt;  
            &lt;/otherwise&gt;  
        &lt;/choose&gt;  
    &lt;/where&gt;    
&lt;/select&gt;  </code></pre> 
<h4 id="5trim标签"><strong>5、trim标签</strong></h4> 
<p>trim元素的主要功能是可以在自己包含的内容前加上某些前缀，也可以在其后加上某些后缀，与之对应的属性是<strong>prefix</strong>和<strong>suffix</strong>；可以把包含内容的首部某些内容覆盖，即忽略，也可以把尾部的某些内容覆盖，对应的属性是<strong>prefixOverrides</strong>和<strong>suffixOverrides</strong>。正因为trim有这样的功能，所以我们也可以非常简单的利用trim来代替where/set标签的功能，示例代码如下：</p> 
<p><strong>trim代替where标签：</strong></p> 
<pre class="prettyprint"><code class=" hljs avrasm">&lt;!-- <span class="hljs-number">5.1</span> if/trim代替where(判断参数) - 将实体类不为空的属性作为where条件 --&gt;  
&lt;select id=<span class="hljs-string">"getStudentList_if_trim"</span> resultMap=<span class="hljs-string">"resultMap_studentEntity"</span>&gt;  
    SELECT <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_ID,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_NAME,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_SEX,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_BIRTHDAY,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_PHOTO,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID,  
           <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID  
      FROM STUDENT_TBL <span class="hljs-keyword">ST</span>   
    &lt;trim prefix=<span class="hljs-string">"WHERE"</span> prefixOverrides=<span class="hljs-string">"AND|OR"</span>&gt;  
        &lt;if test=<span class="hljs-string">"studentName !=null "</span>&gt;  
            <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_NAME LIKE CONCAT(CONCAT(<span class="hljs-string">'%'</span>, <span class="hljs-preprocessor">#{studentName, jdbcType=VARCHAR}),'%')  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"studentSex != null and studentSex != '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_SEX = <span class="hljs-preprocessor">#{studentSex, jdbcType=INTEGER}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"studentBirthday != null "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_BIRTHDAY = <span class="hljs-preprocessor">#{studentBirthday, jdbcType=DATE}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"classId != null and classId!= '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID = <span class="hljs-preprocessor">#{classId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"classEntity != null and classEntity.classId !=null and classEntity.classId !=' ' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.CLASS</span>_ID = <span class="hljs-preprocessor">#{classEntity.classId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"placeId != null and placeId != '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID = <span class="hljs-preprocessor">#{placeId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"placeEntity != null and placeEntity.placeId != null and placeEntity.placeId != '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.PLACE</span>_ID = <span class="hljs-preprocessor">#{placeEntity.placeId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
        &lt;if test=<span class="hljs-string">"studentId != null and studentId != '' "</span>&gt;  
            <span class="hljs-keyword">AND</span> <span class="hljs-keyword">ST</span><span class="hljs-preprocessor">.STUDENT</span>_ID = <span class="hljs-preprocessor">#{studentId, jdbcType=VARCHAR}  </span>
        &lt;/if&gt;  
    &lt;/trim&gt;     
&lt;/select&gt; </code></pre> 
<p><strong>trim代替set标签</strong></p> 
<pre class="prettyprint"><code class=" hljs xml"><span class="hljs-comment">&lt;!-- 5.2 if/trim代替set(判断参数) - 将实体类不为空的属性更新 --&gt;</span>  
<span class="hljs-tag">&lt;<span class="hljs-title">update</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"updateStudent_if_trim"</span> <span class="hljs-attribute">parameterType</span>=<span class="hljs-value">"liming.student.manager.data.model.StudentEntity"</span>&gt;</span>  
    UPDATE STUDENT_TBL  
    <span class="hljs-tag">&lt;<span class="hljs-title">trim</span> <span class="hljs-attribute">prefix</span>=<span class="hljs-value">"SET"</span> <span class="hljs-attribute">suffixOverrides</span>=<span class="hljs-value">","</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"studentName != null and studentName != '' "</span>&gt;</span>  
            STUDENT_TBL.STUDENT_NAME = #{studentName},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"studentSex != null and studentSex != '' "</span>&gt;</span>  
            STUDENT_TBL.STUDENT_SEX = #{studentSex},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"studentBirthday != null "</span>&gt;</span>  
            STUDENT_TBL.STUDENT_BIRTHDAY = #{studentBirthday},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"studentPhoto != null "</span>&gt;</span>  
            STUDENT_TBL.STUDENT_PHOTO = #{studentPhoto, javaType=byte[], jdbcType=BLOB, typeHandler=org.apache.ibatis.type.BlobTypeHandler},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"classId != '' "</span>&gt;</span>  
            STUDENT_TBL.CLASS_ID = #{classId},  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
        <span class="hljs-tag">&lt;<span class="hljs-title">if</span> <span class="hljs-attribute">test</span>=<span class="hljs-value">"placeId != '' "</span>&gt;</span>  
            STUDENT_TBL.PLACE_ID = #{placeId}  
        <span class="hljs-tag">&lt;/<span class="hljs-title">if</span>&gt;</span>  
    <span class="hljs-tag">&lt;/<span class="hljs-title">trim</span>&gt;</span>  
    WHERE STUDENT_TBL.STUDENT_ID = #{studentId}  
<span class="hljs-tag">&lt;/<span class="hljs-title">update</span>&gt;</span> </code></pre> 
<h4 id="6foreach标签"><strong>6、foreach标签</strong></h4> 
<p>foreach的主要用在构建in条件中，它可以在SQL语句中进行迭代一个集合。<strong>foreach元素的属性主要有item，index，collection，open，separator，close。</strong></p> 
<ul><li><strong>item</strong>表示集合中每一个元素进行迭代时的别名；</li><li><strong>index</strong>指定一个名字，用于表示在迭代过程中，每次迭代到的位置；</li><li><strong>open</strong>表示该语句以什么开始；</li><li><strong>separator</strong>表示在每次进行迭代之间以什么符号作为分隔符；</li><li><strong>close</strong>表示以什么结束；</li><li>在使用foreach的时候最关键的也是最容易出错的就是<strong>collection</strong>属性，该属性是必须指定的，但是在不同情况下，该属性的值是不一样的，主要有一下3种情况： <br> 
  <ul><li>如果传入的是单参数且参数类型是一个List的时候，collection属性值为list</li><li>如果传入的是单参数且参数类型是一个array数组的时候，collection的属性值为array</li><li>如果传入的参数是多个的时候，我们就需要把它们封装成一个Map了，当然单参数也可以封装成map，实际上如果你在传入参数的时候，在MyBatis里面也是会把它封装成一个Map的，map的key就是参数名，所以这个时候collection属性值就是传入的List或array对象在自己封装的map里面的key</li></ul></li></ul> 
<p>下面分别来看看上述三种情况的示例代码：</p> 
<h5 id="1单参数list的类型"><strong>1）单参数List的类型：</strong></h5> 
<pre class="prettyprint"><code class=" hljs cs">&lt;<span class="hljs-keyword">select</span> id=<span class="hljs-string">"dynamicForeachTest"</span> resultType=<span class="hljs-string">"Blog"</span>&gt;  
    <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> t_blog <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span>  
    &lt;<span class="hljs-keyword">foreach</span> collection=<span class="hljs-string">"list"</span> index=<span class="hljs-string">"index"</span> item=<span class="hljs-string">"item"</span> open=<span class="hljs-string">"("</span> separator=<span class="hljs-string">","</span> close=<span class="hljs-string">")"</span>&gt;  
        <span class="hljs-preprocessor">#{item}  </span>
    &lt;/<span class="hljs-keyword">foreach</span>&gt;  
&lt;/<span class="hljs-keyword">select</span>&gt;  </code></pre> 
<p>上述collection的值为list，对应的Mapper是这样的：</p> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-keyword">public</span> <span class="hljs-built_in">List</span><span class="hljs-subst">&lt;</span>Blog<span class="hljs-subst">&gt;</span> dynamicForeachTest(<span class="hljs-built_in">List</span><span class="hljs-subst">&lt;</span><span class="hljs-built_in">Integer</span><span class="hljs-subst">&gt;</span> ids);  </code></pre> 
<p>测试代码：</p> 
<pre class="prettyprint"><code class=" hljs avrasm">@Test  
public void dynamicForeachTest() {  
    SqlSession session = Util<span class="hljs-preprocessor">.getSqlSessionFactory</span>()<span class="hljs-preprocessor">.openSession</span>()<span class="hljs-comment">;  </span>
    BlogMapper blogMapper = session<span class="hljs-preprocessor">.getMapper</span>(BlogMapper<span class="hljs-preprocessor">.class</span>)<span class="hljs-comment">;  </span>
    List&lt;Integer&gt; ids = new ArrayList&lt;Integer&gt;()<span class="hljs-comment">;  </span>
    ids<span class="hljs-preprocessor">.add</span>(<span class="hljs-number">1</span>)<span class="hljs-comment">;  </span>
    ids<span class="hljs-preprocessor">.add</span>(<span class="hljs-number">3</span>)<span class="hljs-comment">;  </span>
    ids<span class="hljs-preprocessor">.add</span>(<span class="hljs-number">6</span>)<span class="hljs-comment">;  </span>
    List&lt;Blog&gt; blogs = blogMapper<span class="hljs-preprocessor">.dynamicForeachTest</span>(ids)<span class="hljs-comment">;  </span>
    for (Blog blog : blogs)  
        System<span class="hljs-preprocessor">.out</span><span class="hljs-preprocessor">.println</span>(blog)<span class="hljs-comment">;  </span>
    session<span class="hljs-preprocessor">.close</span>()<span class="hljs-comment">;  </span>
}</code></pre> 
<h5 id="2单参数array数组的类型"><strong>2）单参数array数组的类型：</strong></h5> 
<pre class="prettyprint"><code class=" hljs cs">&lt;<span class="hljs-keyword">select</span> id=<span class="hljs-string">"dynamicForeach2Test"</span> resultType=<span class="hljs-string">"Blog"</span>&gt;  
    <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> t_blog <span class="hljs-keyword">where</span> id <span class="hljs-keyword">in</span>  
    &lt;<span class="hljs-keyword">foreach</span> collection=<span class="hljs-string">"array"</span> index=<span class="hljs-string">"index"</span> item=<span class="hljs-string">"item"</span> open=<span class="hljs-string">"("</span> separator=<span class="hljs-string">","</span> close=<span class="hljs-string">")"</span>&gt;  
        <span class="hljs-preprocessor">#{item}  </span>
    &lt;/<span class="hljs-keyword">foreach</span>&gt;  
&lt;/<span class="hljs-keyword">select</span>&gt;  </code></pre> 
<p>上述collection为array，对应的Mapper代码：</p> 
<pre class="prettyprint"><code class=" hljs cs"><span class="hljs-keyword">public</span> List&lt;Blog&gt; <span class="hljs-title">dynamicForeach2Test</span>(<span class="hljs-keyword">int</span>[] ids);  </code></pre> 
<p>测试代码：</p> 
<pre class="prettyprint"><code class=" hljs cs">@Test  
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dynamicForeach2Test</span>() {  
    SqlSession session = Util.getSqlSessionFactory().openSession();  
    BlogMapper blogMapper = session.getMapper(BlogMapper.class);  
    <span class="hljs-keyword">int</span>[] ids = <span class="hljs-keyword">new</span> <span class="hljs-keyword">int</span>[] {<!-- --><span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>};  
    List&lt;Blog&gt; blogs = blogMapper.dynamicForeach2Test(ids);  
    <span class="hljs-keyword">for</span> (Blog blog : blogs)  
        System.<span class="hljs-keyword">out</span>.println(blog);  
    session.close();  
}  </code></pre> 
<h5 id="3自己把参数封装成map的类型"><strong>3）自己把参数封装成Map的类型</strong></h5> 
<pre class="prettyprint"><code class=" hljs cs">&lt;<span class="hljs-keyword">select</span> id=<span class="hljs-string">"dynamicForeach3Test"</span> resultType=<span class="hljs-string">"Blog"</span>&gt;  
    <span class="hljs-keyword">select</span> * <span class="hljs-keyword">from</span> t_blog <span class="hljs-keyword">where</span> title like <span class="hljs-string">"%"</span><span class="hljs-preprocessor">#{title}"%" and id in  </span>
    &lt;<span class="hljs-keyword">foreach</span> collection=<span class="hljs-string">"ids"</span> index=<span class="hljs-string">"index"</span> item=<span class="hljs-string">"item"</span> open=<span class="hljs-string">"("</span> separator=<span class="hljs-string">","</span> close=<span class="hljs-string">")"</span>&gt;  
        <span class="hljs-preprocessor">#{item}  </span>
    &lt;/<span class="hljs-keyword">foreach</span>&gt;  
&lt;/<span class="hljs-keyword">select</span>&gt;  </code></pre> 
<p>上述collection的值为ids，是传入的参数Map的key，对应的Mapper代码：</p> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-keyword">public</span> <span class="hljs-built_in">List</span><span class="hljs-subst">&lt;</span>Blog<span class="hljs-subst">&gt;</span> dynamicForeach3Test(<span class="hljs-built_in">Map</span><span class="hljs-subst">&lt;</span><span class="hljs-built_in">String</span>, Object<span class="hljs-subst">&gt;</span> <span class="hljs-keyword">params</span>); </code></pre> 
<p>测试代码：</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver">@Test  
public void dynamicForeach3Test() {  
    SqlSession session = Util.getSqlSessionFactory().openSession();  
    BlogMapper blogMapper = session.getMapper(BlogMapper.class);  
    final List&lt;Integer&gt; ids = <span class="hljs-built_in">new</span> ArrayList&lt;Integer&gt;();  
    ids.<span class="hljs-built_in">add</span>(<span class="hljs-number">1</span>);  
    ids.<span class="hljs-built_in">add</span>(<span class="hljs-number">2</span>);  
    ids.<span class="hljs-built_in">add</span>(<span class="hljs-number">3</span>);  
    ids.<span class="hljs-built_in">add</span>(<span class="hljs-number">6</span>);  
    ids.<span class="hljs-built_in">add</span>(<span class="hljs-number">7</span>);  
    ids.<span class="hljs-built_in">add</span>(<span class="hljs-number">9</span>);  
    Map&lt;String, Object&gt; <span class="hljs-built_in">params</span> = <span class="hljs-built_in">new</span> HashMap&lt;String, Object&gt;();  
    <span class="hljs-built_in">params</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">"ids"</span>, ids);  
    <span class="hljs-built_in">params</span>.<span class="hljs-built_in">put</span>(<span class="hljs-string">"title"</span>, <span class="hljs-string">"中国"</span>);  
    List&lt;Blog&gt; blogs = blogMapper.dynamicForeach3Test(<span class="hljs-built_in">params</span>);  
    <span class="hljs-keyword">for</span> (Blog blog : blogs)  
        System.out.println(blog);  
    session.<span class="hljs-built_in">close</span>();  
}  </code></pre> 
<blockquote> 
 <p>转载：<a href="http://haohaoxuexi.iteye.com/blog/1338557" rel="nofollow">http://haohaoxuexi.iteye.com/blog/1338557</a> <br> <a href="http://limingnihao.iteye.com/blog/782190" rel="nofollow">http://limingnihao.iteye.com/blog/782190</a></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff5fb027d2f810d310693b7417a2ae86/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mybatis——select、insert、update、delete</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3dd69eab46ae4cf1cb3bff6d6a150c78/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux 中的各种栈：进程栈 线程栈 内核栈 中断栈</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>