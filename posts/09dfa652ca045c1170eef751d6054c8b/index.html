<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>FPGA-DHT11：温湿度传感器 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="FPGA-DHT11：温湿度传感器" />
<meta property="og:description" content="1.DHT11基本知识 （1）单总线 DHT11器件采用简化的单总线通信。单总线即只有一根数据线，系统中的数据交换、控制均由单总线完成。设备（主机或从机）通过一个漏极开路或三态端口连至该数据线，以允许设备在不发送数据时能够释放总线，而让其它设备使用总线；单总线通常要求外接一个约4.7kΩ的上拉电阻，这样，当总线闲置时，其状态为高电平。由于它们是主从结构，只有主机呼叫从机时，从机才能应答，因此主机访问器件都必须严格遵循单总线序列，如果出现序列混乱，器件将不响应主机。
DATA用于微处理器与DHT11之间的通讯和同步,采用单总线数据格式，一次传送40位数据，高位先出。
(2）数据格式 8bit湿度整数数据&#43;8bit湿度小数数据&#43;8bit温度整数数据&#43;8bit温度小数数据&#43;8bit校验位
data[39:32]&#43;data[31:24]&#43;data[23:16]&#43;data[15:8]=data[7:0]
2.画时序图 由datasheet可知，一次完整的读取过程大致分为：INIT（初始化，即主机唤醒从机，从机响应），READ（40个bit数据的读取），WAIT（每次读取时间间隔需大于2秒，同时这两秒也包含了数据处理）。
首先在INIT初始状态时，主机需要先主动拉低约18ms，因此传输data的i/o口应该定义为inout;
模块框图如下：
首先，因为datasheet里最低的处理时间单位是us,而fpga使用了50MHz时钟，所以要先定义出时间计数器：
当计数到相应的时间主机开始拉低，
拉低的时间要求根据datasheet设定
在主机释放总线后，之后总线被从机接管，从机按照规定时序向主机发送数据；
从机的响应时间应根据datasheet设定；
如何从INIT状态跳转到READ状态呢？
我选择的条件是：cnt_ms==Tbe &#43; 1 &amp;&amp; cnt_us == Tgo&#43;Trel&#43;Treh 时，图中其实多计数了1us，但是不影响，而且这些数值也不是绝对的，需要不断去调试才能确定选哪个数值最好，一切以实际测试为主。
根据个人习惯，我先定义了一个读使能信号 read_en，用来协助cnt_h信号，cnt_h是在READ状态下对data的高电平计数，目的就是来区分数据“0”和‘“1”，
当cnt_h计数了23-27us表示“0”’，计数了68us-74us表示“1”；为什么要对data的高电平计数，而不是直接对单个bit数据计数呢，因为“0”和“1”不等长，所以 无法判断单个bit的长度。
那如何取出cnt_h的数值呢，因为无法去定义一个数使得cnt_h等于这个数时将数值取出。
我选择将信号打一拍然后做对比：
这样取出来的数就可以判断是落在23us-27us之间还是68us-74us之间，从而判断出0和1；
将这样的步骤完成40次，基本上就完成了数据的读取；
如何从READ状态跳转到WAIT状态呢？那就可以定义一个cnt_bit信号，当cnt_bit完成计数40次后转到WAIT状态；
3.总结 WAIT状态至少要2秒，这两秒可以用来检查校验码，并且完成温湿度输出或者其他操作，我的很多信号其实没必要生成，我只是为了自己过段时间不忘，不过定义了也并不会占用很多资源，因为不定义这些综合器也会有可能生成类似的资源，一切以实际为主，我的并不是最优解。
资料以及代码：https://pan.baidu.com/s/1_j2y37xk94G0EmKF-rAfjw 提取码：8z0r" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/09dfa652ca045c1170eef751d6054c8b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-04T13:58:40+08:00" />
<meta property="article:modified_time" content="2023-06-04T13:58:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">FPGA-DHT11：温湿度传感器</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1DHT11_2"></a>1.DHT11基本知识</h3> 
<h4><a id="1_4"></a>（1）单总线</h4> 
<p>DHT11器件采用简化的单总线通信。单总线即只有一根数据线，系统中的数据交换、控制均由单总线完成。设备（主机或从机）通过一个漏极开路或三态端口连至该数据线，以允许设备在不发送数据时能够释放总线，而让其它设备使用总线；单总线通常要求外接一个约4.7kΩ的上拉电阻，这样，当总线闲置时，其状态为高电平。由于它们是主从结构，只有主机呼叫从机时，从机才能应答，因此主机访问器件都必须严格遵循单总线序列，如果出现序列混乱，器件将不响应主机。<br> DATA用于微处理器与DHT11之间的通讯和同步,采用单总线数据格式，一次传送40位数据，<mark>高位先出</mark>。</p> 
<h4><a id="2_8"></a>(2）数据格式</h4> 
<p>8bit湿度整数数据+8bit湿度小数数据+8bit温度整数数据+8bit温度小数数据+8bit校验位<br> data[39:32]+data[31:24]+data[23:16]+data[15:8]=data[7:0]<br> <img src="https://images2.imgbox.com/93/57/DZM2lTZs_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_13"></a>2.画时序图</h3> 
<p><img src="https://images2.imgbox.com/25/0c/u0jGKo68_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ae/cb/BKuwaX1w_o.png" alt="在这里插入图片描述"></p> 
<p>由datasheet可知，一次完整的读取过程大致分为：<strong>INIT</strong>（初始化，即主机唤醒从机，从机响应），<strong>READ</strong>（40个bit数据的读取），<strong>WAIT</strong>（每次读取时间间隔需大于2秒，同时这两秒也包含了数据处理）。</p> 
<p>首先在INIT初始状态时，主机需要先主动拉低约18ms，因此传输data的i/o口应该定义为inout;<br> <img src="https://images2.imgbox.com/50/a4/apwtWSN8_o.png" alt="在这里插入图片描述"><br> 模块框图如下：<br> <img src="https://images2.imgbox.com/8b/74/mDSkVEI6_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/fc/de/Mv3jPHsz_o.png" alt="在这里插入图片描述"><br> 首先，因为datasheet里最低的处理时间单位是us,而fpga使用了50MHz时钟，所以要先定义出时间计数器：<br> <img src="https://images2.imgbox.com/48/ee/9QFGkoyl_o.png" alt="在这里插入图片描述"><br> 当计数到相应的时间主机开始拉低，<br> <img src="https://images2.imgbox.com/0c/fd/Luc2JxMS_o.png" alt="在这里插入图片描述"></p> 
<p>拉低的时间要求根据datasheet设定<br> <img src="https://images2.imgbox.com/93/f1/wXFjWP0E_o.png" alt="在这里插入图片描述"></p> 
<p>在主机释放总线后，之后总线被从机接管，从机按照规定时序向主机发送数据；<br> <img src="https://images2.imgbox.com/ba/eb/AlbaWDDk_o.png" alt="在这里插入图片描述"><br> 从机的响应时间应根据datasheet设定；</p> 
<p>如何从INIT状态跳转到READ状态呢？<br> 我选择的条件是：cnt_ms==Tbe + 1 &amp;&amp; cnt_us == Tgo+Trel+Treh 时，图中其实多计数了1us，但是不影响，而且这些数值也不是绝对的，需要不断去调试才能确定选哪个数值最好，一切以实际测试为主。<br> <img src="https://images2.imgbox.com/e0/ee/WmG6nbAP_o.png" alt="在这里插入图片描述"><br> 根据个人习惯，我先定义了一个读使能信号 read_en，用来协助cnt_h信号，cnt_h是在READ状态下对data的高电平计数，目的就是来区分数据“0”和‘“1”，<br> <img src="https://images2.imgbox.com/04/8c/NjXBJEzf_o.png" alt="在这里插入图片描述"><br> 当cnt_h计数了23-27us表示“0”’，计数了68us-74us表示“1”；为什么要对data的高电平计数，而不是直接对单个bit数据计数呢，因为“0”和“1”不等长，所以 无法判断单个bit的长度。<br> 那如何取出cnt_h的数值呢，因为无法去定义一个数使得cnt_h等于这个数时将数值取出。<br> 我选择将信号打一拍然后做对比：<br> <img src="https://images2.imgbox.com/e0/59/iAuRSpgM_o.png" alt="在这里插入图片描述"><br> 这样取出来的数就可以判断是落在23us-27us之间还是68us-74us之间，从而判断出0和1；<br> 将这样的步骤完成40次，基本上就完成了数据的读取；<br> 如何从<strong>READ</strong>状态跳转到<strong>WAIT</strong>状态呢？那就可以定义一个cnt_bit信号，当cnt_bit完成计数40次后转到<strong>WAIT</strong>状态；<br> <img src="https://images2.imgbox.com/0b/e5/LWdX8eJh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_52"></a>3.总结</h3> 
<p><strong>WAIT</strong>状态至少要2秒，这两秒可以用来检查校验码，并且完成温湿度输出或者其他操作，我的很多信号其实没必要生成，我只是为了自己过段时间不忘，不过定义了也并不会占用很多资源，因为不定义这些综合器也会有可能生成类似的资源，一切以实际为主，我的并不是最优解。</p> 
<p>资料以及代码：https://pan.baidu.com/s/1_j2y37xk94G0EmKF-rAfjw 提取码：8z0r</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6d4c7dcc70f11e2ad3541f92f02e7464/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java：编写一个学生管理程序，选择集合类存储学生的学号、姓名和期末考试各科的成绩（课程名&#43;成绩，假设只包括数学、语文和英语三门课程）。实现如下功能：</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/083938f2d7c356d7bb1d2a9fc6de7d53/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深入理解Jar文件：创建、使用和多版本控制</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>