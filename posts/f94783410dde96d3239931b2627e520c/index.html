<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>从零开始写Python爬虫 --- 1.5 爬虫实践： 获取百度贴吧内容 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="从零开始写Python爬虫 --- 1.5 爬虫实践： 获取百度贴吧内容" />
<meta property="og:description" content="从零开始写Python爬虫 --- 1.5 爬虫实践： 获取百度贴吧内容 Ehco 5 个月前 经过前期大量的学习与准备，我们重要要开始写第一个真正意义上的爬虫了。本次我们要爬取的网站是：百度贴吧，一个非常适合新人练手的地方，那么让我们开始吧。
本次要爬的贴吧是&lt;&lt; 生活大爆炸吧 &gt;&gt;，生活大爆炸是我一直很喜欢的一部美剧，平时有空也会去看看吧友们都在聊些什么。所以这次选取这个吧来作为实验材料。
贴吧地址 :
http://tieba.baidu.com/f?kw=%E7%94%9F%E6%B4%BB%E5%A4%A7%E7%88%86%E7%82%B8&amp;ie=utf-8 Python版本 : 3.6 浏览器版本： Chrome
目标分析： 由于是第一个实验性质爬虫，我们要做的不多，我们需要做的就是：
从网上爬下特定页码的网页 对于爬下的页面内容进行简单的筛选分析 找到每一篇帖子的 标题、发帖人、日期、楼层、以及跳转链接 将结果保存到文本。 前期准备： 看到贴吧的url地址是不是觉得很乱？有那一大串认不得的字符？
其实这些都是中文字符， %E7%94%9F%E6%B4%BB%E5%A4%A7%E7%88%86%E7%82%B8
在编码之后就是： 生活大爆炸 。
链接的末尾处：&amp;ie=utf-8 表示该连接采用的是utf-8编码。
windows的默认编码是GBK，在处理这个连接的时候，需要我们在Python里手动设置一下，才能够成功使用。
Python3相对于Python2对于编码的支持有了很大的提升，默认全局采用utf-8编码，所以建议还在学Python2的小伙伴赶紧投入Python3的怀抱，真的省了老大的功夫了。
接着我们翻到贴吧的第二页：
url:
`url: http://tieba.baidu.com/f?kw=%E7%94%9F%E6%B4%BB%E5%A4%A7%E7%88%86%E7%82%B8&amp;ie=utf-8&amp;pn=50` 注意到没有，连接的末尾处多了一个参数&amp;pn=50, 这里我们很容易就能猜到，这个参数的与页码的联系：
&amp;pn=0 ： 首页 &amp;pn=50： 第二页 &amp;pn=100：第三页 &amp;pn=50*n 第n页 50 表示 每一页都有50篇帖子。 这下我们就能通过简单的url修改，达到翻页的效果了。
chrome开发人员工具的使用： 要写爬虫，我们一定要会使用开发工具，说起来这个工具是给前段开发人员用的，但是我们可以通过它快速定位我们要爬取的信息，并找到相对应的规律。
按cmd&#43;opt&#43;I 打开chrome工具，（win可以看按F12或者手动在chrome工具栏里打开）
使用模拟点击工具快速定位到一个单独帖子的位置。(左上角的鼠标箭头图标)
我们仔细的观察一下，发现每个帖子的内容都包裹在一个li标签内：
&lt;li class=&#34; j_thread_list clearfix&#34;&gt;
这样我们只要快速找出所有的符合规则的标签，
在进一步分析里面的内容，最后筛选出数据就可以了。
开始写代码吧？ 我们先写出抓取页面内人的函数： 这是前面介绍过的爬取框架，以后我们会经常用到。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f94783410dde96d3239931b2627e520c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-10-02T15:18:56+08:00" />
<meta property="article:modified_time" content="2017-10-02T15:18:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">从零开始写Python爬虫 --- 1.5 爬虫实践： 获取百度贴吧内容</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="PostIndex-header av-paddingTop av-card" style=""> 
 <h2 class="PostIndex-title av-paddingSide av-titleFont" style="margin:0px; font-style:inherit; font-variant:inherit; font-size:32px; line-height:1.3; font-family:inherit"> 从零开始写Python爬虫 --- 1.5 爬虫实践： 获取百度贴吧内容</h2> 
 <div class="PostIndex-author" style=""> 
  <a target="_blank" href="https://www.zhihu.com/people/Ehcostuff" rel="nofollow noopener noreferrer" style=""><img class="Avatar-hemingway PostIndex-authorAvatar Avatar--xs" alt="Ehco" src="https://images2.imgbox.com/42/d0/y9IhBxPj_o.jpg" style="overflow:hidden; width:36px; height:36px; margin-right:12px"></a> 
  <a target="_blank" href="https://www.zhihu.com/people/Ehcostuff" rel="nofollow noopener noreferrer" class="PostIndex-authorName" style="color:rgb(128,128,128); min-width:0px; text-overflow:ellipsis; white-space:nowrap; overflow:hidden">Ehco</a> 
  <span class="Bull" style="margin:0px 6px"></span> 
  <div class="HoverTitle" style="">
    5 个月前 
  </div> 
 </div> 
</div> 
<div class="RichText PostIndex-content av-paddingSide av-card" style=""> 
 <blockquote style="padding-left:1.2em; margin:20px 0px; border-left:4px solid rgb(226,227,228)"> 
  <p style="margin-top:20px; margin-bottom:20px">经过前期大量的学习与准备，我们重要要开始写第一个真正意义上的爬虫了。本次我们要爬取的网站是：<span style="">百度贴吧</span>，一个非常适合新人练手的地方，那么让我们开始吧。</p> 
 </blockquote> 
 <p style="margin-top:20px; margin-bottom:20px">本次要爬的贴吧是&lt;&lt; 生活大爆炸吧 &gt;&gt;，生活大爆炸是我一直很喜欢的一部美剧，平时有空也会去看看吧友们都在聊些什么。所以这次选取这个吧来作为实验材料。</p> 
 <blockquote style="padding-left:1.2em; margin:20px 0px; border-left:4px solid rgb(226,227,228)"> 
  <p style="margin-top:20px; margin-bottom:20px">贴吧地址 :</p> 
  <div class="highlight" style=""> 
   <pre style='margin-top:1em; margin-bottom:1em; padding:10px; overflow:auto; font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace; font-size:14px; word-wrap:normal; background:rgb(235,238,245)'><code class="language-text" style='font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace'><span style=""></span>http://tieba.baidu.com/f?kw=%E7%94%9F%E6%B4%BB%E5%A4%A7%E7%88%86%E7%82%B8&amp;ie=utf-8
</code></pre> 
  </div> 
  <p style="margin-top:20px; margin-bottom:20px"><br style=""> Python版本 : 3.6<br style=""> 浏览器版本： Chrome</p> 
 </blockquote> 
 <h4 style="margin:20px 0px; font-style:inherit; font-variant:inherit; font-size:24px; line-height:inherit; font-family:inherit"> <span style="">目标分析：</span></h4> 
 <p style="margin-top:20px; margin-bottom:20px">由于是第一个实验性质爬虫，我们要做的不多，我们需要做的就是：</p> 
 <ol style="margin:20px 0px; padding:0px 0px 0px 40px"><li style="list-style-type:decimal; margin-top:10px; list-style-position:outside"> 从网上爬下特定页码的网页</li><li style="list-style-type:decimal; margin-top:10px; list-style-position:outside"> 对于爬下的页面内容进行简单的筛选分析</li><li style="list-style-type:decimal; margin-top:10px; list-style-position:outside"> 找到每一篇帖子的 标题、发帖人、日期、楼层、以及跳转链接</li><li style="list-style-type:decimal; margin-top:10px; list-style-position:outside"> 将结果保存到文本。</li></ol> 
 <h4 style="margin:20px 0px; font-style:inherit; font-variant:inherit; font-size:24px; line-height:inherit; font-family:inherit"> <span style="">前期准备：</span></h4> 
 <p style="margin-top:20px; margin-bottom:20px">看到贴吧的url地址是不是觉得很乱？有那一大串认不得的字符？</p> 
 <p style="margin-top:20px; margin-bottom:20px">其实这些都是中文字符，<br style=""> %E7%94%9F%E6%B4%BB%E5%A4%A7%E7%88%86%E7%82%B8</p> 
 <p style="margin-top:20px; margin-bottom:20px">在编码之后就是： 生活大爆炸 。</p> 
 <p style="margin-top:20px; margin-bottom:20px">链接的末尾处：&amp;ie=utf-8 表示该连接采用的是utf-8编码。</p> 
 <blockquote style="padding-left:1.2em; margin:20px 0px; border-left:4px solid rgb(226,227,228)"> 
  <p style="margin-top:20px; margin-bottom:20px">windows的默认编码是GBK，在处理这个连接的时候，需要我们在Python里手动设置一下，才能够成功使用。</p> 
 </blockquote> 
 <br style=""> 
 <p style="margin-top:20px; margin-bottom:20px"><span style="font-weight:700">Python3相对于Python2对于编码的支持有了很大的提升，默认全局采用utf-8编码，所以建议还在学Python2的小伙伴赶紧投入Python3的怀抱，真的省了老大的功夫了。</span></p> 
 <p style="margin-top:20px; margin-bottom:20px">接着我们翻到贴吧的第二页：</p> 
 <p style="margin-top:20px; margin-bottom:20px">url:</p> 
 <div class="highlight" style=""> 
  <pre style='margin-top:1em; margin-bottom:1em; padding:10px; overflow:auto; font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace; font-size:14px; word-wrap:normal; background:rgb(235,238,245)'><code class="language-text" style='font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace'><span style=""></span>`url: http://tieba.baidu.com/f?kw=%E7%94%9F%E6%B4%BB%E5%A4%A7%E7%88%86%E7%82%B8&amp;ie=utf-8&amp;pn=50`
</code></pre> 
 </div> 
 <br style=""> 
 <br style=""> 
 <p style="margin-top:20px; margin-bottom:20px">注意到没有，连接的末尾处多了一个参数<span style="font-weight:700">&amp;pn=50,</span><br style=""> 这里我们很容易就能猜到，这个参数的与页码的联系：</p> 
 <ul style="margin:20px 0px; padding:0px 0px 0px 40px"><li style="list-style-type:initial; margin-top:10px; list-style-position:outside"> &amp;pn=0 ： 首页</li><li style="list-style-type:initial; margin-top:10px; list-style-position:outside"> &amp;pn=50： 第二页</li><li style="list-style-type:initial; margin-top:10px; list-style-position:outside"> &amp;pn=100：第三页</li><li style="list-style-type:initial; margin-top:10px; list-style-position:outside"> &amp;pn=50*n 第n页</li><li style="list-style-type:initial; margin-top:10px; list-style-position:outside"> 50 表示 每一页都有50篇帖子。</li></ul> 
 <p style="margin-top:20px; margin-bottom:20px">这下我们就能通过简单的url修改，达到翻页的效果了。</p> 
 <h4 style="margin:20px 0px; font-style:inherit; font-variant:inherit; font-size:24px; line-height:inherit; font-family:inherit"> <span style="">chrome开发人员工具的使用：</span></h4> 
 <p style="margin-top:20px; margin-bottom:20px"><br style=""> <br style=""> 要写爬虫，我们一定要会使用开发工具，说起来这个工具是给前段开发人员用的，但是我们可以通过它快速定位我们要爬取的信息，并找到相对应的规律。</p> 
 <ul style="margin:20px 0px; padding:0px 0px 0px 40px"><li style="list-style-type:initial; margin-top:10px; list-style-position:outside"> <p style="margin-top:20px; margin-bottom:20px">按cmd+opt+I 打开chrome工具，（win可以看按F12或者手动在chrome工具栏里打开）</p> </li></ul> 
 <img src="https://images2.imgbox.com/63/17/BvrmcgYt_o.png" class="origin_image zh-lightbox-thumb lazy" width="1185" alt="" style="overflow:hidden; display:block; max-width:100%; margin:0.72em auto"> 
 <br style=""> 
 <ul style="margin:20px 0px; padding:0px 0px 0px 40px"><li style="list-style-type:initial; margin-top:10px; list-style-position:outside"> <p style="margin-top:20px; margin-bottom:20px">使用模拟点击工具快速定位到一个单独帖子的位置。(左上角的鼠标箭头图标)</p> </li></ul> 
 <img src="https://images2.imgbox.com/95/ed/aweOl3Zj_o.png" class="origin_image zh-lightbox-thumb lazy" width="779" alt="" style="overflow:hidden; display:block; max-width:100%; margin:0.72em auto"> 
 <br style=""> 
 <p style="margin-top:20px; margin-bottom:20px">我们仔细的观察一下，发现每个帖子的内容都包裹在一个li标签内：</p> 
 <p style="margin-top:20px; margin-bottom:20px">&lt;li class=" j_thread_list clearfix"&gt;</p> 
 <p style="margin-top:20px; margin-bottom:20px">这样我们只要快速找出所有的符合规则的标签，</p> 
 <p style="margin-top:20px; margin-bottom:20px">在进一步分析里面的内容，最后筛选出数据就可以了。</p> 
 <h4 style="margin:20px 0px; font-style:inherit; font-variant:inherit; font-size:24px; line-height:inherit; font-family:inherit"> <span style="">开始写代码吧？</span></h4> 
 <h5 style="margin:20px 0px; font-size:24px"><span style="">我们先写出抓取页面内人的函数：</span></h5> 
 <p style="margin-top:20px; margin-bottom:20px">这是前面介绍过的爬取框架，以后我们会经常用到。</p> 
 <div class="highlight" style=""> 
  <pre style='margin-top:1em; margin-bottom:1em; padding:10px; overflow:auto; font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace; font-size:14px; word-wrap:normal; background:rgb(235,238,245)'><code class="language-python" style='font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace'><span style=""></span><span class="kn" style="font-weight:bold">import</span> <span class="nn" style="color:rgb(85,85,85)">requests</span> 
<span class="kn" style="font-weight:bold">from</span> <span class="nn" style="color:rgb(85,85,85)">bs4</span> <span class="kn" style="font-weight:bold">import</span> <span class="n" style="">BeautifulSoup</span>

<span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 首先我们写好抓取网页的函数</span>
<span class="k" style="font-weight:bold">def</span> <span class="nf" style="font-weight:bold; color:rgb(153,0,0)">get_html</span><span class="p" style="">(</span><span class="n" style="">url</span><span class="p" style="">):</span>
    <span class="k" style="font-weight:bold">try</span><span class="p" style="">:</span>
        <span class="n" style="">r</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">requests</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">get</span><span class="p" style="">(</span><span class="n" style="">url</span><span class="p" style="">,</span><span class="n" style="">timeout</span><span class="o" style="font-weight:bold">=</span><span class="mi" style="color:rgb(0,153,153)">30</span><span class="p" style="">)</span>
        <span class="n" style="">r</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">raise_for_status</span><span class="p" style="">()</span>
        <span class="c1" style="font-style:italic; color:rgb(153,153,136)">#这里我们知道百度贴吧的编码是utf-8，所以手动设置的。爬去其他的页面时建议使用：</span>
        <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># r.endcodding = r.apparent_endconding </span>
        <span class="n" style="">r</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">encoding</span><span class="o" style="font-weight:bold">=</span><span class="s1" style="color:rgb(221,51,34)">'utf-8'</span>
        <span class="k" style="font-weight:bold">return</span> <span class="n" style="">r</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">text</span>
    <span class="k" style="font-weight:bold">except</span><span class="p" style="">:</span>
        <span class="k" style="font-weight:bold">return</span> <span class="s2" style="color:rgb(221,51,34)">" ERROR "</span>
</code></pre> 
 </div> 
 <h5 style="margin:20px 0px; font-size:24px"><span style="">接着我们摘取其中的详细信息：</span></h5> 
 <ul style="margin:20px 0px; padding:0px 0px 0px 40px"><li style="list-style-type:initial; margin-top:10px; list-style-position:outside"> 我们来分一下每一个li标签内部的结构：</li></ul> 
 <p style="margin-top:20px; margin-bottom:20px">一个大的li标签内包裹着很多个 <span style="">div标签</span><br style=""> 而我们要的信息就在这一个个div标签之内：</p> 
 <div class="highlight" style=""> 
  <pre style='margin-top:1em; margin-bottom:1em; padding:10px; overflow:auto; font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace; font-size:14px; word-wrap:normal; background:rgb(235,238,245)'><code class="language-cfm" style='font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace'><span style=""></span># 标题<span class="err" style="color:rgb(166,23,23); background-color:rgb(227,210,210)">&amp;</span>帖子链接：
<span class="p" style="">&lt;</span><span class="nt" style="color:rgb(0,0,128)">a</span> <span class="na" style="color:rgb(0,128,128)">href</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"/p/4830198616"</span> <span class="na" style="color:rgb(0,128,128)">title</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"又重温一遍 第九季  这个侧脸给多少分"</span> <span class="na" style="color:rgb(0,128,128)">target</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"_blank"</span> <span class="na" style="color:rgb(0,128,128)">class</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"j_th_tit "</span><span class="p" style="">&gt;</span>又重温一遍 第九季  这个侧脸给多少分<span class="p" style="">&lt;/</span><span class="nt" style="color:rgb(0,0,128)">a</span><span class="p" style="">&gt;</span>

#发帖人：
<span class="p" style="">&lt;</span><span class="nt" style="color:rgb(0,0,128)">span</span> <span class="na" style="color:rgb(0,128,128)">class</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"tb_icon_author "</span> <span class="na" style="color:rgb(0,128,128)">title</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"主题作者: Li欣远"</span> <span class="na" style="color:rgb(0,128,128)">data-field</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">'{&amp;quot;user_id&amp;quot;:836897637}'</span><span class="p" style="">&gt;&lt;</span><span class="nt" style="color:rgb(0,0,128)">i</span> <span class="na" style="color:rgb(0,128,128)">class</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"icon_author"</span><span class="p" style="">&gt;&lt;/</span><span class="nt" style="color:rgb(0,0,128)">i</span><span class="p" style="">&gt;&lt;</span><span class="nt" style="color:rgb(0,0,128)">span</span> <span class="na" style="color:rgb(0,128,128)">class</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"frs-author-name-wrap"</span><span class="p" style="">&gt;&lt;</span><span class="nt" style="color:rgb(0,0,128)">a</span> <span class="na" style="color:rgb(0,128,128)">data-field</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">'{&amp;quot;un&amp;quot;:&amp;quot;Li\u6b23\u8fdc&amp;quot;}'</span> <span class="na" style="color:rgb(0,128,128)">class</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"frs-author-name j_user_card "</span> <span class="na" style="color:rgb(0,128,128)">href</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"/home/main/?un=Li%E6%AC%A3%E8%BF%9C&amp;ie=utf-8&amp;fr=frs"</span> <span class="na" style="color:rgb(0,128,128)">target</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"_blank"</span><span class="p" style="">&gt;</span>Li欣远<span class="p" style="">&lt;/</span><span class="nt" style="color:rgb(0,0,128)">a</span><span class="p" style="">&gt;&lt;/</span><span class="nt" style="color:rgb(0,0,128)">span</span><span class="p" style="">&gt;</span>

#回复数量：
<span class="p" style="">&lt;</span><span class="nt" style="color:rgb(0,0,128)">div</span> <span class="na" style="color:rgb(0,128,128)">class</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"col2_left j_threadlist_li_left"</span><span class="p" style="">&gt;</span>
<span class="p" style="">&lt;</span><span class="nt" style="color:rgb(0,0,128)">span</span> <span class="na" style="color:rgb(0,128,128)">class</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"threadlist_rep_num center_text"</span> <span class="na" style="color:rgb(0,128,128)">title</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"回复"</span><span class="p" style="">&gt;</span>24<span class="p" style="">&lt;/</span><span class="nt" style="color:rgb(0,0,128)">span</span><span class="p" style="">&gt;</span>
<span class="p" style="">&lt;/</span><span class="nt" style="color:rgb(0,0,128)">div</span><span class="p" style="">&gt;</span>

#发帖日期：
 <span class="p" style="">&lt;</span><span class="nt" style="color:rgb(0,0,128)">span</span> <span class="na" style="color:rgb(0,128,128)">class</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"pull-right is_show_create_time"</span> <span class="na" style="color:rgb(0,128,128)">title</span><span class="o" style="font-weight:bold">=</span><span class="s" style="color:rgb(221,51,34)">"创建时间"</span><span class="p" style="">&gt;</span>2016-10<span class="p" style="">&lt;/</span><span class="nt" style="color:rgb(0,0,128)">span</span><span class="p" style="">&gt;</span>
</code></pre> 
 </div> 
 <p style="margin-top:20px; margin-bottom:20px">分析完之后，我们就能很容易的通过soup.find()方法得到我们想要的结果</p> 
 <h5 style="margin:20px 0px; font-size:24px"><span style="">具体代码的实现：</span></h5> 
 <div class="highlight" style=""> 
  <pre style='margin-top:1em; margin-bottom:1em; padding:10px; overflow:auto; font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace; font-size:14px; word-wrap:normal; background:rgb(235,238,245)'><code class="language-python" style='font-family:Menlo,Monaco,Consolas,"Andale Mono","lucida console","Courier New",monospace'><span style=""></span><span class="sd" style="color:rgb(221,51,34)">'''</span>
<span class="sd" style="color:rgb(221,51,34)">抓取百度贴吧---生活大爆炸吧的基本内容</span>
<span class="sd" style="color:rgb(221,51,34)">爬虫线路： requests - bs4</span>
<span class="sd" style="color:rgb(221,51,34)">Python版本： 3.6</span>
<span class="sd" style="color:rgb(221,51,34)">OS： mac os 12.12.4</span>
<span class="sd" style="color:rgb(221,51,34)">'''</span>

<span class="kn" style="font-weight:bold">import</span> <span class="nn" style="color:rgb(85,85,85)">requests</span>
<span class="kn" style="font-weight:bold">import</span> <span class="nn" style="color:rgb(85,85,85)">time</span>
<span class="kn" style="font-weight:bold">from</span> <span class="nn" style="color:rgb(85,85,85)">bs4</span> <span class="kn" style="font-weight:bold">import</span> <span class="n" style="">BeautifulSoup</span>

<span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 首先我们写好抓取网页的函数</span>


<span class="k" style="font-weight:bold">def</span> <span class="nf" style="font-weight:bold; color:rgb(153,0,0)">get_html</span><span class="p" style="">(</span><span class="n" style="">url</span><span class="p" style="">):</span>
    <span class="k" style="font-weight:bold">try</span><span class="p" style="">:</span>
        <span class="n" style="">r</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">requests</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">get</span><span class="p" style="">(</span><span class="n" style="">url</span><span class="p" style="">,</span> <span class="n" style="">timeout</span><span class="o" style="font-weight:bold">=</span><span class="mi" style="color:rgb(0,153,153)">30</span><span class="p" style="">)</span>
        <span class="n" style="">r</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">raise_for_status</span><span class="p" style="">()</span>
        <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 这里我们知道百度贴吧的编码是utf-8，所以手动设置的。爬去其他的页面时建议使用：</span>
        <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># r.endcodding = r.apparent_endconding</span>
        <span class="n" style="">r</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">encoding</span> <span class="o" style="font-weight:bold">=</span> <span class="s1" style="color:rgb(221,51,34)">'utf-8'</span>
        <span class="k" style="font-weight:bold">return</span> <span class="n" style="">r</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">text</span>
    <span class="k" style="font-weight:bold">except</span><span class="p" style="">:</span>
        <span class="k" style="font-weight:bold">return</span> <span class="s2" style="color:rgb(221,51,34)">" ERROR "</span>


<span class="k" style="font-weight:bold">def</span> <span class="nf" style="font-weight:bold; color:rgb(153,0,0)">get_content</span><span class="p" style="">(</span><span class="n" style="">url</span><span class="p" style="">):</span>
    <span class="sd" style="color:rgb(221,51,34)">'''</span>
<span class="sd" style="color:rgb(221,51,34)">    分析贴吧的网页文件，整理信息，保存在列表变量中</span>
<span class="sd" style="color:rgb(221,51,34)">    '''</span>

    <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 初始化一个列表来保存所有的帖子信息：</span>
    <span class="n" style="">comments</span> <span class="o" style="font-weight:bold">=</span> <span class="p" style="">[]</span>
    <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 首先，我们把需要爬取信息的网页下载到本地</span>
    <span class="n" style="">html</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">get_html</span><span class="p" style="">(</span><span class="n" style="">url</span><span class="p" style="">)</span>

    <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 我们来做一锅汤</span>
    <span class="n" style="">soup</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">BeautifulSoup</span><span class="p" style="">(</span><span class="n" style="">html</span><span class="p" style="">,</span> <span class="s1" style="color:rgb(221,51,34)">'lxml'</span><span class="p" style="">)</span>

    <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 按照之前的分析，我们找到所有具有‘ j_thread_list clearfix’属性的li标签。返回一个列表类型。</span>
    <span class="n" style="">liTags</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">soup</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">find_all</span><span class="p" style="">(</span><span class="s1" style="color:rgb(221,51,34)">'li'</span><span class="p" style="">,</span> <span class="n" style="">attrs</span><span class="o" style="font-weight:bold">=</span><span class="p" style="">{<!-- --></span><span class="s1" style="color:rgb(221,51,34)">'class'</span><span class="p" style="">:</span> <span class="s1" style="color:rgb(221,51,34)">' j_thread_list clearfix'</span><span class="p" style="">})</span>

    <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 通过循环找到每个帖子里的我们需要的信息：</span>
    <span class="k" style="font-weight:bold">for</span> <span class="n" style="">li</span> <span class="ow" style="font-weight:bold">in</span> <span class="n" style="">liTags</span><span class="p" style="">:</span>
        <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 初始化一个字典来存储文章信息</span>
        <span class="n" style="">comment</span> <span class="o" style="font-weight:bold">=</span> <span class="p" style="">{}</span>
        <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 这里使用一个try except 防止爬虫找不到信息从而停止运行</span>
        <span class="k" style="font-weight:bold">try</span><span class="p" style="">:</span>
            <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 开始筛选信息，并保存到字典中</span>
            <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'title'</span><span class="p" style="">]</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">li</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">find</span><span class="p" style="">(</span>
                <span class="s1" style="color:rgb(221,51,34)">'a'</span><span class="p" style="">,</span> <span class="n" style="">attrs</span><span class="o" style="font-weight:bold">=</span><span class="p" style="">{<!-- --></span><span class="s1" style="color:rgb(221,51,34)">'class'</span><span class="p" style="">:</span> <span class="s1" style="color:rgb(221,51,34)">'j_th_tit '</span><span class="p" style="">})</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">text</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">strip</span><span class="p" style="">()</span>
            <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'link'</span><span class="p" style="">]</span> <span class="o" style="font-weight:bold">=</span> <span class="s2" style="color:rgb(221,51,34)">"http://tieba.baidu.com/"</span> <span class="o" style="font-weight:bold">+</span> \
                <span class="n" style="">li</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">find</span><span class="p" style="">(</span><span class="s1" style="color:rgb(221,51,34)">'a'</span><span class="p" style="">,</span> <span class="n" style="">attrs</span><span class="o" style="font-weight:bold">=</span><span class="p" style="">{<!-- --></span><span class="s1" style="color:rgb(221,51,34)">'class'</span><span class="p" style="">:</span> <span class="s1" style="color:rgb(221,51,34)">'j_th_tit '</span><span class="p" style="">})[</span><span class="s1" style="color:rgb(221,51,34)">'href'</span><span class="p" style="">]</span>
            <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'name'</span><span class="p" style="">]</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">li</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">find</span><span class="p" style="">(</span>
                <span class="s1" style="color:rgb(221,51,34)">'span'</span><span class="p" style="">,</span> <span class="n" style="">attrs</span><span class="o" style="font-weight:bold">=</span><span class="p" style="">{<!-- --></span><span class="s1" style="color:rgb(221,51,34)">'class'</span><span class="p" style="">:</span> <span class="s1" style="color:rgb(221,51,34)">'tb_icon_author '</span><span class="p" style="">})</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">text</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">strip</span><span class="p" style="">()</span>
            <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'time'</span><span class="p" style="">]</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">li</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">find</span><span class="p" style="">(</span>
                <span class="s1" style="color:rgb(221,51,34)">'span'</span><span class="p" style="">,</span> <span class="n" style="">attrs</span><span class="o" style="font-weight:bold">=</span><span class="p" style="">{<!-- --></span><span class="s1" style="color:rgb(221,51,34)">'class'</span><span class="p" style="">:</span> <span class="s1" style="color:rgb(221,51,34)">'pull-right is_show_create_time'</span><span class="p" style="">})</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">text</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">strip</span><span class="p" style="">()</span>
            <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'replyNum'</span><span class="p" style="">]</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">li</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">find</span><span class="p" style="">(</span>
                <span class="s1" style="color:rgb(221,51,34)">'span'</span><span class="p" style="">,</span> <span class="n" style="">attrs</span><span class="o" style="font-weight:bold">=</span><span class="p" style="">{<!-- --></span><span class="s1" style="color:rgb(221,51,34)">'class'</span><span class="p" style="">:</span> <span class="s1" style="color:rgb(221,51,34)">'threadlist_rep_num center_text'</span><span class="p" style="">})</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">text</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">strip</span><span class="p" style="">()</span>
            <span class="n" style="">comments</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">append</span><span class="p" style="">(</span><span class="n" style="">comment</span><span class="p" style="">)</span>
        <span class="k" style="font-weight:bold">except</span><span class="p" style="">:</span>
            <span class="k" style="font-weight:bold">print</span><span class="p" style="">(</span><span class="s1" style="color:rgb(221,51,34)">'出了点小问题'</span><span class="p" style="">)</span>

    <span class="k" style="font-weight:bold">return</span> <span class="n" style="">comments</span>


<span class="k" style="font-weight:bold">def</span> <span class="nf" style="font-weight:bold; color:rgb(153,0,0)">Out2File</span><span class="p" style="">(</span><span class="nb" style="color:rgb(0,128,128)">dict</span><span class="p" style="">):</span>
    <span class="sd" style="color:rgb(221,51,34)">'''</span>
<span class="sd" style="color:rgb(221,51,34)">    将爬取到的文件写入到本地</span>
<span class="sd" style="color:rgb(221,51,34)">    保存到当前目录的 TTBT.txt文件中。</span>

<span class="sd" style="color:rgb(221,51,34)">    '''</span>
    <span class="k" style="font-weight:bold">with</span> <span class="nb" style="color:rgb(0,128,128)">open</span><span class="p" style="">(</span><span class="s1" style="color:rgb(221,51,34)">'TTBT.txt'</span><span class="p" style="">,</span> <span class="s1" style="color:rgb(221,51,34)">'a+'</span><span class="p" style="">)</span> <span class="k" style="font-weight:bold">as</span> <span class="n" style="">f</span><span class="p" style="">:</span>
        <span class="k" style="font-weight:bold">for</span> <span class="n" style="">comment</span> <span class="ow" style="font-weight:bold">in</span> <span class="nb" style="color:rgb(0,128,128)">dict</span><span class="p" style="">:</span>
            <span class="n" style="">f</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">write</span><span class="p" style="">(</span><span class="s1" style="color:rgb(221,51,34)">'标题： {} </span><span class="se" style="color:rgb(221,51,34)">\t</span><span class="s1" style="color:rgb(221,51,34)"> 链接：{} </span><span class="se" style="color:rgb(221,51,34)">\t</span><span class="s1" style="color:rgb(221,51,34)"> 发帖人：{} </span><span class="se" style="color:rgb(221,51,34)">\t</span><span class="s1" style="color:rgb(221,51,34)"> 发帖时间：{} </span><span class="se" style="color:rgb(221,51,34)">\t</span><span class="s1" style="color:rgb(221,51,34)"> 回复数量： {} </span><span class="se" style="color:rgb(221,51,34)">\n</span><span class="s1" style="color:rgb(221,51,34)">'</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">format</span><span class="p" style="">(</span>
                <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'title'</span><span class="p" style="">],</span> <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'link'</span><span class="p" style="">],</span> <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'name'</span><span class="p" style="">],</span> <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'time'</span><span class="p" style="">],</span> <span class="n" style="">comment</span><span class="p" style="">[</span><span class="s1" style="color:rgb(221,51,34)">'replyNum'</span><span class="p" style="">]))</span>

        <span class="k" style="font-weight:bold">print</span><span class="p" style="">(</span><span class="s1" style="color:rgb(221,51,34)">'当前页面爬取完成'</span><span class="p" style="">)</span>


<span class="k" style="font-weight:bold">def</span> <span class="nf" style="font-weight:bold; color:rgb(153,0,0)">main</span><span class="p" style="">(</span><span class="n" style="">base_url</span><span class="p" style="">,</span> <span class="n" style="">deep</span><span class="p" style="">):</span>
    <span class="n" style="">url_list</span> <span class="o" style="font-weight:bold">=</span> <span class="p" style="">[]</span>
    <span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 将所有需要爬去的url存入列表</span>
    <span class="k" style="font-weight:bold">for</span> <span class="n" style="">i</span> <span class="ow" style="font-weight:bold">in</span> <span class="nb" style="color:rgb(0,128,128)">range</span><span class="p" style="">(</span><span class="mi" style="color:rgb(0,153,153)">0</span><span class="p" style="">,</span> <span class="n" style="">deep</span><span class="p" style="">):</span>
        <span class="n" style="">url_list</span><span class="o" style="font-weight:bold">.</span><span class="n" style="">append</span><span class="p" style="">(</span><span class="n" style="">base_url</span> <span class="o" style="font-weight:bold">+</span> <span class="s1" style="color:rgb(221,51,34)">'&amp;pn='</span> <span class="o" style="font-weight:bold">+</span> <span class="nb" style="color:rgb(0,128,128)">str</span><span class="p" style="">(</span><span class="mi" style="color:rgb(0,153,153)">50</span> <span class="o" style="font-weight:bold">*</span> <span class="n" style="">i</span><span class="p" style="">))</span>
    <span class="k" style="font-weight:bold">print</span><span class="p" style="">(</span><span class="s1" style="color:rgb(221,51,34)">'所有的网页已经下载到本地！ 开始筛选信息。。。。'</span><span class="p" style="">)</span>

    <span class="c1" style="font-style:italic; color:rgb(153,153,136)">#循环写入所有的数据</span>
    <span class="k" style="font-weight:bold">for</span> <span class="n" style="">url</span> <span class="ow" style="font-weight:bold">in</span> <span class="n" style="">url_list</span><span class="p" style="">:</span>
        <span class="n" style="">content</span> <span class="o" style="font-weight:bold">=</span> <span class="n" style="">get_content</span><span class="p" style="">(</span><span class="n" style="">url</span><span class="p" style="">)</span>
        <span class="n" style="">Out2File</span><span class="p" style="">(</span><span class="n" style="">content</span><span class="p" style="">)</span>
    <span class="k" style="font-weight:bold">print</span><span class="p" style="">(</span><span class="s1" style="color:rgb(221,51,34)">'所有的信息都已经保存完毕！'</span><span class="p" style="">)</span>


<span class="n" style="">base_url</span> <span class="o" style="font-weight:bold">=</span> <span class="s1" style="color:rgb(221,51,34)">'http://tieba.baidu.com/f?kw=</span><span class="si" style="color:rgb(221,51,34)">%E</span><span class="s1" style="color:rgb(221,51,34)">7</span><span class="si" style="color:rgb(221,51,34)">%94%</span><span class="s1" style="color:rgb(221,51,34)">9F</span><span class="si" style="color:rgb(221,51,34)">%E</span><span class="s1" style="color:rgb(221,51,34)">6%B4%BB</span><span class="si" style="color:rgb(221,51,34)">%E</span><span class="s1" style="color:rgb(221,51,34)">5%A4%A7</span><span class="si" style="color:rgb(221,51,34)">%E</span><span class="s1" style="color:rgb(221,51,34)">7</span><span class="si" style="color:rgb(221,51,34)">%88%</span><span class="s1" style="color:rgb(221,51,34)">86</span><span class="si" style="color:rgb(221,51,34)">%E</span><span class="s1" style="color:rgb(221,51,34)">7</span><span class="si" style="color:rgb(221,51,34)">%82%</span><span class="s1" style="color:rgb(221,51,34)">B8&amp;ie=utf-8'</span>
<span class="c1" style="font-style:italic; color:rgb(153,153,136)"># 设置需要爬取的页码数量</span>
<span class="n" style="">deep</span> <span class="o" style="font-weight:bold">=</span> <span class="mi" style="color:rgb(0,153,153)">3</span>

<span class="k" style="font-weight:bold">if</span> <span class="n" style="">__name__</span> <span class="o" style="font-weight:bold">==</span> <span class="s1" style="color:rgb(221,51,34)">'__main__'</span><span class="p" style="">:</span>
    <span class="n" style="">main</span><span class="p" style="">(</span><span class="n" style="">base_url</span><span class="p" style="">,</span> <span class="n" style="">deep</span><span class="p" style="">)</span>
</code></pre> 
 </div> 
 <p style="margin-top:20px; margin-bottom:20px">代码里有详细的注释和思路，看不懂的话 <span style="font-weight:700">多看几遍</span><br style=""> 下面是爬完的结果：<br style=""> </p> 
 <img src="https://images2.imgbox.com/85/ad/yQpwvpun_o.png" class="origin_image zh-lightbox-thumb lazy" width="1180" alt="" style="overflow:hidden; display:block; max-width:100%; margin:0.72em auto"> 
 <br style=""> 
 <p style="margin-top:20px; margin-bottom:20px">好了今天的小例子到这里就结束了。<br style=""> 我的代码也托管到Github上了，<br style=""> 要是出现了一些莫名其妙的问题，<br style=""> 可以直接去上面看看源文件。</p> 
 <br style=""> 
 <blockquote style="padding-left:1.2em; margin:20px 0px; border-left:4px solid rgb(226,227,228)"> 
  <p style="margin-top:20px; margin-bottom:20px">每天的学习记录都会 同步更新到：<br style=""> 微信公众号： findyourownway<br style=""> 知乎专栏：<a target="_blank" href="https://zhuanlan.zhihu.com/Ehco-python" rel="nofollow noopener noreferrer" class="internal" style="color:rgb(34,85,153); word-break:break-all">从零开始写Python爬虫 - 知乎专栏</a><br style=""> blog ： <a target="_blank" href="http://link.zhihu.com/?target=http%3A//www.ehcoblog.ml" rel="nofollow noreferrer noopener noreferrer" class=" wrap external" style="color:rgb(34,85,153); word-break:break-all">www.ehcoblog.ml<span class="icon-external" style=""></span></a><br style=""> Github： <a target="_blank" href="http://link.zhihu.com/?target=https%3A//github.com/Ehco1996/Python-crawler" rel="nofollow noreferrer noopener noreferrer" class=" wrap external" style="color:rgb(34,85,153); word-break:break-all">Ehco1996/Python-crawler</a></p> 
 </blockquote> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6b09b1593152f2e24eaf4db0ab85f369/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">流氓软件之会声会影[彻底卸载]</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/220147790fc757349487d8ddd892fefd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">递归删除链表中的指定元素x</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>