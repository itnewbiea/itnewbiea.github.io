<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32CubeMX在FreeRTOS下使用串口进行数据收发（不定长度） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32CubeMX在FreeRTOS下使用串口进行数据收发（不定长度）" />
<meta property="og:description" content="STM32CubeMX-&gt;FreeRTOS&#43;USART接收不定长数据 由于本人做的一个项目功能相对复杂，要求使用操作系统，且项目工程中有很多需要串口操作的外设，所以需要对串口设计不定长的收发功能，裸机跑惯了的孩子就是比较野，一天瞎吉尔弄，现在是不是GG，这里先批评一下自己。为了解决这一问题并做个笔记，就有了这篇博客。
实现思路：
​ 使用串口、定时器记录接收到的数据，每5ms进入一次处理函数（一条数据处理完毕）
​ 使用一个计数位、一个标志位、一个暂存buff
​ 标志位置1则认为数据处理完成，将数据打印出来
使用硬件功能：串口3及中断，定时器7及中断
使用操作系统元素：一个互斥量
使能RTOS后会RTOS会强制调用系统时钟，所以在使能了操作系统之后需要将系统时钟换为定时器TIM1
操作步骤 启动STM32CubeMX并对芯片选型
主要设置
串口3及中断使能，115200,8,None,1定时器7及中断使能，预分频9000-1，自动重载50-1（时钟树APB1、2为90MHz）SYS时钟源设为定时器1使能FreeRTOS，创建1个串口任务、创建1个互斥量使能两个GPIO输出驱动LED
以上都清楚的大佬转到代码功能实现继续 使能RCC时钟源为外部时钟
3. 设置SYS调试方式为串口，时钟源改为定时器1
4. 设置时钟树，是APB1、2为90MHz，或者自行设定，在后面定时器工作会用到
5. 使能串口3，并启用串口3中断，串口3设置为115200，8Bit，None，1（不知道什么意思的就没有必要看下去了）
6. 使能定时器7，并使能中断，定时器预分频系数与之前的90MHz相关，需要通过预分频系数和自动重载值将定时时间设为5ms【200Hz】，不会算的看我定时器博客（这里我用了一个不常用的定时器，用哪个都可以，只要注意好定时器隶属哪根时钟线就行）
7. 使能FreeRTOS并创建一个串口任务和一个二值量（二值信号量用于串口数据接收完成后进入串口任务）
8. 设置两个IO输出作为一个可视化依据
9. 项目命名、选择使用的程序编辑软件我的是MDK_ARM V5、分离.c.h文件，点击右上角GENERATE CODE生成工程
打开项目，先编译没有错误之后再进行修改 代码功能实现 首先在usart.c文件对串口3进行printf函数重定义，使串口3可用printf函数输出
内容加入到/* USER CODE BEGIN 0 */框架内
/* USER CODE BEGIN 0 */ /********************************************************************************/ #include &#34;stdio.h&#34; //加入以下代码,支持printf函数,而不需要选择use MicroLIB	//#define PUTCHAR_PROTOTYPE int fputc(int ch, FILE *f)	#if 1 #pragma import(__use_no_semihosting) //标准库需要的支持函数 struct __FILE { int handle; }; FILE __stdout; //定义_sys_exit()以避免使用半主机模式 void _sys_exit(int x) { x = x; } //重定义fputc函数 int fputc(int ch, FILE *f) { while((USART3-&gt;SR&amp;0X40)==0);//循环发送,直到发送完毕 USART3-&gt;DR = (uint8_t) ch; return ch; } #endif /********************************************************************************/ /* USER CODE END 0 */ 定义串口使用的变量" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/773ffb6e835a2a686b8d0ac03a3839de/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-19T00:33:55+08:00" />
<meta property="article:modified_time" content="2020-05-19T00:33:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32CubeMX在FreeRTOS下使用串口进行数据收发（不定长度）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="STM32CubeMXFreeRTOSUSART_0"></a>STM32CubeMX-&gt;FreeRTOS+USART接收不定长数据</h2> 
<p>由于本人做的一个项目功能相对复杂，要求使用操作系统，且项目工程中有很多需要串口操作的外设，所以需要对串口设计不定长的收发功能，裸机跑惯了的孩子就是比较野，一天瞎吉尔弄，现在是不是GG，这里先批评一下自己。为了解决这一问题并做个笔记，就有了这篇博客。</p> 
<p>实现思路：<br> ​ 使用串口、定时器记录接收到的数据，每5ms进入一次处理函数（一条数据处理完毕）<br> ​ 使用一个计数位、一个标志位、一个暂存buff<br> ​ 标志位置1则认为数据处理完成，将数据打印出来<br> 使用硬件功能：串口3及中断，定时器7及中断<br> 使用操作系统元素：一个互斥量<br> 使能RTOS后会RTOS会强制调用系统时钟，所以在使能了操作系统之后需要将系统时钟换为定时器TIM1</p> 
<h3><a id="_10"></a>操作步骤</h3> 
<ol><li> <p>启动STM32CubeMX并对芯片选型<br> 主要设置</p> 
  <ol><li>串口3及中断使能，115200,8,None,1</li><li>定时器7及中断使能，预分频9000-1，自动重载50-1（时钟树APB1、2为90MHz）</li><li>SYS时钟源设为定时器1</li><li>使能FreeRTOS，创建1个串口任务、创建1个互斥量</li><li>使能两个GPIO输出驱动LED<br> <em>以上都清楚的大佬转到代码功能实现继续</em></li></ol> </li><li> <p>使能RCC时钟源为外部时钟</p> </li></ol> 
<p><img src="https://images2.imgbox.com/36/81/FaolP2b6_o.png" alt=""><br> 3. 设置SYS调试方式为串口，时钟源改为定时器1</p> 
<p><img src="https://images2.imgbox.com/5b/dd/jPHKw110_o.png" alt=""><br> 4. 设置时钟树，是APB1、2为90MHz，或者自行设定，在后面定时器工作会用到<br> <img src="https://images2.imgbox.com/60/79/Fw9Sq9ol_o.png" alt=""><br> 5. 使能串口3，并启用串口3中断，串口3设置为115200，8Bit，None，1（不知道什么意思的就没有必要看下去了）</p> 
<p><img src="https://images2.imgbox.com/ed/bd/B2D8WKwG_o.png" alt="在这里插入图片描述"><br> 6. 使能定时器7，并使能中断，定时器预分频系数与之前的90MHz相关，需要通过预分频系数和自动重载值将定时时间设为5ms【200Hz】，<em>不会算的看我定时器博客</em>（这里我用了一个不常用的定时器，用哪个都可以，只要注意好定时器隶属哪根时钟线就行）</p> 
<p><img src="https://images2.imgbox.com/74/74/H7g3uDJs_o.png" alt="在这里插入图片描述"><br> 7. 使能FreeRTOS并创建一个串口任务和一个二值量（二值信号量用于串口数据接收完成后进入串口任务）</p> 
<p><img src="https://images2.imgbox.com/58/bb/bIFTtyEp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/95/2a/JQu0FOVv_o.png" alt="在这里插入图片描述"><br> 8. 设置两个IO输出作为一个可视化依据</p> 
<p><img src="https://images2.imgbox.com/32/bc/vYTLptKB_o.png" alt="在这里插入图片描述"><br> 9. 项目命名、选择使用的程序编辑软件我的是MDK_ARM V5、分离.c.h文件，点击右上角GENERATE CODE生成工程<br> <img src="https://images2.imgbox.com/04/ba/VZTklbfu_o.png" alt="在这里插入图片描述"></p> 
<ol start="10"><li>打开项目，先编译没有错误之后再进行修改</li></ol> 
<h3><a id="_47"></a>代码功能实现</h3> 
<ol><li> <p>首先在usart.c文件对串口3进行printf函数重定义，使串口3可用printf函数输出</p> <p>内容加入到/* USER CODE BEGIN 0 */框架内</p> <pre><code class="prism language-c"><span class="token comment">/* USER CODE BEGIN 0 */</span>
<span class="token comment">/********************************************************************************/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stdio.h"</span></span>
<span class="token comment">//加入以下代码,支持printf函数,而不需要选择use MicroLIB	  </span>
<span class="token comment">//#define PUTCHAR_PROTOTYPE int fputc(int ch, FILE *f)	</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">if</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">pragma</span> <span class="token expression"><span class="token function">import</span><span class="token punctuation">(</span>__use_no_semihosting<span class="token punctuation">)</span>             </span></span>
<span class="token comment">//标准库需要的支持函数                 </span>
<span class="token keyword">struct</span> <span class="token class-name">__FILE</span> 
<span class="token punctuation">{<!-- --></span> 
	<span class="token keyword">int</span> handle<span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">;</span> 

FILE __stdout<span class="token punctuation">;</span>       
<span class="token comment">//定义_sys_exit()以避免使用半主机模式    </span>
<span class="token keyword">void</span> <span class="token function">_sys_exit</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span> 
	x <span class="token operator">=</span> x<span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token comment">//重定义fputc函数 </span>
<span class="token keyword">int</span> <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token keyword">int</span> ch<span class="token punctuation">,</span> FILE <span class="token operator">*</span>f<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span> 	
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>USART3<span class="token operator">-&gt;</span>SR<span class="token operator">&amp;</span><span class="token number">0X40</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//循环发送,直到发送完毕   </span>
	USART3<span class="token operator">-&gt;</span>DR <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">uint8_t</span><span class="token punctuation">)</span> ch<span class="token punctuation">;</span>      
	<span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span> </span>
<span class="token comment">/********************************************************************************/</span>
<span class="token comment">/* USER CODE END 0 */</span>
</code></pre> </li><li> <p>定义串口使用的变量</p> <p>主要包括串口数据存储BUFF，串口数据长度计数BUFF，串口接收成功标志位（此处借鉴正点原子的串口处理方法）</p> <p>在main.c文件下的定义/* USER CODE BEGIN PV */框架内定义</p> <pre><code class="prism language-c"><span class="token comment">/* USER CODE BEGIN PV */</span>
<span class="token comment">/********************************************************************************/</span>
<span class="token class-name">uint8_t</span> RxBuffer<span class="token punctuation">[</span>MAX_REC_LENGTH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>		<span class="token comment">//串口数据存储BUFF		长度2048</span>
<span class="token class-name">uint8_t</span> RxFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>							<span class="token comment">//串口接收完成标志符</span>
<span class="token class-name">uint16_t</span> RxCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>						<span class="token comment">//串口长度计数</span>
<span class="token class-name">uint8_t</span> RxTemp<span class="token punctuation">[</span>REC_LENGTH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>			<span class="token comment">//串口数据接收暂存BUFF	长度1</span>

<span class="token keyword">extern</span> osSemaphoreId myBinarySem01Handle<span class="token punctuation">;</span>	<span class="token comment">//操作系统定义的互斥量</span>
<span class="token comment">/********************************************************************************/</span>
<span class="token comment">/* USER CODE END PV */</span>
</code></pre> <p>并在usart.h文件下的/* USER CODE BEGIN Private defines */框架下定义长度和链接串口用变量</p> <pre><code class="prism language-c"><span class="token comment">/* USER CODE BEGIN Private defines */</span>
<span class="token comment">/********************************************************************************/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">REC_LENGTH</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MAX_REC_LENGTH</span> <span class="token expression"><span class="token number">2048</span></span></span>

<span class="token keyword">extern</span> <span class="token class-name">uint8_t</span> RxBuffer<span class="token punctuation">[</span>MAX_REC_LENGTH<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token class-name">uint8_t</span> RxFlag<span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token class-name">uint16_t</span> RxCounter<span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token class-name">uint8_t</span> RxTemp<span class="token punctuation">[</span>REC_LENGTH<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">/********************************************************************************/</span>	 
<span class="token comment">/* USER CODE END Private defines */</span>
</code></pre> </li><li> <p>串口中断回调函数，在main.c的/* USER CODE BEGIN 4 */框架下添加串口回调函数</p> <pre><code class="prism language-c"><span class="token comment">/********************************************************************************/</span>
<span class="token keyword">void</span> <span class="token function">HAL_UART_RxCpltCallback</span><span class="token punctuation">(</span>UART_HandleTypeDef <span class="token operator">*</span>huart<span class="token punctuation">)</span><span class="token comment">//串口3接收完成回调函数</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>huart<span class="token operator">-&gt;</span>Instance <span class="token operator">==</span> USART3<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">__HAL_TIM_SET_COUNTER</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim7<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>							<span class="token comment">//清除定时器7计数值	</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">==</span> RxCounter<span class="token punctuation">)</span>											<span class="token comment">//如果是首字符（每帧数据开头）则开启定时器</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">__HAL_TIM_CLEAR_FLAG</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim7<span class="token punctuation">,</span> TIM_FLAG_UPDATE<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//清除中断标志位</span>
			<span class="token function">HAL_TIM_Base_Start_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim7<span class="token punctuation">)</span><span class="token punctuation">;</span>							<span class="token comment">//开启基本定时器</span>
		<span class="token punctuation">}</span>
		RxBuffer<span class="token punctuation">[</span>RxCounter<span class="token punctuation">]</span> <span class="token operator">=</span> RxTemp<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>							<span class="token comment">//缓存数据放入接收数组</span>
		RxCounter<span class="token operator">++</span><span class="token punctuation">;</span>												<span class="token comment">//计数器加1</span>
		<span class="token function">HAL_UART_Receive_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart3<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>RxTemp<span class="token punctuation">,</span> REC_LENGTH<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//重新使能中断</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">/********************************************************************************/</span>
</code></pre> </li><li> <p>定时器周期回调函数，由于在设置中系统时钟使用了定时器1，所以在main.c文件存在</p> <pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">HAL_TIM_PeriodElapsedCallback</span><span class="token punctuation">(</span>TIM_HandleTypeDef <span class="token operator">*</span>htim<span class="token punctuation">)</span>
</code></pre> <p>在函数 /* USER CODE BEGIN Callback 1 */框架下添加定时器7的回调函数</p> <pre><code class="prism language-C">  /* USER CODE BEGIN Callback 1 */
	/********************************************************************************/
	if(htim-&gt;Instance == TIM7)
	{
		HAL_GPIO_TogglePin(DS1_GPIO_Port, DS1_Pin);	//LED反转一次
		RxFlag = 1;																	//接收标志位置1
		HAL_TIM_Base_Stop_IT(&amp;htim7);								//关闭定时器
		osSemaphoreRelease(myBinarySem01Handle);		//释放二值信号量，进入串口任务
	}
	/********************************************************************************/
  /* USER CODE END Callback 1 */
</code></pre> </li><li> <p>对freeRTOS添加任务</p> <p>首先在freertos.c文件的/* USER CODE BEGIN Includes */ 框架下添加串口使用的头文件</p> <pre><code class="prism language-c"><span class="token comment">/* USER CODE BEGIN Includes */</span>     
<span class="token comment">/********************************************************************************/</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"usart.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stdio.h"</span></span>
<span class="token comment">/********************************************************************************/</span>
<span class="token comment">/* USER CODE END Includes */</span>
</code></pre> </li><li> <p>在freertos主任务中启动串口中断以及添加LED闪烁任务</p> <pre><code class="prism language-c"><span class="token comment">/* USER CODE END Header_StartDefaultTask */</span>
<span class="token keyword">void</span> <span class="token function">StartDefaultTask</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token keyword">const</span> <span class="token operator">*</span> argument<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN StartDefaultTask */</span>
	<span class="token function">HAL_UART_Receive_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart3<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span><span class="token punctuation">)</span>RxTemp<span class="token punctuation">,</span> REC_LENGTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* Infinite loop */</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
	<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>DS0_GPIO_Port<span class="token punctuation">,</span>DS0_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">osDelay</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* USER CODE END StartDefaultTask */</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>在freertos串口子任务中添加串口数据打印功能</p> <pre><code class="prism language-c"><span class="token comment">/* USER CODE END Header_Start_U3_Task */</span>
<span class="token keyword">void</span> <span class="token function">Start_U3_Task</span><span class="token punctuation">(</span><span class="token keyword">void</span> <span class="token keyword">const</span> <span class="token operator">*</span> argument<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN Start_U3_Task */</span>
  <span class="token comment">/* Infinite loop */</span>
  <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
	<span class="token comment">/********************************************************************************/</span>  
	<span class="token function">osSemaphoreWait</span><span class="token punctuation">(</span>myBinarySem01Handle<span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//等待二值信号量</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>RxFlag <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span>													<span class="token comment">//数据接收完成</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>RxCounter<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>							<span class="token comment">//打印接收数组存储的内容</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c"</span><span class="token punctuation">,</span>RxBuffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	
         <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>											<span class="token comment">//打印完成换行</span>
		RxFlag <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>													<span class="token comment">//接收标志清零</span>
		RxCounter <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>												<span class="token comment">//接收计数清零</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>RxBuffer <span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span> MAX_REC_LENGTH<span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//清空接收数组</span>
	<span class="token punctuation">}</span>
	<span class="token comment">/********************************************************************************/</span>
    <span class="token function">osDelay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">/* USER CODE END Start_U3_Task */</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<h3><a id="_231"></a>实验结果</h3> 
<p>编译下载程序，打开串口调试助手，用串口转USB模块将串口3接入电脑，使用串口调试助手测试<br> <img src="https://images2.imgbox.com/2a/49/ZxsXHxB1_o.png" alt="在这里插入图片描述"><br> 上图为测试结果，发送ASWaterbenben后回复相同内容，每帧数据用换行符隔开，至此，实验成功！</p> 
<p>DS0灯200ms反转一次，每次接收到一帧完整数据DS1灯就会反转一次。这个效果难以展示，你们自己试试就好！</p> 
<p>如果本博客对您有帮助，希望点赞关注走一波，今后会看心情更新！哈哈哈哈哈哈哈哈哈</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fe339ac77062939df69783e863846840/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">React table无内容时显示No Data,修改为中文内容：暂无数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4ee66695496aafd48d7215fad6ddf79d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">超实用的shell脚本--一键获取进程所有信息</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>