<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>docker小白第十一天 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="docker小白第十一天" />
<meta property="og:description" content="docker小白第十一天 dockerfile分析 Dockerfile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。即构建新镜像时会用到。
构建三步骤：编写dockerfile文件-docker build命令构建镜像-docker run镜像 运行容器实例。即一层一层的包装形成新镜像。
dockerfile内容基础知识 1:每条保留字（关键字）指令都必须为大写字母且后面要跟随至少一个参数。
2:指令按照从上到下，顺序执行。
3:#表示注释。
4:每条指令都会创建一个新的镜像层并对镜像进行提交。
docker执行dockerfile的大致流程 (1） docker从基础镜像运行一个容器
(2）执行一条指令并对容器作出修改
(3）执行类似docker commit的操作提交一个新的镜像层
(4) docker再基于刚提交的镜像运行一个新容器
(5）在执行一条执行对容器做出修改
(6）执行类似docker commit的操作提交一个新的镜像层
(7) docker再基于刚提交的镜像运行一个新容器
(6）循环通过以上步骤执行dockerfile中的下一条指令直到所有指令都执行完成。
1、Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程。(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;
2、Docker镜像，在用Dockerfile定义一个文件之后，docker buildi时会产生一个Docker镜像，当运行Docker镜像时会真正开始提供服务;
3、Docker容器，容器是直接提供服务的。
dockerfile常用保留字指令 FROM #基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是from MAINTAINER # 镜像维护者的姓名和邮箱地址 RUN &lt;命令行指令&gt; # 容器构建时需要运行的命令，命令行指令等于在终端操作的shell指令。在构建镜像docker build时运行 EXPOSE # 当前容器对外暴露出的端口 WORKDIR # 指定在创建容器后，终端默认登陆进容器时的工作目录 USER # 指定该镜像以什么样的用户去执行，如果都不指定，则默认是root ENV # 用来在构建镜像过程中设置环境变量 ADD # 将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包 COPY # 类似ADD，拷贝文件和目录到镜像中。将从构建上下文目录中源路径&gt;的文件/目录复制到新的一层的镜像内的&lt;目标路径&gt;位置 VOLUME CMD # 指定容器启动后要做的事情。Dockerfile 中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换。在运行容器docker run时运行该命令 ENTRYPOINT # 也是用来指定一个容器启动时要运行的命令 类似于CMD指令，但是ENTRYPOINT不会被docker run后面的命令覆盖，而且这些命令行参数会被当作参数送给ENTRYPOINT指令指定的程序 dockerfile案例实践 自定义一个镜像mycentosjava8。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f1c4c75a8ec58af9a1b8cf6bc7d8bd3f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T22:37:28+08:00" />
<meta property="article:modified_time" content="2024-01-03T22:37:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">docker小白第十一天</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="docker_0"></a>docker小白第十一天</h2> 
<h3><a id="dockerfile_1"></a>dockerfile分析</h3> 
<p>Dockerfile是用来构建Docker镜像的文本文件，是由一条条构建镜像所需的指令和参数构成的脚本。即构建新镜像时会用到。<br> 构建三步骤：编写dockerfile文件-docker build命令构建镜像-docker run镜像 运行容器实例。即一层一层的包装形成新镜像。</p> 
<h3><a id="dockerfile_4"></a>dockerfile内容基础知识</h3> 
<p>1:每条保留字（关键字）指令都必须为大写字母且后面要跟随至少一个参数。<br> 2:指令按照从上到下，顺序执行。<br> 3:#表示注释。<br> 4:每条指令都会创建一个新的镜像层并对镜像进行提交。</p> 
<h3><a id="dockerdockerfile_9"></a>docker执行dockerfile的大致流程</h3> 
<p>(1） docker从基础镜像运行一个容器<br> (2）执行一条指令并对容器作出修改<br> (3）执行类似docker commit的操作提交一个新的镜像层<br> (4) docker再基于刚提交的镜像运行一个新容器<br> (5）在执行一条执行对容器做出修改<br> (6）执行类似docker commit的操作提交一个新的镜像层<br> (7) docker再基于刚提交的镜像运行一个新容器<br> (6）循环通过以上步骤执行dockerfile中的下一条指令直到所有指令都执行完成。</p> 
<p>1、Dockerfile，需要定义一个Dockerfile，Dockerfile定义了进程需要的一切东西。Dockerfile涉及的内容包括执行代码或者是文件、环境变量、依赖包、运行时环境、动态链接库、操作系统的发行版、服务进程和内核进程。(当应用进程需要和系统服务和内核进程打交道，这时需要考虑如何设计namespace的权限控制)等等;<br> 2、Docker镜像，在用Dockerfile定义一个文件之后，docker buildi时会产生一个Docker镜像，当运行Docker镜像时会真正开始提供服务;<br> 3、Docker容器，容器是直接提供服务的。</p> 
<h3><a id="dockerfile_22"></a>dockerfile常用保留字指令</h3> 
<pre><code class="prism language-bash">FROM 
<span class="token comment">#基础镜像，当前新镜像是基于哪个镜像的，指定一个已经存在的镜像作为模板，第一条必须是from</span>
MAINTAINER 
<span class="token comment"># 镜像维护者的姓名和邮箱地址</span>
RUN <span class="token operator">&lt;</span>命令行指令<span class="token operator">&gt;</span>
<span class="token comment"># 容器构建时需要运行的命令，命令行指令等于在终端操作的shell指令。在构建镜像docker build时运行</span>
EXPOSE
<span class="token comment"># 当前容器对外暴露出的端口</span>
WORKDIR
<span class="token comment"># 指定在创建容器后，终端默认登陆进容器时的工作目录</span>
<span class="token environment constant">USER</span>
<span class="token comment"># 指定该镜像以什么样的用户去执行，如果都不指定，则默认是root</span>
ENV
<span class="token comment"># 用来在构建镜像过程中设置环境变量</span>
ADD
<span class="token comment"># 将宿主机目录下的文件拷贝进镜像且会自动处理URL和解压tar压缩包</span>
COPY
<span class="token comment"># 类似ADD，拷贝文件和目录到镜像中。将从构建上下文目录中源路径&gt;的文件/目录复制到新的一层的镜像内的&lt;目标路径&gt;位置</span>
VOLUME 
CMD
<span class="token comment"># 指定容器启动后要做的事情。Dockerfile 中可以有多个CMD指令，但只有最后一个生效，CMD会被docker run之后的参数替换。在运行容器docker run时运行该命令</span>
ENTRYPOINT
<span class="token comment"># 也是用来指定一个容器启动时要运行的命令</span>
类似于CMD指令，但是ENTRYPOINT不会被docker run后面的命令覆盖，而且这些命令行参数会被当作参数送给ENTRYPOINT指令指定的程序
</code></pre> 
<h3><a id="dockerfile_50"></a>dockerfile案例实践</h3> 
<p>自定义一个镜像mycentosjava8。</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> pull centos
下载一个默认的基础版本centos镜像
</code></pre> 
<p><img src="https://images2.imgbox.com/aa/74/ZI4ew5gF_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> images
<span class="token comment"># 查看已经下载的镜像</span>
<span class="token function">docker</span> run <span class="token parameter variable">-it</span> 5d0da3dc9764 /bin/bash
<span class="token comment"># 镜像id替换成自己的centos镜像id</span>
<span class="token function">vim</span> a.txt
<span class="token comment"># 测试目前已经运行起来的centos容器是不具备vim命令的</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/58/99/We7AikoA_o.png" alt="在这里插入图片描述"><br> 需求为，原始的centos镜像具备vim+ifconfig+jdk8。</p> 
<pre><code class="prism language-bash">https://www.oracle.coml/java/technologies/downloads/
<span class="token comment"># jdk8下载地址</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c8/c3/XhuEPiZt_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="dockerfile_75"></a>准备编写dockerfile文件</h4> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> myfile
<span class="token comment"># 新建个文件夹叫myfile</span>
</code></pre> 
<p>将下载好的java8通过xftp上传到该文件夹内<br> <img src="https://images2.imgbox.com/20/01/NPMLJQu5_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> Dockerfile
同目录下，新建个Dockerfile文件，D要大写
</code></pre> 
<pre><code class="prism language-bash">FROM centos:7.6.1810
<span class="token comment"># 基于哪个原始镜像,为避免版本冲突这里指定版本</span>
MAINTAINER CZ
<span class="token comment"># 作者信息</span>

ENV MYPATH /usr/local
WORKDIR <span class="token variable">$MYPATH</span>

<span class="token comment">#安装vim编辑器</span>
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> <span class="token function">vim</span>
<span class="token comment">#安装ifconfig命令查看网络IP</span>
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> net-tools
<span class="token comment">#安装java8及lib库</span>
RUN yum <span class="token parameter variable">-y</span> <span class="token function">install</span> glibc.i686
RUN <span class="token function">mkdir</span> /usr/local/java
<span class="token comment">#ADD是相对路径jar,把jdk-8u391-linux-i586.tar.gz添加到容器中,安装包必须要和Dockerfile文件在同一位置    </span>
ADD jdk-8u391-linux-i586.tar.gz /usr/local/java/
<span class="token comment">#配置java环境变量</span>
ENV JAVA_HOME /usr/local/java/jdk1.8.O_391
ENV JRE_HOME <span class="token variable">$JAVA_HOME</span>/jre
ENV CLASSPATH <span class="token variable">$JAVA_HOME</span>/lib/dt.jar:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar:<span class="token variable">$JRE_HONE</span>/lib:<span class="token variable">$CLASSPATH</span>
ENV <span class="token environment constant">PATH</span> <span class="token variable">$JAVA_HOME</span>/bin:<span class="token environment constant">$PATH</span>
EXPOSE <span class="token number">80</span>
CMD <span class="token builtin class-name">echo</span> <span class="token variable">$MYPATH</span>
CMD <span class="token builtin class-name">echo</span> <span class="token string">"success- - - - - --- ----- - ok"</span>
CMD /bin/bash
</code></pre> 
<h4><a id="dockerfile_117"></a>构建dockerfile文件</h4> 
<pre><code class="prism language-bash"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> 新镜像名字:TAG <span class="token builtin class-name">.</span>
<span class="token function">docker</span> build <span class="token parameter variable">-t</span> centosjava8:1.5 <span class="token builtin class-name">.</span>
<span class="token comment">#注意TAG后边有个空格，有个点</span>
<span class="token function">docker</span> images
</code></pre> 
<p>可以看到构建后的新镜像有1.2个G<br> <img src="https://images2.imgbox.com/79/d4/PFKH8Upn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_127"></a>运行新建的镜像</h4> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-it</span> centosjava8:1.5 /bin/bash
</code></pre> 
<p>可以看到启动容器后的默认登入目录为local，是dockerfile文件中设置的。<br> <img src="https://images2.imgbox.com/47/fd/gW4O0gXB_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash">测试vim命令和ifconfig命令
<span class="token function">vim</span> test.txt
<span class="token function">ifconfig</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a9/1f/uOe93v98_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_142"></a>虚悬镜像</h4> 
<p>仓库名、标签都是 <code>&lt;none&gt;</code> 的镜像，俗称虚悬镜像</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> Dockerfile
<span class="token comment"># 新建一个dockerfile文件</span>
FROM ubuntu
CMD <span class="token builtin class-name">echo</span> <span class="token string">'action is success'</span>
<span class="token comment"># dockerfile文件中增加两个命令</span>
<span class="token function">docker</span> build <span class="token builtin class-name">.</span>
<span class="token comment"># 构建镜像</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/c2/ec/Frzra3xE_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-bash"><span class="token comment"># 虚悬镜像删除的命令</span>
<span class="token function">docker</span> image prune
</code></pre> 
<h3><a id="docker_161"></a>docker微服务实战</h3> 
<h4><a id="IDEA_162"></a>通过IDEA新建微服务模块</h4> 
<p>打包代码生成jar包，然后通过xftp上传到linux虚机中，自己新建的文件夹，例如mydocker中。<br> <img src="https://images2.imgbox.com/f6/e6/2qUegWnS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="dockerfile_165"></a>通过dockerfile发布微服务部署</h4> 
<p>1、编写Dockerfile。springBoot编写的jar包自带tomcat，无需额外添加。<br> <img src="https://images2.imgbox.com/3a/33/xEv5lm1h_o.png" alt="在这里插入图片描述"></p> 
<p>2、将微服务jar包和Dockerfile文件搞到同一个目录下。<br> <img src="https://images2.imgbox.com/33/f2/ZW14ePi8_o.png" alt="在这里插入图片描述"><br> 3、构建镜像</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> build <span class="token parameter variable">-t</span> zzyy_docker:1.6 <span class="token builtin class-name">.</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b1/1a/avkf2y8H_o.png" alt="在这里插入图片描述"><br> 4、运行容器</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-d</span> <span class="token parameter variable">-p</span> <span class="token number">6001</span>:6001 15a1424eae6c
<span class="token comment"># 微服务常以后台形式运行</span>
</code></pre> 
<p>5、测试容器</p> 
<pre><code class="prism language-bash"><span class="token function">curl</span> <span class="token number">127.0</span>.0.1:6001/order/docker
<span class="token comment"># 访问微服务测试</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/bf/5b/2WVxglYF_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c879a398f0fb960c49d4665f297dfce8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">GAMES101：作业3记录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d613f4130e24f3bfc9ec8853c2e5ec1a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">注意：C语言结构体里不能赋初始值！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>