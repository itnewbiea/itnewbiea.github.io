<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>redis-dump数据导出以及redis-load还原数据 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="redis-dump数据导出以及redis-load还原数据" />
<meta property="og:description" content="一 、安装Ruby依赖 1）安装Ruby环境
yum -y install ruby ruby-devel
yum -y install rubygems
2)添加taobao Ruby镜像
添加淘宝ruby源;
gem sources --add http://gems.ruby-china.org --removehttps://rubygems.org/ http://gems.ruby-china.org added to sources source https://rubygems.org/ not present in cache 查看现有ruby源;
#gem sources --l *** CURRENT SOURCES *** http://rubygems.org/ http://gems.ruby-china.org 二、安装redis-dump Centos默认支持ruby到2.0.0，可gem 安装redis需要最低是2.2.2
解决办法是 先安装rvm，再把ruby版本提升至2.3.3
#gem install redis-dump
select id,user,host,db,command,time,state,info from information_schema.processlist where command &lt;&gt;&#39;sleep&#39; order by time; ERROR: Error installing redis-dump: redis requires Ruby version &gt;= 2.2.2. #gpg2 --keyserver hkp://keys." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0d3829ef1dc2bbfc172a4102214dae41/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-18T22:34:09+08:00" />
<meta property="article:modified_time" content="2018-04-18T22:34:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">redis-dump数据导出以及redis-load还原数据</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="con artical-content editor-preview-side"> 
 <h2>一 、安装Ruby依赖</h2> 
 <p>1）安装Ruby环境<br>yum -y install ruby ruby-devel<br>yum -y install rubygems</p> 
 <p>2)添加taobao Ruby镜像<br>添加淘宝ruby源;</p> 
 <pre><code>gem sources --add http://gems.ruby-china.org --removehttps://rubygems.org/
http://gems.ruby-china.org added to sources
source https://rubygems.org/ not present in cache</code></pre> 
 <p>查看现有ruby源;</p> 
 <pre><code>#gem sources --l
*** CURRENT SOURCES ***
http://rubygems.org/
http://gems.ruby-china.org</code></pre> 
 <h2>二、安装redis-dump</h2> 
 <p>Centos默认支持ruby到2.0.0，可gem 安装redis需要最低是2.2.2<br>解决办法是 先安装rvm，再把ruby版本提升至2.3.3<br>#gem install redis-dump</p> 
 <pre><code>select id,user,host,db,command,time,state,info from information_schema.processlist where command &lt;&gt;'sleep'  order by time;
ERROR:  Error installing redis-dump:
        redis requires Ruby version &gt;= 2.2.2.</code></pre> 
 <p>#gpg2 --keyserver hkp://keys.gnupg.net --recv-keys D39DC0E3</p> 
 <pre><code>gpg: directory `/root/.gnupg' created
gpg: new configuration file `/root/.gnupg/gpg.conf' created
gpg: WARNING: options in `/root/.gnupg/gpg.conf' are not yet active during this run
gpg: keyring `/root/.gnupg/secring.gpg' created
gpg: keyring `/root/.gnupg/pubring.gpg' created
gpg: requesting key D39DC0E3 from hkp server keys.gnupg.net
gpg: /root/.gnupg/trustdb.gpg: trustdb created
gpg: key D39DC0E3: public key "Michal Papis (RVM signing) &lt;mpapis@gmail.com&gt;" imported
gpg: no ultimately trusted keys found
gpg: Total number processed: 1
gpg:               imported: 1  (RSA: 1)</code></pre> 
 <p>1.安装curl <br>#sudo yum install curl</p> 
 <ol start="2"><li> <p>安装RVM<br>#curl -L get.rvm.io | bash -s stable</p> </li><li> <p>source/usr/local/rvm/scripts/rvm</p> </li><li> <p>查看rvm库中已知的ruby版本</p> <pre><code>#rvm list known   
#MRI Rubies
[ruby-]2.0.0[-p648]
[ruby-]2.1[.10]
[ruby-]2.2[.7]
[ruby-]2.3[.4]
[ruby-]2.4[.1]</code></pre> </li><li> <p>安装一个ruby版本<br>#rvm install 2.3.4 这里要选择正确 //rvm install 2.3会失败</p> </li><li>使用一个ruby版本<br>#rvmuse2.3.4</li></ol> 
 <pre><code>#rvm --create ruby-2.3.4
Using /usr/local/rvm/gems/ruby-2.3.4</code></pre> 
 <pre><code>#ruby --version
ruby 2.3.4p301 (2017-03-30 revision 58214) [x86_64-linux]</code></pre> 
 <ol start="7"><li>卸载一个已知版本rvmremove2.0.0</li></ol> 
 <p>安装redis-dump<br>#gem install redis-dump</p> 
 <h2>三、redis简单初步优化以及启动</h2> 
 <p>配置文件参数：</p> 
 <pre><code>[root@git-server ~]# grep -Ev "^#|^$" /usr/local/redis/redis.conf |egrep "bind|port|tcp-backlog|daemonize|pidfile|loglevel|logfile|dir|requirepass|appendonly|appendfsync"
bind 127.0.0.1
port 6379
tcp-backlog 511
daemonize yes
pidfile /var/run/redis_6379.pid
loglevel notice
logfile "/data/redis/log/redis.log"
dir /data/redis/data/
requirepass zykjdr#558996
appendonly no
appendfilename "appendonly.aof"</code></pre> 
 <p>启动：redis-server /usr/local/redis/redis.conf</p> 
 <pre><code>[root@git-server log]# redis-cli -h 127.0.0.1 -p 6379 -a 'zykjdr#558996'
127.0.0.1:6379&gt; get key
(nil)
127.0.0.1:6379&gt; set key01 name01
OK
127.0.0.1:6379&gt; set key02 name02
OK
127.0.0.1:6379&gt; </code></pre> 
 <h2>四、导出redis数据</h2> 
 <p>#redis-dump -u 127.0.0.1:6379 -a 'zykjdr#558996' &gt; test.json</p> 
 <pre><code>[root@git-server ~]# redis-dump -u 127.0.0.1:6379 -a 'zykjdr#558996' &gt; test.json
-bash: redis-dump: command not found</code></pre> 
 <p><strong>原因是没有指定ruby-2.3.4的环境，导致找不到redis-dump命令</strong><br>解决办法：</p> 
 <pre><code>[root@git-server ~]# rvm --create ruby-2.3.4
Warning! PATH is not properly set up, '/usr/local/rvm/gems/ruby-2.3.4/bin' is not available.
         Usually this is caused by shell initialization files. Search for 'PATH=...' entries.
         You can also re-add RVM to your profile by running: 'rvm get stable --auto-dotfiles'.
         To fix it temporarily in this shell session run: 'rvm use ruby-2.3.4'.
         To ignore this error add rvm_silence_path_mismatch_check_flag=1 to your ~/.rvmrc file.
Using /usr/local/rvm/gems/ruby-2.3.4
[root@git-server ~]# which redis-dump
/usr/local/rvm/gems/ruby-2.3.4/bin/redis-dump</code></pre> 
 <p><strong>数据导出</strong><br>[root@git-server ~]# redis-dump -u 127.0.0.1:6379 -a 'zykjdr#558996' &gt; test.json</p> 
 <pre><code>[root@git-server ~]# cat test.json 
{"db":0,"key":"key02","ttl":-1,"type":"string","value":"name02","size":6}
{"db":0,"key":"key01","ttl":-1,"type":"string","value":"name01","size":6}
[root@git-server ~]# </code></pre> 
 <p><strong>在redis-server 中删除数据</strong></p> 
 <pre><code>127.0.0.1:6379&gt; del key02
(integer) 1
127.0.0.1:6379&gt; get key02
(nil)
127.0.0.1:6379&gt; del key01
(integer) 1
127.0.0.1:6379&gt; get key01
(nil)</code></pre> 
 <p><strong>redis-load 还原数据 </strong></p> 
 <pre><code>[root@git-server ~]# &lt; test.json redis-load -u 127.0.0.1:6379 -a 'zykjdr#558996'
[root@git-server log]# redis-cli -h 127.0.0.1 -p 6379 -a 'zykjdr#558996'
127.0.0.1:6379&gt; get key01
"name01"
127.0.0.1:6379&gt; get key02
"name02"
127.0.0.1:6379&gt; </code></pre> 
 <p><strong>同时可以设置环境变量来使用redis-dump 和redis-load导出和导入redis数据</strong><br>在redis.conf配置文件中去掉redis-server的密码，<br>设定一个环境变量</p> 
 <pre><code>[root@git-server ~]# export REDIS_URI=127.0.0.1:6379 
[root@git-server ~]# redis-dump &gt;test1.json
[root@git-server ~]# cat test1.json 
{"db":0,"key":"key01","ttl":-1,"type":"string","value":"name01","size":6}
{"db":0,"key":"key02","ttl":-1,"type":"string","value":"name02","size":6}</code></pre> 
 <p><strong>登录redis-server删除key值</strong></p> 
 <pre><code>[root@git-server log]# redis-cli -h 127.0.0.1 -p 6379 -a 'zykjdr#558996'
127.0.0.1:6379&gt; del key01
(integer) 1
127.0.0.1:6379&gt; del key02
(integer) 1</code></pre> 
 <p><strong>导入数据并查看导入的key值``</strong></p> 
 <pre><code>[root@git-server ~]# &lt;test1.json redis-load
# export REDIS_URI=127.0.0.1:6379
[root@git-server ~]# &lt;test1.json redis-load

查看key值
127.0.0.1:6379&gt; get key02
"name02"
127.0.0.1:6379&gt; get key01
"name01"
127.0.0.1:6379&gt; </code></pre> 
 <pre><code>[root@git-server ~]# &lt;test1.json redis-load
#export REDIS_URI=127.0.0.1:6379
#&lt; test.json redis-load
ERROR (Yajl::ParseError): lexical error: invalid bytes in UTF8 string.
          },"size":274} {"db":0,"key":"0000\u0005t\u0000#100776963
                     (right here) ------^
[root@cache_hx_193_16 bohai]# cp test.json test.json-bak</code></pre> 
 <p><strong>如果报错，请使用-n选项，使用请参考官方，请谨慎使用</strong>！<br>#&lt; test.json redis-load -n //-n （以二进制形式导入）</p> 
 <p>参考文献：<br>利用redis-dump导出、还原数据--&gt;<a href="http://www.ywnds.com/?p=7115" rel="nofollow">http://www.ywnds.com/?p=7115</a><br>redis-dump安装使用手册---&gt;<a href="https://github.com/delano/redis-dump">https://github.com/delano/redis-dump</a><br>redis requires Ruby version &gt;= 2.2.2问题 ---<a href="https://www.cnblogs.com/carryping/p/7447823.html" rel="nofollow">https://www.cnblogs.com/carryping/p/7447823.html</a></p> 
</div> 
<p>转载于:https://blog.51cto.com/wujianwei/2105124</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6955518a722ce64c8bfe32810c365cb8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Svn总是提示输入账号密码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d9daed6716b1afcc19c292cb26576837/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Unity 多人游戏（Multiplayer and Networking）】1.配置UnityMultiPlayer功能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>