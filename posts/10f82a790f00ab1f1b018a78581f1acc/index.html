<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nodeJS中的异步编程 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nodeJS中的异步编程" />
<meta property="og:description" content="nodejs 不是单线程 在博客项目中关于异步问题： 1.当用户添加一条博客时 需要通过post方式向服务器发送数据 后台获取用户以post方式拿到传送过来的数据 然后存入数据库： 上面的代码：创建一个空字符串 当用户向服务器发送请求时出发data事件将依次获取来数据进行拼接 当用户请求结束后出发end事件 将拼接后的字符串赋值给req.postData属性 理想中的代码执行顺序如下： 但是代码中的data和end事件 都是属于异步 SO 真正执行如下： 因为同步代码优先执行 异步代码等同步代码之行结束后再根据规则执行 这就造成后台接收不到传送的数据 使用Promise解决异步问题：将异步代码放入Promise中 将要传送的数据放到resolve方法中作为参数 当上面代码执行完成后才执行下面的then里面的代码 同时也回想resolve中的参数传到下面的形参result中 在将其赋值给req.postData 将后续代码放在then中 2.当nodeJS操作数据库时也存在异步： var mysql = require(&#39;mysql&#39;); var connection = mysql.createConnection({ host: &#39;localhost&#39;, user: &#39;root&#39;, password: &#39;root&#39;, database: &#39;nodeblog&#39; }); //开始连接 connection.connect(); //查询所有数据 let sql = &#39;SELECT * FROM student&#39; connection.query(sql, (err, result) =&gt; { if (err) { console.log(&#39;sorry&#39;); return; } console.log(result); }); console.log(&#39;查询结束&#39;) 上面代码的执行结果为： 说明：虽然查询学生表的代码书写在前 但是优先输出“查询结束”可见后续代码不会等到查询学生表代码执行结束后才执行 解决方法：也是通过Promise 红色框内为异步代码 黄色框内为后续代码！！！ 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/10f82a790f00ab1f1b018a78581f1acc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-11T19:30:16+08:00" />
<meta property="article:modified_time" content="2020-03-11T19:30:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nodeJS中的异步编程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="nodejs___0"></a>nodejs 不是单线程 在博客项目中关于异步问题：</h5> 
<h6><a id="1_post_post__1"></a>1.当用户添加一条博客时 需要通过post方式向服务器发送数据 后台获取用户以post方式拿到传送过来的数据 然后存入数据库：</h6> 
<p><img src="https://images2.imgbox.com/43/87/ohZzSzUZ_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="_data_end_reqpostData__3"></a>上面的代码：创建一个空字符串 当用户向服务器发送请求时出发data事件将依次获取来数据进行拼接 当用户请求结束后出发end事件 将拼接后的字符串赋值给req.postData属性 理想中的代码执行顺序如下：</h6> 
<p><img src="https://images2.imgbox.com/13/e2/8U2X7OAA_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="dataend__SO__5"></a>但是代码中的data和end事件 都是属于异步 SO 真正执行如下：</h6> 
<p><img src="https://images2.imgbox.com/4e/73/c46ZjDtd_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="___7"></a>因为同步代码优先执行 异步代码等同步代码之行结束后再根据规则执行 这就造成后台接收不到传送的数据</h6> 
<h6><a id="PromisePromise_resolve_8"></a>使用Promise解决异步问题：将异步代码放入Promise中 将要传送的数据放到resolve方法中作为参数</h6> 
<p><img src="https://images2.imgbox.com/5d/b5/vpOeYxAR_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="then_resolveresult_reqpostData_then_10"></a>当上面代码执行完成后才执行下面的then里面的代码 同时也回想resolve中的参数传到下面的形参result中 在将其赋值给req.postData 将后续代码放在then中</h6> 
<p><img src="https://images2.imgbox.com/1c/81/VUQOVLA4_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2nodeJS_12"></a>2.当nodeJS操作数据库时也存在异步：</h6> 
<pre><code>var mysql = require('mysql');
var connection = mysql.createConnection({
    host: 'localhost',
    user: 'root',
    password: 'root',
    database: 'nodeblog'
});

//开始连接
connection.connect();

//查询所有数据
let sql = 'SELECT * FROM student'
connection.query(sql, (err, result) =&gt; {
    if (err) {
        console.log('sorry');
        return;
    }
    console.log(result);
});

console.log('查询结束')
</code></pre> 
<h6><a id="_38"></a>上面代码的执行结果为：</h6> 
<p><img src="https://images2.imgbox.com/d3/0b/FIFFe9Sn_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="__40"></a>说明：虽然查询学生表的代码书写在前 但是优先输出“查询结束”可见后续代码不会等到查询学生表代码执行结束后才执行</h6> 
<h6><a id="Promise_41"></a>解决方法：也是通过Promise</h6> 
<p><img src="https://images2.imgbox.com/67/08/tsVGctVI_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="__43"></a>红色框内为异步代码 黄色框内为后续代码！！！</h6> 
<h6><a id="3Promise_44"></a>3.使用Promise实现依次读取文件：</h6> 
<pre><code>/**依次读取文件
 */

//拿到abc三个文件的路径 使用绝对路径
const path = require('path')
const fs = require('fs')
let a = path.join(__dirname, '文件', 'a.txt')
let b = path.join(__dirname, '文件', 'b.txt')
let c = path.join(__dirname, '文件', 'c.txt')

let read = path =&gt; {
    return new Promise((resolve, reject) =&gt; {
        fs.readFile(path, 'utf8', (err,data) =&gt; {
            resolve(data)
        })
    })
}

read(a).then(data =&gt; {
    console.log(data)
    return read(b)
}).then(data =&gt; {
    console.log(data)
    return read(c)
}).then(data =&gt; {
    console.log(data) 
})
</code></pre> 
<h3><a id="OK_75"></a>OK</h3>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4e051b14745dd0fed087e1de51e6c902/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于Element-UI Upload 上传图片第二次或第N次无反应的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/38bae0383e92008dcbee29fc3f1c320e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用nodemcu玩转物联网系列（三）：nodemcu连接onenet服务器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>