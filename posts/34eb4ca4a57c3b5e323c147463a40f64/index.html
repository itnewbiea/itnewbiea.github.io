<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用内网穿透实现公网VNC远程桌面Ubuntu - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用内网穿透实现公网VNC远程桌面Ubuntu" />
<meta property="og:description" content="文章目录 前言1. ubuntu安装VNC2. 设置vnc开机启动3. windows 安装VNC viewer连接工具4. 内网穿透4.1 安装cpolar【支持使用一键脚本命令安装】4.2 创建隧道映射4.3 测试公网远程访问 5. 配置固定TCP地址5.1 保留一个固定的公网TCP端口地址5.2 配置固定公网TCP端口地址5.3 测试使用固定公网地址远程 总结 前言 实现ubuntu 系统桌面级别的远程连接,需要在ubuntu 系统中安装vnc,既然是桌面,前提是需要ubuntu 带有图形化界面,如果没有,可以执行以下命令安装图形化界面
sudo apt install ubuntu-desktop sudo apt-get install gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal sudo reboot #重启即可看到图形界面 1. ubuntu安装VNC 在ubuntu中安装vnc
sudo apt-get install x11vnc 安装LightDM【LightDM从设计上就是支持本地图形界面以获得最好的兼容性】
sudo apt-get install lightdm 安装过程中会出现以下选项,选择lightdm然后回车即可
设置密码,设置密码后,会问你是否需要将密码保存在:/home/root1/.vnc/passwd,输入y确认即可
x11vnc -storepasswd 2. 设置vnc开机启动 创建一个x11vnc.service文件
sudo vim /lib/systemd/system/x11vnc.service 按i键进入编辑模式,添加如下信息,!!注意: &lt;USERNAME&gt;替换为您ubuntu用户名,添加完成后按Esc键退出编辑,然后输入冒号:wq保存
[Unit] Description=Start x11vnc at startup. After=multi-user.target [Service] Type=simple ExecStart=/usr/bin/x11vnc -auth guess -forever -loop -noxdamage -repeat -rfbauth /home/&lt;USERNAME&gt;/." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/34eb4ca4a57c3b5e323c147463a40f64/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-27T22:56:38+08:00" />
<meta property="article:modified_time" content="2023-09-27T22:56:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用内网穿透实现公网VNC远程桌面Ubuntu</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_5" rel="nofollow">前言</a></li><li><a href="#1_ubuntuVNC_17" rel="nofollow">1. ubuntu安装VNC</a></li><li><a href="#2_vnc_47" rel="nofollow">2. 设置vnc开机启动</a></li><li><a href="#3_windows_VNC_viewer_80" rel="nofollow">3. windows 安装VNC viewer连接工具</a></li><li><a href="#4__106" rel="nofollow">4. 内网穿透</a></li><li><ul><li><a href="#41_cpolar_112" rel="nofollow">4.1 安装cpolar【支持使用一键脚本命令安装】</a></li><li><a href="#42__154" rel="nofollow">4.2 创建隧道映射</a></li><li><a href="#43__182" rel="nofollow">4.3 测试公网远程访问</a></li></ul> 
    </li><li><a href="#5_TCP_201" rel="nofollow">5. 配置固定TCP地址</a></li><li><ul><li><a href="#51_TCP_207" rel="nofollow">5.1 保留一个固定的公网TCP端口地址</a></li><li><a href="#52_TCP_226" rel="nofollow">5.2 配置固定公网TCP端口地址</a></li><li><a href="#53__251" rel="nofollow">5.3 测试使用固定公网地址远程</a></li></ul> 
    </li><li><a href="#_262" rel="nofollow">总结</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h4><a id="_5"></a>前言</h4> 
<p>实现ubuntu 系统桌面级别的远程连接,需要在ubuntu 系统中安装vnc,既然是桌面,前提是需要ubuntu 带有图形化界面,如果没有,可以执行以下命令安装图形化界面</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> ubuntu-desktop 

<span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal 

<span class="token function">sudo</span> <span class="token function">reboot</span> <span class="token comment">#重启即可看到图形界面</span>
</code></pre> 
<h4><a id="1_ubuntuVNC_17"></a>1. ubuntu安装VNC</h4> 
<p>在ubuntu中安装vnc</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> x11vnc
</code></pre> 
<p><img src="https://images2.imgbox.com/3b/e0/NNAObVSH_o.png" alt="Image"></p> 
<p>安装LightDM【LightDM从设计上就是支持本地图形界面以获得最好的兼容性】</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> lightdm
</code></pre> 
<p>安装过程中会出现以下选项,选择lightdm然后回车即可</p> 
<p><img src="https://images2.imgbox.com/07/8b/lgUG35Gd_o.png" alt="在这里插入图片描述"></p> 
<p>设置密码,设置密码后,会问你是否需要将密码保存在:/home/root1/.vnc/passwd,输入<code>y</code>确认即可</p> 
<pre><code class="prism language-shell">x11vnc <span class="token parameter variable">-storepasswd</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5e/71/pzt6v5bJ_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="2_vnc_47"></a>2. 设置vnc开机启动</h4> 
<p>创建一个<code>x11vnc.service</code>文件</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> <span class="token function">vim</span> /lib/systemd/system/x11vnc.service
</code></pre> 
<p>按<code>i</code>键进入编辑模式,添加如下信息,<strong>!!注意: <code>&lt;USERNAME&gt;</code>替换为您ubuntu用户名</strong>,添加完成后按Esc键退出编辑,然后输入冒号:wq保存</p> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>Unit<span class="token punctuation">]</span>
<span class="token assign-left variable">Description</span><span class="token operator">=</span>Start x11vnc at startup.
<span class="token assign-left variable">After</span><span class="token operator">=</span>multi-user.target
 
<span class="token punctuation">[</span>Service<span class="token punctuation">]</span>
<span class="token assign-left variable">Type</span><span class="token operator">=</span>simple
<span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/bin/x11vnc <span class="token parameter variable">-auth</span> guess <span class="token parameter variable">-forever</span> <span class="token parameter variable">-loop</span> <span class="token parameter variable">-noxdamage</span> <span class="token parameter variable">-repeat</span> <span class="token parameter variable">-rfbauth</span> /home/<span class="token operator">&lt;</span>USERNAME<span class="token operator">&gt;</span>/.vnc/passwd <span class="token parameter variable">-rfbport</span> <span class="token number">5900</span> <span class="token parameter variable">-shared</span>
 
<span class="token punctuation">[</span>Install<span class="token punctuation">]</span>
<span class="token assign-left variable">WantedBy</span><span class="token operator">=</span>multi-user.target
</code></pre> 
<p><img src="https://images2.imgbox.com/4a/50/9TXcZ5oF_o.png" alt="在这里插入图片描述"></p> 
<p>设置开机启动</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> x11vnc.service
</code></pre> 
<p>启动服务</p> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> systemctl start x11vnc.service
</code></pre> 
<h4><a id="3_windows_VNC_viewer_80"></a>3. windows 安装VNC viewer连接工具</h4> 
<p>进入vnc官网,下载windows版vnc连接工具</p> 
<blockquote> 
 <p><a href="https://www.realvnc.com/en/connect/download/viewer/" rel="nofollow">https://www.realvnc.com/en/connect/download/viewer/</a></p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/af/1c/xbLoP8Rc_o.png" alt="在这里插入图片描述"></p> 
<p>下载好后打开使用局域网ip进行连接,端口是5900</p> 
<p><img src="https://images2.imgbox.com/88/59/IquYShqf_o.png" alt="在这里插入图片描述"></p> 
<p>出现密码界面,输入上面设置的密码即可<br> <img src="https://images2.imgbox.com/e9/95/tosODoG6_o.png" alt="在这里插入图片描述"></p> 
<p>出现ubuntu桌面表示成功<br> <img src="https://images2.imgbox.com/31/78/RSDjWXoo_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="4__106"></a>4. 内网穿透</h4> 
<p>本地测试远程连接没问题后,接下来我们实现在公网环境下的远程桌面，这里我们可以使用cpolar内网穿透工具实现程访问。支持http/https/tcp协议，不限制流量，无需公网ip，也无需设置路由器。</p> 
<blockquote> 
 <p>cpolar官网：<a href="https://www.cpolar.com/" rel="nofollow">https://www.cpolar.com/</a></p> 
</blockquote> 
<h5><a id="41_cpolar_112"></a>4.1 安装cpolar【支持使用一键脚本命令安装】</h5> 
<ul><li>cpolar 安装（国内使用）</li></ul> 
<pre><code class="prism language-shell"><span class="token function">curl</span> <span class="token parameter variable">-L</span> https://www.cpolar.com/static/downloads/install-release-cpolar.sh <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span>
</code></pre> 
<p>或 cpolar短链接安装方式：(国外使用）</p> 
<pre><code class="prism language-shell"><span class="token function">curl</span> <span class="token parameter variable">-sL</span> https://git.io/cpolar <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">bash</span>
</code></pre> 
<ul><li>查看版本号，有正常显示版本号即为安装成功</li></ul> 
<pre><code class="prism language-shell">cpolar version
</code></pre> 
<ul><li>token认证</li></ul> 
<p>登录<a href="https://www.cpolar.com/" rel="nofollow">cpolar官网</a>后台，点击左侧的验证，查看自己的认证token，之后将token贴在命令行里</p> 
<pre><code class="prism language-shell">cpolar authtoken xxxxxxx
</code></pre> 
<p><img src="https://images2.imgbox.com/57/0c/oMOoUrSe_o.png" alt="20230227141344"></p> 
<ul><li>简单穿透测试，有正常生成相应的公网地址即为穿透成功</li></ul> 
<pre><code class="prism language-shell">cpolar http <span class="token number">8080</span>
</code></pre> 
<p>按ctrl+c退出</p> 
<ul><li>向系统添加服务</li></ul> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> cpolar
</code></pre> 
<ul><li>启动cpolar服务</li></ul> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> systemctl start cpolar
</code></pre> 
<ul><li>查看服务状态</li></ul> 
<pre><code class="prism language-shell"><span class="token function">sudo</span> systemctl status cpolar
</code></pre> 
<h5><a id="42__154"></a>4.2 创建隧道映射</h5> 
<p>cpolar安装成功后，在浏览器上访问本地9200端口，【127.0.0.1:9200]，使用cpolar邮箱账号登录 web UI管理界面。</p> 
<p><img src="https://images2.imgbox.com/c3/97/m4B6gX54_o.png" alt="在这里插入图片描述"></p> 
<p>登录成功后，点击左侧仪表盘的隧道管理——创建隧道，创建一个tcp协议的隧道指向本地5900端口:</p> 
<ul><li>隧道名称：可自定义，注意不要与已有的隧道名称重复</li><li>协议：tcp</li><li>本地地址：5900</li><li>域名类型：免费选择随机域名</li><li>地区：默认China top即可</li></ul> 
<p>点击<code>创建</code></p> 
<p><img src="https://images2.imgbox.com/12/a5/qxDtrhNb_o.png" alt="在这里插入图片描述"></p> 
<p>隧道创建成功后，点击左侧的状态——在线隧道列表，可以看到，刚刚创建的隧道已经有生成了相应的公网地址+公网端口号，将其复制下来</p> 
<p><img src="https://images2.imgbox.com/ef/a1/wnxDqyqk_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="43__182"></a>4.3 测试公网远程访问</h5> 
<p>打开windows vnc viewer，使用刚刚所获取的公网地址+公网端口号进行连接。本例为<code>2.tcp.vip.cpolar.cn:13001</code><br> <img src="https://images2.imgbox.com/96/bb/FD2KE58d_o.png" alt="在这里插入图片描述"></p> 
<p>输入密码<br> <img src="https://images2.imgbox.com/44/d6/tOXXDyte_o.png" alt="在这里插入图片描述"></p> 
<p>公网远程连接成功<br> <img src="https://images2.imgbox.com/b8/a2/9GKeZBzx_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="5_TCP_201"></a>5. 配置固定TCP地址</h4> 
<p>由于以上创建的隧道是随机地址隧道,该地址会在24小时内变化,为了使连接更加稳定,我们需要为其配置固定的TCP地址。</p> 
<blockquote> 
 <p>需要注意，配置固定TCP端口地址需要将cpolar升级到专业版套餐或以上。</p> 
</blockquote> 
<h5><a id="51_TCP_207"></a>5.1 保留一个固定的公网TCP端口地址</h5> 
<p>登录cpolar官网后台，点击左侧的预留，选择保留的TCP地址。</p> 
<ul><li>地区：选择China VIP</li><li>描述：即备注，可自定义填写</li></ul> 
<p>点击保留</p> 
<p><img src="https://images2.imgbox.com/91/c8/oca2c5lI_o.png" alt="在这里插入图片描述"></p> 
<p>地址保留成功后，系统会生成相应的固定公网地址，将其复制下来</p> 
<p><img src="https://images2.imgbox.com/b3/4c/JrtRvcJT_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="52_TCP_226"></a>5.2 配置固定公网TCP端口地址</h5> 
<p>在浏览器上登录cpolar web UI管理界面，<a href="http://127.0.0.1:9200/" rel="nofollow">http://127.0.0.1:9200/</a>，点击左侧仪表盘的隧道管理——隧道列表，找到我们前面创建的vnc远程隧道，点击右侧的编辑</p> 
<p><img src="https://images2.imgbox.com/99/15/D2Sk0EdU_o.png" alt="在这里插入图片描述"></p> 
<p>修改隧道信息，将保留成功的固定tcp地址配置到隧道中</p> 
<ul><li>端口类型：修改为固定tcp端口</li><li>预留的tcp地址：填写保留成功的地址</li></ul> 
<p>点击更新</p> 
<p><img src="https://images2.imgbox.com/3e/bc/ujNtEAB3_o.png" alt="在这里插入图片描述"></p> 
<p>隧道更新成功后，点击左侧仪表盘的状态——在线隧道列表，找到vnc远程桌面隧道，可以看到公网地址已经更新成为了固定tcp地址。</p> 
<p><img src="https://images2.imgbox.com/f7/7e/aAOUSqsk_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="53__251"></a>5.3 测试使用固定公网地址远程</h5> 
<p>接下来测试使用固定TCP端口地址远程ubuntu桌面,我们再次在windows上打开VNC viewer，使用固定tcp地址连接，出现密码界面,同样输入密码</p> 
<p><img src="https://images2.imgbox.com/49/a7/sYAY5ZZM_o.png" alt="在这里插入图片描述"></p> 
<p>远程连接成功</p> 
<p><img src="https://images2.imgbox.com/27/c5/DnSzkpsm_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_262"></a>总结</h4> 
<p>至此，我们成功实现了使用VNC远程桌面ubuntu：通过cpolar穿透vnc服务5900端口，使用所生成的公网地址，实现在外随时随地远程桌面控制内网的Ubuntu，不需要公网IP，也不需要配置路由器。并且，这个公网地址还是固定的，不会随机变化，连接稳定。</p> 
<p>除了穿透vnc之外，cpolar也可以应用在其他众多场景下，比如公网ssh远程、远程群晖NAS、我的世界联机、微信公众号支付宝调试、公开一个本地web…【PS：cpolar目前还支持21天退款保证】</p> 
<blockquote> 
 <p><strong>转载自cpolar极点云文章：<a href="https://www.cpolar.com/blog/remote-desktop-ubuntu" rel="nofollow">使用VNC远程桌面Ubuntu【内网穿透实现公网远程】</a></strong></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/334aef933cf6bc92516d2f562473a056/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">unordered_set&#43;unordered_map&#43;字符输入</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f41d63528093605cd06c0954a939df59/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C# 通过Process.Start(@“C:\Windows\System32\osk.exe“)调用系统软键盘，提示无法找到文件路径解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>