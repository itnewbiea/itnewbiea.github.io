<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android FDE功能介绍 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android FDE功能介绍" />
<meta property="og:description" content="在Android 5.0之前，vold中的磁盘加密功能FDE(full disk encryption)，只是对用户密码及SALT采用了scrypt算法来生成加密密钥(4.4以前使用pkdf2，强度更低)，这些只是增加了暴力破解的难度，但风险依然很高。比如可以获取分区镜像 前1K 及 后16K 的数据 (Android FDE的相关加密密钥默认存储在分区尾部的16 KBytes中，前4K是EXT4文件系统的Superblock，一般EXT4 FS SuperBlock前1K均为0)，暴力枚举用户密码，并采用vold中相同的磁盘加密算法来生成解密密钥，尝试用其对前1K中的部分数据进行AES算法解密，解出来都为0则碰撞OK。默认Android原生的用户密码6位数字密码，即使很普通的PC 3、5个小时都能跑出来。 从5.0开始，增加了硬件TEE(Trusted Execution Environment)中的签名过程，结合多次scrypt算法来产生加密密钥，以此密钥来加密 磁盘加密主密钥，使得离线暴力破解几乎无可能，除非破解者获得了TEE中的RSA私钥，并清楚特定硬件平台HAL中的keymaster模块实现。 5.0中的加密 磁盘加密密钥 的实现逻辑: 1. 产生随机16 Bytes DEK(disk encryption key--磁盘加密用的密钥)及16 Bytes SALT； 2. 对(用户密码&#43;SALT)使用scrypt算法产生32 Bytes HASH 作为IK1(intermediate key 1); 3. 将IK1填充到硬件产生的私钥规格大小(目前看到是RSA算法，256Bytes), 具体是: 00 || IK1 || 00..00 ## one zero byte, 32 IK1 bytes, 223 zero bytes. 4. 使用硬件私钥 HBK 对 IK1 进行签名，生成256 Bytes签名数据作为IK2； 5. 对(IK2&#43;SALT)使用scrypt算法(与第二步中的SALT相同)产生出32 Bytes HASH 作为IK3； 6. 使用IK3前16 Bytes作为KEK(用来加密主密钥DEK的KEY)，后16 Bytes作为算法IV(初始化向量)； 7." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/95e4945942a41f0d1aed96e95aca971e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-18T21:55:08+08:00" />
<meta property="article:modified_time" content="2018-05-18T21:55:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android FDE功能介绍</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">在Android 5.0之前，vold中的磁盘加密功能FDE(full disk encryption)，只是对用户密码及SALT采用了scrypt算法来生成加密密钥(4.4以前使用pkdf2，强度更低)，这些只是增加了暴力破解的难度，但风险依然很高。比如可以获取分区镜像 前1K 及 后16K 的数据 (Android FDE的相关加密密钥默认存储在分区尾部的16 KBytes中，前4K是EXT4文件系统的Superblock，一般EXT4 FS SuperBlock前1K均为0)，暴力枚举用户密码，并采用vold中相同的磁盘加密算法来生成解密密钥，尝试用其对前1K中的部分数据进行AES算法解密，解出来都为0则碰撞OK。默认Android原生的用户密码6位数字密码，即使很普通的PC 3、5个小时都能跑出来。</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">从5.0开始，增加了硬件TEE(Trusted Execution Environment)中的签名过程，结合多次scrypt算法来产生加密密钥，以此密钥来加密 磁盘加密主密钥，使得离线暴力破解几乎无可能，除非破解者获得了TEE中的RSA私钥，并清楚特定硬件平台HAL中的keymaster模块实现。</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">5.0中的加密 磁盘加密密钥 的实现逻辑:</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">1. 产生随机16 Bytes DEK(disk encryption key--磁盘加密用的密钥)及16 Bytes SALT；</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">2. 对(用户密码+SALT)使用scrypt算法产生32 Bytes HASH 作为IK1(intermediate key 1);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">3. 将IK1填充到硬件产生的私钥规格大小(目前看到是RSA算法，256Bytes), 具体是: </span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">00 || IK1 || 00..00  ## one zero byte, 32 IK1 bytes, 223 zero bytes.</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">4. 使用硬件私钥 HBK 对 IK1 进行签名，生成256 Bytes签名数据作为IK2；</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">5. 对(IK2+SALT)使用scrypt算法(与第二步中的SALT相同)产生出32 Bytes HASH 作为IK3；</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">6. 使用IK3前16 Bytes作为KEK(用来加密主密钥DEK的KEY)，后16 Bytes作为算法IV(初始化向量)；</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">7. 使用AES_CBC算法，采用KEK作为密钥，IV作为初始化向量来加密用户的主密钥DEK，生成加密后的主密钥，存入分区尾部数据结构中；</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">&gt; 4.4之前的分区尾部 磁盘加密相关的存储结构，默认采用pbkdf2来做密钥导出算法</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">struct crypt_mnt_ftr {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 magic;                /* See above */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le16 major_version;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le16 minor_version;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 ftr_size;         /* in bytes, not including key following */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 flags;                /* See above */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 keysize;        /* in bytes */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 spare1;        /* ignored */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le64 fs_size;        /* Size of the encrypted fs, in 512 byte sectors */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 failed_decrypt_count; /* count of # of failed attempts to decrypt and</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                  mount, set to 0 on successful mount */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  unsigned char crypto_type_name[MAX_CRYPTO_TYPE_NAME_LEN]; /* The type of encryption</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                                               needed to decrypt this</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                                               partition, null terminated */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">};</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">&gt; 4.4中的分区尾部 磁盘加密相关的存储结构，可选择使用scrypt及pbkdf2，默认为scrypt</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">struct crypt_mnt_ftr {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 magic;                /* See above */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le16 major_version;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le16 minor_version;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 ftr_size;         /* in bytes, not including key following */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 flags;                /* See above */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 keysize;        /* in bytes */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 spare1;        /* ignored */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le64 fs_size;        /* Size of the encrypted fs, in 512 byte sectors */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 failed_decrypt_count; /* count of # of failed attempts to decrypt and</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                  mount, set to 0 on successful mount */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  unsigned char crypto_type_name[MAX_CRYPTO_TYPE_NAME_LEN]; /* The type of encryption</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                                               needed to decrypt this</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                                               partition, null terminated */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 spare2;        /* ignored */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  unsigned char master_key[MAX_KEY_LEN]; /* The encrypted key for decrypting the filesystem */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  unsigned char salt[SALT_LEN];   /* The salt used for this encryption */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le64 persist_data_offset[2];  /* Absolute offset to both copies of crypt_persist_data</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                   * on device with that info, either the footer of the</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                   * real_blkdevice or the metadata partition. */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 persist_data_size;       /* The number of bytes allocated to each copy of the</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                   * persistent data table*/</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  kdf_type; /* The key derivation function used. */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  /* scrypt parameters. See www.tarsnap.com/scrypt/scrypt.pdf */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  N_factor; /* (1 &lt;&lt; N) */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  r_factor; /* (1 &lt;&lt; r) */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  p_factor; /* (1 &lt;&lt; p) */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">};</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">&gt; 5.0中默认采用基于TEE签名外加多轮scrypt算法来导出加密密钥</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">struct crypt_mnt_ftr {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 magic;         /* See above */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le16 major_version;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le16 minor_version;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 ftr_size;      /* in bytes, not including key following */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 flags;         /* See above */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 keysize;       /* in bytes */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 crypt_type;    /* how master_key is encrypted. Must be a</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                         * CRYPT_TYPE_XXX value */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le64 fs_size;        /* Size of the encrypted fs, in 512 byte sectors */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 failed_decrypt_count; /* count of # of failed attempts to decrypt and</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                  mount, set to 0 on successful mount */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  unsigned char crypto_type_name[MAX_CRYPTO_TYPE_NAME_LEN]; /* The type of encryption</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                                               needed to decrypt this</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                                               partition, null terminated */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 spare2;        /* ignored */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  unsigned char master_key[MAX_KEY_LEN]; /* The encrypted key for decrypting the filesystem */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  unsigned char salt[SALT_LEN];   /* The salt used for this encryption */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le64 persist_data_offset[2];  /* Absolute offset to both copies of crypt_persist_data</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                   * on device with that info, either the footer of the</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                   * real_blkdevice or the metadata partition. */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 persist_data_size;       /* The number of bytes allocated to each copy of the</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                   * persistent data table*/</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  kdf_type; /* The key derivation function used. */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  /* scrypt parameters. See www.tarsnap.com/scrypt/scrypt.pdf */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  N_factor; /* (1 &lt;&lt; N) */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  r_factor; /* (1 &lt;&lt; r) */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  p_factor; /* (1 &lt;&lt; p) */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le64 encrypted_upto; /* If we are in state CRYPT_ENCRYPTION_IN_PROGRESS and</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                            we have to stop (e.g. power low) this is the last</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                            encrypted 512 byte sector.*/</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8  hash_first_block[SHA256_DIGEST_LENGTH]; /* When CRYPT_ENCRYPTION_IN_PROGRESS</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                                    set, hash of first block, used</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                                    to validate before continuing*/</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  /* key_master key, used to sign the derived key which is then used to generate</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">   * the intermediate key</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">   * This key should be used for no other purposes! We use this key to sign unpadded </span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">   * data, which is acceptable but only if the key is not reused elsewhere. */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le8 keymaster_blob[KEYMASTER_BLOB_SIZE];</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  __le32 keymaster_blob_size;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  /* Store scrypt of salted intermediate key. When decryption fails, we can</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     check if this matches, and if it does, we know that the problem is with the</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     drive, and there is no point in asking the user for more passwords.</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     Note that if any part of this structure is corrupt, this will not match and</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     we will continue to believe the user entered the wrong password. In that</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     case the only solution is for the user to enter a password enough times to</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     force a wipe.</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     Note also that there is no need to worry about migration. If this data is</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     wrong, we simply won't recognise a right password, and will continue to</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     prompt. On the first password change, this value will be populated and</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">     then we will be OK.</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">   */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">  unsigned char scrypted_intermediate_key[SCRYPT_LEN];</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">};</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">几种密钥导出算法</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">static int pbkdf2(const char *passwd, const unsigned char *salt,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                  unsigned char *ikey, void *params UNUSED)</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">{<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    SLOGI("Using pbkdf2 for cryptfs KDF");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    /* Turn the password into a key and IV that can decrypt the master key */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    unsigned int keysize;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    char* master_key = (char*)convert_hex_ascii_to_key(passwd, &amp;keysize);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (!master_key) return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">// 2000轮，显然强度很低，所以4.4以后改成scrypt这种强度适中的算法</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    PKCS5_PBKDF2_HMAC_SHA1(master_key, keysize, salt, SALT_LEN,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                           </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">/*2000*/</span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">HASH_COUNT, </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">/*16+16*/</span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">KEY_LEN_BYTES+IV_LEN_BYTES, ikey);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    memset(master_key, 0, keysize);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    free (master_key);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    return 0;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">}</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">----------------------------------------------------</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">static int scrypt(const char *passwd, const unsigned char *salt,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                  unsigned char *ikey, void *params)</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">{<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    SLOGI("Using scrypt for cryptfs KDF");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    struct crypt_mnt_ftr *ftr = (struct crypt_mnt_ftr *) params;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    </span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int N = 1 &lt;&lt; ftr-&gt;N_factor; </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">// 15</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int r = 1 &lt;&lt; ftr-&gt;r_factor;</span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> // 3</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int p = 1 &lt;&lt; ftr-&gt;p_factor; </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">// 1</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    /* Turn the password into a key and IV that can decrypt the master key */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    unsigned int keysize;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    unsigned char* master_key = convert_hex_ascii_to_key(passwd, &amp;keysize);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (!master_key) return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    crypto_scrypt(master_key, keysize, salt, SALT_LEN, N, r, p, ikey,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">            KEY_LEN_BYTES + IV_LEN_BYTES);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    memset(master_key, 0, keysize);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    free (master_key);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    return 0;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">}</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">----------------------------------------------------</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">static int scrypt_keymaster(const char *passwd, const unsigned char *salt,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                            unsigned char *ikey, void *params)</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">{<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    SLOGI("Using scrypt with keymaster for cryptfs KDF");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int rc;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    unsigned int key_size;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    size_t signature_size;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    unsigned char* signature;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    struct crypt_mnt_ftr *ftr = (struct crypt_mnt_ftr *) params;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int N = 1 &lt;&lt; ftr-&gt;N_factor;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int r = 1 &lt;&lt; ftr-&gt;r_factor;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int p = 1 &lt;&lt; ftr-&gt;p_factor;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    unsigned char* master_key = convert_hex_ascii_to_key(passwd, &amp;key_size);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (!master_key) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("Failed to convert passwd from hex");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">// 第一轮scrypt，生成IK1</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    rc = crypto_scrypt(master_key, key_size, salt, SALT_LEN,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                       N, r, p, ikey, KEY_LEN_BYTES + IV_LEN_BYTES);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    memset(master_key, 0, key_size);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    free(master_key);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (rc) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("scrypt failed");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">// TEE中初始化RSA密钥对，最终在TEE中对IK1进行签名，并返回签名结果作为IK2</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (keymaster_sign_object(ftr, ikey, KEY_LEN_BYTES + IV_LEN_BYTES,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                              &amp;signature, &amp;signature_size)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("Signing failed");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">// 对IK2结合salt再进行一轮scrypt，产生最终的AES_CBC使用的ikey(16B KEK + 16B IV)</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    rc = crypto_scrypt(signature, signature_size, salt, SALT_LEN,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                       N, r, p, ikey, KEY_LEN_BYTES + IV_LEN_BYTES);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    free(signature);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (rc) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("scrypt failed");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    return 0;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">}</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">/* Create a new keymaster key and store it in this footer */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">static int keymaster_create_key(struct crypt_mnt_ftr *ftr)</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">{<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    uint8_t* key = 0;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    keymaster_device_t *keymaster_dev = 0;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (keymaster_init(&amp;keymaster_dev)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("Failed to init keymaster");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int rc = 0;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    keymaster_rsa_keygen_params_t params;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    memset(¶ms, '\0', sizeof(params));</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    params.public_exponent = RSA_EXPONENT;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    params.modulus_size = RSA_KEY_SIZE;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    size_t key_size;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">   </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> // 调用HAL中的加密模块，产生RSA密钥对<br>    // 其中的私钥一般是加密返回的，具体keymaster_blob数据结构和算法不同硬件平台厂家实现不一样</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (keymaster_dev-&gt;generate_keypair(keymaster_dev, TYPE_RSA, ¶ms,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                                        &amp;key, &amp;key_size)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("Failed to generate keypair");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        rc = -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        goto out;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (key_size &gt; KEYMASTER_BLOB_SIZE) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("Keymaster key too large for crypto footer");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        rc = -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        goto out;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    memcpy(ftr-&gt;keymaster_blob, key, key_size);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    ftr-&gt;keymaster_blob_size = key_size;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">out:</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    keymaster_close(keymaster_dev);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    free(key);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    return rc;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">}</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">static int encrypt_master_key(const char *passwd, const unsigned char *salt,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                              const unsigned char *decrypted_master_key,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                              unsigned char *encrypted_master_key,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                              struct crypt_mnt_ftr *crypt_ftr)</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">{<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    unsigned char ikey[32+32] = { 0 }; /* Big enough to hold a 256 bit key and 256 bit IV */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    EVP_CIPHER_CTX e_ctx;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int encrypted_len, final_len;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int rc = 0;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    /* Turn the password into an intermediate key and IV that can decrypt the master key */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    get_device_scrypt_params(crypt_ftr);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    switch (crypt_ftr-&gt;kdf_type) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    case KDF_SCRYPT_KEYMASTER_UNPADDED:</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    case KDF_SCRYPT_KEYMASTER_BADLY_PADDED:</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    case KDF_SCRYPT_KEYMASTER:</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">// 加载并初始化HAL keymaster模块，调用TEE接口得到RSA的公私钥对keymaster_blob</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        if (keymaster_create_key(crypt_ftr)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">            SLOGE("keymaster_create_key failed");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">            return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        // 产生加密密钥KEK</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        if (scrypt_keymaster(passwd, salt, ikey, crypt_ftr)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">            SLOGE("scrypt failed");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">            return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        break;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    case KDF_SCRYPT:</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        if (scrypt(passwd, salt, ikey, crypt_ftr)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">            SLOGE("scrypt failed");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">            return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        break;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    default:</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("Invalid kdf_type");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    </span> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">// 使用前边得到的KEK及IV，采用AES_CBC算法对磁盘加密密钥master_key进行加密<br>    </span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    /* Initialize the decryption engine */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (! EVP_EncryptInit(&amp;e_ctx, EVP_aes_128_cbc(), ikey, ikey+KEY_LEN_BYTES)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("EVP_EncryptInit failed\n");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    EVP_CIPHER_CTX_set_padding(&amp;e_ctx, 0); /* Turn off padding as our data is block aligned */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    /* Encrypt the master key */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (! EVP_EncryptUpdate(&amp;e_ctx, encrypted_master_key, &amp;encrypted_len,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                              decrypted_master_key, KEY_LEN_BYTES)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("EVP_EncryptUpdate failed\n");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (! EVP_EncryptFinal(&amp;e_ctx, encrypted_master_key + encrypted_len, &amp;final_len)) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("EVP_EncryptFinal failed\n");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (encrypted_len + final_len != KEY_LEN_BYTES) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        SLOGE("EVP_Encryption length check failed with %d, %d bytes\n", encrypted_len, final_len);</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">        return -1;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    /* Store the scrypt of the intermediate key, so we can validate if it's a</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">       password error or mount error when things go wrong.</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">       Note there's no need to check for errors, since if this is incorrect, we</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">       simply won't wipe userdata, which is the correct default behavior</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    */</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int N = 1 &lt;&lt; crypt_ftr-&gt;N_factor;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int r = 1 &lt;&lt; crypt_ftr-&gt;r_factor;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    int p = 1 &lt;&lt; crypt_ftr-&gt;p_factor;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    // 对ikey(KEK+IV)进行一次摘要存入分区尾部的crypt_ftr数据结构中，<br>    // 后续验证可对传入的用户密码+分区尾部存储的SALT 采用同样的密钥导出算法，<br>    // 生成加密密钥，并做一次scrypt摘要，将摘要值与之前crypt_ftr存储的进行比较来检验是否一致</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    rc = crypto_scrypt(ikey, KEY_LEN_BYTES,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                       crypt_ftr-&gt;salt, sizeof(crypt_ftr-&gt;salt), N, r, p,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                       crypt_ftr-&gt;scrypted_intermediate_key,</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">                       sizeof(crypt_ftr-&gt;scrypted_intermediate_key));</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    if (rc) {<!-- --></span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">      SLOGE("encrypt_master_key: crypto_scrypt failed");</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    }</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">    return 0;</span> 
<br style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);"> 
<span style="color:rgb(0,0,0);font-family:'Helvetica Neue', Helvetica, 'Microsoft Yahei', 'Hiragino Sans GB', 'WenQuanYi Micro Hei', '微软雅黑', '华文细黑', STHeiti, sans-serif;font-size:15.4px;text-align:left;background-color:rgb(250,250,250);">}</span> 
<br>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ac2234a715d3cfe496c4b2249dd52a49/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">try catch里面try catch嵌套</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1b8e21640e5118ad36b9bdc7c18485de/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">第二十一课  多线程 多进程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>