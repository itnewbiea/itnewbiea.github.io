<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【学习记录21】Vue&#43;ElementUI el-upload多文件上传，一次请求上传多个文件！ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【学习记录21】Vue&#43;ElementUI el-upload多文件上传，一次请求上传多个文件！" />
<meta property="og:description" content="前情回顾说点废话。。。
1、项目当中遇到需要上传多个图片，一次选取多个图片。但是吧el-upload默认只能一个一个传，每次上传成功还的自己去push，一个一个去判断。
2、关键是后台给的接口，要一次性接收一堆，无奈之下只能去网上搜索，大佬们都是给的代码片段无法直接使用。
3、经过各种搬运后实现了效果，闲下来就想着自己写一下我最后在代码中实现方法吧。大家共同学习进步，我也巩固一下知识点！有问题的地方欢迎各位大佬指正！
话不多说直接撸代码！！！
html部分 // :auto-upload=&#34;false&#34; 这一句必须加上，阻止默认上传事件 // :http-request=&#34;BSuploadFile&#34; 上传到服务器的方法 // :before-upload=&#34;beforeUpload&#34; 上传到服务器前校验文件，选择文件的时候不校验，点击“上传到服务器”调用upload()方法的时候执行 // :on-preview=&#34;handlePictureCardPreview&#34; 预览图片 // :on-remove=&#34;BShandleRemove&#34; 删除图片 // :on-change=&#34;changeFileLength&#34; 选择文件后执行 // multiple // :file-list=&#34;BSfileList&#34; &lt;el-upload list-type=&#34;picture-card&#34; class=&#34;upload-demo&#34; action=&#34;&#34; ref=&#34;upload&#34; :auto-upload=&#34;false&#34; :http-request=&#34;BSuploadFile&#34; :before-upload=&#34;beforeUpload&#34; :on-preview=&#34;handlePictureCardPreview&#34; :on-remove=&#34;BShandleRemove&#34; :on-change=&#34;changeFileLength&#34; multiple :file-list=&#34;BSfileList&#34;&gt; &lt;i class=&#34;el-icon-plus&#34;&gt;&lt;/i&gt; &lt;div slot=&#34;tip&#34; class=&#34;el-upload__tip&#34;&gt; 只能上传jpg/png文件，且不超过1Mb &lt;el-button @click=&#34;upload&#34; type=&#34;success&#34;&gt;上传到服务器&lt;/el-button&gt; &lt;/div&gt; &lt;/el-upload&gt; 喏，没选择文件的时候就是下面的样子
选完文件以后是下面的样子
js部分 // 上传到服务器前的校验 beforeUpload(file) { console.log(&#39;上传前：&#39;,file) // 打印出来看一下格式，file流有时候在file.raw中 if (file&amp;&amp;file.type) { const isJPG = (file.type === &#39;image/jpeg&#39; || file." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0eb65e270ff25195cc56a51d93e8302d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-07T14:47:36+08:00" />
<meta property="article:modified_time" content="2023-04-07T14:47:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【学习记录21】Vue&#43;ElementUI el-upload多文件上传，一次请求上传多个文件！</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>前情回顾说点废话。。。</p> 
 <p></p> 
 <p>1、项目当中遇到需要上传多个图片，一次选取多个图片。但是吧el-upload默认只能一个一个传，每次上传成功还的自己去push，一个一个去判断。</p> 
 <p>2、关键是后台给的接口，要一次性接收一堆，无奈之下只能去网上搜索，大佬们都是给的代码片段无法直接使用。</p> 
 <p>3、经过各种搬运后实现了效果，闲下来就想着自己写一下我最后在代码中实现方法吧。大家共同学习进步，我也巩固一下知识点！有问题的地方欢迎各位大佬指正！</p> 
 <p></p> 
 <p>话不多说直接撸代码！！！</p> 
</blockquote> 
<h2>html部分</h2> 
<pre><code class="language-html">//  :auto-upload="false"    这一句必须加上，阻止默认上传事件     
//  :http-request="BSuploadFile"   上传到服务器的方法
//  :before-upload="beforeUpload" 上传到服务器前校验文件，选择文件的时候不校验，点击“上传到服务器”调用upload()方法的时候执行
//  :on-preview="handlePictureCardPreview"  预览图片
//  :on-remove="BShandleRemove"  删除图片
//  :on-change="changeFileLength"  选择文件后执行
//  multiple
//  :file-list="BSfileList"
&lt;el-upload
              list-type="picture-card"
              class="upload-demo"
              action=""
              ref="upload"
              :auto-upload="false"
              :http-request="BSuploadFile"
              :before-upload="beforeUpload"
              :on-preview="handlePictureCardPreview"
              :on-remove="BShandleRemove"
              :on-change="changeFileLength"
              multiple
              :file-list="BSfileList"&gt;
              &lt;i class="el-icon-plus"&gt;&lt;/i&gt;
              &lt;div slot="tip" class="el-upload__tip"&gt;
                只能上传jpg/png文件，且不超过1Mb
                &lt;el-button @click="upload" type="success"&gt;上传到服务器&lt;/el-button&gt;
              &lt;/div&gt;
&lt;/el-upload&gt;</code></pre> 
<p> 喏，没选择文件的时候就是下面的样子</p> 
<p> <img alt="" height="225" src="https://images2.imgbox.com/c3/74/ejogqziZ_o.png" width="408"></p> 
<p> 选完文件以后是下面的样子</p> 
<p><img alt="" height="238" src="https://images2.imgbox.com/00/19/716jye07_o.png" width="553"></p> 
<p></p> 
<h2>js部分</h2> 
<pre><code class="language-javascript">// 上传到服务器前的校验
beforeUpload(file) {
        console.log('上传前：',file)
// 打印出来看一下格式，file流有时候在file.raw中
        if (file&amp;&amp;file.type) {
          const isJPG = (file.type === 'image/jpeg' || file.type === 'image/png' || file.raw.type === 'image/jpeg' || file.raw.type === 'image/png');
          const isLt1M = file.size / 1024 / 1024 &lt; 1;

          if (!isJPG) {
            this.$message.error('上传头像图片只能是 JPG、PNG 格式!');
          }
          if (!isLt1M) {
            this.$message.error('上传头像图片大小不能超过 1MB!');
          }
          return isJPG &amp;&amp; isLt1M;
        } else {
          this.$message.error('文件格式错误，请检查！');
          return false
        }

},
// 选择文件，修改当前文件列表长度后
changeFileLength(singleFile, fileList){
        console.log('修改当前文件', singleFile, fileList)
        this.filesLength = fileList.length
        this.BSfileList = fileList
},
// 用户点击上传调用
async upload(){
        console.log('点击上传')
        // 触发上传 调用配置 :http-request="BSuploadFile"
        // 即触发 uploadFile函数
        await this.$refs.upload.submit();
        // 上传完成后执行的操作 ...
},
// 自定义上传文件，也就是上传到服务器的方法
BSuploadFile(param) {
        console.log('开始上传')
       

        // 当BSfileList长度等于用户需要上传的文件数时进行上传
        if (this.BSfileList.length == this.filesLength){
          // 创建FormData上传
          let fd = new FormData()
          // 将全部文件添加至FormData中
          this.BSfileList.forEach(file =&gt; {
            // 第一个参数可改，看后台接口接收什么就改成什么。
            // 第二个参数，是没一个文件的文件流，有时候是file，有时候是file.raw
            // 打印出来，根据时间情况来传入。我也不知道为什么，可能是elm版本封装的json格式不一样
            fd.append('file', file.raw)  
          })
          // 配置请求头，基本上所有上传文件用的都是form-data类型
          const config = {
            headers: {
              "Content-Type": "multipart/form-data",
            }
          }
          // 上传文件，看自己怎么用，没封装过ajx就用全局axios
          // this.axost.post("/abc/upload", fd, config).then(res =&gt; {
          multipleTbrandCultureFile(fd, config).then(res =&gt; {
            /*上传成功处理*/
            console.log(res)
            this.form.abcFiles = res.data
          }).catch(err =&gt; {/*报错处理*/});
        }
}
</code></pre> 
<p>改进</p> 
<p>实践出真理，在使用中发现的问题，上面的写法，校验只会出现弹窗，功能不对，优化后的代码如下。</p> 
<pre><code class="language-javascript">

// 自定义上传文件，也就是上传到服务器的方法
BSuploadFile(param) {
    console.log('开始上传')

    // 在此处加上校验
    // 删除html中的:before-upload="beforeUpload"
    const isgo = this.beforeUpload(file.file)
    if (isgo) {

        // 当BSfileList长度等于用户需要上传的文件数时进行上传
        if (this.BSfileList.length == this.filesLength){
          // 创建FormData上传
          let fd = new FormData()
          // 将全部文件添加至FormData中
          this.BSfileList.forEach(file =&gt; {
            // 第一个参数可改，看后台接口接收什么就改成什么。
            // 第二个参数，是没一个文件的文件流，有时候是file，有时候是file.raw
            // 打印出来，根据时间情况来传入。我也不知道为什么，可能是elm版本封装的json格式不一样
            fd.append('file', file.raw)  
          })
          // 配置请求头，基本上所有上传文件用的都是form-data类型
          const config = {
            headers: {
              "Content-Type": "multipart/form-data",
            }
          }
          // 上传文件，看自己怎么用，没封装过ajx就用全局axios
          // this.axost.post("/abc/upload", fd, config).then(res =&gt; {
          multipleTbrandCultureFile(fd, config).then(res =&gt; {
            /*上传成功处理*/
            console.log(res)
            this.form.abcFiles = res.data
          }).catch(err =&gt; {/*报错处理*/});
        }

    }
}


</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c39dad8703afe9936a340ac58e45f1d9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Google Chrome 旧版本下载地址</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f6993d1a13a01145bb172e40d6a2f0ad/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">嵌入式Linux-IMX6ULL开发环境配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>