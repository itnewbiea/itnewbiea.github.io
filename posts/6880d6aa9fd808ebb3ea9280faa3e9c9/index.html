<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Kubernetes搭建 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Kubernetes搭建" />
<meta property="og:description" content="Kubernetes搭建 Kubernetes搭建部署组件介绍K8s 集群架构图k8s控制组件控制平面kube-apiserverkube-schedulerkube-controller-manageretcd k8s运行组件k8s节点容器集容器运行时引擎kubeletkube-proxy k8s 存储组件持久存储容器镜像仓库底层基础架构 kubeadm部署k8skubeadm简介kubeadm安装准备环境要求准备工作 Docker环境安装安装kubeadm安装组件导入镜像 初始化Master执行初始化命令创建配置文件添加flannel网络创建网络查看集群状态查看版本信息查看集群信息删除节点 开启自动补全永久生效 dashboard启动dashboard Kubernetes搭建 部署组件介绍 我们把一个有效的 Kubernetes 部署称为集群。您可以将 Kubernetes 集群可视化为两个部分：
​ 控制平面与计算设备（或称为节点）。每个节点都是其自己的 Linux环境，并且可以是物理机或虚拟机。每个节点都运行由若干容器组成的容器集。
K8s 集群架构图 以下 K8s 架构图显示了 Kubernetes 集群的各部分之间的联系：
k8s控制组件 控制平面 K8s 集群的神经中枢
​ 让我们从 Kubernetes 集群的神经中枢（即控制平面）开始说起。在这里，我们可以找到用于控制集群的 Kubernetes 组件以及一些有关集群状态和配置的数据。这些核心 Kubernetes 组件负责处理重要的工作，以确保容器以足够的数量和所需的资源运行。
​ 控制平面会一直与您的计算机保持联系。集群已被配置为以特定的方式运行，而控制平面要做的就是确保万无一失。
kube-apiserver K8s 集群API，如果需要与您的 Kubernetes 集群进行交互，就要通过 API
​ Kubernetes API 是 Kubernetes 控制平面的前端，用于处理内部和外部请求。API 服务器会确定请求是否有效，如果有效，则对其进行处理。您可以通过 REST 调用、kubectl 命令行界面或其他命令行工具（例如 kubeadm）来访问 API。
kube-scheduler K8s 调度程序，您的集群是否状况良好？如果需要新的容器，要将它们放在哪里？这些是 Kubernetes 调度程序所要关注的问题。
​ 调度程序会考虑容器集的资源需求（例如 CPU 或内存）以及集群的运行状况。随后，它会将容器集安排到适当的计算节点。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6880d6aa9fd808ebb3ea9280faa3e9c9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-01T22:48:35+08:00" />
<meta property="article:modified_time" content="2022-07-01T22:48:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Kubernetes搭建</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Kubernetes搭建</h4> 
 <ul><li><a href="#Kubernetes_1" rel="nofollow">Kubernetes搭建</a></li><li><ul><li><a href="#_4" rel="nofollow">部署组件介绍</a></li><li><ul><li><a href="#K8s__8" rel="nofollow">K8s 集群架构图</a></li><li><a href="#k8s_10" rel="nofollow">k8s控制组件</a></li><li><ul><li><a href="#_11" rel="nofollow">控制平面</a></li><li><a href="#kubeapiserver_18" rel="nofollow">kube-apiserver</a></li><li><a href="#kubescheduler_23" rel="nofollow">kube-scheduler</a></li><li><a href="#kubecontrollermanager_28" rel="nofollow">kube-controller-manager</a></li><li><a href="#etcd_33" rel="nofollow">etcd</a></li></ul> 
    </li><li><a href="#k8s_39" rel="nofollow">k8s运行组件</a></li><li><ul><li><a href="#k8s_40" rel="nofollow">k8s节点</a></li><li><a href="#_46" rel="nofollow">容器集</a></li><li><a href="#_52" rel="nofollow">容器运行时引擎</a></li><li><a href="#kubelet_58" rel="nofollow">kubelet</a></li><li><a href="#kubeproxy_64" rel="nofollow">kube-proxy</a></li></ul> 
    </li><li><a href="#k8s__71" rel="nofollow">k8s 存储组件</a></li><li><ul><li><a href="#_72" rel="nofollow">持久存储</a></li><li><a href="#_77" rel="nofollow">容器镜像仓库</a></li><li><a href="#_81" rel="nofollow">底层基础架构</a></li></ul> 
   </li></ul> 
   </li><li><a href="#kubeadmk8s_89" rel="nofollow">kubeadm部署k8s</a></li><li><ul><li><a href="#kubeadm_91" rel="nofollow">kubeadm简介</a></li><li><a href="#kubeadm_99" rel="nofollow">kubeadm安装准备</a></li><li><ul><li><a href="#_100" rel="nofollow">环境要求</a></li><li><a href="#_111" rel="nofollow">准备工作</a></li></ul> 
    </li><li><a href="#Docker_219" rel="nofollow">Docker环境安装</a></li><li><a href="#kubeadm_247" rel="nofollow">安装kubeadm</a></li><li><ul><li><a href="#_264" rel="nofollow">安装组件</a></li><li><a href="#_286" rel="nofollow">导入镜像</a></li></ul> 
    </li><li><a href="#Master_308" rel="nofollow">初始化Master</a></li><li><ul><li><a href="#_311" rel="nofollow">执行初始化命令</a></li><li><a href="#_322" rel="nofollow">创建配置文件</a></li><li><a href="#flannel_333" rel="nofollow">添加flannel网络</a></li><li><a href="#_567" rel="nofollow">创建网络</a></li><li><a href="#_603" rel="nofollow">查看集群状态</a></li><li><a href="#_626" rel="nofollow">查看版本信息</a></li><li><a href="#_633" rel="nofollow">查看集群信息</a></li><li><a href="#_640" rel="nofollow">删除节点</a></li></ul> 
    </li><li><a href="#_656" rel="nofollow">开启自动补全</a></li><li><ul><li><a href="#_680" rel="nofollow">永久生效</a></li></ul> 
    </li><li><a href="#dashboard_688" rel="nofollow">dashboard</a></li><li><ul><li><a href="#dashboard_998" rel="nofollow">启动dashboard</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Kubernetes_1"></a>Kubernetes搭建</h2> 
<p><img src="https://images2.imgbox.com/b4/dd/P4LBYTgl_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_4"></a>部署组件介绍</h3> 
<p>我们把一个有效的 Kubernetes 部署称为集群。您可以将 Kubernetes 集群可视化为两个部分：</p> 
<p>​ 控制平面与计算设备（或称为节点）。每个节点都是其自己的 Linux环境，并且可以是物理机或虚拟机。每个节点都运行由若干容器组成的容器集。</p> 
<h4><a id="K8s__8"></a>K8s 集群架构图</h4> 
<p>以下 K8s 架构图显示了 Kubernetes 集群的各部分之间的联系：<img src="https://images2.imgbox.com/bb/ae/LQ1sWkXa_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="k8s_10"></a>k8s控制组件</h4> 
<h5><a id="_11"></a>控制平面</h5> 
<p>K8s 集群的神经中枢</p> 
<p>​ 让我们从 Kubernetes 集群的神经中枢（即控制平面）开始说起。在这里，我们可以找到用于<strong>控制集群的 Kubernetes 组件以及一些有关集群状态和配置的数据</strong>。这些核心 Kubernetes 组件负责处理重要的工作，以确保容器以足够的数量和所需的资源运行。</p> 
<p>​ 控制平面会一直与您的计算机保持联系。集群已被配置为以特定的方式运行，而控制平面要做的就是确保万无一失。</p> 
<h5><a id="kubeapiserver_18"></a>kube-apiserver</h5> 
<p>K8s 集群API，如果需要与您的 Kubernetes 集群进行交互，就要通过 API</p> 
<p>​ <strong>Kubernetes API 是 Kubernetes 控制平面的前端，用于处理内部和外部请求</strong>。API 服务器会确定请求是否有效，如果有效，则对其进行处理。您可以通过 REST 调用、kubectl 命令行界面或其他命令行工具（例如 kubeadm）来访问 API。</p> 
<h5><a id="kubescheduler_23"></a>kube-scheduler</h5> 
<p>K8s 调度程序，您的集群是否状况良好？如果需要新的容器，要将它们放在哪里？这些是 Kubernetes 调度程序所要关注的问题。</p> 
<p>​ <strong>调度程序会考虑容器集的资源需求（例如 CPU 或内存）以及集群的运行状况</strong>。随后，它会将容器集安排到适当的计算节点。</p> 
<h5><a id="kubecontrollermanager_28"></a>kube-controller-manager</h5> 
<p><strong>K8s 控制器，控制器负责实际运行集群</strong>，而 Kubernetes 控制器管理器则是将多个控制器功能合而为一</p> 
<p>​ 控制器用于查询调度程序，并确保有正确数量的容器集在运行。如果有容器集停止运行，另一个控制器会发现并做出响应。控制器会将服务连接至容器集，以便让请求前往正确的端点。还有一些控制器用于创建帐户和 API 访问令牌。</p> 
<h5><a id="etcd_33"></a>etcd</h5> 
<p><strong>键值存储数据库</strong></p> 
<p>​ 配置数据以及有关集群状态的信息位于 etcd（一个键值存储数据库）中。etcd 采用分布式、容错设计，被视为集群的最终事实来源。</p> 
<h4><a id="k8s_39"></a>k8s运行组件</h4> 
<h5><a id="k8s_40"></a>k8s节点</h5> 
<p>Kubernetes 集群中至少需要一个计算节点，但通常会有多个计算节点。</p> 
<p>​ 容器集经过调度和编排后，就会在节点上运行。如果需要扩展集群的容量，那就要添加更多的节点。</p> 
<h5><a id="_46"></a>容器集</h5> 
<p>容器集是 Kubernetes 对象模型中最小、最简单的单元。</p> 
<p>​ 它代表了应用的单个实例。每个容器集都由一个容器（或一系列紧密耦合的容器）以及若干控制容器运行方式的选件组成。容器集可以连接至持久存储，以运行有状态应用。</p> 
<h5><a id="_52"></a>容器运行时引擎</h5> 
<p>为了运行容器，每个计算节点都有一个容器运行时引擎。</p> 
<p>​ 比如 Docker，但 Kubernetes 也支持其他符合开源容器运动（OCI）标准的运行时，例如 rkt 和 CRI-O。</p> 
<h5><a id="kubelet_58"></a>kubelet</h5> 
<p>每个计算节点中都包含一个 kubelet，这是一个与控制平面通信的微型应用。</p> 
<p>​ kublet 可确保容器在容器集内运行。当控制平面需要在节点中执行某个操作时，kubelet 就会执行该操作。</p> 
<h5><a id="kubeproxy_64"></a>kube-proxy</h5> 
<p>每个计算节点中还包含 kube-proxy，这是一个用于优化 Kubernetes 网络服务的网络代理。</p> 
<p>​ kube-proxy 负责处理集群内部或外部的网络通信——靠操作系统的数据包过滤层，或者自行转发流量。</p> 
<h4><a id="k8s__71"></a>k8s 存储组件</h4> 
<h5><a id="_72"></a>持久存储</h5> 
<p>除了管理运行应用的容器外，Kubernetes 还可以管理附加在集群上的应用数据。</p> 
<p>​ Kubernetes 允许用户请求存储资源，而无需了解底层存储基础架构的详细信息。持久卷是集群（而非容器集）所特有的，因此其寿命可以超过容器集。</p> 
<h5><a id="_77"></a>容器镜像仓库</h5> 
<p>Kubernetes 所依赖的容器镜像存储于容器镜像仓库中。<br> 这个镜像仓库可以由您自己配置的，也可以由第三方提供。</p> 
<h5><a id="_81"></a>底层基础架构</h5> 
<p>您可以自己决定具体在哪里运行 Kubernetes。</p> 
<p>​ 答案可以是裸机服务器、虚拟机、公共云提供商、私有云和混合云环境。Kubernetes 的一大优势就是它可以在许多不同类型的基础架构上运行。</p> 
<h3><a id="kubeadmk8s_89"></a>kubeadm部署k8s</h3> 
<p><img src="https://images2.imgbox.com/d4/e0/FmAsdxyk_o.png" alt="# "></p> 
<h4><a id="kubeadm_91"></a>kubeadm简介</h4> 
<p>​ kubeadm是Kubernetes项目自带的及集群构建工具，负责执行构建一个最小化的可用集群以及将其启动等的必要基本步骤，kubeadm是Kubernetes集群全生命周期的管理工具，可用于实现集群的部署、升级、降级及拆除。<strong>kubeadm部署Kubernetes集群是将大部分资源以pod的方式运行</strong>，例如（kube-proxy、kube-controller-manager、kube-scheduler、kube-apiserver、flannel)都是以pod方式运行。</p> 
<p><strong>​ Kubeadm仅关心如何初始化并启动集群</strong>，余下的其他操作，例如安装Kubernetes Dashboard、监控系统、日志系统等必要的附加组件则不在其考虑范围之内，需要管理员自行部署。</p> 
<p>​ Kubeadm集成了Kubeadm init和kubeadm join等工具程序，其中kubeadm init用于集群的快速初始化，其核心功能是部署Master节点的各个组件，而kubeadm join则用于将节点快速加入到指定集群中，它们是创建Kubernetes集群最佳实践的“快速路径”。另外，kubeadm token可于集群构建后管理用于加入集群时使用的认证令牌（token)，而kubeadm reset命令的功能则是删除集群构建过程中生成的文件以重置回初始状态。</p> 
<h4><a id="kubeadm_99"></a>kubeadm安装准备</h4> 
<h5><a id="_100"></a>环境要求</h5> 
<ul><li>一台兼容的 Linux 主机。Kubernetes 项目为基于 Debian 和 Red Hat 的 Linux<br> 发行版以及一些不提供包管理器的发行版提供通用的指令</li><li>每台机器 2 GB 或更多的 RAM （如果少于这个数字将会影响你应用的运行内存)</li><li>2 CPU 核或更多</li><li>集群中的所有机器的网络彼此均能相互连接(公网和内网都可以)</li><li>节点之中不可以有重复的主机名、MAC 地址或 product_uuid。请参见这里了解更多详细信息。</li><li>开启机器上的某些端口。请参见这里 了解更多详细信息。</li><li>禁用交换分区。为了保证 kubelet 正常工作，你 必须 禁用交换分区。</li></ul> 
<h5><a id="_111"></a>准备工作</h5> 
<p>下面初始化环境工作master节点和node节点都需要执行</p> 
<p><strong>关闭防火墙</strong></p> 
<pre><code class="prism language-bash">systemctl stop firewalld
systemctl disable firewalld
</code></pre> 
<p><img src="https://images2.imgbox.com/ba/8e/PbxV3qxq_o.png" alt="在这里插入图片描述"><br> <strong>关闭selinux</strong></p> 
<pre><code class="prism language-shell">setenforce <span class="token number">0</span>
<span class="token function">sed</span> -i <span class="token string">'s/^SELINUX=enforcing$/SELINUX=permissive/'</span> /etc/selinux/config
</code></pre> 
<p><img src="https://images2.imgbox.com/47/38/IKd8OP9B_o.png" alt="在这里插入图片描述"><br> <strong>关闭swap</strong></p> 
<pre><code class="prism language-shell">swapoff -a
<span class="token function">sed</span> -i <span class="token string">'s/.*swap.*/#&amp;/'</span> /etc/fstab
</code></pre> 
<p><img src="https://images2.imgbox.com/26/03/WgvD5s2i_o.png" alt="在这里插入图片描述"><br> <strong>时间同步</strong></p> 
<pre><code class="prism language-shell">ntpdate <span class="token number">0</span>.rhel.pool.ntp.org
</code></pre> 
<p><img src="https://images2.imgbox.com/d5/db/yTTtwd7j_o.png" alt="在这里插入图片描述"><br> <strong>修改hostname</strong><br> 其他节点hostname都需要更改</p> 
<pre><code class="prism language-powershell">vi <span class="token operator">/</span>etc/hostname
</code></pre> 
<p>写入</p> 
<pre><code class="prism language-powershell">HOSTNAME=yourhostname
</code></pre> 
<p>保存后执行以下</p> 
<pre><code class="prism language-powershell">hostname yourhostname
</code></pre> 
<p>查看设置后的hostname</p> 
<pre><code class="prism language-powershell">hostname
</code></pre> 
<p><img src="https://images2.imgbox.com/de/31/0NhD8exm_o.png" alt="在这里插入图片描述"><br> <strong>修改host文件</strong><br> 在其他服务节点上都需要更改</p> 
<pre><code class="prism language-powershell">vi <span class="token operator">/</span>etc/hosts
</code></pre> 
<pre><code class="prism language-powershell">127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1   yourhostname localhost localhost<span class="token punctuation">.</span>localdomain localhost4 localhost4<span class="token punctuation">.</span>localdomain4
::1         yourhostname localhost localhost<span class="token punctuation">.</span>localdomain localhost6 localhost6<span class="token punctuation">.</span>localdomain6
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/89/SzKjngB7_o.png" alt="在这里插入图片描述"><br> <strong>host绑定</strong><br> 修改其他节点的hostname后，将域名绑定到hostname中保证其他节点能够通过hostname进行访问其他节点</p> 
<pre><code class="prism language-powershell">vi <span class="token operator">/</span>etc/hosts
</code></pre> 
<pre><code class="prism language-powershell">192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>64<span class="token punctuation">.</span>160   k8s-master
192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>64<span class="token punctuation">.</span>161   k8s-node1
192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>64<span class="token punctuation">.</span>162   k8s-node2
</code></pre> 
<p><img src="https://images2.imgbox.com/08/1d/uiPyCphb_o.png" alt="在这里插入图片描述"><br> 尝试ping其他hostname</p> 
<pre><code class="prism language-powershell">ping k8s-node1
ping k8s-node2
</code></pre> 
<p><img src="https://images2.imgbox.com/72/76/FJmCeppc_o.png" alt="在这里插入图片描述"><br> <strong>配置Iptables规则</strong></p> 
<pre><code class="prism language-powershell"><span class="token function">echo</span> <span class="token string">'net.bridge.bridge-nf-call-iptables = 1'</span> &gt;&gt; <span class="token operator">/</span>etc/sysctl<span class="token punctuation">.</span>conf
<span class="token function">echo</span> 1 &gt; <span class="token operator">/</span>proc/sys/net/bridge/bridge-nf-call-iptables

<span class="token function">echo</span> <span class="token string">"echo 1 &gt; /proc/sys/net/ipv4/ip_forward"</span> &gt;&gt; <span class="token operator">/</span>etc/rc<span class="token punctuation">.</span>d/rc<span class="token punctuation">.</span>local
<span class="token function">echo</span> 1 &gt; <span class="token operator">/</span>proc/sys/net/ipv4/ip_forward
</code></pre> 
<p><img src="https://images2.imgbox.com/26/bc/HzA2EnvQ_o.png" alt="在这里插入图片描述"><br> 如果报</p> 
<pre><code class="prism language-powershell"><span class="token operator">-</span>bash: <span class="token operator">/</span>proc/sys/net/bridge/bridge-nf-call-iptables: No such file or directory
</code></pre> 
<p>先执行</p> 
<pre><code class="prism language-powershell">sudo modprobe br_netfilter
</code></pre> 
<h4><a id="Docker_219"></a>Docker环境安装</h4> 
<p>参考前面章节的Docker安装</p> 
<p>修改daemon.json</p> 
<p>修改docker cgroup driver为systemd</p> 
<p>根据文档CRI installation中的内容，对于使用systemd作为init system的Linux的发行版，使用systemd作为docker的cgroup driver可以确保服务器节点在资源紧张的情况更加稳定，因此这里修改各个节点上docker的cgroup driver为systemd。</p> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token operator">/</span>etc/docker/
sudo <span class="token function">tee</span> <span class="token operator">/</span>etc/docker/daemon<span class="token punctuation">.</span>json &lt;&lt;<span class="token operator">-</span><span class="token string">'EOF'</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string">"exec-opts"</span>: <span class="token punctuation">[</span><span class="token string">"native.cgroupdriver=systemd"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
EOF
</code></pre> 
<p><img src="https://images2.imgbox.com/4b/64/uflRkaEz_o.png" alt="在这里插入图片描述"><br> <strong>启动docker</strong></p> 
<pre><code class="prism language-powershell">systemctl restart docker    <span class="token comment">#启动docker</span>
systemctl enable docker    <span class="token comment">#开机自启动</span>
docker info <span class="token punctuation">|</span>grep Cgroup
</code></pre> 
<h4><a id="kubeadm_247"></a>安装kubeadm</h4> 
<p>master节点和所有node节点都需要执行</p> 
<p>配置kubeadm安装源<br> 在线安装kubeadm，使用阿里的源，本教程使用1.21 （很慢！）</p> 
<pre><code class="prism language-powershell"><span class="token function">cat</span> &lt;&lt;EOF &gt; <span class="token operator">/</span>etc/yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d/kubernetes<span class="token punctuation">.</span>repo
<span class="token namespace">[kubernetes]</span>
name=Kubernetes
baseurl=https:<span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com/kubernetes/yum/repos/kubernetes-el7-x86_64/
enabled=1
gpgcheck=1
repo_gpgcheck=1
gpgkey=https:<span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com/kubernetes/yum/doc/yum-key<span class="token punctuation">.</span>gpg https:<span class="token operator">/</span><span class="token operator">/</span>mirrors<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com/kubernetes/yum/doc/rpm-package-key<span class="token punctuation">.</span>gpg
EOF
</code></pre> 
<h5><a id="_264"></a>安装组件</h5> 
<p>安装kubelat、kubectl、kubeadm</p> 
<pre><code class="prism language-powershell">yum install <span class="token operator">-</span>y kubelet-1<span class="token punctuation">.</span>21<span class="token punctuation">.</span>0 kubeadm-1<span class="token punctuation">.</span>21<span class="token punctuation">.</span>0 kubectl-1<span class="token punctuation">.</span>21<span class="token punctuation">.</span>0 <span class="token operator">--</span>disableexcludes=kubernetes
</code></pre> 
<p><img src="https://images2.imgbox.com/52/df/BdFqXQ9J_o.png" alt="在这里插入图片描述"><br> <strong>查看服务版本</strong></p> 
<pre><code class="prism language-powershell">rpm <span class="token operator">-</span>aq kubelet kubectl kubeadm
</code></pre> 
<p><img src="https://images2.imgbox.com/a6/2c/4Yj4FPHb_o.png" alt="在这里插入图片描述"><br> <strong>将kubelet加入开机启动</strong></p> 
<p>将kubelet加入开机启动，这里刚安装完成不能直接启动。（因为目前还没有集群还没有建立）</p> 
<pre><code class="prism language-powershell">systemctl enable kubelet
</code></pre> 
<h5><a id="_286"></a>导入镜像</h5> 
<p>直接使用离线的镜像文件，在资料下的tar文件夹下</p> 
<p>链接: <a href="https://pan.baidu.com/s/1sC2xhonVPLEmkS53gxm4IQ" rel="nofollow">https://pan.baidu.com/s/1sC2xhonVPLEmkS53gxm4IQ</a> 提取码: 2833</p> 
<p><strong>上传Image镜像</strong><br> 将资料文件夹下的 tar文件上传到centos服务中来<img src="https://images2.imgbox.com/da/d6/2EQNhfei_o.png" alt="在这里插入图片描述"><br> <strong>导入镜像</strong><br> 将上传的镜像导入到docker容器中来</p> 
<pre><code class="prism language-powershell">docker load &lt; coredns<span class="token punctuation">.</span>tar
docker load &lt; etcd<span class="token punctuation">.</span>tar
docker load &lt; ka<span class="token punctuation">.</span>tar
docker load &lt; kcm<span class="token punctuation">.</span>tar
docker load &lt; kp<span class="token punctuation">.</span>tar
docker load &lt; ks<span class="token punctuation">.</span>tar
docker load &lt; pause<span class="token punctuation">.</span>tar
docker load &lt; flannel<span class="token punctuation">.</span>tar
</code></pre> 
<p><img src="https://images2.imgbox.com/6f/71/7YYh95WN_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="Master_308"></a>初始化Master</h4> 
<p>注意：在master节点执行</p> 
<h5><a id="_311"></a>执行初始化命令</h5> 
<pre><code class="prism language-powershell">kubeadm init \
<span class="token operator">--</span>kubernetes-version v1<span class="token punctuation">.</span>21<span class="token punctuation">.</span>0 \
<span class="token operator">--</span>image-repository registry<span class="token punctuation">.</span>aliyuncs<span class="token punctuation">.</span>com/google_containers \
<span class="token operator">--</span>pod-network-cidr=10<span class="token punctuation">.</span>244<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0/16 \
<span class="token operator">--</span>service-cidr=10<span class="token punctuation">.</span>1<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0/16 \
<span class="token operator">--</span>ignore-preflight-errors=Swap
</code></pre> 
<p>执行需要花费一些时间，出现successfully表示初始化成功<img src="https://images2.imgbox.com/2b/12/HLsepxur_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_322"></a>创建配置文件</h5> 
<p>按照上面初始化成功提示创建配置文件</p> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube
sudo <span class="token function">cp</span> <span class="token operator">-</span>i <span class="token operator">/</span>etc/kubernetes/admin<span class="token punctuation">.</span>conf <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube/config
sudo chown $<span class="token punctuation">(</span>id <span class="token operator">-</span>u<span class="token punctuation">)</span>:$<span class="token punctuation">(</span>id <span class="token operator">-</span>g<span class="token punctuation">)</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube/config
<span class="token comment">#我们是root用户启动，所以还需要下面这句</span>
export KUBECONFIG=<span class="token operator">/</span>etc/kubernetes/admin<span class="token punctuation">.</span>conf
</code></pre> 
<p><img src="https://images2.imgbox.com/fd/dc/XDpGATXa_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="flannel_333"></a>添加flannel网络</h5> 
<p>创建flannel配置文件<br> 创建网络，flannel.yml文件在”资料“文件夹里</p> 
<pre><code class="prism language-powershell">vi flannel<span class="token punctuation">.</span>yml
</code></pre> 
<p>文件内容如下</p> 
<pre><code class="prism language-yaml"><span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> policy/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PodSecurityPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> psp.flannel.unprivileged
  <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
    <span class="token key atrule">seccomp.security.alpha.kubernetes.io/allowedProfileNames</span><span class="token punctuation">:</span> docker/default
    <span class="token key atrule">seccomp.security.alpha.kubernetes.io/defaultProfileName</span><span class="token punctuation">:</span> docker/default
    <span class="token key atrule">apparmor.security.beta.kubernetes.io/allowedProfileNames</span><span class="token punctuation">:</span> runtime/default
    <span class="token key atrule">apparmor.security.beta.kubernetes.io/defaultProfileName</span><span class="token punctuation">:</span> runtime/default
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> configMap
  <span class="token punctuation">-</span> secret
  <span class="token punctuation">-</span> emptyDir
  <span class="token punctuation">-</span> hostPath
  <span class="token key atrule">allowedHostPaths</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">pathPrefix</span><span class="token punctuation">:</span> <span class="token string">"/etc/cni/net.d"</span>
  <span class="token punctuation">-</span> <span class="token key atrule">pathPrefix</span><span class="token punctuation">:</span> <span class="token string">"/etc/kube-flannel"</span>
  <span class="token punctuation">-</span> <span class="token key atrule">pathPrefix</span><span class="token punctuation">:</span> <span class="token string">"/run/flannel"</span>
  <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># Users and groups</span>
  <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">supplementalGroups</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token comment"># Privilege Escalation</span>
  <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">defaultAllowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token comment"># Capabilities</span>
  <span class="token key atrule">allowedCapabilities</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'NET_ADMIN'</span><span class="token punctuation">,</span> <span class="token string">'NET_RAW'</span><span class="token punctuation">]</span>
  <span class="token key atrule">defaultAddCapabilities</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token key atrule">requiredDropCapabilities</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token comment"># Host namespaces</span>
  <span class="token key atrule">hostPID</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hostIPC</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
  <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
  <span class="token key atrule">hostPorts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">min</span><span class="token punctuation">:</span> <span class="token number">0</span>
    <span class="token key atrule">max</span><span class="token punctuation">:</span> <span class="token number">65535</span>
  <span class="token comment"># SELinux</span>
  <span class="token key atrule">seLinux</span><span class="token punctuation">:</span>
    <span class="token comment"># SELinux is unused in CaaSP</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> <span class="token string">'RunAsAny'</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'extensions'</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'podsecuritypolicies'</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'use'</span><span class="token punctuation">]</span>
  <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'psp.flannel.unprivileged'</span><span class="token punctuation">]</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">""</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> pods
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">""</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> nodes
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> list
  <span class="token punctuation">-</span> watch
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">""</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> nodes/status
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> patch
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel<span class="token punctuation">-</span>cfg
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> node
    <span class="token key atrule">app</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">cni-conf.json</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    {
      "name": "cbr0",
      "cniVersion": "0.3.1",
      "plugins": [
        {
          "type": "flannel",
          "delegate": {
            "hairpinMode": true,
            "isDefaultGateway": true
          }
        },
        {
          "type": "portmap",
          "capabilities": {
            "portMappings": true
          }
        }
      ]
    }</span>
  <span class="token key atrule">net-conf.json</span><span class="token punctuation">:</span> <span class="token punctuation">|</span><span class="token scalar string">
    {
      "Network": "10.244.0.0/16",
      "Backend": {
        "Type": "vxlan"
      }
    }</span>
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> DaemonSet
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel<span class="token punctuation">-</span>ds
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>system
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">tier</span><span class="token punctuation">:</span> node
    <span class="token key atrule">app</span><span class="token punctuation">:</span> flannel
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">app</span><span class="token punctuation">:</span> flannel
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">tier</span><span class="token punctuation">:</span> node
        <span class="token key atrule">app</span><span class="token punctuation">:</span> flannel
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">affinity</span><span class="token punctuation">:</span>
        <span class="token key atrule">nodeAffinity</span><span class="token punctuation">:</span>
          <span class="token key atrule">requiredDuringSchedulingIgnoredDuringExecution</span><span class="token punctuation">:</span>
            <span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> kubernetes.io/os
                <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
                <span class="token key atrule">values</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> linux
      <span class="token key atrule">hostNetwork</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
      <span class="token key atrule">priorityClassName</span><span class="token punctuation">:</span> system<span class="token punctuation">-</span>node<span class="token punctuation">-</span>critical
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">operator</span><span class="token punctuation">:</span> Exists
        <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> flannel
      <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> install<span class="token punctuation">-</span>cni
        <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/coreos/flannel<span class="token punctuation">:</span>v0.14.0<span class="token punctuation">-</span>rc1
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> cp
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span>f
        <span class="token punctuation">-</span> /etc/kube<span class="token punctuation">-</span>flannel/cni<span class="token punctuation">-</span>conf.json
        <span class="token punctuation">-</span> /etc/cni/net.d/10<span class="token punctuation">-</span>flannel.conflist
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cni
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/cni/net.d
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel<span class="token punctuation">-</span>cfg
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/kube<span class="token punctuation">-</span>flannel/
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel
        <span class="token key atrule">image</span><span class="token punctuation">:</span> quay.io/coreos/flannel<span class="token punctuation">:</span>v0.14.0<span class="token punctuation">-</span>rc1
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> /opt/bin/flanneld
        <span class="token key atrule">args</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>ip<span class="token punctuation">-</span>masq
        <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>kube<span class="token punctuation">-</span>subnet<span class="token punctuation">-</span>mgr
        <span class="token key atrule">resources</span><span class="token punctuation">:</span>
          <span class="token key atrule">requests</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"100m"</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"50Mi"</span>
          <span class="token key atrule">limits</span><span class="token punctuation">:</span>
            <span class="token key atrule">cpu</span><span class="token punctuation">:</span> <span class="token string">"100m"</span>
            <span class="token key atrule">memory</span><span class="token punctuation">:</span> <span class="token string">"50Mi"</span>
        <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
          <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
          <span class="token key atrule">capabilities</span><span class="token punctuation">:</span>
            <span class="token key atrule">add</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"NET_ADMIN"</span><span class="token punctuation">,</span> <span class="token string">"NET_RAW"</span><span class="token punctuation">]</span>
        <span class="token key atrule">env</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAME
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.name
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> POD_NAMESPACE
          <span class="token key atrule">valueFrom</span><span class="token punctuation">:</span>
            <span class="token key atrule">fieldRef</span><span class="token punctuation">:</span>
              <span class="token key atrule">fieldPath</span><span class="token punctuation">:</span> metadata.namespace
        <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> run
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /run/flannel
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel<span class="token punctuation">-</span>cfg
          <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /etc/kube<span class="token punctuation">-</span>flannel/
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> run
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /run/flannel
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> cni
        <span class="token key atrule">hostPath</span><span class="token punctuation">:</span>
          <span class="token key atrule">path</span><span class="token punctuation">:</span> /etc/cni/net.d
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> flannel<span class="token punctuation">-</span>cfg
        <span class="token key atrule">configMap</span><span class="token punctuation">:</span>
          <span class="token key atrule">name</span><span class="token punctuation">:</span> kube<span class="token punctuation">-</span>flannel<span class="token punctuation">-</span>cfg
</code></pre> 
<h5><a id="_567"></a>创建网络</h5> 
<pre><code class="prism language-powershell">kubectl apply <span class="token operator">-</span>f flannel<span class="token punctuation">.</span>yml
</code></pre> 
<p><img src="https://images2.imgbox.com/95/0f/su94cRF4_o.png" alt="在这里插入图片描述"><br> <strong>加入Node节点</strong><br> 在两个node节点都需要执行</p> 
<p><strong>安装kubeadm</strong><br> 参考《安装kubeadm》也需要在从节点执行一遍</p> 
<p><strong>加入集群</strong><br> 主节点输入</p> 
<pre><code class="prism language-powershell"> kubeadm token create <span class="token operator">--</span>print-<span class="token function">join-command</span> <span class="token operator">--</span>ttl 0
</code></pre> 
<p>在子节点上执行加入命令</p> 
<pre><code class="prism language-powershell">kubeadm join 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>64<span class="token punctuation">.</span>159:6443 <span class="token operator">--</span>token i16hg0<span class="token punctuation">.</span>9z9aq1px2mp78fi7 \
        <span class="token operator">--</span>discovery-token-ca-cert-hash sha256:9ec1e3f485191da5a11f42f5d1303fd3f0f3334297e121c62126b72beb6a4643
</code></pre> 
<p><img src="https://images2.imgbox.com/33/c7/eHWWGOuJ_o.png" alt="在这里插入图片描述"><br> <strong>如果出现报错</strong><br> <img src="https://images2.imgbox.com/75/5d/ELow7kvZ_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell">kubeadm reset 
</code></pre> 
<p>然后再执行加入节点的操作即可</p> 
<h5><a id="_603"></a>查看集群状态</h5> 
<p>在master节点输入命令检查集群状态，返回如下结果则集群状态正常</p> 
<pre><code class="prism language-powershell">kubectl get nodes
</code></pre> 
<p><img src="https://images2.imgbox.com/ec/af/q7pUL2ri_o.png" alt="在这里插入图片描述"></p> 
<p>如果报这个错误，先删干净再重新写入配置</p> 
<pre><code class="prism language-powershell"><span class="token function">rm</span> <span class="token operator">-</span>rf <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube
</code></pre> 
<pre><code class="prism language-powershell">mkdir <span class="token operator">-</span>p <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube
sudo <span class="token function">cp</span> <span class="token operator">-</span>i <span class="token operator">/</span>etc/kubernetes/admin<span class="token punctuation">.</span>conf <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube/config
sudo chown $<span class="token punctuation">(</span>id <span class="token operator">-</span>u<span class="token punctuation">)</span>:$<span class="token punctuation">(</span>id <span class="token operator">-</span>g<span class="token punctuation">)</span> <span class="token variable">$HOME</span><span class="token operator">/</span><span class="token punctuation">.</span>kube/config
<span class="token comment">#我们是root用户启动，所以还需要下面这句</span>
export KUBECONFIG=<span class="token operator">/</span>etc/kubernetes/admin<span class="token punctuation">.</span>conf
</code></pre> 
<p>重点查看STATUS内容为Ready时，则说明集群状态正常。<img src="https://images2.imgbox.com/f7/58/iSUHKm3e_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_626"></a>查看版本信息</h5> 
<p>查看集群客户端和服务端程序版本信息</p> 
<pre><code class="prism language-powershell">kubectl version <span class="token operator">--</span>short=true
</code></pre> 
<p><img src="https://images2.imgbox.com/74/27/WgpqfDi9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_633"></a>查看集群信息</h5> 
<pre><code class="prism language-powershell">kubectl cluster-info
</code></pre> 
<p><img src="https://images2.imgbox.com/b3/d1/7E7Yk877_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_640"></a>删除节点</h5> 
<p>有时节点出现故障，需要删除节点，方法如下</p> 
<p><strong>在master节点上执行</strong></p> 
<pre><code class="prism language-powershell">kubectl drain &lt;NODE-NAME&gt; <span class="token operator">--</span>delete-local-<span class="token keyword">data</span> <span class="token operator">--</span>force <span class="token operator">--</span>ignore-daemonsets
kubectl delete node &lt;NODE-NAME&gt;
</code></pre> 
<p><strong>在需要移除的节点上执行</strong></p> 
<pre><code class="prism language-powershell">kubeadm reset
</code></pre> 
<h4><a id="_656"></a>开启自动补全</h4> 
<p>当我们在使用kubectl命令时,如果不能用tab补全,将会非常麻烦,得把命令一个一个敲出来<br> 但是配置自动补全之后就非常方便了</p> 
<p><strong>安装命令</strong><br> 安装bash-completion</p> 
<pre><code class="prism language-powershell">yum install bash-completion <span class="token operator">-</span>y
</code></pre> 
<p><strong>执行命令</strong><br> 执行bash_completion</p> 
<pre><code class="prism language-powershell">source <span class="token operator">/</span>usr/share/bash-completion/bash_completion
</code></pre> 
<p><strong>重新加载</strong><br> 重新加载kubectl completion</p> 
<pre><code class="prism language-powershell">source &lt;<span class="token punctuation">(</span>kubectl completion bash<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_680"></a>永久生效</h5> 
<p>配置永久生效</p> 
<pre><code class="prism language-powershell"><span class="token function">echo</span> <span class="token string">"source &lt;(kubectl completion bash)"</span> &gt;&gt; ~<span class="token operator">/</span><span class="token punctuation">.</span>bashrc
</code></pre> 
<h4><a id="dashboard_688"></a>dashboard</h4> 
<p><strong>创建配置文件</strong></p> 
<pre><code class="prism language-powershell">vi dashboard<span class="token punctuation">.</span>yml
</code></pre> 
<pre><code class="prism language-yaml"><span class="token comment">#</span>
<span class="token comment"># Licensed under the Apache License, Version 2.0 (the "License");</span>
<span class="token comment"># you may not use this file except in compliance with the License.</span>
<span class="token comment"># You may obtain a copy of the License at</span>
<span class="token comment">#</span>
<span class="token comment">#     http://www.apache.org/licenses/LICENSE-2.0</span>
<span class="token comment">#</span>
<span class="token comment"># Unless required by applicable law or agreed to in writing, software</span>
<span class="token comment"># distributed under the License is distributed on an "AS IS" BASIS,</span>
<span class="token comment"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
<span class="token comment"># See the License for the specific language governing permissions and</span>
<span class="token comment"># limitations under the License.</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">443</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">type</span><span class="token punctuation">:</span> NodePort
<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>certs
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>csrf
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque
<span class="token key atrule">data</span><span class="token punctuation">:</span>
  <span class="token key atrule">csrf</span><span class="token punctuation">:</span> <span class="token string">""</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Secret
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>key<span class="token punctuation">-</span>holder
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">type</span><span class="token punctuation">:</span> Opaque

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> ConfigMap
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>settings
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token comment"># Allow Dashboard to get, update and delete Dashboard exclusive secrets.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"secrets"</span><span class="token punctuation">]</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"kubernetes-dashboard-key-holder"</span><span class="token punctuation">,</span> <span class="token string">"kubernetes-dashboard-certs"</span><span class="token punctuation">,</span> <span class="token string">"kubernetes-dashboard-csrf"</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"update"</span><span class="token punctuation">,</span> <span class="token string">"delete"</span><span class="token punctuation">]</span>
    <span class="token comment"># Allow Dashboard to get and update 'kubernetes-dashboard-settings' config map.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"configmaps"</span><span class="token punctuation">]</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"kubernetes-dashboard-settings"</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"update"</span><span class="token punctuation">]</span>
    <span class="token comment"># Allow Dashboard to get metrics.</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"services"</span><span class="token punctuation">]</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"heapster"</span><span class="token punctuation">,</span> <span class="token string">"dashboard-metrics-scraper"</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"proxy"</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">""</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"services/proxy"</span><span class="token punctuation">]</span>
    <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"heapster"</span><span class="token punctuation">,</span> <span class="token string">"http:heapster:"</span><span class="token punctuation">,</span> <span class="token string">"https:heapster:"</span><span class="token punctuation">,</span> <span class="token string">"dashboard-metrics-scraper"</span><span class="token punctuation">,</span> <span class="token string">"http:dashboard-metrics-scraper"</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">]</span>

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
  <span class="token comment"># Allow Metrics Scraper to get metrics from the Metrics server</span>
  <span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"metrics.k8s.io"</span><span class="token punctuation">]</span>
    <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"pods"</span><span class="token punctuation">,</span> <span class="token string">"nodes"</span><span class="token punctuation">]</span>
    <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">"get"</span><span class="token punctuation">,</span> <span class="token string">"list"</span><span class="token punctuation">,</span> <span class="token string">"watch"</span><span class="token punctuation">]</span>

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> ServiceAccount
    <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
    <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
          <span class="token key atrule">image</span><span class="token punctuation">:</span> kubernetesui/dashboard<span class="token punctuation">:</span>v2.2.0
          <span class="token key atrule">imagePullPolicy</span><span class="token punctuation">:</span> Always
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8443</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>auto<span class="token punctuation">-</span>generate<span class="token punctuation">-</span>certificates
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>namespace=kubernetes<span class="token punctuation">-</span>dashboard
            <span class="token punctuation">-</span> <span class="token punctuation">-</span><span class="token punctuation">-</span>token<span class="token punctuation">-</span>ttl=43200
            <span class="token comment"># Uncomment the following line to manually specify Kubernetes API server Host</span>
            <span class="token comment"># If not specified, Dashboard will attempt to auto discover the API server and connect</span>
            <span class="token comment"># to it. Uncomment only if the default does not work.</span>
            <span class="token comment"># - --apiserver-host=http://my-address:port</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>certs
              <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /certs
              <span class="token comment"># Create on-disk volume to store exec logs</span>
            <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp
              <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>volume
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTPS
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8443</span>
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1001</span>
            <span class="token key atrule">runAsGroup</span><span class="token punctuation">:</span> <span class="token number">2001</span>
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>certs
          <span class="token key atrule">secret</span><span class="token punctuation">:</span>
            <span class="token key atrule">secretName</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard<span class="token punctuation">-</span>certs
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>volume
          <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">"kubernetes.io/os"</span><span class="token punctuation">:</span> linux
      <span class="token comment"># Comment the following tolerations if Dashboard must not be deployed on master</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
          <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>
      <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper

<span class="token punctuation">---</span>

<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">revisionHistoryLimit</span><span class="token punctuation">:</span> <span class="token number">10</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">k8s-app</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
      <span class="token key atrule">annotations</span><span class="token punctuation">:</span>
        <span class="token key atrule">seccomp.security.alpha.kubernetes.io/pod</span><span class="token punctuation">:</span> <span class="token string">'runtime/default'</span>
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> dashboard<span class="token punctuation">-</span>metrics<span class="token punctuation">-</span>scraper
          <span class="token key atrule">image</span><span class="token punctuation">:</span> kubernetesui/metrics<span class="token punctuation">-</span>scraper<span class="token punctuation">:</span>v1.0.6
          <span class="token key atrule">ports</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">8000</span>
              <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
          <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
            <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
              <span class="token key atrule">scheme</span><span class="token punctuation">:</span> HTTP
              <span class="token key atrule">path</span><span class="token punctuation">:</span> /
              <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>
            <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
            <span class="token key atrule">timeoutSeconds</span><span class="token punctuation">:</span> <span class="token number">30</span>
          <span class="token key atrule">volumeMounts</span><span class="token punctuation">:</span>
          <span class="token punctuation">-</span> <span class="token key atrule">mountPath</span><span class="token punctuation">:</span> /tmp
            <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>volume
          <span class="token key atrule">securityContext</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowPrivilegeEscalation</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
            <span class="token key atrule">readOnlyRootFilesystem</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
            <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> <span class="token number">1001</span>
            <span class="token key atrule">runAsGroup</span><span class="token punctuation">:</span> <span class="token number">2001</span>
      <span class="token key atrule">serviceAccountName</span><span class="token punctuation">:</span> kubernetes<span class="token punctuation">-</span>dashboard
      <span class="token key atrule">nodeSelector</span><span class="token punctuation">:</span>
        <span class="token key atrule">"kubernetes.io/os"</span><span class="token punctuation">:</span> linux
      <span class="token comment"># Comment the following tolerations if Dashboard must not be deployed on master</span>
      <span class="token key atrule">tolerations</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> node<span class="token punctuation">-</span>role.kubernetes.io/master
          <span class="token key atrule">effect</span><span class="token punctuation">:</span> NoSchedule
      <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> tmp<span class="token punctuation">-</span>volume
          <span class="token key atrule">emptyDir</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<h5><a id="dashboard_998"></a>启动dashboard</h5> 
<pre><code class="prism language-powershell">kubectl apply <span class="token operator">-</span>f yml/dashboard<span class="token punctuation">.</span>yml
</code></pre> 
<p><img src="https://images2.imgbox.com/6a/db/JQ6cwhis_o.png" alt="在这里插入图片描述"><br> <strong>查看启动的端口</strong></p> 
<pre><code class="prism language-powershell">kubectl get services <span class="token operator">--</span>all-namespaces
</code></pre> 
<p><img src="https://images2.imgbox.com/00/9a/0PWe2ayc_o.png" alt="在这里插入图片描述"><br> <strong>访问测试</strong><br> 访问https://192.168.64.159:32428地址进入dashboard界面，因为没有证书，访问需要输入token<img src="https://images2.imgbox.com/4c/2b/3eQXr76A_o.png" alt="在这里插入图片描述"><br> <strong>获取Token</strong><br> 在master执行以下命令来获取Token</p> 
<pre><code class="prism language-powershell">kubectl <span class="token operator">-</span>n kube-system describe $<span class="token punctuation">(</span>kubectl <span class="token operator">-</span>n kube-system get secret <span class="token operator">-</span>n kube-system <span class="token operator">-</span>o name <span class="token punctuation">|</span> grep namespace<span class="token punctuation">)</span> <span class="token punctuation">|</span> grep token
</code></pre> 
<p><img src="https://images2.imgbox.com/f9/0e/D1GYq9PK_o.png" alt="在这里插入图片描述"><br> <strong>访问页面</strong><br> 输入Token后继续访问，这样就可以登录dashboard</p> 
<p><img src="https://images2.imgbox.com/2b/a1/WI6FFlOe_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/26928210109bc3a0bbdbcb09a37ce90b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">git reset --soft 版本回退多了，怎么恢复？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f93bb4ec2b2af8629c2dec4e49e1025a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Skywalking Agent原理剖析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>