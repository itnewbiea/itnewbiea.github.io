<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[605]appium操作多台手机及常见问题汇总 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[605]appium操作多台手机及常见问题汇总" />
<meta property="og:description" content="文章目录 如何区分多台手机appium导致微信聊天记录被清空常见问题汇总问题1问题2问题3问题4问题5问题6问题7问题8问题9问题10问题11 如何区分多台手机 每次启动能不不清除缓存,我每次都要重新登陆账号好麻烦?中文输入为什么是乱码?如果电脑连接了多台设备,但我只想控制指定一台,怎么区分?swip()方法滑动太慢了,有没有更快速的方法滑动? 针对前三个问题,在desired_caps中增加以下四个配置即可解决,此配置同样适用于Appium桌面版的配置.
desired_caps = { &#34;platformName&#34;: &#34;Android&#34;, &#34;platformVersion&#34;: &#34;6.0.1&#34;, &#34;deviceName&#34;: &#34;sansan&#34;,# &#34;appPackage&#34;: &#34;com.immomo.momo&#34;, &#34;appActivity&#34;: &#34;.android.activity.WelcomeActivity&#34;, &#39;unicodeKeyboard&#39;: True, # 使用unicodeKeyboard,即Appiuum自带键盘 &#39;resetKeyboard&#39;: True, # 重新设置系统键盘为Appium自带键盘 &#39;noReset&#39;: True, # 每次启动不重置APP,即不执行清空APP数据操作 &#39;udid&#39;: &#39;be7c2d7f&#39;# 区分多台手机 } 另外再详细说一下最后一项配置,即:
&#39;udid&#39;: &#39;be7c2d7f&#39; 打个比方:
你的电脑上边了连接了三台手机，那么你执行adb devices 会出现三台手机，
那么你的脚本就必须要指定udid 来说明你要控制具体哪一台手机，
如果不指定，也不会同时控制三台，只会默认控制第一台。
udid的value：你输入adb devices 后终端出现的那段字符串如下：
be7c2d7f devcie a38f89f9 devcie c3sji4lw devcie 直接粘贴就好，要控制哪一台就粘贴哪一条。
针对最后一个问题
Appium自带方法中有一个flick()方法
driver.swipe(495, 1530, 495, 433) # 页面只滑动一下 driver.flick(495, 1530, 495, 433) # 页面作匀减速直线运动 swip()方法：按住坐标(495,1530)手指不松，移动到(495,433)，然后松开手指。页面在你手指松开时，就立即静止。类似于你开车到目标点后急刹车…" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7572f5fd04ac90e138fa7d100aa3354c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-30T21:59:05+08:00" />
<meta property="article:modified_time" content="2023-12-30T21:59:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[605]appium操作多台手机及常见问题汇总</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atelier-sulphurpool-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_3" rel="nofollow">如何区分多台手机</a></li><li><a href="#appium_56" rel="nofollow">appium导致微信聊天记录被清空</a></li><li><a href="#_75" rel="nofollow">常见问题汇总</a></li><li><ul><li><a href="#1_76" rel="nofollow">问题1</a></li><li><a href="#2_86" rel="nofollow">问题2</a></li><li><a href="#3_91" rel="nofollow">问题3</a></li><li><a href="#4_102" rel="nofollow">问题4</a></li><li><a href="#5_107" rel="nofollow">问题5</a></li><li><a href="#6_112" rel="nofollow">问题6</a></li><li><a href="#7_117" rel="nofollow">问题7</a></li><li><a href="#8_122" rel="nofollow">问题8</a></li><li><a href="#9_132" rel="nofollow">问题9</a></li><li><a href="#10_141" rel="nofollow">问题10</a></li><li><a href="#11_181" rel="nofollow">问题11</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_3"></a>如何区分多台手机</h3> 
<ul><li>每次启动能不不清除缓存,我每次都要重新登陆账号好麻烦?</li><li>中文输入为什么是乱码?</li><li>如果电脑连接了多台设备,但我只想控制指定一台,怎么区分?</li><li>swip()方法滑动太慢了,有没有更快速的方法滑动?</li></ul> 
<p>针对前三个问题,在desired_caps中增加以下四个配置即可解决,此配置同样适用于Appium桌面版的配置.</p> 
<pre><code>desired_caps = {
            "platformName": "Android",
            "platformVersion": "6.0.1",
            "deviceName": "sansan",#
            "appPackage": "com.immomo.momo",
            "appActivity": ".android.activity.WelcomeActivity",
            'unicodeKeyboard': True,  # 使用unicodeKeyboard,即Appiuum自带键盘
            'resetKeyboard': True,  # 重新设置系统键盘为Appium自带键盘
            'noReset': True, # 每次启动不重置APP,即不执行清空APP数据操作
            'udid': 'be7c2d7f'# 区分多台手机
}
</code></pre> 
<p>另外再详细说一下最后一项配置,即:</p> 
<pre><code>'udid': 'be7c2d7f' 
</code></pre> 
<p>打个比方:</p> 
<p>你的电脑上边了连接了三台手机，那么你执行<code>adb devices</code> 会出现三台手机，</p> 
<p>那么你的脚本就必须要指定udid 来说明你要控制具体哪一台手机，</p> 
<p>如果不指定，也不会同时控制三台，只会默认控制第一台。</p> 
<p>udid的value：你输入<code>adb devices</code> 后终端出现的那段字符串如下：</p> 
<pre><code>be7c2d7f  devcie
a38f89f9  devcie
c3sji4lw  devcie
</code></pre> 
<p>直接粘贴就好，要控制哪一台就粘贴哪一条。</p> 
<p><strong>针对最后一个问题</strong><br> Appium自带方法中有一个flick()方法</p> 
<pre><code>driver.swipe(495, 1530, 495, 433) # 页面只滑动一下
driver.flick(495, 1530, 495, 433) # 页面作匀减速直线运动
</code></pre> 
<p>swip()方法：按住坐标(495,1530)手指不松，移动到(495,433)，然后松开手指。页面在你手指松开时，就立即静止。类似于你开车到目标点后急刹车…</p> 
<p>flick()方法：按住坐标(495,1530)手指慢慢松开，甩到(495,433)，页面在你手指离开后，作匀减速直线运动继续滑动。似于你开车到目标点后挂空挡慢慢溜…</p> 
<h3><a id="appium_56"></a>appium导致微信聊天记录被清空</h3> 
<p>用自己的手机测试appium，一启动微信程序后，微信聊天记录全被清除了！</p> 
<p><strong>原因</strong>：用appium启动微信时，没有设置“不重置应用”，正确做法是增加appium配置"noReset" : True。</p> 
<p>清除的记录是找不回来的了，因为已从存储器中删除。</p> 
<p>解决方案：</p> 
<pre><code>{
  "platformName": "Android",
  "deviceName": "MI_5",
  "appPackage": "com.tencent.mm",
  "appActivity": ".ui.LauncherUI",
  "noReset" : True
}
</code></pre> 
<h3><a id="_75"></a>常见问题汇总</h3> 
<h4><a id="1_76"></a>问题1</h4> 
<blockquote> 
 <p>selenium.common.exceptions.WebDriverException: Message: An unknown server-side error occurred while processing the command. Original error: Could not proxy command to remote server. Original error: Error: socket hang up</p> 
</blockquote> 
<p>解决方案：添加：</p> 
<pre><code>desired_caps['newCommandTimeout'] =6000

self.driver.implicitly_wait(15)
</code></pre> 
<h4><a id="2_86"></a>问题2</h4> 
<blockquote> 
 <p>Try to increase the 90000ms adb execution timeout represented by ‘adbExecTimeout’ capability</p> 
</blockquote> 
<p>解决方案：添加：<code>desired_caps['adbExecTimeout'] =200000</code></p> 
<h4><a id="3_91"></a>问题3</h4> 
<blockquote> 
 <p>error: The instrumentation process cannot be initialized. Make sure the application under test does not crash and investigate the logcat output.</p> 
</blockquote> 
<p>解决方案：</p> 
<p>需要用命令卸载Appium Settings</p> 
<pre><code>adb uninstall io.appium.uiautomator2.server.test
</code></pre> 
<p>然后在重新执行就可以了。</p> 
<h4><a id="4_102"></a>问题4</h4> 
<blockquote> 
 <p>Adb connection Error:远程主机强迫关闭了一个现有的连接。Connection attempts: 1</p> 
</blockquote> 
<p>解决方法：原因是DDMS 调用 adb 引发的。经过一番搜索，发现这是 Windows 环境下，adb 的一个限制，也可以说是 bug。当手机上同时运行的进程数大于 64 时, 就会引发 adb 奔溃。更深层次的原因，就是 Windows API 的 WaitForMultipleObjects 所支持的最大句柄数是 MAXIMUM_WAIT_OBJECTS，即 64。需要换一个支持进程数更大的adb，百度网盘下载地址：https://pan.baidu.com/s/1uBXl8h4VTFho3fyUlnai_Q，下载后替换\sdk\platform-tools的三个文件重启appium即可。</p> 
<h4><a id="5_107"></a>问题5</h4> 
<blockquote> 
 <p>(Original error: Remote install failed: Failure [INSTALL_FAILED_USER_RESTRICTED: Install canceled by user])</p> 
</blockquote> 
<p>解决方法：问题是安装被用户取消，使用adb连接手机，手机需要在开发者选项中打开允许USB安装（具体手机可以百度怎么打开这个选项）</p> 
<h4><a id="6_112"></a>问题6</h4> 
<blockquote> 
 <p>Original error: Could not extract PIDs from ps output. PIDS: [], Procs: [“ps: uiautomator”]</p> 
</blockquote> 
<p>解决办法：因为appium服务用的是1.4.x版本，使用的是 uiatumator1.0在android7.0得不到支持，所以获取PIDS得到空。找到Appium安装目录下node_modules\appium\node_modules\appium-adb\lib\adb.js文件，修改在<code>var outlines = stdout.split("\n");</code>这行代码下方增加<code>outlines.shift();</code>，注意有分号，然后重启appium即可。</p> 
<h4><a id="7_117"></a>问题7</h4> 
<blockquote> 
 <p>A new session could not be created. (Original error: Command failed: C:\Windows\system32\cmd.exe /s /c “E:\Rocheng\ADT-bundle\sdk\platform-tools\adb.exe -s 5b30ee87 shell “ps ‘uiautomator’””) (WARNING: The server did not provide any stacktrace information)</p> 
</blockquote> 
<p>解决办法：参考：https://blog.csdn.net/pjl6523853/article/details/72886048</p> 
<h4><a id="8_122"></a>问题8</h4> 
<blockquote> 
 <p>Appium连接手机时报权限错误 requires:android.permission.WRITE_SECURE_SETTINGS</p> 
</blockquote> 
<p>我所遇到的问题：</p> 
<pre><code>Encountered internal error running command: Error executing adbExec. Original error: ‘Command ‘‘D:\Program Files\Android\android-sdk\platform-tools\adb.exe’ -P 5037 -s 6992c44f install -g ‘C:\Program Files\Appium\resources\app\node_modules\appium\node_modules\io.appium.settings\apks\settings_apk-debug.apk’’ exited with code 1’; Stderr: ‘adb: failed to install C:\Program Files\Appium\resources\app\node_modules\appium\node_modules\io.appium.settings\apks\settings_apk-debug.apk: Failure [INSTALL_FAILED_USER_RESTRICTED: Install canceled by user]’; Code: ‘1’
[W3C] Error: Command '‘D:\Program Files\Android\android-sdk\platform-tools\adb.exe’ -P 5037 -s 6992c44f install -g 'C:\Program
</code></pre> 
<p>简单理解就是安装不了settings_apk-debug.apk，要开启允许usb安装应用的权限，在开发者那开启</p> 
<h4><a id="9_132"></a>问题9</h4> 
<blockquote> 
 <p>Appium 进行自动化几分钟后就出现 Could not proxy command to remote server.ADB</p> 
</blockquote> 
<p>目前的解决办法：以华为手机为例，打开设置，找到启动管理（有的在应用和通知中，有的在电池中）把io.appium.uiautomator2.server 和io.appium.uiautomator2.server.test 等与appium相关的程序，自动管理改成手动管理<br> <img src="https://images2.imgbox.com/be/9d/vrYJqt0T_o.png" alt=""></p> 
<p>如果运行一段时间再出现问题，就看一下电池配置，位置在 设置 -&gt; 电池 -&gt; 后台高耗电， 把 appium 相关的app都加上，允许其在后台高耗电时继续运行，然后再运行appium 自动化测试<br> <img src="https://images2.imgbox.com/e2/29/6bp1G8Xq_o.png" alt=""></p> 
<h4><a id="10_141"></a>问题10</h4> 
<p>问题： 环境使用Python执行appium自动化脚本运行夜神模拟器上的app的时候报错，具体错误信息如下：</p> 
<pre><code>selenium.common.exceptions.WebDriverException: Message: An unknown server-side error occurred while processing the command. Original error: The instrumentation process cannot be initialized. Make sure the application under test does not crash and investigate the logcat output.
Stacktrace:
UnknownError: An unknown server-side error occurred while processing the command. Original error: The instrumentation process cannot be initialized. Make sure the application under test does not crash and investigate the logcat output.
    at getResponseForW3CError (D:\Program Files\nodejs\node_global\node_modules\appium\node_modules\appium-base-driver\lib\protocol\errors.js:804:9)
    at asyncHandler (D:\Program Files\nodejs\node_global\node_modules\appium\node_modules\appium-base-driver\lib\protocol\protocol.js:392:37)
</code></pre> 
<p>原因：因为google服务的问题把夜神模拟器删除了以后重新装了，结果Appium服务运行的核心文件Appium Settings就被之前代码里desired_caps中的这一行"skipServerInstallation": "true"执行后跳过 Appium 服务器的安装，所以没有这个文件脚本运行的时候appium日志就会报错导致脚本运行也报错执行失败。</p> 
<pre><code>
desired_caps = {
    "deviceName": "127.0.0.1:62001",
    "app": r"D:\Program Files\PycharmProjects\app_pytest_framework\app\xxxx.apk",
    "appPackage": "xxxx",
    "appActivity": "xxxx",
    "platformName": "Android",
    "noSign": "true",
    "noReset": "true",
    "resetKeyboard": "true",
    "unicodeKeyboard": "true",
    "connectHardwareKeyboard": "true",
    "ensureWebviewsHavePages": "true",
    "nativeWebScreenshot": "true",
    "skipDeviceInitialization": "true",
    "skipServerInstallation": "true", #跳过 Appium 服务器的安装，ture为是false为否
    "platformVersion": "7.1.2",
    "newCommandTimeout": 240,
    "automationName": "UiAutomator2"
}
# 打开配置字典中指定的 app
driver = webdriver.Remote("http://127.0.0.1:4723/wd/hub", desired_caps)
</code></pre> 
<p>解决：废话不多说，直接看解决方案，将true改为false，或者直接将这行代码删除，再次运行脚本就成功解决了！</p> 
<pre><code>"skipServerInstallation": "false"
</code></pre> 
<h4><a id="11_181"></a>问题11</h4> 
<blockquote> 
 <p>Appium 启动时报错：Encountered internal error running command: Error: Cannot verify the signature of</p> 
</blockquote> 
<pre><code>Caused by: org.openqa.selenium.WebDriverException: An unknown server-side error occurred while processing the command. Original error: Cannot verify the signature of ‘/Applications/Appium.app/Contents/Resources/app/node_modules/appium/node_modules/appium-uiautomator2-server/apks/appium-uiautomator2-server-v4.21.1.apk’. Original error: Error: A JNI error has occurred, please check your installation and try again
Exception in thread “main” java.lang.UnsupportedClassVersionError: com/android/apksigner/ApkSignerTool has been compiled by a more recent version of the Java Runtime (class file version 53.0), this version of the Java Runtime only recognizes class file versions up to 52.0
</code></pre> 
<p>解决：30版本开始build-tools配合jdk1.8会报错，所以需要手动降级到29版本，把bulid-tools里面大于30的版本删掉，即可解决。</p> 
<p>参考：https://blog.csdn.net/it1988888/article/details/102265204<br> https://blog.csdn.net/weixin_28863779/article/details/112507753</p> 
<p>问题参考：https://www.jianshu.com/p/adc685d0ce15<br> https://blog.csdn.net/ouyanggengcheng/article/details/85165553<br> https://blog.csdn.net/weixin_43845191/article/details/108436848<br> https://blog.csdn.net/xl_lx/article/details/78717898<br> https://www.jianshu.com/p/55b1af12c075<br> https://blog.csdn.net/weixin_43288473/article/details/131565884<br> https://blog.csdn.net/weixin_45508657/article/details/131531906</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/382ba4df51a3fdd01110c4163a14d1f5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于蚁剑（AntSword）的溯源反制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/17e2427ff7b958818842bc65404df420/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[1253].class文件转换为.java文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>