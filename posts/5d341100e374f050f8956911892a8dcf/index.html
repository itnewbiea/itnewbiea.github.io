<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pinia简单介绍与使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pinia简单介绍与使用" />
<meta property="og:description" content="依据Pinia官方文档，Pinia是2019年由vue.js官方成员重新设计的新一代状态管理器，更替Vuex4成为Vuex5。
1 pinia特点 兼容vue2和vue3版本删除mutations现不能与vuex 混用支持插件扩展功能支持模块热更新无需加载页面可以修改容器，可以保持任何现有的状态更完美TS支持支持服务端渲染 2 基本使用 首先我们先安装
npm install pinia 在main.js中引入pinia并创建容器挂载到根实例上
import { createPinia } from &#39;pinia&#39; const pinia = createPinia() // 挂载 createApp(App).use(pinia).mount(&#39;#app&#39;) 创建store/index.js
容器名称 要确保唯一性 将来把所有容器挂载到隔壁容器上 根据唯一的值来获取当前容器 类似于对象的key
import { defineStore } from &#34;pinia&#34; // 定义容器 export const useMain = defineStore(&#39;useStore&#39;, { /** * 存储全局状态 * 1.必须是箭头函数: 为了在服务器端渲染的时候避免交叉请求导致数据状态污染 * 和 TS 类型推导 */ state: () =&gt; { return { count: 0, list: [1, 2, 3, 4 ] } }, /** * 用来封装计算属性 有缓存功能 类似于computed */ getters: { }, /** * 编辑业务逻辑 类似于methods */ actions: { } }) 页面使用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5d341100e374f050f8956911892a8dcf/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-19T12:02:06+08:00" />
<meta property="article:modified_time" content="2022-02-19T12:02:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pinia简单介绍与使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>依据Pinia官方文档，Pinia是2019年由vue.js官方成员重新设计的新一代状态管理器，更替Vuex4成为Vuex5。</p> 
<h3><a id="1_pinia_7"></a>1 pinia特点</h3> 
<ul><li>兼容vue2和vue3版本</li><li>删除mutations</li><li>现不能与vuex 混用</li><li>支持插件扩展功能</li><li>支持模块热更新无需加载页面可以修改容器，可以保持任何现有的状态</li><li>更完美TS支持</li><li>支持服务端渲染</li></ul> 
<h3><a id="2__17"></a>2 基本使用</h3> 
<p>首先我们先安装</p> 
<pre><code class="prism language-js">npm install pinia
</code></pre> 
<p>在main.js中引入pinia并创建容器挂载到根实例上</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">const</span> pinia <span class="token operator">=</span> <span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// 挂载</span>
<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>pinia<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre> 
<p>创建store/index.js<br> 容器名称 要确保唯一性 将来把所有容器挂载到隔壁容器上 根据唯一的值来获取当前容器 类似于对象的key</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> defineStore <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"pinia"</span> <span class="token comment">// 定义容器</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> useMain <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token string">'useStore'</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
  <span class="token comment">/**
   * 存储全局状态
   * 1.必须是箭头函数: 为了在服务器端渲染的时候避免交叉请求导致数据状态污染
   * 和 TS 类型推导
  */</span>
  <span class="token function-variable function">state</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * 用来封装计算属性 有缓存功能  类似于computed
   */</span>
  getters<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">/**
   * 编辑业务逻辑  类似于methods
   */</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>

  <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>页面使用</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> useMain <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../store'</span> <span class="token comment">// 引入store</span>

<span class="token keyword">const</span> useStoreMain <span class="token operator">=</span> <span class="token function">useMain</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>greetings<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>green<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{ useStoreMain.count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>我们这里可以直接结构出想要的数据，但是数据会出现无法实现响应式问题，官方使用的API reactive 使state数据生成响应式。 对于这种情况我们可以这样做</p> 
<pre><code class="prism language-js"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> storeToRefs <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>

<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> count <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">storeToRefs</span><span class="token punctuation">(</span><span class="token function">useStore</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>引用官方API storeToRef 作用就是把结构的数据使用ref做代理</p> 
<h3><a id="3__90"></a>3 属性</h3> 
<h4><a id="31_state_91"></a>3.1 state</h4> 
<p>存储全局状态类似于组件中的data</p> 
<blockquote> 
 <p>注意state必须是箭头函数：为了在服务端渲染的时候避免交叉请求导致数据污染，有利于TS类型推导</p> 
</blockquote> 
<p>使用上面有介绍</p> 
<pre><code class="prism language-javaScript">state: () =&gt; {
  return {
    count: 0,
    list: [ 1, 2, 3 ]
  }
}
</code></pre> 
<p>对比vuex</p> 
<pre><code class="prism language-javaScript">const state = () =&gt; ({
  count: 0,
  list: [ 1, 2, 3 ]
})
</code></pre> 
<h4><a id="32_getter_115"></a>3.2 getter</h4> 
<p>封装计算属性 有缓存功能 类似于computed<br> 对比与vuex，pinia中的getters只是在幕后做计算,不能传递任何参数，但是可以使用getter返回一个函数接受任何参数</p> 
<pre><code class="prism language-js">getters<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">getNum</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> state<span class="token punctuation">.</span>count <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token comment">// return  this.count + 1</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这里需要传入state才能拿到数据，可以直接使用state和this效果是一样的</p> 
<p>和计算属性一样的是你可以写很多getter通过this来直接访问依据官网文档</p> 
<pre><code class="prism language-js">getters<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function-variable function">doubleCount</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>counter <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token function">doubleCountPlusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>doubleCount <span class="token operator">+</span> <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<p>页面使用</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ useStoreMain.getNum }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>

// vuex中使用getters
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{ store.getters.getNum }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="33_actions_150"></a>3.3 actions</h4> 
<pre><code class="prism language-js">actions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">addList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>count <span class="token operator">++</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这里我们获取state里数据是不需要传入直接使用this,actions 方法可以互相调用直接使用this</p> 
<p>如果我们批量更改数据建议使用$patch方法，这样我们可以优化性能</p> 
<pre><code class="prism language-js">useStoreMain<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  	count<span class="token operator">:</span> useStoreMain<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
 
<span class="token comment">// $patch 支持函数</span>

useStoreMain<span class="token punctuation">.</span><span class="token function">$patch</span><span class="token punctuation">(</span><span class="token parameter">state</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// state 就是容器</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// actions 更改多个数据 也建议使用$patch</span>
</code></pre> 
<p>对比于VueX</p> 
<ul><li>Action 提交的是 mutation，而不是直接变更状态。</li><li>Action 可以包含任意异步操作。</li></ul> 
<p>下面引用的官方的例子</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> store <span class="token operator">=</span> <span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  state<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    count<span class="token operator">:</span> <span class="token number">0</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mutations<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      state<span class="token punctuation">.</span>count<span class="token operator">++</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  actions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">increment</span> <span class="token punctuation">(</span><span class="token parameter">context</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      context<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'increment'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>action触发需要通过dispatch方法触发，比于Pinia是不是感觉Pinia简单很多</p> 
<p>以下就不对VueX中action做过多介绍 请参官方<a href="https://vuex.vuejs.org/zh/" rel="nofollow">Vuex</a></p> 
<h3><a id="4__206"></a>4 数据持久化</h3> 
<p>pinia支持扩展插件</p> 
<p>我们想实现数据持久化</p> 
<pre><code class="prism language-npm">npm i pinia-plugin-persist
</code></pre> 
<pre><code class="prism language-js"><span class="token keyword">export</span> <span class="token keyword">const</span> useUserStore <span class="token operator">=</span> <span class="token function">defineStore</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  <span class="token function">state</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
      count<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      num<span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span>
      list<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span> <span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  persist<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启缓存  默认会存储在本地localstorage</span>
    storage<span class="token operator">:</span> sessionStorage<span class="token punctuation">,</span> <span class="token comment">// 缓存使用方式</span>
    paths<span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 需要缓存键 </span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>我们实际页面缓存</p> 
<p><img src="https://images2.imgbox.com/57/f0/W2ONYOvL_o.png" alt=""></p> 
<h4><a id="53__239"></a>5.3 更多文档</h4> 
<p>更多文档请参考 <a href="https://pinia.vuejs.org/" rel="nofollow">Pinia 主页</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7e36a497ab138bc2f144827786783850/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Layui中弹出层关闭后但是弹出层中的内容依然显示在页面上，没有消失</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b1a77da6f3a01c2070bf924a58a16326/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java中double类型比较大小或相等的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>