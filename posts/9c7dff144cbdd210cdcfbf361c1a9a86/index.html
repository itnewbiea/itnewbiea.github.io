<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>json与数据库 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="json与数据库" />
<meta property="og:description" content="public class FragmentListView extends Fragment { private PullToRefreshListView refreshListView; private List&lt;DataDataBean.ResultsBean&gt; list = new ArrayList&lt;&gt;();//记录当前展示的所有数据 private ListViewAdapter listViewAdapter; private int page_num = 1; private ILoadingLayout startLabels; private JsonDao jsonDao; @Nullable @Override public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) { View view = inflater.inflate(R.layout.fragment_listview_layout,container,false); refreshListView = view.findViewById(R.id.refresh_list_view); return view; } /** * 使用数据库做一个数据的缓存 * @param savedInstanceState */ @Override public void onActivityCreated(@Nullable Bundle savedInstanceState) { super.onActivityCreated(savedInstanceState); jsonDao = new JsonDao(getContext()); //1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9c7dff144cbdd210cdcfbf361c1a9a86/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-10-26T10:13:20+08:00" />
<meta property="article:modified_time" content="2017-10-26T10:13:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">json与数据库</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    public class FragmentListView extends Fragment { 
<br> 
<br>     private PullToRefreshListView refreshListView; 
<br>     private List&lt;DataDataBean.ResultsBean&gt; list = new ArrayList&lt;&gt;();//记录当前展示的所有数据 
<br>     private ListViewAdapter listViewAdapter; 
<br>     private int page_num = 1; 
<br>     private ILoadingLayout startLabels; 
<br>     private JsonDao jsonDao; 
<br> 
<br>     @Nullable 
<br>     @Override 
<br>     public View onCreateView(LayoutInflater inflater, @Nullable ViewGroup container, @Nullable Bundle savedInstanceState) { 
<br>         View view = inflater.inflate(R.layout.fragment_listview_layout,container,false); 
<br> 
<br> 
<br>         refreshListView = view.findViewById(R.id.refresh_list_view); 
<br> 
<br>         return view; 
<br>     } 
<br> 
<br>     /** 
<br>      * 使用数据库做一个数据的缓存 
<br>      * @param savedInstanceState 
<br>      */ 
<br>     @Override 
<br>     public void onActivityCreated(@Nullable Bundle savedInstanceState) { 
<br>         super.onActivityCreated(savedInstanceState); 
<br> 
<br>         jsonDao = new JsonDao(getContext()); 
<br>         //1.先读取数据库中存的数据....有数据,解析展示....无数据,网络获取数据 
<br>         String json = jsonDao.getJson("http://gank.io/api/data/Android/10/" + page_num); 
<br>         if (json != null){ 
<br>             //解析 显示 
<br> 
<br>             Gson gson = new Gson(); 
<br> 
<br>             DataDataBean dataDataBean = gson.fromJson(json, DataDataBean.class); 
<br> 
<br>             //往后面添加... 
<br>             list.addAll(dataDataBean.getResults()); 
<br> 
<br>             //设置适配器 
<br>             setAdapter(); 
<br> 
<br>         }else { 
<br>             //1.设置listView的适配器 
<br>             getDataFromNet(); 
<br>         } 
<br> 
<br> 
<br> 
<br> 
<br>         //2.设置刷新模式 
<br>         /*设置pullToRefreshListView的刷新模式，BOTH代表支持上拉和下拉，PULL_FROM_END代表上拉,PULL_FROM_START代表下拉 */ 
<br>         refreshListView.setMode(PullToRefreshBase.Mode.BOTH); 
<br> 
<br>         //3.通过getLoadingLayoutProxy 方法来指定上拉和下拉时显示的状态的区别(也就是设置向下拉的时候头部里面显示的文字) 
<br>         //此时这里设置的是下拉刷新的时候显示的文字,所以第一个设置true表示现在是刷新,第二个设置为false 
<br>         startLabels = refreshListView.getLoadingLayoutProxy(true, false); 
<br>         startLabels.setPullLabel("下拉刷新"); 
<br>         startLabels.setRefreshingLabel("正在刷新..."); 
<br>         startLabels.setReleaseLabel("放开刷新"); 
<br> 
<br>         ILoadingLayout endLabels = refreshListView.getLoadingLayoutProxy(false, true); 
<br>         endLabels.setPullLabel("上拉刷新"); 
<br>         endLabels.setRefreshingLabel("正在载入..."); 
<br>         endLabels.setReleaseLabel("放开刷新..."); 
<br> 
<br> 
<br>         //4.设置监听事件 
<br>         /** 
<br>          * 如果Mode设置成Mode.BOTH，需要设置刷新Listener为OnRefreshListener2，并实现onPullDownToRefresh()、 
<br>          * onPullUpToRefresh()两个方法。 
<br>          如果Mode设置成Mode.PULL_FROM_START或Mode.PULL_FROM_END，需要设置刷新Listener为OnRefreshListener， 
<br>          同时实现onRefresh()方法。 
<br>          当然也可以设置为OnRefreshListener2，但是Mode.PULL_FROM_START的时候只调用onPullDownToRefresh()方法， 
<br>          Mode.PULL_FROM_END的时候只调用onPullUpToRefresh()方法 
<br>          */ 
<br>         refreshListView.setOnRefreshListener(new PullToRefreshBase.OnRefreshListener2&lt;ListView&gt;() { 
<br>             //下拉刷新的时候调用的方法....请求第一页的数据,清空之前的数据,然后再添加设置适配器 
<br>             @Override 
<br>             public void onPullDownToRefresh(PullToRefreshBase&lt;ListView&gt; refreshView) { 
<br>                 //下拉刷新....请求第一页的数据,清空之前的数据,然后再添加设置适配器 
<br>                 getRefreshData(); 
<br> 
<br> 
<br>             } 
<br> 
<br>             //上拉刷新的时候调用的方法..page++,然后在请求数据 
<br>             @Override 
<br>             public void onPullUpToRefresh(PullToRefreshBase&lt;ListView&gt; refreshView) { 
<br> 
<br>                 //上拉刷新/加载...加载的时候页数++ 
<br>                 page_num++; 
<br>                 getDataFromNet(); 
<br> 
<br> 
<br>             } 
<br>         }); 
<br> 
<br>     } 
<br> 
<br>     /** 
<br>      * 下拉刷新获取数据 
<br>      */ 
<br>     private void getRefreshData() { 
<br>         NetDataUtil.getData("http://gank.io/api/data/Android/10/1", getActivity(), new JsonCallBack() { 
<br>             @Override 
<br>             public void getJsonString(String json) { 
<br>                 //解析 
<br>                 Gson gson = new Gson(); 
<br> 
<br>                 DataDataBean dataDataBean = gson.fromJson(json, DataDataBean.class); 
<br>                 //先清空一下数据 
<br>                 list.clear(); 
<br> 
<br>                 //添加到集合的最前边,,,,(0,,,,) 
<br>                 list.addAll(0,dataDataBean.getResults()); 
<br> 
<br>                 //设置适配器 
<br>                 setAdapter(); 
<br> 
<br>                 //设置适配器之后停止刷新的操作 
<br>                 refreshListView.onRefreshComplete(); 
<br> 
<br>                 //可以设置刷新的时间.... 
<br>                 startLabels.setLastUpdatedLabel("上次更新时间:"+new SimpleDateFormat("HH:mm").format(new Date(System.currentTimeMillis())));//last最近的,最后一次update修改/更新 
<br>             } 
<br>         }); 
<br> 
<br>     } 
<br> 
<br> 
<br>     /** 
<br>      * 刚开始进入页面获取网络数据....还可以作为上拉加载获取数据的操作 
<br>      * 
<br>      * 
<br>      */ 
<br>     private void getDataFromNet() { 
<br>         //第一个参数是接口,第二个上下文,第三个回调json数据 
<br>         NetDataUtil.getData("http://gank.io/api/data/Android/10/"+page_num, getActivity(), new JsonCallBack() { 
<br>             @Override 
<br>             public void getJsonString(String json) { 
<br> 
<br>                 //先存入数据库 
<br>                 jsonDao.insertJson(json,"http://gank.io/api/data/Android/10/"+page_num); 
<br> 
<br>                 //解析 
<br>                 Gson gson = new Gson(); 
<br> 
<br>                 DataDataBean dataDataBean = gson.fromJson(json, DataDataBean.class); 
<br> 
<br>                 //往后面添加... 
<br>                 list.addAll(dataDataBean.getResults()); 
<br> 
<br>                 //设置适配器 
<br>                 setAdapter(); 
<br> 
<br>                 //停止刷新 
<br>                 refreshListView.onRefreshComplete(); 
<br>             } 
<br>         }); 
<br> 
<br>     } 
<br> 
<br>     private void setAdapter() { 
<br>         if (listViewAdapter == null){ 
<br>             listViewAdapter = new ListViewAdapter(getActivity(),list); 
<br>             refreshListView.setAdapter(listViewAdapter); 
<br>         }else { 
<br>             listViewAdapter.notifyDataSetChanged(); 
<br>         } 
<br> 
<br>     } 
<br> 
<p>}</p> 
<p>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p> 
<p>public class MyHelper extends SQLiteOpenHelper {<!-- --><br>     public MyHelper(Context context) {<!-- --><br>         super(context, "bawei.db", null, 1);<br>     }<br> <br>     @Override<br>     public void onCreate(SQLiteDatabase sqLiteDatabase) {<!-- --><br>         //创建表<br>         sqLiteDatabase.execSQL("create table jsoncache(id integer primary key autoincrement,json text not null,url text not null)");<br> <br>     }<br> <br>     @Override<br>     public void onUpgrade(SQLiteDatabase sqLiteDatabase, int i, int i1) {<!-- --><br> <br>     }<br> }</p> 
<p>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p> 
<p>public class JsonDao {<!-- --><br> <br>     private MyHelper myHelper;<br> <br>     public JsonDao(Context context) {<!-- --><br> <br>         myHelper = new MyHelper(context);<br>     }<br> <br>     /**<br>      * 插入数据的操作<br>      */<br>     public void insertJson(String json,String url){<!-- --><br> <br>         SQLiteDatabase database = myHelper.getWritableDatabase();<br>         //现根据url删除json<br>         database.delete("jsoncache","url = ?",new String[]{url});<br> <br>         //再去添加<br>         ContentValues values = new ContentValues();<br>         values.put("json",json);<br>         values.put("url",url);<br> <br>         database.insert("jsoncache",null,values);<br> <br>         //关闭<br>         database.close();<br>     }<br> <br> <br>     /**<br>      * 查询数据库的操作....根据传入url获取存的json字符串<br>      */<br>     public String getJson(String url){<!-- --><br> <br>         SQLiteDatabase writableDatabase = myHelper.getWritableDatabase();<br> <br>         Cursor cursor = writableDatabase.query("jsoncache", new String[]{"json"}, "url = ?", new String[]{url}, null, null, null);<br> <br>         if (cursor.moveToNext()){<!-- --><br>             String json = cursor.getString(cursor.getColumnIndex("json"));<br> <br>             return json;<br>         }<br> <br>         return null;<br>     }<br> <br> }</p> 
<p>++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++</p> 
<p><br> </p> 
<p><br> </p> 
<p><br> </p> 
<p><br> </p> 
<p><br> </p> 
<br>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/71428ad79777d5f9c37d20bd766b993a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【vue-router①】router-link跳转页面传递参数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e15b502e2d1c2b6e6b429a3a6896ce85/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python学习—matplotlib使用—plt.tick_params中which用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>