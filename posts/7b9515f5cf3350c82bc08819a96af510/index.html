<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mac使用Docker安装RocketMQ，集成到SpringBoot项目 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mac使用Docker安装RocketMQ，集成到SpringBoot项目" />
<meta property="og:description" content="Docker安装RocketMQ，集成到SpringBoot项目 1、构建rocketmq-docker镜像 步骤一 git clone https://github.com/apache/rocketmq-docker.git 步骤二 选择RocketMQ版本并构建镜像
cd image-build sh build-image.sh RMQ-VERSION BASE-IMAGE # 这里是我使用的是：sh build-image.sh 4.8.0 alpine 通过docker images检验镜像是否构建成功
2、构建rocketmq-console-ng 镜像 步骤一 git clone https://github.com/apache/rocketmq-externals.git 步骤二 进入rocketmq-externals的rocketmq-console目录执行 mvn clean package -Dmaven.test.skip=true
cd rocketmq-externals cd rocketmq-console mvn clean package -Dmaven.test.skip=true 执行完成后，将target中的jar包复制到src/main/docker中
3、创建配置文件 步骤一 创建存放配置文件的文件夹 /Users/midas/Desktop/study/java/rocketmq/rocketmq/conf/
步骤二 创建配置文件 broker.conf，放到步骤一创建的conf文件夹中
# Licensed to the Apache Software Foundation (ASF) under one or more # contributor license agreements. See the NOTICE file distributed with # this work for additional information regarding copyright ownership." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7b9515f5cf3350c82bc08819a96af510/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-01T10:50:34+08:00" />
<meta property="article:modified_time" content="2021-08-01T10:50:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mac使用Docker安装RocketMQ，集成到SpringBoot项目</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="DockerRocketMQSpringBoot_0"></a>Docker安装RocketMQ，集成到SpringBoot项目</h2> 
<h3><a id="1rocketmqdocker_2"></a>1、构建<code>rocketmq-docker</code>镜像</h3> 
<h4><a id="_4"></a>步骤一</h4> 
<pre><code class="prism language-Bash">git clone https://github.com/apache/rocketmq-docker.git
</code></pre> 
<br> 
<h4><a id="_12"></a>步骤二</h4> 
<p>选择RocketMQ版本并构建镜像</p> 
<pre><code class="prism language-Bash">cd image-build
sh build-image.sh RMQ-VERSION BASE-IMAGE
# 这里是我使用的是：sh build-image.sh 4.8.0 alpine
</code></pre> 
<p>通过<code>docker images</code>检验镜像是否构建成功</p> 
<p><img src="https://images2.imgbox.com/bd/c6/QBRflKLD_o.png" alt="rocketmq-0"></p> 
<p><br><br></p> 
<h3><a id="2rocketmqconsoleng__30"></a>2、构建<strong>rocketmq-console-ng</strong> 镜像</h3> 
<h4><a id="_32"></a>步骤一</h4> 
<pre><code class="prism language-Bash">git clone https://github.com/apache/rocketmq-externals.git
</code></pre> 
<br> 
<h4><a id="_40"></a>步骤二</h4> 
<p>进入<code>rocketmq-externals</code>的<code>rocketmq-console</code>目录执行 <code>mvn clean package -Dmaven.test.skip=true</code></p> 
<pre><code class="prism language-Bash">cd rocketmq-externals
cd rocketmq-console
mvn clean package -Dmaven.test.skip=true
</code></pre> 
<p>执行完成后，将target中的jar包复制到src/main/docker中</p> 
<p><img src="https://images2.imgbox.com/8b/1b/9FG6Bezi_o.png" alt="rocketmq-2"></p> 
<p><img src="https://images2.imgbox.com/df/56/yoJmReKs_o.png" alt="rocketmq-1"></p> 
<p><br><br></p> 
<h3><a id="3_63"></a>3、创建配置文件</h3> 
<h4><a id="_65"></a>步骤一</h4> 
<p>创建存放配置文件的文件夹 <code>/Users/midas/Desktop/study/java/rocketmq/rocketmq/conf/</code></p> 
<br> 
<h4><a id="_71"></a>步骤二</h4> 
<p>创建配置文件 <code>broker.conf</code>，放到步骤一创建的<code>conf</code>文件夹中</p> 
<pre><code class="prism language-Bash"># Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
#  Unless required by applicable law or agreed to in writing, software
#  distributed under the License is distributed on an "AS IS" BASIS,
#  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
#  See the License for the specific language governing permissions and
#  limitations under the License.

brokerClusterName = DefaultCluster
brokerName = broker-b
brokerId = 0
deleteWhen = 04
fileReservedTime = 48
brokerRole = ASYNC_MASTER
flushDiskType = ASYNC_FLUSH

# Set self-defined brokerIP address (e.g. the host node's) 
brokerIP1=本机IP
</code></pre> 
<h5><a id="_104"></a>注：</h5> 
<p><strong>1、</strong> <strong>broker.conf</strong> <strong>最后一行的</strong> <code>brokerIP1</code><strong>要设置为本机IP</strong></p> 
<p>2、Mac系统通过<code>ifconfig</code> 查询本机IP</p> 
<br> 
<h4><a id="_112"></a>步骤三</h4> 
<p>创建配置文件<code>rocketmq.yml</code>，放到步骤一创建的<code>conf</code>文件夹中</p> 
<pre><code class="prism language-Bash">version: '3'
services:
  namesrv:
    image: apacherocketmq/rocketmq:4.8.0-alpine
    container_name: rmqnamesrv
    ports:
      - 9876:9876
    command: sh mqnamesrv
  broker:
    image: apacherocketmq/rocketmq:4.8.0-alpine
    container_name: rmqbroker
    ports:
      - 10909:10909
      - 10911:10911
      - 10912:10912
    volumes:
      - /Users/midas/Desktop/study/java/rocketmq/rocketmq/conf/broker.conf:/home/rocketmq/rocketmq-4.8.0/conf/broker.conf
    command: sh mqbroker -n namesrv:9876 -c /home/rocketmq/rocketmq-4.8.0/conf/broker.conf
    depends_on:
      - namesrv
  mqconsole:
    image: candice0630/rocketmq-console-ng:2.0
    container_name: rmqconsole
    ports:
      - 8181:8080
    environment:
      JAVA_OPTS: -Drocketmq.config.namesrvAddr=namesrv:9876 -Drocketmq.config.isVIPChannel=false
    depends_on:
      - namesrv

</code></pre> 
<h5><a id="_150"></a>注：</h5> 
<p><strong>1、</strong> 要修改配置文件<code>volumes</code>中的<code>/Users/midas/Desktop/study/java/rocketmq/rocketmq/conf/broker.conf</code>，改成步骤二自己创建的<code>broker.conf</code>的路径</p> 
<p>2、image的版本，根据第1步构建的<code>rocketmq-docker</code>镜像来修改，此处选择4.8.0-alpine</p> 
<p><br><br></p> 
<h3><a id="4rocketmqyml_158"></a>4、通过rocketmq.yml构建镜像组</h3> 
<pre><code class="prism language-Bash">docker-compose -f rocketmq.yml up -d
</code></pre> 
<p>打开Docker界面如图</p> 
<p><img src="https://images2.imgbox.com/3f/2c/kQ4kSIlz_o.png" alt="rocketmq-3"></p> 
<p>通过<code>localhost:8181</code>访问控制台（<code>rocketmq.yml</code>的<code>mqconsole</code>配置的端口号）</p> 
<br> 
<h4><a id="IP_175"></a>IP设置验证</h4> 
<p>在控制台的Cluster中，检查Broker的地址是否成功设置为本机IP</p> 
<p><img src="https://images2.imgbox.com/2b/ac/gJUjflsk_o.png" alt="rocketmq-4"><br> <br><br></p> 
<h3><a id="5SpringBoot_182"></a>5、集成到SpringBoot项目</h3> 
<h4><a id="_184"></a>步骤一</h4> 
<p>pom.xml导入RocketMQ依赖</p> 
<pre><code class="prism language-Java">&lt;!--        RocketMQ--&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.apache.rocketmq&lt;/groupId&gt;
    &lt;artifactId&gt;rocketmq-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;2.0.2&lt;/version&gt;
&lt;/dependency&gt;
</code></pre> 
<h5><a id="_198"></a>注：</h5> 
<p>这一步如果maven依赖下载失败，可以去手动下载缺少的jar包，放入本地的maven仓库中</p> 
<p><a href="https://mvnrepository.com/" rel="nofollow">https://mvnrepository.com/</a></p> 
<br> 
<h4><a id="_206"></a>步骤二</h4> 
<p>application.properties添加配置</p> 
<pre><code class="prism language-.properties"># rocketMQ
# ip为本机ip ifconfg查询
rocketmq.name-server=192.168.3.51:9876
rocketmq.producer.group=default
</code></pre> 
<h4><a id="_219"></a>简单使用</h4> 
<p><strong>注入RocketMQTemplate</strong></p> 
<pre><code class="prism language-Java">@Resource
private RocketMQTemplate rocketMQTemplate;

</code></pre> 
<p><strong>发送消息</strong></p> 
<pre><code class="prism language-Java">// 前面的参数是Topic名称，随意取一个
// 后面的参数是要发送的消息
rocketMQTemplate.convertAndSend("DEMO_TOPIC", "hello world");
</code></pre> 
<p><strong>控制台查看消息</strong></p> 
<p><img src="https://images2.imgbox.com/9e/ea/NiOja7Oz_o.png" alt="rocketmq-5"></p> 
<br> 
<h3><a id="_247"></a>参考</h3> 
<p><a href="https://jarvanbest.com/2021/06/20/M1%E7%89%88%E6%9C%ACMac%E9%80%9A%E8%BF%87Docker%E5%AE%89%E8%A3%85RocketMQ/" rel="nofollow">M1版本Mac通过Docker安装RocketMQ | 蝉 (jarvanbest.com)</a></p> 
<p><a href="https://blog.csdn.net/mefly521/article/details/84394483">https://blog.csdn.net/mefly521/article/details/84394483</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6bd1ac97acd64eda2f94f43c177e0a40/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ibm服务器芯片架构,IBM x366 服务器技术详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f44bce8c1f73b5ab976606aee5bf4127/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">二维码制作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>