<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Js逆向案例—网易云音乐 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Js逆向案例—网易云音乐" />
<meta property="og:description" content="首先找到所需响应所在位置，点开Initiator。点开第一个js文件。
url未登录状态csrf_token为空，不影响操作
点开第一个js文件之后，在弹出的页面所选行打上断点，刷新页面，第一个url并不是我们所要的url，这里我们按F8往下走
出现如上图url即为我们要分析的请求，此处data中有两个参数，此处参数既然已经加密完成，那么我们就需要往下走，继续按上图箭头方向往下查找相关加密位置
找到window.asrsea函数即可，此为加密入口
取消掉原来的断点，在新的位置打上断点再次刷新
进入asrsea函数内部即为相关js代码，下方为python还原代码：
def aes(text, i): text = text.encode(&#39;utf-8&#39;) aes = AES.new(i.encode(&#39;utf-8&#39;), mode=AES.MODE_CBC, iv=&#39;0102030405060708&#39;.encode(&#39;utf-8&#39;)) # ECB一般不需要iv text_len = 16 - len(text) % 16 text &#43;= (text_len * chr(text_len)).encode(&#39;utf-8&#39;) resp = aes.encrypt(text) return base64.b64encode(resp).decode() def main(id): h = {} data_text = &#39;{&#34;rid&#34;:&#34;R_SO_4_%s&#34;,&#34;threadId&#34;:&#34;R_SO_4_%s&#34;,&#34;pageNo&#34;:&#34;1&#34;,&#34;pageSize&#34;:&#34;20&#34;,&#34;cursor&#34;:&#34;-1&#34;,&#34;offset&#34;:&#34;0&#34;,&#34;orderType&#34;:&#34;1&#34;,&#34;csrf_token&#34;:&#34;&#34;}&#39; % (id, id) const1 = &#34;010001&#34; const2 = &#34;00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7&#34; const3 = &#34;0CoJUm6Qyw8W8jud&#34; i = &#34;DEpPIq7Alyv6xXOk&#34; h[&#39;encText&#39;] =aes(data_text, const3) h[&#39;encText&#39;] = aes(h[&#39;encText&#39;], i), # h[&#39;encSecKey&#39;] = c(i, e, f) h[&#39;encSecKey&#39;] = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/be818313927a8638d67224ceeff5a509/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-17T10:16:58+08:00" />
<meta property="article:modified_time" content="2022-02-17T10:16:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Js逆向案例—网易云音乐</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/5f/ae/bu42uYB0_o.png" alt="在这里插入图片描述"><br> 首先找到所需响应所在位置，点开Initiator。点开第一个js文件。<br> url未登录状态csrf_token为空，不影响操作<br> 点开第一个js文件之后，在弹出的页面所选行打上断点，刷新页面，第一个url并不是我们所要的url，这里我们按F8往下走<br> <img src="https://images2.imgbox.com/80/58/PGtVmgnh_o.png" alt="在这里插入图片描述"><br> 出现如上图url即为我们要分析的请求，此处data中有两个参数，此处参数既然已经加密完成，那么我们就需要往下走，继续按上图箭头方向往下查找相关加密位置<br> 找到window.asrsea函数即可，此为加密入口<br> 取消掉原来的断点，在新的位置打上断点再次刷新<br> 进入asrsea函数内部即为相关js代码，下方为python还原代码：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">aes</span><span class="token punctuation">(</span>text<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">:</span>
    text <span class="token operator">=</span> text<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    aes <span class="token operator">=</span> AES<span class="token punctuation">.</span>new<span class="token punctuation">(</span>i<span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token operator">=</span>AES<span class="token punctuation">.</span>MODE_CBC<span class="token punctuation">,</span> iv<span class="token operator">=</span><span class="token string">'0102030405060708'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ECB一般不需要iv</span>
    text_len <span class="token operator">=</span> <span class="token number">16</span> <span class="token operator">-</span> <span class="token builtin">len</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">16</span>
    text <span class="token operator">+=</span> <span class="token punctuation">(</span>text_len <span class="token operator">*</span> <span class="token builtin">chr</span><span class="token punctuation">(</span>text_len<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    resp <span class="token operator">=</span> aes<span class="token punctuation">.</span>encrypt<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
    <span class="token keyword">return</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>resp<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    h <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    data_text <span class="token operator">=</span> <span class="token string">'{"rid":"R_SO_4_%s","threadId":"R_SO_4_%s","pageNo":"1","pageSize":"20","cursor":"-1","offset":"0","orderType":"1","csrf_token":""}'</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">)</span>
    const1 <span class="token operator">=</span> <span class="token string">"010001"</span>
    const2 <span class="token operator">=</span> <span class="token string">"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7"</span>
    const3 <span class="token operator">=</span> <span class="token string">"0CoJUm6Qyw8W8jud"</span>
    i <span class="token operator">=</span> <span class="token string">"DEpPIq7Alyv6xXOk"</span>
    h<span class="token punctuation">[</span><span class="token string">'encText'</span><span class="token punctuation">]</span> <span class="token operator">=</span>aes<span class="token punctuation">(</span>data_text<span class="token punctuation">,</span> const3<span class="token punctuation">)</span>
    h<span class="token punctuation">[</span><span class="token string">'encText'</span><span class="token punctuation">]</span> <span class="token operator">=</span> aes<span class="token punctuation">(</span>h<span class="token punctuation">[</span><span class="token string">'encText'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment"># h['encSecKey'] = c(i, e, f)</span>
    h<span class="token punctuation">[</span><span class="token string">'encSecKey'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"00e0b509f6259df8642dbc35662901477df22677ec152b5ff68ace615bb7b725152b3ab17a876aea8a5aa76d2e417629ec4ee341f56135fccf695280104e0312ecbda92557c93870114af6c9d05c4f7f0c3685b7a46bee255932575cce10b424d813cfe4875d3e82047b97ddef52741d546b8e289dc6935b3ece0462db0a22b8e7"</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'_ntes_nnid=73220b7ba7a407e037463c0626da2d6a,1628652294087; _ntes_nuid=73220b7ba7a407e037463c0626da2d6a; vinfo_n_f_l_n3=0a12faba88adcf4d.1.0.1632972543466.0.1632972549420; _iuqxldmzr_=32; NMTID=00OSGcCcKEHBX3B9Eb6rpq_6AOig24AAAF-4nrJgQ; WEVNSM=1.0.0; WNMCID=ofqpdv.1644477203609.01.0; WM_TID=6JuzaA2c8dVEQVUVREc%2B%2Be0ML53zCRyS; playerid=22620139; WM_NI=wzSm80PLVdp%2F%2FWgeVyJDMCqbgwNHk9e1nWUcGfuHPH%2Bq3XMs0rX4dN11eHw9hnawA9e8zChjb3YxTcVYFV%2FVXME7WIAStL1ksfhoWqctSsf5VAizp0M0z8KW86sTbc6UOWs%3D; WM_NIKE=9ca17ae2e6ffcda170e2e6eeaec4539689a7b2e940ade78eb7d45b868b9fbbf17aa2b1b791fb48a5e9b682e62af0fea7c3b92ab5a69d8ebb3c94949a85f325ed89a986d5738a9c83a4f46aa5a982a9ea33a7efa2b8d86985babba9d344e9affdb9d079f4ae98d5e746f3efaba9f633acb2af98c433a7e8b6a4eb62a2ed9799d76996878ab7ae5e9c938bd8d643838dbcadb461b1baa890d67ba1ac9d94e53f969fa79bf33c8ff0b6d9ca5dfceabdb5e169f68b81b8f237e2a3; JSESSIONID-WYYY=aTAoTpqsMM3el36ZfBUW2Q0zfQ2V9aANY2WXy%5CBPQ2djJSBqUXVOQIaEo9T%2FUe0%2BYbuI%5CigkkOvx8OS5f9UYwRCsq0y8HfS%2ByRCuC44SMRmKvfkmGpenqqdXBPbEGyEibKS5zCyXU8aa3w8z5qfcu%2FN0Iqrr4Wysz5GwKTX23n7RdXTw%3A1644808290336'</span><span class="token punctuation">,</span>
        <span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/96.0.4664.45 Safari/537.36'</span><span class="token punctuation">,</span>
        <span class="token string">'Content-Type'</span><span class="token punctuation">:</span> <span class="token string">'application/x-www-form-urlencoded'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    data <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">'params'</span><span class="token punctuation">:</span> h<span class="token punctuation">[</span><span class="token string">'encText'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string">'encSecKey'</span><span class="token punctuation">:</span><span class="token string">"01cee9438db0034b2262ca105a2ad831b409761f7de8799b4aa63c20f8c7ea3759292e1145988db4787465ec9c47a0a87df0e5d95809f31a30e99d77fa4d301c8c3d1e73078687314a5fd67fc6f709ddbbdbe678644260ce88b10d9f08a6ae81bd47f7bed43efb7d646b7d9157c591b9cc8f53fee6facab63a4eb6f6320b31b7"</span>
    <span class="token punctuation">}</span>
    resp <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>comment_url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">,</span> verify<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
    resp <span class="token operator">=</span> resp<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>resp<span class="token punctuation">)</span>
    hotComments <span class="token operator">=</span> resp<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'hotComments'</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> com <span class="token keyword">in</span> hotComments<span class="token punctuation">:</span>
        content <span class="token operator">=</span> com<span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    comment_url <span class="token operator">=</span> <span class="token string">'评论的url'</span>
    main<span class="token punctuation">(</span><span class="token string">'1851652156'</span><span class="token punctuation">)</span>
</code></pre> 
<p>版权问题，很多图没办法贴出来，有疑问可评论提问。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4f3940255e2a265a31892b31c777d0b0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux中SVN创建用户并分配权限</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4a3aba56455aa4ff5318beea272d8b1e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【王道考研 数据结构 】基础算法代码复习总结 C语言(树和图）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>