<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux：samba服务 （smbd） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux：samba服务 （smbd）" />
<meta property="og:description" content="smb服务器为centos7
使用的yum安装（如果不会搭建本地yum仓库可以查看） Linux：rpm查询安装 &amp;&amp; yum安装_鲍海超-GNUBHCkalitarro的博客-CSDN博客
samba 简介 samba 使用了
1.SMB 协议
Server Message Block，服务消息块
2.CIFS 协议
Common Internet File System，通用互联网文件系
samba有两项主程序分别是
smbd和nmbd。这两个守护进程在服务器启动到停止期间持续运行，功能各异。Smbd和nmbd使用的全部配置信息全都保存在smb.conf文件中。Smb.conf向smbd和nmbd两个守护进程说明输出什么以便共享，共享输出给谁及如何进行输出。
Samba提供了基于CIFS的四个服务
文件和打印服务、授权与被授权 ———— smbd提供 名称解析、浏览服务 ———— nmbd提供
smbd进程的作用是处理到来的SMB软件包，为使用该软件包的资源与Linux进行协商
nmbd进程使主机(或工作站)能浏览Linux服务器。
我们本章将smbd进程 用于文件传输 安装samba yum -y install samba
# 安装samba服务
安装完毕
systemctl start smb 启动smb
systemctl start nmb 启动nmb
systemctl enable smb 开机自启smb
systemctl enable nmb 开机自启nmb
将start 替换为 stop 就是关闭
将enable 替换为 disable 就是开机自动关闭
成功开启服务
netstat -anput | grep &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1643d16bd049846fdcaae079c10c8a02/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-09T22:48:54+08:00" />
<meta property="article:modified_time" content="2023-06-09T22:48:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux：samba服务 （smbd）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>smb服务器为centos7</p> 
<p><img alt="" height="108" src="https://images2.imgbox.com/d6/fd/5Vvmp7Cz_o.png" width="1200"></p> 
<p>使用的yum安装（如果不会搭建本地yum仓库可以查看） </p> 
<p><a href="https://blog.csdn.net/w14768855/article/details/130609556?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522168622420616800180660504%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=168622420616800180660504&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-130609556-null-null.268%5Ev1%5Ekoosearch&amp;utm_term=yum&amp;spm=1018.2226.3001.4450" title="Linux：rpm查询安装 &amp;&amp; yum安装_鲍海超-GNUBHCkalitarro的博客-CSDN博客">Linux：rpm查询安装 &amp;&amp; yum安装_鲍海超-GNUBHCkalitarro的博客-CSDN博客</a></p> 
<hr> 
<h2>samba 简介</h2> 
<p>samba 使用了</p> 
<blockquote> 
 <p>1.SMB 协议<br> Server Message Block，服务消息块<br> 2.CIFS 协议<br> Common Internet File System，通用互联网文件系</p> 
</blockquote> 
<p>samba有两项主程序分别是</p> 
<blockquote> 
 <p> smbd和nmbd。这两个守护进程在服务器启动到停止期间持续运行，功能各异。Smbd和nmbd使用的全部配置信息全都保存在smb.conf文件中。Smb.conf向smbd和nmbd两个守护进程说明输出什么以便共享，共享输出给谁及如何进行输出。</p> 
</blockquote> 
<p>Samba提供了基于CIFS的四个服务</p> 
<blockquote> 
 <p>文件和打印服务、授权与被授权   ————      smbd提供 </p> 
 <p>名称解析、浏览服务                     ————      nmbd提供</p> 
 <p></p> 
 <p>smbd进程的作用是处理到来的SMB软件包，为使用该软件包的资源与Linux进行协商</p> 
 <p>nmbd进程使主机(或工作站)能浏览Linux服务器。</p> 
</blockquote> 
<hr> 
<p><span style="color:#fe2c24;"><strong>我们本章将smbd进程  用于文件传输 </strong></span></p> 
<hr> 
<h2>安装samba </h2> 
<blockquote> 
 <p>yum -y install samba</p> 
 <p># 安装samba服务</p> 
</blockquote> 
<p> <img alt="" height="737" src="https://images2.imgbox.com/98/ac/preSWGmx_o.png" width="994"></p> 
<p> 安装完毕</p> 
<blockquote> 
 <p><span style="color:#fe2c24;"><strong>systemctl start smb        启动smb</strong></span><br> systemctl start nmb        启动nmb<br><strong><span style="color:#fe2c24;">systemctl enable smb        开机自启smb</span></strong><br> systemctl enable nmb        开机自启nmb</p> 
 <p>将start 替换为 stop   就是关闭</p> 
 <p>将enable 替换为 disable 就是开机自动关闭</p> 
</blockquote> 
<p><img alt="" height="483" src="https://images2.imgbox.com/7d/61/WrLUVrtT_o.png" width="1182"> 成功开启服务</p> 
<blockquote> 
 <p>netstat -anput | grep "smbd"</p> 
 <p>#  可以查看占用的端口</p> 
</blockquote> 
<p><img alt="" height="125" src="https://images2.imgbox.com/33/c3/h9f9yAXy_o.png" width="907"></p> 
<hr> 
<h2>创建共享用户 和 共享文件</h2> 
<p>首先准备一个要分配的一个文件 也是十分简单   如果你有现成的文件可以不用创建</p> 
<blockquote> 
 <p>mkdir -p /kali/tarro</p> 
</blockquote> 
<p>等会将/kali/tarro/下的对象共享出去</p> 
<p>现在根据你的需要创建共享用户，我这创建2个</p> 
<p>分别是   tarro1   和 tarro2 这两位用户</p> 
<p>思路：首先创建系统用户再将其变成入共享用户</p> 
<blockquote> 
 <p>useradd tarro1        </p> 
 <p>useradd tarro2</p> 
 <p># 创建两个用户</p> 
 <p>passwd tarro1 </p> 
 <p>passwd tarro2</p> 
 <p>#修改两个用户的密码</p> 
</blockquote> 
<blockquote> 
 <p>pdbedit -a -u tarro1</p> 
 <p>pdbedit -a -u tarro2</p> 
 <p># 将他俩加入共享用户   期间会让再次设置密码   这个可以和系统密码不一样   这个是等会访问文件的用户密码</p> 
 <p>pdbedit -L</p> 
 <p># 列出所有共享用户</p> 
 <p><img alt="" height="89" src="https://images2.imgbox.com/37/62/tuTxzGGR_o.png" width="258"></p> 
 <p> pdbedit -x -u tarro1</p> 
 <p># 取消tarro1这个共享用户</p> 
 <p># 删除共享用户并没有删除系统用户</p> 
 <p><img alt="" height="94" src="https://images2.imgbox.com/8d/9e/uxC0u7g2_o.png" width="356"></p> 
 <p> 再将tarro1添加回来</p> 
 <p>pdbedit -a -u tarro1        </p> 
 <p><img alt="" height="91" src="https://images2.imgbox.com/f2/1d/qGxbR4Vi_o.png" width="262"></p> 
</blockquote> 
<hr> 
<h2>配置samba （核心）/etc/samba/smb.conf</h2> 
<p>samba的smb主配置文件位置是   /etc/samba/smb.conf</p> 
<blockquote> 
 <p> testparm</p> 
 <p># 可以直接查看文件内容</p> 
 <p>vi  /etc/samba/smb.conf</p> 
 <p># 配置文件</p> 
 <p><img alt="" height="775" src="https://images2.imgbox.com/e6/a1/On88WO7u_o.png" width="545"></p> 
 <p> [global]：全局设置<br> [homes]：用户目录共享设置<br> [printers]：打印机共享设置<br> [myshare]：自定义名称的共享目录设置</p> 
 <p></p> 
 <p>常见全局配置项的含义<br> workgroup：所在工作组名称<br> server string：服务器描述信息<br> security：安全级别，可用值如下<br> user、server、domain<br> log file：日志文件位置，“%m” 变量表示客户机地址<br> passwd backend：设置共享账户文件的类型<br>  </p> 
</blockquote> 
<p>上面这些都可以不用改动</p> 
<p>我们让  tarro1 和 tarro2  都可以 读取     但是只有 tarro 2 可以写入</p> 
<blockquote> 
 <p>直接在下面追加</p> 
 <p><img alt="" height="257" src="https://images2.imgbox.com/5d/fb/nEvPGo6b_o.png" width="512"></p> 
 <p> 然后再追加</p> 
 <p><img alt="" height="474" src="https://images2.imgbox.com/5a/d3/bJh50Jvj_o.png" width="672"></p> 
 <p> comment = 介绍  这里可以随便写</p> 
 <p><img alt="" height="419" src="https://images2.imgbox.com/47/db/ajsJogXJ_o.png" width="581"></p> 
 <p> 这个是共享的文件夹路径</p> 
 <p><img alt="" height="272" src="https://images2.imgbox.com/a1/68/B3qeV1GO_o.png" width="486"></p> 
 <p>不允许匿名登录</p> 
 <p> 继续追加</p> 
 <p><img alt="" height="394" src="https://images2.imgbox.com/39/7b/Pu5pRtat_o.png" width="604"></p> 
 <p> 继续追加</p> 
 <p><img alt="" height="279" src="https://images2.imgbox.com/20/ab/mf175XtI_o.png" width="501"></p> 
 <p></p> 
 <p> 这个是允许读取的用户</p> 
 <p><img alt="" height="310" src="https://images2.imgbox.com/7a/fe/y8E3TfbA_o.png" width="637"></p> 
 <p>可以写入的用户</p> 
 <p></p> 
 <p>然后保存退出wq</p> 
</blockquote> 
<p>然后访问 //samba主机ip</p> 
<p>samba服务器selinux  和 防火墙 都要关闭 </p> 
<blockquote> 
 <p>systemctl restart smb</p> 
 <p>重启一下服务 </p> 
</blockquote> 
<p>我们将/kali/tarro文件的权限改为777让用户写入   如果没有samba写入权限也会被拦截 </p> 
<p><img alt="" height="580" src="https://images2.imgbox.com/ee/60/pVWHDWjU_o.png" width="1000"></p> 
<p> 可以正常访问</p> 
<p> 登录tarro2</p> 
<p><img alt="" height="255" src="https://images2.imgbox.com/12/da/TurMp2Vq_o.png" width="659"></p> 
<p>访问成功 </p> 
<p><img alt="" height="195" src="https://images2.imgbox.com/65/b9/enNywTVy_o.png" width="680"></p> 
<p>写入成功</p> 
<p>返回服务器上看一下 </p> 
<p><img alt="" height="107" src="https://images2.imgbox.com/f2/56/FxgNcPQJ_o.png" width="677"></p> 
<p>也可以看到 </p> 
<p>但是他默认写入的权限  文件是 744    目录是 755</p> 
<p>如果不想让他默认是这个可以修改</p> 
<hr> 
<h2>修改写入文件默认权限</h2> 
<blockquote> 
 <p>vi /etc/samba/smb.conf</p> 
</blockquote> 
<p> <img alt="" height="372" src="https://images2.imgbox.com/7c/d0/aryuRxLe_o.png" width="560"></p> 
<p>再次到这里继续追加</p> 
<p> <img alt="" height="445" src="https://images2.imgbox.com/41/68/dM4HCi5n_o.png" width="475"></p> 
<p>这个是写入的文件默认权限   拥有读写 </p> 
<p> <img alt="" height="397" src="https://images2.imgbox.com/a0/6f/ouXwdcOo_o.png" width="528"></p> 
<p>这个是目录默认权限</p> 
<p>为 读写执行</p> 
<p>然后保存退出</p> 
<blockquote> 
 <p> systemctl restart smb</p> 
</blockquote> 
<p><img alt="" height="410" src="https://images2.imgbox.com/c3/6c/IqOQjvFC_o.png" width="827"></p> 
<p>再次新建两个</p> 
<p> <img alt="" height="148" src="https://images2.imgbox.com/64/0d/XOhuJpl7_o.png" width="739"></p> 
<p> 和第一次权限不同这次变成我所指定的权限了</p> 
<hr> 
<h2>Linux访问samba共享文件</h2> 
<p>客户端Linux需要安装<span style="color:#ff9900;"><strong>samba-client</strong></span>软件</p> 
<blockquote> 
 <p>yum -y install samba-client</p> 
</blockquote> 
<p><img alt="" height="737" src="https://images2.imgbox.com/4c/d9/TcCs0zWz_o.png" width="992"></p> 
<p>安装完成</p> 
<blockquote> 
 <p><strong>smbclient -L smb服务器ip -U 用户</strong></p> 
 <p>smbclient -L 192.168.1.1 -U tarro2</p> 
 <p># 查看共享文件内容</p> 
 <p>输入密码就能查看到</p> 
 <p><img alt="" height="359" src="https://images2.imgbox.com/70/58/bNNR0lTy_o.png" width="765"></p> 
</blockquote> 
<blockquote> 
 <p>smbclient -U 用户 //smb服务器ip/目录</p> 
 <p>smbclient -U tarro2 //192.168.1.1/TARRO</p> 
 <p><img alt="" height="86" src="https://images2.imgbox.com/6b/cc/kS1yassg_o.png" width="598"></p> 
 <p> 输入密码后进入到</p> 
 <p>smb：\&gt;</p> 
 <p>就成功进入了</p> 
 <p>exit可以退出</p> 
 <p><img alt="" height="279" src="https://images2.imgbox.com/44/00/v5HsSti4_o.png" width="785"></p> 
 <p> 我们要将里边的文件下载到本地就使用 <span style="color:#fe2c24;">get</span></p> 
 <p><strong>get + 文件名</strong></p> 
 <p><strong>get 123.txt</strong></p> 
 <p><img alt="" height="72" src="https://images2.imgbox.com/67/a3/UwqfgLJt_o.png" width="922"></p> 
 <p>exit退出</p> 
 <p> 默认下载到home目录</p> 
 <p><img alt="" height="202" src="https://images2.imgbox.com/3a/bb/XhrhhbzE_o.png" width="428"></p> 
 <p> 如果要上传文件就使用 <span style="color:#fe2c24;">put</span></p> 
 <p>put + 本地文件名</p> 
 <p>put 123123.txt</p> 
 <p><img alt="" height="64" src="https://images2.imgbox.com/58/00/7fJDcZu8_o.png" width="415"></p> 
 <p><img alt="" height="291" src="https://images2.imgbox.com/28/5a/RAxqPog2_o.png" width="729"></p> 
 <p>exit可以退出</p> 
</blockquote> 
<p> 平时这样登录很麻烦  ， 聪明的攻城狮就会有解决办法 直接将共享文件夹挂载到本地即可</p> 
<blockquote> 
 <p>mount -o username=用户名,password=登录用户密码 //IP/目录 /本机挂载点<br> mount -o username=tarro2,password=123 //192.168.1.1/TARRO /opt</p> 
 <p># 将共享文件夹挂载到本地的opt下</p> 
 <p></p> 
 <p>我们这个tarro有写入权限  进去之后和正常文件一样<br><img alt="" height="132" src="https://images2.imgbox.com/6e/e9/xewoIWHc_o.png" width="795"></p> 
 <p> 如果使用tarro1只有只读时候  往文件内写入东西会有报错</p> 
 <p><img alt="" height="127" src="https://images2.imgbox.com/a4/36/OY8E2cbd_o.png" width="1013"> </p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7c11f65254e5d9c62371abbe5fe7eb1b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ES文档字段类型</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d4a598f6c7ad3345bfa028249e74833f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CH573-07-ADC——RISC-V内核BLE MCU快速开发教程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>