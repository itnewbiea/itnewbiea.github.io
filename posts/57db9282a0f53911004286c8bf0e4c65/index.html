<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>jtopo限制滚轮缩放范围，zoomOut()与zoomIn()缩放限制 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="jtopo限制滚轮缩放范围，zoomOut()与zoomIn()缩放限制" />
<meta property="og:description" content="限制滚轮缩放范围 想要给jtopo的场景缩放加上限制，首先需要找到源代码中控制缩放的代码：
// 在源码里ctrl&#43;F搜索 onmousewheel 就能找到以下代码 function l(a) { var b = d(a); // 原滚轮缩放 a.preventDefault(); n.dispatchEventToScenes(&#34;mousewheel&#34;, b); n.dispatchEvent(&#34;mousewheel&#34;, b), null != n.wheelZoom &amp;&amp; (a.preventDefault ? a.preventDefault() : (a = a || window.event, a.returnValue = !1), 1 == n.eagleEye.visible &amp;&amp; n.eagleEye.update()) // 鹰 } function m(b) { a.util.isIE || !window.addEventListener ? (b.onmouseout = f, b.onmouseover = e, b.onmousedown = g, b.onmouseup = h, b.onmousemove = i, b.onclick = j, b." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/57db9282a0f53911004286c8bf0e4c65/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-12-11T16:40:20+08:00" />
<meta property="article:modified_time" content="2017-12-11T16:40:20+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">jtopo限制滚轮缩放范围，zoomOut()与zoomIn()缩放限制</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5 id="限制滚轮缩放范围"><strong>限制滚轮缩放范围</strong></h5> 
<p>想要给jtopo的场景缩放加上限制，首先需要找到源代码中控制缩放的代码：</p> 
<pre class="prettyprint"><code class=" hljs avrasm"> // 在源码里ctrl+F搜索 onmousewheel 就能找到以下代码

             function l(a) {
                var b = d(a)<span class="hljs-comment">;</span>

                // 原滚轮缩放
                a<span class="hljs-preprocessor">.preventDefault</span>()<span class="hljs-comment">;</span>
                n<span class="hljs-preprocessor">.dispatchEventToScenes</span>(<span class="hljs-string">"mousewheel"</span>, b)<span class="hljs-comment">;</span>
                n<span class="hljs-preprocessor">.dispatchEvent</span>(<span class="hljs-string">"mousewheel"</span>, b),
                null != n<span class="hljs-preprocessor">.wheelZoom</span> &amp;&amp; (a<span class="hljs-preprocessor">.preventDefault</span> ? a<span class="hljs-preprocessor">.preventDefault</span>() : (a = a || window<span class="hljs-preprocessor">.event</span>, a<span class="hljs-preprocessor">.returnValue</span> = !<span class="hljs-number">1</span>), <span class="hljs-number">1</span> == n<span class="hljs-preprocessor">.eagleEye</span><span class="hljs-preprocessor">.visible</span> &amp;&amp; n<span class="hljs-preprocessor">.eagleEye</span><span class="hljs-preprocessor">.update</span>()) // 鹰
            }
            function m(b) {
                a<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.isIE</span> || !window<span class="hljs-preprocessor">.addEventListener</span> ? (b<span class="hljs-preprocessor">.onmouseout</span> = f, b<span class="hljs-preprocessor">.onmouseover</span> = e, b<span class="hljs-preprocessor">.onmousedown</span> = g, b<span class="hljs-preprocessor">.onmouseup</span> = h, b<span class="hljs-preprocessor">.onmousemove</span> = i, b<span class="hljs-preprocessor">.onclick</span> = j, b<span class="hljs-preprocessor">.ondblclick</span> = k, b<span class="hljs-preprocessor">.onmousewheel</span> = l, b<span class="hljs-preprocessor">.touchstart</span> = g, b<span class="hljs-preprocessor">.touchmove</span> = i, b<span class="hljs-preprocessor">.touchend</span> = h) : (b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"mouseout"</span>, f), b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"mouseover"</span>, e), b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"mousedown"</span>, g), b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"mouseup"</span>, h), b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"mousemove"</span>, i), b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"click"</span>, j), b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"dblclick"</span>, k), a<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.isFirefox</span> ? b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"DOMMouseScroll"</span>, l) : b<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"mousewheel"</span>, l)),
                window<span class="hljs-preprocessor">.addEventListener</span> &amp;&amp; (window<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"keydown"</span>,
                    function(b) {
                        n<span class="hljs-preprocessor">.dispatchEventToScenes</span>(<span class="hljs-string">"keydown"</span>, a<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.cloneEvent</span>(b))<span class="hljs-comment">;</span>
                        var c = b<span class="hljs-preprocessor">.keyCode</span><span class="hljs-comment">; (38 == c || 40 == c) &amp;&amp; (b.preventDefault ? b.preventDefault() : (b = b || window.event, b.returnValue = !1))</span>
                    },
                    !<span class="hljs-number">0</span>), window<span class="hljs-preprocessor">.addEventListener</span>(<span class="hljs-string">"keyup"</span>,
                    function(b) {
                        n<span class="hljs-preprocessor">.dispatchEventToScenes</span>(<span class="hljs-string">"keyup"</span>, a<span class="hljs-preprocessor">.util</span><span class="hljs-preprocessor">.cloneEvent</span>(b))<span class="hljs-comment">;</span>
                        var c = b<span class="hljs-preprocessor">.keyCode</span><span class="hljs-comment">; (38 == c || 40 == c) &amp;&amp; (b.preventDefault ? b.preventDefault() : (b = b || window.event, b.returnValue = !1))</span>
                    },
                    !<span class="hljs-number">0</span>))
            }</code></pre> 
<p>加上我们的限制滚轮范围的代码：</p> 
<pre class="prettyprint"><code class=" hljs avrasm"> if(scale&gt;<span class="hljs-number">0.5</span> &amp;&amp; scale &lt; <span class="hljs-number">5</span>){ // scale为现在的缩放比例

    // 原滚轮缩放
      a<span class="hljs-preprocessor">.preventDefault</span>()<span class="hljs-comment">;</span>
      n<span class="hljs-preprocessor">.dispatchEventToScenes</span>(<span class="hljs-string">"mousewheel"</span>, b)<span class="hljs-comment">;</span>
      n<span class="hljs-preprocessor">.dispatchEvent</span>(<span class="hljs-string">"mousewheel"</span>, b),
      null != n<span class="hljs-preprocessor">.wheelZoom</span> &amp;&amp; (a<span class="hljs-preprocessor">.preventDefault</span> ? a<span class="hljs-preprocessor">.preventDefault</span>() : (a = a || window<span class="hljs-preprocessor">.event</span>, a<span class="hljs-preprocessor">.returnValue</span> = !<span class="hljs-number">1</span>), <span class="hljs-number">1</span> == n<span class="hljs-preprocessor">.eagleEye</span><span class="hljs-preprocessor">.visible</span> &amp;&amp; n<span class="hljs-preprocessor">.eagleEye</span><span class="hljs-preprocessor">.update</span>()) // 鹰眼
   }else{
       //mytest<span class="hljs-preprocessor">.scene</span><span class="hljs-preprocessor">.zoom</span>(scale, scale)<span class="hljs-comment">;</span>
       console<span class="hljs-preprocessor">.log</span>(<span class="hljs-string">"不在范围内不执行"</span>)<span class="hljs-comment">;</span>
   }
</code></pre> 
<p>细心的同志可能发现了“原滚轮缩放”这段文字注释，是因为jtopo的这段控制缩放源码被我注释掉了（原滚轮个缩放在mac触控板存在bug），具体请看我的这篇文章： <br> <a href="http://blog.csdn.net/qq_39759115/article/details/78539302" target="_blank" rel="noopener noreferrer">http://blog.csdn.net/qq_39759115/article/details/78539302</a></p> 
<p>so，修改后的代码是：</p> 
<pre class="prettyprint"><code class=" hljs mel">             function l(a) {
                var b = d(a);

                <span class="hljs-comment">// 重写 滚轮缩放</span>
                var <span class="hljs-keyword">event</span> = a;
                var delta = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.wheelDelta) {
                    delta = <span class="hljs-keyword">event</span>.wheelDelta / <span class="hljs-number">120</span>;
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.detail) {
                    delta = -<span class="hljs-keyword">event</span>.detail / <span class="hljs-number">3</span>;
                }
                <span class="hljs-keyword">if</span> (delta !== <span class="hljs-number">0</span>) {
                    <span class="hljs-comment">// calculate the new scale</span>
                    var <span class="hljs-keyword">scale</span> = mytest.scene.scaleX;  <span class="hljs-comment">// 获取现在的缩放比例</span>
                    var zoom = delta / <span class="hljs-number">10</span>;
                    <span class="hljs-keyword">if</span> (delta &lt; <span class="hljs-number">0</span>) {
                        zoom = zoom / (<span class="hljs-number">1</span> - zoom);
                    }
                    <span class="hljs-keyword">scale</span> <span class="hljs-variable">*=</span> <span class="hljs-number">1</span> + zoom;

                    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">scale</span>&gt;<span class="hljs-number">0.5</span> &amp;&amp; <span class="hljs-keyword">scale</span> &lt; <span class="hljs-number">5</span>){
                        mytest.scene.zoom(<span class="hljs-keyword">scale</span>, <span class="hljs-keyword">scale</span>);
                    }<span class="hljs-keyword">else</span>{
                        <span class="hljs-comment">//mytest.scene.zoom(scale, scale);</span>
                        console.<span class="hljs-keyword">log</span>(<span class="hljs-string">"不在范围内不执行"</span>);
                    }

                }

                <span class="hljs-comment">// Prevent default actions caused by mouse wheel.</span>
                <span class="hljs-keyword">event</span>.preventDefault();


                <span class="hljs-comment">//     原滚轮缩放</span>
                <span class="hljs-comment">//    a.preventDefault();</span>
                n.dispatchEventToScenes(<span class="hljs-string">"mousewheel"</span>, b); <span class="hljs-comment">// </span>
                <span class="hljs-comment">//        n.dispatchEvent("mousewheel", b),</span>
                <span class="hljs-comment">//    null != n.wheelZoom &amp;&amp; (a.preventDefault ? a.preventDefault() : (a = a || window.event, a.returnValue = !1), 1 == n.eagleEye.visible &amp;&amp; n.eagleEye.update()) // 鹰眼</span>

            }</code></pre> 
<h5 id="zoomout与zoomin缩放限制"><strong>zoomOut()与zoomIn()缩放限制</strong></h5> 
<p>前段事件做了滚轮的缩放限制，后来无意发现+-两个按钮的缩放并没有被限制，一看源码才发现，两个功能并不是使用的同一个方法。 <br> 放大按钮使用的是zoomOut()方法</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver">                this.zoomOut = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">a</span>) {<!-- --></span>
                    <span class="hljs-number">0</span> != <span class="hljs-operator">a</span> &amp;&amp; (<span class="hljs-constant">null</span> == <span class="hljs-operator">a</span> &amp;&amp; (<span class="hljs-operator">a</span> = <span class="hljs-number">.8</span>), this.scaleX /= <span class="hljs-operator">a</span>, this.scaleY /= <span class="hljs-operator">a</span>)
                },</code></pre> 
<p>缩小按钮使用的是zoomIn()方法</p> 
<pre class="prettyprint"><code class=" hljs livecodeserver">                this.zoomIn = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-title">a</span>) {<!-- --></span>
                    <span class="hljs-number">0</span> != <span class="hljs-operator">a</span> &amp;&amp; (<span class="hljs-constant">null</span> == <span class="hljs-operator">a</span> &amp;&amp; (<span class="hljs-operator">a</span> = <span class="hljs-number">.8</span>), this.scaleX *= <span class="hljs-operator">a</span>, this.scaleY *= <span class="hljs-operator">a</span>)
                },</code></pre> 
<p>调用这两个方法：</p> 
<pre class="prettyprint"><code class=" hljs javascript">        $(<span class="hljs-string">'#zoomOutButton'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
            mytest.stage.zoomOut();
        });
        $(<span class="hljs-string">'#zoomInButton'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
            mytest.stage.zoomIn();
        });</code></pre> 
<p>加上限制：</p> 
<pre class="prettyprint"><code class=" hljs javascript">        $(<span class="hljs-string">'#zoomOutButton'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
            <span class="hljs-keyword">if</span>(mytest.scene.scaleX*<span class="hljs-number">1.2</span>&lt; <span class="hljs-number">3</span>)
            mytest.stage.zoomOut();
        });
        $(<span class="hljs-string">'#zoomInButton'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>{<!-- --></span>
            <span class="hljs-keyword">if</span>(mytest.scene.scaleX*<span class="hljs-number">0.8</span> &gt; <span class="hljs-number">0.2</span>)
            mytest.stage.zoomIn();
        });</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9f64c4bd4b5004c99baa2f589d3651b5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【React Native】开源一个自己入门学习的小项目</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/24ee4aadd1360930a6784b12973b1126/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用Spring @DependsOn控制bean加载顺序</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>