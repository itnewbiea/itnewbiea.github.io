<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>websocket 简单入门 代码 前后端 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="websocket 简单入门 代码 前后端" />
<meta property="og:description" content="websocket 就是为了 前后端一直交互的，建立一次连接 可以进行多次信息传输 前端代码 这边 ws 里面的连接 地址按自己的 来修改 后面的地址是 在后端的注解@ServerEndpoint（） 上的
&lt;script src=&#34;jquery.js&#34;&gt;&lt;/script&gt; &lt;script src=&#34;https://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js&#34;&gt;&lt;/script&gt; &lt;script&gt; var websocket = null; //判断当前浏览器是否支持WebSocket，是则创建WebSocket if (&#39;WebSocket&#39; in window) { console.log(&#34;浏览器支持Websocket&#34;); websocket = new WebSocket(&#34;ws://localhost:8080/websocket/test&#34;); } else { alert(&#39;当前浏览器 Not support websocket&#39;) } //连接发生错误的回调方法 websocket.onerror = function () { console.log(&#34;WebSocket连接发生错误&#34;); setMessageInnerHTML(&#34;WebSocket连接发生错误&#34;); }; //连接成功建立的回调方法 websocket.onopen = function () { // setMessageInnerHTML(&#34;WebSocket连接成功&#34;); console.log(&#34;WebSocket连接成功&#34;); } //接收到消息的回调方法 websocket.onmessage = function (event) { if (event.data) { setMessageInnerHTML(event." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8b7a38e75d38b6ff1ab7dcc7df5a8c32/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-18T12:41:57+08:00" />
<meta property="article:modified_time" content="2023-02-18T12:41:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">websocket 简单入门 代码 前后端</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="">websocket 就是为了 前后端一直交互的，建立一次连接 可以进行多次信息传输 </p> 
 <h2 style="">前端代码</h2> 
 <p style="">这边 ws 里面的连接 地址按自己的 来修改 后面的地址是 在后端的注解@ServerEndpoint（） 上的</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">&lt;script src="jquery.js"&gt;&lt;/script&gt;
 &lt;script src="https://cdn.bootcss.com/bootstrap/3.3.2/js/bootstrap.min.js"&gt;&lt;/script&gt;

&lt;script&gt;

    var websocket = null;
    //判断当前浏览器是否支持WebSocket，是则创建WebSocket
    if ('WebSocket' in window) {
        console.log("浏览器支持Websocket");
        websocket = new WebSocket("ws://localhost:8080/websocket/test");
    } else {
        alert('当前浏览器 Not support websocket')
    }

    //连接发生错误的回调方法
    websocket.onerror = function () {
        console.log("WebSocket连接发生错误");
        setMessageInnerHTML("WebSocket连接发生错误");
    };
    //连接成功建立的回调方法
    websocket.onopen = function () {
//    setMessageInnerHTML("WebSocket连接成功");
        console.log("WebSocket连接成功");
    }
    //接收到消息的回调方法
    websocket.onmessage = function (event) {
        if (event.data) {
            setMessageInnerHTML(event.data);
        }
        console.log(event.data);
    }
    //连接关闭的回调方法
    websocket.onclose = function () {
        console.log("WebSocket连接关闭");
    }

    //关闭WebSocket连接
    function closeWebSocket() {
        websocket.close();
    }

    //发送消息
    function send() {
        var message = document.getElementById('text').value;
        websocket.send(message);
    }

    // 建立连接的方法
    function openWebSocket() {
        // websocket = new WebSocket("ws://localhost:8888/websocket/乔丹");
        websocket = new websocket("ws://localhost:8080/websocket/test");
        websocket.onopen = function () {
//    setMessageInnerHTML("WebSocket连接成功");
            console.log("WebSocket连接成功");
        }
    }


    //将消息显示在网页上

    function setMessageInnerHTML(innerHTML) {

        document.getElementById('message').innerHTML += innerHTML + '&lt;br/&gt;';

    }

    //如果websocket连接还没断开就关闭了窗口，后台server端会抛异常。
    //所以增加监听窗口关闭事件，当窗口关闭时，主动去关闭websocket连接
    window.onbeforeunload = function () {
        closeWebSocket();
    }


&lt;/script&gt;</code></pre> 
 <p style=""></p> 
 <p style=""></p> 
 <p style=""></p> 
 <h2 style="">后端代码</h2> 
 <p style=""></p> 
 <p style="">后端的话 要 先导入依赖--</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">  &lt;dependency&gt;
            &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
            &lt;artifactId&gt;spring-boot-starter-websocket&lt;/artifactId&gt;
        &lt;/dependency&gt;</code></pre> 
 <p style=""></p> 
 <p style="">然后配置放入bean 这边写一个类</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">@Configuration
public class Websocktconfig {

    @Bean
    public ServerEndpointExporter serverEndpointExporter(){
        return new ServerEndpointExporter();
    }

}</code></pre> 
 <p style=""></p> 
 <p style="">之后就是 正式开始写 </p> 
 <p style="">这里写了 三个 注解 一个广播发送消息 想单独发送消息 可以把set换成 map来装websocket</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">package person.websocket;


import lombok.extern.slf4j.Slf4j;
import org.springframework.stereotype.Component;

import javax.websocket.OnClose;
import javax.websocket.OnMessage;
import javax.websocket.OnOpen;
import javax.websocket.Session;
import javax.websocket.server.ServerEndpoint;
import java.io.IOException;
import java.util.concurrent.CopyOnWriteArraySet;

@Component
@Slf4j
@ServerEndpoint("/websocket/test")
public class Websocket {

    private Session session;



    public static CopyOnWriteArraySet&lt;Websocket&gt; set = new CopyOnWriteArraySet&lt;&gt;() ;

    @OnOpen
    public void onOpean(Session session){
        this.session = session;
        set.add(this);
        log.info("websocket建立连接"+"连接总数 "+set.size());
    }


    @OnClose
    public void onClose(){

        set.remove(this);
        log.info("websocket关闭连接"+set.size());

    }

    @OnMessage
    public void onMessage(String mes){

        log.info("收到的消息"+mes);
    }


    public static void sendmes(String s){

        log.info("像前端发送消息");
        for (Websocket websocket : set) {
            try {
                websocket.session.getBasicRemote().sendText(s);
            } catch (IOException e) {
                e.printStackTrace();
            }
        }

    }





}
</code></pre> 
 <p style=""></p> 
 <h2 style="">启动后 本地运行：</h2> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1665px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:83.12312%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/6e/xImBvSMO_o.png" style="margin-left:;display:block;width:1665px;margin-top:-83.12312%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1429px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:27.361792%;height:0;"> 
    <img src="https://images2.imgbox.com/a7/d5/QxJ9l0J8_o.png" style="margin-left:;display:block;width:1429px;margin-top:-27.361792%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">我这边开了两个窗口 显示为2</p> 
 <p style=""></p> 
 <p style=""></p> 
 <p style=""></p> 
 <p style=""></p> 
 <p style="">写了个接口 --》测试发送消息：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:438px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:44.97717%;height:0;"> 
    <img src="https://images2.imgbox.com/6d/eb/xCVP3uCQ_o.png" style="margin-left:;display:block;width:438px;margin-top:-44.97717%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">这边我就直接用浏览器访问了</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1759px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:25.298464%;height:0;"> 
    <img src="https://images2.imgbox.com/43/e5/CLuJHSS8_o.png" style="margin-left:;display:block;width:1759px;margin-top:-25.298464%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:1578px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:31.051964%;height:0;"> 
    <img src="https://images2.imgbox.com/ed/23/xtx9TjUv_o.png" style="margin-left:;display:block;width:1578px;margin-top:-31.051964%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style=""></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0f2c084f6e3354e88bffd1a96bcf2171/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">梅科尔工作室-任采薇-鸿蒙笔记1</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b12f3036d2b0fad20bdf12a9cde9e548/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">GNN之节点分类任务—Cora数据集分类（半监督）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>