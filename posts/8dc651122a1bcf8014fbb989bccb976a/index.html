<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AE （4）_ 直方图调整的理论 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="AE （4）_ 直方图调整的理论" />
<meta property="og:description" content="#灵感# 在短暂的高通平台调试中，很看重直方图调整的理解。后来其它平台，不怎么调整这个了。但还是记录一下。 我个人还是倾向 招式简单，但应用到极致。
绝大部分内容来自：刘斯宁，Image Enhancement - CLAHE - 知乎 (zhihu.com)
穿插个人的部分理解。
目录
英文解释：
对比度：
简单---对比度拉伸：
升级---直方图均衡化 HE：
直方图均衡的局限：
改进---自适应直方图均衡化（AHE）：
高通平台的直方图调整---好像不一样：
另个平台的直方图-----只是参与亮度计算：
英文解释： A histogram is a type of graph that has wide applications in statistics. Histograms provide a visual interpretation of numerical data by indicating the number of data points that lie within a range of values. These ranges of values are called classes or bins. The frequency of the data that falls in each class is depicted by the use of a bar." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8dc651122a1bcf8014fbb989bccb976a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T16:03:48+08:00" />
<meta property="article:modified_time" content="2024-01-04T16:03:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AE （4）_ 直方图调整的理论</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>#灵感# 在短暂的高通平台调试中，很看重直方图调整的理解。后来其它平台，不怎么调整这个了。但还是记录一下。 我个人还是倾向 招式简单，但应用到极致。</p> 
<p>绝大部分内容来自：刘斯宁，<a href="https://zhuanlan.zhihu.com/p/150381937" rel="nofollow" title="Image Enhancement - CLAHE - 知乎 (zhihu.com)">Image Enhancement - CLAHE - 知乎 (zhihu.com)</a></p> 
<p>穿插个人的部分理解。</p> 
<p id="main-toc"><strong>目录</strong></p> 
<p id="%E8%8B%B1%E6%96%87%E8%A7%A3%E9%87%8A%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E8%8B%B1%E6%96%87%E8%A7%A3%E9%87%8A%EF%BC%9A" rel="nofollow">英文解释：</a></p> 
<p id="%E5%AF%B9%E6%AF%94%E5%BA%A6%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E5%AF%B9%E6%AF%94%E5%BA%A6%EF%BC%9A" rel="nofollow">对比度：</a></p> 
<p id="%E7%AE%80%E5%8D%95---%E5%AF%B9%E6%AF%94%E5%BA%A6%E6%8B%89%E4%BC%B8%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E7%AE%80%E5%8D%95---%E5%AF%B9%E6%AF%94%E5%BA%A6%E6%8B%89%E4%BC%B8%EF%BC%9A" rel="nofollow">简单---对比度拉伸：</a></p> 
<p id="%E5%8D%87%E7%BA%A7---%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96%20HE%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E5%8D%87%E7%BA%A7---%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96%20HE%EF%BC%9A" rel="nofollow">升级---直方图均衡化 HE：</a></p> 
<p id="%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E7%9A%84%E5%B1%80%E9%99%90%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E7%9A%84%E5%B1%80%E9%99%90%EF%BC%9A" rel="nofollow">直方图均衡的局限：</a></p> 
<p id="%E6%94%B9%E8%BF%9B---%E8%87%AA%E9%80%82%E5%BA%94%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96%EF%BC%88AHE%EF%BC%89%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E6%94%B9%E8%BF%9B---%E8%87%AA%E9%80%82%E5%BA%94%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96%EF%BC%88AHE%EF%BC%89%EF%BC%9A" rel="nofollow">改进---自适应直方图均衡化（AHE）：</a></p> 
<p id="%E9%AB%98%E9%80%9A%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BE%E8%B0%83%E6%95%B4---%E5%A5%BD%E5%83%8F%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E9%AB%98%E9%80%9A%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BE%E8%B0%83%E6%95%B4---%E5%A5%BD%E5%83%8F%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%9A" rel="nofollow">高通平台的直方图调整---好像不一样：</a></p> 
<p id="%E5%8F%A6%E4%B8%AA%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BE-----%E5%8F%AA%E6%98%AF%E5%8F%82%E4%B8%8E%E4%BA%AE%E5%BA%A6%E8%AE%A1%E7%AE%97%EF%BC%9A-toc" style="margin-left:80px;"><a href="#%E5%8F%A6%E4%B8%AA%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BE-----%E5%8F%AA%E6%98%AF%E5%8F%82%E4%B8%8E%E4%BA%AE%E5%BA%A6%E8%AE%A1%E7%AE%97%EF%BC%9A" rel="nofollow">另个平台的直方图-----只是参与亮度计算：</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h4 id="%E8%8B%B1%E6%96%87%E8%A7%A3%E9%87%8A%EF%BC%9A" style="margin-left:0px;text-align:justify;"><strong>英文解释：</strong></h4> 
<p style="margin-left:0;text-align:justify;">A histogram is<strong> a type of graph that has wide applications in statistics</strong>. Histograms provide a visual interpretation of numerical data by indicating the number of data points that lie within a range of values. These ranges of values are called classes or bins. The frequency of the data that falls in each class is depicted by the use of a bar.</p> 
<p style="margin-left:0;text-align:justify;">翻译过来就是，直方图是统计学中广泛使用的一类图表，它以可视化的形式呈现统计数据，能够显示数据点在给定的数值区间内的<strong>分布情况</strong>。</p> 
<p style="margin-left:0;text-align:justify;">以常用的8位精度图像为例，直方图的X轴为0~255，共256个桶，每个桶刚好覆盖1个像素值，直方图的Y轴表示每个桶盛纳了多少个像素。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="368" src="https://images2.imgbox.com/6a/21/VoDEfHsH_o.png" width="437"></p> 
<h4 id="%E5%AF%B9%E6%AF%94%E5%BA%A6%EF%BC%9A" style="margin-left:0px;text-align:justify;"><strong>对比度：</strong></h4> 
<p style="margin-left:0;text-align:justify;">图像对比度指一幅图像中最亮的白和最暗的黑之间灰度反差的大小。差异越大代表对比越大，否则对比越小。一种常用的定量度量方法是Michelson对比度，定义为</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="66" src="https://images2.imgbox.com/4d/20/zvl4mPHt_o.png" width="191"></p> 
<p style="margin-left:0;text-align:justify;">当一幅图像最白和最黑像素灰度都是128时，图像对比度最低，C=0。</p> 
<p style="margin-left:0;text-align:justify;">当一幅图像最白像素灰度=255，最黑像素灰度=0时，图像对比度最高，C=1.0。</p> 
<p style="margin-left:0;text-align:justify;">当一幅图像最白像素灰度=140，最黑像素灰度=80时，图像对比度C=0.27。-----自己<span style="color:#1c7331;">算个例子√</span></p> 
<p style="margin-left:0;text-align:justify;">当一幅图像最白像素灰度=140，最黑像素灰度=60时，图像对比度C=0.4。</p> 
<p style="margin-left:0;text-align:justify;">--------------------所以最白和最黑的差距越大时，图像对比度会越大。</p> 
<p style="margin-left:0;text-align:justify;">图像的直方图集中在中间的几个桶，图像看起来灰蒙蒙的，英语中使用dull(阴沉的;低沉的;无光泽的;萧条的;隐约的;不鲜明的;隐隐约约的;不清晰的;令人生厌的;不明亮的) 描述这种效果。</p> 
<p style="margin-left:0;text-align:justify;">相反，如果黑白像素的跨度较大，则图像富有通透感，英语中使用clarity（清楚;(画面、物质或声音的)清晰，清澈;）描述这种效果。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="299" src="https://images2.imgbox.com/ba/6a/P1gw1guy_o.png" width="398"></p> 
<h4 id="%E7%AE%80%E5%8D%95---%E5%AF%B9%E6%AF%94%E5%BA%A6%E6%8B%89%E4%BC%B8%EF%BC%9A" style="margin-left:0px;text-align:justify;"><strong>简单---对比度拉伸：</strong></h4> 
<p style="margin-left:0;text-align:justify;">将一个灰蒙蒙的图像，拉伸直方图，使画面更通透。</p> 
<p style="margin-left:0;text-align:justify;">基本思想是用一个下图所示分段线性函数（Piece-Wise Linear, PWL Function）对像素亮度进行映射。------------线性的、分段、3个函数</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="166" src="https://images2.imgbox.com/a2/ac/rihILOCY_o.png" width="210"> <img alt="" height="319" src="https://images2.imgbox.com/d6/75/JT4LE8zo_o.jpg" width="369"></p> 
<p style="margin-left:0;text-align:justify;">局限：对比度拉伸适合处理低动态（LDR）图像，这类图像的特点是直方图的跨度较小，存在向两极拉伸的空间。对于高动态（HDR）图像，直方图跨度已经很大，对比度拉伸没有操作的空间，</p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h4 id="%E5%8D%87%E7%BA%A7---%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96%20HE%EF%BC%9A" style="margin-left:0px;text-align:justify;"><strong>升级---直方图均衡化 HE：</strong></h4> 
<p style="margin-left:0;text-align:justify;"><span style="color:#ed7d31;">均衡化</span>被认为是提升图像对比度最为有效的方法，它的基本思想是用数学方法重新调整像素的亮度分布（和拉伸差不多），使<strong>调整后的直方图具有最大的动态范围，每个桶（bin/bucket）盛纳的像素数量几乎相等</strong>。<strong><span style="color:#1c7892;">------这样就会使图像的灰度级增加，从而可达到图像对比度整体增强的效果。</span></strong>！</p> 
<p style="margin-left:0;text-align:justify;">直方图均衡的方法是dy=p(x)dx，意义是将源直方图<strong>dx宽度</strong>所盛纳的p(x)dx个像素映射到目标直方图的<strong>dy宽度中</strong>，映射前后像素数量不变，密度发生变化，<strong>分布更均匀</strong>。如下图所示。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="170" src="https://images2.imgbox.com/9b/82/suEIt03n_o.png" width="759"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="303" src="https://images2.imgbox.com/3e/7f/JYnwFi8D_o.png" width="413"></p> 
<p style="margin-left:0;text-align:justify;">右侧图的中部、亮部区域的像素分布更加均匀。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="171" src="https://images2.imgbox.com/dd/0f/Yl77KfME_o.png" width="454"></p> 
<p style="margin-left:0;text-align:justify;">对直方图拉伸和均衡两种方法的效果做比较：</p> 
<p style="margin-left:0;text-align:justify;">-----------------（此图直方图均衡后，好像效果也没那么好）</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="260" src="https://images2.imgbox.com/c5/3f/EpykvKBI_o.png" width="520"></p> 
<h4 id="%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E7%9A%84%E5%B1%80%E9%99%90%EF%BC%9A" style="margin-left:0px;text-align:justify;">直方图均衡的局限：</h4> 
<p style="margin-left:0;text-align:justify;">当原图的直方图比较集中时，这意味着原图实际上只出现了少数几个颜色值，如果对原图进行拉伸操作，则这些<strong><span style="color:#ed7d31;">颜色之间的距离就会变大</span></strong>，直方图上留下了更多空洞，这样，原本比较接近的颜色在拉伸后的图上会出现显著的差异，图像出现颜色分层现象（banding），或者叫分色现象。</p> 
<p style="margin-left:0;text-align:justify;">------------右图出现很多异常颜色</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="401" src="https://images2.imgbox.com/b5/e6/Y7Px5X53_o.png" width="486"></p> 
<p style="margin-left:0;text-align:justify;">对齐问题：</p> 
<p style="margin-left:0;text-align:justify;">直方图均衡的一个重要特征是把原图中最亮的像素对齐到预设的最大值（比如8bit图是255）。当原图中颜色比较丰富时，这个操作一般问题不大。但是当原图中所有像素都是一个值（例如8，这对应一幅纯黑的图像，可能是拍摄于夜间），则均衡之后所有像素都被映射到255，图像变成了纯白的。于是，直方图均衡相当于无脑改变了原图的色调。<strong>----------比如下图的映射，改变了色调</strong>。</p> 
<p style="margin-left:0;text-align:justify;">另外还会产生噪声问题，如果一个区域的像素分布大体是均匀的，但是图像中带有一些噪声，则HE变换函数会把原图中很窄的x值分布映射到整个y值空间，这同时也就放大了原图中的噪声。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="455" src="https://images2.imgbox.com/02/9a/4AoK8iw9_o.png" width="914"></p> 
<h4 id="%E6%94%B9%E8%BF%9B---%E8%87%AA%E9%80%82%E5%BA%94%E7%9B%B4%E6%96%B9%E5%9B%BE%E5%9D%87%E8%A1%A1%E5%8C%96%EF%BC%88AHE%EF%BC%89%EF%BC%9A" style="margin-left:0px;text-align:justify;"><span style="color:#4472c4;">改进---</span><strong>自适应直方图均衡化（AHE）：</strong></h4> 
<p style="margin-left:0;text-align:justify;">将图像分成若干个区域（tile），比如8x8=64个tile，直方图均衡的基本单位不再是整个图像，而是对<strong>每个小区域</strong>做直方图均衡。AHE 更适合于用来改善图像的<strong>局部对比度</strong>，以及增强图像边缘信息，但是并没有解决直方图均衡会放大图像噪声的问题。</p> 
<p style="margin-left:0;text-align:justify;">-------------每一小块图像统计一个各自专属的分布函数，这样有利于更好地处理图像数据的局部细节，但是由于图像被等分为几块分别处理，这会导致算法的时间复杂度提高不少，降低了图像处理效率。    并且还有另一个缺点，由于AHE算法是对每个像素块独立进行处理映射，也就是块与块之间并没有做一个过渡处理，这样会导致一个问题现象，那就是图像呈现出来的效果就像是被切割成了几个块。<br>  </p> 
<p style="margin-left:0;text-align:justify;"><strong>限制对比度+自适应直方图均衡 CL AHE：</strong></p> 
<p style="margin-left:0;text-align:justify;">削峰填谷，把我们认为多余的概率平均分摊给其它像素，使亮度增益相对均匀地散布到所有像素上，而不是让某一个颜色突然地对齐到最大亮度。【分析那个黑图像被对齐到全白的例子。如果用CLAHE来处理这个黑图，我们可以拍脑袋规定直方图每个bin的频数不能超过总像素数的50%，超过的部分要被均摊到各个bin中。】</p> 
<p style="margin-left:0;text-align:justify;">以下图为例，由于CLAHE 人为削减了最亮像素的频数（比如不超过10%），所以CLAHE图的亮区得到了抑制，而暗区的亮度得到了明显的提升。</p> 
<p style="margin-left:0;text-align:justify;">----------------------------------------------无脑的HE均衡化。-------------分区均衡化 + 增益分布均匀。</p> 
<p style="margin-left:0;text-align:justify;"> original histogram                                  HE histogram                                CLAHE histogram</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="470" src="https://images2.imgbox.com/7c/7f/QYfwJglF_o.png" width="1001"></p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="229" src="https://images2.imgbox.com/fa/cf/AmV0USUa_o.png" width="1110"></p> 
<h4 id="%E9%AB%98%E9%80%9A%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BE%E8%B0%83%E6%95%B4---%E5%A5%BD%E5%83%8F%E4%B8%8D%E4%B8%80%E6%A0%B7%EF%BC%9A" style="margin-left:0px;text-align:justify;">高通平台的直方图调整---好像不一样：</h4> 
<p>按下述取target 的方案，高通的直方图调整是整体的亮度，不能兼顾：亮部压制+ 暗处提亮。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="401" src="https://images2.imgbox.com/ce/14/Qoxcx9ui_o.png" width="865"></p> 
<p style="margin-left:0;text-align:justify;"></p> 
<h4 id="%E5%8F%A6%E4%B8%AA%E5%B9%B3%E5%8F%B0%E7%9A%84%E7%9B%B4%E6%96%B9%E5%9B%BE-----%E5%8F%AA%E6%98%AF%E5%8F%82%E4%B8%8E%E4%BA%AE%E5%BA%A6%E8%AE%A1%E7%AE%97%EF%BC%9A" style="margin-left:0px;text-align:justify;">另个平台的直方图-----只是参与亮度计算：</h4> 
<p>将直方图划分区域，判断画面过曝情况，然后进行target 调整。也无法做到亮处+暗处的调整。</p> 
<p style="margin-left:0;text-align:justify;"><img alt="" height="72" src="https://images2.imgbox.com/61/8b/c6UesCwX_o.png" width="384"></p> 
<p style="margin-left:0;text-align:justify;">通过high level 计算出高亮的highCut， highCut越大则表示过曝区越多，则降低曝光，</p> 
<p style="margin-left:0;text-align:justify;">直到把highCut收敛到highCutTarget结束。</p> 
<p style="margin-left:0;text-align:justify;"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e6cffeddfff127a1588cfcab446e93da/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CSS免费在线字体格式转换器 CSS @font-face 生成器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/008c815246e59e39b6a43eeee35a4a12/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux引导过程和服务</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>