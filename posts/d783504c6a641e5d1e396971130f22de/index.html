<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>S3c2440如何利用JLINK烧写U-boot到NAND Flash中 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="S3c2440如何利用JLINK烧写U-boot到NAND Flash中" />
<meta property="og:description" content="很多同学使用笔记本作为自己的ARM开发和学习的平台，绝大多数笔记本都没有并口，也就是无法使用JTag调试和烧写程序到Nand Flash中，幸好我们还有JLINK，用JLINK烧写U-boot到Nor Flash中很简单，大部分NOR Flash都已经被JLink的软件SEGGER所支持，而新手在学习的时候经常会实验各种各样的命令，最悲剧的莫过于将NAND Flash中原有的bootloader给删除了，这时候开发板上电后由于没有bootloader，硬件没有被初始化，在NAND Flash中的操作系统也就无法被加载，开发板成“砖”了，这时候笔记本又无法利用JTag烧写程序进Nand Flash。起始这些可以利用JLink通过两种方法解决：
提示：Nor Flash是可以像内存SDRAM一样直接操作，但是NAND Flash必须操作nand的控制器。
一、方法一，利用NOR Flash。
这种方法是利用JLink能够烧写程序到NOR Flash来完成的，首先利用J-FLASH ARM将u-boot.bin烧写进NOR Flash（记得烧写到NOR Flash的0x0起始地址处），然后设置开发板从NOR Flash启动，这时候系统进入U-boot命令行模式，这时候打开J-Link commander，输入命令：r 看JLink是否能识别开发板的信息（也就是判断JLink是否连接正常）。/* 此时SDRAM已经初始化好了 */
以下是在J-Link commander里的命令，先假设u-boot.bin在你电脑的D盘根目录下。
执行命令方式如下：
h speed 12000 //设置TCK为12M，下载程序时会很快 loadbin d:\u-boot.bin 0x30000000 //注意：0x30000000是你想要下载u-boot.bin到开发板的内存地址，内存地址根据不同的开发板设定不同，因为本文中使用的是FL2440，片上系统是S3C2440，内存挂载的地址区域是0x30000000~0x33ffffff，我们只需要把u-boot.bin下载到这片区域即可， 然后我们在U-boot命令行模式输入NAND Flash擦除和写入命令即可：
nand erase 0 40000 //擦除从0地址开始的大小为0x40000的Nnad Flash扇区，0x40000是待写入的U-boot.bin的大致长度，长度必须为NAND Flash页大小的整数倍，通常会需要比u-boot.bin实际长度。
nand write 30000000 0 40000 // 把前面下载到0x30000000的u-boot.bin烧写到Nand的 0 ~40000 二、方法二，直接通过JLink
假如你的开发板没有NOR Flash或者是你使用的NOR Flash还未被J-FLASH ARM所支持，这时上面的方法你就无法使用了，这时候你需要一个初始化内存SDRAM的程序，这个程序完成的功能也就是配置好SDRAM的寄存器，使它能正常工作，fl2440的内存初始化程序下载地址：“2440init.bin”。你还需要准备一个特殊的u-boot_SDRAM.bin，它与你要烧写到NAND Flash的u-boot.bin有区别，u-boot_SDRAM.bin编译时需要在include/configs/fl2440.h文件中添加：
#define CONFIG_SKIP_LOWLEVEL_INIT 1 //用来支持uboot在内存中直接运行 跳过底层初始化 。添加这个宏定义之后，U-boot就跳过了内存初始化的部分，因为此时我们的内存已经先由“2440init.bin“初始化好了，再次初始化会出现内存数据的丢失。
做好上面的准备工作之后，首先将开发板设为从NAND Flash启动，启动J-Link commander，先假设“uboot.bin”和“2440init.bin”，&#34;u-boot_SDRAM.bin&#34;在电脑的D盘根目录下。
h speed 12000" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d783504c6a641e5d1e396971130f22de/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-10-24T12:36:00+08:00" />
<meta property="article:modified_time" content="2015-10-24T12:36:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">S3c2440如何利用JLINK烧写U-boot到NAND Flash中</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="content-detail markdown-body"> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">      很多同学使用笔记本作为自己的ARM开发和学习的平台，绝大多数笔记本都没有并口，也就是无法使用JTag调试和烧写程序到Nand Flash中，幸好我们还有JLINK，用JLINK烧写U-boot到Nor Flash中很简单，大部分NOR Flash都已经被JLink的软件SEGGER所支持，而新手在学习的时候经常会实验各种各样的命令，最悲剧的莫过于将NAND Flash中原有的bootloader给删除了，这时候开发板上电后由于没有bootloader，硬件没有被初始化，在NAND Flash中的操作系统也就无法被加载，开发板成“砖”了，这时候笔记本又无法利用JTag烧写程序进Nand Flash。起始这些可以利用JLink通过两种方法解决：</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;"><span style="color:#3333ff;">提示：</span><span style="font-family:Arial;line-height:26px;"><span style="color:#3333ff;">Nor Flash是可以像内存SDRAM一样直接操作，但是<span style="font-family:Arial;line-height:26px;">NAND Flash必须操作nand的控制器。</span></span></span></span></p> 
 <p><span style="font-size:18px;color:#666666;"><br></span></p> 
 <p style="font-family:Arial;line-height:26px;"><strong><span style="font-size:18px;color:#666666;">一、方法一，利用NOR Flash。</span></strong></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">        这种方法是利用JLink能够烧写程序到NOR Flash来完成的，首先利用J-FLASH ARM将u-boot.bin烧写进NOR Flash（记得烧写到NOR Flash的0x0起始地址处），然后设置开发板从NOR Flash启动，这时候系统进入U-boot命令行模式，这时候打开J-Link commander，输入命令：r 看JLink是否能识别开发板的信息（也就是判断JLink是否连接正常）。/* 此时SDRAM已经初始化好了 */</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">以下是在J-Link commander里的命令，先假设u-boot.bin在你电脑的D盘根目录下。</span></p> 
 <p style="font-family:Arial;line-height:26px;"><strong><span style="font-size:18px;color:#666666;">执行命令方式如下：</span></strong></p> 
 <p style="font-family:Arial;line-height:26px;"><strong><span style="font-size:18px;color:#666666;">h   </span></strong></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;"><strong>speed 12000               //设置TCK为12M，下载程序时会很快 <br> loadbin d:\u-boot.bin 0x30000000     //注意：0x30000000是你想要下载u-boot.bin到开发板的内存地址，内存</strong><span style="font-weight:bold;">地址根据不同的开发板设定不同，因为本文中使用的是FL2440，片上系统是S3C2440，内存挂载的地址区域</span><span style="font-weight:bold;">是0x30000000~0x33ffffff，我们只需要把u-boot.bin下载到这片区域即可， </span></span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;"><span style="font-weight:bold;"> </span></span></p> 
 <p style="font-family:Arial;line-height:26px;"><strong><span style="font-size:18px;color:#666666;">然后我们在U-boot命令行模式输入NAND Flash擦除和写入命令即可：<br></span></strong></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;"><strong>nand erase 0 40000   //擦除从0地址开始的大小为0x40000的Nnad Flash扇区，0x40000是待写入的U-boot.bin</strong><span style="font-weight:bold;">的大致长度，长度必须为NAND Flash页大小的整数倍，通常会需要比u-boot.bin实际长度。</span></span></p> 
 <p style="font-family:Arial;line-height:26px;"><strong><span style="font-size:18px;color:#666666;">nand write 30000000 0 40000   // 把前面下载到0x30000000的u-boot.bin烧写到Nand的 <span style="font-family:Arial;line-height:26px;"><strong>0 ~40000 </strong></span></span></strong></p> 
 <p style="font-family:Arial;line-height:26px;"><strong><span style="font-family:Arial;line-height:26px;"><strong><span style="font-size:18px;color:#666666;"><br></span></strong></span></strong></p> 
 <p style="font-family:Arial;line-height:26px;"><strong><span style="font-size:18px;color:#666666;">  二、方法二，直接通过JLink</span></strong></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">        假如你的开发板没有NOR Flash或者是你使用的NOR Flash还未被J-FLASH ARM所支持，这时上面的方法你就无法使用了，这时候你需要一个初始化内存SDRAM的程序，这个程序完成的功能也就是配置好SDRAM的寄存器，使它能正常工作，fl2440的内存初始化程序<a href="http://download.csdn.net/detail/yanghao23/4391863" style="text-decoration:none;">下载地址</a>：“2440init.bin”。你还需要准备一个特殊的u-boot_SDRAM.bin，它与你要烧写到NAND Flash的u-boot.bin有区别，u-boot_SDRAM.bin编译时需要在include/configs/fl2440.h文件中添加：</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">#define  CONFIG_SKIP_LOWLEVEL_INIT     1 //用来支持uboot在内存中直接运行  跳过底层初始化 。添加这个宏定义之后，U-boot就跳过了内存初始化的部分，因为此时我们的内存已经先由“2440init.bin“初始化好了，再次初始化会出现内存数据的丢失。</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">   做好上面的准备工作之后，首先将开发板设为从NAND Flash启动，启动J-Link commander，先假设“uboot.bin”和“2440init.bin”，"u-boot_SDRAM.bin"在电脑的D盘根目录下。</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">h </span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">speed 12000<br> loadbin d:\2440init.bin  0      /* 初始化SDRAM的程序，就是U-boot的start.S修改的 */<br> setpc 0  </span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">g</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;"> h <br></span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">  为什么需要把"2440init.bin"复制到0x0地址是因为S3C2440有4K的SRAM，它不需要初始化就可以直接执行程序，从NAND Flash启动时，这个SRAM的地址会挂载到0x0~0x1000的地址空间，我们先把"2440init.bin"复制到SRAM中运行，执行这部分后S3C2440的SDRAM内存就初始化好了（地址空间0x30000000~0x33ffffff）。也许有人会说为什么不一开始就把u-boot_SDRAM.bin放在SRAM中运行啊？SRAM只有4K的大小，而U-boot通常在100~300K，SRAM的空间显然不够，而"2440init.bin"的大小只有不到2K，它可以在SRAM中运行。</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">内存初始化成功后，下载特制的u-boot_SDRAM.bin</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">loadbin d:\u-boot.bin 0x30000000     //用来临时存放数据，存放的是真正的u-boot.bin</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">loadbin d:\u-boot_sdram.bin 0x33f80000           / /0x33f80000 是把U-boot放在SDRAM内存最上面的512k的空间<br> setpc 0x33f80000                                      /* 启动我们跳过底层初始化的u-boot.bin */<br> g                                                                 //TEXT_BASE = 0x33F80000<br></span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">      这时你应该可以在串口看到U-boot的输出信息了，然后我们在U-boot命令行模式输入NAND Flash擦除和写入命令即可：</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">nand erase 0 40000  //<br> nand write 30000000 0 40000  //把前面下载到0x3000000的u-boot.bin下载NAND</span></p> 
 <p style="font-family:Arial;line-height:26px;"><span style="font-size:18px;color:#666666;">   根据上面的步骤就可以完成u-boot到NAND Flash的烧写了，实际上是利用一个SDRAM中运行的u-boot去烧写u-boot.bin到NAND Flash中。</span></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e069e311d39d2b214538e37f1020b27b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">php unexpected end of file错误处理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bcc241de173a5b88747ceec8ff2e6571/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Windows命令行查看文件的MD5</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>