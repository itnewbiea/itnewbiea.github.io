<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Yolov7训练自己的数据集（主要是coco2yolo代码，和分割数据集） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Yolov7训练自己的数据集（主要是coco2yolo代码，和分割数据集）" />
<meta property="og:description" content="1. 下载安装Yolov7参考一下博文
(52条消息) YOLOv7保姆级教程（个人踩坑无数）----训练自己的数据集_AmbitionToFree的博客-CSDN博客
2. Yolov7支持的数据集格式为yolo格式，我的格式是json，所以需要自己转一下
注意：我这里面json格式中是两个角点（包络框左上角和右下角），不同的格式对应不同的代码，因为发现其他格式网上都有，就只有这一种没找到
代码如下：
import os import json import numpy as np import cv2 #dir_json = &#39;D:\projects\json/50zhang\ceshijson/&#39; # json存储的文件目录 dir_json = r&#39;E:\projects\json\temp\objectDetection/&#39; dir_txt = r&#39;E:\projects\json\temp\objectDetection/&#39; # txt存储目录 list_json = os.listdir(dir_json) def json2txt(path_json, path_txt): # 可修改生成格式 with open(path_json, &#39;r&#39;,encoding=&#39;utf-8&#39;) as path_json: jsonx = json.load(path_json) with open(path_txt, &#39;w&#43;&#39;) as ftxt: shapes = jsonx[&#39;shapes&#39;] # path = dir_json&#43;shape[&#39;image&#39;] # img = cv2.imread(path) # size =img.shape width=jsonx[&#39;imageWidth&#39;] height=jsonx[&#39;imageHeight&#39;] for shape in shapes: # label = str(annotation[&#39;label&#39;]) &#43; &#39; &#39; x1 = shape[&#39;points&#39;][0][0] y1 = shape[&#39;points&#39;][0][1] x2 = shape[&#39;points&#39;][1][0] y2 = shape[&#39;points&#39;][1][1] if shape[&#39;label&#39;]==&#39;trunk&#39;: cat=0 else: cat=1 dw = 1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/52c77d233643ff43c618d15e12440c38/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-25T22:16:01+08:00" />
<meta property="article:modified_time" content="2023-02-25T22:16:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Yolov7训练自己的数据集（主要是coco2yolo代码，和分割数据集）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1. 下载安装Yolov7参考一下博文</p> 
<p><a href="https://blog.csdn.net/weixin_55749226/article/details/128480595" title="(52条消息) YOLOv7保姆级教程（个人踩坑无数）----训练自己的数据集_AmbitionToFree的博客-CSDN博客">(52条消息) YOLOv7保姆级教程（个人踩坑无数）----训练自己的数据集_AmbitionToFree的博客-CSDN博客</a></p> 
<p>2. Yolov7支持的数据集格式为yolo格式，我的格式是json，所以需要自己转一下</p> 
<p>注意：我这里面<strong><span style="color:#fe2c24;">json格式中是两个角点（包络框左上角和右下角）</span></strong>，不同的格式对应不同的代码，因为发现其他格式网上都有，就只有这一种没找到</p> 
<p>代码如下：</p> 
<p> </p> 
<pre><code class="language-python">import os
import json
import numpy as np
import cv2

#dir_json = 'D:\projects\json/50zhang\ceshijson/'  # json存储的文件目录
dir_json = r'E:\projects\json\temp\objectDetection/'
dir_txt = r'E:\projects\json\temp\objectDetection/'  # txt存储目录
list_json = os.listdir(dir_json)

def json2txt(path_json, path_txt):  # 可修改生成格式
    with open(path_json, 'r',encoding='utf-8') as path_json:
        jsonx = json.load(path_json)
        with open(path_txt, 'w+') as ftxt:
            shapes = jsonx['shapes']
                # path = dir_json+shape['image']
                # img = cv2.imread(path)
                # size =img.shape
            width=jsonx['imageWidth']
            height=jsonx['imageHeight']
            for shape in shapes:
                   # label = str(annotation['label']) + ' '
                x1 = shape['points'][0][0]
                y1 = shape['points'][0][1]
                x2 = shape['points'][1][0]
                y2 = shape['points'][1][1]
                if shape['label']=='trunk':
                    cat=0
                else:
                    cat=1

                dw = 1. / width
                dh = 1. / height
                x=dw *(x1+x2)/2
                y=dh *(y1+y2)/2
                w=dw *abs(x2-x1)
                h = dh * abs(y2 - y1)
                yolo = f"{cat} {x} {y} {w} {h} \n"
                ftxt.writelines(yolo)

for cnt, json_name in enumerate(list_json):
    if os.path.splitext(json_name)[-1] == ".json":
        path_json = dir_json + json_name
        path_txt = dir_txt + json_name.replace('.json', '.txt')
        json2txt(path_json, path_txt)

</code></pre> 
<p></p> 
<p>3. 图片进行分割出训练集、验证集、测试集代码</p> 
<pre><code class="language-python"># insanena
 
import shutil
import random
import os
 
# 原始路径
image_original_path = "/home/nvidia/ghy/yolov7/data/Grape_tree_data/images/"
label_original_path = "/home/nvidia/ghy/yolov7/data/Grape_tree_data/labels/"
 
cur_path = os.getcwd()
 
# 训练集路径
train_image_path = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/images/train/")
train_label_path = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/labels/train/")
 
# 验证集路径
val_image_path = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/images/val/")
val_label_path = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/labels/val/")
 
# 测试集路径
test_image_path = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/images/test/")
test_label_path = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/labels/test/")
 
# 训练集目录
list_train = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/train.txt")
list_val = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/val.txt")
list_test = os.path.join(cur_path, "/home/nvidia/ghy/yolov7/data/Grape_tree_data/yolo/test.txt")
 
train_percent = 0.8
val_percent = 0.1
test_percent = 0.1
 
 
def del_file(path):
    for i in os.listdir(path):
        file_data = path + "\\" + i
        os.remove(file_data)
 
 
def mkdir():
    if not os.path.exists(train_image_path):
        os.makedirs(train_image_path)
    else:
        del_file(train_image_path)
    if not os.path.exists(train_label_path):
        os.makedirs(train_label_path)
    else:
        del_file(train_label_path)
 
    if not os.path.exists(val_image_path):
        os.makedirs(val_image_path)
    else:
        del_file(val_image_path)
    if not os.path.exists(val_label_path):
        os.makedirs(val_label_path)
    else:
        del_file(val_label_path)
 
    if not os.path.exists(test_image_path):
        os.makedirs(test_image_path)
    else:
        del_file(test_image_path)
    if not os.path.exists(test_label_path):
        os.makedirs(test_label_path)
    else:
        del_file(test_label_path)
 
 
def clearfile():
    if os.path.exists(list_train):
        os.remove(list_train)
    if os.path.exists(list_val):
        os.remove(list_val)
    if os.path.exists(list_test):
        os.remove(list_test)
 
 
def main():
    mkdir()
    clearfile()
 
    file_train = open(list_train, 'w')
    file_val = open(list_val, 'w')
    file_test = open(list_test, 'w')
 
    total_txt = os.listdir(label_original_path)
    num_txt = len(total_txt)
    list_all_txt = range(num_txt)
 
    num_train = int(num_txt * train_percent)
    num_val = int(num_txt * val_percent)
    num_test = num_txt - num_train - num_val
 
    train = random.sample(list_all_txt, num_train)
    # train从list_all_txt取出num_train个元素
    # 所以list_all_txt列表只剩下了这些元素
    val_test = [i for i in list_all_txt if not i in train]
    # 再从val_test取出num_val个元素，val_test剩下的元素就是test
    val = random.sample(val_test, num_val)
 
    print("TrainNum：{}, ValNum：{}, TestNum：{}".format(len(train), len(val), len(val_test) - len(val)))
    for i in list_all_txt:
        name = total_txt[i][:-4]
 
        srcImage = image_original_path + name + '.jpg'
        srcLabel = label_original_path + name + ".txt"
 
        if i in train:
            dst_train_Image = train_image_path + name + '.jpg'
            dst_train_Label = train_label_path + name + '.txt'
            shutil.copyfile(srcImage, dst_train_Image)
            shutil.copyfile(srcLabel, dst_train_Label)
            file_train.write(dst_train_Image + '\n')
        elif i in val:
            dst_val_Image = val_image_path + name + '.jpg'
            dst_val_Label = val_label_path + name + '.txt'
            shutil.copyfile(srcImage, dst_val_Image)
            shutil.copyfile(srcLabel, dst_val_Label)
            file_val.write(dst_val_Image + '\n')
        else:
            dst_test_Image = test_image_path + name + '.jpg'
            dst_test_Label = test_label_path + name + '.txt'
            shutil.copyfile(srcImage, dst_test_Image)
            shutil.copyfile(srcLabel, dst_test_Label)
            file_test.write(dst_test_Image + '\n')
 
    file_train.close()
    file_val.close()
    file_test.close()
 
 
if __name__ == "__main__":
    main()
</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/966cf332d19636264208aef9fb7f111a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CSDN每日一练</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0cdc6e418a0b0295e3a66ec48edba352/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c# ini（配置文件）文件读写(简单类)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>