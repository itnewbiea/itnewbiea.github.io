<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Anaconda环境离线迁移 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Anaconda环境离线迁移" />
<meta property="og:description" content="Anaconda是python常用的包和环境管理器，在生产过程中，有时候需要对环境进行迁移。本文参考Anaconda官方教程，并结合自身经验，提供了将一台可以联网并可以运行目标程序的源计算机A上的环境迁移到一台不能联网的目标计算机B上的解决方案。
在源计算机A上： 该部分在Linux和Windows上操作相同
1. conda-pack安装 推荐使用conda-pack工具进行环境打包，conda-pack是一个命令行工具，它能够打包环境中安装的所有二进制包，满足离线迁移的要求。注意确保目标计算机具有与源计算机相同的平台和操作系统，并且两台计算机的Anaconda版本要保持一致。在base环境中安装conda-pack，从而使其在子环境中可用。conda-pack可以在conda-forge或PyPI上获得。
conda安装（推荐） conda install -c conda-forge conda-pack pip安装 pip install conda-pack 2. 环境打包 文中所有的my_env均为要迁移的环境名，需根据实际情况进行替换，如tensorflow-gpu等。
# 将虚拟环境 my_env 打包为 my_env.tar.gz conda pack -n my_env 执行完这条命令后会在命令行的当前路径下找到一个my_env.tar.gz的压缩包，该压缩包即为打包的环境，将该压缩包拷贝到目标计算机B上。
在目标计算机B上： Linux # 切换到Anaconda环境目录 cd /root/anaconda3/envs # 创建`my_env`文件夹 mkdir -p my_env # 将环境解压到 `my_env`，`~/my_env.tar.gz`是环境压缩包的绝对路径 tar -xzf ~/my_env.tar.gz -C my_env # 激活环境 source /root/anaconda3/envs/my_env/bin/activate # 在环境中运行python (my_env) $ python # 停用环境 (my_env) $ source /root/anaconda3/envs/my_env/bin/deactivate Windows 在Anaconda的安装目录下打开envs文件夹，新建my_env文件夹，将压缩包my_env.tar.gz中的文件解压到该文件夹中。
打开cmd命令行
# 激活环境 C:\ProgramData\Anaconda3\envs\my_env\Scripts\activate.bat # 停用环境 C:\ProgramData\Anaconda3\envs\my_env\Scripts\deactivate." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/deaa34f3c91d5f0216b9e33319f20bf6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-09T17:16:17+08:00" />
<meta property="article:modified_time" content="2023-10-09T17:16:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Anaconda环境离线迁移</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>Anaconda是python常用的包和环境管理器，在生产过程中，有时候需要对环境进行迁移。本文参考<a href="https://www.anaconda.com/blog/moving-conda-environments" rel="nofollow">Anaconda官方教程</a>，并结合自身经验，提供了<strong>将一台可以联网并可以运行目标程序的源计算机A上的环境迁移到一台不能联网的目标计算机B上</strong>的解决方案。</p> 
</blockquote> 
<h3><a id="A_3"></a>在源计算机A上：</h3> 
<p><em>该部分在Linux和Windows上操作相同</em></p> 
<h4><a id="1_condapack_5"></a>1. <code>conda-pack</code>安装</h4> 
<p>推荐使用<code>conda-pack</code>工具进行环境打包，<code>conda-pack</code>是一个命令行工具，它能够打包环境中安装的所有二进制包，满足离线迁移的要求。注意确保目标计算机具有与源计算机相同的平台和操作系统，并且两台计算机的Anaconda版本要保持一致。在<code>base</code>环境中安装<code>conda-pack</code>，从而使其在子环境中可用。<code>conda-pack</code>可以在conda-forge或PyPI上获得。</p> 
<ul><li>conda安装（推荐）</li></ul> 
<pre><code class="prism language-shell">conda <span class="token function">install</span> <span class="token parameter variable">-c</span> conda-forge conda-pack
</code></pre> 
<ul><li>pip安装</li></ul> 
<pre><code class="prism language-shell">pip <span class="token function">install</span> conda-pack
</code></pre> 
<h4><a id="2__18"></a>2. 环境打包</h4> 
<p>文中所有的<code>my_env</code>均为要迁移的环境名，需根据实际情况进行替换，如<code>tensorflow-gpu</code>等。</p> 
<pre><code class="prism language-shell"><span class="token comment"># 将虚拟环境 my_env 打包为 my_env.tar.gz</span>
conda pack <span class="token parameter variable">-n</span> my_env
</code></pre> 
<p>执行完这条命令后会在命令行的当前路径下找到一个<code>my_env.tar.gz</code>的压缩包，该压缩包即为打包的环境，将该压缩包拷贝到目标计算机B上。</p> 
<hr> 
<h3><a id="B_29"></a>在目标计算机B上：</h3> 
<ul><li><strong>Linux</strong></li></ul> 
<pre><code class="prism language-shell"><span class="token comment"># 切换到Anaconda环境目录</span>
<span class="token builtin class-name">cd</span> /root/anaconda3/envs

<span class="token comment"># 创建`my_env`文件夹</span>
<span class="token function">mkdir</span> <span class="token parameter variable">-p</span> my_env

<span class="token comment"># 将环境解压到 `my_env`，`~/my_env.tar.gz`是环境压缩包的绝对路径</span>
<span class="token function">tar</span> <span class="token parameter variable">-xzf</span> ~/my_env.tar.gz <span class="token parameter variable">-C</span> my_env

<span class="token comment"># 激活环境</span>
<span class="token builtin class-name">source</span> /root/anaconda3/envs/my_env/bin/activate

<span class="token comment"># 在环境中运行python</span>
<span class="token punctuation">(</span>my_env<span class="token punctuation">)</span> $ python

<span class="token comment"># 停用环境</span>
<span class="token punctuation">(</span>my_env<span class="token punctuation">)</span> $ <span class="token builtin class-name">source</span> /root/anaconda3/envs/my_env/bin/deactivate 
</code></pre> 
<ul><li><strong>Windows</strong></li></ul> 
<p>在Anaconda的安装目录下打开envs文件夹，新建<code>my_env</code>文件夹，将压缩包my_env.tar.gz中的文件解压到该文件夹中。</p> 
<p>打开cmd命令行</p> 
<pre><code class="prism language-shell"><span class="token comment"># 激活环境</span>
C:<span class="token punctuation">\</span>ProgramData<span class="token punctuation">\</span>Anaconda3<span class="token punctuation">\</span>envs<span class="token punctuation">\</span>my_env<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>activate.bat

<span class="token comment"># 停用环境</span>
C:<span class="token punctuation">\</span>ProgramData<span class="token punctuation">\</span>Anaconda3<span class="token punctuation">\</span>envs<span class="token punctuation">\</span>my_env<span class="token punctuation">\</span>Scripts<span class="token punctuation">\</span>deactivate.bat
</code></pre> 
<p>在根据不同的操作系统执行完上述代码后，该环境已经添加到目标计算机中，可以像使用原生conda环境一样使用它，如使用<code>conda activate</code>、<code>conda list</code>等命令。至此，conda环境移植完毕。</p> 
<hr> 
<h3><a id="_69"></a>附</h3> 
<p>如果需要迁移的是tensorflow的gpu环境，要确保python、tensorflow、cuda、cudnn版本相对应，可参考<a href="https://tensorflow.google.cn/install/source_windows" rel="nofollow">官方文档</a>（参考英文文档，中文文档内容更新不及时🙃）。</p> 
<blockquote> 
 <p><a href="https://www.anaconda.com/blog/moving-conda-environments" rel="nofollow">Anaconda | Moving Conda Environments</a><br> <a href="https://zhuanlan.zhihu.com/p/540615230" rel="nofollow">Python | Conda pack 进行环境打包</a><br> <a href="https://conda.github.io/conda-pack/" rel="nofollow">Conda-Pack — conda-pack 0.7.0 documentation</a></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5a9c010e2e0652d6c7c41cd75778333c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Centos安装Jenkins官方方式安装教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0869c0650dc98cbe52880e590856ca3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">模拟实验：xfs文件系统备份文件并恢复</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>