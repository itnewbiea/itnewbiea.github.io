<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【计算机操作系统】存储管理的 C&#43;&#43; 实现（附源码） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【计算机操作系统】存储管理的 C&#43;&#43; 实现（附源码）" />
<meta property="og:description" content="文章目录 一、实验目的二、实验内容2.1 实现多种页面置换算法并比较算法优劣 三、流程图3.1 算法流程 四、设计思想4.1 设计思路4.2 代码分析 五、代码实现六、运行结果6.1 初始化6.2 OPT6.3 FIFO6.4 LRU6.5 LFU 七、思考7.1 比较各种算法的命中率7.2 分析当用户内存容量增加时对命中率的影响 八、结尾 一、实验目的 存储管理的主要功能之一是合理地分配空间。请求页式管理是一种常用的虚拟存储管理技术。本实验的目的是通过请求页式管理中页面置换算法模拟设计，了解虚拟存储技术的特点，掌握请求页式存储管理的页面置换算法。因为源码中我对一些关键步骤的注释已经比较清晰了，所以在本文中不会再对每一个细节都进行分析，只分析整体的代码结构和所使用到的设计模式。
博客内所有文章均为 原创，所有示意图均为 原创，若转载请附原文链接。
二、实验内容 2.1 实现多种页面置换算法并比较算法优劣 （1）通过计算不同算法的命中率比较算法的优劣。同时也考虑了用户内存容量对命中率的影响（命中率 = 1 - 页面失效次数 ÷ 页地址流长度）。页面失效次数为每次访问相应指令时，该指令所对应的页不在内存中的次数。在本实验中，假定页面大小为1k，用户虚存容量为32k，用户内存容量为4页到32页。
（2）produce_addstream 通过随机数产生一个指令序列，共320条指令。
A、指令的地址按下述原则生成：
1）50%的指令是顺序执行的
2）25%的指令是均匀分布在前地址部分
3）25%的指令是均匀分布在后地址部分
B、具体的实施方法是：
1）在[0，319]的指令地址之间随机选取一起点m；
2）顺序执行一条指令，即执行地址为m&#43;1的指令；
3）在前地址[0，m&#43;1]中随机选取一条指令并执行，该指令的地址为m’；
4）顺序执行一条指令，地址为m’&#43;1的指令
5）在后地址[m’&#43;2，319]中随机选取一条指令并执行；
6）重复上述步骤1）~5），直到执行320次指令
C、将指令序列变换称为页地址流
在用户虚存中，按每k存放10条指令排列虚存地址，即320条指令在虚存中的存放方式为：
第0条~第9条指令为第0页（对应虚存地址为[0，9]）；
第10条~第19条指令为第1页（对应虚存地址为[10，19]）；
。。。。。。
第310条~第319条指令为第31页（对应虚存地址为[310，319]）；
按以上方式，用户指令可组成32页。
（3）计算并输出下述算法在不同内存容量下的命中率。
1）最佳置换算法（OPT）；
2）先进先出算法（FIFO）；
3）最近最久未使用页面置换（LRU）；
4）最少使用页面淘汰算法(LFU）
三、流程图 3.1 算法流程 四、设计思想 4.1 设计思路 该实验中需要实现四种页面置换算法，分别为 OPT、FIFO、LRU和LFU，通过分析发现这四种算法中都存在一种优先级的关系，只不过优先级的属性不同，比如在LRU算法中，优先级为最近一次访问距离现在的时间，即页面最近一次访问距离现在的时间越短其优先级越高，而对于LFU算法，优先级页面被访问的次数，即用户内存中页面被访问的次数越多，其优先级也就越高，越不容易被淘汰，而FIFO算法中的优先级就是进入用户空间的时间，时间越短优先级越高，OPT中的优先级就是页面下次被访问据当前的时间，时间越短优先级越高。
当我们找到了这几种算法中的优先级关系后，通过分析可以发现优先级队列可以很好的满足这个需求，而对于LRU算法的实现其实最简单的方法是如果被访问的页面存在于用户空间中，那么就将其提升至队尾（队尾入页面，队头出页面），但是为了保证多个算法的统一性，还是决定采用相同的抽象算法来实现。
而对于整体的代码结构设计，可以采用 模板方法设计模式 &#43; 策略设计模式 的方法来进行实现，增强算法整体的灵活性、可扩展性和可维护性。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8493c15a134cc81abb028e85961f5c37/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-14T21:06:24+08:00" />
<meta property="article:modified_time" content="2020-06-14T21:06:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【计算机操作系统】存储管理的 C&#43;&#43; 实现（附源码）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_1" rel="nofollow">一、实验目的</a></li><li><a href="#_6" rel="nofollow">二、实验内容</a></li><li><ul><li><a href="#21__7" rel="nofollow">2.1 实现多种页面置换算法并比较算法优劣</a></li></ul> 
   </li><li><a href="#_36" rel="nofollow">三、流程图</a></li><li><ul><li><a href="#31__37" rel="nofollow">3.1 算法流程</a></li></ul> 
   </li><li><a href="#_39" rel="nofollow">四、设计思想</a></li><li><ul><li><a href="#41__40" rel="nofollow">4.1 设计思路</a></li><li><a href="#42__44" rel="nofollow">4.2 代码分析</a></li></ul> 
   </li><li><a href="#_127" rel="nofollow">五、代码实现</a></li><li><a href="#_671" rel="nofollow">六、运行结果</a></li><li><ul><li><a href="#61__672" rel="nofollow">6.1 初始化</a></li><li><a href="#62_OPT_674" rel="nofollow">6.2 OPT</a></li><li><a href="#63_FIFO_676" rel="nofollow">6.3 FIFO</a></li><li><a href="#64_LRU_678" rel="nofollow">6.4 LRU</a></li><li><a href="#65_LFU_680" rel="nofollow">6.5 LFU</a></li></ul> 
   </li><li><a href="#_682" rel="nofollow">七、思考</a></li><li><ul><li><a href="#71__683" rel="nofollow">7.1 比较各种算法的命中率</a></li><li><a href="#72__689" rel="nofollow">7.2 分析当用户内存容量增加时对命中率的影响</a></li></ul> 
   </li><li><a href="#_692" rel="nofollow">八、结尾</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="_1"></a>一、实验目的</h3> 
<p>  存储管理的主要功能之一是合理地分配空间。请求页式管理是一种常用的虚拟存储管理技术。本实验的目的是通过请求页式管理中页面置换算法模拟设计，了解虚拟存储技术的特点，掌握请求页式存储管理的页面置换算法。因为源码中我对一些关键步骤的注释已经比较清晰了，所以在本文中不会再对每一个细节都进行分析，只分析整体的代码结构和所使用到的设计模式。</p> 
<blockquote> 
 <p>  博客内所有文章均为 <strong>原创</strong>，所有示意图均为 <strong>原创</strong>，若转载请附原文链接。</p> 
</blockquote> 
<h3><a id="_6"></a>二、实验内容</h3> 
<h4><a id="21__7"></a>2.1 实现多种页面置换算法并比较算法优劣</h4> 
<ul><li> <p>（1）通过计算不同算法的命中率比较算法的优劣。同时也考虑了用户内存容量对命中率的影响（命中率 = 1 - 页面失效次数 ÷ 页地址流长度）。页面失效次数为每次访问相应指令时，该指令所对应的页不在内存中的次数。在本实验中，假定页面大小为1k，用户虚存容量为32k，用户内存容量为4页到32页。</p> </li><li> <p>（2）produce_addstream 通过随机数产生一个指令序列，共320条指令。<br> A、指令的地址按下述原则生成：<br>  1）50%的指令是顺序执行的<br>  2）25%的指令是均匀分布在前地址部分<br>  3）25%的指令是均匀分布在后地址部分<br> B、具体的实施方法是：<br>  1）在[0，319]的指令地址之间随机选取一起点m；<br>  2）顺序执行一条指令，即执行地址为m+1的指令；<br>  3）在前地址[0，m+1]中随机选取一条指令并执行，该指令的地址为m’；<br>  4）顺序执行一条指令，地址为m’+1的指令<br>  5）在后地址[m’+2，319]中随机选取一条指令并执行；<br>  6）重复上述步骤1）~5），直到执行320次指令<br> C、将指令序列变换称为页地址流<br>  在用户虚存中，按每k存放10条指令排列虚存地址，即320条指令在虚存中的存放方式为：<br>  第0条~第9条指令为第0页（对应虚存地址为[0，9]）；<br>  第10条~第19条指令为第1页（对应虚存地址为[10，19]）；<br>  。。。。。。<br>  第310条~第319条指令为第31页（对应虚存地址为[310，319]）；<br>  按以上方式，用户指令可组成32页。</p> </li><li> <p>（3）计算并输出下述算法在不同内存容量下的命中率。<br>   1）最佳置换算法（OPT）；<br>   2）先进先出算法（FIFO）；<br>   3）最近最久未使用页面置换（LRU）；<br>   4）最少使用页面淘汰算法(LFU）</p> </li></ul> 
<h3><a id="_36"></a>三、流程图</h3> 
<h4><a id="31__37"></a>3.1 算法流程</h4> 
<p><img src="https://images2.imgbox.com/51/10/sHkrRvTa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_39"></a>四、设计思想</h3> 
<h4><a id="41__40"></a>4.1 设计思路</h4> 
<p>  该实验中需要实现四种页面置换算法，分别为 OPT、FIFO、LRU和LFU，通过分析发现这四种算法中都存在一种优先级的关系，只不过优先级的属性不同，比如在LRU算法中，优先级为最近一次访问距离现在的时间，即页面最近一次访问距离现在的时间越短其优先级越高，而对于LFU算法，优先级页面被访问的次数，即用户内存中页面被访问的次数越多，其优先级也就越高，越不容易被淘汰，而FIFO算法中的优先级就是进入用户空间的时间，时间越短优先级越高，OPT中的优先级就是页面下次被访问据当前的时间，时间越短优先级越高。<br>   当我们找到了这几种算法中的优先级关系后，通过分析可以发现优先级队列可以很好的满足这个需求，而对于LRU算法的实现其实最简单的方法是如果被访问的页面存在于用户空间中，那么就将其提升至队尾（队尾入页面，队头出页面），但是为了保证多个算法的统一性，还是决定采用相同的抽象算法来实现。<br>   而对于整体的代码结构设计，可以采用 模板方法设计模式 + 策略设计模式 的方法来进行实现，增强算法整体的灵活性、可扩展性和可维护性。</p> 
<h4><a id="42__44"></a>4.2 代码分析</h4> 
<p>  首先是Page结构体，该结构体保存了 OPT、LRU 和 LFU 算法所需的各项属性。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">struct</span> Page
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">elapsed_time_since_last_visit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">used_count</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">int</span> virtual_memory_index<span class="token punctuation">;</span>
	<span class="token comment">// OPT</span>
	TimeSlice be_used_again_time_<span class="token punctuation">;</span>
	<span class="token comment">// LRU</span>
	TimeSlice elapsed_time_since_last_visit<span class="token punctuation">;</span>
	<span class="token comment">// LFU</span>
	<span class="token keyword">int</span> used_count<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>  其次是 UserMemorySpace 类，该类是用户内存空间的抽象，提供了一个模板参数 PriorityCmp，用来指定优先级队列中的优先级关系定义，并且在它的属性中存在 page_index_array_ 数组和 memory_queue_优先级队列，其中前者是保存所有的虚拟页面信息，PageInfo 中持有 Page 的引用，同时记录该页面是否存在于用户空间优先级队列中，而后者的 memory_queue_ 就是物理用户内存空间，前者的存在主要是了便于对物理用户内存空间内页面的查找定位，而该类的功能总结起来就是提供了对物理用户内存空间的基础操作（确定一个页面是否存在于用户空间中，获取一个页面，插入一个页面等等）。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PriorityCmp<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">UserMemorySpace</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">struct</span> PageInfo
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">bool</span> in_user_memory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		PagePtr page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> PageInfo <span class="token operator">*</span> PageInfoPtr<span class="token punctuation">;</span>

	<span class="token function">UserMemorySpace</span><span class="token punctuation">(</span><span class="token keyword">int</span> user_memory_size<span class="token punctuation">,</span> <span class="token keyword">int</span> virtual_memory_size<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">user_memory_size_</span><span class="token punctuation">(</span>user_memory_size<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">virtual_memory_size_</span><span class="token punctuation">(</span>virtual_memory_size<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">memory_queue_</span><span class="token punctuation">(</span><span class="token keyword">new</span> std<span class="token operator">::</span>priority_queue<span class="token operator">&lt;</span>PagePtr<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span><span class="token punctuation">,</span> PriorityCmp<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">page_index_array_</span><span class="token punctuation">(</span><span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PageInfoPtr<span class="token operator">&gt;</span><span class="token punctuation">(</span>virtual_memory_size<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">initPageIndexArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_page_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
	PagePtr <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">inline</span> PageInfoPtr <span class="token function">getPageInfo</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_page_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">inline</span> PagePtr <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_page_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">inline</span> <span class="token keyword">bool</span> <span class="token function">pageInUserMemory</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_page_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">freshPageOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span> <span class="token operator">*</span> <span class="token function">getPagesInUserMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> user_memory_size_<span class="token punctuation">;</span>
	<span class="token keyword">int</span> virtual_memory_size_<span class="token punctuation">;</span>
	<span class="token comment">// help find page in memory queue</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PageInfoPtr<span class="token operator">&gt;</span> <span class="token operator">*</span> page_index_array_<span class="token punctuation">;</span>
	std<span class="token operator">::</span>priority_queue<span class="token operator">&lt;</span>PagePtr<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span><span class="token punctuation">,</span> PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> memory_queue_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>  接下来是页面置换算法，这里采用了模板方法设计模式，其中PageReplacementAlgorithm为所有是算法的抽象基类，不提供具体实现，只规定算法所必须实现的方法，且其持有一个UserMemorySpace的引用。</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 页面置换算法基类</span>
<span class="token keyword">class</span> <span class="token class-name">PageReplacementAlgorithm</span><span class="token punctuation">;</span>

<span class="token comment">// 最佳页面置换算法</span>
<span class="token keyword">class</span> <span class="token class-name">OPTPageReplacementAlgorithm</span> <span class="token operator">:</span> <span class="token keyword">public</span> PageReplacementAlgorithm<span class="token punctuation">;</span>

<span class="token comment">// 先来先服务页面置换算法</span>
<span class="token keyword">class</span> <span class="token class-name">FIFOPageReplacementAlgorithm</span> <span class="token operator">:</span> <span class="token keyword">public</span> PageReplacementAlgorithm<span class="token punctuation">;</span>

<span class="token comment">// LRU 页面置换算法</span>
<span class="token keyword">class</span> <span class="token class-name">LRUPageReplacementAlgorithm</span> <span class="token operator">:</span> <span class="token keyword">public</span> PageReplacementAlgorithm<span class="token punctuation">;</span>

<span class="token comment">// LFU 页面置换算法</span>
<span class="token keyword">class</span> <span class="token class-name">LFUPageReplacementAlgorithm</span> <span class="token operator">:</span> <span class="token keyword">public</span> PageReplacementAlgorithm<span class="token punctuation">;</span>
</code></pre> 
<p>  最后两个模块类，PageReplacement是对页面置换逻辑的封装，主要用于聚合PageReplacementAlgorithm和UserMemorySpace，并设置相应的物理用户内存空间的大小，而PageReplacementWrapper是对PageReplacement的进一步封装，指引用户输入相应的数据（具体实现请见源码）。</p> 
<pre><code class="prism language-cpp"><span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PageReplacementAlgorithm<span class="token punctuation">,</span> <span class="token keyword">typename</span> PriorityCmp<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">PageReplacement</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PageReplacementWrapper</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_127"></a>五、代码实现</h3> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;queue&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cstdlib&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;ctime&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iomanip&gt;</span></span>

<span class="token keyword">class</span> <span class="token class-name">Util</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">static</span> <span class="token keyword">inline</span> <span class="token keyword">int</span> <span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> min_val<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span> max_val<span class="token punctuation">,</span> <span class="token keyword">int</span> match<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">srand</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">+</span> match<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>max_val <span class="token operator">-</span> min_val <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">?</span> min_val <span class="token operator">:</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token punctuation">(</span>max_val <span class="token operator">-</span> min_val <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> min_val<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> <span class="token keyword">int</span> TimeSlice<span class="token punctuation">;</span>
<span class="token keyword">int</span> page_replacement_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> <span class="token operator">*</span> ratio <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> Page
<span class="token punctuation">{<!-- --></span>
	<span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">elapsed_time_since_last_visit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">used_count</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">int</span> virtual_memory_index<span class="token punctuation">;</span>
	<span class="token comment">// OPT</span>
	TimeSlice be_used_again_time_<span class="token punctuation">;</span>
	<span class="token comment">// LRU</span>
	TimeSlice elapsed_time_since_last_visit<span class="token punctuation">;</span>
	<span class="token comment">// LFU</span>
	<span class="token keyword">int</span> used_count<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">typedef</span> Page <span class="token operator">*</span> PagePtr<span class="token punctuation">;</span>

<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PriorityCmp<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">UserMemorySpace</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">struct</span> PageInfo
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">bool</span> in_user_memory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		PagePtr page <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token keyword">typedef</span> PageInfo <span class="token operator">*</span> PageInfoPtr<span class="token punctuation">;</span>

	<span class="token function">UserMemorySpace</span><span class="token punctuation">(</span><span class="token keyword">int</span> user_memory_size<span class="token punctuation">,</span> <span class="token keyword">int</span> virtual_memory_size<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">user_memory_size_</span><span class="token punctuation">(</span>user_memory_size<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">virtual_memory_size_</span><span class="token punctuation">(</span>virtual_memory_size<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">memory_queue_</span><span class="token punctuation">(</span><span class="token keyword">new</span> std<span class="token operator">::</span>priority_queue<span class="token operator">&lt;</span>PagePtr<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span><span class="token punctuation">,</span> PriorityCmp<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">page_index_array_</span><span class="token punctuation">(</span><span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PageInfoPtr<span class="token operator">&gt;</span><span class="token punctuation">(</span>virtual_memory_size<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">initPageIndexArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">inline</span> <span class="token keyword">void</span> <span class="token function">initPageIndexArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> virtual_memory_size_<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token punctuation">(</span><span class="token operator">*</span>page_index_array_<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">PageInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">getPage</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>virtual_memory_index <span class="token operator">=</span> i<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_page_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// if page already in user memory</span>
		PageInfoPtr pip <span class="token operator">=</span> <span class="token function">getPageInfo</span><span class="token punctuation">(</span>virtual_page_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pip<span class="token operator">-</span><span class="token operator">&gt;</span>in_user_memory<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//std::cout &lt;&lt; "virtual page " &lt;&lt; virtual_page_index &lt;&lt; " already in user memory." &lt;&lt; std::endl;</span>
			<span class="token keyword">return</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		page_replacement_count<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>memory_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> user_memory_size_<span class="token punctuation">)</span> <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		PagePtr page <span class="token operator">=</span> <span class="token function">getPage</span><span class="token punctuation">(</span>virtual_page_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		memory_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pip<span class="token operator">-</span><span class="token operator">&gt;</span>in_user_memory <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
		<span class="token comment">//std::cout &lt;&lt; "virtual page " &lt;&lt; virtual_page_index &lt;&lt; " swap in." &lt;&lt; std::endl;</span>
	<span class="token punctuation">}</span>

	PagePtr <span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		PagePtr page <span class="token operator">=</span> memory_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		memory_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">getPageInfo</span><span class="token punctuation">(</span>page<span class="token operator">-</span><span class="token operator">&gt;</span>virtual_memory_index<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>in_user_memory <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

		<span class="token comment">//std::cout &lt;&lt; "virtual page " &lt;&lt; page-&gt;virtual_memory_index &lt;&lt; " swap out." &lt;&lt; std::endl;</span>
		<span class="token keyword">return</span> page<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">inline</span> PageInfoPtr <span class="token function">getPageInfo</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_page_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token operator">*</span>page_index_array_<span class="token punctuation">)</span><span class="token punctuation">[</span>virtual_page_index<span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">inline</span> PagePtr <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_page_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">getPageInfo</span><span class="token punctuation">(</span>virtual_page_index<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>page<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">inline</span> <span class="token keyword">bool</span> <span class="token function">pageInUserMemory</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_page_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token function">getPageInfo</span><span class="token punctuation">(</span>virtual_page_index<span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">&gt;</span>in_user_memory<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">freshPageOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span> <span class="token operator">*</span> pages <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>memory_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// while priority equal，order by enqueue order</span>
			pages<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>memory_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">top</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			memory_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>PagePtr page <span class="token operator">:</span> <span class="token operator">*</span>pages<span class="token punctuation">)</span> memory_queue_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">delete</span> pages<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span> <span class="token operator">*</span> <span class="token function">getPagesInUserMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span> <span class="token operator">*</span> pages <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>PageInfoPtr pi <span class="token operator">:</span> <span class="token operator">*</span>page_index_array_<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pi<span class="token operator">-</span><span class="token operator">&gt;</span>in_user_memory<span class="token punctuation">)</span> pages<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>pi<span class="token operator">-</span><span class="token operator">&gt;</span>page<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> pages<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> user_memory_size_<span class="token punctuation">;</span>
	<span class="token keyword">int</span> virtual_memory_size_<span class="token punctuation">;</span>
	<span class="token comment">// help find page in memory queue</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PageInfoPtr<span class="token operator">&gt;</span> <span class="token operator">*</span> page_index_array_<span class="token punctuation">;</span>
	std<span class="token operator">::</span>priority_queue<span class="token operator">&lt;</span>PagePtr<span class="token punctuation">,</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span><span class="token punctuation">,</span> PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> memory_queue_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PageReplacementAlgorithm</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span> page_address_stream<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">setCurrentPageIndexOfPageAddressStream</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> PagePtr <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_memory_index<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">OPTPageReplacementAlgorithm</span> <span class="token operator">:</span> <span class="token keyword">public</span> PageReplacementAlgorithm
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">struct</span> PriorityCmp
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>PagePtr p1<span class="token punctuation">,</span> PagePtr p2<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> p1<span class="token operator">-</span><span class="token operator">&gt;</span>be_used_again_time_ <span class="token operator">&lt;</span> p2<span class="token operator">-</span><span class="token operator">&gt;</span>be_used_again_time_<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token function">OPTPageReplacementAlgorithm</span><span class="token punctuation">(</span>UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">user_memory_space_</span><span class="token punctuation">(</span>user_memory_space<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span> page_address_stream<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		page_address_stream_ <span class="token operator">=</span> page_address_stream<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setCurrentPageIndexOfPageAddressStream</span><span class="token punctuation">(</span><span class="token keyword">int</span> index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		current_page_index_of_page_address_stream_ <span class="token operator">=</span> index<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	PagePtr <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_memory_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		PagePtr page <span class="token operator">=</span> user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPage</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">updatePageBeAgainUsedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">freshPageOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">;</span>

		current_page_index_of_page_address_stream_<span class="token operator">++</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> page<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">updatePageBeAgainUsedTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span> <span class="token operator">*</span> pages <span class="token operator">=</span> user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPagesInUserMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>PagePtr p <span class="token operator">:</span> <span class="token operator">*</span>pages<span class="token punctuation">)</span>
			p<span class="token operator">-</span><span class="token operator">&gt;</span>be_used_again_time_ <span class="token operator">=</span> <span class="token function">getPageNextUsedTimeFromPageAddressStream</span><span class="token punctuation">(</span>p<span class="token operator">-</span><span class="token operator">&gt;</span>virtual_memory_index<span class="token punctuation">)</span> 
				<span class="token operator">-</span> current_page_index_of_page_address_stream_<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">int</span> <span class="token function">getPageNextUsedTimeFromPageAddressStream</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_memory_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> current_page_index_of_page_address_stream_ <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> virtual_memory_index<span class="token punctuation">)</span> <span class="token keyword">return</span> i<span class="token punctuation">;</span>
		<span class="token keyword">return</span> page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> current_page_index_of_page_address_stream_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span> page_address_stream_<span class="token punctuation">;</span>
	UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FIFOPageReplacementAlgorithm</span> <span class="token operator">:</span> <span class="token keyword">public</span> PageReplacementAlgorithm
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">struct</span> PriorityCmp
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>PagePtr p1<span class="token punctuation">,</span> PagePtr p2<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token function">FIFOPageReplacementAlgorithm</span><span class="token punctuation">(</span>UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">user_memory_space_</span><span class="token punctuation">(</span>user_memory_space<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	PagePtr <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_memory_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		PagePtr page <span class="token operator">=</span> user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPage</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> page<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LRUPageReplacementAlgorithm</span> <span class="token operator">:</span> <span class="token keyword">public</span> PageReplacementAlgorithm
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">struct</span> PriorityCmp
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>PagePtr p1<span class="token punctuation">,</span> PagePtr p2<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> p1<span class="token operator">-</span><span class="token operator">&gt;</span>elapsed_time_since_last_visit <span class="token operator">&lt;</span> p2<span class="token operator">-</span><span class="token operator">&gt;</span>elapsed_time_since_last_visit<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token function">LRUPageReplacementAlgorithm</span><span class="token punctuation">(</span>UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">user_memory_space_</span><span class="token punctuation">(</span>user_memory_space<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	PagePtr <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_memory_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		PagePtr page <span class="token operator">=</span> user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPage</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// this page may already in user memory，avoid repeat elapsed_time_since_last_visit++</span>
		<span class="token comment">// there should judge this page whether in user memory</span>
		page<span class="token operator">-</span><span class="token operator">&gt;</span>elapsed_time_since_last_visit <span class="token operator">=</span> user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pageInUserMemory</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>

		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>PagePtr<span class="token operator">&gt;</span> <span class="token operator">*</span> pages <span class="token operator">=</span> user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPagesInUserMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>PagePtr p <span class="token operator">:</span> <span class="token operator">*</span>pages<span class="token punctuation">)</span>
			p<span class="token operator">-</span><span class="token operator">&gt;</span>elapsed_time_since_last_visit<span class="token operator">++</span><span class="token punctuation">;</span>
		user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">freshPageOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> page<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">LFUPageReplacementAlgorithm</span> <span class="token operator">:</span> <span class="token keyword">public</span> PageReplacementAlgorithm
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">struct</span> PriorityCmp
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">bool</span> <span class="token keyword">operator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>PagePtr p1<span class="token punctuation">,</span> PagePtr p2<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> p1<span class="token operator">-</span><span class="token operator">&gt;</span>used_count <span class="token operator">&gt;</span> p2<span class="token operator">-</span><span class="token operator">&gt;</span>used_count<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

	<span class="token function">LFUPageReplacementAlgorithm</span><span class="token punctuation">(</span>UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">user_memory_space_</span><span class="token punctuation">(</span>user_memory_space<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	PagePtr <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token keyword">int</span> virtual_memory_index<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		PagePtr page <span class="token operator">=</span> user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPage</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">pageInUserMemory</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">)</span> page<span class="token operator">-</span><span class="token operator">&gt;</span>used_count<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> page<span class="token operator">-</span><span class="token operator">&gt;</span>used_count <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

		user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">freshPageOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		user_memory_space_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push</span><span class="token punctuation">(</span>virtual_memory_index<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> page<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


<span class="token keyword">template</span><span class="token operator">&lt;</span><span class="token keyword">typename</span> PageReplacementAlgorithm<span class="token punctuation">,</span> <span class="token keyword">typename</span> PriorityCmp<span class="token operator">&gt;</span>
<span class="token keyword">class</span> <span class="token class-name">PageReplacement</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	PageReplacement<span class="token operator">&lt;</span>PageReplacementAlgorithm<span class="token punctuation">,</span> PriorityCmp<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> user_mem_space <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span> user_mem_space <span class="token operator">&lt;=</span> <span class="token number">32</span><span class="token punctuation">;</span> <span class="token operator">++</span>user_mem_space<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			page_replacement_count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			user_memory_space_ <span class="token operator">=</span> <span class="token keyword">new</span> UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span><span class="token punctuation">(</span>user_mem_space<span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			page_replacement_algorithm_ <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token function">PageReplacementAlgorithm</span><span class="token punctuation">(</span>user_memory_space_<span class="token punctuation">)</span><span class="token punctuation">;</span>
			page_replacement_algorithm_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> index <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> index <span class="token operator">&lt;</span> page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>index<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				page_replacement_algorithm_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setCurrentPageIndexOfPageAddressStream</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
				page_replacement_algorithm_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">getPage</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				current_page_index_of_page_address_stream_ <span class="token operator">=</span> index<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">double</span> cache_hit_ratio <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> page_replacement_count<span class="token operator">/</span><span class="token punctuation">(</span>page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">//std::cout &lt;&lt; "user memory space is " &lt;&lt; user_mem_space &lt;&lt; "k, cache hit ratio " &lt;&lt; cache_hit_ratio &lt;&lt; std::endl;</span>
			<span class="token comment">//std::cout &lt;&lt; cache_hit_ratio &lt;&lt; ",";</span>
			<span class="token punctuation">(</span><span class="token operator">*</span>ratio<span class="token punctuation">)</span><span class="token punctuation">[</span>user_mem_space <span class="token operator">-</span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> cache_hit_ratio<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span> page_address_stream<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		page_address_stream_ <span class="token operator">=</span> page_address_stream<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> current_page_index_of_page_address_stream_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span> page_address_stream_<span class="token punctuation">;</span>
	UserMemorySpace<span class="token operator">&lt;</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> user_memory_space_<span class="token punctuation">;</span>
	PageReplacementAlgorithm <span class="token operator">*</span> page_replacement_algorithm_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">PageReplacementWrapper</span>
<span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">PageReplacementWrapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		opt_page_replacement_ <span class="token operator">=</span> <span class="token keyword">new</span> PageReplacement<span class="token operator">&lt;</span>OPTPageReplacementAlgorithm<span class="token punctuation">,</span> OPTPageReplacementAlgorithm<span class="token operator">::</span>PriorityCmp<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		fifo_page_replacement_ <span class="token operator">=</span> <span class="token keyword">new</span> PageReplacement<span class="token operator">&lt;</span>FIFOPageReplacementAlgorithm<span class="token punctuation">,</span> FIFOPageReplacementAlgorithm<span class="token operator">::</span>PriorityCmp<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		lru_page_replacement_ <span class="token operator">=</span> <span class="token keyword">new</span> PageReplacement<span class="token operator">&lt;</span>LRUPageReplacementAlgorithm<span class="token punctuation">,</span> LRUPageReplacementAlgorithm<span class="token operator">::</span>PriorityCmp<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		lfu_page_replacement_ <span class="token operator">=</span> <span class="token keyword">new</span> PageReplacement<span class="token operator">&lt;</span>LFUPageReplacementAlgorithm<span class="token punctuation">,</span> LFUPageReplacementAlgorithm<span class="token operator">::</span>PriorityCmp<span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">produceAddstream</span><span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//produceTestAddstream();</span>
		<span class="token function">choosePageReplacementAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">bool</span> <span class="token function">doTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> <span class="token operator">*</span> opt <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> <span class="token operator">*</span> fifo <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> <span class="token operator">*</span> lru <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> <span class="token operator">*</span> lfu <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">produceAddstream</span><span class="token punctuation">(</span><span class="token number">320</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			
			opt_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>
			opt_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> opt<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
				<span class="token punctuation">(</span><span class="token operator">*</span>opt<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>ratio<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			ratio<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


			fifo_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>
			fifo_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> fifo<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
				<span class="token punctuation">(</span><span class="token operator">*</span>fifo<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>ratio<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			ratio<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


			lru_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>
			lru_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lru<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
				<span class="token punctuation">(</span><span class="token operator">*</span>lru<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>ratio<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			ratio<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


			lfu_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>
			lfu_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lfu<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
				<span class="token punctuation">(</span><span class="token operator">*</span>lfu<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>ratio<span class="token punctuation">)</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
			ratio<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">double</span> d <span class="token operator">:</span> <span class="token operator">*</span>opt<span class="token punctuation">)</span>
			std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>d <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">double</span> d <span class="token operator">:</span> <span class="token operator">*</span>fifo<span class="token punctuation">)</span>
			std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>d <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">double</span> d <span class="token operator">:</span> <span class="token operator">*</span>lru<span class="token punctuation">)</span>
			std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>d <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">double</span> d <span class="token operator">:</span> <span class="token operator">*</span>lfu<span class="token punctuation">)</span>
			std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>d <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> <span class="token string">","</span><span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">choosePageReplacementAlgorithm</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"There are algorithms in the program"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"1.Optimization algorithm"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"2.First in first out algorithm"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"3.Least recently used algorithm"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"4.Least frequently used algorithm"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Select an algorithm number, please."</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

		<span class="token keyword">int</span> pra <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token keyword">bool</span> continue_do <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>

			<span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
				std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> pra<span class="token punctuation">;</span>
				<span class="token keyword">switch</span> <span class="token punctuation">(</span>pra<span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span>
					std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"current is Optimization algorithm"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
					opt_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>
					opt_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>

				<span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span>
					std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"current is First in first out algorithm"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
					fifo_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>
					fifo_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>

				<span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span>
					std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"current is Least recently used algorithm"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
					lru_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>
					lru_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>

				<span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span>
					std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"current is Least frequently used algorithm"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
					lfu_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setPageAddressStream</span><span class="token punctuation">(</span>page_address_stream_<span class="token punctuation">)</span><span class="token punctuation">;</span>
					lfu_page_replacement_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">doPageReplacement</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>

				<span class="token keyword">default</span><span class="token operator">:</span>
					std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"there is not the algorithm in the program"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
					<span class="token keyword">break</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>pra <span class="token operator">&lt;</span> <span class="token number">1</span> <span class="token operator">||</span> pra <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"do you try again with another algorithm(y/n)"</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
			<span class="token keyword">char</span> ch <span class="token operator">=</span> <span class="token string">'n'</span><span class="token punctuation">;</span>
			std<span class="token operator">::</span>cin <span class="token operator">&gt;&gt;</span> ch<span class="token punctuation">;</span>
			continue_do <span class="token operator">=</span> <span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>continue_do<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">produceAddstream</span><span class="token punctuation">(</span><span class="token keyword">int</span> addrNum<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Start memory management."</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
		std<span class="token operator">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Producing address flow, wait for while, please."</span> <span class="token operator">&lt;&lt;</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

		instruction_sequence_ <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">while</span> <span class="token punctuation">(</span>instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> addrNum<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> m <span class="token operator">=</span> Util<span class="token operator">::</span><span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> addrNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> addrNum<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

			<span class="token keyword">int</span> m_ <span class="token operator">=</span> Util<span class="token operator">::</span><span class="token function">getRandom</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> m <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>m_<span class="token punctuation">)</span><span class="token punctuation">;</span>
			instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>m_ <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> addrNum<span class="token punctuation">)</span> <span class="token keyword">break</span><span class="token punctuation">;</span>

			<span class="token keyword">int</span> n <span class="token operator">=</span> Util<span class="token operator">::</span><span class="token function">getRandom</span><span class="token punctuation">(</span>m_ <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> addrNum <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			instruction_sequence_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		page_address_stream_ <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> ins <span class="token operator">:</span> <span class="token operator">*</span>instruction_sequence_<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span>ins <span class="token operator">/</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// std::cout &lt;&lt; ins/10 &lt;&lt; " ";</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">void</span> <span class="token function">produceTestAddstream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		page_address_stream_ <span class="token operator">=</span> <span class="token keyword">new</span> std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// {7, 0, 1, 2, 0, 3, 0, 4, 2, 3, 0, 3, 2, 1, 2, 0, 1, 7, 0, 1}</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		page_address_stream_<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span> instruction_sequence_<span class="token punctuation">;</span>
	std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span> <span class="token operator">*</span> page_address_stream_<span class="token punctuation">;</span>
	PageReplacement<span class="token operator">&lt;</span>OPTPageReplacementAlgorithm<span class="token punctuation">,</span> OPTPageReplacementAlgorithm<span class="token operator">::</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> opt_page_replacement_<span class="token punctuation">;</span>
	PageReplacement<span class="token operator">&lt;</span>FIFOPageReplacementAlgorithm<span class="token punctuation">,</span> FIFOPageReplacementAlgorithm<span class="token operator">::</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> fifo_page_replacement_<span class="token punctuation">;</span>
	PageReplacement<span class="token operator">&lt;</span>LRUPageReplacementAlgorithm<span class="token punctuation">,</span> LRUPageReplacementAlgorithm<span class="token operator">::</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> lru_page_replacement_<span class="token punctuation">;</span>
	PageReplacement<span class="token operator">&lt;</span>LFUPageReplacementAlgorithm<span class="token punctuation">,</span> LFUPageReplacementAlgorithm<span class="token operator">::</span>PriorityCmp<span class="token operator">&gt;</span> <span class="token operator">*</span> lfu_page_replacement_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_671"></a>六、运行结果</h3> 
<h4><a id="61__672"></a>6.1 初始化</h4> 
<p><img src="https://images2.imgbox.com/f8/78/IrEjN6m9_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="62_OPT_674"></a>6.2 OPT</h4> 
<p><img src="https://images2.imgbox.com/70/ed/gvEpjMVX_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="63_FIFO_676"></a>6.3 FIFO</h4> 
<p><img src="https://images2.imgbox.com/24/57/IijPmga8_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="64_LRU_678"></a>6.4 LRU</h4> 
<p><img src="https://images2.imgbox.com/76/25/tevZQknW_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="65_LFU_680"></a>6.5 LFU</h4> 
<p><img src="https://images2.imgbox.com/59/98/ikWLePiE_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_682"></a>七、思考</h3> 
<h4><a id="71__683"></a>7.1 比较各种算法的命中率</h4> 
<p><img src="https://images2.imgbox.com/de/9b/xIPMlOET_o.png" alt="在这里插入图片描述"><br>   上图为循环执行 100 次时各算法的命中率可视化，其中 x 轴为用户内存大小，y 轴为缓存命中率。这个问题可以通过上述的可视化视图来进行分析，通过上面的运行结果的可视化视图我们可以看到在循环运行100次后，FIFO的平均缓存命中率高于LRU算法，这有点违背我们以往的知识，即LRU是对FIFO的优化算法，缓存命中率应当高于FIFO。通过分析后，我认为主要是由于该实验中的随机指令生成算法造成的。<br>   我们可以发现该随机算法虽然是保证了25%的指令位于前部，25%的指令位于后部，50%的指令是连续的，但是我们可以发现该生成算法五步为一轮，每一轮在第一步都会重新确定起点，这导致虽然整体中又50%的指令是连续的，但都是仅有两条是连续的。<br>   而我们平时所述得LRU算法优于FIFO算法，主要是因为在实际工程中，指令的执行大多是顺序执行的，存在局部性原理，在这里可能刚刚被访问到的指令很快又会被访问到，所以此时LRU算法是最高效的。在后续我也测试了增加指令的重复性和连续性，LRU的算法命中率上升。</p> 
<h4><a id="72__689"></a>7.2 分析当用户内存容量增加时对命中率的影响</h4> 
<p>  通过 7.1 中的图可以看到，当用户内存容量越大时，命中率是越高的，因为用户内存可常驻的物理内存越来越多，缺页次数减少，当用户物理内存和虚拟内存相等时，每个物理页面只需调入一次用户内存，即可一直常驻用户内存。</p> 
<h3><a id="_692"></a>八、结尾</h3> 
<p>  如果本文描述的内容或使用的代码存在任何问题，请及时联系我或在本篇文章的下面进行评论，我会本着对每一位学技术同学的负责态度立即修改。在后续还会有三篇计算机操作系统的算法 C++ 复现博文，如果感兴趣可以关注我。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0f83922ba5756e0c8d72c5db6b5dfc2e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PySide2基础篇（十五）——QFileDialog运用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/383f53886a80e28ebe17e76f7f2e7e81/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HTTP协议知识点必懂</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>