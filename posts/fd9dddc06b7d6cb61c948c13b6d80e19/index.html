<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HIDL_interface_hashing - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HIDL_interface_hashing" />
<meta property="og:description" content="概述 l 每一个接口文件对应一个.hal文件
l 保护接口文件不被轻易修改。如果修改，编译就会报错，同时会生成一个修改后hashing值
l 确保接口变化得到充分审查
布局 每一个包根目录下都有一个current.txt文件。例如android.hardware对应hardware/interfaces。
这个文件包含了发布的所有接口文件即.hal文件以及对应的hashing值。
Hashing产生 1. 手动添加hash到current.txt
.hal文件修改后，编译会报错同时生成修改后的hash值，可以手动添加到current.txt。
2. hidl-gen 注意：不要替换前一个已发布的接口hash值。如果修改的化，只需要在current.txt文件的末尾追加即可。
每一个接口都可以通过调用IBase::getHashChain 获取对应的hash。
hidl-gen在编译接口时，会在其对应的根目目录下检查current.txt
l 没有找到，接口不发布，编译跳过
l Hash不匹配，编译终止，修改current.txt
1. 对于ABI允许的修改，可以修改current.txt。
2. ABI不允许的修改，需要在接口的次版本号或主版本号更新中修改。
ABI stability ABI: Application Binary Interface 。包含了二级制链接、函数调用约定等。如果ABI/API变化，那基于标准接口编译的system.img，可能无法使用该接口功能。
接口版本化和ABI 稳定性是必要的：
l 通过VTS
l System 独立 OTA
l 作为OEM，提供一个容易使用和兼任的BSP版本
l 通过current.txt可以了解接口的发布历史记录
当在current.txt为一个存在的接口添加一个新的hash时，为了确保ABI stability，需要审查下面的修改类型：
对于已发布的接口，ABIstability列出了哪些修改允许哪些不允许，对于不允许的修改只能在接口的次版本号或主版本号更新中修改。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/fd9dddc06b7d6cb61c948c13b6d80e19/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-01-06T19:45:28+08:00" />
<meta property="article:modified_time" content="2018-01-06T19:45:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HIDL_interface_hashing</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h5>概述</h5> 
<p>l  每一个接口文件对应一个.hal文件</p> 
<p>l  保护接口文件不被轻易修改。如果修改，编译就会报错，同时会生成一个修改后hashing值</p> 
<p>l  确保接口变化得到充分审查</p> 
<h5>布局</h5> 
<p>      每一个包根目录下都有一个current.txt文件。例如android.hardware对应hardware/interfaces。</p> 
<p>这个文件包含了发布的所有接口文件即.hal文件以及对应的hashing值。</p> 
<p><img src="https://images2.imgbox.com/2b/0e/u3dptsyI_o.png" alt=""><br> </p> 
<p></p> 
<h5>Hashing产生</h5> 
<p></p> 
<p>1.    手动添加hash到current.txt</p> 
<p>.hal文件修改后，编译会报错同时生成修改后的hash值，可以手动添加到current.txt。</p> 
<p>2.    hidl-gen </p> 
<img src="https://images2.imgbox.com/c1/9b/1ZoHaZY3_o.png" alt=""> 
<br> 
<p></p> 
<p><span style="background:yellow">注意：不要替换前一个已发布的接口</span><span style="background:yellow">hash</span><span style="background:yellow">值。如果修改的化，只需要在</span><span style="background:yellow">current.txt</span><span style="background:yellow">文件的末尾追加即可。</span></p> 
<p>每一个接口都可以通过调用<span style="color:#37474F; background:#F7F7F7">IBase::getHashChain </span>获取对应的hash。</p> 
<p>hidl-gen在编译接口时，会在其对应的根目目录下检查current.txt<br> </p> 
<p>l  没有找到，接口不发布，编译跳过</p> 
<p>l  Hash不匹配，编译终止，修改current.txt</p> 
<p>1.    对于ABI允许的修改，可以修改current.txt。</p> 
<p>2.    ABI不允许的修改，需要在接口的次版本号或主版本号更新中修改。</p> 
<p></p> 
<h5>ABI stability</h5> 
<p></p> 
<p> </p> 
<p>ABI:<span style="color:#212121"> Application Binary Interface </span><span style="color:#212121">。包含了二级制链接、函数调用约定等。如果</span><span style="color:#212121">ABI/API</span><span style="color:#212121">变化，那基于标准接口编译的</span><span style="color:#212121">system.img</span><span style="color:#212121">，可能无法使用该接口功能。</span></p> 
<p><span style="color:#212121">接口版本化和</span><span style="color:#212121">ABI </span> <span style="color:#212121">稳定性是必要的：</span></p> 
<p>l  通过VTS</p> 
<p>l  System 独立 OTA</p> 
<p>l  作为OEM，提供一个容易使用和兼任的BSP版本</p> 
<p>l  通过current.txt可以了解接口的发布历史记录</p> 
<p>当在current.txt为一个存在的接口添加一个新的hash时，为了确保ABI stability，需要审查下面的修改类型：</p> 
<img src="https://images2.imgbox.com/27/8e/szHpELy0_o.png" alt=""> 
<br> 
<p></p> 
<p>对于已发布的接口，ABIstability列出了哪些修改允许哪些不允许，对于不允许的修改只能在接口的次版本号或主版本号更新中修改。</p> 
<br> 
<br>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a267ab76c2ef88319d5096a52743960d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">完美解决Cannot download &#34;https://github.com/sass/node-sass/releases/download/binding.nod的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/05e745925518e0e61f19156b9b3ecad3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">智能手表连接电脑及adb测试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>