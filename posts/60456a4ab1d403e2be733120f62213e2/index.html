<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>UMAP分析及可视化 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="UMAP分析及可视化" />
<meta property="og:description" content="什么是UMAP？和PCA一样，一种降维的算法，如果不是统计学或者数据专业的人，我建议不要去看它的原理，知道如何用就足够了。
也许听到UMAP最多的是对单细胞数据的分析降维，类似于下图：
然而其他数据，像大样本的转录组在PCA降维效果不好的时候，可以使用UMAP，毕竟现在转录非常便宜，随便测几十个样品和玩似的。
首先构建一个数据集，行为样本，列为基因，并对样本的特征进行分组。
读入数据： setwd(&#34;E:/生物信息学&#34;)options(stringsAsFactors= F)####A &lt;- read.csv(&#34;UMAP.csv&#34;,header = T,row.names = 1) 安装R包：
install.packages(&#34;umap&#34;)library(umap) UMAP分析：
A_umap &lt;- A[,colnames(A)!= c(&#39;label2&#39;, &#39;label3&#39;,&#39;label4&#39;)]#新构建一个表，不含有labelA_umap &lt;- data.frame(t(apply(A_umap,1, function(v){(v-mean(v,na.rm=T))/sd(v,na.rm=T)})), stringsAsFactors=F)#标准化umap &lt;- umap(A_umap,method=&#39;naive&#39;,n_neighbors = 10) head(umap$layout) ##################### [,1] [,2]r1 16.16427 -11.32371r2 16.26652 -11.21803r3 16.28917 -11.45600r4 16.28618 -11.56981r5 16.15085 -12.07527r6 16.65784 -12.28240 提取分析结果用于作图：
B &lt;- data.frame(umap$layout)B$label &lt;- A$label2 colnames(B) &lt;- c(&#39;UMAP_1&#39;,&#39;UMAP_2&#39;,&#39;label&#39;) 作图是由ggplot实现的，应该很熟悉了：​​​​​​​
ggplot(B, aes(x=UMAP_1, y=UMAP_2, colour=label)) &#43; geom_point(size=1)&#43; xlab(&#34;UMAP_1&#34;)&#43; ylab(&#34;UMAP_2&#34;)&#43; theme( panel.grid.major = element_blank(), panel.grid.minor = element_blank(), legend." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/60456a4ab1d403e2be733120f62213e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-12-22T17:19:54+08:00" />
<meta property="article:modified_time" content="2021-12-22T17:19:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">UMAP分析及可视化</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" height="109" src="https://images2.imgbox.com/74/4c/JTLmdV3W_o.png" width="494"></p> 
<p>什么是UMAP？和PCA一样，一种降维的算法，如果不是统计学或者数据专业的人，我建议不要去看它的原理，知道如何用就足够了。</p> 
<p></p> 
<p>也许听到UMAP最多的是对单细胞数据的分析降维，类似于下图：</p> 
<p style="text-align:center;"><img alt="图片" src="https://images2.imgbox.com/0e/48/QohWBItO_o.png"></p> 
<p>然而其他数据，像大样本的转录组在PCA降维效果不好的时候，可以使用UMAP，毕竟现在转录非常便宜，随便测几十个样品和玩似的。</p> 
<p>首先构建一个数据集，行为样本，列为基因，并对样本的特征进行分组。</p> 
<p style="text-align:center;"><img alt="图片" src="https://images2.imgbox.com/a2/34/2VU5sqrx_o.png"></p> 
<p>读入数据： </p> 
<pre><code>setwd("E:/生物信息学")</code><code>options(stringsAsFactors= F)####</code><code>A &lt;- read.csv("UMAP.csv",header = T,row.names = 1)</code></pre> 
<p>安装R包：</p> 
<pre><code>install.packages("umap")</code><code>library(umap)</code></pre> 
<p>UMAP分析：</p> 
<pre><code>A_umap &lt;- A[,colnames(A)!= c('label2', 'label3','label4')]#新构建一个表，不含有label</code><code>A_umap &lt;- data.frame(t(apply(A_umap,1,</code><code>                             function(v){(v-mean(v,na.rm=T))/sd(v,na.rm=T)})),</code><code>                     stringsAsFactors=F)#标准化</code><code>umap &lt;- umap(A_umap,method='naive',n_neighbors = 10)    </code><code>head(umap$layout)    </code><code>#####################</code><code>       [,1]      [,2]</code><code>r1 16.16427 -11.32371</code><code>r2 16.26652 -11.21803</code><code>r3 16.28917 -11.45600</code><code>r4 16.28618 -11.56981</code><code>r5 16.15085 -12.07527</code><code>r6 16.65784 -12.28240             </code></pre> 
<p>提取分析结果用于作图：</p> 
<pre><code>B &lt;- data.frame(umap$layout)</code><code>B$label &lt;- A$label2 </code><code>colnames(B) &lt;- c('UMAP_1','UMAP_2','label')</code></pre> 
<p>作图是由ggplot实现的，应该很熟悉了：​​​​​​​</p> 
<pre><code>ggplot(B, aes(x=UMAP_1, y=UMAP_2, colour=label)) + </code><code>  geom_point(size=1)+ xlab("UMAP_1")+ ylab("UMAP_2")+ </code><code>  theme(  panel.grid.major = element_blank(),</code><code>                 panel.grid.minor = element_blank(),</code><code>                 legend.title=element_blank(), </code><code>                 panel.border = element_blank(),</code><code>                 axis.line.x = element_line(color="black", size = 0.5),</code><code>                 axis.line.y = element_line(color="black", size = 0.5),</code><code>                 panel.background = element_blank())</code></pre> 
<p style="text-align:center;"><img alt="图片" src="https://images2.imgbox.com/6a/35/nY6G1DFT_o.png"></p> 
<p>降维效果很好，当然图的颜色也是可以修改的，和之前讲的ggplot的修饰一样。除了对样本的分组，还可以展现其他的分组，毕竟数据中我们设置了3</p> 
<p>个label，我们看一下以性别的分组作图是什么样的？只需要改动下label即可。</p> 
<p> ​​​​​</p> 
<pre><code>C &lt;- data.frame(umap$layout)</code><code>C$label &lt;- A$label3 </code><code>colnames(C) &lt;- c('UMAP_1','UMAP_2','label') </code><code>ggplot(C, aes(x=UMAP_1, y=UMAP_2, colour=label)) + </code><code>  geom_point(size=1)+ xlab("UMAP_1")+ ylab("UMAP_2")+ </code><code>  theme(panel.grid.major = element_blank(),</code><code>                 panel.grid.minor = element_blank(),</code><code>                 legend.title=element_blank(), </code><code>                 panel.border = element_blank(),</code><code>                 axis.line.x = element_line(color="black", size = 0.5),</code><code>                 axis.line.y = element_line(color="black", size = 0.5),</code><code>                 panel.background = element_blank())</code></pre> 
<p style="text-align:center;"><img alt="图片" src="https://images2.imgbox.com/be/fd/g4mVFhij_o.png"></p> 
<p>效果不错！</p> 
<p>样本多可以试试这个方法，不局限于转录组，其他的任何数据都可以!</p> 
<p>想要示例数据的可以打赏截图联系作者获取，记得留下邮箱！</p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bfdb3f2f28fcfa824be75bdc1494665a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Duplicate keys detected: ‘/index‘. This may cause an update error.</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/41d5d8efbf14be19df9c28b3eb8787bd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">完美 幻塔</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>