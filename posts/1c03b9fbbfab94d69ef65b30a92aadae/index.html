<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图片和数据懒加载 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="图片和数据懒加载" />
<meta property="og:description" content="目标 了解如何实现图片数据懒加载
图片懒加载 背景 电商类网站，图片会非常的多，而如果一上来就加载所有的图片，会导致网页加载很慢
图片懒加载：等图片正式进入到可视区中时，才加载对应的图片，否则不请求图片
图片懒加载的原理:
如何知道图片进入或者离开了可视区？
通过vueuse封装的useIntersectionObserver
useIntersectionObserver // 实时监听这个dom是否在可视区内 // const { stop } = useIntersectionObserver(要监视的dom, ([{ isIntersecting }]) =&gt; { // // 回调函数: 当 isIntersecting 变化时：从可见-&gt;不可见； 不可见-&gt;可见 // isIntersecting: 当前是否可见？ // }) // stop: 停止监听 优化代码--封装自定义指令
封装指令 v-lazy，实现图片懒加载
/1.导入所有的公共组件 //2.定义插件,并导出 import { useIntersectionObserver } from &#39;@vueuse/core&#39;; import defaultImg from &#39;@/assets/images/200.png&#39; import {App} from &#39;vue&#39; export default { install(app:App){ app.directive(&#39;lazy&#39;,{ //mounted是v3自定义指令的生命周期,它会被自动调用 //它表示的含义和组件的mounted是一致的 //el是dom元素, binding mounted(el,binding){ //设置默认图 el." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1c03b9fbbfab94d69ef65b30a92aadae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-15T20:48:42+08:00" />
<meta property="article:modified_time" content="2022-07-15T20:48:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">图片和数据懒加载</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>目标</h4> 
<p id="u9b2972b1">了解如何实现图片数据懒加载</p> 
<h4>图片懒加载</h4> 
<h4>背景</h4> 
<p id="uac436cda">电商类网站，图片会非常的多，而如果一上来就加载所有的图片，会导致网页加载很慢</p> 
<p id="u17d4db84">图片懒加载：等图片正式进入到可视区中时，才加载对应的图片，否则不请求图片</p> 
<p>图片懒加载的原理:</p> 
<p><img alt="" height="643" src="https://images2.imgbox.com/36/35/NkC3OLuo_o.png" width="468"></p> 
<p> </p> 
<p id="u7da49df4">如何知道图片进入或者离开了可视区？</p> 
<blockquote> 
 <p id="uc0d0b2b0">通过vueuse封装的<a href="https://vueuse.org/core/useIntersectionObserver/" rel="nofollow" title="useIntersectionObserver">useIntersectionObserver</a></p> 
</blockquote> 
<h4 id="UsXxT">useIntersectionObserver</h4> 
<pre><code>// 实时监听这个dom是否在可视区内
// const { stop } = useIntersectionObserver(要监视的dom, ([{ isIntersecting }]) =&gt; {
//    // 回调函数: 当 isIntersecting 变化时：从可见-&gt;不可见； 不可见-&gt;可见
//    isIntersecting: 当前是否可见？
// })

// stop: 停止监听</code></pre> 
<p><strong>优化代码</strong>--封装自定义指令</p> 
<p>封装指令 v-lazy，实现图片懒加载</p> 
<pre><code>/1.导入所有的公共组件
//2.定义插件,并导出
import { useIntersectionObserver } from '@vueuse/core';
import defaultImg from '@/assets/images/200.png'
import {App} from 'vue'

export default {
  install(app:App){
    app.directive('lazy',{
     //mounted是v3自定义指令的生命周期,它会被自动调用
     //它表示的含义和组件的mounted是一致的
     //el是dom元素, binding
     mounted(el,binding){
      //设置默认图
      el.src=defaultImg
      // console.log('lazy',el,binding.value);

      //实时监听el是否可见,如果可见,给他的src设置binding
      const {stop} = useIntersectionObserver(el,([{isIntersecting}])=&gt;{
        if(isIntersecting){
          el.src = binding.value
          //停止
          stop()
        }
      })
      //el是img标签
      //el.onerror 0级dom事件
      el.onerror=()=&gt;{
        el.src = defaultImg
      }
    }
    })
  }
}</code></pre> 
<p>直接使用v-lazy,实现功能</p> 
<p><img alt="" height="33" src="https://images2.imgbox.com/79/67/y2PvhZRz_o.png" width="595"></p> 
<h4> 数据懒加载</h4> 
<p><strong>目标:</strong>封装组件数据懒加载可复用的逻辑</p> 
<p><strong>应用场景:</strong></p> 
<p id="u5e81f071">首页中，很多地方都应该使用组件数据懒加载这个功能，不管是哪个模块使用，下面代码都会重复书写.事实上，唯一可能会随着业务使用发生变化的是 ajax接口的调用</p> 
<p><img alt="" height="264" src="https://images2.imgbox.com/57/ef/8ZrVwHa5_o.png" width="377"></p> 
<p>封装通用的懒加载数据api,传入参数是一个函数</p> 
<pre><code>import { useIntersectionObserver } from '@vueuse/core';
import { onMounted, ref } from 'vue';
export  function useLazyData(fn:()=&gt;void){
  const target =  ref(null)
  //当整个区域处于可见状态时,才发送ajax
  onMounted(()=&gt;{
  // 第一个参数：ref引用，获取DOM
  // 第二个参数：回调，回调里面的参数 isIntersecting 会在参数一获取的 DOM 元素进入可视区域的时候监听并且为 true
   const { stop } = useIntersectionObserver(target.value,([{isIntersecting}])=&gt;{
     //可见
     if(isIntersecting){
        //发起请求
        fn()
        //停止监听
        stop()
     }
   })
  })
  return target
}</code></pre> 
<p> 调用函数,实现功能</p> 
<p><img alt="" height="91" src="https://images2.imgbox.com/42/ae/WMxeNunr_o.png" width="411"></p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1d8e3f610f3102f9558a27c13d0886c8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android P/Q中PackageManagerService添加接口方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/835daabcb2447c4156b0ee155bd85ec3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux系统的文件和目录</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>