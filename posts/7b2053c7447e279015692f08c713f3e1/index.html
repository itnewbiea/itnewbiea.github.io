<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>计算机图形学实验——利用MFC对话框实现多边形绘制与填充（扫描线填充算法）附源码 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="计算机图形学实验——利用MFC对话框实现多边形绘制与填充（扫描线填充算法）附源码" />
<meta property="og:description" content="内容概括：
利用基于对话框的MFC项目实现鼠标点击绘制多边形实现扫描线算法填充多边形 源码见Yushan-Ji/ComputerGraphics: ECNU2023秋 计算机图形学课程实验代码 (github.com)
实验内容 通过鼠标交互输入多边形对各种多边形进行填充，包括边界自交的情况 算法描述 多边形绘制 利用OnLButtonDown和OnRButtonDown函数，实现： 左键点击：开始绘制多边形，并连接上一个顶点和当前点击的顶点右键点击：结束绘制多边形，并连接上一个顶点和第一个顶点
其中，绘制顶点间的连线利用了MoveTo和LineTo函数 另外，为了避免多边形绘制完毕后，程序仍然对鼠标点击事件进行响应，因此需要添加布尔变量IsCompleted，用来监测当前多边形是否绘制完毕
因此在OnLButtonDown和OnRButtonDown函数的最开始，需要添加一个条件判断语句，若IsCompleted为TRUE，则表明多边形已绘制完毕，函数直接返回将所有顶点信息保存在vector&lt;CPoint&gt; points中，便于后续计算边信息 扫描线填充 y&#43;&#43;\n清空scanPoints 获取边表 AET更新 获取当前扫描线\n的所有交点 交点排序 填充当前扫描线 首先需要根据points中存储的多边形顶点信息，计算出多边形的边信息，得到ET表 新建Edge类，存储每条边的信息 // 边信息 class Edge { public: float x_lower; // 扫描线与边的交点x值（初始值为线段下端点x值） float dx; // 斜率倒数 float y_upper; // 线段上端点y值 // 构造函数 Edge() : x_lower(0.0), dx(0.0), y_upper(0.0) {} Edge(float x_val, float dx_val, float y_val); }; 新建ET表：map&lt;int, vector&lt;Edge&gt;&gt; ET 建立从线段下端点y值y_lower到多边形所有边vector&lt;Edge&gt;的映射，这样有相同下端点的不同边就能够存储在相同键值的map中，便于后续向AET中添加活性边 获取ET表：通过getET()函数实现 需要判断当前边是否为首尾顶点连成的边计算当前边斜率的倒数dx 若当前边平行于x轴，continue不执行任何操作若当前边平行于y轴，则dx=0不是上述两种情况则正常计算 计算x_lower 和y_upper 初始化、更新AET表 扫描线y初始化为ymin，并将ET表中ymin对应的所有边都添加到AET中对于每一条扫描线，都需要检查AET中是否有非活性边的存在，还要及时添加新的活性边 当y &gt;= y_upper 时，说明该边需要移除当y &gt;= y_lower时，说明该边需要添加到AET中 获取每条扫描线与活性边的交点，存入scanPoints中 对于不同边相交的顶点，不存入对于其他交点，易知交点数量必为偶数，因此成对存入交点 根据scanPoints中交点的x值升序排列所有交点，并进行填充 核心代码 CPolygonFillDlg类中新添加的public成员：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7b2053c7447e279015692f08c713f3e1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-25T22:25:36+08:00" />
<meta property="article:modified_time" content="2023-10-25T22:25:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">计算机图形学实验——利用MFC对话框实现多边形绘制与填充（扫描线填充算法）附源码</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>内容概括：</p> 
 <ul><li>利用基于对话框的MFC项目</li><li>实现鼠标点击绘制多边形</li><li>实现扫描线算法填充多边形</li></ul> 
</blockquote> 
<p>源码见<a href="https://github.com/Yushan-Ji/ComputerGraphics">Yushan-Ji/ComputerGraphics: ECNU2023秋 计算机图形学课程实验代码 (github.com)</a></p> 
<h2><a id="_6"></a>实验内容</h2> 
<ol><li>通过鼠标交互输入多边形</li><li>对各种多边形进行填充，包括边界自交的情况</li></ol> 
<h2><a id="_11"></a>算法描述</h2> 
<h3><a id="_13"></a>多边形绘制</h3> 
<ol><li>利用<code>OnLButtonDown</code>和<code>OnRButtonDown</code>函数，实现： 
  <ul><li><strong>左键点击</strong>：开始绘制多边形，并连接上一个顶点和当前点击的顶点</li><li><strong>右键点击</strong>：结束绘制多边形，并连接上一个顶点和第一个顶点<br> 其中，绘制顶点间的连线利用了<code>MoveTo</code>和<code>LineTo</code>函数</li></ul> </li><li>另外，为了避免多边形绘制完毕后，程序仍然对鼠标点击事件进行响应，因此需要添加布尔变量<code>IsCompleted</code>，用来<strong>监测当前多边形是否绘制完毕</strong><br> 因此在<code>OnLButtonDown</code>和<code>OnRButtonDown</code>函数的最开始，需要添加一个条件判断语句，若<code>IsCompleted</code>为<code>TRUE</code>，则表明多边形已绘制完毕，函数直接返回</li><li>将所有顶点信息保存在<code>vector&lt;CPoint&gt; points</code>中，便于后续计算边信息</li></ol> 
<h3><a id="_23"></a>扫描线填充</h3> 
<div class="mermaid"> 
 <svg id="mermaid-svg-sEWg8QdRo2PBTAMA" width="967.2708740234375" xmlns="http://www.w3.org/2000/svg" height="110" viewbox="0 0 967.2708740234375 110" class="mermaid-svg"> 
  <style>#mermaid-svg-sEWg8QdRo2PBTAMA {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-sEWg8QdRo2PBTAMA .error-icon{fill:#552222;}#mermaid-svg-sEWg8QdRo2PBTAMA .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-sEWg8QdRo2PBTAMA .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-sEWg8QdRo2PBTAMA .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-sEWg8QdRo2PBTAMA .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-sEWg8QdRo2PBTAMA .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-sEWg8QdRo2PBTAMA .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-sEWg8QdRo2PBTAMA .marker{fill:#333333;stroke:#333333;}#mermaid-svg-sEWg8QdRo2PBTAMA .marker.cross{stroke:#333333;}#mermaid-svg-sEWg8QdRo2PBTAMA svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-sEWg8QdRo2PBTAMA .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-sEWg8QdRo2PBTAMA .cluster-label text{fill:#333;}#mermaid-svg-sEWg8QdRo2PBTAMA .cluster-label span{color:#333;}#mermaid-svg-sEWg8QdRo2PBTAMA .label text,#mermaid-svg-sEWg8QdRo2PBTAMA span{fill:#333;color:#333;}#mermaid-svg-sEWg8QdRo2PBTAMA .node rect,#mermaid-svg-sEWg8QdRo2PBTAMA .node circle,#mermaid-svg-sEWg8QdRo2PBTAMA .node ellipse,#mermaid-svg-sEWg8QdRo2PBTAMA .node polygon,#mermaid-svg-sEWg8QdRo2PBTAMA .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-sEWg8QdRo2PBTAMA .node .label{text-align:center;}#mermaid-svg-sEWg8QdRo2PBTAMA .node.clickable{cursor:pointer;}#mermaid-svg-sEWg8QdRo2PBTAMA .arrowheadPath{fill:#333333;}#mermaid-svg-sEWg8QdRo2PBTAMA .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-sEWg8QdRo2PBTAMA .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-sEWg8QdRo2PBTAMA .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-sEWg8QdRo2PBTAMA .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-sEWg8QdRo2PBTAMA .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-sEWg8QdRo2PBTAMA .cluster text{fill:#333;}#mermaid-svg-sEWg8QdRo2PBTAMA .cluster span{color:#333;}#mermaid-svg-sEWg8QdRo2PBTAMA div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-sEWg8QdRo2PBTAMA :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g> 
   <g class="output"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <g class="edgePath LS-1 LE-2" style="opacity: 1;" id="L-1-2"> 
      <path class="path" d="M92,60L96.16666666666667,60C100.33333333333333,60,108.66666666666667,60,117,60C125.33333333333333,60,133.66666666666666,60,137.83333333333334,60L142,60" marker-end="url(#arrowhead95)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead95" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-2 LE-3" style="opacity: 1;" id="L-2-3"> 
      <path class="path" d="M221.30208587646484,42.21404956595464L225.4687525431315,40.3450413049622C229.6354192097982,38.47603304396976,237.9687525431315,34.73801652198488,246.30208587646484,32.86900826099244C254.6354192097982,31,262.96875254313153,31,267.13541920979816,31L271.30208587646484,31" marker-end="url(#arrowhead96)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead96" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-3 LE-4" style="opacity: 1;" id="L-3-4"> 
      <path class="path" d="M497.73958587646484,31L514.0338567097982,31C530.3281275431315,31,562.9166692097982,31,595.5052108764648,31C628.0937525431315,31,660.6822942097982,31,676.9765650431315,31L693.2708358764648,31" marker-end="url(#arrowhead97)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead97" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-4 LE-5" style="opacity: 1;" id="L-4-5"> 
      <path class="path" d="M777.2708358764648,31L781.4375025431315,31C785.6041692097982,31,793.9375025431315,31,802.2708358764648,32.327838827838825C810.6041692097982,33.65567765567766,818.9375025431315,36.31135531135531,823.1041692097982,37.63919413919414L827.2708358764648,38.967032967032964" marker-end="url(#arrowhead98)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead98" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
     <g class="edgePath LS-5 LE-2" style="opacity: 1;" id="L-5-2"> 
      <path class="path" d="M827.2708358764648,81.03296703296704L823.1041692097982,82.36080586080585C818.9375025431315,83.68864468864469,810.6041692097982,86.34432234432234,795.2708358764648,87.67216117216117C779.9375025431315,89,757.6041692097982,89,723.1432317097982,89C688.6822942097982,89,642.0937525431315,89,583.6354192097982,89C525.1770858764648,89,454.84896087646484,89,396.64844004313153,89C338.44791920979816,89,292.37500254313153,89,265.17187754313153,87.13099173900757C237.9687525431315,85.26198347801513,229.6354192097982,81.52396695603024,225.4687525431315,79.6549586950378L221.30208587646484,77.78595043404536" marker-end="url(#arrowhead99)" style="fill:none"></path> 
      <defs> 
       <marker id="arrowhead99" viewbox="0 0 10 10" refx="9" refy="5" markerunits="strokeWidth" markerwidth="8" markerheight="6" orient="auto"> 
        <path d="M 0 0 L 10 5 L 0 10 z" class="arrowheadPath" style="stroke-width: 1; stroke-dasharray: 1, 0;"></path> 
       </marker> 
      </defs> 
     </g> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-1-2" class="edgeLabel L-LS-1' L-LE-2"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-2-3" class="edgeLabel L-LS-2' L-LE-3"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-3-4" class="edgeLabel L-LS-3' L-LE-4"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform=""> 
      <g transform="translate(0,0)" class="label"> 
       <rect rx="0" ry="0" width="0" height="0"></rect> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-4-5" class="edgeLabel L-LS-4' L-LE-5"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" style="opacity: 1;" transform="translate(595.5052108764648,89)"> 
      <g transform="translate(-72.765625,-13)" class="label"> 
       <rect rx="0" ry="0" width="145.53125" height="26"></rect> 
       <foreignobject width="145.53125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span id="L-L-5-2" class="edgeLabel L-LS-5' L-LE-2">y++\n清空scanPoints</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default" style="opacity: 1;" id="flowchart-1-75" transform="translate(50,60)"> 
      <rect rx="0" ry="0" x="-42" y="-23" width="84" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-32,-13)"> 
        <foreignobject width="64" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           获取边表 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-2-76" transform="translate(181.65104293823242,60)"> 
      <rect rx="0" ry="0" x="-39.65104293823242" y="-23" width="79.30208587646484" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-29.651042938232422,-13)"> 
        <foreignobject width="59.302085876464844" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           AET更新 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-3-77" transform="translate(384.52083587646484,31)"> 
      <rect rx="0" ry="0" x="-113.21875" y="-23" width="226.4375" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-103.21875,-13)"> 
        <foreignobject width="206.4375" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           获取当前扫描线\n的所有交点 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-4-78" transform="translate(735.2708358764648,31)"> 
      <rect rx="0" ry="0" x="-42" y="-23" width="84" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-32,-13)"> 
        <foreignobject width="64" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           交点排序 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
     <g class="node default" style="opacity: 1;" id="flowchart-5-79" transform="translate(893.2708358764648,60)"> 
      <rect rx="0" ry="0" x="-66" y="-23" width="132" height="46" class="label-container"></rect> 
      <g class="label" transform="translate(0,0)"> 
       <g transform="translate(-56,-13)"> 
        <foreignobject width="112" height="26"> 
         <div style="display: inline-block; white-space: nowrap;">
           填充当前扫描线 
         </div> 
        </foreignobject> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<ol><li>首先需要根据<code>points</code>中存储的多边形顶点信息，计算出多边形的边信息，得到<code>ET</code>表 
  <ul><li>新建<code>Edge</code>类，存储每条边的信息<pre><code class="prism language-cpp">    <span class="token comment">// 边信息</span>
    <span class="token keyword">class</span> <span class="token class-name">Edge</span> 
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
    	<span class="token keyword">float</span> x_lower<span class="token punctuation">;</span> <span class="token comment">// 扫描线与边的交点x值（初始值为线段下端点x值）</span>
    	<span class="token keyword">float</span> dx<span class="token punctuation">;</span> <span class="token comment">// 斜率倒数</span>
    	<span class="token keyword">float</span> y_upper<span class="token punctuation">;</span> <span class="token comment">// 线段上端点y值</span>
    	<span class="token comment">// 构造函数</span>
    	<span class="token function">Edge</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">x_lower</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">dx</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">y_upper</span><span class="token punctuation">(</span><span class="token number">0.0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    	<span class="token function">Edge</span><span class="token punctuation">(</span><span class="token keyword">float</span> x_val<span class="token punctuation">,</span> <span class="token keyword">float</span> dx_val<span class="token punctuation">,</span> <span class="token keyword">float</span> y_val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> </li><li>新建<code>ET</code>表：<code>map&lt;int, vector&lt;Edge&gt;&gt; ET</code> 
    <ul><li>建立从线段下端点y值<code>y_lower</code>到多边形所有边<code>vector&lt;Edge&gt;</code>的映射，这样有<strong>相同下端点的不同边</strong>就能够存储在相同键值的map中，便于后续向<code>AET</code>中添加活性边</li></ul> </li><li>获取<code>ET</code>表：通过<code>getET()</code>函数实现 
    <ul><li>需要判断当前边是否为首尾顶点连成的边</li><li>计算当前边斜率的倒数<code>dx</code> 
      <ul><li>若当前边平行于x轴，<code>continue</code>不执行任何操作</li><li>若当前边平行于y轴，则<code>dx=0</code></li><li>不是上述两种情况则正常计算</li></ul> </li><li>计算<code>x_lower</code> 和<code>y_upper</code></li></ul> </li></ul> </li><li>初始化、更新<code>AET</code>表 
  <ul><li>扫描线<code>y</code>初始化为<code>ymin</code>，并将<code>ET</code>表中<code>ymin</code>对应的所有边都添加到<code>AET</code>中</li><li>对于每一条扫描线，都需要检查<code>AET</code>中是否有非活性边的存在，还要及时添加新的活性边 
    <ul><li>当<code>y &gt;= y_upper </code>时，说明该边需要移除</li><li>当<code>y &gt;= y_lower</code>时，说明该边需要添加到<code>AET</code>中</li></ul> </li></ul> </li><li>获取每条扫描线与活性边的交点，存入<code>scanPoints</code>中 
  <ul><li>对于不同边相交的顶点，不存入</li><li>对于其他交点，易知交点数量必为偶数，因此成对存入交点</li></ul> </li><li>根据<code>scanPoints</code>中交点的<code>x</code>值升序排列所有交点，并进行填充</li></ol> 
<h2><a id="_75"></a>核心代码</h2> 
<p><code>CPolygonFillDlg</code>类中新添加的<code>public</code>成员：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">CPolygonFillDlg</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">CDialogEx</span></span>
<span class="token punctuation">{<!-- --></span>
  <span class="token keyword">public</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>CPoint<span class="token operator">&gt;</span> points<span class="token punctuation">;</span> <span class="token comment">// 存储多边形的顶点</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>CPoint<span class="token operator">&gt;</span> scanPoints<span class="token punctuation">;</span> <span class="token comment">// 存储扫描线与活动边的交点</span>
    
	BOOL IsCompleted<span class="token punctuation">;</span> <span class="token comment">// 标志多边形是否绘制完毕</span>
    
	std<span class="token double-colon punctuation">::</span>map<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token punctuation">,</span> std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Edge<span class="token operator">&gt;&gt;</span> ET<span class="token punctuation">;</span> <span class="token comment">// ET表：从线段下端点y值到边信息链表的映射</span>
	std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Edge<span class="token operator">&gt;</span> AET<span class="token punctuation">;</span> <span class="token comment">// 活动边表</span>
	<span class="token keyword">float</span> YMAX<span class="token punctuation">;</span> <span class="token comment">// 存储多边形最高点</span>
    
	<span class="token keyword">void</span> <span class="token function">getET</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">PolygonFill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">compareCPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> CPoint<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> CPoint<span class="token operator">&amp;</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_98"></a>消息函数</h3> 
<p>在<code>PolygonFillDlg.cpp</code>中需要添加按钮点击、鼠标点击的消息关联函数</p> 
<pre><code class="prism language-cpp"><span class="token comment">// 消息关联</span>
<span class="token function">BEGIN_MESSAGE_MAP</span><span class="token punctuation">(</span>CPolygonFillDlg<span class="token punctuation">,</span> CDialogEx<span class="token punctuation">)</span>
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
	<span class="token function">ON_WM_LBUTTONDOWN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 关联鼠标左键点击事件</span>
	<span class="token function">ON_WM_RBUTTONDOWN</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// 关联鼠标右键点击事件</span>
	<span class="token function">ON_BN_CLICKED</span><span class="token punctuation">(</span>IDC_BUTTON_FILL<span class="token punctuation">,</span> <span class="token operator">&amp;</span>PolygonFill<span class="token punctuation">)</span> <span class="token comment">// 关联按钮点击事件</span>
<span class="token function">END_MESSAGE_MAP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>在<code>PolygonFillDlg.h</code>中需要添加鼠标点击函数的声明</p> 
<pre><code class="prism language-c++">class CPolygonFillDlg : public CDialogEx
{
    ...
  protected:
    ...
    afx_msg void OnLButtonDown(UINT nFlags, CPoint point);
    afx_msg void OnRButtonDown(UINT nFlags, CPoint point);
    ...
}
</code></pre> 
<h3><a id="_126"></a>多边形绘制</h3> 
<pre><code class="prism language-cpp"><span class="token comment">// 鼠标左键点击事件（绘制多边形）</span>
<span class="token keyword">void</span> <span class="token class-name">CPolygonFillDlg</span><span class="token double-colon punctuation">::</span><span class="token function">OnLButtonDown</span><span class="token punctuation">(</span>UINT nFlags<span class="token punctuation">,</span> CPoint point<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 若多边形绘制完毕，忽略该函数，不执行操作</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>IsCompleted <span class="token operator">==</span> TRUE<span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 如果是第一个点，存入points数组中</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{<!-- --></span>
			points<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 若不是第一个点，则连接当前点和上一个点</span>
		<span class="token keyword">else</span> 
		<span class="token punctuation">{<!-- --></span>
			CStatic<span class="token operator">*</span> CANVAS <span class="token operator">=</span> <span class="token punctuation">(</span>CStatic<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">GetDlgItem</span><span class="token punctuation">(</span>IDC_STATIC_CANVAS<span class="token punctuation">)</span><span class="token punctuation">;</span>
			CDC<span class="token operator">*</span> pDC <span class="token operator">=</span> CANVAS<span class="token operator">-&gt;</span><span class="token function">GetDC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// 获取points数组的最后一个point（就是上一个点），并将当前绘图位置移动到该点</span>
			pDC<span class="token operator">-&gt;</span><span class="token function">MoveTo</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span>points<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 连接上一个点和当前点</span>
			pDC<span class="token operator">-&gt;</span><span class="token function">LineTo</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span>
			points<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>point<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将当前点加入数组</span>
			<span class="token function">ReleaseDC</span><span class="token punctuation">(</span>pDC<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 鼠标右键点击事件（多边形绘制完毕）</span>
<span class="token keyword">void</span> <span class="token class-name">CPolygonFillDlg</span><span class="token double-colon punctuation">::</span><span class="token function">OnRButtonDown</span><span class="token punctuation">(</span>UINT nFlags<span class="token punctuation">,</span> CPoint point<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>IsCompleted <span class="token operator">==</span> TRUE<span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">else</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 如果前面少于3个点，则无法连接成为多边形，弹出错误信息</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			CString message <span class="token operator">=</span> <span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"顶点数量少于3，无法绘制多边形"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			CString caption <span class="token operator">=</span> <span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"多边形绘制错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">MessageBox</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> caption<span class="token punctuation">,</span> MB_ICONERROR<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token comment">// 若points已存储有2个以上的顶点，则连接上一个点和第一个点</span>
		<span class="token keyword">else</span> 
		<span class="token punctuation">{<!-- --></span>
			CStatic<span class="token operator">*</span> CANVAS <span class="token operator">=</span> <span class="token punctuation">(</span>CStatic<span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">GetDlgItem</span><span class="token punctuation">(</span>IDC_STATIC_CANVAS<span class="token punctuation">)</span><span class="token punctuation">;</span>
			CDC<span class="token operator">*</span> pDC <span class="token operator">=</span> CANVAS<span class="token operator">-&gt;</span><span class="token function">GetDC</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 连接第一个点和当前点</span>
			pDC<span class="token operator">-&gt;</span><span class="token function">MoveTo</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span>points<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			pDC<span class="token operator">-&gt;</span><span class="token function">LineTo</span><span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">ReleaseDC</span><span class="token punctuation">(</span>pDC<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">// 成功消息</span>
			CString message <span class="token operator">=</span> <span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"多边形绘制完毕"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			CString caption <span class="token operator">=</span> <span class="token function">_T</span><span class="token punctuation">(</span><span class="token string">"多边形绘制完毕"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">MessageBox</span><span class="token punctuation">(</span>message<span class="token punctuation">,</span> caption<span class="token punctuation">,</span> MB_OK<span class="token punctuation">)</span><span class="token punctuation">;</span>

			IsCompleted <span class="token operator">=</span> TRUE<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_198"></a>扫描线填充</h3> 
<p>由于扫描线填充涉及到的代码较长，这里不全部展示，仅列出关键的几个步骤</p> 
<h4><a id="_202"></a>获取边表</h4> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">CPolygonFillDlg</span><span class="token double-colon punctuation">::</span><span class="token function">getET</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> points<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> 
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">float</span> dx<span class="token punctuation">;</span>
		<span class="token keyword">float</span> x_lower<span class="token punctuation">,</span> y_lower<span class="token punctuation">,</span> y_upper<span class="token punctuation">;</span>

		<span class="token comment">// points中最后一个点和第一个点的连线</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> points<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">==</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 边平行于x轴，不处理</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">==</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				dx <span class="token operator">=</span> <span class="token number">0.0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				dx <span class="token operator">=</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				y_lower <span class="token operator">=</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
				y_upper <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
				x_lower <span class="token operator">=</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				y_lower <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
				y_upper <span class="token operator">=</span> points<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
				x_lower <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token comment">// 插入到Edge边信息中</span>
			Edge <span class="token function">e</span><span class="token punctuation">(</span>x_lower<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> y_upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 插入到ET表中</span>
			ET<span class="token punctuation">[</span>y_lower<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">else</span> 
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 斜率</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">==</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">continue</span><span class="token punctuation">;</span> <span class="token comment">// 边平行于x轴，不处理</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">==</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				dx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				dx <span class="token operator">=</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x <span class="token operator">-</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">1.0</span> <span class="token operator">/</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">-</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// 线段上端点的x，y值</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y <span class="token operator">&lt;=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				y_lower <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
				y_upper <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
				x_lower <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span>
			<span class="token punctuation">{<!-- --></span>
				y_lower <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
				y_upper <span class="token operator">=</span> points<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>y<span class="token punctuation">;</span>
				x_lower <span class="token operator">=</span> points<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>x<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// 计算多边形的最高点y值</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>y_upper <span class="token operator">&gt;=</span> YMAX<span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				YMAX <span class="token operator">=</span> y_upper<span class="token punctuation">;</span>
			<span class="token punctuation">}</span>

			<span class="token comment">// 插入到Edge边信息中</span>
			Edge <span class="token function">e</span><span class="token punctuation">(</span>x_lower<span class="token punctuation">,</span> dx<span class="token punctuation">,</span> y_upper<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token comment">// 插入到ET表中</span>
			ET<span class="token punctuation">[</span>y_lower<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="AET_291"></a>AET表更新</h4> 
<pre><code class="prism language-cpp"><span class="token comment">// 移除已经超出扫描线的边</span>
std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>Edge<span class="token operator">&gt;</span> newAET<span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span> it <span class="token operator">=</span> AET<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> it <span class="token operator">!=</span> AET<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token operator">++</span>it<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>it<span class="token operator">-&gt;</span>y_upper <span class="token operator">&gt;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		newAET<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token operator">*</span>it<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
AET <span class="token operator">=</span> newAET<span class="token punctuation">;</span>

<span class="token comment">//检查是否有新的边加入</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>it_ET <span class="token operator">!=</span> ET<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> y <span class="token operator">&gt;=</span> it_ET<span class="token operator">-&gt;</span>first<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	AET<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>AET<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> it_ET<span class="token operator">-&gt;</span>second<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> it_ET<span class="token operator">-&gt;</span>second<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	it_ET<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_310"></a>获取当前扫描线的所有交点</h4> 
<pre><code class="prism language-cpp"><span class="token keyword">auto</span> it <span class="token operator">=</span> AET<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> AET<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">float</span> x1 <span class="token operator">=</span> it<span class="token operator">-&gt;</span>x_lower<span class="token punctuation">;</span>
	it<span class="token operator">-&gt;</span>x_lower <span class="token operator">+=</span> it<span class="token operator">-&gt;</span>dx<span class="token punctuation">;</span>
	it<span class="token operator">++</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>it <span class="token operator">!=</span> AET<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">float</span> x2 <span class="token operator">=</span> it<span class="token operator">-&gt;</span>x_lower<span class="token punctuation">;</span>
		it<span class="token operator">-&gt;</span>x_lower <span class="token operator">+=</span> it<span class="token operator">-&gt;</span>dx<span class="token punctuation">;</span>
		it<span class="token operator">++</span><span class="token punctuation">;</span>

		<span class="token comment">// 扫描线遇到两条线相交的顶点时，不记录交点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>x1 <span class="token operator">!=</span> x2<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			scanPoints<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">CPoint</span><span class="token punctuation">(</span>x1<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			scanPoints<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">CPoint</span><span class="token punctuation">(</span>x2<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="_336"></a>交点排序并填充</h4> 
<pre><code class="prism language-cpp"><span class="token comment">// 比较函数，按照CPoint对象的x值升序排列</span>
<span class="token keyword">bool</span> <span class="token class-name">CPolygonFillDlg</span><span class="token double-colon punctuation">::</span><span class="token function">compareCPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> CPoint<span class="token operator">&amp;</span> a<span class="token punctuation">,</span> <span class="token keyword">const</span> CPoint<span class="token operator">&amp;</span> b<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">return</span> a<span class="token punctuation">.</span>x <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-c++">// 对扫描到的所有交点进行升序排列
std::sort(scanPoints.begin(), scanPoints.end(), compareCPoint);

// 获取画板
CStatic* CANVAS = (CStatic*)GetDlgItem(IDC_STATIC_CANVAS);
CDC* pDC = CANVAS-&gt;GetDC();
// 成对绘制，i每次+2
for (int i = 0; i &lt; scanPoints.size(); i += 2)
{
	pDC-&gt;MoveTo(scanPoints[i]);
	pDC-&gt;LineTo(scanPoints[i + 1]);
}
ReleaseDC(pDC);
</code></pre> 
<h2><a id="_361"></a>实验结果</h2> 
<img src="https://images2.imgbox.com/de/07/8ogNfW0d_o.png" alt="image-20231025213116930"> 
<p>如上图，通过左键点击绘制多边形，右键点击结束绘制</p> 
<p>绘制成功后会弹出绘制完毕的提示框</p> 
<p>如果多边形顶点少于3个，则弹出错误提示框如下：</p> 
<img src="https://images2.imgbox.com/88/bd/fVX76Q90_o.png" alt="image-20231025213258682"> 
<p>随后点击<code>Fill Polygon</code>按钮，运行扫描线填充，结果如下：</p> 
<ul><li>凸多边形<br> ​ <img src="https://images2.imgbox.com/64/09/o4hPPg61_o.png" alt="image-20231025213412123"></li><li>凹多边形<br> ​ <img src="https://images2.imgbox.com/a9/6e/C5GnOHsk_o.png" alt="image-20231025213526340"></li><li>边相交<br> ​ <img src="https://images2.imgbox.com/1b/ba/9BCu9Efa_o.png" alt="image-20231025213430842"></li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6ee093e746a49744b4e3f55c72e967e7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">语音转文字以及音频格式转换（推荐链接）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e60f3d88e4cbe7da9ed5157358b2a9c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">PBA.常用人工智能预测分析算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>