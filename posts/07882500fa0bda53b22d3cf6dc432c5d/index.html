<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32 ws2812b多屏驱动程序 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32 ws2812b多屏驱动程序" />
<meta property="og:description" content="文章目录 前言一、ws2812b的数据传输以及屏幕的组合二、代码ws2812screen.c文件ws2812screen.h文件主函数 前言 在上篇文章中使用了stm32的dma&#43;tim的方式点亮了ws2812b的灯
但是我的需求不仅仅是点亮他，我需要他像屏幕一样显示某一些东西，ws2812显示有一个开源库AWTRIX
这个库需要使用上位机不是很符合我的需求。
所以自己写了一个屏幕的驱动，后续会不断在此基础上改进。
例如我使用的是一个5*5的小ws2812b的屏幕
但是我需要把多个屏幕组合起来。当点亮某个屏幕的时候不能总是一个个按照他的数据方向一个个数。所以我们就需要对每个灯珠进行重映射–也就是通过【x】【y】的方式来点亮屏幕。
2023/7/17 可以多块屏幕组合进行显示，可以设置数据流动方向
一、ws2812b的数据传输以及屏幕的组合 ws2812b的数据传输是有方向的以我买的屏幕为例.
绿色的是板子的第一个灯，按照这个数据流向。
当把多个板子组合在一起的时候
数据就是这样子流向
再有多行板子的时候
当弄清楚了数据的流向以后就需要明确板子的行列关系.
二、代码 ws2812screen.c文件 本代码段分别有initializeLedMapping(int boardRows, int boardCols, int rows, int cols)
其中的几个参数需要根据上面的自己填写。
void setLedColor(int x, int y, uint32_t colorValue) 是给点设置颜色的。设置完以后还要调用上篇文章的中
的void WS2812_Send (void)进行发送。
你还可以调用void drawDigit(int digit, int startX, int startY, uint32_t colorValueOn, uint32_t colorValueOff) 这个函数来显示阿拉伯数字
void drawColon(int x, int y, uint8_t on,uint32_t colorValueOn) 函数是显示冒号的，为后续做时钟做准备。
显示3x5的阿拉伯数字的二维布尔数组的定义
显示一个阿拉伯数字最少需要3*5的灯珠
效果
#include &#34;ws2812screen.h&#34; #include &#34;stdio.h&#34; #include &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/07882500fa0bda53b22d3cf6dc432c5d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-17T15:38:26+08:00" />
<meta property="article:modified_time" content="2023-07-17T15:38:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32 ws2812b多屏驱动程序</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_6" rel="nofollow">前言</a></li><li><a href="#ws2812b_22" rel="nofollow">一、ws2812b的数据传输以及屏幕的组合</a></li><li><a href="#_48" rel="nofollow">二、代码</a></li><li><ul><li><a href="#ws2812screenc_51" rel="nofollow">ws2812screen.c文件</a></li><li><a href="#ws2812screenh_262" rel="nofollow">ws2812screen.h文件</a></li><li><a href="#_285" rel="nofollow">主函数</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_6"></a>前言</h2> 
<p>在<a href="https://blog.csdn.net/qq_59953808/article/details/131754607">上篇文章</a>中使用了stm32的dma+tim的方式点亮了ws2812b的灯<br> 但是我的需求不仅仅是点亮他，我需要他像屏幕一样显示某一些东西，ws2812显示有一个开源库<a href="https://awtrixdocs.blueforcer.de/#/en-en/README" rel="nofollow">AWTRIX</a><br> 这个库需要使用上位机不是很符合我的需求。<br> 所以自己写了一个屏幕的驱动，后续会不断在此基础上改进。<br> 例如我使用的是一个5*5的小ws2812b的屏幕</p> 
<p><img src="https://images2.imgbox.com/16/d7/8pKoYoJ6_o.png" alt="在这里插入图片描述"></p> 
<p>但是我需要把多个屏幕组合起来。当点亮某个屏幕的时候不能总是一个个按照他的数据方向一个个数。所以我们就需要对每个灯珠进行重映射–也就是通过【x】【y】的方式来点亮屏幕。<br> <img src="https://images2.imgbox.com/6f/a7/UyfVjuUC_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>2023/7/17 可以多块屏幕组合进行显示，可以设置数据流动方向</p> 
</blockquote> 
<h2><a id="ws2812b_22"></a>一、ws2812b的数据传输以及屏幕的组合</h2> 
<p>ws2812b的数据传输是有方向的以我买的屏幕为例.<br> 绿色的是板子的第一个灯，按照这个数据流向。</p> 
<p><img src="https://images2.imgbox.com/47/b7/EsroC2AO_o.png" alt="在这里插入图片描述"><br> 当把多个板子组合在一起的时候<br> 数据就是这样子流向</p> 
<p><img src="https://images2.imgbox.com/0c/77/z2u6YwZ7_o.png" alt="在这里插入图片描述"><br> 再有多行板子的时候<br> <img src="https://images2.imgbox.com/ab/2d/inCO4Pm2_o.png" alt="在这里插入图片描述"><br> 当弄清楚了数据的流向以后就需要明确板子的行列关系.</p> 
<p><img src="https://images2.imgbox.com/97/8c/ez7nWYKx_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a4/1d/YHK0GaAj_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_48"></a>二、代码</h2> 
<h3><a id="ws2812screenc_51"></a>ws2812screen.c文件</h3> 
<p>本代码段分别有<code>initializeLedMapping(int boardRows, int boardCols, int rows, int cols)</code><br> 其中的几个参数需要根据上面的自己填写。<br> <code>void setLedColor(int x, int y, uint32_t colorValue) </code>是给点设置颜色的。设置完以后还要调用上篇文章的中<br> 的<code>void WS2812_Send (void)</code>进行发送。<br> 你还可以调用<code>void drawDigit(int digit, int startX, int startY, uint32_t colorValueOn, uint32_t colorValueOff) </code>这个函数来显示阿拉伯数字<br> <code>void drawColon(int x, int y, uint8_t on,uint32_t colorValueOn) </code>函数是显示冒号的，为后续做时钟做准备。</p> 
<blockquote> 
 <p>显示3x5的阿拉伯数字的二维布尔数组的定义<br> 显示一个阿拉伯数字最少需要3*5的灯珠</p> 
</blockquote> 
<p>效果<br> <img src="https://images2.imgbox.com/36/d3/MDLiWuf1_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ws2812screen.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stdio.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stdlib.h"</span></span>


<span class="token keyword">int</span><span class="token operator">*</span><span class="token operator">*</span> ledMapping<span class="token punctuation">;</span>

<span class="token keyword">int</span> totalBoards<span class="token punctuation">;</span>
<span class="token keyword">int</span> ledsPerBoard<span class="token punctuation">;</span>  <span class="token comment">// LEDs per board</span>
<span class="token keyword">int</span> rowsPerBoard<span class="token punctuation">;</span>  <span class="token comment">// Rows per board</span>
<span class="token keyword">int</span> colsPerBoard<span class="token punctuation">;</span>  <span class="token comment">// Columns per board</span>


<span class="token comment">///*</span>
<span class="token comment">//int boardCount	几行小板子</span>
<span class="token comment">//int boardCols		几列小板子</span>
<span class="token comment">//int rows		小板子中灯的行数</span>
<span class="token comment">//int cols		小板子中灯的列数</span>
<span class="token comment">//*/</span>
<span class="token keyword">void</span> <span class="token function">initializeLedMapping</span><span class="token punctuation">(</span><span class="token keyword">int</span> boardRows<span class="token punctuation">,</span> <span class="token keyword">int</span> boardCols<span class="token punctuation">,</span> <span class="token keyword">int</span> rows<span class="token punctuation">,</span> <span class="token keyword">int</span> cols<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    totalBoards <span class="token operator">=</span> boardRows<span class="token operator">*</span>boardCols<span class="token punctuation">;</span>
    rowsPerBoard <span class="token operator">=</span> rows<span class="token punctuation">;</span>
    colsPerBoard <span class="token operator">=</span> cols<span class="token punctuation">;</span>
    ledsPerBoard <span class="token operator">=</span> rows <span class="token operator">*</span> cols<span class="token punctuation">;</span>  <span class="token comment">// Calculate total LEDs per board</span>
	
    <span class="token comment">// Allocate memory for the mapping table  为映射表分配内存</span>
    ledMapping <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span> <span class="token operator">*</span> totalBoards <span class="token operator">*</span> colsPerBoard<span class="token punctuation">)</span><span class="token punctuation">;</span>  

    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalBoards<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> colsPerBoard<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            ledMapping<span class="token punctuation">[</span>i<span class="token operator">*</span>colsPerBoard<span class="token operator">+</span>j<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">malloc</span><span class="token punctuation">(</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token operator">*</span> rowsPerBoard <span class="token operator">*</span> boardRows<span class="token punctuation">)</span><span class="token punctuation">;</span>  

            <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> m <span class="token operator">&lt;</span> rowsPerBoard <span class="token operator">*</span> boardRows<span class="token punctuation">;</span> <span class="token operator">++</span>m<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">int</span> panelIdx <span class="token operator">=</span> i <span class="token operator">/</span> boardCols<span class="token punctuation">;</span>
                <span class="token keyword">int</span> panelLoc <span class="token operator">=</span> i <span class="token operator">%</span> boardCols<span class="token punctuation">;</span>
                
                <span class="token keyword">int</span> localRow <span class="token operator">=</span> m <span class="token operator">/</span> rows<span class="token punctuation">;</span>
                <span class="token keyword">int</span> localCol <span class="token operator">=</span> m <span class="token operator">%</span> rows<span class="token punctuation">;</span>

                <span class="token comment">//检查它是偶数列还是奇数列</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token punctuation">(</span>panelLoc<span class="token operator">*</span>colsPerBoard <span class="token operator">+</span> j<span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> 
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 奇数 go from bottom to top</span>
                    ledMapping<span class="token punctuation">[</span>i<span class="token operator">*</span>colsPerBoard<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>panelIdx <span class="token operator">*</span> rowsPerBoard <span class="token operator">+</span> localRow<span class="token punctuation">)</span> <span class="token operator">*</span> totalBoards <span class="token operator">*</span> ledsPerBoard 
                                                    <span class="token operator">+</span> panelLoc <span class="token operator">*</span> ledsPerBoard <span class="token operator">+</span> j <span class="token operator">*</span> rows <span class="token operator">+</span> localCol<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> 
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 偶数 go from top to bottom</span>
                    ledMapping<span class="token punctuation">[</span>i<span class="token operator">*</span>colsPerBoard<span class="token operator">+</span>j<span class="token punctuation">]</span><span class="token punctuation">[</span>m<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span>panelIdx <span class="token operator">*</span> rowsPerBoard <span class="token operator">+</span> localRow<span class="token punctuation">)</span> <span class="token operator">*</span> totalBoards <span class="token operator">*</span> ledsPerBoard 
                                                    <span class="token operator">+</span> panelLoc <span class="token operator">*</span> ledsPerBoard <span class="token operator">+</span> j <span class="token operator">*</span> rows <span class="token operator">+</span> rows <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">-</span> localCol<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">//void initializeLedMapping(int boardCount, int rows, int cols)</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">//    totalBoards = boardCount;</span>
<span class="token comment">//    rowsPerBoard = rows;</span>
<span class="token comment">//    colsPerBoard = cols;</span>
<span class="token comment">//    ledsPerBoard = rows * cols;  // Calculate total LEDs per board</span>
<span class="token comment">//	</span>
<span class="token comment">//    int panelIdx = i / 5;  // 获取面板的索引</span>
<span class="token comment">//    int localX = i % 5;  // 获取在面板内的x坐标</span>

<span class="token comment">//    // Allocate memory for the mapping table</span>
<span class="token comment">//    ledMapping = malloc(sizeof(int*) * totalBoards * colsPerBoard);  // 5 columns per board</span>

<span class="token comment">//    for(int i = 0; i &lt; totalBoards * colsPerBoard; ++i)</span>
<span class="token comment">//    {<!-- --></span>
<span class="token comment">//        ledMapping[i] = malloc(sizeof(int) * rowsPerBoard);  // 5 leds per column</span>

<span class="token comment">//        for(int j = 0; j &lt; rowsPerBoard; ++j)</span>
<span class="token comment">//        {<!-- --></span>
<span class="token comment">//            if((i % colsPerBoard) % 2 == 0)// 用于判断在当前面板内，LED的列号是奇数还是偶数</span>
<span class="token comment">//            {<!-- --></span>
<span class="token comment">//                // 奇数列从下到上</span>
<span class="token comment">//                ledMapping[i][j] = (i / colsPerBoard * ledsPerBoard) + (i % colsPerBoard * rowsPerBoard) + j;</span>
<span class="token comment">//            }</span>
<span class="token comment">//            else</span>
<span class="token comment">//            {<!-- --></span>
<span class="token comment">//                // 偶数列从上到下</span>
<span class="token comment">//                ledMapping[i][j] = (i / colsPerBoard * ledsPerBoard) + (i % colsPerBoard * rowsPerBoard) + (rowsPerBoard-1 - j);</span>
<span class="token comment">//            }</span>
<span class="token comment">//        }</span>
<span class="token comment">//    }</span>
<span class="token comment">//}</span>

<span class="token comment">//int** ledMapping;</span>
<span class="token comment">//int totalBoards;</span>
<span class="token comment">//int ledsPerBoard = 25;  // 5*5</span>

<span class="token comment">//void initializeLedMapping(int boardCount)</span>
<span class="token comment">//{<!-- --></span>
<span class="token comment">    int panelIdx = i / 5;  // 获取面板的索引</span>
<span class="token comment">    int localX = i % 5;  // 获取在面板内的x坐标</span>
<span class="token comment">//    totalBoards = boardCount;</span>

<span class="token comment">//    // Allocate memory for the mapping table</span>
<span class="token comment">//    ledMapping = malloc(sizeof(int*) * totalBoards * 5);  // 5 columns per board</span>

<span class="token comment">//    for(int i = 0; i &lt; totalBoards * 5; ++i)</span>
<span class="token comment">//    {<!-- --></span>
<span class="token comment">//        ledMapping[i] = malloc(sizeof(int) * 5);  // 5 leds per column</span>

<span class="token comment">//        for(int j = 0; j &lt; 5; ++j)</span>
<span class="token comment">//        {<!-- --></span>
<span class="token comment">//            if((i % 5) % 2 == 0)// 用于判断在当前面板内，LED的列号是奇数还是偶数</span>
<span class="token comment">//            {<!-- --></span>
<span class="token comment">//                // 奇数列从下到上</span>
<span class="token comment">//                ledMapping[i][j] = (i / 5 * ledsPerBoard) + (i % 5 * 5) + j;</span>
<span class="token comment">//            }</span>
<span class="token comment">//            else</span>
<span class="token comment">//            {<!-- --></span>
<span class="token comment">//                // 偶数列从上到下</span>
<span class="token comment">//                ledMapping[i][j] = (i / 5 * ledsPerBoard) + (i % 5 * 5) + (4 - j);</span>
<span class="token comment">//            }</span>
<span class="token comment">//        }</span>
<span class="token comment">//    }</span>
<span class="token comment">//}</span>

<span class="token keyword">void</span> <span class="token function">setLedColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> colorValue<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
	
	<span class="token function">Set_LED_HEX</span><span class="token punctuation">(</span>ledMapping<span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">,</span> colorValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">cleanupLedMapping</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> totalBoards <span class="token operator">*</span> <span class="token number">5</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">free</span><span class="token punctuation">(</span>ledMapping<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">free</span><span class="token punctuation">(</span>ledMapping<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/*
你可以用 initializeLedMapping() 来初始化你的映射表，
用 setLedColor() 来设置LED颜色，最后用 cleanupLedMapping() 来释放内存。
注意，这个版本的代码使用了动态内存分配，
所以你需要确保在不再需要映射表的时候调用 cleanupLedMapping() 来避免内存泄漏。
*/</span>


<span class="token class-name">uint8_t</span> digits<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 0</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 1</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 2</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 3</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 4</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 5</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 6</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 7</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 8</span>
    <span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 9</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 显示3x5的阿拉伯数字的二维布尔数组的定义</span>


<span class="token keyword">void</span> <span class="token function">drawDigit</span><span class="token punctuation">(</span><span class="token keyword">int</span> digit<span class="token punctuation">,</span> <span class="token keyword">int</span> startX<span class="token punctuation">,</span> <span class="token keyword">int</span> startY<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> colorValueOn<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> colorValueOff<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> y <span class="token operator">&lt;</span> <span class="token number">5</span><span class="token punctuation">;</span> y<span class="token operator">++</span><span class="token punctuation">)</span> 
		<span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> x <span class="token operator">&lt;</span> <span class="token number">3</span><span class="token punctuation">;</span> x<span class="token operator">++</span><span class="token punctuation">)</span> 
				<span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>digits<span class="token punctuation">[</span>digit<span class="token punctuation">]</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">[</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span> 
						<span class="token punctuation">{<!-- --></span>
                <span class="token function">setLedColor</span><span class="token punctuation">(</span>startX <span class="token operator">+</span> x<span class="token punctuation">,</span> startY <span class="token operator">+</span> y<span class="token punctuation">,</span> colorValueOn<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> 
						<span class="token keyword">else</span> 
						<span class="token punctuation">{<!-- --></span>
                <span class="token function">setLedColor</span><span class="token punctuation">(</span>startX <span class="token operator">+</span> x<span class="token punctuation">,</span> startY <span class="token operator">+</span> y<span class="token punctuation">,</span> colorValueOff<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">drawColon</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> on<span class="token punctuation">,</span><span class="token class-name">uint32_t</span> colorValueOn<span class="token punctuation">)</span> 
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 冒号由两个点表示</span>
    <span class="token function">setLedColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> on <span class="token operator">?</span> colorValueOn <span class="token operator">:</span> <span class="token number">0x000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// top dot</span>
    <span class="token function">setLedColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">,</span> on <span class="token operator">?</span> colorValueOn <span class="token operator">:</span> <span class="token number">0x000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// bottom dot</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="ws2812screenh_262"></a>ws2812screen.h文件</h3> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__WS2812_SCREEN_H</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__WS2812_SCREEN_H</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"main.h"</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"ws2812b.h"</span></span>

<span class="token comment">//void initializeLedMapping(int boardCount);</span>
<span class="token comment">//void initializeLedMapping(int boardCount, int rows, int cols);</span>
<span class="token keyword">void</span> <span class="token function">initializeLedMapping</span><span class="token punctuation">(</span><span class="token keyword">int</span> boardRows<span class="token punctuation">,</span> <span class="token keyword">int</span> boardCols<span class="token punctuation">,</span> <span class="token keyword">int</span> rows<span class="token punctuation">,</span> <span class="token keyword">int</span> cols<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">setLedColor</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> colorValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">cleanupLedMapping</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">drawDigit</span><span class="token punctuation">(</span><span class="token keyword">int</span> digit<span class="token punctuation">,</span> <span class="token keyword">int</span> startX<span class="token punctuation">,</span> <span class="token keyword">int</span> startY<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> colorValueOn<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> colorValueOff<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">drawColon</span><span class="token punctuation">(</span><span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> on<span class="token punctuation">,</span><span class="token class-name">uint32_t</span> colorValueOn<span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<h3><a id="_285"></a>主函数</h3> 
<pre><code class="prism language-c">
	<span class="token function">initializeLedMapping</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	
	<span class="token function">drawDigit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x0F000F</span><span class="token punctuation">,</span><span class="token number">0x000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">drawDigit</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x0F000F</span><span class="token punctuation">,</span><span class="token number">0x000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">drawColon</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x0F000F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">drawDigit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x0F000F</span><span class="token punctuation">,</span><span class="token number">0x000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">drawDigit</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x0F000F</span><span class="token punctuation">,</span><span class="token number">0x000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		

	<span class="token function">WS2812_Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* USER CODE END 2 */</span>

  <span class="token comment">/* Infinite loop */</span>
  <span class="token comment">/* USER CODE BEGIN WHILE */</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
    <span class="token comment">/* USER CODE END WHILE */</span>

    <span class="token comment">/* USER CODE BEGIN 3 */</span>
		<span class="token function">drawColon</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x0F000F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">WS2812_Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">drawColon</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0x0F000F</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">WS2812_Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/19b55fcce6eb345d7e889f8144a50ef7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Windows安装jdk并配置环境变量</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/556c1ee02e328d5ab03d4e0d1fb411dd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ITDR何以成为IAM的最佳搭档？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>