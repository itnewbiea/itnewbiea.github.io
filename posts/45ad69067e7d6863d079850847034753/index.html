<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>matlab使用udpport实现udp通信 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="matlab使用udpport实现udp通信" />
<meta property="og:description" content="为了实现程序间udp通信，可以使用matlab的udpport函数建立本地udp端口，监听及发送数据。
主要可以参考matlab官网给出的文档：udpport函数的使用
以下是我的整理。
1. 建立端口 u = udpport(&#39;IPV4&#39;, ... &#39;LocalHost&#39;,&#39;127.0.0.1&#39;, ... &#39;LocalPort&#39;,8000); 这段可以直接用，表明建立了一个端口号为8000的udp端口，可以负责监听和发送数据。
2. 属性设置 建立好udp后，会出现一个udpport实例，打开会发现其中有很多属性可以设置，我选择了几个比较常用的、可能需要自己设定的属性详细说一下。
2.1 Timeout 设置可以进行端口监听或数据发送的操作时长，单位是秒，类似于这个端口可以工作的时长。
例如：
u.Timeout=100; 那么udpport建立后的100s内，都可以进行监听。
2.2 OutputDatagramSize 发送一次数据到该udpport后，最大可以被读入的字节数，可以设置为1到 65507。
有时候会发现读入的数据不完整，很可能是因为这个值设置的太小了，因为默认只有512。
举例：
u.OutputDatagramSize = 65500; 2.3 LocalPort和LocalHost 这两个属性我在上面创建udpport的代码中已经设定了，就不再赘述。
2.4 NumBytesAvailable 这是可以读的字节数
比如在读取数据的时候，可能不知道有多少数传过来了，就可以：
data = read(u,u.NumBytesAvailable,&#39;string&#39;); 另外，每次读取某个长度的数据后，NumBytesAvailable会自动减去这个长度。
关于read函数参考下文。
2.5⭐BytesAvailableFcn、BytesAvailableFcnCount、BytesAvailableFcnMode 这个是放在一起设置的，通过这三个参数，就可以达到这样的效果：当目前udpport缓存的BytesAvailableFcnMode数为BytesAvailableFcnCount时，就可以唤起BytesAvailableFcnCount函数。
举例：
% 当有5个数据包可获得时，调用函数myCallbackFcn configureCallback(u,&#34;datagram&#34;,5,@myCallbackFcn); % 当有5个字节可获得时，调用函数myCallbackFcn configureCallback(u,&#34;byte&#34;,50,@myCallbackFcn); 这里比较特别的是，需要使用configureCallback这个函数进行设置，关于这个函数也参考下文。
3. 相关函数 3.1 read函数 可参考官网：read函数
这个函数是用来实现从udpport中读取已收到的数据，例如：
data = read(u,5,&#39;string&#39;); 就是读取5个字节，并指定了返回类型是string。
如果是在监听端口的过程中，调用这个函数来获取收到的数据，那么执行完毕之后程序会停止，不再继续监听了。
所以说，用matlab进行应用间通信时，如果是只需要传输一次数据，比较适合用read函数，如果是多次不定时地传输，最好用configureCallback设定事件触发。
3.2 write函数 可参考官网：write函数
这个函数是用来实现从udpport向某个端口发送数据，例如：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/45ad69067e7d6863d079850847034753/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-16T10:26:14+08:00" />
<meta property="article:modified_time" content="2023-05-16T10:26:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">matlab使用udpport实现udp通信</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>为了实现程序间udp通信，可以使用matlab的<strong>udpport</strong>函数建立本地udp端口，监听及发送数据。<br> 主要可以参考matlab官网给出的文档：<a href="https://ww2.mathworks.cn/help/instrument/udpport.html" rel="nofollow">udpport函数的使用</a><br> 以下是我的整理。</p> 
<h2><a id="1__3"></a>1. 建立端口</h2> 
<pre><code class="prism language-matlab">u <span class="token operator">=</span> <span class="token function">udpport</span><span class="token punctuation">(</span><span class="token string">'IPV4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
<span class="token string">'LocalHost'</span><span class="token punctuation">,</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
<span class="token string">'LocalPort'</span><span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这段可以直接用，表明建立了一个端口号为8000的udp端口，可以负责监听和发送数据。</p> 
<h2><a id="2__12"></a>2. 属性设置</h2> 
<p>建立好udp后，会出现一个udpport实例，打开会发现其中有很多属性可以设置，我选择了几个比较常用的、可能需要自己设定的属性详细说一下。<br> <img src="https://images2.imgbox.com/75/13/MEiPcOZT_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/bb/b7/5YDbLP68_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="21_Timeout_17"></a>2.1 Timeout</h3> 
<p>设置可以进行端口监听或数据发送的操作时长，单位是秒，类似于这个端口可以工作的时长。<br> 例如：</p> 
<pre><code class="prism language-matlab">u<span class="token punctuation">.</span>Timeout<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>
</code></pre> 
<p>那么udpport建立后的100s内，都可以进行监听。</p> 
<h3><a id="22_OutputDatagramSize_26"></a>2.2 OutputDatagramSize</h3> 
<p>发送一次数据到该udpport后，最大可以被读入的字节数，可以设置为1到 65507。<br> 有时候会发现读入的数据不完整，很可能是因为这个值设置的太小了，因为默认只有512。<br> 举例：</p> 
<pre><code class="prism language-matlab">u<span class="token punctuation">.</span>OutputDatagramSize <span class="token operator">=</span> <span class="token number">65500</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="23_LocalPortLocalHost_34"></a>2.3 LocalPort和LocalHost</h3> 
<p>这两个属性我在上面创建udpport的代码中已经设定了，就不再赘述。</p> 
<h3><a id="24_NumBytesAvailable_37"></a>2.4 NumBytesAvailable</h3> 
<p>这是可以读的字节数<br> 比如在读取数据的时候，可能不知道有多少数传过来了，就可以：</p> 
<pre><code class="prism language-matlab">data <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>u<span class="token punctuation">.</span>NumBytesAvailable<span class="token punctuation">,</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>另外，每次读取某个长度的数据后，NumBytesAvailable会自动减去这个长度。<br> 关于read函数参考下文。</p> 
<h3><a id="25BytesAvailableFcnBytesAvailableFcnCountBytesAvailableFcnMode_46"></a>2.5⭐BytesAvailableFcn、BytesAvailableFcnCount、BytesAvailableFcnMode</h3> 
<p>这个是放在一起设置的，通过这三个参数，就可以达到这样的效果：当目前udpport缓存的BytesAvailableFcnMode数为BytesAvailableFcnCount时，就可以唤起BytesAvailableFcnCount函数。<br> 举例：</p> 
<pre><code class="prism language-matlab"><span class="token comment">% 当有5个数据包可获得时，调用函数myCallbackFcn</span>
<span class="token function">configureCallback</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"datagram"<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">@</span>myCallbackFcn<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">% 当有5个字节可获得时，调用函数myCallbackFcn</span>
<span class="token function">configureCallback</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"byte"<span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token operator">@</span>myCallbackFcn<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里比较特别的是，需要使用<strong>configureCallback</strong>这个函数进行设置，关于这个函数也参考下文。</p> 
<h2><a id="3__58"></a>3. 相关函数</h2> 
<h3><a id="31_read_59"></a>3.1 read函数</h3> 
<p>可参考官网：<a href="https://ww2.mathworks.cn/help/instrument/udpport.read.html" rel="nofollow">read函数</a><br> 这个函数是用来实现从udpport中读取已收到的数据，例如：</p> 
<pre><code class="prism language-matlab">data <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>就是读取5个字节，并指定了返回类型是string。<br> 如果是在监听端口的过程中，调用这个函数来获取收到的数据，那么执行完毕之后程序会停止，不再继续监听了。<br> 所以说，用matlab进行应用间通信时，如果是只需要传输一次数据，比较适合用read函数，如果是多次不定时地传输，最好用configureCallback设定事件触发。</p> 
<h3><a id="32_write_69"></a>3.2 write函数</h3> 
<p>可参考官网：<a href="https://ww2.mathworks.cn/help/instrument/udpport.write.html" rel="nofollow">write函数</a><br> 这个函数是用来实现从udpport向某个端口发送数据，例如：</p> 
<pre><code class="prism language-matlab"><span class="token comment">%格式：write(u,data,datatype,destinationAddress,destinationPort)</span>
<span class="token function">write</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span> "uint8"<span class="token punctuation">,</span> "<span class="token number">192.1</span><span class="token number">.5</span><span class="token number">.15</span>"<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这就是向端口20发送uint8格式的数据1到5</p> 
<h3><a id="33_configureCallback_78"></a>3.3 configureCallback函数</h3> 
<p>这个函数就可以实现在设定的timeout时间内监听发送到当前端口的数据，很实用。<br> 可参考官网：<a href="https://ww2.mathworks.cn/help/instrument/udpport.configurecallback.html" rel="nofollow">configureCallback函数</a><br> 举例：</p> 
<pre><code class="prism language-matlab"><span class="token function">configureCallback</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"terminator"<span class="token punctuation">,</span><span class="token operator">@</span>myCallbackFcn<span class="token punctuation">)</span>
<span class="token function">configureCallback</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"byte"<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">@</span>myCallbackFcn<span class="token punctuation">)</span>
<span class="token function">configureCallback</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"datagram"<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">@</span>myCallbackFcn<span class="token punctuation">)</span>
<span class="token function">configureCallback</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"off"<span class="token punctuation">)</span>
</code></pre> 
<p>其中，@myCallbackFcn就是自己设定好的一个函数的句柄，条件实现时，就会发起回调。<br> 这里还有一个要注意的点是关于回调函数的构造，参考官网：<a href="https://ww2.mathworks.cn/help/icomm/ug/create-and-execute-callback-functions.html?s_tid=srchtitle_callback%20functions_8" rel="nofollow">关于回调函数</a>，就是说自己设定的函数myCallbackFcn必须有两个输入参数：</p> 
<pre><code class="prism language-matlab"><span class="token comment">% 得是这样的结构</span>
<span class="token keyword">function</span> <span class="token function">mycallback</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span>event<span class="token punctuation">)</span>

<span class="token keyword">end</span>
</code></pre> 
<p>因为我还遇到过这样的一个报错：<br> <em>警告: 执行为类<br> asyncio.InputStream 定义的<br> 事件 DataWritten 的侦听程序回<br> 调时出现错误:<br> 错误使用 myCallbackFcn<br> 输入参数太多。</em><br> <img src="https://images2.imgbox.com/9d/2b/1H2Tbitx_o.png" alt="在这里插入图片描述"><br> 原因就是因为我设置的myCallbackFcn输入参数个数不对、、大家写的时候可以注意一下。<br> 如果需要更多的输入参数，可以参考：<a href="https://ww2.mathworks.cn/matlabcentral/answers/454048-how-to-add-more-parameters-to-callback-function?s_tid=srchtitle" rel="nofollow">如何在回调参数设置多个输入参数</a><br> 关于回调和句柄这部分我不是很熟悉，如果以上说错了请指正。</p> 
<h3><a id="34_flush_110"></a>3.4 flush函数</h3> 
<p>这个函数用于清除udpport中的数据，可以选择清除input或output或两者都。一般当前数据发送完毕之后可以flush一下。</p> 
<pre><code class="prism language-matlab"><span class="token function">flush</span><span class="token punctuation">(</span>u<span class="token punctuation">)</span>
<span class="token function">flush</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"input"<span class="token punctuation">)</span>
<span class="token function">flush</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"output"<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="35_bytes_118"></a>3.5 用于读取字节bytes的其他函数</h3> 
<p><a href="https://ww2.mathworks.cn/help/instrument/udpport.readline.html" rel="nofollow">readline</a><br> <a href="https://ww2.mathworks.cn/help/instrument/udpport.writeline.html" rel="nofollow">writeline</a><br> 可以用于读取和发送一整行的数据<br> 怎么定义一行的结束呢？可以用<a href="https://ww2.mathworks.cn/help/instrument/udpport.configureterminator.html" rel="nofollow">configureterminator</a>函数<br> 这个我用的比较少，不太了解。</p> 
<h2><a id="4_udp_matlab_124"></a>4. 一个完整的udp matlab端代码</h2> 
<p>向matlab的这个udp端口发送数据的代码段我就不放了，大家可能使用的语言、用于通信的应用不一样，我主要放两个matlab端的代码例子。</p> 
<h3><a id="41__126"></a>4.1 读取数据</h3> 
<pre><code class="prism language-matlab"><span class="token comment">%MATLAB端，进行接收的一段简单代码</span>

u <span class="token operator">=</span> <span class="token function">udpport</span><span class="token punctuation">(</span><span class="token string">'IPV4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
<span class="token string">'LocalHost'</span><span class="token punctuation">,</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
<span class="token string">'LocalPort'</span><span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">%设置可发送数据长度为一个较大的值</span>
u<span class="token punctuation">.</span>OutputDatagramSize <span class="token operator">=</span> <span class="token number">65500</span><span class="token punctuation">;</span>
<span class="token comment">%超时时间</span>
u<span class="token punctuation">.</span>Timeout<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">;</span>

data <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fprintf</span><span class="token punctuation">(</span>"current receive<span class="token operator">:</span> <span class="token comment">%s\n",data);</span>

</code></pre> 
<p>效果：<br> 程序首先处于运行态：<br> <img src="https://images2.imgbox.com/6e/23/kK4Ba67L_o.png" alt="在这里插入图片描述"><br> 接收到数据后：<br> <img src="https://images2.imgbox.com/50/29/FddrqssR_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/b4/47/OpLXlgI8_o.png" alt="在这里插入图片描述"><br> 这种情况下，只能接收一次数据，matlab接收到start之后，另一方再发送的话，matlab就收不到了。</p> 
<h3><a id="42__151"></a>4.2 持续读取</h3> 
<pre><code class="prism language-matlab">clc
clear
<span class="token comment">%MATLAB端，进行接收的一段简单代码</span>

u <span class="token operator">=</span> <span class="token function">udpport</span><span class="token punctuation">(</span><span class="token string">'IPV4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
<span class="token string">'LocalHost'</span><span class="token punctuation">,</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
<span class="token string">'LocalPort'</span><span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">%设置可发送数据长度为一个较大的值</span>
u<span class="token punctuation">.</span>OutputDatagramSize <span class="token operator">=</span> <span class="token number">65500</span><span class="token punctuation">;</span>
u<span class="token punctuation">.</span>Timeout<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">;</span>

<span class="token function">configureCallback</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span>"byte"<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token operator">@</span>myCallbackFcn<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">fprintf</span><span class="token punctuation">(</span>"current receive<span class="token operator">:</span> <span class="token comment">%s\n",data);</span>

</code></pre> 
<pre><code class="prism language-matlab"><span class="token keyword">function</span> <span class="token function">myCallbackFcn</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> event<span class="token punctuation">)</span>
data <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fprintf</span><span class="token punctuation">(</span>"current<span class="token operator">:</span><span class="token comment">%s\n",data);</span>
<span class="token keyword">end</span>
</code></pre> 
<p>效果：<br> <img src="https://images2.imgbox.com/52/1a/hYyTvIYc_o.png" alt="在这里插入图片描述"><br> 这种情况下，就可以随着另一方的发送一直接收，直到超时。</p> 
<p>更正：我测试的时候发现，使用这种方法，即使建立udpport的时间超过了设置的timeout，也能继续监听。</p> 
<h2><a id="5__182"></a>5. 总结</h2> 
<p>使用matlab进行udp通信的流程主要就是：</p> 
<ol><li>建立端口<code>udpport</code></li></ol> 
<pre><code class="prism language-matlab">u <span class="token operator">=</span> <span class="token function">udpport</span><span class="token punctuation">(</span><span class="token string">'IPV4'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
<span class="token string">'LocalHost'</span><span class="token punctuation">,</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> <span class="token punctuation">...</span>
<span class="token string">'LocalPort'</span><span class="token punctuation">,</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>2.<code>read</code>/<code>write</code>数据</p> 
<pre><code class="prism language-matlab">data <span class="token operator">=</span> <span class="token function">read</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'string'</span><span class="token punctuation">)</span>
<span class="token function">write</span><span class="token punctuation">(</span>u<span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span> "uint8"<span class="token punctuation">,</span> "<span class="token number">192.1</span><span class="token number">.5</span><span class="token number">.15</span>"<span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<ol start="3"><li>删除连接<code>clear</code></li></ol> 
<pre><code class="prism language-matlab">clear u
</code></pre> 
<ol start="4"><li>需要注意的点：是否需要<code>configureCallback</code>的设置</li></ol>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0be267c909435b2ab900d159371560bf/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">HTML概述及常用语法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8573db888f14cac1481c4ad697434eb4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">React配置代理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>