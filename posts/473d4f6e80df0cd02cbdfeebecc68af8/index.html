<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>R可视化学习代码（五） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="R可视化学习代码（五）" />
<meta property="og:description" content="第五章：散点图 1.基本散点图
attach(heightweight) heightweight[,c(&#34;ageYear&#34;,&#34;heightIn&#34;)] ggplot(heightweight,aes(x=ageYear,y=heightIn))&#43;geom_point() ggplot(heightweight,aes(x=ageYear,y=heightIn))&#43;geom_point(shape=21)#shape参数修改点的形状 ggplot(heightweight,aes(x=ageYear,y=heightIn))&#43;geom_point(size=1.5)# 2、使用点形和颜色属性，并基于某变量对数据进行【分组】
`heightweight[,c(&#34;sex&#34;,&#34;ageYear&#34;,&#34;heightIn&#34;)] ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex))&#43;geom_point() ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))&#43;geom_point() PS:分类因子变量必须是因子
ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex,colour=sex))&#43;geom_point()#将一变量同时映射给shape和colour 分组后颜色和形状都不同
ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex,colour=sex))&#43; geom_point()&#43;scale_shape_manual(values=c(1,2))&#43; scale_colour_brewer(palette=&#34;Set1&#34;)#根据分组变量将分属不同组的数据点设置为不同点形和颜色 3、使用不同于默认设置的点形
ggplot(heightweight,aes(x=ageYear,y=heightIn,shape=sex))&#43; geom_point(size=3)&#43;scale_shape_manual(values=c(1,4))#利用scale_shape_manual调整,自定义点形 #点是否实点，边框颜色都可以设置 hw=heightweight#副本 hw$weightGroup=cut(hw$weightLb,breaks=c(-Inf,100,Inf),labels=c(&#34;&lt;100&#34;,&#34;&gt;=100&#34;))#大于100磅的一组 #可以按2个变量对数据进行分组，一个是因子sex，一个是连续型变量（做了分类处理）——刻画了两个变量 ggplot(hw,aes(x=ageYear,y=heightIn,shape=sex,fill=weightGroup))&#43; geom_point(size=2.5)&#43; scale_shape_manual(values=c(21,24)) #上面的代码运行后没有虚点，和标示不同 ggplot(hw,aes(x=ageYear,y=heightIn,shape=sex,fill=weightGroup))&#43; geom_point(size=2.5)&#43; scale_shape_manual(values=c(21,24))&#43; scale_fill_manual(values=c(NA,&#34;black&#34;),guide=guide_legend(override.ase=list(shape=21))) 4、将连续型变量映射到点的颜色或大小属性上
###如何来刻画第三个连续型变量——必须将第三个变量映射到其他的图形属性（颜色、大小）——必须放在aes中 heightweight[,c(&#34;sex&#34;,&#34;ageYear&#34;,&#34;heightIn&#34;,&#34;weightLb&#34;)] ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=weightLb))&#43;geom_point()#该图点的颜色越深weightLb越小 ggplot(heightweight,aes(x=ageYear,y=heightIn,size=weightLb))&#43;geom_point()#该图点越大weightLb越大 #此时对第三个变量解释精度较低，适用于不需要高精度解释的变量，点的大小差不代表值的大小差 ggplot(heightweight,aes(x=ageYear,y=heightIn,fill=weightLb))&#43; geom_point(shape=21,size=2.5)&#43;scale_fill_gradient(low=&#34;black&#34;,high=&#34;white&#34;)#scale_fill_gradient #将色阶设置为黑白,黑白渐变，增大数据点大小 ggplot(heightweight,aes(x=ageYear,y=heightIn,fill=weightLb))&#43; geom_point(shape=21,size=2.5)&#43;scale_fill_gradient(low=&#34;black&#34;,high=&#34;white&#34;,breaks=seq(70,170,by=20), guide=guide_legend()) #scale_fill_gradient()中breaks设置断点，会以离散点的图例代替色阶（渐变色） ggplot(heightweight,aes(x=ageYear,y=heightIn,size=weightLb,colour=sex))&#43; geom_point(alpha=0.5)&#43;scale_size_area()&#43; scale_colour_brewer(palette=&#34;Set1&#34;)#scale_fill_gradient #alpha=0.5指定点为半透明，scale_size_area()设置点面积正比于变量值，scale_colour_gradient()修改调色板 #PS:将某变量映射给size时，避免将其他变量映射给shape属性。【不同点形的大小不好比较】 5、处理图像重叠
###数据量大时，如何避免互相重叠？——重叠度低的时候可以用不同的点形或虚实区别 #（1）用半透明的点处理 sp=ggplot(diamonds,aes(x=carat,y=price)) sp&#43;geom_point()#5万多数据，很难区分不同区域数据点的相对密度 sp&#43;geom_point(alpha=0.1)#设置点透明度为90%，重叠后颜色越重表示该区域点越密集 sp&#43;geom_point(alpha=0.01)#设置点透明度为99%，重叠后颜色越重表示该区域点越密集 #（2）将数据点分箱，并以矩阵来表示，将数据点的密度映射为矩阵的填充色 sp&#43;stat_bin2d()#stat_bin2d()分别在横纵轴方向将数据分隔20组，总计900个箱子 #数据点默认颜色区分不大（黑蓝） sp&#43;stat_bin2d(bins=50)&#43; #将箱数设置为50 scale_fill_gradient(low=&#34;lightblue&#34;,high=&#34;red&#34;) sp&#43;stat_bin2d(bins=50)&#43; #将箱数设置为50 scale_fill_gradient(low=&#34;lightblue&#34;,high=&#34;red&#34;,limits=c(0,6000)) #scale_fill_gradient重新设定数据点颜色，最小色阶为浅蓝，最大色阶为红色，默认图例不含最小值，颜色标度范围不是从0开始 #limits手动设定范围为0,6000 install.packages(&#34;hexbin&#34;) library(hexbin) sp&#43;stat_binhex()&#43; scale_fill_gradient(low=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/473d4f6e80df0cd02cbdfeebecc68af8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-05-16T16:57:39+08:00" />
<meta property="article:modified_time" content="2017-05-16T16:57:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">R可视化学习代码（五）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>第五章：散点图 <br> 1.基本散点图</p> 
<pre class="prettyprint"><code class=" hljs scss"><span class="hljs-function">attach(heightweight)</span>
heightweight<span class="hljs-attr_selector">[,c("ageYear","heightIn")]</span>
<span class="hljs-function">ggplot(heightweight,<span class="hljs-function">aes(x=ageYear,y=heightIn)</span>)</span>+<span class="hljs-function">geom_point()</span>
<span class="hljs-function">ggplot(heightweight,<span class="hljs-function">aes(x=ageYear,y=heightIn)</span>)</span>+<span class="hljs-function">geom_point(shape=<span class="hljs-number">21</span>)</span><span class="hljs-id">#shape</span>参数修改点的形状
<span class="hljs-function">ggplot(heightweight,<span class="hljs-function">aes(x=ageYear,y=heightIn)</span>)</span>+<span class="hljs-function">geom_point(size=<span class="hljs-number">1.5</span>)</span>#</code></pre> 
<p>2、使用点形和颜色属性，并基于某变量对数据进行【分组】</p> 
<pre class="prettyprint"><code class=" hljs erlang">`heightweight[,c(<span class="hljs-string">"sex"</span>,<span class="hljs-string">"ageYear"</span>,<span class="hljs-string">"heightIn"</span>)]
<span class="hljs-function"><span class="hljs-title">ggplot</span><span class="hljs-params">(heightweight,<span class="hljs-function_name">aes</span>(x=age<span class="hljs-variable">Year</span>,y=height<span class="hljs-variable">In</span>,shape=sex))</span>+<span class="hljs-title">geom_point</span><span class="hljs-params">()</span>
<span class="hljs-title">ggplot</span><span class="hljs-params">(heightweight,<span class="hljs-function_name">aes</span>(x=age<span class="hljs-variable">Year</span>,y=height<span class="hljs-variable">In</span>,colour=sex))</span>+<span class="hljs-title">geom_point</span><span class="hljs-params">()</span></span></code></pre> 
<p>PS:分类因子变量必须是因子</p> 
<pre class="prettyprint"><code class=" hljs scss"><span class="hljs-function">ggplot(heightweight,<span class="hljs-function">aes(x=ageYear,y=heightIn,shape=sex,colour=sex)</span>)</span>+<span class="hljs-function">geom_point()</span>#将一变量同时映射给shape和colour</code></pre> 
<p>分组后颜色和形状都不同</p> 
<pre class="prettyprint"><code class=" hljs scss"><span class="hljs-function">ggplot(heightweight,<span class="hljs-function">aes(x=ageYear,y=heightIn,shape=sex,colour=sex)</span>)</span>+
       <span class="hljs-function">geom_point()</span>+<span class="hljs-function">scale_shape_manual(values=<span class="hljs-function">c(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>)</span>)</span>+
       <span class="hljs-function">scale_colour_brewer(palette=<span class="hljs-string">"Set1"</span>)</span>#根据分组变量将分属不同组的数据点设置为不同点形和颜色</code></pre> 
<p>3、使用不同于默认设置的点形</p> 
<pre class="prettyprint"><code class=" hljs perl">ggplot(heightweight,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn,shape=sex))+
       geom_point(size=<span class="hljs-number">3</span>)+scale_shape_manual(<span class="hljs-keyword">values</span>=c(<span class="hljs-number">1</span>,<span class="hljs-number">4</span>))<span class="hljs-comment">#利用scale_shape_manual调整,自定义点形</span>
<span class="hljs-comment">#点是否实点，边框颜色都可以设置</span>
hw=heightweight<span class="hljs-comment">#副本</span>
hw<span class="hljs-variable">$weightGroup</span>=cut(hw<span class="hljs-variable">$weightLb</span>,breaks=c(-Inf,<span class="hljs-number">100</span>,Inf),labels=c(<span class="hljs-string">"&lt;100"</span>,<span class="hljs-string">"&gt;=100"</span>))<span class="hljs-comment">#大于100磅的一组</span>
<span class="hljs-comment">#可以按2个变量对数据进行分组，一个是因子sex，一个是连续型变量（做了分类处理）——刻画了两个变量</span>
ggplot(hw,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn,shape=sex,fill=weightGroup))+
       geom_point(size=<span class="hljs-number">2.5</span>)+
       scale_shape_manual(<span class="hljs-keyword">values</span>=c(<span class="hljs-number">21</span>,<span class="hljs-number">24</span>))
<span class="hljs-comment">#上面的代码运行后没有虚点，和标示不同</span>
ggplot(hw,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn,shape=sex,fill=weightGroup))+
       geom_point(size=<span class="hljs-number">2.5</span>)+
       scale_shape_manual(<span class="hljs-keyword">values</span>=c(<span class="hljs-number">21</span>,<span class="hljs-number">24</span>))+
       scale_fill_manual(<span class="hljs-keyword">values</span>=c(NA,<span class="hljs-string">"black"</span>),guide=guide_legend(override.ase=list(shape=<span class="hljs-number">21</span>)))</code></pre> 
<p>4、将连续型变量映射到点的颜色或大小属性上</p> 
<pre class="prettyprint"><code class=" hljs perl"><span class="hljs-comment">###如何来刻画第三个连续型变量——必须将第三个变量映射到其他的图形属性（颜色、大小）——必须放在aes中</span>
heightweight[,c(<span class="hljs-string">"sex"</span>,<span class="hljs-string">"ageYear"</span>,<span class="hljs-string">"heightIn"</span>,<span class="hljs-string">"weightLb"</span>)]
ggplot(heightweight,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn,colour=weightLb))+geom_point()<span class="hljs-comment">#该图点的颜色越深weightLb越小</span>
ggplot(heightweight,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn,size=weightLb))+geom_point()<span class="hljs-comment">#该图点越大weightLb越大</span>
<span class="hljs-comment">#此时对第三个变量解释精度较低，适用于不需要高精度解释的变量，点的大小差不代表值的大小差</span>
ggplot(heightweight,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn,fill=weightLb))+
       geom_point(shape=<span class="hljs-number">21</span>,size=<span class="hljs-number">2.5</span>)+scale_fill_gradient(low=<span class="hljs-string">"black"</span>,high=<span class="hljs-string">"white"</span>)<span class="hljs-comment">#scale_fill_gradient</span>
<span class="hljs-comment">#将色阶设置为黑白,黑白渐变，增大数据点大小</span>
ggplot(heightweight,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn,fill=weightLb))+
       geom_point(shape=<span class="hljs-number">21</span>,size=<span class="hljs-number">2.5</span>)+scale_fill_gradient(low=<span class="hljs-string">"black"</span>,high=<span class="hljs-string">"white"</span>,breaks=se<span class="hljs-string">q(70,170,by=20)</span>,
                                                         guide=guide_legend())
<span class="hljs-comment">#scale_fill_gradient()中breaks设置断点，会以离散点的图例代替色阶（渐变色）</span>
ggplot(heightweight,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn,size=weightLb,colour=sex))+
       geom_point(alpha=<span class="hljs-number">0</span>.<span class="hljs-number">5</span>)+scale_size_area()+
       scale_colour_brewer(palette=<span class="hljs-string">"Set1"</span>)<span class="hljs-comment">#scale_fill_gradient</span>
<span class="hljs-comment">#alpha=0.5指定点为半透明，scale_size_area()设置点面积正比于变量值，scale_colour_gradient()修改调色板</span>
<span class="hljs-comment">#PS:将某变量映射给size时，避免将其他变量映射给shape属性。【不同点形的大小不好比较】</span>
</code></pre> 
<p>5、处理图像重叠</p> 
<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor">###数据量大时，如何避免互相重叠？——重叠度低的时候可以用不同的点形或虚实区别</span>
<span class="hljs-preprocessor">#（1）用半透明的点处理</span>
sp=ggplot(diamonds,aes(<span class="hljs-built_in">x</span>=carat,<span class="hljs-built_in">y</span>=price))
sp+geom_point()<span class="hljs-preprocessor">#5万多数据，很难区分不同区域数据点的相对密度</span>
sp+geom_point(alpha=<span class="hljs-number">0.1</span>)<span class="hljs-preprocessor">#设置点透明度为90%，重叠后颜色越重表示该区域点越密集</span>
sp+geom_point(alpha=<span class="hljs-number">0.01</span>)<span class="hljs-preprocessor">#设置点透明度为99%，重叠后颜色越重表示该区域点越密集</span>
<span class="hljs-preprocessor">#（2）将数据点分箱，并以矩阵来表示，将数据点的密度映射为矩阵的填充色</span>
sp+stat_bin2d()<span class="hljs-preprocessor">#stat_bin2d()分别在横纵轴方向将数据分隔20组，总计900个箱子</span>
<span class="hljs-preprocessor">#数据点默认颜色区分不大（黑蓝）    </span>
sp+stat_bin2d(bins=<span class="hljs-number">50</span>)+ <span class="hljs-preprocessor">#将箱数设置为50</span>
   scale_fill_gradient(low=<span class="hljs-string">"lightblue"</span>,high=<span class="hljs-string">"red"</span>)
sp+stat_bin2d(bins=<span class="hljs-number">50</span>)+ <span class="hljs-preprocessor">#将箱数设置为50</span>
   scale_fill_gradient(low=<span class="hljs-string">"lightblue"</span>,high=<span class="hljs-string">"red"</span>,limits=c(<span class="hljs-number">0</span>,<span class="hljs-number">6000</span>))
<span class="hljs-preprocessor">#scale_fill_gradient重新设定数据点颜色，最小色阶为浅蓝，最大色阶为红色，默认图例不含最小值，颜色标度范围不是从0开始</span>
<span class="hljs-preprocessor">#limits手动设定范围为0,6000</span>
install<span class="hljs-preprocessor">.packages</span>(<span class="hljs-string">"hexbin"</span>)
library(hexbin)
sp+stat_binhex()+
   scale_fill_gradient(low=<span class="hljs-string">"lightblue"</span>,high=<span class="hljs-string">"red"</span>,limits=c(<span class="hljs-number">0</span>,<span class="hljs-number">8000</span>))
<span class="hljs-preprocessor">#stat_binhex()对分箱形状改为六边形</span>
sp+stat_binhex()+
   scale_fill_gradient(low=<span class="hljs-string">"lightblue"</span>,high=<span class="hljs-string">"red"</span>,breaks=c(<span class="hljs-number">0</span>,<span class="hljs-number">250</span>,<span class="hljs-number">500</span>,<span class="hljs-number">1000</span>,<span class="hljs-number">2000</span>,<span class="hljs-number">4000</span>,<span class="hljs-number">6000</span>),
                        limits=c(<span class="hljs-number">0</span>,<span class="hljs-number">6000</span>))
<span class="hljs-preprocessor">#stat_binhex()对分箱形状改为六边形,落在分箱范围外面的格子显示灰色</span>


<span class="hljs-preprocessor">#（3）当某一数据轴或两个数据轴都是离散型数据时，很容易出现重叠——增加随机扰动</span>
fix(ChickWeight)
<span class="hljs-built_in">spl</span>=ggplot(ChickWeight,aes(<span class="hljs-built_in">x</span>=Time,<span class="hljs-built_in">y</span>=weight))
<span class="hljs-built_in">spl</span>+geom_point()<span class="hljs-preprocessor">#重合状况</span>
<span class="hljs-built_in">spl</span>+geom_point(position=<span class="hljs-string">"jitter"</span>)
<span class="hljs-preprocessor">#spl+geom_jitter()同上#所谓扰动就是原本取值0的点在0附近随机波动，把原本重叠的点横向平铺一点</span>
<span class="hljs-built_in">spl</span>+geom_point(position=position_jitter(width=<span class="hljs-number">0.5</span>,height=<span class="hljs-number">0</span>))<span class="hljs-preprocessor">#height=0表示只在水平方向增加扰动</span>
<span class="hljs-built_in">spl</span>+geom_point(position=position_jitter(width=<span class="hljs-number">1</span>,height=<span class="hljs-number">0</span>))<span class="hljs-preprocessor">#水平方向扰动太大，点很容易混淆</span>
<span class="hljs-preprocessor">#当数据集一个离散一个连续时，使用箱线图（缺点：难以显示每个位置的数据点数量）</span>
<span class="hljs-preprocessor">###由于某些变量time本质是离散，但被保存成连续，需告诉如何分组aes(group=)</span>
<span class="hljs-built_in">spl</span>+geom_boxplot(aes(group=Time))<span class="hljs-preprocessor">#设定分组</span>
<span class="hljs-built_in">spl</span>+geom_boxplot()<span class="hljs-preprocessor">#不设分组</span></code></pre> 
<p>6、添加回归模型拟合线</p> 
<pre class="prettyprint"><code class=" hljs php"><span class="hljs-comment">###在散点图中添加回归模型拟合线——stat_smooth()</span>
library(gcookbook)<span class="hljs-comment">#为了数据</span>
sp=ggplot(heightweight,aes(x=ageYear,y=heightIn))<span class="hljs-comment">#先定义基本绘图对象sp</span>
sp+geom_point()+stat_smooth()<span class="hljs-comment">#不设置method默认拟合loess曲线（局部加权多项式）,不是直线</span>
sp+geom_point()+stat_smooth(method=<span class="hljs-string">"lm"</span>)
sp+geom_point()+stat_smooth(method=<span class="hljs-string">"lm"</span>,level=<span class="hljs-number">0.99</span>)<span class="hljs-comment">#99%置信区间</span>
<span class="hljs-comment"># method可以取lm, glm, gam, loess, rlm</span>
sp+geom_point()+stat_smooth(method=<span class="hljs-string">"lm"</span>,se=<span class="hljs-keyword">FALSE</span>)<span class="hljs-comment">#不画置信域</span>
sp+geom_point(colour=<span class="hljs-string">"grey60"</span>)+
              stat_smooth(method=<span class="hljs-string">"lm"</span>,se=<span class="hljs-keyword">FALSE</span>,colour=<span class="hljs-string">"blue"</span>)<span class="hljs-comment">#修改线和点的颜色</span>
sp+geom_point(colour=<span class="hljs-string">"grey60"</span>)+stat_smooth(method=<span class="hljs-string">"loess"</span>)
sp+geom_point(colour=<span class="hljs-string">"grey60"</span>)+stat_smooth(method=<span class="hljs-string">"glm"</span>)
<span class="hljs-comment">#logistic回归</span>
library(MASS)<span class="hljs-comment">#需要该包里面的数据,用来logistic回归</span>
b=biopsy;head(b)<span class="hljs-comment">#副本数据,有699条观测</span>
b<span class="hljs-variable">$classn</span>[b<span class="hljs-variable">$class</span>==<span class="hljs-string">"benign"</span>]=<span class="hljs-number">0</span><span class="hljs-comment">#把类别class转化为0-1变量</span>
b<span class="hljs-variable">$classn</span>[b<span class="hljs-variable">$class</span>==<span class="hljs-string">"malignant"</span>]=<span class="hljs-number">1</span>
head(b)
ggplot(b,aes(x=V1,y=classn))+geom_point()<span class="hljs-comment">#基本的散点图看出大量的点重合，需要设置透明度和扰动</span>
ggplot(b,aes(x=V1,y=classn))+
       geom_point(position=position_jitter(width=<span class="hljs-number">0.3</span>,height=<span class="hljs-number">0.06</span>),alpha=<span class="hljs-number">0.4</span>,shape=<span class="hljs-number">21</span>,size=<span class="hljs-number">1.5</span>)+
       stat_smooth(fill=<span class="hljs-string">"red"</span>,method=<span class="hljs-string">"glm"</span>,family=binomial)
<span class="hljs-comment">#########glm拟合，fill设置置信带颜色</span>
sps=ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+
           geom_point()+
           scale_colour_brewer(palette=<span class="hljs-string">"Set1"</span>)
sps<span class="hljs-comment">#以sex分类，映射到颜色</span>
sps+geom_smooth()<span class="hljs-comment">#分类添加loess线</span>
<span class="hljs-comment">##可知蓝色的拟合线没有到达图形的右边界（1.由于预测范围为数据的范围 2.即使外推，也只能根据整组数据对应的x轴范围进行预测）</span>
<span class="hljs-comment">#####loessn不能外推，lm可以</span>
sps+geom_smooth(method=<span class="hljs-string">"lm"</span>,se=<span class="hljs-keyword">FALSE</span>,fullrange=<span class="hljs-keyword">TRUE</span>)<span class="hljs-comment">#fullrange是T指示需要外推</span>
<span class="hljs-comment">##需不需要外推，要用loess还是lm要考虑变量的意义，这里体重身高不会随年龄一直增加，显然lm不适合。loess更适合</span></code></pre> 
<p>7、根据【已有】模型向散点图添加拟合线</p> 
<pre class="prettyprint"><code class=" hljs perl"><span class="hljs-comment">##方法仍然是调用stat_smooth()</span>
library(gcookbook)
model=lm(heightIn~ageYear+I(ageYear^<span class="hljs-number">2</span>),heightweight)
model
xmin=min(heightweight<span class="hljs-variable">$ageYear</span>);xmax=max(heightweight<span class="hljs-variable">$ageYear</span>)<span class="hljs-comment">#找到范围，进行插值</span>
predicted=data.frame(ageYear=se<span class="hljs-string">q(xmin,xmax,length.out=100)</span>)<span class="hljs-comment">#xmin到xmax之间的100个数作为横坐标的值</span>
predicted<span class="hljs-variable">$heightIn</span>=predict(model,predicted)<span class="hljs-comment">#把用模型预测的值放入数据框</span>
predicted
<span class="hljs-comment">##将这些点与原本数据点绘制到一起</span>
sp=ggplot(heightweight,aes(<span class="hljs-keyword">x</span>=ageYear,<span class="hljs-keyword">y</span>=heightIn))+
         geom_point(colour=<span class="hljs-string">"grey50"</span>)
sp+geom_line(data=predicted,size=<span class="hljs-number">1</span>)<span class="hljs-comment">#用插值的点绘制曲线，size是线的粗细</span>
sp+stat_smooth(colour=<span class="hljs-string">"blue"</span>,se=FALSE,size=<span class="hljs-number">1</span>)+stat_smooth(method=<span class="hljs-string">"lm"</span>,colour=<span class="hljs-string">"red"</span>,se=FALSE,size=<span class="hljs-number">1</span>)</code></pre> 
<pre class="prettyprint"><code class=" hljs r"><span class="hljs-comment">##定义函数predictvals()简化向散点图添加模型拟合线的过程【对上面代码的简化】</span>
predictvals=<span class="hljs-keyword">function</span>(model,xvar,yvar,xrange=<span class="hljs-literal">NULL</span>,samples=<span class="hljs-number">100</span>,<span class="hljs-keyword">...</span>)
{ <span class="hljs-comment">#if先判断是否给了x的范围xrange</span>
  <span class="hljs-keyword">if</span> (is.null(xrange))
    { <span class="hljs-comment">#如果是空，也就是没给范围，x的范围从模型对象中提取</span>
      <span class="hljs-keyword">if</span> (any(class(model) %<span class="hljs-keyword">in</span>% c(<span class="hljs-string">"lm"</span>,<span class="hljs-string">"glm"</span>)))
          xrange=range(model$model[[xvar]])<span class="hljs-comment">#如果是线性模型lm和glm用该语句提取范围</span>
      <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (any(class(model) %<span class="hljs-keyword">in</span>% <span class="hljs-string">"loess"</span>))
          xrange=range(model$x) <span class="hljs-comment">#用局部加权多项式loess拟合时提取</span>
     }
  newdata=data.frame(x=seq(xrange[<span class="hljs-number">1</span>],xrange[<span class="hljs-number">2</span>],length.out=samples))<span class="hljs-comment">#在该范围内打samples数量的点作为自变量</span>
  names(newdata)=xvar<span class="hljs-comment">#把上面的数据点命名</span>
  newdata[[yvar]]=predict(model,newdata=newdata,<span class="hljs-keyword">...</span>)<span class="hljs-comment">#利用predict按model对上面的数据点预测，并放入数据框</span>
  newdata<span class="hljs-comment">#输出数据框</span>
}

modlinear=lm(heightIn~ageYear,heightweight)<span class="hljs-comment">#线性回归模型</span>
<span class="hljs-comment">##对该模型调用上面的函数predictvals</span>
lm_predicted=predictvals(modlinear,<span class="hljs-string">"ageYear"</span>,<span class="hljs-string">"heightIn"</span>)

modloess=loess(heightIn~ageYear,heightweight)<span class="hljs-comment">#loess拟合模型</span>
loess_predicted=predictvals(modloess,<span class="hljs-string">"ageYear"</span>,<span class="hljs-string">"heightIn"</span>)

sp+geom_line(data=lm_predicted,colour=<span class="hljs-string">"red"</span>,size=<span class="hljs-number">0.8</span>)+
   geom_line(data=loess_predicted,colour=<span class="hljs-string">"blue"</span>,size=<span class="hljs-number">0.8</span>)<span class="hljs-comment">#绘图结果和7最开始的结果相同</span>

<span class="hljs-comment">#注意：在用非线性glm函数拟合时，需要设定参数type。下面是应用</span>
<span class="hljs-keyword">library</span>(MASS)
b=biopsy
b$classn[b$class==<span class="hljs-string">"bengin"</span>]=<span class="hljs-number">0</span><span class="hljs-comment">#b中加一列classn作为类别的标示</span>
b$classn[b$class==<span class="hljs-string">"malignant"</span>]=<span class="hljs-number">1</span>
fitlogistic=glm(classn ~ V1, b, family=binomial)<span class="hljs-comment">#用glm拟合</span>
glm_predicted=predictvals(fitlogistic, <span class="hljs-string">"V1"</span>, <span class="hljs-string">"classn"</span>, type=<span class="hljs-string">"response"</span>)<span class="hljs-comment">#用定义的函数预测并生成新的数据</span>
<span class="hljs-comment">####此处需要加参数type用来对glm进行predict。</span>
ggplot(b, aes(x=V1, y=classn)) +
       geom_point(position=position_jitter(width=<span class="hljs-number">0.3</span>, height=<span class="hljs-number">0.08</span>),alpha=<span class="hljs-number">0.4</span>,shape=<span class="hljs-number">21</span>,size=<span class="hljs-number">1.5</span>)+
       geom_line(data=glm_predicted, colour=<span class="hljs-string">"#1177FF"</span>, size=<span class="hljs-number">1</span>)
       <span class="hljs-comment">##position增加扰动避免重复，geom_line用data绘制曲线，颜色"#1177FF"是RGB颜色--蓝色</span>

<span class="hljs-comment">#8、添加来自多个模型的拟合线</span>
<span class="hljs-comment">##自定义函数predictvals()、dlply()、ldply()</span>

<span class="hljs-comment">#由数据集自定义函数，可以对原数据集的子集分别建立模型</span>
make_model=<span class="hljs-keyword">function</span>(data) 
{ lm(heightIn ~ ageYear, data) }
<span class="hljs-keyword">library</span>(gcookbook)<span class="hljs-comment">#数据集所在包</span>
<span class="hljs-keyword">library</span>(plyr)<span class="hljs-comment">#dlply()和ldply()的包，这两个函数的作用是切分数据，对各个部分执行某一函数，并对执行结果进行重组</span>
models=dlply(heightweight,<span class="hljs-string">"sex"</span>,.fun=make_model)<span class="hljs-comment">#dlply对数据集按sex分类，并对数据集分别应用上面的函数建立模型</span>
models
predvals=ldply(models,.fun=predictvals,xvar=<span class="hljs-string">"ageYear"</span>,yvar=<span class="hljs-string">"heightIn"</span>)<span class="hljs-comment">#ldply可以用上面得到的模型预测得到新的数据集</span>
predvals<span class="hljs-comment">#该数据集按照性别分别建立数据集</span>
ggplot(heightweight,aes(x=ageYear,y=heightIn,colour=sex))+
       geom_point()+geom_line(data=predvals)<span class="hljs-comment">##绘制原来的散点和预测值绘成的曲线</span>

predvals=ldply(models, .fun=predictvals, xvar=<span class="hljs-string">"ageYear"</span>, yvar=<span class="hljs-string">"heightIn"</span>,xrange=range(heightweight$ageYear))
ggplot(heightweight,aes(x=ageYear,y=heightIn, colour=sex))+
       geom_point()+geom_line(data=predvals)

<span class="hljs-comment">#9、向散点图添加模型系数</span>
<span class="hljs-comment">##如何向图形添加模型的数值信息（文本注释、）</span>
<span class="hljs-keyword">library</span>(gcookbook)
model=lm(heightIn ~ ageYear, heightweight)
summary(model)<span class="hljs-comment">#从模型结果可知，R2是0.4249.希望添加到图中</span>

pred=predictvals(model, <span class="hljs-string">"ageYear"</span>, <span class="hljs-string">"heightIn"</span>)<span class="hljs-comment">#调用定义的函数，生成预测得到的新数据</span>
sp=ggplot(heightweight, aes(x=ageYear, y=heightIn)) + geom_point() +
          geom_line(data=pred)<span class="hljs-comment">#基本图形</span>
sp+annotate(<span class="hljs-string">"text"</span>, label=<span class="hljs-string">"r^2=0.42"</span>, x=<span class="hljs-number">16.5</span>, y=<span class="hljs-number">52</span>)<span class="hljs-comment">#annotate()函数手动添加文本“text”,(x,y)指示文本位置</span>
sp+annotate(<span class="hljs-string">"text"</span>, label=<span class="hljs-string">"r^2 == 0.42"</span>, parse = <span class="hljs-literal">TRUE</span>, x=<span class="hljs-number">16.5</span>, y=<span class="hljs-number">52</span>)<span class="hljs-comment">#parse指示调用R中的数学表达式语法来输入公式</span>

<span class="hljs-comment">#不能直接以表达式对象作为输入</span>
expression(r^<span class="hljs-number">2</span> == <span class="hljs-number">0.42</span>)<span class="hljs-comment">#正确的表达式，因为==合法，=不合法</span>
expression(r^<span class="hljs-number">2</span> = <span class="hljs-number">0.42</span>)<span class="hljs-comment">#不正确</span>
<span class="hljs-comment">###自动提取模型对象的值，</span>
eqn=as.character(as.expression(
    substitute(italic(y) == a + b * italic(x) * <span class="hljs-string">","</span> ~~ italic(r)^<span class="hljs-number">2</span> ~ <span class="hljs-string">"="</span> ~ r2,
    list(a = format(coef(model)[<span class="hljs-number">1</span>],digits=<span class="hljs-number">3</span>),
         b = format(coef(model)[<span class="hljs-number">2</span>],digits=<span class="hljs-number">3</span>),
         r2 = format(summary(model)$r.squared, digits=<span class="hljs-number">2</span>)<span class="hljs-comment">#list里面的元素是从模型中提取的</span>
        ))))<span class="hljs-comment">#substitute里面是表达式，里面的a,b,m由list来给出</span>
eqn
parse(text=eqn)<span class="hljs-comment">#parse进行解析，返回表达式</span>
sp + annotate(<span class="hljs-string">"text"</span>, label=eqn, parse=<span class="hljs-literal">TRUE</span>, x=<span class="hljs-literal">Inf</span>, y=-<span class="hljs-literal">Inf</span>, hjust=<span class="hljs-number">1.1</span>, vjust=-<span class="hljs-number">.5</span>)
          <span class="hljs-comment">#指示的位置是图形右下角，两个just是对位置的调整，使其在图形内</span>

<span class="hljs-comment">#10、向散点图添加边际地毯marginal rugs</span>
<span class="hljs-comment">###调用geom_rug()</span>
fix(faithful)<span class="hljs-comment">#有两个变量：waiting和eruptions</span>
ggplot(faithful, aes(x=eruptions, y=waiting))+geom_point()+ 
       geom_rug()<span class="hljs-comment">#geom_rug添加边际地毯：展示数据在每个数据轴上的分布</span>
<span class="hljs-comment">##存在的问题：纵轴的waiting重叠的很严重，下面添加扰动减小线宽减轻重叠</span>
ggplot(faithful,aes(x=eruptions,y=waiting))+geom_point()+
       geom_rug(position=<span class="hljs-string">"jitter"</span>,size=<span class="hljs-number">0.2</span>)<span class="hljs-comment">#geom_rug添加参数是对边际的设置，线性更细，增加了扰动</span>
ggplot(faithful,aes(x=eruptions,y=waiting))+geom_point()+
       geom_rug(position=position_jitter(width=<span class="hljs-number">0.5</span>,height=<span class="hljs-number">0.5</span>),size=<span class="hljs-number">0.2</span>)
<span class="hljs-comment">##PS:扰动对于横纵坐标的值都有影响</span>

<span class="hljs-comment">#11、向散点图添加标签——annotate()函数、geom_text()函数</span>
<span class="hljs-keyword">library</span>(gcookbook)
subset(countries, Year==<span class="hljs-number">2009</span> &amp; healthexp&gt;<span class="hljs-number">2000</span>)<span class="hljs-comment">#subset用来选取符合条件的部分数据</span>
sp=ggplot(subset(countries,Year==<span class="hljs-number">2009</span>&amp;healthexp&gt;<span class="hljs-number">2000</span>),aes(x=healthexp,y=infmortality))+
      geom_point()<span class="hljs-comment">#保存基本散点图对象</span>

sp + annotate(<span class="hljs-string">"text"</span>, x=<span class="hljs-number">4350</span>, y=<span class="hljs-number">5.4</span>, label=<span class="hljs-string">"Canada"</span>) +
     annotate(<span class="hljs-string">"text"</span>, x=<span class="hljs-number">7400</span>, y=<span class="hljs-number">6.8</span>, label=<span class="hljs-string">"USA"</span>)<span class="hljs-comment">#手动添加注释</span>
sp + geom_text(aes(label=Name), size=<span class="hljs-number">4</span>)<span class="hljs-comment">#按数据自动添加。geom_text()指示label，默认size是5</span>
<span class="hljs-comment">#此时，默认标注位置是将文本中心放在对应(x,y)坐标处。下面对位置进行调整</span>

sp + geom_text(aes(label=Name), size=<span class="hljs-number">4</span>, vjust=<span class="hljs-number">0</span>)<span class="hljs-comment">#vjust=0标签基线与数据点对齐</span>
sp + geom_text(aes(y=infmortality+<span class="hljs-number">0.1</span>, label=Name), size=<span class="hljs-number">4</span>, vjust=<span class="hljs-number">0</span>)<span class="hljs-comment">#使y的取值增加0.1，用来调高标签位置</span>
    <span class="hljs-comment">#geom_text里面y的值减小的话会降低标签位置</span>
<span class="hljs-comment">##其它可以调整位置方法：修改vjust</span>
sp + geom_text(aes(label=Name), size=<span class="hljs-number">4</span>, vjust=<span class="hljs-number">1</span>)<span class="hljs-comment">#vjust=1标签文本顶部与数据点对齐</span>
sp + geom_text(aes(label=Name), size=<span class="hljs-number">4</span>, vjust=<span class="hljs-number">2</span>)<span class="hljs-comment">#vjust=2的时候标签在点下面，比1的时候距离远</span>
sp + geom_text(aes(label=Name), size=<span class="hljs-number">4</span>, vjust=-<span class="hljs-number">2</span>)<span class="hljs-comment">#vjust=-2的时候标签在点上面，比1的时候距离远，有个点标签超出图形范围</span>

sp + geom_text(aes(label=Name), size=<span class="hljs-number">4</span>, hjust=<span class="hljs-number">0</span>)<span class="hljs-comment">#点与标签左对齐</span>
sp + geom_text(aes(x=healthexp+<span class="hljs-number">100</span>, label=Name), size=<span class="hljs-number">4</span>, hjust=<span class="hljs-number">0</span>)<span class="hljs-comment">#先左对齐然后增加x的值，使距离远一点</span>
sp + geom_text(aes(x=healthexp-<span class="hljs-number">100</span>, label=Name), size=<span class="hljs-number">4</span>, hjust=<span class="hljs-number">1</span>)<span class="hljs-comment">#先右对齐然后减少x的值，使距离远一点</span>
<span class="hljs-comment">#PS：这里在geom_text()里面增加减少x或是y只是改变标签的位置，不改变原始数据</span>

cdat=subset(countries, Year==<span class="hljs-number">2009</span> &amp; healthexp&gt;<span class="hljs-number">2000</span>)
cdat$Name1=cdat$Name<span class="hljs-comment">#这两行创建副本</span>
idx=cdat$Name1 %<span class="hljs-keyword">in</span>% c(<span class="hljs-string">"Canada"</span>, <span class="hljs-string">"Ireland"</span>, <span class="hljs-string">"United Kingdom"</span>, <span class="hljs-string">"United States"</span>,
                         <span class="hljs-string">"New Zealand"</span>, <span class="hljs-string">"Iceland"</span>, <span class="hljs-string">"Japan"</span>, <span class="hljs-string">"Luxembourg"</span>,
                         <span class="hljs-string">"Netherlands"</span>, <span class="hljs-string">"Switzerland"</span>)<span class="hljs-comment">#%in%运算符：找出cdat$Name1里面属于后面的c()字符串的</span>
        <span class="hljs-comment">##返回TRUE或是FALSE</span>
idx<span class="hljs-comment">#该逻辑向量用来指示标示哪些</span>
cdat$Name1[!idx]=<span class="hljs-literal">NA</span><span class="hljs-comment">#把逻辑向量里面FALSE的改为NA，也就是不在输入的字符向量里面的记为NA</span>
cda<span class="hljs-comment">#这样对数据进行了修改，绘图时label里面NA的值不表示</span>
ggplot(cdat, aes(x=healthexp, y=infmortality)) +
       geom_point() +
       geom_text(aes(x=healthexp+<span class="hljs-number">100</span>, label=Name1), size=<span class="hljs-number">4</span>, hjust=<span class="hljs-number">0</span>)+
       xlim(<span class="hljs-number">2000</span>, <span class="hljs-number">10000</span>)<span class="hljs-comment">#xlim()函数可以单独加，增加x范围使标签更美</span>

<span class="hljs-comment">#12、绘制气泡图——geom_point()+scale_size_area()</span>
 <span class="hljs-comment">##并且令点的面积正比于变量值</span>
<span class="hljs-keyword">library</span>(gcookbook)
cdat=subset(countries, Year==<span class="hljs-number">2009</span> &amp;Name %<span class="hljs-keyword">in</span>% c(<span class="hljs-string">"Canada"</span>, <span class="hljs-string">"Ireland"</span>, <span class="hljs-string">"United Kingdom"</span>, <span class="hljs-string">"United States"</span>,
                <span class="hljs-string">"New Zealand"</span>, <span class="hljs-string">"Iceland"</span>, <span class="hljs-string">"Japan"</span>, <span class="hljs-string">"Luxembourg"</span>,
                <span class="hljs-string">"Netherlands"</span>, <span class="hljs-string">"Switzerland"</span>))<span class="hljs-comment">#挑选数据</span>
cdat<span class="hljs-comment">#只有10条</span>
p=ggplot(cdat, aes(x=healthexp, y=infmortality, size=GDP))+
         geom_point(shape=<span class="hljs-number">21</span>, colour=<span class="hljs-string">"black"</span>, fill=<span class="hljs-string">"cornsilk"</span>)<span class="hljs-comment">#colour边框色，fill填充色</span>
p<span class="hljs-comment">#将GDP映射给大小size（对应点的半径），所以值增加一倍，点面积增加原来的4倍，这时无法直观理解图形</span>
p + scale_size_area(max_size=<span class="hljs-number">15</span>)<span class="hljs-comment">#将gdp大小映射给点面积，仍然需要在geom_point把gdp映射给size，得到的气泡图就很直观比较gdp大小</span>
<span class="hljs-comment">#此时：气泡图实际是散点图</span>
<span class="hljs-keyword">library</span>(reshape2)
hec=HairEyeColor[,,<span class="hljs-string">"Male"</span>] + HairEyeColor[,,<span class="hljs-string">"Female"</span>]<span class="hljs-comment">#该数据是两分类变量，每个有四种特性，数据显示为矩阵</span>
hec=melt(hec,value.name=<span class="hljs-string">"count"</span>)<span class="hljs-comment">#reshape2里面的melt函数把矩阵hec按count转变为1列的长向量</span>
ggplot(hec, aes(x=Eye, y=Hair)) +
       geom_point(aes(size=count), shape=<span class="hljs-number">21</span>, colour=<span class="hljs-string">"black"</span>, fill=<span class="hljs-string">"cornsilk"</span>) +
       scale_size_area(max_size=<span class="hljs-number">20</span>, guide=<span class="hljs-literal">FALSE</span>) +
       geom_text(aes(y=as.numeric(Hair)-sqrt(count)/<span class="hljs-number">22</span>, label=count), vjust=<span class="hljs-number">1</span>,colour=<span class="hljs-string">"grey60"</span>, size=<span class="hljs-number">4</span>)
<span class="hljs-comment">###1、geom_point对点设置颜色，映射count到size,此时显示为半径</span>
<span class="hljs-comment">###2、scale_size_area()的max_szie=20指示点面积反映count</span>
<span class="hljs-comment">###3、geom_text先vjust=1时标签与数据点y轴对应，然后对y做了变换使得标签正好在气泡的正下方</span>

<span class="hljs-comment">#13、绘制散点图矩阵——ggplot2不能绘制散点图矩阵，pairs()</span>
<span class="hljs-comment">#显示多变量两两关系</span>
<span class="hljs-keyword">library</span>(gcookbook)
c2009=subset(countries, Year==<span class="hljs-number">2009</span>,select=c(Name, GDP, laborrate, healthexp, infmortality))
c2009
pairs(c2009[,<span class="hljs-number">2</span>:<span class="hljs-number">5</span>])<span class="hljs-comment">#第一列是国家名字，不画</span>
<span class="hljs-comment">#自定义面板函数来展示变量间两两相关系数</span>
panel.cor=<span class="hljs-keyword">function</span>(x, y, digits=<span class="hljs-number">2</span>, prefix=<span class="hljs-string">""</span>, cex.cor, <span class="hljs-keyword">...</span>) 
{   usr=par(<span class="hljs-string">"usr"</span>)
    on.exit(par(usr))
    par(usr = c(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>))
    r=abs(cor(x, y, use=<span class="hljs-string">"complete.obs"</span>))
    txt=format(c(r, <span class="hljs-number">0.123456789</span>), digits=digits)[<span class="hljs-number">1</span>]
    txt=paste(prefix, txt, sep=<span class="hljs-string">""</span>)
    <span class="hljs-keyword">if</span>(missing(cex.cor)) cex.cor=<span class="hljs-number">0.8</span>/strwidth(txt)
    text(<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, txt, cex = cex.cor * (<span class="hljs-number">1</span> + r) / <span class="hljs-number">2</span>)
}
<span class="hljs-comment">#定义函数为了在面板的对角线上显示各变量的直方图</span>
panel.hist &lt;- <span class="hljs-keyword">function</span>(x, <span class="hljs-keyword">...</span>) {
    usr &lt;- par(<span class="hljs-string">"usr"</span>)
    on.exit(par(usr))
    par(usr = c(usr[<span class="hljs-number">1</span>:<span class="hljs-number">2</span>], <span class="hljs-number">0</span>, <span class="hljs-number">1.5</span>) )
    h &lt;- hist(x, plot = <span class="hljs-literal">FALSE</span>)
    breaks &lt;- h$breaks
    nB &lt;- length(breaks)
    y &lt;- h$counts
    y &lt;- y/max(y)
    rect(breaks[-nB], <span class="hljs-number">0</span>, breaks[-<span class="hljs-number">1</span>], y, col=<span class="hljs-string">"white"</span>, <span class="hljs-keyword">...</span>)
}

pairs(c2009[,<span class="hljs-number">2</span>:<span class="hljs-number">5</span>], upper.panel = panel.cor,diag.panel = panel.hist,lower.panel = panel.smooth)
<span class="hljs-comment">#调用前面的两个函数，在散点图矩阵中添加相关系数，直方图；lower.panel执行panel.smooth()函数，添加lowess平滑曲线</span>

<span class="hljs-comment">#自定义函数为了添加lm曲线(pairs里面没有panel.lm)</span>
panel.lm=<span class="hljs-keyword">function</span> (x, y, col = par(<span class="hljs-string">"col"</span>), bg = <span class="hljs-literal">NA</span>, pch = par(<span class="hljs-string">"pch"</span>),
                            cex = <span class="hljs-number">1</span>, col.smooth = <span class="hljs-string">"black"</span>, <span class="hljs-keyword">...</span>) {
    points(x, y, pch = pch, col = col, bg = bg, cex = cex)
    abline(stats::lm(y ~ x),  col = col.smooth, <span class="hljs-keyword">...</span>)
}

pairs(c2009[,<span class="hljs-number">2</span>:<span class="hljs-number">5</span>], pch=<span class="hljs-string">"."</span>,
                   upper.panel = panel.cor,
                   diag.panel  = panel.hist,
                   lower.panel = panel.lm)</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b36c53448e47e70784e4b87fdb3590d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java多线程学习之二——多线程的优势和风险</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/004aedff64bef5796d241a9839011eaf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot配置属性</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>