<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【vue2】纯前端实现本地的pdf/word/epub文件预览（包括pdf选中文字，epub高亮等） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【vue2】纯前端实现本地的pdf/word/epub文件预览（包括pdf选中文字，epub高亮等）" />
<meta property="og:description" content="前言 需求是预览本地的pdf/word/epub格式的文件，但是搜索后发现没有可以直接使用的，格式不同，显示的方式和效果也都略有不同。
最后还是分别实现预览的功能。
如果只需要预览pdf/word等格式的话，可以使用的方案：vue-office，支持多种文件(docx、excel、pdf)预览的vue组件库，支持vue2/3。也支持非Vue框架的预览。补充功能：pdf选中文字，epub高亮（我的需求是选中pdf/epub的文字后进行收藏） 实现 pdf预览和选中文字高亮 方案：pdfjs&#43;iframe
因为这样可以使用浏览器自带的pdf阅读器，不需要再自己实现小图预览等功能。
pdf.js实现pdf的预览与下载（vue&#43;springboot&#43;pdf.js） 有demo,比较基础的功能。也是本地引入pdf.js的用法
扩展：web打开在线的pdf文件，禁用打印和下载功能
VUE预览PDF文件并利用pdf.js获取鼠标选中的文字和搜索，在iframe中获取选中文字，监听鼠标事件，右键菜单
直接本地引入pdf.js的方法也可以参考上面这篇文章，写的很详细。
主要参考的还是获取选中文字的部分：
getSelectText() { let _this = this; let iframe = document.getElementsByClassName(&#34;pdf-viewer-local&#34;)[0]; let x = &#34;&#34;; let y = &#34;&#34;; let _x = &#34;&#34;; let _y = &#34;&#34;; // iframe 加载完成后执行并将双击事件过滤掉，因为双击事件可能也触发滑选，所以为了不误操作，将其剔除 iframe.onload = function () { // 鼠标点击监听 iframe.contentDocument.addEventListener( &#34;mousedown&#34;, function (e) { x = e.pageX; y = e.pageY; _this.isShowNotePop = false; }, true ); // 鼠标抬起监听 iframe." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6e39f61193de0adce832ab914db28b57/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-17T06:48:18+08:00" />
<meta property="article:modified_time" content="2023-07-17T06:48:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【vue2】纯前端实现本地的pdf/word/epub文件预览（包括pdf选中文字，epub高亮等）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>前言</h2> 
<p>需求是预览本地的pdf/word/epub格式的文件，但是搜索后发现没有可以直接使用的，格式不同，显示的方式和效果也都略有不同。<br> 最后还是<strong>分别实现预览</strong>的功能。</p> 
<ul><li>如果只需要预览pdf/word等格式的话，可以使用的方案：<a href="https://github.com/501351981/vue-office">vue-office</a>，支持多种文件(docx、excel、pdf)预览的vue组件库，支持vue2/3。也支持非Vue框架的预览。</li><li><strong>补充功能</strong>：pdf选中文字，epub高亮（我的需求是选中pdf/epub的文字后进行收藏）</li></ul> 
<h2><a id="_5"></a>实现</h2> 
<h3><a id="pdf_6"></a>pdf预览和选中文字高亮</h3> 
<p><strong>方案</strong>：pdfjs+iframe<br> 因为这样可以使用浏览器自带的pdf阅读器，不需要再自己实现小图预览等功能。<br> <a href="https://juejin.cn/post/7215397054259494949#heading-5" rel="nofollow">pdf.js实现pdf的预览与下载（vue+springboot+pdf.js）</a> 有demo,比较基础的功能。也是本地引入pdf.js的用法<br> <strong>扩展</strong>：<a href="https://www.jianshu.com/p/42a8b1d1a041" rel="nofollow">web打开在线的pdf文件，禁用打印和下载功能</a></p> 
<p><a href="https://blog.csdn.net/ZMJ_QQ/article/details/126875978">VUE预览PDF文件并利用pdf.js获取鼠标选中的文字和搜索，在iframe中获取选中文字，监听鼠标事件，右键菜单</a></p> 
<p>直接本地引入pdf.js的方法也可以参考上面这篇文章，写的很详细。<br> 主要参考的还是获取选中文字的部分：</p> 
<pre><code class="prism language-javascript">    <span class="token function">getSelectText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">let</span> _this <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> iframe <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"pdf-viewer-local"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> x <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> y <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> _x <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> _y <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
      <span class="token comment">// iframe 加载完成后执行并将双击事件过滤掉，因为双击事件可能也触发滑选，所以为了不误操作，将其剔除</span>
      iframe<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 鼠标点击监听</span>
        iframe<span class="token punctuation">.</span>contentDocument<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
          <span class="token string">"mousedown"</span><span class="token punctuation">,</span>
          <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            x <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span>
            y <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY<span class="token punctuation">;</span>
            _this<span class="token punctuation">.</span>isShowNotePop <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token boolean">true</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 鼠标抬起监听</span>
        iframe<span class="token punctuation">.</span>contentDocument<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span>
          <span class="token string">"mouseup"</span><span class="token punctuation">,</span>
          <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            _x <span class="token operator">=</span> e<span class="token punctuation">.</span>pageX<span class="token punctuation">;</span>
            _y <span class="token operator">=</span> e<span class="token punctuation">.</span>pageY<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> _x <span class="token operator">&amp;&amp;</span> y <span class="token operator">==</span> _y<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span> <span class="token comment">//判断点击和抬起的位置，如果相同，则视为没有滑选，不支持双击选中</span>
            <span class="token keyword">var</span> selection <span class="token operator">=</span> iframe<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> range <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> choose <span class="token operator">=</span> selection<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            _this<span class="token punctuation">.</span>selectText <span class="token operator">=</span> choose<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"选中文本："</span> <span class="token operator">+</span> choose<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token boolean">true</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>扩展：<a href="https://blog.csdn.net/zhang79513/article/details/120831157">在iframe中获取选中的数据/iframe中鼠标事件</a> 来自上一篇参考文章的参考文章。</p> 
<h3><a id="docx_58"></a>docx</h3> 
<h4><a id="Mammoth_59"></a>Mammoth</h4> 
<p>旨在转换 .docx 文档（例如由 Microsoft Word 创建的文档），并将其转换为 HTML。 <strong>不支持样式</strong>。<br> <a href="https://blog.csdn.net/qq_42697806/article/details/125423742">Vue Word预览之mammoth.js</a></p> 
<h4><a id="docxpreview_62"></a>docx-preview</h4> 
<p>我的博客：<a href="https://blog.csdn.net/sinat_41838682/article/details/130999285?spm=1001.2014.3001.5501">关于实现</a></p> 
<h3><a id="epub_65"></a>epub</h3> 
<p><strong>功能</strong>：实现预览、电子书切换、目录、换背景色、字体大小调整、进度的功能。<br> <strong>方案</strong>：使用epub.js，<a href="http://epubjs.org/documentation/0.3/" rel="nofollow">官方文档</a><br> <strong>版本</strong>选择：<a href="https://www.cnblogs.com/Li-ningning/p/15945819.html" rel="nofollow">使用epub对电子书进行渲染（Blocked script execution in 'http://localhost:8080/’ because the document 's frame is sandboxed and the ‘allow-scripts’ permission is not set.）</a>，出现了上述报错，原因是epub.js版本太高，所以切换了版本。省流：版本是<code>epubjs@0.3.71</code></p> 
<p>参考文章：</p> 
<ul><li><a href="https://blog.csdn.net/Z1553653199/article/details/128060774">epub.js制作电子书阅读网站</a> 有demo,有源码。不过功能还存在一些问题（比如电子书切换之类的有bug）。 注释还是比较详细的。可以体验参考</li><li><a href="https://blog.csdn.net/qq_45654741/article/details/110907901?spm=1001.2101.3001.6650.1&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-110907901-blog-93158645.235%5Ev36%5Epc_relevant_default_base3&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~Rate-1-110907901-blog-93158645.235%5Ev36%5Epc_relevant_default_base3&amp;utm_relevant_index=2">基于Vue创建的epub小说阅读器效果展示及源码分享</a> 主要是在这篇文章内容上进行移植二改。因为提供了源码。功能也比较全。</li><li><a href="https://juejin.cn/post/7244002241845248058#heading-11" rel="nofollow">epub.js 踩坑与实践指南</a>阅读后可以对epub.js有一个大概了解，方便二次开发。<br> <strong>二次开发</strong>的记录<br> ps.其实这个获取的页数不太准确。但是也没别的方法，怪不得上面的代码用的是百分比进度</li></ul> 
<ol><li>获取总页数：</li></ol> 
<pre><code class="prism language-javascript"><span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>ready
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>navigation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>navigation<span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>locations<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>locations <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>locations<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>bookAvailable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取总页数</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalPages <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>locations<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// console.log("Total pages: " + this.totalPages);</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>2.左右翻页或跳转页数<br> 通过父子组件间通信传递当前的页码、监听左右翻页或输入页码跳转。</p> 
<pre><code class="prism language-javascript">    <span class="token comment">//epub翻页</span>
    <span class="token function">prevPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"prev"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">.</span><span class="token function">prev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentPage<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment">// 向前翻页时更新 currentPage</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">nextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>currentPage<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 向后翻页时更新 currentPage</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"EPUB 下一页出错："</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错，请重试或检查 EPUB 文件格式。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>注意：“跳转到对应页”这个功能是在子组件中进行监听实现的，<br> <strong>子组件不能直接修改父组件的值</strong>，所以需要中转一下。在子组件中使用<code>currentPageLocal</code>（进行页码的显示或者是传递）</p> 
<pre><code class="prism language-javascript">    <span class="token literal-property property">currentPage</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token function-variable function">handler</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentPageLocal <span class="token operator">=</span> value<span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>3.监听鼠标滚动控制左右翻页<br> 在包裹epub内容的div上增加监听鼠标滚轮的动作<code> @wheel="handleWheel"</code></p> 
<pre><code class="prism language-javascript">    <span class="token function">handleWheel</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>deltaY <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// console.log("往上");</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prevPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>event<span class="token punctuation">.</span>deltaY <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// console.log("往下");</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">nextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>优化了一下上面的左右翻页代码，如下：<br> ps:还是存在一些问题的，滚动翻页可能会导致页码和实际的页码对不上？不知道是哪里的逻辑错了。</p> 
<pre><code class="prism language-javascript">    <span class="token function">prevPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"prev"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">.</span><span class="token function">prev</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>currentPage<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token comment">// 向前翻页时更新 currentPage</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentPage <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>currentPage <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">nextPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">this</span><span class="token punctuation">.</span>currentPage<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// 向后翻页时更新 currentPage</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentPage <span class="token operator">&gt;=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalPages<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>currentPage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>totalPages<span class="token punctuation">;</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"EPUB 下一页出错："</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"出错，请重试或检查 EPUB 文件格式。"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<p>4.高亮选中文本（不保存版）<br> ps:如果是跨行的文本，无法高亮会报错，最好排除一下，加一个用户提示。</p> 
<pre><code class="prism language-javascript">    <span class="token comment">//读取epub信息并挂载</span>
    <span class="token keyword">async</span> <span class="token function">readEpubMes</span><span class="token punctuation">(</span><span class="token parameter">file</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>book <span class="token operator">=</span> <span class="token function">ePub</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>ready<span class="token punctuation">;</span>

      <span class="token comment">// console.log(this.book);</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>book <span class="token operator">!==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">typeof</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book <span class="token operator">!==</span> <span class="token string">"undefined"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rendition <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span><span class="token function">renderTo</span><span class="token punctuation">(</span><span class="token string">"read"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
          <span class="token literal-property property">flow</span><span class="token operator">:</span> <span class="token string">"paginated"</span><span class="token punctuation">,</span>
          <span class="token literal-property property">width</span><span class="token operator">:</span> <span class="token string">"100%"</span><span class="token punctuation">,</span>
          <span class="token literal-property property">height</span><span class="token operator">:</span> <span class="token string">"100%"</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">.</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加选中事件监听器</span>
        <span class="token keyword">let</span> lastChoosed <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rendition<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"selected"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">cfiRange<span class="token punctuation">,</span> contents</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
          <span class="token comment">// 获取选中范围</span>
          <span class="token keyword">let</span> range <span class="token operator">=</span> contents<span class="token punctuation">.</span>window<span class="token punctuation">.</span><span class="token function">getSelection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getRangeAt</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

          <span class="token keyword">if</span> <span class="token punctuation">(</span>range<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> lastChoosed<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>range<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            lastChoosed <span class="token operator">=</span> range<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          <span class="token comment">// 创建标记</span>
          <span class="token keyword">let</span> marker <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"span"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          marker<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">"yellow"</span><span class="token punctuation">;</span> <span class="token comment">// 设置高亮颜色</span>
          marker<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"highlight"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 可选，添加自定义类名</span>

          <span class="token comment">// 将选中范围用标记包裹起来</span>
          range<span class="token punctuation">.</span><span class="token function">surroundContents</span><span class="token punctuation">(</span>marker<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取locations对象 epubjs的钩子函数实现</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>ready
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>navigation <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>navigation<span class="token punctuation">;</span>

            <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>locations<span class="token punctuation">.</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>locations <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>book<span class="token punctuation">.</span>locations<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>bookAvailable <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

            <span class="token comment">// 获取总页数</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>totalPages <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>locations<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// console.log("Total pages: " + this.totalPages);</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> 
<h2><a id="_224"></a>后记</h2> 
<p>关于epubjs写得不是很详细，因为是在前面的源码上二改的。所需要的功能也不多。（单页+上下滑动显示不知道怎么实现）<br> 关于pdf的预览，其实直接用vue-pdf也是不错的。<br> 后面补充吧。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a0088537bc4ac72e2608b3c47645915a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux实现定时备份文件到百度网盘详细教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9edf2176a88b5c3c8c5bb68d8b7c1716/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL SERVER的字段类型说明</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>