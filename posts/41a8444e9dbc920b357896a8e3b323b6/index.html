<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据存储——动态内存申请和释放（c语言） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据存储——动态内存申请和释放（c语言）" />
<meta property="og:description" content="动态内存： malloc函数： 作用：用于申请一块连续的指定大小的内存块区域以（void *）类型返回分配的内存区域地址，当无法知道内存具体位置的时候，就要用到动态分配内存。
函数声明：（返回为（void *）类型）
void *malloc( size_t size ); 需要的头文件：
#include &lt;stdlib.h&gt; 或 #include &lt;malloc.h&gt; 应用：(指针类型） 变量名 =（指针类型）malloc（n * sizeof(类型））；//（指针类型）强转为同变量类型；
如：int *arr = （int *）malloc( n * sizeof( int )); //分配n个（int）大小的内存，arr指向该内存的首部；
相当于：int arr[n]; //c99不支持；大部分编译器会出现语法错误；
当n=4时，
malloc的“近亲”：calloc，realloc；
calloc函数： 作用：在内存的动态存储区分配n个长度为size（类型）的连续空间，函数返回一个指向分配起始地址的指针；如果分配不成功，返回NULL。
函数声明：（返回为（void *）类型）
void *calloc( size_t num, size_t size ); 同malloc函数相同的头文件：
#include &lt;stdlib.h&gt; 或 #include &lt;malloc.h&gt; 应用：(指针类型） 变量名 =（指针类型）calloc（n ，sizeof(类型））；//（指针类型）强转为同变量类型；
如：int *arr = (int *) calloc ( n , sizeof(int) ); //将n个（int）初始化为0；arr指向该内存首部；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/41a8444e9dbc920b357896a8e3b323b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-21T21:02:06+08:00" />
<meta property="article:modified_time" content="2018-04-21T21:02:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据存储——动态内存申请和释放（c语言）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>动态内存：</h2> 
<h3>malloc函数：</h3> 
<p>   作用：用于申请一块连续的指定大小的内存块区域以（void *）类型返回分配的内存区域地址，当无法知道内存具体位置的时候，就要用到动态分配内存。</p> 
<p>函数声明：（返回为（void *）类型）</p> 
<pre><code class="language-cpp">void *malloc(
   size_t size 
);</code></pre> 
<p>需要的头文件：</p> 
<pre><code class="language-html">#include &lt;stdlib.h&gt;
或
#include &lt;malloc.h&gt;</code></pre> 
<br> 
<p>应用：(<span style="color:rgb(51,51,255);">指针</span><span style="color:rgb(255,0,0);">类型</span>）  变量名 =<u>（<span style="color:#3333ff;">指针</span><span style="color:#ff0000;">类型</span>）</u>malloc（n * sizeof(<span style="color:rgb(255,0,0);">类型</span>））；//<u>（<span style="color:#3333ff;">指针</span><span style="color:#ff0000;">类型</span>）</u>强转为同变量类型；</p> 
<blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
 <p>如：int *arr = （int *）malloc( n * sizeof( int )); //分配n个（int）大小的内存，arr指向该内存的首部；</p> 
 <p>相当于：<del>int arr[n]; //c99不支持；大部分编译器会出现语法错误；</del></p> 
 <p>当n=4时，</p> 
 <p><del><img src="https://images2.imgbox.com/7e/f9/OVesNC82_o.png" alt=""><br></del></p> 
</blockquote> 
<p>malloc的“近亲”：calloc，realloc；</p> 
<h3>calloc函数：</h3> 
<p>   作用：在内存的动态存储区分配n个长度为size（类型）的连续空间，函数返回一个指向分配起始地址的指针；如果分配不成功，返回NULL。</p> 
<p>函数声明：（返回为（void *）类型）</p> 
<pre><code class="language-cpp">void *calloc( 
   size_t num,
   size_t size 
);</code></pre> 
<p>同malloc函数相同的头文件：</p> 
<pre><code class="language-html">#include &lt;stdlib.h&gt;
或
#include &lt;malloc.h&gt;</code></pre> 
<p>应用：(<span style="color:#3333ff;">指针</span><span style="color:#ff0000;">类型</span>）  变量名 =<u>（<span style="color:#3333ff;">指针</span><span style="color:#ff0000;">类型</span>）</u>calloc（n ，sizeof(<span style="color:#ff0000;">类型</span>））；//<u>（<span style="color:rgb(51,51,255);">指针</span><span style="color:rgb(255,0,0);">类型</span>）</u>强转为同变量类型；</p> 
<blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
 <p>如：int *arr = (int *) calloc ( n , sizeof(int) ); //将n个（int）初始化为0；arr指向该内存首部；</p> 
 <p>相当于：int *arr = (int*) malloc (a*sizeof(int));<br><span style="white-space:pre;"> </span>    for(int i=0;i&lt;a;i++)<br><span style="white-space:pre;"> </span>{<!-- --><br></p> 
</blockquote> 
<blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
 <span style="white-space:pre;"> </span>arr[i] = 0; 
</blockquote> 
<blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
 <blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
  <p></p> 
  <p>}</p> 
  <p>int n=4;</p> 
 </blockquote> 
</blockquote> 
<blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
 <p></p> 
 <p><img src="https://images2.imgbox.com/ff/67/xJ3shndn_o.png" alt=""></p> 
</blockquote> 
<h3>realloc函数：</h3> 
<p>   作用：（对原内存进行扩充）在内存的动态存储区分配m（新的大小）个长度为size（类型）的连续空间，将原来的内容拷贝到新的内存；</p> 
<p>   注意：新的大小可小。如果新的内存大于原内存，则新分配部分不会被初始化；如果新的内存小于原内存，则可能会导致数据丢失。</p> 
<p>函数声明：（返回为（void *）类型）</p> 
<pre><code class="language-cpp">void *realloc(
   void *memblock,
   size_t size 
);</code></pre> 
<p>同malloc函数相同的头文件：</p> 
<pre><code class="language-html">#include &lt;stdlib.h&gt;
或
#include &lt;malloc.h&gt;</code></pre>应用：( 
<span style="color:rgb(51,51,255);">指针</span> 
<span style="color:rgb(255,0,0);">类型</span>）变量名 = 
<u>（<span style="color:rgb(51,51,255);">指针</span><span style="color:rgb(255,0,0);">类型</span>）</u>realloc（原内存的指针名，新的大小）；// 
<u>（<span style="color:rgb(51,51,255);">指针</span><span style="color:rgb(255,0,0);">类型</span>）</u>强转为同变         量类型； 
<br> 
<p style="margin:0 0 0 40px;border:none;padding:0px;">如：int *brr = (int *)realloc(arr,2*n*sizeof(int));     //将arr的内容存入2*n*sizeof(int)的内存中；brr指向         新的内存；</p> 
<p style="margin:0 0 0 40px;border:none;padding:0px;">int n=4;</p> 
<p style="margin:0 0 0 40px;border:none;padding:0px;"><img src="https://images2.imgbox.com/3f/96/jYyuyLwO_o.png" alt=""><br></p> 
<h3>free()函数:</h3> 
<p>   作用：释放malloc、calloc、realloc函数给指针变量分配的内存空间的函数，使用后将该指针变量指向NULL，防止野指针。</p> 
<p>函数声明：</p> 
<pre><code class="language-cpp">void free( 
   void *memblock 
);</code></pre> 
<p>应用：free（动态内存的指针）；</p> 
<p></p> 
<blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
 <p>如：free（arr）；</p> 
</blockquote> 
<p></p> 
<p>   注意：系统在分配内存时，为了好管理，通常在内存首尾增加标识。如果在使用内存时越界，free()函数在释放内存时崩溃。</p> 
<blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
 <p></p> 
 <p>可能“崩溃”的原因：</p> 
 <p>1、越界。如：malloc函数漏写sizeof,realloc第二个参数写错</p> 
 <p>2、改变指针的指向（free()通过首部标识释放内存）。如：p++</p> 
 <p></p> 
 <p>3、重复释放内存。如：释放同一内存。（避免发生，将 p=NULL;）</p> 
 <pre><code class="language-cpp">int *p = (int *)malloc(40);
	int *q = p;
	free(p);
	free(q);</code></pre> 
 <p>4、释放不是动态申请的内存（动态申请的内存才有首尾标识）。如：</p> 
 <pre><code class="language-cpp">int arr[10];
	free(arr);</code></pre> 
 <br> 
 <p><br></p> 
 <p><br></p> 
</blockquote> 
<blockquote style="margin:0 0 0 40px;border:none;padding:0px;"> 
 <p></p> 
 <p><br></p> 
</blockquote> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ac3bd1e9ceea1d8eff47b8d3abec952/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MongoDB日志logappend方式以每天为单位自动切割日志</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2b288537066f02206172ac831971f58e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">互斥锁与死锁</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>