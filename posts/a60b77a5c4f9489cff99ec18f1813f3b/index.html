<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HIVE 大数据实战项目 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HIVE 大数据实战项目" />
<meta property="og:description" content="目录
一、项目需求
二、数据介绍
三、创建表结构
四、数据清洗
五、数据加载
六、业务数据分析
七、原始数据
一、项目需求 1.统计视频观看数 Top10
2.统计视频类别热度Top10
3.统计出视频观看数最高的20个视频的所属类别以及类别包含这Top20视频的个数
4.统计视频观看数Top50所关联视频的所属类别的热度排名
5.统计每个类别中的视频热度Top10，以 Music为例
6.统计每个类别中视频流量 Top10 ，以 Music为例
7.统计上传视频最多的用户Top10以及他们上传的观看次数在前20的视频
8.统计每个类别视频观看数Top10（分组取topN）
二、数据介绍 1.视频数据表：
2.用户表：
三、创建表结构 1.视频表：
create table youtube_ori( videoId string, uploader string, age int, category array&lt; string&gt;, length int, views int, rate float, ratings int, comments int, relatedId array&lt; string&gt;) row format delimited fields terminated by &#34;\t&#34; collection items terminated by &#34;&amp;&#34; ; create table youtube_orc( videoId string, uploader string, age int, category array&lt; string&gt;, length int, views int, rate float, ratings int, comments int, relatedId array&lt; string&gt;) clustered by (uploader) into 8 buckets row format delimited fields terminated by &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a60b77a5c4f9489cff99ec18f1813f3b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-28T22:06:28+08:00" />
<meta property="article:modified_time" content="2019-07-28T22:06:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HIVE 大数据实战项目</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <div class="htmledit_views" id="content_views"> 
 <p id="main-toc"><strong>目录</strong></p> 
</div> 
<p id="%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E9%9C%80%E6%B1%82-toc"><a href="#%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E9%9C%80%E6%B1%82" rel="nofollow noopener noreferrer" target="_self">一、项目需求</a></p> 
<p id="%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E4%BB%8B%E7%BB%8D-toc"><a href="#%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E4%BB%8B%E7%BB%8D" rel="nofollow noopener noreferrer" target="_self">二、数据介绍</a></p> 
<p id="%E4%B8%89%E3%80%81%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%BB%93%E6%9E%84-toc"><a href="#%E4%B8%89%E3%80%81%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%BB%93%E6%9E%84" rel="nofollow noopener noreferrer" target="_self">三、创建表结构</a></p> 
<p id="%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97-toc"><a href="#%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97" rel="nofollow noopener noreferrer" target="_self">四、数据清洗</a></p> 
<p id="%E4%BA%94%E3%80%81%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD-toc"><a href="#%E4%BA%94%E3%80%81%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD" rel="nofollow noopener noreferrer" target="_self">五、数据加载</a></p> 
<p id="%E5%85%AD%E3%80%81%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90-toc"><a href="#%E5%85%AD%E3%80%81%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90" rel="nofollow noopener noreferrer" target="_self">六、业务数据分析</a></p> 
<p id="%E4%B8%83%E3%80%81%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE-toc"><a href="#%E4%B8%83%E3%80%81%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE" rel="nofollow noopener noreferrer" target="_self">七、原始数据</a></p> 
<hr id="hr-toc"> 
<h3 id="%E4%B8%80%E3%80%81%E9%A1%B9%E7%9B%AE%E9%9C%80%E6%B1%82">一、项目需求</h3> 
<p>1.统计视频观看数 Top10</p> 
<p>2.统计视频类别热度Top10</p> 
<p>3.统计出视频观看数最高的20个视频的所属类别以及类别包含这Top20视频的个数</p> 
<p>4.统计视频观看数Top50所关联视频的所属类别的热度排名</p> 
<p>5.统计每个类别中的视频热度Top10，以 Music为例</p> 
<p>6.统计每个类别中视频流量 Top10 ，以 Music为例</p> 
<p>7.统计上传视频最多的用户Top10以及他们上传的观看次数在前20的视频</p> 
<p>8.统计每个类别视频观看数Top10（分组取topN）</p> 
<h3 id="%E4%BA%8C%E3%80%81%E6%95%B0%E6%8D%AE%E4%BB%8B%E7%BB%8D">二、数据介绍</h3> 
<p>1.视频数据表：</p> 
<p><img alt="" class="has" height="400" src="https://images2.imgbox.com/6a/fd/sVZcdUii_o.png" width="706"></p> 
<p>2.用户表：</p> 
<p><img alt="" class="has" height="150" src="https://images2.imgbox.com/b6/9d/Tw47DMwW_o.png" width="711"></p> 
<h3 id="%E4%B8%89%E3%80%81%E5%88%9B%E5%BB%BA%E8%A1%A8%E7%BB%93%E6%9E%84">三、创建表结构</h3> 
<p>1.视频表：</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">create</span> 
     
     <span class="hljs-keyword">table</span> youtube_ori(
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     videoId 
     
     <span class="hljs-keyword">string</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     uploader 
     
     <span class="hljs-keyword">string</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     age 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">category</span> 
     
     <span class="hljs-built_in">array</span>&lt;
     
     <span class="hljs-keyword">string</span>&gt;,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">length</span> 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     views 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     rate 
     
     <span class="hljs-built_in">float</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     ratings 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     comments 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     relatedId 
     
     <span class="hljs-built_in">array</span>&lt;
     
     <span class="hljs-keyword">string</span>&gt;)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">row</span> 
     
     <span class="hljs-keyword">format</span> 
     
     <span class="hljs-keyword">delimited</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">fields</span> 
     
     <span class="hljs-keyword">terminated</span> 
     
     <span class="hljs-keyword">by</span> 
     
     <span class="hljs-string">"\t"</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     collection items 
     
     <span class="hljs-keyword">terminated</span> 
     
     <span class="hljs-keyword">by</span> 
     
     <span class="hljs-string">"&amp;"</span> ;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">create</span> 
     
     <span class="hljs-keyword">table</span> youtube_orc(
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     videoId 
     
     <span class="hljs-keyword">string</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     uploader 
     
     <span class="hljs-keyword">string</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     age 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">category</span> 
     
     <span class="hljs-built_in">array</span>&lt;
     
     <span class="hljs-keyword">string</span>&gt;,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">length</span> 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     views 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     rate 
     
     <span class="hljs-built_in">float</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     ratings 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     comments 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     relatedId 
     
     <span class="hljs-built_in">array</span>&lt;
     
     <span class="hljs-keyword">string</span>&gt;)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     clustered 
     
     <span class="hljs-keyword">by</span> (uploader) 
     
     <span class="hljs-keyword">into</span> 
     
     <span class="hljs-number">8</span> buckets
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">row</span> 
     
     <span class="hljs-keyword">format</span> 
     
     <span class="hljs-keyword">delimited</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">fields</span> 
     
     <span class="hljs-keyword">terminated</span> 
     
     <span class="hljs-keyword">by</span> 
     
     <span class="hljs-string">"\t"</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     collection items 
     
     <span class="hljs-keyword">terminated</span> 
     
     <span class="hljs-keyword">by</span> 
     
     <span class="hljs-string">"&amp;"</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">stored</span> 
     
     <span class="hljs-keyword">as</span> orc;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>2.用户表：</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">create</span> 
     
     <span class="hljs-keyword">table</span> youtube_user_ori(
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     uploader 
     
     <span class="hljs-keyword">string</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     videos 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     friends 
     
     <span class="hljs-built_in">int</span>)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     clustered 
     
     <span class="hljs-keyword">by</span> (uploader) 
     
     <span class="hljs-keyword">into</span> 
     
     <span class="hljs-number">24</span> buckets
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">row</span> 
     
     <span class="hljs-keyword">format</span> 
     
     <span class="hljs-keyword">delimited</span> 
     
     <span class="hljs-keyword">fields</span> 
     
     <span class="hljs-keyword">terminated</span> 
     
     <span class="hljs-keyword">by</span> 
     
     <span class="hljs-string">"\t"</span>;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">create</span> 
     
     <span class="hljs-keyword">table</span> youtube_user_orc(
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     uploader 
     
     <span class="hljs-keyword">string</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     videos 
     
     <span class="hljs-built_in">int</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     friends 
     
     <span class="hljs-built_in">int</span>)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     clustered 
     
     <span class="hljs-keyword">by</span> (uploader) 
     
     <span class="hljs-keyword">into</span> 
     
     <span class="hljs-number">24</span> buckets
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">row</span> 
     
     <span class="hljs-keyword">format</span> 
     
     <span class="hljs-keyword">delimited</span> 
     
     <span class="hljs-keyword">fields</span> 
     
     <span class="hljs-keyword">terminated</span> 
     
     <span class="hljs-keyword">by</span> 
     
     <span class="hljs-string">"\t"</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">stored</span> 
     
     <span class="hljs-keyword">as</span> orc;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<h3 id="%E5%9B%9B%E3%80%81%E6%95%B0%E6%8D%AE%E6%B8%85%E6%B4%97">四、数据清洗</h3> 
<p>通过观察原始数据形式，可以发现，视频可以有多个所属分类，每个所属分类用&amp;符号分割， 且分割的两边有空格字符，同时相关视频也是可以有多个元素，多个相关视频又用“\t”进 行分割。为了分析数据时方便对存在多个子元素的数据进行操作，我们首先进行数据重组清 洗操作。即：将所有的类别用“&amp;”分割，同时去掉两边空格，多个相关视频 id 也使用“&amp;” 进行分割。</p> 
<p>1.ETLUtil</p> 
<pre class="has"><code class="language-java hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">package</span> com.company.sparksql;
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">public</span> 
     
     <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ETLUtil</span> </span>{
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">    
     
     <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">oriString2ETLString</span><span class="hljs-params">(String ori)</span></span>{
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
             StringBuilder etlString = 
     
     <span class="hljs-keyword">new</span> StringBuilder();
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
             String[] splits = ori.split(
     
     <span class="hljs-string">"\t"</span>);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">        
     
     <span class="hljs-keyword">if</span>(splits.length &lt; 
     
     <span class="hljs-number">9</span>) 
     
     <span class="hljs-keyword">return</span> 
     
     <span class="hljs-keyword">null</span>;
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
             splits[
     
     <span class="hljs-number">3</span>] = splits[
     
     <span class="hljs-number">3</span>].replace(
     
     <span class="hljs-string">" "</span>, 
     
     <span class="hljs-string">""</span>);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">        
     
     <span class="hljs-keyword">for</span>(
     
     <span class="hljs-keyword">int</span> i = 
     
     <span class="hljs-number">0</span>; i &lt; splits.length; i++){
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">            
     
     <span class="hljs-keyword">if</span>(i &lt; 
     
     <span class="hljs-number">9</span>){
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">                
     
     <span class="hljs-keyword">if</span>(i == splits.length - 
     
     <span class="hljs-number">1</span>){
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                         etlString.append(splits[i]);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                     }
     
     <span class="hljs-keyword">else</span>{
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                         etlString.append(splits[i] + 
     
     <span class="hljs-string">"\t"</span>);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                     }
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                 }
     
     <span class="hljs-keyword">else</span>{
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">                
     
     <span class="hljs-keyword">if</span>(i == splits.length - 
     
     <span class="hljs-number">1</span>){
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                         etlString.append(splits[i]);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                     }
     
     <span class="hljs-keyword">else</span>{
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                         etlString.append(splits[i] + 
     
     <span class="hljs-string">"&amp;"</span>);
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                     }
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
                 }
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
             }
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">        
     
     <span class="hljs-keyword">return</span> etlString.toString();
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         }
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     }
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>2.DataCleaner</p> 
<pre class="has"><code class="language-java hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">package</span> com.company.sparksql
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">import</span> org.apache.log4j.{Level, Logger}
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">import</span> org.apache.spark.sql.SparkSession
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     object DataCleaner {
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">  
     
     <span class="hljs-function">def <span class="hljs-title">main</span><span class="hljs-params">(args: Array[String])</span>: Unit </span>= {
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         val spark = SparkSession
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
           .builder()
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
           .master(
     
     <span class="hljs-string">"local"</span>)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
           .appName(DataCleaner.getClass.getSimpleName)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
           .getOrCreate()
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         Logger.getLogger(
     
     <span class="hljs-string">"org.apache.spark"</span>).setLevel(Level.OFF)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         Logger.getLogger(
     
     <span class="hljs-string">"org.apache.hadoop"</span>).setLevel(Level.OFF)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         val lineDS = spark.read.textFile(
     
     <span class="hljs-string">"e:/0.txt"</span>)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">    
     
     <span class="hljs-keyword">import</span> spark.implicits._
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         val splitedDS = lineDS.map(ETLUtil.oriString2ETLString(_))
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         splitedDS.write.format(
     
     <span class="hljs-string">"text"</span>).save(
     
     <span class="hljs-string">"e:/movie"</span>)
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">   
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       }
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     }
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<h3 id="%E4%BA%94%E3%80%81%E6%95%B0%E6%8D%AE%E5%8A%A0%E8%BD%BD">五、数据加载</h3> 
<p>1.视频表：</p> 
<p>加载清洗之后的数据到原始视频表</p> 
<pre class="has"><code class="language-bash hljs">load data <span class="hljs-built_in">local</span> inpath <span class="hljs-string">"/opt/datas/cleaned.txt"</span> into table youtube_ori;</code>
 
 <div class="hljs-button {2}"></div></pre> 
<p>加载数据到视频的ORC表</p> 
<pre class="has"><code class="language-bash hljs">insert overwrite table youtube_orc select * from youtube_ori;</code>
 
 <div class="hljs-button {2}"></div></pre> 
<p>2用户表：</p> 
<p>加载清洗之后的数据到原始用户表</p> 
<pre class="has"><code class="hljs sql"><span class="hljs-keyword">load</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">local</span> inpath <span class="hljs-string">"/opt/datas/user.txt"</span> <span class="hljs-keyword">into</span> <span class="hljs-keyword">table</span> user_ori;</code>
 
 <div class="hljs-button {2}"></div></pre> 
<p>加载数据到用户的ORC表</p> 
<pre class="has"><code class="language-bash hljs">insert overwrite table user_orc select * from user_ori;</code>
 
 <div class="hljs-button {2}"></div></pre> 
<h3 id="%E5%85%AD%E3%80%81%E4%B8%9A%E5%8A%A1%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90">六、业务数据分析</h3> 
<p>1.统计视频观看数 Top10</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">select</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     videoId,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     uploader,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     age ,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">category</span> ,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">length</span> ,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     views ,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     rate ,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     ratings ,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     comments  
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> youtube_orc 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> views 
     
     <span class="hljs-keyword">desc</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">10</span>;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>2.统计视频类别热度Top10</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     第一种方式：
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     category_name,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">count</span>(videoId) 
     
     <span class="hljs-keyword">as</span> video_num 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> youtube_orc lateral 
     
     <span class="hljs-keyword">view</span> explode(
     
     <span class="hljs-keyword">category</span>) youtube_view 
     
     <span class="hljs-keyword">as</span> category_name 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">group</span> 
     
     <span class="hljs-keyword">by</span> category_name 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span>  video_num 
     
     <span class="hljs-keyword">desc</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">10</span>;
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     第二种方式：
     
     <span class="hljs-keyword">select</span> category_name 
     
     <span class="hljs-keyword">as</span> 
     
     <span class="hljs-keyword">category</span>, 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">count</span>(t1.videoId) 
     
     <span class="hljs-keyword">as</span> hot 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> (
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       videoId,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       category_name
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">    
     
     <span class="hljs-keyword">from</span> youtube_orc lateral 
     
     <span class="hljs-keyword">view</span> explode(
     
     <span class="hljs-keyword">category</span>) t_catetory 
     
     <span class="hljs-keyword">as</span> category_name) t1 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">group</span> 
     
     <span class="hljs-keyword">by</span> t1.category_name 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> hot 
     
     <span class="hljs-keyword">desc</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">10</span>;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>3.统计出视频观看数最高的20个视频的所属类别以及类别包含这Top20视频的个数</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">select</span> category_name,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">count</span>(videoId) 
     
     <span class="hljs-keyword">as</span> videonums
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> (
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">	
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     	videoId,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     	category_name
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">	
     
     <span class="hljs-keyword">from</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     		(
     
     <span class="hljs-keyword">select</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">		
     
     <span class="hljs-keyword">category</span>,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     		videoId,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     		views
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">		
     
     <span class="hljs-keyword">from</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     		youtube_orc 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">		
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> views 
     
     <span class="hljs-keyword">desc</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">		
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">20</span>) top20view lateral 
     
     <span class="hljs-keyword">view</span> explode(
     
     <span class="hljs-keyword">category</span>) t1_view 
     
     <span class="hljs-keyword">as</span> category_name )t2_alias 
     
     <span class="hljs-keyword">group</span> 
     
     <span class="hljs-keyword">by</span> category_name 
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> videonums 
     
     <span class="hljs-keyword">desc</span>;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>4.统计视频观看数Top50所关联视频的所属类别的热度排名</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     category_name,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">count</span>(relatedvideoId) 
     
     <span class="hljs-keyword">as</span> hot
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
        (
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
        relatedvideoId,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">   
     
     <span class="hljs-keyword">category</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         (
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">   
     
     <span class="hljs-keyword">distinct</span> relatedvideoId
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> (
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       views,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       relatedId
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
        youtube_orc
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> views 
     
     <span class="hljs-keyword">desc</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">50</span> )t1 lateral 
     
     <span class="hljs-keyword">view</span> explode(relatedId) explode_viedeo 
     
     <span class="hljs-keyword">as</span>  relatedvideoId)t2 
     
     <span class="hljs-keyword">join</span> youtube_orc  
     
     <span class="hljs-keyword">on</span> youtube_orc.videoId = t2.relatedvideoId)t3 lateral 
     
     <span class="hljs-keyword">view</span> explode(
     
     <span class="hljs-keyword">category</span>) explode_category 
     
     <span class="hljs-keyword">as</span> category_name
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">group</span> 
     
     <span class="hljs-keyword">by</span> category_name
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> hot 
     
     <span class="hljs-keyword">desc</span>;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>5.统计每个类别中的视频热度Top10，以 Music为例</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">select</span>  
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       videoId,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       views  
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> youtube_orc lateral 
     
     <span class="hljs-keyword">view</span> explode(
     
     <span class="hljs-keyword">category</span>) t1_view 
     
     <span class="hljs-keyword">as</span> category_name 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
     
     <span class="hljs-keyword">where</span> category_name = 
     
     <span class="hljs-string">"Music"</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> views 
     
     <span class="hljs-keyword">desc</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">10</span> ; 
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>6.统计每个类别中视频流量 Top10 ，以 Music为例</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
        videoId ,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
        ratings
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> youtube_orc lateral 
     
     <span class="hljs-keyword">view</span> explode(
     
     <span class="hljs-keyword">category</span>) t1_view 
     
     <span class="hljs-keyword">as</span> category_name 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">where</span> category_name = 
     
     <span class="hljs-string">"Music"</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> ratings 
     
     <span class="hljs-keyword">desc</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line"> 
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">10</span> ;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>7.统计上传视频最多的用户Top10以及他们上传的观看次数在前20的视频</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">select</span> t1.uploader,youtube_orc.videoId,youtube_orc.views
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     (
     
     <span class="hljs-keyword">select</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     uploader,videos
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span> youtube_user_orc 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> videos 
     
     <span class="hljs-keyword">desc</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">10</span>) t1 
     
     <span class="hljs-keyword">inner</span> 
     
     <span class="hljs-keyword">join</span> youtube_orc 
     
     <span class="hljs-keyword">on</span> t1.uploader = youtube_orc.uploader 
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> views 
     
     <span class="hljs-keyword">desc</span> 
     
     <span class="hljs-keyword">limit</span> 
     
     <span class="hljs-number">20</span> ; 
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<p>8.统计每个类别视频观看数Top10（分组取topN）</p> 
<pre class="has"><code class="language-sql hljs"></code>
 
 <ol class="hljs-ln"><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">select</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         t2_alias.category_name,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
         t2_alias.videoId,t2_alias.views 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
     <span class="hljs-keyword">from</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
       (
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">    
     
     <span class="hljs-keyword">select</span>  
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
             category_name,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
             videoId,views ,
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
             row_number() 
     
     <span class="hljs-keyword">over</span>(
     
     <span class="hljs-keyword">partition</span> 
     
     <span class="hljs-keyword">by</span> category_name 
     
     <span class="hljs-keyword">order</span> 
     
     <span class="hljs-keyword">by</span> views 
     
     <span class="hljs-keyword">desc</span>) 
     
     <span class="hljs-keyword">rank</span>
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">     
     
     <span class="hljs-keyword">from</span> 
    
    </div>
   
   </div></li><li>
   
   <div class="hljs-ln-numbers">
    
    <div class="hljs-ln-line hljs-ln-n"></div>
   
   </div>
   
   <div class="hljs-ln-code">
    
    <div class="hljs-ln-line">
     
             youtube_orc lateral 
     
     <span class="hljs-keyword">view</span> explode(
     
     <span class="hljs-keyword">category</span>) t1_view 
     
     <span class="hljs-keyword">as</span> category_name ) t2_alias 
     
     <span class="hljs-keyword">where</span> 
     
     <span class="hljs-keyword">rank</span> &lt;= 
     
     <span class="hljs-number">10</span>;
    
    </div>
   
   </div></li></ol>
 
 <div class="hljs-button {2}"></div></pre> 
<h3 id="%E4%B8%83%E3%80%81%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE">七、原始数据</h3> 
<p>1.视频表</p> 
<p>2.用户表</p> 
<p>3.清洗之后的视频表</p> 
<p>链接：https://pan.baidu.com/s/1OkQ2E5_KCngVRbTkalodrQ <br> 提取码：yzk7 </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cd640d432dca8b5738151143dbfd82b2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Spring--Resource</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/46555835af32e708bb19ce89c041f284/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">c&#43;&#43; 线程间通信方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>