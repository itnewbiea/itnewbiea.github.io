<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MyBatis使用动态SQL注解@SelectProvider、@InsertProvider、@UpdateProvider、@DeleteProvider - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MyBatis使用动态SQL注解@SelectProvider、@InsertProvider、@UpdateProvider、@DeleteProvider" />
<meta property="og:description" content="MyBatis 3.x 版本提供了以下4个CRUD的高级注解。
@SelectProvider：用于构建动态查询SQL。
@InsertProvider：用于构建动态新增SQL。
@UpdateProvider：用于构建动态更新SQL。
@DeleteProvider：用于构建动态删除SQL。
动态SQL注解主要用于编写动态SQL。这里以@SelectProvider为例，它主要包含两个注解属性，其中，type表示工具类，method表示工具类的某个方法（用于返回具体的SQL语句）。
以下代码可以构建动态SQL，实现查询功能：
/** * 根据用户ID，获取用户信息 * @author pan_junbiao */ @SelectProvider(type = UserSqlBuilder.class, method = &#34;buildGetUserByIdSql&#34;) public UserInfo getUserById(@Param(&#34;userId&#34;) int userId); UserSqlBuilder工具类的代码如下：
public class UserSqlBuilder { public String buildGetUserByIdSql(@Param(&#34;userId&#34;) int userId) { return new SQL() { { SELECT(&#34;*&#34;); FROM(&#34;tb_user&#34;); WHERE(&#34;user_id = #{userId}&#34;); } }.toString(); } } 【实例】使用MyBatis的动态SQL注解，实现用户信息的查询、新增、修改、删除操作。
1、创建数据表 在MySQL数据库中创建用户信息表（tb_user），并添加数据。
-- 判断数据表是否存在，存在则删除 DROP TABLE IF EXISTS tb_user; -- 创建“用户信息”数据表 CREATE TABLE IF NOT EXISTS tb_user ( user_id INT AUTO_INCREMENT PRIMARY KEY COMMENT &#39;用户编号&#39;, user_name VARCHAR(50) NOT NULL COMMENT &#39;用户名称&#39;, blog_url VARCHAR(50) NOT NULL COMMENT &#39;博客地址&#39;, blog_remark VARCHAR(50) COMMENT &#39;博客备注&#39; ) COMMENT = &#39;用户信息表&#39;; -- 添加数据 INSERT INTO tb_user(user_name,blog_url,blog_remark) VALUES(&#39;pan_junbiao的博客&#39;,&#39;https://blog." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/157d13d30fb5d832c5f393cebed5721a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-06-15T16:49:01+08:00" />
<meta property="article:modified_time" content="2020-06-15T16:49:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MyBatis使用动态SQL注解@SelectProvider、@InsertProvider、@UpdateProvider、@DeleteProvider</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>MyBatis 3.x 版本提供了以下4个CRUD的高级注解。</p> 
<p>@SelectProvider：用于构建动态查询SQL。</p> 
<p>@InsertProvider：用于构建动态新增SQL。</p> 
<p>@UpdateProvider：用于构建动态更新SQL。</p> 
<p>@DeleteProvider：用于构建动态删除SQL。</p> 
<p>动态SQL注解主要用于编写动态SQL。这里以@SelectProvider为例，它主要包含两个注解属性，其中，type表示工具类，method表示工具类的某个方法（用于返回具体的SQL语句）。</p> 
<p>以下代码可以构建动态SQL，实现查询功能：</p> 
<pre><code class="language-java">/**
 * 根据用户ID，获取用户信息
 * @author pan_junbiao
 */
@SelectProvider(type = UserSqlBuilder.class, method = "buildGetUserByIdSql")
public UserInfo getUserById(@Param("userId") int userId);</code></pre> 
<p>UserSqlBuilder工具类的代码如下：</p> 
<pre><code class="language-java">public class UserSqlBuilder
{
    public String buildGetUserByIdSql(@Param("userId") int userId)
    {
        return new SQL()
        {
            {
                SELECT("*");
                FROM("tb_user");
                WHERE("user_id = #{userId}");
            }
        }.toString();
    }
}</code></pre> 
<p><strong>【实例】</strong>使用MyBatis的动态SQL注解，实现用户信息的查询、新增、修改、删除操作。</p> 
<h2>1、创建数据表</h2> 
<p>在MySQL数据库中创建用户信息表（tb_user），并添加数据。</p> 
<pre><code class="language-sql">-- 判断数据表是否存在，存在则删除
DROP TABLE IF EXISTS tb_user;
 
-- 创建“用户信息”数据表
CREATE TABLE IF NOT EXISTS tb_user
( 
	user_id INT AUTO_INCREMENT PRIMARY KEY COMMENT '用户编号',
	user_name VARCHAR(50) NOT NULL COMMENT '用户名称',
	blog_url VARCHAR(50) NOT NULL COMMENT '博客地址',
	blog_remark VARCHAR(50) COMMENT '博客备注'
) COMMENT = '用户信息表';
 
-- 添加数据
INSERT INTO tb_user(user_name,blog_url,blog_remark) VALUES('pan_junbiao的博客','https://blog.csdn.net/pan_junbiao','您好，欢迎访问 pan_junbiao的博客');</code></pre> 
<h2>2、创建项目</h2> 
<p><strong>（1）创建SpringBoot项目，项目结构如下图：</strong></p> 
<p><img alt="" src="https://images2.imgbox.com/ae/01/74nvl4l3_o.jpg"></p> 
<p><strong>（2）添加pom.xml配置信息</strong></p> 
<p>在pom.xml配置文件中添加MyBatis、 MySQL的JDBC数据库驱动。</p> 
<pre><code class="language-html">&lt;!-- MyBatis与SpringBoot整合依赖 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.mybatis.spring.boot&lt;/groupId&gt;
    &lt;artifactId&gt;mybatis-spring-boot-starter&lt;/artifactId&gt;
    &lt;version&gt;2.1.3&lt;/version&gt;
&lt;/dependency&gt;

&lt;!-- MySQL的JDBC数据库驱动 --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;mysql&lt;/groupId&gt;
    &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
    &lt;version&gt;8.0.20&lt;/version&gt;
&lt;/dependency&gt;</code></pre> 
<p><strong>（3）配置相关信息</strong></p> 
<p>将默认的application.properties文件的后缀修改为“.yml”，即配置文件名称为：application.yml，并配置以下信息：</p> 
<pre><code>spring:
  #DataSource数据源
  datasource:
    url: jdbc:mysql://localhost:3306/db_admin?useSSL=false&amp;amp
    username: root
    password: 123456
    driver-class-name: com.mysql.cj.jdbc.Driver

#MyBatis配置
mybatis:
  type-aliases-package: com.pjb.entity #别名定义
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl #指定 MyBatis 所用日志的具体实现，未指定时将自动查找
    map-underscore-to-camel-case: true #开启自动驼峰命名规则（camel case）映射
    lazy-loading-enabled: true #开启延时加载开关
    aggressive-lazy-loading: false #将积极加载改为消极加载（即按需加载）,默认值就是false
    lazy-load-trigger-methods: "" #阻挡不相干的操作触发，实现懒加载
    cache-enabled: true #打开全局缓存开关（二级环境），默认值就是true</code></pre> 
<h3>2.1 创建实体类（Entity层）</h3> 
<p>在com.pjb.entity包中，创建UserInfo类（用户信息实体类）。</p> 
<pre><code class="language-java">package com.pjb.entity;

/**
 * 用户信息实体类
 * @author pan_junbiao
 **/
public class UserInfo
{
    private int userId; //用户编号
    private String userName; //用户名称
    private String blogUrl; //博客地址
    private String blogRemark; //博客备注

    //省略getter与setter方法...
}</code></pre> 
<h3>2.2 数据库映射层（Mapper层）</h3> 
<p>在com.pjb.mapper包中，创建UserMapper接口（用户信息Mapper动态代理接口）。</p> 
<pre><code class="language-java">package com.pjb.mapper;

import com.pjb.entity.UserInfo;
import org.apache.ibatis.annotations.*;
import org.apache.ibatis.jdbc.SQL;
import org.springframework.stereotype.Repository;

/**
 * 用户信息Mapper动态代理接口
 * @author pan_junbiao
 **/
@Mapper
@Repository
public interface UserMapper
{
    /**
     * 根据用户ID，获取用户信息
     */
    @SelectProvider(type = UserSqlBuilder.class, method = "buildGetUserByIdSql")
    public UserInfo getUserById(@Param("userId") int userId);

    /**
     * 新增用户，并获取自增主键
     */
    @InsertProvider(type = UserSqlBuilder.class, method = "buildInsertUserSql")
    @Options(useGeneratedKeys = true, keyColumn = "user_id", keyProperty = "userId")
    public int insertUser(UserInfo user);

    /**
     * 修改用户
     */
    @UpdateProvider(type = UserSqlBuilder.class, method = "buildUpdateUserSql")
    public int updateUser(UserInfo user);

    /**
     * 删除用户
     */
    @DeleteProvider(type = UserSqlBuilder.class, method = "buildDeleteUserSql")
    public int deleteUser(@Param("userId") int userId);

    //建议将SQL Builder以映射器接口内部类的形式进行定义
    public class UserSqlBuilder
    {
        public String buildGetUserByIdSql(@Param("userId") int userId)
        {
            return new SQL()
            {
                {
                    SELECT("*");
                    FROM("tb_user");
                    WHERE("user_id = #{userId}");
                }
            }.toString();
        }

        public String buildInsertUserSql(UserInfo user)
        {
            return new SQL()
            {
                {
                    INSERT_INTO("tb_user");
                    VALUES("user_name", "#{userName}");
                    VALUES("blog_url", "#{blogUrl}");
                    VALUES("blog_remark", "#{blogRemark}");
                }
            }.toString();
        }

        public String buildUpdateUserSql(UserInfo user)
        {
            return new SQL()
            {
                {
                    UPDATE("tb_user");
                    SET("user_name = #{userName} ,blog_url=#{blogUrl} ,blog_remark=#{blogRemark}");
                    WHERE("user_id = #{userId}");
                }
            }.toString();
        }

        public String buildDeleteUserSql(@Param("userId") int userId)
        {
            return new SQL()
            {
                {
                    DELETE_FROM("tb_user");
                    WHERE("user_id = #{userId}");
                }
            }.toString();
        }
    }
}</code></pre> 
<h2>3、运行测试</h2> 
<h3>31. 查询操作</h3> 
<pre><code class="language-java">@Autowired
private UserMapper userMapper;

/**
 * 根据用户ID，获取用户信息
 * @author pan_junbiao
 */
@Test
public void getUserById()
{
    //获取用户编号为1的用户信息
    UserInfo userInfo = userMapper.getUserById(1);

    //打印结果
    System.out.println("用户编号：" + userInfo.getUserId());
    System.out.println("用户姓名：" + userInfo.getUserName());
    System.out.println("博客地址：" + userInfo.getBlogUrl());
    System.out.println("备注信息：" + userInfo.getBlogRemark());
}</code></pre> 
<p><strong>执行结果：</strong> </p> 
<p>控制台打印的SQL语句与执行结果如下图：</p> 
<p><img alt="" src="https://images2.imgbox.com/3f/1e/iJNWqT15_o.jpg"></p> 
<h3>3.2 新增操作</h3> 
<pre><code class="language-java">@Autowired
private UserMapper userMapper;

/**
 * 新增用户，并获取自增主键
 * @author pan_junbiao
 */
@Test
public void insertUser()
{
    //创建新用户
    UserInfo userInfo = userMapper.getUserById(1);
    userInfo.setUserName("pan_junbiao的博客");
    userInfo.setBlogUrl("https://blog.csdn.net/pan_junbiao");
    userInfo.setBlogRemark("您好，欢迎访问 pan_junbiao的博客");

    //执行新增操作
    int result = userMapper.insertUser(userInfo);

    //打印结果
    System.out.println("新增用户完成！");
    System.out.println("执行结果：" + result);
    System.out.println("自增主键：" + userInfo.getUserId());
}</code></pre> 
<p><strong>执行结果：</strong> </p> 
<p>控制台打印的SQL语句与执行结果如下图：</p> 
<p><img alt="" height="191" src="https://images2.imgbox.com/55/f6/8urcz3xZ_o.jpg" width="1157"></p> 
<h3>3.3 修改操作</h3> 
<pre><code class="language-java">@Autowired
private UserMapper userMapper;

/**
 * 修改用户
 * @author pan_junbiao
 */
@Test
public void updateUser()
{
    //修改用户
    UserInfo userInfo = userMapper.getUserById(2);
    userInfo.setUserName("pan_junbiao的博客_02");
    userInfo.setBlogUrl("https://blog.csdn.net/pan_junbiao");
    userInfo.setBlogRemark("您好，欢迎访问 pan_junbiao的博客");

    //执行修改操作
    int result = userMapper.updateUser(userInfo);

    //打印结果
    System.out.println("修改用户完成！");
    System.out.println("修改结果：" + result);
}</code></pre> 
<p><strong>执行结果：</strong> </p> 
<p>控制台打印的SQL语句与执行结果如下图：</p> 
<p><img alt="" height="161" src="https://images2.imgbox.com/f8/40/77pnTxVY_o.jpg" width="1157"></p> 
<h3>3.4 删除操作</h3> 
<pre><code class="language-java">@Autowired
private UserMapper userMapper;

/**
 * 删除用户
 * @author pan_junbiao
 */
@Test
public void deleteUser()
{
    //执行修改操作
    int result = userMapper.deleteUser(2);

    //打印结果
    System.out.println("删除用户完成！");
    System.out.println("删除结果：" + result);
}</code></pre> 
<p><strong>执行结果：</strong> </p> 
<p>控制台打印的SQL语句与执行结果如下图：</p> 
<p><img alt="" height="161" src="https://images2.imgbox.com/02/0f/vW6kzier_o.jpg" width="1157"></p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e5fa2ba63712bb4bbf94f62eb135ad8c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Edge、Chrome、IE浏览器乱码解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dafd1524d736b289363f2b92c9ef01cf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IDEA使用Git，快捷键总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>