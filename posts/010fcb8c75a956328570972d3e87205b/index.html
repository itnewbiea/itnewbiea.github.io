<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>DNS的正向、反向、双向解析（正向解析内含CNAME，MX） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="DNS的正向、反向、双向解析（正向解析内含CNAME，MX）" />
<meta property="og:description" content="一：DNS解析层次结构
如图所示（图片来自网络）：DNS是逐级查询
域名后缀一般分为国际域名和国内域名，常见的域名后缀有.com（商业组织）、.org（非盈利组织）、.gov（政府部门）、.net（网络服务商）、.edu（教研机构）、.pub（公共大众）、.cn（中国国家顶级域名）等。
解析答案：
肯定答案： 否定答案：请求的条目不存在等原因导致无法返回结果 权威答案：你请求的dns服务器正好是负责这个链接域的dns 非权威答案：dns服务器问别人，别人告诉它的，有时候会是假的，比如国外某些网站访问不了，就是dns告诉给你一个错误的答案，不让你访问（DNS的污染，信息篡改了） 备注：名字解析成不成功和能不能上网是两码事
做实验所需的配置文件：
/etc/named.conf 主配置文件 服务器主要运行参数 /etc/named.rfc1912.zones 区域文件，主要指定要解析哪个域名 /var/named 数据目录 /var/named/xxx.xx 数据文件，用来对应域名和ip关系 二.DNS的 正向解析
在DNS域名解析服务中，正向解析是指根据域名（主机名）查找到对应的IP地址。
实验如下：
&lt;1&gt;正向解析
步骤一：调整实验环境
将提供解析的ip在/etc/resolv.conf里修改为服务器的ip，并将之前网络配置里面DNS1=114.114.114.114删掉
步骤二：编辑区域文件
我们可以在主配置文件里面看见，它可以读取区域文件 /etc/named.rfc1912.zones
我们此时有一个域meng.com需要进行管理，所以需要去编辑区域文件（其实也可以将要管理的域写在主配置文件里，但这样会使主配置文件变得很长，为了方便与整齐，我们统一将其写在区域文件里）
vim /etc/named.rfc1912.zones 在里面写入以下内容
步骤三：编辑数据文件
因为我们自定义的这个数据文件格式与/var/named/named.localhost（模版文件）格式相同，所以我们将其复制过来（记得要将权限一起复制过来，否则named服务起不来）
cp -p named.localhost meng.com.zone 复制并保留原始文件的权限 vim meng.com.zone 编辑数据文件 在里面写入以下内容（不能忘记写.否则服务起不来）
步骤四：重启服务
systemctl restart named 测试
&lt;2&gt;CNAME(名称到“规范名称“，（包括A/AAAA记录的另一个名称）)
其实上面的话通俗一点来说就是域名转换（相当于一个域名对应两个ip，进行轮循）
实验如下：
在数据文件为meng.come.zone里写入以下内容
重启DNS服务，总体如下图所示：
测试：
dig www.baidu.com
如果ip不变化，可以多试着dig几次，因为进行交替也需要时间。
&lt;3&gt;MX(邮件解析)
邮件交换记录 (MX record)是域名系统（DNS）中的一种资源记录类型，用于指定负责处理发往收件人域名的邮件服务器。MX记录允许设置一个优先级，当多个邮件服务器可用时，会根据该值决定投递邮件的服务器。简单邮件传输协议（SMTP）会根据MX记录的值来决定邮件的路由过程。
例如：此时我要发送一封邮件给163.com，但我自己是qq.com，这个时候MX的作用就是识别这封发送邮件的域名163.com，将其解析出来，会得到一个值，然后简单邮件传输协议（SMTP）会根据MX的值来决定邮件的发送。
实验如下：
前提：
此时我们去发送一封邮件，系统会告诉我们这个域名不存在，这说明是我们的DNS的问题
我们查看这个错误，发现是域名不存在
此时为了解决这个问题，我们需要去配置我们的DNS，步骤如下：
在数据文件为meng.come.zone里写入以下内容（注意写.）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/010fcb8c75a956328570972d3e87205b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-14T00:46:48+08:00" />
<meta property="article:modified_time" content="2019-05-14T00:46:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">DNS的正向、反向、双向解析（正向解析内含CNAME，MX）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>一：DNS解析层次结构</strong></p> 
<p>如图所示（图片来自网络）：DNS是逐级查询<br> <img src="https://images2.imgbox.com/7c/e0/Cwfa0GT6_o.png" alt="在这里插入图片描述"></p> 
<p>域名后缀一般分为国际域名和国内域名，<a href="http://xn--eqrc340ayriszljtwrsneju.com" rel="nofollow">常见的域名后缀有.com</a>（商业组织）、.org（非盈利组织）、.gov（政府部门）、.net（网络服务商）、.edu（教研机构）、.pub（公共大众）、.cn（中国国家顶级域名）等。</p> 
<p>解析答案：</p> 
<pre><code>肯定答案：

否定答案：请求的条目不存在等原因导致无法返回结果

权威答案：你请求的dns服务器正好是负责这个链接域的dns

非权威答案：dns服务器问别人，别人告诉它的，有时候会是假的，比如国外某些网站访问不了，就是dns告诉给你一个错误的答案，不让你访问（DNS的污染，信息篡改了）
</code></pre> 
<p><mark>备注：名字解析成不成功和能不能上网是两码事</mark></p> 
<p>做实验所需的配置文件：</p> 
<pre><code>/etc/named.conf          主配置文件 服务器主要运行参数
/etc/named.rfc1912.zones  区域文件，主要指定要解析哪个域名
/var/named                数据目录
/var/named/xxx.xx        数据文件，用来对应域名和ip关系
</code></pre> 
<p><strong>二.DNS的 正向解析</strong></p> 
<p>在DNS域名解析服务中，正向解析是指根据域名（主机名）查找到对应的IP地址。</p> 
<p>实验如下：</p> 
<p><strong>&lt;1&gt;正向解析</strong></p> 
<p><mark>步骤一</mark>：调整实验环境</p> 
<p>将提供解析的ip在/etc/resolv.conf里修改为服务器的ip，并将之前网络配置里面DNS1=114.114.114.114删掉</p> 
<p><img src="https://images2.imgbox.com/49/ab/J1wTc9vP_o.png" alt="在这里插入图片描述"><br> <mark>步骤二</mark>：编辑区域文件</p> 
<p>我们可以在主配置文件里面看见，它可以读取区域文件 /etc/named.rfc1912.zones<br> <img src="https://images2.imgbox.com/13/d8/LqNbXsmi_o.png" alt="在这里插入图片描述"><br> 我们此时有一个域meng.com需要进行管理，所以需要去编辑区域文件（其实也可以将要管理的域写在主配置文件里，但这样会使主配置文件变得很长，为了方便与整齐，我们统一将其写在区域文件里）</p> 
<pre><code>vim   /etc/named.rfc1912.zones
</code></pre> 
<p><img src="https://images2.imgbox.com/e3/c3/9oqY8muS_o.png" alt="在这里插入图片描述"><br> 在里面写入以下内容<br> <img src="https://images2.imgbox.com/96/f0/qBucsVHW_o.png" alt="在这里插入图片描述"><br> <mark>步骤三</mark>：编辑数据文件</p> 
<p>因为我们自定义的这个数据文件格式与/var/named/named.localhost（模版文件）格式相同，所以我们将其复制过来（<mark>记得要将权限一起复制过来，否则named服务起不来</mark>）</p> 
<pre><code>cp -p named.localhost  meng.com.zone      复制并保留原始文件的权限
vim meng.com.zone                             编辑数据文件
</code></pre> 
<p><img src="https://images2.imgbox.com/24/65/UOMJPbRA_o.png" alt="在这里插入图片描述"><br> 在里面写入以下内容（不能忘记写.否则服务起不来）<br> <img src="https://images2.imgbox.com/60/2a/vrr9rRQA_o.png" alt="在这里插入图片描述"></p> 
<p><mark>步骤四</mark>：重启服务</p> 
<pre><code>systemctl restart named
</code></pre> 
<p><img src="https://images2.imgbox.com/8d/14/7FEfmNs8_o.png" alt="在这里插入图片描述"><br> <mark>测试</mark></p> 
<p><img src="https://images2.imgbox.com/8d/d2/EJdLOTaU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/55/59/9UB7B4ei_o.png" alt="在这里插入图片描述"></p> 
<p><strong>&lt;2&gt;CNAME(名称到“规范名称“，（包括A/AAAA记录的另一个名称）)</strong></p> 
<p>其实上面的话通俗一点来说就是域名转换（相当于一个域名对应两个ip，进行轮循）</p> 
<p><mark>实验如下</mark>：</p> 
<p>在数据文件为meng.come.zone里写入以下内容</p> 
<p><img src="https://images2.imgbox.com/a0/cc/PmksjaOg_o.png" alt="在这里插入图片描述"><br> 重启DNS服务，总体如下图所示：<br> <img src="https://images2.imgbox.com/3d/4e/Ywf34lpV_o.png" alt="在这里插入图片描述"><br> <mark>测试</mark>：</p> 
<p>dig <a href="http://www.baidu.com" rel="nofollow">www.baidu.com</a><br> <img src="https://images2.imgbox.com/dd/a4/uDqdV6Nh_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/31/a4/JL7d95ff_o.png" alt="在这里插入图片描述"><br> 如果ip不变化，可以多试着dig几次，因为进行交替也需要时间。</p> 
<p><strong>&lt;3&gt;MX(邮件解析)</strong></p> 
<p>邮件交换记录 <mark>(MX record)是域名系统（DNS）中的一种资源记录类型</mark>，用于指定负责处理发往收件人域名的邮件服务器。MX记录允许设置一个优先级，当多个邮件服务器可用时，会根据该值决定投递邮件的服务器。简单邮件传输协议（SMTP）会根据MX记录的值来决定邮件的路由过程。</p> 
<p>例如：<a href="http://xn--163-p18d07bb7piopxnlmqie7nw95cgz0adxrjfc.com" rel="nofollow">此时我要发送一封邮件给163.com</a>，<a href="http://xn--qq-sn3c996c30ez4g0p8c.com" rel="nofollow">但我自己是qq.com</a>，<a href="http://xn--MX163-mn1hu1ckxas2cszjwmfvuaj11be7nsual46j31ah58q4nfia1935ikzsama67gu7j.com" rel="nofollow">这个时候MX的作用就是识别这封发送邮件的域名163.com</a>，将其解析出来，会得到一个值，然后简单邮件传输协议（SMTP）会根据MX的值来决定邮件的发送。</p> 
<p>实验如下：</p> 
<p>前提：</p> 
<p>此时我们去发送一封邮件，系统会告诉我们这个域名不存在，这说明是我们的DNS的问题<br> <img src="https://images2.imgbox.com/42/61/Mih0pTsx_o.png" alt="在这里插入图片描述"><br> 我们查看这个错误，发现是域名不存在</p> 
<p><img src="https://images2.imgbox.com/74/f7/C5c0TOdL_o.png" alt="在这里插入图片描述"></p> 
<p>此时为了解决这个问题，我们需要去配置我们的DNS，步骤如下：</p> 
<p>在数据文件为meng.come.zone里写入以下内容（<mark>注意写.</mark>）</p> 
<p><img src="https://images2.imgbox.com/8f/2a/Lysc34UN_o.png" alt="在这里插入图片描述"><br> 重启服务<br> <img src="https://images2.imgbox.com/8f/16/8hIVlAtq_o.png" alt="在这里插入图片描述"><br> 此时再去发送邮件，发现报错被拒绝，是因为172.25.254.115的25端口没开（STMP协议的端口号），但此时我们可以知道，DNS邮件地址解析成功。</p> 
<p><img src="https://images2.imgbox.com/8f/0a/uLlv02HH_o.png" alt="在这里插入图片描述"><br> dig发送的域名，可以检测到<mark>dig -t 指定要查询的DNS数据类型</mark></p> 
<p><img src="https://images2.imgbox.com/8e/b9/tDTnBFDh_o.png" alt="在这里插入图片描述"></p> 
<p><strong>三：DNS的反向解析</strong></p> 
<p>用于IP地址到域名的映射，当DNS客户端请求解析某个IP地址时，DNS服务器通过反向查找，返回给DNS客户端对应的域名。</p> 
<p>实验如下：</p> 
<p><mark>第一步</mark>：编辑区域文件</p> 
<pre><code>vim   /etc/named.rfc1912.zones
</code></pre> 
<p><img src="https://images2.imgbox.com/cd/a6/CLHGkViA_o.png" alt="在这里插入图片描述"><br> 在区域文件里面写入以下的内容</p> 
<p><img src="https://images2.imgbox.com/4a/e7/bHbx8f3j_o.png" alt="在这里插入图片描述"><br> <mark>第二步</mark>：编辑数据文件</p> 
<p>因为我们自定义的这个数据文件格式与/var/named/named.localhost（模版文件）格式相同，所以我们将其复制过来（<mark>记得要将权限一起复制过来，否则named服务起不来</mark>）</p> 
<pre><code>cp -p named.localhost  172.25.254.ptr      复制并保留原始文件的权限
vim      172.25.254.ptr
</code></pre> 
<p><img src="https://images2.imgbox.com/d6/6e/nsknT6eG_o.png" alt="在这里插入图片描述"><br> 在里面写入</p> 
<p><img src="https://images2.imgbox.com/c6/57/c03BXv5N_o.png" alt="在这里插入图片描述"><br> <mark>第三步</mark>：重启服务</p> 
<p><img src="https://images2.imgbox.com/8f/ac/96Yk2GgX_o.png" alt="在这里插入图片描述"><br> <mark>测试</mark>：</p> 
<p><mark>用dig -x 执行逆向域名查询</mark></p> 
<p><img src="https://images2.imgbox.com/ad/4a/QOkXKhPv_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ed/7f/lfrjChgK_o.png" alt="在这里插入图片描述"><br> <strong>四：DNS双向解析</strong></p> 
<p>双向解析即在不同的主机中，当访问同一个域名时，会出现不同的ip。</p> 
<p>在企业中，我们需要内部的主机访问的时候获取的网段ip与外网的主机访问到的网段ip不同，这能大大的强化企业环境安全性。</p> 
<p>实验如下：</p> 
<p><mark>第一步：编辑外网的数据文件</mark></p> 
<p>将正向解析库进行复制，复制过来的这个文件是外网来访问的时候读取的文件，里面有外网主机可以获得的ip。</p> 
<pre><code>cp -p meng.com.zone  meng.com.outer.zone
ls
vim  meng.com.outer.zone
</code></pre> 
<p><img src="https://images2.imgbox.com/00/ed/SRCFRmfN_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1d/89/nLUeHdqY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/70/13/Kkj43nVi_o.png" alt="在这里插入图片描述"><br> <mark>第二步：编辑外网的局域文件</mark></p> 
<pre><code>cp -p /etc/named.rfc1912.zones  /etc/named.rfc1912.outer.zones
vim /etc/named.rfc1912.outer.zones
</code></pre> 
<p><img src="https://images2.imgbox.com/a7/83/xZXt7V91_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cf/90/nTOb7dfT_o.png" alt="在这里插入图片描述"><br> 在里面写入<br> <img src="https://images2.imgbox.com/50/c0/r38MCAXJ_o.png" alt="在这里插入图片描述"></p> 
<p><mark>第三步：编辑主配置文件</mark></p> 
<pre><code>vim /etc/named.conf
</code></pre> 
<p><img src="https://images2.imgbox.com/22/39/4MLi392e_o.png" alt="在这里插入图片描述"><br> 在里面将如图所示的代码注释掉（让原本的域名解析部署失效）</p> 
<p><img src="https://images2.imgbox.com/6c/4a/VHSNqvdB_o.png" alt="在这里插入图片描述"><br> 在里面添加以下如图内容<br> <img src="https://images2.imgbox.com/26/23/SRTjD7ZJ_o.png" alt="在这里插入图片描述"></p> 
<p><mark>第四步：重启服务</mark></p> 
<p><img src="https://images2.imgbox.com/1f/19/gJ0eQt9F_o.png" alt="在这里插入图片描述"></p> 
<p><mark>测试</mark>：</p> 
<p>在本机上dig域名，查询到的是172.25.254网段的<br> <img src="https://images2.imgbox.com/38/a3/EQZmwF2a_o.png" alt="在这里插入图片描述"><br> 在别的主机上dig域名，查询到的是1.1.1网段的</p> 
<p><img src="https://images2.imgbox.com/3d/42/RPpcWcKA_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a807e186891ec2c6bab9cdb2379b3483/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">信用评分卡（A卡/B卡/C卡）的模型简介及开发流程｜干货</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/de29cd78280b2a579e3cc88f76df61f9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">css怎么设置页面缩放最小宽度</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>