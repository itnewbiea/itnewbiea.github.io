<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Oracle数据库备份还原——物理备份 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Oracle数据库备份还原——物理备份" />
<meta property="og:description" content="文章目录 冷备份 异机恢复操作案例备份异机恢复 当一个阶段性系统使用完后，需要备份完全的数据库，此时使用冷备份再合适不过了。冷备份需要知道源机与目标机Oracle安装位置和文件系统位置，是一种非常快速的备份方法。源Oracle和目标Oracle版本需要一致。 冷备份 1、 冷备份发生在数据库已经正常关闭的情况下
2、冷备份所需备份的文件包括以下几种：
所有数据文件（datefile）、所有控制文件（controlfile）、所有联机REDO LOG 文件（logfile）、密码文件
3、冷备份的步骤
①正常关闭要备份的实例（instance）
②拷贝物理文件到指定备份路径或设备。
③完成备份后启动数据库
异机恢复 背景：目标机已安装数据库，且未创建同名实例
1、在目标机上的oradata目录下建立orcl文件夹，拷贝源机的所有data文件和联机redo文件到此目录下。
2、在目标机上的admin目录下建立orcl文件夹，然后在orcl里面再建立adump、bdump、cdump、udump、dpdump、pfile六个文件夹。
3、使用oradim命令在cmd下oradim -new -sid orcl 表示建立一个服务，sid为orcl（最好名字和源机备份的数据库名字一致，就不需要重建密码文件）。
4、拷贝源机的pfile到目标机的一个目录下，修改pfile里面相关文件的路径，然后通过SQL&gt;create spfile from pfile=‘文件路径’来创建参数文件。
5、重建控制文件。
6、用net configuration为orcl实例新建监听。
7、还原临时工作空间文件。
操作案例 冷备份数据必须是数据库不在open状态下。以Windows环境下oracle11gR2为例，备份恢复orcl实例。
备份 备份脚本如下：
spool D:/Other-shore/oradata/lengbei/bf.sql select &#39;COPY &#34;&#39;||name||&#39;&#34; &#34;D:/Other-shore/oradata/lengbei&#34;&#39; from v$controlfile union all select &#39;COPY &#34;&#39;||name||&#39;&#34; &#34;D:/Other-shore/oradata/lengbei&#34;&#39; from v$datafile union all select &#39;COPY &#34;&#39;||member||&#39;&#34; &#34;D:/Other-shore/oradata/lengbei&#34;&#39; from v$logfile / create pfile=&#39;D:/Other-shore/oradata/lengbei/initorcl.ora&#39; from spfile; alter database backup controlfile to trace as &#39;D:/Other-shore/oradata/lengbei/databasectl." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e2d6b76d922cb465e84d6a873f93b358/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-17T12:03:44+08:00" />
<meta property="article:modified_time" content="2020-12-17T12:03:44+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Oracle数据库备份还原——物理备份</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#font_colorblue_font_2" rel="nofollow"><font color="blue">冷备份 </font></a></li><li><a href="#font_colororaclefont_11" rel="nofollow"><font color="oracle">异机恢复</font></a></li><li><a href="#font_colororange_21" rel="nofollow"><font color="orange">操作案例</font></a></li><li><ul><li><a href="#_23" rel="nofollow">备份</a></li><li><a href="#_62" rel="nofollow">异机恢复</a></li></ul> 
 </li></ul> 
</div> 
<br> 当一个阶段性系统使用完后，需要备份完全的数据库，此时使用冷备份再合适不过了。冷备份需要知道源机与目标机Oracle安装位置和文件系统位置，是一种非常快速的备份方法。源Oracle和目标Oracle版本需要一致。 
<p></p> 
<h2><a id="font_colorblue_font_2"></a><font color="blue">冷备份 </font></h2> 
<p>1、 冷备份发生在数据库已经正常关闭的情况下<br> 2、冷备份所需备份的文件包括以下几种：<br> 所有数据文件（datefile）、所有控制文件（controlfile）、所有联机REDO LOG 文件（logfile）、密码文件<br> 3、冷备份的步骤<br> ①正常关闭要备份的实例（instance）<br> ②拷贝物理文件到指定备份路径或设备。<br> ③完成备份后启动数据库</p> 
<h2><a id="font_colororaclefont_11"></a><font color="oracle">异机恢复</font></h2> 
<p>背景：目标机已安装数据库，且未创建同名实例<br> 1、在目标机上的oradata目录下建立orcl文件夹，拷贝源机的所有data文件和联机redo文件到此目录下。<br> 2、在目标机上的admin目录下建立orcl文件夹，然后在orcl里面再建立adump、bdump、cdump、udump、dpdump、pfile六个文件夹。<br> 3、使用oradim命令在cmd下oradim -new -sid orcl 表示建立一个服务，sid为orcl（最好名字和源机备份的数据库名字一致，就不需要重建密码文件）。<br> 4、拷贝源机的pfile到目标机的一个目录下，修改pfile里面相关文件的路径，然后通过SQL&gt;create spfile from pfile=‘文件路径’来创建参数文件。<br> 5、重建控制文件。<br> 6、用net configuration为orcl实例新建监听。<br> 7、还原临时工作空间文件。</p> 
<h2><a id="font_colororange_21"></a><font color="orange">操作案例</font></h2> 
<p>冷备份数据必须是数据库不在open状态下。以Windows环境下oracle11gR2为例，备份恢复orcl实例。</p> 
<h3><a id="_23"></a>备份</h3> 
<p>备份脚本如下：</p> 
<pre><code class="prism language-bash">spool D:/Other-shore/oradata/lengbei/bf.sql
<span class="token keyword">select</span> <span class="token string">'COPY "'</span><span class="token operator">||</span>name<span class="token operator">||</span><span class="token string">'" "D:/Other-shore/oradata/lengbei"'</span> from <span class="token function">v</span><span class="token variable">$controlfile</span>
union all
<span class="token keyword">select</span> <span class="token string">'COPY "'</span><span class="token operator">||</span>name<span class="token operator">||</span><span class="token string">'" "D:/Other-shore/oradata/lengbei"'</span> from <span class="token function">v</span><span class="token variable">$datafile</span>
union all
<span class="token keyword">select</span> <span class="token string">'COPY "'</span><span class="token operator">||</span>member<span class="token operator">||</span><span class="token string">'" "D:/Other-shore/oradata/lengbei"'</span> from <span class="token function">v</span><span class="token variable">$logfile</span>
/
create pfile<span class="token operator">=</span><span class="token string">'D:/Other-shore/oradata/lengbei/initorcl.ora'</span> from spfile<span class="token punctuation">;</span>
alter database backup controlfile to trace as <span class="token string">'D:/Other-shore/oradata/lengbei/databasectl.txt'</span><span class="token punctuation">;</span>
spool off
</code></pre> 
<p>Step1、在命令行窗口中(cmd)页面执行</p> 
<pre><code class="prism language-bash">c:\<span class="token operator">&gt;</span>set ORACLE_SID<span class="token operator">=</span>orcl
c:\<span class="token operator">&gt;</span>sqlplus/nolog
SQL<span class="token operator">&gt;</span> conn sys/sys as sysdba
SQL<span class="token operator">&gt;</span>   //运行备份脚本
SQL<span class="token operator">&gt;</span>shutdown immediate<span class="token punctuation">;</span>
</code></pre> 
<p>Step2、执行完备份脚本后，产生如下图文件：<br> <img src="https://images2.imgbox.com/2b/1d/EhJRASyF_o.png" alt="在这里插入图片描述"></p> 
<p>打开参数文件，拷贝如图框内文件到指定备份路径：<br> <img src="https://images2.imgbox.com/99/e5/sNlNRcbS_o.png" alt="在这里插入图片描述"></p> 
<p>打开重建控制文件，拷贝如图框内文件到指定备份路径：<br> <img src="https://images2.imgbox.com/76/bb/oA5Gj30k_o.png" alt="在这里插入图片描述"></p> 
<p>Step3、找到密码文件备份到指定备份路径。密码文件在数据库安装位置的database文件夹下。本机位置E:\app\product\11.2.0\dbhome_1\database\PWDorcl.ora。<br> <img src="https://images2.imgbox.com/df/27/nBciQioy_o.png" alt="在这里插入图片描述"></p> 
<p>Step4、启动源机数据库实例startup<br> 至此冷备份完成，下图是冷备份所需要的所有物理文件：<br> <img src="https://images2.imgbox.com/67/d1/UZb0sIQp_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_62"></a>异机恢复</h3> 
<p>不创建实例：（源机上的数据库名字为orcl）<br> Step1、拷贝冷备份文件到目标机上</p> 
<p>Step2、在目标机的数据库文件系统位置oradata目录下建立orcl文件夹，将备份文件中所有data文件和联机redo文件到此目录下。(C:\app\oradata)</p> 
<p>Step3、在目标机的数据库安装位置下(C:\app)<br> ①将flash_recovery_area文件夹中对应的orcl文件备份过去<br> ②将密码文件拷贝到database目录下<br> ③admin目录下建立orcl文件夹，然后在orcl里面再建立adump、bdump、cdump、udump、dpdump、pfile六个文件夹。</p> 
<p>Step4、更改参数文件pfile里面框内路径为目标机路径：<br> <img src="https://images2.imgbox.com/b4/f3/kxblsf0V_o.png" alt="在这里插入图片描述"></p> 
<p>Step5、打开重建控制文件，找到下图一段文本，修改框内相应路径后保存为:createctl.sql文件（sql脚本文件）。<br> <img src="https://images2.imgbox.com/07/8c/fC6zfEYB_o.png" alt="在这里插入图片描述"></p> 
<p>Step6、在命令窗口中，使用oradim命令oradim -new -sid orcl 表示建立一个服务，sid为orcl（最好名字和源机备份的数据库名字一致，就不需要重建密码文件）<br> <font color="green">新建一个实例服务：oradim -new -sid orcl<br> 删除一个实例服务：oradim -delete -sid orcl</font></p> 
<p>Step7、在命令行窗口中(cmd)页面执行</p> 
<pre><code class="prism language-bash">c:\<span class="token operator">&gt;</span>oradim -new -sid orcl
c:\<span class="token operator">&gt;</span>set ORACLE_SID<span class="token operator">=</span>orcl
c:\<span class="token operator">&gt;</span>sqlplus/nolog
SQL<span class="token operator">&gt;</span> conn / as sysdba
SQL<span class="token operator">&gt;</span>create spfile from pfile<span class="token operator">=</span><span class="token string">'c:\initorcl.ora'</span><span class="token punctuation">;</span>
SQL<span class="token operator">&gt;</span>@c:\createctl.sql<span class="token punctuation">;</span>
SQL<span class="token operator">&gt;</span>shutdown immediate<span class="token punctuation">;</span>
SQL<span class="token operator">&gt;</span>startup<span class="token punctuation">;</span>
SQL<span class="token operator">&gt;</span>alter database <span class="token function">open</span> resetlogs<span class="token punctuation">;</span>
</code></pre> 
<p>执行期间遇到如下报错：<br> <font color="red">ORA-12560:</font>TNS协议适配器错误<br> 原因：ORACLE的数据库服务没有启动。使用命令net start ORACLESERVICEORADB(ORADB为数据库名字)。</p> 
<p><font color="red">SP2-XXX:</font>原因：存在空行。去除文件中空行就可</p> 
<p>Step8、完成上述步骤后已经可以在命令窗口中连接数据库了。接下来用net configuration为orcl实例新建监听</p> 
<p>Step9、为保证数据库正常运行，需要将控制文件里的临时工作空间建立一下。<br> 重建控制文件脚本中会自动附加创建临时表空间的语句,如下图所示：<br> <img src="https://images2.imgbox.com/5c/68/sLaYM1xR_o.png" alt="在这里插入图片描述"></p> 
<p>连接数库后执行下面语句：</p> 
<pre><code class="prism language-sql"><span class="token keyword">ALTER</span> <span class="token keyword">TABLESPACE</span> <span class="token keyword">TEMP</span> <span class="token keyword">ADD</span> TEMPFILE <span class="token string">'D:\APP\ORADATA\ORCL\TEMP01.DBF'</span>
     SIZE <span class="token number">84934656</span>  REUSE AUTOEXTEND <span class="token keyword">ON</span> <span class="token keyword">NEXT</span> <span class="token number">655360</span>  MAXSIZE <span class="token number">32767</span>M<span class="token punctuation">;</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLESPACE</span> TEMP_SDTP <span class="token keyword">ADD</span> TEMPFILE <span class="token string">'D:\OTHER-SHORE\ORADATA\TEMP_SD.DBF'</span>
     SIZE <span class="token number">10</span>M REUSE AUTOEXTEND <span class="token keyword">ON</span> <span class="token keyword">NEXT</span> <span class="token number">10</span>M MAXSIZE <span class="token number">32767</span>M<span class="token punctuation">;</span>
</code></pre> 
<p align="right">常记溪亭日暮，沉醉不知归路。——李清照《如梦令·常记溪亭日暮》</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/73399248f8b04691f10dc80356af6b03/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java的封装——小白篇(11)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/35dd7822b38e42ec3ff88f59c6276c90/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java计算数据的百分比</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>