<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>应用后台省电秘籍——低功耗状态下应用如何正常运行？ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="应用后台省电秘籍——低功耗状态下应用如何正常运行？" />
<meta property="og:description" content="应用退居后台，如何在低功耗的情况下保证任务正常运行？本文华为软件功耗专家黄文将分享议题——应用后台功耗经验。
本文将从安卓绿色联盟功耗标准2.0、谷歌后台功耗方案、华为后台功耗方案以及开发者资源使用建议和检测工具五大方面进行全面讲解。
安卓绿色联盟功耗标准2.0 《安卓绿色联盟应用体验标准2.0---功耗标准》详细介绍了应用后台软资源和硬资源的使用标准，查看详情请访问安卓绿色联盟官网。
谷歌后台功耗方案 谷歌从Android M开始着力改善终端的续航表现。Android版本在演进中主要提供如下几个方案。
1.后台位置限制:
对后台应用获取用户当前位置的频率进行限制。
相关链接：https://developer.android.goo...
2.后台服务限制:
限制应用在后台运行服务，并禁止应用通过隐藏/不可见方式调用 CPU 或网络资源。
相关链接：https://developer.android.goo...
3.后台限制:
当系统检测到应用出现不良行为时，系统会向用户询问是否要限制该应用在后台访问设备资源。
相关链接：https://developer.android.goo...
4.谷歌后台功耗方案-Doze（低耗电模式和应用待机模式）
谷歌在Android M版本引入了Doze方案，此方案主要针对后台应用在没有活动的情况下做某些限制。设备未充电且屏幕关闭处于空闲状态一段时间后，系统会进入低耗电或者应用待机模式，对应用行为施加相应限制。
相关链接：https://developer.android.goo...
如图所示，以下是Doze模式各状态说明：
ACTIVE: 设备活动态
INACTIVE:设备不活跃(灭屏、不运动) 等待进入idle.
IDLE_PENDING: 设备准备进入下一阶段
SENSING: 传感器检测设备是否运动
LOCATING: 设备位置变化.
IDLE: 设备进入idle，并尽量长时间保持该状态
IDLE_MAINTENANCE: 退出idle进入“维护期”
谷歌还引入了Light-Doze(Android N)和Deep-Doze(Android M)的概念，具体内容如下：
5.应用待机群组
应用待机群组对应用进行分组管理，不同的分组享有不同的权限设置，杜绝了对应用一刀切的现象。
相关链接：https://developer.android.goo...
应用待机分组：
1）活跃 (Active): 应用正在被使用
2）工作 (Working set): 应用使用频率很高
3）常用 (Frequent): 应用经常但不是每天被使用
4）极少 (Rare): 应用偶尔被使用
5）从不（Never）：安装后一次都未被使用过的应用
分组策略：
调试：
通过adb命令将应用手动划分至某一待机群组。输入以下命令，更改群组：
$ adb shell am set-standby-bucket packagename active/working_set/frequent/rare
输入以下命令，查看应用所处群组：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/77c4aa6aec640fd2b067e9ee6359d0c4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-02-19T09:50:36+08:00" />
<meta property="article:modified_time" content="2019-02-19T09:50:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">应用后台省电秘籍——低功耗状态下应用如何正常运行？</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="article fmt article__content"> 
 <p>应用退居后台，如何在低功耗的情况下保证任务正常运行？本文华为软件功耗专家黄文将分享议题——应用后台功耗经验。</p> 
 <p>本文将从安卓绿色联盟功耗标准2.0、谷歌后台功耗方案、华为后台功耗方案以及开发者资源使用建议和检测工具五大方面进行全面讲解。</p> 
 <h5>安卓绿色联盟功耗标准2.0</h5> 
 <p>《安卓绿色联盟应用体验标准2.0---功耗标准》详细介绍了应用后台软资源和硬资源的使用标准，查看详情请访问安卓绿色联盟官网。</p> 
 <h5>谷歌后台功耗方案</h5> 
 <p>谷歌从Android M开始着力改善终端的续航表现。Android版本在演进中主要提供如下几个方案。</p> 
 <p><strong>1.后台位置限制:</strong></p> 
 <p>对后台应用获取用户当前位置的频率进行限制。</p> 
 <p>相关链接：<a href="https://developer.android.google.cn/about/versions/oreo/background-location-limits" rel="nofollow">https://developer.android.goo...</a></p> 
 <p><strong>2.后台服务限制:</strong></p> 
 <p>限制应用在后台运行服务，并禁止应用通过隐藏/不可见方式调用 CPU 或网络资源。</p> 
 <p>相关链接：<a href="https://developer.android.google.cn/about/versions/oreo/background#services" rel="nofollow">https://developer.android.goo...</a></p> 
 <p><strong>3.后台限制:</strong></p> 
 <p>当系统检测到应用出现不良行为时，系统会向用户询问是否要限制该应用在后台访问设备资源。</p> 
 <p>相关链接：<a href="https://developer.android.google.cn/topic/performance/background-optimization#bg-restrict" rel="nofollow">https://developer.android.goo...</a></p> 
 <p><strong>4.谷歌后台功耗方案-Doze（低耗电模式和应用待机模式）</strong></p> 
 <p>谷歌在Android M版本引入了Doze方案，此方案主要针对后台应用在没有活动的情况下做某些限制。设备未充电且屏幕关闭处于空闲状态一段时间后，系统会进入低耗电或者应用待机模式，对应用行为施加相应限制。</p> 
 <p>相关链接：<a href="https://developer.android.google.cn/about/versions/marshmallow/android-6.0-changes#behavior-power" rel="nofollow">https://developer.android.goo...</a></p> 
 <p><span class="img-wrap"><img src="https://images2.imgbox.com/19/45/de5SBwmf_o.jpg" alt="image" title="image"></span></p> 
 <p>如图所示，以下是Doze模式各状态说明：</p> 
 <p>ACTIVE: 设备活动态</p> 
 <p>INACTIVE:设备不活跃(灭屏、不运动) 等待进入idle.</p> 
 <p>IDLE_PENDING: 设备准备进入下一阶段</p> 
 <p>SENSING: 传感器检测设备是否运动</p> 
 <p>LOCATING: 设备位置变化.</p> 
 <p>IDLE: 设备进入idle，并尽量长时间保持该状态</p> 
 <p>IDLE_MAINTENANCE: 退出idle进入“维护期”</p> 
 <p>谷歌还引入了Light-Doze(Android N)和Deep-Doze(Android M)的概念，具体内容如下：</p> 
 <p><span class="img-wrap"><img src="https://images2.imgbox.com/ce/ff/jY9Z18Jf_o.jpg" alt="image" title="image"></span></p> 
 <p><strong>5.应用待机群组</strong></p> 
 <p>应用待机群组对应用进行分组管理，不同的分组享有不同的权限设置，杜绝了对应用一刀切的现象。</p> 
 <p>相关链接：<a href="https://developer.android.google.cn/preview/features/power#buckets" rel="nofollow">https://developer.android.goo...</a></p> 
 <p>应用待机分组：</p> 
 <p>1）活跃 (Active): 应用正在被使用</p> 
 <p>2）工作 (Working set): 应用使用频率很高</p> 
 <p>3）常用 (Frequent): 应用经常但不是每天被使用</p> 
 <p>4）极少 (Rare): 应用偶尔被使用</p> 
 <p>5）从不（Never）：安装后一次都未被使用过的应用</p> 
 <p>分组策略：</p> 
 <p><span class="img-wrap"><img src="https://images2.imgbox.com/cc/6b/QdXKoUOY_o.jpg" alt="image" title="image"></span></p> 
 <p>调试：</p> 
 <p>通过adb命令将应用手动划分至某一待机群组。输入以下命令，更改群组：</p> 
 <p>$ adb shell am set-standby-bucket packagename active/working_set/frequent/rare</p> 
 <p>输入以下命令，查看应用所处群组：</p> 
 <p>$ adb shell am get-standby-bucket [packagename]</p> 
 <p>为促进用户体验，谷歌对应用在后台状态下的建议如下：</p> 
 <p><span class="img-wrap"><img src="https://images2.imgbox.com/51/05/yLRtp1N6_o.jpg" alt="image" title="image"></span></p> 
 <h5>华为后台功耗方案</h5> 
 <p>1.华为的功耗方案，主要是在谷歌的基础上对应用的异常行为进行监控，通过智电机器人，识别后台应用的行为是正常耗电还是异常耗电。</p> 
 <p>2.华为的优化分为主动优化和异常防护。</p> 
 <p>主动优化在谷歌运行方案的基础上增加了冷冻方案，应用退到后台后，在没有用户可感知状态和活动下，将应用所占用的资源包括CPU、软硬件资源等全部暂停。一旦应用需要运行，资源会启动恢复流程，这就是主动优化。</p> 
 <p>华为的盾防系统会监控所有后台资源消耗情况，在用户未感知的情况下，一旦资源消耗超过华为功耗红线标准，便会发出高耗电提醒，这就是华为的异常防护。</p> 
 <p>具体红线标准请参考《安卓绿色联盟应用体验标准2.0---功耗标准》，标准包括持锁阻止系统休眠、alarm频繁唤醒系统、后台CPU高负载耗电、长时间网络定位等。</p> 
 <p>3.华为低功耗Power kit包括PUSH+NC和Bastet链路托管技术。</p> 
 <p>应用推送远程通知，可以使用华为PUSH NC。</p> 
 <p>相关链接：</p> 
 <p><a href="https://developer.huawei.com/consumer/cn/service/hms/pushservice.html" rel="nofollow">https://developer.huawei.com/...</a></p> 
 <p>应用保持长链接，可以接入华为链路托管技术Bastet.</p> 
 <p>相关链接：</p> 
 <p><a href="https://developer.huawei.com/consumer/cn/devservice/doc/30401" rel="nofollow">https://developer.huawei.com/...</a></p> 
 <h5>开发者资源使用建议</h5> 
 <p><strong>1.定时任务</strong></p> 
 <p>推荐绿色机制：</p> 
 <ul><li>本地高频任务，建议使用Handler机制；</li><li>本地低频定时任务，建议使用AlarmManager的set()和setInexactRepeating()方法分别处理单次和循环多次的调用；</li><li>特定条件（网络、充电），可延迟定时任务，推荐JobScheduler/WorkManager。</li></ul> 
 <p><strong>2．网络</strong></p> 
 <p>推荐绿色机制：</p> 
 <ul><li>避免频繁、零散的网络请求，推荐统一批量网络请求；</li><li>避免在低电量、弱网络、移动网络执行过多的网络请求，在充电、wifi网络下进行大数据量请求；</li><li>应用离开界面或进入后台及时关闭不再使用的TCP链接，避免出现大量未关闭状态TCP链接。</li></ul> 
 <p><span class="img-wrap"><img src="https://images2.imgbox.com/98/5a/clEbRP24_o.jpg" alt="image" title="image"></span></p> 
 <p><span class="img-wrap"><img src="https://images2.imgbox.com/aa/10/IdbiDd55_o.jpg" alt="image" title="image"></span></p> 
 <p><strong>3．Wakelock</strong></p> 
 <p>推荐绿色机制：</p> 
 <ul><li>确保唤醒锁不再需要时立即释放；</li><li>申请和释放必须成对出现；</li><li>推荐使用超时锁acquire(timeout)，提前结束后主动释放超时锁。</li></ul> 
 <h5>资源使用检测工具</h5> 
 <p>1.Battery Historian</p> 
 <p>相关链接：<a href="https://developer.android.google.cn/topic/performance/power/battery-historian" rel="nofollow">https://developer.android.goo...</a></p> 
 <ol><li>AT&amp;T Application Resource Optimizer</li></ol> 
 <p>擅长于网络跟踪</p> 
 <p>相关链接：</p> 
 <p><a href="https://developer.att.com/application-resource-optimizer" rel="nofollow">https://developer.att.com/app...</a></p> 
 <ol><li>Android vitals</li></ol> 
 <p>对过度唤醒、wifi扫描、网络使用、长时间持唤醒锁、进行监控，并输出报告</p> 
 <p>相关链接：<a href="https://developer.android.google.cn/topic/performance/vitals/" rel="nofollow">https://developer.android.goo...</a></p> 
 <h5>总结</h5> 
 <p>为保证应用在低功耗的情况下能够正常的运行任务，建议使用如下方案：</p> 
 <p>1.研发阶段:</p> 
 <p>1)推送远程通知消息，需使用FCM或华为PUSH NC。</p> 
 <p>2)保持长链接心跳，需使用华为Modem链路托管技术（华为Bastet）</p> 
 <p>3)用户触发的后台业务，需使用前台服务+常驻通知。</p> 
 <ul><li>后台下载、播放音乐、录音、导航、计步、骑行记录轨迹、同步照片等。</li><li>让用户能够感知到（可见、可听），包括声音、通知栏、widget提示等。</li></ul> 
 <p>4)非用户触发可推迟的任务，需使用JobScheduler/WorkManager。</p> 
 <ul><li>需在充电、Wifi环境、Doze窗口期进行。</li><li>禁止在低电量（&lt;30%）、省电模式、长待机（灭屏超过30min）、夜间（0:00~6:00）进行。</li></ul> 
 <p>5)合理使用Alarm，Wakelock，Network，GPS等软硬资源。</p> 
 <ul><li>统一使用，避免频繁使用。</li><li>按需使用，及时释放。</li></ul> 
 <p>2.测试验收：</p> 
 <p>借助工具，使用battery-historian、 ARO、Android vitals分析运行时和长待机情况。</p> 
 <p>3.禁止行为：</p> 
 <p>恶意保活，包括无声播放、一像素界面、低流量下载等。</p> 
 <p>关注安卓绿色联盟公众号，回复“2304”获取PPT</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1151353baf3943dab27ba97edfc05aea/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Loadrunner基础1-----解决loadrunner录制脚本为空的方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/42f0f03c80b9e0342625db0d4476c7fc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android程序员的年终总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>