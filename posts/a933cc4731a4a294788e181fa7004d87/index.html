<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何应用Python助你在股票中获利？ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何应用Python助你在股票中获利？" />
<meta property="og:description" content="学习如何利用Python创建模型,以根据财务报表计算股票的公允价值。
扫码关注《Python学研大本营》，加入读者群，分享更多精彩
股票市场中需要低买高卖的投资策略，必须以合理的价格购买投资，这意味着以公允价值购买。但是如何计算股票的公允价值或内在价值呢？
有几种方法可以考虑，具体来说：
一种方法是公允价值是未来自由现金流的现值。
另一种方式是，公允价值是可以支付并产生所需回报率的价格。
第三种方式是，公允价值是在当前倍数下包含财务未来增长的价格。
当然，他们都假设分析和模型是正确的。随着央行利率政策正常化和投资回归基本面，这些方法越来越多地重新成为主流。
在本文中，我们将根据来自公司季度损益表和资产负债表的财务指标数据创建三种不同的模型。使用收益、自由现金流、收入、相应的增长和出色的股票作为模型的输入。这实际上进入了第三个假设，其中公允价值是在给定当前倍数的情况下包含未来增长的价格。
对于高质量的基本面数据，使用EOD的 API，对于价格数据，使用 yfinance。
项目特点 下载给定公司的基本面数据（资产负债表、损益表、现金流量表）。
计算财务指标模型的输入。
将输入插入每个模型并估计公司的公平价格。
可视化股票的价格序列并将市场价格与公允价格进行比较。
需要准备以下内容： Python：安装 3.9.7 版本。
Jupyter Notebook：为操作系统安装 Anaconda的个人版本，确保已经安装了 Jupyter。
EOD API 密钥：按照此处的说明进行操作。
一旦设置好了，就可以继续执行了。
开始 让我们加载整个项目所需的包并启动我们以后需要的变量。
包是一组结构化函数，可以导入到我们的 Python 解释器中，然后我们可以从中调用和使用它们。
import matplotlib.pyplot as plt import requests import pandas as pd from datetime import * import numpy as np import json import urllib.request import yfinance as yf import warnings warnings.filterwarnings(&#39;ignore&#39;) EOD_API_KEY = &#39;your-api-key&#39; SYMBOL = &#39;FVRR.US&#39; 我为这个演示选择了 Fiverr 股票 (FVRR)，因为喜欢这家公司，而且我认为评估其当前的公平价格和潜在的未来增长有点困难，所以这仍然是一个有趣的练习。但是，最终会将整个代码组合成一个函数，该函数可以对指定给它的任何股票进行此评估！" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a933cc4731a4a294788e181fa7004d87/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-06T05:22:23+08:00" />
<meta property="article:modified_time" content="2022-09-06T05:22:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何应用Python助你在股票中获利？</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>学习如何利用Python创建模型,以根据财务报表计算股票的公允价值。</p> 
</blockquote> 
<p>扫码关注《Python学研大本营》，加入读者群，分享更多精彩</p> 
<p>股票市场中需要低买高卖的投资策略，必须以合理的价格购买投资，这意味着以公允价值购买。但是如何计算股票的公允价值或内在价值呢？</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d0/3c/y8D6J9ba_o.png"></p> 
<p>有几种方法可以考虑，具体来说：</p> 
<ul><li> <p>一种方法是公允价值是未来自由现金流的现值。</p> </li><li> <p>另一种方式是，公允价值是可以支付并产生所需回报率的价格。</p> </li><li> <p>第三种方式是，公允价值是在当前倍数下包含财务未来增长的价格。</p> </li></ul> 
<p>当然，他们都假设分析和模型是正确的。随着央行利率政策正常化和投资回归基本面，这些方法越来越多地重新成为主流。</p> 
<p>在本文中，我们将根据来自公司季度损益表和资产负债表的财务指标数据创建三种不同的模型。使用收益、自由现金流、收入、相应的增长和出色的股票作为模型的输入。这实际上进入了第三个假设，其中公允价值是在给定当前倍数的情况下包含未来增长的价格。</p> 
<p>对于高质量的基本面数据，使用EOD的 API，对于价格数据，使用 yfinance。</p> 
<h3>项目特点</h3> 
<ul><li> <p>下载给定公司的基本面数据（资产负债表、损益表、现金流量表）。</p> </li><li> <p>计算财务指标模型的输入。</p> </li><li> <p>将输入插入每个模型并估计公司的公平价格。</p> </li><li> <p>可视化股票的价格序列并将市场价格与公允价格进行比较。</p> </li></ul> 
<h3>需要准备以下内容：</h3> 
<ul><li> <p>Python：安装 3.9.7 版本。</p> </li><li> <p>Jupyter Notebook：为操作系统安装 Anaconda的个人版本，确保已经安装了 Jupyter。</p> </li><li> <p>EOD API 密钥：按照此处的说明进行操作。</p> </li></ul> 
<p>一旦设置好了，就可以继续执行了。</p> 
<h3>开始</h3> 
<p>让我们加载整个项目所需的包并启动我们以后需要的变量。</p> 
<blockquote> 
 <p>包是一组结构化函数，可以导入到我们的 Python 解释器中，然后我们可以从中调用和使用它们。</p> 
</blockquote> 
<pre><code>import matplotlib.pyplot as plt
import requests
import pandas as pd
from datetime import *
import numpy as np
import json
import urllib.request
import yfinance as yf
import warnings
warnings.filterwarnings('ignore')

EOD_API_KEY = 'your-api-key'

SYMBOL = 'FVRR.US'
</code></pre> 
<p>我为这个演示选择了 Fiverr 股票 (FVRR)，因为喜欢这家公司，而且我认为评估其当前的公平价格和潜在的未来增长有点困难，所以这仍然是一个有趣的练习。但是，最终会将整个代码组合成一个函数，该函数可以对指定给它的任何股票进行此评估！</p> 
<p>现在，在导入了所有需要的包之后，让我们从定义将使用的函数开始。</p> 
<h3>1. 下载给定公司的基本面数据</h3> 
<pre><code>def get_data(symbol):
    url = f'https://eodhistoricaldata.com/api/fundamentals/{symbol}?api_token={EOD_API_KEY}'
    response = urllib.request.urlopen(url)
    data = json.loads(response.read())
    return data
    
    data = get_data(symbol=SYMBOL)
    
    print(data.keys())
</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/39/be/TLlRdFr5_o.png"></p> 
<p>对于给定的股票，可以获得相当多的数据，但是对于公式，将使用“财务”、“收益”和“杰出股票”。</p> 
<h3>2. 基于自由现金流的估值</h3> 
<p>𝐹𝑉(𝑓𝑐𝑓)=𝑓𝑐𝑓p𝑠∗(1+𝑓𝑐𝑓𝑔𝑟𝑜𝑤𝑡ℎ)∗(𝑝𝑟𝑖𝑐𝑒/𝑓𝑐𝑓p𝑠)</p> 
<pre><code>`fcf = pd.DataFrame(data['Financials']['Cash_Flow']['quarterly']).T.sort_index()['freeCashFlow'].astype(float)[-1]

fcf_growth = pd.DataFrame(data['Financials']['Cash_Flow']['quarterly']).T.sort_index()\
                              ['freeCashFlow'].astype(float).pct_change().rolling(20).mean()[-1]

shares_outs = round(pd.DataFrame(data['outstandingShares']['quarterly']).T.set_index('dateFormatted')\
                                                 .sort_index()['shares'].astype(float)[-1],0)

price = yf.download(SYMBOL.split('.')[0], date.today()-pd.DateOffset(5), date.today())['Adj Close'][-1]

fcf_per_share = fcf/shares_outs

print(f'fcf_fair_value: {fcf_per_share*(1+fcf_growth)*(price/fcf_per_share)}')``

</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a1/b9/v11BmnWW_o.png"></p> 
<p>对于基于自由现金流的估值，使用最新的季度自由现金流<code>fcf</code>，然后使用过去20个季度的平均季度自由现金流变化作为预期指标<code>fcf_growth</code>，然后使用流通股<code>shares_outs</code>和最新价格。至于<code>price</code>计算每股自由现金流量和最终公式。</p> 
<h3>3. 基于收入/销售的估值</h3> 
<p><strong>𝐹𝑉(𝑠𝑎𝑙𝑒𝑠)=𝑠𝑝𝑠∗(1+𝑠𝑎𝑙𝑒𝑠𝑔𝑟𝑜𝑤𝑡ℎ)∗(𝑝𝑟𝑖𝑐𝑒/𝑠𝑝𝑠)</strong></p> 
<pre><code>sales = pd.DataFrame(data['Financials']['Income_Statement']['quarterly']).T.sort_index()\
                            ['totalRevenue'].astype(float)[-1]
    
sales_growth = pd.DataFrame(data['Financials']['Income_Statement']['quarterly']).T.sort_index()\
                            ['totalRevenue'].astype(float).pct_change().rolling(20).mean()[-1]

price = yf.download(SYMBOL.split('.')[0], date.today()-pd.DateOffset(5), date.today())['Adj Close'][-1]

shares_outs = round(pd.DataFrame(data['outstandingShares']['quarterly']).T.set_index('dateFormatted')\
                                                 .sort_index()['shares'].astype(float)[-1],0)

sales_per_share = sales/shares_outs

print(f'sps_fair_value: {sales_per_share*(1+sales_growth)*(price/sales_per_share)}')
</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/2d/61/04Ptli6Y_o.png"></p> 
<p>对于基于收入/销售的估值，使用最新的季度总收入作为<code>sales</code>，然后<code>sales_growth</code>使用过去 20 个季度的平均总收入变化，然后再次使用流通股作为<code>shares_outs</code>和最新价格<code>price</code>来计算每分享和最终公式。</p> 
<h3>4. 基于收益的估值</h3> 
<p><strong>𝐹𝑉(𝑝𝑒)=𝑒𝑝𝑠∗(1+𝑒𝑝𝑠𝑔𝑟𝑜𝑤𝑡ℎ)∗𝑝𝑒</strong></p> 
<pre><code>eps = pd.DataFrame(data['Earnings']['Annual']).T.sort_index()['epsActual'][-1]

eps_growth = np.mean(pd.DataFrame(data['Earnings']['Trend']).T.sort_index()\
                                  ['earningsEstimateGrowth'].astype(float).values)

price = yf.download(SYMBOL.split('.')[0], date.today()-pd.DateOffset(5), date.today())['Adj Close'][-1]

pe = price/eps

print(f'pe_fair_value: {eps*(1+eps_growth)*pe}')
</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/af/2e/QNAYSUNT_o.png"></p> 
<p>对于基于收益的估值，使用年收益作为 eps，接下来使用可用的 EarningsEstimatedGrowth 作为 eps_growth，使用最新的股价来计算最新的市盈率和公式。</p> 
<p><strong>在完成所有三个方法之后，现在可以将所有内容放在一个函数中，该函数将交易品种名称作为参数并计算所有三个公允价值并与当前股价进行比较！</strong></p> 
<h3>5. 放在一起</h3> 
<pre><code>import matplotlib.pyplot as plt
import requests
import pandas as pd
from datetime import *
import numpy as np
import json
import urllib.request
import yfinance as yf
import warnings
warnings.filterwarnings('ignore')

EOD_API_KEY = 'your_api_key'

SYMBOL = 'FVRR.US'


def get_data(symbol, api_key):
    url = f'https://eodhistoricaldata.com/api/fundamentals/{symbol}?api_token={EOD_API_KEY}'
    
    response = urllib.request.urlopen(url)
    
    data = json.loads(response.read())
    
    return data


def get_financial_metrics_valuation(data):
    
    eps = pd.DataFrame(data['Earnings']['Annual']).T.sort_index()['epsActual'][-1]

    eps_growth = np.mean(pd.DataFrame(data['Earnings']['Trend']).T.sort_index()['earningsEstimateGrowth'].astype(float).values)
    
    fcf = pd.DataFrame(data['Financials']['Cash_Flow']['quarterly']).T.sort_index()['freeCashFlow'].astype(float)[-1]
    
    fcf_growth = pd.DataFrame(data['Financials']['Cash_Flow']['quarterly']).T.sort_index()\
                              ['freeCashFlow'].astype(float).pct_change().rolling(20).mean()[-1]
    
    sales = pd.DataFrame(data['Financials']['Income_Statement']['quarterly']).T.sort_index()['totalRevenue'].astype(float)[-1]
    
    sales_growth = pd.DataFrame(data['Financials']['Income_Statement']['quarterly']).T.sort_index()\
                                ['totalRevenue'].astype(float).pct_change().rolling(20).mean()[-1]
    
    shares_outs = round(pd.DataFrame(data['outstandingShares']['quarterly']).T.set_index('dateFormatted')\
                                                 .sort_index()['shares'].astype(float)[-1],0)
    
    price = yf.download(SYMBOL.split('.')[0], date.today()-pd.DateOffset(5), date.today())['Adj Close'][-1]

    pe = price/eps
    
    fcf_per_share = fcf/shares_outs
    
    sales_per_share = sales/shares_outs
    
    df = {}
    
    df['pe_intrinsic_value'] = eps*(1+eps_growth)*pe
    
    df['fcf_intrinsic_value'] = fcf_per_share*(1+fcf_growth)*(price/fcf_per_share)
    
    df['sales_intrinsic_value'] = sales_per_share*(1+sales_growth)*(price/sales_per_share)
    
    df['current_price'] = price
    
    return pd.DataFrame(df, index=pd.Series(SYMBOL))


data = get_data(symbol=SYMBOL, api_key=EOD_API_KEY)

fair_values = get_financial_metrics_valuation(data)

fair_values
</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/14/76/M7kpujAg_o.png"></p> 
<p>最终得到了一个易于使用的小脚本，可以使用来自 EOD 的 API 的数据从根本上评估想要的任何股票。从目前的分析中，可以看到 FVRR 的当前价格可能被略微低估了。此外，可以观察到三个模型价格对应的股票价格和绘图线，这样更容易直观地了解股票当前的位置。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/48/e3/AzHMykV6_o.png"></p> 
<h3>最后的想法</h3> 
<p>尽管估值模型被提示假设和错误，但通过一些简单的数学和质量数据，能够估计给定股票的一系列公允价值。这可以很容易地增强我们的投资分析能力，并为我们提供精确的基线或起点！</p> 
<p>但是，建议您在遇到投资分析、交易技术或策略时始终遵循以下步骤：</p> 
<ul><li> <p>对所做的每一个分析都有批判的心态。</p> </li><li> <p>确保已经使用现实生活中的模拟和条件对其进行了回测。</p> </li><li> <p>如果有好的潜力，请通过前瞻测试。</p> </li></ul> 
<p>加油吧！</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b1/4d/2u94vnEO_o.gif"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/47/f8/kROgWCIa_o.png"></p> 
<h3>推荐书单</h3> 
<h4>《Python数据可视化》</h4> 
<p>购买链接： https://item.jd.com/12670073.html</p> 
<p>《Python数据可视化》详细阐述了与Python数据可视化相关的基本解决方案，主要包括数据可视化和数据探索的重要性、绘图知识、Matplotlib、利用Seaborn简化可视化操作、绘制地理空间数据、基于Bokeh的交互式操作等内容。此外，该书还提供了相应的示例、代码，以帮助读者进一步理解相关方案的实现过程。</p> 
<p>《Python数据可视化》适合作为高等院校计算机及相关专业的教材和教学参考书，也可作为相关开发人员的自学教材和参考手册。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/33/fc/ITIXOm7J_o.jpg"></p> 
<blockquote> 
 <blockquote> 
  <h3>精彩回顾</h3> 
  <p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4Mzc3NTM4Ng==&amp;mid=2247484818&amp;idx=1&amp;sn=7803b7b00f5986f1f05f388e66f38bd4&amp;chksm=cf430767f8348e71f3f6b47d662fc7674b9f25604065f85217a822c93eb0a7b738164db70b7c#rd" rel="nofollow" title="可视化案例研究——以智利总统选举为例">可视化案例研究——以智利总统选举为例</a></p> 
  <p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4Mzc3NTM4Ng==&amp;mid=2247484878&amp;idx=1&amp;sn=ed99110ec51e4b8af85660dff0aa0114&amp;chksm=cf43073bf8348e2d8c694650e3595fb79e6d8c201aca5e474462c943dee52cc0672505895d3b#rd" rel="nofollow" title="想用Python赚钱？——安排！">想用Python赚钱？——安排！</a></p> 
  <p><a href="https://mp.weixin.qq.com/s?__biz=Mzg4Mzc3NTM4Ng==&amp;mid=2247485644&amp;idx=1&amp;sn=5da4baa9020c119327297a454d1ae57f&amp;chksm=cf430a39f834832f178434872a30a7619c5b831345f05a4d1445d997809fd780c428553d419f#rd" rel="nofollow" title="【案例】如何使用Flask构建天气预报 ">【案例】如何使用Flask构建天气预报 </a></p> 
 </blockquote> 
</blockquote> 
<blockquote> 
 <blockquote> 
  <p>扫码关注《Python学研大本营》，加入读者群，分享更多精彩</p> 
 </blockquote> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/858e64a0907400614619c8837a8acb0c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">人工神经网络的结构模型,神经网络模型结构图</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/824e8b74a9b38382aef92ff63930a41d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue3项目启动报错 in ./src/App.vue?vue&amp;type=style&amp;index=0&amp;lang=scss解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>