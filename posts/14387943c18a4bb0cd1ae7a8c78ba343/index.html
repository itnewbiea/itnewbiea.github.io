<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>PyVISA使用——用python控制TEK示波器源码实现 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="PyVISA使用——用python控制TEK示波器源码实现" />
<meta property="og:description" content="项目要求 项目上提出自动化测试需求，要求能够对板级信号使用示波器等仪器做自动化测量
实现方案 使用PyVISA 方案实现。
VISA (Virtual Instrument Software Architecture) 是一个用于访问测量仪器和控制计算机之间的接口标准，由美国国家仪器公司（National Instruments）推出，用于实现仪器之间的通信和控制。VISA提供了一组标准API函数，可以实现多种通信协议和连接方式的仪器控制。VISA相比于VXI11更加灵活，支持多种接口（底层协议），比如GPIB，RS232，USB， VXIBus等，对于仪器控制有更强大的功能。
Pyvisa是一个基于Python语言开发的访问VISA资源的工具包。通过调用VISA标准API函数来实现与仪器的通信和控制。Pyvisa提供了一组Python的API函数，可以方便地访问VISA库中的函数和方法，从而实现与仪器的数据读取、写入、控制等操作。Pyvisa相比于LabVIEW，Pyvisa是一种跨平台的软件，可以在Linux，Windows和Mac OS上运行，且其拥有更灵活的用户界面，可以自行定制。
如果该脚本运行在服务器上，建议使用Pycharm Professional 或者VSCode &#43; Remote-SSH 插件进行开发，即本地开发，远程部署或调试。
本例使用SCPI命令访问示波器的VISA库，SCPI命令的格式见示波器软件编程手册
脚本实现功能 （1）连接示波器
注意：电脑并没有使用NI-VISA后台，而是使用纯python代码实现的Pyvisa-py, 因此需要提前安装下 pip install -U pyvisa-py
（2）简单设置示波器参数，包括channal 选择，横轴窗口设置，纵轴电压窗口设置，Trigger触发方式选择
（3）波形数据以csv 和图片格式保存到本地
（4）保存示波器的截图到本地
脚本与注释 import time import pyvisa as visa import numpy as np import matplotlib.pyplot as plt import pandas as pd from datetime import datetime from pyvisa.errors import VisaIOError from PIL import Image # rm = visa." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/14387943c18a4bb0cd1ae7a8c78ba343/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-17T17:29:04+08:00" />
<meta property="article:modified_time" content="2023-04-17T17:29:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">PyVISA使用——用python控制TEK示波器源码实现</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>项目要求</h2> 
<p>项目上提出自动化测试需求，要求能够对板级信号使用示波器等仪器做自动化测量</p> 
<h2><a id="_4"></a>实现方案</h2> 
<p>使用PyVISA 方案实现。<br> VISA (Virtual Instrument Software Architecture) 是一个用于访问测量仪器和控制计算机之间的接口标准，由美国国家仪器公司（National Instruments）推出，用于实现仪器之间的通信和控制。VISA提供了一组标准API函数，可以实现多种通信协议和连接方式的仪器控制。VISA相比于VXI11更加灵活，支持多种接口（底层协议），比如GPIB，RS232，USB， VXIBus等，对于仪器控制有更强大的功能。<img src="https://images2.imgbox.com/7d/12/ScXdHpZs_o.png" alt="在这里插入图片描述"><br> Pyvisa是一个基于Python语言开发的访问VISA资源的工具包。通过调用VISA标准API函数来实现与仪器的通信和控制。Pyvisa提供了一组Python的API函数，可以方便地访问VISA库中的函数和方法，从而实现与仪器的数据读取、写入、控制等操作。Pyvisa相比于LabVIEW，Pyvisa是一种跨平台的软件，可以在Linux，Windows和Mac OS上运行，且其拥有更灵活的用户界面，可以自行定制。</p> 
<p>如果该脚本运行在服务器上，建议使用Pycharm Professional 或者VSCode + Remote-SSH 插件进行开发，即本地开发，远程部署或调试。</p> 
<p>本例使用SCPI命令访问示波器的VISA库，SCPI命令的格式见示波器软件编程手册</p> 
<h2><a id="_13"></a>脚本实现功能</h2> 
<p>（1）连接示波器<br> 注意：电脑并没有使用NI-VISA后台，而是使用纯python代码实现的Pyvisa-py, 因此需要提前安装下 pip install -U pyvisa-py<br> （2）简单设置示波器参数，包括channal 选择，横轴窗口设置，纵轴电压窗口设置，Trigger触发方式选择<br> （3）波形数据以csv 和图片格式保存到本地<br> （4）保存示波器的截图到本地</p> 
<h2><a id="_20"></a>脚本与注释</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> time
<span class="token keyword">import</span> pyvisa <span class="token keyword">as</span> visa
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> datetime <span class="token keyword">import</span> datetime
<span class="token keyword">from</span> pyvisa<span class="token punctuation">.</span>errors <span class="token keyword">import</span> VisaIOError
<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image

<span class="token comment"># rm = visa.ResourceManager('@py')</span>
<span class="token comment"># rm.list_resources()</span>
<span class="token comment"># Tek = rm.open_resource('TCPIPO::10.163.xxx.xxx::INSTR')</span>
<span class="token comment"># Tek.timeout=10000</span>
<span class="token comment"># print(Tek.query('*IDN?'))</span>
<span class="token comment"># self.inst.write('*RST')</span>
<span class="token comment"># self.inst.write('AUTOSET EXECUTE')</span>


<span class="token keyword">class</span> <span class="token class-name">Tektronix_DPO</span><span class="token punctuation">:</span>
        <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>rm <span class="token operator">=</span> visa<span class="token punctuation">.</span>ResourceManager<span class="token punctuation">(</span><span class="token string">'@py'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>rm<span class="token punctuation">.</span>list_resources<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst <span class="token operator">=</span> self<span class="token punctuation">.</span>rm<span class="token punctuation">.</span>open_resource<span class="token punctuation">(</span><span class="token string">'TCPIPO::10.163.xxx.xxx::INSTR'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>timeout<span class="token operator">=</span><span class="token number">10000</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'*IDN?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'CLEAR'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'ACQuire:MODe?'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'ACQUIRE:STOPAFTER RUNSTOP'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'ACQuire:STATE RUN'</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'autoset EXECUTE'</span><span class="token punctuation">)</span> <span class="token comment"># autoset</span>
              
        <span class="token keyword">def</span> <span class="token function">set_HORIZONTAL</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> POSITION<span class="token punctuation">,</span> SCALE<span class="token punctuation">)</span><span class="token punctuation">:</span>         <span class="token comment">#horizontal settings</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'HORIZONTAL:POSITION %s'</span><span class="token operator">%</span>POSITION<span class="token punctuation">)</span>  <span class="token comment">#position means trigger point on the screen /%</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'HORIZONTAL:SCALE %se-6'</span><span class="token operator">%</span>SCALE<span class="token punctuation">)</span>     <span class="token comment">#scale means step /us</span>
  
        <span class="token keyword">def</span> <span class="token function">open_ch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>ch<span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># open channal</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'DISplay:GLObal:CH%s:STATE ON'</span><span class="token operator">%</span>ch<span class="token punctuation">)</span>
  
        <span class="token keyword">def</span> <span class="token function">close_ch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>ch<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># close channal</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'DISplay:GLObal:CH%s:STATE OFF'</span><span class="token operator">%</span>ch<span class="token punctuation">)</span>
  
        <span class="token keyword">def</span> <span class="token function">vertical_ch</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>ch<span class="token punctuation">,</span>scale<span class="token punctuation">,</span>position<span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token comment">#channal settings，</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'CH%s:BANDWIDTH FULl'</span><span class="token operator">%</span>ch<span class="token punctuation">)</span> <span class="token comment"># at its maximum bandwidth</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'CH%s:SCAle %sE-3'</span><span class="token operator">%</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span>scale<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token comment">#channal scale/mv</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'CH%s:POSition %s'</span><span class="token operator">%</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span>position<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">#channal divisions above the center graticule</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'CH%s:COUPLING DC'</span><span class="token operator">%</span>ch<span class="token punctuation">)</span>     <span class="token comment"># DC coupling</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'CH%s:TERMINATION 10.0E+5'</span><span class="token operator">%</span>ch<span class="token punctuation">)</span> <span class="token comment">#channal input resistence is 1MΩ</span>
  
        <span class="token keyword">def</span> <span class="token function">trigger_set</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>ch<span class="token punctuation">,</span>level<span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment">#trigger settings</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'TRIGGER:A:EDGE:COUPLING DC'</span><span class="token punctuation">)</span>  <span class="token comment"># DC trigger coupling with input signal to the trigger circuitry</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'TRIGGER:A:EDGE:SOURCE CH%s'</span><span class="token operator">%</span>ch<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'TRIGGER:A:EDGE:SLOPE RISE'</span><span class="token punctuation">)</span>   <span class="token comment">#triggers on the rising edge of the signal</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'TRIGGER:A:LEVEL:CH%s %s'</span><span class="token operator">%</span><span class="token punctuation">(</span>ch<span class="token punctuation">,</span>level<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># level specifies channal trigger level for seach 1, /V</span>
    
        <span class="token keyword">def</span> <span class="token function">begin_trigger</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#start once trigger action</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'acquire:state 0'</span><span class="token punctuation">)</span> <span class="token comment"># stop</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'acquire:stopafter SEQUENCE'</span><span class="token punctuation">)</span> <span class="token comment"># single</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'acquire:state 1'</span><span class="token punctuation">)</span> <span class="token comment"># run</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'*opc?'</span><span class="token punctuation">)</span> <span class="token comment"># sync</span>
        
        <span class="token keyword">def</span> <span class="token function">data_caul</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span>ch<span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment">#calculate the channal value</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"HEADER 0"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'DATA:SOURCE CH%s'</span><span class="token operator">%</span>ch<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"DAT:ENC SRI"</span><span class="token punctuation">)</span>   <span class="token comment"># Signed Binary Format, LSB order</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"DAT:WIDTH 1"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"DAT:START 1"</span><span class="token punctuation">)</span>
            recordLength <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">'horizontal:recordlength?'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"DAT:STOP {0}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>recordLength<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># Set data stop to match points available</span>

            <span class="token comment"># Fetch horizontal scaling factors</span>
            xinc <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"WFMO:XINCR?"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            xzero <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"WFMO:XZERO?"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            pt_off <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"WFMO:PT_OFF?"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token comment"># Fetch vertical scaling factors</span>
            ymult <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"WFMO:YMULT?"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            yzero <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"WFMO:YZERO?"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            yoff <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query<span class="token punctuation">(</span><span class="token string">"WFMO:YOFF?"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token comment"># Fetch waveform data and save as csv file</span>
            rawData <span class="token operator">=</span> self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>query_binary_values<span class="token punctuation">(</span><span class="token string">'curve?'</span><span class="token punctuation">,</span> datatype<span class="token operator">=</span><span class="token string">'b'</span><span class="token punctuation">,</span> container<span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">)</span>       
            dataLen <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rawData<span class="token punctuation">)</span>
            t0 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span>pt_off <span class="token operator">*</span> xinc<span class="token punctuation">)</span> <span class="token operator">+</span> xzero                
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'horizonal_vector.csv'</span><span class="token punctuation">,</span>mode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
                <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>dataLen<span class="token punctuation">)</span><span class="token punctuation">:</span>
                    xvalues <span class="token operator">=</span> t0 <span class="token operator">+</span> xinc <span class="token operator">*</span> i <span class="token comment"># Create timestamp for the data point</span>
                    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>xvalues<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span> 
                    yvalues<span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>rawData<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> yoff<span class="token punctuation">)</span> <span class="token operator">*</span> ymult <span class="token operator">+</span> yzero <span class="token comment"># Convert raw ADC value into a floating point value</span>
                    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>yvalues<span class="token punctuation">)</span><span class="token punctuation">)</span>
                    <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"\n"</span><span class="token punctuation">)</span>        
            <span class="token comment"># plotting the measurement figure</span>
            data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"horizonal_vector.csv"</span><span class="token punctuation">)</span>
            data_x <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>
            data_y <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span>
            plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>data_x<span class="token punctuation">,</span> data_y<span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'channel 1'</span><span class="token punctuation">)</span> <span class="token comment"># plot label</span>
            plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'time (seconds)'</span><span class="token punctuation">)</span> <span class="token comment"># x label</span>
            plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'voltage (volts)'</span><span class="token punctuation">)</span> <span class="token comment"># y label</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"look for plot window..."</span><span class="token punctuation">)</span>
            plt<span class="token punctuation">.</span>savefig<span class="token punctuation">(</span><span class="token string">'test.png'</span><span class="token punctuation">)</span>     <span class="token comment">#save test picture</span>
            plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
               
        <span class="token keyword">def</span> <span class="token function">close</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>rm<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
    
        <span class="token keyword">def</span> <span class="token function">get_screen</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"HARDCopy:PORT FILE;"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"EXPort:FORMat PNG"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"HARDCopy:FILEName \"C:\\est_Temp\\Temp.png\""</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"HARDCopy STARt"</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">"FILESystem:READFile \"C:\\Low_Speed_Test_Temp\\Temp.png\""</span><span class="token punctuation">)</span>
            imgData <span class="token operator">=</span> self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>read_raw<span class="token punctuation">(</span><span class="token punctuation">)</span>
            dt <span class="token operator">=</span> datetime<span class="token punctuation">.</span>now<span class="token punctuation">(</span><span class="token punctuation">)</span>
            fileName <span class="token operator">=</span> dt<span class="token punctuation">.</span>strftime<span class="token punctuation">(</span><span class="token string">"DPO70000_%Y%m%d_%H%M%S.png"</span><span class="token punctuation">)</span> <span class="token comment"># Generate a filename with date and time</span>
            <span class="token builtin">file</span> <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>fileName<span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span>
            <span class="token builtin">file</span><span class="token punctuation">.</span>write<span class="token punctuation">(</span>imgData<span class="token punctuation">)</span>
            <span class="token builtin">file</span><span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>inst<span class="token punctuation">.</span>write<span class="token punctuation">(</span><span class="token string">'FILESystem:DELEte \"C:\\Test_Temp\\Temp.png\"'</span><span class="token punctuation">)</span> <span class="token comment"># Delete image file from instrument's hard disk.</span>
            

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    
    my<span class="token operator">=</span>Tektronix_DPO<span class="token punctuation">(</span><span class="token punctuation">)</span>
    my<span class="token punctuation">.</span>set_HORIZONTAL<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">40E-3</span><span class="token punctuation">)</span>
    my<span class="token punctuation">.</span>open_ch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    my<span class="token punctuation">.</span>vertical_ch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    my<span class="token punctuation">.</span>trigger_set<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
    my<span class="token punctuation">.</span>begin_trigger<span class="token punctuation">(</span><span class="token punctuation">)</span>
    my<span class="token punctuation">.</span>data_caul<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    my<span class="token punctuation">.</span>get_screen<span class="token punctuation">(</span><span class="token punctuation">)</span>
    my<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_159"></a>参考</h2> 
<p>【1】<a href="https://www.tek.com/en/oscilloscope/dpo70000-mso70000-manual/dpo70000sx-mso-dpo70000dx-mso-dpo70000c-dpo7000c-mso5000-b-1" rel="nofollow">TEK DPO系列示波器编程手册</a><br> 【2】<a href="https://pyvisa.readthedocs.io/en/latest/" rel="nofollow">PyVISA官方文档</a><br> 【3】<a href="https://forum.tek.com/search.php" rel="nofollow">TEK 技术交流论坛</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3d86f165915c8e96f689de864022c8db/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">JS中filter()方法的使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6acfb762c829265d6d59708ff560405a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">tar基本命令</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>