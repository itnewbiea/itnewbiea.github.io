<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Oracle数据库的备份与恢复常用方法 详解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Oracle数据库的备份与恢复常用方法 详解" />
<meta property="og:description" content="Oracle数据库的备份与恢复 在Oracle数据库的使用过程中，备份与恢复是经常遇到的操作。Oracle中的备份分为两大类：逻辑备份和物理备份。其中物理备份又分为两类：冷备份和热备份。本节将简要讲述如何利用各种备份手段进行Oracle数据库的备份与恢复。
1 逻辑备份/恢复（导出/导入） 逻辑备份是指利用exp命令进行备份。利用该命令进行备份，简单易行，也不影响正常的数据库操作。因此，经常被作为日常备份的手段。exp命令可以添加多个参数选项，以实现不同的导出策略。可以通过exp –?命令进行查看。其中，常用参数包括：owner、table和inctype。
1.必备参数
对于一个导出命令，可以只使用必备参数，如范例1所示。
【范例1】演示导出命令的使用。
C:\Documents and Settings\Administrator&gt;exp system/abc123 file=d:/b.dmp
【代码说明】system/abc123为登录数据库时所使用的用户名和密码；file=d:/b.dmp指定数据导出所存放的文件完整路径。这里需要注意的是，该命令并未指定登录到哪个数据库实例，因此，将使用系统环境变量ORACLE_SID所指定的数据库实例。
注意：另外一种特殊情况为，在环境变量列表中找不到ORACLE_SID，那么，可以在注册表中搜索ORACLE_SID项。Oracle也会参考注册表中该项的值来设置环境。
2.owner参数
owner参数，可以指定一个用户名列表。导出时，将只导出用户名列表中用户所拥有的对象，如范例2所示。
【范例2】演示owner参数的使用。
C:\Documents and Settings\Administrator&gt;exp system/abc123 owner=(test, oracle)
file=d:/b.dmp
【代码说明】owner=(test, oracle)指定exp命令仅仅导出test和oracle两个用户所拥有的对象。如果某个用户不存在，例如，本例中用户oracle不存在，那么将给出相应警告，但不会影响对于用户test的对象的导出。
3.tables参数
当使用exp命令时，同样可以指定tables参数。该参数用于指定导出哪些数据表。范例3演示了该参数的使用。
【范例3】演示tables参数的使用。
exp system/abc123 tables=(people, employees) file=d:/b.dmp
【代码说明】tables=（people, employees）指定了要导出的数据表列表，在exp命令执行时，将只导出用户system的people和employees表。如果要导出的表不存在，那么将给出警告信息。但不会影响其他表的导出工作。
4.关于inctype参数
在Oracle 9i之前的版本中，可以利用inctype参数指定导出的增量类型。但是，在Oracle 9i及以后的版本中，该参数不再使用。范例4演示了在Oracle 10g中使用该参数的错误信息。
【范例4】Oracle 10g中参数inctype已经废除。
C:\Documents and Settings\Administrator&gt;exp system/abc123 inctype= complete
file=d:/b.dmp
【代码说明】在exp命令中使用inctype参数，Oracle将抛出错误错误信息，
对于逻辑备份，相应的恢复命令为imp。如果数据库遭到破坏，可以利用如下命令进行恢复：
C:\Documents and Settings\Administrator&gt;imp system/abc123 file=d:/b.dmp
imp命令同样可以指定参数。例如，使用owner参数只导入特定用户的对象；使用tables参数只导入特定表，代码如下： C:\Documents and Settings\Administrator&gt;imp system/abc123 file=d:/b.dmp tables=(people, employees)
该命令将只导入名为people与employees的表。
2 物理备份/恢复 物理备份，是指直接备份数据库的文件。物理备份又分为两种：冷备份和热备份。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8b23c9c2e13c6804392607e1c15c9696/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-12T08:49:26+08:00" />
<meta property="article:modified_time" content="2019-03-12T08:49:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Oracle数据库的备份与恢复常用方法 详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>Oracle数据库的备份与恢复</h3> 
<p><br> 在Oracle数据库的使用过程中，备份与恢复是经常遇到的操作。Oracle中的备份分为两大类：逻辑备份和物理备份。其中物理备份又分为两类：冷备份和热备份。本节将简要讲述如何利用各种备份手段进行Oracle数据库的备份与恢复。</p> 
<h3>1 逻辑备份/恢复（导出/导入）</h3> 
<p><br> 逻辑备份是指利用exp命令进行备份。利用该命令进行备份，简单易行，也不影响正常的数据库操作。因此，经常被作为日常备份的手段。exp命令可以添加多个参数选项，以实现不同的导出策略。可以通过exp –?命令进行查看。其中，常用参数包括：owner、table和inctype。<br> 1.必备参数<br> 对于一个导出命令，可以只使用必备参数，如范例1所示。<br> 【范例1】演示导出命令的使用。<br> C:\Documents and Settings\Administrator&gt;exp system/abc123 file=d:/b.dmp<br> 【代码说明】system/abc123为登录数据库时所使用的用户名和密码；file=d:/b.dmp指定数据导出所存放的文件完整路径。这里需要注意的是，该命令并未指定登录到哪个数据库实例，因此，将使用系统环境变量ORACLE_SID所指定的数据库实例。</p> 
<p>注意：另外一种特殊情况为，在环境变量列表中找不到ORACLE_SID，那么，可以在注册表中搜索ORACLE_SID项。Oracle也会参考注册表中该项的值来设置环境。</p> 
<p><br> 2.owner参数<br> owner参数，可以指定一个用户名列表。导出时，将只导出用户名列表中用户所拥有的对象，如范例2所示。<br> 【范例2】演示owner参数的使用。<br>     C:\Documents and Settings\Administrator&gt;exp system/abc123 owner=(test, oracle)<br> file=d:/b.dmp<br> 【代码说明】owner=(test, oracle)指定exp命令仅仅导出test和oracle两个用户所拥有的对象。如果某个用户不存在，例如，本例中用户oracle不存在，那么将给出相应警告，但不会影响对于用户test的对象的导出。<br><br> 3.tables参数<br> 当使用exp命令时，同样可以指定tables参数。该参数用于指定导出哪些数据表。范例3演示了该参数的使用。<br> 【范例3】演示tables参数的使用。<br> exp system/abc123 tables=(people, employees) file=d:/b.dmp<br> 【代码说明】tables=（people, employees）指定了要导出的数据表列表，在exp命令执行时，将只导出用户system的people和employees表。如果要导出的表不存在，那么将给出警告信息。但不会影响其他表的导出工作。</p> 
<p><br> 4.关于inctype参数<br> 在Oracle 9i之前的版本中，可以利用inctype参数指定导出的增量类型。但是，在Oracle 9i及以后的版本中，该参数不再使用。范例4演示了在Oracle 10g中使用该参数的错误信息。<br> 【范例4】Oracle 10g中参数inctype已经废除。<br>     C:\Documents  and  Settings\Administrator&gt;exp  system/abc123  inctype=  complete<br> file=d:/b.dmp<br> 【代码说明】在exp命令中使用inctype参数，Oracle将抛出错误错误信息，<br><br> 对于逻辑备份，相应的恢复命令为imp。如果数据库遭到破坏，可以利用如下命令进行恢复：<br> C:\Documents and Settings\Administrator&gt;imp system/abc123 file=d:/b.dmp<br> imp命令同样可以指定参数。例如，使用owner参数只导入特定用户的对象；使用tables参数只导入特定表，代码如下： C:\Documents   and   Settings\Administrator&gt;imp   system/abc123   file=d:/b.dmp tables=(people, employees)<br> 该命令将只导入名为people与employees的表。</p> 
<h4>2 物理备份/恢复</h4> 
<p><br> 物理备份，是指直接备份数据库的文件。物理备份又分为两种：冷备份和热备份。<br> 1.冷备份/恢复<br> 冷备份是指在数据库关闭的状态下，备份所有的数据库文件。这些文件包括：所有数据文件、所有控制文件、所有联机REDO LOG文件和Init.ora文件（可选）。<br> 【范例5】演示数据库冷备份。<br> （1）首先以管理员身份登录数据库，并将数据库关闭<br> C:\Documents and Settings\Administrator&gt;sqlplus / as sysdba<br> SQL&gt; shutdown normal;<br> Database closed.<br> Database dismounted.<br> ORACLE instance shut down.<br> （2）在关闭数据库之后，可以对其物理文件进行备份。这些物理文件默认处于{ORACLE_HOME}\product\10.1.0\oradata\test，其中test为数据库名。因此，首先返回到Windows命令行下使用复制命令，或者在SQL命令行中添加host关键字直接使用主机命令：<br> SQL&gt; host copy D:\oracle\product\10.1.0\oradata\test  f:\backup\<br> D:\oracle\product\10.1.0\oradata\test\CONTROL01.CTL<br> D:\oracle\product\10.1.0\oradata\test\CONTROL02.CTL<br> D:\oracle\product\10.1.0\oradata\test\CONTROL03.CTL<br> 此时，已经实现了整个数据库的冷备份。而冷备份的恢复则十分方便，只要数据库处于关闭状态，将备份的文件复制到原来的位置即可。</p> 
<p><br> 2.热备份/恢复<br> 数据库的热备份是指对处于启动状态下的数据库进行备份。热备份一个数据库，首先要保证数据库运行于归档模式，然后备份表空间的数据文件，最后备份控制文件。<br> 【范例6】演示数据库热备份。<br> （1）在进行日志模式切换之前，必须将运行的数据库正常关闭。因此，首先应该以管理员身份登录数据库，关闭数据库。<br> SQL&gt; shutdown immediate;<br> Database closed.<br> Database dismounted.<br> ORACLE instance shut down.</p> 
<p><br> （2）重新启动数据库实例，但是并不打开数据库。<br> SQL&gt; startup mount;<br> ORACLE instance started.<br> Total System Global Area  171966464 bytes<br> Fixed Size               787988 bytes<br> Variable Size          145488364 bytes<br> Database Buffers         25165824 bytes<br> Redo Buffers             524288 bytes<br> Database mounted.</p> 
<p><br> （3）利用alter命令将数据库切换到归档模式。<br> SQL&gt; alter database archivelog;<br> Database altered.</p> 
<p><br> （4）打开数据库，以便对数据库进行操作。<br> SQL&gt; alter database open;<br> Database altered.</p> 
<p><br> （5）利用archive log list命令确认当前数据库处于归档模式。<br> SQL&gt; archive log list;<br> Database log mode         Archive Mode<br> Automatic archival          Enabled<br> Archive destination          USE_DB_RECOVERY_FILE_DEST<br> Oldest online log sequence     538<br> Next log sequence to archive   540<br> Current log sequence         540<br> Archive Mode表明当前的数据库处于归档模式。Oracle数据库有联机重做日志，该日志用于记录用户的数据库操作，如插入、删除或更新数据。一般情况下，每个Oracle数据库至少含有两个联机重做日志组。当一个联机重做日志组被写满的时候，就会发生日志切换。另一个联机日志组成为当前使用的日志，继续记录用户操作。当前联机日志组写满后，会切换到第一个联机日志组，并覆写其中的数据。<br> 如果数据库处于非归档模式，联机日志在切换时就会丢弃已有信息。而在归档模式下，当发生日志切换时，被切换的日志会首先进行归档，并将信息复制到其他目录。这样，不会造成联机日志信息的丢失。</p> 
<p><br> （6）将数据库中的表空间users设置为备份模式，代码如下：<br> SQL&gt; alter tablespace users begin backup;<br> Tablespace altered.</p> 
<p><br> （7）复制实际的表空间的数据文件到备份目录下，代码如下：<br> SQL&gt; host copy D:\oracle\product\10.1.0\oradata\test\users01.dbf d:\back;<br> 已复制       1 个文件。<br> 关闭表空间的备份模式，代码如下：<br> SQL&gt; alter tablespace users end backup;<br> Tablespace altered.</p> 
<p><br> （8）以同样的方式备份数据库中的其他表空间的数据文件。</p> 
<p><br> （9）备份控制文件，代码如下：<br> SQL&gt; alter database backup controlfile to 'F:\backup\TEST_BACKUP' reuse;<br> Database altered.</p> 
<p><br> （10）备份控制文件的创建脚本，代码如下：<br> SQL&gt; alter database backup controlfile to trace;<br> Database altered.<br> 此时会在{ORACLE_HOME}\admin\{INSTANCE_NAME}\udump目录下生成新的控制文件的跟踪文件。在本例中其路径为D:\oracle\product\10.1.0\admin\test\udump。在目录中获得最新的跟踪文件，该文件记录了数据库控制文件的创建脚本。以下代码为文件片段：<br>     -- The following commands will create a new control file and use it<br>     -- to open the database.<br>     -- Data used by Recovery Manager will be lost.<br>     -- The contents of online logs will be lost and all backups will<br>     -- be invalidated. Use this only if online logs are damaged.<br>     -- After mounting the created controlfile, the following SQL<br>     -- statement will place the database in the appropriate<br>     -- protection mode:<br>     --  ALTER DATABASE SET STANDBY DATABASE TO MAXIMIZE PERFORMANCE<br>     STARTUP NOMOUNT<br>     CREATE CONTROLFILE REUSE DATABASE "TEST" RESETLOGS  ARCHIVELOG<br>         MAXLOGFILES 16<br>         MAXLOGMEMBERS 3<br>         MAXDATAFILES 100<br>         MAXINSTANCES 8<br>         MAXLOGHISTORY 454<br>     LOGFILE<br>       GROUP 1 'D:\ORACLE\PRODUCT\10.1.0\ORADATA\TEST\REDO01.LOG'  SIZE 10M,<br>       GROUP 2 'D:\ORACLE\PRODUCT\10.1.0\ORADATA\TEST\REDO02.LOG'  SIZE 10M,<br>       GROUP 3 'D:\ORACLE\PRODUCT\10.1.0\ORADATA\TEST\REDO03.LOG'  SIZE 10M<br>     -- STANDBY LOGFI<br> 复制该文件，并将该文件复制到备份目录下。至此，热备份的过程结束。<br> 在备份成功之后，一旦出现数据库故障，即可以利用备份文件进行恢复工作。例如，如果数据文件D:\oracle\product\10.1.0\oradata\test\users01.dbf损坏，那么在启动数据库时会抛出错误。<br> SQL&gt; startup mount;<br> ORACLE instance started.<br> Total System Global Area  171966464 bytes<br> Fixed Size               787988 bytes<br> Variable Size          145488364 bytes<br> Database Buffers         25165824 bytes<br> Redo Buffers             524288 bytes<br> Database mounted.<br> SQL&gt; alter database open;<br> alter database open<br> *<br> ERROR at line 1:<br> ORA-01157: cannot identify/lock data file 4- see DBWR trace file<br> ORA-01110: data file 4: 'D:\ORACLE\PRODUCT\10.1.0\ORADATA\TEST\USERS01. DBF'</p> 
<p>由于无法找到数据文件USERS01.DBF，数据库启动失败。此时，需要将以前备份的数据文件复制到原目录中。<br>     SQL&gt;   host   copy   f:\backup\users01.dbf   D:\ORACLE\PRODUCT\10.1.0\ORADATA\<br> TEST\USERS01.DBF;<br>     已复制       1 个文件。<br> 此时，重新启动数据库。</p> 
<p>        SQL&gt; alter database open;<br>         alter database open<br> *<br>         ERROR at line 1:<br>         ORA-01113: file 4 needs media recovery<br>         ORA-01110: data file 4: 'D:\ORACLE\PRODUCT\10.1.0\ORADATA\TEST\USERS01. DBF'<br> Oracle在启动时，总是会检查控制文件中的标识（Checkpoint CNT与Checkpoint SCN）与数据文件中的标识是否相同。如果不同，则需要重新恢复数据文件，以同步控制文件中的标识与数据文件中的标识。恢复的命令如下：<br> SQL&gt; recover datafile 'D:\ORACLE\PRODUCT\10.1.0\ORADATA\TEST\USERS01. DBF';<br> 当然，也可以使用如下语句代替。<br> SQL&gt; recover datafile 4;<br> 此时，Oracle可能会要求用户指定归档日志。归档日志默认存储在{ORACLE_HOME}\flash_recovery_area\{DATABASE_NAME}\ARCHIVELOG\下，为recover命令选择最近的归档日志或使用Oracle建议的归档日志，如图所示。<br><img alt="" class="has" height="296" src="https://images2.imgbox.com/c5/a5/mtumqR7z_o.png" width="1017"><br> 选择归档日志<br> 在选择了归档日志之后，Oracle将使用该归档日志进行恢复。恢复成功之后，可以成功打开数据库。<br> SQL&gt; alter database open;<br> Database altered.<br> 备份控制文件的意义在于，当控制文件丢失时，可以将热备份的控制文件还原。而备份跟踪文件的意义在于，当备份的控制文件无法正常使用时，利用跟踪文件重新创建控制文件。</p> 
<h4>3 利用PL/SQL Developer备份数据库</h4> 
<p><br> 除了利用各种命令对数据库进行备份之外，还可以利用PL/SQL Developer进行备份。利用该工具进行备份，简单易学，而且不易出错。利用PL/SQL Developer进行备份的模式包括针对整个数据库、针对某个用户、针对某些特定表等。本节以备份某个用户对象为例，讲述如何利用PL/SQL Developer进行备份。<br> 【范例7】演示利用PL/SQL Developer备份用户System所有对象。<br> （1）打开PL/SQL Developer，并利用System用户登录数据库TEST。<br> （2）在左侧窗口的下拉菜单中选择【My objects】从而保证所有的操作都是针对当前用户的对象。<br> （3）选择菜单栏中的【Tools】菜单下的【Export User Objects】菜单项，将弹出导出窗口，如图所示。<br><img alt="" class="has" height="695" src="https://images2.imgbox.com/70/a0/hgDiMyQz_o.png" width="923"><br> 利用PL/SQL Developer备份用户的所有对象<br> （4）选择列表中所有对象，并为【Output File】指定导出文件的路径。导出的文件实际上是一个SQL脚本文件。其中记录了当前用户的所有对象的创建脚本。一旦数据库出现故障，可以重建数据库，并在其中创建相应用户（System用户无须创建，为数据库默认用户），然后利用该用户登录数据库，并执行该SQL脚本，即可实现数据库对象的重新创建。<br> （5）除了备份数据库对象之外，还需要备份数据表中的数据。备份表中数据，需要使用【Tools】菜单下的【Export Tables】功能。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/68100ccc4617c1a5fc79e3d662cd4a01/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">nodejs异步和回调</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8acfc00f5e115202f941959bfc59de79/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用STM32Cube生成的工程在使用JLink下载调试时遇到的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>