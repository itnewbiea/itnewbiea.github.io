<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>kubernetes单节点部署 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="kubernetes单节点部署" />
<meta property="og:description" content="主从服务器 [root@localhost ~]# systemctl stop firewalld.service [root@localhost ~]# setenforce 0 [root@localhost ~]# hostnamectl set-hostname master [root@localhost ~]# su #关闭swap [root@master ~]# sed -ri &#39;s/.*swap.*/#&amp;/&#39; /etc/fstab [root@master ~]# swapoff -a #本地映射/etc/hosts [root@master ~]# vim /etc/hosts 192.168.68.200 master 192.168.68.30 node1 192.168.68.105 node2 ##时间同步 [root@master ~]# yum install ntpdate -y [root@master ~]# ntpdate time.windows.com [root@master ~]# cat &lt;&lt;EOF &gt; /etc/sysctl.d/k8s.conf net.bridge.bridge-nf-call-ip6tables = 1 net.bridge.bridge-nf-call-iptables = 1 EOF [root@master ~]# sysctl --system ##安装docker [root@master ~]# yum-config-manager \ --add-repo \ https://download." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/728e9366725fe785e8414ea75800b54a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-26T20:51:34+08:00" />
<meta property="article:modified_time" content="2022-05-26T20:51:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">kubernetes单节点部署</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>主从服务器</h2> 
<pre><code class="language-bash">[root@localhost ~]# systemctl stop firewalld.service 
[root@localhost ~]# setenforce 0
[root@localhost ~]# hostnamectl set-hostname master
[root@localhost ~]# su
#关闭swap
[root@master ~]# sed -ri 's/.*swap.*/#&amp;/' /etc/fstab
[root@master ~]# swapoff -a
#本地映射/etc/hosts
[root@master ~]# vim /etc/hosts
192.168.68.200 master
192.168.68.30 node1
192.168.68.105 node2
##时间同步
[root@master ~]# yum install ntpdate -y
[root@master ~]# ntpdate time.windows.com
[root@master ~]# cat &lt;&lt;EOF &gt;  /etc/sysctl.d/k8s.conf
net.bridge.bridge-nf-call-ip6tables = 1
net.bridge.bridge-nf-call-iptables = 1
EOF
[root@master ~]# sysctl --system
##安装docker
[root@master ~]# yum-config-manager \
--add-repo \
https://download.docker.com/linux/centos/docker-ce.repo
[root@master ~]# yum install -y docker-ce docker-ce-cli containerd.io
[root@master ~]# systemctl enable docker --now 
##允许iptables 检查桥接流量
[root@master ~]# cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
br_netfilter
EOF
[root@master ~]# tee /etc/docker/daemon.json &lt;&lt;-'EOF'
{
  "registry-mirrors": ["https://jqqwsp8f.mirror.aliyuncs.com"]
}
EOF
[root@master ~]# systemctl daemon-reload
[root@master ~]# systemctl restart docker
[root@master ~]# cat &gt; /etc/yum.repos.d/kubernetes.repo &lt;&lt; EOF
[kubernetes]
name=Kubernetes
baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64
enabled=1
gpgcheck=0
repo_gpgcheck=0
gpgkey=http://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg http://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
exclude=kubelet kubeadm kubectl
EOF
[root@master ~]# yum install -y kubelet-1.20.9 kubeadm-1.20.9 kubectl-1.20.9 --disableexcludes=kubernetes
[root@master ~]# systemctl enable --now kubelet
[root@master ~]# tee ./images.sh &lt;&lt;- 'EOF'
#!/bin/bash
images=(
kube-apiserver:v1.20.9
kube-proxy:v1.20.9
kube-controller-manager:v1.20.9
kube-scheduler:v1.20.9
coredns:1.7.0
etcd:3.4.13-0
pause:3.2
) 
for imageName in ${images[@]}; do 
docker pull registry.cn-hangzhou.aliyuncs.com/lfy_k8s_images/$imageName
done
EOF
[root@master ~]# chmod +x images.sh 
[root@master ~]# ./images.sh </code></pre> 
<h3>主服务器</h3> 
<pre><code class="language-bash">##初始化节点master
[root@master ~]# kubeadm init \
--apiserver-advertise-address=192.168.68.200 \
--control-plane-endpoint=master \
--image-repository registry.aliyuncs.com/google_containers \
--kubernetes-version v1.20.9 \
--service-cidr=10.1.0.0/16 \
--pod-network-cidr=10.244.0.0/16
##需要等一会儿
[root@master ~]# export KUBECONFIG=/etc/kubernetes/admin.conf
[root@master ~]# mkdir -p $HOME/.kube
[root@master ~]# sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
[root@master ~]# sudo chown $(id -u):$(id -g) $HOME/.kube/config
[root@master ~]# kubeadm join master:6443 --token 694j5u.9j2yrc4p9q97xn3w \
    --discovery-token-ca-cert-hash sha256:6476289c5a9a6159c36f8eea7c64ce8f79b95cb10a2c2299df0437b45151038f \
    --control-plane 
[root@master ~]# curl https://docs.projectcalico.org/manifests/calico.yaml -O
[root@master ~]# vim calico.yaml 
在vi里面搜一下“/192.168”就可以找到这个地方。
4222             - name: CALICO_IPV4POOL_CIDR
4223               value: "10.244.0.0/16"
[root@master ~]# kubectl apply -f calico.yaml</code></pre> 
<p><img alt="" height="134" src="https://images2.imgbox.com/03/b2/mkUeKs0L_o.png" width="833"></p> 
<h3>从服务器</h3> 
<pre><code class="language-bash">[root@node1 ~]# kubeadm join master:6443 --token 694j5u.9j2yrc4p9q97xn3w \
    --discovery-token-ca-cert-hash sha256:6476289c5a9a6159c36f8eea7c64ce8f79b95cb10a2c2299df0437b45151038f </code></pre> 
<p><img alt="" height="118" src="https://images2.imgbox.com/88/4b/kyHaBsHj_o.png" width="641"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ea073cb1ab0df820948e0ef4264982f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ApiFox 基本使用教程（浅尝辄止，非广）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e03f1983cbcd1947611f7bf1bc41bb15/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">double类型的两个数可以直接比较吗？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>