<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>合宙Air780e&#43;luatos&#43;腾讯云物联网平台完成设备通信与控制（属性上报&#43;4G远程点灯） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="合宙Air780e&#43;luatos&#43;腾讯云物联网平台完成设备通信与控制（属性上报&#43;4G远程点灯）" />
<meta property="og:description" content="1.腾讯云物联网平台 首先需要在腾讯云物联网平台创建产品、创建设备、定义设备属性和行为，例如：
（1）创建产品 （2）定义设备属性和行为 （3）创建设备 （4）准备参数 这里我们主要用到的参数有：
a) MQTT参数 mqtt_host = &#34;xxxxxxxxxx.iotcloud.tencentdevices.com&#34; --MQTT地址 mqtt_port = 1883 client_id = &#34;xxxxxxxxxx&#34; --MQTT Client ID user_name = &#34;xxxxxxxxxx&#34; --MQTT Username password = &#34;xxxxxxxxxx&#34; --MQTT password b) topic 这里我们主要用到的topic分别是设备属性上报和应用调用设备行为，大家根据需要也可以添加属性响应和行为响应的topic：
$thing/up/action/xxxxxxxxx/xxxxxxxxx $thing/down/action/xxxxxxxxx/xxxxxxxxx c) json数据格式 上面topic对应具体的JSON数据格式可以参考官网文档：腾讯云物联网平台物模型协议
这里需要我们确定的有：
设备属性上报topic对应的json数据 { &#34;method&#34;: &#34;report&#34;, &#34;clientToken&#34;: &#34;123&#34;, &#34;timestamp&#34;: 1628646783, &#34;params&#34;: { &#34;temp&#34;: 1 } } 应用下发行为命令时设备接收的json数据 { &#34;method&#34;: &#34;action&#34;, &#34;clientToken&#34;: &#34;v2530233902vujFm::b1eex-15x8-4e9x-980d-cf73xx539678&#34;, &#34;actionId&#34;: &#34;LED_action&#34;, &#34;timestamp&#34;: 1696565196, &#34;params&#34;: { &#34;LED_action_down_id&#34;: 1 } } 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6cfc426a34c280b52eef6b24b6bde945/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-06T14:23:57+08:00" />
<meta property="article:modified_time" content="2023-10-06T14:23:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">合宙Air780e&#43;luatos&#43;腾讯云物联网平台完成设备通信与控制（属性上报&#43;4G远程点灯）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1_0"></a>1.腾讯云物联网平台</h2> 
<p>首先需要在腾讯云物联网平台创建产品、创建设备、定义设备属性和行为，例如：</p> 
<h3><a id="1_2"></a>（1）创建产品</h3> 
<p><img src="https://images2.imgbox.com/a4/a2/Te2gPzIc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_4"></a>（2）定义设备属性和行为</h3> 
<p><img src="https://images2.imgbox.com/25/4c/BIMaHi4I_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_6"></a>（3）创建设备</h3> 
<p><img src="https://images2.imgbox.com/1c/79/SBJPxHh3_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_8"></a>（4）准备参数</h3> 
<p>这里我们主要用到的参数有：</p> 
<h4><a id="a_MQTT_10"></a>a) MQTT参数</h4> 
<p><img src="https://images2.imgbox.com/22/ed/yqZDqbXr_o.png" alt="在这里插入图片描述"></p> 
<pre><code>mqtt_host = "xxxxxxxxxx.iotcloud.tencentdevices.com"  --MQTT地址
mqtt_port = 1883  
client_id = "xxxxxxxxxx"    --MQTT Client ID
user_name = "xxxxxxxxxx"    --MQTT Username
password = "xxxxxxxxxx"     --MQTT password
</code></pre> 
<h4><a id="b_topic_19"></a>b) topic</h4> 
<p>这里我们主要用到的topic分别是设备属性上报和应用调用设备行为，大家根据需要也可以添加属性响应和行为响应的topic：<br> <img src="https://images2.imgbox.com/13/af/uyVFBr2s_o.png" alt="在这里插入图片描述"></p> 
<pre><code>$thing/up/action/xxxxxxxxx/xxxxxxxxx
$thing/down/action/xxxxxxxxx/xxxxxxxxx
</code></pre> 
<h4><a id="c_json_26"></a>c) json数据格式</h4> 
<p>上面topic对应具体的JSON数据格式可以参考官网文档：<a href="https://cloud.tencent.com/document/product/1081/34916" rel="nofollow">腾讯云物联网平台物模型协议</a><br> <img src="https://images2.imgbox.com/f6/3a/85A3Twbw_o.png" alt="在这里插入图片描述"><br> 这里需要我们确定的有：</p> 
<ul><li>设备属性上报topic对应的json数据</li></ul> 
<pre><code>{
	"method": "report",
	"clientToken": "123",
	"timestamp": 1628646783,
	"params": {
		"temp": 1
	}
}
</code></pre> 
<ul><li>应用下发行为命令时设备接收的json数据</li></ul> 
<pre><code>{
	"method": "action",
	"clientToken": "v2530233902vujFm::b1eex-15x8-4e9x-980d-cf73xx539678",
	"actionId": "LED_action",
	"timestamp": 1696565196,
	"params": {
		"LED_action_down_id": 1
	}
}
</code></pre> 
<h2><a id="2_MQTTFX_54"></a>2. MQTT.FX测试</h2> 
<p>首先使用MQTT.FX软件代替设备进行测试：</p> 
<h3><a id="1_56"></a>（1）登录</h3> 
<p>拿上面的MQTT数据进行登录<br> <img src="https://images2.imgbox.com/d0/60/nSfx2DSi_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_59"></a>（2）属性上报</h3> 
<p><img src="https://images2.imgbox.com/7a/8f/szFaX6SZ_o.png" alt="在这里插入图片描述"></p> 
<p>上报后我们可以在控制台看到相关数据：<br> <img src="https://images2.imgbox.com/95/a1/FwAsiqdz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_64"></a>（3）行为响应</h3> 
<p>首先订阅topic:<br> <img src="https://images2.imgbox.com/cb/d1/AtibhdT0_o.png" alt="在这里插入图片描述"></p> 
<p>我们在控制台模拟应用端完成行为下发：<br> <img src="https://images2.imgbox.com/67/e5/p5h89Y39_o.png" alt="在这里插入图片描述"><br> 查看接收数据：<br> <img src="https://images2.imgbox.com/2c/7f/1wtg2iYD_o.png" alt="在这里插入图片描述"><br> 到这里即证明相关准备以完成，接下来就可以使用设备代替mqtt.fx了。</p> 
<h2><a id="2LuatosAir780e_73"></a>2.Luatos+Air780e</h2> 
<h3><a id="1_74"></a>（1）下载源码</h3> 
<p>例程已经开源在Gitee，大家自行下载：<br> <a href="https://gitee.com/funiot/luatos_-tencentyun-iot_air780e/" rel="nofollow">Gitee：IOT趣制作 / Luatos_TencentyunIot_air780e</a></p> 
<h3><a id="2_77"></a>（2）补充代码</h3> 
<p>通过上面我们拿到的数据就可以完成编程了，把相关参数填写到对应的位置即可：<br> <img src="https://images2.imgbox.com/ba/d5/IaAUAMIQ_o.png" alt="在这里插入图片描述"><br> 按照自己的数据格式进行解析：<br> <img src="https://images2.imgbox.com/2b/d4/uZXNwEOj_o.png" alt="在这里插入图片描述"><br> 按照自己的数据格式进行上报<br> <img src="https://images2.imgbox.com/b1/e5/1TcPnXFf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_84"></a>（3）编译烧录运行</h3> 
<p><img src="https://images2.imgbox.com/2a/98/OiUuN7Wn_o.png" alt="在这里插入图片描述"><br> 运行：<br> 运行程序后，系统每5S上报一次数据，数据每次上报后累加1，并且通过应用下发命令，例如开关灯，设备能够接收命令并完成灯光控制。<br> <img src="https://images2.imgbox.com/a8/e2/ORTPFogf_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9272485be6a10db7577e1e4cd8e69e64/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">香橙派 arm64 ubuntu安装docker</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fbca33fae0421847c733f3f3fbe16e84/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python&#43;turtle</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>