<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>访问者模式 (Visitor Pattern) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="访问者模式 (Visitor Pattern)" />
<meta property="og:description" content="定义 访问者模式（Visitor Pattern）是一种行为型设计模式，用于将算法与其作用于的对象结构分离。这种模式主要用于执行操作或应用过程，这些操作需要在不同类型的对象上执行，同时避免让这些对象的类变得过于复杂。
关键组成部分
访问者（Visitor）： 一个接口或抽象类，定义了对不同类型元素（Element）的访问操作。实现了每种类型元素的操作，是将操作逻辑从元素类中分离出来的关键所在。 元素（Element）： 定义了一个接受访问者的方法（通常为 accept），该方法允许访问者对象访问元素。元素结构通常稳定，且含有多个接受访问的方法，每个方法对应一种类型的访问者。 具体元素（Concrete Element）： 实现元素接口，定义了 accept 方法的具体实现。可能有多个不同类型的具体元素类，每个类都有自己的逻辑和接受访问者的方式。 具体访问者（Concrete Visitor）： 实现访问者接口，定义了对每个元素类的具体操作。可能有多个不同类型的具体访问者，每个访问者都实现了一套作用于元素的操作。 解决的问题 操作与对象结构的分离：在复杂对象结构中，经常需要执行各种不依赖于特定对象的操作。访问者模式使得可以将这些操作从对象结构中分离出来，以减少这些操作对于对象结构的影响。添加新操作的灵活性：当新的操作需要在这些对象上执行时，你可能不希望更改这些对象的类。访问者模式允许你通过添加新的访问者类来添加新的操作，而无需修改对象的类。集中相关操作：在传统的面向对象设计中，相关的操作可能分散在各个类中。访问者模式允许你将相关操作集中在一个访问者类中，这样可以避免在对象结构中散布这些操作，从而提高代码的组织性和可维护性。扩展性：对于那些可能需要添加新操作的对象结构，访问者模式提供了一种容易扩展的方式。你可以在不更改现有代码的情况下，通过创建新的访问者来添加新的操作。聚合操作：在一些情况下，你可能需要对一个复杂的对象结构执行聚合操作，如遍历、搜索或生成报告。访问者模式使得这些操作可以被集中管理和维护。 使用场景 复杂对象结构：在复杂的对象结构中（如树状或图状结构），需要对结构中的各个对象执行操作，而这些操作依赖于对象的具体类型。访问者模式允许在不修改这些对象类的情况下，添加新的操作。添加新操作：当需要对一个对象结构添加新的操作，且不希望这些操作影响到对象的类时。访问者模式允许将操作逻辑封装在访问者中，易于扩展。避免&#34;污染&#34;对象类：如果在每个对象类中添加新操作会导致类变得复杂或不易维护，那么使用访问者模式将这些操作外部化是一个好选择。不同的访问者实现不同的操作：当同一个对象结构需要支持多种不同的操作，且这些操作是互相独立的。例如，可能有一个用于渲染对象的访问者，另一个用于检查对象的完整性。频繁变更的操作：如果一组操作经常变更，但对象结构相对稳定，那么将这些操作作为访问者的一部分，可以避免频繁修改对象结构。累积状态：在遍历一个复杂结构时，如果需要在访问者中累积状态，而不是在元素中累积，那么访问者模式也是一个不错的选择。 示例代码1-计算机部件访问者 在这个例子中，我们定义了一个计算机部件（ComputerPart）的接口和一些具体部件类（Keyboard、Monitor、Mouse），以及一个访问者接口（ComputerPartVisitor）和一个具体的访问者实现（ComputerPartDisplayVisitor）。
// 访问者接口 interface ComputerPartVisitor { void visit(Computer computer); void visit(Mouse mouse); void visit(Keyboard keyboard); void visit(Monitor monitor); } // 元素接口 interface ComputerPart { void accept(ComputerPartVisitor computerPartVisitor); } // 元素实现 class Keyboard implements ComputerPart { public void accept(ComputerPartVisitor computerPartVisitor) { computerPartVisitor.visit(this); } } class Monitor implements ComputerPart { public void accept(ComputerPartVisitor computerPartVisitor) { computerPartVisitor." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cf86cb2ade7334ed508fa2b94f4aaca2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-24T17:25:23+08:00" />
<meta property="article:modified_time" content="2023-11-24T17:25:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">访问者模式 (Visitor Pattern)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h6><a id="_0"></a>定义</h6> 
<p>访问者模式（Visitor Pattern）是一种行为型设计模式，用于将算法与其作用于的对象结构分离。这种模式主要用于执行操作或应用过程，这些操作需要在不同类型的对象上执行，同时避免让这些对象的类变得过于复杂。</p> 
<p>关键组成部分</p> 
<ol><li><strong>访问者（Visitor）</strong>： 
  <ul><li>一个接口或抽象类，定义了对不同类型元素（Element）的访问操作。</li><li>实现了每种类型元素的操作，是将操作逻辑从元素类中分离出来的关键所在。</li></ul> </li><li><strong>元素（Element）</strong>： 
  <ul><li>定义了一个接受访问者的方法（通常为 <code>accept</code>），该方法允许访问者对象访问元素。</li><li>元素结构通常稳定，且含有多个接受访问的方法，每个方法对应一种类型的访问者。</li></ul> </li><li><strong>具体元素（Concrete Element）</strong>： 
  <ul><li>实现元素接口，定义了 <code>accept</code> 方法的具体实现。</li><li>可能有多个不同类型的具体元素类，每个类都有自己的逻辑和接受访问者的方式。</li></ul> </li><li><strong>具体访问者（Concrete Visitor）</strong>： 
  <ul><li>实现访问者接口，定义了对每个元素类的具体操作。</li><li>可能有多个不同类型的具体访问者，每个访问者都实现了一套作用于元素的操作。</li></ul> </li></ol> 
<h6><a id="_19"></a>解决的问题</h6> 
<ul><li><strong>操作与对象结构的分离</strong>：在复杂对象结构中，经常需要执行各种不依赖于特定对象的操作。访问者模式使得可以将这些操作从对象结构中分离出来，以减少这些操作对于对象结构的影响。</li><li><strong>添加新操作的灵活性</strong>：当新的操作需要在这些对象上执行时，你可能不希望更改这些对象的类。访问者模式允许你通过添加新的访问者类来添加新的操作，而无需修改对象的类。</li><li><strong>集中相关操作</strong>：在传统的面向对象设计中，相关的操作可能分散在各个类中。访问者模式允许你将相关操作集中在一个访问者类中，这样可以避免在对象结构中散布这些操作，从而提高代码的组织性和可维护性。</li><li><strong>扩展性</strong>：对于那些可能需要添加新操作的对象结构，访问者模式提供了一种容易扩展的方式。你可以在不更改现有代码的情况下，通过创建新的访问者来添加新的操作。</li><li><strong>聚合操作</strong>：在一些情况下，你可能需要对一个复杂的对象结构执行聚合操作，如遍历、搜索或生成报告。访问者模式使得这些操作可以被集中管理和维护。</li></ul> 
<h6><a id="_27"></a>使用场景</h6> 
<ul><li><strong>复杂对象结构</strong>：在复杂的对象结构中（如树状或图状结构），需要对结构中的各个对象执行操作，而这些操作依赖于对象的具体类型。访问者模式允许在不修改这些对象类的情况下，添加新的操作。</li><li><strong>添加新操作</strong>：当需要对一个对象结构添加新的操作，且不希望这些操作影响到对象的类时。访问者模式允许将操作逻辑封装在访问者中，易于扩展。</li><li><strong>避免"污染"对象类</strong>：如果在每个对象类中添加新操作会导致类变得复杂或不易维护，那么使用访问者模式将这些操作外部化是一个好选择。</li><li><strong>不同的访问者实现不同的操作</strong>：当同一个对象结构需要支持多种不同的操作，且这些操作是互相独立的。例如，可能有一个用于渲染对象的访问者，另一个用于检查对象的完整性。</li><li><strong>频繁变更的操作</strong>：如果一组操作经常变更，但对象结构相对稳定，那么将这些操作作为访问者的一部分，可以避免频繁修改对象结构。</li><li><strong>累积状态</strong>：在遍历一个复杂结构时，如果需要在访问者中累积状态，而不是在元素中累积，那么访问者模式也是一个不错的选择。</li></ul> 
<h6><a id="1_36"></a>示例代码1-计算机部件访问者</h6> 
<p>在这个例子中，我们定义了一个计算机部件（ComputerPart）的接口和一些具体部件类（Keyboard、Monitor、Mouse），以及一个访问者接口（ComputerPartVisitor）和一个具体的访问者实现（ComputerPartDisplayVisitor）。</p> 
<pre><code class="prism language-java"><span class="token comment">// 访问者接口</span>
<span class="token keyword">interface</span> <span class="token class-name">ComputerPartVisitor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Computer</span> computer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Mouse</span> mouse<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Keyboard</span> keyboard<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Monitor</span> monitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 元素接口</span>
<span class="token keyword">interface</span> <span class="token class-name">ComputerPart</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ComputerPartVisitor</span> computerPartVisitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 元素实现</span>
<span class="token keyword">class</span> <span class="token class-name">Keyboard</span> <span class="token keyword">implements</span> <span class="token class-name">ComputerPart</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ComputerPartVisitor</span> computerPartVisitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        computerPartVisitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Monitor</span> <span class="token keyword">implements</span> <span class="token class-name">ComputerPart</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ComputerPartVisitor</span> computerPartVisitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        computerPartVisitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Mouse</span> <span class="token keyword">implements</span> <span class="token class-name">ComputerPart</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ComputerPartVisitor</span> computerPartVisitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        computerPartVisitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Computer</span> <span class="token keyword">implements</span> <span class="token class-name">ComputerPart</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">ComputerPart</span><span class="token punctuation">[</span><span class="token punctuation">]</span> parts<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        parts <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComputerPart</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{<!-- --></span><span class="token keyword">new</span> <span class="token class-name">Mouse</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Keyboard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Monitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>		
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">ComputerPartVisitor</span> computerPartVisitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> parts<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            parts<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>computerPartVisitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        computerPartVisitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 具体访问者</span>
<span class="token keyword">class</span> <span class="token class-name">ComputerPartDisplayVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">ComputerPartVisitor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Computer</span> computer<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Displaying Computer."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Mouse</span> mouse<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Displaying Mouse."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Keyboard</span> keyboard<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Displaying Keyboard."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">Monitor</span> monitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Displaying Monitor."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 客户端</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VisitorPatternDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ComputerPart</span> computer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Computer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        computer<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ComputerPartDisplayVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="2_116"></a>示例代码2-媒体文件的操作</h6> 
<p>在这个例子中，我们有不同类型的媒体文件（如音频文件和视频文件），并希望执行不同的操作，例如播放和编码。我们将定义媒体文件的接口和具体类，以及一个访问者接口和两个具体的访问者实现。</p> 
<pre><code class="prism language-java"><span class="token comment">// 媒体文件接口</span>
<span class="token keyword">interface</span> <span class="token class-name">MediaFile</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaFileVisitor</span> visitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 音频文件</span>
<span class="token keyword">class</span> <span class="token class-name">AudioFile</span> <span class="token keyword">implements</span> <span class="token class-name">MediaFile</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> filename<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">AudioFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> filename<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>filename <span class="token operator">=</span> filename<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> filename<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaFileVisitor</span> visitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 视频文件</span>
<span class="token keyword">class</span> <span class="token class-name">VideoFile</span> <span class="token keyword">implements</span> <span class="token class-name">MediaFile</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> filename<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">VideoFile</span><span class="token punctuation">(</span><span class="token class-name">String</span> filename<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>filename <span class="token operator">=</span> filename<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> filename<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaFileVisitor</span> visitor<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        visitor<span class="token punctuation">.</span><span class="token function">visit</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">// 媒体文件访问者接口</span>
<span class="token keyword">interface</span> <span class="token class-name">MediaFileVisitor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">AudioFile</span> audio<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">VideoFile</span> video<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 播放操作访问者</span>
<span class="token keyword">class</span> <span class="token class-name">PlayVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">MediaFileVisitor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">AudioFile</span> audio<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Playing audio file: "</span> <span class="token operator">+</span> audio<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">VideoFile</span> video<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Playing video file: "</span> <span class="token operator">+</span> video<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 编码操作访问者</span>
<span class="token keyword">class</span> <span class="token class-name">EncodeVisitor</span> <span class="token keyword">implements</span> <span class="token class-name">MediaFileVisitor</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">AudioFile</span> audio<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Encoding audio file: "</span> <span class="token operator">+</span> audio<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">visit</span><span class="token punctuation">(</span><span class="token class-name">VideoFile</span> video<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Encoding video file: "</span> <span class="token operator">+</span> video<span class="token punctuation">.</span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">VisitorDemo</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">MediaFile</span> audio <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AudioFile</span><span class="token punctuation">(</span><span class="token string">"song.mp3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MediaFile</span> video <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VideoFile</span><span class="token punctuation">(</span><span class="token string">"movie.mp4"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">MediaFileVisitor</span> playVisitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PlayVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">MediaFileVisitor</span> encodeVisitor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EncodeVisitor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        audio<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>playVisitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        video<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>playVisitor<span class="token punctuation">)</span><span class="token punctuation">;</span>

        audio<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>encodeVisitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        video<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span>encodeVisitor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这个例子中，<code>MediaFile</code> 接口定义了接受访问者的方法。<code>AudioFile</code> 和 <code>VideoFile</code> 是具体的媒体文件类。<code>MediaFileVisitor</code> 接口定义了访问者的行为，而 <code>PlayVisitor</code> 和 <code>EncodeVisitor</code> 是具体的访问者实现，它们实现了对不同媒体文件进行播放和编码的操作。这样，当需要为媒体文件添加新的操作时，我们只需要添加新的访问者，而不必修改媒体文件类。</p> 
<h6><a id="_214"></a>主要符合的设计原则</h6> 
<ul><li><strong>开闭原则（Open-Closed Principle）</strong>： 
  <ul><li>访问者模式允许在不修改现有代码的情况下引入新的操作。这意味着类可以保持开放以供扩展（通过添加新的访问者来实现新的功能），但对修改是关闭的（因为你不需要改变现有的类和对象结构）。</li></ul> </li><li><strong>单一职责原则（Single Responsibility Principle）</strong>： 
  <ul><li>在访问者模式中，元素类的职责是维护其核心功能和数据，而访问者类的职责是执行在这些元素上的特定操作。这种分离确保了单一职责原则，即每个类或模块只有一个原因导致改变。</li></ul> </li><li><strong>依赖倒置原则（Dependency Inversion Principle）</strong>： 
  <ul><li>访问者模式通常定义了抽象访问者和抽象元素接口，具体的访问者和元素类都依赖于这些接口，而不是具体的实现。这符合依赖倒置原则，即高层模块不应该依赖于低层模块的具体实现，而应该依赖于抽象。</li></ul> </li><li><strong>里氏替换原则（Liskov Substitution Principle）</strong>： 
  <ul><li>在访问者模式中，可以用子类的对象替换父类的对象，而程序的行为不会发生变化。比如在访问者模式中，可以用具体元素的子类来替换父类元素，而访问者的行为不会改变。</li></ul> </li></ul> 
<h6><a id="JDK_225"></a>在JDK中的应用</h6> 
<ul><li><strong>Java文件I/O（NIO）</strong>： 
  <ul><li><code>java.nio.file.FileVisitor</code> 接口是访问者模式的一个经典应用。它用于遍历文件系统的目录树。<code>FileVisitor</code> 接口定义了在访问目录树的过程中可以执行的一系列操作（如访问文件前后的操作），而具体的行为则由实现了 <code>FileVisitor</code> 接口的类定义。</li><li><code>SimpleFileVisitor</code> 类是 <code>FileVisitor</code> 的一个实现，它提供了对遍历过程中各种事件的基本处理。</li></ul> </li><li><strong>Java编译API</strong>： 
  <ul><li>在 <code>javax.lang.model</code> 包中，Java编译API使用了访问者模式来处理抽象语法树（AST）。这个API允许开发者在编译时检查、处理和生成Java代码。</li><li><code>Element</code> 和 <code>ElementVisitor</code> 接口及其相关类在这个包中用于表示和访问AST中的元素。</li></ul> </li><li><strong>Java反射API</strong>： 
  <ul><li>在 <code>java.lang.reflect</code> 包中，反射API提供了一种访问者风格的接口，用于检查类和对象的运行时行为。例如，<code>Visitor</code> 模式用于在不同类型的 <code>AnnotatedElement</code>（如类、方法、字段等）上执行操作。</li></ul> </li></ul> 
<h6><a id="Spring_236"></a>在Spring中的应用</h6> 
<ul><li>Spring框架中没有直接的访问者模式实例，但是框架的设计允许并鼓励使用访问者模式来实现跨多个类的操作和维护。</li></ul> 
<hr>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d68de8350c52ce4a0082174e4e5c869c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">模板方法模式 (Template Method Pattern)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/23b3aa53dbfe6168fa7ece21f9267284/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">竞赛选题 题目：基于LSTM的预测算法 - 股票预测 天气预测 房价预测</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>