<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【JS】关于精度丢失，产生的原因以及解决方案 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【JS】关于精度丢失，产生的原因以及解决方案" />
<meta property="og:description" content="精度丢失案例 在前端开发中，精度丢失是一个常见的问题，特别是在涉及到浮点数计算时。
以下是一些常见的精度丢失案例：
1 简单的加法和减法
0.1 &#43; 0.2 // 结果为 0.30000000000000004 0.3 - 0.1 // 结果为 0.19999999999999996 // 这是因为浮点数的二进制表示无法准确表示某些十进制小数，导致计算结果存在微小的误差。 2 乘法和除法
0.1 * 0.2 // 结果为 0.020000000000000004 0.3 / 0.1 // 结果为 2.9999999999999996 // 在进行乘法和除法时，浮点数计算结果的精度问题更为突出，可能会产生更大的误差。 3 比较运算
0.1 &#43; 0.2 === 0.3 // 结果为 false // 直接比较浮点数可能会导致不准确的结果，因为计算结果的微小误差可能使它们不完全相等。 产生精度丢失的原因 主要原因是计算机内部使用二进制浮点数表示法，而不是十进制。这种二进制表示法在某些情况下无法准确地表示某些十进制小数，从而导致精度丢失。
以下是导致精度丢失的几个常见原因：
无法精确表示的十进制小数：某些十进制小数无法准确地表示为有限长度的二进制小数。例如，0.1 和 0.2 这样的十进制小数在二进制表示中是无限循环的小数，因此在计算机内部以有限的位数进行表示时，会存在舍入误差，导致精度丢失。舍入误差：由于浮点数的位数是有限的，对于无法精确表示的十进制小数，计算机进行舍入来逼近其值。这种舍入操作会引入误差，并导致计算结果与预期值之间的差异。算术运算的累积误差：在进行一系列浮点数算术运算时，舍入误差可能会累积并导致精度丢失。每一次运算都会引入一些误差，这些误差在多次运算中逐渐累积，导致最终结果的精度降低。比较运算的不精确性：由于浮点数的表示精度有限，直接比较浮点数可能会导致不准确的结果。微小的舍入误差可能使得两个看似相等的浮点数在比较时被认为是不等的。数值范围的限制：浮点数的表示范围是有限的，超出范围的数值可能会导致溢出或下溢，进而影响计算结果的精度。 解决精度丢失的方法 以下是一些常见的解决方法：
使用整数进行计算：尽可能地将浮点数转换为整数进行计算。例如，通过将小数位数乘以一个固定的倍数，将浮点数转换为整数，进行计算后再将结果转换回浮点数。这可以减少浮点数计算中的精度问题。使用专门的库或工具：在处理需要高精度计算的场景中，可以使用一些专门的库或工具。例如，JavaScript 中的 Decimal.js、Big.js 或 BigNumber.js 等库提供了高精度的数学计算功能，可以避免精度丢失的问题。避免直接比较浮点数：由于精度问题，直接比较浮点数可能会导致不准确的结果。在需要比较浮点数的情况下，可以使用误差范围进行比较，而不是使用精确的相等性判断。限制小数位数：对于一些特定的应用场景，可以限制浮点数的小数位数，以减少精度丢失的影响。例如，货币计算常常只保留到小数点后两位。使用适当的舍入策略：在需要进行舍入的情况下，选择适当的舍入策略以满足实际需求。常见的舍入策略包括四舍五入、向上取整、向下取整等。注意数值范围：在进行浮点数计算时，要注意数值的范围。超出浮点数表示范围的数值可能会导致精度丢失或溢出的问题。 总之，处理前端精度丢失问题需要谨慎处理浮点数的计算和比较，并考虑使用整数计算、专门的库或工具以及适当的舍入策略来解决问题。根据具体的应用场景，选择合适的方法可以有效地减少精度丢失带来的影响。
在一些简单的场景，可以通过一些技巧来解决浮点数计算精度丢失的问题。
例如：
// 使用这些方法，仍然需要注意数值范围、舍入策略和比较运算等方面的问题，根据具体的应用场景进行适当的调整和处理。 // 加法运算 function add(a, b) { const precision = Math." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d03b345a1d60ed66154c5b892e87f209/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-23T16:18:13+08:00" />
<meta property="article:modified_time" content="2023-08-23T16:18:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【JS】关于精度丢失，产生的原因以及解决方案</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_0"></a>精度丢失案例</h4> 
<p>在前端开发中，精度丢失是一个常见的问题，特别是在涉及到浮点数计算时。</p> 
<p>以下是一些常见的精度丢失案例：</p> 
<p><strong>1 简单的加法和减法</strong></p> 
<pre><code class="prism language-js"><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token comment">// 结果为 0.30000000000000004</span>
<span class="token number">0.3</span> <span class="token operator">-</span> <span class="token number">0.1</span> <span class="token comment">// 结果为 0.19999999999999996</span>

<span class="token comment">// 这是因为浮点数的二进制表示无法准确表示某些十进制小数，导致计算结果存在微小的误差。</span>
</code></pre> 
<p><strong>2 乘法和除法</strong></p> 
<pre><code class="prism language-js"><span class="token number">0.1</span> <span class="token operator">*</span> <span class="token number">0.2</span> <span class="token comment">// 结果为 0.020000000000000004</span>
<span class="token number">0.3</span> <span class="token operator">/</span> <span class="token number">0.1</span> <span class="token comment">// 结果为 2.9999999999999996</span>

<span class="token comment">// 在进行乘法和除法时，浮点数计算结果的精度问题更为突出，可能会产生更大的误差。</span>
</code></pre> 
<p><strong>3 比较运算</strong></p> 
<pre><code class="prism language-js"><span class="token number">0.1</span> <span class="token operator">+</span> <span class="token number">0.2</span> <span class="token operator">===</span> <span class="token number">0.3</span> <span class="token comment">// 结果为 false</span>

<span class="token comment">// 直接比较浮点数可能会导致不准确的结果，因为计算结果的微小误差可能使它们不完全相等。</span>
</code></pre> 
<h4><a id="_34"></a>产生精度丢失的原因</h4> 
<p>主要原因是计算机内部使用二进制浮点数表示法，而不是十进制。这种二进制表示法在某些情况下无法准确地表示某些十进制小数，从而导致精度丢失。</p> 
<p>以下是导致精度丢失的几个常见原因：</p> 
<ol><li><strong>无法精确表示的十进制小数</strong>：某些十进制小数无法准确地表示为有限长度的二进制小数。例如，0.1 和 0.2 这样的十进制小数在二进制表示中是无限循环的小数，因此在计算机内部以有限的位数进行表示时，会存在舍入误差，导致精度丢失。</li><li><strong>舍入误差</strong>：由于浮点数的位数是有限的，对于无法精确表示的十进制小数，计算机进行舍入来逼近其值。这种舍入操作会引入误差，并导致计算结果与预期值之间的差异。</li><li><strong>算术运算的累积误差</strong>：在进行一系列浮点数算术运算时，舍入误差可能会累积并导致精度丢失。每一次运算都会引入一些误差，这些误差在多次运算中逐渐累积，导致最终结果的精度降低。</li><li><strong>比较运算的不精确性</strong>：由于浮点数的表示精度有限，直接比较浮点数可能会导致不准确的结果。微小的舍入误差可能使得两个看似相等的浮点数在比较时被认为是不等的。</li><li><strong>数值范围的限制</strong>：浮点数的表示范围是有限的，超出范围的数值可能会导致溢出或下溢，进而影响计算结果的精度。</li></ol> 
<h4><a id="_48"></a>解决精度丢失的方法</h4> 
<p>以下是一些常见的解决方法：</p> 
<ol><li><strong>使用整数进行计算</strong>：尽可能地将浮点数转换为整数进行计算。例如，通过将小数位数乘以一个固定的倍数，将浮点数转换为整数，进行计算后再将结果转换回浮点数。这可以减少浮点数计算中的精度问题。</li><li><strong>使用专门的库或工具</strong>：在处理需要高精度计算的场景中，可以使用一些专门的库或工具。例如，JavaScript 中的 Decimal.js、Big.js 或 BigNumber.js 等库提供了高精度的数学计算功能，可以避免精度丢失的问题。</li><li><strong>避免直接比较浮点数</strong>：由于精度问题，直接比较浮点数可能会导致不准确的结果。在需要比较浮点数的情况下，可以使用误差范围进行比较，而不是使用精确的相等性判断。</li><li><strong>限制小数位数</strong>：对于一些特定的应用场景，可以限制浮点数的小数位数，以减少精度丢失的影响。例如，货币计算常常只保留到小数点后两位。</li><li><strong>使用适当的舍入策略</strong>：在需要进行舍入的情况下，选择适当的舍入策略以满足实际需求。常见的舍入策略包括四舍五入、向上取整、向下取整等。</li><li><strong>注意数值范围</strong>：在进行浮点数计算时，要注意数值的范围。超出浮点数表示范围的数值可能会导致精度丢失或溢出的问题。</li></ol> 
<p>总之，处理前端精度丢失问题需要谨慎处理浮点数的计算和比较，并考虑使用整数计算、专门的库或工具以及适当的舍入策略来解决问题。根据具体的应用场景，选择合适的方法可以有效地减少精度丢失带来的影响。</p> 
<p>在一些简单的场景，可以通过一些技巧来解决浮点数计算精度丢失的问题。</p> 
<p>例如：</p> 
<pre><code class="prism language-js"><span class="token comment">// 使用这些方法，仍然需要注意数值范围、舍入策略和比较运算等方面的问题，根据具体的应用场景进行适当的调整和处理。</span>

<span class="token comment">// 加法运算</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> precision <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">getPrecision</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">getPrecision</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> multiplier <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> precision<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>a <span class="token operator">*</span> multiplier<span class="token punctuation">)</span> <span class="token operator">+</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>b <span class="token operator">*</span> multiplier<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> multiplier<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 减法运算</span>
<span class="token keyword">function</span> <span class="token function">subtract</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">return</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token operator">-</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 乘法运算</span>
<span class="token keyword">function</span> <span class="token function">multiply</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> precision <span class="token operator">=</span> <span class="token function">getPrecision</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">getPrecision</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> multiplier <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> precision<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>a <span class="token operator">*</span> multiplier<span class="token punctuation">)</span> <span class="token operator">*</span> Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>b <span class="token operator">*</span> multiplier<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>multiplier <span class="token operator">*</span> multiplier<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 除法运算</span>
<span class="token keyword">function</span> <span class="token function">divide</span><span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span> b</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> precision <span class="token operator">=</span> <span class="token function">getPrecision</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">getPrecision</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> divisor <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">pow</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> precision<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">round</span><span class="token punctuation">(</span>a <span class="token operator">/</span> b <span class="token operator">*</span> divisor<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> divisor<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 获取浮点数的小数位数</span>
<span class="token keyword">function</span> <span class="token function">getPrecision</span><span class="token punctuation">(</span><span class="token parameter">num</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> str <span class="token operator">=</span> <span class="token function">String</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> decimalIndex <span class="token operator">=</span> str<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> decimalIndex <span class="token operator">===</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">?</span> <span class="token number">0</span> <span class="token operator">:</span> str<span class="token punctuation">.</span>length <span class="token operator">-</span> decimalIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述代码定义了四个基本的算术运算方法：<code>add</code>（加法）、<code>subtract</code>（减法）、<code>multiply</code>（乘法）和 <code>divide</code>（除法）。这些方法通过将浮点数转换为整数进行计算，并在必要时进行舍入操作，以减少精度丢失的影响。</p> 
<p>请注意，这些方法仅提供了一种简单的处理精度丢失的方法，<strong>并不能解决所有可能的情况</strong>。在某些特定场景下，可能需要使用专门的高精度数学库，如 Decimal.js、Big.js 或 BigNumber.js 等，以获得更精确的计算结果。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/23bcbb12a799c54428a184062c772be5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【python】正则表达式匹配数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8ce230b6dcc85c458923783a18df98d6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">js改变div大小</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>