<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Elasticsearch&#43;Logstash&#43;Java整合实现Word、PDF，TXT等文件的全文内容检索功能-windows版 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Elasticsearch&#43;Logstash&#43;Java整合实现Word、PDF，TXT等文件的全文内容检索功能-windows版" />
<meta property="og:description" content="一：概述 Elasticsearch：是一个开源的高扩展的分布式全文搜索引擎，它可以近乎实时的存储，然后检索数据，延迟很小。
Logstash: 实现将mysql或其他数据库的数据定时采集到Elasticsearch里。
ElasticHD：Elasticsearch的可视化工具，可以在界面条件查询查询Elasticsearch里的数据。
二：Elasticsearch安装部署 注意：因为ES是java开发的，所以需要安装jdk，安装完之后要配置环境变量，这个就不再赘述了，不会的可以从网上搜索怎么配置
1. 下载elasticsearch安装包（也可以自己去es官网下载）: elasticsearch-7.16.2-windows-x86-64-Java文档类资源-CSDN下载
2. 解压安装包到指定目录，我的目录是：D:\tool\elasticsearch-7.16.2
3. 进入bin目录，打开命令行（ps：在地址栏直接输入cmd，敲回车，就会在当前目录打开一个命令行窗口）
4. 在命令行输入：elasticsearch-service.bat install 把ES安装为服务
5. 启动 elasticsearch
方法一：进入bin目录，双击 elasticsearch.bat 启动该应用
方法二： 打开任务管理器，在服务栏里查看ES是否启动，没有启动，就启动
6. 直接访问 http://localhost:9200/ ，浏览器出现如下所示，表明成功
补充： 如果启动后报jdk相关的错（原因：es默认先使用本地jdk, 当本地jdk与其需要的版本不匹配则会报错；解决思路就是 让es使用自己自带的jdk,这样就需要修改配置文件，让其指向自己自带的jdk），则按如下方式解决：
步骤一：在系统环境变量里添加：
ES_HOME: D:\tool\elasticsearch-7.16.2\
ES_PATH_CONF: D:\tool\elasticsearch-7.16.2\config JAVA_HOME: D:\tool\elasticsearch-7.16.2\jdk
步骤二：按照如上配置后，bin目录下的elasticsearch-env.bat配置文件就会按照设置的目录去调用自带的jdk, 此时重新启动 elasticsearch即可。
三：Logstash安装部署 1. 下载Logstash安装包（也可以自己去es官网下载）: logstash-7.16.2-windows-x86-64版-Java文档类资源-CSDN下载
2. 将安装包解压到指定目录下，我的在：D:\tool\logstash-7.16.2
3. 进入到bin目录下，将 连接mysql数据库的驱动包（mysql-connector-java-5.1.39.jar） 放到该目录下
下载链接：
https://download.csdn.net/download/m0_37951794/87207721
4. 编写采集数据的sql, 并保存到 test.sql文件里，将test.sql文件放到新建的sqldir里，即 bin/sqldir/ test.sql
我test.sql里的内容是： select * from user
5. 修改bin目录下，logstash.conf 配置文件内容：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0247789258c26564da1394bb0f268430/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-01T11:13:40+08:00" />
<meta property="article:modified_time" content="2022-12-01T11:13:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Elasticsearch&#43;Logstash&#43;Java整合实现Word、PDF，TXT等文件的全文内容检索功能-windows版</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一：概述</h2> 
<p><strong>Elasticsearch</strong>：是一个开源的高扩展的分布式全文搜索引擎，它可以近乎实时的存储，然后检索数据，延迟很小。</p> 
<p><strong>Logstash</strong>: 实现将mysql或其他数据库的数据定时采集到Elasticsearch里。</p> 
<p><strong>ElasticHD</strong>：Elasticsearch的可视化工具，可以在界面条件查询查询Elasticsearch里的数据。</p> 
<h2>二：Elasticsearch安装部署</h2> 
<p><strong><span style="background-color:#ffd7b9;">注意：因为ES是java开发的，所以需要安装jdk，安装完之后要配置环境变量，这个就不再赘述了，不会的可以从网上搜索怎么配置</span></strong></p> 
<p>1. 下载elasticsearch安装包（也可以自己去es官网下载）:  <a href="https://download.csdn.net/download/m0_37951794/86934122" title="elasticsearch-7.16.2-windows-x86-64-Java文档类资源-CSDN下载">elasticsearch-7.16.2-windows-x86-64-Java文档类资源-CSDN下载</a></p> 
<p>2. 解压安装包到指定目录，我的目录是：D:\tool\elasticsearch-7.16.2</p> 
<p><img alt="" height="311" src="https://images2.imgbox.com/88/a4/BGsxp5su_o.png" width="496"></p> 
<p>3. 进入bin目录，打开命令行（ps：在地址栏直接输入cmd，敲回车，就会在当前目录打开一个命令行窗口）</p> 
<p><img alt="" height="313" src="https://images2.imgbox.com/e6/53/g4xI0w3f_o.png" width="809"></p> 
<p> 4. 在命令行输入：elasticsearch-service.bat install  把ES安装为服务</p> 
<p><img alt="" height="121" src="https://images2.imgbox.com/e3/49/wmRVDatj_o.png" width="486"></p> 
<p>5. 启动 elasticsearch</p> 
<p>方法一：进入bin目录，双击 elasticsearch.bat 启动该应用</p> 
<p>方法二： 打开任务管理器，在服务栏里查看ES是否启动，没有启动，就启动</p> 
<p><img alt="" height="227" src="https://images2.imgbox.com/65/8c/TKAwiPL7_o.png" width="753"></p> 
<p>6. 直接访问 http://localhost:9200/ ，浏览器出现如下所示，表明成功</p> 
<p><img alt="" height="334" src="https://images2.imgbox.com/5f/34/K3T7Gd0E_o.png" width="483"></p> 
<p><span style="background-color:#ffd7b9;"> 补充：  如果启动后报jdk相关的错（原因：es默认先使用本地jdk, 当本地jdk与其需要的版本不匹配则会报错；解决思路就是 让es使用自己自带的jdk,这样就需要修改配置文件，让其指向自己自带的jdk），则按如下方式解决：</span></p> 
<p><span style="background-color:#ffd7b9;">步骤一：在系统环境变量里添加：</span></p> 
<p><span style="background-color:#ffd7b9;">ES_HOME:     D:\tool\elasticsearch-7.16.2\</span></p> 
<p><span style="background-color:#ffd7b9;">ES_PATH_CONF:    D:\tool\elasticsearch-7.16.2\config    </span></p> 
<p><span style="background-color:#ffd7b9;">JAVA_HOME:   D:\tool\elasticsearch-7.16.2\jdk</span></p> 
<p><span style="background-color:#ffd7b9;">步骤二：按照如上配置后，bin目录下的elasticsearch-env.bat配置文件就会按照设置的目录去调用自带的jdk, 此时重新启动 elasticsearch即可。</span></p> 
<h2>三：Logstash安装部署</h2> 
<p>1. 下载Logstash安装包（也可以自己去es官网下载）:  <a href="https://download.csdn.net/download/m0_37951794/86934238" title="logstash-7.16.2-windows-x86-64版-Java文档类资源-CSDN下载">logstash-7.16.2-windows-x86-64版-Java文档类资源-CSDN下载</a></p> 
<p>2. 将安装包解压到指定目录下，我的在：D:\tool\logstash-7.16.2</p> 
<p>3. 进入到bin目录下，将 连接mysql数据库的驱动包（mysql-connector-java-5.1.39.jar） 放到该目录下</p> 
<p>下载链接：</p> 
<p><a href="https://download.csdn.net/download/m0_37951794/87207721" title="https://download.csdn.net/download/m0_37951794/87207721">https://download.csdn.net/download/m0_37951794/87207721</a></p> 
<p>4. 编写采集数据的sql, 并保存到 test.sql文件里，将test.sql文件放到新建的sqldir里，即  bin/sqldir/ test.sql</p> 
<p>我test.sql里的内容是： select * from user</p> 
<p>5. 修改bin目录下，logstash.conf 配置文件内容：</p> 
<p><span style="background-color:#e7fafa;">input{<!-- --></span></p> 
<p><span style="background-color:#ffd900;">  stdin {}</span><br>   <span style="background-color:#e7fafa;">jdbc{<!-- --></span><br><span style="background-color:#e7fafa;">    type =&gt; "jdbc"</span><br><span style="background-color:#dad5e9;">    # mysql 数据库的连接信息</span><br><span style="background-color:#dad5e9;">    jdbc_connection_string =&gt; "jdbc:mysql://127.0.0.1:3306/elasticsearch_view?  characterEncoding=UTF-8&amp;autoReconnect=true&amp;useTimezone=true&amp;serverTimezone=UTC"</span><br><span style="background-color:#dad5e9;">    jdbc_user =&gt; "root"</span><br><span style="background-color:#dad5e9;">    jdbc_password =&gt; "ABCabc123"</span><br><span style="background-color:#dad5e9;">    jdbc_driver_library =&gt; "./mysql-connector-java-5.1.39.jar"</span><br><span style="background-color:#dad5e9;">    jdbc_driver_class =&gt; "com.mysql.jdbc.Driver" </span><br><span style="background-color:#e7fafa;">    # 数据库重连尝试次数</span><br><span style="background-color:#e7fafa;">    connection_retry_attempts =&gt; "3"</span><br><span style="background-color:#efedf6;">    # 判断数据库连接是否可用，默认false不开启</span><br><span style="background-color:#efedf6;">    jdbc_validate_connection =&gt; "true"</span><br><span style="background-color:#e7fafa;">    # 数据库连接可用校验超时时间，默认3600S</span><br><span style="background-color:#e7fafa;">    jdbc_validation_timeout =&gt; "3600"</span><br><span style="background-color:#efedf6;">    # 开启分页查询（默认false不开启）；</span><br><span style="background-color:#efedf6;">    jdbc_paging_enabled =&gt; "true"</span><br><span style="background-color:#e7fafa;">    # 单次分页查询条数（默认100000,若字段较多且更新频率较高，建议调低此值）；</span><br><span style="background-color:#e7fafa;">    jdbc_page_size =&gt; "2"</span></p> 
<p><span style="background-color:#efedf6;">    # 执行的sql 文件路径,如果sql较简单则用statement属性直接写sql语句即可</span><br><span style="background-color:#efedf6;">    statement_filepath =&gt; "./sqldir/test.sql"</span></p> 
<p><span style="background-color:#efedf6;">   #statement=&gt;"select * from user"</span></p> 
<p><span style="background-color:#e7fafa;">   # 是否将字段名转换为小写，默认true（如果有数据序列化、反序列化需求，建议改为false）；</span><br><span style="background-color:#e7fafa;">    lowercase_column_names =&gt; false</span></p> 
<p><span style="background-color:#efedf6;">  # 是否记录上次执行结果，true表示会将上次执行结果的tracking_column字段的值保存到last_run_metadata_path指定的文件中；</span><br><span style="background-color:#efedf6;">    record_last_run =&gt; true     </span></p> 
<p><span style="background-color:#e7fafa;">    # 需要记录查询结果某字段的值时，此 字段为true,否则默认tracking_column为timestamp的值；：sql_last_value如果input里面use_column_value=&gt;true,即如果设置为true的话，可以是我们设定的字段的上一次的值</span></p> 
<p><span style="background-color:#e7fafa;">    #默认 use_column_value=&gt;false,这样： sql_last_value为上一次更新的最后时刻值，也就是说对于新增的值，才会更新，这样就实现了增量更新的目的</span></p> 
<p><span style="background-color:#e7fafa;">use_column_value=&gt;true</span></p> 
<p><span style="background-color:#efedf6;">    # 需要记录的字段，用于增量同步，需要是数据库里的字段</span><br><span style="background-color:#efedf6;">    tracking_column =&gt;"id"</span></p> 
<p><span style="background-color:#e7fafa;">    #查询结果某字段的数据类型，仅包括numeric和timestamp,默认为numeric</span></p> 
<p><span style="background-color:#e7fafa;">    tracking_column_type=&gt;"numeric"</span></p> 
<p><span style="background-color:#efedf6;">    #记录上次执行结果数据的存放位置</span></p> 
<p><span style="background-color:#efedf6;">last_run_metadata_path=&gt;"./iweb_file_view.log"</span></p> 
<p><span style="background-color:#eaf4fc;">   #是否清除last_run_metadata_path的记录，需要增量同步时此字段必须为false</span></p> 
<p><span style="background-color:#eaf4fc;">clean_run=&gt;false</span></p> 
<p><span style="background-color:#efedf6;">  #同步频率（分 时 天 月 年），默认每分钟同步一次</span></p> 
<p><span style="background-color:#efedf6;">  schedule=&gt;"* * * * * *"</span><br><span style="background-color:#e7fafa;">    }</span><br><span style="background-color:#e7fafa;"> }</span></p> 
<p><span style="background-color:#ffd900;">filter{<!-- --></span></p> 
<p><span style="background-color:#ffd900;">     mutate{<!-- --></span></p> 
<p><span style="background-color:#ffd900;">          remove_field=&gt;["@timestamp","@version"]</span></p> 
<p><span style="background-color:#ffd900;">     }</span></p> 
<p><span style="background-color:#ffd900;">}</span></p> 
<p><span style="background-color:#e7fafa;">output {<!-- --></span><br><span style="background-color:#efedf6;">  if [type] == "jdbc" {<!-- --></span><br><span style="background-color:#efedf6;">  elasticsearch {<!-- --></span><br><span style="background-color:#efedf6;">     hosts =&gt; "127.0.0.1:9200"</span><br><span style="background-color:#efedf6;">    # 配置ES集群地址</span><br><span style="background-color:#efedf6;">    # hosts =&gt; ["192.168.1.1:9200", "192.168.1.2:9200", "192.168.1.3:9200"]</span><br><span style="background-color:#efedf6;">    # 索引名字，必须小写,一个索引下只能有一个类型</span><br><span style="background-color:#efedf6;">    index =&gt; "iweb_file"</span><br><span style="background-color:#efedf6;">    # 数据唯一索引（建议使用数据库KeyID）</span><br><span style="background-color:#efedf6;">    document_id =&gt; "%{id}"</span></p> 
<p><span style="background-color:#efedf6;">    document_type=&gt;"file_type"</span><br><span style="background-color:#efedf6;">   }</span><br><span style="background-color:#efedf6;">  }</span><br>  <span style="background-color:#ffd900;">  stdout {<!-- --></span><br><span style="background-color:#ffd900;">       codec =&gt; json_lines</span><br><span style="background-color:#ffd900;">    }</span><br><span style="background-color:#e7fafa;">  }</span></p> 
<p>6. 用记事本编写logstash的启动脚本，并存为： my_run.bat 文件</p> 
<p>我  my_run.bat里的内容是： logstash -f logstash.conf</p> 
<p>7. 在确保elasticsearch已经启动成功的前提下，启动 logstash(否则无法将数据写入elasticsearch):  双击 my_run.bat 即可，如下图则说明logstash启动成功，并成功连接上了elasticsearch </p> 
<p><img alt="" height="641" src="https://images2.imgbox.com/98/bf/a46KadXD_o.png" width="905"></p> 
<p></p> 
<h2>四：Elasticsearch可视化工具安装使用（ElasticHD、Kibana）</h2> 
<p>1. 下载 ElasticHD 安装包：<a href="https://download.csdn.net/download/m0_37951794/87214728" title="https://download.csdn.net/download/m0_37951794/87214728">https://download.csdn.net/download/m0_37951794/87214728</a></p> 
<p>2. 解压 安装包到 D:\tool\ElasticHD</p> 
<p>3. 在elasticsearch已经启动的前提下，双击ElasticHD/run.bat，启动该可视化工具</p> 
<p><img alt="" height="194" src="https://images2.imgbox.com/12/0d/23QBgxFT_o.png" width="737"></p> 
<p></p> 
<p>4. 启动后直接浏览器访问： http://127.0.0.1:9800,即可看到可视化界面，在连接里配置已启动的elasticsearch的访问地址即可查看里面的存储的数据</p> 
<p><img alt="" height="539" src="https://images2.imgbox.com/9c/24/fmEy5T6x_o.png" width="1156"></p> 
<p></p> 
<h2>五：Java如何调用Elasticsearch（连接、查询、分页、排序、统计、模糊匹配、精准匹配、文字高亮）</h2> 
<p>我的完整demo：<a href="https://download.csdn.net/download/m0_37951794/87214886" title="java如何调用Elasticsearch（连接、查询、分页、排序、统计、模糊匹配、精准匹配、文字高亮）源码-Java文档类资源-CSDN下载">java如何调用Elasticsearch（连接、查询、分页、排序、统计、模糊匹配、精准匹配、文字高亮）源码-Java文档类资源-CSDN下载</a></p> 
<p><img alt="" height="517" src="https://images2.imgbox.com/88/65/0qK4oxPR_o.png" width="1200"></p> 
<p></p> 
<h3>结束！</h3> 
<h4>如要安装linux版本请参考：<a href="https://blog.csdn.net/m0_37951794/article/details/128115375?spm=1001.2014.3001.5502" title="Elasticsearch(集群)+Logstash+Java整合实现Word、PDF，TXT等文件的全文内容检索功能-Linux版_他山之石女士的博客-CSDN博客">Elasticsearch(集群)+Logstash+Java整合实现Word、PDF，TXT等文件的全文内容检索功能-Linux版_他山之石女士的博客-CSDN博客</a></h4> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7143f9843c7301da02f5efff1541ef95/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pinia安装使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a76910cf4acc1dcd362477b5fa3d97be/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python每日一练：输入一个字符串，统计其中的小写字母，大写字母，空格键，以及其它字符，并在一行内输出统计的个数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>