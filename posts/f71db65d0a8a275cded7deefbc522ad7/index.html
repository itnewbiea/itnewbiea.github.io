<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>怎样通过历史数据预测未来？ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="怎样通过历史数据预测未来？" />
<meta property="og:description" content="很多人或许都看过火影忍者，你是否对蛤蟆丸口中的预言之子感到很神奇，这个老蛤蟆预言了很多事情，他在梦里可以预见未来。如果我们在现实生活中也能预测未来该有多好，每天坐等买彩票就可以致富了（笑醒）。当然彩票因为其随机性，肯定是不能预测的，不过有些事情倒是可以预测，只是现有的技术还做不到百分百正确。那么哪些事情是可以预测的呢，比如预测天气、预测股票，预测世界杯或NBA，预测疾病，事故，公司明年的销量，未来的房价走向等等。其实预测可以用于几乎每个行业，通过预测可以对一些决策提供客观参考。那么怎么做到预测呢？下面我们通过一个简单的示例来理解预测。
假设有这样一个场景，每天上下班的时候，我们乘坐的电梯有时候会出故障，有的电梯一下掉十几楼，我每天坐电梯的时候心都是提着的。那么我们是否可以对某部电梯的故障进行预测，来减少未来发生故障的次数？当然可以的。
选用较为主流的一些工具来搭建我们的预测环境。
jupyter安装：https://www.cnblogs.com/bxyan/p/7203966.html可以参照该文章进行安装
hadoop安装：https://blog.csdn.net/hliq5399/article/details/78193113安装本地模式就可以了
spark安装：https://www.cnblogs.com/tijun/p/7561718.html 由于spark是运行在hdfs上，所以需要先安装好hadoop
以上环境搭建好了后，我们就以hadoop为数据源，来计算预测模型，再以该模型实时预测电梯故障。
我们采集到电梯正常运行和故障发生前的一些数据：
运行时长
200370130245360365345361112190234564670200240490785280150530489389载重5001009003007009005552331000110023460030011009004001000120011899991001009是否高峰期1010110011010110011101是否故障0000000000011111111111 我们将其中的70%作为训练数据，30%作为测试数据。首先利用训练数据训练出预测模型。我们用pyspark从hadoop中提取出数据：
import findspark import os #初始化pyspark的依赖 findspark.init() %matplotlib inline # 实例化sparksession from pyspark.sql import SparkSession spark = SparkSession.builder \ .master(&#34;local&#34;) \ .appName(&#34;Python Spark SQL basic example&#34;) \ .config(&#34;spark.some.config.option&#34;, &#34;some-value&#34;) \ .enableHiveSupport() \ .getOrCreate() spark实例已经初始化成功，接下来从hadoop中提取数据到spark中，
#提取hadoop数据到DataFram df_train = spark.read.format(&#34;csv&#34;).option(&#34;header&#34;,&#34;true&#34;)\ .option(&#34;inferSchema&#34;,&#34;true&#34;).load(&#34;hdfs://bigdata:8020/hive/warehousedir/db.db/lift/lift_train.txt&#34;) df_train.show() 接下来需要将这些数据构造成特征矩阵，其中feature列就是转换后的特征矩阵
from pyspark.ml.feature import * vectorizer = VectorAssembler() vectorizer.setInputCols([&#34;runtime&#34;, &#34;weight&#34;, &#34;ishight&#34;]) vectorizer.setOutputCol(&#34;features&#34;) #特征矩阵 df_vect = vectorizer.transform(df_train) df_vect.show() 我们这里选用的是逻辑回归算法来生成模型，因为我们预测的目标属性是一个二元数值。生成模型的算法还有很多，按模型的训练方式分为：有监督训练、无监督训练和半监督训练。逻辑回归是监督训练中的一种，决策树算法，神经网络，多元线性回归等也都属于监督训练。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f71db65d0a8a275cded7deefbc522ad7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-01-08T10:51:46+08:00" />
<meta property="article:modified_time" content="2019-01-08T10:51:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">怎样通过历史数据预测未来？</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>很多人或许都看过火影忍者，你是否对蛤蟆丸口中的预言之子感到很神奇，这个老蛤蟆预言了很多事情，他在梦里可以预见未来。如果我们在现实生活中也能预测未来该有多好，每天坐等买彩票就可以致富了（笑醒）。当然彩票因为其随机性，肯定是不能预测的，不过有些事情倒是可以预测，只是现有的技术还做不到百分百正确。那么哪些事情是可以预测的呢，比如预测天气、预测股票，预测世界杯或NBA，预测疾病，事故，公司明年的销量，未来的房价走向等等。其实预测可以用于几乎每个行业，通过预测可以对一些决策提供客观参考。那么怎么做到预测呢？下面我们通过一个简单的示例来理解预测。</p> 
<p>假设有这样一个场景，每天上下班的时候，我们乘坐的电梯有时候会出故障，有的电梯一下掉十几楼，我每天坐电梯的时候心都是提着的。那么我们是否可以对某部电梯的故障进行预测，来减少未来发生故障的次数？当然可以的。</p> 
<p>选用较为主流的一些工具来搭建我们的预测环境。</p> 
<p>jupyter安装：<a href="https://www.cnblogs.com/bxyan/p/7203966.html" rel="nofollow">https://www.cnblogs.com/bxyan/p/7203966.html</a>可以参照该文章进行安装</p> 
<p>hadoop安装：<a href="https://blog.csdn.net/hliq5399/article/details/78193113">https://blog.csdn.net/hliq5399/article/details/78193113</a>安装本地模式就可以了</p> 
<p>spark安装：<a href="https://www.cnblogs.com/tijun/p/7561718.html" rel="nofollow">https://www.cnblogs.com/tijun/p/7561718.html</a> 由于spark是运行在hdfs上，所以需要先安装好hadoop</p> 
<p>以上环境搭建好了后，我们就以hadoop为数据源，来计算预测模型，再以该模型实时预测电梯故障。</p> 
<p>我们采集到电梯正常运行和故障发生前的一些数据：</p> 
<table align="center" cellspacing="0" style="width:300pt;"><tbody><tr><th style="text-align:justify;vertical-align:middle;width:49pt;"> <p> </p> <p> </p> <p> </p> <p><span style="color:#000000;">运行时长</span></p> </th><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">200</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">370</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">130</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">245</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">360</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">365</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">345</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">361</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">112</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">190</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">234</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">564</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">670</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">200</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">240</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">490</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">785</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">280</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">150</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">530</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">489</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">389</span></td></tr><tr><th style="text-align:justify;vertical-align:middle;width:49pt;"><span style="color:#000000;">载重</span></th><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">500</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">100</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">900</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">300</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">700</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">900</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">555</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">233</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1000</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1100</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">234</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">600</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">300</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1100</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">900</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">400</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1000</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1200</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1189</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">999</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">100</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1009</span></td></tr><tr><th style="text-align:justify;vertical-align:middle;width:49pt;"><span style="color:#000000;">是否高峰期</span></th><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td></tr><tr><th style="text-align:justify;vertical-align:middle;width:49pt;"><span style="color:#000000;">是否故障</span></th><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">0</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td><td style="text-align:justify;vertical-align:middle;width:26pt;"><span style="color:#000000;">1</span></td></tr></tbody></table> 
<p>我们将其中的70%作为训练数据，30%作为测试数据。首先利用训练数据训练出预测模型。我们用pyspark从hadoop中提取出数据：</p> 
<pre class="has"><code>import findspark
import os
#初始化pyspark的依赖
findspark.init()
%matplotlib inline
# 实例化sparksession
from pyspark.sql import SparkSession
spark = SparkSession.builder \
    .master("local") \
    .appName("Python Spark SQL basic example") \
    .config("spark.some.config.option", "some-value") \
    .enableHiveSupport() \
    .getOrCreate()</code></pre> 
<p><img alt="" class="has" src="https://images2.imgbox.com/95/04/UPttjFfi_o.png"></p> 
<p>spark实例已经初始化成功，接下来从hadoop中提取数据到spark中，</p> 
<pre class="has"><code>#提取hadoop数据到DataFram
df_train = spark.read.format("csv").option("header","true")\
.option("inferSchema","true").load("hdfs://bigdata:8020/hive/warehousedir/db.db/lift/lift_train.txt")
df_train.show()</code></pre> 
<p><img alt="" class="has" src="https://images2.imgbox.com/fa/15/SzM44JKU_o.png"></p> 
<p>接下来需要将这些数据构造成特征矩阵，其中feature列就是转换后的特征矩阵</p> 
<pre class="has"><code>from pyspark.ml.feature import *
vectorizer = VectorAssembler()
vectorizer.setInputCols(["runtime", "weight", "ishight"])
vectorizer.setOutputCol("features")
#特征矩阵
df_vect = vectorizer.transform(df_train)
df_vect.show()</code></pre> 
<p><img alt="" class="has" src="https://images2.imgbox.com/50/ab/Cwr6tRpa_o.png"></p> 
<p>我们这里选用的是逻辑回归算法来生成模型，因为我们预测的目标属性是一个二元数值。生成模型的算法还有很多，按模型的训练方式分为：有监督训练、无监督训练和半监督训练。逻辑回归是监督训练中的一种，决策树算法，神经网络，多元线性回归等也都属于监督训练。</p> 
<pre class="has"><code>#构建逻辑回归模型
from pyspark.ml.classification import LogisticRegression
mlor = LogisticRegression(regParam=0.1, elasticNetParam=0, family="binomial")
#设置目标属性和特征矩阵
mlor.setLabelCol("isbroken")
mlor.setFeaturesCol("features")</code></pre> 
<pre class="has"><code>#生成模型
model = mlor.fit(df_vect)</code></pre> 
<p>pyspark.ml库给我们提供了多种分类算法，我们可以根据业务场景选择合适的算法来生成模型。根据该模型，对测试数据进行预测</p> 
<pre class="has"><code>df_test = spark.read.format("csv").option("header","true")\
.option("inferSchema","true").load("hdfs://bigdata:8020/hive/warehousedir/db.db/lift/lift_test.txt")
#构建测试数据的特征矩阵
df_vtest = vectorizer.transform(df_test)
#预测
transformed = model.transform(df_vtest)
transformed.show()</code></pre> 
<p><img alt="" class="has" src="https://images2.imgbox.com/07/48/Yobr0zRs_o.png"></p> 
<p>其中prediction这列就是我们对测试数据预测的结果，当然，用于训练的数据越多，最后预测的结果就越准确。一个模型只要预测正确的概率大于随机概率，都是有意义的。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d4df0e1ff2fa71d69de3152973e980c2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Docker系列05—Docker 存储卷详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4693e211eb563da89ae18e59868fe440/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ansible 结合playbook批量添加用户</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>