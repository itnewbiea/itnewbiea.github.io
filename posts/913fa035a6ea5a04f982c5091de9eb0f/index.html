<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Golang语言基础—函数调用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Golang语言基础—函数调用" />
<meta property="og:description" content="1. C语言的函数调用惯例 所谓“调用惯例(calling convention)”是调用方和被调用方对于函数调用的一个明确的约定，包括：函数参数与返回值的传递方式、传递顺序。只有双方都遵守同样的约定，函数才能被正确地调用和执行。如果不遵守这个约定，函数将无法正确执行。
C语言中，一般使用gcc将C语言编译成汇编代码是分析函数调用的最常见方式，比如以下的代码：
int my_function(int arg1, int arg2) { return arg1 &#43; arg2; } int main() { int i = my_function(1, 2); } 通过gcc -S main.c指令生成main.s：
.file &#34;main.c&#34; .text .globl my_function .type my_function, @function my_function: .LFB0: .cfi_startproc pushq %rbp .cfi_def_cfa_offset 16 .cfi_offset 6, -16 movq %rsp, %rbp .cfi_def_cfa_register 6 movl %edi, -4(%rbp) // 取出第一个参数放到栈上 movl %esi, -8(%rbp) // 取出第二个参数放到栈上 movl -4(%rbp), %edx // 设置edx = edi = 1 movl -8(%rbp), %eax // 设置eax = esi = 2 addl %edx, %eax // 返回值放在eax，eax = eax &#43; edx = 3 popq %rbp ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/913fa035a6ea5a04f982c5091de9eb0f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T12:37:10+08:00" />
<meta property="article:modified_time" content="2024-01-05T12:37:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Golang语言基础—函数调用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1_C_0"></a>1. C语言的函数调用惯例</h2> 
<p>所谓“调用惯例(calling convention)”是调用方和被调用方对于函数调用的一个明确的约定，包括：函数参数与返回值的传递方式、传递顺序。只有双方都遵守同样的约定，函数才能被正确地调用和执行。如果不遵守这个约定，函数将无法正确执行。<br> C语言中，一般使用gcc将C语言编译成汇编代码是分析函数调用的最常见方式，比如以下的代码：</p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg1<span class="token punctuation">,</span> <span class="token keyword">int</span> arg2<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> arg1 <span class="token operator">+</span> arg2<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过gcc -S main.c指令生成main.s：</p> 
<pre><code class="prism language-c">        <span class="token punctuation">.</span>file   <span class="token string">"main.c"</span>
        <span class="token punctuation">.</span>text
        <span class="token punctuation">.</span>globl  my_function
        <span class="token punctuation">.</span>type   my_function<span class="token punctuation">,</span> @function
my_function<span class="token operator">:</span>
<span class="token punctuation">.</span>LFB0<span class="token operator">:</span>
        <span class="token punctuation">.</span>cfi_startproc
        pushq   <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa_offset <span class="token number">16</span>
        <span class="token punctuation">.</span>cfi_offset <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span>
        movq    <span class="token operator">%</span>rsp<span class="token punctuation">,</span> <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa_register <span class="token number">6</span>
        movl    <span class="token operator">%</span>edi<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span>    <span class="token comment">// 取出第一个参数放到栈上</span>
        movl    <span class="token operator">%</span>esi<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span>    <span class="token comment">// 取出第二个参数放到栈上</span>
        movl    <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>edx    <span class="token comment">// 设置edx = edi = 1</span>
        movl    <span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax    <span class="token comment">// 设置eax = esi = 2</span>
        addl    <span class="token operator">%</span>edx<span class="token punctuation">,</span> <span class="token operator">%</span>eax        <span class="token comment">// 返回值放在eax，eax = eax + edx = 3</span>
        popq    <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span>
        ret
        <span class="token punctuation">.</span>cfi_endproc
<span class="token punctuation">.</span>LFE0<span class="token operator">:</span>
        <span class="token punctuation">.</span>size   my_function<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token operator">-</span>my_function
        <span class="token punctuation">.</span>globl  main
        <span class="token punctuation">.</span>type   main<span class="token punctuation">,</span> @function
main<span class="token operator">:</span>
<span class="token punctuation">.</span>LFB1<span class="token operator">:</span>
        <span class="token punctuation">.</span>cfi_startproc
        pushq   <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa_offset <span class="token number">16</span>
        <span class="token punctuation">.</span>cfi_offset <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span>
        movq    <span class="token operator">%</span>rsp<span class="token punctuation">,</span> <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa_register <span class="token number">6</span>
        subq    $<span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">%</span>rsp
        movl    $<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span>esi    <span class="token comment">// 设置第二个参数</span>
        movl    $<span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">%</span>edi    <span class="token comment">// 设置第一个参数</span>
        call    my_function
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span>
        movl    $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        leave
        <span class="token punctuation">.</span>cfi_def_cfa <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span>
        ret
        <span class="token punctuation">.</span>cfi_endproc
<span class="token punctuation">.</span>LFE1<span class="token operator">:</span>
        <span class="token punctuation">.</span>size   main<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token operator">-</span>main
        <span class="token punctuation">.</span>ident  <span class="token string">"GCC: (Ubuntu 7.5.0-3ubuntu1~18.04) 7.5.0"</span>
        <span class="token punctuation">.</span>section        <span class="token punctuation">.</span>note<span class="token punctuation">.</span>GNU<span class="token operator">-</span>stack<span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span>@progbits
</code></pre> 
<p>可以看到：</p> 
<p>在调用my_function函数前，main函数将两个参数分别存到edi和esi两个寄存器中；<br> 在调用时，最后通过edx和eax接收到入参，并计算值存入eax寄存器（C语言的返回值都是存储在eax寄存器的），然后返回；</p> 
<p>如果参数过多会怎么样呢？我们试着将入参拓展到8个：</p> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token keyword">int</span> arg1<span class="token punctuation">,</span> <span class="token keyword">int</span> arg2<span class="token punctuation">,</span> <span class="token keyword">int</span> arg3<span class="token punctuation">,</span> <span class="token keyword">int</span> arg4<span class="token punctuation">,</span> <span class="token keyword">int</span> arg5<span class="token punctuation">,</span> <span class="token keyword">int</span> arg6<span class="token punctuation">,</span> <span class="token keyword">int</span> arg7<span class="token punctuation">,</span> <span class="token keyword">int</span> arg8<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> arg1 <span class="token operator">+</span> arg2 <span class="token operator">+</span> arg3 <span class="token operator">+</span> arg4 <span class="token operator">+</span> arg5 <span class="token operator">+</span> arg6 <span class="token operator">+</span> arg7 <span class="token operator">+</span> arg8<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token function">my_function</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后查看汇编代码，可以发现前6个参数放到寄存器中，但是后面的参数会通过栈传递。</p> 
<pre><code class="prism language-c">main<span class="token operator">:</span>
<span class="token punctuation">.</span>LFB1<span class="token operator">:</span>
        <span class="token punctuation">.</span>cfi_startproc
        pushq   <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa_offset <span class="token number">16</span>
        <span class="token punctuation">.</span>cfi_offset <span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">16</span>
        movq    <span class="token operator">%</span>rsp<span class="token punctuation">,</span> <span class="token operator">%</span>rbp
        <span class="token punctuation">.</span>cfi_def_cfa_register <span class="token number">6</span>
        subq    $<span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">%</span>rsp
        pushq   $<span class="token number">8</span>
        pushq   $<span class="token number">7</span>
        movl    $<span class="token number">6</span><span class="token punctuation">,</span> <span class="token operator">%</span>r9d
        movl    $<span class="token number">5</span><span class="token punctuation">,</span> <span class="token operator">%</span>r8d
        movl    $<span class="token number">4</span><span class="token punctuation">,</span> <span class="token operator">%</span>ecx
        movl    $<span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">%</span>edx
        movl    $<span class="token number">2</span><span class="token punctuation">,</span> <span class="token operator">%</span>esi
        movl    $<span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">%</span>edi
        call    my_function
        addq    $<span class="token number">16</span><span class="token punctuation">,</span> <span class="token operator">%</span>rsp
        movl    <span class="token operator">%</span>eax<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">4</span><span class="token punctuation">(</span><span class="token operator">%</span>rbp<span class="token punctuation">)</span>
        movl    $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">%</span>eax
        leave
        <span class="token punctuation">.</span>cfi_def_cfa <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span>
        ret
        <span class="token punctuation">.</span>cfi_endproc
</code></pre> 
<p>可以总结，在x86_64的机器上使用C语言调用函数时：</p> 
<ul><li>6个及以下的参数会按照顺序分别使用edi、esi、edx、ecx、r8d和r9d这六个寄存器传递；</li><li>6个以上的参数传递会使用寄存器+栈，前六个参数会按照以上顺序使用寄存器，后面的会按照从右到左的顺序入栈。</li></ul> 
<h2><a id="2_Go_112"></a>2. Go语言的函数调用惯例</h2> 
<p>在Go v1.17版本之前，Go语言的函数调用是通过栈来传递参数的。根据存储山结构，CPU从寄存器上取值要比从内存取快几百倍，即使局部性高，L1 Cache的缓存命中率高，那也会比寄存器中取值速度慢4倍左右，所以栈传参大大限制了Go语言函数调用的速度。基于栈传递参数和接收返回值的设计大大降低了实现的复杂度，但是牺牲了函数调用的性能，在Go v1.17版本之后引入了寄存器传递函数传参。<br> 我们直接以下面的例子来看一下Go语言的调用惯例：</p> 
<pre><code class="prism language-c">package main

func <span class="token function">myFunction</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">,</span> l <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> i<span class="token punctuation">,</span> j<span class="token punctuation">,</span> k<span class="token punctuation">,</span> l
<span class="token punctuation">}</span>

func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token function">myFunction</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>通过go tool compile -S -N -l main.go &gt;&gt; main.s得到汇编代码，可以看到，函数传参，前9个参数都是通过寄存器传入，超过9个的以上通过栈传递参数。</p> 
<pre><code class="prism language-c"><span class="token string">""</span><span class="token punctuation">.</span>main STEXT size<span class="token operator">=</span><span class="token number">118</span> args<span class="token operator">=</span><span class="token number">0x0</span> locals<span class="token operator">=</span><span class="token number">0x80</span> funcid<span class="token operator">=</span><span class="token number">0x0</span>
        <span class="token number">0x0000</span> <span class="token number">00000</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        TEXT    <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span><span class="token punctuation">,</span> ABIInternal<span class="token punctuation">,</span> $<span class="token number">128</span><span class="token operator">-</span><span class="token number">0</span>
        <span class="token number">0x0000</span> <span class="token number">00000</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        CMPQ    SP<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">(</span>R14<span class="token punctuation">)</span>
        <span class="token number">0x0004</span> <span class="token number">00004</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        PCDATA  $<span class="token number">0</span><span class="token punctuation">,</span> $<span class="token operator">-</span><span class="token number">2</span>
        <span class="token number">0x0004</span> <span class="token number">00004</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        JLS     <span class="token number">111</span>
        <span class="token number">0x0006</span> <span class="token number">00006</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        PCDATA  $<span class="token number">0</span><span class="token punctuation">,</span> $<span class="token operator">-</span><span class="token number">1</span>
        <span class="token number">0x0006</span> <span class="token number">00006</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        ADDQ    $<span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">,</span> SP
        <span class="token number">0x000a</span> <span class="token number">00010</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        MOVQ    BP<span class="token punctuation">,</span> <span class="token number">120</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
        <span class="token number">0x000f</span> <span class="token number">00015</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        LEAQ    <span class="token number">120</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> BP
        <span class="token number">0x0014</span> <span class="token number">00020</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        FUNCDATA        $<span class="token number">0</span><span class="token punctuation">,</span> gclocals·<span class="token number">33</span>cdeccccebe80329f1fdbee7f5874cb<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>
        <span class="token number">0x0014</span> <span class="token number">00020</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">7</span><span class="token punctuation">)</span>        FUNCDATA        $<span class="token number">1</span><span class="token punctuation">,</span> gclocals·<span class="token number">33</span>cdeccccebe80329f1fdbee7f5874cb<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>
        <span class="token number">0x0014</span> <span class="token number">00020</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVQ    $<span class="token number">10</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>SP<span class="token punctuation">)</span>    <span class="token comment">// 10入栈</span>
        <span class="token number">0x001c</span> <span class="token number">00028</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVQ    $<span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>   <span class="token comment">// 11入栈</span>
        <span class="token number">0x0025</span> <span class="token number">00037</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVQ    $<span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>  <span class="token comment">// 12入栈</span>
        <span class="token number">0x002e</span> <span class="token number">00046</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">1</span><span class="token punctuation">,</span> AX       <span class="token comment">// 1存入AX</span>
        <span class="token number">0x0033</span> <span class="token number">00051</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">2</span><span class="token punctuation">,</span> BX       <span class="token comment">// 2存入BX</span>
        <span class="token number">0x0038</span> <span class="token number">00056</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">3</span><span class="token punctuation">,</span> CX       <span class="token comment">// 3存入CX</span>
        <span class="token number">0x003d</span> <span class="token number">00061</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">4</span><span class="token punctuation">,</span> DI       <span class="token comment">// 4存入DI</span>
        <span class="token number">0x0042</span> <span class="token number">00066</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">5</span><span class="token punctuation">,</span> SI       <span class="token comment">// 5存入SI</span>
        <span class="token number">0x0047</span> <span class="token number">00071</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">6</span><span class="token punctuation">,</span> R8       <span class="token comment">// 6存入R8</span>
        <span class="token number">0x004d</span> <span class="token number">00077</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">7</span><span class="token punctuation">,</span> R9       <span class="token comment">// 7存入R9</span>
        <span class="token number">0x0053</span> <span class="token number">00083</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">8</span><span class="token punctuation">,</span> R10      <span class="token comment">// 8存入R10</span>
        <span class="token number">0x0059</span> <span class="token number">00089</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        MOVL    $<span class="token number">9</span><span class="token punctuation">,</span> R11      <span class="token comment">// 9存入R11</span>
        <span class="token number">0x005f</span> <span class="token number">00095</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        PCDATA  $<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">0</span>
        <span class="token number">0x005f</span> <span class="token number">00095</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        NOP
        <span class="token number">0x0060</span> <span class="token number">00096</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">)</span>        CALL    <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">myFunction</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span>
        <span class="token number">0x0065</span> <span class="token number">00101</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span>        MOVQ    <span class="token number">120</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> BP
        <span class="token number">0x006a</span> <span class="token number">00106</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span>        SUBQ    $<span class="token operator">-</span><span class="token number">128</span><span class="token punctuation">,</span> SP
        <span class="token number">0x006e</span> <span class="token number">00110</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">9</span><span class="token punctuation">)</span>        RET

</code></pre> 
<p>再看返回值，可以发现返回值也是前9个利用相同的寄存器返回的，但是如果返回值超过9，剩下的也是用栈返回的，注意是在入参栈的下面再开辟栈，所以不会占据传参的栈。</p> 
<pre><code class="prism language-c"><span class="token string">""</span><span class="token punctuation">.</span>myFunction STEXT nosplit size<span class="token operator">=</span><span class="token number">399</span> args<span class="token operator">=</span><span class="token number">0x78</span> locals<span class="token operator">=</span><span class="token number">0x50</span> funcid<span class="token operator">=</span><span class="token number">0x0</span>
   <span class="token number">0x0000</span> <span class="token number">00000</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   TEXT   <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">myFunction</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span><span class="token punctuation">,</span> NOSPLIT<span class="token operator">|</span>ABIInternal<span class="token punctuation">,</span> $<span class="token number">80</span><span class="token operator">-</span><span class="token number">120</span>
   <span class="token number">0x0000</span> <span class="token number">00000</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   SUBQ   $<span class="token number">80</span><span class="token punctuation">,</span> SP <span class="token comment">// SP 先减去0x80</span>
   <span class="token number">0x0004</span> <span class="token number">00004</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   BP<span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0009</span> <span class="token number">00009</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   LEAQ   <span class="token number">72</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> BP
   <span class="token number">0x000e</span> <span class="token number">00014</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   FUNCDATA   $<span class="token number">0</span><span class="token punctuation">,</span> gclocals·<span class="token number">33</span>cdeccccebe80329f1fdbee7f5874cb<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>
   <span class="token number">0x000e</span> <span class="token number">00014</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   FUNCDATA   $<span class="token number">1</span><span class="token punctuation">,</span> gclocals·<span class="token number">33</span>cdeccccebe80329f1fdbee7f5874cb<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>
   <span class="token number">0x000e</span> <span class="token number">00014</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   FUNCDATA   $<span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>myFunction<span class="token punctuation">.</span><span class="token function">arginfo1</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span>
   <span class="token number">0x000e</span> <span class="token number">00014</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   AX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>a<span class="token operator">+</span><span class="token number">136</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0016</span> <span class="token number">00022</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   BX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>b<span class="token operator">+</span><span class="token number">144</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x001e</span> <span class="token number">00030</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   CX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>c<span class="token operator">+</span><span class="token number">152</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0026</span> <span class="token number">00038</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   DI<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>d<span class="token operator">+</span><span class="token number">160</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x002e</span> <span class="token number">00046</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   SI<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>e<span class="token operator">+</span><span class="token number">168</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0036</span> <span class="token number">00054</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   R8<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>f<span class="token operator">+</span><span class="token number">176</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x003e</span> <span class="token number">00062</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   R9<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>g<span class="token operator">+</span><span class="token number">184</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0046</span> <span class="token number">00070</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   R10<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>h<span class="token operator">+</span><span class="token number">192</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x004e</span> <span class="token number">00078</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   R11<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span>i<span class="token operator">+</span><span class="token number">200</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0056</span> <span class="token number">00086</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r12<span class="token operator">+</span><span class="token number">64</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x005f</span> <span class="token number">00095</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r13<span class="token operator">+</span><span class="token number">56</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0068</span> <span class="token number">00104</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r14<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0071</span> <span class="token number">00113</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r15<span class="token operator">+</span><span class="token number">40</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x007a</span> <span class="token number">00122</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r16<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0083</span> <span class="token number">00131</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r17<span class="token operator">+</span><span class="token number">24</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x008c</span> <span class="token number">00140</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r18<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0095</span> <span class="token number">00149</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r19<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x009e</span> <span class="token number">00158</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span><span class="token function">r20</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x00a6</span> <span class="token number">00166</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r21<span class="token operator">+</span><span class="token number">112</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x00af</span> <span class="token number">00175</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r22<span class="token operator">+</span><span class="token number">120</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x00b8</span> <span class="token number">00184</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">)</span>   MOVQ   $<span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r23<span class="token operator">+</span><span class="token number">128</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x00c4</span> <span class="token number">00196</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>a<span class="token operator">+</span><span class="token number">136</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x00cc</span> <span class="token number">00204</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r12<span class="token operator">+</span><span class="token number">64</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x00d1</span> <span class="token number">00209</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>b<span class="token operator">+</span><span class="token number">144</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x00d9</span> <span class="token number">00217</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r13<span class="token operator">+</span><span class="token number">56</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x00de</span> <span class="token number">00222</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>c<span class="token operator">+</span><span class="token number">152</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x00e6</span> <span class="token number">00230</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r14<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x00eb</span> <span class="token number">00235</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>d<span class="token operator">+</span><span class="token number">160</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x00f3</span> <span class="token number">00243</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r15<span class="token operator">+</span><span class="token number">40</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x00f8</span> <span class="token number">00248</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>e<span class="token operator">+</span><span class="token number">168</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x0100</span> <span class="token number">00256</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r16<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0105</span> <span class="token number">00261</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>f<span class="token operator">+</span><span class="token number">176</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x010d</span> <span class="token number">00269</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r17<span class="token operator">+</span><span class="token number">24</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0112</span> <span class="token number">00274</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>g<span class="token operator">+</span><span class="token number">184</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x011a</span> <span class="token number">00282</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r18<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x011f</span> <span class="token number">00287</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>h<span class="token operator">+</span><span class="token number">192</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x0127</span> <span class="token number">00295</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r19<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x012c</span> <span class="token number">00300</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>i<span class="token operator">+</span><span class="token number">200</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x0134</span> <span class="token number">00308</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span><span class="token function">r20</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
   <span class="token number">0x0138</span> <span class="token number">00312</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>j<span class="token operator">+</span><span class="token number">88</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x013d</span> <span class="token number">00317</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r21<span class="token operator">+</span><span class="token number">112</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token comment">// 第10个返回值</span>
   <span class="token number">0x0142</span> <span class="token number">00322</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>k<span class="token operator">+</span><span class="token number">96</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x0147</span> <span class="token number">00327</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r22<span class="token operator">+</span><span class="token number">120</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token comment">// 第11个返回值</span>
   <span class="token number">0x014c</span> <span class="token number">00332</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span>l<span class="token operator">+</span><span class="token number">104</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DX
   <span class="token number">0x0151</span> <span class="token number">00337</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   DX<span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r23<span class="token operator">+</span><span class="token number">128</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token comment">// 第12个返回值</span>
   <span class="token number">0x0159</span> <span class="token number">00345</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r12<span class="token operator">+</span><span class="token number">64</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> AX <span class="token comment">// 第1个返回值</span>
   <span class="token number">0x015e</span> <span class="token number">00350</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r13<span class="token operator">+</span><span class="token number">56</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> BX <span class="token comment">// 第2个返回值</span>
   <span class="token number">0x0163</span> <span class="token number">00355</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r14<span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> CX <span class="token comment">// 第3个返回值</span>
   <span class="token number">0x0168</span> <span class="token number">00360</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r15<span class="token operator">+</span><span class="token number">40</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> DI <span class="token comment">// 第4个返回值</span>
   <span class="token number">0x016d</span> <span class="token number">00365</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r16<span class="token operator">+</span><span class="token number">32</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> SI <span class="token comment">// 第5个返回值</span>
   <span class="token number">0x0172</span> <span class="token number">00370</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r17<span class="token operator">+</span><span class="token number">24</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> R8 <span class="token comment">// 第6个返回值</span>
   <span class="token number">0x0177</span> <span class="token number">00375</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r18<span class="token operator">+</span><span class="token number">16</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> R9 <span class="token comment">// 第7个返回值</span>
   <span class="token number">0x017c</span> <span class="token number">00380</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span>r19<span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> R10 <span class="token comment">// 第8个返回值</span>
   <span class="token number">0x0181</span> <span class="token number">00385</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token string">""</span><span class="token punctuation">.</span><span class="token operator">~</span><span class="token function">r20</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> R11   <span class="token comment">// 第9个返回值</span>
   <span class="token number">0x0185</span> <span class="token number">00389</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   MOVQ   <span class="token number">72</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> BP
   <span class="token number">0x018a</span> <span class="token number">00394</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   ADDQ   $<span class="token number">80</span><span class="token punctuation">,</span> SP
   <span class="token number">0x018e</span> <span class="token number">00398</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">4</span><span class="token punctuation">)</span>   RET

</code></pre> 
<p>其中，Go使用的是Plan9汇编，其和C语言直接使用的x86_64的寄存器对比如下表：<br> <img src="https://images2.imgbox.com/11/d5/x5YEe4yg_o.png" alt="在这里插入图片描述"><br> 总结如下：</p> 
<ul><li>当Go语言的函数传参和返回值在9个及以下时，按顺序使用AX、BX、CX、DI、SI、R8、R9、R10和R11作为传递的寄存器，注意传参和返回值一致；</li><li>当Go语言的函数传参和返回值大于9个时，多于9个的部分使用栈传递；</li></ul> 
<h3><a id="21__237"></a>2.1 结构体参数如何传参</h3> 
<p>当结构体中的参数能够被寄存器装下时，则采用寄存器传递结构体中的参数。</p> 
<p>如下代码：</p> 
<pre><code class="prism language-c">package main

type Request <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
   a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> i <span class="token keyword">int</span>
<span class="token punctuation">}</span>

type Response <span class="token keyword">struct</span> <span class="token punctuation">{<!-- --></span>
   a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">,</span> e<span class="token punctuation">,</span> f<span class="token punctuation">,</span> g<span class="token punctuation">,</span> h<span class="token punctuation">,</span> i <span class="token keyword">int</span>
<span class="token punctuation">}</span>

func <span class="token function">myFunction</span><span class="token punctuation">(</span>req Request<span class="token punctuation">)</span> Response <span class="token punctuation">{<!-- --></span>
   <span class="token keyword">return</span> Response<span class="token punctuation">{<!-- --></span>
      a<span class="token operator">:</span> req<span class="token punctuation">.</span>a<span class="token punctuation">,</span>
      b<span class="token operator">:</span> req<span class="token punctuation">.</span>b<span class="token punctuation">,</span>
      c<span class="token operator">:</span> req<span class="token punctuation">.</span>c<span class="token punctuation">,</span>
      d<span class="token operator">:</span> req<span class="token punctuation">.</span>d<span class="token punctuation">,</span>
      e<span class="token operator">:</span> req<span class="token punctuation">.</span>e<span class="token punctuation">,</span>
      f<span class="token operator">:</span> req<span class="token punctuation">.</span>f<span class="token punctuation">,</span>
      g<span class="token operator">:</span> req<span class="token punctuation">.</span>g<span class="token punctuation">,</span>
      h<span class="token operator">:</span> req<span class="token punctuation">.</span>h<span class="token punctuation">,</span>
      i<span class="token operator">:</span> req<span class="token punctuation">.</span>i<span class="token punctuation">,</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   <span class="token function">myFunction</span><span class="token punctuation">(</span>Request<span class="token punctuation">{<!-- --></span>
      a<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      b<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      c<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span>
      d<span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
      e<span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span>
      f<span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span>
      g<span class="token operator">:</span> <span class="token number">7</span><span class="token punctuation">,</span>
      h<span class="token operator">:</span> <span class="token number">8</span><span class="token punctuation">,</span>
      i<span class="token operator">:</span> <span class="token number">9</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>编译后的代码是：</p> 
<pre><code class="prism language-c"><span class="token string">""</span><span class="token punctuation">.</span>main STEXT size<span class="token operator">=</span><span class="token number">91</span> args<span class="token operator">=</span><span class="token number">0x0</span> locals<span class="token operator">=</span><span class="token number">0x50</span> funcid<span class="token operator">=</span><span class="token number">0x0</span>
        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
        <span class="token number">0x0014</span> <span class="token number">00020</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">1</span><span class="token punctuation">,</span> AX
        <span class="token number">0x0019</span> <span class="token number">00025</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">2</span><span class="token punctuation">,</span> BX
        <span class="token number">0x001e</span> <span class="token number">00030</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">3</span><span class="token punctuation">,</span> CX
        <span class="token number">0x0023</span> <span class="token number">00035</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">4</span><span class="token punctuation">,</span> DI
        <span class="token number">0x0028</span> <span class="token number">00040</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">5</span><span class="token punctuation">,</span> SI
        <span class="token number">0x002d</span> <span class="token number">00045</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">6</span><span class="token punctuation">,</span> R8
        <span class="token number">0x0033</span> <span class="token number">00051</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">7</span><span class="token punctuation">,</span> R9
        <span class="token number">0x0039</span> <span class="token number">00057</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">8</span><span class="token punctuation">,</span> R10
        <span class="token number">0x003f</span> <span class="token number">00063</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       MOVL    $<span class="token number">9</span><span class="token punctuation">,</span> R11
        <span class="token number">0x0045</span> <span class="token number">00069</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       PCDATA  $<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">0</span>
        <span class="token number">0x0045</span> <span class="token number">00069</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       CALL    <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">myFunction</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span>

</code></pre> 
<p>如果我们增加一个结构体参数，就会看到以下的传参，通过DUFFCOPY拷贝到栈中。</p> 
<pre><code class="prism language-c"><span class="token string">""</span><span class="token punctuation">.</span>main STEXT size<span class="token operator">=</span><span class="token number">73</span> args<span class="token operator">=</span><span class="token number">0x0</span> locals<span class="token operator">=</span><span class="token number">0x58</span> funcid<span class="token operator">=</span><span class="token number">0x0</span>
        <span class="token number">0x0000</span> <span class="token number">00000</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       TEXT    <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">main</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span><span class="token punctuation">,</span> ABIInternal<span class="token punctuation">,</span> $<span class="token number">88</span><span class="token operator">-</span><span class="token number">0</span>
        <span class="token number">0x0000</span> <span class="token number">00000</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       CMPQ    SP<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">(</span>R14<span class="token punctuation">)</span>
        <span class="token number">0x0004</span> <span class="token number">00004</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       PCDATA  $<span class="token number">0</span><span class="token punctuation">,</span> $<span class="token operator">-</span><span class="token number">2</span>
        <span class="token number">0x0004</span> <span class="token number">00004</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       JLS     <span class="token number">66</span>
        <span class="token number">0x0006</span> <span class="token number">00006</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       PCDATA  $<span class="token number">0</span><span class="token punctuation">,</span> $<span class="token operator">-</span><span class="token number">1</span>
        <span class="token number">0x0006</span> <span class="token number">00006</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       SUBQ    $<span class="token number">88</span><span class="token punctuation">,</span> SP
        <span class="token number">0x000a</span> <span class="token number">00010</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       MOVQ    BP<span class="token punctuation">,</span> <span class="token number">80</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span>
        <span class="token number">0x000f</span> <span class="token number">00015</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       LEAQ    <span class="token number">80</span><span class="token punctuation">(</span>SP<span class="token punctuation">)</span><span class="token punctuation">,</span> BP
        <span class="token number">0x0014</span> <span class="token number">00020</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       FUNCDATA        $<span class="token number">0</span><span class="token punctuation">,</span> gclocals·<span class="token number">33</span>cdeccccebe80329f1fdbee7f5874cb<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>
        <span class="token number">0x0014</span> <span class="token number">00020</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">25</span><span class="token punctuation">)</span>       FUNCDATA        $<span class="token number">1</span><span class="token punctuation">,</span> gclocals·<span class="token number">33</span>cdeccccebe80329f1fdbee7f5874cb<span class="token punctuation">(</span>SB<span class="token punctuation">)</span>
        <span class="token number">0x0014</span> <span class="token number">00020</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">38</span><span class="token punctuation">)</span>       MOVQ    SP<span class="token punctuation">,</span> DI
        <span class="token number">0x0017</span> <span class="token number">00023</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       LEAQ    <span class="token string">""</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">stmp_1</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span><span class="token punctuation">,</span> SI
        <span class="token number">0x001e</span> <span class="token number">00030</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       PCDATA  $<span class="token number">0</span><span class="token punctuation">,</span> $<span class="token operator">-</span><span class="token number">2</span>
        <span class="token number">0x001e</span> <span class="token number">00030</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       NOP
        <span class="token number">0x0020</span> <span class="token number">00032</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       DUFFCOPY        $<span class="token number">826</span>
        <span class="token number">0x0033</span> <span class="token number">00051</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       PCDATA  $<span class="token number">0</span><span class="token punctuation">,</span> $<span class="token operator">-</span><span class="token number">1</span>
        <span class="token number">0x0033</span> <span class="token number">00051</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       PCDATA  $<span class="token number">1</span><span class="token punctuation">,</span> $<span class="token number">0</span>
        <span class="token number">0x0033</span> <span class="token number">00051</span> <span class="token punctuation">(</span>main<span class="token punctuation">.</span>go<span class="token operator">:</span><span class="token number">26</span><span class="token punctuation">)</span>       CALL    <span class="token string">""</span><span class="token punctuation">.</span><span class="token function">myFunction</span><span class="token punctuation">(</span>SB<span class="token punctuation">)</span>

</code></pre> 
<h3><a id="22__324"></a>2.2 浮点型如何传参</h3> 
<p>浮点型参数。由于amd 64架构中，浮点型数据的编码与整形数据编码大不相同，而浮点数的运算会使用专用寄存器和指令。所以浮点数不会使用这9个通用寄存器来传递，而是使用这15个XMM寄存器来传递。这组XMM寄存器是随着多媒体相关的指令集一起引入的,go 语言使用它们来处理浮点数。前15个浮点型参数会依次使用x0到x14这15个寄存器来传递。<br> 如果还有就要使用栈来传递了。</p> 
<h2><a id="3_Go_328"></a>3. Go语言的参数传递</h2> 
<p>Go中只有传值调用，没有传引用调用！<br> 至于为什么有些操作看起来就像传指针一样，需要明确的是：</p> 
<p>切片复制，结构体的底层指针指向同一个地址，所以修改切片已有值会影响原切片底层数组的值，但是append操作不会；<br> 字符串复制和切片复制类似，但是其底层数组值不可修改；<br> map本质上就是一个指针，所以看起来像传引用，实际上还是传值，只不过这个值是指针；<br> channel本质上也是个指针；<br> 结构体传值时也会复制对象，所以太大的结构体最好采用指针传值调用。bi</p> 
<h2><a id="4__337"></a>4 闭包</h2> 
<p>闭包的本质是函数+引用环境，如下，incr函数返回一个匿名函数，其含有一个局部变量i，这个局部变量会发生逃逸。</p> 
<pre><code class="prism language-c">package main

import <span class="token string">"fmt"</span>

func <span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">int</span> <span class="token punctuation">{<!-- --></span>
   var i <span class="token keyword">int</span>
   <span class="token keyword">return</span> <span class="token function">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">int</span> <span class="token punctuation">{<!-- --></span>
      i<span class="token operator">++</span>
      <span class="token keyword">return</span> i
   <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

func <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
   incr1<span class="token punctuation">,</span> incr2 <span class="token operator">:</span><span class="token operator">=</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">incr1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">incr1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">incr1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">incr2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">incr2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
   fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token function">incr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>以上代码执行的结果是：</p> 
<pre><code class="prism language-c"><span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">3</span>
<span class="token number">1</span>
<span class="token number">2</span>
<span class="token number">0x104400280</span>
<span class="token number">1</span>

</code></pre> 
<p>当执行incr1, incr2 := incr(), incr()时就会生成两个闭包，可以想象，闭包incr1和incr2保存这个一个对i的引用，可以理解为incr1有一个指向i的指针。<br> incr()是一个函数，打印的是一个函数地址；incr()()是这个函数执行，打印的是这个函数的执行结果。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/602aff35a2567e0360932abad8e79a7e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">推荐 5 个本周很火的 GitHub 项目</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1481c2d2ea71aa9ffe7651aa47d27368/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">清华叉院提出「GenH2R」框架，用百万场景打造基于视觉的通用人机交接策略</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>