<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Selenium定位不到元素怎么办？一定要这么做 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Selenium定位不到元素怎么办？一定要这么做" />
<meta property="og:description" content="在使用Selenium进行自动化测试时，碰到无法定位元素该怎么办？这里总结了9种情况下的元素定位方法：
1、frame/iframe表单嵌套 WebDriver只能在一个页面上对元素识别与定位，对于frame/iframe表单内嵌的页面元素无法直接定位。
解决方法：
driver.switch_to.frame(id/name/obj) switch_to.frame() 默认可以直接取表单的id或name属性。如果没有可用的id和name属性，可以先定位到frame/iframe，再将定位对象传给 switch_to.frame(对象) 方法。
xf = driver.find_element_by_xpath(&#39;//*[@class=&#34;if&#34;]&#39;) driver.switch_to.frame(xf) ... driver.switch_to.parent_frame() 切到父frame。影响性能，可以提给开发，让其改进。
driver.switch_to.default_content() 跳回最外层的页面
2、页面跳转到新标签页，或弹出警告框等 在页面操作过程中有时候点击某个链接会弹出新窗口，这时就需要切换焦点到新窗口上进行操作。
解决方法1：
driver.switch_to.window(window_handle) //切换到新窗口 首先获取当前窗口的句柄 driver.current_window_handle，接着打开弹出新窗口，获得当前打开的所有窗口的句柄driver.window_handles 。通过for循环遍历handle，如果不等于第一次打开窗口的句柄，那么一定是新窗口的句柄，因为执行过程只打开了两个窗口；改变条件，如果等于第一次打开窗口的句柄，那么可以切换回第一次打开的窗口。
解决方法2：
对于JavaScript生成的alert、confirm以及prompt，无法使用前端工具对弹出窗口进行定位的，使用driver.switch_to.alert 方法定位弹出框。
alert的方法有：
.accept() 等同于点击“确认”或“OK”
.dismiss() 等同于点击“取消”或“Cancel”
.text 获取alert文本内容，对有信息显示的alert框
.send_keys(text) 发送文本，对有提交需求的prompt框
.authenticate(username,password) 验证，针对需要身份验证的alert
3、页面元素失去焦点导致脚本运行不稳定 解决方法：
driver.switch_to.active_element 遇到脚本不稳定，有时会失去焦点导致测试失败的情况下，可以先切到焦点元素再进行操作。注意：.active_element后面不带括号()。
下面是一个参考案例：
driver.find_element_by_class_name(&#39;fnew&#39;).click() time.sleep(2) driver.switch_to.active_element.send_keys(&#39;filename&#39;) time.sleep(2) 4、使用Xpath或CSS定位 find_element_by_xpath(&#34;//标签[属性=&#39;值&#39;]&#34;) 使用Xpath/CSS方法，非常适合定位属性值动态生成、不容易定位的元素。如果不想指定标签，则可以使用“*”代替，使用xpath不局限于id、name和class这三个属性，元素的任意属性值都可以使用，只要它能唯一的标识一个元素。
解决方法1：
如果一个元素没有唯一属性，那么我们可以一级一级向上查找，直到找到可以唯一定位元素的属性，再向下查找其子元素。
find_element_by_xpath(&#34;//form[@id=&#39;form&#39;]/span[2]/input&#34;) 首先通过唯一标识属性id=form定位最外层元素，接着找到最外层元素下的第2个span标签的元素为父元素，最后向下查找定位到父元素下标签为input的子元素。
解决方法2：
如果一个属性不能唯一地区分一个元素，那么使用多个属性来唯一地定位一个元素。
find_element_by_xpath(&#34;//input[@id=&#39;kw&#39;and@class=&#39;su&#39;]/span/input&#34;) 首先找到标签为input，id=kw且class=su的元素，接着找到其下标签为span的子元素，继续向下查找找到标签为input的子元素。
解决方法3：
检查Xpath描述是否有误，导致无法定位到元素。
5、页面还没加载出来就对页面上的元素进行操作 因为加载元素延时造成的脚本失败，我们可以通过设置等待时间来提升自动化脚本的稳定性。
解决方法1：
WebDriverWait() 显示等待，等待单个的元素加载，通常配合until()、until_not()方法使用。
WebDriverWait(driver,timeout,poll_frequency=0.5,ignored_exceptions=None) - driver - 传入WebDriver实例，必填 - timeout - 最长等待时间，必填 - poll_frequency - 调用`until`/`until_not`方法的时间间隔，默认为0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0ad45a0d4bcc8c9e24029d77bb11a3f3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-20T20:00:00+08:00" />
<meta property="article:modified_time" content="2023-11-20T20:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Selenium定位不到元素怎么办？一定要这么做</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" height="644" src="https://images2.imgbox.com/19/00/VqWI4JGj_o.jpg" width="1144"></p> 
<p>在使用Selenium进行自动化测试时，碰到无法定位元素该怎么办？这里总结了9种情况下的元素定位方法：</p> 
<h4 id="1%E3%80%81frame%2Fiframe%E8%A1%A8%E5%8D%95%E5%B5%8C%E5%A5%97"><a name="t0"></a><strong>1、frame/iframe表单嵌套</strong></h4> 
<p>WebDriver只能在一个页面上对元素识别与定位，对于frame/<a href="https://so.csdn.net/so/search?q=iframe&amp;spm=1001.2101.3001.7020" title="iframe">iframe</a>表单内嵌的页面元素无法直接定位。</p> 
<p><strong>解决方法：</strong></p> 
<pre><code class="language-python">driver.switch_to.frame(id/name/obj)</code></pre> 
<p>switch_to.frame() 默认可以直接取表单的id或name属性。如果没有可用的id和name属性，可以先定位到frame/iframe，再将定位对象传给 switch_to.frame(对象) 方法。</p> 
<pre><code class="language-python">xf = driver.find_element_by_xpath('//*[@class="if"]')
driver.switch_to.frame(xf)
...</code></pre> 
<p><strong>driver.switch_to.parent_frame()</strong> 切到父frame。影响性能，可以提给开发，让其改进。<br><strong>driver.switch_to.default_content() </strong>跳回最外层的页面</p> 
<h4 id="2%E3%80%81%E9%A1%B5%E9%9D%A2%E8%B7%B3%E8%BD%AC%E5%88%B0%E6%96%B0%E6%A0%87%E7%AD%BE%E9%A1%B5%EF%BC%8C%E6%88%96%E5%BC%B9%E5%87%BA%E8%AD%A6%E5%91%8A%E6%A1%86%E7%AD%89"><strong>2、页面跳转到新标签页，或弹出警告框等</strong></h4> 
<p>在页面操作过程中有时候点击某个链接会弹出新窗口，这时就需要切换焦点到新窗口上进行操作。</p> 
<p><strong>解决方法1：</strong></p> 
<pre><code class="language-python">driver.switch_to.window(window_handle)  //切换到新窗口</code></pre> 
<p>首先获取当前窗口的句柄 driver.current_window_handle，接着打开弹出新窗口，获得当前打开的所有窗口的句柄driver.window_handles 。通过for循环遍历handle，如果不等于第一次打开窗口的句柄，那么一定是新窗口的句柄，因为执行过程只打开了两个窗口；改变条件，如果等于第一次打开窗口的句柄，那么可以切换回第一次打开的窗口。</p> 
<p><strong>解决方法2：</strong></p> 
<p>对于JavaScript生成的alert、confirm以及prompt，无法使用前端工具对弹出窗口进行定位的，使用driver.switch_to.alert 方法定位弹出框。</p> 
<p>alert的方法有：</p> 
<p>.accept() 等同于点击“确认”或“OK”<br> .dismiss() 等同于点击“取消”或“Cancel”<br> .text 获取alert文本内容，对有信息显示的alert框<br> .send_keys(text) 发送文本，对有提交需求的prompt框<br> .authenticate(username,password) 验证，针对需要身份验证的alert</p> 
<h4 id="3%E3%80%81%E9%A1%B5%E9%9D%A2%E5%85%83%E7%B4%A0%E5%A4%B1%E5%8E%BB%E7%84%A6%E7%82%B9%E5%AF%BC%E8%87%B4%E8%84%9A%E6%9C%AC%E8%BF%90%E8%A1%8C%E4%B8%8D%E7%A8%B3%E5%AE%9A"><strong>3、页面元素失去焦点导致脚本运行不稳定</strong></h4> 
<p><strong>解决方法：</strong></p> 
<p><strong>driver.switch_to.active_element</strong> 遇到脚本不稳定，有时会<a href="https://so.csdn.net/so/search?q=%E5%A4%B1%E5%8E%BB%E7%84%A6%E7%82%B9&amp;spm=1001.2101.3001.7020" title="失去焦点">失去焦点</a>导致测试失败的情况下，可以先切到焦点元素再进行操作。注意：<strong>.active_element后面不带括号()</strong>。</p> 
<p>下面是一个参考案例：</p> 
<pre><code class="language-python">driver.find_element_by_class_name('fnew').click()
time.sleep(2)
driver.switch_to.active_element.send_keys('filename')
time.sleep(2)</code></pre> 
<h4 id="4%E3%80%81%E4%BD%BF%E7%94%A8Xpath%E6%88%96CSS%E5%AE%9A%E4%BD%8D"><strong>4、使用Xpath或CSS定位</strong></h4> 
<pre><code>find_element_by_xpath("//标签[属性='值']")</code></pre> 
<p>使用Xpath/CSS方法，非常适合定位属性值动态生成、不容易定位的元素。如果不想指定标签，则可以使用“*”代替，使用xpath不局限于id、name和class这三个属性，元素的任意属性值都可以使用，只要它能唯一的标识一个元素。</p> 
<p><strong>解决方法1：</strong></p> 
<p>如果一个元素没有唯一属性，那么我们可以一级一级向上查找，直到找到可以唯一定位元素的属性，再向下查找其子元素。</p> 
<pre><code>find_element_by_xpath("//form[@id='form']/span[2]/input")</code></pre> 
<p>首先通过唯一标识属性id=form定位最外层元素，接着找到最外层元素下的第2个span标签的元素为父元素，最后向下查找定位到父元素下标签为input的子元素。</p> 
<p><strong>解决方法2：</strong></p> 
<p>如果一个属性不能唯一地区分一个元素，那么使用多个属性来唯一地定位一个元素。</p> 
<pre><code class="language-python">find_element_by_xpath("//input[@id='kw'and@class='su']/span/input") </code></pre> 
<p>首先找到标签为input，id=kw且class=su的元素，接着找到其下标签为span的子元素，继续向下查找找到标签为input的子元素。</p> 
<p><strong>解决方法3：</strong></p> 
<p>检查Xpath描述是否有误，导致无法定位到元素。</p> 
<h4>5、页面还没加载出来就对页面上的元素进行操作</h4> 
<p>因为加载元素延时造成的脚本失败，我们可以通过设置等待时间来提升自动化脚本的稳定性。</p> 
<p><strong>解决方法1：</strong></p> 
<p>WebDriverWait() 显示等待，等待单个的元素加载，通常配合until()、until_not()方法使用。</p> 
<pre><code class="language-python">WebDriverWait(driver,timeout,poll_frequency=0.5,ignored_exceptions=None)
- driver - 传入WebDriver实例，必填
- timeout - 最长等待时间，必填
- poll_frequency - 调用`until`/`until_not`方法的时间间隔，默认为0.5秒，可省。
- ignored_exceptions - 忽略异常，默认仅包含NoSuchElementException，可省。</code></pre> 
<pre><code class="language-python">WebDriverWait(driver,10).until(method,message='')     '等待目标出现'
WebDriverWait(driver,5,1).until_not(method,message='')    '等待目标消失'
- method - 必填。
- message - 默认为空，可省。如果超时，抛出TimeoutException，返回message信息。</code></pre> 
<p>即：</p> 
<p>WebDriverWait(driver, 超时时长, 调用频率, 忽略异常).until(可执行方法, 超时时返回的信息)</p> 
<pre><code class="language-python">WebDriverWait(driver,5,1).until(expected_conditions.presence_of_element_located(By.ID,'kw'))</code></pre> 
<p>最长等待时间为5s，每隔1秒检查一次id='kw'的元素是否被加载在DOM树里（并不代表该元素一定可见）。最常用的method是expected_conditions类提供的预期条件判断。</p> 
<pre><code class="language-python">is_disappeared= WebDriverWait(driver, 30, 1, (ElementNotVisibleException)).until_not(lambda x: x.find_element_by_id('someId').is_displayed())</code></pre> 
<p>最长等待时间为30s，每隔1秒检查一次id='someId'的元素是否从DOM树里消失，忽略默认异常信息NoSuchElementException 和指定的异常信息 ElementNotVisibleException 。</p> 
<p><strong>解决方法2：</strong></p> 
<p>driver.implicitly_wait(秒) 隐式等待。全局等待，对所有元素设置超时时间，等待页面的加载，因此只需要设置一次即可。这里的时间是最长等待时间（非固定等待时间）。</p> 
<p><strong>解决方法3：</strong></p> 
<p>sleep(秒) 线程等待。休眠固定的时间，使用时需要先引入time模块的sleep方法from time import sleep。</p> 
<h4 id="6%E3%80%81%E5%85%83%E7%B4%A0%E8%A2%AB%E9%81%AE%E6%8C%A1%EF%BC%8C%E4%B8%8D%E5%8F%AF%E7%94%A8%EF%BC%8C%E4%B8%8D%E5%8F%AF%E8%A7%81"><strong>6、元素被遮挡，不可用，不可见</strong></h4> 
<p><strong>解决方法1：</strong></p> 
<p>driver.maximize_window() 由于窗口大小改变引起的页面元素布局发生变化，被测元素被遮挡，可以先将窗口最大化，再进行元素定位。</p> 
<p><strong>解决方法2：</strong></p> 
<p>.is_enabled() 由于业务原因元素在某些情况下不可用（元素属性disabled，灰显），首先检查测试步骤是否符合业务逻辑，其次确认是否为业务流程上的Bug。</p> 
<p><strong>解决方法3：</strong></p> 
<p>.is_displayed() 对于属性不一定可见的元素，在定位前首先判断其属性是否可见，是否被隐藏。</p> 
<p><strong>解决方法4：</strong></p> 
<p>由于布局不合理导致的元素被遮盖、或是元素本身缺失引起的无法定位问题属于Bug，可以提给开发让其改进。</p> 
<h4><strong>7、用WebDriver调用JavaScript代码代替无法实现的功能</strong></h4> 
<p>对于有些WebDriver没有提供的方法或者无法实现的功能，WebDriver提供了 driver.execute_script() 方法来执行JavaScript代码。</p> 
<p><strong>解决方法：</strong></p> 
<p>如果页面内容过长，窗口最大化也无法查看到所有元素，可以通过执行JavaScript脚本实现滚动条的拖动等动作。</p> 
<pre><code class="language-python">driver.execute_script("window.scrollTo(0, document.body.scrollHeight);")</code></pre> 
<p>以上语句实现了拉动页面到底部的功能，其中 <strong>window.scrollTo(左边距，上边距) </strong>是JavaScript中用于设置浏览器窗口滚动条的水平和垂直位置的代码。</p> 
<pre><code class="language-python">text = "input text"
driver.execute_script("var obj=document.getElementById('text'); obj.value=' " + text + " ';")</code></pre> 
<p>假设一个输入框可以通过id='text'将其定位，却不能通过send_keys()输入文本内容，可以借助JavaScript代码来实现。</p> 
<h4>8、WebDriver无法操作Windows控件</h4> 
<p>文件的普通上传和下载，可以通过..send_keys（'本地路径'）和find_element_by_partial_link_text('下载链接名').click()实现。</p> 
<p><strong>解决方法：</strong></p> 
<p>对于插件上传，需要操作Windows控件的，可以通过安装AutoIt工具、编写脚本、保存为“.au3”文件、转换成“.exe”文件，再由自动化脚本os.system("D:\upfile.exe")实现上传/下载。</p> 
<p>虽然这种方法可以解决文件上传、下载的操作问题，但是并不推荐。因为通过python调用exe程序并不在python的可控范围内，执行多长时间，执行过程是否出错，都无从自动化过程得知。</p> 
<h4 id="9%E3%80%81firefox%E5%AE%89%E5%85%A8%E6%80%A7%E5%BC%BA%EF%BC%8C%E4%B8%8D%E5%85%81%E8%AE%B8%E8%B7%A8%E5%9F%9F%E8%B0%83%E7%94%A8%E5%87%BA%E7%8E%B0%E6%8A%A5%E9%94%99"><strong>9、firefox安全性强，不允许跨域调用出现报错</strong></h4> 
<p>错误描述：</p> 
<p>uncaught exception: [Exception... "Component returned failure code: 0x80004005 (NS_ERROR_FAILURE) [nsIDOMNSHTMLDocument.execCommand]" nsresult: "0x80004005 (NS_ERROR_FAILURE)" location:</p> 
<p><strong>解决办法：</strong></p> 
<p>Firefox 要取消XMLHttpRequest的跨域限制的话，</p> 
<p>第一是从 about:config 里设置 signed.applets.codebase_principal_support = true；（地址栏输入about:config 即可进行firefox设置）；</p> 
<p>第二就是在open的代码函数前加入类似如下的代码：</p> 
<pre><code class="language-python">try { 
 
 netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead"); 
      } catch (e) { 
      alert("Permission UniversalBrowserRead denied."); 
      }</code></pre> 
<p><strong>最后感谢每一个认真阅读我文章的人，礼尚往来总是要有的，虽然不是什么很值钱的东西，如果你用得到的话可以直接拿走：</strong></p> 
<p><strong><a class="link-info" href="https://www.bilibili.com/read/cv27680653/?spm_id_from=333.999.0.0" rel="nofollow" title="免费领取软件测试+自动化测试全套资料+软件测试面试真题+面试刷题工具+简历模板">免费领取软件测试+自动化测试全套资料+软件测试面试真题+面试刷题工具+简历模板</a></strong></p> 
<h4 id="%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%C2%A0%20%E3%80%90%E4%B8%8B%E9%9D%A2%E6%98%AF%E6%88%91%E6%95%B4%E7%90%86%E7%9A%842023%E5%B9%B4%E6%9C%80%E5%85%A8%E7%9A%84%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E5%B7%A5%E7%A8%8B%E5%B8%88%E5%AD%A6%E4%B9%A0%E7%9F%A5%E8%AF%86%E6%9E%B6%E6%9E%84%E4%BD%93%E7%B3%BB%E5%9B%BE%E3%80%91"><img alt="" height="707" src="https://images2.imgbox.com/13/99/9ekArism_o.png" width="929"></h4> 
<p>这些资料，对于【软件测试】的朋友来说应该是最全面最完整的备战仓库，这个仓库也陪伴上万个测试工程师们走过最艰难的路程，希望也能帮助到你！  </p> 
<p class="img-center"><img alt="" height="126" src="https://images2.imgbox.com/0c/b5/UL5dNORz_o.png" width="634"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9cdac67976a62efd3c2ca676368b031a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用vpn后，不能正常上网或连接vpn</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f623ae898dc2ac0e1fccb2e4eb418499/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JMeter HTTP请求的详细指南，还不知道的快来看</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>