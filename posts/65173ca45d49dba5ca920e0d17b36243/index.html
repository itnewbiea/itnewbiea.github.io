<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>部署ndk环境（废弃） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="部署ndk环境（废弃）" />
<meta property="og:description" content="1.从网上获取android-ndk-r20,首先肯定是要有NDK的包，去http://developers.google.cn谷歌的中国官方网站上面去下.然后配置好环境变量
在配置ndk系统环境变量，添加一个变量名“NDK_ROOT”，值为NDK的路径。
在path中新建%NDK_ROOT%
2.在File---Project Structure中配置好ndk的路径
3.在项目名所在的目录下创建一个jni的文件夹,在这个目录里，添加c/c&#43;&#43;文件
4.在创建好的jni目录下创建一个Android.mk文件，（就是jni所在路径的makefile）
5.在Android.mk中写如下代码
LOCAL_PATH:=$(call my-dir) include $(CLEAR_VARS) #libtestjni.so //生成so的名字 LOCAL_MODULE := testjni //生成模块的规则，生成的so的名字testjni LOCAL_SRC_FILES := test.cpp //生成模块的规则，so依赖的cpp文件可以有多个 LOCAL_LDLIBS := -llog //生成模块的规则，当前so依赖的so include $(BUILD_SHARED_LIBRARY) //生成尾缀是so的文件 6 修改 项目名app/build.gradle
在这个文件中的 android{}作用域中添加如下代码
sourceSets { main.jniLibs { //表示生产的so文件所在路径在什么位置 source { srcDirs = [&#39;../libs&#39;] } } } externalNativeBuild { ndkBuild { //表示构件androidJNI的Android.mk的所在路径 path &#39;../jni/Android.mk&#39; } } 7.在jni路径下创建一个test.cpp，并随便填充点代码，使用Android studio 中的Terminal命令行进入到jni目录下输入ndk-build.cmd，如果能生产so文件说明cpp编译环境成功。
test.cpp代码
void testJni_Hello() { return; } 8.在目录下面创建一个HelloJNI.java的文件夹，创建相关的函数
使用JNI函数的方式
//调用jni函数的方法 HelloJNI.getInstance().hello_jni(); HlloeJNI." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/65173ca45d49dba5ca920e0d17b36243/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-11T02:44:58+08:00" />
<meta property="article:modified_time" content="2019-10-11T02:44:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">部署ndk环境（废弃）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1.从网上获取android-ndk-r20,首先肯定是要有NDK的包，去http://developers.google.cn谷歌的中国官方网站上面去下.然后配置好环境变量</p> 
<p>在配置ndk系统环境变量，添加一个变量名“NDK_ROOT”，值为NDK的路径。</p> 
<p><img alt="" class="has" height="220" src="https://images2.imgbox.com/6a/03/48BDTvYz_o.png" width="838"></p> 
<p>在path中新建%NDK_ROOT%</p> 
<p><img alt="" class="has" height="403" src="https://images2.imgbox.com/72/13/HxDnbHLZ_o.png" width="783"></p> 
<p>2.在File---Project Structure中配置好ndk的路径</p> 
<p><img alt="" class="has" height="460" src="https://images2.imgbox.com/8f/93/E26qXVdz_o.png" width="869"></p> 
<p>3.在项目名所在的目录下创建一个jni的文件夹,在这个目录里，添加c/c++文件</p> 
<p><img alt="" class="has" height="431" src="https://images2.imgbox.com/23/3a/OIelGICW_o.png" width="533"></p> 
<p>4.在创建好的jni目录下创建一个Android.mk文件，（就是jni所在路径的makefile）</p> 
<p>5.在Android.mk中写如下代码</p> 
<pre class="has"><code>LOCAL_PATH:=$(call my-dir)

include $(CLEAR_VARS)

#libtestjni.so  //生成so的名字
LOCAL_MODULE := testjni   //生成模块的规则，生成的so的名字testjni
LOCAL_SRC_FILES := test.cpp   //生成模块的规则，so依赖的cpp文件可以有多个
LOCAL_LDLIBS := -llog    //生成模块的规则，当前so依赖的so

include $(BUILD_SHARED_LIBRARY)   //生成尾缀是so的文件</code></pre> 
<p>6 修改 项目名app/build.gradle<br> 在这个文件中的 android{}作用域中添加如下代码</p> 
<pre class="has"><code>sourceSets {
        main.jniLibs {
            //表示生产的so文件所在路径在什么位置
            source {
                srcDirs = ['../libs']
            }
        }
    }

    externalNativeBuild {
        ndkBuild {
            //表示构件androidJNI的Android.mk的所在路径
            path '../jni/Android.mk'
        }
    }</code></pre> 
<p><img alt="" class="has" height="794" src="https://images2.imgbox.com/3b/1a/yUCG29x4_o.png" width="1200"></p> 
<p>7.在jni路径下创建一个test.cpp，并随便填充点代码，使用Android studio 中的Terminal命令行进入到jni目录下输入ndk-build.cmd，如果能生产so文件说明cpp编译环境成功。</p> 
<p>test.cpp代码</p> 
<pre class="has"><code class="language-cpp">void testJni_Hello()
{
    return;
}</code></pre> 
<p><img alt="" class="has" height="586" src="https://images2.imgbox.com/14/2c/eh1jBy3O_o.png" width="605"></p> 
<p>8.在目录下面创建一个HelloJNI.java的文件夹，创建相关的函数</p> 
<p>使用JNI函数的方式</p> 
<pre class="has"><code class="language-java">//调用jni函数的方法
HelloJNI.getInstance().hello_jni();</code></pre> 
<p>HlloeJNI.java</p> 
<pre class="has"><code class="language-java">package com.ldw.hello;

/**
 * author: ldw
 * created on: 2019/10/11 3:06
 * description:
 */
//专门调用jni C++接口的类
public class HelloJNI {

    private static HelloJNI instance = null;
    //设置一个单例
    public static HelloJNI getInstance() {
        if (instance == null) {
            instance = new HelloJNI();
        }

        return instance;
    }

    //提供一个调用JNI接口的成员方法
    public native void hello_jni();

    //加载cpp给提供的 动态库
    static {
        System.loadLibrary("testjni"); //libtestjni.so
    }
}
</code></pre> 
<p>9.在命令窗口下输入命令javah -jni com.ldw.hello.HelloJNI</p> 
<p><img alt="" class="has" height="244" src="https://images2.imgbox.com/a3/b2/zkRLOBdh_o.png" width="828"></p> 
<p>执行命令以后java目录下生成com_ldw_hello_HelloJNI.h文件</p> 
<p>这样java中的方法hello_jni()对应到c语言中的方法是Java_com_ldw_hello_HelloJNI_hello_1jni</p> 
<p>com_ldw_hello_HelloJNI.h文件内容如下，这个文件都是函数的声明，需要在实现函数test.cpp中实现</p> 
<pre class="has"><code class="language-cpp">/* DO NOT EDIT THIS FILE - it is machine generated */
#include &lt;jni.h&gt;
/* Header for class com_ldw_hello_HelloJNI */

#ifndef _Included_com_ldw_hello_HelloJNI
#define _Included_com_ldw_hello_HelloJNI
#ifdef __cplusplus
extern "C" {
#endif
/*
 * Class:     com_ldw_hello_HelloJNI
 * Method:    hello_jni
 * Signature: ()V
 */
JNIEXPORT void JNICALL Java_com_ldw_hello_HelloJNI_hello_1jni
  (JNIEnv *, jobject);

#ifdef __cplusplus
}
#endif
#endif
</code></pre> 
<p>10.在test.cpp中实现java中hello_jni()的方法</p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a841894b6a6fa8fcbb4aaa21d0da0722/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">winform内调用API</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/11df44eb1ab11fc31b283b6a681a753b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Opencv C&#43;&#43; 判断一个点是否在一个矩形内（RECT）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>