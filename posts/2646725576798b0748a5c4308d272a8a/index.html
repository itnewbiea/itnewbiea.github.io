<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>class06：node获取数据 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="class06：node获取数据" />
<meta property="og:description" content="目录 一、node获取数据-爬虫1. 问题分析2. 初始化3. 安装axios4. 后端引入axios5. 模拟浏览器获取数据6. 返回数据到前端7. 将数据渲染到html页面8. 下载html页面的图片 二、小说爬虫1. 单个页面爬取2. 整个小说爬取 一、node获取数据-爬虫 1. 问题分析 第三节中我们可以在自己的后端设置跨域而访问数据，如果我们要获取别人的数据呢？
比如我们打开baidu搜索图片：
通过上图我们可以获得该页面图片的源码请求URL，复制粘贴该url到浏览器搜索得到源码：
我们可以随便选择一张图片的地址，并复制该地址在浏览器中搜索查看：
图片地址在预览中的位置：data -&gt; xx(数字下标) -&gt; replaceUrl -&gt; 0 -&gt; ObjURL
复制该地址在浏览器中搜索查看：
但是我们如果将该图片地址复制到我们写的html页面用axios发起请求可以获得这张图片吗？
答案是否定的，因为跨域问题。我们不可能去修改baidu的后端，那怎么解决呢？
解决方法：通过我们自己的后端去访问数据，因为后端是不存在跨域问题的。通过我们自己的后端模拟浏览器获取数据之后再返回给我们的前端。而我们知道axios可以作用于node和浏览器中，所以我们使用node通过axios获取数据。
2. 初始化 通过npm init -y 初始化生成json文件：
3. 安装axios npm i axios -S 4. 后端引入axios const axios = require(&#34;axios&#34;); 5. 模拟浏览器获取数据 模拟浏览器，即我们自己的后端通过响应头发送信息告诉baidu后端我们的node是一个浏览器（这里的浏览器相当于后端，没有跨域问题）。
找到baidu的请求标头中的User-Agent和请求标头Accept复制到后端node的header中：
访问地址为标头中的请求URL：
所以js文件代码为：
const axios = require(&#34;axios&#34;); axios({ method: &#34;get&#34;, url: &#34;https://image.baidu.com/search/acjson?tn=resultjson_com&amp;logid=10647297934415395588&amp;ipn=rj&amp;ct=201326592&amp;is=&amp;fp=result&amp;fr=&amp;word=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;queryWord=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&amp;adpicid=&amp;st=&amp;z=&amp;ic=&amp;hd=&amp;latest=&amp;copyright=&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=&amp;istype=&amp;qc=&amp;nc=1&amp;expermode=&amp;nojc=&amp;isAsync=&amp;pn=30&amp;rn=30&amp;gsm=1e&amp;1657702473476=&#34;, // 我node后端要告诉baidu的后端我是一个浏览器来请求数据---后端不会产生跨域问题 // headers 发送给baidu后端的信息 headers: { // 模拟浏览器信息 告诉其他人后端我是一个浏览器 &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/2646725576798b0748a5c4308d272a8a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-20T08:47:08+08:00" />
<meta property="article:modified_time" content="2022-07-20T08:47:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">class06：node获取数据</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#node_1" rel="nofollow">一、node获取数据-爬虫</a></li><li><ul><li><a href="#1__2" rel="nofollow">1. 问题分析</a></li><li><a href="#2__33" rel="nofollow">2. 初始化</a></li><li><a href="#3_axios_40" rel="nofollow">3. 安装axios</a></li><li><a href="#4_axios_46" rel="nofollow">4. 后端引入axios</a></li><li><a href="#5__54" rel="nofollow">5. 模拟浏览器获取数据</a></li><li><a href="#6__108" rel="nofollow">6. 返回数据到前端</a></li><li><a href="#7_html_190" rel="nofollow">7. 将数据渲染到html页面</a></li><li><a href="#8_html_245" rel="nofollow">8. 下载html页面的图片</a></li></ul> 
  </li><li><a href="#_395" rel="nofollow">二、小说爬虫</a></li><li><ul><li><a href="#1__397" rel="nofollow">1. 单个页面爬取</a></li><li><a href="#2__546" rel="nofollow">2. 整个小说爬取</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="node_1"></a>一、node获取数据-爬虫</h2> 
<h3><a id="1__2"></a>1. 问题分析</h3> 
<p>第三节中我们可以在自己的后端设置跨域而访问数据，如果我们要获取别人的数据呢？</p> 
<p>比如我们打开baidu搜索图片：<br> <img src="https://images2.imgbox.com/2f/25/752lobmY_o.png" alt="在这里插入图片描述"></p> 
<p>通过上图我们可以获得该页面图片的源码请求URL，复制粘贴该url到浏览器搜索得到源码：</p> 
<p><img src="https://images2.imgbox.com/c0/61/N1PhYiLV_o.png" alt="在这里插入图片描述"></p> 
<p>我们可以随便选择一张图片的地址，并复制该地址在浏览器中搜索查看：</p> 
<p><strong>图片地址在预览中的位置：data -&gt; xx(数字下标) -&gt; replaceUrl -&gt; 0 -&gt; ObjURL</strong><br> <img src="https://images2.imgbox.com/59/6d/qu6Fr3gh_o.png" alt="在这里插入图片描述"></p> 
<p>复制该地址在浏览器中搜索查看：<br> <img src="https://images2.imgbox.com/aa/31/E35rTZmd_o.png" alt="在这里插入图片描述"></p> 
<p>但是我们如果将该图片地址复制到我们写的html页面用axios发起请求可以获得这张图片吗？</p> 
<p><strong>答案是否定的，因为跨域问题。我们不可能去修改baidu的后端，那怎么解决呢？</strong></p> 
<p><strong>解决方法：通过我们自己的后端去访问数据，因为后端是不存在跨域问题的。通过我们自己的后端模拟浏览器获取数据之后再返回给我们的前端。而我们知道axios可以作用于node和浏览器中，所以我们使用node通过axios获取数据。</strong></p> 
<h3><a id="2__33"></a>2. 初始化</h3> 
<p>通过npm init -y 初始化生成json文件：<br> <img src="https://images2.imgbox.com/89/39/H03ETOwe_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_axios_40"></a>3. 安装axios</h3> 
<pre><code class="prism language-c">npm i axios <span class="token operator">-</span>S
</code></pre> 
<p><img src="https://images2.imgbox.com/98/0a/00lXiGuR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4_axios_46"></a>4. 后端引入axios</h3> 
<pre><code class="prism language-c"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="5__54"></a>5. 模拟浏览器获取数据</h3> 
<p>模拟浏览器，即我们自己的后端通过响应头发送信息告诉baidu后端我们的node是一个浏览器（这里的浏览器相当于后端，没有跨域问题）。</p> 
<p>找到baidu的请求标头中的<strong>User-Agent</strong>和请求标头<strong>Accept</strong>复制到后端node的header中：<br> <img src="https://images2.imgbox.com/eb/fd/De1QlK3w_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/fc/2c/9UXPq71j_o.png" alt="在这里插入图片描述"></p> 
<p><strong>访问地址为标头中的请求URL：</strong></p> 
<p><img src="https://images2.imgbox.com/57/90/7WIPyMuP_o.png" alt="在这里插入图片描述"></p> 
<p><strong>所以js文件代码为：</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"https://image.baidu.com/search/acjson?tn=resultjson_com&amp;logid=10647297934415395588&amp;ipn=rj&amp;ct=201326592&amp;is=&amp;fp=result&amp;fr=&amp;word=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;queryWord=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&amp;adpicid=&amp;st=&amp;z=&amp;ic=&amp;hd=&amp;latest=&amp;copyright=&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=&amp;istype=&amp;qc=&amp;nc=1&amp;expermode=&amp;nojc=&amp;isAsync=&amp;pn=30&amp;rn=30&amp;gsm=1e&amp;1657702473476="</span><span class="token punctuation">,</span>
    <span class="token comment">// 我node后端要告诉baidu的后端我是一个浏览器来请求数据---后端不会产生跨域问题</span>
    <span class="token comment">// headers 发送给baidu后端的信息</span>
    <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 模拟浏览器信息    告诉其他人后端我是一个浏览器</span>
        <span class="token string-property property">"User-Agent"</span><span class="token operator">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.114 Safari/537.36 Edg/103.0.1264.49"</span><span class="token punctuation">,</span>
        <span class="token comment">//   告诉其他后端 我接收的数据格式</span>
        <span class="token string-property property">"Accept"</span><span class="token operator">:</span> <span class="token string">"text/plain, */*; q=0.01"</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>执行js文件获取数据：</strong></p> 
<pre><code class="prism language-c">node app<span class="token punctuation">.</span>js
</code></pre> 
<p><img src="https://images2.imgbox.com/d1/c8/6MWmLX7j_o.png" alt="在这里插入图片描述"></p> 
<p><strong>这样我们就获得了baidu图片的网页数据，可以通过"ctrl + 单击"终端的链接查看图片：</strong></p> 
<p><img src="https://images2.imgbox.com/a6/dd/bHicRKLb_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6__108"></a>6. 返回数据到前端</h3> 
<p>在js文件中引入http模块，创建和开启http服务并设置跨域：</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"http"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 引入http模块    用于创建服务器应用</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 引入 axios 请求数据</span>

<span class="token keyword">let</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 后端设置跨域 允许任何人 能够访问 并返回数据</span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span><span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"3000"</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"启动"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>设置发起请求的地址，当请求该地址时通过axios获取baidu图片的数据(将之前的模拟浏览器的代码复制到条件语句中)：</p> 
<p><strong>这里我设置的请求地址后缀为：/img_baidu</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">if</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">==</span> <span class="token string">"/img_baidu"</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"https://image.baidu.com/search/acjson?tn=resultjson_com&amp;logid=10647297934415395588&amp;ipn=rj&amp;ct=201326592&amp;is=&amp;fp=result&amp;fr=&amp;word=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;queryWord=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&amp;adpicid=&amp;st=&amp;z=&amp;ic=&amp;hd=&amp;latest=&amp;copyright=&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=&amp;istype=&amp;qc=&amp;nc=1&amp;expermode=&amp;nojc=&amp;isAsync=&amp;pn=30&amp;rn=30&amp;gsm=1e&amp;1657702473476="</span><span class="token punctuation">,</span>
        <span class="token comment">// 我node后端要告诉baidu的后端我是一个浏览器来请求数据   后端不会产生跨域问题</span>
        <span class="token comment">// headers 发送给baidu后端的信息</span>
        <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        	<span class="token comment">// 模拟浏览器信息    告诉其他人后端我是一个浏览器</span>
        	<span class="token string-property property">"User-Agent"</span><span class="token operator">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.114 Safari/537.36 Edg/103.0.1264.49"</span><span class="token punctuation">,</span>
        	<span class="token comment">// 告诉其他人后端 我接收的数据格式</span>
        	<span class="token string-property property">"Accept"</span><span class="token operator">:</span> <span class="token string">"text/plain, */*; q=0.01"</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>注意：.then之后要将获取的数据返回前端，且要进行格式转换：</strong></p> 
<pre><code class="prism language-js">res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>前端html的代码：</strong></p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>test<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>get请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        test<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"http://localhost:3000/img_baidu"</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">result</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span> <span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><strong>注意：前端代码中发起请求的地址url要与后端node我们自己设置的一致：/img_baidu；</strong></p> 
<p><strong>alt + B 运行html文件，点击按钮获取数据：</strong><br> <img src="https://images2.imgbox.com/5f/08/I8lrXkBR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7_html_190"></a>7. 将数据渲染到html页面</h3> 
<p>我们知道使用axios时页面中的img标签会自动发起请求，所以我们可以通过循环遍历将图片的链接地址赋值到img标签中的src上，而获得图片地址是通过数组中每一项数据的thumbURL获得的。在html页面.then的回调函数中：</p> 
<pre><code class="prism language-js"><span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>button id<span class="token operator">=</span><span class="token string">"test"</span><span class="token operator">&gt;</span><span class="token keyword">get</span>请求<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h2<span class="token operator">&gt;</span>将我们获取的图片数据加载到页面中<span class="token operator">&lt;</span><span class="token operator">/</span>h2<span class="token operator">&gt;</span>   
    <span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span> 获取后端数据 渲染到前端页面中  渲染到wrap元素中 <span class="token operator">--</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">"wrap"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span>
        test<span class="token punctuation">.</span><span class="token function-variable function">onclick</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"http://localhost:3000/img_baidu"</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span> <span class="token parameter">result</span>  <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">let</span> frg <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createDocumentFragment</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 创建frg文本仓库，否则会重复渲染</span>
                    result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 创建img标签，将地址赋值到img上，再将img 插入文本仓库</span>
                        <span class="token keyword">let</span> img <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">"img"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        img<span class="token punctuation">.</span>src <span class="token operator">=</span> item<span class="token punctuation">.</span>thumbURL<span class="token punctuation">;</span>
                        frg<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//插入元素</span>
                    wrap<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span>frg<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>body<span class="token operator">&gt;</span>
</code></pre> 
<p><strong>注意：在接收到后端返回的数据时，我们要遍历的是数组中每一项的图片，是result.data.data；后端代码与上节一样，未做改变。</strong><br> <img src="https://images2.imgbox.com/3b/8f/4PE6ZBqd_o.png" alt="在这里插入图片描述"></p> 
<p><strong>渲染结果部分截图：</strong><br> <img src="https://images2.imgbox.com/6f/f9/mAHRWw7M_o.png" alt="在这里插入图片描述"></p> 
<p><strong>终端输出：</strong><br> <img src="https://images2.imgbox.com/3b/f0/cDGssvqC_o.png" alt="在这里插入图片描述"><br> 该错误与数据有关，后续讲解。</p> 
<h3><a id="8_html_245"></a>8. 下载html页面的图片</h3> 
<p><strong>在后端axios的.then函数中先通过结构赋值和.的方式获取到所有图片所在的data数组；然后通过循环遍历该数组获取每一项图片的链接地址thumbURL：</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">==</span> <span class="token string">"/img_baidu"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
		<span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
		<span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"https://image.baidu.com/search/acjson?tn=resultjson_com&amp;logid=10647297934415395588&amp;ipn=rj&amp;ct=201326592&amp;is=&amp;fp=result&amp;fr=&amp;word=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;queryWord=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&amp;adpicid=&amp;st=&amp;z=&amp;ic=&amp;hd=&amp;latest=&amp;copyright=&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=&amp;istype=&amp;qc=&amp;nc=1&amp;expermode=&amp;nojc=&amp;isAsync=&amp;pn=30&amp;rn=30&amp;gsm=1e&amp;1657702473476="</span><span class="token punctuation">,</span>
		<span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
			<span class="token string-property property">"User-Agent"</span><span class="token operator">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.114 Safari/537.36 Edg/103.0.1264.49"</span><span class="token punctuation">,</span>
			<span class="token string-property property">"Accept"</span><span class="token operator">:</span> <span class="token string">"text/plain, */*; q=0.01"</span>
		<span class="token punctuation">}</span>

	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//  data 第一个axios 获取到的数据,data.data是一个数组</span>
            <span class="token comment">//  console.log(data.data);</span>
            data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>    <span class="token comment">// 数据遍历,获取到每个图片的地址</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>thumbURL<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 图片的地址</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>打印输出：</strong></p> 
<p><img src="https://images2.imgbox.com/2b/46/2bWFs7pr_o.png" alt="在这里插入图片描述"></p> 
<p><strong>然后通过第二个axios请求获取每一张图片的二进制数据：</strong></p> 
<pre><code class="prism language-js"><span class="token comment">// 作用：避免 item.thumbURLios请求的地址为空，地址随意设置</span>
<span class="token keyword">let</span> url <span class="token operator">=</span>  item<span class="token punctuation">.</span>thumbURL <span class="token operator">||</span> <span class="token string">"https://img2.baidu.com/it/u=3507648251,3424133896&amp;fm=26&amp;fmt=auto"</span><span class="token punctuation">;</span>
<span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>         <span class="token comment">// 第二个axios 请求图片的真正的数据</span>
	<span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
	<span class="token literal-property property">url</span><span class="token operator">:</span> item<span class="token punctuation">.</span>thumbURL<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>注意：axios获取完整个数组之后会出现undefined的情况，我们可以在循环最后随意设置一个地址解决该情况。</strong></p> 
<p><strong>打印输出：</strong></p> 
<p><img src="https://images2.imgbox.com/06/e3/7ljRDQ2V_o.png" alt="在这里插入图片描述"></p> 
<p><strong>得到二进制数据之后，我们可以将其存入同目录下的data文件夹中，需要引入fs模块：</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>但是axios请求将二进制转换成了utf-8格式，我们需要获取数据时要求对方后端以流的格式发送回来，然后通过管道向data文件夹写入数据。</strong></p> 
<pre><code class="prism language-js"><span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">"stream"</span> 	<span class="token comment">//以流的格式发送回来</span>
</code></pre> 
<pre><code class="prism language-js"><span class="token comment">// 通过管道写入数据</span>
result<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">"./test/"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">".jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>代码如下：</p> 
<pre><code class="prism language-js"><span class="token keyword">let</span> url <span class="token operator">=</span>  item<span class="token punctuation">.</span>thumbURL <span class="token operator">||</span> <span class="token string">"https://t7.baidu.com/it/u=2168645659,3174029352&amp;fm=193&amp;f=GIF"</span><span class="token punctuation">;</span>  <span class="token comment">// 默认自己随意设置的</span>
<span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>         <span class="token comment">// 第二个axios 请求图片的真正的数据</span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
    <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">"stream"</span><span class="token punctuation">,</span> <span class="token comment">// 告诉对方的后端将数据以流的格式发送回来</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token comment">// 通过管道写入数据</span>
    result<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">"./test/"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">".jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>打开写入图片的文件夹，图片获取成功：</strong><br> <img src="https://images2.imgbox.com/48/9d/ZffwZXDr_o.png" alt="在这里插入图片描述"></p> 
<p>完整代码：</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//引入http模块，用于创建服务器应用</span>
<span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 创建服务器应用</span>
<span class="token keyword">let</span> serve <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">"Access-Control-Allow-Origin"</span><span class="token punctuation">,</span> <span class="token string">"*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>req<span class="token punctuation">.</span>url <span class="token operator">==</span> <span class="token string">"/img_baidu"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"https://image.baidu.com/search/acjson?tn=resultjson_com&amp;logid=10647297934415395588&amp;ipn=rj&amp;ct=201326592&amp;is=&amp;fp=result&amp;fr=&amp;word=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;queryWord=%E9%A3%8E%E6%99%AF%E5%9B%BE%E7%89%87%E5%A4%A7%E5%85%A8&amp;cl=2&amp;lm=-1&amp;ie=utf-8&amp;oe=utf-8&amp;adpicid=&amp;st=&amp;z=&amp;ic=&amp;hd=&amp;latest=&amp;copyright=&amp;s=&amp;se=&amp;tab=&amp;width=&amp;height=&amp;face=&amp;istype=&amp;qc=&amp;nc=1&amp;expermode=&amp;nojc=&amp;isAsync=&amp;pn=30&amp;rn=30&amp;gsm=1e&amp;1657702473476="</span><span class="token punctuation">,</span>
            <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"User-Agent"</span><span class="token operator">:</span> <span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.5060.114 Safari/537.36 Edg/103.0.1264.49"</span><span class="token punctuation">,</span>

                <span class="token string-property property">"Accept"</span><span class="token operator">:</span> <span class="token string">"text/plain, */*; q=0.01"</span>
            <span class="token punctuation">}</span>

        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//  data 第一个axios 获取到的数据    data.data是一个数组</span>
            <span class="token comment">//  console.log(data.data);</span>
            data<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">item<span class="token punctuation">,</span> index</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>    <span class="token comment">// 数据遍历 获取到每个图片的地址</span>
                <span class="token comment">// console.log(item.thumbURL); // 图片的地址</span>
                <span class="token comment">// 作用避免 axitem.thumbURLios请求的地址为空   地址随意设置</span>
                <span class="token keyword">let</span> url <span class="token operator">=</span>  item<span class="token punctuation">.</span>thumbURL <span class="token operator">||</span> <span class="token string">"https://t7.baidu.com/it/u=2168645659,3174029352&amp;fm=193&amp;f=GIF"</span><span class="token punctuation">;</span>  <span class="token comment">// 默认自己随意设置的</span>
                <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>         <span class="token comment">// 第二个axios 请求图片的真正的数据</span>
                    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
                    <span class="token comment">// url: item.thumbURL,</span>
                    <span class="token literal-property property">responseType</span><span class="token operator">:</span> <span class="token string">"stream"</span><span class="token punctuation">,</span> <span class="token comment">// 告诉对方的后端将数据以流的格式发送回来</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// console.log(result); </span>
                    <span class="token comment">// 通过管道写入数据</span>
                    result<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">pipe</span><span class="token punctuation">(</span>fs<span class="token punctuation">.</span><span class="token function">createWriteStream</span><span class="token punctuation">(</span><span class="token string">"./data/"</span> <span class="token operator">+</span> index <span class="token operator">+</span> <span class="token string">".jpg"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span>

            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 启动监听端口号，我们应用运行的地址</span>
serve<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"3000"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"开启3000端口服务"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_395"></a>二、小说爬虫</h2> 
<h3><a id="1__397"></a>1. 单个页面爬取</h3> 
<p>比如我们搜索biqvge，随便打开一本小说：<br> <img src="https://images2.imgbox.com/7e/bb/4eV5plvE_o.png" alt="在这里插入图片描述"></p> 
<p>用网址通过axios发起请求：</p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">"get"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"https://www.bbiquge.net/book/133303/56520852.html"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span> <span class="token parameter"><span class="token punctuation">{<!-- --></span>data<span class="token punctuation">}</span></span> <span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>   
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>打印输出解构赋值后的data：</strong><br> <img src="https://images2.imgbox.com/e3/4a/RyMoRcOi_o.png" alt="在这里插入图片描述"></p> 
<p><strong>乱码是因为node不能解析gbk格式，解析gbk格式非常复杂，所以我们只能换小说。。。。爬取utf-8格式的网页。</strong><br> <img src="https://images2.imgbox.com/17/a6/6aBTvODS_o.png" alt="在这里插入图片描述"></p> 
<p><strong>找到啦找到啦：</strong></p> 
<pre><code class="prism language-c">https<span class="token operator">:</span><span class="token comment">//www.17k.com/chapter/3006464/38107770.html</span>
</code></pre> 
<p><strong>打印输出：</strong></p> 
<p><img src="https://images2.imgbox.com/7d/79/SWdNHTDN_o.png" alt="在这里插入图片描述"></p> 
<p>现在我们获取到整个页面，文字也是页面中的数据，只要把文字复制下来再写入就可以了。但是node是没有办法操作节点的，我们可以通过第三方包来获取 =&gt; <strong>jsdom =&gt; 用于node中操作dom节点</strong></p> 
<p><strong>安装jsdom：</strong></p> 
<pre><code class="prism language-c">npm i jsdom <span class="token operator">-</span>S
</code></pre> 
<p><img src="https://images2.imgbox.com/67/96/3bXbkwdh_o.png" alt="在这里插入图片描述"></p> 
<p>jsdom的使用说明可以在npm官网查看：<a href="https://www.npmjs.com/package/jsdom" rel="nofollow">jsdom - npm (npmjs.com)</a></p> 
<p><strong>引入jsdom：</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> jsdom <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"jsdom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token constant">JSDOM</span> <span class="token punctuation">}</span> <span class="token operator">=</span> jsdom<span class="token punctuation">;</span>
</code></pre> 
<p><strong>使用jsdom：</strong></p> 
<p>向构造函数传递一个字符串。您将获得一个对象，该对象具有许多有用的属性；</p> 
<p>通过new方式使用jsdom，参数是字符串(html整个页面相当于字符串)：</p> 
<p><strong>通过对节点操作，我们可以获取到取出标签后的纯文字内容：</strong></p> 
<pre><code class="prism language-js"><span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"https://www.17k.com/chapter/3006464/38107770.html"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> dom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSDOM</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">// 将后端具有标签字符串转换可以通过js方法获取节点或者内容</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取节点 和 js的使用方法一样</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/c5/b0/vAmahTaV_o.png" alt="在这里插入图片描述"></p> 
<p><strong>注意：</strong> 代码.querySelector(“.p”)中的p指的是html页面中小说内容的<strong>class类</strong>的名称。</p> 
<p><img src="https://images2.imgbox.com/3b/c7/F9yEsPLB_o.png" alt="在这里插入图片描述"></p> 
<p><strong>写入文本：</strong></p> 
<p>通过fs模块的writeFile方法将文本内容写入文档：</p> 
<pre><code class="prism language-js"><span class="token keyword">let</span> value <span class="token operator">=</span> dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">.</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//trim()用于将文本格式从头写入</span>
fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">"./text/01.txt"</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"获取成功"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>爬取结果：</strong><br> <img src="https://images2.imgbox.com/80/15/TdGNPkwd_o.png" alt="在这里插入图片描述"></p> 
<p><strong>完整代码：</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> jsdom <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"jsdom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token constant">JSDOM</span> <span class="token punctuation">}</span> <span class="token operator">=</span> jsdom<span class="token punctuation">;</span>

<span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">"https://www.17k.com/chapter/3006464/38107770.html"</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// console.log(data)</span>
    <span class="token comment">// 向构造函数传递一个字符串。您将获得一个对象，该对象具有许多有用的属性</span>
    <span class="token comment">// 通过new方式使用jsdom，参数是字符串</span>
    <span class="token keyword">const</span> dom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSDOM</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log(dom.window.document.querySelector(".p").textContent);</span>
    <span class="token keyword">let</span> value <span class="token operator">=</span> dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">;</span> <span class="token comment">//trim()用于将文本格式从头写入</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">"./text/01.txt"</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">"获取成功"</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="2__546"></a>2. 整个小说爬取</h3> 
<p>要获取整个小说，我们可以先获取第一个页面，获取到里面的文字同时获取到下一章的跳转地址，再通过axios获取下一章页面的数据，再获取里面的文字，以此循环，就可以拿到整个小说 。<br> <img src="https://images2.imgbox.com/e3/25/4gqo2BuH_o.png" alt="在这里插入图片描述"></p> 
<p>可以看到，html给的下一章的地址是不全的，前面还需要拼接https://www.17k.com/；</p> 
<p>我们通过对节点操作<strong>获取属性值</strong>尝试获取类.nextChapter中的href下一章地址：</p> 
<pre><code class="prism language-c">function <span class="token function">fun</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        method<span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
        url<span class="token operator">:</span> url
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 获取属性值:元素.getAttribute("属性名") 返回属性值</span>
        let nexturl <span class="token operator">=</span> dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".nextChapter"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nexturl<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fun</span><span class="token punctuation">(</span><span class="token string">"https://www.17k.com/chapter/3006464/38107770.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 函数执行</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f7/66/svIPZg9x_o.png" alt="在这里插入图片描述"></p> 
<p><strong>然后通过拼接得到完整地址，再将文本内容通过追加的方式 {flag:“a”} 写入文档：</strong></p> 
<p>写入之后，我们通过循环调用函数不断的读取下一章内容，使程序自动运行：</p> 
<p><strong>完整代码：</strong></p> 
<pre><code class="prism language-js"><span class="token keyword">const</span> axios <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"axios"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fs"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token punctuation">{<!-- --></span> <span class="token constant">JSDOM</span> <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"jsdom"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">function</span> <span class="token function">fun</span><span class="token punctuation">(</span><span class="token parameter">url</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">axios</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">"get"</span><span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> url
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{<!-- --></span> data <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> dom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JSDOM</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> value <span class="token operator">=</span> dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".p"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>textContent<span class="token punctuation">;</span>
        <span class="token comment">// 获取属性值:元素.getAttribute("属性名") 返回属性值</span>
        <span class="token keyword">let</span> nextUrl <span class="token operator">=</span> dom<span class="token punctuation">.</span>window<span class="token punctuation">.</span>document<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">".nextChapter"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// console.log(nextUrl);</span>
        <span class="token comment">// nextUrl是一空值，则打断程序运行</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>nextUrl<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token comment">// 拼接地址</span>
        nextUrl <span class="token operator">=</span> <span class="token string">"https://www.17k.com"</span> <span class="token operator">+</span> nextUrl<span class="token punctuation">;</span>
        <span class="token comment">// 在一个文件内 追加写入内容</span>
        fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">"./text/02.txt"</span><span class="token punctuation">,</span> value<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">flag</span><span class="token operator">:</span> <span class="token string">"a"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>nextUrl <span class="token operator">+</span> <span class="token string">"的上一章写入成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">fun</span><span class="token punctuation">(</span>nextUrl<span class="token punctuation">)</span> <span class="token comment">// 函数循环调用，获取下一章内容</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token function">fun</span><span class="token punctuation">(</span><span class="token string">"https://www.17k.com/chapter/3006464/38107770.html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 函数执行,先获取第一章内容</span>
</code></pre> 
<p><strong>爬取结果：</strong><br> <img src="https://images2.imgbox.com/84/5e/khnKv0Bb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/24/8c/JD2lZ7F7_o.png" alt="在这里插入图片描述"></p> 
<p><strong>注意：在读取到第五十一章时报错了，复制该章链接到浏览器中搜索：</strong></p> 
<p><img src="https://images2.imgbox.com/5d/14/fADlCBW3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/99/d1/JjnaWevj_o.png" alt="在这里插入图片描述"></p> 
<p><strong>结果是需要登录才能阅读，所以获取不到网页的文本内容和下一章地址。。。</strong></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c662097a3a3d2fb65ed1bdd0d4b6f0af/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">模型微调（fine-tuning）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49a7a7d1f7ebb5f12aa90944e9fc9717/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pandas多条件筛选</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>