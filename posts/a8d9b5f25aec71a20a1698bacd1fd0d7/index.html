<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【go语言】Chromeless简介及Chromedp库实现模拟登录截屏 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【go语言】Chromeless简介及Chromedp库实现模拟登录截屏" />
<meta property="og:description" content="一、什么是Chromeless chromeless 是一个基于 Node.js 的库，用于通过无头浏览器（Headless Chrome）进行自动化测试和网页截图。它允许开发者使用 JavaScript 脚本来控制和操作浏览器，而无需实际打开浏览器窗口。
以下是一些 chromeless 的主要特性和用法：
基于 Chrome DevTools Protocol：chromeless 使用 Chrome DevTools Protocol（CDP）与浏览器进行通信。这允许对浏览器进行底层的控制和操作。支持无头模式： 由于使用 Headless Chrome，chromeless 在执行测试和脚本时不会显示实际的浏览器界面，从而提高了效率。链式调用：chromeless 的 API 设计允许使用链式调用，使代码看起来更清晰和易读。截图和PDF生成： 可以使用 chromeless 进行页面截图和生成 PDF 文件，这对于测试和生成报告非常有用。表单提交和用户交互： 支持模拟用户在页面上的交互，比如点击、输入文本等操作。异步执行：chromeless 支持异步操作，可以等待页面加载完成或等待特定的事件发生。 以下是一个简单的 chromeless 示例：
const { Chromeless } = require(&#39;chromeless&#39;); async function run() { const chromeless = new Chromeless(); const screenshot = await chromeless .goto(&#39;https://www.example.com&#39;) .screenshot(); console.log(screenshot); // 返回截图的 Buffer await chromeless.end(); } run().catch(console.error); 在这个示例中，chromeless 打开了一个 Headless Chrome 浏览器，导航到了 https://www." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a8d9b5f25aec71a20a1698bacd1fd0d7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-29T16:06:02+08:00" />
<meta property="article:modified_time" content="2023-12-29T16:06:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【go语言】Chromeless简介及Chromedp库实现模拟登录截屏</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>一、什么是Chromeless</h2> 
<p><code>chromeless</code> 是一个基于 Node.js 的库，用于通过无头浏览器（Headless Chrome）进行自动化测试和网页截图。它允许开发者使用 JavaScript 脚本来控制和操作浏览器，而无需实际打开浏览器窗口。</p> 
<p>以下是一些 <code>chromeless</code> 的主要特性和用法：</p> 
<ol><li><strong>基于 Chrome DevTools Protocol：</strong><code>chromeless</code> 使用 Chrome DevTools Protocol（CDP）与浏览器进行通信。这允许对浏览器进行底层的控制和操作。</li><li><strong>支持无头模式：</strong> 由于使用 Headless Chrome，<code>chromeless</code> 在执行测试和脚本时不会显示实际的浏览器界面，从而提高了效率。</li><li><strong>链式调用：</strong><code>chromeless</code> 的 API 设计允许使用链式调用，使代码看起来更清晰和易读。</li><li><strong>截图和PDF生成：</strong> 可以使用 <code>chromeless</code> 进行页面截图和生成 PDF 文件，这对于测试和生成报告非常有用。</li><li><strong>表单提交和用户交互：</strong> 支持模拟用户在页面上的交互，比如点击、输入文本等操作。</li><li><strong>异步执行：</strong><code>chromeless</code> 支持异步操作，可以等待页面加载完成或等待特定的事件发生。</li></ol> 
<p>以下是一个简单的 <code>chromeless</code> 示例：</p> 
<pre><code class="language-javascript">const { Chromeless } = require('chromeless');


async function run() {
  const chromeless = new Chromeless();


  const screenshot = await chromeless
    .goto('https://www.example.com')
    .screenshot();


  console.log(screenshot); // 返回截图的 Buffer


  await chromeless.end();
}


run().catch(console.error);</code></pre> 
<p>在这个示例中，<code>chromeless</code> 打开了一个 Headless Chrome 浏览器，导航到了 <code>https://www.example.com</code>，然后截取了页面的屏幕截图。这只是 <code>chromeless</code> 的基本用法，它提供了更多的功能，可以满足自动化测试和其他网页操作的需求。</p> 
<h2>二、go语言中的实现</h2> 
<p>在 Go 语言中，要使用无头浏览器进行自动化测试和网页操作，可以考虑使用一些第三方库。以下是一些常见的用于在 Go 中进行无头浏览器测试的库：</p> 
<p><strong>1. Chromedp:</strong><code>Chromedp</code> 是一个基于 Chrome DevTools Protocol 的库，允许你在无头浏览器中执行操作。它提供了对 Chrome DevTools 的直接访问，以及一些高级功能，如截图、模拟用户输入等。GitHub 地址：<a href="https://github.com/chromedp/chromedp" title="GitHub - chromedp/chromedp: A faster, simpler way to drive browsers supporting the Chrome DevTools Protocol.">GitHub - chromedp/chromedp: A faster, simpler way to drive browsers supporting the Chrome DevTools Protocol.</a></p> 
<pre><code class="language-Go">  package main


   import (
      "context"
      "log"
      "github.com/chromedp/chromedp"
   )


   func main() {
      ctx, cancel := chromedp.NewContext(context.Background())
      defer cancel()


      var buf []byte
      if err := chromedp.Run(ctx,
         chromedp.Navigate("https://www.example.com"),
         chromedp.CaptureScreenshot(&amp;buf),
      ); err != nil {
         log.Fatal(err)
      }


      // 处理截图数据（buf）
   }</code></pre> 
<p><strong>2. Headless Chrome with Puppeteer Go:</strong><code>Headless Chrome with Puppeteer Go</code> 是一个使用 Puppeteer 和 Go 的库，使得在 Go 中能够方便地控制 Chrome 浏览器。GitHub 地址：<a href="https://github.com/dtinth/puppeteer-go" title="https://github.com/dtinth/puppeteer-go">https://github.com/dtinth/puppeteer-go</a></p> 
<pre><code class="language-Go">package main


   import (
      "fmt"
      "github.com/dtinth/puppeteer-go"
   )


   func main() {
      browser, _ := puppeteer.Launch(puppeteer.DefaultArgs, puppeteer.Debug(false))
      defer browser.Close()


      page, _ := browser.NewPage()
      page.Navigate("https://www.example.com")
      page.Screenshot("screenshot.png")
   }</code></pre> 
<p>这两个库都提供了在 Go 中控制无头浏览器进行测试和网页操作的能力。选择其中一个库取决于你的具体需求和喜好。</p> 
<h2>三、简单实操实现登录截屏</h2> 
<pre><code class="language-Go">package main
import (
    "context"
    "github.com/chromedp/cdproto/cdp"
    "github.com/chromedp/chromedp"
    "log"
    "os"
)
func main() {
    // 创建登录阶段的上下文
    ctxLogin, cancelLogin := chromedp.NewContext(context.Background())
    defer cancelLogin()
    // 定义变量分别用于存储两个阶段的截图
    var bufLogin []byte
    var nodes []*cdp.Node
    // 登录阶段
    if err := chromedp.Run(ctxLogin,
       chromedp.Navigate("https://shimo.im/login"),
       //等待页面加载
       chromedp.WaitVisible(`[name="account"]`, chromedp.ByQuery),
       //输入账号和密码
       chromedp.SendKeys(`[name="account"]`, "zhangsan@shimo.im", chromedp.ByQuery),
       chromedp.SendKeys(`[name="password"]`, "woshizhangsan", chromedp.ByQuery),
       //点击同意协议和登录按钮
       chromedp.Click(`div.StyledCheckBox-sc-RjILa-1`, chromedp.ByQuery),
       chromedp.Click(`div[type="black"] button[data-test="btn-submit"]`, chromedp.ByQuery),
       //等待加载
       chromedp.WaitVisible(`.StyledUserCardContainer-sc-RevvT-9`, chromedp.ByQuery),
       chromedp.CaptureScreenshot(&amp;bufLogin),
    ); err != nil {
       log.Fatal(err)
    }
    if err := os.WriteFile("elementScreenshot.png", bufLogin, 0o644); err != nil {
       log.Fatal(err)
    }
}</code></pre> 
<p>chromedp使用例子：<a href="https://github.com/chromedp/examples" title="GitHub - chromedp/examples: chromedp code examples.">GitHub - chromedp/examples: chromedp code examples.</a></p> 
<p>chromedp源码地址：<a href="https://github.com/chromedp/chromedp" title="GitHub - chromedp/chromedp: A faster, simpler way to drive browsers supporting the Chrome DevTools Protocol.">GitHub - chromedp/chromedp: A faster, simpler way to drive browsers supporting the Chrome DevTools Protocol.</a></p> 
<p>以下是chromedp库中常用函数：</p> 
<blockquote> 
 <p>chromedp.NewContext() 初始化chromedp的上下文，后续这个页面都使用这个上下文进行操作</p> 
 <p>chromedp.Run() 运行一个chrome的一系列操作</p> 
 <p>chromedp.Navigate() 将浏览器导航到某个页面</p> 
 <p>chromedp.WaitVisible() 等候某个元素可见，再继续执行。</p> 
 <p>chromedp.Click() 模拟鼠标点击某个元素</p> 
 <p>chromedp.Value() 获取某个元素的value值</p> 
 <p>chromedp.ActionFunc() 再当前页面执行某些自定义函数</p> 
 <p>chromedp.Text() 读取某个元素的text值</p> 
 <p>chromedp.Evaluate() 执行某个js，相当于控制台输入js</p> 
 <p>network.SetExtraHTTPHeaders() 截取请求，额外增加header头</p> 
 <p>chromedp.SendKeys() 模拟键盘操作，输入字符</p> 
 <p>chromedp.Nodes() 根据xpath获取某些元素，并存储进入数组</p> 
 <p>chromedp.NewRemoteAllocator</p> 
 <p>chromedp.OuterHTML() 获取元素的outer html</p> 
 <p>chromedp.Screenshot() 根据某个元素截图</p> 
 <p>page.CaptureScreenshot() 截取整个页面的元素</p> 
 <p>chromedp.Submit() 提交某个表单</p> 
 <p>chromedp.WaitNotPresent() 等候某个元素不存在，比如“正在搜索。。。”</p> 
 <p>chromedp.Tasks{} 一系列Action组成的任务</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8d511b4f992fd15c589079602a2450f6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MMDet 第三季度更新</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ca2aab8ee1974413a8492f74acd357c1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Ubuntu16.04 安装Anaconda</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>