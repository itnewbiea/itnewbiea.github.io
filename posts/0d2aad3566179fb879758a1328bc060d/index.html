<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>解决CAS 4.2.7 版本集群部署的各种问题 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="解决CAS 4.2.7 版本集群部署的各种问题" />
<meta property="og:description" content="近期公司决定使用CAS来做单点登录，选择较为稳定的4.*版本,然而在集群部署时发现了不少问题。今天在这里总结一下，
一、部署条件 安装tomcat7 集群 （demo 两台） 安装redis 集群 （demo 单台） cas 4.2.7版本，单台CAS服务环境下登录、单点、退出皆运行正常 安装nginx ,配置tomcat集群负载均衡；其他负载均衡方式皆可 JDK1.7 二、集群部署问题 需解决集群环境下CAS服务集群session共享问题。 需解决集群环境下多个CAS服务共用一个ticket库。 需解决集群环境和springwebflow框架下CAS登录流程数据加密秘钥统一（或去除登录流程数据加密） 需解决集群环境和springwebflow框架下CAS登录票据加密秘钥统一（或去除票据数据加密） 三、操作部署 配置tomcat服务器session共享： DEMO简单配置： （1）nginx配置两个tomcat服务器,server1、server2 （2）分别向两个tomcat导入所用jar包：E:\*** \***tomcat7***\lib 目录下。 commons-pool-1.6.jar、jedis-2.0.0.jar、tomcat-redis-session-manager-1.2-tomcat-7-java-7.jar （3）分别修改tomcat配置文件：E:\*** \***tomcat7***\conf 目录下context.xml。 &lt;Valve className=&#34;com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve&#34;/&gt; &lt;Manager className=&#34;com.orangefunction.tomcat.redissessions.RedisSessionManager&#34; database=&#34;0&#34; host=&#34;127.0.0.1&#34; maxInactiveInterval=&#34;60&#34; port=&#34;6379&#34;/&gt; （4）为了方便测试可修改服务器欢迎页：E:\*** \***tomcat7***\webapps\ROOT\index.jsp。 可删除ROOT目录下文件、重新写一个简单的index.jsp、增加服务器标识、展示sessionId。 启动两台tomcat服务器和nginx。访问服务器欢迎页显示两台服务器sessionId一致即可。 2. CAS登录流程数据加密秘钥统一： （1） 简要说明： 流程数据默认采用对称加密方式（AES），无手动配置的情况下会默认生成随机encryptionKey和signKey， 那么集群条件下就会产生问题，当集群中某个CAS服务在生成加密数据后去另一台CAS服务去解密，由于签名秘钥 分别由不同服务器随机产生的解密过程中就会产生错误。 （2） 涉及代码说明： CAS4.2.7版本使用spring web flow框架，在执行登录流程调用loginFlowCipherBean对流程数据进行加密解密 时 使 用构造方法中默认注入的cipherExecutor子类 webflowCipherExecutor webflowCipherExecutor使用时调用了构造方法，在构造方法中又调用该类的父类BinaryCipherExecutor，此时若无手动配置， 构造参数的secretKeyEncryption和secretKeySigning则皆为空。在BinaryCipherExecutor的构造方法中又判断这两个构造参数，若参数 为空则会产生随机key值用来加密解密。 （3） 解决方法一： 在CAS的配置文件cas.properties中打开webflow.encryption.key、webflow.signing.key注释，并配置值，将KEY值固定。 那么如何获取生成固定KEY值呢，其实源码BinaryCipherExecutor类中已经告诉我们了。自己写个main方法，导入jose4j的jar包就可以随机 生成。 public static void main(String[] args ) { final OctetSequenceJsonWebKey octetKey = OctJwkGenerator." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0d2aad3566179fb879758a1328bc060d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-02T10:38:04+08:00" />
<meta property="article:modified_time" content="2018-07-02T10:38:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">解决CAS 4.2.7 版本集群部署的各种问题</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>近期公司决定使用CAS来做单点登录，选择较为稳定的4.*版本,然而在集群部署时发现了不少问题。今天在这里总结一下，</p> 
<p></p> 
<div> 
 <div> 
  <br> 
 </div> 
 <div> 
  <span style="font-size:16pt;">一、部署条件</span> 
 </div> 
 <div> 
  <br> 
 </div> 
 <ul><li> 
   <div> 
    <span style="font-size:12pt;">安装tomcat7 集群 （demo 两台）</span> 
   </div></li><li> 
   <div> 
    <span style="font-size:12pt;">安装redis 集群 （demo 单台） </span> 
   </div></li><li> 
   <div> 
    <span style="font-size:12pt;">cas 4.2.7版本，单台CAS服务环境下登录、单点、退出皆运行正常</span> 
   </div></li><li> 
   <div> 
    <span style="font-size:12pt;">安装nginx ,配置tomcat集群负载均衡；其他负载均衡方式皆可</span> 
   </div></li><li> 
   <div> 
    <span style="font-size:12pt;">JDK1.7</span> 
   </div></li></ul> 
 <div> 
  <span style="font-size:12pt;">    </span> 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  <span style="font-size:16pt;">二、集群部署问题</span> 
 </div> 
 <div> 
  <br> 
 </div> 
 <ul><li> 
   <div> 
    <span style="font-size:12pt;">需解决集群环境下CAS服务集群session共享问题。</span> 
   </div></li><li> 
   <div> 
    <span style="font-size:12pt;">需解决集群环境下多个CAS服务共用一个ticket库。</span> 
   </div></li><li> 
   <div> 
    <span style="font-size:12pt;">需解决集群环境和springwebflow框架下CAS登录流程数据加密秘钥统一（或去除登录流程数据加密）</span> 
   </div></li><li> 
   <div> 
    <span style="font-size:12pt;">需解决集群环境和<span style="font-size:12pt;">springwebflow框架下CAS登录票据加密秘钥统一（或去除票据数据加密）</span></span> 
   </div></li></ul> 
 <div> 
  <br> 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  <span style="font-size:16pt;">三、操作部署</span> 
 </div> 
 <div> 
  <br> 
 </div> 
 <ol><li> 
   <div> 
    <span style="font-size:12pt;"> 配置tomcat服务器session共享：</span> 
   </div></li></ol> 
 <div> 
  <span style="font-size:12pt;">         DEMO简单配置：</span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">        （1）nginx配置两个tomcat服务器,server1、server2</span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">        （2）分别向两个tomcat导入所用jar包：E:\*** \***tomcat7***\lib 目录下。</span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                 <span style="font-size:12pt;"><span style="font-size:12pt;">commons-pool-1.6.jar、<span style="font-size:12pt;">jedis-2.0.0.jar、<span style="font-size:12pt;">tomcat-redis-session-manager-1.2-tomcat-7-java-7.jar</span></span></span></span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">        （3）分别修改tomcat配置文件：<span style="font-size:12pt;">E:\*** \***tomcat7***\conf 目录下</span><span style="font-size:12pt;">context.xml</span><span style="font-size:12pt;">。</span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                &lt;Valve className="com.orangefunction.tomcat.redissessions.RedisSessionHandlerValve"/&gt;</span></span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                &lt;Manager className="com.orangefunction.tomcat.redissessions.RedisSessionManager" </span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                 database="0"</span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                 host="127.0.0.1"</span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                 maxInactiveInterval="60" </span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                 port="6379"/&gt;</span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">        （4）为了方便测试可修改服务器欢迎页：<span style="font-size:12pt;">E:\*** \***tomcat7***\webapps\ROOT\index.jsp。</span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;"><span style="font-size:12pt;">                可删除ROOT目录下文件、重新写一个简单的index.jsp、增加服务器标识、展示sessionId。</span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;"><span style="font-size:12pt;">                启动两台tomcat服务器和nginx。访问服务器欢迎页显示两台服务器sessionId一致即可。</span></span> 
 </div> 
 <div>
                    
  <br> 
 </div> 
 <div> 
  <span style="font-size:12pt;"><span style="font-size:12pt;">                <img src="https://images2.imgbox.com/d8/09/df2ycTUR_o.png" alt=""></span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;"><span style="font-size:12pt;">                <img src="https://images2.imgbox.com/1e/24/odPLuQU3_o.png" alt=""><br></span></span> 
 </div> 
 <div>
                        
 </div> 
 <div> 
  <br> 
 </div> 
 <div>
                      
 </div> 
 <div> 
  <br> 
 </div> 
 <div>
               
  <span style="font-size:12pt;"> 2. </span> 
  <span style="font-size:12pt;"><span style="font-size:12pt;">CAS登录流程数据加密秘钥统一</span>：</span> 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  <span style="font-size:12pt;">            （1） 简要说明：</span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                      流程数据默认采用对称加密方式（AES），无手动配置的情况下会默认生成随机<span style="font-size:12pt;">encryptionKey和signKey，</span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;"><span style="font-size:12pt;">                      那么集群条件下就会产生问题，当集群中某个CAS服务在生成加密数据后去另一台CAS服务去解密，由于签名秘钥</span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;"><span style="font-size:12pt;">                      分别由不同服务器随机产生的解密过程中就会产生错误。</span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;"><span style="font-size:12pt;">            </span></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">             （2） 涉及代码说明：</span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                    </span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                     <img src="https://images2.imgbox.com/4a/d3/XfpDsA2y_o.png" alt=""></span> 
 </div> 
 <div>
                       
  <span style="font-size:12pt;">CAS4.2.7版本使用spring web flow框架，在执行登录流程调用loginFlowCipherBean对流程数据进行加密解密                         时 使</span> 
  <span style="font-size:12pt;"> 用构造方法中默认注入的cipherExecutor子类</span> 
  <span style="font-size:12pt;"> </span> 
  <span style="font-size:12pt;">webflowCipherExecutor</span> 
 </div> 
 <div> 
  <br> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                    <img src="https://images2.imgbox.com/95/1d/RJpHCh8m_o.png" alt=""></span> 
 </div> 
 <div> 
  <span style="font-size:12pt;">                    <span style="font-size:12pt;">webflowCipherExecutor使用时调用了构造方法，在构造方法中又调用该类的父类<span style="font-size:12pt;">BinaryCipherExecutor，此时若无手动配置，</span></span></span> 
 </div> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    构造参数的<span style="font-size:12pt;">secretKeyEncryption</span><span style="font-size:12pt;">和<span style="font-size:12pt;">secretKeySigning则</span><span style="font-size:12pt;">皆为空。在<span style="font-size:12pt;">BinaryCipherExecutor的构造方法中又判断这两个构造参数，若参数</span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    为空则会产生随机key值用来加密解密。</span></span></span></span></span></span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">            （3） 解决方法一：</span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    在CAS的配置文件<span style="font-size:12pt;">cas.properties中打开</span><span style="font-size:12pt;">webflow.encryption.key、<span style="font-size:12pt;">webflow.signing.key</span></span><span style="font-size:12pt;">注释，并配置值，将KEY值固定。</span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    <img src="https://images2.imgbox.com/48/6e/fKtilSV8_o.png" alt=""></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    那么如何获取生成固定KEY值呢，其实源码</span><span style="font-size:12pt;">BinaryCipherExecutor类中已经告诉我们了。</span><span style="font-size:12pt;">自己写个main方法，导入jose4j的jar包就可以随机</span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    生成。</span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                  </span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">      </span> 
 <span style="font-size:12pt;">  </span> 
 <span style="min-height:16pt;font-size:12pt;"> </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);"><strong>public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);"><strong>static</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);"><strong>void</strong></span> 
 <span style="min-height:16pt;font-size:12pt;">main(String[]</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);">args</span> 
 <span style="min-height:16pt;font-size:12pt;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;">                         </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;">OctetSequenceJsonWebKey</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);">octetKey</span> 
 <span style="min-height:16pt;font-size:12pt;">= OctJwkGenerator.</span> 
 <span style="min-height:16pt;font-size:12pt;"><em>generateJwk</em></span> 
 <span style="min-height:16pt;font-size:12pt;">(512);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;">                         </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;">Map&lt;String, Object&gt;</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);">params</span> 
 <span style="min-height:16pt;font-size:12pt;">=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);">octetKey</span> 
 <span style="min-height:16pt;font-size:12pt;">.toParams(org.jose4j.jwk.JsonWebKey.OutputControlLevel.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);"><strong><em>INCLUDE_SYMMETRIC</em></strong></span> 
 <span style="min-height:16pt;font-size:12pt;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;">                         String</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);">signingKey</span> 
 <span style="min-height:16pt;font-size:12pt;">=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);">params</span> 
 <span style="min-height:16pt;font-size:12pt;">.get(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);">"k"</span> 
 <span style="min-height:16pt;font-size:12pt;">).toString();</span> 
</div> 
<div style="min-height:11pt;"> 
 <span style="font-size:12pt;"><span style="min-height:11pt;font-size:12pt;">                         System.</span><span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);"><strong><em>out</em></strong></span><span style="min-height:11pt;font-size:12pt;">.println(</span><span style="min-height:11pt;font-size:12pt;color:rgb(42,0,255);">"webflow.signing.key:"</span><span style="min-height:11pt;font-size:12pt;">+</span><span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);">signingKey</span><span style="min-height:11pt;font-size:12pt;">);</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;">        </span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;">                         String</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);">encryptionKey</span> 
 <span style="min-height:16pt;font-size:12pt;">= RandomStringUtils.</span> 
 <span style="min-height:16pt;font-size:12pt;"><em>randomAlphabetic</em></span> 
 <span style="min-height:16pt;font-size:12pt;">(16);</span> 
</div> 
<div style="min-height:11pt;"> 
 <span style="font-size:12pt;"><span style="min-height:11pt;font-size:12pt;">                         System.</span><span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);"><strong><em>out</em></strong></span><span style="min-height:11pt;font-size:12pt;">.println(</span><span style="min-height:11pt;font-size:12pt;color:rgb(42,0,255);">"webflow.encryption.key:"</span><span style="min-height:11pt;font-size:12pt;">+</span><span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);">encryptionKey</span><span style="min-height:11pt;font-size:12pt;">);</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;">                  </span></span> 
 <span style="font-size:12pt;">  }</span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    </span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    <span style="font-size:12pt;">key的长度在</span><span style="font-size:12pt;">BinaryCipherExecutor已有声明</span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">            </span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">           （4） 解决方法二：</span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    去除登录流程数据加密，CAS的util包中有一个类<span style="font-size:12pt;">NoOpCipherExecutor.java和<span style="font-size:12pt;">BinaryCipherExecutor一样是<span style="font-size:12pt;">CipherExecutor子类，省略了对</span></span></span></span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    数据的加密解密过程。</span></span></span></span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    <img src="https://images2.imgbox.com/a6/8d/SM6CnpVy_o.png" alt=""></span></span></span></span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    在CAS的配置文件<span style="font-size:12pt;">cas-servlet.xml中配置：</span></span></span></span></span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                   <span style="font-size:12pt;color:rgb(158,0,243);"> </span><span style="font-size:12pt;color:rgb(158,0,243);">&lt;bean id="loginFlowCipherBean"  class="org.jasig.cas.web.flow.CasWebflowCipherBean"&gt;</span></span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;color:rgb(158,0,243);">                            &lt;constructor-arg ref="noOpByteCipherExecutor" /&gt;</span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;color:rgb(158,0,243);">                    &lt;/bean&gt;</span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    启动服务时找不到这个类，则在<span style="font-size:12pt;">applicationContext.xml中配置</span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    <span style="font-size:12pt;">&lt;bean id="noOpByteCipherExecutor"  class="</span><span style="font-size:12pt;">org.jasig.cas.util</span><span style="font-size:12pt;">.NoOpByteCipherExecutor"/&gt;</span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    其实，自己也可以仿照<span style="font-size:12pt;">NoOpCipherExecutor自定义一个<span style="font-size:12pt;">CipherExecutor，打成jar包，写进配置文件。</span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">         <span style="font-size:12pt;"> 3. <span style="font-size:12pt;">CAS登录cookie票据TGC加密秘钥统一：</span></span></span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;">            </span> 
</div> 
<div> 
 <span style="font-size:12pt;">             （1） 简要说明：</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                       和CAS登录流程数据加密解密的问题一样。</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                </span> 
</div> 
<div> 
 <span style="font-size:12pt;">             （2） 涉及代码说明：</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                       登录验证成功后会生成TGC票据存储到浏览器的cookie中。</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                       生成cookie时调用<span style="font-size:12pt;">sendTicketGrantingTicketAction，然后再调用<span style="font-size:12pt;">CookieRetrievingCookieGenerator</span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                       的addCookie方法，由于<span style="font-size:12pt;">ticketGrantingTicketCookieGenerator注入了<span style="font-size:12pt;">CookieRetrievingCookieGenerator</span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                       子类<span style="font-size:12pt;">TGCCookieRetrievingCookieGenerator，其构造方法中注入了默认的c<span style="font-size:12pt;">ookieValueManager</span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      <img src="https://images2.imgbox.com/3c/ea/qF6c9uz6_o.png" alt=""></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      ,即是<span style="font-size:12pt;">DefaultCasCookieValueManager。所以在执行<span style="font-size:12pt;">CookieRetrievingCookieGenerator的addCookie方法时</span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      所调用的实际上是<span style="font-size:12pt;">CookieValueManager的子类<span style="font-size:12pt;">DefaultCasCookieValueManager的</span><span style="font-size:12pt;">buildCookieValue方法。</span></span></span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      <span style="font-size:12pt;">DefaultCasCookieValueManager构造方法中注入了<span style="font-size:12pt;">defaultCookieCipherExecutor，在配置文件<span style="font-size:12pt;">deployerConfigContext.xml</span></span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      中默认配置的</span></span></span></span></span></span></span></span> 
 <span style="font-size:12pt;">是</span> 
 <span style="font-size:12pt;">TGCCipherExecutor，</span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    <img src="https://images2.imgbox.com/54/0b/ppONtJ7b_o.png" alt=""></span></span></span></span></span></span></span></span></span> 
</div> 
<div>
                         
 <span style="font-size:12pt;">所以在</span> 
 <span style="font-size:12pt;">DefaultCasCookieValueManager的</span> 
 <span style="font-size:12pt;">buildCookieValue方法中实际调用了<span style="font-size:12pt;">TGCCipherExecutor的encode方法，即是</span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;">                      <span style="font-size:12pt;">TGCCipherExecutor的父类<span style="font-size:12pt;">BaseStringCipherExecutor的endcode方法。在调用<span style="font-size:12pt;">TGCCipherExecutor时，</span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    <img src="https://images2.imgbox.com/e0/f6/gdx2cfib_o.png" alt=""></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      若无手动配置，其</span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      构造参数<span style="font-size:12pt;">secretKeyEncryption，<span style="font-size:12pt;">secretKeySigning皆为空，又调用了其父类，<span style="font-size:12pt;">BaseStringCipherExecutor的构造方法中对</span></span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      这两个构造参数进行了判断，<span style="font-size:12pt;">若参数</span></span></span></span></span></span></span></span></span> 
 <span style="font-size:12pt;">为空则会产生随机key值用来加密解密。</span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                   </span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">           （3） 解决方法一：</span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                     <span style="font-size:12pt;">在CAS的配置文件</span><span style="font-size:12pt;">cas.properties中打开</span><span style="font-size:12pt;">tgc.encryption.key、</span><span style="font-size:12pt;">tgc.signing.key</span><span style="font-size:12pt;">注释，并配置值，将KEY值固定。</span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                            <img src="https://images2.imgbox.com/5e/6d/jCF3K6DJ_o.png" alt=""></span></span></span></span></span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                     <span style="font-size:12pt;"> 那么如何获取生成固定KEY值呢，其实源码<span style="font-size:12pt;">BaseStringCipherExecutor</span></span><span style="font-size:12pt;">类中也已经告诉我们了。</span><span style="font-size:12pt;">自己写个main方法，导入</span></span></span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      jose4j的jar包就可以随机</span></span></span></span></span></span></span> 
 <span style="font-size:12pt;">生成。</span> 
</div> 
<div> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">  </span> 
 <span style="font-size:12pt;">       public static void main(String[] args) {<!-- --></span> 
</div> 
<div> 
 <span style="font-size:12pt;">                          final OctetSequenceJsonWebKey octetKey = OctJwkGenerator.generateJwk(512);</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                          final Map&lt;String, Object&gt; params =  octetKey.toParams(org.jose4j.jwk.JsonWebKey.OutputControlLevel.INCLUDE_SYMMETRIC);</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                          String signingKey = params.get("k").toString();</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                          System.out.println("tgc.signing.key:"+signingKey);</span> 
</div> 
<div> 
 <span style="font-size:12pt;">        </span> 
</div> 
<div> 
 <span style="font-size:12pt;">                         final OctetSequenceJsonWebKey octetKey2 = OctJwkGenerator.generateJwk(256);</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                         final Map&lt;String, Object&gt; params2 = octetKey2.toParams(org.jose4j.jwk.JsonWebKey.OutputControlLevel.INCLUDE_SYMMETRIC);</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                         String signingKey2 = params2.get("k").toString();</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                         System.out.println("tgc.encryption.key:"+signingKey2);</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                     }</span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-size:12pt;">            </span> 
 <span style="font-size:12pt;">（4） 解决方法二：</span> 
</div> 
<div> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;">     去除票据数据加密，CAS中有一个类<span style="font-size:12pt;">noOpCookieValueManager，省略了对票据的加密解密过程。可在<span style="font-size:12pt;">deployerConfigContext.xml文件中配置</span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    <span style="font-size:12pt;">&lt;bean id="ticketGrantingTicketCookieGenerator" class="org.jasig.cas.web.support.TGCCookieRetrievingCookieGenerator"&gt;</span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;">                            &lt;constructor-arg  ref="noOpCookieValueManager" /&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;">                    &lt;/bean&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">            </span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">          4<span style="font-size:12pt;">. 使用redis作为集群公共缓存ticket的仓库</span><span style="font-size:12pt;">：</span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">            </span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">            </span><span style="font-size:12pt;">（1） 简要说明：</span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      单独CAS生成TGT票据时默认缓存在所在服务器内存中，所以集群环境下如果生成票据和认证票据的请求在不同的服务器上，那么会造成票据</span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                      认证错误。</span></span></span></span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">            （2） 解决方法：</span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                     </span><span style="font-size:12pt;">① </span><span style="font-size:12pt;">可建立本地工程，新建 </span><span style="min-height:16pt;font-size:14pt;background:rgb(212,212,212);font-family:Consolas;">AbstractDistributedTicketRegistry</span><span style="font-size:12pt;"> 的继承类 ：</span></span></span></span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">java.util.Collection;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">java.util.HashSet;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">java.util.Set;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">java.util.concurrent.TimeUnit;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">javax.validation.constraints.Min;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">javax.validation.constraints.NotNull;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">org.jasig.cas.ticket.ServiceTicket;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">org.jasig.cas.ticket.Ticket;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">org.jasig.cas.ticket.TicketGrantingTicket;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">org.jasig.cas.ticket.registry.AbstractDistributedTicketRegistry;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    import</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">org.springframework.beans.factory.DisposableBean;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>    public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>class</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">RedisTicketRegistry </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>extends</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">AbstractDistributedTicketRegistry</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>implements</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">DisposableBean {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">    </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">/**</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;"><u>redis</u></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">client. */</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@NotNull</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>private</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">TicketRedisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">/**</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     * TGT cache entry timeout in seconds.</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     */</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@Min</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(0)</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>private</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>int</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">tgtTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">/**</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     * ST cache entry timeout in seconds.</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     */</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@Min</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(0)</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>private</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>int</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">stTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>private</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">String</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">PREFIX_CAS</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"CAS:TICKET:"</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">RedisTicketRegistry(TicketRedisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>int</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">tgtTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>int</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">stTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">tgtTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">tgtTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">stTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">stTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">    }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span><span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@</span><span style="min-height:16pt;background:rgb(212,212,212);font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">Override</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>void</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">addTicket(Ticket</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">logger</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.info(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"Add ticket {}"</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>try</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">{<!-- --></span> 
</div> 
<div style="min-height:11pt;"> 
 <span style="font-size:12pt;"><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">             </span><span style="min-height:11pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">.</span><span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">.boundValueOps(</span><span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">PREFIX_CAS</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">+</span><span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">.getId()).set(</span><span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">, getTimeout(</span><span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">), TimeUnit.</span><span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;"><strong><em>SECONDS</em></strong></span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">);</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">        }</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>catch</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(Exception</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">e</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span><span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">e</span><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.printStackTrace();</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">        }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">     }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span><span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@</span><span style="min-height:16pt;background:rgb(212,212,212);font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">Override</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">Ticket getTicket(String</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticketId</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">logger</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.info(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"Get ticket {}"</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticketId</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>try</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">{<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">               Ticket</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">t</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">= (Ticket)</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.boundValueOps(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">PREFIX_CAS</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">+</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticketId</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">).get();</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">               </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>if</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">t</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">!=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>null</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">               </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">getProxiedTicketInstance(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">t</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">            }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">        }</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>catch</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">Exception</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">e</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">logger</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.error(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"Failed fetching {} "</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticketId</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">e</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">        }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>null</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">     }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span><span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@</span><span style="min-height:16pt;background:rgb(212,212,212);font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">Override</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">Collection&lt;Ticket&gt; getTickets() {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          Set&lt;Ticket&gt;</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">tickets</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>new</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">HashSet&lt;Ticket&gt;();</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">         Set&lt;String&gt;</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">keys</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">=</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.keys(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">PREFIX_CAS</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">+</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"*"</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">        </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>for</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(String</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">key</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">:</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">keys</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">           Ticket</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">= (Ticket)</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.boundValueOps(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">key</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">).get();</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>if</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">==</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>null</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">)</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">            </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.delete(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">key</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>else</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">{<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">            </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">tickets</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.add(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">           }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">         }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">tickets</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">     }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span><span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@</span><span style="min-height:16pt;background:rgb(212,212,212);font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">Override</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>protected</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>boolean</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">needsCallback() {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,127,95);font-family:Consolas;">//</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,159,191);font-family:Consolas;"><strong>TODO</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,127,95);font-family:Consolas;">Auto-generated method stub</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>true</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">     }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span><span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@</span><span style="min-height:16pt;background:rgb(212,212,212);font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">Override</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>protected</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>void</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">updateTicket(Ticket</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span><span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">logger</span><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.info(</span><span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"Updating ticket {}"</span><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span><span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>try</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">{<!-- --></span> 
</div> 
<div style="min-height:11pt;"> 
 <span style="font-size:12pt;"><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">             </span><span style="min-height:11pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">.</span><span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">.boundValueOps(</span><span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">PREFIX_CAS</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">+</span><span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">.getId()).set(</span><span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">, getTimeout(</span><span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">), TimeUnit.</span><span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;"><strong><em>SECONDS</em></strong></span><span style="min-height:11pt;font-size:12pt;font-family:Consolas;">);</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">        }</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>catch</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">Exception</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">e</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">logger</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.error(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"Failed updating {}"</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticket</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">e</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">        }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">     }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span><span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@</span><span style="min-height:16pt;background:rgb(212,212,212);font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">Override</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>boolean</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">deleteSingleTicket(String</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticketId</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">logger</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.debug(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"Deleting Single Ticket {}"</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticketId</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>try</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">{<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">          </span></span> 
</div> 
<div style="min-height:11pt;"> 
 <span style="min-height:11pt;font-size:12pt;font-family:Consolas;">           </span> 
 <span style="min-height:11pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:11pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">redisTemplate</span> 
 <span style="min-height:11pt;font-size:12pt;font-family:Consolas;">.delete(</span> 
 <span style="min-height:11pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">PREFIX_CAS</span> 
 <span style="min-height:11pt;font-size:12pt;font-family:Consolas;">+</span> 
 <span style="min-height:11pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticketId</span> 
 <span style="min-height:11pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">           </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>true</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">        }</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>catch</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">Exception</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">e</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">logger</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.error(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"Failed deleting {}"</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">ticketId</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">,</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">e</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">        }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>false</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">     }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span><span style="min-height:16pt;font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">@</span><span style="min-height:16pt;background:rgb(212,212,212);font-size:12pt;color:rgb(100,100,100);font-family:Consolas;">Override</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>void</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">destroy()</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>throws</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">Exception {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">          </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,127,95);font-family:Consolas;">//</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,159,191);font-family:Consolas;"><strong>TODO</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,127,95);font-family:Consolas;">Auto-generated method stub</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">     }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="font-size:12pt;"><span style="min-height:16pt;font-size:12pt;font-family:Consolas;">     </span><span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">/**</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     * Gets the timeout value for the ticket.</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     *</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     *</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,159,191);font-family:Consolas;"><strong>@param</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">t the t</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     *</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,159,191);font-family:Consolas;"><strong>@return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">the timeout</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;color:rgb(63,95,191);font-family:Consolas;">     */</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">   </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>private</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>int</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">getTimeout(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>final</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">Ticket</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">t</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>if</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">t</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>instanceof</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">TicketGrantingTicket) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">           </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">tgtTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">        }</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>else</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>if</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(106,62,62);font-family:Consolas;">t</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>instanceof</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">ServiceTicket) {<!-- --></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">           </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>return</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>this</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">.</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(0,0,192);font-family:Consolas;">stTimeout</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">;</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">        }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">       </span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>throw</strong></span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(127,0,85);font-family:Consolas;"><strong>new</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">IllegalArgumentException(</span> 
 <span style="min-height:16pt;font-size:12pt;color:rgb(42,0,255);font-family:Consolas;">"Invalid ticket type"</span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;">);</span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">    }</span></span> 
</div> 
<div style="min-height:16pt;"> 
 <span style="min-height:16pt;"><span style="font-size:12pt;font-family:Consolas;">   </span></span> 
 <span style="font-size:12pt;font-family:Consolas;">}</span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <br> 
</div> 
<div>
                    
 <span style="font-size:12pt;">  ② 新建</span> 
 <span style="min-height:16pt;background:rgb(212,212,212);font-size:12pt;font-family:Consolas;">RedisTemplate的继承类</span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-size:12pt;">  </span> 
 <span style="font-size:12pt;font-family:Consolas;">   </span> 
 <span style="font-size:12pt;font-family:Consolas;">import org.jasig.cas.ticket.Ticket;</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">    import org.springframework.data.redis.connection.RedisConnectionFactory;</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">    import org.springframework.data.redis.core.RedisTemplate;</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">    import org.springframework.data.redis.serializer.JdkSerializationRedisSerializer;</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">    import org.springframework.data.redis.serializer.RedisSerializer;</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">    import org.springframework.data.redis.serializer.StringRedisSerializer;</span> 
</div> 
<div> 
 <br> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">  </span> 
 <span style="font-family:Consolas;font-size:12pt;color:rgb(106,0,129);"> </span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;color:rgb(127,0,85);"><strong>public</strong></span> 
 <span style="min-height:16pt;font-size:12pt;font-family:Consolas;color:rgb(127,0,85);"><strong>class </strong></span> 
 <span style="font-family:Consolas;font-size:12pt;">TicketRedisTemplate extends RedisTemplate&lt;String, Ticket&gt;{<!-- --></span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">        public TicketRedisTemplate()</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">          {<!-- --></span> 
</div> 
<div> 
 <span style="font-size:12pt;font-family:Consolas;">    </span> 
 <span style="font-size:12pt;font-family:Consolas;">        RedisSerializer string =</span> 
 <span style="min-height:16pt;background:rgb(232,242,254);"><span style="font-family:Consolas;background-color:rgb(232,242,254);color:rgb(127,0,85);font-size:12pt;"><strong>new</strong></span></span> 
 <span style="font-size:14pt;min-height:16pt;background:rgb(232,242,254);font-family:Consolas;color:rgb(127,0,85);"><strong> </strong></span> 
 <span style="font-size:12pt;font-family:Consolas;">StringRedisSerializer();</span> 
</div> 
<div> 
 <span style="font-size:12pt;font-family:Consolas;">       </span> 
 <span style="font-size:12pt;font-family:Consolas;">     JdkSerializationRedisSerializer jdk =</span> 
 <span style="min-height:16pt;background:rgb(232,242,254);"><span style="font-family:Consolas;background-color:rgb(232,242,254);color:rgb(127,0,85);font-size:12pt;"><strong>new </strong></span></span> 
 <span style="font-size:12pt;font-family:Consolas;">JdkSerializationRedisSerializer();</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">            setKeySerializer(string);</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">            setValueSerializer(jdk);</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">            setHashKeySerializer(string);</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">            setHashValueSerializer(jdk);</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">          }</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">     </span> 
 <span style="font-size:12pt;min-height:16pt;font-family:Consolas;color:rgb(127,0,85);"><strong>public</strong></span> 
 <span style="font-family:Consolas;font-size:12pt;">TicketRedisTemplate(RedisConnectionFactory connectionFactory)</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">      {<!-- --></span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">        setConnectionFactory(connectionFactory);</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">        afterPropertiesSet();</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">      }</span> 
</div> 
<div> 
 <span style="font-family:Consolas;font-size:12pt;">}</span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;">        <span style="font-size:12pt;">③ 修改配置文件：</span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;">           </span>  
 <span style="font-size:12pt;">注释掉deployerConfigContext.xml中的票据仓库配置配置：</span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    </span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">             在<span style="font-size:12pt;">applicationContext.xml中加入配置</span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">           <span style="font-size:12pt;color:rgb(65,173,28);"> </span><span style="font-size:12pt;color:rgb(65,173,28);">&lt;!--</span> <span style="font-size:12pt;color:rgb(65,173,28);">配置自定义票据仓库</span><span style="font-size:12pt;color:rgb(65,173,28);">,class写入自定义文件路径--&gt;</span></span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">            <span style="font-size:12pt;">&lt;bean id="redisTicketRegistry" class="XXX.XXX.XXX.XXX.RedisTicketRegistry"&gt;</span></span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;constructor-arg index="0" ref="redisTemplate" /&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;constructor-arg index="1" value="1800" /&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;constructor-arg index="2" value="10" /&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;/bean&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;bean id="noOpByteCipherExecutor"  class="com.hpe.cipher.executor.NoOpByteCipherExecutor"/&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;bean id="jedisConnFactory"</span> 
</div> 
<div> 
 <span style="font-size:12pt;">              class="org.springframework.data.redis.connection.jedis.JedisConnectionFactory"</span> 
</div> 
<div> 
 <span style="font-size:12pt;">              p:hostName="127.0.0.1"</span> 
</div> 
<div> 
 <span style="font-size:12pt;">              p:database="0"</span> 
</div> 
<div> 
 <span style="font-size:12pt;">              p:usePool="true"</span> 
</div> 
<div> 
 <span style="font-size:12pt;">              p:pool-config-ref="poolConfig"/&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;bean id="poolConfig" class="redis.clients.jedis.JedisPoolConfig"&gt;  </span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;property name="maxIdle" value="200" /&gt;  </span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;property name="testOnBorrow" value="true" /&gt;  </span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;/bean&gt;  </span> 
</div> 
<div> 
 <span style="font-size:12pt;">            <span style="font-size:12pt;color:rgb(77,206,29);">&lt;!--</span> <span style="font-size:12pt;color:rgb(77,206,29);">配置自定义模板</span><span style="font-size:12pt;color:rgb(77,206,29);">,class写入自定义文件路径--&gt;</span></span> 
</div> 
<div> 
 <span style="font-size:12pt;">            <span style="font-size:12pt;">&lt;bean id="redisTemplate" class="XXX.XXX.XXX.TicketRedisTemplate"</span></span> 
</div> 
<div> 
 <span style="font-size:12pt;">                p:connection-factory-ref="jedisConnFactory"&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;">            &lt;/bean&gt;</span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                 </span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                  </span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;">    </span> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">       到此，配置完成，可以完成集群部署的SSO功能。</span></span></span> 
</div> 
<div> 
 <span style="font-size:12pt;"><span style="font-size:12pt;"><span style="font-size:12pt;">                    </span></span></span> 
</div> 
<br> 
<br>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/76f967689c064eb8d2af3c9fdfe6cfa5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">PSV破解流程&#43;软件游戏安装（最简单/最快的方法整理，已测支持3.65~3.68，理论上支持全系列版本）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9e0d23051960a70363304f500e99ab20/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">(webpack打包css) You may need an appropriate loader to handle this file type</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>