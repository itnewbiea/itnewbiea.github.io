<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>（一）看参考手册学stm32基于hal库，点灯时钟配置 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="（一）看参考手册学stm32基于hal库，点灯时钟配置" />
<meta property="og:description" content="（一）看参考手册学stm32基于hal库，点灯时钟配置 这篇文章主要是个人的学习经验，想分享出来供大家提供思路，如果其中有不足之处请批评指正哈。
废话不多说直接开始主题，本人是基于STM32F407VET6芯片，但是意在你看懂这篇文章后，不管是F1,F4,H7等一系列系统时钟配置都能明白如何通过参考手册去学习配置。而不是Ctrl c，Ctrl v。
时钟配置 首先看看数据手册目录找找有木有时钟相关的内容好定位。
1.这句话就告诉你了你可以不用外部接时钟用它内部的就行，16 MHz内部RC振荡器在出厂时经过修整，在整个温度范围内提供1%的精度。他是这么说但是我不这么相信，主要是我的开发板上有一块8M的外部晶振，不用就浪费了。
2.这就是外部晶振的频率要求，我就不翻译了。
3.看看我自己的开发板原理图，8M没问题
4.数据手册中告诉你了，APB，AHB总线的频率要求，一会我就会参照着他的要求设置cubemx的时钟树配置，是不是配置时钟有点思路了？
几个预分频器允许配置三个AHB总线，即高速APB(APB2)和低速APB (APB1)域。三个AHB总线的最大频率为168 MHz，而高速APB域的最大频率为168 MHz，84 MHz。低速APB域允许的最大频率为42Mhz。该器件嵌入了一个专用的锁相环(PLLI2S)，可实现音频级性能。在这种情况下，i2s主时钟可以产生从8khz到192khz的所有标准采样频率。
再看看定时器的时钟配置
数据手册中还写到APB1线上的定时器84MHZ，APB1=42MHZ
APB2线上的定时器168MHZ,APB2=84MHZ.
CUBEMX时钟树的这几个数为什么知道由来了吧。
5.来到参考手册这看看相关时钟配置，你该想想如果是别的系列的芯片怎么看手册该怎么配置了？
6.他说3个不同的时钟源，三种不同的时钟源可用于驱动系统时钟(SYSCLK):
•恒生指数振荡器时钟
•HSE振荡器时钟
•主锁相环(PLL)时钟
好看看cubemx
还真是3个时钟源啊，只不过我用的主锁相环(PLL)时钟。其他时钟源还可以试试不会坏的，又不是VCC,GND。
7.设备有以下两个备用时钟源:
•32 kHz低速内部RC (LSI RC)，驱动独立的看门狗，可选的RTC用于从停止/待机模式自动唤醒。
•32.768 kHz低速外部晶体(LSE晶体)可选驱动RTC时钟(RTCCLK)
本人用的外部时钟始终秉持着不用就浪费原则。
好好看看翻译，好好看看这几张图，思考一下你会豁然开朗的，因为每一块都是一一对应的关系。
9.这张抽象无比的时钟树真正关键的只有这几个小点，其他的我爱答不理。
配置cubemx 有了参考基础，接下来开始正式配置外部时钟
1.打开cubemx
2.本人用的是f407，如果是不一样的芯片按自己的型号来
3.上文也介绍了我不管是高速还是低速都用的是外部晶振，详见上文第3条第7条。
4.cubemx时钟树需要根据你的选择如果是外部晶振，需要根据你的原理图去配置，我原理图是32.768K,8M所以本人根据此配置。
5.再根据要求系统时钟（sysclk）不能超过180MHz，APB1&lt;=42MHZ,APB1 CLOCK&lt;=84MZ,APB2&lt;=84MHZ,APB1 CLOCK&lt;=168MZ满足以上要求即可，如图所示
至此你应该明白了，噢原来时钟只要小于他的限幅频率即可，那我设多少都可以比如SYSCLK&lt;=180,那我179，178，176.52，168无论是不是浮点数只要小于180都是可以的。至此外部晶振的工作已经完成。
内部源时钟配置 1.失能即可，即进入内部时钟源
2.你会发现外部的时钟源那部分已经改不了了，其他内容配置同外部晶振配置
接下来怎么测试可行性呢？点个灯试试
F407按键点灯
经过测试不管是内部时钟还是外部时钟都没问题哈哈。
本文没有对点灯部分详细讲解，将会在下一篇文章中讲解物理知识以及hal库的使用，纯属个人经验，有不足之处希望大家指正。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/764ff8ec6c6081902d1c20f2b10e77bb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T13:34:49+08:00" />
<meta property="article:modified_time" content="2024-01-04T13:34:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">（一）看参考手册学stm32基于hal库，点灯时钟配置</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="stm32hal_0"></a>（一）看参考手册学stm32基于hal库，点灯时钟配置</h2> 
<p>这篇文章主要是个人的学习经验，想分享出来供大家提供思路，如果其中有不足之处请批评指正哈。<br> 废话不多说直接开始主题，本人是基于STM32F407VET6芯片，但是意在你看懂这篇文章后，不管是F1,F4,H7等一系列系统时钟配置都能明白如何通过参考手册去学习配置。而不是Ctrl c，Ctrl v。</p> 
<h3><a id="_5"></a>时钟配置</h3> 
<p>首先看看数据手册目录找找有木有时钟相关的内容好定位。<br> <img src="https://images2.imgbox.com/a1/0e/xTr7O7yI_o.png" alt="数据手册图片"><br> <img src="https://images2.imgbox.com/b6/ef/32xKdOQv_o.png" alt="在这里插入图片描述"><br> 1.这句话就告诉你了你可以不用外部接时钟用它内部的就行，16 MHz内部RC振荡器在出厂时经过修整，在整个温度范围内提供1%的精度。他是这么说但是我不这么相信，主要是我的开发板上有一块8M的外部晶振，不用就浪费了。<br> <img src="https://images2.imgbox.com/04/8b/SGWfMctT_o.png" alt="在这里插入图片描述">2.这就是外部晶振的频率要求，我就不翻译了。<br> <img src="https://images2.imgbox.com/92/55/xJZbG4Ou_o.png" alt="在这里插入图片描述"></p> 
<p>3.看看我自己的开发板原理图，8M没问题<br> <img src="https://images2.imgbox.com/4f/ea/EzN62I1Q_o.png" alt="在这里插入图片描述"></p> 
<p>4.数据手册中告诉你了，APB，AHB总线的频率要求，一会我就会参照着他的要求设置cubemx的时钟树配置，<strong>是不是配置时钟有点思路了？</strong><br> <img src="https://images2.imgbox.com/45/c0/pM8OVORo_o.png" alt="在这里插入图片描述">几个预分频器允许配置三个AHB总线，即高速APB(APB2)和低速APB (APB1)域。三个AHB总线的最大频率为168 MHz，而高速APB域的最大频率为168 MHz，84 MHz。低速APB域允许的最大频率为42Mhz。该器件嵌入了一个专用的锁相环(PLLI2S)，可实现音频级性能。在这种情况下，i2s主时钟可以产生从8khz到192khz的所有标准采样频率。</p> 
<p><strong>再看看定时器的时钟配置</strong><br> <img src="https://images2.imgbox.com/c0/24/gxY1WxCp_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/f7/ee/taa9RNjr_o.png" alt="在这里插入图片描述"><strong>数据手册中还写到APB1线上的定时器84MHZ，APB1=42MHZ</strong></p> 
<p><img src="https://images2.imgbox.com/13/9e/WldkKVnR_o.png" alt="在这里插入图片描述"><strong>APB2线上的定时器168MHZ,APB2=84MHZ.</strong><br> <img src="https://images2.imgbox.com/e6/56/N8g7I7Fg_o.png" alt="在这里插入图片描述"><strong>CUBEMX时钟树的这几个数为什么知道由来了吧。</strong></p> 
<p>5.来到参考手册这看看相关时钟配置，<strong>你该想想如果是别的系列的芯片怎么看手册该怎么配置了？</strong><br> <img src="https://images2.imgbox.com/4d/a1/qc7ctzsL_o.png" alt="在这里插入图片描述">6.他说3个不同的时钟源，三种不同的时钟源可用于驱动系统时钟(SYSCLK):<br> •恒生指数振荡器时钟<br> •HSE振荡器时钟<br> •主锁相环(PLL)时钟<br> <strong>好看看cubemx</strong><br> <img src="https://images2.imgbox.com/ea/c0/H3oVQbmo_o.png" alt="在这里插入图片描述">还真是3个时钟源啊，只不过我用的主锁相环(PLL)时钟。其他时钟源还可以试试不会坏的，又不是VCC,GND。<br> <img src="https://images2.imgbox.com/95/90/Azd29K4W_o.png" alt="在这里插入图片描述"><br> 7.设备有以下两个备用时钟源:<br> •32 kHz低速内部RC (LSI RC)，驱动独立的看门狗，可选的RTC用于从停止/待机模式自动唤醒。<br> •32.768 kHz低速外部晶体(LSE晶体)可选驱动RTC时钟(RTCCLK)<br> <strong>本人用的外部时钟始终秉持着不用就浪费原则。</strong><br> <img src="https://images2.imgbox.com/18/b4/xvBok23i_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/35/8f/QuTHII5p_o.png" alt="在这里插入图片描述">好好看看翻译，好好看看这几张图，思考一下你会豁然开朗的，因为每一块都是一一对应的关系。<br> <img src="https://images2.imgbox.com/40/23/jYfTSEuF_o.png" alt="在这里插入图片描述"></p> 
<p>9.这张抽象无比的时钟树真正关键的只有这几个小点，其他的我爱答不理。<br> <img src="https://images2.imgbox.com/32/71/wPDbH4Yu_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="cubemx_49"></a>配置cubemx</h3> 
<p><strong>有了参考基础，接下来开始正式配置外部时钟</strong></p> 
<p>1.打开cubemx<br> <img src="https://images2.imgbox.com/55/6b/G3g1JHU5_o.png" alt="在这里插入图片描述">2.本人用的是f407，如果是不一样的芯片按自己的型号来<br> <img src="https://images2.imgbox.com/bd/e9/UhbaOKZH_o.png" alt="在这里插入图片描述">3.上文也介绍了我不管是高速还是低速都用的是外部晶振，详见上文第3条第7条。<br> <img src="https://images2.imgbox.com/4e/c6/6oqhs4yR_o.png" alt="在这里插入图片描述">4.cubemx时钟树需要根据你的选择如果是外部晶振，需要根据你的原理图去配置，我原理图是32.768K,8M所以本人根据此配置。<br> <img src="https://images2.imgbox.com/0c/ef/wA3zaWO9_o.png" alt="在这里插入图片描述">5.再根据要求系统时钟（sysclk）不能超过180MHz，APB1&lt;=42MHZ,APB1 CLOCK&lt;=84MZ,APB2&lt;=84MHZ,APB1 CLOCK&lt;=168MZ满足以上要求即可，如图所示<br> <img src="https://images2.imgbox.com/08/eb/70wKyUPh_o.png" alt="在这里插入图片描述">至此你应该明白了，噢原来时钟只要小于他的限幅频率即可，那我设多少都可以比如SYSCLK&lt;=180,那我179，178，176.52，168无论是不是浮点数只要小于180都是可以的。至此外部晶振的工作已经完成。</p> 
<h3><a id="_60"></a>内部源时钟配置</h3> 
<p>1.失能即可，即进入内部时钟源<br> <img src="https://images2.imgbox.com/76/08/VFVcy36P_o.png" alt="在这里插入图片描述">2.你会发现外部的时钟源那部分已经改不了了，其他内容配置同外部晶振配置<br> <img src="https://images2.imgbox.com/32/79/PWM9WeGd_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/76/77/wSlsu6VM_o.png" alt="在这里插入图片描述"><br> 接下来怎么测试可行性呢？点个灯试试</p> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="RU0VebQa-1704345985935" frameborder="0" src="https://live.csdn.net/v/embed/356851" allowfullscreen="true" data-mediaembed="csdn"></iframe> 
 <p>F407按键点灯</p> 
</div> 
<p></p> 
<p>经过测试不管是内部时钟还是外部时钟都没问题哈哈。<br> 本文没有对点灯部分详细讲解，将会在下一篇文章中讲解物理知识以及hal库的使用，纯属个人经验，<strong>有不足之处希望大家指正</strong>。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/171de4b7878413e10d6509d1d1d7d290/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【React系列】非父子组件通信—Context.Provider共享数据、events库事件总线通信</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3e53bac48ced92f527676919acd83bf6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【React系列】Hook（一）基本使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>