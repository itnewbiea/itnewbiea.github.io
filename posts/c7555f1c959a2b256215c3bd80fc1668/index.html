<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ESP8266二次入坑笔记(4) NONOS 3.0程序架构与注意事项 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ESP8266二次入坑笔记(4) NONOS 3.0程序架构与注意事项" />
<meta property="og:description" content="一、前言 在完成了搭建环境与编译烧录后，接下来需要了解一下3.0版本的程序架构。
二、本文参考资料 1.esp8266_nonos_3.0版本的API使用文档.pdf（乐鑫官方文档）
2.https://www.bilibili.com/video/BV1dJ411S723?p=12（技小新8266教程）
三、正文部分 3.1 程序架构 ESP8266的SDK编程是基于“内核回调”的方式
user_main.c 文件中：
void user_init(void)	//8266内核为用户提供的初始化接口：用户的【应用功能初始化】入口 { 初始化...;	//IO口、定时器、设置中断... } 用户看不见，不能修改
{ 内核初始化... user_init();	//执行 用户的【应用功能初始化】 while(1)	//类似主循环 { 执行内核功能... 执行用户功能...	//比如：用户初始化中设置了1s定时，那么在这里将会进行定时器计时 } } 回调函数 //当满足某条件时，内核调用这些回调函数
void xxx_cb(void) { LED闪烁... } 任务函数 //如果安排了任务，在系统空闲时，内核会调用任务函数
void xxx_Task(void) { ... } 中断函数 //当触发中断时，进入中断函数
void xxx_IRQHandler(void) { ... } 以下是官方文档的介绍
Non-OS SDK 为用户提供了一套应用程序编程接口 (API)，能够实现 ESP8266 的核心功能，例如数据接收/发送、 TCP/IP 功能、硬件接口功能，以及基本的系统管理理功能等。用户不必关心底层网络，如 Wi-Fi、 TCP/IP 等的具体实现，只需要专注于物联网上层应用的开发，利用相应接口实现各种功能即可。
ESP8266 物联网平台的所有⽹网络功能均在库中实现，对用户不不透明。用户应用的初始化功能可以在 user_main.c 中实现。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c7555f1c959a2b256215c3bd80fc1668/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-01T23:58:45+08:00" />
<meta property="article:modified_time" content="2020-04-01T23:58:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ESP8266二次入坑笔记(4) NONOS 3.0程序架构与注意事项</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>一、前言</h3> 
<p>在完成了搭建环境与编译烧录后，接下来需要了解一下3.0版本的程序架构。</p> 
<h3><a id="_3"></a>二、本文参考资料</h3> 
<p>1.esp8266_nonos_3.0版本的API使用文档.pdf（乐鑫官方文档）<br> 2.https://www.bilibili.com/video/BV1dJ411S723?p=12（技小新8266教程）</p> 
<h3><a id="_7"></a>三、正文部分</h3> 
<h4><a id="31__8"></a>3.1 程序架构</h4> 
<p>ESP8266的SDK编程是基于“内核回调”的方式<br> user_main.c 文件中：</p> 
<pre><code>void user_init(void)		//8266内核为用户提供的初始化接口：用户的【应用功能初始化】入口
{
	初始化...;	//IO口、定时器、设置中断...
}
</code></pre> 
<p>用户看不见，不能修改</p> 
<pre><code>{
	内核初始化...
	user_init();	//执行 用户的【应用功能初始化】
	while(1)	//类似主循环
	{
		执行内核功能...
		执行用户功能...	//比如：用户初始化中设置了1s定时，那么在这里将会进行定时器计时
	}
}
</code></pre> 
<p>回调函数 //当满足某条件时，内核调用这些回调函数</p> 
<pre><code>void xxx_cb(void)
{
	LED闪烁...
}
</code></pre> 
<p>任务函数 //如果安排了任务，在系统空闲时，内核会调用任务函数</p> 
<pre><code>void xxx_Task(void)
{
	...
}
</code></pre> 
<p>中断函数 //当触发中断时，进入中断函数</p> 
<pre><code>void xxx_IRQHandler(void)
{
	...
}
</code></pre> 
<p><strong>以下是官方文档的介绍</strong><br> Non-OS SDK 为用户提供了一套应用程序编程接口 (API)，能够实现 ESP8266 的核心功能，例如数据接收/发送、 TCP/IP 功能、硬件接口功能，以及基本的系统管理理功能等。用户不必关心底层网络，如 Wi-Fi、 TCP/IP 等的具体实现，只需要专注于物联网上层应用的开发，利用相应接口实现各种功能即可。<br> ESP8266 物联网平台的所有⽹网络功能均在库中实现，对用户不不透明。用户应用的初始化功能可以在 user_main.c 中实现。</p> 
<p><strong>void user_init(void) 是上层程序的入口函数，给用户提供一个初始化接口，用户可在该函数内增加硬件初始化、网络参数设置、定时器器初始化等功能。</strong></p> 
<p><strong><mark>• 对于 ESP8266_NONOS_SDK_v3.0.0 及之后版本，请在 user_main.c 增加函数void ICACHE_FLASH_ATTR user_pre_init(void)，并且user_pre_init 中注册自己的 partition table。</mark></strong></p> 
<p>对于 ESP8266_NONOS_SDK_v2.1.0 及之后版本，用户如果并未使用 DIO-To-QIO flash，可以在 user_main.c 中增加空函数 void user_spi_flash_dio_to_qio_pre_init(void)来优化 iRAM 空间。<br> SDK 中提供了了对 JSON 包的处理理 API，用户也可以采用自定义数据包格式，自行对数据进行处理。<br> Non-OS SDK 不像基于 RTOS 的应用程序支持任务调度。 Non-OS SDK 使用四种类型的函数：<br> - 应用函数<br> - 回调函数<br> - 用户任务<br> - 中断服务程序 (Interrupt Service Routines, ISR)</p> 
<h4><a id="32_SDK_67"></a>3.2 SDK编程注意事项</h4> 
<p><strong>1.</strong> 请勿频繁调用定时器<br> <strong>2.</strong> 微秒定时器不是很精确<br> <strong>3.</strong> ESP8266 通常的运行速率为 80 MHz，在高性能应用中也可以配置为160MHz。请注意，外设不受CPU 频率设置的影响，因为它们使用了不同的时钟源。<br> <strong>4.</strong> 添加了 ICACHE_FLASH_ATTR 的代码通常比使用 IRAM_ATTR 标记的代码执行得慢。然而，像大多数嵌入式平台一样， ESP8266 的 iRAM 空间有限，因此建议一般代码添加ICACHE_FLASH_ATTR，仅对执行效率要求高的代码添加 IRAM_ATTR宏。<br> <strong>5.</strong> RAM 和 flash 访问必须是 4 字对齐的，请勿直接进行指针转换。请使用os_memcpy 或其他 API 进行内存操作</p> 
<h4><a id="33__75"></a>3.3 如何添加第三方文件</h4> 
<p><strong>1.添加uart.c文件</strong><br> <img src="https://images2.imgbox.com/25/f1/1ZPwph0n_o.png" alt="在这里插入图片描述"></p> 
<p><strong>2.添加uart.h与uart_register.h</strong><br> <img src="https://images2.imgbox.com/28/b1/eBhZHC1k_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0db536056e5405fbf917bc9b109005f4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java 包与权限</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f408c61b363fe5ab34bc7845c9d8352/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">unity 使用CharacterController实现人物模拟力作用的跳跃加移动方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>