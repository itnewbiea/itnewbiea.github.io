<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>以代码流程方式探索Spring源码(九)--Bean实例化3--populateBean--IOC和DI执行的地方 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="以代码流程方式探索Spring源码(九)--Bean实例化3--populateBean--IOC和DI执行的地方" />
<meta property="og:description" content="以代码流程方式探索Spring源码--Bean实例化3--populateBean--IOC和DI执行的地方 入口:populateBean()对InstantiationAwareBeanPostProcessor的使用通过BeanPostProcessor进行属性依赖注入AutowiredAnnotationBeanPostProcessor的应用CommonAnnotationBeanPostProcessor的应用 入口:populateBean() 收集注解后，会对条件合适的bean进行三级缓存操作，这一步先跳过，与循环依赖一起研究。
目前我们已经通过实例化方法创建了我们的bean实例，但是是一个裸实例，存在于堆内存，但是没有属性值，在populateBean方法中进行属性的填充，这个时候回发生DI（依赖注入）。
对InstantiationAwareBeanPostProcessor的使用 首先依次执行实现了InstantiationAwareBeanPostProcessor的BeanPostProcessor的postProcessAfterInstantiation方法。因为这一步是发生的依赖注入之前的，所以可以自己实现一个B eanPostProcessor在对应的方法中返回false，这个地方就会直接短路return，从而不会执行依赖注入。
举个栗子：在这个地方可以针对某些具体的bean决定要不要执行依赖注入，还可进行其余的扩展。
通过BeanPostProcessor进行属性依赖注入 该处主要是对两个BeanPostProcessor的应用：
1、AutowiredAnnotationBeanPostProcessor
2、CommonAnnotationBeanPostProcessor
AutowiredAnnotationBeanPostProcessor的应用 先调用findAutowiringMetadata（）方法寻找有@Autowired注解的属性和方法。这次进入方法的时候可以直接从缓存中取了。因为我们在之前的注解收集阶段已经把相关的属性和方法解析为InjectionMetadata放在缓存中了。
在进行inject的时候，对于引用类型的注入，会触发对应Bean的实例化操作，即调用getBean()方法。
下面是对Field的注入
这个地方会出里@Value注解
先获取候选的Bean，单例情况下，候选Bean只有一个，走else分支，然后解析该Bean。
解析其实就是getBean()。
对方法上面的@Autowired注解的处理也是类似的，先处理参数，如果参数需要注入，同样会调用getBean()方法。
CommonAnnotationBeanPostProcessor的应用 最后才会进行xml文件中配置的属性依赖注入。过时的操作就不赘述了。。。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/3cb4e162f4e8dcd5c1eafe99679ebd21/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-06T16:05:37+08:00" />
<meta property="article:modified_time" content="2021-03-06T16:05:37+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">以代码流程方式探索Spring源码(九)--Bean实例化3--populateBean--IOC和DI执行的地方</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>以代码流程方式探索Spring源码--Bean实例化3--populateBean--IOC和DI执行的地方</h4> 
 <ul><li><ul><li><a href="#populateBean_2" rel="nofollow">入口:populateBean()</a></li><li><a href="#InstantiationAwareBeanPostProcessor_6" rel="nofollow">对InstantiationAwareBeanPostProcessor的使用</a></li><li><a href="#BeanPostProcessor_11" rel="nofollow">通过BeanPostProcessor进行属性依赖注入</a></li><li><ul><li><a href="#AutowiredAnnotationBeanPostProcessor_16" rel="nofollow">AutowiredAnnotationBeanPostProcessor的应用</a></li><li><a href="#CommonAnnotationBeanPostProcessor_32" rel="nofollow">CommonAnnotationBeanPostProcessor的应用</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="populateBean_2"></a>入口:populateBean()</h3> 
<p>收集注解后，会对条件合适的bean进行三级缓存操作，这一步先跳过，与循环依赖一起研究。<br> 目前我们已经通过实例化方法创建了我们的bean实例，但是是一个裸实例，存在于堆内存，但是没有属性值，在populateBean方法中进行属性的填充，这个时候回发生DI（依赖注入）。<br> <img src="https://images2.imgbox.com/c4/43/psw0H01t_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="InstantiationAwareBeanPostProcessor_6"></a>对InstantiationAwareBeanPostProcessor的使用</h3> 
<p>首先依次执行实现了InstantiationAwareBeanPostProcessor的BeanPostProcessor的postProcessAfterInstantiation方法。因为这一步是发生的依赖注入之前的，所以可以自己实现一个B eanPostProcessor在对应的方法中返回false，这个地方就会直接短路return，从而不会执行依赖注入。<br> <img src="https://images2.imgbox.com/31/f6/bubPJe03_o.png" alt="在这里插入图片描述"><br> 举个栗子：在这个地方可以针对某些具体的bean决定要不要执行依赖注入，还可进行其余的扩展。<br> <img src="https://images2.imgbox.com/fc/de/LZptQzms_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="BeanPostProcessor_11"></a>通过BeanPostProcessor进行属性依赖注入</h3> 
<p><img src="https://images2.imgbox.com/63/35/C5MlnsVA_o.png" alt="在这里插入图片描述"><br> 该处主要是对两个BeanPostProcessor的应用：<br> 1、AutowiredAnnotationBeanPostProcessor<br> 2、CommonAnnotationBeanPostProcessor</p> 
<h4><a id="AutowiredAnnotationBeanPostProcessor_16"></a>AutowiredAnnotationBeanPostProcessor的应用</h4> 
<p>先调用findAutowiringMetadata（）方法寻找有@Autowired注解的属性和方法。这次进入方法的时候可以直接从缓存中取了。因为我们在之前的注解收集阶段已经把相关的属性和方法解析为InjectionMetadata放在缓存中了。<br> <img src="https://images2.imgbox.com/6c/0d/LdK2xhhp_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/88/77/iSJCh3YW_o.png" alt="在这里插入图片描述"><br> 在进行inject的时候，对于引用类型的注入，会触发对应Bean的实例化操作，即调用getBean()方法。<br> <img src="https://images2.imgbox.com/e5/31/pnioeU1X_o.png" alt="在这里插入图片描述"><br> 下面是对Field的注入<br> <img src="https://images2.imgbox.com/6e/4e/SUHkFj1J_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0d/02/QvHA76Kb_o.png" alt="在这里插入图片描述"><br> 这个地方会出里@Value注解<br> <img src="https://images2.imgbox.com/58/06/lcqrCwKq_o.png" alt="在这里插入图片描述"><br> 先获取候选的Bean，单例情况下，候选Bean只有一个，走else分支，然后解析该Bean。<br> <img src="https://images2.imgbox.com/c1/0f/0dQ8rgiC_o.png" alt="在这里插入图片描述"><br> 解析其实就是getBean()。<br> <img src="https://images2.imgbox.com/13/97/bDPUzrwp_o.png" alt="在这里插入图片描述"><br> 对方法上面的@Autowired注解的处理也是类似的，先处理参数，如果参数需要注入，同样会调用getBean()方法。</p> 
<h4><a id="CommonAnnotationBeanPostProcessor_32"></a>CommonAnnotationBeanPostProcessor的应用</h4> 
<p><img src="https://images2.imgbox.com/66/7b/Yke8AvlK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4d/73/05eyaISt_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f3/b8/k0L0dkce_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7b/4a/t9pQOjj5_o.png" alt="在这里插入图片描述"><br> 最后才会进行xml文件中配置的属性依赖注入。过时的操作就不赘述了。。。<br> <img src="https://images2.imgbox.com/70/c9/CJylzhmK_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39f52e3d65c6067e50a41e8715d6359c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">docker连不上宿主机mysql_Docker从宿主机挂载卷到Mysql镜像之坑</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/66d3b12c926c6be03d494bbe004b8dfa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">js正则表达式验证用户名密码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>