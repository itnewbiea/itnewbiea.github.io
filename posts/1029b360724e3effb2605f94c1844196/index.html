<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>对象友元的概念及应用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="对象友元的概念及应用" />
<meta property="og:description" content="友元入门友元的使用带有命名空间的函数声明类的前向声明friend直接修饰类的好处 友元特性友元重构（友元运算符重载）类重构全局重构友元重构 友元入门 友元friend
可以将一个函数或类进行friend修饰
修饰后的函数和类可以直接在外部访问调用本类的所有成员
友元的位置无需在意是否为public还是private
class Point { public: //在类中用friend声明该函数，在外部定义 friend void display(const Point&amp; p); //在类中修饰另一个类，另一个类可直接访问该类对象的成员 friend class Line; private: int _ix; int _iy; }; //friend修饰声明需要friend开头，定义时不需要带 void display(const Point&amp; p) { cout &lt;&lt; p._ix; cout &lt;&lt; p._iy &lt;&lt; endl; } class Line { public: void print(const Point&amp; p) { cout &lt;&lt; p._ix; } }; 具体实现
#include &lt;iostream&gt; #include &lt;cmath&gt; using std::cout; using std::endl; class Point { public: friend void distance(const Point&amp; p1, const Point&amp; p2); friend void display(const Point&amp; p); friend class Line; Point(const int&amp; ix, const int&amp; iy) :_ix(ix) , _iy(iy) { cout &lt;&lt; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1029b360724e3effb2605f94c1844196/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-25T09:33:03+08:00" />
<meta property="article:modified_time" content="2023-05-25T09:33:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">对象友元的概念及应用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4> </h4> 
 <ul><li><a href="#_1" rel="nofollow">友元入门</a></li><li><a href="#_106" rel="nofollow">友元的使用</a></li><li><ul><li><a href="#_138" rel="nofollow">带有命名空间的函数声明</a></li><li><a href="#_189" rel="nofollow">类的前向声明</a></li><li><ul><li><a href="#friend_277" rel="nofollow">friend直接修饰类的好处</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_322" rel="nofollow">友元特性</a></li><li><a href="#_342" rel="nofollow">友元重构（友元运算符重载）</a></li><li><ul><li><a href="#_399" rel="nofollow">类重构</a></li><li><a href="#_428" rel="nofollow">全局重构</a></li><li><a href="#_514" rel="nofollow">友元重构</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>友元入门</h2> 
<p>友元friend</p> 
<blockquote> 
 <p>可以将一个函数或类进行friend修饰<br> 修饰后的函数和类可以直接在外部访问调用本类的所有成员<br> 友元的位置无需在意是否为public还是private</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">//在类中用friend声明该函数，在外部定义</span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//在类中修饰另一个类，另一个类可直接访问该类对象的成员</span>
	<span class="token keyword">friend</span> <span class="token keyword">class</span> <span class="token class-name">Line</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _ix<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _iy<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//friend修饰声明需要friend开头，定义时不需要带</span>
<span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">.</span>_ix<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">.</span>_iy <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> <span class="token class-name">Line</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">.</span>_ix<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>具体实现</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>

<span class="token keyword">using</span> std<span class="token operator">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>


<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">friend</span> <span class="token keyword">class</span> <span class="token class-name">Line</span><span class="token punctuation">;</span>

	<span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> ix<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> iy<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_ix</span><span class="token punctuation">(</span>ix<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>iy<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _ix<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _iy<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">'('</span> <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">.</span>_ix <span class="token operator">&lt;&lt;</span> <span class="token string">' '</span> <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">.</span>_iy <span class="token operator">&lt;&lt;</span> <span class="token string">')'</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p2<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//hypot函数可以返回两个参数的平方后的和在开根的值，在应用两点之间距离很常用，包含库为math</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"distance:"</span><span class="token operator">&lt;&lt;</span><span class="token function">hypot</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>_ix <span class="token operator">-</span> p2<span class="token punctuation">.</span>_ix<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>_iy <span class="token operator">-</span> p2<span class="token punctuation">.</span>_iy<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Line</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">.</span>_ix<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Point <span class="token function">p1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Point <span class="token function">p2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">display</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">display</span><span class="token punctuation">(</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">distance</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出结果</p> 
<pre><code>Point(int,int)
Point(int,int)
(0 0)
(3 4)
distance:5
</code></pre> 
<h2><a id="_106"></a>友元的使用</h2> 
<blockquote> 
 <p>在友元修饰类时，我们发现虽然代码没有语法错误，但在编译过程中往往无法执行</p> 
</blockquote> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Line</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"distance:"</span> <span class="token operator">&lt;&lt;</span> <span class="token function">hypot</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>_ix <span class="token operator">-</span> p2<span class="token punctuation">.</span>_ix<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>_iy <span class="token operator">-</span> p2<span class="token punctuation">.</span>_iy<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">/*friend class Line;*/</span>

	<span class="token keyword">friend</span> <span class="token keyword">void</span> Line<span class="token operator">::</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> ix<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> iy<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_ix</span><span class="token punctuation">(</span>ix<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>iy<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _ix<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _iy<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>这是因为在编译过程中，Line类作为Point的友元，虽然能够调用Point的成员，但因为Line声明定义在Point的前面，我们目前还不清楚Point类中成员都有什么，无法调用Point的成员</p> 
</blockquote> 
<blockquote> 
 <p>这种情况在我们一开始认识命名空间时也有遇到过，解决方法称为带有命名空间的函数声明</p> 
</blockquote> 
<h3><a id="_138"></a>带有命名空间的函数声明</h3> 
<p>无法执行的案例</p> 
<pre><code class="prism language-cpp"><span class="token keyword">namespace</span> front <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		back<span class="token operator">::</span><span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">namespace</span> back<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		front<span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"out"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在编译过程中，front内部的print函数调用了back内的out函数，此时out函数和back命名空间还没有声明或者定义，编译器不知道调用的是什么，就出现了问题</p> 
<p>由此可知问题可以概括为:当一个命名空间需要调用另一个命名空间的函数，而另一个命名空间也需要调用当前命名空间的函数</p> 
<p>解决方法：将一开始命名空间内需要调用的另一个命名空间内函数提前声明</p> 
<pre><code class="prism language-cpp"><span class="token comment">//只需提前定义命名空间在命名空间内声明该函数</span>
<span class="token comment">//命名空间可以多次定义，这一特性使得他能够解决这一冲突问题</span>

<span class="token keyword">namespace</span> back <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">void</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">namespace</span> front <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		back<span class="token operator">::</span><span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">namespace</span> back<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		front<span class="token operator">::</span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">out</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"out"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上述解决方法我们称之为带有命名空间的函数声明</p> 
<h3><a id="_189"></a>类的前向声明</h3> 
<p>根据带有命名空间的函数声明，我们可以用来解决当前Line类中不能调用Point成员的问题（前提条件是friend已经在Point类内部修饰好了Line）</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;cmath&gt;</span></span>

<span class="token keyword">using</span> std<span class="token operator">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Line</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">void</span> <span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token comment">/*friend class Line;*/</span>

	<span class="token keyword">friend</span> <span class="token keyword">void</span> Line<span class="token operator">::</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">Point</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> ix<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> iy<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_ix</span><span class="token punctuation">(</span>ix<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_iy</span><span class="token punctuation">(</span>iy<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Point(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _ix<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _iy<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">'('</span> <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">.</span>_ix <span class="token operator">&lt;&lt;</span> <span class="token string">' '</span> <span class="token operator">&lt;&lt;</span> p<span class="token punctuation">.</span>_iy <span class="token operator">&lt;&lt;</span> <span class="token string">')'</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> Line<span class="token operator">::</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p2<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"distance:"</span> <span class="token operator">&lt;&lt;</span> <span class="token function">hypot</span><span class="token punctuation">(</span>p1<span class="token punctuation">.</span>_ix <span class="token operator">-</span> p2<span class="token punctuation">.</span>_ix<span class="token punctuation">,</span> p1<span class="token punctuation">.</span>_iy <span class="token operator">-</span> p2<span class="token punctuation">.</span>_iy<span class="token punctuation">)</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Point <span class="token function">p1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Point <span class="token function">p2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>此时我们发现将Point提前声明好，把下方实现部分加上作用域，整个代码就不会报错了（如果直接在Line内部实现，Line还是不知道Point内部有什么，类的前向声明仅仅是让该类知道该另一个的存在）</p> 
<p>此时我们可以选择使用static修饰来调用distance函数，或者通过创建Line对象调用(不写static修饰了，省点字数)</p> 
<pre><code class="prism language-cpp">	Point <span class="token function">p1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Point <span class="token function">p2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Line temp<span class="token punctuation">;</span>

	temp<span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span> p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><strong>对于临时对象调用distance更便捷的写法</strong></p> 
<pre><code class="prism language-cpp">	Point <span class="token function">p1</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Point <span class="token function">p2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token function">Line</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">distance</span><span class="token punctuation">(</span>p1<span class="token punctuation">,</span>p2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>输出结果</p> 
<pre><code>Point(int,int)
Point(int,int)
distance:5
</code></pre> 
<p>简便的原因</p> 
<blockquote> 
 <p>一方面是作为临时对象，其生命周期明显缩短，由整个test函数的生命周期缩短到了一个语句的生命周期，另一方面，只需要写一行就可以实现两行的功能</p> 
</blockquote> 
<h4><a id="friend_277"></a>friend直接修饰类的好处</h4> 
<p>在之前的代码中，我们用friend修饰了Line中distance函数，如果Line中有很多函数需要调用Point的成员，那么我们可以直接修饰类，此时可以大大降低代码的冗余</p> 
<p>复杂写法</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Line</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">double</span> <span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> pt1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> pt2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setPoint</span><span class="token punctuation">(</span>Point<span class="token operator">&amp;</span> pt<span class="token punctuation">,</span> <span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">displayPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">checkPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">friend</span> <span class="token keyword">double</span> Line<span class="token operator">::</span><span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> pt1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> pt2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> Line<span class="token operator">::</span><span class="token function">setPoint</span><span class="token punctuation">(</span>Point<span class="token operator">&amp;</span> pt<span class="token punctuation">,</span> <span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> Line<span class="token operator">::</span><span class="token function">displayPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> Line<span class="token operator">::</span><span class="token function">checkPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>简便写法</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Line</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">double</span> <span class="token function">distance</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> pt1<span class="token punctuation">,</span> <span class="token keyword">const</span> Point<span class="token operator">&amp;</span> pt2<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">setPoint</span><span class="token punctuation">(</span>Point<span class="token operator">&amp;</span> pt<span class="token punctuation">,</span> <span class="token keyword">int</span> ix<span class="token punctuation">,</span> <span class="token keyword">int</span> iy<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">displayPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token function">checkPoint</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> p<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Point</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">friend</span> <span class="token keyword">void</span> <span class="token function">display</span><span class="token punctuation">(</span><span class="token keyword">const</span> Point<span class="token operator">&amp;</span> pt<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//为了防止代码冗余，可以直接让Line类成为Point的友元(Line可以使用Point的所有成员)</span>
	<span class="token keyword">friend</span> <span class="token keyword">class</span> <span class="token class-name">Line</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_322"></a>友元特性</h2> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">Point</span><span class="token punctuation">{<!-- --></span>
 <span class="token keyword">friend</span> <span class="token keyword">class</span> <span class="token class-name">Line</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>友元的单向性</p> 
<blockquote> 
 <p>Point把Line认为是自己的朋友<br> Line因此可以随便用Point的东西<br> 但是Line还没有认为Point是他的朋友，所以Line不许Point去用Line的东西</p> 
</blockquote> 
<p>友元的非传递性</p> 
<blockquote> 
 <p>A认为B是他的朋友，B认为C是B的朋友，但是A如果不认识C那么A就不认为C是A的朋友。</p> 
</blockquote> 
<p>友元的非继承性</p> 
<blockquote> 
 <p>a的父亲是A，B是A的朋友，但是B不一定是a的朋友</p> 
</blockquote> 
<p><strong>友元最为特殊，不受public/protected/private影响，可以在类的任何位置声明</strong></p> 
<h2><a id="_342"></a>友元重构（友元运算符重载）</h2> 
<p>假如有一个类专门用来创建复数对象，我们想让两个复数对象相加</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">using</span> std<span class="token operator">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Complex</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_dreal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_dimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">Complex</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> dreal<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> dimage<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_dreal</span><span class="token punctuation">(</span>dreal<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_dimage</span><span class="token punctuation">(</span>dimage<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Complex"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> _dreal <span class="token operator">&lt;&lt;</span> <span class="token string">' + '</span> <span class="token operator">&lt;&lt;</span> _dimage <span class="token operator">&lt;&lt;</span> <span class="token string">'i'</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _dreal<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _dimage<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Complex <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	c1<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	c2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Complex c3 <span class="token operator">=</span> c1 <span class="token operator">+</span> c2<span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我们发现想要用c3保存好相加的结果，是不可行的，无法想string对象一样直接相加，那么string类中是如何实现的</p> 
<h3><a id="_399"></a>类重构</h3> 
<pre><code class="prism language-cpp">	Complex <span class="token keyword">operator</span> <span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		Complex <span class="token function">temp</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		temp<span class="token punctuation">.</span>_dreal <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>_dreal <span class="token operator">+</span> rhs<span class="token punctuation">.</span>_dreal<span class="token punctuation">;</span>
		temp<span class="token punctuation">.</span>_dimage <span class="token operator">=</span> <span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>_dimage <span class="token operator">+</span> rhs<span class="token punctuation">.</span>_dimage<span class="token punctuation">;</span>

		<span class="token keyword">return</span> temp<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre> 
<p>说明</p> 
<blockquote> 
 <p>1：+运算符为双目运算符，有左右两个参数，在类中重构时，this指针指向的对象为左参数，参数1指向右参数，this指针作为隐含的参数不需要我们在参数列表内加上他，所以在类中重构+运算符时，只有一个参数<br> 2：函数类型不能带上引用符号，因为我们创建了一个临时对象，返回了右值，无法进行取地址操作，因此中间会多一步拷贝函数(因为一些优化，我们看不到拷贝函数的执行过程)</p> 
</blockquote> 
<p>输出结果</p> 
<pre><code>Complex(int,int)
Complex(int,int)
1 + 2i
3 + 4i
Complex(int,int)
4 + 6i
~Complex
~Complex
~Complex
</code></pre> 
<p>这种在类内部重构的方法一般来说不便于理解，在我们印象中，如果需要重构+应该自己写两个参数才对，而不是一个this指针来代替左参数</p> 
<h3><a id="_428"></a>全局重构</h3> 
<p>顾名思义就是在全局区来定义函数，缺点是需要单独在类中开新的函数去访问数据成员</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">using</span> std<span class="token operator">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Complex</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_dreal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_dimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">Complex</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> dreal<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> dimage<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_dreal</span><span class="token punctuation">(</span>dreal<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_dimage</span><span class="token punctuation">(</span>dimage<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Complex"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> _dreal <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> _dimage <span class="token operator">&lt;&lt;</span> <span class="token string">'i'</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> <span class="token function">getdreal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _dreal<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">int</span> <span class="token function">getimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> _dimage<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _dreal<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _dimage<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//全局重构，需要函数来访问数据成员</span>
Complex <span class="token keyword">operator</span> <span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span><span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> dreal <span class="token operator">=</span> lhs<span class="token punctuation">.</span><span class="token function">getdreal</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> rhs<span class="token punctuation">.</span><span class="token function">getdreal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span> dimage <span class="token operator">=</span> lhs<span class="token punctuation">.</span><span class="token function">getimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> rhs<span class="token punctuation">.</span><span class="token function">getimage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Complex <span class="token function">temp</span><span class="token punctuation">(</span>dreal<span class="token punctuation">,</span>dimage<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Complex <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	c1<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	c2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Complex c3 <span class="token operator">=</span> c1 <span class="token operator">+</span> c2<span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出结果</p> 
<pre><code>Complex(int,int)
Complex(int,int)
1 + 2i
3 + 4i
Complex(int,int)
4 + 6i
~Complex
~Complex
~Complex
</code></pre> 
<p>那么有什么方法既可以保证函数内参数列表有两个参数，而且不需要另起新的函数去访问数据成员呢</p> 
<h3><a id="_514"></a>友元重构</h3> 
<p>用到刚刚掌握的友元，可以在类的外部定义，并且可以直接访问所有成员</p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">using</span> std<span class="token operator">::</span>cout<span class="token punctuation">;</span>
<span class="token keyword">using</span> std<span class="token operator">::</span>endl<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Complex</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_dreal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token punctuation">,</span><span class="token function">_dimage</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex()"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">Complex</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> dreal<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">int</span><span class="token operator">&amp;</span> dimage<span class="token punctuation">)</span>
		<span class="token operator">:</span><span class="token function">_dreal</span><span class="token punctuation">(</span>dreal<span class="token punctuation">)</span>
		<span class="token punctuation">,</span> <span class="token function">_dimage</span><span class="token punctuation">(</span>dimage<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Complex(int,int)"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token operator">~</span><span class="token function">Complex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> <span class="token string">"~Complex"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span>
	<span class="token punctuation">{<!-- --></span>
		cout <span class="token operator">&lt;&lt;</span> _dreal <span class="token operator">&lt;&lt;</span> <span class="token string">" + "</span> <span class="token operator">&lt;&lt;</span> _dimage <span class="token operator">&lt;&lt;</span> <span class="token string">'i'</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">friend</span> Complex <span class="token keyword">operator</span> <span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span> <span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> _dreal<span class="token punctuation">;</span>
	<span class="token keyword">int</span> _dimage<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

Complex <span class="token keyword">operator</span> <span class="token operator">+</span><span class="token punctuation">(</span><span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> lhs<span class="token punctuation">,</span><span class="token keyword">const</span> Complex<span class="token operator">&amp;</span> rhs<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> dreal <span class="token operator">=</span> lhs<span class="token punctuation">.</span>_dreal <span class="token operator">+</span> rhs<span class="token punctuation">.</span>_dreal<span class="token punctuation">;</span>
	<span class="token keyword">int</span> dimage <span class="token operator">=</span> lhs<span class="token punctuation">.</span>_dimage <span class="token operator">+</span> rhs<span class="token punctuation">.</span>_dimage<span class="token punctuation">;</span>

	Complex <span class="token function">temp</span><span class="token punctuation">(</span>dreal<span class="token punctuation">,</span>dimage<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> temp<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	Complex <span class="token function">c1</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	Complex <span class="token function">c2</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	c1<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	c2<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	Complex c3 <span class="token operator">=</span> c1 <span class="token operator">+</span> c2<span class="token punctuation">;</span>
	c3<span class="token punctuation">.</span><span class="token function">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">test0</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>输出结果</p> 
<pre><code>Complex(int,int)
Complex(int,int)
1 + 2i
3 + 4i
Complex(int,int)
4 + 6i
~Complex
~Complex
~Complex
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1318a84a478a9a09cdf0f284e59f26e9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python之redis&#43;proxy_pool构建ip代理池</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/23d011d7303e26f29956541c8ab71013/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Mac 配置环境变量每次打开终端都要source ~/.bash_profile</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>