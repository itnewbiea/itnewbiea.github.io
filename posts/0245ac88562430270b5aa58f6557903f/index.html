<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据架构如何做到流批一体？ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大数据架构如何做到流批一体？" />
<meta property="og:description" content="阿里妹导读：大数据与现有的科技手段结合，对大多数产业而言都能产生巨大的经济及社会价值。这也是当下许多企业，在大数据上深耕的原因。大数据分析场景需要解决哪些技术挑战？目前，有哪些主流大数据架构模式及其发展？今天，我们都会一一解读，并介绍如何结合云上存储、计算组件，实现更优的通用大数据架构模式，以及该模式可以涵盖的典型数据处理场景。
大数据处理的挑战 现在已经有越来越多的行业和技术领域需求大数据分析系统，例如金融行业需要使用大数据系统结合 VaR(value at risk) 或者机器学习方案进行信贷风控，零售、餐饮行业需要大数据系统实现辅助销售决策，各种 IOT 场景需要大数据系统持续聚合和分析时序数据，各大科技公司需要建立大数据分析中台等等。
抽象来看，支撑这些场景需求的分析系统，面临大致相同的技术挑战：
业务分析的数据范围横跨实时数据和历史数据，既需要低延迟的实时数据分析，也需要对 PB 级的历史数据进行探索性的数据分析；
可靠性和可扩展性问题，用户可能会存储海量的历史数据，同时数据规模有持续增长的趋势，需要引入分布式存储系统来满足可靠性和可扩展性需求，同时保证成本可控；
技术栈深，需要组合流式组件、存储系统、计算组件和；
可运维性要求高，复杂的大数据架构难以维护和管控；
简述大数据架构发展 Lambda 架构 Lambda 架构是目前影响最深刻的大数据处理架构，它的核心思想是将不可变的数据以追加的方式并行写到批和流处理系统内，随后将相同的计算逻辑分别在流和批系统中实现，并且在查询阶段合并流和批的计算视图并展示给用户。Lambda的提出者 Nathan Marz 还假定了批处理相对简单不易出现错误，而流处理相对不太可靠，因此流处理器可以使用近似算法，快速产生对视图的近似更新，而批处理系统会采用较慢的精确算法，产生相同视图的校正版本。
图 1 Lambda架构示例
Lambda架构典型数据流程是(http://lambda-architecture.net/)：
所有的数据需要分别写入批处理层和流处理层；
批处理层两个职责：(i)管理 master dataset (存储不可变、追加写的全量数据)，(ii)预计算batch view；
服务层对 batch view 建立索引，以支持低延迟、ad-hoc 方式查询 view；
流计算层作为速度层，对实时数据计算近似的 real-time view，作为高延迟batch view 的补偿快速视图；
所有的查询需要合并 batch view 和 real-time view；
Lambda 架构设计推广了在不可变的事件流上生成视图，并且可以在必要时重新处理事件的原则，该原则保证了系统随需求演进时，始终可以创建相应的新视图出来，切实可行地满足了不断变化的历史数据和实时数据分析需求。
Lambda 架构的四个挑战 Lambda 架构非常复杂，在数据写入、存储、对接计算组件以及展示层都有复杂的子课题需要优化：
写入层上，Lambda 没有对数据写入进行抽象，而是将双写流批系统的一致性问题反推给了写入数据的上层应用；
存储上，以 HDFS 为代表的master dataset 不支持数据更新，持续更新的数据源只能以定期拷贝全量 snapshot 到 HDFS 的方式保持数据更新，数据延迟和成本比较大；
计算逻辑需要分别在流批框架中实现和运行，而在类似 Storm 的流计算框架和Hadoop MR 的批处理框架做 job 开发、调试、问题调查都是比较复杂的；" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0245ac88562430270b5aa58f6557903f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-01T08:08:00+08:00" />
<meta property="article:modified_time" content="2019-07-01T08:08:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据架构如何做到流批一体？</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="rich_media_content" id="js_content"> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:left;line-height:1.75em;"><img class="rich_pages" style="text-align:center;" src="https://images2.imgbox.com/29/69/FKhmH70w_o.png" alt="640?wx_fmt=jpeg"><br></p> 
 <p style="min-height:1em;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.612px;">阿里妹导</span><span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.612px;">读</span><span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.612px;">：大数据与现有的科技手段结合，对大多数产业而言都能产生巨大的经济及社会价值</span><span style="color:rgb(136,136,136);font-size:15px;letter-spacing:.612px;">。这也是当下许多企业，在大数据上深耕的原因。大数据分析场景需要解决哪些技术挑战？目前，有哪些主流大数据架构模式及其发展？今天，我们都会一一解读，并介绍如何结合云上存储、计算组件，实现更优的通用大数据架构模式，以及该模式可以涵盖的典型数据处理场景。</span></p> 
 <p><br></p> 
 <h4 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(255,129,36);">大数据处理的挑战</span></strong></h4> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">现在已经有越来越多的行业和技术领域需求大数据分析系统，例如金融行业需要使用大数据系统结合 VaR(value at risk) 或者机器学习方案进行信贷风控，零售、餐饮行业需要大数据系统实现辅助销售决策，各种 IOT 场景需要大数据系统持续聚合和分析时序数据，各大科技公司需要建立大数据分析中台等等。</span></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);"><br>抽象来看，支撑这些场景需求的分析系统，面临大致相同的技术挑战：</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <ul class="list-paddingleft-2"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">业务分析的数据范围横跨实时数据和历史数据，既需要低延迟的实时数据分析，也需要对 PB  级的历史数据进行探索性的数据分析；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">可靠性和可扩展性问题，用户可能会存储海量的历史数据，同时数据规模有持续增长的趋势，需要引入分布式存储系统来满足可靠性和可扩展性需求，同时保证成本可控；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">技术栈深，需要组合流式组件、存储系统、计算组件和；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">可运维性要求高，复杂的大数据架构难以维护和管控；</span></p></li></ul> 
 <p><br></p> 
 <h4 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(255,129,36);">简述大数据架构发展</span></strong></h4> 
 <p><br></p> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);">Lambda 架构</span></strong></h6> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Lambda 架构是目前影响最深刻的大数据处理架构，它的核心思想是将不可变的数据以追加的方式并行写到批和流处理系统内，随后将相同的计算逻辑分别在流和批系统中实现，并且在查询阶段合并流和批的计算视图并展示给用户。Lambda的提出者 Nathan Marz 还假定了批处理相对简单不易出现错误，而流处理相对不太可靠，因此流处理器可以使用近似算法，快速产生对视图的近似更新，而批处理系统会采用较慢的精确算法，产生相同视图的校正版本。</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:center;"><img class="rich_pages" src="https://images2.imgbox.com/69/bb/p6ckENQG_o.png" alt="640?wx_fmt=png"></p> 
 <p style="text-align:center;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:14px;">图 1 Lambda架构示例</span><br></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Lambda架构典型数据流程是(http://lambda-architecture.net/)：</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <ol class="list-paddingleft-2"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">所有的数据需要分别写入批处理层和流处理层；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">批处理层两个职责：(i)管理 master dataset (存储不可变、追加写的全量数据)，(ii)预计算batch view；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">服务层对 batch view 建立索引，以支持低延迟、ad-hoc 方式查询 view；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">流计算层作为速度层，对实时数据计算近似的 real-time view，作为高延迟batch view 的补偿快速视图；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">所有的查询需要合并 batch view 和 real-time view；</span></p></li></ol> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Lambda 架构设计推广了在不可变的事件流上生成视图，并且可以在必要时重新处理事件的原则，该原则保证了系统随需求演进时，始终可以创建相应的新视图出来，切实可行地满足了不断变化的历史数据和实时数据分析需求。<br></span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);">Lambda 架构的四个挑战</span></strong></h6> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Lambda 架构非常复杂，在数据写入、存储、对接计算组件以及展示层都有复杂的子课题需要优化：</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <ol class="list-paddingleft-2"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">写入层上，Lambda 没有对数据写入进行抽象，而是将双写流批系统的一致性问题反推给了写入数据的上层应用；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">存储上，以 HDFS 为代表的master dataset 不支持数据更新，持续更新的数据源只能以定期拷贝全量 snapshot 到 HDFS 的方式保持数据更新，数据延迟和成本比较大；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">计算逻辑需要分别在流批框架中实现和运行，而在类似 Storm 的流计算框架和Hadoop MR 的批处理框架做 job 开发、调试、问题调查都是比较复杂的；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">结果视图需要支持低延迟的查询分析，通常还需要将数据派生到列存分析系统，并保证成本可控。<br></span></p></li></ol> 
 <h6 style="text-align:left;line-height:1.75em;"></h6> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);"><br></span></strong></h6> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);">流批融合的 Lambda 架构</span></strong></h6> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">针对 Lambda 架构的问题3，计算逻辑需要分别在流批框架中实现和运行的问题，不少计算引擎已经开始往流批统一的方向去发展，例如 Spark 和 Flink，从而简化lambda 架构中的计算部分。实现流批统一通常需要支持：</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">1.以相同的处理引擎来处理实时事件和历史回放事件；</span></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">2.支持 exactly once 语义，保证有无故障情况下计算结果完全相同；</span></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">3.支持以事件发生时间而不是处理时间进行窗口化。<br></span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);">Kappa架构</span></strong></h6> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Kappa 架构由 Jay Kreps 提出，不同于 Lambda 同时计算流计算和批计算并合并视图，Kappa 只会通过流计算一条的数据链路计算并产生视图。Kappa 同样采用了重新处理事件的原则，对于历史数据分析类的需求，Kappa 要求数据的长期存储能够以有序 log 流的方式重新流入流计算引擎，重新产生历史数据的视图。</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:center;"><img class="rich_pages" src="https://images2.imgbox.com/fe/b2/KlFyzzGm_o.png" alt="640?wx_fmt=png"></p> 
 <p style="text-align:center;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:14px;">图2 Kappa大数据架构<br></span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Kappa 方案通过精简链路解决了1数据写入和3计算逻辑复杂的问题，但它依然没有解决存储和展示的问题，特别是在存储上，使用类似 kafka 的消息队列存储长期日志数据，数据无法压缩，存储成本很大，绕过方案是使用支持数据分层存储的消息系统（如 Pulsar，支持将历史消息存储到云上存储系统），但是分层存储的历史日志数据仅能用于 Kappa backfill 作业，数据的利用率依然很低。<br style="color:rgb(36,41,46);font-family:'-apple-system', BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;font-size:16px;"></span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);">Lambda 和 Kappa 的场景区别：</span></strong></h6> 
 <p><br></p> 
 <ul class="list-paddingleft-2"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Kappa 不是 Lambda 的替代架构，而是其简化版本，Kappa 放弃了对批处理的支持，更擅长业务本身为 append-only 数据写入场景的分析需求，例如各种时序数据场景，天然存在时间窗口的概念，流式计算直接满足其实时计算和历史补偿任务需求；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Lambda 直接支持批处理，因此更适合对历史数据有很多 ad hoc 查询的需求的场景，比如数据分析师需要按任意条件组合对历史数据进行探索性的分析，并且有一定的实时性需求，期望尽快得到分析结果，批处理可以更直接高效地满足这些需求。<br></span></p></li></ul> 
 <h6 style="text-align:left;line-height:1.75em;"></h6> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);"><br></span></strong></h6> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);">Kappa+</span></strong></h6> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Kappa+是 Uber 提出流式数据处理架构，它的核心思想是让流计算框架直读 HDFS类的数仓数据，一并实现实时计算和历史数据 backfill 计算，不需要为 backfill 作业长期保存日志或者把数据拷贝回消息队列。Kappa+ 将数据任务分为无状态任务和时间窗口任务，无状态任务比较简单，根据吞吐速度合理并发扫描全量数据即可，时间窗口任务的原理是将数仓数据按照时间粒度进行分区存储，窗口任务按时间序一次计算一个 partition 的数据，partition 内乱序并发，所有分区文件全部读取完毕后，所有 source 才进入下个 partition 消费并更新 watermark。事实上，Uber 开发了Apache hudi 框架来存储数仓数据，hudi 支持更新、删除已有 parquet 数据，也支持增量消费数据更新部分，从而系统性解决了问题2存储的问题。下图3是完整的Uber 大数据处理平台，其中 Hadoop -&gt; Spark -&gt; Analytical data user 涵盖了Kappa+ 数据处理架构。</span><br></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:center;"><img class="rich_pages" src="https://images2.imgbox.com/bd/aa/Mok8b892_o.png" alt="640?wx_fmt=png"></p> 
 <p style="text-align:center;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:14px;">图3 Uber围绕Hadoop dataset的大数据架构</span><br></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <h6 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(62,62,62);">混合分析系统的 Kappa 架构</span></strong></h6> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Lambda 和 Kappa 架构都还有展示层的困难点，结果视图如何支持 ad-hoc 查询分析，一个解决方案是在 Kappa 基础上衍生数据分析流程，如下图4，在基于使用Kafka + Flink 构建 Kappa 流计算数据架构，针对Kappa 架构分析能力不足的问题，再利用 Kafka 对接组合 ElasticSearch 实时分析引擎，部分弥补其数据分析能力。但是 ElasticSearch 也只适合对合理数据量级的热数据进行索引，无法覆盖所有批处理相关的分析需求，这种混合架构某种意义上属于 Kappa 和 Lambda 间的折中方案。</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:center;"><img class="rich_pages" src="https://images2.imgbox.com/7e/11/CBKiom4W_o.png" alt="640?wx_fmt=png"></p> 
 <p style="text-align:center;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:14px;">图4 Kafka + Flink + ElasticSearch的混合分析系统</span><br></p> 
 <p><br></p> 
 <h4 style="text-align:left;line-height:1.75em;"><strong><span style="font-size:15px;color:rgb(255,129,36);">Lambda plus：Tablestore + Blink 流批一体处理框架</span></strong></h4> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Lambda plus 是基于 Tablestore 和 Blink 打造的云上存在可以复用、简化的大数据架构模式，架构方案全 serverless 即开即用，易搭建免运维。</span></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);"><br>表格存储（Tablestore）是阿里云自研的 NoSQL 多模型数据库，提供 PB 级结构化数据存储、千万 TPS 以及毫秒级延迟的服务能力，表格存储提供了通道服务（TunnelService）支持用户以按序、流式地方式消费写入表格存储的存量数据和实时数据，同时表格存储还提供了多元索引功能，支持用户对结果视图进行实时查询和分析。</span></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);"><br>Blink 是阿里云在 Apache Flink 基础上深度改进的实时计算平台，Blink 旨在将流处理和批处理统一，实现了全新的 Flink SQL 技术栈，在功能上，Blink 支持现在标准 SQL 几乎所有的语法和语义，在性能上，Blink 也比社区Flink更加强大。</span></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);"><br>在 TableStore + Blink 的云上 Lambda 架构中，用户可以同时使用表格存储作为master dataset 和 batch&amp;stream view，批处理引擎直读表格存储产生 batch view，同时流计算引擎通过 Tunnel Service 流式处理实时数据，持续生成 stream view。</span><br></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:center;"><img class="rich_pages" src="https://images2.imgbox.com/84/29/mx8g1ekn_o.png" alt="640?wx_fmt=png"></p> 
 <p style="text-align:center;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:14px;">图5 Tablestore + Blink 的 Lambda plus 大数据架构</span><br></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">如上图5，其具体组件分解：</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <ul class="list-paddingleft-2"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Lambda batch 层：</span></p> 
   <ul class="list-paddingleft-2" style="list-style-type:none;"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Tablestore 直接作为 master dataset，支持用户直读，配合 Tablestore 多元索引，用户的线上服务直读、ad-hoc 查询 master dataset 并将结果返回给用户；</span><span style="color:rgb(62,62,62);font-size:15px;">Blink 批处理任务向 Tablestore 下推 SQL 的查询条件，直读 Tablestore master dataset，计算 batch view，并将 batch view 重新写回 Tablestore；</span></p></li></ul></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Streaming 层：</span></p> 
   <ul class="list-paddingleft-2" style="list-style-type:none;"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Blink 流处理任务通过表格存储 TunnelService API 直读 master dataset 中的实时数据，持续产生 stream view；</span><span style="color:rgb(62,62,62);font-size:15px;">Kappa 架构的 backfill任务，可以通过建立全量类型数据通道，流式消费 master dataset 的存量数据，从新计算；</span></p></li></ul></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">Serving 层：</span></p> 
   <ul class="list-paddingleft-2" style="list-style-type:none;"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">为存储 batch view 和 stream view 的 Tablestore 结果表建立全局二级索引和多元索引，业务可以低延迟、ad-hoc方式查询；</span></p></li></ul></li></ul> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:center;"><img class="rich_pages" src="https://images2.imgbox.com/51/9d/UkSEoeRL_o.png" alt="640?wx_fmt=png"></p> 
 <p style="text-align:center;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:14px;">图6 Lambda plus的数据链路</span><br></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">针对上述 Lambda 架构1-4的技术问题，Lambda plus 的解决思路：</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <ol class="list-paddingleft-2"><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">针对数据写入的问题，Lambda plus 数据只需要写入表格存储，Blink 流计算框架通过通道服务 API 直读表格存储的实时数据，不需要用户双写队列或者自己实现数据同步；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">存储上，Lambda plus 直接使用表格存储作为 master dataset，表格存储支持用户 tp 系统低延迟读写更新，同时也提供了索引功能 ad-hoc 查询分析，数据利用率高，容量型表格存储实例也可以保证数据存储成本可控；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">计算上，Lambda plus 利用 Blink 流批一体计算引擎，统一流批代码；</span></p></li><li><p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">展示层，表格存储提供了多元索引和全局二级索引功能，用户可以根据解决视图的查询需求和存储体量，合理选择索引方式。</span></p></li></ol> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">总结，表格存储实现了 batch view、master dataset 直接查询、stream view 的功能全集，Blink 实现流批统一，Tablestore 加 Blink 的 Lambda plus 模式可以明显简化 Lambda 架构的组件数量，降低搭建和运维难度，拓展用户数据价值。</span></p> 
 <p><br></p> 
 <h4 style="text-align:left;line-height:1.75em;"><span style="color:rgb(255,129,36);"><strong><span style="font-size:15px;">表格存储是如何实现支持上述功能全集的</span></strong></span></h4> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">存储引擎的高并发、低延迟特性：</span><span style="color:rgb(62,62,62);font-size:15px;">表格存储面向在线业务提供高并发、低延迟的访问，并且 tps 按分区水平扩展，可以有效支持批处理和 Kappa backfill 的高吞吐数据扫描和流计算按分区粒度并发实时处理；</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">使用通道服务精简架构：</span><span style="color:rgb(62,62,62);font-size:15px;">Tablestore 数据通道支持用户以按序、流式地方式消费写入表格存储的存量数据和实时数据，避免 Lambda 架构引入消息队列系统以及master dataset 和队列的数据一致性问题；</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">二级索引和多元索引的灵活查询能力：</span><span style="color:rgb(62,62,62);font-size:15px;">存储在表格存储的 batch view 和 real-time view 可以使用多元索引和二级索引实现 ad-hoc 查询，使用多元索引进行聚合分析计算；同时展示层也可以利用二级索引和多元索引直接查询表格存储 master dataset，不强依赖引擎计算结果。</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <h4 style="text-align:left;line-height:1.75em;"><span style="color:rgb(255,129,36);"><strong><span style="font-size:15px;">Lambda plus 的适用场景</span></strong></span></h4> 
 <p><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">基于 Tablestore 和 Blink 的 Lambda plus 架构，适用于基于分布式 NoSQL 数据库存储数据的大数据分析场景，如 IOT、时序数据、爬虫数据、用户行为日志数据存储等，数据量以 TB 级为主。典型的业务场景如：</span></p> 
 <p style="text-align:left;line-height:1.75em;"><br></p> 
 <p style="text-align:left;line-height:1.75em;"><span style="font-size:15px;color:rgb(62,62,62);">大数据舆情分析系统：</span></p> 
 <p><br></p> 
 <p style="text-align:center;"><img class="rich_pages" src="https://images2.imgbox.com/a4/8f/ZB5dOOXT_o.png" alt="640?wx_fmt=png"></p> 
 <p style="text-align:center;"><br></p> 
 <h4 style="font-weight:bold;line-height:1.6;"><span style="font-size:14px;color:rgb(136,136,136);">参考资料</span></h4> 
 <p style="text-align:left;"><span style="font-size:14px;color:rgb(136,136,136);">[1]<span style="color:rgb(136,136,136);font-size:14px;text-align:left;">.</span>https://yq.aliyun.com/articles/704171?spm=a2c4e.11153959.0.0.229847a2BpWNvc</span></p> 
 <p><span style="font-size:14px;color:rgb(136,136,136);">[2].</span><span style="font-size:14px;color:rgb(136,136,136);">http://lambda-architecture.net</span><span style="font-size:14px;color:rgb(136,136,136);">/<br>[3].</span><span style="font-size:14px;color:rgb(136,136,136);">http://shop.oreilly.com/product/0636920032175.do</span><span style="font-size:14px;color:rgb(136,136,136);">, </span><span style="font-size:14px;color:rgb(136,136,136);">Martin Kleppmann</span><br><span style="font-size:14px;color:rgb(136,136,136);">[4].</span><span style="font-size:14px;color:rgb(136,136,136);">https://www.oreilly.com/ideas/applying-the-kappa-architecture-in-the-telco-industry</span><br><span style="font-size:14px;color:rgb(136,136,136);">[5].</span><span style="font-size:14px;color:rgb(136,136,136);">https://www.oreilly.com/ideas/questioning-the-lambda-architecture</span><span style="font-size:14px;color:rgb(136,136,136);">,</span><span style="color:rgb(136,136,136);font-size:14px;">Jay Kre</span><span style="color:rgb(136,136,136);font-size:14px;">ps</span></p> 
 <p><span style="font-size:14px;color:rgb(136,136,136);">[6].</span><span style="font-size:14px;color:rgb(136,136,136);">http://milinda.pathirage.org/kappa-architecture.com/</span><br><span style="font-size:14px;color:rgb(136,136,136);">[7].</span><span style="font-size:14px;color:rgb(136,136,136);">Moving from Lambda and Kappa Architectures to Kappa+ at Uber</span><br><span style="font-size:14px;color:rgb(136,136,136);"><span style="color:rgb(136,136,136);font-size:14px;text-align:left;">[</span>8].</span><span style="font-size:14px;color:rgb(136,136,136);">https://eng.uber.com/hoodie/</span><span style="font-size:14px;color:rgb(136,136,136);">, </span><span style="font-size:14px;color:rgb(136,136,136);">Prasanna Rajaperumal</span><span style="font-size:14px;color:rgb(136,136,136);"> and </span><span style="font-size:14px;color:rgb(136,136,136);">Vinoth Chandar</span><br><span style="font-size:14px;color:rgb(136,136,136);">[9].</span><span style="font-size:14px;color:rgb(136,136,136);">https://eng.uber.com/uber-big-data-platform/</span><span style="font-size:14px;color:rgb(136,136,136);">, </span><span style="font-size:14px;color:rgb(136,136,136);">Reza Shiftehfar</span></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><img src="https://images2.imgbox.com/dd/2a/DWjAytmf_o.png" alt="640?wx_fmt=png"></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><span style="color:rgb(84,84,84);font-size:15px;">每天一篇技术文章，</span></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><span style="color:rgb(84,84,84);font-size:15px;">看不过瘾？</span><br></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><span style="font-size:15px;color:rgb(84,84,84);">关注“</span><span style="font-size:15px;color:rgb(217,33,66);"><strong>阿里机器智能</strong></span><span style="color:rgb(84,84,84);font-size:15px;">”，</span></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><span style="color:rgb(84,84,84);font-size:14px;">发现更多AI干货。</span></p> 
 <p style="min-height:1em;letter-spacing:.544px;"><br></p> 
 <img width="317" style="vertical-align:middle;" src="https://images2.imgbox.com/18/85/B07KEzjR_o.png" alt="640?wx_fmt=jpeg"> 
 <p style="min-height:1em;text-align:center;"><span style="color:rgb(62,62,62);font-size:15px;letter-spacing:.544px;text-align:left;"><strong style="letter-spacing:.544px;text-align:center;line-height:27.2px;"><span style="color:rgb(136,136,136);font-size:14px;"> ↑ </span></strong><strong style="letter-spacing:.544px;text-align:center;line-height:27.2px;font-size:14px;color:rgb(136,136,136);">翘首以盼等你关注</strong></span><br></p> 
 <p style="min-height:1em;"><br></p> 
 <p style="min-height:1em;letter-spacing:.544px;"><img src="https://images2.imgbox.com/ac/69/IaXiWMbC_o.png" alt="640?wx_fmt=gif"></p> 
 <p style="min-height:1em;letter-spacing:.544px;font-size:14px;font-family:monospace;text-align:center;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:15px;"><strong>你可能还喜欢</strong></span></p> 
 <p style="min-height:1em;letter-spacing:.544px;font-size:14px;font-family:monospace;text-align:center;line-height:1.75em;"><span style="color:rgb(136,136,136);font-size:12px;">点击下方图片即可阅读</span></p> 
 <p style="min-height:1em;letter-spacing:.544px;font-size:14px;font-family:monospace;text-align:center;line-height:1.75em;"><br></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;line-height:1.75em;"><a href="https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247490475&amp;idx=1&amp;sn=bee5d94253c119d49c156aba6aab4a23&amp;chksm=e92926a4de5eafb2415e6db2db1185da23511eb9494354342f70245ad75f4b20a8538d2a0c09&amp;token=114993047&amp;lang=zh_CN&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link" style="line-height:0;"><img style="letter-spacing:.544px;" src="https://images2.imgbox.com/2a/00/m7uUbMiL_o.png" alt="640?wx_fmt=jpeg"></span></a><br></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;line-height:1.75em;"><a href="https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247490475&amp;idx=1&amp;sn=bee5d94253c119d49c156aba6aab4a23&amp;chksm=e92926a4de5eafb2415e6db2db1185da23511eb9494354342f70245ad75f4b20a8538d2a0c09&amp;token=114993047&amp;lang=zh_CN&amp;scene=21#wechat_redirect" rel="nofollow"><span style="font-size:14px;">谁是代码界3%的王者？</span></a></p> 
 <p style="min-height:1em;letter-spacing:.544px;font-size:14px;font-family:monospace;text-align:center;line-height:1.75em;"><br></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><a href="https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247490367&amp;idx=1&amp;sn=32d43d44eb67cf4b460aa705acc09ef0&amp;chksm=e9292630de5eaf26b2d150c31bc3404f38efb22d35b8616581c93a8844662a1c34fdb8e0fd77&amp;token=1599949620&amp;lang=zh_CN&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link" style="line-height:0;"><img class="rich_pages" src="https://images2.imgbox.com/e3/5a/LLfoJu2Z_o.png" alt="640?wx_fmt=jpeg"></span></a><span style="color:rgb(87,107,149);font-size:14px;letter-spacing:.544px;">开放下载！《阿里语音与信号处理技术》精选集</span></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><br></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><a href="https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247490442&amp;idx=1&amp;sn=62d1a7e5f90f172c0deafca474772d89&amp;chksm=e9292685de5eaf93b29e862f1af709f47409447c02e0bd55a710b2ba0fb19fd17505a7a35a01&amp;token=786564927&amp;lang=zh_CN&amp;scene=21#wechat_redirect" rel="nofollow"><span class="js_jump_icon h5_image_link" style="line-height:0;"><img class="rich_pages" src="https://images2.imgbox.com/0c/58/zAkNiUd2_o.png" alt="640?wx_fmt=jpeg"></span></a></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><a href="https://mp.weixin.qq.com/s?__biz=MzIzOTU0NTQ0MA==&amp;mid=2247490442&amp;idx=1&amp;sn=62d1a7e5f90f172c0deafca474772d89&amp;chksm=e9292685de5eaf93b29e862f1af709f47409447c02e0bd55a710b2ba0fb19fd17505a7a35a01&amp;token=786564927&amp;lang=zh_CN&amp;scene=21#wechat_redirect" rel="nofollow"><span style="font-size:14px;">优秀工程师必备的一项技能，你解锁了吗？</span></a></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;line-height:1.75em;"><br></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><br></p> 
 <p style="min-height:1em;letter-spacing:.544px;text-align:center;"><img style="border-width:1px;border-style:solid;border-color:rgb(238,237,235);background-position:50% 50%;background-repeat:no-repeat;" src="https://images2.imgbox.com/52/0f/IVtybBhe_o.png" alt="640?wx_fmt=jpeg"></p> 
 <p style="text-indent:0em;min-height:1em;letter-spacing:.544px;font-family:monospace;font-size:11.9px;text-align:center;line-height:1.75em;"><br></p> 
 <p style="text-indent:0em;min-height:1em;letter-spacing:.544px;font-family:monospace;font-size:11.9px;text-align:center;line-height:1.75em;"><strong><span style="font-size:15px;"><span style="font-size:14px;font-family:'宋体';color:rgb(136,136,136);">关注</span><span style="font-size:14px;font-family:'宋体';color:rgb(255,76,65);">「阿里技术」</span></span></strong></p> 
 <p style="text-indent:0em;min-height:1em;letter-spacing:.544px;font-family:monospace;font-size:11.9px;text-align:center;line-height:1.75em;"><strong><span style="font-size:14px;font-family:'宋体';color:rgb(136,136,136);">把握前沿技术脉搏</span></strong></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6925a3605e97b1f5a77f7d7233234956/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据分析(8)--matplotlib 数据可视化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/726a631a495b97895070664a2a8f7154/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">超简单 微信开发 分享功能 php,自定义微信分享功能</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>