<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>乔尔·格林布拉特的神奇公式 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="乔尔·格林布拉特的神奇公式" />
<meta property="og:description" content="2005年，格林布拉特将自己长达20年的投资经验浓缩成一本仅有150页的小书——《股市稳赚》（The Little Book That Beats The Market），他创造的这一投资方法因此广为流传，并被称为“神奇公式”。 格林布拉特的投资理念来源于价值投资，他要做的就是找到物美价廉的公司，尤其是在市场出现特殊情况的背景下低价买入拥有好业务的公司。价廉物美简单说就是一方面寻找好的业务，另一方，面寻找便宜的股票。在《股市稳赚》中，格林布拉特指出：好的业务是指有形资本回报率高的公司，而便宜的股票则是指净收益率高的股票。乔尔·格林布拉特认为，好企业就是资本回报率高(ROIC)的企业，便宜也就是低估值，可以用PE、PB、EBIT/EV等来衡量。 神奇公式筛选股票函数实现
排除不适合ROIC衡量的企业，例如银行等。 将股票以ROIC与EP排序，再将ROIC和EP的序数相加。 最后得到序数之和选取最大的30只股票。 import numpy as np import pandas as pd import datetime def MagicFormulaSelect(universe,date):
&#34;&#34;&#34; 给定股票列表和日期，返回神奇公式评分最高的股票的30只股票 Args: universe (list of str): 股票列表（有后缀） date (str or datetime): 常见日期格式支持 Returns: list: 神奇公式评分最高的股票的30只股票 Examples: &gt;&gt; universe = set_universe(&#39;HS300&#39;) &gt;&gt; buy_list = MagicFormulaSelect(universe,&#39;20160909&#39;) &#34;&#34;&#34; trade_date = date if isinstance(date,datetime.datetime) else parse(date) trade_date = trade_date.strftime(&#39;%Y%m%d&#39;) df_roic = DataAPI.MktStockFactorsOneDayProGet(tradeDate=trade_date,secID=universe, ticker=u&#34;&#34;,field=u&#34;secID,tradeDate,ROIC&#34;,pandas=&#34;1&#34;) df_roic = df_roic.dropna() df_roic = df_roic." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5b6f2ba7bb4c3eb7488f68a9f832e0e4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-21T23:39:36+08:00" />
<meta property="article:modified_time" content="2018-08-21T23:39:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">乔尔·格林布拉特的神奇公式</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>2005年，格林布拉特将自己长达20年的投资经验浓缩成一本仅有150页的小书——《股市稳赚》（The Little Book That Beats The Market），他创造的这一投资方法因此广为流传，并被称为“神奇公式”。 <br> 格林布拉特的投资理念来源于价值投资，他要做的就是找到物美价廉的公司，尤其是在市场出现特殊情况的背景下低价买入拥有好业务的公司。价廉物美简单说就是一方面寻找好的业务，另一方，面寻找便宜的股票。在《股市稳赚》中，格林布拉特指出：好的业务是指有形资本回报率高的公司，而便宜的股票则是指净收益率高的股票。乔尔·格林布拉特认为，好企业就是资本回报率高(ROIC)的企业，便宜也就是低估值，可以用PE、PB、EBIT/EV等来衡量。 <br> 神奇公式筛选股票函数实现</p> 
<p>排除不适合ROIC衡量的企业，例如银行等。 <br> 将股票以ROIC与EP排序，再将ROIC和EP的序数相加。 <br> 最后得到序数之和选取最大的30只股票。 <br> import numpy as np <br> import pandas as pd <br> import datetime <br> def MagicFormulaSelect(universe,date):</p> 
<pre><code>"""
给定股票列表和日期，返回神奇公式评分最高的股票的30只股票
Args:
    universe (list of str): 股票列表（有后缀）
    date (str or datetime): 常见日期格式支持
Returns:
    list: 神奇公式评分最高的股票的30只股票

Examples:
    &gt;&gt; universe = set_universe('HS300')
    &gt;&gt; buy_list = MagicFormulaSelect(universe,'20160909')
"""

trade_date = date if isinstance(date,datetime.datetime) else parse(date)
trade_date = trade_date.strftime('%Y%m%d')
df_roic = DataAPI.MktStockFactorsOneDayProGet(tradeDate=trade_date,secID=universe,
                                              ticker=u"",field=u"secID,tradeDate,ROIC",pandas="1")
df_roic = df_roic.dropna()
df_roic = df_roic.reset_index()
df_roic['rank_roic'] = df_roic['ROIC'].rank()
df_pe = DataAPI.MktStockFactorsOneDayProGet(tradeDate=trade_date,secID=df_roic['secID'].tolist(),
                                        ticker=u"",field=u"secID,tradeDate,PE",pandas="1")
df_pe['EP'] = 1.0/df_pe['PE']
df_pe['rank_ep'] = df_pe['EP'].rank()
df_rank = pd.concat([df_roic[['secID','rank_roic']],df_pe[['rank_ep']]],axis=1)
df_rank['rank_sum'] = df_rank['rank_roic'] + df_rank['rank_ep']
return df_rank.sort_values(['rank_sum'],ascending=False)['secID'].tolist()[0:30]
</code></pre> 
<p>start = ‘2013-01-01’ # 回测起始时间 <br> end = ‘2016-09-19’ # 回测结束时间 <br> benchmark = ‘HS300’ # 策略参考标准 <br> universe = DynamicUniverse(‘A’) # 证券池，支持股票和基金 <br> capital_base = 1000000 # 起始资金 <br> freq = ‘d’ # 策略类型，’d’表示日间策略使用日线回测，’m’表示日内策略使用分钟线回测 <br> refresh_rate = 20 # 调仓频率，表示执行handle_data的时间间隔，若freq = ‘d’时间间隔的单位为交易日，若freq = ‘m’时间间隔为分钟</p> 
<p>def initialize(account): # 初始化虚拟账户状态 <br> pass</p> 
<p>def handle_data(account): # 每个交易日的买入卖出指令</p> 
<pre><code>buy_list = MagicFormulaSelect(account.universe,account.previous_date)

for stk in account.avail_security_position:
    if stk not in buy_list:
        order_to(stk, 0)
if len(buy_list) &gt; 0:
        weight = min(0.1,1.0/len(buy_list))
else:
    weight = 0
for stk in buy_list:
    if stk not in account.security_position:
        order_pct_to(stk,weight)
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f35c452c144f126d9aca4cb2254b1a86/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LeetCode: 26. 删除排序数组中的重复项（Java）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f93ad94beddbfd8017caf9167bb29896/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何成功import cv2</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>