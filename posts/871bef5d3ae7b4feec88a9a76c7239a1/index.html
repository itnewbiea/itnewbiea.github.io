<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>oracle 三表关联更新_Oracel学习--多表关联（99语法）、TOP-N、分页 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="oracle 三表关联更新_Oracel学习--多表关联（99语法）、TOP-N、分页" />
<meta property="og:description" content="（以下连接，都基于笛卡尔积模型）
1.自然连接 关键字 nuatural join
概念：基于两个表中列名完全相同的列产生连接
注意：
[1]两个表有相同名字的列
[2]数据类型相同
[3]从两个表中选出连接列的值相等的所有行
语法：
select * from dept d natural join emp e 使用自然连接后，新表只会保留一个重复列。
自然连接的使用特点：
主外键关系且主外键字段只有一个。这样才会比较符合我们的实际运用。
2.using using 主要用于指定连接字段。
[1] 按照指定的字段连接两个表。
[2] 选指定字段值相同的数据行。
由于自然连接的局限性，Oracle推出了Using关键字，Using可以灵活地制定关键字段来进行连接。
select * from emp e join dept d using (deptno) 3. on 为了设置任意的连接条件或者指定连接的列，需要使用ON子句
连个表的关联用关键字 join ，默认内连接(inner) 语法
语法：
select filed1,fild2,… from table1 join table2 on condition1 [join table3 on condition2]* -- 查询出员工的部门名称 select * from dept d join emp e on d." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/871bef5d3ae7b4feec88a9a76c7239a1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-22T12:20:33+08:00" />
<meta property="article:modified_time" content="2021-01-22T12:20:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">oracle 三表关联更新_Oracel学习--多表关联（99语法）、TOP-N、分页</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/11/5e/ImHWAG0t_o.png" alt="c94577e454ca1c70d9713615ee3e5822.png"> 
 </div> 
 <p>（以下连接，都基于笛卡尔积模型）</p> 
 <h3>1.自然连接</h3> 
 <p>关键字 nuatural join</p> 
 <p>概念：基于两个表中列名完全相同的列产生连接</p> 
 <p>注意：</p> 
 <p>[1]两个表有相同名字的列</p> 
 <p>[2]数据类型相同</p> 
 <p>[3]从两个表中选出连接列的值相等的所有行</p> 
 <p>语法：</p> 
 <div class="has"> 
  <pre class="has"><code>select *
from dept d natural join emp e</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/dd/a2/BWYpFNwL_o.png" alt="30cdce43116c31454a3b3aac50c89b12.png"> 
 </div> 
 <p>使用自然连接后，新表只会保留一个重复列。</p> 
 <p>自然连接的使用特点：</p> 
 <p>主外键关系且主外键字段只有一个。这样才会比较符合我们的实际运用。</p> 
 <h3>2.using</h3> 
 <p>using 主要用于指定连接字段。</p> 
 <p>[1] 按照指定的字段连接两个表。</p> 
 <p>[2] 选指定字段值相同的数据行。</p> 
 <p>由于自然连接的局限性，Oracle推出了Using关键字，Using可以灵活地制定关键字段来进行连接。</p> 
 <div class="has"> 
  <pre class="has"><code>select *
from emp e join dept d using (deptno)</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/a2/9c/Fuus0Jx1_o.png" alt="81be1faf7def055c0273f25f00d8b5ab.png"> 
 </div> 
 <h3>3. on</h3> 
 <p>为了设置任意的连接条件或者指定连接的列，需要使用ON子句</p> 
 <p>连个表的关联用关键字 join ，默认内连接(inner) 语法</p> 
 <p>语法：</p> 
 <div class="has"> 
  <pre class="has"><code>select filed1,fild2,…
from table1 
join table2 on condition1
     [join table3 on condition2]*</code></pre> 
 </div> 
 <div class="has"> 
  <pre class="has"><code>-- 查询出员工的部门名称
select *
from dept d join emp e
on d.deptno = e.deptno</code></pre> 
 </div> 
 <div class="has"> 
  <pre class="has"><code>-- 查询scott的上级领导
select e.ename,m.ename
from emp e join emp m
on e.mgr = m.empno
where e.ename = 'SCO%T'</code></pre> 
 </div> 
 <h4>3.1三表连接</h4> 
 <div class="has"> 
  <pre class="has"><code>-- 查询SCOTT部门名称和薪资等级
select e.ename,d.dname,sg.grade
from dept d join emp e on d.deptno = e.deptno 
join salgrade sg on e.sal between sg.losal and sg.hisal
where e.ename = 'SCO%T'</code></pre> 
 </div> 
 <div class="has"> 
  <pre class="has"><code>-- 查询SCOTT的管理者名称和其管理者的薪资等级
select e.ename,m.ename,sg.grade
from emp e join emp m on e.mgr = m.empno
join salgrade sg on m.sal between sg.losal and sg.hisal
where e.ename = 'SCOTT'</code></pre> 
 </div> 
 <h3>4.外连接</h3> 
 <p>按照主表的位置，可以分为left outer/right outer</p> 
 <p>语法：</p> 
 <div class="has"> 
  <pre class="has"><code>select filed1,field2
from table1 left/right outer join table2 on condition1
      [left/right outer join table3 on condition2]*</code></pre> 
 </div> 
 <p>左外连接</p> 
 <div class="has"> 
  <pre class="has"><code>-- 查询所有部门的所有员工
select *
from dept d left outer join emp e
on d.deptno = e.deptno</code></pre> 
 </div> 
 <p>右外连接</p> 
 <div class="has"> 
  <pre class="has"><code>-- 查询所有部门的所有员工
select *
from emp e right outer join dept d
on e.deptno = d.deptno;</code></pre> 
 </div> 
 <h3>5.子查询</h3> 
 <p>查询得到的一个表，我们可以称之为虚表，这个虚表我们可以作为另一个查询的条件，或者表。即在另一个查询中，嵌套一个sql语句。</p> 
 <div class="has"> 
  <pre class="has"><code>SELECT	select_list
FROM	table
WHERE	expr operator
		(SELECT	select_list
			 FROM	table);</code></pre> 
 </div> 
 <p>理解子查询的关键在于把子查询当作一张表来看待。外层的语句可以把内嵌的子查询返回的结果当成一张表使用。子查询可以作为一个虚表被使用。</p> 
 <p>子表查询需要用括号把子表括起来。</p> 
 <p>一般语法中，我们会将子查询放在比较运算符的右边（便于增加代码可读性）</p> 
 <h4>5.1单行子查询</h4> 
 <p>单行子查询，只该查询的查询结果只有一个值时，我们称之为单行子查询，值得注意的是，这样的值，在子查询中，我们常常将其用于条件比较。</p> 
 <div class="has"> 
  <pre class="has"><code>-- 查询雇员其薪资在雇员平均薪资以上
-- [1] 查询员工的平均薪资
select avg(e.sal) "AVGSAL"
from emp e

--[2] 查询满足条件的雇员
select *
from emp e
where e.sal &gt; (select avg(e.sal) "AVGSAL" from emp e)</code></pre> 
 </div> 
 <h4>5.2多行子查询</h4> 
 <p>多行子查询，我们只需把这条sql语句当成一个表即可，而且经常会与 in 、 some 、any 、all 、exists 联用。</p> 
 <div class="has"> 
  <pre class="has"><code>-- 查在雇员中有哪些人是管理者
--【1】查询管理者
select distinct e.mgr
from emp e
where e.mgr is not null

--【2】查询指定列表的信息 in
select e.*
from emp e 
where e.empno in (select distinct e.mgr
                         from emp e
                         where e.mgr is not null)</code></pre> 
 </div> 
 <h4>5.3 from后的子查询</h4> 
 <p>同样，将这条sql语句当成一个表来使用，就跟多表连接（关联）类似。</p> 
 <div class="has"> 
  <pre class="has"><code>-- 每个部门平均薪水的等级
--【1】部门的平均薪资
select e.deptno,avg(e.sal) "AVGSAL"
from emp e
group by e.deptno

--【2】求等级
select vt0.deptno,vt0.avgsal,sg.grade
from (select e.deptno,avg(e.sal) "AVGSAL"
        from emp e
        group by e.deptno) VT0,salgrade sg
where vt0.avgsal between sg.losal and sg.hisal
-- 99 join on
select vt0.deptno,vt0.avgsal,sg.grade
from (select e.deptno,avg(e.sal) "AVGSAL"
        from emp e
        group by e.deptno) VT0 join salgrade sg on vt0.avgsal between sg.losal and sg.hisal
</code></pre> 
 </div> 
 <h3>6. TOP-N</h3> 
 <p>把select得到的数据集提取前n条数。</p> 
 <p>rownum:表示对查询的数据集记录的编号，从1开始。</p> 
 <div class="has"> 
  <pre class="has"><code>-- 查询前10名雇员
select e.*,rownum
from emp e
where rownum &lt;= 10</code></pre> 
 </div> 
 <div class="has"> 
  <pre class="has"><code>-- 查询按照薪资降序，前10名雇员
select e.*,rownum
from emp e
where rownum &lt;= 10
order by e.sal desc</code></pre> 
 </div> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/f1/f4/mNVSjbys_o.png" alt="59bb3fc4f7b3d4296e8a255059597b2b.png"> 
 </div> 
 <p>注意：</p> 
 <p>[1] order by 一定在整个结果集出现后才执行。</p> 
 <p>[2] rownum 在结果集出现后才有编号。</p> 
 <p> 执行顺序：</p> 
 <p>...-&gt; select -&gt; rownum -&gt; order by</p> 
 <p>[3] order by 正常情况下，永远最后执行，所以，这里的rownum就有可能会生变化。</p> 
 <p>上述例子正确语法：</p> 
 <div class="has"> 
  <pre class="has"><code>-- 查询按照薪资降序，前10名雇员
select vt0.*,rownum
from (select e.*
     from emp e 
     order by e.sal desc) VT0
where rownum &lt;= 10</code></pre> 
 </div> 
 <p>把ruwnum冻结之后，我们再使用rownum进行条件过滤。</p> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/23/5e/KDOssH1h_o.png" alt="77f3f54fbd6f0caa8fc6b5c743c6682d.png"> 
 </div> 
 <h3>7.分页</h3> 
 <div class="has"> 
  <pre class="has"><code>-- 求查询6-10号的雇员
select vt0.*
from (select e.*,rownum "RN"
        from emp e 
        where rownum &lt;= 10) VT0
where vt0.rn &gt;= 6</code></pre> 
 </div> 
 <p>（一般用于网页的分页）格式或规律：</p> 
 <p>求page=n,pagesize=size的数据</p> 
 <p>=&gt;[(n-1)*size+1,n*size]</p> 
 <div class="has"> 
  <pre class="has"><code>select vt0.*
from (select t.*, rownum “RN”
from table t 
where rownum &lt;= n*size) VT0
where vt0.rn &gt;= (n-1)*size+1</code></pre> 
 </div> 
 <h3>8.行转列</h3> 
 <p></p> 
 <div style="text-align:center;"> 
  <img src="https://images2.imgbox.com/90/e1/K0573F5l_o.png" alt="beab2f312d0ff6f0b015cad7e52fbf48.png"> 
 </div> 
 <p>将上面的结果改成下面的结果：</p> 
 <p>姓名 语文 数学 英语</p> 
 <p>张三 78 88 98</p> 
 <p>王五 89 56 89</p> 
 <div class="has"> 
  <pre class="has"><code>select ts.name,
sum(decode(ts.subject,'语文',ts.score)) "语文",
sum(decode(ts.subject,'数学',ts.score)) "数学",
sum(decode(ts.subject,'英语',ts.score)) "英语"
from test_score ts
group by ts.name</code></pre> 
 </div> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a1e6531561888ba65d730fbd325bee75/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">前端框架React Js入门教程【转】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c6b7992de126b750e46cc2696dfbb2e1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">centos7.x 查看主机名,修改主机名</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>