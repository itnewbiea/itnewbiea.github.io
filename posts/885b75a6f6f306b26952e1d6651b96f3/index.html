<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python操作rocket-mq - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python操作rocket-mq" />
<meta property="og:description" content="1、参考源码
看源码，可以修改消息字节长度限制（rocketmq/client.py）
2、推送消息
from rocketmq.client import Producer, Message producer = Producer(&#39;PID-001&#39;) #随便 producer.set_namesrv_addr(&#39;ip:port&#39;) #ip和端口 producer.start() msg = Message(&#39;rocket_mq_test_broadcast_topic&#39;) #topic msg.set_keys(&#39;2020-12-15&#39;) msg.set_tags(&#39;explain&#39;) msg.set_body(&#39;{&#34;key&#34;:&#34;value&#34;}&#39;) ret = producer.send_sync(msg) print(ret.status, ret.msg_id, ret.offset) producer.shutdown() 推送消息的时候，如果消息所占字节太长，需要手动设置size，代码中设置的是1M。
producer = Producer(&#39;PID-001&#39;,max_message_size=1024*1024) 3、消费方式PullConsumer（全部消费）（可重复消费）
from rocketmq.client import PullConsumer import json consumer = PullConsumer(&#39;PID-001&#39;) consumer.set_namesrv_addr(&#39;ip:port&#39;) consumer.start() for msg in consumer.pull(&#39;rocket_mq_test_broadcast_topic&#39;): print(msg.tags) print(msg.keys) print(msg.id, msg.body) print(msg.topic) print(msg) data=json.loads(str(msg)) #dict consumer.shutdown() 4、消费方式PushConsumer（即时消费）（不可重复消费）
import time from rocketmq.client import PushConsumer def callback(msg): print(msg) consumer = PushConsumer(&#39;PID-001&#39;) consumer." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/885b75a6f6f306b26952e1d6651b96f3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-15T10:41:28+08:00" />
<meta property="article:modified_time" content="2020-12-15T10:41:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python操作rocket-mq</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong><a href="https://github.com/messense/rocketmq-python">1、参考源码</a></strong></p> 
<p>看源码，可以修改消息字节长度限制（rocketmq/client.py）</p> 
<p><img alt="" height="225" src="https://images2.imgbox.com/fa/7c/EFbEFgqc_o.png" width="444"></p> 
<p><strong>2、推送消息</strong></p> 
<pre><code>from rocketmq.client import Producer, Message
producer = Producer('PID-001')     #随便
producer.set_namesrv_addr('ip:port')   #ip和端口
producer.start()

msg = Message('rocket_mq_test_broadcast_topic')  #topic
msg.set_keys('2020-12-15')
msg.set_tags('explain')
msg.set_body('{"key":"value"}')
ret = producer.send_sync(msg)
print(ret.status, ret.msg_id, ret.offset)
producer.shutdown()
</code></pre> 
<p>推送消息的时候，如果消息所占字节太长，需要手动设置size，代码中设置的是1M。</p> 
<pre><code>producer = Producer('PID-001',max_message_size=1024*1024)</code></pre> 
<p>3、消费方式PullConsumer（全部消费）（可重复消费）</p> 
<pre><code>from rocketmq.client import PullConsumer
import json
consumer = PullConsumer('PID-001')
consumer.set_namesrv_addr('ip:port')
consumer.start()
for msg in consumer.pull('rocket_mq_test_broadcast_topic'):
    print(msg.tags)
    print(msg.keys)
    print(msg.id, msg.body)
    print(msg.topic)
    print(msg)
    data=json.loads(str(msg))  #dict
consumer.shutdown()</code></pre> 
<p>4、消费方式PushConsumer（即时消费）（不可重复消费）</p> 
<pre><code>import time
from rocketmq.client import PushConsumer
def callback(msg):
    print(msg)
consumer = PushConsumer('PID-001')
consumer.set_namesrv_addr('ip:port')
consumer.subscribe("rocket_mq_test_broadcast_topic",callback)
consumer.start()
while True:
    time.sleep(30)
consumer.shutdown()
</code></pre> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/39032d4373d1534ca129b839e50e155b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VINS slam , imu fusion</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/411bc0c552be65fc1589ce6b9abe94a1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">R语言——连续向量离散化函数总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>