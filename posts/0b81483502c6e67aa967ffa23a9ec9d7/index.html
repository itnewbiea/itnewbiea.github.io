<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>HiveQL常用参数 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="HiveQL常用参数" />
<meta property="og:description" content="文章目录 一、并行参数二、小表数据内存运行参数三、数据倾斜时负载均衡参数四、调整内存参数五、调整占用CPU数量参数六、调整map和reduce的数量参数七、动态分区参数八、物化with as九、本地模式十、显示表头十一、大数据集报错Java heap space 一、并行参数 （一）允许不同的job并行执行。当脚本中使用较多个UNION ALL或者不相关联的临时表时，使用并行参数将明显提高执行速度，但同时会占用更多资源。
SET hive.exec.parallel = true; （二）并行数默认为8，可以根据需要调高。
SET hive.exec.parallel.thread.number = 32; 二、小表数据内存运行参数 （一）自动对比表数据，将小表放内存执行。利用mapjoin的方式，直接在map阶段进行join操作，省去reduce过程，提高性能。
SET hive.auto.convert.join = true; （二）设置小表的大小（单位是字节）。结合这两个参数，关联维度时，可以把左联结的维表先根据过滤条件做成小数据量的临时表再关联，以此来提高性能。
SET hive.mapjoin.smalltable.filesize = 25000000 三、数据倾斜时负载均衡参数 （一）当脚本运行时长时间停留在reduce=99%，reduce执行缓慢。
SET hive.groupby.skewindata = true; 四、调整内存参数 （一）调整每个Map Task需要的内存量
SET mapreduce.map.memory.mb = 4096; （二）调整每个Reduce Task需要的内存量
SET mapreduce.reduce.memory.mb = 4096; （三）调整每个Map Task的JVM最大使用内存
SET mapreduce.map.java.opts = Xmx3276M -Djava.net.preferIPv4stack = true; （四）调整每个Reduce Task的JVM最大使用内存
SET mapreduce.reduce.java.opts = Xmx3276M -Djava.net.preferIPv4stack = true; 五、调整占用CPU数量参数 （一）调整每个Map Task可用最多CPU Core数量" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0b81483502c6e67aa967ffa23a9ec9d7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-20T16:57:46+08:00" />
<meta property="article:modified_time" content="2022-10-20T16:57:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">HiveQL常用参数</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_5" rel="nofollow">一、并行参数</a></li><li><a href="#_17" rel="nofollow">二、小表数据内存运行参数</a></li><li><a href="#_28" rel="nofollow">三、数据倾斜时负载均衡参数</a></li><li><a href="#_35" rel="nofollow">四、调整内存参数</a></li><li><a href="#CPU_58" rel="nofollow">五、调整占用CPU数量参数</a></li><li><a href="#mapreduce_64" rel="nofollow">六、调整map和reduce的数量参数</a></li><li><a href="#_88" rel="nofollow">七、动态分区参数</a></li><li><a href="#with_as_103" rel="nofollow">八、物化with as</a></li><li><a href="#_108" rel="nofollow">九、本地模式</a></li><li><a href="#_114" rel="nofollow">十、显示表头</a></li><li><a href="#Java_heap_space_121" rel="nofollow">十一、大数据集报错Java heap space</a></li></ul> 
</div> 
<p></p> 
<hr color="#000000" size='1"'> 
<h2><a id="_5"></a>一、并行参数</h2> 
<p>（一）允许不同的job并行执行。当脚本中使用较多个UNION ALL或者不相关联的临时表时，使用并行参数将明显提高执行速度，但同时会占用更多资源。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>parallel <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> 
<p>（二）并行数默认为8，可以根据需要调高。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>parallel<span class="token punctuation">.</span>thread<span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token number">32</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_17"></a>二、小表数据内存运行参数</h2> 
<p>（一）自动对比表数据，将小表放内存执行。利用mapjoin的方式，直接在map阶段进行join操作，省去reduce过程，提高性能。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span>auto<span class="token punctuation">.</span><span class="token keyword">convert</span><span class="token punctuation">.</span><span class="token keyword">join</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> 
<p>（二）设置小表的大小（单位是字节）。结合这两个参数，关联维度时，可以把左联结的维表先根据过滤条件做成小数据量的临时表再关联，以此来提高性能。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span>mapjoin<span class="token punctuation">.</span>smalltable<span class="token punctuation">.</span>filesize <span class="token operator">=</span> <span class="token number">25000000</span>
</code></pre> 
<h2><a id="_28"></a>三、数据倾斜时负载均衡参数</h2> 
<p>（一）当脚本运行时长时间停留在reduce=99%，reduce执行缓慢。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span>groupby<span class="token punctuation">.</span>skewindata <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_35"></a>四、调整内存参数</h2> 
<p>（一）调整每个Map Task需要的内存量</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> mapreduce<span class="token punctuation">.</span>map<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>mb <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>
</code></pre> 
<p>（二）调整每个Reduce Task需要的内存量</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> mapreduce<span class="token punctuation">.</span>reduce<span class="token punctuation">.</span>memory<span class="token punctuation">.</span>mb <span class="token operator">=</span> <span class="token number">4096</span><span class="token punctuation">;</span>
</code></pre> 
<p>（三）调整每个Map Task的JVM最大使用内存</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> mapreduce<span class="token punctuation">.</span>map<span class="token punctuation">.</span>java<span class="token punctuation">.</span>opts <span class="token operator">=</span> Xmx3276M <span class="token operator">-</span>Djava<span class="token punctuation">.</span>net<span class="token punctuation">.</span>preferIPv4stack <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> 
<p>（四）调整每个Reduce Task的JVM最大使用内存</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> mapreduce<span class="token punctuation">.</span>reduce<span class="token punctuation">.</span>java<span class="token punctuation">.</span>opts <span class="token operator">=</span> Xmx3276M <span class="token operator">-</span>Djava<span class="token punctuation">.</span>net<span class="token punctuation">.</span>preferIPv4stack <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="CPU_58"></a>五、调整占用CPU数量参数</h2> 
<p>（一）调整每个Map Task可用最多CPU Core数量</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> mapreduce<span class="token punctuation">.</span>map<span class="token punctuation">.</span>cpu<span class="token punctuation">.</span>vcores <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="mapreduce_64"></a>六、调整map和reduce的数量参数</h2> 
<p>（一）合并小文件限制map数</p> 
<pre><code class="prism language-sql"><span class="token comment"># 一个inputspilt最大含有500M数据</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>max<span class="token punctuation">.</span>split<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">500000000</span><span class="token punctuation">;</span>
<span class="token comment"># 一个inputspilt最小含有100M数据</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>min<span class="token punctuation">.</span>split<span class="token punctuation">.</span>size <span class="token operator">=</span> <span class="token number">100000000</span><span class="token punctuation">;</span>
<span class="token comment"># 一个节点可以处理文件的大小</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>min<span class="token punctuation">.</span>split<span class="token punctuation">.</span>size<span class="token punctuation">.</span>per<span class="token punctuation">.</span>node <span class="token operator">=</span> <span class="token number">100000000</span><span class="token punctuation">;</span>
<span class="token comment"># 一个机架可以处理文件的大小</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>min<span class="token punctuation">.</span>split<span class="token punctuation">.</span>size<span class="token punctuation">.</span>per<span class="token punctuation">.</span>rack <span class="token operator">=</span> <span class="token number">100000000</span><span class="token punctuation">;</span>
<span class="token comment"># 实现map中的数据合并（默认）</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span>input<span class="token punctuation">.</span>format<span class="token operator">=</span>org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>hadoop<span class="token punctuation">.</span>hive<span class="token punctuation">.</span>ql<span class="token punctuation">.</span>io<span class="token punctuation">.</span>CombineHiveInputFormat<span class="token punctuation">;</span>
</code></pre> 
<p>（二）设置reduce数</p> 
<pre><code class="prism language-sql"><span class="token comment"># 一个reduce处理500M数据</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>reducers<span class="token punctuation">.</span>bytes<span class="token punctuation">.</span>per<span class="token punctuation">.</span>reducer <span class="token operator">=</span> <span class="token number">500000000</span><span class="token punctuation">;</span>

<span class="token comment"># 启用5个reduce</span>
<span class="token keyword">SET</span> mapred<span class="token punctuation">.</span>reduce<span class="token punctuation">.</span>tasks <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_88"></a>七、动态分区参数</h2> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span><span class="token keyword">partition</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span><span class="token keyword">partition</span><span class="token punctuation">.</span><span class="token keyword">mode</span> <span class="token operator">=</span> nonstrict<span class="token punctuation">;</span>

<span class="token comment"># 所有节点上最大可以创建多少个动态分区</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>max<span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span>partitions <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token comment"># 每个节点上最大可以创建多少个动态分区</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>max<span class="token punctuation">.</span>dynamic<span class="token punctuation">.</span>partitions<span class="token punctuation">.</span>pernode <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>

<span class="token comment"># 整个MR job中最大可以创建多少个HDFS文件</span>
<span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span>max<span class="token punctuation">.</span>created<span class="token punctuation">.</span>files<span class="token operator">=</span><span class="token number">100000</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="with_as_103"></a>八、物化with as</h2> 
<p>（一）当with as临时表被使用多次时，使用该参数可以将with as临时表物化。比如设置该参数 = 2，则with as临时表被使用两次以上时，with as只会执行一次，以此提高性能。</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">optimize</span><span class="token punctuation">.</span>cte<span class="token punctuation">.</span>materialize<span class="token punctuation">.</span>threshold <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_108"></a>九、本地模式</h2> 
<p>查询时不使用Mapreduce，不触发job，比如一些直接查询的操作，如：SELECT * FROM xxx；</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span><span class="token keyword">exec</span><span class="token punctuation">.</span><span class="token keyword">mode</span><span class="token punctuation">.</span><span class="token keyword">local</span><span class="token punctuation">.</span>auto <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_114"></a>十、显示表头</h2> 
<p>查询表字段时，显示表名+字段名</p> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> hive<span class="token punctuation">.</span>cli<span class="token punctuation">.</span><span class="token keyword">print</span><span class="token punctuation">.</span>header <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="Java_heap_space_121"></a>十一、大数据集报错Java heap space</h2> 
<pre><code class="prism language-sql"><span class="token keyword">SET</span> io<span class="token punctuation">.</span>sort<span class="token punctuation">.</span>mb
</code></pre> 
<p>生产中场景，SET io.sort.mb发现默认为512，调整为100后任务跑通。<br> <img src="https://images2.imgbox.com/ef/2e/ogyDUGwU_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b525768c54ac1290d3af27b73c842497/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java终止线程的三种方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1dd74f76aa666d44e2192bb419b68fe7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springboot打包分离lib和配置文件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>