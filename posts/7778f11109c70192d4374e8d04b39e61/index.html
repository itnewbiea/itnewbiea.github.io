<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>IDEA 中 ANTLR 4 的安装与使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="IDEA 中 ANTLR 4 的安装与使用" />
<meta property="og:description" content="（1）在 File - Settings - Plugins 中，安装 ANTLR v4 插件
（2）创建 maven 项目
File - New - Project… 中，选择 maven，
然后一路 next 即可（当然，可以自己取个名字，换个位置）
（3）在 pox.xml 中添加 antlr 的依赖项
&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;org.antlr&lt;/groupId&gt; &lt;artifactId&gt;antlr4-runtime&lt;/artifactId&gt; &lt;version&gt;4.10.1&lt;/version&gt; &lt;/dependency&gt; &lt;/dependencies&gt; &lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.antlr&lt;/groupId&gt; &lt;artifactId&gt;antlr4-maven-plugin&lt;/artifactId&gt; &lt;version&gt;4.10.1&lt;/version&gt; &lt;executions&gt; &lt;execution&gt; &lt;id&gt;antlr&lt;/id&gt; &lt;goals&gt; &lt;goal&gt;antlr4&lt;/goal&gt; &lt;/goals&gt; &lt;phase&gt;none&lt;/phase&gt; &lt;/execution&gt; &lt;/executions&gt; &lt;configuration&gt; &lt;outputDirectory&gt;src/test/java&lt;/outputDirectory&gt; &lt;listener&gt;true&lt;/listener&gt; &lt;treatWarningsAsErrors&gt;true&lt;/treatWarningsAsErrors&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt; &lt;/build&gt; 添加位置如下所示，注意在 &lt;version&gt; 的地方修改成自己的 antlr 版本！
&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt; &lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34; xsi:schemaLocation=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7778f11109c70192d4374e8d04b39e61/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-05-03T11:27:31+08:00" />
<meta property="article:modified_time" content="2022-05-03T11:27:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">IDEA 中 ANTLR 4 的安装与使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>（1）在 File - Settings - Plugins 中，安装 ANTLR v4 插件</p> 
<p><img alt="" height="888" src="https://images2.imgbox.com/b5/9d/4EgelPaT_o.png" width="1200"></p> 
<p></p> 
<p>（2）创建 maven 项目</p> 
<p>File - New - Project… 中，选择 maven，</p> 
<p>然后一路 next 即可（当然，可以自己取个名字，换个位置）</p> 
<p></p> 
<p>（3）在 pox.xml 中添加 antlr 的依赖项</p> 
<pre><code>    &lt;dependencies&gt;
        &lt;dependency&gt;
            &lt;groupId&gt;org.antlr&lt;/groupId&gt;
            &lt;artifactId&gt;antlr4-runtime&lt;/artifactId&gt;
            &lt;version&gt;4.10.1&lt;/version&gt;
        &lt;/dependency&gt;
    &lt;/dependencies&gt;

    &lt;build&gt;
        &lt;plugins&gt;
            &lt;plugin&gt;
                &lt;groupId&gt;org.antlr&lt;/groupId&gt;
                &lt;artifactId&gt;antlr4-maven-plugin&lt;/artifactId&gt;
                &lt;version&gt;4.10.1&lt;/version&gt;
                &lt;executions&gt;
                    &lt;execution&gt;
                        &lt;id&gt;antlr&lt;/id&gt;
                        &lt;goals&gt;
                            &lt;goal&gt;antlr4&lt;/goal&gt;
                        &lt;/goals&gt;
                        &lt;phase&gt;none&lt;/phase&gt;
                    &lt;/execution&gt;
                &lt;/executions&gt;
                &lt;configuration&gt;
                    &lt;outputDirectory&gt;src/test/java&lt;/outputDirectory&gt;
                    &lt;listener&gt;true&lt;/listener&gt;
                    &lt;treatWarningsAsErrors&gt;true&lt;/treatWarningsAsErrors&gt;
                &lt;/configuration&gt;
            &lt;/plugin&gt;
        &lt;/plugins&gt;
    &lt;/build&gt;</code></pre> 
<p>添加位置如下所示，注意在 &lt;version&gt; 的地方修改成自己的 antlr 版本！</p> 
<pre><code>&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;project xmlns="http://maven.apache.org/POM/4.0.0"
         xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
    &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

    &lt;groupId&gt;org.example&lt;/groupId&gt;
    &lt;artifactId&gt;untitled1&lt;/artifactId&gt;
    &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;

    &lt;properties&gt;
        &lt;maven.compiler.source&gt;13&lt;/maven.compiler.source&gt;
        &lt;maven.compiler.target&gt;13&lt;/maven.compiler.target&gt;
    &lt;/properties&gt;

    // 上面一坨粘在这里

&lt;/project&gt;</code></pre> 
<p>（4）在 src\main\java 下新建一个 antlr 文法文件，以 .g4 为后缀名，</p> 
<p>文件头部 grammer 关键字定义文法名字，必须与文件名相同，因此我们的文件就叫 demo.g4</p> 
<p>此处定义一个语法，识别以 hello 开头的短句</p> 
<pre><code>grammar demo;            // Define a grammar called demo

parse : prog+ ;              // A program consists of at least one statement

prog : 'Hello' ID            // match keyword hello/Hello followed by an identifier
    | 'hello' ID
    ;

ID : [a-z]+ ;               // match lower-case identifiers

WS : [ \t\n\r]+ -&gt; skip ;   // skip spaces, tabs, newlines, \r (Windows)
</code></pre> 
<p></p> 
<p>（5）右键 demo.g4 文件，选择 Configure ANTLR…，配置输出路径；</p> 
<p>若不填写 output directory where all output is generated，默认会在根目录下生成 gen 文件夹；</p> 
<p>Language 若不填写则默认生成 java 语言；</p> 
<p><img alt="" height="474" src="https://images2.imgbox.com/90/c4/uKpMi7DN_o.png" width="829"></p> 
<p> （6）右键 demo.g4 选择 Configure ANTLR Recognizer，生成输出结果；</p> 
<p class="img-center"><img alt="" height="452" src="https://images2.imgbox.com/87/29/awt7IgRA_o.png" width="333"></p> 
<p>生成后的项目结构如图所示（同为整个项目的结构）：</p> 
<p class="img-center"><img alt="" height="464" src="https://images2.imgbox.com/85/b2/fI3xeEBt_o.png" width="314"></p> 
<p></p> 
<p>其中，demoLexer是词法分析器，demoParser是语法分析器，</p> 
<p>demoVistor和demoListener是两种遍历树的机制，分别是访问者模式和监听器模式</p> 
<p></p> 
<p>（7）调用分析器进行测试</p> 
<p>在 src\main\java\demo1 下新建 test 包（demo1是我自己新建的包），</p> 
<p>在 test 包下新建 demoMain.java 文件</p> 
<pre><code>package demo1.test;

import org.antlr.v4.runtime.ANTLRInputStream;
import org.antlr.v4.runtime.CommonTokenStream;

import demo1.demo.demoLexer;
import demo1.demo.demoParser;

public class demoMain {
    public static void run(String expr) throws Exception{
        // 对每一个输入的字符串，构造一个 ANTLRStringStream 流 in
        ANTLRInputStream input = new ANTLRInputStream(expr);
        // 用 in 构造词法分析器 lexer，词法分析的作用是将字符聚集成单词或者符号
        demoLexer lexer = new demoLexer(input);
        // 用词法分析器 lexer 构造一个记号流 tokens
        CommonTokenStream tokens = new CommonTokenStream(lexer);
        // 再使用 tokens 构造语法分析器 parser,至此已经完成词法分析和语法分析的准备工作
        demoParser parser = new demoParser(tokens);
        // 最终调用语法分析器的规则 parse（在demo.g4里定义的规则），完成对表达式的验证
        parser.parse();
    }

    public static void main(String[] args) throws Exception{
        String[] testStr={
                "Hello world",
                "hello world",
                "hi world"
        };
        for(String s : testStr){
            System.out.println("Input: " + s);
            run(s);
        }
    }
}</code></pre> 
<p>注意 run() 函数最后的 parse.parse() 语句修改为自己的文法规则名称</p> 
<p>（此处规则为 parse，即 demo.g4 文件第一个表达式 parse : prog+ ; ）</p> 
<p></p> 
<p>运行 demoMain.java，</p> 
<p>当输入合法的表达式时，分析器没有任何输出；</p> 
<p>当输入表达式违反文法规则时，分析器输出 line mismatched 信息提示;</p> 
<p><img alt="" height="142" src="https://images2.imgbox.com/16/0d/Hr3xDnV6_o.png" width="700"></p> 
<p></p> 
<p>（8）可视化文法</p> 
<p>在 demo.g4 文件中选择一个文法规则，右键，选择 Text Rule parse</p> 
<p class="img-center"><img alt="" height="400" src="https://images2.imgbox.com/a7/11/V6p6iITF_o.png" width="424"></p> 
<p> 在打开的 ANTLR Preview 中选择 input</p> 
<p>输入表达式，即能够可视化的显示出该文法（以选中符号为根节点）的语法树</p> 
<p><img alt="" height="294" src="https://images2.imgbox.com/56/13/FVTS9m1a_o.png" width="1039"></p> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/db6d92b57e1e71c3873200c0d8a22f4c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">测试了几款基于electron的笔记本软件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/73908a6bef971244b780e8a4c1b00dac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">动态系统MATLAB分析的初步研究（一）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>