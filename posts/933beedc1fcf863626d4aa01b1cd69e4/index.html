<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用OpenCV实现对车流量的统计 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用OpenCV实现对车流量的统计" />
<meta property="og:description" content="此文在我的个人博客地址：https://sublimerui.top/archives/48ab4a6e.html
目录 调试平台汽车识别原理——背景/前景分割算法整体结构整体流程框架图主要参数主要函数 测试结果结论附：程序源代码 闲话少絮。开始正题——OpenCV的车流量统计。
调试平台 OpenCV 4.2VS 2019 汽车识别原理——背景/前景分割算法 如今，检测和提取车辆时候，常用的方法有MOG2算法和KNN算法。MOG算法是以高斯混合模型（GMM）为基础的背景/前景分割算法。它是以2004年和2006年Z.Zivkovic的两篇文章为基础的。这个算法的一个特点是它为每一个像素选择一个合适数目的高斯分布。其主要原理为：在一个固定位置和角度固定的视频或图像中，提取分割图像或视频中运动的成分。此算法使用背景建模的方式，将整张图片或一帧视频分为前景和后景。此算法运行时，会将动态的前景与静止的后景相减，得出结果即为徐提取的运动物体的图像。
K最近邻算法（KNN）是属于机器学习的一种算法。其主要原理为：给定一个已训练数据集，对新的输入实例，在训练数据集中找到与该实例最邻近（注：衡量邻近的标准以具体选取的某个特征而言，例如下面示意图中使用的特征为欧式距离）的K个实例，这K个实例的多数属于某个类，则判定该输入实例同属此类。如下图所示：训练者取k值，计算以欧氏距离k为半径的圆内其他类别的个数，图中中心小红点以k为半径的圆内三角形个数最多，则判定中心小红点为三角形。
整体结构 整体流程框架图 本程序的主要运行流程为：程序运行开始，首先从文件中获取上次保存的光流量检测矩形框数据（顶点坐标和矩形的长宽）；其后，分别初始化背景提取对象，使用MOG2和KNN两种算法。与此同时，建立一个鼠标回调函数，用于捕获鼠标左键（绘制矩形框）、中键（取消操作）和右键（保存矩形框数据到文件）的操作。
此后，程序进入主循环状态。程序循环从视频中获取一帧的图像，先进行压缩处理，以提高后续运算速度。之后，将这一帧图片从RGB转为灰度图片。为了祛除灰度后可能出现的小毛刺杂点，再进行平滑滤波处理。此后，分别通过MOG2和KNN算法提取前景，并将提取后的视频显示出来。与此同时，获取每个矩形框中积分后的亮度和。
最后，两个算法中，分别将实时得到的亮度和与所预设的阈值进行比较，当满足条件后，便认为一辆汽车通过矩形框，使得计数器加一。如此重复，统计整个视频中的车流量。
主要参数 int detectTHD 此参数为预设的亮度阈值。确定是否有汽车经过检测框中，其需要联合上一帧积分亮度和本次积分亮度后综合做出决定。
cv::Size newSize(frame.cols / 2, frame.rows / 2); 此参数可以储存一帧视频缩小后的大小。
cv::Mat showMat; 此参数用于储存最终显示的图像矩阵。
主要函数 static void onMouse(int event, int x, int y, int flags, void\*) 此函数主要用于检测鼠标左键、滑轮（中键）和右键的一些操作，用于绘制矩形检测框。
cv::resize(frame, newframe, newSize); 此函数主要用于缩小原视频比例，提高计算机运算速度。
bgMOG2-\&gt;apply(greyFrame, mog2RES, update_bg_model ? -1 : 0);以及bgKNN-\&gt;apply(greyFrame, KNN, update_bg_model ? -1 : 0); apply函数主要用于两种算法的前景提取。此后，前景提取后的这帧视频保存于bgMOG2和bgKNN之中。
cv::rectangle(showMat, myLanneRect.at(k), cv::Scalar(255, 255, 255), 3); 此函数主要用于前景提取后在其上面绘制矩形框。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/933beedc1fcf863626d4aa01b1cd69e4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-14T09:45:29+08:00" />
<meta property="article:modified_time" content="2020-07-14T09:45:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用OpenCV实现对车流量的统计</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>此文在我的个人博客地址</strong>：<a href="https://sublimerui.top/archives/48ab4a6e.html" rel="nofollow">https://sublimerui.top/archives/48ab4a6e.html</a></p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#_7" rel="nofollow">调试平台</a></li><li><a href="#_12" rel="nofollow">汽车识别原理——背景/前景分割算法</a></li><li><a href="#_20" rel="nofollow">整体结构</a></li><li><ul><li><a href="#_22" rel="nofollow">整体流程框架图</a></li><li><a href="#_32" rel="nofollow">主要参数</a></li><li><a href="#_46" rel="nofollow">主要函数</a></li></ul> 
   </li><li><a href="#_72" rel="nofollow">测试结果</a></li><li><a href="#_105" rel="nofollow">结论</a></li><li><a href="#_109" rel="nofollow">附：程序源代码</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<p>闲话少絮。开始正题——OpenCV的车流量统计。</p> 
<h3><a id="_7"></a>调试平台</h3> 
<ul><li>OpenCV 4.2</li><li>VS 2019</li></ul> 
<h3><a id="_12"></a>汽车识别原理——背景/前景分割算法</h3> 
<p>如今，检测和提取车辆时候，常用的方法有MOG2算法和KNN算法。MOG算法是以高斯混合模型（GMM）为基础的背景/前景分割算法。它是以2004年和2006年Z.Zivkovic的两篇文章为基础的。这个算法的一个特点是它为每一个像素选择一个合适数目的高斯分布。其主要原理为：在一个固定位置和角度固定的视频或图像中，提取分割图像或视频中运动的成分。此算法使用背景建模的方式，将整张图片或一帧视频分为前景和后景。此算法运行时，会将动态的前景与静止的后景相减，得出结果即为徐提取的运动物体的图像。</p> 
<p>K最近邻算法（KNN）是属于机器学习的一种算法。其主要原理为：给定一个已训练数据集，对新的输入实例，在训练数据集中找到与该实例最邻近（注：衡量邻近的标准以具体选取的某个特征而言，例如下面示意图中使用的特征为欧式距离）的K个实例，这K个实例的多数属于某个类，则判定该输入实例同属此类。如下图所示：训练者取k值，计算以欧氏距离k为半径的圆内其他类别的个数，图中中心小红点以k为半径的圆内三角形个数最多，则判定中心小红点为三角形。</p> 
<p><img src="https://images2.imgbox.com/de/48/YuJKdpzZ_o.png" alt="KNN"></p> 
<h3><a id="_20"></a>整体结构</h3> 
<h4><a id="_22"></a>整体流程框架图</h4> 
<p>本程序的主要运行流程为：程序运行开始，首先从文件中获取上次保存的光流量检测矩形框数据（顶点坐标和矩形的长宽）；其后，分别初始化背景提取对象，使用MOG2和KNN两种算法。与此同时，建立一个鼠标回调函数，用于捕获鼠标左键（绘制矩形框）、中键（取消操作）和右键（保存矩形框数据到文件）的操作。</p> 
<p>此后，程序进入主循环状态。程序循环从视频中获取一帧的图像，先进行压缩处理，以提高后续运算速度。之后，将这一帧图片从RGB转为灰度图片。为了祛除灰度后可能出现的小毛刺杂点，再进行平滑滤波处理。此后，分别通过MOG2和KNN算法提取前景，并将提取后的视频显示出来。与此同时，获取每个矩形框中积分后的亮度和。</p> 
<p>最后，两个算法中，分别将实时得到的亮度和与所预设的阈值进行比较，当满足条件后，便认为一辆汽车通过矩形框，使得计数器加一。如此重复，统计整个视频中的车流量。</p> 
<p><img src="https://images2.imgbox.com/d4/63/VTbNpAl1_o.png" alt="流程图"></p> 
<h4><a id="_32"></a>主要参数</h4> 
<ol><li><code>int detectTHD</code></li></ol> 
<blockquote> 
 <p>此参数为预设的亮度阈值。确定是否有汽车经过检测框中，其需要联合上一帧积分亮度和本次积分亮度后综合做出决定。</p> 
</blockquote> 
<ol start="2"><li><code>cv::Size newSize(frame.cols / 2, frame.rows / 2);</code></li></ol> 
<blockquote> 
 <p>此参数可以储存一帧视频缩小后的大小。</p> 
</blockquote> 
<ol start="3"><li><code>cv::Mat showMat;</code></li></ol> 
<blockquote> 
 <p>此参数用于储存最终显示的图像矩阵。</p> 
</blockquote> 
<h4><a id="_46"></a>主要函数</h4> 
<ol><li><code>static void onMouse(int event, int x, int y, int flags, void\*)</code></li></ol> 
<blockquote> 
 <p>此函数主要用于检测鼠标左键、滑轮（中键）和右键的一些操作，用于绘制矩形检测框。</p> 
</blockquote> 
<ol start="2"><li><code>cv::resize(frame, newframe, newSize);</code></li></ol> 
<blockquote> 
 <p>此函数主要用于缩小原视频比例，提高计算机运算速度。</p> 
</blockquote> 
<ol start="3"><li><code>bgMOG2-\&gt;apply(greyFrame, mog2RES, update_bg_model ? -1 : 0);</code>以及<code>bgKNN-\&gt;apply(greyFrame, KNN, update_bg_model ? -1 : 0);</code></li></ol> 
<blockquote> 
 <p>apply函数主要用于两种算法的前景提取。此后，前景提取后的这帧视频保存于bgMOG2和bgKNN之中。</p> 
</blockquote> 
<ol start="4"><li><code>cv::rectangle(showMat, myLanneRect.at(k), cv::Scalar(255, 255, 255), 3);</code></li></ol> 
<blockquote> 
 <p>此函数主要用于前景提取后在其上面绘制矩形框。</p> 
</blockquote> 
<ol start="5"><li><code>cv::integral(subMat, sumMat, CV_32S);</code></li></ol> 
<blockquote> 
 <p>计算车道矩形框亮度积分图。</p> 
</blockquote> 
<ol start="6"><li><code>cv::putText();</code></li></ol> 
<blockquote> 
 <p>此函数可以按照要求，在视频图像上显示文字和统计数字。</p> 
</blockquote> 
<h3><a id="_72"></a>测试结果</h3> 
<ol><li><strong>功能测试</strong></li></ol> 
<p>进行车流量统计前，应当首先根据矩形框中出现车辆时，估算其亮度平均值作为亮度阈值，使其设定为一个较为合适的值，增强检测的灵敏性。由下图可知，当程序运行后，通过手动标记车道检测区域，得到2个矩形检测区。每次获得矩形中的积分亮度结果，当上从亮度结果大于阈值，且此次亮度结果小于阈值时，使车辆统计结果加一。</p> 
<p><img src="https://images2.imgbox.com/4a/2d/aOh5YzI4_o.png" alt="功能测试"></p> 
<ol start="2"><li><strong>算法处理时间</strong></li></ol> 
<p>由测试结果可知，相较于MOG2算法，KNN算法在运算处理上花费更多的时间，KNN算法时间约为MOG2时间的2倍。同时，算法处理总时间也相对较长，除了两个算法所带来的开销外，仍有其他附加代码所花费的时间。</p> 
<p><img src="https://images2.imgbox.com/6f/d4/axInDmIH_o.png" alt="时间处理"></p> 
<ol start="3"><li><strong>缩放图片前后比较</strong></li></ol> 
<p>程序中，可以使用<code>cv::resize();</code>函数进行图片的压缩，缩放图片对于检测速度有较大的影响。不使用缩放时，将视频中原始一帧的图像进行计算，经测试发现，处理速度很慢，显示的图片有明显的脱帧和卡顿现象，CPU占用率相当高，与压缩后（上图）相比，无论使用MOG2还是KNN算法，其处理时间均成倍增加。下图为不使用缩小图片尺寸条件下的处理时间。</p> 
<p><img src="https://images2.imgbox.com/82/9b/f2GQKDss_o.png" alt="时间对比"></p> 
<ol start="4"><li><strong>矩形检测区亮度阈值的影响</strong></li></ol> 
<p>阈值设置的合理性也是车流量检测准确性的一个重要指标。过高或过低的阈值均不能很好地反映车辆的经过和实现的统计。阈值过低，将会把视频中环境干扰噪声和其他运动对象（如三轮车和行人）当做汽车统计，使得统计结果偏大；同理，阈值过高，将很难检测到车辆的通过，当车辆进过矩形检测区时，无法实现车辆的统计。本程序中，经过检测矩形框内平均值的大致估算，将阈值<code>detectTHD</code>设置为900000。</p> 
<p>下图中显示了当阈值设定过小时的状况。右端矩形框（右车道）经过了一辆电动车，程序误认为汽车，并错误地将统计结果L1的值从1加为2。</p> 
<p><img src="https://images2.imgbox.com/85/e3/iFRj5SPW_o.png" alt="阈值过小"></p> 
<p>同理，当阈值设置过大，也会造成统计的不准确。下图显示了当阈值设定过大时的状况。可以发现，即使是车辆经过了矩形框，车辆统计变量L0和L1仍为0。</p> 
<p><img src="https://images2.imgbox.com/6e/d4/ALidYggI_o.png" alt="阈值过大"></p> 
<h3><a id="_105"></a>结论</h3> 
<p>由以上分析可知，汽车流量的统计可以借助设定矩形区域内的亮度阈值来确定。为识别运动对象（汽车）的状态，可使用背景提取算法，如本软件中使用到的MOG2和KNN算法。通过比较不同算法间的处理时间，我们应当合理选择一种耗时短且提取车辆准确性高的一种算法。此外，识别统计车流量较为重要的一环便是设置合理的亮度阈值，亮度阈值设置的合理性直接关系到车流量统计准确性。</p> 
<h3><a id="_109"></a>附：程序源代码</h3> 
<p><strong>此项目Github地址：</strong> <a href="https://github.com/cwxyr/traffic-detection">https://github.com/cwxyr/traffic-detection</a></p> 
<pre><code class="prism language-cpp"><span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">"stdafx.h"</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;Windows.h&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/core.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/imgproc.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/highgui.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/features2d.hpp&gt;</span></span>
<span class="token macro property">#<span class="token directive keyword">include</span> <span class="token string">&lt;opencv2/video.hpp&gt;</span></span>

<span class="token macro property">#<span class="token directive keyword">ifdef</span> _DEBUG</span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "opencv_world420d.lib") </span>
<span class="token macro property">#<span class="token directive keyword">else</span></span>
<span class="token macro property">#<span class="token directive keyword">pragma</span> comment(lib, "opencv_world420.lib") </span>
<span class="token macro property">#<span class="token directive keyword">endif</span></span>

<span class="token comment">//===【鼠标事件回调函数】===</span>
<span class="token keyword">int</span> detectTHD <span class="token operator">=</span> <span class="token number">900000</span><span class="token punctuation">;</span>		<span class="token comment">//亮度阈值：有车辆经过的；</span>
std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>		myLanneLightSum_Last<span class="token punctuation">;</span>			<span class="token comment">//车道亮度和：上一帧的</span>
std<span class="token operator">::</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span>		myLanneVihicleCnt<span class="token punctuation">;</span>				<span class="token comment">//车道车辆计数器</span>

std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>cv<span class="token operator">::</span>Rect<span class="token operator">&gt;</span>		myLanneRect<span class="token punctuation">;</span>			<span class="token comment">//车道矩形框；显示为红色；</span>
std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>cv<span class="token operator">::</span>Point<span class="token operator">&gt;</span>		myMousePoints<span class="token punctuation">;</span>		<span class="token comment">//鼠标点向量；显示为蓝色；</span>
<span class="token keyword">int</span>	myMouseEventBusy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>							<span class="token comment">//鼠标回调事件忙:简单的资源锁</span>
<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">onMouse</span><span class="token punctuation">(</span><span class="token keyword">int</span> event<span class="token punctuation">,</span> <span class="token keyword">int</span> x<span class="token punctuation">,</span> <span class="token keyword">int</span> y<span class="token punctuation">,</span> <span class="token keyword">int</span> flags<span class="token punctuation">,</span> <span class="token keyword">void</span><span class="token operator">*</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	myMouseEventBusy <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
	cv<span class="token operator">::</span>Point  mPoint<span class="token punctuation">;</span>
	cv<span class="token operator">::</span>Rect mRect<span class="token punctuation">;</span>
	<span class="token keyword">switch</span> <span class="token punctuation">(</span>event<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">case</span> cv<span class="token operator">::</span>EVENT_LBUTTONDOWN<span class="token operator">:</span>		<span class="token comment">//左键按下:增加myMousePoints中的点数</span>
		mPoint <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		myMousePoints<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>mPoint<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//将当前鼠标点推送到向量中；</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>myMousePoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">4</span><span class="token punctuation">)</span>
			myMousePoints<span class="token punctuation">.</span><span class="token function">erase</span><span class="token punctuation">(</span>myMousePoints<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//保证myMousePoints向量中节点数不大于4；</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> cv<span class="token operator">::</span>EVENT_RBUTTONDOWN<span class="token operator">:</span>		<span class="token comment">//右键键按下：将myMousePoints中的4个点推送到矩形框向量myLanneRect</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>myMousePoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">int</span> Xmin <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span> <span class="token keyword">int</span> Ymin <span class="token operator">=</span> <span class="token number">100000</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> Xmax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token keyword">int</span> Ymax <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
			<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				Xmin <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span>Xmin<span class="token punctuation">,</span> myMousePoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
				Ymin <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">min</span><span class="token punctuation">(</span>Ymin<span class="token punctuation">,</span> myMousePoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
				Xmax <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span>Xmax<span class="token punctuation">,</span> myMousePoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
				Ymax <span class="token operator">=</span> std<span class="token operator">::</span><span class="token function">max</span><span class="token punctuation">(</span>Ymax<span class="token punctuation">,</span> myMousePoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token comment">//for k   &lt;&lt;&lt; === 用四个点构成矩形框的参数</span>
			mRect <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">Rect</span><span class="token punctuation">(</span>Xmin<span class="token punctuation">,</span> Ymin<span class="token punctuation">,</span> Xmax <span class="token operator">-</span> Xmin<span class="token punctuation">,</span> Ymax <span class="token operator">-</span> Ymin<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//构成矩形框</span>
			myLanneRect<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>mRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
			myLanneLightSum_Last<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			myLanneVihicleCnt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			myMousePoints<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//清除鼠标点向量</span>

		<span class="token punctuation">}</span><span class="token comment">///if</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token keyword">case</span> cv<span class="token operator">::</span>EVENT_MBUTTONDOWN<span class="token operator">:</span>		<span class="token comment">//中间键键按下：删除myMousePoints中的一个点；myMousePoints为空时，删除myLanneRect中的节点；</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"EVENT_MBUTTONDOWN\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>myMousePoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
			myMousePoints<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			myLanneRect<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			myLanneLightSum_Last<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			myLanneVihicleCnt<span class="token punctuation">.</span><span class="token function">pop_back</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">break</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span><span class="token comment">/switch</span>
myMouseEventBusy <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span> argv<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span> errorMSG<span class="token punctuation">[</span><span class="token number">256</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> curPathName<span class="token punctuation">[</span><span class="token number">384</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span> <span class="token keyword">char</span> curModulerPath<span class="token punctuation">[</span><span class="token number">384</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
	<span class="token function">GetCurrentDirectory</span><span class="token punctuation">(</span><span class="token number">383</span><span class="token punctuation">,</span> curModulerPath<span class="token punctuation">)</span><span class="token punctuation">;</span> 
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Line39: curModulerPath = %s\n"</span><span class="token punctuation">,</span> curModulerPath<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//=======读取标记的矩形框文件内容到myLanneRect：=======</span>
	<span class="token macro property">#<span class="token directive keyword">ifndef</span> READ_RECT_FILE</span>
		FILE <span class="token operator">*</span>pFILE <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"MarkRect.txt"</span><span class="token punctuation">,</span> <span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>pFILE <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			cv<span class="token operator">::</span>Rect  mRect<span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token function">fgets</span><span class="token punctuation">(</span>errorMSG<span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> pFILE<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">int</span> rtn <span class="token operator">=</span> <span class="token function">sscanf</span><span class="token punctuation">(</span>errorMSG<span class="token punctuation">,</span> <span class="token string">"%d %d %d %d"</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>mRect<span class="token punctuation">.</span>x<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mRect<span class="token punctuation">.</span>y<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mRect<span class="token punctuation">.</span>width<span class="token punctuation">,</span> <span class="token operator">&amp;</span>mRect<span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">if</span> <span class="token punctuation">(</span>rtn <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					myLanneRect<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>mRect<span class="token punctuation">)</span><span class="token punctuation">;</span>
					myLanneLightSum_Last<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					myLanneVihicleCnt<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
			<span class="token function">fclose</span><span class="token punctuation">(</span>pFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span><span class="token comment">///if</span>
	<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">// !READ_RECT_FILE</span>

	std<span class="token operator">::</span>string  imgName <span class="token operator">=</span> <span class="token string">"video-02.mp4"</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span> FilePath<span class="token punctuation">[</span><span class="token number">384</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span>curPathName<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span>FilePath<span class="token punctuation">,</span> <span class="token string">"%s\\%s"</span><span class="token punctuation">,</span> curPathName<span class="token punctuation">,</span> imgName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//图片文件路径</span>
	<span class="token keyword">else</span>
		<span class="token function">sprintf</span><span class="token punctuation">(</span>FilePath<span class="token punctuation">,</span> <span class="token string">"%s"</span><span class="token punctuation">,</span> imgName<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//图片文件路径</span>

	<span class="token comment">//==【01】== 打开视频文件或摄像头</span>
		cv<span class="token operator">::</span>VideoCapture cap<span class="token punctuation">;</span> <span class="token comment">//VideoCapture类实例化，使用缺省摄像头</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token number">0</span> <span class="token operator">&amp;&amp;</span> <span class="token string">"UsingCam"</span><span class="token punctuation">)</span>
			cap<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			cap<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>FilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>cap<span class="token punctuation">.</span><span class="token function">isOpened</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// check if we succeeded</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"error#73: 打开设备或文件失败，检查是否存在！回车退出！\n路径=%s\n"</span><span class="token punctuation">,</span> FilePath<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token function">fgets</span><span class="token punctuation">(</span>FilePath<span class="token punctuation">,</span> <span class="token number">127</span><span class="token punctuation">,</span> <span class="token constant">stdin</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		cv<span class="token operator">::</span>Mat frame<span class="token punctuation">,</span> newframe<span class="token punctuation">,</span> greyFrame<span class="token punctuation">,</span> floatFrame<span class="token punctuation">,</span> lastFrame<span class="token punctuation">,</span> frame2<span class="token punctuation">,</span> mog2RES<span class="token punctuation">,</span> KNN<span class="token punctuation">,</span> out_frame<span class="token punctuation">,</span> avgFrame<span class="token punctuation">;</span>
		std<span class="token operator">::</span>vector<span class="token operator">&lt;</span>cv<span class="token operator">::</span>Mat<span class="token operator">&gt;</span> diffIMGvec<span class="token punctuation">;</span>

	<span class="token comment">//==【02】== 创建运动视频背景提取对象：用于分离背景和运动对象</span>
		cv<span class="token operator">::</span>Ptr<span class="token operator">&lt;</span>cv<span class="token operator">::</span>BackgroundSubtractorMOG2<span class="token operator">&gt;</span> bgMOG2 <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">createBackgroundSubtractorMOG2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		cv<span class="token operator">::</span>Ptr<span class="token operator">&lt;</span>cv<span class="token operator">::</span>BackgroundSubtractorKNN<span class="token operator">&gt;</span> bgKNN <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">createBackgroundSubtractorKNN</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bgMOG2<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">setVarThreshold</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">bool</span> update_bg_model <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	<span class="token comment">//==【03】== 命名几个显示窗口</span>
		cv<span class="token operator">::</span><span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"RawWnd"</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cv<span class="token operator">::</span><span class="token function">setMouseCallback</span><span class="token punctuation">(</span><span class="token string">"RawWnd"</span><span class="token punctuation">,</span> onMouse<span class="token punctuation">,</span> <span class="token operator">&amp;</span>newframe<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//设置鼠标事件回调函数（"RawWnd"窗口的）：同时传递彩色图像指针；</span>
		cv<span class="token operator">::</span><span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Out_KNN"</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cv<span class="token operator">::</span><span class="token function">namedWindow</span><span class="token punctuation">(</span><span class="token string">"Out_MOG2"</span><span class="token punctuation">,</span> cv<span class="token operator">::</span>WINDOW_NORMAL<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">int</span> frameNums <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token punctuation">;</span><span class="token punctuation">;</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		frame<span class="token punctuation">.</span>rows <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token keyword">double</span> t1 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>cv<span class="token operator">::</span><span class="token function">getCPUTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//开始统计时间</span>
		cap<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>frame<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>frame<span class="token punctuation">.</span>rows <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		cv<span class="token operator">::</span>Size <span class="token function">newSize</span><span class="token punctuation">(</span>frame<span class="token punctuation">.</span>cols <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> frame<span class="token punctuation">.</span>rows <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//压缩图像，将其尺寸缩小</span>
		cv<span class="token operator">::</span><span class="token function">resize</span><span class="token punctuation">(</span>frame<span class="token punctuation">,</span> newframe<span class="token punctuation">,</span> newSize<span class="token punctuation">)</span><span class="token punctuation">;</span>
		cv<span class="token operator">::</span><span class="token function">cvtColor</span><span class="token punctuation">(</span>newframe<span class="token punctuation">,</span> greyFrame<span class="token punctuation">,</span> cv<span class="token operator">::</span>COLOR_RGB2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//转换为灰度图</span>
		cv<span class="token operator">::</span><span class="token function">blur</span><span class="token punctuation">(</span>greyFrame<span class="token punctuation">,</span> greyFrame<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//使用平滑运算</span>
	
		<span class="token keyword">double</span> t2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>cv<span class="token operator">::</span><span class="token function">getCPUTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bgMOG2<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span>greyFrame<span class="token punctuation">,</span> mog2RES<span class="token punctuation">,</span> update_bg_model <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//使用MOG2算法提取前景</span>
		<span class="token keyword">double</span> t3 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>cv<span class="token operator">::</span><span class="token function">getCPUTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//获取处理时间</span>

		<span class="token keyword">double</span> t4 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>cv<span class="token operator">::</span><span class="token function">getCPUTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		bgKNN<span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">apply</span><span class="token punctuation">(</span>greyFrame<span class="token punctuation">,</span> KNN<span class="token punctuation">,</span> update_bg_model <span class="token operator">?</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//使用KNN算法提取前景</span>
		<span class="token keyword">double</span> t5 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>cv<span class="token operator">::</span><span class="token function">getCPUTickCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//获取处理时间</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"MOG2 Time = %.3fms\n"</span><span class="token punctuation">,</span> <span class="token number">1e0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t3 <span class="token operator">-</span> t2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>cv<span class="token operator">::</span><span class="token function">getTickFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"KNN Time = %.3fms\n"</span><span class="token punctuation">,</span> <span class="token number">1e0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t5 <span class="token operator">-</span> t4<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>cv<span class="token operator">::</span><span class="token function">getTickFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Total Time = %.3fms\n"</span><span class="token punctuation">,</span> <span class="token number">1e0</span> <span class="token operator">*</span> <span class="token punctuation">(</span>t5 <span class="token operator">-</span> t1<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token keyword">double</span><span class="token punctuation">)</span>cv<span class="token operator">::</span><span class="token function">getTickFrequency</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"--------------------\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>mog2RES<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">//计算MOG2算法下矩形框的积分亮度值</span>
		<span class="token punctuation">{<!-- --></span>
			cv<span class="token operator">::</span>Mat showMat<span class="token punctuation">;</span>
			mog2RES<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>showMat<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>myMouseEventBusy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> myLanneRect<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cv<span class="token operator">::</span><span class="token function">rectangle</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					cv<span class="token operator">::</span>Mat subMat <span class="token operator">=</span> <span class="token function">mog2RES</span><span class="token punctuation">(</span>myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//再MOG2的前景提取结果中，取车道标记矩形框区域为subMat矩阵</span>
					cv<span class="token operator">::</span>Mat sumMat<span class="token punctuation">;</span>		<span class="token comment">//积分图 == subMat的积分矩阵</span>
					cv<span class="token operator">::</span><span class="token function">integral</span><span class="token punctuation">(</span>subMat<span class="token punctuation">,</span> sumMat<span class="token punctuation">,</span> CV_32S<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//设置积分矩阵的数据类型为uint；</span>
					<span class="token keyword">int</span> sumValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>rows <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//获取积分图右下角的值，就是矩形框内亮度和；</span>
					<span class="token function">sprintf</span><span class="token punctuation">(</span>errorMSG<span class="token punctuation">,</span> <span class="token string">"sum = %d;"</span><span class="token punctuation">,</span> sumValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
					cv<span class="token operator">::</span><span class="token function">putText</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> errorMSG<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示矩形框内的亮度和；</span>

				<span class="token punctuation">}</span><span class="token comment">//for k</span>
			<span class="token punctuation">}</span><span class="token comment">if</span>
			cv<span class="token operator">::</span><span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Out_MOG2"</span><span class="token punctuation">,</span> showMat<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>

		<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>KNN<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>   <span class="token comment">//计算KNN算法下矩形框的积分亮度值</span>
		<span class="token punctuation">{<!-- --></span>
			cv<span class="token operator">::</span>Mat showMat<span class="token punctuation">;</span>
			KNN<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>showMat<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>myMouseEventBusy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> myLanneRect<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>

					cv<span class="token operator">::</span><span class="token function">rectangle</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					cv<span class="token operator">::</span>Mat subMat <span class="token operator">=</span> <span class="token function">KNN</span><span class="token punctuation">(</span>myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//再KNN的前景提取结果中，取车道标记矩形框区域为subMat矩阵</span>
					cv<span class="token operator">::</span>Mat sumMat<span class="token punctuation">;</span>		<span class="token comment">//积分图 == subMat的积分矩阵</span>
					cv<span class="token operator">::</span><span class="token function">integral</span><span class="token punctuation">(</span>subMat<span class="token punctuation">,</span> sumMat<span class="token punctuation">,</span> CV_32S<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//设置积分矩阵的数据类型为uint；</span>
					<span class="token keyword">int</span> sumValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>rows <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//获取积分图右下角的值，就是矩形框内亮度和；</span>
					<span class="token function">sprintf</span><span class="token punctuation">(</span>errorMSG<span class="token punctuation">,</span> <span class="token string">"sum = %d;"</span><span class="token punctuation">,</span> sumValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
					cv<span class="token operator">::</span><span class="token function">putText</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> errorMSG<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示矩形框内的亮度和；</span>
				<span class="token punctuation">}</span><span class="token comment">//for k</span>
			<span class="token punctuation">}</span><span class="token comment">if</span>
			<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"Out_KNN"</span><span class="token punctuation">,</span> showMat<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>			

		<span class="token comment">//===&gt;&gt;&gt; 显示原始图像：显示车道标记信息 + 矩形框内亮度和 + 车流量统计</span>
		<span class="token macro property">#<span class="token directive keyword">ifndef</span> SHOW_RAW_MAT</span>
			cv<span class="token operator">::</span>Mat showMat<span class="token punctuation">;</span>
			newframe<span class="token punctuation">.</span><span class="token function">copyTo</span><span class="token punctuation">(</span>showMat<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//矩阵复制</span>
			<span class="token function">sprintf</span><span class="token punctuation">(</span>errorMSG<span class="token punctuation">,</span> <span class="token string">"mL=add Point; mR=add Rect; mM=delete Point;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			cv<span class="token operator">::</span><span class="token function">putText</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> errorMSG<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示提示信息；</span>
			<span class="token comment">//==&gt;&gt; 显示车道矩形框为红色 + 车流量统计 + 车流量显示</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>myMouseEventBusy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> myLanneRect<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cv<span class="token operator">::</span><span class="token function">rectangle</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					cv<span class="token operator">::</span>Mat subMat <span class="token operator">=</span> <span class="token function">mog2RES</span><span class="token punctuation">(</span>myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//再MOG2的前景提取结果中，取车道标记矩形框区域为subMat矩阵</span>
					cv<span class="token operator">::</span>Mat sumMat<span class="token punctuation">;</span>		<span class="token comment">//积分图 == subMat的积分矩阵</span>
					cv<span class="token operator">::</span><span class="token function">integral</span><span class="token punctuation">(</span>subMat<span class="token punctuation">,</span> sumMat<span class="token punctuation">,</span> CV_32S<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//设置积分矩阵的数据类型为int，计算车道矩形框内亮度积分图；</span>
					<span class="token keyword">int</span> sumValue <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>at<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>rows <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span>sumMat<span class="token punctuation">.</span>cols <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//获取积分图右下角的值，就是矩形框内亮度和；</span>
					<span class="token function">sprintf</span><span class="token punctuation">(</span>errorMSG<span class="token punctuation">,</span> <span class="token string">"sum = %d;"</span><span class="token punctuation">,</span> sumValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
					cv<span class="token operator">::</span><span class="token function">putText</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> errorMSG<span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span>myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>y <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示矩形框内的亮度和；</span>
					<span class="token comment">//===&gt;&gt;&gt; 车流量统计：</span>
					<span class="token keyword">if</span> <span class="token punctuation">(</span>myLanneLightSum_Last<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">&gt;</span> detectTHD <span class="token operator">&amp;&amp;</span> sumValue <span class="token operator">&lt;=</span> detectTHD<span class="token punctuation">)</span>
					<span class="token punctuation">{<!-- --></span>
						<span class="token comment">//:: 车辆通过了矩形框：上一帧亮度和大于阈值，本帧亮度和小于阈值；车辆计数器自加；</span>
						myLanneVihicleCnt<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token operator">++</span><span class="token punctuation">;</span>
						myLanneLightSum_Last<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> sumValue<span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> 
						myLanneLightSum_Last<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span> <span class="token operator">=</span> sumValue<span class="token punctuation">;</span>  <span class="token comment">//存储当前亮度和到myLanneLightSum_Last				</span>
				<span class="token punctuation">}</span><span class="token comment">//for k</span>

				<span class="token comment">//===&gt;&gt; 车流量统计结果显示</span>
				cv<span class="token operator">::</span>Mat topareaMat <span class="token operator">=</span> <span class="token function">showMat</span><span class="token punctuation">(</span>cv<span class="token operator">::</span><span class="token function">Rect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> showMat<span class="token punctuation">.</span>cols<span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//最顶部48行置0；</span>
				topareaMat <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">255</span><span class="token punctuation">;</span>

				std<span class="token operator">::</span>string strVihicleCnt <span class="token operator">=</span> <span class="token string">"VihicleCnt: "</span><span class="token punctuation">;</span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> myLanneRect<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					<span class="token function">sprintf</span><span class="token punctuation">(</span>errorMSG<span class="token punctuation">,</span> <span class="token string">"L%d = %d;"</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> myLanneVihicleCnt<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					strVihicleCnt <span class="token operator">+</span><span class="token operator">=</span> errorMSG<span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				cv<span class="token operator">::</span><span class="token function">putText</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> strVihicleCnt<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0.2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//流量统计显示到彩色图片上</span>

			<span class="token punctuation">}</span><span class="token comment">if</span>
			 <span class="token comment">//==&gt;&gt; 显示正在标记的坐标点为蓝色：</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>myMouseEventBusy <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> myMousePoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span>
				<span class="token punctuation">{<!-- --></span>
					cv<span class="token operator">::</span><span class="token function">line</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> myMousePoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> myMousePoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token comment">//for k</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>myMousePoints<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
					cv<span class="token operator">::</span><span class="token function">line</span><span class="token punctuation">(</span>showMat<span class="token punctuation">,</span> myMousePoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> myMousePoints<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cv<span class="token operator">::</span><span class="token function">Scalar</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token comment">if</span>

			<span class="token function">imshow</span><span class="token punctuation">(</span><span class="token string">"RawWnd"</span><span class="token punctuation">,</span> showMat<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">// SHOW_RAW_MAT</span>
		<span class="token keyword">int</span> keycode <span class="token operator">=</span> cv<span class="token operator">::</span><span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//等待100ms</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>keycode <span class="token operator">==</span> <span class="token string">'q'</span><span class="token punctuation">)</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keycode <span class="token operator">==</span> <span class="token string">' '</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			update_bg_model <span class="token operator">=</span> <span class="token operator">!</span>update_bg_model<span class="token punctuation">;</span>
			<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Learn background is in state = %d\n"</span><span class="token punctuation">,</span> update_bg_model<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>keycode <span class="token operator">==</span> <span class="token string">'w'</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//写文件：记录标记的矩形框到文件中：</span>
			<span class="token macro property">#<span class="token directive keyword">ifndef</span> WRITE_RECT_FILE</span>
			FILE <span class="token operator">*</span>pFILE <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"MarkRect.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">if</span> <span class="token punctuation">(</span>pFILE <span class="token operator">!=</span> <span class="token constant">NULL</span><span class="token punctuation">)</span>
			<span class="token punctuation">{<!-- --></span>
				<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> k <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> myLanneRect<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					<span class="token function">fprintf</span><span class="token punctuation">(</span>pFILE<span class="token punctuation">,</span> <span class="token string">"%d %d %d %d\n"</span><span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>x<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>y<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">,</span> myLanneRect<span class="token punctuation">.</span><span class="token function">at</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">.</span>height<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token function">fclose</span><span class="token punctuation">(</span>pFILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token comment">///if</span>
			<span class="token macro property">#<span class="token directive keyword">endif</span> </span><span class="token comment">// !WRITE_RECT_FILE</span>

		<span class="token punctuation">}</span>
		frameNums<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token comment">//for </span>
	cap<span class="token punctuation">.</span><span class="token function">release</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78639d94ec46c800fbd12a614bcaf6a0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Visual Studio 开发入门</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b9be456417b748cdf1285b2a746899d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SpringBoot2.* GateWay网关中关闭security验证</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>