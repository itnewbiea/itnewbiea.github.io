<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>stm32蜂鸣器实现电子琴（原理&#43;代码） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="stm32蜂鸣器实现电子琴（原理&#43;代码）" />
<meta property="og:description" content="许久没有摸32了，今天是培训的第一天，做个电子琴练练手。
编程难度很小，无非就是gpio控制引脚高低电平转换，比较值得注意的主要是一些乐理上的知识。
我们能听到的1 2 3 4 5 6 7的音符，实际上是一个个固定的频率，这个具体算我也不懂，问巴赫去吧
总而言之，通过百度，我找到了对照图
那怎么转换这个频率捏，首先来看一下频率单位——赫兹（hz）的定义：
赫兹是国际单位制中频率的单位，它是每秒钟的周期性变动重复次数的计量。
赫兹简称赫。每秒钟振动（或振荡、波动）一次为1赫兹，或可写成次/秒，周/秒。
（摘自百度百科）
这么理解，1赫兹就是一秒震动一次，而图中的高音1就是一秒震动880次。
在单片机里，想让蜂鸣器发出高音1就是一秒高低电平转换880次。
每次震动可以这么写：
GPIO_SetBits(GPIOF,GPIO_Pin_8); delay_us(5); GPIO_ResetBits(GPIOF,GPIO_Pin_8); delay_us(5); 这里就是一个50%的pwm波，记住这是一次频率转换，（博主一开始就把pwm波和频率的概念搞混了）而占空比的变化，反应的是声音的强度，占空比越大，蜂鸣器发出的声音越响。
那880hz举例子，如果我们要让蜂鸣器响高音1一秒钟，那就意味着要转换电平880次，而且，每次转换要均匀分布在1秒内，所以我们要在一秒内分割出880个时间周期，即1s/880=1136us（取整）
而这包含前面的10us，所以一次时间周期应该是这样的：
GPIO_SetBits(GPIOF,GPIO_Pin_8); delay_us(5); GPIO_ResetBits(GPIOF,GPIO_Pin_8); delay_us(5); delay_us(1136); 事实上，无论是多少秒，只要在这个时间周期内执行这段指令，蜂鸣器都会发出高音1的音调。
以下是函数代码
double connect[3][7]={{880,987.76,1108.73,1174.66,1318.52,1479.98,1661.22},{440,493.88,554.37,587.33,659.33,739.99,830.61},{220,246.94,277.19,293.67,329.63,370,415.31}}; //创建二位数组存放频率数据 void yinjie(int mst, int f,int h)//第一个参数为响的时间（ms），第二个参数确定音阶 { int t=(int)1000000.0/connect[h-1][f-1]-10;//计算时间间隔 int n=mst*1000;//转微秒 while(n&gt;0)//响的时间每次循环减去时间间隔，小于0时跳出 { GPIO_SetBits(GPIOF,GPIO_Pin_8); delay_us(5); GPIO_ResetBits(GPIOF,GPIO_Pin_8); delay_us(5); delay_us(t); n-=t&#43;10; } GPIO_ResetBits(GPIOF,GPIO_Pin_8); delay_ms(100); } gpio初始化
void Init(){ //gpio初始化 GPIO_InitTypeDef GPIO_InitStructure; RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOF, ENABLE);//使能GPIOF时钟 //初始化蜂鸣器对应引脚GPIOF8 GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8;//BEEP对应引脚 GPIO_InitStructure." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b38fd4664fd140ca83a85e532596b86a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-25T17:09:57+08:00" />
<meta property="article:modified_time" content="2022-06-25T17:09:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">stm32蜂鸣器实现电子琴（原理&#43;代码）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>许久没有摸32了，今天是培训的第一天，做个电子琴练练手。</p> 
<p>编程难度很小，无非就是gpio控制引脚高低电平转换，比较值得注意的主要是一些乐理上的知识。</p> 
<p>我们能听到的1 2 3 4 5 6 7的音符，实际上是一个个固定的频率，这个具体算我也不懂，问巴赫去吧</p> 
<p>总而言之，通过百度，我找到了对照图</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/6a/b2/TRbNYLnA_o.png"></p> 
<p> 那怎么转换这个频率捏，首先来看一下频率单位——赫兹（hz）的定义：</p> 
<p>赫兹是国际单位制中频率的单位，它是每秒钟的周期性变动重复次数的计量。<br> 赫兹简称赫。每秒钟振动（或振荡、波动）一次为1赫兹，或可写成次/秒，周/秒。</p> 
<p>（摘自百度百科）</p> 
<p>这么理解，1赫兹就是一秒震动一次，而图中的高音1就是一秒震动880次。</p> 
<p><span style="color:#fe2c24;">在单片机里，想让蜂鸣器发出高音1就是一秒高低电平转换880次。</span></p> 
<p>每次震动可以这么写：</p> 
<pre><code>GPIO_SetBits(GPIOF,GPIO_Pin_8);
delay_us(5);
GPIO_ResetBits(GPIOF,GPIO_Pin_8);
delay_us(5);</code></pre> 
<p>这里就是一个50%的pwm波，记住这是一次频率转换，（博主一开始就把pwm波和频率的概念搞混了）而占空比的变化，反应的是声音的强度，占空比越大，蜂鸣器发出的声音越响。</p> 
<p></p> 
<p>那880hz举例子，如果我们要让蜂鸣器响高音1一秒钟，那就意味着要转换电平880次，而且，<span style="color:#fe2c24;">每次转换要均匀分布在1秒内</span><span style="color:#0d0016;">，所以我们要在一秒内分割出880个时间周期，即1s/880=1136us（取整）</span></p> 
<p><span style="color:#0d0016;">而这包含前面的10us，所以一次时间周期应该是这样的：</span></p> 
<pre><code>GPIO_SetBits(GPIOF,GPIO_Pin_8);
delay_us(5);
GPIO_ResetBits(GPIOF,GPIO_Pin_8);
delay_us(5);
delay_us(1136);</code></pre> 
<p>事实上，无论是多少秒，只要在这个时间周期内执行这段指令，蜂鸣器都会发出高音1的音调。</p> 
<p>以下是函数代码</p> 
<pre><code>double connect[3][7]={<!-- -->{880,987.76,1108.73,1174.66,1318.52,1479.98,1661.22},{440,493.88,554.37,587.33,659.33,739.99,830.61},{220,246.94,277.19,293.67,329.63,370,415.31}};
//创建二位数组存放频率数据
void yinjie(int mst, int f,int h)//第一个参数为响的时间（ms），第二个参数确定音阶
{
	int t=(int)1000000.0/connect[h-1][f-1]-10;//计算时间间隔
	int n=mst*1000;//转微秒
	while(n&gt;0)//响的时间每次循环减去时间间隔，小于0时跳出
	{
		GPIO_SetBits(GPIOF,GPIO_Pin_8);
				delay_us(5);
		GPIO_ResetBits(GPIOF,GPIO_Pin_8);
				delay_us(5);
		delay_us(t);
		n-=t+10;
		
	}
	GPIO_ResetBits(GPIOF,GPIO_Pin_8);
			delay_ms(100);
		
		
}</code></pre> 
<p>gpio初始化</p> 
<pre><code>void Init(){
	//gpio初始化
	GPIO_InitTypeDef  GPIO_InitStructure;

  RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOF, ENABLE);//使能GPIOF时钟
  
  //初始化蜂鸣器对应引脚GPIOF8
  GPIO_InitStructure.GPIO_Pin = GPIO_Pin_8;//BEEP对应引脚
  GPIO_InitStructure.GPIO_Mode = GPIO_Mode_OUT;//普通输出模式
  GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;//推挽输出
  GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;//100MHz
  GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_DOWN;//下拉
  GPIO_Init(GPIOF, &amp;GPIO_InitStructure);//初始化GPIO
	
  GPIO_ResetBits(GPIOF,GPIO_Pin_8);  //蜂鸣器对应引脚GPIOF8拉低</code></pre> 
<p>main（生日快乐歌）</p> 
<pre><code>int main(void)
{
	u32 t=0;
	int i;
	Init();
	delay_init(84);

	
  while(1){
		yinjie(400,5,3);
		yinjie(400,5,3);
		yinjie(800,6,3);
		yinjie(800,5,3);
		yinjie(800,1,2);
		yinjie(800,7,3);
		
		yinjie(400,5,3);
		yinjie(400,5,3);
		yinjie(800,6,3);
		yinjie(800,5,3);
		yinjie(800,2,2);
		yinjie(800,1,2);
		
		yinjie(400,5,3);
		yinjie(400,5,3);
		yinjie(400,5,2);
		yinjie(400,3,2);
		yinjie(800,1,2);
		yinjie(800,7,3);
		yinjie(800,6,3);
		
		yinjie(400,4,2);
		yinjie(400,4,2);
		yinjie(400,3,2);
		yinjie(800,1,2);
		yinjie(800,2,2);
		yinjie(800,1,2);
	}</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/33fa889080f9328593fd9e01453e768d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">单片机控制光耦开关继而控制电机转动</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/614618c260abbbb1fd319298a5577b87/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android中Parcelable的原理和使用方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>