<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>高通 Android 12 framework添加自定义按键上报应用层 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="高通 Android 12 framework添加自定义按键上报应用层" />
<meta property="og:description" content="Android下添加新的自定义键值和按键处理流程
首先分析下Android下怎么添加新的自定义键值。在Android的原生系统中键值默认情况下是92个，从0-91；一般情况下，这些键值是够用的，但是如果想扩充的话，还是需要添加新的键值的，那么如何将一个新的键值从驱动的设置映射到上层，使应用可以对我们自定义的键值进行相应的处理呢？
在介绍Android怎么添加新的键值以前先介绍下Android下INPUT子系统FLOW的流程，下面就是精简的流程图示意图：
1.添加按键及其映射
1)如果系统有新的按键需要添加，是怎么添加并上报到系统上层去的呢(这里的上层主要指的是Android应用层)，首先要确定的是我们的遥控设备是通过/dev/input目录下那个event调用那个kl文件，这里可以通过如下命令查看cat /proc/bus/input/devices,下面是在Window终端下的打印信息
2)getevent -p得到以下数据信息 3）命令查看如下 通过getevent查看驱动调节的按键值是否上传ok。adb shell getevent 驱动上报O按键键值 如下图所示 0259是16进制数 对应10进制601 1，0: 是指按下和弹起的动作。
Kernel修改
2、在qssi11/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi 中增加相关内容[key]: 添加方向键（上、下、左、右）、X/O 键、确认键、主页键、菜单键
diff --git a/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi b/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi index a6398b6..9de20ea 100755 --- a/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi &#43;&#43;&#43; b/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi @@ -148,6 &#43;148,31 @@ }; }; */ &#43; tlmm_gpio_key { &#43; gpio_key_em_active: gpio_key_em_active { &#43; mux { &#43; pins = &#34;gpio160&#34;, &#34;gpio161&#34;, &#34;gpio164&#34;, &#34;gpio165&#34;, &#34;gpio166&#34;, &#34;gpio167&#34;, &#34;gpio168&#34;, &#34;gpio169&#34;; &#43; function = &#34;gpio&#34;; &#43; }; &#43; config { &#43; pins = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d31f6ddc08806a8cea1f2e44d0426d61/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-14T11:52:16+08:00" />
<meta property="article:modified_time" content="2023-09-14T11:52:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">高通 Android 12 framework添加自定义按键上报应用层</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#000000;">Android下添加新的自定义键值和按键处理流程</span></span></strong></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#000000;">       首先分析下Android下怎么添加新的自定义键值。在Android的原生系统中键值默认情况下是92个，从0-91；一般情况下，这些键值是够用的，但是如果想扩充的话，还是需要添加新的键值的，那么如何将一个新的键值从驱动的设置映射到上层，使应用可以对我们自定义的键值进行相应的处理呢？</span></span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#000000;">    在介绍Android怎么添加新的键值以前先介绍下Android下INPUT子系统FLOW的流程，下面就是精简的流程图示意图：</span></span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="382" src="https://images2.imgbox.com/49/d6/4cNxkL1H_o.png" width="443"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="background-color:#ffffff;"><span style="color:#000000;"> </span></span><strong><span style="background-color:#ffffff;"><span style="color:#000000;">1.添加按键及其映射</span></span></strong></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><strong><span style="background-color:#ffffff;"><span style="color:#000000;">1)</span></span></strong><span style="background-color:#ffffff;"><span style="color:#000000;">如果系统有新的按键需要添加，是怎么添加并上报到系统上层去的呢(这里的上层主要指的是Android应用层)，首先要确定的是我们的遥控设备是通过/dev/input目录下那个event调用那个kl文件，这里可以通过如下命令查看cat /proc/bus/input/devices,下面是在Window终端下的打印信息</span></span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="493" src="https://images2.imgbox.com/0c/ad/EsNuP1O6_o.png" width="554"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="text-align:left;"><span style="background-color:#ffffff;"><strong>2)</strong>getevent -p得到以下数据信息 </span></p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="376" src="https://images2.imgbox.com/84/61/bQhbOgie_o.png" width="554"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>3）</strong></strong>命令查看如下 通过getevent查看驱动调节的按键值是否上传ok。adb shell getevent 驱动上报O按键键值 如下图所示 0259是16进制数 对应10进制601  <strong><span style="color:#ff0000;"><strong>1，0:</strong></span></strong> 是指按下和弹起的动作。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="195" src="https://images2.imgbox.com/19/2c/qODefVIh_o.png" width="554"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;"><strong>Kernel</strong></span></strong><strong><strong>修改</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">2、在qssi11/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi 中增加相关内容[key]: 添加方向键（上、下、左、右）、X/O 键、确认键、主页键、菜单键</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<pre><code class="language-java">diff --git a/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi b/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi
index a6398b6..9de20ea 100755
--- a/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi
+++ b/LINUX/android/vendor/qcom/proprietary/devicetree-4.19/qcom/kona-pinctrl.dtsi
@@ -148,6 +148,31 @@
                        };
                };
 */
+               tlmm_gpio_key {
+                       gpio_key_em_active: gpio_key_em_active {
+                    mux {
+                            pins = "gpio160", "gpio161", "gpio164", "gpio165", "gpio166", "gpio167", "gpio168", "gpio169";
+                            function = "gpio";
+                    };
+                    config {
+                            pins = "gpio160", "gpio161", "gpio164", "gpio165", "gpio166", "gpio167", "gpio168", "gpio169";
+                            drive-strength = &lt;4&gt;;
+                            bias-pull-up;
+                    };
+            };
+            gpio_key_em_suspend: gpio_key_em_suspend {
+                    mux {
+                            pins = "gpio160", "gpio161", "gpio164", "gpio165", "gpio166", "gpio167", "gpio168", "gpio169";
+                            function = "gpio";
+                    };
+                    config {
+                            pins = "gpio160", "gpio161", "gpio164", "gpio165", "gpio166", "gpio167", "gpio168", "gpio169";
+                            drive-strength = &lt;2&gt;;
+                            bias-pull-up;
+                    };
+            };
+               };
+
                trigout_a: trigout_a {
                        mux {
:</code></pre> 
<p style="text-align:left;"></p> 
<h4 style="margin-left:0pt;text-align:left;"><span style="background-color:#ffffff;"><strong><strong><span style="color:#ff0000;"><strong> framework</strong></span></strong><strong><span style="color:#000000;"><strong>修改</strong></span></strong></strong></span></h4> 
<h4 style="margin-left:0pt;text-align:left;"><span style="background-color:#ffffff;"><strong><strong><span style="color:#ff0000;"><strong>注意：需要注意 gpio 在其他地方的引用，这个会引起冲突。</strong></span></strong></strong></span></h4> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">3、QSSI12/device/qcom/qssi/gpio-keys.kl中增加键盘扫描码对应的键盘码key值X/O,600/601</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="164" src="https://images2.imgbox.com/27/45/3546TQS8_o.png" width="554"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">4、在QSSI12/frameworks/base/data/keyboards/Generic.kl中增加X/O按键 如下所示</p> 
<pre><code class="language-java">
 git diff frameworks/base/data/keyboards/Generic.kl
diff --git a/QSSI12/frameworks/base/data/keyboards/Generic.kl b/QSSI12/frameworks/base/data/keyboards/Generic.kl
index bd0e56a..e4eb2ae 100644
--- a/QSSI12/frameworks/base/data/keyboards/Generic.kl
+++ b/QSSI12/frameworks/base/data/keyboards/Generic.kl
@@ -410,6 +410,9 @@ key 580   APP_SWITCH
 key 582   VOICE_ASSIST
 # Linux KEY_ASSISTANT
 key 583   ASSIST
+# ZM ADD KEY X O
+key 158   KEY_BACK(X键目前BACK键替换）
+key 601   KEY_EM_O

</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">5、在 QSSI12/frameworks/native/include/android/keycodes.h路径中增加内容如下</p> 
<pre><code class="language-java">--- a/QSSI12/frameworks/native/include/android/keycodes.h
+++ b/QSSI12/frameworks/native/include/android/keycodes.h
@@ -776,7 +776,11 @@ enum {
     AKEYCODE_THUMBS_DOWN = 287,
     /** Used to switch current account that is consuming content.
      * May be consumed by system to switch current viewer profile. */
-    AKEYCODE_PROFILE_SWITCH = 288
+    AKEYCODE_PROFILE_SWITCH = 288,
+         /** add custom key X */
+    AKEYCODE_KEY_EM_O = 289, 
     // NOTE: If you add a new keycode here you must also add it to several other files.
     //       Refer to frameworks/base/core/java/android/view/KeyEvent.java for the full list.</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">6、在Android 12目录下 QSSI12/frameworks/native/libs/input/InputEventLabels.cpp 将上面的宏展开就是 {<!-- --><strong><span style="color:#ff0000;"><strong>KEY_EM_O， AKEYCODE_KEY_EM_O</strong></span></strong> }</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">其中KEY_EM_O对应上面定制的字符串</span></p> 
<p style="text-align:left;">     <span style="background-color:#f8f8f8;"><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;">QSSI12/frameworks/</span></span><span style="background-color:#f8f8f8;"><span style="color:#a626a4;">native</span></span><span style="background-color:#f8f8f8;"><span style="color:#5c5c5c;">/libs/input/InputEventLabels.cpp</span></span></span></p> 
<pre><code class="language-java">@@ -314,7 +314,10 @@ namespace android {
     DEFINE_KEYCODE(REFRESH), \
     DEFINE_KEYCODE(THUMBS_UP), \
     DEFINE_KEYCODE(THUMBS_DOWN), \
-    DEFINE_KEYCODE(PROFILE_SWITCH)
+    DEFINE_KEYCODE(PROFILE_SWITCH), \
+    DEFINE_KEYCODE(KEY_EM_O)
 
 // NOTE: If you add a new axis here you must also add it to several other files.
 //       Refer to frameworks/base/core/java/android/view/MotionEvent.java for the full list.</code></pre> 
<p style="text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">7、</p> 
<p style="margin-left:.0001pt;text-align:justify;">高通Android 10/11目录 LINUX/android/frameworks/native/include/input<strong><span style="color:#ff0000;"><strong>/InputEventLabels.h添加</strong></span></strong><strong><strong>DEFINE_KEYCODE 增加X/O按键映射</strong></strong></p> 
<pre><code class="language-java">static const InputEventLabel KEYCODES[] = {

    // NOTE: If you add a new keycode here you must also add it to several other files.

    //       Refer to frameworks/base/core/java/android/view/KeyEvent.java for the full list.

    DEFINE_KEYCODE(UNKNOWN),

    DEFINE_KEYCODE(SOFT_LEFT),

    ......

    DEFINE_KEYCODE(PROFILE_SWITCH),

    DEFINE_KEYCODE(KEY_EM_O),

    { nullptr, 0 }

};</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">8、在QSSI12/frameworks/base/core/java/android/view/KeyEvent.java 增加X/O按键<span style="background-color:#ffffff;"><span style="color:#000000;"> 经过如上的步骤就将"123"按键和Android系统中的</span></span>KEYCODE_KEY_EM_X<span style="background-color:#ffffff;"><span style="color:#000000;">就对应起来，注意这里的"</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">600</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">键值并不是真正意义上的</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">600</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">键值，他只是linux驱动向上层抛出的键值。</span></span></p> 
<pre><code class="language-java">--- a/QSSI12/frameworks/base/core/java/android/view/KeyEvent.java
+++ b/QSSI12/frameworks/base/core/java/android/view/KeyEvent.java
@@ -831,6 +831,9 @@ public class KeyEvent extends InputEvent implements Parcelable {
      */
     public static final int KEYCODE_PROFILE_SWITCH = 288;
 
+       /** add by zm 2023/04/11*/
+    public static final int KEYCODE_KEY_EM_O = 289;     /**
      * Integer value of the last KEYCODE. Increases as new keycodes are added to KeyEvent.
      * @hide
@@ -1977,6 +1980,9 @@ public class KeyEvent extends InputEvent implements Parcelable {
             case KeyEvent.KEYCODE_SYSTEM_NAVIGATION_DOWN:
             case KeyEvent.KEYCODE_SYSTEM_NAVIGATION_LEFT:
             case KeyEvent.KEYCODE_SYSTEM_NAVIGATION_RIGHT:
+            case KeyEvent.KEYCODE_KEY_EM_O:
+
                 return true;
         }</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000000;">9、对应上层KeyEvent.java里面映射KEYCODE值</span></span></p> 
<pre><code class="language-java">--- a/QSSI12/frameworks/base/core/res/res/values/attrs.xml
+++ b/QSSI12/frameworks/base/core/res/res/values/attrs.xml
@@ -1984,6 +1984,9 @@
         &lt;enum name="KEYCODE_THUMBS_UP" value="286" /&gt;
         &lt;enum name="KEYCODE_THUMBS_DOWN" value="287" /&gt;
         &lt;enum name="KEYCODE_PROFILE_SWITCH" value="288" /&gt;
+        &lt;enum name="KEYCODE_KEY_EM_O" value="289" /&gt;
     &lt;/attr&gt;
 
     &lt;!-- ***************************************************************** --&gt;</code></pre> 
<p style="text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">10、最后在PhoneWindowManager增打开<strong><span style="background-color:#ffffff;"><span style="color:#ff0000;"><strong>DEBUG_INPUT</strong></span></span></strong>日志开关 如下代码所示</p> 
<pre><code class="language-java">--- a/QSSI12/frameworks/base/services/core/java/com/android/server/policy/PhoneWindowManager.java
+++ b/QSSI12/frameworks/base/services/core/java/com/android/server/policy/PhoneWindowManager.java
@@ -240,7 +240,7 @@ import java.util.HashSet;
 public class PhoneWindowManager implements WindowManagerPolicy {
     static final String TAG = "WindowManager";
     static final boolean localLOGV = false;
-    static final boolean DEBUG_INPUT = false;
+    static final boolean DEBUG_INPUT = true;
     static final boolean DEBUG_KEYGUARD = false;
     static final boolean DEBUG_SPLASH_SCREEN = false;
     static final boolean DEBUG_WAKEUP = false;
@@ -2604,6 +2604,8 @@ public class PhoneWindowManager implements WindowManagerPolicy {
         if (DEBUG_INPUT) {
             Log.d(TAG, "interceptKeyTi keyCode=" + keyCode + " down=" + down + " repeatCount="
                     + repeatCount + " keyguardOn=" + keyguardOn + " canceled=" + canceled);
+                        Log.d("ZM", "interceptKeyBeforeDispatching KeyEvent="+event.toString());
+
         }
 
         if (mKeyCombinationManager.isKeyConsumed(event)) {
@@ -3448,6 +3450,7 @@ public class PhoneWindowManager implements WindowManagerPolicy {
             Log.d(TAG, "interceptKeyTq keycode=" + keyCode
                     + " interactive=" + interactive + " keyguardActive=" + keyguardActive
                     + " policyFlags=" + Integer.toHexString(policyFlags));
+                                       Log.d("ZM", "interceptKeyBeforeQueueing KeyEvent="+event.toString());
         }


Log.d("ZM", "interceptKeyBeforeQueueing KeyEvent="+event.toString())



Log.d("ZM", "interceptKeyBeforeDispatching KeyEvent="+event.toString())</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">11、编译之前执行 最后执行指令更新下api，再触发编译</p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<pre><code class="language-java">make update-api

/frameworks/base/api/current.txt（qssi11路径）QSSI12 frameworks/base/core/api/current.txt

git diff frameworks/base/core/api/current.txt
diff --git a/QSSI12/frameworks/base/core/api/current.txt b/QSSI12/frameworks/base/core/api/current.txt
index 1dd401d..c8ad206 100644
--- a/QSSI12/frameworks/base/core/api/current.txt
+++ b/QSSI12/frameworks/base/core/api/current.txt
@@ -47609,6 +47609,8 @@ package android.view {
     field public static final int KEYCODE_K = 39; // 0x27
     field public static final int KEYCODE_KANA = 218; // 0xda
     field public static final int KEYCODE_KATAKANA_HIRAGANA = 215; // 0xd7
+    field public static final int KEYCODE_KEY_EM_O = 289; // 0x121
     field public static final int KEYCODE_L = 40; // 0x28
     field public static final int KEYCODE_LANGUAGE_SWITCH = 204; // 0xcc
     field public static final int KEYCODE_LAST_CHANNEL = 229; // 0xe5</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><span style="color:#ff0000;"><strong>注意事项:</strong></span></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<ol><li style="text-align:justify;">防止<strong><span style="background-color:#d9d9d9;"><span style="color:#ff0000;"><strong>冲突</strong></span></span></strong>或者<strong><span style="color:#ff0000;"><strong>遗漏</strong></span></strong>最好在QSSI12目录下搜索所有Generic.kl文件find -name ‘Generic.kl’ </li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">QSSI12/device/google/atv/Generic.kl</p> 
<p style="margin-left:.0001pt;text-align:justify;">QSSI12/device/amlogic/yukawa/input/Generic.kl</p> 
<p style="margin-left:.0001pt;text-align:justify;">QSSI12/frameworks/base/data/keyboards/Generic.kl</p> 
<p style="margin-left:.0001pt;text-align:justify;">QSSI12/cts/tests/tests/view/res/raw/Generic.kl</p> 
<p style="margin-left:.0001pt;text-align:justify;">最后编译产物out/target/product/qssi/system/usr/keylayout/Generic.kl</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<ol><li style="text-align:justify;">编译之前执行 最后执行指令更新下api，再触发编译</li><li style="text-align:justify;">make update-api</li><li style="text-align:justify;">/frameworks/base/api/current.txt</li><li style="text-align:justify;">(qssi11路径）QSSI12 frameworks/base/core/api/current.txt</li></ol> 
<p style="margin-left:0;text-align:left;">3、调试可打开以下库文件的开关</p> 
<p style="margin-left:0;text-align:left;">3.1 \frameworks\native\libs\input</p> 
<p style="margin-left:0;text-align:left;">3.2 \frameworks\native\services\inputflinger</p> 
<p style="margin-left:0;text-align:left;">3.3 .  adb shell dumpsys input 查看现有输入系统</p> 
<p style="margin-left:0;text-align:left;">3. 4 adb shell getevent 可查看现有的输入事件</p> 
<p style="margin-left:0;text-align:left;">3.5 在/system/usr/keylayout中还有很多Vendor_xxxx_Product_xxxx.kl 之类的配置文件，但是我们没有配置对应的vend id等，所以一直使用默认的Generic.kl。</p> 
<p style="margin-left:.0001pt;text-align:justify;">其他编译异常：</p> 
<p style="margin-left:.0001pt;text-align:justify;">1、QSSI12/frameworks/native/libs/input/InputEventLabels.cpp 出现空格其他字</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">解决方案:去掉<strong><span style="color:#ff0000;"><strong>空格</strong></span></strong>其他<strong><span style="color:#ff0000;"><strong>斜杠字符转义</strong></span></strong>重新编译即可 用编译器修改最好不要用内部编辑器出现编码不一致问题（VSCode/<a href="https://blog.csdn.net/gengyiping18/article/details/123636237" title="NodePad++">NodePad++</a>)</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">2、出现KeyCode Unknown 检查<strong><span style="color:#ff0000;"><strong>QSSI12/device/qcom/qssi</strong></span></strong><strong><span style="color:#ff0000;"><strong>/</strong></span></strong><strong><span style="color:#ff0000;"><strong>gpio-keys.kl</strong></span></strong>中增加键盘扫描码对应的键盘码 是否添加，如果没有新增示例如下</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">3、其他相关参考文章</p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="https://blog.csdn.net/lxp_p666/article/details/121342435?spm=1001.2101.3001.6650.3&amp;utm_medium=distribute.wap_relevant.none-task-blog-2~default~CTRLIST~Rate-3-121342435-blog-117277128.wap_relevant_t0_download&amp;depth_1-utm_source=distribute.wap_relevant.none-task-blog-2~default~CTRLIST~Rate-3-121342435-blog-117277128.wap_relevant_t0_download" title="Android 10 添加一个新物理按键_gpio-keys.kl_卖报的小行家007的博客-CSDN博客">Android 10 添加一个新物理按键_gpio-keys.kl_卖报的小行家007的博客-CSDN博客</a></p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="https://www.jianshu.com/p/a7ebc88842cb" rel="nofollow" title="记一次查看KeyEvent.keyCodeToString方法源码 - 简书 (jianshu.com)">记一次查看KeyEvent.keyCodeToString方法源码 - 简书 (jianshu.com)</a></p> 
<p> 转载请注明出处 ：<a href="https://blog.csdn.net/qq_15950325/article/details/130352358" title="高通 Android 12 framework添加自定义按键上报应用层_KdanMin的博客-CSDN博客">高通 Android 12 framework添加自定义按键上报应用层_KdanMin的博客-CSDN博客</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/51d771443cf47e8f7ec79b273070a1ca/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android 12(S) IPV4优先IPV6(优先使用IPv4地址)的实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0e6049957f7d02375ab4f3f069014ce7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL优化第二篇</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>