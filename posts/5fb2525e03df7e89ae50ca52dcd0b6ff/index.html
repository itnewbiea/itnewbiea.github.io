<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android仿地铁行进线路图 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android仿地铁行进线路图" />
<meta property="og:description" content="在坐地铁的时候，能看到有些地铁上是有地铁行进动画和站点到达动画的，最近在做项目的时候，就有一个类似这样的需求，不同的是展示的点有限制，多出来的点是需要是折贴起来的，当需要展示时再拉出来，大致动画如下：
看到这样一个动画，你有什么想法呢？对于这个动画，我有一个同事使用的是RecycleView去做的，做出来后差不多有十几个类，里面的逻辑还是比较复杂的，由于同事离职，这里面还有一些问题存在，由我接手修改，确实不太好改，没办法，尝试自己撸一个。对于这样一个动画，我首先想到的是使用自定义View来解决。先来说一下绘制这个View的大致思路：先绘制静态的，在绘制动态的。
1、如何绘制静态的呢，这个比较简单，不过这里需要考虑一个问题，站点抽出是向左抽出的，所以绘制时应该从右边开始画，主要的界面是由圆还有线绘制成的，这些都很简单，现在主要来说说这写点线位置的计算，首先一开始左右位置的间隙是对称的，这里可以根据预先设置的点的个数，根据屏宽和预先设置的参数计算出线的长短，这样就可以画出这些点还有线了，点还有线绘制完后，就差文字及其背景了，文字这个不多说，背景其实也就是一条线，只不过是比较宽而已。
2、比较难的是动态绘制的处理，可以看出，点一次可以拉出1~3个，这里将一个点和一条线看做是一段长，这里先上一段代码：
private void initAnimator() { animator = new ValueAnimator(); animator.addUpdateListener(animation -&gt; { changeX = (float) animation.getAnimatedValue(); if ((int) (changeX / lineWithdotWidth) == flag) { headPositionIndex&#43;&#43;; flag&#43;&#43;; } changeX = changeX % lineWithdotWidth; isScrolling = true; invalidate(); }); animator.addListener(new AnimatorListenerAdapter() { @Override public void onAnimationEnd(Animator animation) { super.onAnimationEnd(animation); isScrolling = false; flag = 1; } }); } 后面动画用到的主要就是这个changeX，根据这个changX去绘制点和线，由于拉出的过程都是在一个点和线之间的距离变化的，所以这个changeX就是在这个范围内变化的，大致的思路就是这样，当然里面还有好多细节需要去处理，代码主要分为三个类，其中两个是处理点位数据的，比较简单：
public class IndicatorPositionDatas { private List&lt;PositionData&gt; positionList = new ArrayList&lt;&gt;(); public IndicatorPositionDatas(List&lt;String&gt; list) { boolean isTextUp; int size = list." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5fb2525e03df7e89ae50ca52dcd0b6ff/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-06T11:02:23+08:00" />
<meta property="article:modified_time" content="2020-03-06T11:02:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android仿地铁行进线路图</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>在坐地铁的时候，能看到有些地铁上是有地铁行进动画和站点到达动画的，最近在做项目的时候，就有一个类似这样的需求，不同的是展示的点有限制，多出来的点是需要是折贴起来的，当需要展示时再拉出来，大致动画如下：<br> <img src="https://images2.imgbox.com/3c/10/4ghr9gIU_o.gif" alt="在这里插入图片描述"><br> 看到这样一个动画，你有什么想法呢？对于这个动画，我有一个同事使用的是RecycleView去做的，做出来后差不多有十几个类，里面的逻辑还是比较复杂的，由于同事离职，这里面还有一些问题存在，由我接手修改，确实不太好改，没办法，尝试自己撸一个。对于这样一个动画，我首先想到的是使用自定义View来解决。先来说一下绘制这个View的大致思路：先绘制静态的，在绘制动态的。<br> 1、如何绘制静态的呢，这个比较简单，不过这里需要考虑一个问题，站点抽出是向左抽出的，所以绘制时应该从右边开始画，主要的界面是由圆还有线绘制成的，这些都很简单，现在主要来说说这写点线位置的计算，首先一开始左右位置的间隙是对称的，这里可以根据预先设置的点的个数，根据屏宽和预先设置的参数计算出线的长短，这样就可以画出这些点还有线了，点还有线绘制完后，就差文字及其背景了，文字这个不多说，背景其实也就是一条线，只不过是比较宽而已。<br> 2、比较难的是动态绘制的处理，可以看出，点一次可以拉出1~3个，这里将一个点和一条线看做是一段长，这里先上一段代码：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        animator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ValueAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        animator<span class="token punctuation">.</span><span class="token function">addUpdateListener</span><span class="token punctuation">(</span>animation <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
            changeX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> animation<span class="token punctuation">.</span><span class="token function">getAnimatedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>changeX <span class="token operator">/</span> lineWithdotWidth<span class="token punctuation">)</span> <span class="token operator">==</span> flag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                headPositionIndex<span class="token operator">++</span><span class="token punctuation">;</span>
                flag<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            changeX <span class="token operator">=</span> changeX <span class="token operator">%</span> lineWithdotWidth<span class="token punctuation">;</span>
            isScrolling <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        animator<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnimatorListenerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationEnd</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAnimationEnd</span><span class="token punctuation">(</span>animation<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isScrolling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>后面动画用到的主要就是这个changeX，根据这个changX去绘制点和线，由于拉出的过程都是在一个点和线之间的距离变化的，所以这个changeX就是在这个范围内变化的，大致的思路就是这样，当然里面还有好多细节需要去处理，代码主要分为三个类，其中两个是处理点位数据的，比较简单：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndicatorPositionDatas</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>PositionData<span class="token punctuation">&gt;</span></span> positionList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">IndicatorPositionDatas</span><span class="token punctuation">(</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">boolean</span> isTextUp<span class="token punctuation">;</span>
        <span class="token keyword">int</span> size <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            isTextUp <span class="token operator">=</span> <span class="token punctuation">(</span>i <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            PositionData positionData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PositionData</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>isTextUp<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            positionList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>positionData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        PositionData positionData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PositionData</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">,</span>size<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        positionList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>positionData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> PositionData <span class="token function">getLastPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> positionList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>positionList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> PositionData <span class="token function">getCurrentPosition</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> positionList<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>position<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> positionList<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PositionData</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">private</span> String positionText<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isTextUp<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> position<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token function">PositionData</span><span class="token punctuation">(</span>String positionText<span class="token punctuation">,</span> <span class="token keyword">boolean</span> isTextUp<span class="token punctuation">,</span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>positionText <span class="token operator">=</span> positionText<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>isTextUp <span class="token operator">=</span> isTextUp<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> String <span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> positionText<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isTextUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> isTextUp<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token keyword">int</span> position<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>position <span class="token operator">=</span> position<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>接下来就是自定义的View类：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IndicatorViewGroup</span> <span class="token keyword">extends</span> <span class="token class-name">View</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> String TAG <span class="token operator">=</span> <span class="token string">"IndicatorViewGroup"</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> Paint mPaintText<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Paint mPaintLine<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Paint mPaintTextBg<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Paint mPaintDot<span class="token punctuation">;</span>
    <span class="token keyword">private</span> Paint mPaintLoopDot<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> lineNoWalkColor <span class="token operator">=</span> <span class="token number">0xFF219BFF</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> lineWalkedColor <span class="token operator">=</span> <span class="token number">0xFF999999</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dotStartColor <span class="token operator">=</span> <span class="token number">0xFFFCB300</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dotEndColor <span class="token operator">=</span> <span class="token number">0xFFEA0075</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> textBackground <span class="token operator">=</span> <span class="token number">0xFFF4F4F9</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dotWidthAndHeight<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> lineLength<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> leftRightPadding<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> lineWidth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> textBgWidth<span class="token punctuation">;</span>
    <span class="token comment">//绘制文字背景时，背景距离dot的距离</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> textBgMarginDot<span class="token punctuation">;</span>
    <span class="token comment">//绘制文字时定位的Y方向坐标</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> textTopBaseline<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> textBottomBaseline<span class="token punctuation">;</span>
    <span class="token comment">//绘制文字背景定位的中心线</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> textBgTopCenter<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> textBgBottomCenter<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> changeX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> animatorTime <span class="token operator">=</span> <span class="token number">4000</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dotFlashTime <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> ValueAnimator animator<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> textSize <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> IndicatorPositionDatas positionDatas<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> headPositionIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> arrivePosition <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> String textMore <span class="token operator">=</span> <span class="token string">"更多(%d)"</span><span class="token punctuation">;</span>
    <span class="token comment">//绘制在上边文本的位置信息</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dotTopPosition<span class="token punctuation">;</span>
    <span class="token comment">//绘制下边文本的位置信息</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> dotBottomPosition<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isScrolling<span class="token punctuation">;</span>
    <span class="token comment">//view的垂直居中位置</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> centerY<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> lineWithdotWidth<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isWalking <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">long</span> timeFlag<span class="token punctuation">;</span>
    <span class="token comment">//外圆环的宽度</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> loopDotStroke<span class="token punctuation">;</span>
    <span class="token comment">//绘制点所需要的参数，cx是点的中心点</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> cx<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> dotRadius<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> loopDotRadius<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> lineWithCircleGap<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> dotOffset<span class="token punctuation">;</span>

    <span class="token comment">/**
     * 去往目的点的途中
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">arriveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isWalking <span class="token operator">&amp;&amp;</span> arrivePosition <span class="token operator">==</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"已经到终点了"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isWalking<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            isWalking <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>headPositionIndex <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">==</span> arrivePosition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>arrivePosition <span class="token operator">&lt;</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">startAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        timeFlag <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        isWalking <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        arrivePosition<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 到达目的点
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">arriveTo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isWalking <span class="token operator">&amp;&amp;</span> arrivePosition <span class="token operator">==</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            Toast<span class="token punctuation">.</span><span class="token function">makeText</span><span class="token punctuation">(</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"已经到终点了"</span><span class="token punctuation">,</span> Toast<span class="token punctuation">.</span>LENGTH_SHORT<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>isWalking<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            isWalking <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>headPositionIndex <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">==</span> arrivePosition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>arrivePosition <span class="token operator">&lt;</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">startAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 开启展开动画
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">startAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> isScrolling <span class="token operator">?</span> <span class="token number">6</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> moreCount <span class="token operator">=</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> headPositionIndex <span class="token operator">-</span> count<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moreCount <span class="token operator">==</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            animator<span class="token punctuation">.</span><span class="token function">setFloatValues</span><span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> lineWithdotWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            animator<span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span>animatorTime <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>moreCount <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            animator<span class="token punctuation">.</span><span class="token function">setFloatValues</span><span class="token punctuation">(</span>lineWithdotWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            animator<span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span>animatorTime <span class="token operator">/</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            animator<span class="token punctuation">.</span><span class="token function">setFloatValues</span><span class="token punctuation">(</span><span class="token number">3</span> <span class="token operator">*</span> lineWithdotWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
            animator<span class="token punctuation">.</span><span class="token function">setDuration</span><span class="token punctuation">(</span>animatorTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        animator<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param arrivePosition 所在的位置点
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setArrivePosition</span><span class="token punctuation">(</span><span class="token keyword">int</span> arrivePosition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>arrivePosition <span class="token operator">=</span> arrivePosition<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param list 点位数据
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPositionDatas</span><span class="token punctuation">(</span>ArrayList<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        positionDatas <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IndicatorPositionDatas</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param size 位置点上文字的大小
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTextSize</span><span class="token punctuation">(</span><span class="token keyword">int</span> size<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        textSize <span class="token operator">=</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param lineWidth 路线线条的宽度
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLineWidth</span><span class="token punctuation">(</span><span class="token keyword">int</span> lineWidth<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lineWidth <span class="token operator">=</span> lineWidth<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param textBgWidth 文字背景的宽度
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTextBgWidth</span><span class="token punctuation">(</span><span class="token keyword">int</span> textBgWidth<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>textBgWidth <span class="token operator">=</span> textBgWidth<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param marginDot 文字距离原点的距离
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setTextBgMarginDot</span><span class="token punctuation">(</span><span class="token keyword">int</span> marginDot<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        textBgMarginDot <span class="token operator">=</span> marginDot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * @param animatorTime 设置展开三个点所需的时间，单位是ms
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setAnimatorTime</span><span class="token punctuation">(</span><span class="token keyword">int</span> animatorTime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>animatorTime <span class="token operator">=</span> animatorTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param dotFlashTime 设置点位闪动的时间间隔
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setDotFlashTime</span><span class="token punctuation">(</span><span class="token keyword">int</span> dotFlashTime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>dotFlashTime <span class="token operator">=</span> dotFlashTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * @param lineWithCircleGap 线与点之间的间隔
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setLineWithCircleGap</span><span class="token punctuation">(</span><span class="token keyword">float</span> lineWithCircleGap<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>lineWithCircleGap <span class="token operator">=</span> lineWithCircleGap<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">IndicatorViewGroup</span><span class="token punctuation">(</span>Context context<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">IndicatorViewGroup</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> AttributeSet attrs<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">IndicatorViewGroup</span><span class="token punctuation">(</span>Context context<span class="token punctuation">,</span> AttributeSet attrs<span class="token punctuation">,</span> <span class="token keyword">int</span> defStyleAttr<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> attrs<span class="token punctuation">,</span> defStyleAttr<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initDotParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initPaint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initPaint</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        mPaintText <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintText<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintText<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span>BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintText<span class="token punctuation">.</span><span class="token function">setTextSize</span><span class="token punctuation">(</span>TypedValue<span class="token punctuation">.</span><span class="token function">applyDimension</span><span class="token punctuation">(</span>TypedValue<span class="token punctuation">.</span>COMPLEX_UNIT_SP<span class="token punctuation">,</span> textSize<span class="token punctuation">,</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        mPaintLine <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLine<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLine<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineNoWalkColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLine<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span>lineWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLine<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLine<span class="token punctuation">.</span><span class="token function">setStrokeCap</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Cap<span class="token punctuation">.</span>ROUND<span class="token punctuation">)</span><span class="token punctuation">;</span>

        mPaintTextBg <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintTextBg<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintTextBg<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>textBackground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintTextBg<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span>textBgWidth<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintTextBg<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintTextBg<span class="token punctuation">.</span><span class="token function">setStrokeCap</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Cap<span class="token punctuation">.</span>ROUND<span class="token punctuation">)</span><span class="token punctuation">;</span>

        mPaintDot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintDot<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineNoWalkColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintDot<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>FILL<span class="token punctuation">)</span><span class="token punctuation">;</span>

        mPaintLoopDot <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Paint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLoopDot<span class="token punctuation">.</span><span class="token function">setAntiAlias</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLoopDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>Color<span class="token punctuation">.</span><span class="token function">parseColor</span><span class="token punctuation">(</span><span class="token string">"#FFFFFF"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLoopDot<span class="token punctuation">.</span><span class="token function">setStrokeWidth</span><span class="token punctuation">(</span>loopDotStroke<span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintLoopDot<span class="token punctuation">.</span><span class="token function">setStyle</span><span class="token punctuation">(</span>Paint<span class="token punctuation">.</span>Style<span class="token punctuation">.</span>STROKE<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        leftRightPadding <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">27</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lineWidth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textBgWidth <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textBgMarginDot <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dotRadius <span class="token operator">=</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        lineWithCircleGap <span class="token operator">=</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        loopDotStroke <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        dotOffset <span class="token operator">=</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">float</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token keyword">int</span> px<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> TypedValue<span class="token punctuation">.</span><span class="token function">applyDimension</span><span class="token punctuation">(</span>TypedValue<span class="token punctuation">.</span>COMPLEX_UNIT_DIP<span class="token punctuation">,</span> px<span class="token punctuation">,</span> <span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getDisplayMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onMeasure</span><span class="token punctuation">(</span><span class="token keyword">int</span> widthMeasureSpec<span class="token punctuation">,</span> <span class="token keyword">int</span> heightMeasureSpec<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> width <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        lineLength <span class="token operator">=</span> <span class="token punctuation">(</span>width <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> leftRightPadding <span class="token operator">-</span> <span class="token number">6</span> <span class="token operator">*</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">5</span><span class="token punctuation">;</span>
        lineWithdotWidth <span class="token operator">=</span> dotWidthAndHeight <span class="token operator">+</span> lineLength<span class="token punctuation">;</span>
        <span class="token keyword">int</span> heightMode <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">getMode</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> heightSize <span class="token operator">=</span> dotWidthAndHeight <span class="token operator">+</span> textBgMarginDot <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> textBgWidth <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>heightSize <span class="token operator">&gt;</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">getSize</span><span class="token punctuation">(</span>heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            heightMeasureSpec <span class="token operator">=</span> MeasureSpec<span class="token punctuation">.</span><span class="token function">makeMeasureSpec</span><span class="token punctuation">(</span>heightSize<span class="token punctuation">,</span> heightMode<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onMeasure</span><span class="token punctuation">(</span>widthMeasureSpec<span class="token punctuation">,</span> heightMeasureSpec<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAttachedToWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">initArrivePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 初始化所在的位置点是否需要展开
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initArrivePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isMorePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> arrivePosition <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arrivePosition <span class="token operator">%</span> <span class="token number">3</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            headPositionIndex <span class="token operator">=</span> <span class="token punctuation">(</span>arrivePosition <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">3</span> <span class="token operator">*</span> <span class="token number">3</span><span class="token punctuation">;</span>
            <span class="token function">postDelayed</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span><span class="token operator">:</span>startAnimator<span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isMorePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">6</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initDotParams</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        dotWidthAndHeight <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>dotRadius <span class="token operator">+</span> lineWithCircleGap<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">;</span>
        loopDotRadius <span class="token operator">=</span> dotRadius <span class="token operator">+</span> loopDotStroke <span class="token operator">/</span> <span class="token number">2f</span><span class="token punctuation">;</span>
        cx <span class="token operator">=</span> dotWidthAndHeight <span class="token operator">/</span> <span class="token number">2f</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">initAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        animator <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ValueAnimator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        animator<span class="token punctuation">.</span><span class="token function">addUpdateListener</span><span class="token punctuation">(</span>animation <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
            changeX <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">float</span><span class="token punctuation">)</span> animation<span class="token punctuation">.</span><span class="token function">getAnimatedValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>changeX <span class="token operator">/</span> lineWithdotWidth<span class="token punctuation">)</span> <span class="token operator">==</span> flag<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                headPositionIndex<span class="token operator">++</span><span class="token punctuation">;</span>
                flag<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            changeX <span class="token operator">=</span> changeX <span class="token operator">%</span> lineWithdotWidth<span class="token punctuation">;</span>
            isScrolling <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        animator<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AnimatorListenerAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">onAnimationEnd</span><span class="token punctuation">(</span>Animator animation<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onAnimationEnd</span><span class="token punctuation">(</span>animation<span class="token punctuation">)</span><span class="token punctuation">;</span>
                isScrolling <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                flag <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onLayout</span><span class="token punctuation">(</span><span class="token keyword">boolean</span> changed<span class="token punctuation">,</span> <span class="token keyword">int</span> left<span class="token punctuation">,</span> <span class="token keyword">int</span> top<span class="token punctuation">,</span> <span class="token keyword">int</span> right<span class="token punctuation">,</span> <span class="token keyword">int</span> bottom<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onLayout</span><span class="token punctuation">(</span>changed<span class="token punctuation">,</span> left<span class="token punctuation">,</span> top<span class="token punctuation">,</span> right<span class="token punctuation">,</span> bottom<span class="token punctuation">)</span><span class="token punctuation">;</span>
        centerY <span class="token operator">=</span> <span class="token function">getHeight</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        dotTopPosition <span class="token operator">=</span> centerY <span class="token operator">-</span> dotWidthAndHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        dotBottomPosition <span class="token operator">=</span> centerY <span class="token operator">+</span> dotWidthAndHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        mPaintText<span class="token punctuation">.</span><span class="token function">measureText</span><span class="token punctuation">(</span>positionDatas<span class="token punctuation">.</span><span class="token function">getLastPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        Paint<span class="token punctuation">.</span>FontMetrics fm <span class="token operator">=</span> mPaintText<span class="token punctuation">.</span><span class="token function">getFontMetrics</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textTopBaseline <span class="token operator">=</span> dotTopPosition <span class="token operator">-</span> fm<span class="token punctuation">.</span>descent <span class="token operator">-</span> textBgMarginDot<span class="token punctuation">;</span>
        textBottomBaseline <span class="token operator">=</span> dotBottomPosition <span class="token operator">+</span> fm<span class="token punctuation">.</span>descent <span class="token operator">-</span> fm<span class="token punctuation">.</span>ascent <span class="token operator">+</span> textBgMarginDot <span class="token operator">-</span> <span class="token function">px2Dp</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        textBgTopCenter <span class="token operator">=</span> dotTopPosition <span class="token operator">-</span> <span class="token punctuation">(</span>fm<span class="token punctuation">.</span>bottom <span class="token operator">-</span> fm<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">-</span> textBgMarginDot<span class="token punctuation">;</span>
        textBgBottomCenter <span class="token operator">=</span> dotBottomPosition <span class="token operator">+</span> <span class="token punctuation">(</span>fm<span class="token punctuation">.</span>bottom <span class="token operator">-</span> fm<span class="token punctuation">.</span>top<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> textBgMarginDot<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">onDraw</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">onDraw</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">drawPosition</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawPosition</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isMorePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> dotWidthAndHeight <span class="token operator">-</span> leftRightPadding <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token function">getWidth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> dotWidthAndHeight <span class="token operator">-</span> leftRightPadding <span class="token operator">-</span> <span class="token punctuation">(</span><span class="token number">6</span> <span class="token operator">-</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> lineWithdotWidth<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">drawDot</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> positionDatas<span class="token punctuation">.</span><span class="token function">getLastPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">translateLine</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>arrivePosition <span class="token operator">==</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mPaintLine<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineWalkedColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            mPaintLine<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineNoWalkColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">drawLine</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> positionDatas<span class="token punctuation">.</span><span class="token function">getLastPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> dotIndex <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token function">translateBit</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isMorePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//绘制拉出的那个点</span>
            canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span> <span class="token operator">*</span> dotOffset<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>changeX <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">unfoldPosition</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            dotIndex <span class="token operator">=</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">3</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//绘制倒数第二个点</span>
        <span class="token function">drawDot</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> positionDatas<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">int</span> index<span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> dotIndex<span class="token punctuation">;</span> <span class="token number">0</span> <span class="token operator">&lt;=</span> i<span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">translateLine</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
            index <span class="token operator">=</span> headPositionIndex <span class="token operator">+</span> i<span class="token punctuation">;</span>
            <span class="token keyword">int</span> lineColor <span class="token operator">=</span> arrivePosition <span class="token operator">&lt;=</span> index <span class="token operator">?</span> lineNoWalkColor <span class="token operator">:</span> lineWalkedColor<span class="token punctuation">;</span>
            mPaintLine<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            PositionData currentPosition <span class="token operator">=</span> positionDatas<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>index<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawLine</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> currentPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">translateBit</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawDot</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> currentPosition<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>headPositionIndex <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mPaintLine<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineWalkedColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            mPaintLine<span class="token punctuation">.</span><span class="token function">setShader</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token operator">-</span>lineLength <span class="token operator">/</span> <span class="token number">2f</span><span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> mPaintLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>isScrolling<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">invalidate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">unfoldPosition</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span>changeX<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineNoWalkColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> dotRadius<span class="token punctuation">,</span> mPaintDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> loopDotRadius<span class="token punctuation">,</span> mPaintLoopDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>changeX <span class="token operator">&gt;</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">float</span> stopX<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>changeX <span class="token operator">&gt;</span> dotWidthAndHeight <span class="token operator">+</span> lineLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                stopX <span class="token operator">=</span> dotWidthAndHeight <span class="token operator">+</span> lineLength<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                stopX <span class="token operator">=</span> changeX <span class="token operator">+</span> <span class="token number">10</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>dotWidthAndHeight<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> stopX<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> mPaintLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>lineLength <span class="token operator">&gt;</span> changeX<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">int</span> alpha <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>changeX <span class="token operator">/</span> lineLength <span class="token operator">*</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            mPaintText<span class="token punctuation">.</span><span class="token function">setAlpha</span><span class="token punctuation">(</span>alpha<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">drawText</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> positionDatas<span class="token punctuation">.</span><span class="token function">getCurrentPosition</span><span class="token punctuation">(</span>headPositionIndex <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mPaintText<span class="token punctuation">.</span><span class="token function">setAlpha</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">translateLine</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span>lineLength<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">translateBit</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        canvas<span class="token punctuation">.</span><span class="token function">translate</span><span class="token punctuation">(</span><span class="token operator">-</span>dotWidthAndHeight<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//绘制线以及移动时相应的动画</span>
    <span class="token keyword">private</span> <span class="token keyword">float</span> offsetFlashX<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawLine</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">,</span> PositionData msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> arrivePosition <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">||</span> <span class="token punctuation">(</span>arrivePosition <span class="token operator">==</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> msg<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>isWalking<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                mPaintLine<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>dotStartColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                LinearGradient backGradient <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinearGradient</span><span class="token punctuation">(</span><span class="token operator">-</span>lineLength <span class="token operator">+</span> offsetFlashX<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> offsetFlashX<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">int</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span>dotStartColor<span class="token punctuation">,</span> <span class="token number">0xffffffff</span><span class="token punctuation">,</span> dotStartColor<span class="token punctuation">}</span><span class="token punctuation">,</span> null<span class="token punctuation">,</span> Shader<span class="token punctuation">.</span>TileMode<span class="token punctuation">.</span>CLAMP<span class="token punctuation">)</span><span class="token punctuation">;</span>
                mPaintLine<span class="token punctuation">.</span><span class="token function">setShader</span><span class="token punctuation">(</span>backGradient<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            mPaintLine<span class="token punctuation">.</span><span class="token function">setShader</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        offsetFlashX <span class="token operator">=</span> offsetFlashX <span class="token operator">+</span> <span class="token number">1f</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>offsetFlashX <span class="token operator">&gt;</span> lineLength <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span> offsetFlashX <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> lineLength<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> mPaintLine<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawDot</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">,</span> PositionData msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> position <span class="token operator">=</span> msg<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> time <span class="token operator">=</span> System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> toLastTime <span class="token operator">=</span> time <span class="token operator">-</span> timeFlag<span class="token punctuation">;</span>
        Log<span class="token punctuation">.</span><span class="token function">d</span><span class="token punctuation">(</span>TAG<span class="token punctuation">,</span> <span class="token string">"drawDot: toLastTime = "</span> <span class="token operator">+</span> toLastTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> arrivePosition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>toLastTime <span class="token operator">/</span> dotFlashTime <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                mPaintDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>dotStartColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                mPaintDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token number">0x00000000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> arrivePosition <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                mPaintDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>dotStartColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                mPaintDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>dotEndColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">&lt;</span> arrivePosition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    mPaintDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineWalkedColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    mPaintDot<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>lineNoWalkColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> count <span class="token operator">=</span> isScrolling <span class="token operator">?</span> <span class="token number">6</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> moreCount <span class="token operator">=</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> headPositionIndex <span class="token operator">-</span> count<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>position <span class="token operator">==</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isMorePosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//绘制倒数第二个点</span>
                <span class="token function">drawMoreDot</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> moreCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> changeX<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> dotRadius<span class="token punctuation">,</span> mPaintDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
                canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> changeX<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> loopDotRadius<span class="token punctuation">,</span> mPaintLoopDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>headPositionIndex <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                String textName <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>textMore<span class="token punctuation">,</span> moreCount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">float</span> textWidth <span class="token operator">=</span> mPaintText<span class="token punctuation">.</span><span class="token function">measureText</span><span class="token punctuation">(</span>textName<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//绘制文字背景色</span>
                canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span>changeX <span class="token operator">+</span> <span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> textBgTopCenter<span class="token punctuation">,</span>
                        changeX <span class="token operator">+</span> <span class="token punctuation">(</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> textBgTopCenter<span class="token punctuation">,</span> mPaintTextBg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span>textName<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> changeX <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> textTopBaseline<span class="token punctuation">,</span> mPaintText<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">float</span> textWidth <span class="token operator">=</span> mPaintText<span class="token punctuation">.</span><span class="token function">measureText</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//绘制文字背景</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> arrivePosition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    mPaintTextBg<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>dotStartColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    mPaintTextBg<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>textBackground<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">isTextUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> textBgTopCenter<span class="token punctuation">,</span>
                            <span class="token punctuation">(</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textBgTopCenter<span class="token punctuation">,</span> mPaintTextBg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> textBgBottomCenter<span class="token punctuation">,</span>
                            <span class="token punctuation">(</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textBgBottomCenter<span class="token punctuation">,</span> mPaintTextBg<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//绘制文字</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">isTextUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> textTopBaseline<span class="token punctuation">,</span> mPaintText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> textBottomBaseline<span class="token punctuation">,</span> mPaintText<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> dotRadius<span class="token punctuation">,</span> mPaintDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> loopDotRadius<span class="token punctuation">,</span> mPaintLoopDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">drawText</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawMoreDot</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">,</span> <span class="token keyword">int</span> moreCount<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">float</span> factor1 <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">float</span> factor2 <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moreCount <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            factor1 <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">-</span> changeX <span class="token operator">/</span> lineWithdotWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            factor2 <span class="token operator">=</span> changeX <span class="token operator">/</span> lineWithdotWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>changeX <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                factor1 <span class="token operator">=</span> <span class="token number">1.5f</span><span class="token punctuation">;</span>
                factor2 <span class="token operator">=</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>moreCount <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>headPositionIndex <span class="token operator">+</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> positionDatas<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                factor1 <span class="token operator">=</span> <span class="token number">1.5f</span> <span class="token operator">-</span> changeX <span class="token operator">/</span> lineWithdotWidth <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
                factor2 <span class="token operator">=</span> changeX <span class="token operator">/</span> lineWithdotWidth <span class="token operator">/</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">0.5f</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                factor1 <span class="token operator">=</span> factor2 <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>factor1 <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> changeX <span class="token operator">+</span> factor1 <span class="token operator">*</span> dotOffset<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> dotRadius<span class="token punctuation">,</span> mPaintDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> changeX <span class="token operator">+</span> factor1 <span class="token operator">*</span> dotOffset<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> loopDotRadius<span class="token punctuation">,</span> mPaintLoopDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> changeX <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> dotRadius<span class="token punctuation">,</span> mPaintDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
        canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> changeX <span class="token operator">+</span> dotOffset<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> loopDotRadius<span class="token punctuation">,</span> mPaintLoopDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>factor2 <span class="token operator">!=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> changeX <span class="token operator">+</span> factor2 <span class="token operator">*</span> dotOffset<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> dotRadius<span class="token punctuation">,</span> mPaintDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
            canvas<span class="token punctuation">.</span><span class="token function">drawCircle</span><span class="token punctuation">(</span>cx <span class="token operator">+</span> changeX <span class="token operator">+</span> factor2 <span class="token operator">*</span> dotOffset<span class="token punctuation">,</span> centerY<span class="token punctuation">,</span> loopDotRadius<span class="token punctuation">,</span> mPaintLoopDot<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawText</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">,</span> PositionData msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">float</span> textWidth <span class="token operator">=</span> mPaintText<span class="token punctuation">.</span><span class="token function">measureText</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">drawTextBackground</span><span class="token punctuation">(</span>canvas<span class="token punctuation">,</span> textWidth<span class="token punctuation">,</span> msg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">isTextUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textTopBaseline<span class="token punctuation">,</span> mPaintText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">drawText</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textBottomBaseline<span class="token punctuation">,</span> mPaintText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">drawTextBackground</span><span class="token punctuation">(</span>Canvas canvas<span class="token punctuation">,</span> <span class="token keyword">float</span> textWidth<span class="token punctuation">,</span> PositionData msg<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> arrivePosition<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            mPaintTextBg<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>dotStartColor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            mPaintTextBg<span class="token punctuation">.</span><span class="token function">setColor</span><span class="token punctuation">(</span>textBackground<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>msg<span class="token punctuation">.</span><span class="token function">isTextUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textBgTopCenter<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textBgTopCenter<span class="token punctuation">,</span> mPaintTextBg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            canvas<span class="token punctuation">.</span><span class="token function">drawLine</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textBgBottomCenter<span class="token punctuation">,</span>
                    <span class="token punctuation">(</span>textWidth <span class="token operator">+</span> dotWidthAndHeight<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> textBgBottomCenter<span class="token punctuation">,</span> mPaintTextBg<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>代码到这就算是完成了，代码量不多，用起来也很简单，首先就是在xml中进行添加：</p> 
<pre><code class="prism language-java">    <span class="token operator">&lt;</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ubt<span class="token punctuation">.</span>myapplication<span class="token punctuation">.</span>view<span class="token punctuation">.</span>IndicatorViewGroup
        android<span class="token operator">:</span>id<span class="token operator">=</span><span class="token string">"@+id/iv_animator"</span>
        android<span class="token operator">:</span>layout_width<span class="token operator">=</span><span class="token string">"match_parent"</span>
        android<span class="token operator">:</span>layout_height<span class="token operator">=</span><span class="token string">"wrap_content"</span><span class="token operator">&gt;</span>
        
    <span class="token operator">&lt;</span><span class="token operator">/</span>com<span class="token punctuation">.</span>example<span class="token punctuation">.</span>ubt<span class="token punctuation">.</span>myapplication<span class="token punctuation">.</span>view<span class="token punctuation">.</span>IndicatorViewGroup<span class="token operator">&gt;</span>
</code></pre> 
<p>高度这里可以指定高度，但都是会居中绘制的，最后就是在Activity中进行使用了，也比较简单：</p> 
<pre><code class="prism language-java">		IndicatorViewGroup ivAnimator <span class="token operator">=</span> <span class="token punctuation">(</span>IndicatorViewGroup<span class="token punctuation">)</span> <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>iv_animator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        ivAnimator<span class="token punctuation">.</span><span class="token function">setPositionDatas</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">findViewById</span><span class="token punctuation">(</span>R<span class="token punctuation">.</span>id<span class="token punctuation">.</span>btn_start<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setOnClickListener</span><span class="token punctuation">(</span>v<span class="token operator">-</span><span class="token operator">&gt;</span>ivAnimator<span class="token punctuation">.</span><span class="token function">arriveNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这样完成后，点击按钮就可以动起来了，代码中还提供了一个arriveTo（）方法，为了方便调试，直接将这个方法添加到了arriveNext（）中，如果需要使用两个方法，直接把arriveNext（）中相同的代码去掉即可，为了整体的视觉感，这里建议<mark>将屏幕设置成横屏</mark>。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78f7e3b69a25ed71985bb4a55b9289d1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;那些问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d43298121c6edefd0a0177f171a11ea9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">oracle数据库备份还原</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>