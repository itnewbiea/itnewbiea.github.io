<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java 8的Stream API分组。将List＜Map＜String, String＞＞集合分组，分组条件为动态集合List＜String＞ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java 8的Stream API分组。将List＜Map＜String, String＞＞集合分组，分组条件为动态集合List＜String＞" />
<meta property="og:description" content="有一个集合：
{ &#34;condition&#34;: [ &#34;key3774&#34;,&#34;key3770&#34; ], &#34;body&#34;: [ { &#34;key3779&#34;: &#34;44406107.75&#34;, &#34;key3778&#34;: &#34;-49468430.57&#34;, &#34;key3774&#34;: &#34;一二三航&#34;, &#34;key3770&#34;: &#34;SHY&#34;, &#34;key&#34;: &#34;1742796948097728512&#34; }, { &#34;key3782&#34;: &#34;634&#34;, &#34;key3775&#34;: &#34;634&#34;, &#34;key3774&#34;: &#34;一二三航&#34;, &#34;key3770&#34;: &#34;SHY&#34;, &#34;key&#34;: &#34;1742796948097728513&#34; }, { &#34;key3779&#34;: &#34;971864954.96&#34;, &#34;key3778&#34;: &#34;-98854650.65&#34;, &#34;key3774&#34;: &#34;上航&#34;, &#34;key3770&#34;: &#34;SHK&#34;, &#34;key&#34;: &#34;1742796948097728514&#34; }, { &#34;key3782&#34;: &#34;3921&#34;, &#34;key3775&#34;: &#34;3921&#34;, &#34;key3774&#34;: &#34;上航&#34;, &#34;key3770&#34;: &#34;SHK&#34;, &#34;key&#34;: &#34;1742796948097728515&#34; } ] } 将该集合中的body，根据分组条件condition进行分组，后再聚合。
最终变为如下集合：
{ &#34;condition&#34;: [ &#34;key3774&#34;,&#34;key3770&#34; ], &#34;body&#34;: [ { &#34;key3779&#34;: &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/21f82fcc3a020f94f9fc79342480b2ca/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T14:04:22+08:00" />
<meta property="article:modified_time" content="2024-01-05T14:04:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java 8的Stream API分组。将List＜Map＜String, String＞＞集合分组，分组条件为动态集合List＜String＞</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>有一个集合：</p> 
<pre><code class="hljs">
{
    "condition": [
        "key3774","key3770"
    ],
    "body": [
        {
            "key3779": "44406107.75",
            "key3778": "-49468430.57",
            "key3774": "一二三航",
            "key3770": "SHY",
            "key": "1742796948097728512"
        },
        {
            "key3782": "634",
            "key3775": "634",
            "key3774": "一二三航",
            "key3770": "SHY",
            "key": "1742796948097728513"
        },
        {
            "key3779": "971864954.96",
            "key3778": "-98854650.65",
            "key3774": "上航",
            "key3770": "SHK",
            "key": "1742796948097728514"
        },
        {
            "key3782": "3921",
            "key3775": "3921",
            "key3774": "上航",
            "key3770": "SHK",
            "key": "1742796948097728515"
        }
    ]
}</code></pre> 
<p>将该集合中的body，根据分组条件condition进行分组，后再聚合。</p> 
<p>最终变为如下集合：</p> 
<pre><code class="hljs">{
    "condition": [
        "key3774","key3770"
    ],
    "body": [
        {
            "key3779": "44406107.75",
            "key3778": "-49468430.57",
            "key3774": "一二三航",
            "key3770": "SHY",
            "key": "1742796948097728512",
            "key3782": "634",
            "key3775": "634"
        },
        {
            "key3779": "971864954.96",
            "key3778": "-98854650.65",
            "key3774": "上航",
            "key3770": "SHK",
            "key": "1742796948097728514",
            "key3782": "3921",
            "key3775": "3921"
        }
    ]
}</code></pre> 
<p>执行代码：</p> 
<pre><code class="hljs"> private List&lt;Map&lt;String, String&gt;&gt; groupByCondition(List&lt;Map&lt;String, String&gt;&gt; body, List&lt;String&gt; conditionList) {

        List&lt;Map&lt;String, String&gt;&gt; bodyRes = new ArrayList&lt;&gt;();

        // 根据condition分组
        Map&lt;String, List&lt;Map&lt;String, String&gt;&gt;&gt; recordMap = body.stream().collect(Collectors.groupingBy(map -&gt; {
            StringBuilder s = new StringBuilder();
            conditionList.forEach(c -&gt; {
                if (s.length() != 0) {
                    s.append("#");
                }
                s.append(map.get(c));
            });
            return s.toString();
        }));

        // 分组后聚合
        recordMap.forEach((k, v) -&gt; {
            if (CollectionUtils.isEmpty(v)) {
                return;
            }
            if (v.size() &gt; 1) {
                // list有2个及以上，聚合
                Map&lt;String, String&gt; mapRes = new HashMap&lt;&gt;();
                v.forEach(mapRes::putAll);
                bodyRes.add(mapRes);
            } else {
                // list有1个,直接取值
                bodyRes.add(v.get(0));
            }
        });

        return bodyRes;
    }</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/64440969b417e7187dc70208c4b757a3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Intelrealsense D435i关闭结构光</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5aedb090975ae61b6f5684cf8a2f84c5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【LeetCode每日一题】1944. 队列中可以看到的人数（单调栈）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>