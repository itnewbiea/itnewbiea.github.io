<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>a-tree 实现父级节点禁用，通过子级节点勾选状态控制 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="a-tree 实现父级节点禁用，通过子级节点勾选状态控制" />
<meta property="og:description" content="a-tree 组件实现折叠选择；使其父级节点禁用，通过子级节点的勾选状态来控制是否勾选；如果子级节点勾选任一个，父级节点就勾选中，如果子级节点全部不勾选则父节点不勾选，否则勾选 ，效果如下：
代码实现如下所示：
1、封装组件 setTableToolbar
vue 部分
&lt;template&gt; &lt;div class=&#34;toolbar-meta&#34;&gt; &lt;vxe-pulldown ref=&#34;vxePulldown&#34; transfer @hide-panel=&#34;hidePanel&#34;&gt; &lt;template #default&gt; &lt;a-button shape=&#34;circle&#34; @click=&#34;open()&#34; :size=&#34;16&#34;&gt; &lt;vxe-icon style=&#34;font-size: 20px;&#34; name=&#34;setting&#34;&gt;&lt;/vxe-icon&gt; &lt;/a-button&gt; &lt;/template&gt; &lt;template #dropdown&gt; &lt;div class=&#34;downBox&#34; &gt; &lt;!-- &lt;div class=&#34;checkTopAll&#34;&gt; &lt;a-checkbox v-model=&#34;checkAll&#34; @change=&#34;onCheckAllChange&#34; &gt;全部 &lt;/a-checkbox&gt; &lt;/div&gt; --&gt; &lt;div class=&#34;checkItem&#34;&gt; &lt;a-tree v-if=&#34;plainOptions.length&gt;0&#34; checkable :checkStrictly=&#34;true&#34; :tree-data=&#34;plainOptions&#34; :expandedKeys=&#34;expandedKeys&#34; :checkedKeys=&#34;checkedList&#34; :replace-fields=&#34;{children: &#39;children&#39;, title: &#39;title&#39;, key: &#39;id&#39;}&#34; @expand=&#34;onExpand&#34; @check=&#34;checkNode&#34; /&gt; &lt;/div&gt; &lt;!-- 底部按钮 --&gt; &lt;div class=&#34;downBtn clearfix&#34;&gt; &lt;a-button class=&#34;btnOk&#34; @click=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0ced9a25269a441b8a587285ddbebde1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-21T16:12:50+08:00" />
<meta property="article:modified_time" content="2023-07-21T16:12:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">a-tree 实现父级节点禁用，通过子级节点勾选状态控制</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>a-tree 组件实现折叠选择；使其父级节点禁用，通过子级节点的勾选状态来控制是否勾选；如果子级节点勾选任一个，父级节点就勾选中，如果子级节点全部不勾选则父节点不勾选，否则勾选 ，效果如下：</p> 
<p><img alt="" height="267" src="https://images2.imgbox.com/b9/f1/XasdN9UY_o.png" width="223"></p> 
<p>代码实现如下所示：</p> 
<p>1、封装组件 setTableToolbar</p> 
<p>vue 部分</p> 
<pre><code class="language-html">&lt;template&gt;
    &lt;div class="toolbar-meta"&gt;  
        &lt;vxe-pulldown  ref="vxePulldown" transfer @hide-panel="hidePanel"&gt;
            &lt;template #default&gt;
                &lt;a-button  shape="circle" @click="open()" :size="16"&gt;
                    &lt;vxe-icon style="font-size: 20px;" name="setting"&gt;&lt;/vxe-icon&gt; 
                &lt;/a-button&gt;
            &lt;/template&gt; 
            &lt;template  #dropdown&gt; 
                &lt;div class="downBox" &gt;
                    &lt;!-- &lt;div class="checkTopAll"&gt; 
                        &lt;a-checkbox 
                        v-model="checkAll"  
                        @change="onCheckAllChange"
                        &gt;全部
                        &lt;/a-checkbox&gt;
                    &lt;/div&gt; --&gt;
                    &lt;div class="checkItem"&gt; 
                        &lt;a-tree  
                            v-if="plainOptions.length&gt;0"
                            checkable
                            :checkStrictly="true"
                            :tree-data="plainOptions"  
                            :expandedKeys="expandedKeys"
                            :checkedKeys="checkedList"
                            :replace-fields="{children: 'children', title: 'title', key: 'id'}"
                            @expand="onExpand" 
                            @check="checkNode"
                        /&gt;
                    &lt;/div&gt;
                     &lt;!-- 底部按钮 --&gt;
                     &lt;div  class="downBtn clearfix"&gt;
                        &lt;a-button class="btnOk" @click="sumbitOk"&gt;确认&lt;/a-button&gt;
                        &lt;a-button class="btnReset" @click="sumbitReset"&gt;全选&lt;/a-button&gt;
                     &lt;/div&gt;
                &lt;/div&gt; 
            &lt;/template&gt;
        &lt;/vxe-pulldown&gt; 
    &lt;/div&gt;
&lt;/template&gt;</code></pre> 
<p> js部分代码设置：</p> 
<pre><code class="language-javascript">export default {
    name: 'setTableToolbar',
    components: { 
    },
    props: { 
        columns: {
            type: Array, 
            default: [],
        }
    },
    data(){
        return { 
            expandParent: true,
            expandedKeys: [],
            indeterminate: true,
            userInfo: {},
            checkAll: false,
            checkedList: [],
            plainOptions: [],
            Downtype: false
        }
    }, 
    watch: {
        checkedList() { // 监听设置
            this.isCheckedAll()
        },
    },
    methods:{
        open(){
            this.$refs.vxePulldown.togglePanel() 
            if(this.Downtype){
                this.sumbitOk()
                // this.$refs.vxePulldown.hidePanel() 
            } else {
                this.Downtype = !this.Downtype
            } 
        },
        // 隐藏 执行保存
        hidePanel(){
            this.sumbitOk()
        },
        // 父级节点展开、收缩事件
        onExpand(select, e){
            let val = e.node.eventKey || '' 
            if(this.expandedKeys.indexOf(val) &gt; -1) { 
                this.expandedKeys.splice(this.expandedKeys.indexOf(val), 1) 
            } else {
                this.expandedKeys.push(val) 
            } 
        }, 
        // 
        /**
         * 初始设置
         * @param {*} arr  所有选择项
         * @param {*} selearr  已选择项
         * @param {*} info  用户信息 保存使用
         */
        resetListLable(arr, selearr, info){
            this.userInfo = info || {}
            let plainOptions = []
            arr.forEach((item, i) =&gt; {
                if(item.title&amp;&amp;item.dataIndex&amp;&amp;item.dataIndex != 'action'){
                    item.id = item.dataIndex 
                    item.key = '0-'+i
                    if(item.children &amp;&amp; item.children.length&gt;0){
                        item.disabled = true
                        item.children.forEach((itm,u)=&gt;{
                            itm.id = itm.dataIndex ? itm.dataIndex : 'p-'+i +'-'+u
                            itm.key = '0-'+i +'-'+u
                            if(itm.children&amp;&amp;itm.children.length&gt;0){
                                itm.disabled = true
                                itm.children.forEach((imt,ui)=&gt;{
                                    imt.id= imt.dataIndex ? imt.dataIndex : 'p-'+i +'-'+u+'-'+ui
                                    imt.key = '0-'+i +'-'+u+'-'+ui
                                })
                            }
                        })
                    } 
                    plainOptions.push(item) 
                } 
            });
            this.plainOptions = plainOptions 
            let seletOption = [] 
            if(selearr){
                selearr.forEach(itm =&gt; {
                    if(itm.title&amp;&amp;itm.dataIndex&amp;&amp;itm.dataIndex != 'action'){  
                        let objItem = itm.dataIndex
                        seletOption.push(objItem)
                        if(itm.children&amp;&amp;itm.children.length&gt;0){
                            itm.children.forEach(itm2=&gt;{
                                seletOption.push(itm2.dataIndex)
                                if(itm2.children&amp;&amp;itm2.children.length&gt;0){
                                    itm2.children.forEach(itm3=&gt;{
                                        seletOption.push(itm3.dataIndex) 
                                    })
                                }
                            })
                        }
                    } 
                }); 
            }
           this.checkedList = seletOption
        },
        //选择点击 
        checkNode(check, e){
            this.checkedList =  e.checkedNodes &amp;&amp;  e.checkedNodes.length&gt;0 ? e.checkedNodes.map(x=&gt;{return x.key}) : []  
           this.parentCheckNode(check, e)
        },
        // 判断是否选择父节点
        parentCheckNode(check, e){ 
           this.plainOptions.forEach((item,u)=&gt;{
                if(this.checkedList.indexOf(item.id) &gt; -1) {
                    let isHaveParent = true
                    // 查子节点内是否
                    if(e.checked == false &amp;&amp; item.children &amp;&amp; item.children.length&gt;0){ 
                        item.children.forEach((itm,b)=&gt;{
                            if(this.checkedList.indexOf(itm.id) &gt; -1) { 
                                let isPHaveParent = true
                                if(e.checked == false &amp;&amp; itm.children &amp;&amp; itm.children.length&gt;0){
                                    itm.children.forEach(itm2=&gt;{
                                        if(this.checkedList.indexOf(itm2.id) &gt; -1) {
                                            isPHaveParent = false
                                            return
                                        }
                                    })
                                    if(isPHaveParent == true){
                                        this.checkedList.splice(this.checkedList.indexOf(itm.id), 1)  
                                        return
                                    } 
                                } else {
                                    isHaveParent = false 
                                    return
                                } 
                            }  
                        })
                        if(isHaveParent == true){
                            this.checkedList.splice(this.checkedList.indexOf(item.id), 1)  
                            return
                        }
                    } else {
                        return
                    } 
                    return
                } else { 
                   if(item.children &amp;&amp; item.children.length&gt;0){
                        item.children.forEach((itm,b)=&gt;{
                            if(this.checkedList.indexOf(itm.id) &gt; -1) { 
                                this.checkedList.push(item.id)
                                return
                            } else { 
                                if(itm.children&amp;&amp;itm.children.length&gt;0){
                                    itm.children.forEach((imt,ui)=&gt;{
                                        if(this.checkedList.indexOf(imt.id) &gt; -1) { 
                                            this.checkedList.push(item.id)
                                            this.checkedList.push(imt.id)
                                            return
                                        }   
                                    })
                                }
                            }
                          
                        })
                    }
                } 
           })
        },
         // 查看点击事件
        selectNode(selectkey, e){  
            let node_eventKey = e.node.eventKey || ''  
            this.param = { 
                id: node_eventKey,
                title: e.node.title || '',
            }
            this.selectKeys = [node_eventKey]  
        }, 
        // 全选设置
        onCheckAllChange(e){ 
            let newList = []
            if(e.target.checked){
                this.plainOptions.forEach(item =&gt;{
                    newList.push(item.dataIndex)
                })
            } 
            this.checkedList = newList  
            this.isCheckedAll()
        },
        // 判断是否全选
        isCheckedAll(){
            let isAll = false
            isAll = this.checkedList.length == this.plainOptions.length ? true : false
            this.indeterminate = isAll
            this.checkAll = isAll
        },
        // 确认选中
        sumbitOk(){
            let extend = this.checkedList.join(',') 
            this.$emit('isSettingColumnsOk', this.checkedList)
            this.$refs.vxePulldown.hidePanel() 
            this.Downtype = false
        },
        // 还原全选
        sumbitReset(){
            this.checkAll = true
            let newList = []
            this.plainOptions.forEach(item =&gt;{
                newList.push(item.dataIndex)
                if(item.children &amp;&amp; item.children.length&gt;0){
                    item.children.forEach((itm,u)=&gt;{
                        newList.push(itm.dataIndex)
                        if(itm.children&amp;&amp;itm.children.length&gt;0){
                            itm.children.forEach((imt,ui)=&gt;{
                                newList.push(imt.dataIndex)
                            })
                        }
                    })
                }
            })
            this.checkedList = newList
            let extend = this.checkedList.join(',')
            this.$nextTick(() =&gt; { 
                this.$emit('isSettingColumnsOk', this.checkedList)
                this.$refs.vxePulldown.hidePanel() 
                this.Downtype = false
            })
        }, 
    }
}</code></pre> 
<p>style 样式部分修改；</p> 
<pre><code class="language-css">.toolbar-meta{
    position: relative; 
}
.downBox{
        width: 220px;
        position: relative;
        overflow: hidden;
        border: 1px solid #999;
        border-radius: 4px;
        .checkTopAll{
            position: absolute; 
            top: 0;
            left: 0;
            border-bottom: 1px solid #999;
            padding: 10px 5px;
            width:100%;
            background-color: #fff; 
            z-index: 999;
        }
        .checkItem{
            position: relative;
            width: 220px; 
            max-height:200px; 
            overflow:auto; 
            padding: 10px;
            margin-bottom: 40px;
            .checkLi{
                display: block;
                width: 100%;
            }
            .ant-checkbox-group-item{
                display: block;
            }
        }
        .downBtn{
            position: absolute;
            z-index: 999;
            bottom: 0;
            left: 0;
            width: 100%;
            padding: 5px 10px; 
            background: #fff;
            border-top:1px solid #999;
            .btnReset{
                float: right;
            }
        }
    }</code></pre> 
<p>2、引用组件：setTableToolbar</p> 
<pre><code class="language-html">&lt;set-table-toolbar ref="setTableToolbar1" :columns="defColumns" @isSettingColumnsOk="isSettingColumnsOk" @reshload="reshColumns"&gt;&lt;/set-table-toolbar&gt;

&lt;script&gt;
// 列配置
import setTableToolbar from "./common/setTableToolbar.vue"
export default {
    components: {
        setTableToolbar 
    },
    data() {
        return {
            tableColumnsParams:{},
            settingColumns: [],
            defColumns: []
        }
    },
    methods:{
        // 配置列点击确认
     isSettingColumnsOk(settingColumnsStr){ 
       if (settingColumnsStr&amp;&amp;settingColumnsStr.length&gt;0) {
        this.settingColumns = settingColumnsStr
        let params = {
          'id': this.tableColumnsParams.id || '',
          'tableId': this.tableColumnsParams.cgformHeadId || this.code,
          'conntent': settingColumnsStr.join(',')
        }
       Vue.ls.set('保存缓存名字', settingColumnsStr.join(','))
        // this.saveColumnsHiding(params)
      } 
    },
    // 配置列后获取
    reshColumns(){  
        this.$nextTick(() =&gt; { 
            this.loadData(1)
        })
    },
    }
}
&lt;/script&gt;</code></pre> 
<p>补充，其他设置：初始执行设置被选项，已选项等；</p> 
<p> this.$refs.setTableToolbar.resetListLable(this.defColumns, cols, info)</p> 
<p>以上内容仅供参考，具体请根据实际情况选用；</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/18f5bb92bd04204cb49b48015ef10e8b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue中如何让el-date-picker时间选择器组件结束时间不早于开始时间？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bb235495507afaa91e6d788b41930778/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue&#43;element-UI实现跟随滚动条加载表格数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>