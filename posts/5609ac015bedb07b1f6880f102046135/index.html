<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>h5动态/接口获取title - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="h5动态/接口获取title" />
<meta property="og:description" content="1.动态设置title router/index.js文件里的信息。在meta对象里面配置一个title
{ path: &#34;/&#34;, name: &#34;Home&#34;, meta: { title: &#34;首页&#34;//这是重点 }, } 在main.js中，使用路由守卫beforeEach，在路由跳转之前判断跳转之后的页面是否配置的有title值。如果有则替换title，如果没有则保持title不变。
router.beforeEach((to, from, next) =&gt; { if (to.meta.title) { //判断是否设置title document.title = to.meta.title } }) 2.接口赋值title（首页） 接口异步调用会导致赋值延迟，不可以在beforeEach或页面内beforeRouteEnter中异步调用接口赋值title，会导致当前页面渲染不成功，跳转后渲染至下一页面
//设置title 在main中封装，next()之前调用;queryParams为浏览器参数，判断宿主,to为router.beforeEach中路由 await setTitle(queryParams,to); //设置title async function setTitle(QP,To){ if (To.meta.title) { if(QP.state == &#39;YSF&#39;){ //YSF--宿主为云闪付（云闪付内嵌小程序） window.upsdk.pluginReady (function(){ if(To.meta.title == &#39;首页&#39;|| To.meta.title == &#39;我的&#39;){ window.upsdk.setTitleStyle({ backBtnVisible: &#39;0&#39;, // 可选，左侧返回按钮是否显示。&#39;0&#39;不显示，&#39;1&#39;显示，不传或空则默认显示 }); }else{ window.upsdk.setTitleStyle({ backBtnVisible: &#39;1&#39;, // 可选，左侧返回按钮是否显示。&#39;0&#39;不显示，&#39;1&#39;显示，不传或空则默认显示 }); } window.upsdk.setNavigationBarTitle({ title: To." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5609ac015bedb07b1f6880f102046135/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-27T09:39:45+08:00" />
<meta property="article:modified_time" content="2022-07-27T09:39:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">h5动态/接口获取title</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4><strong>1.动态设置title</strong></h4> 
<p>router/index.js文件里的信息。在meta对象里面配置一个title</p> 
<pre><code class="language-javascript">{
    path: "/",
    name: "Home",
    meta: {
      title: "首页"//这是重点
    },
 }
</code></pre> 
<p>在main.js中，使用路由守卫beforeEach，在路由跳转之前判断跳转之后的页面是否配置的有title值。如果有则替换title，如果没有则保持title不变。</p> 
<pre><code class="language-javascript">router.beforeEach((to, from, next) =&gt; {
  if (to.meta.title) { //判断是否设置title
    document.title = to.meta.title
  }
})
</code></pre> 
<h4>2.接口赋值title（首页）</h4> 
<p>接口异步调用会导致赋值延迟，不可以在beforeEach或页面内beforeRouteEnter中异步调用接口赋值title，会导致当前页面渲染不成功，跳转后渲染至下一页面</p> 
<pre><code class="language-javascript">//设置title 在main中封装，next()之前调用;queryParams为浏览器参数，判断宿主,to为router.beforeEach中路由
await setTitle(queryParams,to);

//设置title
async function setTitle(QP,To){
  if (To.meta.title) {
    if(QP.state == 'YSF'){   //YSF--宿主为云闪付（云闪付内嵌小程序）
      window.upsdk.pluginReady (function(){
        if(To.meta.title == '首页'|| To.meta.title == '我的'){
          window.upsdk.setTitleStyle({
            backBtnVisible: '0', // 可选，左侧返回按钮是否显示。'0'不显示，'1'显示，不传或空则默认显示
          });
        }else{
          window.upsdk.setTitleStyle({
            backBtnVisible: '1', // 可选，左侧返回按钮是否显示。'0'不显示，'1'显示，不传或空则默认显示
          });
        }
        window.upsdk.setNavigationBarTitle({
            title: To.meta.title
        });
      })
    }else if(QP.state == 'DD'){ //YSF--宿主为钉钉（钉钉内嵌小程序）
      dd.ready(function() {
        if(To.path == "/"){
         //接口调用，调用钉钉api赋值title
          http.configKey().then(TempOpen=&gt;{
            if(TempOpen[1].data){
              // document.title = TempOpen[1].data;
              dd.biz.navigation.setTitle({
                title: TempOpen[1].data,
              })
            }else {
              dd.biz.navigation.setTitle({
                title: To.meta.title,
              })
            }
          });
        }else{
          dd.biz.navigation.setTitle({
            title: To.meta.title,
          })
        }
      })
    }
    else{
        //其他宿主使用iframe,目前仅验证微信内嵌公众号可行，其他未验证
      if(To.path == "/"){
        console.log('首页更换title_main_function')
        let sendInfo = {
          schoolId:0,
          configKey:'h5.index.title'
        }
        var TempOpen = await http.configKey(sendInfo);
        if(TempOpen[1].data){
          document.title = TempOpen[1].data
        } else {
          document.title = ''
        }
        let iframe = document.createElement('iframe');
        // iframe.src = require('./favicon.ico');
        iframe.style.display = 'none';
        // 这个就是我们异步获取 title 的函数
        let fn = function () {
          setTimeout(function () {
            iframe.removeEventListener('load', fn);
            document.body.removeChild(iframe);
            console.log('title', document.title);
          }, 0);
        };

        iframe.addEventListener('load', fn);
        document.body.appendChild(iframe);
      }else{
        document.title = To.meta.title
      }
    }
  }
}</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fa57b1e79f7e18c350d1a28136d6af32/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">几分钟带你认识vuex的五个核心属性</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a4fedead4ad241ee04c9659b4ed2a6fb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vuex的五个属性</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>