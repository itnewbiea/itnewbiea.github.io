<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>仿QQ底部退出弹出框 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="仿QQ底部退出弹出框" />
<meta property="og:description" content="简述：
前段时间碰到了类似QQ点击头像弹出对话框的需求，为此自己写了demo。可后来发现用到该自定义View的地方不是一处，而且item的数量也不一样，为了能够随意添加item数量，于是就对代码进行了重构，今天就来记录一下。
效果图： 方案： 有两种实现方式：
第一种采用popupWindow的方式，但是利用这种方式实现会出现问题：在有虚拟键的手机中，在正在显示上图效果时如果突然隐藏虚拟键，那么这个效果图不会自动下沉，而本来虚拟键的位置会显示留白，所以这种方案是不太理想的。
第二种方案，也就是本片博客采用的方案：利用Dialog的方式，这种方式不会出现第一种方案的问题。该视图分为两个部分：它上半部分采用一个ListView（“版本更新”、“反馈”、“退出QQ”），注意这个Dialog必须去除去除Title，否则虽然Title不显示它依然存在而影响Dialog的点击事件。下半部分是一个TextView（“取消”）。
方案实现：
接下来看一下具体的实现：
一、首先我们定义两个Dialog的Style：
1：首先定义一个Dialog的主题theme的style，代码如下：
&lt;style name=&#34;transparentFrameWindowStyle&#34; parent=&#34;android:style/Theme.Dialog&#34;&gt; &lt;!-- 边框 --&gt; &lt;item name=&#34;android:windowFrame&#34;&gt;@null&lt;/item&gt; &lt;!-- 是否有标题（去除标题） --&gt; &lt;item name=&#34;android:windowNoTitle&#34;&gt;true&lt;/item&gt;&lt;/span&gt; &lt;!-- 是否浮现在activity之上 --&gt; &lt;item name=&#34;android:windowIsFloating&#34;&gt;true&lt;/item&gt; &lt;!-- 半透明 --&gt; &lt;item name=&#34;android:windowIsTranslucent&#34;&gt;false&lt;/item&gt; &lt;!-- 背景透明 --&gt; &lt;item name=&#34;android:windowBackground&#34;&gt;@android:color/transparent&lt;/item&gt; &lt;!-- Dialog背景模糊 --&gt; &lt;item name=&#34;android:backgroundDimEnabled&#34;&gt;true&lt;/item&gt; &lt;/style&gt; 2：再定义一个Dialog的显示与消失的动画Style，代码如下： &lt;style name=&#34;bottom_dialog_anim_style&#34;&gt; &lt;item name=&#34;android:windowEnterAnimation&#34;&gt;@anim/bottom_dialog_in_anim&lt;/item&gt; &lt;item name=&#34;android:windowExitAnimation&#34;&gt;@anim/bottom_dialog_out_anim&lt;/item&gt; &lt;/style&gt; 在这用到了两个动画， bottom_dialog_in_anim动画和 bottom_dialog_out_anim动画。 bottom_dialog_in_anim动画如下：
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;set xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34; &gt; &lt;translate android:duration=&#34;200&#34; android:fromXDelta=&#34;0&#34; android:fromYDelta=&#34;0&#34; android:toXDelta=&#34;0&#34; android:toYDelta=&#34;1000&#34; /&gt; &lt;/set&gt; bottom_dialog_out_anim动画代码如下： &lt;?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8e0216cb231fc95598b6b1eaf135b5da/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-04-18T23:14:38+08:00" />
<meta property="article:modified_time" content="2016-04-18T23:14:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">仿QQ底部退出弹出框</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><span style="font-family:FangSong_GB2312"><strong><span style="font-size:18px">简述：</span><span style="font-size:14px"><br> </span></strong></span></h2> 
<p><span style="font-family:FangSong_GB2312; font-size:14px">    前段时间碰到了类似QQ点击头像弹出对话框的需求，为此自己写了demo。可后来发现用到该自定义View的地方不是一处，而且item的数量也不一样，为了能够随意添加item数量，于是就对代码进行了重构，今天就来记录一下。</span><strong><span style="font-family:FangSong_GB2312"><br> </span></strong></p> 
<h2><span style="font-size:18px"><strong><span style="font-family:FangSong_GB2312">效果图：</span></strong></span></h2> 
<p>                                          <img src="https://images2.imgbox.com/ce/0e/drrthGj5_o.png" alt="" height="450" width="280"></p> 
<h2><strong><span style="font-size:18px">方案：</span></strong></h2> 
<p><span style="font-size:14px"><strong>有两种实现方式：</strong></span></p> 
<p><span style="font-size:14px">第一种采用popupWindow的方式，但是利用这种方式实现会出现问题：在有虚拟键的手机中，在正在显示上图效果时如果突然隐藏虚拟键，那么这个效果图不会自动下沉，而本来虚拟键的位置会显示留白，所以这种方案是不太理想的。</span></p> 
<p><span style="font-size:18px"><span style="font-size:14px">第二种方案，也就是本片博客采用的方案：利用Dialog的方式，这种方式不会出现第一种方案的问题。该视图分为两个部分：它上半部分采用一个ListView（“版本更新”、“反馈”、“退出QQ”），注意这个Dialog必须去除去除Title，否则虽然Title不显示它依然存在而影响Dialog的点击事件。下半部分是一个TextView（“取消”）。</span><br> </span></p> 
<h2><strong><span style="font-size:18px">方案实现：<br> </span></strong></h2> 
<p>接下来看一下具体的实现：</p> 
<h3><span style="">一、首先我们定义两个Dialog的Style：</span><br> </h3> 
<p><span style="">1：首先定义一个Dialog的主题theme的style，代码如下：</span><br> </p> 
<pre><code class="language-html">&lt;style name="transparentFrameWindowStyle" parent="android:style/Theme.Dialog"&gt;
        &lt;!-- 边框 --&gt;
        &lt;item name="android:windowFrame"&gt;@null&lt;/item&gt;
        &lt;!-- 是否有标题（去除标题） --&gt;
        &lt;item name="android:windowNoTitle"&gt;true&lt;/item&gt;&lt;/span&gt;
        &lt;!-- 是否浮现在activity之上 --&gt;
        &lt;item name="android:windowIsFloating"&gt;true&lt;/item&gt;
        &lt;!-- 半透明 --&gt;
        &lt;item name="android:windowIsTranslucent"&gt;false&lt;/item&gt;
        &lt;!-- 背景透明 --&gt;
        &lt;item name="android:windowBackground"&gt;@android:color/transparent&lt;/item&gt;
        &lt;!-- Dialog背景模糊 --&gt;
        &lt;item name="android:backgroundDimEnabled"&gt;true&lt;/item&gt;
    &lt;/style&gt;
</code></pre> 
<br> 
<p><span style="">2：再定义一个Dialog的显示与消失的动画Style，代码如下：</span> <br> </p> 
<p></p> 
<pre><code class="language-html">&lt;style name="bottom_dialog_anim_style"&gt;
        &lt;item name="android:windowEnterAnimation"&gt;@anim/bottom_dialog_in_anim&lt;/item&gt;
        &lt;item name="android:windowExitAnimation"&gt;@anim/bottom_dialog_out_anim&lt;/item&gt;
    &lt;/style&gt;</code></pre> 
<br> 在这用到了两个动画， 
<span style="">  </span> 
<span style="">bottom_dialog_in_anim动画和<span style=""> </span><span style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">bottom_dialog_out_anim</span>动画</span></span>。 
<p></p> 
<p><span style=""></span><span style="">bottom_dialog_in_anim</span>动画如下：</p> 
<pre><code class="language-html">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;set xmlns:android="http://schemas.android.com/apk/res/android" &gt;

    &lt;translate
        android:duration="200"
        android:fromXDelta="0"
        android:fromYDelta="0"
        android:toXDelta="0"
        android:toYDelta="1000" /&gt;

&lt;/set&gt;</code></pre> 
<span style=""><span style=""><span style="font-family:微软雅黑; font-size:14px; color:#000000; background-color:rgb(255,255,255); font-style:normal; font-weight:normal; text-align:left">bottom_dialog_out_anim</span>动画</span></span>代码如下： 
<p></p> 
<p></p> 
<pre><code class="language-html">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;set xmlns:android="http://schemas.android.com/apk/res/android" &gt;

    &lt;translate
        android:duration="200"
        android:fromXDelta="0"
        android:fromYDelta="0"
        android:toXDelta="0"
        android:toYDelta="1000" /&gt;

&lt;/set&gt;
</code></pre> 
<br> 
<h3><span style="">二、布局文件</span></h3> 
<p></p> 
<p><span style="">  从刚才的效果图中，BottomDialog的布局文件整体利用LinearLayout，在LinearLayout中嵌套一个ListView和一个TextView，代码如下：</span></p> 
<pre><code class="language-html">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="#00000000"
    android:gravity="bottom"
    android:orientation="vertical"
    android:paddingLeft="10dp"
    android:paddingRight="10dp" &gt;

    &lt;ListView
        android:id="@+id/txt_dialog_listview"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:background="@drawable/bottom_dialog_bg_shape"
        android:divider="#DAD9DB"
        android:dividerHeight="1dp" /&gt;

    &lt;TextView
        android:id="@+id/txt_cancel"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:layout_marginBottom="10dp"
        android:layout_marginTop="8dp"
        android:background="@drawable/bottom_dialog_item_selector"
        android:gravity="center_horizontal"
        android:paddingBottom="8dp"
        android:paddingTop="8dp"
        android:text="取消"
        android:textColor="#1C86EE"
        android:textSize="19sp" /&gt;

&lt;/LinearLayout&gt;</code></pre> 
<br> 
<span style="">另外ListView的item布局bottom_dialog_item.xml就一个TextView如下:</span> 
<p></p> 
<pre><code class="language-html">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;LinearLayout xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:tools="http://schemas.android.com/tools"
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:orientation="vertical" &gt;

    &lt;TextView
        android:id="@+id/txt_list_item"
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:background="@drawable/bottom_dialog_item_selector"
        android:gravity="center_horizontal"
        android:paddingBottom="8dp"
        android:paddingTop="8dp"
        android:text="拍照"
        android:textColor="#1C86EE"
        android:textSize="19sp"
        tools:ignore="HardcodedText" /&gt;

&lt;/LinearLayout&gt;</code></pre> 
<br> 
<span style="">ok到此布局文件编写完毕，下面我们就是Java代码的实现部分了。</span> 
<p></p> 
<h3><span style=""><span style="">三、代码实现</span></span></h3> 
<p><span style=""><span style="">1.<span style="">BottomDialog</span><br> </span></span></p> 
<p><span style="">1）、 首先也是最重要的代码部分就是自定义BottomDialog，让其集成Dialog，OK，既然是集成Dialog那就必须要重写构造方法，我们在构造方法中要完成加载我们的布局文件、初始化变量和初始化布局文件3项任务。代码如下：</span><br> </p> 
<p></p> 
<pre><code class="language-html">public BottomDialog(Context context, int themeResId) {
  super(context, themeResId);
  initVars(context);
  setContentView(view, new LayoutParams(LayoutParams.MATCH_PARENT,
    LayoutParams.WRAP_CONTENT));
  initViews();
 }</code></pre> 
<span style="">①：我们先看一下初始化类中变量的方法initVars（Context context），这个方法代码如下：初始化上下文mCtx、ListView和布局View变量。</span> 
<pre><code class="language-html">private void initVars(Context context) {
  this.mCtx = context;
  mListItem = new ArrayList&lt;DialogListViewItem&gt;();
  view = LayoutInflater.from(context).inflate(R.layout.bottom_dialog, null); 
 }</code></pre> 
<br> 
<span style="">②：将刚才初始化的布局view变量添加到Dialog窗体中：</span> 
<pre><code class="language-html">setContentView(view, new LayoutParams(LayoutParams.MATCH_PARENT,LayoutParams.WRAP_CONTENT));</code></pre> 
<br> 
<span style="">③：初始化布局控件方法initViews（），刚才我们看到布局文件中就两个基本控件：ListView和TextView，OK，在该方法中我们就做初始化ListView和TextView的任务：</span> 
<p></p> 
<p></p> 
<pre><code class="language-html">private void initViews() {

  initListView();

  initTextView();
 }</code></pre> 
<br> 
<span style="">在初始化ListView方法中，主要是设置Item的点击监听，其中</span> 
<span style="">bottomDialogItemOnClickListener为自定义的接口，</span> 
<span style="">代码如下</span>： 
<p></p> 
<p></p> 
<pre><code class="language-html">/**
	 * 功能描述：初始化ListView控件
	 * 
	 * @Time 2016年4月18日
	 * @Author lizy18
	 */
	private void initListView() {
		listView = (ListView) this.findViewById(R.id.txt_dialog_listview);
		listView.setOnItemClickListener(new OnItemClickListener() {

			@Override
			public void onItemClick(AdapterView&lt;?&gt; parent, View view,
					int position, long id) {
				dismiss();
				if (bottomDialogItemOnClickListener != null) {
					bottomDialogItemOnClickListener.onItemClick(
							mListItem.get(position), position);
				}
			}
		});
	}
</code></pre> 
<br> 
<span style="">在初始化TextView中比较简单，该控件的作用：点击取消Dialog。</span> 
<p></p> 
<p></p> 
<pre><code class="language-html">/**
	 * 功能描述：初始化"取消"按钮控件
	 * 
	 * @Time 2016年4月18日
	 * @Author lizy18
	 */
	private void initTextView() {
		cancel = (TextView) this.findViewById(R.id.txt_cancel);
		cancel.setOnClickListener(new android.view.View.OnClickListener() {

			@Override
			public void onClick(View v) {
				dismiss();
			}

		});
	}</code></pre> 
<br> 2）、 
<span style="">那么接下来就是展示对话对话框的时候啦，请看代码：</span> 
<p></p> 
<p></p> 
<pre><code class="language-html">/**
	 * 功能描述：展示对话框
	 * 
	 * @Time 2016年4月18日
	 * @Author lizy18
	 */
	public void show() {
		/**
		 * 待显示的数据
		 */
		listView.setAdapter(new DialogListViewAdapter(mCtx, mListItem));
		/**
		 * 展示的位置
		 */
		Window window = getWindow();
		window.setWindowAnimations(R.style.bottom_dialog_anim_style);
		android.view.WindowManager.LayoutParams attributes = window
				.getAttributes();
		attributes.x = 0;
		attributes.y = ScreenUtil.getScreenHeight(mCtx);
		attributes.width = ViewGroup.LayoutParams.MATCH_PARENT;
		attributes.height = ViewGroup.LayoutParams.WRAP_CONTENT;
		// 仿照QQ这设施透明度
		attributes.alpha = 0.7f;
		onWindowAttributesChanged(attributes);

		// 设置点击外围解散dialog
		this.setCanceledOnTouchOutside(true);

		super.show();
	}
</code></pre> 
<br> 
<div style="">
  改段代码主要3个部分：加载数据、配置Dialog的窗体属性和展示； 
</div> 
<div style="">
  ①加载数据用到了自定义的Adapter：DialogListViewAdapter，这是一个基本的自定义Adapter，相信大家应该不会有太大问题： 
</div> 
<pre><code class="language-html">/**
 * 类描述：ButtomDialog适配器
 * 
 * @Time 2016年4月18日
 * @author lizy18
 */
public class DialogListViewAdapter extends BaseAdapter {
	private LayoutInflater layoutInflater;
	private List&lt;DialogListViewItem&gt; mList;

	public DialogListViewAdapter(Context context, List&lt;DialogListViewItem&gt; list) {
		layoutInflater = LayoutInflater.from(context);
		this.mList = list;
	}

	@Override
	public int getCount() {
		return mList.size();
	}

	@Override
	public Object getItem(int position) {
		return mList.get(position);
	}

	@Override
	public long getItemId(int position) {
		return position;
	}

	@SuppressLint("InflateParams")
	@Override
	public View getView(int position, View convertView, ViewGroup parent) {
		ViewHolder viewHolder = null;
		if (convertView == null) {
			viewHolder = new ViewHolder();
			convertView = layoutInflater.inflate(R.layout.bottom_dialog_item, null);
			viewHolder.text = (TextView) convertView
					.findViewById(R.id.txt_list_item);

			convertView.setTag(viewHolder);

		} else {
			viewHolder = (ViewHolder) convertView.getTag();
		}
		DialogListViewItem dialogListViewItem = mList.get(position);
		CharSequence text = dialogListViewItem.getText();
		viewHolder.text.setText(text);

		return convertView;
	}

	class ViewHolder {
		TextView text;
	}

}
</code></pre>上面我们用到一个实体类DialogListViewItem： 
<p></p> 
<p></p> 
<pre><code class="language-html">/**
 * 类描述：ButtomDialog中ListView数据应用的实体类
 * 
 * @Time 2016年4月18日
 * @author lizy18
 */
public class DialogListViewItem {
	CharSequence text;

	public DialogListViewItem(CharSequence text) {
		this.text = text;
	}

	public CharSequence getText() {
		return text;
	}

	public void setText(CharSequence text) {
		this.text = text;
	}

}
</code></pre> 
<p>为此我们需要利用“依赖注入”方式提供一个为ListView添加数据的方法：</p> 
<p></p> 
<pre><code class="language-html">/**
	 * 功能描述："依赖注入"添加DialogListViewItem对象
	 * 
	 * @Time 2016年4月18日
	 * @Author lizy18
	 */
	public void addItem(DialogListViewItem item) {
		if (item != null) {
			mListItem.add(item);
		} else {
			throw new NullPointerException("DialogListViewItem对象不能为空！");
		}
	}
</code></pre> 
<br> ②配置Dialog的窗体属性 
<p></p> 
<p></p> 
<pre><code class="language-html">Window window = getWindow();
		window.setWindowAnimations(R.style.bottom_dialog_anim_style);
		android.view.WindowManager.LayoutParams attributes = window
				.getAttributes();
		attributes.x = 0;
		attributes.y = ScreenUtil.getScreenHeight(mCtx);
		attributes.width = ViewGroup.LayoutParams.MATCH_PARENT;
		attributes.height = ViewGroup.LayoutParams.WRAP_CONTENT;
		// 仿照QQ这设施透明度
		attributes.alpha = 0.7f;
		onWindowAttributesChanged(attributes);

		// 设置点击外围解散dialog
		this.setCanceledOnTouchOutside(true);</code></pre> 
<p></p> 
<p>OK，代码就这么些，接下来测试一下。</p> 
<h3>四、测试<br> </h3> 
<p>测试代码如下：</p> 
<pre><code class="language-html">/**
 * 类描述：BottomDialog测试类
 * 
 * @Time 2016年4月18日
 * @author lizy18
 */
public class MainActivity extends Activity implements
		OnBottomDialogItemOnClickListener {

	private Button btn;

	@Override
	protected void onCreate(Bundle savedInstanceState) {
		super.onCreate(savedInstanceState);
		setContentView(R.layout.activity_main);

		initViews();
	}

	/**
	 * 功能描述：初始化布局控件
	 * 
	 * @Time 2016年4月18日
	 * @Author lizy18
	 */
	private void initViews() {
		btn = (Button) findViewById(R.id.btn);
		btn.setOnClickListener(new OnClickListener() {

			@Override
			public void onClick(View v) {
				showBottomDialog();
			}
		});

	}

	/**
	 * 功能描述：展示BottomDialog
	 * 
	 * @Time 2016年4月18日
	 * @Author lizy18
	 */
	protected void showBottomDialog() {
		BottomDialog dialog = new BottomDialog(MainActivity.this,
				R.style.transparentFrameWindowStyle);
		dialog.setOnBottomDialogItemOnClickListener(this);
		dialog.addItem(new DialogListViewItem("版本更新"));
		dialog.addItem(new DialogListViewItem("反馈"));
		dialog.addItem(new DialogListViewItem("退出QQ"));
		dialog.show();
	}

	/**
	 * 功能描述:点击事件的处理
	 */
	@Override
	public void onItemClick(DialogListViewItem item, int position) {
		switch (position) {
		case 0:
			Toast.makeText(MainActivity.this,
					"点击了位置" + position + ":  " + item.getText(),
					Toast.LENGTH_SHORT).show();
			break;
		case 1:
			Toast.makeText(MainActivity.this,
					"点击了位置" + position + ":  " + item.getText(),
					Toast.LENGTH_SHORT).show();
			break;
		default:
			break;
		}

	}

}
</code></pre> 
<br> 注意：new BottomDialog对象的时候要用到theme主题。 
<p></p> 
<p><span style="font-size:18px">上述完整源码下载链接</span>：<span style="font-size:18px; color:#3333FF"><a target="_blank" href="http://download.csdn.net/detail/u012810020/9495139" rel="noopener noreferrer">仿QQ底部退出弹出框</a></span><br> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0438cbd2d189f50e64d740ce088245c9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mercurial(5)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6769215769676b241e01b78ada41b437/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">出现rpm: command not found</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>