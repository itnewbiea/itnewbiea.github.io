<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>char data[0] 用法及意义 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="char data[0] 用法及意义" />
<meta property="og:description" content="用法：
struct MyData { int nLen; char data[0]; };
在结构中，data是一个数组名；但该数组没有元素；该数组的真实地址紧随结构体MyData之后，而这个地址就是结构体后面数据的地址（如果给这个结构体分配的内容大于这个结构体实际大小，后面多余的部分就是这个data的内容）。常用于构成动态缓冲区buffer。
采取这样：struct MyData *p = (struct MyData *)malloc(sizeof(struct MyData )&#43;strlen(str))这样就可以通过p-&gt;data 来操作这个str。
int main()
{
int nLen = 10;
char str[10] = &#34;123456789&#34;;
cout &lt;&lt; &#34;Size of MyData: &#34; &lt;&lt; sizeof(MyData) &lt;&lt; endl;
MyData *myData = (MyData*)malloc(sizeof(MyData) &#43; 10);
memcpy(myData-&gt;data, str, 10);
cout &lt;&lt; &#34;myData&#39;s Data is: &#34; &lt;&lt; myData-&gt;data &lt;&lt; endl;
free(myData);
return 0;
}
输出：
Size of MyData: 4" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/41cc3e60233701197271076d0cff20dd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-09-22T00:33:00+08:00" />
<meta property="article:modified_time" content="2015-09-22T00:33:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">char data[0] 用法及意义</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><strong>用法：</strong></span></p> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">struct MyData </span></p> 
 <span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">{<!-- --></span> 
 <br style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> 
 <span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">    int nLen;</span> 
 <br style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> 
 <span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">    char data[0];</span> 
 <br style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">};</span></p> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">在结构中，data是一个数组名；但该数组没有元素；该数组的真实地址紧随结构体MyData之后，而这个地址就是结构体后面数据的地址（如果给这个结构体分配的内容大于这个结构体实际大小，后面多余的部分就是这个data的内容）。常用于构成动态缓冲区buffer。</span><br></span></p> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">采取这样：</span><br style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">struct MyData *p = (struct MyData *)malloc(sizeof(struct MyData )+strlen(str))</span><br style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">这样就可以通过p-&gt;data 来操作这个str。</span><br></span></span></p> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"></span></span></span></p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"> int main()<br> {<!-- --><br>     int nLen = 10;<br>     char str[10] = "123456789";</p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">     cout &lt;&lt; "Size of MyData: " &lt;&lt; sizeof(MyData) &lt;&lt; endl;</p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">     MyData *myData = (MyData*)malloc(sizeof(MyData) + 10);<br>     memcpy(myData-&gt;data,  str, 10);</p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">     cout &lt;&lt; "myData's Data is: " &lt;&lt; myData-&gt;data &lt;&lt; endl;</p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">     free(myData);</p> 
 <p style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">     return 0;<br> }<br> 输出：<br> Size of MyData: 4<br> myData's Data is: 123456789         <br> 由于数组没有元素，该数组在该结构体中分配占用空间，所以sizeof(struct Mydata) = 4。<br> malloc申请的是14个字节的连续空间，它返回一个指针指向这14个字节，强制转换成struct INFO的时候，前面4个字节被认为是Mydata结构，后面的部分拷贝了“123456789”的内容。</p> 
 <strong>意义：</strong> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">1. 方便管理内存缓冲区：如果<span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">用指针 char* 代替 char data[0] 来指向新开辟的str，<span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">需要两次malloc(1次MyData*myd= malloc(sizeof(MyData))， 1次myd-&gt;p = malloc(10))。也需要两次free。用char data[0]，一次malloc即完成，方便管理缓冲区。</span></span></span></span></span></p> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">2. 减少内存碎片化：如果在struct尾部用指针*指向新开辟的buffer长度，struct本身相较buffer长度是很小的，即碎片化的内存。而用char data[0]指向新开辟的buffer，只需一次malloc，struct和buffer的空间是连续的。即减少了内存的碎片化。</span></span></span></p> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">3. <span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">节省空间，相较用指针指向新开辟的str，data[0]是不占用内存的，而指针占用4字节。</span></span></span></span></p> 
 <p><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;"><strong>add on：</strong></span></span></span></span></p> 
 <p><span style="font-family:Arial;font-size:14px;line-height:26px;"><span style="font-family:Arial;font-size:14px;line-height:26px;"><span style="font-family:Arial;font-size:14px;line-height:26px;"><span style="font-family:Arial;font-size:14px;line-height:26px;"><span style="font-family:Arial;font-size:14px;line-height:26px;">结构体中最后一个成员为</span><span style="font-family:Arial;font-size:14px;line-height:26px;">[1]</span><span style="font-family:Arial;font-size:14px;line-height:26px;">长度数组的用法</span><span style="font-family:Arial;font-size:14px;line-height:26px;">：</span><span style="color:rgb(51,51,51);font-family:Arial;font-size:14px;line-height:26px;">与长度为[0]数组的用法相同，改写为[1]是出于可移植性的考虑。有些编译器不支持[0]数组，可将其改成[]或[1].</span><br></span></span></span></span></p> 
</div> 
<p>转载于:https://www.cnblogs.com/hh6plus/p/5548074.html</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fab804c50259e79d009d39b24e96048a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">GTK&#43;浅谈之八表格列表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/75d84adf700cd3bcc848c7be18ccea36/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">3110: [Zjoi2013]K大数查询</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>