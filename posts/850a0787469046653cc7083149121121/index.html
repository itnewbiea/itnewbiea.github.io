<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ubuntu添加和设置开机自动启动程序的方法 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ubuntu添加和设置开机自动启动程序的方法" />
<meta property="og:description" content="ubuntu-18.04 设置开机启动脚本 ubuntu-18.04 设置开机启动脚本
参阅下列链接
https://askubuntu.com/questions/886620/how-can-i-execute-command-on-startup-rc-local-alternative-on-ubuntu-16-10
ubuntu-18.04不能像ubuntu14一样通过编辑rc.local来设置开机启动脚本，通过下列简单设置后，可以使rc.local重新发挥作用。
1、建立rc-local.service文件
1
sudo vi /etc/systemd/system/rc-local.service
2、将下列内容复制进rc-local.service文件
1
2
3
4
5
6
7
8
9
10
11
12
13
14
[Unit]
Description=/etc/rc.local Compatibility
ConditionPathExists=/etc/rc.local
[Service]
Type=forking
ExecStart=/etc/rc.local start
TimeoutSec=0
StandardOutput=tty
RemainAfterExit=yes
SysVStartPriority=99
[Install]
WantedBy=multi-user.target
3、创建文件rc.local　1
sudo vi /etc/rc.local
4、将下列内容复制进rc.local文件
1
2
3
4
5
6
7
8
9
10
11
12
13
14
#!/bin/sh -e
#
# rc.local
#
# This script is executed at the end of each multiuser runlevel." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/850a0787469046653cc7083149121121/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-12T19:12:23+08:00" />
<meta property="article:modified_time" content="2019-11-12T19:12:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ubuntu添加和设置开机自动启动程序的方法</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2><a href="https://www.cnblogs.com/airdot/p/9688530.html" rel="nofollow" id="cb_post_title_url">ubuntu-18.04 设置开机启动脚本</a></h2> 
<p>ubuntu-18.04 设置开机启动脚本</p> 
<p>参阅下列链接</p> 
<p><a href="https://askubuntu.com/questions/886620/how-can-i-execute-command-on-startup-rc-local-alternative-on-ubuntu-16-10" rel="nofollow">https://askubuntu.com/questions/886620/how-can-i-execute-command-on-startup-rc-local-alternative-on-ubuntu-16-10</a></p> 
<p>ubuntu-18.04不能像ubuntu14一样通过编辑rc.local来设置开机启动脚本，通过下列简单设置后，可以使rc.local重新发挥作用。</p> 
<p>1、建立rc-local.service文件</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>sudo</code> <code>vi</code> <code>/etc/systemd/system/rc-local</code><code>.service</code></p> </td></tr></tbody></table> 
<p>2、将下列内容复制进rc-local.service文件</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> </td><td> <p><code>[Unit]</code></p> <p><code>Description=</code><code>/etc/rc</code><code>.</code><code>local</code> <code>Compatibility</code></p> <p><code>ConditionPathExists=</code><code>/etc/rc</code><code>.</code><code>local</code></p> <p> </p> <p><code>[Service]</code></p> <p><code>Type=forking</code></p> <p><code>ExecStart=</code><code>/etc/rc</code><code>.</code><code>local</code> <code>start</code></p> <p><code>TimeoutSec=0</code></p> <p><code>StandardOutput=</code><code>tty</code></p> <p><code>RemainAfterExit=</code><code>yes</code></p> <p><code>SysVStartPriority=99</code></p> <p> </p> <p><code>[Install]</code></p> <p><code>WantedBy=multi-user.target</code></p> </td></tr></tbody></table> 
<p>3、创建文件rc.local　　</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>sudo</code> <code>vi</code> <code>/etc/rc</code><code>.</code><code>local</code></p> </td></tr></tbody></table> 
<p>4、将下列内容复制进rc.local文件</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> </td><td> <p><code>#!/bin/sh -e</code></p> <p><code>#</code></p> <p><code># rc.local</code></p> <p><code>#</code></p> <p><code># This script is executed at the end of each multiuser runlevel.</code></p> <p><code># Make sure that the script will "exit 0" on success or any other</code></p> <p><code># value on error.</code></p> <p><code>#</code></p> <p><code># In order to enable or disable this script just change the execution</code></p> <p><code># bits.</code></p> <p><code>#</code></p> <p><code># By default this script does nothing.</code></p> <p><code>echo</code> <code>"看到这行字，说明添加自启动脚本成功。"</code> <code>&gt; </code><code>/usr/local/test</code><code>.log</code></p> <p><code>exit</code> <code>0</code></p> </td></tr></tbody></table> 
<p>5、给rc.local加上权限</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>sudo</code> <code>chmod</code> <code>+x </code><code>/etc/rc</code><code>.</code><code>local</code></p> </td></tr></tbody></table> 
<p>6、启用服务</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>sudo</code> <code>systemctl </code><code>enable</code> <code>rc-</code><code>local</code></p> </td></tr></tbody></table> 
<p>7、启动服务并检查状态</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> <p>2</p> </td><td> <p><code>sudo</code> <code>systemctl start rc-</code><code>local</code><code>.service</code></p> <p><code>sudo</code> <code>systemctl status rc-</code><code>local</code><code>.service</code></p> </td></tr></tbody></table> 
<p>8、重启并检查test.log文件</p> 
<table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td> <p>1</p> </td><td> <p><code>cat</code> <code>/usr/local/test</code><code>.log　　</code></p> </td></tr></tbody></table> 
<p> </p> 
<p>ref link: <a href="https://www.cnblogs.com/airdot/p/9688530.html" rel="nofollow">https://www.cnblogs.com/airdot/p/9688530.html</a></p> 
<p> </p> 
<p><strong>一、Ubuntu添加开机自动启动程序的方法</strong></p> 
<p><strong>1. 开机启动时自动运行程序</strong></p> 
<p>Linux加载后, 它将初始化硬件和设备驱动, 然后运行第一个进程init。init根据配置文件继续引导过程，启动其它进程。通常情况下，修改放置在</p> 
<p>/etc/rc或</p> 
<p>/etc/rc.d 或</p> 
<p>/etc/rc?.d</p> 
<p>目录下的脚本文件，可以使init自动启动其它程序。例如：编辑/etc/rc.d/rc.local 文件(该文件通常是系统最后启动的脚本)，在文件最末加上一行“xinit”或“startx”，可以在开机启动后直接进入X－Window。</p> 
<p><strong>2. 登录时自动运行程序</strong></p> 
<p>用户登录时，bash先自动执行系统管理员建立的全局登录script ：</p> 
<p>/ect/profile</p> 
<p>然后bash在用户起始目录下按顺序查找三个特殊文件中的一个：</p> 
<p>/.bash_profile、</p> 
<p>/.bash_login、</p> 
<p>/.profile，</p> 
<p>但只执行最先找到的一个。因此，只需根据实际需要在上述文件中加入命令就可以实现用户登录时自动运行某些程序（类似于DOS下的Autoexec.bat）。</p> 
<p><strong>3. 退出登录时自动运行程序</strong></p> 
<p>退出登录时，bash自动执行个人的退出登录脚本</p> 
<p>/.bash_logout。</p> 
<p>例如，在/.bash_logout中加入命令“tar －cvzf c.source.tgz ＊.c”，则在每次退出登录时自动执行 “tar” 命令备份 ＊.c 文件。</p> 
<p><strong>4. 定期自动运行程序</strong></p> 
<p>Linux有一个称为crond的守护程序，主要功能是周期性地检查 /var/spool/cron目录下的一组命令文件的内容，并在设定的时间执行这些文件中的命令。用户可以通过crontab 命令来建立、修改、删除这些命令文件。</p> 
<p>例如，建立文件crondFile，内容为“00 9 23 Jan ＊ HappyBirthday”，运行“crontabcronFile”命令后，每当元月23日上午9:00系统自动执行“HappyBirthday”的程序（“＊”表示不管当天是星期几）。</p> 
<p><strong>5. 定时自动运行程序一次</strong></p> 
<p>定时执行命令at 与crond 类似（但它只执行一次）：命令在给定的时间执行，但不自动重复。at命令的一般格式为：at [ －f file ] time ，在指定的时间执行file文件中所给出的所有命令。也可直接从键盘输入命令：</p> 
<p>＄ at 12:00</p> 
<p>at&gt;mailto Roger －s ″Have a lunch″ &lt; plan.txt</p> 
<p>at&gt;Ctr－D</p> 
<p>Job 1 at 2000－11－09 12:00</p> 
<p>2000－11－09 12:00时候自动发一标题为“Have a lunch”，内容为plan.txt文件内容的邮件给Roger.</p> 
<p> </p> 
<p> </p> 
<p>Ubuntu下添加开机启动脚本</p> 
<p>Ubuntu开机之后会执行/etc/rc.local文件中的脚本，所以我们可以直接在/etc/rc.local中添加启动脚本。</p> 
<p>当然要添加到语句：exit 0 前面才行。</p> 
<p>如：</p> 
<p>sudo vi /etc/rc.local</p> 
<p>然后在 exit 0 前面添加好脚本代码。</p> 
<p>后续有空再研究下添加一个Ubuntu的开机启动服务看看。</p> 
<p>如果要添加为开机启动执行的脚本文件，可先将脚本复制或者软连接到/etc/init.d/目录下，然后用：update-rc.d xxx defaults NN命令(NN为启动顺序)，将脚本添加到初始化执行的队列中去。</p> 
<p>注意如果脚本需要用到网络，则NN需设置一个比较大的数字，如98 。</p> 
<p> </p> 
<p> </p> 
<p><strong>二、ubuntu下设置程序开机自启动的几种方法</strong></p> 
<p> </p> 
<p><strong>1、方法一：</strong></p> 
<p>这种也是最常用的一种<strong> rcconf</strong>：</p> 
<p>sudo apt-get install rcconf</p> 
<p>root下运行: rcconf</p> 
<p> </p> 
<p>功能更全的：<strong>sysv-rc-conf</strong></p> 
<p>sudo apt-get install sysv-rc-conf</p> 
<p>运行：sysv-rc-conf</p> 
<p>这个改起来很简单，自己试一下就知道了.</p> 
<p> </p> 
<p><strong>2、方法二：</strong></p> 
<p>直接改<strong>/etc/rc0.d ~ /etc/rc6.d和/etc/rcS.d</strong>下的东西，S开头的表示启动，K开头的表示不启动，例如：想关闭vsftpd的开机自动启动，只需sudo mv /etc/rc2.d/S20vsftpd /etc/rc2.d/K20vsftpd就可以了。</p> 
<p>这条命令的用意就是利用mv的重命名功能。</p> 
<p> </p> 
<p><strong>3、方法三：</strong></p> 
<p><strong>chkconfig</strong>,这种方法在redhat,Debian里面比较常用,在fedora和ubuntu里面用方法1比较简单,但是学习一下这种方法也是不错的。</p> 
<p>但在ubuntu下这个命令没有redhat好用,老是出错.</p> 
<p>算了,还是直接看一下redhat里面chkconfig的用法吧.</p> 
<p>（1）chkconfig --level [0123456] [service name] [on|off]</p> 
<p>   chkconfig --level 23 dhcp3-server off ----设定dhcp server服务在level2,3下关闭.</p> 
<p>（2）chkconfig --list 查看服务的自动开启状态</p> 
<p>（3）chkconfig --add 增加一个服务给chkconfig来管理,但是该服务必须在/etc/init.d内。</p> 
<p> </p> 
<p><a href="http://www.360doc.com/content/18/0201/13/52515624_726922842.shtml" rel="nofollow">点击打开链接</a></p> 
<p> </p> 
<p>ref link: <a href="https://blog.csdn.net/qq_14989227/article/details/79227283">https://blog.csdn.net/qq_14989227/article/details/79227283</a></p> 
<p>以前一直搞的centos配置开机启动脚本,但是相同方法用在ubuntu系统上就不管用了,非常伤脑筋.</p> 
<p>非常感谢  https://www.linuxidc.com/Linux/2017-09/147178.htm  http://www.linuxdiyf.com/linux/26896.html  这两篇文章.</p> 
<p>我第一次也是尝试修改rc.local这个文件,但是压根不管用.</p> 
<p>然后尝试第二种方法,成功了,再一次非常感谢以上两篇文件分享的内容.</p> 
<p>1. 创建一个shell脚本如下,以下注释部分必须存在,不然会报错:如下错误：missing LSB tags and overrides   导致脚本无法执行成功</p> 
<p>#!/bin/sh<br> ### BEGIN INIT INFO<br> # Provides: svnd.sh<br> # Required-start: $local_fs $remote_fs $network $syslog<br> # Required-Stop: $local_fs $remote_fs $network $syslog<br> # Default-Start: 2 3 4 5<br> # Default-Stop: 0 1 6<br> # Short-Description: starts the svnd.sh daemon<br> # Description: starts svnd.sh using start-stop-daemon<br> ### END INIT INFO<br> sudo mount /dev/sdb /imdata/test          ##这里就是我需要开机做的事情.</p> 
<p>2. 脚本执行执行权限;</p> 
<p>    sudo chmod +x 你的脚本命令 </p> 
<p>3.将脚本复制到 /etc/init.d/  下;</p> 
<p>   cp -r 脚本名 /etc/init.d/你的脚本名</p> 
<p>4.更新脚本的启动顺序</p> 
<p>   cd /etc/init.d</p> 
<p>   $ sudo update-rc.d svnd.sh defaults 90</p> 
<p>注：其中数字95是脚本启动的顺序号，按照自己的需要相应修改即可。在你有多个启动脚本，而它们之间又有先后启动的依赖关系时你就知道这个数字的具体作用了。</p> 
<p> </p> 
<p>5.卸载启动脚本的方法：</p> 
<p>  $ cd /etc/init.d</p> 
<p>  $ sudo update-rc.d -f svnd.sh remove</p> 
<p> </p> 
<p>ref link: <a href="https://www.cnblogs.com/yehui/p/9874866.html" rel="nofollow">https://www.cnblogs.com/yehui/p/9874866.html</a></p> 
<p> </p> 
<p> </p> 
<h2> </h2>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/679bb478ee0492c3498b4fb0a612d0dc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">javascript使用crypto-js进行AES加密解密算法（CBC模式）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a80a55345d941ff211caf7336ec8b913/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CentOS7自定义安装mysql</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>