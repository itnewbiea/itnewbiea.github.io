<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java集成kettle:配置资源库，并执行资源库中保存的转换 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java集成kettle:配置资源库，并执行资源库中保存的转换" />
<meta property="og:description" content="首先配置资源库
1.安装kettle7.1
2.将mysql-connector-java-5.1.46.jar复制到D:\Program Files\kettle7.1\data-integration\lib目录下
3.配置kettle资源库
上图就是在cgmrepositorydb数据库中初始化建立表格呢。需要建立1分钟左右。 密码也是admin 然后我们创建一个名称为fromto的转换
输入就是D:/from.txt 输出就是D:/to.txt
那么这个转换就在数据库中了 在数据库中的结构如下：
那么如何以树形目录结构查询fromto转换在哪里呢？ 发现fromto在根目录下。因为fromto转换在数据块中的ID_DIRECTORY=0
现在我们要使用java代码去读取kettle资源数据库中存储的fromto转换，并执行这个换行
项目结构如下
pom.xml文件如下
&lt;project xmlns=&#34;http://maven.apache.org/POM/4.0.0&#34; xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;
xsi:schemaLocation=&#34;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&#34;&gt;
&lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;
&lt;groupId&gt;www.test.com&lt;/groupId&gt;
&lt;artifactId&gt;test&lt;/artifactId&gt;
&lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;
&lt;dependencies&gt;
&lt;dependency&gt;
&lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;
&lt;artifactId&gt;kettle-core&lt;/artifactId&gt;
&lt;version&gt;7.1.0.0-12&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;
&lt;artifactId&gt;kettle-dbdialog&lt;/artifactId&gt;
&lt;version&gt;7.1.0.0-12&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;
&lt;artifactId&gt;kettle-engine&lt;/artifactId&gt;
&lt;version&gt;7.1.0.0-12&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;pentaho&lt;/groupId&gt;
&lt;artifactId&gt;metastore&lt;/artifactId&gt;
&lt;version&gt;7.1.0.0-12&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-vfs2 --&gt;
&lt;dependency&gt;
&lt;groupId&gt;org.apache.commons&lt;/groupId&gt;
&lt;artifactId&gt;commons-vfs2&lt;/artifactId&gt;
&lt;version&gt;2.2&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;com.google.guava&lt;/groupId&gt;
&lt;artifactId&gt;guava&lt;/artifactId&gt;
&lt;version&gt;19.0&lt;/version&gt;
&lt;/dependency&gt;
&lt;dependency&gt;
&lt;groupId&gt;mysql&lt;/groupId&gt;
&lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;
&lt;version&gt;5.1.46&lt;/version&gt;
&lt;/dependency&gt;
&lt;!-- https://mvnrepository.com/artifact/commons-lang/commons-lang --&gt;
&lt;dependency&gt;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c77af76e98b16806dcbf7c2b6f631766/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-07-06T15:21:43+08:00" />
<meta property="article:modified_time" content="2019-07-06T15:21:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java集成kettle:配置资源库，并执行资源库中保存的转换</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>首先配置资源库</p> 
<p>1.安装kettle7.1</p> 
<p>2.将mysql-connector-java-5.1.46.jar复制到D:\Program Files\kettle7.1\data-integration\lib目录下</p> 
<p>3.配置kettle资源库</p> 
<p><img alt="" class="has" height="338" src="https://images2.imgbox.com/01/df/QwZdGAYT_o.png" width="554"></p> 
<p><img alt="" class="has" height="564" src="https://images2.imgbox.com/20/79/EhUUPqm2_o.png" width="554"></p> 
<p> <img alt="" class="has" height="565" src="https://images2.imgbox.com/a4/71/EI4nbAtQ_o.png" width="554"></p> 
<p><img alt="" class="has" height="564" src="https://images2.imgbox.com/ca/cc/hC78SjcT_o.png" width="554"></p> 
<p> <img alt="" class="has" height="454" src="https://images2.imgbox.com/08/14/BrvdA44P_o.png" width="554"></p> 
<p><img alt="" class="has" height="560" src="https://images2.imgbox.com/32/c0/LD9bmIi2_o.png" width="554"></p> 
<p> <img alt="" class="has" height="552" src="https://images2.imgbox.com/70/2b/RMIqqV8z_o.png" width="554"></p> 
<p> <img alt="" class="has" height="557" src="https://images2.imgbox.com/a7/54/dZHMWgHR_o.png" width="554"></p> 
<p>上图就是在cgmrepositorydb数据库中初始化建立表格呢。需要建立1分钟左右。 </p> 
<p><img alt="" class="has" height="391" src="https://images2.imgbox.com/c6/5e/jdMFBYug_o.png" width="554"></p> 
<p><img alt="" class="has" height="563" src="https://images2.imgbox.com/04/4a/eKNBp5pK_o.png" width="554"></p> 
<p><img alt="" class="has" height="133" src="https://images2.imgbox.com/d8/0e/79NmhdwQ_o.png" width="554"></p> 
<p><img alt="" class="has" height="559" src="https://images2.imgbox.com/bc/a4/xr5md6jg_o.png" width="554"></p> 
<p>密码也是admin </p> 
<p><img alt="" class="has" height="111" src="https://images2.imgbox.com/4e/3b/rfPR4ZbR_o.png" width="554"></p> 
<p> </p> 
<p style="margin-left:0cm;">然后我们创建一个名称为fromto的转换</p> 
<p style="margin-left:0cm;"><img alt="" class="has" height="602" src="https://images2.imgbox.com/a1/dd/2MfqFoMb_o.png" width="1046"></p> 
<p>输入就是D:/from.txt 输出就是D:/to.txt</p> 
<p> 那么这个转换就在数据库中了  </p> 
<p><img alt="" class="has" height="131" src="https://images2.imgbox.com/13/d3/kjHQH3QP_o.png" width="554"></p> 
<p> 在数据库中的结构如下：</p> 
<p><img alt="" class="has" height="485" src="https://images2.imgbox.com/a8/19/vJRmWzue_o.png" width="1073"></p> 
<p> 那么如何以树形目录结构查询fromto转换在哪里呢？ </p> 
<p><img alt="" class="has" height="214" src="https://images2.imgbox.com/4f/96/C9JL0ang_o.png" width="554"></p> 
<p><img alt="" class="has" height="141" src="https://images2.imgbox.com/4e/df/7mSrDei0_o.png" width="554"></p> 
<p> 发现fromto在根目录下。因为fromto转换在数据块中的ID_DIRECTORY=0</p> 
<p><img alt="" class="has" height="99" src="https://images2.imgbox.com/c4/80/ZHgV2CtX_o.png" width="652"></p> 
<p> </p> 
<p> 现在我们要使用java代码去读取kettle资源数据库中存储的fromto转换，并执行这个换行</p> 
<p>项目结构如下</p> 
<p><img alt="" class="has" height="331" src="https://images2.imgbox.com/c2/b7/35l4ER5o_o.png" width="277"></p> 
<p> pom.xml文件如下</p> 
<blockquote> 
 <p>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"<br>     xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;<br>     &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;<br>     &lt;groupId&gt;www.test.com&lt;/groupId&gt;<br>     &lt;artifactId&gt;test&lt;/artifactId&gt;<br>     &lt;version&gt;0.0.1-SNAPSHOT&lt;/version&gt;</p> 
 <p>    &lt;dependencies&gt;<br>         &lt;dependency&gt;<br>             &lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;<br>             &lt;artifactId&gt;kettle-core&lt;/artifactId&gt;<br>             &lt;version&gt;7.1.0.0-12&lt;/version&gt;<br>         &lt;/dependency&gt;<br>         &lt;dependency&gt;<br>             &lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;<br>             &lt;artifactId&gt;kettle-dbdialog&lt;/artifactId&gt;<br>             &lt;version&gt;7.1.0.0-12&lt;/version&gt;<br>         &lt;/dependency&gt;</p> 
 <p>        &lt;dependency&gt;<br>             &lt;groupId&gt;pentaho-kettle&lt;/groupId&gt;<br>             &lt;artifactId&gt;kettle-engine&lt;/artifactId&gt;<br>             &lt;version&gt;7.1.0.0-12&lt;/version&gt;<br>         &lt;/dependency&gt;</p> 
 <p>        &lt;dependency&gt;<br>             &lt;groupId&gt;pentaho&lt;/groupId&gt;<br>             &lt;artifactId&gt;metastore&lt;/artifactId&gt;<br>             &lt;version&gt;7.1.0.0-12&lt;/version&gt;<br>         &lt;/dependency&gt;<br>         &lt;!-- https://mvnrepository.com/artifact/org.apache.commons/commons-vfs2 --&gt;<br>         &lt;dependency&gt;<br>             &lt;groupId&gt;org.apache.commons&lt;/groupId&gt;<br>             &lt;artifactId&gt;commons-vfs2&lt;/artifactId&gt;<br>             &lt;version&gt;2.2&lt;/version&gt;<br>         &lt;/dependency&gt;</p> 
 <p>        &lt;dependency&gt;<br>             &lt;groupId&gt;com.google.guava&lt;/groupId&gt;<br>             &lt;artifactId&gt;guava&lt;/artifactId&gt;<br>             &lt;version&gt;19.0&lt;/version&gt;<br>         &lt;/dependency&gt;</p> 
 <p>        &lt;dependency&gt;<br>             &lt;groupId&gt;mysql&lt;/groupId&gt;<br>             &lt;artifactId&gt;mysql-connector-java&lt;/artifactId&gt;<br>             &lt;version&gt;5.1.46&lt;/version&gt;<br>         &lt;/dependency&gt;<br>         &lt;!-- https://mvnrepository.com/artifact/commons-lang/commons-lang --&gt;<br>         &lt;dependency&gt;<br>             &lt;groupId&gt;commons-lang&lt;/groupId&gt;<br>             &lt;artifactId&gt;commons-lang&lt;/artifactId&gt;<br>             &lt;version&gt;2.6&lt;/version&gt;<br>         &lt;/dependency&gt;<br>     &lt;/dependencies&gt;<br>     &lt;repositories&gt;<br>         &lt;repository&gt;<br>             &lt;id&gt;pentaho-releases&lt;/id&gt;<br>             &lt;name&gt;Kettle&lt;/name&gt;<br>             &lt;url&gt;https://nexus.pentaho.org/content/groups/omni/&lt;/url&gt;<br>         &lt;/repository&gt;<br>         &lt;!-- 阿里云maven仓库 --&gt;<br>         &lt;repository&gt;<br>             &lt;id&gt;public&lt;/id&gt;<br>             &lt;name&gt;aliyun nexus&lt;/name&gt;<br>             &lt;url&gt;http://maven.aliyun.com/nexus/content/groups/public/&lt;/url&gt;<br>             &lt;releases&gt;<br>                 &lt;enabled&gt;true&lt;/enabled&gt;<br>             &lt;/releases&gt;<br>         &lt;/repository&gt;<br>     &lt;/repositories&gt;<br> &lt;/project&gt;</p> 
</blockquote> 
<p>KettleTest文件如下</p> 
<blockquote> 
 <p> </p> 
 <p>package test;</p> 
 <p>import org.pentaho.di.core.KettleEnvironment;<br> import org.pentaho.di.core.database.DatabaseMeta;<br> import org.pentaho.di.core.exception.KettleException;<br> import org.pentaho.di.repository.ObjectId;<br> import org.pentaho.di.repository.RepositoryDirectoryInterface;<br> import org.pentaho.di.repository.kdr.KettleDatabaseRepository;<br> import org.pentaho.di.repository.kdr.KettleDatabaseRepositoryMeta;<br> import org.pentaho.di.trans.Trans;<br> import org.pentaho.di.trans.TransMeta;</p> 
 <p>/**<br>  * @author cgm<br>  * @date 2019年7月5日<br>  */<br> public class KettleTest {<!-- --><br>     public static void main(String[] args) throws KettleException {<!-- --></p> 
 <p>        KettleDatabaseRepository obj = RepositoryCon();<br>         if (obj != null) {// 资源库连接成功<br>             runTrans(obj, "fromto");// 调用指定的tansformation<br>         }<br>     }</p> 
 <p>    /**<br>      * 配置资源库环境 并接连接的资源库<br>      * <br>      * @return<br>      * @throws KettleException<br>      */<br>     public static KettleDatabaseRepository RepositoryCon() throws KettleException {<!-- --><br>         // 初始化<br>         KettleEnvironment.init();<br>         // 数据库连接元对象<br>         // （kettle数据库连接名称(KETTLE工具右上角显示)，资源库类型，连接方式，IP，数据库名，端口，用户名，密码） //cgmRepositoryConn<br>         DatabaseMeta databaseMeta = new DatabaseMeta("cgmRepository", "mysql", "Native(JDBC)", "127.0.0.1",<br>             "cgmrepositorydb", "3306", "root", "root");<br>         // 数据库形式的资源库元对象<br>         KettleDatabaseRepositoryMeta kettleDatabaseRepositoryMeta = new KettleDatabaseRepositoryMeta();<br>         kettleDatabaseRepositoryMeta.setConnection(databaseMeta);<br>         // 数据库形式的资源库对象<br>         KettleDatabaseRepository kettleDatabaseRepository = new KettleDatabaseRepository();<br>         // 用资源库元对象初始化资源库对象<br>         kettleDatabaseRepository.init(kettleDatabaseRepositoryMeta);<br>         // 连接到资源库<br>         kettleDatabaseRepository.connect("admin", "admin");// 默认的连接资源库的用户名和密码<br>         if (kettleDatabaseRepository.isConnected()) {<!-- --><br>             System.out.println("连接成功");<br>             return kettleDatabaseRepository;<br>         } else {<!-- --><br>             System.out.println("连接失败");<br>             return null;<br>         }<br>     }</p> 
 <p>    /**<br>      * 调用Transformation示例<br>      * <br>      * @param rep<br>      * @param transName<br>      */<br>     public static void runTrans(KettleDatabaseRepository rep, String transName) {<!-- --></p> 
 <p>        try {<!-- --><br>             // 根据指定的字符串路径 找到目录，在 r_transformation中id_directory=0的代表根目录<br>             RepositoryDirectoryInterface dir = rep.findDirectory("/");<br>             // 根据转换名称获取转换id<br>             // 这个值就是从SELECT ID_TRANSFORMATION FROM `r_transformation` where name='fromto';来的<br>             ObjectId id = rep.getTransformationID(transName, dir);<br>             System.out.println("------ObjectId=" + id);<br>             // 根据转换id查询与其关联的step和hop<br>             // select name from r_step where ID_STEP=(SELECT ID_STEP_FROM FROM `r_trans_hop` where<br>             // ID_TRANSFORMATION='1');<br>             // select name from r_step where ID_STEP=(SELECT ID_STEP_TO FROM `r_trans_hop` where ID_TRANSFORMATION='1');<br>             TransMeta transMeta = rep.loadTransformation(id, null);<br>             //<br>             Trans trans = new Trans(transMeta);<br>             trans.execute(null);// 执行转换<br>             trans.waitUntilFinished(); // 等待转换执行结束<br>             if (trans.getErrors() != 0) {<!-- --><br>                 System.out.println("Error");<br>             }<br>         } catch (Exception e) {<!-- --><br>             e.printStackTrace();<br>         }<br>     }</p> 
 <p>}<br>  </p> 
</blockquote> 
<p>运行结果如下：</p> 
<p><img alt="" class="has" height="183" src="https://images2.imgbox.com/5f/9b/udih2S81_o.png" width="927"></p> 
<p> 发现D:/to.txt中文件内容和D:/from.txt内容一致</p> 
<p>代码示例： <a href="https://download.csdn.net/download/cgm625637391/11289885">https://download.csdn.net/download/cgm625637391/11289885</a> </p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7af3938f2d55a630d87087d49f29fa72/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">老调重弹：const char*, char const* and char *const</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d47a2c102b3e3e65c1f1266b102b892/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Spring报错: org.springframework.beans.factory.CannotLoadBeanClassException: Cannot find class [xxx]</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>