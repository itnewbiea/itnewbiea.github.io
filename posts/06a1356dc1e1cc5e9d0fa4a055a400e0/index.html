<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>快速入门到精通：一篇学会Oracle - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="快速入门到精通：一篇学会Oracle" />
<meta property="og:description" content="目录
1 Oracle系统体系结构介绍
1.1 启动关闭Oracle实例
2 SQL语句
2.1数据控制语言 DCL
2.2数据定义语言 DDL
2.2.1 用户类的创建、删除和修改：
2.2.2 表的创建、删除、修改、清空
2.2.3 alter的用法（关于表结构）
2.3数据操作语言 DML
2.4数据查询语言 DQL
3 DQL数据查询语言
3.1 去重distinct查询
3.2 where条件查询
3.3 group by分组查询
3.4 having过滤查询
3.5 order by排序查询
3.6 分页查询
3.7 多表查询
3.7.1 内连接
3.7.2 外连接
3.7.2.1 左连接
3.7.2.2 右连接
3.7.2.3 全连接
3.7.3 交叉连接
3.8 联合查询
3.8.1 并集
3.8.2 交集
3.8.3 差集
3.9 子查询
3.9.1 FROM子句中的子查询
3.9.2 运算符的子查询
3.9.3 SELECT下的子查询
3.9.4 with...as 子查询" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/06a1356dc1e1cc5e9d0fa4a055a400e0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-07T09:59:54+08:00" />
<meta property="article:modified_time" content="2023-10-07T09:59:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">快速入门到精通：一篇学会Oracle</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1%20Oracle%E7%B3%BB%E7%BB%9F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D-toc" style="margin-left:0px;"><a href="#1%20Oracle%E7%B3%BB%E7%BB%9F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D" rel="nofollow">1 Oracle系统体系结构介绍</a></p> 
<p id="1.1%20%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%ADOracle%E5%AE%9E%E4%BE%8B-toc" style="margin-left:40px;"><a href="#1.1%20%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%ADOracle%E5%AE%9E%E4%BE%8B" rel="nofollow">1.1 启动关闭Oracle实例</a></p> 
<p id="2%20SQL%E8%AF%AD%E5%8F%A5-toc" style="margin-left:0px;"><a href="#2%20SQL%E8%AF%AD%E5%8F%A5" rel="nofollow">2 SQL语句</a></p> 
<p id="2.1%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80%20%C2%A0DCL-toc" style="margin-left:40px;"><a href="#2.1%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80%20%C2%A0DCL" rel="nofollow">2.1数据控制语言  DCL</a></p> 
<p id="2.2%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%20%C2%A0DDL-toc" style="margin-left:40px;"><a href="#2.2%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%20%C2%A0DDL" rel="nofollow">2.2数据定义语言  DDL</a></p> 
<p id="2.2.1%20%E7%94%A8%E6%88%B7%E7%B1%BB%E7%9A%84%E5%88%9B%E5%BB%BA%E3%80%81%E5%88%A0%E9%99%A4%E5%92%8C%E4%BF%AE%E6%94%B9%EF%BC%9A-toc" style="margin-left:120px;"><a href="#2.2.1%20%E7%94%A8%E6%88%B7%E7%B1%BB%E7%9A%84%E5%88%9B%E5%BB%BA%E3%80%81%E5%88%A0%E9%99%A4%E5%92%8C%E4%BF%AE%E6%94%B9%EF%BC%9A" rel="nofollow">2.2.1 用户类的创建、删除和修改：</a></p> 
<p id="2.2.2%20%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%81%E6%B8%85%E7%A9%BA-toc" style="margin-left:120px;"><a href="#2.2.2%20%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%81%E6%B8%85%E7%A9%BA" rel="nofollow">2.2.2 表的创建、删除、修改、清空</a></p> 
<p id="2.2.3%20alter%E7%9A%84%E7%94%A8%E6%B3%95%EF%BC%88%E5%85%B3%E4%BA%8E%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%89-toc" style="margin-left:120px;"><a href="#2.2.3%20alter%E7%9A%84%E7%94%A8%E6%B3%95%EF%BC%88%E5%85%B3%E4%BA%8E%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%89" rel="nofollow">2.2.3 alter的用法（关于表结构）</a></p> 
<p id="2.3%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80%20%C2%A0DML-toc" style="margin-left:40px;"><a href="#2.3%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80%20%C2%A0DML" rel="nofollow">2.3数据操作语言  DML</a></p> 
<p id="2.4%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%20%C2%A0DQL-toc" style="margin-left:40px;"><a href="#2.4%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%20%C2%A0DQL" rel="nofollow">2.4数据查询语言  DQL</a></p> 
<p id="3%20DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80-toc" style="margin-left:0px;"><a href="#3%20DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80" rel="nofollow">3 DQL数据查询语言</a></p> 
<p id="3.1%20%E5%8E%BB%E9%87%8Ddistinct%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.1%20%E5%8E%BB%E9%87%8Ddistinct%E6%9F%A5%E8%AF%A2" rel="nofollow">3.1 去重distinct查询</a></p> 
<p id="3.2%20where%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.2%20where%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2" rel="nofollow">3.2 where条件查询</a></p> 
<p id="3.3%20group%20by%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.3%20group%20by%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2" rel="nofollow">3.3 group by分组查询</a></p> 
<p id="3.4%20having%E8%BF%87%E6%BB%A4%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.4%20having%E8%BF%87%E6%BB%A4%E6%9F%A5%E8%AF%A2" rel="nofollow">3.4 having过滤查询</a></p> 
<p id="3.5%20order%20by%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.5%20order%20by%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2" rel="nofollow">3.5 order by排序查询</a></p> 
<p id="3.6%20%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.6%20%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2" rel="nofollow">3.6 分页查询</a></p> 
<p id="3.7%20%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.7%20%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2" rel="nofollow">3.7 多表查询</a></p> 
<p id="3.7.1%20%E5%86%85%E8%BF%9E%E6%8E%A5-toc" style="margin-left:80px;"><a href="#3.7.1%20%E5%86%85%E8%BF%9E%E6%8E%A5" rel="nofollow">3.7.1 内连接</a></p> 
<p id="3.7.2%20%E5%A4%96%E8%BF%9E%E6%8E%A5-toc" style="margin-left:80px;"><a href="#3.7.2%20%E5%A4%96%E8%BF%9E%E6%8E%A5" rel="nofollow">3.7.2 外连接</a></p> 
<p id="3.7.2.1%20%E5%B7%A6%E8%BF%9E%E6%8E%A5-toc" style="margin-left:120px;"><a href="#3.7.2.1%20%E5%B7%A6%E8%BF%9E%E6%8E%A5" rel="nofollow">3.7.2.1 左连接</a></p> 
<p id="3.7.2.2%20%E5%8F%B3%E8%BF%9E%E6%8E%A5-toc" style="margin-left:120px;"><a href="#3.7.2.2%20%E5%8F%B3%E8%BF%9E%E6%8E%A5" rel="nofollow">3.7.2.2 右连接</a></p> 
<p id="3.7.2.3%20%E5%85%A8%E8%BF%9E%E6%8E%A5-toc" style="margin-left:120px;"><a href="#3.7.2.3%20%E5%85%A8%E8%BF%9E%E6%8E%A5" rel="nofollow">3.7.2.3 全连接</a></p> 
<p id="3.7.3%20%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5-toc" style="margin-left:80px;"><a href="#3.7.3%20%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5" rel="nofollow">3.7.3 交叉连接</a></p> 
<p id="3.8%20%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.8%20%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2" rel="nofollow">3.8 联合查询</a></p> 
<p id="3.8.1%20%E5%B9%B6%E9%9B%86-toc" style="margin-left:80px;"><a href="#3.8.1%20%E5%B9%B6%E9%9B%86" rel="nofollow">3.8.1 并集</a></p> 
<p id="3.8.2%20%E4%BA%A4%E9%9B%86-toc" style="margin-left:80px;"><a href="#3.8.2%20%E4%BA%A4%E9%9B%86" rel="nofollow">3.8.2 交集</a></p> 
<p id="3.8.3%20%E5%B7%AE%E9%9B%86-toc" style="margin-left:80px;"><a href="#3.8.3%20%E5%B7%AE%E9%9B%86" rel="nofollow">3.8.3 差集</a></p> 
<p id="3.9%20%E5%AD%90%E6%9F%A5%E8%AF%A2-toc" style="margin-left:40px;"><a href="#3.9%20%E5%AD%90%E6%9F%A5%E8%AF%A2" rel="nofollow">3.9 子查询</a></p> 
<p id="3.9.1%20FROM%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2-toc" style="margin-left:80px;"><a href="#3.9.1%20FROM%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2" rel="nofollow">3.9.1 FROM子句中的子查询</a></p> 
<p id="3.9.2%20%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2-toc" style="margin-left:80px;"><a href="#3.9.2%20%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2" rel="nofollow">3.9.2 运算符的子查询</a></p> 
<p id="3.9.3%20SELECT%E4%B8%8B%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2-toc" style="margin-left:80px;"><a href="#3.9.3%20SELECT%E4%B8%8B%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2" rel="nofollow">3.9.3 SELECT下的子查询</a></p> 
<p id="3.9.4%20with...as%20%E5%AD%90%E6%9F%A5%E8%AF%A2-toc" style="margin-left:80px;"><a href="#3.9.4%20with...as%20%E5%AD%90%E6%9F%A5%E8%AF%A2" rel="nofollow">3.9.4 with...as 子查询</a></p> 
<p id="4%20Oracle%E5%87%BD%E6%95%B0-toc" style="margin-left:0px;"><a href="#4%20Oracle%E5%87%BD%E6%95%B0" rel="nofollow">4 Oracle函数</a></p> 
<p id="4.1%20%E6%95%B0%E5%80%BC%E5%9E%8B%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#4.1%20%E6%95%B0%E5%80%BC%E5%9E%8B%E5%87%BD%E6%95%B0" rel="nofollow">4.1 数值型函数</a></p> 
<p id="4.2%20%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#4.2%20%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%87%BD%E6%95%B0" rel="nofollow">4.2 字符型函数</a></p> 
<p id="4.3%20%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#4.3%20%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0" rel="nofollow">4.3 时间日期函数</a></p> 
<p id="4.4%20%E8%81%9A%E5%90%88%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#4.4%20%E8%81%9A%E5%90%88%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0" rel="nofollow">4.4 聚合分组函数</a></p> 
<p id="4.5%20%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#4.5%20%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0" rel="nofollow">4.5 开窗函数</a></p> 
<p id="4.5.1%20%E7%94%A8%E6%B3%95-toc" style="margin-left:80px;"><a href="#4.5.1%20%E7%94%A8%E6%B3%95" rel="nofollow">4.5.1 用法</a></p> 
<p id="4.5.2%20%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0-toc" style="margin-left:80px;"><a href="#4.5.2%20%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0" rel="nofollow">4.5.2 排名函数</a></p> 
<p id="4.5.3%20%E5%B9%B3%E7%A7%BB%E5%87%BD%E6%95%B0-toc" style="margin-left:80px;"><a href="#4.5.3%20%E5%B9%B3%E7%A7%BB%E5%87%BD%E6%95%B0" rel="nofollow">4.5.3 平移函数</a></p> 
<p id="4.6%20%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#4.6%20%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0" rel="nofollow">4.6 转换函数</a></p> 
<p id="4.7%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#4.7%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0" rel="nofollow">4.7其他函数</a></p> 
<p id="5%20PLSQL%E7%BC%96%E7%A8%8B-toc" style="margin-left:0px;"><a href="#5%20PLSQL%E7%BC%96%E7%A8%8B" rel="nofollow">5 PLSQL编程</a></p> 
<p id="5.1%E6%A0%BC%E5%BC%8F%E5%86%99%E6%B3%95-toc" style="margin-left:40px;"><a href="#5.1%E6%A0%BC%E5%BC%8F%E5%86%99%E6%B3%95" rel="nofollow">5.1格式写法</a></p> 
<p id="5.2%20%E5%8F%98%E9%87%8F-toc" style="margin-left:40px;"><a href="#5.2%20%E5%8F%98%E9%87%8F" rel="nofollow">5.2 变量</a></p> 
<p id="5.2.1%20%E6%99%AE%E9%80%9A%E5%8F%98%E9%87%8F-toc" style="margin-left:80px;"><a href="#5.2.1%20%E6%99%AE%E9%80%9A%E5%8F%98%E9%87%8F" rel="nofollow">5.2.1 普通变量</a></p> 
<p id="5.2.2%20%E5%BC%95%E7%94%A8%E5%9E%8B%E5%8F%98%E9%87%8F-toc" style="margin-left:80px;"><a href="#5.2.2%20%E5%BC%95%E7%94%A8%E5%9E%8B%E5%8F%98%E9%87%8F" rel="nofollow">5.2.2 引用型变量</a></p> 
<p id="5.2.3%20%E8%AE%B0%E5%BD%95%E5%9E%8B%E5%8F%98%E9%87%8F-toc" style="margin-left:80px;"><a href="#5.2.3%20%E8%AE%B0%E5%BD%95%E5%9E%8B%E5%8F%98%E9%87%8F" rel="nofollow">5.2.3 记录型变量</a></p> 
<p id="5.2.4%20%E5%8F%98%E9%87%8F%E8%BE%93%E5%85%A5-toc" style="margin-left:80px;"><a href="#5.2.4%20%E5%8F%98%E9%87%8F%E8%BE%93%E5%85%A5" rel="nofollow">5.2.4 变量输入</a></p> 
<p id="5.3%20If%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5-toc" style="margin-left:40px;"><a href="#5.3%20If%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5" rel="nofollow">5.3 If条件判断语句</a></p> 
<p id="5.4%20%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5-toc" style="margin-left:40px;"><a href="#5.4%20%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5" rel="nofollow">5.4 循环语句</a></p> 
<p id="5.4.1%20for%E5%BE%AA%E7%8E%AF-toc" style="margin-left:80px;"><a href="#5.4.1%20for%E5%BE%AA%E7%8E%AF" rel="nofollow">5.4.1 for循环</a></p> 
<p id="5.4.2%20While%E5%BE%AA%E7%8E%AF-toc" style="margin-left:80px;"><a href="#5.4.2%20While%E5%BE%AA%E7%8E%AF" rel="nofollow">5.4.2 While循环</a></p> 
<p id="5.4.3%20Loop%E5%BE%AA%E7%8E%AF-toc" style="margin-left:80px;"><a href="#5.4.3%20Loop%E5%BE%AA%E7%8E%AF" rel="nofollow">5.4.3 Loop循环</a></p> 
<p id="5.3.4%20continue%E5%92%8Cexit-toc" style="margin-left:80px;"><a href="#5.3.4%20continue%E5%92%8Cexit" rel="nofollow">5.3.4 continue和exit</a></p> 
<p id="5.5%20%E5%8A%A8%E6%80%81SQL-toc" style="margin-left:40px;"><a href="#5.5%20%E5%8A%A8%E6%80%81SQL" rel="nofollow">5.5 动态SQL</a></p> 
<p id="6%20%E7%B4%A2%E5%BC%95-toc" style="margin-left:0px;"><a href="#6%20%E7%B4%A2%E5%BC%95" rel="nofollow">6 索引</a></p> 
<p id="6.1%20%E7%B4%A2%E5%BC%95%E5%90%AB%E4%B9%89-toc" style="margin-left:40px;"><a href="#6.1%20%E7%B4%A2%E5%BC%95%E5%90%AB%E4%B9%89" rel="nofollow">6.1 索引含义</a></p> 
<p id="6.2%20%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95-toc" style="margin-left:40px;"><a href="#6.2%20%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95" rel="nofollow">6.2 使用索引</a></p> 
<p id="6.3%20%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%88%AB-toc" style="margin-left:40px;"><a href="#6.3%20%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%88%AB" rel="nofollow">6.3 索引类别</a></p> 
<p id="6.3.1%20%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%E3%80%81%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E3%80%81%E5%A4%96%E9%94%AE%E7%B4%A2%E5%BC%95-toc" style="margin-left:80px;"><a href="#6.3.1%20%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%E3%80%81%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E3%80%81%E5%A4%96%E9%94%AE%E7%B4%A2%E5%BC%95" rel="nofollow">6.3.1 主键索引、唯一索引、外键索引</a></p> 
<p id="6.3.2%20%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95-toc" style="margin-left:80px;"><a href="#6.3.2%20%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95" rel="nofollow">6.3.2 普通索引</a></p> 
<p id="6.3.3%20%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95-toc" style="margin-left:80px;"><a href="#6.3.3%20%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95" rel="nofollow">6.3.3 组合索引</a></p> 
<p id="6.3.4%20%E5%87%BD%E6%95%B0%E7%B4%A2%E5%BC%95-toc" style="margin-left:80px;"><a href="#6.3.4%20%E5%87%BD%E6%95%B0%E7%B4%A2%E5%BC%95" rel="nofollow">6.3.4 函数索引</a></p> 
<p id="6.3.5%20%E4%BD%8D%E5%9B%BE%E7%B4%A2%E5%BC%95-toc" style="margin-left:80px;"><a href="#6.3.5%20%E4%BD%8D%E5%9B%BE%E7%B4%A2%E5%BC%95" rel="nofollow">6.3.5 位图索引</a></p> 
<p id="6.3.6%20%E5%88%86%E5%8C%BA%E8%A1%A8%E7%B4%A2%E5%BC%95-toc" style="margin-left:80px;"><a href="#6.3.6%20%E5%88%86%E5%8C%BA%E8%A1%A8%E7%B4%A2%E5%BC%95" rel="nofollow">6.3.6 分区表索引</a></p> 
<p id="6.4%20%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E6%83%85%E5%86%B5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88-toc" style="margin-left:40px;"><a href="#6.4%20%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E6%83%85%E5%86%B5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" rel="nofollow">6.4 索引失效情况及解决方案</a></p> 
<p id="7%20%E6%B8%B8%E6%A0%87-toc" style="margin-left:0px;"><a href="#7%20%E6%B8%B8%E6%A0%87" rel="nofollow">7 游标</a></p> 
<p id="7.1%20%E9%9D%99%E6%80%81%E6%B8%B8%E6%A0%87-toc" style="margin-left:40px;"><a href="#7.1%20%E9%9D%99%E6%80%81%E6%B8%B8%E6%A0%87" rel="nofollow">7.1 静态游标</a></p> 
<p id="7.2%20%E5%8A%A8%E6%80%81%E6%B8%B8%E6%A0%87-toc" style="margin-left:40px;"><a href="#7.2%20%E5%8A%A8%E6%80%81%E6%B8%B8%E6%A0%87" rel="nofollow">7.2 动态游标</a></p> 
<p id="7.3%20%E6%A1%88%E4%BE%8B-toc" style="margin-left:40px;"><a href="#7.3%20%E6%A1%88%E4%BE%8B" rel="nofollow">7.3 案例</a></p> 
<p id="8%20%E8%A7%86%E5%9B%BE-toc" style="margin-left:0px;"><a href="#8%20%E8%A7%86%E5%9B%BE" rel="nofollow">8 视图</a></p> 
<p id="8.1%20%E8%A7%86%E5%9B%BE%E6%93%8D%E4%BD%9C-toc" style="margin-left:40px;"><a href="#8.1%20%E8%A7%86%E5%9B%BE%E6%93%8D%E4%BD%9C" rel="nofollow">8.1 视图操作</a></p> 
<p id="8.1.1%20%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE-toc" style="margin-left:80px;"><a href="#8.1.1%20%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE" rel="nofollow">8.1.1 创建视图</a></p> 
<p id="8.1.2%20%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE-toc" style="margin-left:80px;"><a href="#8.1.2%20%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE" rel="nofollow">8.1.2 删除视图</a></p> 
<p id="8.1.3%20%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE-toc" style="margin-left:80px;"><a href="#8.1.3%20%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE" rel="nofollow">8.1.3 修改视图</a></p> 
<p id="8.1.4%20%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE-toc" style="margin-left:80px;"><a href="#8.1.4%20%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE" rel="nofollow">8.1.4 更新视图</a></p> 
<p id="8.2%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE-toc" style="margin-left:40px;"><a href="#8.2%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE" rel="nofollow">8.2 物化视图</a></p> 
<p id="8.3%20%E6%99%AE%E9%80%9A%E8%A7%86%E5%9B%BE%E4%B8%8E%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E7%9A%84%E5%8C%BA%E5%88%AB-toc" style="margin-left:40px;"><a href="#8.3%20%E6%99%AE%E9%80%9A%E8%A7%86%E5%9B%BE%E4%B8%8E%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E7%9A%84%E5%8C%BA%E5%88%AB" rel="nofollow">8.3 普通视图与物化视图的区别</a></p> 
<p id="9%20%E9%94%81-toc" style="margin-left:0px;"><a href="#9%20%E9%94%81" rel="nofollow">9 锁</a></p> 
<p id="9.1%20%E4%BA%8B%E5%8A%A1-toc" style="margin-left:40px;"><a href="#9.1%20%E4%BA%8B%E5%8A%A1" rel="nofollow">9.1 事务</a></p> 
<p id="9.2%20%E9%94%81%E7%9A%84%E5%AE%9A%E4%B9%89-toc" style="margin-left:40px;"><a href="#9.2%20%E9%94%81%E7%9A%84%E5%AE%9A%E4%B9%89" rel="nofollow">9.2 锁的定义</a></p> 
<p id="9.3%20%E6%AD%BB%E9%94%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E5%A4%84%E7%90%86-toc" style="margin-left:40px;"><a href="#9.3%20%E6%AD%BB%E9%94%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E5%A4%84%E7%90%86" rel="nofollow">9.3 死锁原因及处理</a></p> 
<p id="10%20%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-toc" style="margin-left:0px;"><a href="#10%20%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B" rel="nofollow">10 存储过程</a></p> 
<p id="10.1%20%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-toc" style="margin-left:40px;"><a href="#10.1%20%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B" rel="nofollow">10.1 创建存储过程</a></p> 
<p id="10.2%20%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B-toc" style="margin-left:40px;"><a href="#10.2%20%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B" rel="nofollow">10.2 调用存储过程</a></p> 
<p id="10.3%20%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86-toc" style="margin-left:40px;"><a href="#10.3%20%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86" rel="nofollow">10.3 异常处理</a></p> 
<p id="10.4%20%E6%A1%88%E4%BE%8B-toc" style="margin-left:40px;"><a href="#10.4%20%E6%A1%88%E4%BE%8B" rel="nofollow">10.4 案例</a></p> 
<p id="10.5%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0-toc" style="margin-left:40px;"><a href="#10.5%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0" rel="nofollow">10.5 自定义函数</a></p> 
<p id="11%20%E8%A7%A6%E5%8F%91%E5%99%A8-toc" style="margin-left:0px;"><a href="#11%20%E8%A7%A6%E5%8F%91%E5%99%A8" rel="nofollow">11 触发器</a></p> 
<p id="11.1%20%E7%94%A8%E6%B3%95-toc" style="margin-left:40px;"><a href="#11.1%20%E7%94%A8%E6%B3%95" rel="nofollow">11.1 用法</a></p> 
<p id="11.2%20%E6%A1%88%E4%BE%8B%EF%BC%88%E5%89%8D%E7%BD%AE%E8%A7%A6%E5%8F%91%E5%99%A8--%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%EF%BC%89-toc" style="margin-left:40px;"><a href="#11.2%20%E6%A1%88%E4%BE%8B%EF%BC%88%E5%89%8D%E7%BD%AE%E8%A7%A6%E5%8F%91%E5%99%A8--%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%EF%BC%89" rel="nofollow">11.2 案例（前置触发器--验证数据）</a></p> 
<p id="11.3%20%E6%A1%88%E4%BE%8B%EF%BC%88%E5%90%8E%E7%BD%AE%E8%A7%A6%E5%8F%91%E5%99%A8--%E5%AE%A1%E8%AE%A1%EF%BC%89-toc" style="margin-left:40px;"><a href="#11.3%20%E6%A1%88%E4%BE%8B%EF%BC%88%E5%90%8E%E7%BD%AE%E8%A7%A6%E5%8F%91%E5%99%A8--%E5%AE%A1%E8%AE%A1%EF%BC%89" rel="nofollow">11.3 案例（后置触发器--审计）</a></p> 
<p id="12%20%E5%88%86%E5%8C%BA%E8%A1%A8-toc" style="margin-left:0px;"><a href="#12%20%E5%88%86%E5%8C%BA%E8%A1%A8" rel="nofollow">12 分区表</a></p> 
<p id="12.1%20%E8%8C%83%E5%9B%B4%E5%88%86%E5%8C%BA-toc" style="margin-left:40px;"><a href="#12.1%20%E8%8C%83%E5%9B%B4%E5%88%86%E5%8C%BA" rel="nofollow">12.1 范围分区</a></p> 
<p id="12.2%20hash%E5%88%86%E5%8C%BA-toc" style="margin-left:40px;"><a href="#12.2%20hash%E5%88%86%E5%8C%BA" rel="nofollow">12.2 hash分区</a></p> 
<p id="12.3%20%E5%88%97%E8%A1%A8%E5%88%86%E5%8C%BA-toc" style="margin-left:40px;"><a href="#12.3%20%E5%88%97%E8%A1%A8%E5%88%86%E5%8C%BA" rel="nofollow">12.3 列表分区</a></p> 
<p id="12.4%20%E7%BB%84%E5%90%88%E5%88%86%E5%8C%BA-toc" style="margin-left:40px;"><a href="#12.4%20%E7%BB%84%E5%90%88%E5%88%86%E5%8C%BA" rel="nofollow">12.4 组合分区</a></p> 
<p id="12.5%20%E5%88%86%E5%8C%BA%E4%B8%AD%E5%88%86%E6%9E%90%E5%B8%B8%E7%94%A8%E8%AF%AD%E5%8F%A5-toc" style="margin-left:40px;"><a href="#12.5%20%E5%88%86%E5%8C%BA%E4%B8%AD%E5%88%86%E6%9E%90%E5%B8%B8%E7%94%A8%E8%AF%AD%E5%8F%A5" rel="nofollow">12.5 分区中分析常用语句</a></p> 
<p id="12.6%20%E5%88%86%E5%8C%BA%E4%B8%AD%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99-toc" style="margin-left:40px;"><a href="#12.6%20%E5%88%86%E5%8C%BA%E4%B8%AD%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99" rel="nofollow">12.6 分区中常见报错</a></p> 
<p id="13%20Oracle%E4%BC%98%E5%8C%96-toc" style="margin-left:0px;"><a href="#13%20Oracle%E4%BC%98%E5%8C%96" rel="nofollow">13 Oracle优化</a></p> 
<p id="13.1%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96-toc" style="margin-left:40px;"><a href="#13.1%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96" rel="nofollow">13.1 数据库的设计优化</a></p> 
<p id="13.2%20SQL%E8%B0%83%E4%BC%98-toc" style="margin-left:40px;"><a href="#13.2%20SQL%E8%B0%83%E4%BC%98" rel="nofollow">13.2 SQL调优</a></p> 
<p id="13.3%20%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96-toc" style="margin-left:40px;"><a href="#13.3%20%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96" rel="nofollow">13.3 参数配置优化</a></p> 
<p id="13.4%20%E7%A1%AC%E4%BB%B6%E4%BC%98%E5%8C%96-toc" style="margin-left:40px;"><a href="#13.4%20%E7%A1%AC%E4%BB%B6%E4%BC%98%E5%8C%96" rel="nofollow">13.4 硬件优化</a></p> 
<p id="13.5%20%E4%BC%98%E5%8C%96%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7-toc" style="margin-left:40px;"><a href="#13.5%20%E4%BC%98%E5%8C%96%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7" rel="nofollow">13.5 优化常用工具</a></p> 
<p id="13.6%20%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF-toc" style="margin-left:40px;"><a href="#13.6%20%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF" rel="nofollow">13.6 优化思路</a></p> 
<p id="14%20%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93-toc" style="margin-left:0px;"><a href="#14%20%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93" rel="nofollow">14 数据仓库</a></p> 
<p id="14.1%20%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1-toc" style="margin-left:40px;"><a href="#14.1%20%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1" rel="nofollow">14.1 数据建模</a></p> 
<p id="14.1.1%20%E8%8C%83%E5%BC%8F%E5%BB%BA%E6%A8%A1-toc" style="margin-left:80px;"><a href="#14.1.1%20%E8%8C%83%E5%BC%8F%E5%BB%BA%E6%A8%A1" rel="nofollow">14.1.1 范式建模</a></p> 
<p id="14.1.2%20%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1-toc" style="margin-left:80px;"><a href="#14.1.2%20%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1" rel="nofollow">14.1.2 维度建模</a></p> 
<p id="14.1.3%20%E5%BB%BA%E6%A8%A1%E5%B7%A5%E5%85%B7-toc" style="margin-left:80px;"><a href="#14.1.3%20%E5%BB%BA%E6%A8%A1%E5%B7%A5%E5%85%B7" rel="nofollow">14.1.3 建模工具</a></p> 
<p id="14.2%20%E5%B8%B8%E8%A7%81%E8%A1%A8%E7%B1%BB%E5%9E%8B-toc" style="margin-left:40px;"><a href="#14.2%20%E5%B8%B8%E8%A7%81%E8%A1%A8%E7%B1%BB%E5%9E%8B" rel="nofollow">14.2 常见表类型</a></p> 
<p id="14.2.1%20%E6%8B%89%E9%93%BE%E8%A1%A8-toc" style="margin-left:80px;"><a href="#14.2.1%20%E6%8B%89%E9%93%BE%E8%A1%A8" rel="nofollow">14.2.1 拉链表</a></p> 
<p id="14.2.2%20%E5%85%A8%E9%87%8F%E8%A1%A8-toc" style="margin-left:80px;"><a href="#14.2.2%20%E5%85%A8%E9%87%8F%E8%A1%A8" rel="nofollow">14.2.2 全量表</a></p> 
<p id="14.2.3%20%E5%A2%9E%E9%87%8F%E8%A1%A8-toc" style="margin-left:80px;"><a href="#14.2.3%20%E5%A2%9E%E9%87%8F%E8%A1%A8" rel="nofollow">14.2.3 增量表</a></p> 
<p id="14.2.4%20%E6%B5%81%E6%B0%B4%E8%A1%A8-toc" style="margin-left:80px;"><a href="#14.2.4%20%E6%B5%81%E6%B0%B4%E8%A1%A8" rel="nofollow">14.2.4 流水表</a></p> 
<hr id="hr-toc"> 
<p><span style="background-color:#cccccc;">本文是将Oracle主要知识点由浅及深的系统性整理下来</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#cccccc;">目的有二：一是用于回顾与自查，二是希望能帮到学习Oracle的同志们</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#cccccc;">涉及的知识点多且广，定有很多不及的地方，请指点</span></p> 
<hr> 
<p></p> 
<h2 id="1%20Oracle%E7%B3%BB%E7%BB%9F%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84%E4%BB%8B%E7%BB%8D" style="text-align:center;"><strong>1 Oracle系统体系结构介绍</strong></h2> 
<p style="margin-left:0;text-align:left;">Oracle是一种关系型数据库。</p> 
<p style="margin-left:0;text-align:left;">Oracle体系结构主要有两部分组成：实例（Instance）和数据库（Database）。</p> 
<h3 id="1.1%20%E5%90%AF%E5%8A%A8%E5%85%B3%E9%97%ADOracle%E5%AE%9E%E4%BE%8B" style="text-align:justify;"><strong>1.1 启动关闭Oracle实例</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">1.如何启动Oracle实例：</p> 
<p style="margin-left:.0001pt;text-align:justify;">（1）先打开计算机管理中的服务，查看Oracle的几个服务是否打开。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="381" src="https://images2.imgbox.com/00/4f/WPpmGEGL_o.png" width="630"></p> 
<p style="margin-left:.0001pt;text-align:justify;">（2）打开终端，用管理员权限登陆到Oracle数据库服务器。</p> 
<p style="margin-left:.0001pt;text-align:justify;">（3）启动监听。</p> 
<p style="margin-left:.0001pt;text-align:justify;">isnrctl start</p> 
<p style="margin-left:.0001pt;text-align:justify;">（4）打开新的终端，用管理员权限登录到Oracle数据库服务器。</p> 
<p style="margin-left:.0001pt;text-align:justify;">sqlplus / as sysdba</p> 
<p style="margin-left:.0001pt;text-align:justify;">（5）启动Oracle实例。</p> 
<p style="margin-left:.0001pt;text-align:justify;">startup</p> 
<p style="margin-left:.0001pt;text-align:justify;">如果希望启动实例时自动应用任何未完成的恢复操作：</p> 
<p style="margin-left:.0001pt;text-align:justify;">startup recover</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">2.关闭数据库实例</p> 
<p style="margin-left:.0001pt;text-align:justify;">数据库的实例关闭有几种模式：</p> 
<p style="margin-left:.0001pt;text-align:justify;">SHUTDOWN ABORT：用于紧急情况的关闭</p> 
<p style="margin-left:.0001pt;text-align:justify;">SHUTDOWN IMMEDIATE：快速关闭，终止一切用户的相关活动。</p> 
<p style="margin-left:.0001pt;text-align:justify;">SHUTDOWN NORMAL：默认方式，关闭数据库需用户断开连接。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="2%20SQL%E8%AF%AD%E5%8F%A5" style="text-align:center;"><strong>2 SQL语句</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">Oracle的SQL语句分为4类：数据控制语言  DCL、数据定义语言  DDL、数据查询语言  DQL、数据操作语言  DML</p> 
<h3 id="2.1%E6%95%B0%E6%8D%AE%E6%8E%A7%E5%88%B6%E8%AF%AD%E8%A8%80%20%C2%A0DCL" style="text-align:justify;"><strong>2.1</strong><strong>数据控制语言  DCL</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#00b0f0;">为数据库用户赋予权限或者收回权限。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">grant    赋予权限</p> 
<p style="margin-left:.0001pt;text-align:justify;">revoke  收回权限</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:0;text-align:left;">1.给用户赋予基本的操作权限：</p> 
<p style="margin-left:0;text-align:left;">grant 权限的类型和名字 to 用户名;</p> 
<p style="margin-left:0;text-align:left;">grant connect,resource,dba to gzd;</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:0;text-align:left;">2.收回权限：</p> 
<p style="margin-left:0;text-align:left;">revoke 权限的类型和名字 from 用户名;</p> 
<p style="margin-left:0;text-align:left;">revoke resource,dba from gzd;</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">3.主要的权限的类型和名字:</p> 
<p style="margin-left:0;text-align:left;">connect  连接的权限</p> 
<p style="margin-left:0;text-align:left;">resource  写代码的权限</p> 
<p style="margin-left:0;text-align:left;">dba  管理的权限</p> 
<h3 id="2.2%E6%95%B0%E6%8D%AE%E5%AE%9A%E4%B9%89%E8%AF%AD%E8%A8%80%20%C2%A0DDL" style="text-align:justify;"><strong>2.2</strong><strong>数据定义语言  DDL</strong></h3> 
<p style="margin-left:.0001pt;text-align:left;">create、drop可对数据库用户、表、索引、自定义函数、存储过程等进行创建、删除。</p> 
<p style="margin-left:.0001pt;text-align:left;">alter可对用户信息进行修改，对表结构内容进行修改。</p> 
<p style="margin-left:.0001pt;text-align:left;">truncate可清空表中数据。</p> 
<p style="margin-left:.0001pt;text-align:left;">create     创建</p> 
<p style="margin-left:.0001pt;text-align:left;">alter       修改</p> 
<p style="margin-left:.0001pt;text-align:left;">drop       删除</p> 
<p style="margin-left:.0001pt;text-align:left;">truncate    清空</p> 
<h5 id="2.2.1%20%E7%94%A8%E6%88%B7%E7%B1%BB%E7%9A%84%E5%88%9B%E5%BB%BA%E3%80%81%E5%88%A0%E9%99%A4%E5%92%8C%E4%BF%AE%E6%94%B9%EF%BC%9A" style="text-align:justify;"><strong>2.2.1 用户类的创建、删除和修改：</strong></h5> 
<p style="margin-left:.0001pt;text-align:justify;">在创建用户时需要登陆有管理员DBA权限的账户。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">create user 用户名 identified by 密码;</p> 
<p style="margin-left:.0001pt;text-align:justify;">新建的用户必须赋予权限</p> 
<p style="margin-left:.0001pt;text-align:justify;">create user user1 identified by 123456;</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">删除用户</p> 
<p style="margin-left:.0001pt;text-align:justify;">drop user 用户名;</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">修改用户密码:</p> 
<p style="margin-left:.0001pt;text-align:justify;">alter user 用户名 identified by 密码;</p> 
<h5 id="2.2.2%20%E8%A1%A8%E7%9A%84%E5%88%9B%E5%BB%BA%E3%80%81%E5%88%A0%E9%99%A4%E3%80%81%E4%BF%AE%E6%94%B9%E3%80%81%E6%B8%85%E7%A9%BA" style="text-align:justify;"><strong>2.2.2 表的创建、删除、修改、清空</strong></h5> 
<p style="margin-left:.0001pt;text-align:justify;">创建表：</p> 
<p style="margin-left:.0001pt;text-align:justify;">create table 表名(</p> 
<p style="margin-left:.0001pt;text-align:justify;">列名1 数据类型 [primary key],</p> 
<p style="margin-left:.0001pt;text-align:justify;">列名2 数据类型 [unique],</p> 
<p style="margin-left:.0001pt;text-align:justify;">列名3 数据类型 [not null | null],</p> 
<p style="margin-left:.0001pt;text-align:justify;">列名4 数据类型 check(条件),</p> 
<p style="margin-left:.0001pt;text-align:justify;">列名5 数据类型 [references 表名(列名)]</p> 
<p style="margin-left:.0001pt;text-align:justify;">...</p> 
<p style="margin-left:.0001pt;text-align:justify;">列名N 数据类型 [default 默认值] [各种约束]</p> 
<p style="margin-left:.0001pt;text-align:justify;">);</p> 
<p style="margin-left:.0001pt;text-align:justify;">删除表：</p> 
<p style="margin-left:.0001pt;text-align:justify;">drop table 表名;</p> 
<p style="margin-left:.0001pt;text-align:justify;">修改表的名字：</p> 
<p style="margin-left:.0001pt;text-align:justify;">alter table 旧表名 rename to 新表名;</p> 
<p style="margin-left:.0001pt;text-align:justify;">清空表中数据：</p> 
<p style="margin-left:.0001pt;text-align:justify;">truncate 表名;</p> 
<h5 id="2.2.3%20alter%E7%9A%84%E7%94%A8%E6%B3%95%EF%BC%88%E5%85%B3%E4%BA%8E%E8%A1%A8%E7%BB%93%E6%9E%84%EF%BC%89" style="text-align:justify;"><strong>2.2.3 alter的用法（关于表结构）</strong></h5> 
<p style="margin-left:.0001pt;text-align:justify;">字段有相应的数据类型、约束条件。</p> 
<p style="margin-left:.0001pt;text-align:justify;">一、数据类型：</p> 
<p style="margin-left:.0001pt;text-align:justify;">数据类型主要有三种：字符型、数字型、时间日期型。</p> 
<p style="margin-left:.0001pt;text-align:justify;">添加字段：alter table TABLE_NAME add COLUMN_NAME varchar2(10);</p> 
<p style="margin-left:.0001pt;text-align:justify;">删除字段：alter table TABLE_NAME drop column COLUMN_NAME;</p> 
<p style="margin-left:.0001pt;text-align:justify;">更新字段名：alter table TABLE_NAME rename column column_old to column_new;</p> 
<p style="margin-left:.0001pt;text-align:justify;">修改字段数据类型：alter table table_name modify 字段名 varchar2(20);</p> 
<p style="margin-left:.0001pt;text-align:justify;">二、约束条件：</p> 
<p style="margin-left:.0001pt;text-align:justify;">约束条件有以下几种类型：</p> 
<p style="margin-left:0;text-align:left;">1. 主键：表格中最核心的列   primary key  一个表只能有一个主键</p> 
<p style="margin-left:0;text-align:left;">不能重复唯一，也不能为空</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">2. 非空：not null</p> 
<p style="margin-left:0;text-align:left;">填写的内容不能为空</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">3. 唯一： unique</p> 
<p style="margin-left:0;text-align:left;">数据不能重复可以为空，例如身份证或者手机号码</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">4. 检查： check</p> 
<p style="margin-left:0;text-align:left;">限制数据在某个范围之内</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">5. 外键： foreign key  外键只能和另一个表的主键关联，外键可以有多个</p> 
<p style="margin-left:0;text-align:left;">foreign key (从表列名) references 主表的表名(它的主键字段名)</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">6.默认值：default</p> 
<p style="margin-left:0;text-align:left;">当没有给列指定值的时候，则取默认值。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">修改约束条件：</p> 
<p style="margin-left:.0001pt;text-align:justify;">alter table 表名modify(列名  数据类型 约束条件);</p> 
<p style="margin-left:.0001pt;text-align:justify;">增加约束条件：</p> 
<p style="margin-left:.0001pt;text-align:justify;">alter table 表名 add constraint 约束条件的名字 约束关系(列名);</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="2.3%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E8%AF%AD%E8%A8%80%20%C2%A0DML" style="text-align:justify;"><strong>2.3数据操作语言  DML</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#00b0f0;">主要是对表进行插入数据，修改数据，删除数据。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;">insert 插入</p> 
<p style="margin-left:.0001pt;text-align:justify;">update 修改</p> 
<p style="margin-left:.0001pt;text-align:justify;">delete 删除</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">我就以曾写过的SQL来展示。</p> 
<p style="margin-left:0;text-align:left;">insert into student(id,name,sex,birthday) values(12,'test','男',sysdate);</p> 
<p style="margin-left:0;text-align:left;">update emp1 set sal=4000 where ename='daizian';</p> 
<p style="margin-left:0;text-align:left;">DELETE FROM student WHERE id = 1;</p> 
<h3 id="2.4%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80%20%C2%A0DQL" style="text-align:justify;"><strong>2.4数据查询语言  DQL</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">Select 查询</p> 
<p style="margin-left:.0001pt;text-align:justify;">查询语句是工作中使用最频繁的语句。</p> 
<p style="margin-left:.0001pt;text-align:justify;">select * from EMP;</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="3%20DQL%E6%95%B0%E6%8D%AE%E6%9F%A5%E8%AF%A2%E8%AF%AD%E8%A8%80" style="text-align:center;"><strong>3 DQL数据查询语言</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">查询语句大致有6种处理过程：去重distinct查询、where条件查询、group by分组查询、having过滤查询、order by排序查询、分页查询，还有3种多表进行的数据共查：多表查询、联合查询、子查询。这些方式都是为了便于得到我们想要的数据。</p> 
<p style="margin-left:.0001pt;text-align:justify;">语法：</p> 
<p style="margin-left:.0001pt;text-align:justify;">select [DISTINCT] [字段]|[*]</p> 
<p style="margin-left:.0001pt;text-align:justify;">from 表名</p> 
<p style="margin-left:.0001pt;text-align:justify;">[where 查询条件]</p> 
<p style="margin-left:.0001pt;text-align:justify;">[group by 分组条件]</p> 
<p style="margin-left:.0001pt;text-align:justify;">[having 过滤条件]</p> 
<p style="margin-left:.0001pt;text-align:justify;">[order by 排序条件 asc|desc]</p> 
<p style="margin-left:.0001pt;text-align:justify;">[分页条件];</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">执行顺序：</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">1. FROM阶段</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">2. WHERE阶段</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">3. GROUP BY阶段</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">4. HAVING阶段</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">5. SELECT阶段</span></p> 
<p style="margin-left:0;text-align:left;">6. ORDER BY阶段</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="3.1%20%E5%8E%BB%E9%87%8Ddistinct%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.1 去重distinct查询</strong></h3> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--查询所有部门的编号</span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">select distinct deptno from emp;</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="236" src="https://images2.imgbox.com/3c/f6/oXpsYZvU_o.png" width="376"></p> 
<h3 id="3.2%20where%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.2 where条件查询</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="371" src="https://images2.imgbox.com/57/79/uANLGwHN_o.png" width="666"></p> 
<p style="margin-left:.0001pt;text-align:justify;">除去上面的运算符，还有</p> 
<p style="margin-left:.0001pt;text-align:justify;">逻辑运算符与或非：<span style="background-color:#ffffff;">and、or、not</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;">类似于in的exist</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;">例between的用法</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--输出工资</span></span></em><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">在</span></span></em><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">2000-4000范围的数据</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">between</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">2000</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">and</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">4000</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="283" src="https://images2.imgbox.com/5a/41/MacoRDsQ_o.png" width="678"></p> 
<h3 id="3.3%20group%20by%E5%88%86%E7%BB%84%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.3 group by分组查询</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="255" src="https://images2.imgbox.com/92/47/IEu1IVG6_o.png" width="330"></p> 
<h3 id="3.4%20having%E8%BF%87%E6%BB%A4%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.4 having过滤查询</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">Having 过滤查询的功能和where一致，不同的地方是执行顺序不同。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="268" src="https://images2.imgbox.com/3d/ce/cv99ZqWP_o.png" width="454"></p> 
<h3 id="3.5%20order%20by%E6%8E%92%E5%BA%8F%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.5 order by排序查询</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="270" src="https://images2.imgbox.com/51/17/rk3mwNAY_o.png" width="444"></p> 
<p style="margin-left:.0001pt;text-align:justify;">这里order by 为啥可以用别名<span style="background-color:#ffffff;"><span style="color:#000080;">sum_sal</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,而having不能用别名呢？</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000080;">是因为前面所讲的执行顺序的知识。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000080;">Order by的执行顺序在select之后。</span></span></p> 
<h3 id="3.6%20%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.6 分页查询</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">分页查询在MySQL上用法比较方便：limit</p> 
<p style="margin-left:.0001pt;text-align:justify;">在Oracle的用法是：</p> 
<p style="margin-left:.0001pt;text-align:justify;">给表加上行号的字段，再通过子查询的方式来实现。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="313" src="https://images2.imgbox.com/72/6b/xaD5h5iB_o.png" width="692"></p> 
<h3 id="3.7%20%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.7 多表查询</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">多表查询是多张表相关联进行的查询，关键点在于表关联字段。</p> 
<h4 id="3.7.1%20%E5%86%85%E8%BF%9E%E6%8E%A5" style="text-align:justify;"><strong>3.7.1 内连接</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">select  * from a join b on a.条件=b.条件 where 条件;</span></span></em>  </p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="224" src="https://images2.imgbox.com/7b/70/sWpL7i2t_o.png" width="431"></p> 
<p style="margin-left:.0001pt;text-align:justify;">e.deptno=d.deptno的作用：它对两个表进行连接查询，oracle会扫描dept表，分别检查每条记录在连接条件e.deptno=d.deptno中字段的值从emp表取出的记录的列值是否相等。如果相等，则将这两个记录连接，产生一条新的记录作为查询到的一行，再继续从表emp中取下一条记录。重复这个步骤，一直到处理完emp表的全部符合条件的记录。</p> 
<h4 id="3.7.2%20%E5%A4%96%E8%BF%9E%E6%8E%A5" style="text-align:justify;"><strong>3.7.2 外连接</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">外连接有三种类型：左连接、右连接、全连接。</p> 
<h5 id="3.7.2.1%20%E5%B7%A6%E8%BF%9E%E6%8E%A5" style="text-align:justify;"><strong>3.7.2.1 左连接</strong></h5> 
<p style="margin-left:.0001pt;text-align:justify;">作用：可以显示相等连接时左表存在右表不存在的数据，右表不存在的记录用空值显示</p> 
<p style="margin-left:.0001pt;text-align:justify;">select * from a left join b on a.条件=b.条件</p> 
<h5 id="3.7.2.2%20%E5%8F%B3%E8%BF%9E%E6%8E%A5" style="text-align:justify;"><strong>3.7.2.2 右连接</strong></h5> 
<p style="margin-left:.0001pt;text-align:justify;">作用：可以显示相等连接时左表不存在右表存在的数据，左表不存在的记录用空值显示</p> 
<p style="margin-left:.0001pt;text-align:justify;">select * from a right join b on a.条件=b.条件</p> 
<h5 id="3.7.2.3%20%E5%85%A8%E8%BF%9E%E6%8E%A5" style="text-align:justify;"><strong>3.7.2.3 全连接</strong></h5> 
<p style="margin-left:.0001pt;text-align:justify;">作用：可以显示相等连接时左右表互相不存在的数据、左右表互相不存在的记录用空值显示</p> 
<p style="margin-left:.0001pt;text-align:justify;">select * from a full join b on a.条件=b.条件</p> 
<h4 id="3.7.3%20%E4%BA%A4%E5%8F%89%E8%BF%9E%E6%8E%A5" style="text-align:justify;"><strong>3.7.3 交叉连接</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">交叉连接的原理是笛卡尔积，也就是两表的乘积。</p> 
<p style="margin-left:.0001pt;text-align:justify;">假如a表有3条数据，b表有4条数据，那么交叉连接后共12条数据。</p> 
<p style="margin-left:.0001pt;text-align:justify;">select * from a cross join b</p> 
<h3 id="3.8%20%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.8 联合查询</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">联合查询就是将上下两个结果集进行并集、交集、差集运算。</p> 
<p style="margin-left:.0001pt;text-align:justify;">取结果集时有几点注意：</p> 
<ol><li style="text-align:justify;">上下两个结果集的字段的类型要一致。</li><li style="text-align:justify;">上下两个结果集的字段的顺序要一致。</li><li style="text-align:justify;">上下两个结果集的字段的数量要一致。</li></ol> 
<h4 id="3.8.1%20%E5%B9%B6%E9%9B%86" style="text-align:justify;"><strong>3.8.1 并集</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">并集有两种处理方式：union all和union，一个是两个结果集数据全取合并成一个结果集，一个是做去重后的结果集。</p> 
<p style="margin-left:.0001pt;text-align:justify;">例：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="233" src="https://images2.imgbox.com/c9/5d/1m9DKSp7_o.png" width="484"></p> 
<h4 id="3.8.2%20%E4%BA%A4%E9%9B%86" style="text-align:justify;"><strong>3.8.2 交集</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">intersect：显示两个结果集共有的数据部分。</p> 
<h4 id="3.8.3%20%E5%B7%AE%E9%9B%86" style="text-align:justify;"><strong>3.8.3 差集</strong></h4> 
<p style="margin-left:0;text-align:left;">minus：显示第一个结果集A有的内容，但是第二个结果集B没有的数据，即A-B。</p> 
<p style="margin-left:0;text-align:left;">例：</p> 
<p style="margin-left:0;text-align:left;">运行该语句的结果显示如下：</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="203" src="https://images2.imgbox.com/84/85/bbcIezzq_o.png" width="381"></p> 
<p>运行这条语句显示：</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="229" src="https://images2.imgbox.com/68/8a/A9RIdAAM_o.png" width="385"></p> 
<p>取差集后：</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="203" src="https://images2.imgbox.com/84/f5/8uSG8MAZ_o.png" width="379"></p> 
<h3 id="3.9%20%E5%AD%90%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.9 子查询</strong></h3> 
<h4 id="3.9.1%20FROM%E5%AD%90%E5%8F%A5%E4%B8%AD%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.9.1 </strong><strong>FROM</strong><strong>子句中的子查询</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="230" src="https://images2.imgbox.com/7c/99/p3SpWGQ2_o.png" width="458"></p> 
<h4 id="3.9.2%20%E8%BF%90%E7%AE%97%E7%AC%A6%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.9.2 运算符的子查询</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;">运算符主要有：</span><span style="background-color:#ffffff;">&gt;、&gt;=、&lt;、&lt;=、!=、&lt;&gt;、=、&lt;=&gt;</span><span style="background-color:#ffffff;">、</span><span style="background-color:#ffffff;">in、not in、any、some、all、exits</span><span style="background-color:#ffffff;">、</span><span style="background-color:#ffffff;">not exists</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;">现以exists举例（主要当初学习exists，摸索了好两天才学明白它的作用）：</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">用法：</span>select * from A where exists(select * from B where A.id = B.id);</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;">原理：</span></p> 
<ol><li style="text-align:justify;"><span style="background-color:#ffffff;">先执行外查询</span>select * from A，然后取出一条数据传给内查询。</li><li style="text-align:justify;">再执行内查询select * from B，外查询传入的数据和内查询的数据如果满足where条件A.id = B.id，则返回ture，如果一条都不满足，则返回false。</li><li style="text-align:justify;">内查询返回true，则外查询的这行数据保留，反之内查询返回false则外查询的这行数据不保留。外查询的所有数据逐行查询传入内查询匹对。</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">例：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="296" src="https://images2.imgbox.com/4c/a1/nRJjM0Jz_o.png" width="505"></p> 
<h4 id="3.9.3%20SELECT%E4%B8%8B%E7%9A%84%E5%AD%90%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.9.3 </strong><strong>SELECT</strong><strong>下</strong><strong>的子查询</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">Select下的子查询使用情况我列举了3个常见用法，可看案例：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="317" src="https://images2.imgbox.com/e1/7b/cAlRsa83_o.png" width="693"></p> 
<h4 id="3.9.4%20with...as%20%E5%AD%90%E6%9F%A5%E8%AF%A2" style="text-align:justify;"><strong>3.9.4 with...as 子查询</strong></h4> 
<p style="margin-left:0;text-align:left;"> with...as用来定义一个sql片段,且该片段会被整个sql语句反复使用很多次，这个sql片段就相当于是一个公用临时表</p> 
<p style="margin-left:0;text-align:left;">例：</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">with</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> aaa </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">as</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> aaa; </span></span> </p> 
<p style="margin-left:0;text-align:left;">with...as需和查询语句一起执行，否则报错无select关键字；还有不能在with..as后加分号，不然也报错无select关键字。另外查询语句有多表查询不能有相同的列，否则，with..as无法识别具体哪个列。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<h2 id="4%20Oracle%E5%87%BD%E6%95%B0" style="text-align:center;"><strong>4 Oracle函数</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">Oracle的常见函数我有整理成表格形式，没有用法，只有函数的功能，可通过搜索该函数去网上找相应的用法。列举一些常用的，不过我会持续更新。</p> 
<h3 id="4.1%20%E6%95%B0%E5%80%BC%E5%9E%8B%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.1 数值型函数</strong></h3> 
<table border="1" cellspacing="0" style="margin-left:4.8pt;width:198.6pt;"><tbody><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">数值函数</span></p> </td></tr><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">近似函数，五舍四入：round(x,2)</span></p> </td></tr><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">向下取整函数：floor(x)</span></p> </td></tr><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">向上取整函数：ceil(x)</span></p> </td></tr><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">取随机函数：DBMS_RANDOM.VALUE(a,b)</span></p> </td></tr><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">幂运算函数：power(x,n)</span></p> </td></tr><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">平方根函数：sqrt(x)</span></p> </td></tr><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">绝对值函数：abs(x)</span></p> </td></tr><tr><td style="width:198.6pt;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">取余函数：mod(x,y)</span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="4.2%20%E5%AD%97%E7%AC%A6%E5%9E%8B%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.2 字符型函数</strong></h3> 
<table border="1" cellspacing="0" style="margin-left:4.8pt;width:334.25pt;"><tbody><tr><td style="width:334.2pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">字符串函数</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">截取字符串的一部分：substr(字符串, 开始位置, 连续取值的长度)</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">两个字符串的拼接：concat(x1, x2)</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">字符串替换：replace(x, old, new)</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">字符查找函数:instr(源字符串, 目标字符串, 起始位置, 匹配序号)</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">转大写字母:upper()</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">转小写字母:lower()</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:justify;"><span style="color:#000000;">返回一个字符串的长度:length()</span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="4.3%20%E6%97%B6%E9%97%B4%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.3 时间日期函数</strong></h3> 
<table border="1" cellspacing="0" style="margin-left:4.8pt;width:389.45pt;"><tbody><tr><td style="width:389.4pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">日期函数</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">返回当前日期和时间：SYSDATE</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">从一个date类型中截取year,month,day：extract()</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">计算日期的月份偏移 正数时间往后推移，负数时间往前推移：add_months(x, m) </span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">计算日期的最后一天：last_day(x)</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">计算两个日期之间的月份差：months_between(x1, x2)</span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;">例：</p> 
<p style="margin-left:.0001pt;text-align:justify;">select extract(year from sysdate),extract(month from sysdate),extract(day from sysdate) from dual;</p> 
<p style="margin-left:.0001pt;text-align:justify;">select months_between(date'2020-9-2',date'2019-9-1') from dual;</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="4.4%20%E8%81%9A%E5%90%88%E5%88%86%E7%BB%84%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.4 聚合分组函数</strong></h3> 
<table border="1" cellspacing="0" style="margin-left:4.8pt;width:383px;"><tbody><tr><td style="width:380px;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">聚合函数</span></p> </td></tr><tr><td style="width:380px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">SUM：计算一组数值的总和。</span></p> </td></tr><tr><td style="width:380px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">AVG：计算一组数值的平均值。</span></p> </td></tr><tr><td style="width:380px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">MAX：返回一组数值中的最大值。</span></p> </td></tr><tr><td style="width:380px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">MIN：返回一组数值中的最小值。</span></p> </td></tr><tr><td style="width:380px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">COUNT：计算一组数值的个数。</span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="4.5%20%E5%BC%80%E7%AA%97%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.5 开窗函数</strong></h3> 
<h4 id="4.5.1%20%E7%94%A8%E6%B3%95" style="text-align:justify;"><strong>4.5.1 用法</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0000ff;">计算函数部分()  over(partition by 列名 order by 列名 asc|desc)</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0000ff;">--计算函数部分：sum,count,max,min,avg,row_number(),rank()等，只能是一个函数</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0000ff;">--over() 关键字</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0000ff;">--partition by ：分组，根据分区表达式的条件逻辑将单个结果集分成N组，不是必选项</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0000ff;">--order by：对分区中的数据排序,不是必选项</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#0000ff;">例：</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--计算工资与部门最高工资的差</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span> </p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">emp.</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">*,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">max</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sal</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">over</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">by</span></span><span style="background-color:#ffffff;"><span style="color:#000000;"> deptno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span> <span style="background-color:#ffffff;"><span style="color:#000000;">maxsal</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">sal</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">-</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">max</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sal</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">over</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">by</span></span><span style="background-color:#ffffff;"><span style="color:#000000;"> deptno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span><span style="background-color:#ffffff;"><span style="color:#000000;"> c </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000000;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="266" src="https://images2.imgbox.com/4c/ff/MGQ1T4Gx_o.png" width="384"></p> 
<p></p> 
<h4 id="4.5.2%20%E6%8E%92%E5%90%8D%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.5.2 排名函数</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">1.row_number()：根据某个列，按照顺序进行排序 1 2 3 4</p> 
<p style="margin-left:.0001pt;text-align:justify;">2.rank()：根据某个列，按照顺序进行排序，如果值相同，会出现并列的名次，会跳过占用的名次 1 2 2 4</p> 
<p style="margin-left:.0001pt;text-align:justify;">3.dense_rank()：根据某个列，按照顺序进行排序，如果值相同，会出现并列的名次，不会跳过名次 1 2 2 3</p> 
<h4 id="4.5.3%20%E5%B9%B3%E7%A7%BB%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.5.3 平移函数</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">在平常业务中一般用来实现数据的同比和环比的计算。</p> 
<p style="margin-left:.0001pt;text-align:justify;">同比：今年的7月和去年的7月相比，在两个时间范围内，取相同时间节点的数据进行比较</p> 
<p style="margin-left:.0001pt;text-align:justify;">环比：今年的7月和今年的6月相比，在同一个时间范围内，取相邻的时间节点的数据进行比较</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>lag()</strong><strong>：</strong><strong>将数据往下平移一行 + 开窗函数</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>lead()</strong></strong><strong><strong>：</strong></strong><strong><strong>将数据往上平移一行</strong></strong><strong> </strong><strong>+ 开窗函数</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">例：</p> 
<p style="margin-left:.0001pt;text-align:justify;">表及数据：</p> 
<pre><code class="language-sql">create table sale_info(
y number,
m number,
amount number(7,2)
);
insert into sale_info values(2018,1,2342);
insert into sale_info values(2018,2,1234);
insert into sale_info values(2018,3,3545);
insert into sale_info values(2018,4,3456);
insert into sale_info values(2018,5,2342);
insert into sale_info values(2018,6,4534);
insert into sale_info values(2018,7,3453);
insert into sale_info values(2018,8,2342);
insert into sale_info values(2018,9,4352);
insert into sale_info values(2018,10,1312);
insert into sale_info values(2018,11,3453);
insert into sale_info values(2018,12,1235);
insert into sale_info values(2019,1,3453);
insert into sale_info values(2019,2,1233);
insert into sale_info values(2019,3,3445);
insert into sale_info values(2019,4,1233);
insert into sale_info values(2019,5,1231);
insert into sale_info values(2019,6,4234);
insert into sale_info values(2019,7,1231);
insert into sale_info values(2019,8,2131);
insert into sale_info values(2019,9,1231);
insert into sale_info values(2019,10,3421);
insert into sale_info values(2019,11,1231);
insert into sale_info values(2019,12,1231);
commit;</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">需求1：计算2019年每一个月和2018年同月份的数据增长率。(同比)</p> 
<p style="margin-left:.0001pt;text-align:justify;">需求2：计算2019年的每一个月，比上个月增长了百分之多少？(环比)</p> 
<p style="margin-left:.0001pt;text-align:justify;">需求1：</p> 
<pre><code class="language-sql">select 
       b.*,c/lo,
       round(c/lo*100,2)||'%' 增长率
from 
       (select
              a.*,lag(amount) over(partition by m order by y) lo,
              amount-lag(amount) over(partition by m order by y) c 
       from sale_info a) b
where y=2019;</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="301" src="https://images2.imgbox.com/77/4d/Kmy1Y6pv_o.png" width="464"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">注：这里可以看到同比增长率显示有问题，-0.08%不能显示。这是Oracle的显示问题，对于小于1的小数，小数点前面的0是不显示的。</p> 
<p style="margin-left:.0001pt;text-align:justify;">解决方案：对该数值转为字符类型。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#000080;">to_char(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">round</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(c/lo*</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">100</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'fm99990.0099'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'%'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> 增长率</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;">需求2：</p> 
<pre><code class="language-sql">select 
      b.*,amount-lo c, 
      to_char(round((amount-lo)/lo*100,2),'fm99990.0099')||'%' 环比增长率
from 
      (select a.*,lag(amount) over(order by m) lo from sale_info a where y=2019) b;  </code></pre> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="225" src="https://images2.imgbox.com/db/6e/w5TcSSM4_o.png" width="490"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">当然，同环比的计算方法也可以用多表连接来处理，在方法上都不难。</p> 
<h3 id="4.6%20%E8%BD%AC%E6%8D%A2%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.6 转换函数</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">转换函数最常用的就4个：</p> 
<ol><li style="text-align:justify;">转换成日期类型：to_date()</li><li style="text-align:justify;">转换成字符串类型：to_char()</li><li style="text-align:justify;">转换成数值类型：to_number()</li><li style="text-align:justify;">将某种数据类型的表达式显式转换为另一种数据类型：cast(表达式 as 数据类型)</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">其他还有进制类等的相互转换，因也没用过，就不说明了。</p> 
<h3 id="4.7%E5%85%B6%E4%BB%96%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>4.7其他函数</strong></h3> 
<table border="1" cellspacing="0" style="margin-left:4.8pt;width:599px;"><tbody><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">其他函数</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">rownum：取行号函数</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">rowid：数据去重，表里面每一行数据，在数据库中的唯一编号，不会出现重复的数据</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">pivot：行列转换</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">case when：条件取值函数</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">decode：功能同case when差不多，也是条件取值</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">unpivot：列转行函数</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">nvl(列名, 如果这列为空时设置的默认值)</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">nvl2(列名, 如果不为空显示的内容, 如果为空显示的内容)</span></p> </td></tr><tr><td style="width:596px;"> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">sign()：是用来判断数据是负数、0、正数分别返回-1、0、1</span></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="5%20PLSQL%E7%BC%96%E7%A8%8B" style="text-align:center;"><strong>5 PLSQL编程</strong></h2> 
<h3 id="5.1%E6%A0%BC%E5%BC%8F%E5%86%99%E6%B3%95" style="text-align:justify;"><strong>5.1格式写法</strong></h3> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">  --变量的声明部分</p> 
<p style="margin-left:0;text-align:left;">  a number;</p> 
<p style="margin-left:0;text-align:left;">  b varchar2(10);</p> 
<p style="margin-left:0;text-align:left;">  c date;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">  --代码的逻辑和执行部分</p> 
<p style="margin-left:0;text-align:left;">  a:=100;</p> 
<p style="margin-left:0;text-align:left;">  b:='hello';</p> 
<p style="margin-left:0;text-align:left;">  c:=sysdate;</p> 
<p style="margin-left:0;text-align:left;">  dbms_output.put_line(a||b||c);</p> 
<p style="margin-left:0;text-align:left;">end;</p> 
<p style="margin-left:0;text-align:left;"></p> 
<h3 id="5.2%20%E5%8F%98%E9%87%8F" style="text-align:justify;"><strong>5.2 变量</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">变量主要有3种类型：普通变量、引用型变量、记录型变量。</p> 
<h4 id="5.2.1%20%E6%99%AE%E9%80%9A%E5%8F%98%E9%87%8F" style="text-align:justify;"><strong>5.2.1 普通变量</strong></h4> 
<p style="margin-left:0;text-align:left;">普通变量</p> 
<p style="margin-left:0;text-align:left;">a number;</p> 
<h4 id="5.2.2%20%E5%BC%95%E7%94%A8%E5%9E%8B%E5%8F%98%E9%87%8F" style="text-align:justify;"><strong>5.2.2 引用型变量</strong></h4> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">格式：</span><span style="color:#0000ff;">变量名字</span>  <span style="color:#0000ff;">表名</span><span style="color:#0000ff;">.</span><span style="color:#0000ff;">列名</span><span style="color:#0000ff;">%type;</span></p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">  v_sal emp.sal%type;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">  select sal into v_sal from emp where empno=7369;</p> 
<p style="margin-left:0;text-align:left;">  dbms_output.put_line('工资是'||v_sal);</p> 
<p style="margin-left:0;text-align:left;">end;</p> 
<h4 id="5.2.3%20%E8%AE%B0%E5%BD%95%E5%9E%8B%E5%8F%98%E9%87%8F" style="text-align:justify;"><strong>5.2.3 记录型变量</strong></h4> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">记录型变量</span><span style="color:#0000ff;">也叫</span><span style="color:#0000ff;">数组型变量</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">格式：</span><span style="color:#0000ff;">变量名</span>  <span style="color:#0000ff;">表名</span><span style="color:#0000ff;">%rowtype;</span></p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">  v_user emp%rowtype;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">  select * into v_user from emp where empno=7369;</p> 
<p style="margin-left:0;text-align:left;">  dbms_output.put_line(v_user.ename||','||v_user.job);</p> 
<p style="margin-left:0;text-align:left;">end;</p> 
<h4 id="5.2.4%20%E5%8F%98%E9%87%8F%E8%BE%93%E5%85%A5" style="text-align:justify;"><strong>5.2.4 变量输入</strong></h4> 
<p style="margin-left:0;text-align:left;">变量值的输入：</p> 
<p style="margin-left:0;text-align:left;">数字类型的变量名:=&amp;提示语句;</p> 
<p style="margin-left:0;text-align:left;">字符串类型的变量名:='&amp;提示语句';</p> 
<p style="margin-left:0;text-align:left;">例：</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  v_user emp%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowtype</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--v_empno emp.empno%type;</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  v_ename emp.ename%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">type</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--v_empno:=&amp;输入要查询的员工编号;  </span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  v_ename:=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'&amp;输入员工姓名'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> v_user </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> ename=v_ename;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  dbms_output.put_line(v_user.ename||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">','</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.job);</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span> </p> 
<p style="margin-left:0;text-align:left;">注：</p> 
<p style="margin-left:0;text-align:left;">1.在代码块中，所有的select都一定要有into来存放你查询出来的数据</p> 
<p style="margin-left:0;text-align:left;">into 变量，只能放一个数据，并且一定要有数据。</p> 
<p style="margin-left:0;text-align:left;">2.在提示语句中，字符串和数值的一个有引号一个没有引号</p> 
<p style="margin-left:0;text-align:left;"></p> 
<h3 id="5.3%20If%E6%9D%A1%E4%BB%B6%E5%88%A4%E6%96%AD%E8%AF%AD%E5%8F%A5" style="text-align:justify;"><strong>5.3 If条件判断语句</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">If判断语句3种写法，应该都不难于理解。</p> 
<p style="margin-left:.0001pt;text-align:justify;">1.</p> 
<p style="margin-left:0;text-align:left;">if 条件判断 then</p> 
<p style="margin-left:0;text-align:left;">    执行sql语句;</p> 
<p style="margin-left:0;text-align:left;">end if;</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">2.</p> 
<p style="margin-left:0;text-align:left;">if 条件判断 then</p> 
<p style="margin-left:0;text-align:left;">    执行sql语句;</p> 
<p style="margin-left:0;text-align:left;">else</p> 
<p style="margin-left:0;text-align:left;">    执行sql语句;</p> 
<p style="margin-left:0;text-align:left;">end if;</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">3.</p> 
<p style="margin-left:0;text-align:left;">if 条件判断 then</p> 
<p style="margin-left:0;text-align:left;">    执行sql语句;</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">elsif </span>条件判断 then</p> 
<p style="margin-left:0;text-align:left;">    执行sql语句;</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">elsif </span>条件判断 then</p> 
<p style="margin-left:0;text-align:left;">    执行sql语句;</p> 
<p style="margin-left:0;text-align:left;">......</p> 
<p style="margin-left:0;text-align:left;">else</p> 
<p style="margin-left:0;text-align:left;">    执行sql语句;</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">end if;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">和if语句相同类型和效果的另一些判断语句的写法：case when</p> 
<p style="margin-left:0;text-align:left;">case</p> 
<p style="margin-left:0;text-align:left;">when 条件判断 then 执行的sql语句 <span style="color:#0000ff;">;</span></p> 
<p style="margin-left:0;text-align:left;">when 条件判断 then 执行的sql语句 <span style="color:#0000ff;">;</span></p> 
<p style="margin-left:0;text-align:left;">when 条件判断 then 执行的sql语句 <span style="color:#0000ff;">;</span></p> 
<p style="margin-left:0;text-align:left;">......</p> 
<p style="margin-left:0;text-align:left;">else 执行的sql语句;</p> 
<p style="margin-left:0;text-align:left;"><span style="color:#0000ff;">end case</span>;</p> 
<p style="margin-left:.0001pt;text-align:justify;">例：输入部门编号得到部门员工数量。</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  v_deptno </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> :=&amp;输入部门编号;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">   c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">   v_user emp%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowtype</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">count</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(*) </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> deptno=v_deptno;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> c=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">0</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">       dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'部门编号:'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_deptno||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'的部门没有员工'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">elsif</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> c&gt;=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">       dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'部门编号:'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_deptno||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'的部门有'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||c ||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'名员工'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">else</span></span> </p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> v_user </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> deptno=v_deptno;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">       dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'部门编号:'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_deptno||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'的部门'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'员工编号：'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.empno</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">       ||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'的工资是'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.sal); </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h3 id="5.4%20%E5%BE%AA%E7%8E%AF%E8%AF%AD%E5%8F%A5" style="text-align:justify;"><strong>5.4 循环语句</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">Oracle循环有3种：for循环、while循环、loop循环。</p> 
<p style="margin-left:.0001pt;text-align:justify;">循环终止有两个关键字：</p> 
<p style="margin-left:0;text-align:left;">continue：直接开始下一次的循环，忽略掉continue后面的代码。</p> 
<p style="margin-left:0;text-align:left;">exit：跳出整个循环，停止循环。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">在循环中有个特别的关键语句：goto，但是不建议使用，容易引起逻辑的混乱，不过也有奇效，后续不再讲，就在此处单独说说。</p> 
<p style="margin-left:0;text-align:left;">定义：可以理解为一个标签，使用goto能进行代码的任意的跳转。</p> 
<p style="margin-left:0;text-align:left;">例：（可以自己试验下结果就能理解它的定义作用）</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> i </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">..10 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span>   </p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> i=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">5</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">goto</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> here;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    dbms_output.put_line(i); </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'world'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">); </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  &lt;&lt;here&gt;&gt;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'hello'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">); </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h4 id="5.4.1%20for%E5%BE%AA%E7%8E%AF" style="text-align:justify;"><strong>5.4.1 for循环</strong></h4> 
<p style="margin-left:0;text-align:left;"><strong><strong>功能：</strong></strong><strong><strong>有循环范围的循环方式，一开始就知道运行次数的循环方法。</strong></strong></p> 
<p style="margin-left:0;text-align:left;"><strong><strong>格式：</strong></strong></p> 
<p style="margin-left:0;text-align:left;">for  变量名  in  循环范围  loop</p> 
<p style="margin-left:0;text-align:left;">执行的sql语句;</p> 
<p style="margin-left:0;text-align:left;">end  loop;</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">例1：将1+3+5+<em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>+......+</em></span></span></em>99的和，计算出来</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  s:=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">0</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> i </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">..99 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">mod</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(i,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">      s:=s+i;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  dbms_output.put_line(s); </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">例2：输入部门编号，输出部门人数。</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    v_dept </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">:=&amp;请输入部门编号;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">    <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--v_user emp%rowtype;</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:0;text-align:left;">        <span style="background-color:#ffffff;"><span style="color:#008080;">select count</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(*) </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">deptno= v_dept;</span></span></p> 
<p style="margin-left:0;text-align:left;">        <span style="background-color:#ffffff;"><span style="color:#008080;">case</span></span></p> 
<p style="margin-left:0;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">when </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">c=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">0 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'部门编号：'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_dept || </span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'的部门没有员工'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">        <span style="background-color:#ffffff;"><span style="color:#008080;">else</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'部门编号：'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_dept || </span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'的部门有' </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">|| c ||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'名员工！！！'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">for </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">i </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">* </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">deptno=v_dept) </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">              dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'-----'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||i.empno||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'  '</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||i.ename||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'  '</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||i.job);</span></span></p> 
<p style="margin-left:0;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">end loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">        <span style="background-color:#ffffff;"><span style="color:#008080;">end case</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">; </span></span></p> 
<h4 id="5.4.2%20While%E5%BE%AA%E7%8E%AF" style="text-align:justify;"><strong>5.4.2 While循环</strong></h4> 
<p style="margin-left:0;text-align:left;">while循环，当循环的范围不是特别确定的时候。</p> 
<p style="margin-left:0;text-align:left;">while条件如果判断为真，就进入到循环，否则跳出循环</p> 
<p style="margin-left:0;text-align:left;">格式：</p> 
<p style="margin-left:0;text-align:left;">while 条件判断 loop</p> 
<p style="margin-left:0;text-align:left;">    执行的sql语句;</p> 
<p style="margin-left:0;text-align:left;">end loop;</p> 
<p style="margin-left:.0001pt;text-align:justify;">例：输出数字1到10</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  n </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  n:=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">while</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> n&lt;=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'数字'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||n); </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    n:=n+</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h4 id="5.4.3%20Loop%E5%BE%AA%E7%8E%AF" style="text-align:justify;"><strong>5.4.3 Loop循环</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">Loop循环也是适用当循环的范围不是特别确定的时候。</p> 
<p style="margin-left:.0001pt;text-align:justify;">Loop循环条件判断为真，则exit退出循环，否则进入循环。</p> 
<p style="margin-left:.0001pt;text-align:justify;">格式：</p> 
<p style="margin-left:.0001pt;text-align:justify;">loop</p> 
<p style="margin-left:.0001pt;text-align:justify;">  exit when 条件判断;</p> 
<p style="margin-left:.0001pt;text-align:justify;">  执行的sql语句;</p> 
<p style="margin-left:.0001pt;text-align:justify;">end loop;</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">例：输出10,8,6,4,2,0</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  n </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  n:=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">exit</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">when</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> n&lt;</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">0</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    dbms_output.put_line(n);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    n:=n-</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">; </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h4 id="5.3.4%20continue%E5%92%8Cexit" style="text-align:justify;"><strong>5.3.4 </strong><strong>continue</strong><strong>和</strong><strong>exit</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">定义：</p> 
<p style="margin-left:0;text-align:left;">continue：直接开始下一次的循环，忽略掉continue后面的代码</p> 
<p style="margin-left:0;text-align:left;">exit：跳出整个循环，停止循环</p> 
<p style="margin-left:.0001pt;text-align:justify;">用例来说明它们之间的区别：</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span> </p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> i </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">..5 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">          <span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> j </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">..3 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">             <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> j=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span>  <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--当i=5时结束内层循环，继续下一个内循环j=3。</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">                <span style="background-color:#ffffff;"><span style="color:#008080;">continue</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">             <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">             dbms_output.put_line(i);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">          <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">          dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'a'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;       </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">输出结果：</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">1</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">1</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">2</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">2</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">3</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">3</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">4</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">4</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">5</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">5</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span> </p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> i </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">..5 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">          <span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> j </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">..3 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">             <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> j=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span> <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--当i=5时跳出内层循环，继续下一个外循环i</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">                <span style="background-color:#ffffff;"><span style="color:#008080;">exit</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">             <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">             dbms_output.put_line(i);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">          <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">          dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'a'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;       </span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">输出结果：</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">1</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">2</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">3</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">4</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">5</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">a</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">根据结果显示：很明显的看出</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">continue</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">是结束内层当前循环，继续下一次的内层循环。</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">exit</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">是直接结束整个循环，整个循环没有后续循环操作了。</span></span></p> 
<h3 id="5.5%20%E5%8A%A8%E6%80%81SQL" style="text-align:justify;"><strong>5.5 动态SQL</strong></h3> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">定义：将</span><span style="background-color:#ffffff;">SQL</span><span style="background-color:#ffffff;">语句写在一个字符串中，在存储过程中解析字符串执行</span><span style="background-color:#ffffff;">SQL</span><span style="background-color:#ffffff;">。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">一般情况下代码块只支持dml和</span><span style="background-color:#ffffff;">dql</span><span style="background-color:#ffffff;">语句。 增加关键字 </span><span style="background-color:#ffffff;">execute immediate </span><span style="background-color:#ffffff;">可以执行动态</span><span style="background-color:#ffffff;">sql</span><span style="background-color:#ffffff;">语句。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">继续举例说明：</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">需求：备份所有E开头的表，备份的表名格式：原表名_月日，如：</span><span style="background-color:#ffffff;">emp_0</span><span style="background-color:#ffffff;">7</span><span style="background-color:#ffffff;">2</span><span style="background-color:#ffffff;">9。</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--要先准备一个表，用来存储当前所需要的找出来的表名     </span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">table</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> tmp_t(tn </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">100</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">));  </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">; </span></span><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--E开头的表的数量</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    v_tn </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">100</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--存储表名的变量</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">200</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">     <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--找出E开头的表的数量</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">count</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(*) </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> user_tables </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> table_name </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">like</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">'E%'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">; </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">     <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--将表名保存到表中</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> tmp_t </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> table_name  </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> user_tables </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> table_name </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">like</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">'E%'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;  </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">commit</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> i </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">..c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">  tn </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> v_tn </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> tn,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rownum</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> r </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> tmp_t) </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> r=i;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">       s:=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'create table '</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_tn||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'_0926 as select * from '</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> || v_tn;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">       dbms_output.put_line(s);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">execute</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">immediate</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> s;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">另外说明一个知识点，打印输出：</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">d</span><span style="background-color:#ffffff;">bms_output.put是总共就输出一行，然后在后面依次输出数据（变成一行多列）。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">dbms_output.put_line</span><span style="background-color:#ffffff;">是总共就输出一列，然后在下面依次输出数据（变成一列多行）。</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<h2 id="6%20%E7%B4%A2%E5%BC%95" style="text-align:center;"><strong>6 索引</strong></h2> 
<h3 id="6.1%20%E7%B4%A2%E5%BC%95%E5%90%AB%E4%B9%89" style="text-align:justify;"><strong>6.1 索引含义</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">什么是索引？</p> 
<p style="margin-left:0;text-align:left;">索引相当于目录，是一种数据结构。是对某些特定列中的数据进行排序，生成索引表，该列作为WHERE条件时，扫描索引列，根据ROWID快速定位具体记录，提高查询效率。</p> 
<p style="margin-left:0;text-align:left;">创建索引的条件：</p> 
<ol><li style="text-align:left;">首先表要大，如果只有几兆，还不如不建，全表扫描说不定更好；</li><li style="text-align:left;">select 操作占大部分的表上创建索引；</li><li style="text-align:left;">where 子句中出现最频繁的列上创建索引；</li><li style="text-align:left;">索引的数量不宜过多，看表的大小和字段数量合适规划；</li><li style="text-align:left;">索引需要维护，它会降低dml语句的速度，所以大量的dml时，可以先删除再创建。</li></ol> 
<h3 id="6.2%20%E4%BD%BF%E7%94%A8%E7%B4%A2%E5%BC%95" style="text-align:justify;"><strong>6.2 使用索引</strong></h3> 
<p style="margin-left:0;text-align:left;">添加索引的语法：</p> 
<p style="margin-left:0;text-align:left;">create index 索引名 on 表名(列名);</p> 
<p style="margin-left:0;text-align:left;">删除索引的语法：</p> 
<p style="margin-left:0;text-align:left;">drop index 索引名;</p> 
<p style="margin-left:0;text-align:left;"><strong><span style="color:#df402a;"><strong>查看索引：</strong></span></strong></p> 
<p style="margin-left:0;text-align:left;">select * from user_indexes 查询现有的索引</p> 
<p style="margin-left:0;text-align:left;">select * from user_ind_columns 可获知索引建立在那些字段上</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">修改索引：alter</p> 
<p style="margin-left:0;text-align:left;">写法都没必要讲，一个表最多就那么几个索引，直接删了重建更好。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">例：快速查到某个表的索引建立在那些字段上</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="161" src="https://images2.imgbox.com/de/74/wP1OYmJ5_o.png" width="692"></p> 
<p></p> 
<h3 id="6.3%20%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%88%AB" style="text-align:justify;"><strong>6.3 索引类别</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">主要索引结构：B树索引、位图索引和HASH索引。</p> 
<p style="margin-left:0;text-align:left;">B树索引：</p> 
<p style="margin-left:0;text-align:left;">含义：使用树状结构，通过分支和叶子节点来存储索引信息</p> 
<p style="margin-left:0;text-align:left;">类型：主键、唯一、外键、普通、组合、函数索引</p> 
<p style="margin-left:0;text-align:left;">位图索引：</p> 
<p style="margin-left:0;text-align:left;">含义：使用二进制位来表示索引信息，适用于具有少量不同取值的列。</p> 
<p style="margin-left:0;text-align:left;">Hash索引：</p> 
<p style="margin-left:0;text-align:left;">定义：哈希索引适用于等值查询。</p> 
<h4 id="6.3.1%20%E4%B8%BB%E9%94%AE%E7%B4%A2%E5%BC%95%E3%80%81%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%E3%80%81%E5%A4%96%E9%94%AE%E7%B4%A2%E5%BC%95" style="text-align:justify;"><strong>6.3.1 主键索引、唯一索引、外键索引</strong></h4> 
<p style="margin-left:0;text-align:left;">主键索引：在创建表的时候，添加了主键约束，那么就会自动生成主键索引。</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">alter table </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">add constraint </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">pri_empno </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">primary key</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">); </span></span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--</span></span></em><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">通过主键约束的创建，来自动生成这个主键索引</span></span></em></p> 
<p style="margin-left:0;text-align:left;">唯一索引：在创建表的时候，会根据唯一约束自动的生成唯一索引，唯一索引确保索引列中的值唯一。</p> 
<p style="margin-left:0;text-align:left;">外键索引：外键索引用于定义表的主键；外键索引用于加速外键关联查询。</p> 
<h4 id="6.3.2%20%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95" style="text-align:justify;"><strong>6.3.2 普通索引</strong></h4> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#ff0000;">普通索引：这个列经常需要被查询，但是这个列又没有什么特点</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create index </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">idx_ename </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">on </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">emp</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">ename</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<h4 id="6.3.3%20%E7%BB%84%E5%90%88%E7%B4%A2%E5%BC%95" style="text-align:justify;"><strong>6.3.3 组合索引</strong></h4> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#ff0000;">就是普通索引的升级版。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#ff0000;">组合索引：和普通索引相同，有多个列需要同时被查询，但是这些列也没有什么特点，那么就放在一起，创建一个组合索引</span></span></p> 
<p style="margin-left:0;text-align:left;">create index 索引名 on 表名(a,b,c);</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create index </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">idx_sal_job </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">on </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">emp</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sal</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">job</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">注：</p> 
<p style="margin-left:0;text-align:left;">1.在查询时需要使用第一列的列查询，否则组合索引会失效。</p> 
<p style="margin-left:0;text-align:left;">2.组合索引中应将最具选择性的列放在最前面。选择性就是列中的值唯一或几乎唯一。这样能有效的减少查询的结果集大小，从而提高查询性能。</p> 
<h4 id="6.3.4%20%E5%87%BD%E6%95%B0%E7%B4%A2%E5%BC%95" style="text-align:justify;"><strong>6.3.4 函数索引</strong></h4> 
<p style="margin-left:0;text-align:left;">函数索引：如果你的列，是需要被使用函数计算之后再用来查询，那么计算过程需要的函数要写在索引里面</p> 
<p style="margin-left:0;text-align:left;">create index idx_func_hiredate on emp(to_char(hiredate,'yyyy'));</p> 
<h4 id="6.3.5%20%E4%BD%8D%E5%9B%BE%E7%B4%A2%E5%BC%95" style="text-align:justify;"><strong>6.3.5 位图索引</strong></h4> 
<p style="margin-left:0;text-align:left;">位图索引：列的内容是由大量的重复的内容组成的  bitmap</p> 
<p style="margin-left:0;text-align:left;">create bitmap index idx_emp_deptno on emp(deptno);</p> 
<h4 id="6.3.6%20%E5%88%86%E5%8C%BA%E8%A1%A8%E7%B4%A2%E5%BC%95" style="text-align:justify;"><strong>6.3.6 分区表索引</strong></h4> 
<p style="margin-left:0;text-align:left;">分区表索引分为：本地索引、全局索引。</p> 
<p style="margin-left:0;text-align:left;">定义：分区索引就是简单地把一个索引分成多个片断。通过把一个索引分成多个片断，可以访问更小的片断(也更快)，并且可以把这些片断分别存放在不同的磁盘驱动器上(避免I/O问题)。</p> 
<p style="margin-left:0;text-align:left;">应用：本地索引更适合用于频繁查询单个分区的情况，而全局索引更适合用于需要跨多个分区进行查询的场景。</p> 
<p style="margin-left:0;text-align:left;">1.本地索引（分为有前缀索引和无前缀索引）</p> 
<p style="margin-left:0;text-align:left;">create index idx_hash_ename on emp_hash(ename) local;</p> 
<p style="margin-left:0;text-align:left;">2.全局索引</p> 
<p style="margin-left:0;text-align:left;">create index idx_hash_job on emp_hash(job) global;</p> 
<p>--全局索引测试1，索引分区键和表分区键相同,成功<br> create index ig_test_id on testindex(id) global <br> partition by range(id)<br> ( partition p1 values less than (5),<br>   partition p2 values less than (30),<br>   partition p3 values less than (maxvalue)</p> 
<p>);<br> --全局索引测试2，索引的分区键和表分区键不相同,成功<br> create index ighash_test_id on testindex(name) global <br> partition by hash(name)<br> ( partition p1,<br>   partition p2,<br>   partition p3</p> 
<p>);<br> --全局索引测试3,：报错GLOBAL 分区索引必须加上前缀。（全局索引是指索引键值必须和分区键值相同，也就是所谓的前缀索引）<br> create index i_test_id on testindex(name) global <br> partition by range(id)<br> ( partition p1 values less than (5),<br>   partition p2 values less than (30),<br>   partition p3 values less than (maxvalue)</p> 
<p>);</p> 
<p style="margin-left:0;text-align:left;">区别：</p> 
<p style="margin-left:0;">本地索引必须建在分区表上，全局索引和表没有直接的关联；使用场景不同；</p> 
<h3 id="6.4%20%E7%B4%A2%E5%BC%95%E5%A4%B1%E6%95%88%E6%83%85%E5%86%B5%E5%8F%8A%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88" style="text-align:justify;"><strong>6.4 索引失效情况及解决方案</strong></h3> 
<p style="margin-left:0;text-align:left;">1. 经常需要被修改的列，索引是一直处于失效状态的</p> 
<p style="margin-left:0;text-align:left;">重建索引</p> 
<p style="margin-left:0;text-align:left;">2. 数据发生了隐性的转换，这里使用了函数。</p> 
<p style="margin-left:0;text-align:left;">select * from emp where to_char(hiredate,'yyyy')=1981;</p> 
<p style="margin-left:0;text-align:left;">新建针对该列的函数索引</p> 
<p style="margin-left:0;text-align:left;">3. 计算的时候，公式放在了等号的左边</p> 
<p style="margin-left:0;text-align:left;">select * from emp where sal+1000=4000 and job='MANAGER'；</p> 
<p style="margin-left:0;text-align:left;">修改为：</p> 
<p style="margin-left:0;text-align:left;">select * from emp where sal=3000 and job='MANAGER';</p> 
<p style="margin-left:0;text-align:left;">4. 查询的时候使用不等于</p> 
<p style="margin-left:0;text-align:left;">select * from emp where deptno!=20;</p> 
<p style="margin-left:0;text-align:left;">修改为：</p> 
<p style="margin-left:0;text-align:left;">select * from emp where deptno&lt;20 or deptno&gt;20;</p> 
<p style="margin-left:0;text-align:left;">5. 查询的时候使用了like模糊查询</p> 
<p style="margin-left:0;text-align:left;">select * from emp where ename like '%LL%';</p> 
<p style="margin-left:0;text-align:left;">6. 空值查询</p> 
<p style="margin-left:0;text-align:left;">select * from emp where ename is null;</p> 
<p style="margin-left:0;text-align:left;">7. 组合索引没有使用第一列的列查询</p> 
<p style="margin-left:0;text-align:left;">8. 查询的时候，使用了非函数索引的函数</p> 
<p style="margin-left:0;text-align:left;"></p> 
<h2 id="7%20%E6%B8%B8%E6%A0%87" style="text-align:center;"><strong>7 游标</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">定义：</p> 
<p style="margin-left:.0001pt;text-align:justify;">游标是用来存储多条查询查询数据的一种数据结构，通过指针，从上而下移动，遍历每条数据。因为遍历的数据依次是保存到内存中，所以当数据量很大，容易造成内存不足而崩溃。</p> 
<p style="margin-left:.0001pt;text-align:justify;">游标分为静态游标和动态游标。</p> 
<h3 id="7.1%20%E9%9D%99%E6%80%81%E6%B8%B8%E6%A0%87" style="text-align:justify;"><strong>7.1 静态游标</strong></h3> 
<p style="margin-left:0;text-align:left;">定义：在编译期间就声明定义了数据结果集，所以结果集是固定的。如果在静态游标打开后对表进行修改，则游标的结果集不会受到影响。</p> 
<p style="margin-left:0;text-align:left;">写法：</p> 
<p style="margin-left:0;text-align:left;">声明一个游标</p> 
<p style="margin-left:0;text-align:left;">cursor 游标名 is select 语句;</p> 
<p style="margin-left:0;text-align:left;"><strong><strong>打开游标</strong></strong></p> 
<p style="margin-left:0;text-align:left;">open 游标名;</p> 
<p style="margin-left:0;text-align:left;"><strong><strong>使用游标，获取游标当前的内容</strong></strong></p> 
<p style="margin-left:0;text-align:left;">fetch 游标名 into 变量;</p> 
<p style="margin-left:0;text-align:left;"><strong><strong>关闭游标</strong></strong></p> 
<p style="margin-left:0;text-align:left;">close 游标名;</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">实例：（用while循环操作游标，打印出emp表所有员工信息）</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">   <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--声明一个游标</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">cursor</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">is</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">   v_user emp%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowtype</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">   <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--打开游标</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">open</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">   <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--使用游标</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">fetch</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> v_user;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">while</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">found</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">       dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'员工编号'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.empno||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'的部门号是'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.deptno||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'工资是'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.sal);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">fetch</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> v_user;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--关闭游标</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">close</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;  </span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">游标属性及其作用：</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<table border="1" cellspacing="0" style="margin-left:4.8pt;width:472.25pt;"><tbody><tr><td style="width:102pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">属性</span></p> </td><td style="width:77.4pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">返回值类型</span></p> </td><td style="width:292.8pt;"> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">作用</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">sql%isopen</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">布尔型</span></p> </td><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">判断游标是否 </span><span style="color:#000000;">'</span><span style="color:#000000;">开启</span><span style="color:#000000;">'</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">sql%found</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">布尔型</span></p> </td><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">判断游标是否 </span><span style="color:#000000;">'</span><span style="color:#000000;">获取</span><span style="color:#000000;">' </span><span style="color:#000000;">到值</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">sql%notfound</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">布尔型</span></p> </td><td> <p style="margin-left:.0001pt;text-align:left;"><span style="color:#000000;">判断游标是否 </span><span style="color:#000000;">'</span><span style="color:#000000;">没有获取</span><span style="color:#000000;">' </span><span style="color:#000000;">到值（常用于 </span><span style="color:#000000;">"</span><span style="color:#000000;">退出循环</span><span style="color:#000000;">"</span><span style="color:#000000;">）</span></p> </td></tr><tr><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">sql%rowcount</span></p> </td><td> <p style="margin-left:.0001pt;text-align:center;"><span style="color:#000000;">整型</span></p> </td><td> <p style="margin-left:.0001pt;text-align:left;"> <span style="color:#000000;">'</span><span style="color:#000000;">当前</span><span style="color:#000000;">' </span><span style="color:#000000;">成功执行的数据行数（非 </span><span style="color:#000000;">"</span><span style="color:#000000;">总记录数</span><span style="color:#000000;">"</span><span style="color:#000000;">）</span></p> </td></tr></tbody></table> 
<p style="margin-left:0;text-align:left;"><strong><span style="color:#fa0000;"><strong>例：</strong></span></strong><strong><span style="color:#fa0000;"><strong>通过sql关键字来查看，本次数据修改的范围，一共有多少行。</strong></span></strong></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"> <span style="background-color:#ffffff;"><span style="color:#008080;">delete</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal&gt;=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">5000</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;"> dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sql</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowcount</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"> <span style="background-color:#ffffff;"><span style="color:#008080;">update</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">set</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2000</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal&lt;</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2000</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;"> dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sql</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowcount</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h3 id="7.2%20%E5%8A%A8%E6%80%81%E6%B8%B8%E6%A0%87" style="text-align:justify;"><strong>7.2 动态游标</strong></h3> 
<p style="margin-left:0;text-align:left;">定义： 动态游标是在运行时定义的，用于在查询结果集可能发生更改的情况下遍历结果集。如果在动态游标打开后对表进行修改，则游标的结果集会更新。</p> 
<p style="margin-left:0;text-align:left;">写法上与静态游标不同，需先声明游标类型，且静态游标是在声明部分定义赋值，动态游标是在代码执行部分定义赋值的。</p> 
<p style="margin-left:0;text-align:left;">直接举例：（用loop循环打印出emp表中部门号20的所有员工信息）</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--声明一个动态游标的类型  自己定义的dongtai_c和number   varchar2  date是一个意思</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">type</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dongtai_c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">is</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">ref</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">cursor</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--声明游标</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    mc dongtai_c;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    v_user emp%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowtype</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--打开游标的同时，给游标赋值</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">open</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> deptno=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">20</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--使用loop循环读取游标</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">fetch</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> v_user;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">exit</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">when</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">notfound</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">       dbms_output.put_line(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'员工编号'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.empno||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'的部门号是'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.deptno||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'工资是'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||v_user.sal);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">    <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--关闭游标</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">    <span style="background-color:#ffffff;"><span style="color:#008080;">close</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> mc;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h3 id="7.3%20%E6%A1%88%E4%BE%8B" style="text-align:justify;"><strong>7.3 案例</strong></h3> 
<p style="margin-left:0;text-align:left;">建表语句：</p> 
<p style="margin-left:0;text-align:left;">CREATE TABLE EMPLOYEES (</p> 
<p style="margin-left:0;text-align:left;">  ID NUMBER PRIMARY KEY,</p> 
<p style="margin-left:0;text-align:left;">  NAME VARCHAR2(50) NOT NULL,</p> 
<p style="margin-left:0;text-align:left;">  SALARY NUMBER NOT NULL,</p> 
<p style="margin-left:0;text-align:left;">  DEPARTMENT_ID NUMBER</p> 
<p style="margin-left:0;text-align:left;">);</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">INSERT INTO EMPLOYEES (ID, NAME, SALARY, DEPARTMENT_ID) VALUES (1, '张三', 10000, 101);</p> 
<p style="margin-left:0;text-align:left;">INSERT INTO EMPLOYEES (ID, NAME, SALARY, DEPARTMENT_ID) VALUES (2, '李四', 12000, 101);</p> 
<p style="margin-left:0;text-align:left;">INSERT INTO EMPLOYEES (ID, NAME, SALARY, DEPARTMENT_ID) VALUES (3, '王五', 11000, 102);</p> 
<p style="margin-left:0;text-align:left;">INSERT INTO EMPLOYEES (ID, NAME, SALARY, DEPARTMENT_ID) VALUES (4, '赵六', 9000, 103);</p> 
<p style="margin-left:0;text-align:left;">INSERT INTO EMPLOYEES (ID, NAME, SALARY, DEPARTMENT_ID) VALUES (5, '钱七', 13000, 101);</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">需求：使用游标打印出表中员工信息及工资总额。</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="275" src="https://images2.imgbox.com/80/29/JZBPiKDy_o.png" width="692"></p> 
<p></p> 
<p style="margin-left:0;text-align:left;">输出结果：</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="180" src="https://images2.imgbox.com/00/ed/sV3XaqOH_o.png" width="304"></p> 
<p></p> 
<h2 id="8%20%E8%A7%86%E5%9B%BE" style="text-align:center;"><strong>8 视图</strong></h2> 
<p style="margin-left:0;text-align:left;">视图是从数据库一个或多个表中导出的虚拟表，视图本身并不包含任何数据，它只包含映射到基表的一个查询语句，当基表数据发生变化，视图数据也随之变化。</p> 
<p style="margin-left:0;text-align:left;">作用：是为了简化查询，也提高了数据的安全性。</p> 
<p style="margin-left:.0001pt;text-align:justify;">视图有两种分类：普通视图和物化视图。</p> 
<h3 id="8.1%20%E8%A7%86%E5%9B%BE%E6%93%8D%E4%BD%9C" style="text-align:justify;"><strong>8.1 视图操作</strong></h3> 
<h4 id="8.1.1%20%E5%88%9B%E5%BB%BA%E8%A7%86%E5%9B%BE" style="text-align:justify;"><strong>8.1.1 创建视图</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">语句：</p> 
<p style="margin-left:0;text-align:left;">create view 视图名 as</p> 
<p style="margin-left:0;text-align:left;">select 语句</p> 
<p style="margin-left:0;text-align:left;">with read only;</p> 
<h4 id="8.1.2%20%E5%88%A0%E9%99%A4%E8%A7%86%E5%9B%BE" style="text-align:justify;"><strong>8.1.2 删除视图</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">drop view 视图名；</p> 
<h4 id="8.1.3%20%E4%BF%AE%E6%94%B9%E8%A7%86%E5%9B%BE" style="text-align:justify;"><strong>8.1.3 修改视图</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">语句：</p> 
<p style="margin-left:0;text-align:left;">修改视图：（可以在不用删除原视图的情况下更新）</p> 
<p style="margin-left:0;text-align:left;">create or replace view 修改；</p> 
<p style="margin-left:0;text-align:left;">没有则创建。</p> 
<h4 id="8.1.4%20%E6%9B%B4%E6%96%B0%E8%A7%86%E5%9B%BE" style="text-align:justify;"><strong>8.1.4 更新视图</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">和更新表的数据一样。</p> 
<p style="margin-left:0;text-align:left;">update view_name set name ='开发部'；</p> 
<p style="margin-left:0;text-align:left;">注意：</p> 
<p style="margin-left:0;text-align:left;">因为在使用update或delete 执行某些数据时，会出现某一行删除的情况，一般会在原创建视图中末尾加上：</p> 
<p style="margin-left:0;text-align:left;">WITH CHECK OPTION</p> 
<h3 id="8.2%20%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE" style="text-align:justify;"><strong>8.2 物化视图</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">定义：这是一个真实的物理的表，它将查询语句的结果集当成一个新的表保存起来，同时会对原表的数据进行同步。</p> 
<p style="margin-left:.0001pt;text-align:justify;">格式：</p> 
<p style="margin-left:.0001pt;text-align:justify;">create materialized view 物化视图名字</p> 
<p style="margin-left:.0001pt;text-align:justify;">refresh on commit | demand</p> 
<p style="margin-left:.0001pt;text-align:justify;">start with 时间点 next 下一次更新的时间点</p> 
<p style="margin-left:.0001pt;text-align:justify;">as</p> 
<p style="margin-left:.0001pt;text-align:justify;">select 语句;</p> 
<p style="margin-left:.0001pt;text-align:justify;">含义：refresh on commit：类似于实时更新，原表提交数据时更新</p> 
<p style="margin-left:.0001pt;text-align:justify;">      refresh on demand: 根据需要更新</p> 
<p style="margin-left:0;text-align:left;">物化视图更新的方法：</p> 
<p style="margin-left:0;text-align:left;">1. complete        完全刷新，整个表格全部都更新一次数据</p> 
<p style="margin-left:0;text-align:left;">2. fast                快速刷新，更新你变更部分的数据</p> 
<p style="margin-left:0;text-align:left;">3. force                默认的更新方式，默认的更新方法就是fast        </p> 
<p style="margin-left:0;text-align:left;">4. never                不要更新表格</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">格式：</span></span></p> 
<p style="margin-left:0;text-align:left;">declare</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">dbms_mview.refresh('物化视图的名字','更新的方法');</p> 
<p style="margin-left:0;text-align:left;">end;</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">例：</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create materialized view </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">stu_nv_201</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">refresh on demand</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">as </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">* </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">student_a02 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">ssex</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'男' </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">and </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sage</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">&gt;</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">20</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">update </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">student_a02 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">set </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sname</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'王小san' </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'s021'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">commit</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">  dbms_mview.refresh</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'stu_nv_201'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'complete'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h3 id="8.3%20%E6%99%AE%E9%80%9A%E8%A7%86%E5%9B%BE%E4%B8%8E%E7%89%A9%E5%8C%96%E8%A7%86%E5%9B%BE%E7%9A%84%E5%8C%BA%E5%88%AB" style="text-align:justify;"><strong>8.3 普通视图与物化视图的区别</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">1.存储不同：普通视图是虚拟的表，不占用磁盘空间。物化视图是真实的表，会占用磁盘空间。</p> 
<p style="margin-left:.0001pt;text-align:justify;">2.作用不同：普通视图是为了简化查询。物化视图是为了保存更新的数据。</p> 
<p style="margin-left:.0001pt;text-align:justify;">3.更新方式不同：普通视图是实时更新。物化视图有两种：按需更新、提交数据时更新。</p> 
<p style="margin-left:.0001pt;text-align:justify;">4.查询时间不同：如果原表占用内存增大，普通视图查询时间不变，而物化视图是会减少查询时间的。</p> 
<p style="margin-left:.0001pt;text-align:justify;">5.物化视图可以建索引，普通视图不行。</p> 
<h2 id="9%20%E9%94%81" style="text-align:center;"><strong>9 锁</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">锁是面试中经常问到的题，在工作中也经常会碰到相关的问题。</p> 
<p style="margin-left:.0001pt;text-align:justify;">锁是用于管理并发访问数据库对象的机制。锁可以防止多个会话同时修改同一个对象，从而确保数据的一致性和完整性。也就是事务只能被一个线程占用。只有这个锁释放了，其他线程才能占用。</p> 
<h3 id="9.1%20%E4%BA%8B%E5%8A%A1" style="text-align:justify;"><strong>9.1 事务</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">讲锁得先理解事务，事务是什么？</p> 
<p style="margin-left:.0001pt;text-align:justify;">事务是最小的不可再分的工作单元，有DML语句产生。它有四个特征：</p> 
<p style="margin-left:.0001pt;text-align:justify;">原子性：事务是最小单元，不可再分</p> 
<p style="margin-left:.0001pt;text-align:justify;">一致性：事务要求DML的语句，必须保证全部同时成功提交或者同时失败回滚。</p> 
<p style="margin-left:.0001pt;text-align:justify;">隔离性：事务A和事务B具有隔离性。</p> 
<p style="margin-left:.0001pt;text-align:justify;">持久性：内存的数据持久到硬盘文件中。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">开启事务：任何一条DML语句(insert、update、delete)执行，标志事务的开启。</p> 
<p style="margin-left:0;text-align:left;">事务结束：</p> 
<p style="margin-left:0;text-align:left;">  提交：成功的结束，将所有的DML语句操作历史记录和底层硬盘数据来一次同步。</p> 
<p style="margin-left:0;text-align:left;">  回滚：失败的结束，将所有的DML语句操作历史记录全部清空。</p> 
<h3 id="9.2%20%E9%94%81%E7%9A%84%E5%AE%9A%E4%B9%89" style="text-align:justify;"><strong>9.2 锁的定义</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">锁从需求上看分为：共享锁和排他锁。</p> 
<p style="margin-left:.0001pt;text-align:justify;">共享锁：允许多个会话同时读取一个对象，但不允许任何会话修改该对象。这种锁适用于读取操作，可以提高并发性能。</p> 
<p style="margin-left:.0001pt;text-align:justify;">排他锁：只允许一个会话同时对一个对象进行读取和修改操作。当一个会话持有排他锁时，其他会话无法读取或修改该对象。这种锁适用于写操作，可以确保数据的一致性。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">细化从范围上看分为：表级锁和行锁。</p> 
<p style="margin-left:.0001pt;text-align:justify;">表级锁：为了保证在修改表数据时，表的结构不会改变。在使用DDL或DML语句时产生。</p> 
<p style="margin-left:.0001pt;text-align:justify;">行锁：使用DML时，会生成行锁，被修改的数据所在的行会被锁定，他人无法进行操作，属于排他锁。这时候也会自动生成该表的表级锁，不允许其他会话进行对该表DDL的操作。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">从上锁的主动性和被动性上看分为：乐观锁和悲观锁。</p> 
<p style="margin-left:.0001pt;text-align:justify;">乐观锁：数据库默认的。</p> 
<p style="margin-left:.0001pt;text-align:justify;">悲观锁：需要通过for update提前占用数据的资源。</p> 
<p style="margin-left:.0001pt;text-align:justify;">写法：select 语句 + for update;</p> 
<p style="margin-left:.0001pt;text-align:justify;">在用户A修改之前就对返回的数据集进行上锁，防止其他用户的修改。如果用户B修改数据，那么他就会产生阻塞，需等到用户A事务结束。</p> 
<p style="margin-left:.0001pt;text-align:justify;">悲观锁的缺点：主动加锁可能会导致时间过长，限制其他用户的访问。所以从并发性上看不推荐使用。</p> 
<h3 id="9.3%20%E6%AD%BB%E9%94%81%E5%8E%9F%E5%9B%A0%E5%8F%8A%E5%A4%84%E7%90%86" style="text-align:justify;"><strong>9.3 死锁原因及处理</strong></h3> 
<p style="margin-left:0;text-align:left;">死锁产生的原因：当两个用户互相希望持有对方的资源时就会发生死锁,也就是说两个用户互相等待对方释放资源时,这个时候就产生了死锁。</p> 
<p style="margin-left:0;text-align:left;">（举例易懂）：</p> 
<p style="margin-left:0;text-align:left;">1：用户 1 对 A 表某行数据进行 Update，没有提交事务。</p> 
<p style="margin-left:0;text-align:left;">2：用户 2 对 B 表某行数据进行 Update，没有提交事务。</p> 
<p style="margin-left:0;text-align:left;">此时双方不存在资源共享的问题。</p> 
<p style="margin-left:0;text-align:left;">3：如果用户 2 此时对 A 表中那行数据作 update,则会发生阻塞，需要等到用户1的事务结束。</p> 
<p style="margin-left:0;text-align:left;">4：如果此时用户 1 又对 B 表的那一行数据作 update，也产生阻塞，等待用户2的事务结束。</p> 
<p style="margin-left:0;text-align:left;">这样双方都在等待对方释放锁资源，这就是死锁。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">处理办法：只需释放掉其中一个资源即可。</p> 
<p style="margin-left:0;text-align:left;">--查看所有被上了锁的对象    69539</p> 
<p style="margin-left:0;text-align:left;">select * from v$locked_object;</p> 
<p style="margin-left:0;text-align:left;">--找到锁的对象，是在哪个表上面，根据自己找到的这个表的名字，回去找session_id    131</p> 
<p style="margin-left:0;text-align:left;">select * from dba_objects where object_id=69539;</p> 
<p style="margin-left:0;text-align:left;">--找锁的id的 serial#    9555</p> 
<p style="margin-left:0;text-align:left;">select * from v$session where sid=131;</p> 
<p style="margin-left:0;text-align:left;">--根据这两个编号，杀掉这个锁</p> 
<p style="margin-left:0;text-align:left;">alter system kill session '131,9555';</p> 
<h2 id="10%20%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B" style="text-align:center;"><strong>10 存储过程</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">存储过程的形式学习简单，就是带有名字的代码块。</p> 
<p style="margin-left:.0001pt;text-align:justify;">什么时候会用到存储过程？</p> 
<p style="margin-left:0;text-align:left;"><strong><strong>一个固定的功能的代码块，并且这个代码需要经常的反复的运行。</strong></strong></p> 
<p style="margin-left:0;text-align:left;">比如：</p> 
<ol><li style="text-align:justify;">常用的业务计算。</li><li style="text-align:justify;">数据增量、全量操作。</li><li style="text-align:justify;">日志的操作（如每天建立新的日志表分区）。</li></ol> 
<h3 id="10.1%20%E5%88%9B%E5%BB%BA%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B" style="text-align:justify;"><strong>10.1 创建存储过程</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">存储过程的写法有4种形式，无参、带入参、带出参、入参出参都有</p> 
<p style="margin-left:.0001pt;text-align:justify;">1.没有参数的存储过程</p> 
<p style="margin-left:0;text-align:left;">create or replace procedure 存储过程名字</p> 
<p style="margin-left:0;text-align:left;">as</p> 
<p style="margin-left:0;text-align:left;">   变量的声明;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">   执行的sql语句;</p> 
<p style="margin-left:0;text-align:left;">end;</p> 
<p style="margin-left:0;text-align:left;">2.创建一个有输入参数的存储过程</p> 
<p style="margin-left:0;text-align:left;">create or replace procedure 存储过程名字(输入参数名字  in  数据类型)</p> 
<p style="margin-left:0;text-align:left;">as</p> 
<p style="margin-left:0;text-align:left;">   变量的声明;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">   执行的sql语句;</p> 
<p style="margin-left:0;text-align:left;">end;</p> 
<p style="margin-left:0;text-align:left;">3.有输出参数的存储过程</p> 
<p style="margin-left:0;text-align:left;">create or replace procedure 存储过程名字(参数名字  out  数据类型)</p> 
<p style="margin-left:0;text-align:left;">as</p> 
<p style="margin-left:0;text-align:left;">   变量的声明;</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">   执行的sql语句;</p> 
<p style="margin-left:0;text-align:left;">end;</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">4.同时有输入和输出的存储过程</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">create or replace procedure 存储过程名字(参数名字 in 数据类型,参数名字  out  数据类型)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">as</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">   变量的声明;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">begin</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">   执行的sql语句;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">end;</span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">注：带</span><span style="background-color:#ffffff;">有输出参数的存储过程，需要放入到代码块中进行调用</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">例：</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">or</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">replace</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">procedure</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> pro_p4(n1 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,n2 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">out</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">as</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  s:=n1+n2;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--调用</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  pro_p4(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1.5</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1.8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,s);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  dbms_output.put_line(s); </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h3 id="10.2%20%E8%B0%83%E7%94%A8%E5%AD%98%E5%82%A8%E8%BF%87%E7%A8%8B" style="text-align:justify;"><strong>10.2 调用存储过程</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">调用存储过程有两种方式：</p> 
<p style="text-align:justify;">        1.call调用</p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">call</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> pro_</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">name</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">();</span></span></p> 
<p style="text-align:justify;">        2.代码块调用</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  pro_p4(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1.5</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1.8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,s);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  dbms_output.put_line(s); </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h3 id="10.3%20%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86" style="text-align:justify;"><strong>10.3 异常处理</strong></h3> 
<p style="margin-left:0;text-align:left;">在代码中捕获所有出现的异常和错误</p> 
<p style="margin-left:0;text-align:left;">create or replace procedure 过程名</p> 
<p style="margin-left:0;text-align:left;">as</p> 
<p style="margin-left:0;text-align:left;">  --声明部分</p> 
<p style="margin-left:0;text-align:left;">begin</p> 
<p style="margin-left:0;text-align:left;">  --执行部分</p> 
<p style="margin-left:0;text-align:left;">exception</p> 
<p style="margin-left:0;text-align:left;">  when 异常的名字 then</p> 
<p style="margin-left:0;text-align:left;">      对异常的处理</p> 
<p style="margin-left:0;text-align:left;">  when 异常的名字 then</p> 
<p style="margin-left:0;text-align:left;">      对异常的处理</p> 
<p style="margin-left:0;text-align:left;">  when others then</p> 
<p style="margin-left:0;text-align:left;">      对异常的处理</p> 
<p style="margin-left:0;text-align:left;">end;</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">others表示所有的错误。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">异常有三类：系统预定义的、非预定义的、自定义的</p> 
<ol><li style="text-align:justify;">系统预定义的异常：有名字有编号，大致有20来个吧。（我就不一一说明，百度吧）</li><li style="text-align:justify;">非预定义的异常：有错误代码，但没有名字，这个名字，我们自己来取。</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">例：（给外键约束取名的验证）</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create or replace procedure </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">p8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_deptno </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">as</span></span></p> 
<p style="margin-left:0;text-align:left;">   <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--定义一个变量，这个变量数据类型是exception异常类型</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">   fk_error </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">exception</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">   <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--将这个变量名字和错误的代码绑定在一起</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">pragma exception_init</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">fk_error</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,-</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2291</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">update </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">set </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">deptno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_deptno </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">9999</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">commit</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">exception</span></span></p> 
<p style="margin-left:0;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">when </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">fk_error </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">         dbms_output.put_line</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'违反外键约束！！！！'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--调用存储过程</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">call </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">p8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">40</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">call p8(60);</span></span></p> 
<p style="margin-left:0;text-align:left;">注： <span style="background-color:#ffffff;"><span style="color:#008080;">pragma exception_init：绑定错误名字和错误代码。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:0;text-align:left;">3.自定义异常：通过<span style="color:#0000ff;">raise_application_error</span>(错误编号, 错误提示)，错误编号的范围是<span style="color:#0000ff;">-20001到-20999</span></p> 
<p style="margin-left:0;text-align:left;">例：现在有人要加工资，但是规定是，每次加工资，不能超过原有工资的20%</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create or replace procedure </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">p8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_empno </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_sal </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">as</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">   s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">   m </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">300</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">begin </span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sal </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">if </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_sal </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">&gt;=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">s</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">*</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1.2 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">         raise_application_error</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(-</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">20001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'加工资，不能超过原有工资的20%'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--错误编号的范围是-20001到-20999</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">else </span></span></p> 
<p style="margin-left:0;text-align:left;">         <span style="background-color:#ffffff;"><span style="color:#008080;">update </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">set </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sal</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_sal </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">         dbms_output.put_line</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sql</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowcount</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'行数据被修改！！！'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">end if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">exception</span></span></p> 
<p style="margin-left:0;text-align:left;">          <span style="background-color:#ffffff;"><span style="color:#008080;">when others then</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">          m</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">:=</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sqlerrm</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">          dbms_output.put_line</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(sqlcode||</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">m</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">  </p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">call </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">p8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7639</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10000</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">call </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">p8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7369</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10000</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">call </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">p8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7788</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">3500</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<h3 id="10.4%20%E6%A1%88%E4%BE%8B" style="text-align:justify;"><strong>10.4 案例</strong></h3> 
<p style="margin-left:0;text-align:left;">需求：<span style="background-color:#ffffff;">用存储过程保存错误日志</span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--1、新建一个错误日志表</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create table </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">error_log</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">proce_name </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">300</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">), --对应存储过程的名字</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">table_name </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">300</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),  --对应的表的名字</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">mcode </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">100</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),--错误代码</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">merror </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">300</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),--错误信息</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">mtime </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">date</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);--时间</span></span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--2、新建一个存储过程保存错误信息</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create or replace procedure </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">insert_error_log</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_proce_name </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_table_name </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in varchar</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_mcode </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_merror </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">as</span></span></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:0;text-align:left;">       <span style="background-color:#ffffff;"><span style="color:#008080;">insert into </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">error_log </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_proce_name</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_table_name</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_mcode</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_merror</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sysdate</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">       dbms_output.put_line</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sql</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowcount</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'行数据被插入！！！'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">       <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--commit; </em></span></span></em></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--3.在另一个过程里面，如果运行报错了，那么就调用存入错误日志的存储过程</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create or replace procedure </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">p8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_empno </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_sal </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">as</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">   s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">   m </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">300</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">begin </span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sal </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">into </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">if </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_sal </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">&gt;=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">s</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">*</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1.2 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">         raise_application_error</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(-</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">20001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'加工资，不能超过原有工资的20%'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--错误编号的范围是-20001到-20999         </em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--调用保存错误日志的存储过程</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">         insert_error_log</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'p8'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'emp'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sqlcode</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sqlerrm</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">         <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--commit;</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">else </span></span></p> 
<p style="margin-left:0;text-align:left;">         <span style="background-color:#ffffff;"><span style="color:#008080;">update </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">set </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sal</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_sal </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">v_empno</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">         dbms_output.put_line</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sql</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">%</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">rowcount</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'行数据被修改！！！'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">         <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--commit;</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">end if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">      --异常处理部分</span></span></p> 
<p style="margin-left:0;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">exception</span></span></p> 
<p style="margin-left:0;text-align:left;">          <span style="background-color:#ffffff;"><span style="color:#008080;">when others then</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">          m</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">:=</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sqlerrm</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">          dbms_output.put_line</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'错误代码: '</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sqlcode</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">' 错误信息：'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">||</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">m</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">); </span></span></p> 
<p style="margin-left:0;text-align:left;">     <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--调用保存错误日志的存储过程</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">          insert_error_log</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'p8'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'emp'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sqlcode</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sqlerrm</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">          <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--commit;</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--通过代码块来调用存储过程</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">declare</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">   empno1 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">:=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">&amp;输入员工编号</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">   sal1 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">:=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">&amp;输入工资</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">Begin</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">      --调用保存错误日志的存储过程</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">      p8</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">empno1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">sal1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:0;text-align:left;">   <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">* </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">error_log</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h3 id="10.5%20%E8%87%AA%E5%AE%9A%E4%B9%89%E5%87%BD%E6%95%B0" style="text-align:justify;"><strong>10.5 自定义函数</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">自定义函数和存储过程在用法没什么差异。主要差异有下：</p> 
<ol><li style="text-align:justify;">存储过程中可以调用其他的存储过程以及一系列SQL语句。而函数有很多语句不能使用，比如DML语句。</li><li style="text-align:justify;">存储过程是返回参数，函数是返回值，有return语句。</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">用法：</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">create or replace function 函数名(输入的参数  数据类型)</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">return  返回的数据类型</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">as</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">  声明部分</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">begin</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">  执行部分</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">  return 返回值的变量</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">end;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">例：</span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--实现一个和数据库power()相同的函数的功能，自己写一个求数字的次方的方法：</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create or replace function </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">cf</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">n </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">return number</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">as </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">  s </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">:=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:0;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">for </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">i  </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">in </span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">..c </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">loop</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000000;">       s</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">:=</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">s</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">*</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">n</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">end loop</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">     <span style="background-color:#ffffff;"><span style="color:#008080;">return </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">s </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">  <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--dql语句调用函数</em></span></span></em><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>验证两个函数结果是否一致</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select power</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">3</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">cf</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">3</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">power</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">3</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">cf</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">3</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">power</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span><span style="background-color:#ffffff;"><span style="color:#000000;">cf</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">) </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">dual</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<h2 id="11%20%E8%A7%A6%E5%8F%91%E5%99%A8" style="text-align:center;"><strong>11 触发器</strong></h2> 
<p style="margin-left:0;text-align:left;">触发器是一种数据库对象。在事先为某张表绑定一段代码，当表中的数据发生增、删、改的时候，系统会自动触发代码并执行。</p> 
<p style="margin-left:0;text-align:left;">作用：检查输入的数据；实时备份表格的数据；记录表格操作的日志。</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">注：</span><span style="background-color:#ffffff;">触发器发生错误时，前面用户已经执行成功的操作会被撤销，类似事务的回滚</span><span style="background-color:#ffffff;">。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">触发器在业务上主要应用于数据库的备份和审计。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">触发器的类型分为：前置触发器、后置触发器。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">区别：</span></p> 
<ol><li style="text-align:left;"><span style="background-color:#ffffff;">触发时间：前置触发器是在执行DML之前被激活；而后置触发器是在执行DML之后被激活。所以前置触发器可以在DML之前验证或修改数据；而后置触发器在DML之后对数据进行处理，常用于日志记录和数据统计。</span></li><li style="text-align:left;"><span style="background-color:#ffffff;">功能上：前置触发器可以做</span>增、删、改的操作；而后置触发器不能，只能做select操作。</li></ol> 
<h3 id="11.1%20%E7%94%A8%E6%B3%95" style="text-align:justify;"><strong>11.1 用法</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">创建触发器：</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">create or replace trigger 触发器名字</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">before|after insert or update or delete</span> <span style="background-color:#ffffff;">on </span><span style="background-color:#ffffff;">表名</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">for each row</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">begin</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">    执行的</span><span style="background-color:#ffffff;">sql</span><span style="background-color:#ffffff;">语句</span><span style="background-color:#ffffff;">;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">end;</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">--前置触发器：</span><span style="background-color:#ffffff;">before</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">--</span><span style="background-color:#ffffff;">后置触发器：</span><span style="background-color:#ffffff;">after</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">删除触发器：</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">drop trigger 触发器名称;</span></p> 
<h3 id="11.2%20%E6%A1%88%E4%BE%8B%EF%BC%88%E5%89%8D%E7%BD%AE%E8%A7%A6%E5%8F%91%E5%99%A8--%E9%AA%8C%E8%AF%81%E6%95%B0%E6%8D%AE%EF%BC%89" style="text-align:justify;"><strong>11.2 案例（前置触发器--验证数据）</strong></h3> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">需求：</span><span style="background-color:#ffffff;">在emp</span><span style="background-color:#ffffff;">表中如果要去更新用户的工资，新增的用户，工资不能超过</span><span style="background-color:#ffffff;">2000</span><span style="background-color:#ffffff;">元；老用户涨工资不能超过原来工资的</span><span style="background-color:#ffffff;">10%</span><span style="background-color:#ffffff;">；禁止删除岗位</span><span style="background-color:#ffffff;">PRESIDENT</span><span style="background-color:#ffffff;">。</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span>  <span style="background-color:#ffffff;"><span style="color:#008080;">or</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">replace</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">trigger</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> check_emp_sal</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">before</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">or</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">update</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">or</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">delete</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">on</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">each</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">row</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> inserting </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">         <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> :new.sal&gt;</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2000</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           raise_application_error(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'-20007'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'新员工工资不能超过2000'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">         <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">elsif</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> updating </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">         <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> :new.sal&gt;:old.sal*</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1.1</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           raise_application_error(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'-20008'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'老员工涨工资不能超过原来的10%'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);    </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">         <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">else</span></span> </p> 
<p style="margin-left:.0001pt;text-align:left;">         <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> :old.job=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'PRESIDENT'</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           raise_application_error(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'-20006'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'不能删除岗位是PRESIDENT的员工信息'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">         <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--这里报错：无法对sys拥有的对象创建触发器，换个普通用户，把emp表备份出来，再创建触发器</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">table</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">as</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> scott.emp;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--测试触发器</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">6666</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'ADDFD66'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'CLERK'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">null</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">date</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'2021-09-20'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">null</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">40</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">6667</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'ADDFD67'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'CLERK'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">null</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">date</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'2021-09-20'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1500</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">null</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">40</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span>  </p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">update</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">set</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4000</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> empno=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7369</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">update</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">set</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">850</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> empno=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7369</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">delete</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> job=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'CLERK'</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">and</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal&lt;</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2000</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">delete</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> job=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'PRESIDENT'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">; </span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">经测试，结果符合预期，满足需求。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">注：</span></p> 
<ol><li style="text-align:left;"><span style="background-color:#ffffff;">sys的对象不能用来创建触发器，会报错。</span></li><li style="text-align:left;"><span style="background-color:#ffffff;">2. "：</span><span style="background-color:#ffffff;">"</span><span style="background-color:#ffffff;">有</span><span style="background-color:#ffffff;">2</span><span style="background-color:#ffffff;">中意思；一：给变量赋值， 如，</span><span style="background-color:#ffffff;"> names varchar2(10) :='aa'; </span><span style="background-color:#ffffff;">这是把</span><span style="background-color:#ffffff;">"aa"</span><span style="background-color:#ffffff;">赋值给变量</span><span style="background-color:#ffffff;">names</span><span style="background-color:#ffffff;">。二：表示引用，即引用表中字段所对应的值，如：emp表中有个</span><span style="background-color:#ffffff;">name</span><span style="background-color:#ffffff;">为</span><span style="background-color:#ffffff;">“Bob”</span><span style="background-color:#ffffff;">，那么</span><span style="background-color:#ffffff;"> : old.name </span><span style="background-color:#ffffff;">的值就是</span><span style="background-color:#ffffff;">"Bob"</span><span style="background-color:#ffffff;">。只是表示引用的时候，只能出现在触发器里面。</span></li><li style="text-align:left;"><span style="background-color:#ffffff;">:NEW 和</span><span style="background-color:#ffffff;">:OLD</span><span style="background-color:#ffffff;">使用方法和意义，</span><span style="background-color:#ffffff;">new </span><span style="background-color:#ffffff;">只出现在</span><span style="background-color:#ffffff;">insert</span><span style="background-color:#ffffff;">和</span><span style="background-color:#ffffff;">update</span><span style="background-color:#ffffff;">时，</span><span style="background-color:#ffffff;">old</span><span style="background-color:#ffffff;">只出现在</span><span style="background-color:#ffffff;">update</span><span style="background-color:#ffffff;">和</span><span style="background-color:#ffffff;">delete</span><span style="background-color:#ffffff;">时。在</span><span style="background-color:#ffffff;">insert</span><span style="background-color:#ffffff;">时</span><span style="background-color:#ffffff;">new</span><span style="background-color:#ffffff;">表示新插入的行数据，</span><span style="background-color:#ffffff;">update</span><span style="background-color:#ffffff;">时</span><span style="background-color:#ffffff;">new</span><span style="background-color:#ffffff;">表示要替换的新数据、</span><span style="background-color:#ffffff;">old</span><span style="background-color:#ffffff;">表示要被更改的原来的数据行，</span><span style="background-color:#ffffff;">delete</span><span style="background-color:#ffffff;">时</span><span style="background-color:#ffffff;">old</span><span style="background-color:#ffffff;">表示要被删除的数据。</span></li></ol> 
<h3 id="11.3%20%E6%A1%88%E4%BE%8B%EF%BC%88%E5%90%8E%E7%BD%AE%E8%A7%A6%E5%8F%91%E5%99%A8--%E5%AE%A1%E8%AE%A1%EF%BC%89" style="text-align:justify;"><strong>11.3 案例（后置触发器--审计）</strong></h3> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">触发器的另一个常见用途是为了之后审计的目的而记录的对数据库的修改。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">比如：当一个人增加或删除了某条记录的时候，我们可以把这个操作记录下来。这样就知道了谁进行了什么样的操作。</span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;">需求：对dept表进行增删改，建立记录其改动的操作的审计表。</span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--1.先创建审计表。</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">table</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept_audit(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    user_name </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">64</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    action_type </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">64</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    action_date </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">date</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    new_deptno </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    old_deptno </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">number</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    new_dname </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">16</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    old_dname </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">16</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    new_loc </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">16</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">    old_loc </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">varchar</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">16</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> *</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept_audit;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--2.创建触发器：</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">or</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">replace</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">trigger</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> after_dept</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">after</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">or</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">update</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">or</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">delete</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">on</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">for</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">each</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">row</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">begin</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> inserting </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">            <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--dept表插入数据时</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">            <span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept_audit</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">            <span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">user</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'insert'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sysdate</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,:new.deptno,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">''</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,:new.dname,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">''</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,:new.loc,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">''</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">elsif</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> updating </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">then</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">            <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--dept表更新数据时</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">            <span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept_audit</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">            <span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">user</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'update'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sysdate</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,:new.deptno,:old.deptno,:new.dname,:old.dname,:new.loc,:old.loc);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">else</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">            <em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--dept表删除数据时</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;">            <span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept_audit</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">            <span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">user</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'delete'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">sysdate</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">''</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,:old.deptno,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">''</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,:old.dname,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">''</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,:old.loc);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">      <span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">if</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;  </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">end</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--3.验证触发器的结果</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">60</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'java'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'chongqing'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">update</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">set</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dname=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'python'</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> deptno=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">32</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">delete</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> deptno=</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">60</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept_audit;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">结果显示：</span></span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="111" src="https://images2.imgbox.com/31/65/NuhvTRlS_o.png" width="615"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;">这里如果换个用户A登陆来对YANGFENG用户下的dept表的数据进行修改，那么user_name的数据也会变成用户A。</p> 
<h2 id="12%20%E5%88%86%E5%8C%BA%E8%A1%A8" style="text-align:center;"><strong>12 分区表</strong></h2> 
<p style="margin-left:0;text-align:left;">什么时候用到分区表？</p> 
<p style="margin-left:0;text-align:left;">当表的数据量不断增大，查询数据的速度就会变慢，性能就会下降，这时就应该考虑对表进行分区。表进行分区后，逻辑上表仍然是一张完整的表，只是将表中的数据在物理上存放到多个表空间(物理文件上)，这样查询数据时，不至于每次都扫描整张表。</p> 
<p style="margin-left:0;text-align:left;">分区表的划分方式有4种：范围分区、hash分区、列表分区、组合分区。</p> 
<h3 id="12.1%20%E8%8C%83%E5%9B%B4%E5%88%86%E5%8C%BA" style="text-align:justify;"><strong>12.1 范围分区</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">关键字：range</p> 
<p style="margin-left:0;text-align:left;">最常用的一种分区，范围分区将数据基于范围映射到每一个分区，这个范围是你在创建分区时指定的分区键决定的。</p> 
<p style="margin-left:0;text-align:left;">常用于范围分区的字段：数值范围类（比如工资区间）、时间范围类（比如一月一月的来）。</p> 
<p style="margin-left:.0001pt;text-align:justify;">例：</p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--范围分区（用sal列进行范围划分）</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">table</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> amp(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  empno    </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  ename    </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">VARCHAR2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  job      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">VARCHAR2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">9</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  mgr      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  hiredate </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">DATE</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  sal      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  comm     </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  deptno   </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">by</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">range</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(sal)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_0_1000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_1001_2000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_2001_3000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">3001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_3001_maxv </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">maxvalue</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">);</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--录入数据检验</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> amp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> amp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(sal_0_1000);</span></span></p> 
<h3 id="12.2%20hash%E5%88%86%E5%8C%BA" style="text-align:justify;"><strong>12.2 hash分区</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">关键字：hash</p> 
<p style="margin-left:0;text-align:left;">Hash分区通过数据库的内部的哈希算法，将所有的行，根据数据，放到不同的分区中进行保存。</p> 
<p style="margin-left:.0001pt;text-align:justify;">Hash分区常用于划分没有啥规律的字段。</p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--hash分区(划分没有规律的字段),本例子划分4个区</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">table</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> bmp(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  empno    </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  ename    </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">VARCHAR2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  job      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">VARCHAR2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">9</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  mgr      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  hiredate </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">DATE</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  sal      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  comm     </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  deptno   </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">by</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">hash</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(ename) </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> p1,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> p2,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> p3,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> p4</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--录入数据检验</span></span></em><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">，</span></span></em><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">查看分区1的数据</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> bmp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp;</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> bmp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(p1);</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="138" src="https://images2.imgbox.com/78/6e/3uaftY91_o.png" width="445"></p> 
<p></p> 
<h3 id="12.3%20%E5%88%97%E8%A1%A8%E5%88%86%E5%8C%BA" style="text-align:justify;"><strong>12.3 列表分区</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">关键字：list</p> 
<p style="margin-left:0;text-align:left;">该分区的特点是某列的值只有几个，并且存在一样的规律，基于这样的特点我们可以采用列表分区。</p> 
<p style="margin-left:.0001pt;text-align:justify;">比如说性别字段，就可以分为男女两个分区。</p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">table</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> cmp(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  empno    </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  ename    </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">VARCHAR2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  job      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">VARCHAR2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">9</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  mgr      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  hiredate </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">DATE</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  sal      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  comm     </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  deptno   </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">by</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">list</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(deptno) </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept10 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept20 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">20</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept30 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">30</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dept40 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">40</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--录入数据检验</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> cmp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> cmp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(dept10);</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="12.4%20%E7%BB%84%E5%90%88%E5%88%86%E5%8C%BA" style="text-align:justify;"><strong>12.4 组合分区</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">组合分区就是将范围分区、hash分区、列表分区组合起来进行分区。</p> 
<p style="margin-left:.0001pt;text-align:justify;">写法：</p> 
<p style="margin-left:0;text-align:left;">create table 表名(</p> 
<p style="margin-left:0;text-align:left;">列名 数据类型</p> 
<p style="margin-left:0;text-align:left;">)partition by 父分区类型(列名)</p> 
<p style="margin-left:0;text-align:left;">subpartition by 子分区类型(列名)</p> 
<p style="margin-left:0;text-align:left;">(</p> 
<p style="margin-left:0;text-align:left;">    partition 父分区名字 values 分区规则(</p> 
<p style="margin-left:0;text-align:left;">        subpartition 子分区名字 values 分区规则，</p> 
<p style="margin-left:0;text-align:left;">        subpartition 子分区名字 values 分区规则，</p> 
<p style="margin-left:0;text-align:left;">        ...</p> 
<p style="margin-left:0;text-align:left;">    )</p> 
<p style="margin-left:0;text-align:left;">);</p> 
<p style="margin-left:.0001pt;text-align:justify;">例：</p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--组合分区(以列表——范围为例子)</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">create</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">table</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dmp(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  empno    </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  ename    </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">VARCHAR2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  job      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">VARCHAR2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">9</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  mgr      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">4</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  hiredate </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">DATE</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  sal      </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  comm     </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">7</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">,</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">  deptno   </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">NUMBER</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">by</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">list</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(deptno) </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">by</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">range</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(sal)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> d10 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">10</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           (</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_10_1000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_10_2000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_10_maxv </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">maxvalue</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)      </span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           ),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> d20 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">20</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           (</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_20_1000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_20_2000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_20_maxv </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">maxvalue</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           ),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> d30 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">30</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           (</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_30_1000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_30_2000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_30_maxv </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">maxvalue</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           ),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">           <span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> d40 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">40</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           (</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_40_1000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">1001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_40_2000 </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2001</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">),</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;">               <span style="background-color:#ffffff;"><span style="color:#008080;">subpartition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> sal_40_maxv </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">values</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">less</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">than</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> (</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">maxvalue</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">           )</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">)</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--录入数据检验</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">insert</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">into</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> dmp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> emp;</span></span></p> 
<p style="margin-left:.0001pt;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;">--共4个主分区，12个子分区</span></span></em></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> cmp </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">partition</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">(d10);</span></span></p> 
<h3 id="12.5%20%E5%88%86%E5%8C%BA%E4%B8%AD%E5%88%86%E6%9E%90%E5%B8%B8%E7%94%A8%E8%AF%AD%E5%8F%A5" style="text-align:justify;"><strong>12.5 分区中分析常用语句</strong></h3> 
<p style="margin-left:0;text-align:left;">--增加分区subpartition  </p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">alter table 表名</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">modify partition 父分区名</span></span><span style="background-color:#ffffff;"><span style="color:#008080;"> a</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">dd subpartition 子分区名</span></span><span style="background-color:#ffffff;"><span style="color:#008080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;">--删除分区subpartition  </p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">alter table</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">表名</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">drop </span></span><span style="color:#008080;">subpartition 子分区名</span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">* </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">user_tables</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span>      <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--查看当前用户所有的表的信息</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">* </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">user_tab_columns</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--查看当前用户所有表的列信息</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">* </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">user_tab_partitions</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span>    <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--查看用户所有的分区表信息</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--主分区数据字典表</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"> <span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">* </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">user_tab_partitions</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--主分区数据字典表</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">SELECT * FROM </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">user_tab_partitions</span></span><span style="background-color:#ffffff;"><span style="color:#008080;"> WHERE TABLE_NAME='EMP_RANGE';</span></span></p> 
<p style="margin-left:0;text-align:left;"> <em><span style="background-color:#ffffff;"><span style="color:#ff0000;"><em>--子分区数据字典表</em></span></span></em></p> 
<p style="margin-left:0;text-align:left;"> <span style="background-color:#ffffff;"><span style="color:#008080;">select </span></span><span style="background-color:#ffffff;"><span style="color:#000080;">* </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from </span></span><span style="background-color:#ffffff;"><span style="color:#000000;">user_tab_subpartitions</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#ff0000;">--删除一个表的数据是</span>  </p> 
<p style="margin-left:0;text-align:left;">truncate table table_name;  </p> 
<p style="margin-left:0;text-align:left;"><span style="color:#ff0000;">--删除分区表一个分区的数据是</span>  </p> 
<p style="margin-left:0;text-align:left;">alter table table_name truncate partition p2;  </p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h3 id="12.6%20%E5%88%86%E5%8C%BA%E4%B8%AD%E5%B8%B8%E8%A7%81%E6%8A%A5%E9%94%99" style="text-align:justify;"><strong>12.6 分区中常见报错</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">1.分区’P11’的分区界限过高。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="190" src="https://images2.imgbox.com/5c/14/1TZxoL0J_o.png" width="365"></p> 
<p></p> 
<p style="margin-left:0;text-align:left;">原因分析:出现这个情况是建表分区时P11的下一个分区出现了问题。</p> 
<p style="margin-left:0;text-align:left;">一般是分区的数值与其他分区重合，造成了分区界限过高的报错。</p> 
<p style="margin-left:0;text-align:left;">处理办法：重新修改子分区的数值界限，值域不能交叉。容易出现在以时间范围分区中。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">2.插入分区的关键字未映射到任何分区。</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="163" src="https://images2.imgbox.com/54/83/OLRdp1Lb_o.png" width="452"></p> 
<p></p> 
<p style="margin-left:0;text-align:left;">原因分析：出现这个报错是在录入数据时出现的，插入的数据未与分区对应到，造成一些数据无法录入。</p> 
<p style="margin-left:0;text-align:left;">举例这个分区是分了3个分区：10部门，20部门，30 部门。在插入的数据中还有40部门的数据，所以造成了这个报错。</p> 
<p style="margin-left:0;text-align:left;">解决办法：加入一个相应的子分区。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">注：在进行分区操作之前，先备份数据，如果一旦有错误的分区操作可能会导致数据丢失。</p> 
<h2 id="13%20Oracle%E4%BC%98%E5%8C%96" style="text-align:center;"><strong>13 Oracle优化</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">本章节是Oracle学习的升华，通过Oracle各种优化的方式，来提高数据库的性能和效率（响应时间、吞吐量、负载等）。</p> 
<p style="margin-left:.0001pt;text-align:justify;">主要从以下几个方向来进行优化：</p> 
<h3 id="13.1%20%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E8%AE%BE%E8%AE%A1%E4%BC%98%E5%8C%96" style="text-align:justify;"><strong>13.1 数据库的设计优化</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">1、合理设计数据表结构。</p> 
<p style="margin-left:.0001pt;text-align:justify;">合理选择建模方法（范式建模、维度建模）、字段、数据类型、约束条件、表空间大小。</p> 
<p style="text-align:justify;">        （1）索引优化。</p> 
<p style="margin-left:.0001pt;text-align:justify;">创建合适的索引，避免全表扫描，加快查询速度。要注意索引数量不能过多。</p> 
<p style="margin-left:0;text-align:left;">在使用索引的时候，也要尽量避免产生回表，尽管这很多时候很难避免。回表：使用普通索引的时候，如果索引里不包含全部要查找的字段，则需要回到表中查找需要的字段，这个过程也叫做回表。</p> 
<p style="text-align:justify;">        （2）分区表优化。</p> 
<p style="margin-left:.0001pt;text-align:justify;">通过合理分区减少查询的数据量，加快查询速度。</p> 
<p style="text-align:justify;">        （3）计算方式优化。</p> 
<p style="margin-left:.0001pt;text-align:justify;">通过分布式、并行计算，加快查询速度。</p> 
<h3 id="13.2%20SQL%E8%B0%83%E4%BC%98" style="text-align:justify;"><strong>13.2 SQL调优</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">1、尽量少用子查询。子查询的结果集会占用内存，影响查询效率。</p> 
<p style="margin-left:.0001pt;text-align:justify;">2、使用表别名。简化SQL语句，就减少了SQL解析，加快了查询速度。</p> 
<p style="margin-left:.0001pt;text-align:justify;">3、减少以下效率低关键字的使用。</p> 
<p style="margin-left:0;text-align:left;">（1）union并集去重、minus差集、intersect交集的集合运算，这些关键字效率很差；</p> 
<p style="margin-left:0;text-align:left;">（2）用exists代替in、distinct关键字；</p> 
<p style="margin-left:0;text-align:left;">（3）or的效率比较低，可以使用union all去进行替换；</p> 
<p style="margin-left:0;text-align:left;">（4）模糊查询like；</p> 
<p style="margin-left:0;text-align:left;">4、使用临时表。简化SQL语句，就减少了SQL解析，加快了查询速度。</p> 
<p style="margin-left:0;text-align:left;">5、尽量不用排序order by。排序是相当耗费资源的。</p> 
<p style="margin-left:0;text-align:left;">6、避免使用select *，会导致全表扫描，造成不必要的资源开销且增加了查询时间。所以尽量只查需要的字段。</p> 
<p style="margin-left:0;text-align:left;">7、有大量DML语句时多使用commit，可以释放缓存，同时释放锁资源。</p> 
<p style="margin-left:0;text-align:left;">8、表连接的调优。</p> 
<p style="margin-left:0;text-align:left;">表的内部逻辑有三种不同的算法连接方式：</p> 
<p style="margin-left:0;text-align:left;">        （1）hash join(哈希连接)</p> 
<p style="margin-left:0;text-align:left;">定义：等值关联，性能好，但占用内存较大。它是将被驱动表和其计算的hash值表一起放入缓存，然后在驱动表中逐条取数据匹配相应hash值，再精确匹配数据。所以，适用于大型数据集或大规模连接。</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="173" src="https://images2.imgbox.com/f9/35/bTyiuHy6_o.png" width="691"></p> 
<p></p> 
<p style="text-align:left;">        （2）nested loops(嵌套循环连接)</p> 
<p style="margin-left:0;text-align:left;">定义：内存占用小，但性能好。它是依次从驱动表中取一条数据，遍历被驱动表，将匹配的数据放入缓存中。所以适用于两表的数据差异大得情况。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="text-align:left;">        （3）merge join(排序归并)</p> 
<p style="margin-left:0;text-align:left;">定义：不等关联，将关联的a表跟b表分别进行排序，生成临时的两张表后，随机取一张表逐条抽取记录与另一张表匹配。</p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="201" src="https://images2.imgbox.com/d6/1a/g6VYEeLB_o.png" width="699"></p> 
<p style="margin-left:0;text-align:left;">以上的3中连接方式Oracle的优化器会评估查询的条件、表大小、索引使用等因素，并选择最适合的表连接算法来执行查询。当然也可以采用hints优化器强制改变连接方式：</p> 
<p style="margin-left:0;text-align:left;">改变表连接的逻辑：</p> 
<p style="margin-left:0;text-align:left;">/*+use_hash(a b) */    强制使用哈希连接</p> 
<p style="margin-left:0;text-align:left;">/*+use_merge(a b)*/    强制使用排序归并</p> 
<p style="margin-left:0;text-align:left;">/*+use_nl(a b) */     强制使用嵌套连接</p> 
<p style="margin-left:0;text-align:left;">/*+leading(a b) */     a一定要是小表(驱动表)，b一定是大表(匹配表)</p> 
<p style="margin-left:0;text-align:left;">/*+ full(a) */       强制全表扫描</p> 
<p style="margin-left:0;text-align:left;">/*+ index(表名  索引名) */    强制使用索引</p> 
<p style="margin-left:0;text-align:left;">/*+ parallel(8) */     强制使用并行的资源，来执行这个sql语句</p> 
<h3 id="13.3%20%E5%8F%82%E6%95%B0%E9%85%8D%E7%BD%AE%E4%BC%98%E5%8C%96" style="text-align:justify;"><strong>13.3 参数配置优化</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">合理调整数据库的参数配置，如SGA和PGA的大小调整、日志和缓存的配置、并发连接数的设置等。主要参数有：<span style="background-color:#ffffff;"><span style="color:#333333;">SGA_TARGET</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">（</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">SGA</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">）</span></span>、<span style="background-color:#ffffff;"><span style="color:#333333;">DB_BLOCK_SIZE</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">（</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">块</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">）、</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">UNDO_RETENTION</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">、</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">SORT_AREA_SIZE</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">（</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">排序时内存</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">）、</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">LOG_BUFFER</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">（</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">日志缓存</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">）。</span></span></p> 
<h3 id="13.4%20%E7%A1%AC%E4%BB%B6%E4%BC%98%E5%8C%96" style="text-align:justify;"><strong>13.4 硬件优化</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">一般是增加内存、磁盘。还可以采用集群</p> 
<h3 id="13.5%20%E4%BC%98%E5%8C%96%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7" style="text-align:justify;"><strong>13.5 优化常用工具</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;">SQL调优时常用的几个监控和诊断工具：</p> 
<p style="text-align:justify;">        1、执行计划。</p> 
<p style="margin-left:.0001pt;text-align:justify;">可以通过PLSQL或终端查看执行计划SQL语句执行顺序、CPU耗费、IO耗费等。（PLSQL中在编译计划窗口打开SQL即可查看）</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="139" src="https://images2.imgbox.com/a0/40/Xcm6vZGY_o.png" width="517"></p> 
<p></p> 
<p style="text-align:justify;">        2、 <span style="background-color:#ffffff;"><span style="color:#333333;">SQL Trace</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">可以跟踪SQL语句的执行情况，包括执行时间、IO操作、锁等信息。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">打开方法：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">用管理员用户打开</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">session的trace</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">ALTER</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">SESSION</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">SET</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">SQL_TRACE</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> = </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">TRUE</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">查看trace文件的存储位置：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#008080;">SELECT</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">value</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">FROM</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> V$DIAG_INFO </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">WHERE</span></span> <span style="background-color:#ffffff;"><span style="color:#008080;">name</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">= </span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">'Diag Trace'</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">;</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">在该目录下打开文件即可。</span></span></p> 
<p style="text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">        3、AWR报告。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">通过AWR报告查看数据库的性能指标</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">资源使用情况</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">，比如CPU使用率、内存使用率、IO等待时间等</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">；</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">以及top10的SQL分析</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">打开方法：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">1.</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">终端</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">下登陆</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">dba</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">用户：（验证是否连接）</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">sqlplus / as sysdba</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">2.</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">然后输入下面这句：</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">@?/rdbms/admin/awrrpt.sql</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">3.</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">输入</span></span><span style="background-color:#ffffff;"><span style="color:#333333;"> report_type </span></span><span style="background-color:#ffffff;"><span style="color:#333333;">的值</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">:</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">html</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">或</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">text</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">4.</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">输入</span></span><span style="background-color:#ffffff;"><span style="color:#333333;"> num_days </span></span><span style="background-color:#ffffff;"><span style="color:#333333;">的值</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">:</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">（</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">1</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">就是今天，</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">2</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">就是昨天和今天，依次排列）</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">1</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">5.</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">输入</span></span><span style="background-color:#ffffff;"><span style="color:#333333;"> begin_snap </span></span><span style="background-color:#ffffff;"><span style="color:#333333;">的值</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">:</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">（开始的</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">snap id</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">）</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">按照实际输入</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="164" src="https://images2.imgbox.com/6d/55/mmSsR4Ai_o.png" width="201"></p> 
<p></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">6.</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">输入</span></span><span style="background-color:#ffffff;"><span style="color:#333333;"> end_snap </span></span><span style="background-color:#ffffff;"><span style="color:#333333;">的值</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">:</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">按照实际输入</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">7.</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">输入</span></span><span style="background-color:#ffffff;"><span style="color:#333333;"> report_name </span></span><span style="background-color:#ffffff;"><span style="color:#333333;">的值</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">:</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">文件名</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">.html</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#333333;">8.</span></span><span style="background-color:#ffffff;"><span style="color:#333333;">然后去相应的目录找到该文件用网页打开即可</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="205" src="https://images2.imgbox.com/14/de/jY5jHxTV_o.png" width="527"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="235" src="https://images2.imgbox.com/ea/42/wcXvOU7w_o.png" width="443"></p> 
<p style="margin-left:.0001pt;text-align:justify;">具体更多的指标解读分析请查询相关的知识。推荐：</p> 
<p style="margin-left:.0001pt;text-align:justify;">https://blog.csdn.net/hezuijiudexiaobai/article/details/120472266</p> 
<h3 id="13.6%20%E4%BC%98%E5%8C%96%E6%80%9D%E8%B7%AF" style="text-align:justify;"><strong>13.6 优化思路</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#222226;">对于Oracle已存在的</span><span style="color:#222226;">SQL语句运行很慢的问题的处理：</span></p> 
<ol><li style="text-align:justify;"><span style="color:#222226;">先通过执行计划或AWR报告获取该语句影响运行存在的问题，制定合适的方案。</span></li><li style="text-align:justify;"><span style="color:#222226;">数据非常大，那么建分区，只查询数据所在的分区表，避免整张大表的查询。</span></li><li style="text-align:left;">查看有没有导致索引失效的语句。</li><li style="text-align:justify;"><span style="color:#222226;">给需查询的字段创建索引。</span></li><li style="text-align:justify;"><span style="color:#222226;">查找SQL语句中有无低效率的关键字。</span></li><li style="text-align:left;">SQL语句频繁的对硬盘进行了读写，可以把语句写成代码块。</li><li style="text-align:justify;"><span style="color:#222226;">使用并行或分布式计算。</span></li><li style="text-align:justify;"><span style="color:#222226;">有内存的原因则增加内存。</span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<h2 id="14%20%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93" style="text-align:center;"><strong>14 数据仓库</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">数据仓库是一个面向主题的、集成的、相对稳定的、反映历史变化的数据集合，用于支持管理决策</span></span><span style="background-color:#ffffff;"><span style="color:#4d4d4d;">。</span></span><span style="color:#222226;">数据</span><span style="color:#222226;">仓库</span><span style="color:#222226;">从多个源系统中提取、转换和加载数据</span><span style="color:#222226;">（</span><span style="color:#222226;">ETL流程</span><span style="color:#222226;">），</span><span style="color:#222226;">通过数据清洗、整合、转换等生成目标的过程。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#222226;">按照数据的流向，可以将数据仓库分为3层（常见），也可以分为</span><span style="color:#222226;">更多</span><span style="color:#222226;">层（根据实际情况分层）：</span></p> 
<ol><li style="text-align:justify;"><span style="color:#222226;">贴源层（ODS）：数据来源于现有业务库，与源表的数据结构保持一致，一般不做改动</span><span style="color:#222226;">，为其他逻辑层提供数据来源</span><span style="color:#222226;">。</span></li><li style="text-align:justify;"><span style="color:#222226;">数据仓库层（DW）：数据来源于ODS层，对ODS的数据进行规范化（编码转换、清洗、统一格式、脱敏等），再进行各表数据的关联整合，输出主题宽表。</span></li><li style="text-align:justify;"><span style="color:#222226;">集市层（DM）：</span><span style="color:#222226;">数据来源可以是ODS层，也可以是DW层，主要是</span><span style="color:#222226;">面向业务需求进行开发。</span><span style="color:#222226;">数据应用于前端报表展示或输出到项目库中。</span></li></ol> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#222226;">总体来说，数仓</span><span style="color:#222226;">像</span><span style="color:#222226;">是一个逻辑性的概念，是为了帮助开发更好去管理数据，为业务提供数据支撑而延伸的</span><span style="color:#222226;">概念</span><span style="color:#222226;">过程。</span></p> 
<h3 id="14.1%20%E6%95%B0%E6%8D%AE%E5%BB%BA%E6%A8%A1" style="text-align:justify;"><strong>14.1 数据建模</strong></h3> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#222226;">数据建模就是基于对业务的理解，将各种数据进行整合关联。在数据仓库DW和DM逻辑层需要分析数据，通常我们的中间层宽表就基于维度建模-星型模型来实现的。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#222226;">数据建模方式有两类：范式建模、维度建模。</span></p> 
<h4 id="14.1.1%20%E8%8C%83%E5%BC%8F%E5%BB%BA%E6%A8%A1" style="text-align:justify;"><strong>14.1.1 范式建模</strong></h4> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">范式建模的主要作用是</span></span><span style="background-color:#ffffff;"><span style="color:#fa0000;">减少数据冗余</span></span><span style="background-color:#ffffff;">提高更新数据的效率</span><span style="background-color:#ffffff;"><span style="color:#121212;">，同时保证数据完整性，</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">但是这样存在一个问题，划分的表会很多，表连接的查询越多就会影响性能</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">。</span></span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="background-color:#ffffff;"><span style="color:#121212;">范式建模主要有3种常用：第一范式、第二范式、第三范式。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">1.第一范式</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">表中的每一列都是不可拆分的原子项，只能存在一个值。（属性不可再分）</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">2.第二范式</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">第二范式要同时满足下面两个条件：</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">（1）</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">满足第一范式。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">（2）</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">没有部分依赖。（表中的非主键列都必须依赖于主键列）</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">3.第三范式</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">第三范式要同时满足下面两个条件：</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">（1）</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">满足第二范式。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">（2）</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">没有传递依赖。（表中非主键列关系重复，能互相推导出来）</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">比如说：emp表再加一个部门名称的字段，那么：</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">部门编号依赖于员工编号，部门名称依赖于部门编号，部门名称间接依赖于员工编号，则产生了传递依赖。</span></span></p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">在表的设计上采用</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">ER模型</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">（实体关系图）：</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">1.</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">一对一关系</span></span><br><span style="background-color:#ffffff;"><span style="color:#121212;">外键列设置在任意一张表中，都是可以的。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">2.</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">一对多关系</span></span><br><span style="background-color:#ffffff;"><span style="color:#121212;">外键列要设置在多的一方。</span></span></p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#121212;">3.</span></span><span style="background-color:#ffffff;"><span style="color:#121212;">多对多关系</span></span><br><span style="background-color:#ffffff;"><span style="color:#121212;">假设是A表和B表，这种情况下，需要设计第三张表（桥表），桥表中设置俩个外键，分别引用A表的主键和B表的主键。</span></span></p> 
<h4 id="14.1.2%20%E7%BB%B4%E5%BA%A6%E5%BB%BA%E6%A8%A1" style="text-align:justify;"><strong>14.1.2 维度建模</strong></h4> 
<p style="margin-left:0;text-align:left;"><span style="color:#222226;">维度建模</span><span style="color:#222226;">是通过维度和指标来进行设计，它是面向分析的，目的是</span><span style="color:#ff0000;">提高查询性能，</span><span style="color:#222226;">快速完成需求分析且对于复杂查询及时响应</span><span style="color:#222226;">。相应的缺点就是会造成数据冗余，可能会违反范式要求。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#222226;">维度建模常用的有3种：星型模型、雪花模型、星座模型。</span></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#222226;">（1）星型模型</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#222226;">星形模型中有一张事实表</span><span style="color:#222226;">和</span><span style="color:#222226;">多个维度表，事实表与维度表通过主键外键相关联，维度表之间没有关联</span><span style="color:#222226;">。</span><span style="color:#222226;">当所有维表都直接连接到事实表上时，整个图就像星星一样，故将该模型称为星型模型。</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="321" src="https://images2.imgbox.com/8b/01/tD3VM1Q3_o.png" width="676"></p> 
<p><span style="color:#222226;">（2）雪花模型</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#222226;">当有一个或多个维度表没有直接连接到事实表上，而是通过其他维表连接到事实表上时，其图解就像多个雪花连接在一起，故称雪花模型。</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="303" src="https://images2.imgbox.com/c7/c4/nRIjVWYl_o.png" width="698"></p> 
<p style="margin-left:.0001pt;text-align:justify;"><span style="color:#222226;">（3）星座模型</span></p> 
<p style="margin-left:0;text-align:left;"><span style="color:#222226;">星座模型是由星型模型延伸而来，星型模型是基于一张事实表而星座模式是基于多张事实表，并且共享维度表信息，这种模型往往应用于数据关系比星型模型和雪花模型更复杂的场合。星座模型需要多个事实表共享维度表，因而可以视为星形模型的集合。</span></p> 
<p style="margin-left:0;text-align:left;"><img alt="" height="375" src="https://images2.imgbox.com/5e/53/1ZpWnFzS_o.png" width="582"></p> 
<h4 id="14.1.3%20%E5%BB%BA%E6%A8%A1%E5%B7%A5%E5%85%B7" style="text-align:justify;"><strong>14.1.3 建模工具</strong></h4> 
<p style="margin-left:0;text-align:left;"><span style="color:#222226;">常用的有Navicat、</span><span style="color:#222226;">PowerDesigner</span></p> 
<h3 id="14.2%20%E5%B8%B8%E8%A7%81%E8%A1%A8%E7%B1%BB%E5%9E%8B" style="text-align:justify;"><strong>14.2 常见表类型</strong></h3> 
<h4 id="14.2.1%20%E6%8B%89%E9%93%BE%E8%A1%A8" style="text-align:justify;"><strong>14.2.1 拉链表</strong></h4> 
<p style="margin-left:0;text-align:left;">一些表的数据不是静态的，而是会随着时间而缓慢地变化，这种随着时间发生变化的维度称之为缓慢变化维。例如用户修改了自己的住址、商品的描述信息更改等。</p> 
<p style="margin-left:0;text-align:left;">有时候的某些需求需要查看或统计某一个时间点或者时间段的历史快照信息。这个时候就需要拉链表。</p> 
<p style="margin-left:0;text-align:left;">拉链表定义：记录数据在某一时间内的状态以及数据在某一时点上的变化的数据存储方式。</p> 
<p style="margin-left:0;text-align:left;">算法：</p> 
<p style="margin-left:0;text-align:left;">新增数据 ==&gt; 开链</p> 
<p style="margin-left:0;text-align:left;">删除数据 ==&gt; 关链</p> 
<p style="margin-left:0;text-align:left;">修改数据 ==&gt; 先关链，在开新的拉链</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">start_time</p> 
<p style="margin-left:0;text-align:left;">表示该条记录的生命周期开始时间——周期快照时的状态</p> 
<p style="margin-left:0;text-align:left;">end_time</p> 
<p style="margin-left:0;text-align:left;">该条记录的生命周期结束时间</p> 
<p style="margin-left:0;text-align:left;">end_time= ‘9999-12-31’ 表示该条记录目前处于有效状态</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">以emp表为原表举例：（阐述拉链表的过程，分为原表的更新和新增）</p> 
<p style="margin-left:0;text-align:left;">原表为更新时：</p> 
<p style="margin-left:0;text-align:left;">第一步：先以emp表为原表将结构及数据批量导入到新创建的拉链表empb中，同时在拉链表中新建两个字段，起始创建时间和结束时间。</p> 
<p style="margin-left:0;text-align:left;">create table empb as select emp.*,date'2023-03-21' starttime,date'9999-12-31' endtime from emp;</p> 
<p style="margin-left:0;text-align:left;">第二步：对原表某个值进行更新，这里选的是姓名为king的工资为5500。</p> 
<p style="margin-left:0;text-align:left;">update emp set sal=5500 where lower(ename)='king';</p> 
<p style="margin-left:0;text-align:left;">第三步：对拉链表进行更新，只更新结束时间，（结束时间与该条数据的下条新增的起始创建时间一致。因为原数据只有先结束标记为失效状态，再新增下条数据，标记为有效状态），然后再将原表emp的更新数据插入到拉链表empb中。</p> 
<p style="margin-left:0;text-align:left;">update empb set endtime=date'2023-03-22' where lower(ename)='king';</p> 
<p style="margin-left:0;text-align:left;">insert into empb select emp.*,date'2023-03-22',date'9999-12-31' from emp where lower(ename)='king';</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">原表为插入数据时：</p> 
<p style="margin-left:0;text-align:left;">第一步：与更新数据一致。</p> 
<p style="margin-left:0;text-align:left;">第二步：对原表插入数据。</p> 
<p style="margin-left:0;text-align:left;">第三步：不用对拉链表的日期更新，直接根据原表的数据插入即可（只需要第三步中的第二步）。</p> 
<p style="margin-left:0;text-align:left;"></p> 
<p style="margin-left:0;text-align:left;">拉链表能反应出某个时间的所有信息的有效情况，相当于快照表。比如说：</p> 
<p style="margin-left:0;text-align:left;">已知拉链表中：用户A002有两条数据，分别是：</p> 
<p style="margin-left:0;text-align:left;">用户   起始时间     结束时间      状态</p> 
<p style="margin-left:0;text-align:left;">A002   2016-01-01     2017-01-03     失效</p> 
<p style="margin-left:0;text-align:left;">A002   2017-01-03     9999-12-31     有效</p> 
<p style="margin-left:0;text-align:left;">要求查询出在2016-06-01的用户情况：</p> 
<p style="margin-left:0;text-align:left;"><span style="background-color:#ffffff;"><span style="color:#008080;">select</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> * </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">from</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> empb </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">where</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> start_time &lt;= </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">date</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">‘</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2016</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">-</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">06</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">-</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">01</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">’ </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">and</span></span><span style="background-color:#ffffff;"><span style="color:#000080;"> end_time &gt;= </span></span><span style="background-color:#ffffff;"><span style="color:#008080;">date</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">‘</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">2016</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">-</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">06</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">-</span></span><span style="background-color:#ffffff;"><span style="color:#0000ff;">01</span></span><span style="background-color:#ffffff;"><span style="color:#000080;">’;</span></span></p> 
<p style="margin-left:0;text-align:left;">此SQL语句会查询出这天所有用户的有效信息。</p> 
<h4 id="14.2.2%20%E5%85%A8%E9%87%8F%E8%A1%A8" style="text-align:justify;"><strong>14.2.2 </strong><strong>全量表</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">全量表就是记录所有的数据，一般使用它时都会清空目标表。用于数据量不大的表。</p> 
<h4 id="14.2.3%20%E5%A2%9E%E9%87%8F%E8%A1%A8" style="text-align:justify;"><strong>14.2.3 </strong><strong>增量表</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">增量表只记录更新周期内的新增数据，就是基于原表，记录每次变化的数据。</p> 
<p style="margin-left:0;text-align:left;">特殊增量表：da表，每天的分区就是当天的数据，其数据特点就是数据产生后就不会发生变化，如日志表</p> 
<h4 id="14.2.4%20%E6%B5%81%E6%B0%B4%E8%A1%A8" style="text-align:justify;"><strong>14.2.4 </strong><strong>流水表</strong></h4> 
<p style="margin-left:0;text-align:left;">对于表的每一个修改都会记录，可以用于反映实际记录的变更。</p> 
<p style="margin-left:0;text-align:left;">与拉链表的区别：流水表是只新增，不对原来的结束时间做出更新，且流水表只有创建时间，没有结束时间。流水表就是字面意思，直接罗列出来即可，无论原表是新增还是更新，流水表都是新增。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3c80171f3b76f3dd7c1ba65a461b5e47/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux和Hadoop的学习</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/be22330378e0af6f074ebb930e996fbb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python：六步教会你使用python爬虫爬取数据</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>