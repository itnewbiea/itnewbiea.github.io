<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>手把手教你电商用户行为分析 | 附实战代码 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="手把手教你电商用户行为分析 | 附实战代码" />
<meta property="og:description" content="导读：本文将针对淘宝App的运营数据，以行业常见指标对用户的行为进行分析。
作者：刘鹏、高中强
来源：华章计算机（hzbook_jsj）
数据内容包括user_id（用户身份）、item_id（商品）、IDbehavior_type（用户行为类型，包含点击、收藏、加购物车、支付四种行为，分别用数字1、2、3、4表示）、user_geohash（地理位置）、item_category（品类ID，即商品所属的品类）、Time（用户行为发生的时间），其中user_id和item_id因为涉及隐私，做了脱敏处理，显示的是数字编号。
下面是具体的代码实现过程。
1. 导入相关工具和数据
# 导入相关库 import pandas as pd import numpy as np %matplotlib inline import matplotlib.pyplot as plt import seaborn as sns dt = pd.read_csv(&#39;E:/tianchi_mobile_recommend_train_user.csv&#39;) 其中，seaborn库可实现对统计数据的可视化展示，是基于Matplotlib的Python数据可视化库。
2. 数据的处理
# 对其中的label进行重命名 dt=dt.rename(columns={&#39;user_id&#39;:&#39;用户名&#39;,&#39;item_id&#39;:&#39;商品名&#39;,&#39;behavior_type&#39;:&#39;用 户行为类型&#39;,&#39;user_geohash&#39;:&#39;地理位置&#39;,&#39;InvoiceDate&#39;:&#39;发票日期&#39;,&#39;item_category&#39;: &#39;品类名&#39;,&#39;CustomerID&#39;:&#39;用户名&#39;,&#39;time&#39;:&#39;行为时间&#39;}) dt.apply(lambda x:sum(x.isnull())/len(x))# 计算缺失率(缺失数/总数) # # 对时间数据进行处理，将日期与小时数据分开 dt[&#39;date&#39;]=dt[&#39;行为时间&#39;].str[0:10] dt[&#39;hour&#39;]=dt[&#39;行为时间&#39;].str[11:] dt[&#39;date&#39;]=pd.to_datetime(dt[&#39;date&#39;]) dt[&#39;行为时间&#39;]=pd.to_datetime(dt[&#39;行为时间&#39;]) dt[&#39;hour&#39;]=dt[&#39;hour&#39;].astype(int) dt.sample(5) 结果如图12-24所示。
图12-24　数据处理结果
# # 将数据集按时间列进行升序排列 dt.sort_values(by=&#39;行为时间&#39;,ascending=True,inplace=True) # 舍弃原来的索引进行重置 dt.reset_index(drop=True,inplace=True) # 查看处理后的数据信息 dt.info() 结果如图12-25所示。
图12-25　处理后的数据信息
dt.describe() 结果如图12-26所示。
图12-26　处理后的数据分布情况" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b8bd06a82e770e79b9d205bdb4399520/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-16T08:00:00+08:00" />
<meta property="article:modified_time" content="2022-02-16T08:00:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">手把手教你电商用户行为分析 | 附实战代码</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p><img src="https://images2.imgbox.com/c7/de/wRlwEVLr_o.gif" alt="b1c1a04366edbe6384b522b441993640.gif"><br></p> 
 <p><img src="https://images2.imgbox.com/5f/3c/8GUZG57J_o.png" alt="42554bfe263527fc6ad5fe46f319df11.png"></p> 
 <p style="text-align:justify;"><strong>导读：</strong>本文将针对淘宝App的运营数据，以行业常见指标对用户的行为进行分析。</p> 
 <p><img src="https://images2.imgbox.com/70/3f/BnTvCPoz_o.png" alt="9ed7300430b4987f7d8a5efa48784c2c.png"></p> 
 <p>作者：刘鹏、高中强<br></p> 
 <p>来源：华章计算机（hzbook_jsj）</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/15/89/1H1udPGr_o.png" alt="0805e42d7fc768f4f74508689fe0453d.png"></p> 
 <p>数据内容包括user_id（用户身份）、item_id（商品）、IDbehavior_type（用户行为类型，包含点击、收藏、加购物车、支付四种行为，分别用数字1、2、3、4表示）、user_geohash（地理位置）、item_category（品类ID，即商品所属的品类）、Time（用户行为发生的时间），其中user_id和item_id因为涉及隐私，做了脱敏处理，显示的是数字编号。</p> 
 <p>下面是具体的代码实现过程。</p> 
 <p><strong>1. 导入相关工具和数据</strong></p> 
 <pre class="has"><code class="language-python"># 导入相关库
import pandas as pd
import numpy as np
%matplotlib inline
import matplotlib.pyplot as plt
import seaborn as sns
dt = pd.read_csv('E:/tianchi_mobile_recommend_train_user.csv')</code></pre> 
 <p>其中，seaborn库可实现对统计数据的可视化展示，是基于Matplotlib的Python数据可视化库。</p> 
 <p><strong>2. 数据的处理</strong></p> 
 <pre class="has"><code class="language-perl"># 对其中的label进行重命名
dt=dt.rename(columns={'user_id':'用户名','item_id':'商品名','behavior_type':'用
    户行为类型','user_geohash':'地理位置','InvoiceDate':'发票日期','item_category':
    '品类名','CustomerID':'用户名','time':'行为时间'})
dt.apply(lambda x:sum(x.isnull())/len(x))# 计算缺失率(缺失数/总数)
# # 对时间数据进行处理，将日期与小时数据分开
dt['date']=dt['行为时间'].str[0:10]
dt['hour']=dt['行为时间'].str[11:]
dt['date']=pd.to_datetime(dt['date'])
dt['行为时间']=pd.to_datetime(dt['行为时间'])
dt['hour']=dt['hour'].astype(int)
dt.sample(5)</code></pre> 
 <p>结果如图12-24所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/63/19/vUuRWaST_o.png" alt="2d09fd3d0b609e1d882cde3066c7e841.png"></p> 
 <p style="text-align:center;">图12-24　数据处理结果</p> 
 <pre class="has"><code class="language-php"># # 将数据集按时间列进行升序排列
dt.sort_values(by='行为时间',ascending=True,inplace=True)
# 舍弃原来的索引进行重置
dt.reset_index(drop=True,inplace=True)
# 查看处理后的数据信息
dt.info()</code></pre> 
 <p>结果如图12-25所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/b6/4d/HYThpvg7_o.png" alt="da942d0849614dd85cc5da535a67693b.png"></p> 
 <p style="text-align:center;">图12-25　处理后的数据信息</p> 
 <pre class="has"><code class="language-css">dt.describe()</code></pre> 
 <p>结果如图12-26所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/58/74/af8bg3hy_o.png" alt="0a94594d59c2792f78015bd2f67bd9e2.png"></p> 
 <p style="text-align:center;">图12-26　处理后的数据分布情况</p> 
 <p><strong>3. 用户行为分析</strong></p> 
 <p>在介绍用户行为分析前，先了解两个概念。</p> 
 <ul><li><p><strong>PV</strong>（Page View，访问量）：具体是指网站的页面浏览量或者点击量，页面被刷新一次就计算一次；</p></li><li><p><strong>UV</strong>（Unique Visitor，独立访客）：访问网站的一台电脑客户端即一个访客。<br><br></p></li></ul> 
 <p>1）日访问量分析：</p> 
 <pre class="has"><code class="language-php"># uv_daily记录每天不同的上线用户数量
uv_daily=dt.groupby('date')['用户名'].nunique().rename('uv')
uv_daily=uv_daily.reset_index().rename(columns={'用户名':'uv'})
uv_daily.set_index('date',inplace=True)
# pv_daily记录每天用户操作次数
pv_daily=dt.groupby('date')['用户名'].count()
pv_daily=pv_daily.reset_index().rename(columns={'用户名':'pv'})
pv_daily.set_index('date',inplace=True)  
# UV同比
uv_daily['uv_lastday']=uv_daily.shift(1)
uv_daily['tb']=100*(uv_daily['uv']-uv_daily['uv_lastday'])/uv_daily['uv_
    lastday']
formater="{0:.02f}".format
uv_daily['tb']=uv_daily['tb'].map(formater).astype('float')</code></pre> 
 <ul><li><p><strong>nunique()</strong>：该函数返回所有数据唯一值个数。unique()函数是以数组形式返回列的所有唯一值。</p></li><li><p><strong>shift()</strong>：该函数对数据进行移动的操作，默认值是1。注意这里移动的都是数据，而索引是不移动的，移动之后没有对应值的，就赋值为NaN。</p></li><li><p><strong>formater="{0:.02f}"</strong>.format相当于formater=lambda x: '%.02f'，即x取小数点后两位。</p></li></ul> 
 <pre class="has"><code class="language-bash"># UV环比
uv_daily['uv_7days']=uv_daily['uv'].shift(7)
uv_daily['hb']=100*(uv_daily['uv']-uv_daily['uv_7days'])/uv_daily['uv_7days']
formater="{0:.02f}".format
uv_daily['hb']=uv_daily['hb'].map(formater).astype('float')
uv_daily.head(2)</code></pre> 
 <p>结果如图12-27所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/d3/16/VlSwtuld_o.png" alt="5ed1c7f3aac178b81238a05882f84e1a.png"></p> 
 <p style="text-align:center;">图12-27　UV同比、环比情况</p> 
 <pre class="has"><code class="language-bash"># PV同比
pv_daily['pv_lastday']=pv_daily.shift(1)
pv_daily['tb']=100*(pv_daily['pv']-pv_daily['pv_lastday'])/pv_daily['pv_
    lastday']
formater="{0:.02f}".format
pv_daily['tb']=pv_daily['tb'].map(formater).astype('float')
# PV环比
pv_daily['pv_7days']=pv_daily.pv.shift(7)
pv_daily['hb']=100*(pv_daily['pv']-pv_daily['pv_7days'])/pv_daily['pv_7days']
formater="{0:.02f}".format
pv_daily['hb']=pv_daily['hb'].map(formater).astype('float')
pv_daily.head(2)</code></pre> 
 <p>结果如图12-28所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/b8/ec/gQayj2C6_o.png" alt="9b4bbbf4faeaedc3a506f8bb12e87d37.png"></p> 
 <p style="text-align:center;">图12-28 PV同比、环比情况</p> 
 <p>同比，即同期比较，可以是本年度与上年度，也可以是上年同一个月份或季度与本年同期。同比发展速度一般是指本期发展水平与上年同期发展水平对比，而达到的相对发展速度。由此处求得的PV同比增长可以看出本期与之前同样的时间段内用户对该平台的点击变动情况，由UV的同比增长可以看出在同样时段中使用该平台的用户数量的变化。</p> 
 <p>环比，即连续两个单位周期（比如连续两月）内的量的变化比。如今年8月比今年7月。当然这里的单位不一定是月，它可以是任何时间单位，能反映本期比上期增长了多少。环比发展速度，一般是指报告期水平与前一时期水平之比，表明现象逐期的发展速度。由此处求得的PV环比增长可以看出连续时间段内用户对该平台的点击变动情况，由UV的环比增长可以看出使用该平台的用户数量的变化。</p> 
 <pre class="has"><code class="language-powershell"># 按照日期和用户行为进行分组
pv_detail=dt.groupby(['用户行为类型','date'])['用户名'].count()
pv_detail=pv_detail.reset_index().rename(columns={'用户名':'total_pv'})
# # 将时间格式转换，否则会调用最原始的数据形状，会包含时分秒的格式
pv_detail['date']=pv_detail['date'].dt.strftime('%Y-%m-%d')
pv_detail['用户行为类型']=pv_detail['用户行为类型'].map({1:'click',2:'collect',
    3: 'add_to_cart',4:'payment'})
fig,axes=plt.subplots(2,1,sharex=True,figsize=(20,10)) # 可视化
sns.pointplot(x='date',y='total_pv',hue='用户行为类型',data=pv_detail,ax=axes[0])
sns.pointplot(x='date',y='total_pv',hue='用户行为类型',data=pv_detail[pv_detail
    ['用户行为类型']!='click'],ax=axes[1])
axes[0].set_title('pv different behavior type')
axes[1].set_title('pv different behavior type except click')</code></pre> 
 <p>结果如图12-29所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/d1/24/Jcn5DjQF_o.png" alt="2799a91e376818ed0820cb2e7ca2f4d9.png"></p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/01/1f/EWI5yxFJ_o.png" alt="8848d1570ae8315c9d319bbb377646dc.png"></p> 
 <p style="text-align:center;">图12-29　不同用户行为的PV情况统计<br></p> 
 <p>从图12-29中可以看出，由于浏览点击的数量和其他用户行为不在一个数量级，故将其他三种类型单独列看，发现加购物车的人数高于其他两种类型。</p> 
 <pre class="has"><code class="language-python">pv_uv_daily=pd.concat([pv_daily,uv_daily],axis=1)
import matplotlib.dates as mdate
from matplotlib.dates import DateFormatter
pv_uv_daily['date']=pd.to_datetime(dt['date'])
plt.figure(figsize=(16,10))
plt.xlabel(' ',fontsize=9)
pv_uv_daily['pv'].plot(color='steelblue',label='每天访问量')
plt.ylabel('访问量')
plt.legend(loc=1)
fig=pv_uv_daily['uv'].plot(color='red',label='每天不同用户访问量',secondary_y=True)
plt.ylabel('访问用户量')
plt.xticks((pv_uv_daily.index),pd.date_range('2014-11-18','2014-12-18'))
plt.legend(loc=2)
plt.grid(True)
plt.gcf().autofmt_xdate()# 坐标轴时间刻度自动调整
fig.xaxis.set_major_formatter(DateFormatter('%Y-%m-%d'))
plt.rcParams['font.sans-serif']=['SimHei'] 
plt.show()</code></pre> 
 <p>结果如图12-30所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/50/da/T6bMRpmx_o.png" alt="3ac5082c2d72f81b568bf8075733f76a.png"></p> 
 <p style="text-align:center;">图12-30　用户行为的日期折线图</p> 
 <p>由用户行为的日期折线图可以看出，用户行为也具有周期性特点，在11.21、11.28、12.5这三个周五都是一周内的最低值，12月10日至12月12日，用户点击量、收藏量、加购量都明显增长，在12月12日达到最大值，而购买量则在12月12日当日大幅度增加。</p> 
 <p>从图12-30中可以看出，每天用户会访问多次，用户访问量在双十二有明显激增，进而带来流量的激增。在此时段的用户消费情况应该远优于其他时段，此时一些小商家可以考虑在此段时间加入一些营销手段，提高自己的PV点击量，带动销量。</p> 
 <ul><li><p><strong>strftime()</strong><strong>：</strong>使用strftime()函数将时间格式化为我们想要的格式。</p></li><li><p><strong>fig、axes</strong><strong>：</strong>用来创建多维窗口，此处是一个2?的图。sharex：x轴一样，y轴不同；</p></li><li><p><strong>figsize：</strong>图片的大小尺寸。</p></li><li><p><strong>sns.pointplot()</strong>：点图表示通过散点图点的位置对数值变量的中心趋势的估计。x, y, hue：数据字段变量名，根据实际数据，x、y常用来指定x、y轴的分类名称，hue常用来指定第二次分类的数据类别；ax：绘图时使用的Axes轴对象，ax=axes[0]是在第一个x轴上生成图像，依此类推。</p></li><li><p><strong>concat()：</strong>可以根据一个或多个键将不同DataFrame中的行连接起来，可以指定按某个轴进行连接，也可以指定连接的方式，axis=1实现横向连接。</p></li><li><p><strong>matplotlib.dates：</strong>将datetime对象转换为浮点数，用于配置横坐标为日期格式。</p></li><li><p><strong>DateFormatter：</strong>用于设定日期格式。</p></li><li><p><strong>color='steelblue'</strong>：颜色为亮钢兰色。</p></li><li><p><strong>plt.legend(loc=1)：</strong>此处表示图注的位置，而1、2、3、4分别对应图像的右上角、左上角、左下角、右下角，但两个图注不能重合。</p></li><li><p><strong>plot(secondary_y=True)：</strong>指右侧的y轴是否显示。</p></li><li><p><strong>plt.rcParams['font.sans-serif']=['SimHei']：</strong>用来正常显示中文标签。</p></li><li><p><strong>plt.grid(True)：</strong>是否在图中显示网格。<br><br></p></li></ul> 
 <p>2）小时访问量分析：</p> 
 <pre class="has"><code class="language-php">pv_hour=dt.groupby('hour').count()['用户名']
uv_hour=dt.groupby('hour')['用户名'].nunique().rename('uv')
pv_uv_hour=pd.concat([pv_hour,uv_hour],axis=1)
pv_uv_hour.columns=['pv','uv']
plt.figure(figsize=(16,10))
plt.xlabel(' ',fontsize=9)
pv_uv_hour['pv'].plot(color='steelblue',label='pv访问量')
plt.ylabel('访问量')
plt.legend(loc='upper right')
pv_uv_hour['uv'].plot(color='red',label='uv访问量',secondary_y=True)
plt.ylabel('访问用户量')
plt.xticks(range(0,24),pv_uv_hour.index)
plt.legend(loc='upper center')
plt.grid(True)
# 坐标轴时间刻度自动调整
plt.gcf().autofmt_xdate() 
plt.show()</code></pre> 
 <p>结果如图12-31所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/8f/31/fDy2wDTW_o.png" alt="36039d8c60511d01c80b0115fc3295a1.png"></p> 
 <p style="text-align:center;">图12-31　一天内用户行为</p> 
 <p>由图12-31可知，pv和uv在凌晨0～5点期间波动情况相同，都呈下降趋势，访问量都比较小，同时在晚上18点后，pv访问量激增，但uv波动不大，很有可能是用户量趋于稳定但他们空闲时间增多，因此pv增多，所以晚上18～22点是该电商平台用户访问App的活跃时间段，可以在此段时间集中进行促销活动。</p> 
 <p>3）不同行为类型用户pv分析：</p> 
 <pre class="has"><code class="language-perl">pv_detail=pd.pivot_table(columns='用户行为类型', index='hour', data=dt, values=
    '用户名',aggfunc=np.size)
plt.figure(figsize=(16,9))
sns.lineplot(data=pv_detail.iloc[:,1:])
plt.show()
# 1-点击；2-收藏；3-购物车；4-支付</code></pre> 
 <ul><li><p><strong>pivot_table()</strong>：透视表，它是一种可以对数据动态排布并且分类汇总的表格格式。columns为列维度；index为行维度；values为对需要的计算数据进行筛选；aggfunc表示可以设置我们对数据聚合时进行的函数操作，即聚合依据，np.size用于统计矩阵元素个数。</p></li><li><p><strong>Sns.lineplot()：</strong>绘制折线图。</p></li><li><p><strong>iloc[:,1:]：</strong>截取除第一列外的所有行列数据。<br><br></p></li></ul> 
 <p>结果如图12-32所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/77/45/ku2s1PlA_o.png" alt="b3d7f2eda495a10ebac40d28fb4dfa6b.png"></p> 
 <p style="text-align:center;">图12-32　不同行为类型的用户pv</p> 
 <p>由于点击的数量比其他操作数量多太多，故此处去掉查看其他具体操作的情况。</p> 
 <p>由图12-32可知点击相比较于其他三类用户行为，pv访问量较高，同时四种用户行为的波动情况基本一致，因此在晚上这一时间段，不管是哪种用户行为，pv访问量都是最高的。同时加入购物车这一用户行为的pv总量高于收藏的总量，购物车pv&gt;收藏pv&gt;支付pv，因此在后续漏斗流失分析中，要重点关注购物车这一用户类型。</p> 
 <p><strong>4. 用户消费行为分析</strong></p> 
 <p>1）购买用户的访问次数分析：</p> 
 <pre class="has"><code class="language-bash"># 已经购买的用户里面访问次数
data_user_buy=dt[dt['用户行为类型']==4].groupby('用户名')['用户行为类型'].count()
# 查看用户的浏览次数
plt.hist(x=data_user_buy,bins=30)
plt.show()</code></pre> 
 <ul><li><p><strong>plt.hist()：</strong>直方图，其中x参数指定每个bin（箱子）分布的数据，对应x轴；bins参数指定bin（箱子）的个数，也就是总共有几幅条状图。</p></li></ul> 
 <p>结果如图12-33所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/b3/3c/H5rzyGHd_o.png" alt="3d72d490199e49b2bd6b7f0cf0cde897.png"></p> 
 <p style="text-align:center;">图12-33　购买次数和用户数目关系</p> 
 <p>用户消费次数普遍在13～17次，因此需要重点关注购买次数在20次以上的消费者用户群体。</p> 
 <p>2）日ARPPU。</p> 
 <p>ARPPU（Average Revenue Per Paying User，平均每用户付费额度）是指从每位付费用户身上获得的收入，它反映的是每个付费用户的平均付费额度。</p> 
 <p style="text-align:center;"><strong><em>ARPPU=总收入/活跃用户付费数量</em></strong></p> 
 <p>因为本数据集中没有消费金额，因此在计算过程中用消费次数代替消费金额—人均消费次数=消费总次数/消费人数</p> 
 <pre class="has"><code class="language-bash"># 针对已付费用户计算消费次数，即人均消费次数
data_use_buy1=dt[dt['用户行为类型']==4].groupby(['date','用户名'])
['用户行为类型'].count().reset_index().rename(columns={'用户行为类型':'total'})
data_use_buy1.describe()</code></pre> 
 <p>结果如图12-34所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/4f/f0/rn8iKUTn_o.png" alt="5f9fd014779d4047e2683566c8d3569a.png"></p> 
 <p style="text-align:center;">图12-34　人均消费次数</p> 
 <pre class="has"><code class="language-bash"># 计算每天消费次数、消费人数，即每天人均消费次数
# 消费次数/消费人数
data_use_buy2=data_use_buy1.groupby('date').sum()['total']/data_use_buy1.
    groupby('date').count()['total']
data_use_buy2.plot()
plt.show()</code></pre> 
 <p>结果如图12-35所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/b4/50/6dabackH_o.png" alt="b671e98b897362524c06ebfca44a62cf.png"></p> 
 <p style="text-align:center;">图12-35　每天人均消费次数</p> 
 <pre class="has"><code class="language-css">data_use_buy2.describe()</code></pre> 
 <p>结果如图12-36所示。</p> 
 <p>从统计数据看，每天人均购买2次左右，最多购买近4次。</p> 
 <p>日ARPU（Average Revenue Per User，平均每用户收入）可通过（总收入/AU）计算得出，用于衡量产品的盈利能力和发展活力。</p> 
 <p style="text-align:center;"><strong><em>活跃用户数平均消费次数=消费总次数/活跃用户人数(每天有操作行为的用户）</em></strong></p> 
 <pre class="has"><code class="language-python">dt['operation']=1
# 计算不同行为访问量
data_use_buy3=dt.groupby(['date','用户名','用户行为类型'])
['operation'].count().reset_index().rename(columns={'operation':'total'})
# 计算每天用户的平均消费次数
data_use_buy3.groupby('date').apply(lambda x:x[x.用户行为类型==4]
.total.sum()/len(x.用户名.unique())).plot()
plt.title('daily_ARPU')</code></pre> 
 <p>结果如图12-37所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/e9/53/fPJPxAaw_o.png" alt="bb02ada245aa6b161a19e0a3d4b27e1a.png"></p> 
 <p style="text-align:center;">图12-37　日ARPU情况</p> 
 <p>由图12-37可知，双十二这天的销量果然是最高的，附近日期的销量也远高于平常，盈利和点击量也是这段时间最可观的，双十二当天的平均每用户收入将近2（平常日ARPU可0.5左右）。</p> 
 <p>3）付费率，计算公式如下：</p> 
 <p style="text-align:center;"><em><strong>付费率=消费人数/活跃用户人数</strong></em></p> 
 <p>具体实现代码如下：</p> 
 <pre class="has"><code class="language-python">data_use_buy3.groupby('date').apply(lambda x:x[x.用户行为类型==4]
.total.count()/len(x.用户名.unique())).plot()
plt.title('daily_afford_rate')</code></pre> 
 <p>结果如图12-38所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/6d/78/pztELmDK_o.png" alt="27375e3f002f874d126220bcffd45be6.png"></p> 
 <p style="text-align:center;">图12-38　每日付费率</p> 
 <p>用户付费率是衡量商家盈利情况的重要指标，从图12-38中可以看出，双十二的付费率在0.5，意味着浏览过商品的用户，有一半人都会选择购买商品，转化率已经很不错了（平常的付费率在0.23左右）。如果想要进一步提升用户的付费转化率，就需要梳理现有活动的转化流程，观察各转化环节的转化率。针对转化率较差的环节，思考转化较差的原因并采取相应措施，减少用户在各环节中的流失。例如：环节是否过多、流程是否过长，是否需要对环节进行合理的合并或删减；各环节的引导机制是否顺畅，文案/UI是否引导清晰，是否可以通过一些奖励来提高转化等。</p> 
 <p>4）同一时间段用户消费次数分布：</p> 
 <pre class="has"><code class="language-bash">data_user_buy3=dt[dt.用户行为类型==4]
.groupby(['用户名','date','hour'])['operation'].sum().rename('buy_count')
sns.distplot(data_user_buy3)
print('大多数用户消费：{}次'.format(data_user_buy3.mode()[0]))</code></pre> 
 <p>结果如图12-39所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/71/ca/7a9v5lkm_o.png" alt="03b634b54b245d1829da1464ca82713f.png"></p> 
 <p style="text-align:center;">图12-39　同时段用户消费次数<br><br></p> 
 <ul><li><p><strong>sns.distplot()：</strong>用来绘制直方图。</p></li><li><p><strong>format()：</strong>通过{}和:来代替传统%方式，即在%处依次填充入format的内容。</p></li><li><p><strong>mode()[0]：</strong>mode()函数最后输出两个值，一个是众数值，另外是众数个数，[0]是返回众数值，整个语句的意思为返回data_user_buy3中的众数值。<br><br></p></li></ul> 
 <p><strong>5. 复购行为分析</strong></p> 
 <p>复购情况，即两天以上有购买行为，一天内多次购买算一次。</p> 
 <p style="text-align:center;"><em><strong>复购率=有复购行为的用户数/有购买行为的用户总数</strong></em></p> 
 <pre class="has"><code class="language-python">date_rebuy=dt[dt.用户行为类型==4].groupby('用户名')['date']
.apply(lambda x:len(x.unique())).rename('rebuy_count')
print('复购率:',round(date_rebuy[date_rebuy&gt;=2].count()/date_rebuy.count(),4))
运行代码，得到复购率为0.8717。
round(number,digits)函数用于处理计算数据的四舍五入，number是数值，digits为保留几位小数，当digits&lt;0时，在小数点左侧进行四舍五入。
# 所有复购时间间隔消费次数分布
data_day_buy=dt[dt.用户行为类型==4].groupby(['用户名','date']).operation.count().
    reset_index()
data_user_buy4=data_day_buy.groupby('用户名').date.apply(lambda x:x.sort_values().
    diff(1).dropna())
data_user_buy4=data_user_buy4.map(lambda x:x.days)
data_user_buy4.value_counts().plot(kind='bar')
plt.title('time_gap')
plt.xlabel('gap_day')
plt.ylabel('gap_count')</code></pre> 
 <p>结果如图12-40所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/a5/85/MqvIhPNu_o.png" alt="ba577b9f88afb2fc7db63b1f5bba178c.png"></p> 
 <p style="text-align:center;">图12-40　复购时间间隔与消费次数分布关系</p> 
 <ul><li><p><strong>sort_values()：</strong>按照某一列的大小进行排序，默认为True，即升序排列。</p></li><li><p><strong>diff()：</strong>关于某列或者某行数据进行差分运算，axis=1，则进行列间的移动差分操作。</p></li></ul> 
 <pre class="has"><code class="language-bash"># 不同用户平均复购时间分析
sns.distplot(data_user_buy4.reset_index().groupby('用户名').date.mean())</code></pre> 
 <p>结果如图12-41所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/9f/8f/JYg0arKH_o.png" alt="0889ea60ca35071695625cdffd987878.png"></p> 
 <p style="text-align:center;">图12-41　不同用户平均复购时间</p> 
 <p>分析来看，多数用户复购率为0.04693，消费次数随着消费时间间隔的增加而不断下降，在1～10天之内复购次数比较多，10天之后用户很少进行复购，因此需要重视10天之内的用户复购行为，增加用户复购。不同用户平均复购时间呈正态分布，但是总体来看，呈现逐渐下降趋势。多数用户平均复购时间集中在1～5天时间间隔内。</p> 
 <p><strong>6. 漏斗流失分析</strong></p> 
 <p>漏斗流失分析是一套流程式数据分析，它能够科学反映用户行为状态以及从起点到终点各阶段用户转化率情况。</p> 
 <pre class="has"><code class="language-bash">data_user_count=dt.groupby('用户行为类型').size()
data_user_count
# 查看点击数据
data_user_count[1]
# 计算总浏览量
pv_all=dt['用户名'].count()
pv_all
print('总浏览量—点击量 流失率: {:.2%}'.format((pv_all - data_user_count[1])/pv_all))
print('点击量-加入购物车量 流失率: {:.2%}'
.format((data_user_count[1] - data_user_count[3])/data_user_count[1]))
print('加入购物车量-收藏量 流失率: {:.2%}'
.format((data_user_count[3] - data_user_count[2])/data_user_count[3]))
print('收藏量—购买量 流失率: {:.2%}'
.format((data_user_count[2] - data_user_count[4])/data_user_count[2]))</code></pre> 
 <p>结果如图12-42所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/71/7a/Q0y9Zt6C_o.png" alt="d06271f5ba4233b260e9befd33532bd1.png"></p> 
 <p style="text-align:center;">图12-42 漏斗分析流失率情况<br></p> 
 <p>漏斗分析就是转化率分析，流量漏斗模型在产品中的经典运用是AARRR模型。衡量每一个节点的转换率，通过异常数据（即转换率过低处）找出异常节点，进而确定各个环节的流失率，分析用户怎么流失、为什么流失、在哪里流失。根据数据改进产品，最终提升整体转化率。从上面的分析中我们可以看出，从点击到加入购物车的转化率是最低的，流失率达到97%，所以要尽可能降低此处的流失率，比如可以改变商品的展示图片、提高留言区的评论质量等。</p> 
 <p><strong>7. 用户价值RFM分析</strong></p> 
 <pre class="has"><code class="language-python">from datetime import datetime
datenow=datetime(2014,12,20)
# 每位用户最近购买时间
recent_buy_time=dt[dt.用户行为类型==4].groupby('用户名')['date']
.apply(lambda x:datetime(2014,12,20)-x.sort_values().iloc[-1])
recent_buy_time=recent_buy_time.reset_index().rename(columns={'date':'recent'})
recent_buy_time.recent=recent_buy_time.recent.map(lambda x:x.days)
# 每个用户消费频率
buy_freq=dt[dt.用户行为类型==4].groupby('用户名').date.count()
.reset_index().rename(columns={'date':'freq'})
rfm=pd.merge(recent_buy_time,buy_freq,left_on='用户名',right_on='用户名',how=
    'outer')
# 将各维度分成两个程度,基于等频分段，分数越高越好
rfm['recent_value']=pd.qcut(rfm.recent,2,labels=['2','1'])
rfm['freq_value']=pd.qcut(rfm.freq,2,labels=['1','2'])
rfm['rfm']=rfm['recent_value'].str.cat(rfm['freq_value'])
rfm.head()</code></pre> 
 <p>结果如图12-43所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/c6/04/JDrroo4P_o.png" alt="f399f3a7a973b704ca1bd91fd459681f.png"></p> 
 <p style="text-align:center;">图12-43 用户价值RFM分析<br></p> 
 <pre class="has"><code class="language-python">def trans_value(x):
    if x == '22':
        return '重要价值客户'
    elif x == '21':
        return '重要深耕客户'
    elif x == '12':
        return '重要唤回客户'
    else: 
        return '流失客户'
rfm['用户等级']=rfm['rfm'].apply(trans_value)
rfm['用户等级'].value_counts()</code></pre> 
 <p>结果如图12-44所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/5b/2c/bpyBw013_o.png" alt="0cd17014f49524f323be9e503b116adb.png"></p> 
 <p style="text-align:center;">图12-44 RFM模型用户等级情况<br></p> 
 <ul><li><p><strong>pd.qcut(x, q, labels=None)</strong>表示创建每个区间分割的数据个数相等。其中，x是相应的data，q则为组数，labels是标签名，而相应的pd.cut()则为创建差值相等（个数不同）的区间。</p></li></ul> 
 <p>可以看出重要价值客户和流失客户是最多的，可以根据不同的客户类型制定相应的营销策略，一段时间后，再对比查看效果。</p> 
 <p>1）转化率分析（从点击到加入购物车）：</p> 
 <pre class="has"><code class="language-shell"># # 看下列标签
dt.columns</code></pre> 
 <p>结果如图12-45所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/c8/cd/LUmcmtIB_o.png" alt="672924ddb637f0eb462746fb310744de.png"></p> 
 <p style="text-align:center;">图12-45　标签</p> 
 <pre class="has"><code class="language-bash"># 不同用户行为类别的转化率
data_category=dt[dt.用户行为类型!=2].groupby(['品类名','用户行为类型']).operation.
    count().unstack(1).rename(columns={1:'点击量',3:'加入购物车量',4:'购买量'}).
    fillna(0)
# 转化率计算
data_category['转化率']=data_category['购买量']/data_category['点击量']
# 空值填充为0
data_category=data_category.fillna(0) 
data_category=data_category[data_category['转化率']&lt;=1]
data_category.describe()</code></pre> 
 <p>结果如图12-46所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/0d/25/g9uaML70_o.png" alt="6e1316693e0f7f7b82263fda5c44d600.png"></p> 
 <p style="text-align:center;">图12-46　点击到加入购物车的转化率</p> 
 <p>unstack(1)表示将列索引转成最内层的行索引，默认值就为1，将最内层的列索引转换为最内层的行索引。</p> 
 <p>由数据可得，转化率均值在1.5%左右，其中75%的用户转化率在1.9%左右，即点击但不购买的用户拉低了整体点击率，需收集用户浏览商品详情页的相关数据，分析出用户流失的原因，指导商家优化详情页，提高转化。</p> 
 <p>2）转化率分析（从加入购物车到购买）：</p> 
 <pre class="has"><code class="language-javascript">data_category['感兴趣比率']=data_category['加入购物车量']/data_category['购买量']
data_category=data_category[data_category['感兴趣比率']&lt;=1]
data_category.describe()</code></pre> 
 <p>结果如图12-47所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/6d/ed/qGed5G0M_o.png" alt="a05908424365511e064d3c4220c1326e.png"></p> 
 <p style="text-align:center;">图12-47　加入购物车到购买的感兴趣比率</p> 
 <pre class="has"><code class="language-cs"># 查看购买量前10的商品的感兴趣比率情况
data_category.groupby('品类名').sum()['购买量'].sort_values(ascending=False)
data_category.head(10)</code></pre> 
 <p>结果如图12-48所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/0a/2a/xyL3SxCe_o.png" alt="56a7902db13f3321d9af48e51387f7f4.png"></p> 
 <p style="text-align:center;">图12-48　购买量前10的商品的感兴趣比率</p> 
 <pre class="has"><code class="language-cs">data_category.groupby('品类名').sum()['购买量'].sort_values(ascending=False).head
    (10).plot('bar')</code></pre> 
 <p>结果如图12-49所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/ce/aa/lqTjqLPx_o.png" alt="6596d4a4ea99ee4c6ffa36d5ef76bbd5.png"></p> 
 <p style="text-align:center;">图12-49　不同品类商品的购买量</p> 
 <p>从数据可知，75%的用户将产品加入购物车后便会伺机购买，但整体均值在54%左右，即用户加入购物车到实际产生购买行为有近50%的流失比率。因本数据集中在双十二前夕，价格战成为主流，故推测价格是用户产生实际购买行为的主导因素，提醒商家在店铺页做好其他价值指引（售后服务，会员服务）等价值吸引，避免用户流失，同时保证备货充足。</p> 
 <p><strong>9. 二八理论分析</strong></p> 
 <pre class="has"><code class="language-cs">data_category=data_category[data_category['购买量']&gt;0]
value_8=data_category['购买量'].sum()*0.8
value_10=data_category['购买量'].sum()
data_category=data_category.sort_values(by='购买量',ascending=False)
data_category['累计购买量']=data_category['购买量'].cumsum()
data_category['分类']=data_category['累计购买量'].map(lambda x:'前80%' if x&lt;=
    value_8 else '后20%')
data_category.describe()</code></pre> 
 <p>结果如图12-50所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/e9/1b/OVF4bZoI_o.png" alt="7e87f92e3495d8907f47bdf1921f7f1e.png"></p> 
 <p style="text-align:center;">图12-50　用户行为统计</p> 
 <pre class="has"><code class="language-javascript">data_category.groupby('分类')['分类'].count()/data_category['分类'].count()</code></pre> 
 <p>结果如图12-51所示。</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/2f/03/YqURfe9b_o.png" alt="529eaca25ddf4b7639d5cc55556e8cfe.png"></p> 
 <p style="text-align:center;">图12-51 销量与商品品类的关系<br></p> 
 <p>cumsum()用于求元素的累加和。根据分析结果可知，前80%销量有24.9%左右的商品品类承包，接近二八原则。同样也可以看出，有接近20%的销量由75.1%的商品品类提供。可以得出结论：用户对该平台消费已局限在某一品类。</p> 
 <p>根据以上的分析，相信你对消费者的行为已经有一定了解了，在后续的营销过程中，我们将针对已有产品，寻找所偏好的精准人群进行推广，同时根据客户的访问情况进行刺激，促进客户的消费行为，再考虑用户的消费数据，确定不同的客户群体的营销策略，最后实现精准营销啦！</p> 
 <p>本文摘编自《Python金融数据挖掘与分析实战》</p> 
 <h4>目录</h4> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/7e/4a/GlL40mHy_o.png" alt="03c6708df1ace1112cebe1e6b5c20952.png"></p> 
 <p style="text-align:center;">《Python金融数据挖掘与分析实战》</p> 
 <p style="text-align:center;">点击以下链接了解及购买</p> 
 <p style="text-align:center;">转载请联系微信：zj06220_0</p> 
 <p><strong>推荐语：</strong>云创大数据（上市公司）总裁撰写，零基础学会金融数据挖掘，配有案例、视频、代码、数据、习题及答案。</p> 
 <p><strong>关于作者： </strong><br><strong>刘鹏</strong>教授，清华大学博士，云计算、大数据和人工智能领域的知名专家，南京云创大数据科技股份有限公司总裁、中国大数据应用联盟人工智能专家委员会主任。 <br><strong>高中强 </strong>，人工智能与大数据领域技术专家，有非常深厚的积累，擅长机器学习和自然语言处理，尤其是深度学习，熟悉Tensorflow、PyTorch等深度学习开发框架。 <br><br></p> 
 <p><img src="https://images2.imgbox.com/0f/76/WslykH6r_o.gif" alt="a6852097f9c520f629ccff2a4e705e5d.gif"></p> 
 <p><a href="" rel="nofollow">更多精彩回顾</a></p> 
 <p style="text-align:center;">书讯 | <a href="" rel="nofollow">2月书讯（下）| 新年到，新书到！</a></p> 
 <p style="text-align:center;">书讯 | <a href="" rel="nofollow">2月书讯 （上）| 新年到，新书到！</a></p> 
 <p style="text-align:center;">资讯 | <a href="" rel="nofollow">重磅！达摩院发布2022十大科技趋势</a></p> 
 <p style="text-align:center;">书单 | <a href="" rel="nofollow">6本书，读懂2022年最火的边缘计算</a></p> 
 <p style="text-align:center;">干货 | <a href="" rel="nofollow">前端应用和产品逻辑的核心：交互流</a></p> 
 <p style="text-align:center;">收藏 | <a href="" rel="nofollow">Three.js 的 3D 粒子动画：群星送福</a></p> 
 <p style="text-align:center;">干货 |<a href="" rel="nofollow"> </a><a href="" rel="nofollow">你的自动化测试是有效的吗？</a></p> 
 <p><img src="https://images2.imgbox.com/90/d1/MDVlUOKX_o.gif" alt="7973c6ad55a401d699f22a7ff2b86bb7.gif"></p> 
 <p><img src="https://images2.imgbox.com/72/1f/psZ75ExT_o.gif" alt="a833821704524fd2cd6df3a8eacd87c1.gif"></p> 
 <p>点击<strong>阅读全文</strong>购买</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f10404a9adddc40a702c5a11bfc2265e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">flink看见就总结一下</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/38437ce90298bfe81fb7057192e49301/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">UE中渲染自发光通道的折衷方案</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>