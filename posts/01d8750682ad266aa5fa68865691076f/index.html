<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>opc java_Java实现OPC通信---utgard - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="opc java_Java实现OPC通信---utgard" />
<meta property="og:description" content="importjava.util.concurrent.Executors;importjava.util.concurrent.ScheduledExecutorService;importjava.util.concurrent.TimeUnit;importorg.jinterop.dcom.common.JIException;importorg.jinterop.dcom.core.JIVariant;importorg.openscada.opc.lib.common.ConnectionInformation;importorg.openscada.opc.lib.da.AccessBase;importorg.openscada.opc.lib.da.DataCallback;importorg.openscada.opc.lib.da.Group;importorg.openscada.opc.lib.da.Item;importorg.openscada.opc.lib.da.ItemState;importorg.openscada.opc.lib.da.Server;importorg.openscada.opc.lib.da.SyncAccess;public classUtgardTutorial2 {public static void main(String[] args) throwsException {//连接信息
final ConnectionInformation ci = newConnectionInformation();
ci.setHost(&#34;192.168.0.1&#34;); //电脑IP
ci.setDomain(&#34;&#34;); //域，为空就行
ci.setUser(&#34;OPCUser&#34;); //用户名，配置DCOM时配置的
ci.setPassword(&#34;123456&#34;); //密码//使用MatrikonOPC Server的配置//ci.setClsid(&#34;F8582CF2-88FB-11D0-B850-00C0F0104305&#34;);//MatrikonOPC的注册表ID，可以在“组件服务”里看到//final String itemId = &#34;u.u&#34;;//项的名字按实际//使用KEPServer的配置
ci.setClsid(&#34;7BC0CC8E-482C-47CA-ABDC-0FE7F9C6E729&#34;); //KEPServer的注册表ID，可以在“组件服务”里看到
final String itemId = &#34;u.u.u&#34;; //项的名字按实际，没有实际PLC，用的模拟器：simulator//final String itemId = &#34;通道 1.设备 1.标记 1&#34;;//create a new server，启动服务
final Server server = newServer(ci, Executors.newSingleThreadScheduledExecutor());try{//connect to server，连接到服务
server.connect();//add sync access, poll every 500 ms，启动一个同步的access用来读取地址上的值，线程池每500ms读值一次//这个是用来循环读值的，只读一次值不用这样
final AccessBase access = new SyncAccess(server, 500);//这是个回调函数，就是读到值后执行再执行下面的代码，是用匿名类写的，当然也可以写到外面去
access.addItem(itemId, newDataCallback() {" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/01d8750682ad266aa5fa68865691076f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-12T09:44:43+08:00" />
<meta property="article:modified_time" content="2021-02-12T09:44:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">opc java_Java实现OPC通信---utgard</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>importjava.util.concurrent.Executors;importjava.util.concurrent.ScheduledExecutorService;importjava.util.concurrent.TimeUnit;importorg.jinterop.dcom.common.JIException;importorg.jinterop.dcom.core.JIVariant;importorg.openscada.opc.lib.common.ConnectionInformation;importorg.openscada.opc.lib.da.AccessBase;importorg.openscada.opc.lib.da.DataCallback;importorg.openscada.opc.lib.da.Group;importorg.openscada.opc.lib.da.Item;importorg.openscada.opc.lib.da.ItemState;importorg.openscada.opc.lib.da.Server;importorg.openscada.opc.lib.da.SyncAccess;public classUtgardTutorial2 {public static void main(String[] args) throwsException {//连接信息</p> 
 <p>final ConnectionInformation ci = newConnectionInformation();</p> 
 <p>ci.setHost("192.168.0.1"); //电脑IP</p> 
 <p>ci.setDomain(""); //域，为空就行</p> 
 <p>ci.setUser("OPCUser"); //用户名，配置DCOM时配置的</p> 
 <p>ci.setPassword("123456"); //密码//使用MatrikonOPC Server的配置//ci.setClsid("F8582CF2-88FB-11D0-B850-00C0F0104305");//MatrikonOPC的注册表ID，可以在“组件服务”里看到//final String itemId = "u.u";//项的名字按实际//使用KEPServer的配置</p> 
 <p>ci.setClsid("7BC0CC8E-482C-47CA-ABDC-0FE7F9C6E729"); //KEPServer的注册表ID，可以在“组件服务”里看到</p> 
 <p>final String itemId = "u.u.u"; //项的名字按实际，没有实际PLC，用的模拟器：simulator//final String itemId = "通道 1.设备 1.标记 1";//create a new server，启动服务</p> 
 <p>final Server server = newServer(ci, Executors.newSingleThreadScheduledExecutor());try{//connect to server，连接到服务</p> 
 <p>server.connect();//add sync access, poll every 500 ms，启动一个同步的access用来读取地址上的值，线程池每500ms读值一次//这个是用来循环读值的，只读一次值不用这样</p> 
 <p>final AccessBase access = new SyncAccess(server, 500);//这是个回调函数，就是读到值后执行再执行下面的代码，是用匿名类写的，当然也可以写到外面去</p> 
 <p>access.addItem(itemId, newDataCallback() {<!-- --></p> 
 <p>@Overridepublic voidchanged(Item item, ItemState state) {//also dump value</p> 
 <p>try{if (state.getValue().getType() == JIVariant.VT_UI4) { //如果读到的值类型时UnsignedInteger，即无符号整形数值</p> 
 <p>System.out.println("&lt;&lt;&lt; " + state + " / value = " +state.getValue().getObjectAsUnsigned().getValue());</p> 
 <p>}else{<!-- --></p> 
 <p>System.out.println("&lt;&lt;&lt; " + state + " / value = " +state.getValue().getObject());</p> 
 <p>}</p> 
 <p>}catch(JIException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>});//Add a new group，添加一个组，这个用来就读值或者写值一次，而不是循环读取或者写入//组的名字随意，给组起名字是因为，server可以addGroup也可以removeGroup，读一次值，就先添加组，然后移除组，再读一次就再添加然后删除</p> 
 <p>final Group group = server.addGroup("test");//Add a new item to the group，//将一个item加入到组，item名字就是MatrikonOPC Server或者KEPServer上面建的项的名字比如：u.u.TAG1，PLC.S7-300.TAG1</p> 
 <p>final Item item =group.addItem(itemId);//start reading，开始循环读值</p> 
 <p>access.bind();//add a thread for writing a value every 3 seconds//写入一次就是item.write(value)，循环写入就起个线程一直执行item.write(value)</p> 
 <p>ScheduledExecutorService writeThread =Executors.newSingleThreadScheduledExecutor();</p> 
 <p>writeThread.scheduleWithFixedDelay(newRunnable() {<!-- --></p> 
 <p>@Overridepublic voidrun() {final JIVariant value = new JIVariant("24"); //写入24</p> 
 <p>try{<!-- --></p> 
 <p>System.out.println("&gt;&gt;&gt; " + "写入值： " + "24");</p> 
 <p>item.write(value);</p> 
 <p>}catch(JIException e) {<!-- --></p> 
 <p>e.printStackTrace();</p> 
 <p>}</p> 
 <p>}</p> 
 <p>},5, 3, TimeUnit.SECONDS); //启动后5秒第一次执行代码，以后每3秒执行一次代码//wait a little bit ，延时20秒</p> 
 <p>Thread.sleep(20 * 1000);</p> 
 <p>writeThread.shutdownNow();//关掉一直写入的线程//stop reading，停止循环读取数值</p> 
 <p>access.unbind();</p> 
 <p>}catch (finalJIException e) {<!-- --></p> 
 <p>System.out.println(String.format("%08X: %s", e.getErrorCode(), server.getErrorMessage(e.getErrorCode())));</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cb247342e1a1dbba71310610e8b1e783/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java考试系统_Java在线考试系统（含源码）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/774e7a932bcf581e01af15101c51cdf5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java system in_JAVA中的System.in</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>