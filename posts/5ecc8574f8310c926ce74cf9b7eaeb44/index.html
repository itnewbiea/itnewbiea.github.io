<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CentOS自己搭建时钟同步服务实操 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CentOS自己搭建时钟同步服务实操" />
<meta property="og:description" content="目录
1、产生背景
2、操作过程
3、客户端操作
4、ntpd和ntpdate的区别
5、参考文章
1、产生背景 因为公司业务，需要使用一些网关设备上报监测实时数据，为了保障数据时钟一致性，所以需要提供一天时钟校验服务器。因为原来这个厂家的网关设备以前使用过其他时钟同步服务。但是最近发现设备掉线率很高，于是经过研究需要我们这边提供时钟同步服务器。
2、操作过程 2.1、准备一台授时服务器
检查是否安装ntp [root@lh-mqtt ~]# rpm -q ntp ntp-4.2.6p5-28.el7.centos.x86_64 如果没有则执行安装操作如下命令
安装ntp服务 yum -y install ntp 修改配置文件
vi /etc/ntp.conf 修改如下：
driftfile /var/lib/ntp/drift restrict default nomodify restrict 127.0.0.1 restrict ::1 # 配置允许连接服务端的网段 restrict 10.10.20.* mask 255.255.255.0 nomodify notrap # 配置时间服务器 server ntp.neu.edu.cn iburst server ntp.aliyun.com iburst server ntp.ntsc.ac.cn iburst # 配置在无法连接到时间服务器时将本地时间同步到客户端 server 127.127.1.0 fudge 127.127.1.0 stratum 10 includefile /etc/ntp/crypto/pw keys /etc/ntp/keys disable monitor 启动ntp服务并配置开机自启" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5ecc8574f8310c926ce74cf9b7eaeb44/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-17T11:20:25+08:00" />
<meta property="article:modified_time" content="2023-08-17T11:20:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CentOS自己搭建时钟同步服务实操</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1%E3%80%81%E4%BA%A7%E7%94%9F%E8%83%8C%E6%99%AF-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E4%BA%A7%E7%94%9F%E8%83%8C%E6%99%AF" rel="nofollow">1、产生背景</a></p> 
<p id="2%E3%80%81%E6%93%8D%E4%BD%9C%E8%BF%87%E7%A8%8B-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E6%93%8D%E4%BD%9C%E8%BF%87%E7%A8%8B" rel="nofollow">2、操作过程</a></p> 
<p id="3%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9C-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9C" rel="nofollow">3、客户端操作</a></p> 
<p id="4%E3%80%81ntpd%E5%92%8Cntpdate%E7%9A%84%E5%8C%BA%E5%88%AB-toc" style="margin-left:40px;"><a href="#4%E3%80%81ntpd%E5%92%8Cntpdate%E7%9A%84%E5%8C%BA%E5%88%AB" rel="nofollow">4、ntpd和ntpdate的区别</a></p> 
<p id="5%E3%80%81%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0-toc" style="margin-left:40px;"><a href="#5%E3%80%81%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0" rel="nofollow">5、参考文章</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="1%E3%80%81%E4%BA%A7%E7%94%9F%E8%83%8C%E6%99%AF">1、产生背景</h3> 
<p>        因为公司业务，需要使用一些网关设备上报监测实时数据，为了保障数据时钟一致性，所以需要提供一天时钟校验服务器。因为原来这个厂家的网关设备以前使用过其他时钟同步服务。但是最近发现设备掉线率很高，于是经过研究需要我们这边提供时钟同步服务器。</p> 
<h3 id="2%E3%80%81%E6%93%8D%E4%BD%9C%E8%BF%87%E7%A8%8B">2、操作过程</h3> 
<p>2.1、准备一台授时服务器</p> 
<p><strong>检查是否安装ntp</strong>        </p> 
<pre><code class="language-bash">[root@lh-mqtt ~]# rpm -q ntp
ntp-4.2.6p5-28.el7.centos.x86_64
</code></pre> 
<p>如果没有则执行安装操作如下命令</p> 
<pre><code class="language-bash">安装ntp服务

yum -y install ntp</code></pre> 
<p>修改配置文件</p> 
<pre><code class="language-bash">vi /etc/ntp.conf</code></pre> 
<p>修改如下：</p> 
<pre><code class="language-bash">driftfile /var/lib/ntp/drift

restrict default nomodify

restrict 127.0.0.1
restrict ::1
# 配置允许连接服务端的网段
restrict 10.10.20.* mask 255.255.255.0 nomodify notrap
# 配置时间服务器
server ntp.neu.edu.cn iburst
server ntp.aliyun.com iburst
server ntp.ntsc.ac.cn iburst


# 配置在无法连接到时间服务器时将本地时间同步到客户端
server 127.127.1.0
fudge 127.127.1.0 stratum 10

includefile /etc/ntp/crypto/pw
keys /etc/ntp/keys
disable monitor</code></pre> 
<p>启动ntp服务并配置开机自启</p> 
<pre><code class="language-bash">systemctl start ntpd
systemctl enable ntpd</code></pre> 
<p>查看状态，前面带*号表示当前连接的时间服务器</p> 
<pre><code class="language-bash">ntpq -p

[root@lh-mqtt ~]# ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
*ntp2.neu.edu.cn .BDS.            1 u  424 1024  351   78.285  -23.443  16.037
+203.107.6.*    100.107.25.114   2 u  902 1024  377   15.739    3.737  79.777
 114.118.7.*   123.139.33.3     2 u 134m 1024  200   68.171    4.728  18.907
 LOCAL(0)        .LOCL.          10 l  15d   64    0    0.000    0.000   0.000</code></pre> 
<pre>remote： *表示目前使用的ntp server；+表示备用服务器</pre> 
<p>　　st：即stratum阶层，值越小表示ntp serve的精准度越高；<br> 　　when：几秒前曾做过时间同步更新的操作；<br> 　　Poll表示，每隔多少毫秒与ntp server同步一次；<br> 　　reach：已经向上层NTP服务器要求更新的次数；<br> 　　delay：网络传输过程钟延迟的时间；<br> 　　offset：时间补偿的结果；<br> 　　jitter：Linux系统时间与BIOS硬件时间的差异时间</p> 
<p><strong>设置NTP开机自动启动</strong></p> 
<pre><code class="language-bash">chkconfig ntpd on</code></pre> 
<p><strong>查看NTP是否正常运行</strong></p> 
<pre><code class="language-bash">netstat -tlunp | grep ntp</code></pre> 
<p><strong>手工同步一次时间</strong></p> 
<pre><code class="language-bash">/usr/sbin/ntpdate ip地址</code></pre> 
<p><strong>查看时间同步结果</strong></p> 
<pre><code class="language-bash">root@lh-mqtt ~]# ntpstat
synchronised to NTP server (202.118.1.47) at stratum 2 
   time correct to within 113 ms
   polling server every 1024 s</code></pre> 
<h3 id="3%E3%80%81%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%93%8D%E4%BD%9C">3、<strong>客户端操作</strong></h3> 
<p>  <strong>安装ntp服务，同服务端</strong></p> 
<p>  修改配置文件</p> 
<pre><code class="language-bash">driftfile /var/lib/ntp/drift

restrict default nomodify notrap nopeer noquery

restrict 127.0.0.1 
restrict ::1# 配置服务端地址
server 10.10.20.5 iburst

includefile /etc/ntp/crypto/pw
keys /etc/ntp/keys
disable monitor</code></pre> 
<p><strong>启动ntp服务并配置开机自启</strong></p> 
<pre><code class="language-bash">systemctl start ntpd
systemctl enable ntpd</code></pre> 
<p><strong>查看状态 ntpq -p</strong></p> 
<pre><code class="language-bash">ntpq -p</code></pre> 
<h3 id="4%E3%80%81ntpd%E5%92%8Cntpdate%E7%9A%84%E5%8C%BA%E5%88%AB">4、<strong>ntpd和ntpdate的区别</strong></h3> 
<p>ntpd在实际同步时间时是一点点的校准过来时间的，最终把时间慢慢的校正对。而ntpdate不会考虑其他程序是否会阵痛，直接调整时间。</p> 
<h3 id="5%E3%80%81%E5%8F%82%E8%80%83%E6%96%87%E7%AB%A0">5、参考文章</h3> 
<p><a class="link-info" href="https://www.cnblogs.com/whjblog/p/16918576.html" rel="nofollow" title="ntp同步Linux服务器时间">ntp同步Linux服务器时间</a></p> 
<p><a class="link-info" href="https://www.cnblogs.com/kewenpu/p/16836147.html" rel="nofollow" title="Linux配置NTP时间同步">Linux配置NTP时间同步</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1e258ecbe994309d48b2079120e325ee/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何用思维导图&#43;Markdown提升工作效率？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c8e61734c21759c3e6fe829f9dab3c6d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于FPGA的DHT11数字温湿度传感器测试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>