<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Oracle 数据库kernel.shmmax 及kernel.sem设置 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Oracle 数据库kernel.shmmax 及kernel.sem设置" />
<meta property="og:description" content="最近因为拿到一个好配置的生产机器。在装完数据库后，需要对参数进行调优。 首先这个机器内存是128G的 ，而且/dev/shm 设置的是63G （物理内存的一半）。Oracle设置用的是AMM管理，那么就想是否能把这个内存设置大点。
首先这个参数文件在 vi /etc/sysctl.conf 里，重新加载生效是 sysctl -p
# System default settings live in /usr/lib/sysctl.d/00-system.conf. # To override those settings, enter new settings here, or in an /etc/sysctl.d/&lt;name&gt;.conf file # # For more information, see sysctl.conf(5) and sysctl.d(5). #ORACLE SETTING fs.aio-max-nr = 1048576 fs.file-max = 6815744 kernel.shmall = 15728640 kernel.shmmax = 64424509440 kernel.shmmni = 4096 kernel.sem = 5010 641280 5010 128 net.ipv4.ip_local_port_range = 9000 65500 net.core.rmem_default = 262144 net." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0963c8731cdaa6524d36a32fa9fa643c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2016-12-06T14:56:06+08:00" />
<meta property="article:modified_time" content="2016-12-06T14:56:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Oracle 数据库kernel.shmmax 及kernel.sem设置</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近因为拿到一个好配置的生产机器。在装完数据库后，需要对参数进行调优。 <br> 首先这个机器内存是128G的 ，而且/dev/shm 设置的是63G （物理内存的一半）。Oracle设置用的是AMM管理，那么就想是否能把这个内存设置大点。</p> 
<p>首先这个参数文件在 vi /etc/sysctl.conf 里，重新加载生效是 sysctl -p</p> 
<pre class="prettyprint"><code class=" hljs avrasm"><span class="hljs-preprocessor"># System default settings live in /usr/lib/sysctl.d/00-system.conf.</span>
<span class="hljs-preprocessor"># To override those settings, enter new settings here, or in an /etc/sysctl.d/&lt;name&gt;.conf file</span>
<span class="hljs-preprocessor">#</span>
<span class="hljs-preprocessor"># For more information, see sysctl.conf(5) and sysctl.d(5).</span>

<span class="hljs-preprocessor">#ORACLE SETTING</span>
fs<span class="hljs-preprocessor">.aio</span>-max-nr = <span class="hljs-number">1048576</span>
fs<span class="hljs-preprocessor">.file</span>-max = <span class="hljs-number">6815744</span>
kernel<span class="hljs-preprocessor">.shmall</span> = <span class="hljs-number">15728640</span>
kernel<span class="hljs-preprocessor">.shmmax</span> = <span class="hljs-number">64424509440</span>
kernel<span class="hljs-preprocessor">.shmmni</span> = <span class="hljs-number">4096</span>
kernel<span class="hljs-preprocessor">.sem</span> = <span class="hljs-number">5010</span> <span class="hljs-number">641280</span> <span class="hljs-number">5010</span> <span class="hljs-number">128</span>
net<span class="hljs-preprocessor">.ipv</span>4<span class="hljs-preprocessor">.ip</span>_local_port_range = <span class="hljs-number">9000</span> <span class="hljs-number">65500</span>
net<span class="hljs-preprocessor">.core</span><span class="hljs-preprocessor">.rmem</span>_default = <span class="hljs-number">262144</span>
net<span class="hljs-preprocessor">.core</span><span class="hljs-preprocessor">.rmem</span>_max = <span class="hljs-number">4194304</span>
net<span class="hljs-preprocessor">.core</span><span class="hljs-preprocessor">.wmem</span>_default = <span class="hljs-number">262144</span>
net<span class="hljs-preprocessor">.core</span><span class="hljs-preprocessor">.wmem</span>_max = <span class="hljs-number">1048586</span></code></pre> 
<p><strong>kernel.shmall:</strong> 共享内存页数的最大值 <br> Linux共享内存页大小为4KB， 共享内存段的大小都是共享内存页大小的整数倍。一个共享内存段的最大大小是16G，需要共享内存页数是 <br> 16GB/4KB=16777216KB/4KB=4194304(页)</p> 
<p><strong>kernel.shmmax:</strong>单个共享内存段的最大值 <br> shmmax是核心参数中最重要的参数之一，用于定义单个共享内存段的最大值，shmmax设置应足够大，能在一个共享内存段下容纳下整个的SGA，设置的过低可能会导致需要创建多个共享内存段，可能导致系统性能的下降 。</p> 
<p><strong>kernel.shmmni:</strong>共享内存段的最大数量 <br> 注意该参数不是shmmin，是shmmni，shmmin 表示内存段最小大小 ） <br> shmmni缺省值4096 足够。 <br> shmmax(bytes) = shmmni(page size, default 4k) * shmall (page的个数）</p> 
<p>下面专门说说<strong>kernel.sem</strong>：对应4个值 <br> SEMMSL、SEMMNS、SEMOPM、SEMMNI</p> 
<p><strong>SEMMSL:</strong> 每个信号集的最大信号数量 <br> 数据库最大 PROCESS 实例参数的设置值再加上 10 。 <br> Oracle 建议将 SEMMSL 的值设置为不少于 100 。 <br> <strong>SEMMNS：</strong>用于控制整个 Linux 系统中信号（而不是信号集）的最大数。 <br> Oracle 建议将 SEMMNS 设置为：系统中每个数据库的 PROCESSES 实例参数设置值的总和，加上最大 PROCESSES 值的两倍，最后根据系统中 Oracle 数据库的数量，每个加 10 。 <br> 使用以下计算式来确定在 Linux 系统中可以分配的信号的最大数量。它将是以下两者中较小的一个值：SEMMNS 或 (SEMMSL * SEMMNI)</p> 
<p><strong>SEMOPM：</strong> 内核参数用于控制每个 semop 系统调用可以执行的信号操作的数量。semop 系统调用（函数）提供了利用一个 semop 系统调用完成多项信号操作的功能。一个信号集能够拥有每个信号集中最大数量的SEMMSL 信号，因此建议设置 SEMOPM 等于SEMMSL 。 <br> Oracle 建议将 SEMOPM 的值设置为不少于 100 。 <br> <strong>SEMMNI ：</strong>内核参数用于控制整个 Linux 系统中信号集的最大数量。 <br> Oracle 建议将 SEMMNI 的值设置为不少于 100 。 </p> 
<p>设计完这些之后可以 sysctl -p 生效，剩下可以配置AMM.</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0971bdfa1c0394e9ae155d718811dfb1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ListView  中Item  位置获取</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/72ae0fe54343166244467dccb503d4f5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">gdb &#43; openocd 调试嵌入式软件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>