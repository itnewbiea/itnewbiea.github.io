<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python net use_在循环中使用“net use”命令 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python net use_在循环中使用“net use”命令" />
<meta property="og:description" content="我正在编写一个简单的python脚本，它连接到几个远程Windows机器，读取这些机器上远程文件夹的内容，然后压缩并复制在给定日期之后修改过的所有文件。在
问题是，当它连接到第一台计算机后，它没有连接到第二台计算机，“netuse”命令不起作用。
如果我通过计算机的windows命令行手动执行此操作，它确实可以工作，但不能通过python脚本。在
我没有找到任何可以帮助我的话题，我现在有点困了。。。你们知道我会做错什么吗？在
下面是我的代码(如果看起来不太整洁，我很抱歉，我是从python开始的)。在import os, subprocess, datetime, shutil
# the local destination of log files on my computer
ROOT_folder = &#39;C:\\Logs&#39;
for i, IP in enumerate(list_of_IPs):
# list of names corresponding to the IPs
location = list_of_locs[i]
# create a local repository in my ROT folder for storing the logs of this remote station
try:
os.chdir(ROOT_folder &#43; &#39;\\&#39; &#43; location)
except:
os.mkdir(ROOT_folder &#43; &#39;\\&#39; &#43; location)
# The path to the logs that are stored on the remote windows machines" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/56f6e83ff0a328fc10da51c824f164b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-12-11T06:04:46+08:00" />
<meta property="article:modified_time" content="2020-12-11T06:04:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python net use_在循环中使用“net use”命令</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>我正在编写一个简单的python脚本，它连接到几个远程Windows机器，读取这些机器上远程文件夹的内容，然后压缩并复制在给定日期之后修改过的所有文件。在</p> 
 <p>问题是，当它连接到第一台计算机后，它没有连接到第二台计算机，“netuse”命令不起作用。</p> 
 <p>如果我通过计算机的windows命令行手动执行此操作，它确实可以工作，但不能通过python脚本。在</p> 
 <p>我没有找到任何可以帮助我的话题，我现在有点困了。。。你们知道我会做错什么吗？在</p> 
 <p>下面是我的代码(如果看起来不太整洁，我很抱歉，我是从python开始的)。在import os, subprocess, datetime, shutil</p> 
 <p># the local destination of log files on my computer</p> 
 <p>ROOT_folder = 'C:\\Logs'</p> 
 <p>for i, IP in enumerate(list_of_IPs):</p> 
 <p># list of names corresponding to the IPs</p> 
 <p>location = list_of_locs[i]</p> 
 <p># create a local repository in my ROT folder for storing the logs of this remote station</p> 
 <p>try:</p> 
 <p>os.chdir(ROOT_folder + '\\' + location)</p> 
 <p>except:</p> 
 <p>os.mkdir(ROOT_folder + '\\' + location)</p> 
 <p># The path to the logs that are stored on the remote windows machines</p> 
 <p>remote_path_to_logs = '_Temporary\\Logs'</p> 
 <p>print location</p> 
 <p># Mapping a drive m: &gt;&gt;&gt; Here I get the error at the 2nd iteration</p> 
 <p>subprocess.call(r'net use m: \\' + IP + '\c$ Password /user:Username', shell=True)</p> 
 <p># The modification date of the most recent file I donwloaded is stored on my local computer in a txt file - here I read the date</p> 
 <p>try:</p> 
 <p>with open(ROOT_folder + '\\' + location + '\\last_mod.txt','r') as myFile:</p> 
 <p>last_file_downloaded = datetime.datetime.strptime(myFile.read(),'%Y-%m-%d %H:%M:%S')</p> 
 <p>except:</p> 
 <p>last_file_downloaded = datetime.datetime(1970,1,1)</p> 
 <p>os.chdir('M:\\' + remote_path_to_logs)</p> 
 <p># I sort the list of files from oldest to newest</p> 
 <p>list_files = os.listdir('M:\\' + remote_path_to_logs)</p> 
 <p>list_sorted = sorted([(fl, os.path.getmtime(fl)) for fl in list_files],key=lambda x: x[1])</p> 
 <p>for log, logtime in list_sorted:</p> 
 <p>date_file = datetime.datetime(1970,1,1) + datetime.timedelta(seconds=logtime)</p> 
 <p># I zip and move the file to my computer if it was modified after the date I stored on my computer</p> 
 <p>if date_file &gt; last_file_downloaded :</p> 
 <p>print log + ': zipping and moving to local directory... '</p> 
 <p>with zipfile.ZipFile(date_file.strftime('%Y-%m-%d_%H-%M-%S') + '.zip','w', zipfile.ZIP_DEFLATED) as z:</p> 
 <p>z.write(log)</p> 
 <p>shutil.move(date_file.strftime('%Y-%m-%d_%H-%M-%S') + '.zip',ROOT_folder + '\\' + location)</p> 
 <p># I overwrite the modification date in my file</p> 
 <p>with open(ROOT_folder + '\\' + location + '\\last_mod.txt','w') as myFile:</p> 
 <p>myFile.write(date_file.strftime('%Y-%m-%d %H:%M:%S'))</p> 
 <p># Disconnecting the drive m:</p> 
 <p>subprocess.call('net use m: /delete /yes', shell=True)</p> 
 <p># I tried to put a time.sleep(5) here but it does not help</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/74be6c3474df089f08a7b3d5cef676e2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">华为手机丢失定位网站_EMUI这个功能可以帮你找回丢失的手机</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/16c69250cdc1eb3ce216a2569d18f579/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">resize2fs: Bad magic number in super-block while trying to open /dev/mapper/centos-root</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>