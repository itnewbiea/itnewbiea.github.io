<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android开发技巧——使用Dialog实现仿QQ的ActionSheet菜单 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android开发技巧——使用Dialog实现仿QQ的ActionSheet菜单" />
<meta property="og:description" content="最近看到有人用Dialog来实现QQ的仿ActionSheet的自定义菜单，对于自己没实现过的一些控件，看着也想实现一下。于是动手了一下，发现也不难，和大家分享一下。
本文原创，转载请注明出处：http://blog.csdn.net/maosidiaoxian/article/details/46119197
在这里我也是用Dialog来实现，代码不多，这里说一下实现的过程。
菜单的布局文件 首先我们写先一下菜单的布局文件，很简单，一个ListView菜单再加一个取消的Button。
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;LinearLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;match_parent&#34; android:orientation=&#34;vertical&#34;&gt; &lt;ListView android:id=&#34;@&#43;id/menu_items&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;wrap_content&#34; android:listSelector=&#34;@android:color/transparent&#34;/&gt; &lt;Button android:id=&#34;@&#43;id/menu_cancel&#34; android:layout_width=&#34;match_parent&#34; android:layout_height=&#34;45dp&#34; android:layout_marginBottom=&#34;8dp&#34; android:layout_marginTop=&#34;8dp&#34; android:text=&#34;取消&#34;/&gt; &lt;/LinearLayout&gt; 在这里我们先是写一下最基本的布局文件，因为我急着想知道实现上的可行性，所以背景那些暂未修改。
继承Dialog实现自己的菜单 我们的对话框有几个特点，一是弹出的位置在底部，二是没有对话框的那些windowFrame层也没有标题和contentOverlay层，并且背景透明。 所以我们要先写一个Dialog的Style，继承自系统主题:
&lt;style name=&#34;ActionSheetDialog&#34; parent=&#34;android:Theme.Dialog&#34;&gt; &lt;item name=&#34;android:windowContentOverlay&#34;&gt;@null&lt;/item&gt; &lt;item name=&#34;android:windowFrame&#34;&gt;@null&lt;/item&gt; &lt;item name=&#34;android:windowBackground&#34;&gt;@android:color/transparent&lt;/item&gt; &lt;item name=&#34;android:windowNoTitle&#34;&gt;true&lt;/item&gt; &lt;/style&gt; 接下来我们需要写一个类继承Dialog，来实现自己的弹出菜单。在构造方法中调用super(Context context, int theme)方法。并且我们尝试设置gravity，来使它显示在底部。
public class ActionSheet extends Dialog { private Button mCancel; private ListView mMenuItems; private ArrayAdapter&lt;String&gt; mAdapter; public ActionSheet(Context context) { super(context, R.style.ActionSheetDialog); getWindow().setGravity(Gravity.BOTTOM); initView(context); } private void initView(Context context) { View rootView = View." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f43b200192f0c9ea3967dde3b0e1b398/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-05-28T10:40:00+08:00" />
<meta property="article:modified_time" content="2015-05-28T10:40:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android开发技巧——使用Dialog实现仿QQ的ActionSheet菜单</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="content-detail markdown-body"> 
 <div class="markdown_views"> 
  <p>最近看到有人用Dialog来实现QQ的仿ActionSheet的自定义菜单，对于自己没实现过的一些控件，看着也想实现一下。于是动手了一下，发现也不难，和大家分享一下。</p> 
  <p>本文原创，转载请注明出处：<a href="http://blog.csdn.net/maosidiaoxian/article/details/46119197">http://blog.csdn.net/maosidiaoxian/article/details/46119197</a></p> 
  <p>在这里我也是用Dialog来实现，代码不多，这里说一下实现的过程。</p> 
  <h2>菜单的布局文件</h2> 
  <p>首先我们写先一下菜单的布局文件，很简单，一个ListView菜单再加一个取消的Button。</p> 
  <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">LinearLayout</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
              <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"match_parent"</span>
              <span class="hljs-attribute">android:orientation</span>=<span class="hljs-value">"vertical"</span>&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">ListView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/menu_items"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:listSelector</span>=<span class="hljs-value">"@android:color/transparent"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/menu_cancel"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"45dp"</span>
        <span class="hljs-attribute">android:layout_marginBottom</span>=<span class="hljs-value">"8dp"</span>
        <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"8dp"</span>
        <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"取消"</span>/&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">LinearLayout</span>&gt;</span></code></pre> 
  <p>在这里我们先是写一下最基本的布局文件，因为我急着想知道实现上的可行性，所以背景那些暂未修改。</p> 
  <h2>继承Dialog实现自己的菜单</h2> 
  <p>我们的对话框有几个特点，一是弹出的位置在底部，二是没有对话框的那些windowFrame层也没有标题和contentOverlay层，并且背景透明。 <br> 所以我们要先写一个Dialog的Style，继承自系统主题:</p> 
  <pre class="prettyprint"><code class="language-xml hljs">    <span class="hljs-tag">&lt;<span class="hljs-title">style</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"ActionSheetDialog"</span> <span class="hljs-attribute">parent</span>=<span class="hljs-value">"android:Theme.Dialog"</span>&gt;</span><span class="css">
        &lt;<span class="hljs-tag">item</span> <span class="hljs-tag">name</span>="<span class="hljs-tag">android</span><span class="hljs-pseudo">:windowContentOverlay"</span>&gt;<span class="hljs-at_rule">@<span class="hljs-keyword">null&lt;/item&gt;</span>
        &lt;item name=<span class="hljs-string">"android:windowFrame"</span>&gt;@null&lt;/item&gt;
        &lt;item name=<span class="hljs-string">"android:windowBackground"</span>&gt;@android:color/transparent&lt;/item&gt;
        &lt;item name=<span class="hljs-string">"android:windowNoTitle"</span>&gt;true&lt;/item&gt;
    </span></span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span></code></pre> 
  <p>接下来我们需要写一个类继承Dialog，来实现自己的弹出菜单。在构造方法中调用<code>super(Context context, int theme)</code>方法。并且我们尝试设置gravity，来使它显示在底部。</p> 
  <pre class="prettyprint"><code class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">ActionSheet</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">Dialog</span> {<!-- --></span>
    <span class="hljs-keyword">private</span> Button mCancel;
    <span class="hljs-keyword">private</span> ListView mMenuItems;
    <span class="hljs-keyword">private</span> ArrayAdapter&lt;String&gt; mAdapter;

    <span class="hljs-keyword">public</span> <span class="hljs-title">ActionSheet</span>(Context context) {
        <span class="hljs-keyword">super</span>(context, R.style.ActionSheetDialog);
        getWindow().setGravity(Gravity.BOTTOM);
        initView(context);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initView</span>(Context context) {
        View rootView = View.inflate(context, R.layout.dialog_action_sheet, <span class="hljs-keyword">null</span>);
        mCancel = (Button) rootView.findViewById(R.id.menu_cancel);
        mMenuItems = (ListView) rootView.findViewById(R.id.menu_items);
        mAdapter = <span class="hljs-keyword">new</span> ArrayAdapter&lt;String&gt;(context, android.R.layout.simple_list_item_1);
        mMenuItems.setAdapter(mAdapter);
        <span class="hljs-keyword">this</span>.setContentView(rootView);
    }

    <span class="hljs-keyword">public</span> ActionSheet <span class="hljs-title">addMenuItem</span>(String items) {
        mAdapter.add(items);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">toggle</span>() {
        <span class="hljs-keyword">if</span> (isShowing()) {
            dismiss();
        } <span class="hljs-keyword">else</span> {
            show();
        }
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">show</span>() {
        mAdapter.notifyDataSetChanged();
        <span class="hljs-keyword">super</span>.show();
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onKeyDown</span>(<span class="hljs-keyword">int</span> keyCode, KeyEvent event) {
        <span class="hljs-keyword">if</span> (keyCode == KeyEvent.KEYCODE_MENU) {
            dismiss();
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onKeyDown(keyCode, event);
    }
}</code></pre> 
  <p>在该类当中，我们需要拦截MENU键，处理按下MENU时菜单消失。</p> 
  <h2>写一个Activity来验证可行性</h2> 
  <p>然后写我们的Activity，来显示我们的Dialog，看是否如我们所想。</p> 
  <pre class="prettyprint"><code class="language-java hljs"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">ActionBarActivity</span> {<!-- --></span>
    <span class="hljs-keyword">private</span> ActionSheet mActionSheet;

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCreate</span>(Bundle savedInstanceState) {
        <span class="hljs-keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);
    }

    <span class="hljs-javadoc">/**
     * 创建MENU
     */</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onCreateOptionsMenu</span>(Menu menu) {
        menu.add(<span class="hljs-string">"menu"</span>).setVisible(<span class="hljs-keyword">false</span>);<span class="hljs-comment">// 必须创建一项,设为false之后ActionBar上不会出现菜单按钮。</span>
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.onCreateOptionsMenu(menu);
    }

    <span class="hljs-javadoc">/**
     * 拦截MENU事件，显示自己的菜单
     */</span>
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onMenuOpened</span>(<span class="hljs-keyword">int</span> featureId, Menu menu) {
        <span class="hljs-keyword">if</span> (mActionSheet == <span class="hljs-keyword">null</span>) {
            mActionSheet = <span class="hljs-keyword">new</span> ActionSheet(<span class="hljs-keyword">this</span>);
            mActionSheet.addMenuItem(<span class="hljs-string">"Test1"</span>).addMenuItem(<span class="hljs-string">"Test2"</span>);
        }
        mActionSheet.show();
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;
    }

}</code></pre> 
  <p>需要注意的是，要显示我们自己的菜单，只重写Activity的<code>onKeyDown</code>在那里显示是实现不了的。需要继承自<code>onCreateOptionsMenu</code>方法并添加一项菜单，然后才可以在<code>onMenuOpened</code>当中显示。 <br> 网上传的方法是说在<code>onCreateOptionsMenu</code>添加一项，然后在<code>onMenuOpened</code>中弹出我们的菜单并返回<code>true</code>。但是这样写有一个问题，就是在ActionBar的右边还是会有一个菜单键。在各种尝试中，我发现了一个很简单的解决此问题的方法。就是在<code>onCreateOptionsMenu</code>中添加了一项菜单之后，设为不可见。接下来在<code>onMenuOpened</code>弹出菜单之后，返回true和false都可以，都不会显示系统原来的菜单了。</p> 
  <h2>修改我们的菜单</h2> 
  <p>上面的代码跑起来，主要的效果确实如我们所想，所以接下来我们就需要对菜单的外观进行大的修改，来让它更像是QQ的菜单。</p> 
  <h3>背景</h3> 
  <p>首先，是菜单背景。菜单的背景共有四种，分别是在四个角中，仅上面圆角，仅下面圆角，都为圆角，都不为圆角。其次，背景都是半透明的。所以我们先在colors.xml中定义背景的颜色，包括正常状态时的颜色及按下去状态的颜色。</p> 
  <pre class="prettyprint"><code class="language-xml hljs">    <span class="hljs-tag">&lt;<span class="hljs-title">color</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"menu_item_normal"</span>&gt;</span>#c9ffffff<span class="hljs-tag">&lt;/<span class="hljs-title">color</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">color</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"menu_item_pressed"</span>&gt;</span>#d5dadada<span class="hljs-tag">&lt;/<span class="hljs-title">color</span>&gt;</span></code></pre> 
  <p>接着在drawable里编写这四个背景的selector。 <br> menu_iten_top.xml，仅上面是圆角的背景。</p> 
  <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">selector</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">android:state_pressed</span>=<span class="hljs-value">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">shape</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">corners</span> <span class="hljs-attribute">android:topLeftRadius</span>=<span class="hljs-value">"@dimen/list_corner"</span>
                     <span class="hljs-attribute">android:topRightRadius</span>=<span class="hljs-value">"@dimen/list_corner"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">solid</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/menu_item_pressed"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">shape</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">shape</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">corners</span> <span class="hljs-attribute">android:topLeftRadius</span>=<span class="hljs-value">"@dimen/list_corner"</span>
                     <span class="hljs-attribute">android:topRightRadius</span>=<span class="hljs-value">"@dimen/list_corner"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">solid</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/menu_item_normal"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">shape</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">selector</span>&gt;</span></code></pre> 
  <p>menu_item_middle.xml，都不为圆角：</p> 
  <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">selector</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">android:state_pressed</span>=<span class="hljs-value">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">shape</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">solid</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/menu_item_pressed"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">shape</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">shape</span> &gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">solid</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/menu_item_normal"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">shape</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">selector</span>&gt;</span></code></pre> 
  <p>menu_item_bottom.xml，仅下面是圆角：</p> 
  <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">selector</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">android:state_pressed</span>=<span class="hljs-value">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">shape</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">corners</span> <span class="hljs-attribute">android:bottomLeftRadius</span>=<span class="hljs-value">"@dimen/list_corner"</span>
                     <span class="hljs-attribute">android:bottomRightRadius</span>=<span class="hljs-value">"@dimen/list_corner"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">solid</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/menu_item_pressed"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">shape</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">shape</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">corners</span> <span class="hljs-attribute">android:bottomLeftRadius</span>=<span class="hljs-value">"@dimen/list_corner"</span>
                     <span class="hljs-attribute">android:bottomRightRadius</span>=<span class="hljs-value">"@dimen/list_corner"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">solid</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/menu_item_normal"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">shape</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">selector</span>&gt;</span></code></pre> 
  <p>menu_item_single.xml，均为圆角：</p> 
  <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">selector</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span> <span class="hljs-attribute">android:state_pressed</span>=<span class="hljs-value">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">shape</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">corners</span> <span class="hljs-attribute">android:radius</span>=<span class="hljs-value">"@dimen/list_corner"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">solid</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/menu_item_pressed"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">shape</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">item</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">shape</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">corners</span> <span class="hljs-attribute">android:radius</span>=<span class="hljs-value">"@dimen/list_corner"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">solid</span> <span class="hljs-attribute">android:color</span>=<span class="hljs-value">"@color/menu_item_normal"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">shape</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">item</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">selector</span>&gt;</span></code></pre> 
  <p>其中取消按扭使用的是均为圆角的背景，所以回到菜单的布局文件中，对其修改。并且把ListView的listSelector设为透明，添加分割线，改完如下：</p> 
  <pre class="prettyprint"><code class="language-xml hljs">  <span class="hljs-tag">&lt;<span class="hljs-title">ListView
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/menu_items"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
        <span class="hljs-attribute">android:divider</span>=<span class="hljs-value">"#c9dddddd"</span>
        <span class="hljs-attribute">android:dividerHeight</span>=<span class="hljs-value">"1px"</span>
        <span class="hljs-attribute">android:listSelector</span>=<span class="hljs-value">"@android:color/transparent"</span>/&gt;</span>

    <span class="hljs-tag">&lt;<span class="hljs-title">Button
</span>        <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@+id/menu_cancel"</span>
        <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
        <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"45dp"</span>
        <span class="hljs-attribute">android:layout_marginBottom</span>=<span class="hljs-value">"8dp"</span>
        <span class="hljs-attribute">android:layout_marginTop</span>=<span class="hljs-value">"8dp"</span>
        <span class="hljs-attribute">android:background</span>=<span class="hljs-value">"@drawable/menu_item_single"</span>
        <span class="hljs-attribute">android:text</span>=<span class="hljs-value">"取消"</span>
        <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@color/menu_text"</span>/&gt;</span></code></pre> 
  <p>接着修改ListView的每一项的背景，我们需要重写我们的Adapter，设置背景。在此之前，先定ListView的item的布局文件： <br> menu_item.xml</p> 
  <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">TextView</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
          <span class="hljs-attribute">android:id</span>=<span class="hljs-value">"@android:id/text1"</span>
          <span class="hljs-attribute">android:layout_width</span>=<span class="hljs-value">"match_parent"</span>
          <span class="hljs-attribute">android:layout_height</span>=<span class="hljs-value">"wrap_content"</span>
          <span class="hljs-attribute">android:textSize</span>=<span class="hljs-value">"18sp"</span>
          <span class="hljs-attribute">android:textColor</span>=<span class="hljs-value">"@color/menu_text"</span>
          <span class="hljs-attribute">android:gravity</span>=<span class="hljs-value">"center"</span>
          <span class="hljs-attribute">android:minHeight</span>=<span class="hljs-value">"45dp"</span> /&gt;</span></code></pre> 
  <p>定义了文字颜色为蓝色：</p> 
  <pre class="prettyprint"><code class="language-xml hljs">    <span class="hljs-tag">&lt;<span class="hljs-title">color</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"menu_text"</span>&gt;</span>#f12162ff<span class="hljs-tag">&lt;/<span class="hljs-title">color</span>&gt;</span></code></pre> 
  <p>同时设置取消按钮的文字也是这个颜色。</p> 
  <p>重写Adapter，代码如下：</p> 
  <pre class="prettyprint"><code class="language-java hljs">mAdapter = <span class="hljs-keyword">new</span> ArrayAdapter&lt;String&gt;(context, R.layout.menu_item) {
    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> View <span class="hljs-title">getView</span>(<span class="hljs-keyword">int</span> position, View convertView, ViewGroup parent) {
        View view = <span class="hljs-keyword">super</span>.getView(position, convertView, parent);
        setBackground(position, view);
        <span class="hljs-keyword">return</span> view;
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setBackground</span>(<span class="hljs-keyword">int</span> position, View view) {
        <span class="hljs-keyword">int</span> count = getCount();
        <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span>) {
            view.setBackgroundResource(R.drawable.menu_item_single);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (position == <span class="hljs-number">0</span>) {
            view.setBackgroundResource(R.drawable.menu_item_top);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (position == count - <span class="hljs-number">1</span>) {
            view.setBackgroundResource(R.drawable.menu_item_bottom);
        } <span class="hljs-keyword">else</span> {
            view.setBackgroundResource(R.drawable.menu_item_middle);
        }
    }
};</code></pre> 
  <p>写完之后，给Activity的下面加点文字，看看背景透明度是否如我们的所想。这下子看起来很像了。但还是觉得有所欠缺，没错，我们还缺少动画。</p> 
  <h3>动画</h3> 
  <p>编写两个动画，一个是显示时弹出的，一个是消失的。 <br> 弹出动画：</p> 
  <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">translate</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
           <span class="hljs-attribute">android:fromYDelta</span>=<span class="hljs-value">"100%"</span>
           <span class="hljs-attribute">android:toYDelta</span>=<span class="hljs-value">"0"</span>
           <span class="hljs-attribute">android:duration</span>=<span class="hljs-value">"350"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">translate</span>&gt;</span></code></pre> 
  <p>消失动画：</p> 
  <pre class="prettyprint"><code class="language-xml hljs"><span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">translate</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>
           <span class="hljs-attribute">android:fromYDelta</span>=<span class="hljs-value">"0%"</span>
           <span class="hljs-attribute">android:toYDelta</span>=<span class="hljs-value">"100%"</span>
           <span class="hljs-attribute">android:duration</span>=<span class="hljs-value">"350"</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">translate</span>&gt;</span></code></pre> 
  <p>然后回到ActionSheet类，把我们的rootView重构为成员变量 ，因为我们的动画要加在它身上。同时，需要定义几个成员变量，分别是显示和消失的动画以及表示正在消失的<code>boolean</code>变量。</p> 
  <pre class="prettyprint"><code class="hljs java">    <span class="hljs-keyword">private</span> View mRootView;

    <span class="hljs-keyword">private</span> Animation mShowAnim;
    <span class="hljs-keyword">private</span> Animation mDismissAnim;

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">boolean</span> isDismissing;</code></pre> 
  <p>然后是初始化动画变量，重写show和dismiss方法，加入播放动画的代码。注意，对父类的dismiss调用是在弹出动画结束之后才调用的，所以加入一个isDismissing表示这段过程，并添加一个私有方法dismissMe来调用父类的dismiss方法。代码如下：</p> 
  <pre class="prettyprint"><code class="language-java hljs">    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">initAnim</span>(Context context) {
        mShowAnim = AnimationUtils.loadAnimation(context, R.anim.translate_up);
        mDismissAnim = AnimationUtils.loadAnimation(context, R.anim.translate_down);
        mDismissAnim.setAnimationListener(<span class="hljs-keyword">new</span> Animation.AnimationListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationStart</span>(Animation animation) {

            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationEnd</span>(Animation animation) {
                dismissMe();
            }

            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onAnimationRepeat</span>(Animation animation) {

            }
        });
    }</code></pre> 
  <p>这是初始化动画的代码，该方法在initView中调用。然后是显示和隐藏菜单的代码：</p> 
  <pre class="prettyprint"><code class="language-java hljs">    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">show</span>() {
        mAdapter.notifyDataSetChanged();
        <span class="hljs-keyword">super</span>.show();
        mRootView.startAnimation(mShowAnim);
    }

    <span class="hljs-annotation">@Override</span>
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dismiss</span>() {
        <span class="hljs-keyword">if</span>(isDismissing) {
            <span class="hljs-keyword">return</span>;
        }
        isDismissing = <span class="hljs-keyword">true</span>;
        mRootView.startAnimation(mDismissAnim);
    }

    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">dismissMe</span>() {
        <span class="hljs-keyword">super</span>.dismiss();
        isDismissing = <span class="hljs-keyword">false</span>;
    }</code></pre> 
  <p>加上动画之后，更逼真了些吧。但我们还漏了一个很重要的东西 。事件！</p> 
  <h3>事件</h3> 
  <p>首先，在ActionSheet里面定义一个接口：</p> 
  <pre class="prettyprint"><code class="language-java hljs">    interface MenuListener {
        <span class="hljs-keyword">void</span> onItemSelected(<span class="hljs-keyword">int</span> position, String item);

        <span class="hljs-keyword">void</span> onCancel();
    }</code></pre> 
  <p>添加<code>MenuListener</code>变量。</p> 
  <pre class="prettyprint"><code class="hljs cs">    <span class="hljs-keyword">private</span> MenuListener mMenuListener;

    <span class="hljs-keyword">public</span> MenuListener <span class="hljs-title">getMenuListener</span>() {
        <span class="hljs-keyword">return</span> mMenuListener;
    }

    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMenuListener</span>(MenuListener menuListener) {
        mMenuListener = menuListener;
    }</code></pre> 
  <p>各种事件回调：</p> 
  <pre class="prettyprint"><code class="language-java hljs">        <span class="hljs-comment">//取消按钮的事件</span>
        mCancel.setOnClickListener(<span class="hljs-keyword">new</span> View.OnClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onClick</span>(View v) {
                cancel();
            }
        });
        <span class="hljs-comment">// 菜单的事件</span>
        mMenuItems.setOnItemClickListener(<span class="hljs-keyword">new</span> AdapterView.OnItemClickListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemClick</span>(AdapterView&lt;?&gt; parent, View view, <span class="hljs-keyword">int</span> position, <span class="hljs-keyword">long</span> id) {
                <span class="hljs-keyword">if</span> (mMenuListener != <span class="hljs-keyword">null</span>) {
                    mMenuListener.onItemSelected(position, mAdapter.getItem(position));
                    dismiss();
                }
            }
        });
        <span class="hljs-comment">// 对话框取消的回调</span>
        setOnCancelListener(<span class="hljs-keyword">new</span> OnCancelListener() {
            <span class="hljs-annotation">@Override</span>
            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCancel</span>(DialogInterface dialog) {
                <span class="hljs-keyword">if</span>(mMenuListener != <span class="hljs-keyword">null</span>) {
                    mMenuListener.onCancel();
                }
            }
        });</code></pre> 
  <p>这下就基本完成了。</p> 
  <h2>运行</h2> 
  <p>然后再对我们的Activity略加修改，加入事件回调。</p> 
  <pre class="prettyprint"><code class="language-java hljs">            mActionSheet.setMenuListener(<span class="hljs-keyword">new</span> ActionSheet.MenuListener() {
                <span class="hljs-annotation">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onItemSelected</span>(<span class="hljs-keyword">int</span> position, String item) {
                    Toast.makeText(MainActivity.<span class="hljs-keyword">this</span>, item, Toast.LENGTH_SHORT).show();
                }

                <span class="hljs-annotation">@Override</span>
                <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">onCancel</span>() {
                    Toast.makeText(MainActivity.<span class="hljs-keyword">this</span>, <span class="hljs-string">"onCancel"</span>, Toast.LENGTH_SHORT).show();
                }
            });</code></pre> 
  <p>运行，效果如下（由于我是通过Android Studio屏幕录制先录成MP4再在线转换为GIF的，GIF有些大，所以我就不贴图了）：<a href="http://v.youku.com/v_show/id_XOTY2MTM0ODM2.html" rel="nofollow">http://v.youku.com/v_show/id_XOTY2MTM0ODM2.html</a></p> 
  <p>这篇博客由于主要是写实现的过程，所以有点长。实际上代码并不复杂，ActionSheet的全部代码加注释才170行。 <br> 项目地址（包括运行效果的录制视频）：<a href="http://zdz.la/2pz0Ys" rel="nofollow">http://zdz.la/2pz0Ys</a></p> 
  <p>下一篇将写一下如何把它写成一个可复用的控件。</p> 
  <p>参考博客：<a href="http://blog.csdn.net/bbld_/article/details/39124097">http://blog.csdn.net/bbld_/article/details/39124097</a></p> 
 </div> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b9d464d0e66ccbbdd28e20a9ea158b3c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">passwd --stdin 选项</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cf42ed42a5a99f25ac9e9497a9b2d5c9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux Centos 下非 root  用户执行shell的一些问题解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>