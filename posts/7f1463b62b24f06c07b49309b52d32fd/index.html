<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Oracle merge into 详解（有则更新，无则插入） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Oracle merge into 详解（有则更新，无则插入）" />
<meta property="og:description" content="文章目录 1 概述1.1 使用场景1.2 常规写法1.3 基础数据准备 2 示例2.1 语法2.2 实操 1 概述 1.1 使用场景 需求：源表 a 的数据 写入至 目标表 b 中规则： ① 若目标表 b 中 有 源表 a 的这条记录，则 更新② 若目标表 b 中 没有 源表 a 的这条记录，则 插入 优势：执行效率高、语法简洁 1.2 常规写法 -- 如果不知道 merge into 这个语法，咱可能会这么写 select count(1) into v_count from ...; if count(1) &gt;= 1 then update ...; -- 有则更新 else insert ...; -- 无则插入 1.3 基础数据准备 -- 源表：source_table create table source_table ( sno number(3), sname varchar2(30), sex varchar2(2) ); insert into source_table(sno, sname, sex) values(1, &#39;瑶瑶&#39;, &#39;女&#39;); insert into source_table(sno, sname, sex) values(2, &#39;优优&#39;, &#39;男&#39;); insert into source_table(sno, sname, sex) values(3, &#39;倩倩&#39;, &#39;女&#39;); commit; -- 目标表：target_table（仅表结构） create table target_table as select * from source_table where 1 = 2; insert into target_table (sno, sname, sex) values(1, &#39;瑶瑶&#39;, &#39;男&#39;); commit; 2 示例 2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7f1463b62b24f06c07b49309b52d32fd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T10:07:01+08:00" />
<meta property="article:modified_time" content="2024-01-02T10:07:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Oracle merge into 详解（有则更新，无则插入）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__2" rel="nofollow">1 概述</a></li><li><ul><li><a href="#11__4" rel="nofollow">1.1 使用场景</a></li><li><a href="#12__12" rel="nofollow">1.2 常规写法</a></li><li><a href="#13__25" rel="nofollow">1.3 基础数据准备</a></li></ul> 
  </li><li><a href="#2__45" rel="nofollow">2 示例</a></li><li><ul><li><a href="#21__46" rel="nofollow">2.1 语法</a></li><li><a href="#22__59" rel="nofollow">2.2 实操</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1__2"></a>1 概述</h2> 
<h3><a id="11__4"></a>1.1 使用场景</h3> 
<ul><li><strong>需求</strong>：源表 a 的数据 写入至 目标表 b 中</li><li><strong>规则</strong>： 
  <ul><li>① 若目标表 b 中 <strong>有</strong> 源表 a 的这条记录，则 <strong>更新</strong></li><li>② 若目标表 b 中 <strong>没有</strong> 源表 a 的这条记录，则 <strong>插入</strong></li></ul> </li><li><strong>优势</strong>：执行效率高、语法简洁</li></ul> 
<h3><a id="12__12"></a>1.2 常规写法</h3> 
<pre><code class="prism language-sql"><span class="token comment">-- 如果不知道 merge into 这个语法，咱可能会这么写</span>
<span class="token keyword">select</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">into</span> v_count
  <span class="token keyword">from</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span>
 
<span class="token keyword">if</span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token keyword">then</span>
   <span class="token keyword">update</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span> <span class="token comment">-- 有则更新</span>
<span class="token keyword">else</span>
   <span class="token keyword">insert</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">;</span> <span class="token comment">-- 无则插入</span>
</code></pre> 
<h3><a id="13__25"></a>1.3 基础数据准备</h3> 
<pre><code class="prism language-sql"><span class="token comment">-- 源表：source_table</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> source_table <span class="token punctuation">(</span>
  sno   number<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  sname varchar2<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  sex   varchar2<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> source_table<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'瑶瑶'</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> source_table<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'优优'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> source_table<span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'倩倩'</span><span class="token punctuation">,</span> <span class="token string">'女'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>

<span class="token comment">-- 目标表：target_table（仅表结构）</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> target_table <span class="token keyword">as</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> source_table <span class="token keyword">where</span> <span class="token number">1</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> target_table <span class="token punctuation">(</span>sno<span class="token punctuation">,</span> sname<span class="token punctuation">,</span> sex<span class="token punctuation">)</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'瑶瑶'</span><span class="token punctuation">,</span> <span class="token string">'男'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">commit</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="2__45"></a>2 示例</h2> 
<h3><a id="21__46"></a>2.1 语法</h3> 
<pre><code class="prism language-sql"><span class="token keyword">merge</span> <span class="token keyword">into</span> 目标表 b
<span class="token keyword">using</span> 源表 a
<span class="token keyword">on</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>字段<span class="token number">1</span> <span class="token operator">=</span> a<span class="token punctuation">.</span>字段<span class="token number">1</span> <span class="token operator">and</span> b<span class="token punctuation">.</span>字段n <span class="token operator">=</span> a<span class="token punctuation">.</span>字段n<span class="token punctuation">)</span> <span class="token comment">-- 必须带 '()'</span>
<span class="token keyword">when</span> <span class="token keyword">matched</span> <span class="token keyword">then</span> <span class="token comment">-- 整体扫描，匹配时，执行此处</span>
   <span class="token keyword">update</span> 子句
<span class="token keyword">when</span> <span class="token operator">not</span> <span class="token keyword">matched</span> <span class="token keyword">then</span> <span class="token comment">-- 整体扫描，不匹配时，执行此处</span>
   <span class="token keyword">insert</span> 子句<span class="token punctuation">;</span>

<span class="token keyword">commit</span><span class="token punctuation">;</span> <span class="token comment">-- 记得提交哦</span>
</code></pre> 
<h3><a id="22__59"></a>2.2 实操</h3> 
<p><strong>实例： 将源表 source_table 的数据同步至目标表 target_table</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">merge</span> <span class="token keyword">into</span> target_table b
<span class="token keyword">using</span> source_table a
<span class="token keyword">on</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>sno <span class="token operator">=</span> a<span class="token punctuation">.</span>sno<span class="token punctuation">)</span> <span class="token comment">-- 关联字段</span>
<span class="token keyword">when</span> <span class="token keyword">matched</span> <span class="token keyword">then</span>
  <span class="token keyword">update</span> <span class="token keyword">set</span> b<span class="token punctuation">.</span>sname <span class="token operator">=</span> a<span class="token punctuation">.</span>sname<span class="token punctuation">,</span> b<span class="token punctuation">.</span>sex <span class="token operator">=</span> a<span class="token punctuation">.</span>sex
<span class="token keyword">when</span> <span class="token operator">not</span> <span class="token keyword">matched</span> <span class="token keyword">then</span>
  <span class="token keyword">insert</span> <span class="token punctuation">(</span>b<span class="token punctuation">.</span>sno<span class="token punctuation">,</span> b<span class="token punctuation">.</span>sname<span class="token punctuation">,</span> b<span class="token punctuation">.</span>sex<span class="token punctuation">)</span> <span class="token keyword">values</span> <span class="token punctuation">(</span>a<span class="token punctuation">.</span>sno<span class="token punctuation">,</span> a<span class="token punctuation">.</span>sname<span class="token punctuation">,</span> a<span class="token punctuation">.</span>sex<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">commit</span><span class="token punctuation">;</span> <span class="token comment">-- 记得提交哦</span>
</code></pre> 
<p><strong>查询结果：</strong></p> 
<pre><code class="prism language-sql"><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> source_table t <span class="token keyword">order</span> <span class="token keyword">by</span> t<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>
<span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> target_table t <span class="token keyword">order</span> <span class="token keyword">by</span> t<span class="token punctuation">.</span>sno<span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ee/ba/PUS2TFK0_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0a73a1fe959e05c4e55052d95beec1f0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Java 21 新特性】顺序集合（Sequenced Collections）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/98dd678dfe8ea1295a005349e4e5dc8e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">目标检测-One Stage-SSD</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>