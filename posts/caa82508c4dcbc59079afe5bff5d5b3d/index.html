<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【项目实战】Python实现循环神经网络RNN-LSTM回归模型项目实战(股票价格预测) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【项目实战】Python实现循环神经网络RNN-LSTM回归模型项目实战(股票价格预测)" />
<meta property="og:description" content="说明：这是一个机器学习实战项目（附带数据&#43;代码&#43;文档&#43;代码讲解），如需数据&#43;代码&#43;文档&#43;代码讲解可以直接到文章最后获取。
1.项目背景 金融一直是现代社会非常热门的一个研究方向，随着社会的发展，越来越多的数学方法被应用于金融领域的描述中。我们寄希望于用一种更客观地表达来研究金融。而股票市场作为一个看似门槛极低的金融市场，参与者众多，与利益直接挂钩，是金融市场的一个大热研究方向。
中国股市于 1989 年开始试运行，自此，开始了中国股市近30年的起起伏伏。中国股市虽相较于美国股市还没有很成熟，但是经过30年的发展，也在逐渐向一个成熟的市场发展。截至2019年，沪深A股交易股票已有3589只，如何在其中筛选出有潜力的股票，或者说如何对股票价格进行短期的预测，这在深度学习日趋兴起的背景下，成为了我们想要尝试解决的一个问题。
2.数据获取 本次建模数据来源于网络(本项目撰写人整理而成)，数据项统计如下：
数据详情如下(部分展示)：
3.数据预处理 3.1 用Pandas工具查看数据
使用Pandas工具的tail()方法查看后十行数据：
关键代码：
3.2查看AAPL公司股票数据的描述性统计分析
使用Pandas工具的describe()方法AAPL公司的描述性统计分析信息：
从上图可以看到，AAPL公司股票数据开盘价、最高价、最低价、收盘价、成交量的平均值、标准差、最小值、中位数、最大值。
关键代码：
3.3查看AAPL公司股票数据的摘要信息
通过Pandas工具的info()方法来查看AAPL公司股票数据的摘要信息：
通过上图可以看到，总共有6个数据项，1259条数据，数据时间范围为2013到2018年，数据中无缺失值。
关键代码如下：
4.探索性数据分析 4.1 绘制股票收盘价曲线图
用Pandas工具的plot()方法进行绘图，图形如下：
通过上图可以看到，4家公司的股票收盘价格基本每年呈上升趋势。
4.2 绘制股票成交量曲线图
从上图中可以看到，每家公司股票的成交量基本都是在一定的范围内进行波动。
4.3 绘制股票收盘价10天、20天、50天累计曲线图
从上图中可以看到，APPLE公司股票收盘价10天、20天、50天内累计收盘价呈上升趋势，而APPLE公司股票收盘价比较稳定。
关键代码：
4.4 绘制股票日收益曲线图
从上图中可以看到，每家股票的日收益都存在一定的波动，同时也说明了股票有风险、入市需谨慎。
关键代码如下：
4.5 绘制股票日收益直方图
从上图中可以看到，4家公司的日收益均集中在-0.05-0.05之间。
关键代码：
4.6 相关性分析
通过Pandas工具的corr()方法进行相关性分析：
从上图可以看到，除成交量外其它数据项之间相关性比较高。
5.特征工程 5.1 建立特征数据和标签数据
close为标签数据，除 close之外的为特征数据。关键代码如下：
5.2 数据集拆分
训练集拆分，分为训练集和验证集，70%训练集和30%验证集，关键代码如下：
5.3 数据归一化
通过MinMaxScaler工具进行数据的归一化，把数据缩放到0-1区间，关键代码如下：
6.构建LSTM回归模型 Hochreiter 等学者（1997）[21]提出了长短时记忆单元（Long Short-Term Memory，LSTM）用于改进传统的循环神经网络模型（RNN），该模型通过门的开关实现时间上的记忆功能，并反之梯度小时，实验结果表明，LSTM 能有效地解决 RNN 训练时的梯度爆炸和梯度消失问题。2005 年，Alex Graves，Jürgen Schmidhuber[22]提出了使用完全的后向传播方式训练 LSTM 模型，使得LSTM 的实现过程更加可靠。2015 年，Chung 等学者提出了简化版本的LSTM，门控反馈 RNN（GF-RNN）通过允许和控制从上部复现层流向下层的信号，使用每对层的全局选通单元，扩展了堆叠多个复现层的现有方法。层之间交换的递归信号基于先前的隐藏状态和当前输入自适应地选通。相比于传统的神经网络模型。LSTM 神经网络模型对于神经组织的认知过程的模拟更为准确。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/caa82508c4dcbc59079afe5bff5d5b3d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-20T09:38:08+08:00" />
<meta property="article:modified_time" content="2023-11-20T09:38:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【项目实战】Python实现循环神经网络RNN-LSTM回归模型项目实战(股票价格预测)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>说明：这是一个机器学习实战项目（附带<strong>数据+代码+文档+代码讲解</strong>），如需<strong>数据+代码+文档+代码讲解</strong>可以直接到文章最后获取。</p> 
 <p><img alt="" height="132" src="https://images2.imgbox.com/e4/57/bgV5GpEI_o.png" width="485"></p> 
 <p><img alt="" height="710" src="https://images2.imgbox.com/ae/a3/wffty901_o.png" width="733"></p> 
 <h4 style="margin-left:0px;text-align:justify;">1.项目背景</h4> 
 <p style="margin-left:0;text-align:justify;">       金融一直是现代社会非常热门的一个研究方向，随着社会的发展，越来越多的数学方法被应用于金融领域的描述中。我们寄希望于用一种更客观地表达来研究金融。而股票市场作为一个看似门槛极低的金融市场，参与者众多，与利益直接挂钩，是金融市场的一个大热研究方向。</p> 
 <p style="margin-left:0;text-align:justify;">       中国股市于 1989 年开始试运行，自此，开始了中国股市近30年的起起伏伏。中国股市虽相较于美国股市还没有很成熟，但是经过30年的发展，也在逐渐向一个成熟的市场发展。截至2019年，沪深A股交易股票已有3589只，如何在其中筛选出有潜力的股票，或者说如何对股票价格进行短期的预测，这在深度学习日趋兴起的背景下，成为了我们想要尝试解决的一个问题。</p> 
 <h4 style="margin-left:0px;text-align:justify;">2.数据获取</h4> 
 <p>本次建模数据来源于网络(本项目撰写人整理而成)，数据项统计如下：</p> 
 <p><img alt="" height="230" src="https://images2.imgbox.com/0e/9d/NHck5c5B_o.png" width="709"></p> 
 <p> 数据详情如下(部分展示)：</p> 
 <p><img alt="" height="289" src="https://images2.imgbox.com/0d/9b/sBVg6BgE_o.png" width="865"></p> 
 <h4 style="margin-left:0px;text-align:justify;">3.数据预处理</h4> 
 <p style="margin-left:0px;text-align:justify;"><strong>3.1 用Pandas工具查看数据</strong></p> 
 <p style="margin-left:0;text-align:justify;">使用Pandas工具的tail()方法查看后十行数据：</p> 
 <p><img alt="" height="491" src="https://images2.imgbox.com/83/5e/vUjUBk96_o.png" width="865"></p> 
 <p> 关键代码：</p> 
 <p><img alt="" height="61" src="https://images2.imgbox.com/e0/4c/hDlJTVaV_o.png" width="344"></p> 
 <p style="margin-left:0px;text-align:justify;"><strong>3.2查看AAPL公司股票数据的描述性统计分析</strong></p> 
 <p style="margin-left:0;text-align:justify;">使用Pandas工具的describe()方法AAPL公司的描述性统计分析信息：</p> 
 <p><img alt="" height="298" src="https://images2.imgbox.com/10/1e/ZC1mrM4U_o.png" width="865"></p> 
 <p> 从上图可以看到，AAPL公司股票数据开盘价、最高价、最低价、收盘价、成交量的平均值、标准差、最小值、中位数、最大值。</p> 
 <p style="margin-left:0;text-align:justify;">关键代码：</p> 
 <p style="margin-left:0;text-align:justify;"><img alt="" height="77" src="https://images2.imgbox.com/de/71/5TnTC7tb_o.png" width="433"></p> 
 <p style="margin-left:0px;text-align:justify;"><strong>3.3查看AAPL公司股票数据的摘要信息</strong></p> 
 <p style="margin-left:0;text-align:justify;">通过Pandas工具的info()方法来查看AAPL公司股票数据的摘要信息：</p> 
 <p><img alt="" height="484" src="https://images2.imgbox.com/4d/4b/fWsMXBhd_o.png" width="855"></p> 
 <p> 通过上图可以看到，总共有6个数据项，1259条数据，数据时间范围为2013到2018年，数据中无缺失值。</p> 
 <p style="margin-left:0;text-align:justify;">关键代码如下：</p> 
 <p style="margin-left:0;text-align:justify;"><img alt="" height="83" src="https://images2.imgbox.com/bf/0d/Srvhls8P_o.png" width="378"></p> 
 <h4 style="margin-left:0px;text-align:justify;">4.探索性数据分析</h4> 
 <p style="margin-left:0px;text-align:justify;"><strong>4.1 绘制股票收盘价曲线图</strong></p> 
 <p style="margin-left:0;text-align:justify;">用Pandas工具的plot()方法进行绘图，图形如下：</p> 
 <p><img alt="" height="413" src="https://images2.imgbox.com/f0/cd/ZxcjAj08_o.png" width="865"></p> 
 <p> 通过上图可以看到，4家公司的股票收盘价格基本每年呈上升趋势。</p> 
 <p style="margin-left:0px;text-align:justify;"><strong>4.2 绘制股票成交量曲线图</strong></p> 
 <p><img alt="" height="418" src="https://images2.imgbox.com/63/2d/ckSMCLc2_o.png" width="865"></p> 
 <p>从上图中可以看到，每家公司股票的成交量基本都是在一定的范围内进行波动。</p> 
 <p><strong>4.3 绘制股票收盘价10天、20天、50天累计曲线图</strong></p> 
 <p><img alt="" height="428" src="https://images2.imgbox.com/1f/c5/rAJA5SIr_o.png" width="865"></p> 
 <p> 从上图中可以看到，APPLE公司股票收盘价10天、20天、50天内累计收盘价呈上升趋势，而APPLE公司股票收盘价比较稳定。</p> 
 <p style="margin-left:0;text-align:left;">关键代码：</p> 
 <p style="margin-left:0;text-align:left;"><img alt="" height="541" src="https://images2.imgbox.com/65/65/xyw6OeD9_o.png" width="865"></p> 
 <p><strong>4.4 绘制股票日收益曲线图</strong></p> 
 <p><img alt="" height="426" src="https://images2.imgbox.com/ae/61/YcInMeCb_o.png" width="865"></p> 
 <p> 从上图中可以看到，每家股票的日收益都存在一定的波动，同时也说明了股票有风险、入市需谨慎。</p> 
 <p style="margin-left:0;text-align:left;">关键代码如下：</p> 
 <p style="margin-left:0;text-align:left;"><img alt="" height="262" src="https://images2.imgbox.com/88/90/5UECueoi_o.png" width="865"></p> 
 <p><strong>4.5 绘制股票日收益直方图</strong></p> 
 <p><img alt="" height="510" src="https://images2.imgbox.com/43/20/gROvljGJ_o.png" width="865"></p> 
 <p> 从上图中可以看到，4家公司的日收益均集中在-0.05-0.05之间。</p> 
 <p style="margin-left:0;text-align:left;">关键代码：</p> 
 <p style="margin-left:0;text-align:left;"><img alt="" height="191" src="https://images2.imgbox.com/86/77/wBDJV1Al_o.png" width="865"></p> 
 <p style="margin-left:0px;text-align:justify;"><strong>4.6 相关性分析</strong></p> 
 <p style="margin-left:0;text-align:left;">通过Pandas工具的corr()方法进行相关性分析：</p> 
 <p><img alt="" height="678" src="https://images2.imgbox.com/24/02/wxzUnSW8_o.png" width="865"></p> 
 <p> 从上图可以看到，除成交量外其它数据项之间相关性比较高。</p> 
 <h4 style="margin-left:0px;text-align:justify;">5.特征工程</h4> 
 <p style="margin-left:0px;text-align:justify;"><strong>5.1 建立特征数据和标签数据</strong></p> 
 <p style="margin-left:0;text-align:justify;">close为标签数据，除 close之外的为特征数据。关键代码如下：</p> 
 <p style="margin-left:0;text-align:justify;"><img alt="" height="125" src="https://images2.imgbox.com/1c/6a/JmhU3Mxw_o.png" width="608"></p> 
 <p style="margin-left:0px;text-align:justify;"><strong>5.2 数据集拆分</strong></p> 
 <p style="margin-left:0;text-align:justify;">训练集拆分，分为训练集和验证集，70%训练集和30%验证集，关键代码如下：</p> 
 <p><img alt="" height="38" src="https://images2.imgbox.com/58/26/fv6shNmb_o.png" width="865"></p> 
 <p style="margin-left:0px;text-align:justify;"><strong>5.3 数据归一化</strong></p> 
 <p style="margin-left:0;text-align:justify;">通过MinMaxScaler工具进行数据的归一化，把数据缩放到0-1区间，关键代码如下：</p> 
 <p><img alt="" height="300" src="https://images2.imgbox.com/ae/dc/FAgggg8x_o.png" width="764"></p> 
 <h4 style="margin-left:0px;text-align:justify;">6.构建LSTM回归模型</h4> 
 <p style="margin-left:0;text-align:justify;">          Hochreiter 等学者（1997）[21]提出了长短时记忆单元（Long Short-Term Memory，LSTM）用于改进传统的循环神经网络模型（RNN），该模型通过门的开关实现时间上的记忆功能，并反之梯度小时，实验结果表明，LSTM 能有效地解决 RNN 训练时的梯度爆炸和梯度消失问题。2005 年，Alex Graves，Jürgen Schmidhuber[22]提出了使用完全的后向传播方式训练 LSTM 模型，使得LSTM 的实现过程更加可靠。2015 年，Chung 等学者提出了简化版本的LSTM，门控反馈 RNN（GF-RNN）通过允许和控制从上部复现层流向下层的信号，使用每对层的全局选通单元，扩展了堆叠多个复现层的现有方法。层之间交换的递归信号基于先前的隐藏状态和当前输入自适应地选通。相比于传统的神经网络模型。LSTM 神经网络模型对于神经组织的认知过程的模拟更为准确。</p> 
 <p style="margin-left:0px;text-align:justify;"><strong>6.1建模</strong></p> 
 <p><img alt="" height="130" src="https://images2.imgbox.com/0d/af/v8sVlBwr_o.png" width="707">关键代码如下： </p> 
 <p><img alt="" height="275" src="https://images2.imgbox.com/bc/64/gG9TxbgO_o.png" width="865"></p> 
 <p style="margin-left:0px;text-align:justify;"><strong>6.2查看模型信息</strong></p> 
 <p style="margin-left:0;text-align:justify;">通过模型的summary()方法查看模型的信息，如下图所示：</p> 
 <p style="margin-left:0;text-align:justify;"><img alt="" height="569" src="https://images2.imgbox.com/9f/df/0AFeRiTK_o.png" width="865"></p> 
 <h4 style="margin-left:0px;text-align:justify;">7.模型评估</h4> 
 <p style="margin-left:0px;text-align:justify;"><strong>7.1评估指标及结果</strong></p> 
 <p style="margin-left:0;text-align:justify;">评估指标主要包括可解释方差值、均方误差、R方值等等。</p> 
 <p><img alt="" height="147" src="https://images2.imgbox.com/3c/65/bCLbMahf_o.png" width="704"></p> 
 <p>从上表可以看出，R方为100%  可解释方差值为100%，LSTM回归模型比较优秀，效果非常好。</p> 
 <p style="margin-left:0;text-align:justify;">关键代码如下：</p> 
 <p style="margin-left:0;text-align:justify;"><img alt="" height="177" src="https://images2.imgbox.com/5f/ab/vS3BQYCI_o.png" width="865"></p> 
 <p><strong>7.2 真实值与预测值对比图 </strong></p> 
 <p><img alt="" height="438" src="https://images2.imgbox.com/1d/97/qcNCNKZl_o.png" width="865"></p> 
 <p> 从上图可以看出真实值和预测值波动基本一致，模型拟合效果非常棒。</p> 
 <h4 style="margin-left:0px;text-align:justify;">8.结论与展望</h4> 
 <p style="margin-left:0;text-align:justify;">综上所述，本文采用了LSTM回归模型，最终证明了我们提出的模型效果良好。可用于日常金融中股票价格的预测。</p> 
</blockquote> 
<blockquote> 
 <pre><code class="language-python">sns.set_style('whitegrid')
plt.style.use("fivethirtyeight")

tech_list = ['AAPL', 'GOOG', 'MSFT', 'AMZN']

df = pd.read_excel('data.xlsx', index_col='date')

# 本次机器学习项目实战所需的资料，项目资源如下：


链接：https://pan.baidu.com/s/1fi4YFKZk1bHWKHdgxUHQEA 
提取码：m36g






# 用Pandas工具查看数据
print(df.tail(10))

df_AAPL = df[df['Name'] == 'AAPL']
print(df_AAPL.head())

# 查看AAPL公司股票数据的描述性统计分析
print(df_AAPL.describe())

# 查看AAPL公司股票数据的摘要信息
print(df_AAPL.info())

plt.figure(figsize=(15, 6))
plt.subplots_adjust(top=1.25, bottom=1.2)

company_list = ['AAPL', 'GOOG', 'MSFT', 'AMZN']
# 绘制股票收盘价曲线图</code></pre> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2c848db7177a1db29ab84a85834fcb2d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">pandas &#43;re获取pubmed中文献的标题和摘要</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8cd3d5e2766d108da89f7f43c54c5ff9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">深度学习系列54：使用 MMDETECTION 和 LABEL-STUDIO 进行半自动化目标检测标注</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>