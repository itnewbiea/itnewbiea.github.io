<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux实现ssh公钥登录的步骤 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux实现ssh公钥登录的步骤" />
<meta property="og:description" content="【3.5】实现Linux上SSH公钥认证的免密码登录需要按照以下步骤进行，这里以两台Linux主机A和B为例：
步骤1：在本地生成SSH密钥对 在主机A上，打开终端，输入以下命令：
ssh-keygen -t rsa 按照提示，选择生成SSH密钥对的类型（通常选择默认的RSA），然后可以选择是否设置密码（直接回车表示无密码）。
步骤2：将公钥复制到目标主机B 使用以下命令将生成的公钥复制到目标主机B上：
ssh-copy-id username@B 这会要求输入目标主机B的用户密码。输入后，公钥将被复制到B主机的~/.ssh/authorized_keys文件中。
步骤3：测试SSH连接 尝试使用SSH连接到目标主机B：
ssh username@B 如果一切设置正确，应该可以无密码登录到目标主机B。
验证是否成功： 成功情况：
执行ssh username@B时，应该直接登录到主机B而无需输入密码。如果执行ssh -v username@B，可以看到详细的调试信息，其中包括尝试使用公钥进行身份验证。 失败情况和解决方法：
文件权限： 如果~/.ssh 或 ~/.ssh/authorized_keys 的权限设置不正确，可能导致身份验证失败。确保这些目录的权限是安全的。chmod 700 ~/.ssh chmod 600 ~/.ssh/authorized_keys 公钥格式问题： 确保公钥的内容是正确的，没有多余的空格或换行符。SSH服务配置问题： 在目标主机B上，确保SSH服务已正确配置允许公钥身份验证。 注意事项： 在主机A上的~/.ssh/id_rsa.pub 文件是公钥文件，可以在其中找到复制到目标主机B的公钥。如果使用不同的用户名，确保在命令中替换username为目标主机B上的实际用户名。在SSH连接时，可以通过添加-v选项查看详细的调试信息，帮助诊断问题。 如果出现问题，根据错误信息进行调试，并根据上述失败情况和解决方法进行修复。
4.0
要在Linux系统中使用SSH公钥实现免密码登录，你需要在本地机器上生成一对密钥，并将公钥复制到远程服务器。以下是具体操作步骤及其命令。
在本地生成密钥对 打开一个终端。
运行 ssh-keygen 命令来生成新的密钥对。
ssh-keygen -t rsa -b 4096 -t rsa 指定了密钥类型为RSA，-b 4096 指定了密钥长度为4096位。
系统会提示你输入保存密钥对的文件名（默认为 ~/.ssh/id_rsa）。
接着系统会提示你输入密钥的密码短语（passphrase），不希望设置可以直接按回车跳过。
成功生成密钥后，你将看到如下信息：
Your identification has been saved in /your/home/directory/.ssh/id_rsa. Your public key has been saved in /your/home/directory/." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d7774fd005b359f0d6f45eae13159931/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-27T18:18:49+08:00" />
<meta property="article:modified_time" content="2023-12-27T18:18:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux实现ssh公钥登录的步骤</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>【3.5】实现Linux上SSH公钥认证的免密码登录需要按照以下步骤进行，这里以两台Linux主机A和B为例：</p> 
<h4><a id="1SSH_1"></a>步骤1：在本地生成SSH密钥对</h4> 
<p>在主机A上，打开终端，输入以下命令：</p> 
<pre><code class="prism language-bash">ssh-keygen <span class="token parameter variable">-t</span> rsa
</code></pre> 
<p>按照提示，选择生成SSH密钥对的类型（通常选择默认的RSA），然后可以选择是否设置密码（直接回车表示无密码）。</p> 
<h4><a id="2B_8"></a>步骤2：将公钥复制到目标主机B</h4> 
<p>使用以下命令将生成的公钥复制到目标主机B上：</p> 
<pre><code class="prism language-bash">ssh-copy-id username@B
</code></pre> 
<p>这会要求输入目标主机B的用户密码。输入后，公钥将被复制到B主机的<code>~/.ssh/authorized_keys</code>文件中。</p> 
<h4><a id="3SSH_15"></a>步骤3：测试SSH连接</h4> 
<p>尝试使用SSH连接到目标主机B：</p> 
<pre><code class="prism language-bash"><span class="token function">ssh</span> username@B
</code></pre> 
<p>如果一切设置正确，应该可以无密码登录到目标主机B。</p> 
<h4><a id="_22"></a>验证是否成功：</h4> 
<ul><li> <p><strong>成功情况：</strong></p> 
  <ul><li>执行<code>ssh username@B</code>时，应该直接登录到主机B而无需输入密码。</li><li>如果执行<code>ssh -v username@B</code>，可以看到详细的调试信息，其中包括尝试使用公钥进行身份验证。</li></ul> </li><li> <p><strong>失败情况和解决方法：</strong></p> 
  <ul><li><strong>文件权限：</strong> 如果<code>~/.ssh</code> 或 <code>~/.ssh/authorized_keys</code> 的权限设置不正确，可能导致身份验证失败。确保这些目录的权限是安全的。<pre><code class="prism language-bash"><span class="token function">chmod</span> <span class="token number">700</span> ~/.ssh
<span class="token function">chmod</span> <span class="token number">600</span> ~/.ssh/authorized_keys
</code></pre> </li><li><strong>公钥格式问题：</strong> 确保公钥的内容是正确的，没有多余的空格或换行符。</li><li><strong>SSH服务配置问题：</strong> 在目标主机B上，确保SSH服务已正确配置允许公钥身份验证。</li></ul> </li></ul> 
<h4><a id="_36"></a>注意事项：</h4> 
<ul><li>在主机A上的<code>~/.ssh/id_rsa.pub</code> 文件是公钥文件，可以在其中找到复制到目标主机B的公钥。</li><li>如果使用不同的用户名，确保在命令中替换<code>username</code>为目标主机B上的实际用户名。</li><li>在SSH连接时，可以通过添加<code>-v</code>选项查看详细的调试信息，帮助诊断问题。</li></ul> 
<p>如果出现问题，根据错误信息进行调试，并根据上述失败情况和解决方法进行修复。</p> 
<p>4.0</p> 
<p>要在Linux系统中使用SSH公钥实现免密码登录，你需要在本地机器上生成一对密钥，并将公钥复制到远程服务器。以下是具体操作步骤及其命令。</p> 
<h4><a id="_47"></a>在本地生成密钥对</h4> 
<ol><li> <p>打开一个终端。</p> </li><li> <p>运行 <code>ssh-keygen</code> 命令来生成新的密钥对。</p> <pre><code class="prism language-bash">ssh-keygen <span class="token parameter variable">-t</span> rsa <span class="token parameter variable">-b</span> <span class="token number">4096</span>
</code></pre> <p><code>-t rsa</code> 指定了密钥类型为RSA，<code>-b 4096</code> 指定了密钥长度为4096位。</p> </li><li> <p>系统会提示你输入保存密钥对的文件名（默认为 <code>~/.ssh/id_rsa</code>）。</p> </li><li> <p>接着系统会提示你输入密钥的密码短语（passphrase），不希望设置可以直接按回车跳过。</p> </li><li> <p>成功生成密钥后，你将看到如下信息：</p> <pre><code>Your identification has been saved in /your/home/directory/.ssh/id_rsa.
Your public key has been saved in /your/home/directory/.ssh/id_rsa.pub.
</code></pre> </li></ol> 
<h4><a id="_67"></a>将公钥复制到远程服务器</h4> 
<ol><li> <p>使用 <code>ssh-copy-id</code> 命令将公钥添加到远程服务器的 <code>~/.ssh/authorized_keys</code> 文件中。</p> <pre><code class="prism language-bash">ssh-copy-id user@remote_host
</code></pre> <p>其中，<code>user</code> 是远程服务器的用户名，<code>remote_host</code> 是远程服务器的地址或主机名。</p> </li><li> <p>输入远程用户的密码进行认证。</p> </li><li> <p>成功添加后，你将看到类似以下输出：</p> <pre><code>Number of key(s) added: 1

Now try logging into the machine, with:   "ssh 'user@remote_host'"
and check to make sure that only the key(s) you wanted were added.
</code></pre> </li></ol> 
<h4><a id="_85"></a>验证免密码登录是否成功</h4> 
<ol><li> <p>现在，尝试使用SSH登录远程服务器，如果一切正常，你应该不需要输入密码：</p> <pre><code class="prism language-bash"><span class="token function">ssh</span> user@remote_host
</code></pre> </li><li> <p>如果设置了密钥密码短语，第一次使用时可能会被要求输入。</p> </li><li> <p>登录成功后，你将进入远程服务器的shell。</p> </li></ol> 
<h4><a id="_96"></a>处理失败的情况</h4> 
<ul><li> <p><strong>Permission Denied</strong>：如果收到“权限拒绝”的消息，请检查远程服务器的 <code>~/.ssh/authorized_keys</code> 文件权限是否设置正确（应为600），以及 <code>~/.ssh</code> 目录的权限（应为700）。</p> </li><li> <p><strong>Connection Refused</strong>：如果连接被拒绝，请检查远程服务器是否运行着SSH服务，以及你是否使用了正确的端口和IP地址。</p> </li><li> <p><strong>No such file or directory</strong>：如果出现这个错误，可能是因为远程服务器上不存在 <code>~/.ssh</code> 目录，你需要手动创建它并设置正确的权限。</p> </li><li> <p><strong>The agent has no identities</strong>：如果碰到这个错误，意味着SSH代理没有加载私钥。可以使用 <code>ssh-add ~/.ssh/id_rsa</code> 来解决。</p> </li><li> <p><strong>Timeout</strong>：如果SSH尝试超时，请检查网络连接，确保远程主机可达，并且SSH端口（默认为22）没有被防火墙阻塞。</p> </li></ul> 
<p>记住，任何时候更改了 <code>~/.ssh/authorized_keys</code> 文件或相关目录和文件的权限，都可能需要重新验证和调整设置。如果遇到问题，查看日志文件通常有助于诊断，例如通过 <code>journalctl -u ssh</code> 或查看 <code>/var/log/auth.log</code>（取决于你的Linux发行版）。</p> 
<hr> 
<p>阮一峰大神的文章每读一次都收获满满。必读系列<br> <a href="https://wangdoc.com/ssh/key" rel="nofollow">《SSH密钥登录》</a><br> <a href="https://www.ruanyifeng.com/blog/2011/12/ssh_remote_login.html" rel="nofollow">《SSH原理和运用：远程登录》</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4e9762e427b2a6e28d1555b469af1697/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">re:Invent2023技术上新｜使用Amazon Q Code Transformation升级Java应用程序（预览版）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ab09ec556c0ea465656209dc7319e84c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【解决方案】智能语音模块，东胜物联远场语音解决方案让控制更简单，应用于智能家居等场景</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>