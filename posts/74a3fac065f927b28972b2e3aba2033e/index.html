<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>gazebo中仿真双目相机(stereo camera) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="gazebo中仿真双目相机(stereo camera)" />
<meta property="og:description" content="注：在gazebo中为px4添加相机，可以参考这篇 博客
1、仿真环境 仿真环境为 ROS-Academy-for-Beginners
环境搭建过程参考：https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/chapter1/1.5.html
2、双目相机 sdf文件 &lt;!-- stereo camera --&gt; &lt;gazebo reference=&#34;camera_link&#34;&gt; &lt;sensor type=&#34;multicamera&#34; name=&#34;stereocamera&#34;&gt; &lt;always_on&gt;true&lt;/always_on&gt; &lt;update_rate&gt;10&lt;/update_rate&gt; &lt;visualize&gt;false&lt;/visualize&gt; &lt;camera name=&#34;left&#34;&gt; &lt;pose&gt;0 0 0 0 0 0&lt;/pose&gt; &lt;horizontal_fov&gt;1.047&lt;/horizontal_fov&gt; &lt;image&gt; &lt;width&gt;320&lt;/width&gt; &lt;height&gt;240&lt;/height&gt; &lt;/image&gt; &lt;clip&gt; &lt;near&gt;0.1&lt;/near&gt; &lt;far&gt;100&lt;/far&gt; &lt;/clip&gt; &lt;/camera&gt; &lt;camera name=&#34;right&#34;&gt; &lt;pose&gt;0 -0.07 0 0 0 0&lt;/pose&gt; &lt;horizontal_fov&gt;1.047&lt;/horizontal_fov&gt; &lt;image&gt; &lt;width&gt;320&lt;/width&gt; &lt;height&gt;240&lt;/height&gt; &lt;/image&gt; &lt;clip&gt; &lt;near&gt;0.1&lt;/near&gt; &lt;far&gt;100&lt;/far&gt; &lt;/clip&gt; &lt;/camera&gt; &lt;plugin name=&#34;stereo_camera_controller&#34; filename=&#34;libgazebo_ros_multicamera.so&#34;&gt; &lt;cameraName&gt;stereocamera&lt;/cameraName&gt; &lt;alwaysOn&gt;true&lt;/alwaysOn&gt; &lt;updateRate&gt;10&lt;/updateRate&gt; &lt;cameraName&gt;stereocamera&lt;/cameraName&gt; &lt;imageTopicName&gt;image_raw&lt;/imageTopicName&gt; &lt;cameraInfoTopicName&gt;camera_info&lt;/cameraInfoTopicName&gt; &lt;frameName&gt;camera_link_optical&lt;/frameName&gt; &lt;baseline&gt;0.07&lt;/baseline&gt; &lt;distortion_k1&gt;0.0&lt;/distortion_k1&gt; &lt;distortion_k2&gt;0.0&lt;/distortion_k2&gt; &lt;distortion_k3&gt;0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/74a3fac065f927b28972b2e3aba2033e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-09T16:22:22+08:00" />
<meta property="article:modified_time" content="2020-02-09T16:22:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">gazebo中仿真双目相机(stereo camera)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>注：在gazebo中为px4添加相机，可以参考这篇 <a href="https://blog.csdn.net/CSDNZSX/article/details/104949203"><span style="color:#3399ea;">博客</span></a></strong></p> 
<h3>1、仿真环境</h3> 
<p>仿真环境为<strong> ROS-Academy-for-Beginners</strong></p> 
<p>环境搭建过程参考：<a href="https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/chapter1/1.5.html" rel="nofollow">https://sychaichangkun.gitbooks.io/ros-tutorial-icourse163/content/chapter1/1.5.html</a></p> 
<h3>2、双目相机 sdf文件</h3> 
<pre class="has"><code class="language-html">  &lt;!-- stereo camera --&gt;
    &lt;gazebo reference="camera_link"&gt;  
      &lt;sensor type="multicamera" name="stereocamera"&gt;
        &lt;always_on&gt;true&lt;/always_on&gt;
        &lt;update_rate&gt;10&lt;/update_rate&gt;
        &lt;visualize&gt;false&lt;/visualize&gt;
        &lt;camera name="left"&gt;
          &lt;pose&gt;0 0 0 0 0 0&lt;/pose&gt;
          &lt;horizontal_fov&gt;1.047&lt;/horizontal_fov&gt;
          &lt;image&gt;
            &lt;width&gt;320&lt;/width&gt;
            &lt;height&gt;240&lt;/height&gt;
          &lt;/image&gt;
          &lt;clip&gt;
            &lt;near&gt;0.1&lt;/near&gt;
            &lt;far&gt;100&lt;/far&gt;
          &lt;/clip&gt;
        &lt;/camera&gt;
        &lt;camera name="right"&gt;
          &lt;pose&gt;0 -0.07 0 0 0 0&lt;/pose&gt;
          &lt;horizontal_fov&gt;1.047&lt;/horizontal_fov&gt;
          &lt;image&gt;
            &lt;width&gt;320&lt;/width&gt;
            &lt;height&gt;240&lt;/height&gt;
          &lt;/image&gt;
          &lt;clip&gt;
            &lt;near&gt;0.1&lt;/near&gt;
            &lt;far&gt;100&lt;/far&gt;
          &lt;/clip&gt;
        &lt;/camera&gt;        
        &lt;plugin name="stereo_camera_controller" filename="libgazebo_ros_multicamera.so"&gt;
          &lt;cameraName&gt;stereocamera&lt;/cameraName&gt;
          &lt;alwaysOn&gt;true&lt;/alwaysOn&gt;
          &lt;updateRate&gt;10&lt;/updateRate&gt;
          &lt;cameraName&gt;stereocamera&lt;/cameraName&gt;
          &lt;imageTopicName&gt;image_raw&lt;/imageTopicName&gt;
          &lt;cameraInfoTopicName&gt;camera_info&lt;/cameraInfoTopicName&gt;
          &lt;frameName&gt;camera_link_optical&lt;/frameName&gt;
          &lt;baseline&gt;0.07&lt;/baseline&gt;
          &lt;distortion_k1&gt;0.0&lt;/distortion_k1&gt;
          &lt;distortion_k2&gt;0.0&lt;/distortion_k2&gt;
          &lt;distortion_k3&gt;0.0&lt;/distortion_k3&gt;
          &lt;distortion_t1&gt;0.0&lt;/distortion_t1&gt;
          &lt;distortion_t2&gt;0.0&lt;/distortion_t2&gt;
        &lt;/plugin&gt;
      &lt;/sensor&gt;
    &lt;/gazebo&gt;</code></pre> 
<h3>3 、将双目相机添加到仿真机器人<span style="color:#f33b45;"><strong>xbot-u</strong></span>中</h3> 
<p>找到 <strong><span style="color:#86ca5e;">ROS-Academy-for-Beginners/robot_sim_demo/urdf</span></strong> 中 <span style="color:#f33b45;"><strong>xbot-u.gazebo文件</strong></span></p> 
<p><img alt="" class="has" height="272" src="https://images2.imgbox.com/4e/bb/73Uo8uSG_o.png" width="534"></p> 
<p> 将双目相机代码添加到<span style="color:#f33b45;"><strong>xbot-u.gazebo</strong></span>文件中</p> 
<p><img alt="" class="has" height="513" src="https://images2.imgbox.com/95/17/hPkz0kXj_o.png" width="700"></p> 
<h3> 4、<strong>编写程序读取双目相机的左右图</strong></h3> 
<pre class="has"><code class="language-cpp">#include &lt;ros/ros.h&gt;  
#include&lt;sensor_msgs/image_encodings.h&gt; //ROS图象类型的编码函数
#include&lt;image_transport/image_transport.h&gt; //用来在ROS系统中的话题上发布和订阅图象消息

//OpenCV2标准头文件
#include&lt;opencv2/core/core.hpp&gt;
#include&lt;opencv2/highgui/highgui.hpp&gt;
#include&lt;opencv2/imgproc/imgproc.hpp&gt;
#include&lt;cv_bridge/cv_bridge.h&gt;     //cv_bridge中包含CvBridge库

#include&lt;iostream&gt; //C++标准输入输出库
using namespace std;

//消息订阅回调函数
void subLeftImage_cb(const sensor_msgs::ImageConstPtr&amp; msg)
{
    try
    {
        cout &lt;&lt; " image_L receive success " &lt;&lt; endl;
        cv::imshow("image_l",cv_bridge::toCvShare(msg,"bgr8")-&gt;image);
        cv::waitKey(10);//因为highgui处理来自cv::imshow()的绘制请求需要时间 10代表10ms
    }
    catch (cv_bridge::Exception&amp; e)
    {
        cout &lt;&lt; "Could not convert from " &lt;&lt; msg-&gt;encoding.c_str() &lt;&lt; "to 'brg8'." &lt;&lt; endl;
    }   
}
void subRightImage_cb(const sensor_msgs::ImageConstPtr&amp; msg)
{
    try
    {
        cout &lt;&lt; " image_R receive success " &lt;&lt; endl;
        cv::imshow("image_r",cv_bridge::toCvShare(msg,"bgr8")-&gt;image);
        cv::waitKey(10);//因为highgui处理来自cv::imshow()的绘制请求需要时间 10代表10ms
    }
    catch (cv_bridge::Exception&amp; e)
    {
        cout &lt;&lt; "Could not convert from " &lt;&lt; msg-&gt;encoding.c_str() &lt;&lt; "to 'brg8'." &lt;&lt; endl;
    }   
}
int main(int argc, char *argv[])
{
    ros::init(argc, argv, "subscribImage");

    ros::NodeHandle nh;//创建句柄
    image_transport::ImageTransport it(nh);

    image_transport::Subscriber sub_L;
    image_transport::Subscriber sub_R;

    //设置订阅主题 camera/image
    sub_L = it.subscribe("stereocamera/left/image_raw",1,subLeftImage_cb);
    sub_R = it.subscribe("stereocamera/right/image_raw",1,subRightImage_cb);

    ros::spin();

    return 0;
}
</code></pre> 
<h3> 5、测试</h3> 
<p>启动仿真</p> 
<pre class="has"><code class="language-bash">rlaunch robot_sim_demo robot_spawn.launch</code></pre> 
<p>运行 图像接受程序</p> 
<pre class="has"><code class="language-bash">rosrun opcv_ros subscribImage</code></pre> 
<p><img alt="" class="has" height="449" src="https://images2.imgbox.com/ac/44/IHlZ8yff_o.png" width="800"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/207379843f22ec53a8c81428bce4a04b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Visual Studio 2015软件安装教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d73f24d835ef74c631dd225157b8e796/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">什么是幻读？以及如何解决幻读问题？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>