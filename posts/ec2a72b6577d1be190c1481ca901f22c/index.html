<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32CubeMX：配置硬件CRC 对比软件CRC计算 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32CubeMX：配置硬件CRC 对比软件CRC计算" />
<meta property="og:description" content="关键词： CRC,STM32硬件CRC
调试环境：Keil
编译器：Keil
驱动生成：STM32CubeMX
开发板：STM32F334C8T6 核心开发板
测试目的：
1：记录硬件CRC的使用方法；
2：对比硬件、软件 CRC16 的计算耗时；
一、STM32硬件CRC功能配置 1.1按如下选项配置： 注意：以下配置是为了硬件计算结果与软件计算模式相同。实际硬件配置方式多样，这里仅取如下方式作为对比。
配置参数放大截图
1.2生成代码，并找到 crc.c ,crc.h 文件，里面有crc的初始化代码 代码如下：
#include &#34;crc.h&#34; /* USER CODE BEGIN 0 */ /* USER CODE END 0 */ CRC_HandleTypeDef hcrc; /* CRC init function */ void MX_CRC_Init(void) { /* USER CODE BEGIN CRC_Init 0 */ /* USER CODE END CRC_Init 0 */ /* USER CODE BEGIN CRC_Init 1 */ /* USER CODE END CRC_Init 1 */ hcrc." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ec2a72b6577d1be190c1481ca901f22c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-27T17:05:50+08:00" />
<meta property="article:modified_time" content="2023-11-27T17:05:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32CubeMX：配置硬件CRC 对比软件CRC计算</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p> 关键词： CRC,STM32硬件CRC</p> 
<p>调试环境：Keil</p> 
<p>编译器：Keil</p> 
<p>驱动生成：STM32CubeMX</p> 
<p>开发板：STM32F334C8T6 核心开发板</p> 
<p>测试目的：</p> 
<p>1：记录硬件CRC的使用方法；</p> 
<p>2：对比硬件、软件 CRC16 的计算耗时；</p> 
<h2>一、STM32硬件CRC功能配置</h2> 
<h3>1.1按如下选项配置：</h3> 
<p>注意：以下配置是为了硬件计算结果与软件计算模式相同。实际硬件配置方式多样，这里仅取如下方式作为对比。</p> 
<p><img alt="" height="569" src="https://images2.imgbox.com/c3/6b/rzsEZ39P_o.png" width="1054"></p> 
<p>配置参数放大截图</p> 
<p><img alt="" height="267" src="https://images2.imgbox.com/98/a3/rKjWf2v0_o.png" width="471"></p> 
<h3>1.2生成代码，并找到 crc.c ,crc.h 文件，里面有crc的初始化代码</h3> 
<p><img alt="" height="131" src="https://images2.imgbox.com/83/3c/rqFYWCFT_o.png" width="384"></p> 
<p>代码如下：</p> 
<pre><code class="language-cpp">#include "crc.h"

/* USER CODE BEGIN 0 */

/* USER CODE END 0 */

CRC_HandleTypeDef hcrc;

/* CRC init function */
void MX_CRC_Init(void)
{

  /* USER CODE BEGIN CRC_Init 0 */

  /* USER CODE END CRC_Init 0 */

  /* USER CODE BEGIN CRC_Init 1 */

  /* USER CODE END CRC_Init 1 */
  hcrc.Instance = CRC;
  hcrc.Init.DefaultPolynomialUse = DEFAULT_POLYNOMIAL_DISABLE;
  hcrc.Init.DefaultInitValueUse = DEFAULT_INIT_VALUE_DISABLE;
  hcrc.Init.GeneratingPolynomial = 32773;
  hcrc.Init.CRCLength = CRC_POLYLENGTH_16B;
  hcrc.Init.InitValue = 0xFFFF;
  hcrc.Init.InputDataInversionMode = CRC_INPUTDATA_INVERSION_BYTE;
  hcrc.Init.OutputDataInversionMode = CRC_OUTPUTDATA_INVERSION_ENABLE;
  hcrc.InputDataFormat = CRC_INPUTDATA_FORMAT_BYTES;
  if (HAL_CRC_Init(&amp;hcrc) != HAL_OK)
  {
    Error_Handler();
  }
  /* USER CODE BEGIN CRC_Init 2 */

  /* USER CODE END CRC_Init 2 */

}

void HAL_CRC_MspInit(CRC_HandleTypeDef* crcHandle)
{

  if(crcHandle-&gt;Instance==CRC)
  {
  /* USER CODE BEGIN CRC_MspInit 0 */

  /* USER CODE END CRC_MspInit 0 */
    /* CRC clock enable */
    __HAL_RCC_CRC_CLK_ENABLE();
  /* USER CODE BEGIN CRC_MspInit 1 */

  /* USER CODE END CRC_MspInit 1 */
  }
}

void HAL_CRC_MspDeInit(CRC_HandleTypeDef* crcHandle)
{

  if(crcHandle-&gt;Instance==CRC)
  {
  /* USER CODE BEGIN CRC_MspDeInit 0 */

  /* USER CODE END CRC_MspDeInit 0 */
    /* Peripheral clock disable */
    __HAL_RCC_CRC_CLK_DISABLE();
  /* USER CODE BEGIN CRC_MspDeInit 1 */

  /* USER CODE END CRC_MspDeInit 1 */
  }
}</code></pre> 
<h3>1.3 STM32 库函数的 CRC 计算代码</h3> 
<pre><code class="language-cpp">uint32_t HAL_CRC_Accumulate(CRC_HandleTypeDef *hcrc, uint32_t pBuffer[], uint32_t BufferLength) //累计模式，每次计算都以上一次的结果做初始值
uint32_t HAL_CRC_Calculate(CRC_HandleTypeDef *hcrc, uint32_t pBuffer[], uint32_t BufferLength)  //单次计算模式</code></pre> 
<h2>二、软件CRC16计算代码</h2> 
<h3>2.1 计算方式1</h3> 
<pre><code class="language-cpp">/* CRC16 余式表 */
static uint16_t crctalbeabs[] =
{
    0x0000, 0xCC01, 0xD801, 0x1400, 0xF001, 0x3C00, 0x2800, 0xE401,
    0xA001, 0x6C00, 0x7800, 0xB401, 0x5000, 0x9C01, 0x8801, 0x4400
};

/*!
 *  功  能: CRC16校验
 *  param1: 指向要校验的数据的指针
 *  param2: 要校验的数据的长度
 *  retval: 校验所得到的值，uint16_t 类型
 *
 *  说  明: 本次CRC校验为查表法，多项式为 x16+x15+x2+1(0x8005)，CRC的初始值为0xFFFF
 */
uint16_t Crc16_C(uint8_t *ptr, uint32_t len)
{
    uint16_t crc = 0xffff;
    uint32_t i;
    uint8_t ch;

    for (i = 0; i &lt; len; i++)
    {
        ch = *ptr++;
        crc = crctalbeabs[(ch ^ crc) &amp; 15] ^ (crc &gt;&gt; 4);
        crc = crctalbeabs[((ch &gt;&gt; 4) ^ crc) &amp; 15] ^ (crc &gt;&gt; 4);
    }

    return crc;
}
</code></pre> 
<h3>2.1 计算方式2</h3> 
<pre><code class="language-cpp">#define CRC16_Modbus
static uint16_t yl_crc16(unsigned char *buffer, uint16_t len)
{
#if defined  CRC16_XModem

    int i;
    uint16_t cksum;

    cksum = 0;
    for (i = 0; i &lt; len; i++)
    {
        cksum = crc16_tab[((cksum&gt;&gt;8) ^ *buffer++) &amp; 0xFF] ^ (cksum &lt;&lt; 8);
    }
    return cksum;
#endif

#if defined  CRC16_Modbus
    uint16_t wcrc = 0XFFFF;         //16位crc寄存器预置
    uint8_t temp;
    uint16_t i = 0, j = 0;          //计数
    for (i = 0; i &lt; len; i++)       //循环计算每个数据
    {
        temp = *buffer &amp; 0X00FF;    //将八位数据与crc寄存器亦或
        buffer++;                   //指针地址增加，指向下个数据
        wcrc ^= temp;               //将数据存入crc寄存器
        for (j = 0; j &lt; 8; j++)     //循环计算数据的
        {
            if (wcrc &amp; 0X0001)      //判断右移出的是不是1，如果是1则与多项式进行异或。
            {
                wcrc &gt;&gt;= 1;         //先将数据右移一位
                wcrc ^= 0XA001;     //与上面的多项式进行异或
            }
            else                    //如果不是1，则直接移出
            {
                wcrc &gt;&gt;= 1;         //直接移出
            }
        }
    }

    return wcrc;

#endif
}</code></pre> 
<h2>三、计算对比</h2> 
<p>测试环境 stm32f334c8t6  72M 超频到 96M.</p> 
<p>测试用计算数据：AB 00 00 12 9A 2F B4 00 00 00 1D 00</p> 
<p>CRC16值：93 8D </p> 
<p>软件CRC16计算 耗时：16uS</p> 
<p>硬件CRC16计算 耗时：1.44uS</p> 
<p>在线CRC计算工具：<a href="http://www.ip33.com/crc.html" rel="nofollow" title="http://www.ip33.com/crc.html">http://www.ip33.com/crc.html</a></p> 
<p><img alt="" height="753" src="https://images2.imgbox.com/03/15/wS1O5WNt_o.png" width="898"></p> 
<h2>四、结论 </h2> 
<p>在本次的测试环境下，硬件的计算耗时不到软件的1/10.</p> 
<p>软件CRC16计算 耗时：16uS</p> 
<p>硬件CRC16计算 耗时：1.44uS</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ec152dc2334b545e631431c06540de17/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">深度学习/语义分割入门笔记（一）——遥感影像数据集及标签制作&#43;arcgis批量矢量转栅格</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2c8d00c7567f946c687f2dadb5994de1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">OpenGl的详细安装流程以及OpenGL.error.NullFunctionError:报错解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>