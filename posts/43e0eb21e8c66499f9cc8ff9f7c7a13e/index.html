<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python多线程操作字典_Python：迭代字典而另一个线程修改字典 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python多线程操作字典_Python：迭代字典而另一个线程修改字典" />
<meta property="og:description" content="我有一个pyglet窗口,它有一个属性“observer”.观察者有一本字典“dict”.在main_loop()函数中,窗口根据observer.dict的内容重新绘制窗口.观察者本身是一个读取流的线程,向dict添加读数.观察者还有一个计时器线程,如果dict中有过时的项目,则每秒检查一次,如果是,则删除它们.
显然,如果在窗口迭代dict时添加或删除项目,则可能会导致问题.我目前的解决方法是每次都使dict的深层副本,并绘制副本.它似乎有效,但它是一个丑陋的解决方案.
我对python很新,特别是w.r.t线程/锁定/等等.我想我需要观察者在添加或删除项目时“锁定”dict.有人可以给我一些提示在哪里先看？
我试图提取我的代码的有意义的结构,所有都会太长.我希望你能得到主要的想法.
class GraphConsole(window.Window):
def __init__(self, *args, **kwargs):
window.Window.__init__(self, *args, **kwargs)
def init(self, observer):
self.observer = observer
def main_loop(self):
while not self.has_exit:
...
self.draw()
def draw(self):
dict_copy = deepcopy(self.observer.dict) # &lt;-- UGLY WORKAROUND
for k, v in dict_copy.iteritems():
...
class Observer(threading.Thread):
def __init__(self):
threading.Thread.__init__(self)
self.dict = {}
self.timer = Timer(1, self.delete_obsolete);
self.timer.start()
def run(self):
while True:
...
# read a stream
self.dict.append()
...
def delete_obsolete(self):
...
del self." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/43e0eb21e8c66499f9cc8ff9f7c7a13e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-30T09:02:28+08:00" />
<meta property="article:modified_time" content="2020-11-30T09:02:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python多线程操作字典_Python：迭代字典而另一个线程修改字典</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>我有一个pyglet窗口,它有一个属性“observer”.观察者有一本字典“dict”.在main_loop()函数中,窗口根据observer.dict的内容重新绘制窗口.观察者本身是一个读取流的线程,向dict添加读数.观察者还有一个计时器线程,如果dict中有过时的项目,则每秒检查一次,如果是,则删除它们.</p> 
<p>显然,如果在窗口迭代dict时添加或删除项目,则可能会导致问题.我目前的解决方法是每次都使dict的深层副本,并绘制副本.它似乎有效,但它是一个丑陋的解决方案.</p> 
<p>我对python很新,特别是w.r.t线程/锁定/等等.我想我需要观察者在添加或删除项目时“锁定”dict.有人可以给我一些提示在哪里先看？</p> 
<p>我试图提取我的代码的有意义的结构,所有都会太长.我希望你能得到主要的想法.</p> 
<p>class GraphConsole(window.Window):</p> 
<p>def __init__(self, *args, **kwargs):</p> 
<p>window.Window.__init__(self, *args, **kwargs)</p> 
<p>def init(self, observer):</p> 
<p>self.observer = observer</p> 
<p>def main_loop(self):</p> 
<p>while not self.has_exit:</p> 
<p>...</p> 
<p>self.draw()</p> 
<p>def draw(self):</p> 
<p>dict_copy = deepcopy(self.observer.dict) # &lt;-- UGLY WORKAROUND</p> 
<p>for k, v in dict_copy.iteritems():</p> 
<p>...</p> 
<p>class Observer(threading.Thread):</p> 
<p>def __init__(self):</p> 
<p>threading.Thread.__init__(self)</p> 
<p>self.dict = {}</p> 
<p>self.timer = Timer(1, self.delete_obsolete);</p> 
<p>self.timer.start()</p> 
<p>def run(self):</p> 
<p>while True:</p> 
<p>...</p> 
<p># read a stream</p> 
<p>self.dict.append()</p> 
<p>...</p> 
<p>def delete_obsolete(self):</p> 
<p>...</p> 
<p>del self.dict[...]</p> 
<p>...</p> 
<p>class Timer(threading.Thread):</p> 
<p>def __init__(self, interval_in_seconds, func):</p> 
<p>threading.Thread.__init__(self)</p> 
<p>self.interval_in_seconds = interval_in_seconds</p> 
<p>self.func = func</p> 
<p>def run(self):</p> 
<p>while True:</p> 
<p>self.func();</p> 
<p>time.sleep(self.interval_in_seconds)</p> 
<p>if __name__ == "__main__":</p> 
<p>observer = Observer();</p> 
<p>observer.start()</p> 
<p>graph_console = GraphConsole()</p> 
<p>graph_console.init(observer)</p> 
<p>graph_console.main_loop()</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0672e8df593f43549167e21b985a04f9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">踩坑指南！import cv2出错怎么办？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2f1b04e098304a812e3562d61f910f8e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pymesh版本问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>