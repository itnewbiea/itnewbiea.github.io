<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>shell脚本合集、练习题(附答案) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="shell脚本合集、练习题(附答案)" />
<meta property="og:description" content="1.查找网关 dns IP地址
[root@localhost net_subject]# cat showip.sh #!/bin/bash # 显示网卡的ip地址 #ip add|grep &#34;\&lt;inet\&gt;&#34;|awk &#39;{print &#34;网卡&#34;$NF&#34;的ip是&#34;$2}&#39; # 除去本地回环地址的ip ip add|grep &#34;\&lt;inet\&gt;&#34;|grep -v &#34;\&lt;lo\&gt;&#34;|awk &#39;{print &#34;网卡&#34;$NF&#34;的ip是&#34;$2}&#39; # 显示默认网关 ip route|grep &#34;default&#34;|awk &#39;{print &#34;默认网关是&#34;$3}&#39; # 显示DNS服务器 cat /etc/resolv.conf |grep &#34;nameserver&#34;|sed -n &#39;1p&#39;|awk &#39;{print &#34;首选DNS是&#34;$2}&#39; sec=$(cat /etc/resolv.conf |grep &#34;nameserver&#34;|sed -n &#39;2p&#39;|awk &#39;{print &#34;备用DNS是&#34;$2}&#39;) # 判断有误备用DNS服务器 if [[ -z &#34;$sec&#34; ]] ; then echo &#34;无备用DNS&#34; else echo &#34;$sec&#34; fi # 赋予可执行权限 #chmod &#43;x showip.sh # 复制进PATH变量的目录，以方便使用 #cp -p showip." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/43cf3c95be9d17fda578db993da0d9eb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-16T14:45:25+08:00" />
<meta property="article:modified_time" content="2021-01-16T14:45:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">shell脚本合集、练习题(附答案)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>1.查找网关 dns IP地址<br> <img src="https://images2.imgbox.com/6b/4c/oTU9hjQE_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@localhost net_subject]</span><span class="token comment"># cat showip.sh </span>
<span class="token comment">#!/bin/bash</span>

<span class="token comment"># 显示网卡的ip地址</span>
<span class="token comment">#ip add|grep "\&lt;inet\&gt;"|awk '{print "网卡"$NF"的ip是"$2}'</span>
<span class="token comment"># 除去本地回环地址的ip</span>
ip add<span class="token punctuation">|</span>grep <span class="token string">"\&lt;inet\&gt;"</span><span class="token punctuation">|</span>grep <span class="token operator">-</span>v <span class="token string">"\&lt;lo\&gt;"</span><span class="token punctuation">|</span>awk <span class="token string">'{print "网卡"$NF"的ip是"$2}'</span>
<span class="token comment"># 显示默认网关</span>
ip route<span class="token punctuation">|</span>grep <span class="token string">"default"</span><span class="token punctuation">|</span>awk <span class="token string">'{print "默认网关是"$3}'</span>
<span class="token comment"># 显示DNS服务器</span>
<span class="token function">cat</span> <span class="token operator">/</span>etc<span class="token operator">/</span>resolv<span class="token punctuation">.</span>conf <span class="token punctuation">|</span>grep <span class="token string">"nameserver"</span><span class="token punctuation">|</span>sed <span class="token operator">-</span>n <span class="token string">'1p'</span><span class="token punctuation">|</span>awk <span class="token string">'{print "首选DNS是"$2}'</span>
sec=$<span class="token punctuation">(</span><span class="token function">cat</span> <span class="token operator">/</span>etc<span class="token operator">/</span>resolv<span class="token punctuation">.</span>conf <span class="token punctuation">|</span>grep <span class="token string">"nameserver"</span><span class="token punctuation">|</span>sed <span class="token operator">-</span>n <span class="token string">'2p'</span><span class="token punctuation">|</span>awk <span class="token string">'{print "备用DNS是"$2}'</span><span class="token punctuation">)</span>
<span class="token comment"># 判断有误备用DNS服务器</span>
<span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span> <span class="token operator">-</span>z <span class="token string">"<span class="token variable">$sec</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">;</span> then
	<span class="token function">echo</span> <span class="token string">"无备用DNS"</span>
<span class="token keyword">else</span>
	<span class="token function">echo</span> <span class="token string">"<span class="token variable">$sec</span>"</span>
fi

<span class="token comment"># 赋予可执行权限</span>
<span class="token comment">#chmod +x showip.sh</span>

<span class="token comment"># 复制进PATH变量的目录，以方便使用</span>
<span class="token comment">#cp -p showip.sh /bin</span>

<span class="token comment"># 起别名</span>
<span class="token comment">#alias showip=showip.sh</span>

</code></pre> 
<p>2.根据拓扑图 使堡垒机和web/ssh服务器能够上网，且访问router服务器能80端口能访问web服务器的nginx，ssh连接router服务器ip地址2233端口，是转换到堡垒机的。</p> 
<p>拓扑图如下：<br> <img src="https://images2.imgbox.com/80/7d/HtZYaWFA_o.png" alt="在这里插入图片描述"></p> 
<p>脚本代码：</p> 
<pre><code class="prism language-bash">
<span class="token punctuation">[</span>root@sc 1-23<span class="token punctuation">]</span><span class="token comment"># cat iptables-snat-dnat.sh </span>
<span class="token comment">#!/bin/bash</span>

<span class="token comment">#停止firewalld服务</span>
<span class="token function">service</span>  firewalld stop
<span class="token comment">#清除下iptables里的规则</span>
iptables -t nat -F
iptables  -F
<span class="token comment">#disabled  selinux</span>
setenforce  0
<span class="token function">sed</span>  -i  <span class="token string">'/^SELINUX=/  s/enforcing/disabled/'</span> /etc/sysconfig/selinux
<span class="token comment">#开启路由功能</span>
<span class="token keyword">echo</span> 1 <span class="token operator">&gt;</span>/proc/sys/net/ipv4/ip_forward

<span class="token comment">#配置SNAT策略，实现snat功能,将所有内网是192.168.88.0这个网段的ip包的源ip修改为192.168.0.77</span>
iptables  -t  nat  -A POSTROUTING  -s  192.168.88.0/24 -o ens33 -j SNAT --to-source 192.168.0.77

<span class="token comment">#配置DNAT策略,发布内网的web服务器192.168.88.80</span>
iptables  -t nat  -A  PREROUTING  -d 192.168.0.77 -p tcp  --dport 80 -i ens33 -j DNAT  --to-destination  192.168.88.80
<span class="token comment">#配置DNAT策略,发布内网的ssh堡垒机192.168.88.190,访问防火墙机器的2233端口转发到内网的192.158.50.2的22号端口</span>
iptables  -t nat  -A  PREROUTING  -d 192.168.0.77 -p tcp  --dport 2233 -i ens33 -j DNAT  --to-destination  192.168.88.190:22
</code></pre> 
<p>结果：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@sc 1-23<span class="token punctuation">]</span><span class="token comment"># iptables -L -t nat -n</span>
Chain PREROUTING <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         
DNAT       tcp  --  0.0.0.0/0            192.168.0.77         tcp dpt:80 to:192.168.88.80
DNAT       tcp  --  0.0.0.0/0            192.168.0.77         tcp dpt:2233 to:192.168.88.190:22

Chain INPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         

Chain POSTROUTING <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination         
SNAT       all  --  192.168.88.0/24      0.0.0.0/0            to:192.168.0.77

Chain OUTPUT <span class="token punctuation">(</span>policy ACCEPT<span class="token punctuation">)</span>
target     prot opt <span class="token function">source</span>               destination     
</code></pre> 
<p><strong>3.编写一个清除iptables规则。</strong><br> 注意：默认规则是不会被清除的</p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@web-server ~]</span><span class="token comment"># cat clear_iptables.sh </span>
<span class="token comment">#!/bin/bash</span>

<span class="token comment">#清除filter和nat表里的规则</span>
iptables  <span class="token operator">-</span>t <span class="token keyword">filter</span> <span class="token operator">-</span>F
iptables <span class="token operator">-</span>t nat <span class="token operator">-</span>F

<span class="token comment">#设置filter表的INPUT链的默认策略为ACCEPT</span>
iptables <span class="token operator">-</span>t <span class="token keyword">filter</span> <span class="token operator">-</span>P INPUT  ACCEPT

</code></pre> 
<ol start="4"><li></ol> 
<pre><code class="prism language-markup">练习：
	1.运行192.168.0.0/24（可以根据你家里上网的网段修改）网段的主机访问本机的web、ftp、ssh、mysql服务
	-s 192.168.0.0/24 
	ssh 22  tcp
	ftp 21  tcp
	mysql 3306   tcp
	nginx  80  443   tcp

	2.允许任何人都可以访问本机的dns服务--》53 udp
	3.禁止其他的电脑ping本机，但是本机可以ping其他电脑
	4.默认的INPUT链规则设置为DROP
	5.所有的规则生效后要保存，同时如果重启机器，希望也是生效的
</code></pre> 
<p>脚本：</p> 
<pre><code class="prism language-powershell"><span class="token namespace">[root@web-server ~]</span><span class="token comment"># cat open_port_iptables.sh </span>
<span class="token comment">#!/bin/bash</span>

<span class="token comment">#初始化iptables的规则</span>
iptables <span class="token operator">-</span>t <span class="token keyword">filter</span>  <span class="token operator">-</span>F
iptables <span class="token operator">-</span>t nat <span class="token operator">-</span>F

<span class="token comment">#设置INPUT链默认的策略为DROP</span>
iptables <span class="token operator">-</span>P INPUT DROP

<span class="token comment">#open  ssh </span>
iptables <span class="token operator">-</span>A INPUT  <span class="token operator">-</span>s 192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token operator">/</span>24 <span class="token operator">-</span>p tcp  <span class="token operator">--</span>dport 22 <span class="token operator">-</span>j ACCEPT

<span class="token comment">#open nginx  80 443</span>
iptables <span class="token operator">-</span>A INPUT  <span class="token operator">-</span>p tcp <span class="token operator">--</span>dport 80 <span class="token operator">-</span>j ACCEPT
iptables <span class="token operator">-</span>A INPUT  <span class="token operator">-</span>p tcp <span class="token operator">--</span>dport 443 <span class="token operator">-</span>j ACCEPT

<span class="token comment">#open mysql 3306</span>
iptables  <span class="token operator">-</span>A INPUT <span class="token operator">-</span>p tcp  <span class="token operator">--</span>dport 3306 <span class="token operator">-</span>j ACCEPT
<span class="token comment">#open dns 53 udp</span>
iptables  <span class="token operator">-</span>A INPUT <span class="token operator">-</span>p udp  <span class="token operator">--</span>dport 53 <span class="token operator">-</span>j ACCEPT

<span class="token comment">#open ftp 21</span>
iptables  <span class="token operator">-</span>A INPUT <span class="token operator">-</span>p tcp  <span class="token operator">--</span>dport 21 <span class="token operator">-</span>j ACCEPT

<span class="token comment">#ping</span>
iptables  <span class="token operator">-</span>A INPUT <span class="token operator">-</span>p icmp  <span class="token operator">--</span>icmp<span class="token operator">-</span><span class="token function">type</span> 8 <span class="token operator">-</span>j DROP
iptables <span class="token operator">-</span>A INPUT <span class="token operator">-</span>p icmp <span class="token operator">--</span>icmp<span class="token operator">-</span><span class="token function">type</span> 0 <span class="token operator">-</span>j ACCEPT

<span class="token namespace">[root@web-server ~]</span><span class="token comment"># </span>

<span class="token namespace">[root@web-server ~]</span><span class="token comment"># iptables-save &gt;/etc/sysconfig/iptables-config </span>

如何开机让linux系统去加载保存的iptables规则？
<span class="token namespace">[root@localhost ~]</span><span class="token comment"># chmod +x /etc/rc.d/rc.local</span>
写到<span class="token operator">/</span>etc<span class="token operator">/</span>rc<span class="token punctuation">.</span>local文件里
iptables<span class="token operator">-</span>restore &lt; <span class="token operator">/</span>etc<span class="token operator">/</span>sysconfig<span class="token operator">/</span>iptables<span class="token operator">-</span>config 
<span class="token namespace">[root@localhost ~]</span><span class="token comment"># </span>
</code></pre> 
<p>5.写一个关于一个判断进程起了没有？</p> 
<pre><code class="prism language-powershell">
</code></pre> 
<p>6.写个脚本执行mysql语句</p> 
<pre><code class="prism language-bash"><span class="token shebang important">#!/bin/bash</span>

mysql -uroot -p<span class="token string">'Sanchuang123#'</span> <span class="token operator">&lt;&lt;</span>EOF
create database jiangzihan2<span class="token punctuation">;</span>
use jiangzihan2<span class="token punctuation">;</span>
create table student<span class="token punctuation">(</span>id int<span class="token punctuation">)</span><span class="token punctuation">;</span>
insert into student<span class="token punctuation">(</span>id<span class="token punctuation">)</span> values<span class="token punctuation">(</span>1<span class="token punctuation">)</span>,<span class="token punctuation">(</span>6<span class="token punctuation">)</span>,<span class="token punctuation">(</span>9<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">select</span> * from student<span class="token punctuation">;</span>
EOF
<span class="token keyword">echo</span> <span class="token string">"查询的结果如上:"</span>
</code></pre> 
<ol start="7"><li></ol>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8c570733120111dc102cf35ba230a240/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Fusion of multispectral data through illumination-aware deep neural networks for pedestrian det</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/27d958453a4fc4002167c91c8ebe6108/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">区块链——配置和使用geth</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>