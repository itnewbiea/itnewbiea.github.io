<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CPU使用率100%如何定位分析？ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CPU使用率100%如何定位分析？" />
<meta property="og:description" content="1、首先通过top指令查看当前占用CPU较高的进程PID $ top -c 2、按下”shift&#43;p”找到CPU使用率最高的进程 （按shft&#43;p按照cpu占用进行排序，按shift&#43;m按照内存占用进行排序）
此时发现9331的java进程CPU高达253.4%，且一直降不下来，很显然9331这个进程出现了问题。
top - 17:57:20 up 91 days, 20:37, 1 user, load average: 3.34, 3.14, 2.23 Tasks: 180 total, 1 running, 179 sleeping, 0 stopped, 0 zombie Cpu(s): 46.1%us, 13.4%sy, 0.0%ni, 36.2%id, 0.1%wa, 0.0%hi, 2.5%si, 1.7%st Mem: 8059860k total, 7888496k used, 171364k free, 22648k buffers Swap: 10485752k total, 0k used, 10485752k free, 2750132k cached PID USER PR NI VIRT RES SHR S %CPU %MEM TIME&#43; COMMAND 7331 kafka 20 0 43." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/823e309f5b7ab121955da281441d075b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-17T13:50:57+08:00" />
<meta property="article:modified_time" content="2023-03-17T13:50:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CPU使用率100%如何定位分析？</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1、首先通过top指令查看当前占用CPU较高的进程PID</h2> 
<pre><code class="language-bash">$ top -c</code></pre> 
<p></p> 
<h2>2、按下”shift+p”找到CPU使用率最高的进程</h2> 
<p>（按shft+p按照cpu占用进行排序，按shift+m按照内存占用进行排序）</p> 
<p>此时发现9331的java进程CPU高达253.4%，且一直降不下来，很显然9331这个进程出现了问题。</p> 
<pre><code class="language-bash">top - 17:57:20 up 91 days, 20:37,  1 user,  load average: 3.34, 3.14, 2.23
Tasks: 180 total,   1 running, 179 sleeping,   0 stopped,   0 zombie
Cpu(s): 46.1%us, 13.4%sy,  0.0%ni, 36.2%id,  0.1%wa,  0.0%hi,  2.5%si,  1.7%st
Mem:   8059860k total,  7888496k used,   171364k free,    22648k buffers
Swap: 10485752k total,        0k used, 10485752k free,  2750132k cached

  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND
 7331 kafka     20   0 43.2g 4.3g  16m S 253.4 56.2   3942:19 /home/kafka/software/java/bin/java -Xms4G -Xmx4G -server -XX:+UseG1GC -XX:MaxGCPauseMi</code></pre> 
<h2></h2> 
<h2>3、使用top -Hp命令定位线程</h2> 
<p>因为java使用的是单进程多线程，所有需要通过进程PID（7331）找到CPU最高的线程</p> 
<pre><code class="language-bash">$ top -Hp 7331</code></pre> 
<p>很容易发现，多个线程的CPU占用达到了56%多。我们挑选线程号为7573的线程继续分析。</p> 
<blockquote> 
 <p>top - 18:01:28 up 91 days, 20:41,  1 user,  load average: 1.90, 2.31, 2.08<br> Tasks:  90 total,   6 running,  84 sleeping,   0 stopped,   0 zombie<br> Cpu(s): 43.2%us, 14.6%sy,  0.0%ni, 38.4%id,  0.1%wa,  0.0%hi,  3.0%si,  0.8%st<br> Mem:   8059860k total,  7888236k used,   171624k free,    24888k buffers<br> Swap: 10485752k total,        0k used, 10485752k free,  2741760k cached</p> 
 <p>  PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND<br>  7535 kafka     20   0 43.6g 4.3g  11m R 21.0 56.2 318:04.55 java<br>  7481 kafka     20   0 43.6g 4.3g  11m R 20.0 56.2 230:05.61 java<br>  7534 kafka     20   0 43.6g 4.3g  11m S 18.6 56.2 297:30.55 java<br>  7475 kafka     20   0 43.6g 4.3g  11m S 16.3 56.2 229:33.86 java<br>  7477 kafka     20   0 43.6g 4.3g  11m S 15.6 56.2 229:55.57 java<br>  7478 kafka     20   0 43.6g 4.3g  11m S 15.3 56.2 229:38.64 java<br>  7482 kafka     20   0 43.6g 4.3g  11m R 15.0 56.2 230:00.66 java</p> 
</blockquote> 
<p></p> 
<h2>4、将线程id转成16进制</h2> 
<p>printf “%x\n” 命令（tid指线程的id号）将以上10进制的线程号转换为16进制：</p> 
<pre><code class="language-bash">$ printf %x 7535</code></pre> 
<blockquote> 
 <p>1d6f</p> 
</blockquote> 
<p></p> 
<h2>5、使用jstack命令导出java进程的线程快照，再根据16进制县城号定位具体代码</h2> 
<p>因为 1d6f 为十六进制，所以加上0x在grep会跟准确，不然可能会被其他信息干扰。</p> 
<pre><code class="language-bash">$ jstack 7331 | grep "0x1d6f" -C30 --color</code></pre> 
<h2>6、找到具体的代码，就可以看源码分析问题原因。</h2> 
<p>此处不再做介绍，因为没有案例截图，以后再补充。</p> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c56b6464c203ac30bb864b845590aac6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue2和vue3的 区别 （深度篇）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c29589a2de431cdf2e5fb78f43b058ec/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">DM9051--TCP通信实验（基于STM32CUBEMX）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>