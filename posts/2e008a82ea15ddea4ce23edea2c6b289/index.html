<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【pytorch学习03】预训练图像识别分类预测 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【pytorch学习03】预训练图像识别分类预测" />
<meta property="og:description" content="下载安装mmcv-full（openmmlab里面最基础的算法库）：对视频进行逐帧的分析，把每一帧画面的中间结果保存到目录里，最后把所有帧的中间结果串成一个视频文件
ImageNet1000类别信息，用于检测算法实现效果的数据集
我们今天用的是别人已经训练好的模型
# 创建目录
import os
# 存放测试图片
os.mkdir(&#39;test_img&#39;)
# 存放结果图片
os.mkdir(&#39;output&#39;)
把图片换成视频/实时摄像头画面
Import os # 导入操作系统库
Cv2 导入opencv
import os # 操作系统库
import cv2 # 导入opencv
import pandas as pd # 数据处理
import numpy as np
import torch # pytorch
import matplotlib.pyplot as plt # 数据可视化，画图
# 载入预训练图像分类模型
from torchvision import models
model = models.resnet18(pretrained=True) # 表示有18层网络，层数越高，深度学习越深
model = model.eval() # 设为评估模式
model = model.to(device) # 将模型放到设备GPU/CPU里面" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/2e008a82ea15ddea4ce23edea2c6b289/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-20T02:41:13+08:00" />
<meta property="article:modified_time" content="2023-01-20T02:41:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【pytorch学习03】预训练图像识别分类预测</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:0;">下载安装mmcv-full（openmmlab里面最基础的算法库）：对视频进行逐帧的分析，把每一帧画面的中间结果保存到目录里，最后把所有帧的中间结果串成一个视频文件</p> 
<p style="margin-left:0;">ImageNet1000类别信息，用于检测算法实现效果的数据集</p> 
<p style="margin-left:0;">我们今天用的是别人已经训练好的模型</p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"><span style="color:#000000;"># 创建目录</span></p> 
<p style="margin-left:0;"><span style="color:#000000;">import os</span></p> 
<p style="margin-left:0;"><span style="color:#000000;"># 存放测试图片</span></p> 
<p style="margin-left:0;"><span style="color:#000000;">os.mkdir(</span><span style="color:#a31515;">'test_img'</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;"><span style="color:#000000;"># 存放结果图片</span></p> 
<p style="margin-left:0;"><span style="color:#000000;">os.mkdir(</span><span style="color:#a31515;">'output'</span><span style="color:#000000;">)</span></p> 
<p style="margin-left:0;"><span style="color:#000000;"> </span></p> 
<p style="margin-left:0;"><span style="color:#000000;">把图片换成视频/实时摄像头画面</span></p> 
<p style="margin-left:0;"><span style="color:#000000;">Import os # 导入操作系统库</span></p> 
<p style="margin-left:0;"><span style="color:#000000;">Cv2 导入opencv</span></p> 
<p style="margin-left:0;"></p> 
<p style="margin-left:0;"></p> 
<p>import os # 操作系统库</p> 
<p>import cv2 # 导入opencv</p> 
<p>import pandas as pd # 数据处理</p> 
<p>import numpy as np</p> 
<p>import torch  # pytorch</p> 
<p>import matplotlib.pyplot as plt # 数据可视化，画图</p> 
<p></p> 
<p># 载入预训练图像分类模型</p> 
<p>from torchvision import models</p> 
<p></p> 
<p>model = models.resnet18(pretrained=True)  # 表示有18层网络，层数越高，深度学习越深</p> 
<p></p> 
<p>model = model.eval()  # 设为评估模式</p> 
<p>model = model.to(device) # 将模型放到设备GPU/CPU里面</p> 
<p></p> 
<p># 测试集集的图像、用户新上传的图像、视频的帧、摄像头的实时画面</p> 
<p></p> 
<p>Resize:把任何一张图像，缩放成256x256大小</p> 
<p>CenterCrop:裁剪成224大小的图象</p> 
<p>把方框转成pytorch的张量</p> 
<p>对RGB三通道做归一化，减去均值，除以标准差</p> 
<p>（这6个数是人们总结之后的标准数值）</p> 
<p>做缩放的归一化：每个像素减去它所在的通道的均值，再除以它所在通道的标准差</p> 
<p></p> 
<p>更容易被神经网络处理</p> 
<p></p> 
<p>#  1张3通道的224x224图像</p> 
<p>要传入pytorch必须整理成这样的数据维度</p> 
<p></p> 
<p>pred_logits # 1000个类别的分数（有+/-）</p> 
<p>pred_softmax把每一个logits的分数转成了0-1的概率，并且求合为1</p> 
<p></p> 
<p>有多种形态的，多种分布的，不适合做成图像分类数据集供基础算法去训练和测试</p> 
<p><br>  </p> 
<p>pytorch要求输入到tsettransform里面的都是pil格式</p> 
<p>opencv载入的是BGR格式，而pil载入的是RGB模式</p> 
<p>img_rgb = cv2.cvtColor(img， cv2.COLOR_BGR2RGB) # BGR 转 RGB</p> 
<p></p> 
<p>pil文件——RGB转BGR</p> 
<p>img_bgr = cv2.cvtColor(np.array(img_pil),cv2.COLOR_RGB2BGR)  # RGB 转 BGR</p> 
<p></p> 
<p>给出了——凡是对视频进行逐帧处理都可以用这套代码模板</p> 
<p>先用opencv把视频读进来，生成一个进度条</p> 
<p># 对视频进行逐帧处理，获取的是第几帧和画面本身</p> 
<p>然后再进行逐帧处理，再更新进度条</p> 
<p>每一帧都存到目录中，再用frames2video,串成视频</p> 
<p></p> 
<p># 获取设备——有GPU就用GPU，没有就用CPU</p> 
<p>device = torch.device('cuda:0' if torch.cuda.is_available() else 'cpu')</p> 
<p></p> 
<p>导包，获取设备，载入预训练分类模型，载入ImageNet1000标签，预处理，先获取摄像头的一帧画面</p> 
<p>获取系统默认摄像头，cap.open(0)mac为1，wins为0</p> 
<p style="margin-left:0;"><span style="color:#000000;"> </span></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/85833da43195a1b1f7de77ef6710f85f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">yolov5源码解析(10)--损失计算与anchor</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/51e3bbca1b6630026efb9f9126239966/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用Docker打包镜像并发布</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>