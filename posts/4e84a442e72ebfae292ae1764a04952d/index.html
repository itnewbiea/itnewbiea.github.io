<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>海康工业相机功能模块-IO输入输出控制 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="海康工业相机功能模块-IO输入输出控制" />
<meta property="og:description" content="海康工业相机功能模块sdk调用介绍
IO输入输出控制 前言IO输入IO输出 前言 机器视觉行业里面，相机作为最重要的图像传感器，除了主要的拍摄功能外，它也承担了一部分信号控制功能.
一方面能够接受外部的触发信号例如PLC、光电传感器等，进行指定时刻拍照；另外一方面，能够输出IO信号，控制外围机构进行机械运动；
海康标准工业相机，支持1路GPIO输入，1路GPIO输出，一路可配置的IO输出（非光耦），本文主要讲一下如何使用SDK进行IO配置以及注意事项
IO输入 IO输入的主要作用就是，相机通过IO管脚，收到1个IO信号，相机就立即拍摄一帧图像；
通用的使用方法如下代码依次设置：
触发模式：TriggerMode设置为1，开启触发模式触发源选择：TriggerSource设置为0，选择line0，也可以选择line2，或者选择anyway；line0、line2取决于硬件电路接线，anyway支持软触发、硬触发同时使用，需要看相机是否支持沿信号TriggerActivation：默认上升沿触发（可以不设置）触发缓存TriggerCacheEnable：默认不开启。当相机同时收到两个触发信号时，不开启此功能，相机只会响应1个信号，出一张图；开启后，相机会自动缓存第二个信号，上个信号处理完毕后，立即处理缓存信号触发延时TriggerDelay：收到信号后，固定延迟一段时间再曝光滤波设置 LineDebouncerTime：去除信号毛刺抖动，根据实际情况进行调节 //C语言代码段：硬触发模式初始化配置 //参数值，仅针对海康工业相机，其他品牌相机需根据对应节点微调 nRet = MV_CC_SetEnumValue(handle, &#34;AcquisitionMode&#34;, 2); //0:SingleFrame 1:MultiFrame 2:Continuous nRet = MV_CC_SetEnumValue(handle, &#34;TriggerMode&#34;, 1);//0：off 1：on nRet = MV_CC_SetEnumValue(handle, &#34;TriggerSource&#34;, 0);//line2也可做输入源，非光耦 //0:Line0 1:Line1 2:Line2 7:Software 8:FrequencyConverter 13：anyway nRet = MV_CC_SetEnumValue(handle, &#34;TriggerActivation&#34;, 0);//0：Rising Edge 1：Falling Edge 2：LevelHigh 3：LevelLow nRet = MV_CC_SetFloatValue(handle,&#34;TriggerDelay&#34;,0);//根据实际情况设置，默认0 us nRet = MV_CC_SetBoolValue(handle,&#34;TriggerCacheEnable&#34;,TRUE);//开启后会默认缓存1个信号 //滤波设置 nRet = MV_CC_SetEnumValue(handle, &#34;LineSelector&#34;, 0);//0:Line0 2:Line2 nRet = MV_CC_SetIntValue(handle,&#34;LineDebouncerTime&#34;,10);//硬件滤波时间，可加大此参数防抖us 触发配置：
滤波：
IO输出 IO输出，参考用法主要分为两类" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/4e84a442e72ebfae292ae1764a04952d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-27T11:59:05+08:00" />
<meta property="article:modified_time" content="2021-02-27T11:59:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">海康工业相机功能模块-IO输入输出控制</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>海康工业相机功能模块sdk调用介绍<br> </p> 
<div class="toc"> 
 <h4>IO输入输出控制</h4> 
 <ul><li><a href="#_2" rel="nofollow">前言</a></li><li><ul><li><a href="#IO_7" rel="nofollow">IO输入</a></li><li><a href="#IO_35" rel="nofollow">IO输出</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>前言</h2> 
<p>机器视觉行业里面，相机作为最重要的图像传感器，除了主要的拍摄功能外，它也承担了一部分信号控制功能.<br> 一方面能够接受外部的触发信号例如PLC、光电传感器等，进行指定时刻拍照；另外一方面，能够输出IO信号，控制外围机构进行机械运动；<br> 海康标准工业相机，支持1路GPIO输入，1路GPIO输出，一路可配置的IO输出（非光耦），本文主要讲一下如何使用SDK进行IO配置以及注意事项</p> 
<h3><a id="IO_7"></a>IO输入</h3> 
<p>IO输入的主要作用就是，相机通过IO管脚，收到1个IO信号，相机就立即拍摄一帧图像；<br> 通用的使用方法如下代码依次设置：</p> 
<ul><li>触发模式：TriggerMode设置为1，开启触发模式</li><li>触发源选择：TriggerSource设置为0，选择line0，也可以选择line2，或者选择anyway；line0、line2取决于硬件电路接线，anyway支持软触发、硬触发同时使用，需要看相机是否支持</li><li>沿信号TriggerActivation：默认上升沿触发（可以不设置）</li><li>触发缓存TriggerCacheEnable：默认不开启。当相机同时收到两个触发信号时，不开启此功能，相机只会响应1个信号，出一张图；开启后，相机会自动缓存第二个信号，上个信号处理完毕后，立即处理缓存信号</li><li>触发延时TriggerDelay：收到信号后，固定延迟一段时间再曝光</li><li>滤波设置 LineDebouncerTime：去除信号毛刺抖动，根据实际情况进行调节</li></ul> 
<pre><code class="prism language-c"><span class="token comment">//C语言代码段：硬触发模式初始化配置</span>
<span class="token comment">//参数值，仅针对海康工业相机，其他品牌相机需根据对应节点微调</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"AcquisitionMode"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//0:SingleFrame 1:MultiFrame 2:Continuous </span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"TriggerMode"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0：off 1：on</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"TriggerSource"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//line2也可做输入源，非光耦</span>
<span class="token comment">//0:Line0 1:Line1 2:Line2  7:Software 8:FrequencyConverter 13：anyway</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"TriggerActivation"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0：Rising Edge  1：Falling Edge 2：LevelHigh 3：LevelLow</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetFloatValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span><span class="token string">"TriggerDelay"</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//根据实际情况设置，默认0 us</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetBoolValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span><span class="token string">"TriggerCacheEnable"</span><span class="token punctuation">,</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启后会默认缓存1个信号</span>
<span class="token comment">//滤波设置</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineSelector"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//0:Line0  2:Line2 </span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetIntValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span><span class="token string">"LineDebouncerTime"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//硬件滤波时间，可加大此参数防抖us</span>
</code></pre> 
<p>触发配置：<br> <img src="https://images2.imgbox.com/45/4b/g9iHCimq_o.png" alt="在这里插入图片描述"><br> 滤波：<br> <img src="https://images2.imgbox.com/31/dd/HuTOVyA1_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="IO_35"></a>IO输出</h3> 
<p>IO输出，参考用法主要分为两类</p> 
<ul><li>strobe输出，配合频闪光源拍摄，IO输出跟随曝光，输出周期与曝光周期同步</li><li>software输出，用户自定义时刻输出，用户自主控制，必要时刻输出OK或NG信号</li></ul> 
<ol><li>strobe输出配合频闪光源，<strong>IO输出与曝光同步</strong><br> 这里需要注意StrobeLineDuration、StrobeLineDelay、StrobeLinePreDelay三个参数，用于调节与光源同步；光源的LED从灭到亮有个响应时间，那么我们就需要适当的去调节StrobeLineDelay/StrobeLinePreDelay这两个值去做匹配，StrobeLineDuration是持续时间，可以不配置，也可以根据需要配置</li></ol> 
<pre><code class="prism language-c"><span class="token comment">//Strobe输出</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineSelector"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//0:Line0 1:Line1 2:Line2 </span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineMode"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//仅LineSelector为line2时需要特意设置，其他输出不需要</span>
<span class="token comment">//0:Input 1:Output 8:Strobe </span>
<span class="token keyword">int</span> DurationValue<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>DelayValue<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>PreDelayValue<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//us</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetIntValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"StrobeLineDuration"</span><span class="token punctuation">,</span>DurationValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//strobe持续时间，设置为0，持续时间就是曝光时间，设置其他值，就是其他值时间</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetIntValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"StrobeLineDelay"</span><span class="token punctuation">,</span>DelayValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//strobe延时，从曝光开始，延时多久输出</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetIntValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"StrobeLinePreDelay"</span><span class="token punctuation">,</span>PreDelayValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//strobe提前输出，曝光延后开始</span>
<span class="token comment">//--------------------------------------------------------------------------------------------------</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetBoolValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"StrobeEnable"</span><span class="token punctuation">,</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Strobe输出使能，使能之后，上面配置参数生效，IO输出与曝光同步</span>
<span class="token comment">//Strobe输出，多用作点亮频闪光源，sensor快门类型为Global相机都支持，rolling需注意相机是否支持</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5e/70/z6lMvZdU_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>Software输出，<strong>IO输出与LineSource同步</strong></li></ol> 
<pre><code class="prism language-c"><span class="token comment">//IO输出做NG信号用</span>
<span class="token comment">//参数初始化</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineSelector"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//0:Line0 1:Line1 2:Line2 </span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineMode"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//仅line2需要设置</span>
<span class="token comment">//0:Input 1:Output 8:Strobe </span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineSource"</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//0:ExposureStartActive 5:SoftTriggerActive  6:HardTriggerActive</span>
<span class="token keyword">int</span> DurationValue<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">,</span>DelayValue<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>PreDelayValue<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//us</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetIntValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"StrobeLineDuration"</span><span class="token punctuation">,</span>DurationValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetIntValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"StrobeLineDelay"</span><span class="token punctuation">,</span>DelayValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//strobe延时，从曝光开始，延时多久输出</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetIntValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"StrobeLinePreDelay"</span><span class="token punctuation">,</span>PreDelayValue<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//strobe提前输出，曝光延后开始</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetBoolValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"StrobeEnable"</span><span class="token punctuation">,</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//Strobe输出使能，使能之后，上面配置参数生效，IO输出与LineSource同步</span>
<span class="token comment">//-------------------------------------------------------------------------------------</span>
<span class="token comment">//输出IO信号命令</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetCommandValue</span><span class="token punctuation">(</span>m_handle<span class="token punctuation">,</span> <span class="token string">"LineTriggerSoftware"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/16/9e/wzP8uNtq_o.png" alt="在这里插入图片描述"></p> 
<p>这里会存在一个问题就是，海康部分相机，LineSource没有SoftTriggerActive的参数选项，那么就必须使用另外一种方法实现</p> 
<ol start="3"><li>电平反转，通过快速反转电平状态，来模拟一个信号输出<br> 当然这种控制电平变化时间做不到精确控制，只能适用于那种不太严格要求信号质量的场景</li></ol> 
<pre><code class="prism language-c"><span class="token comment">//电平反转</span>
<span class="token comment">//IO输出做NG信号用</span>
<span class="token comment">//参数初始化</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineSelector"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//0:Line0 1:Line1 2:Line2 </span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetEnumValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineMode"</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//仅line2需要设置</span>
<span class="token comment">//0:Input 1:Output 8:Strobe </span>
<span class="token comment">//信号输出----------------------------------------------------</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetBoolValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineInverter"</span><span class="token punctuation">,</span>TRUE<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//电平反转，也可用作IO输出,连续两次翻转可以输出一个IO信号</span>
<span class="token function">Sleep</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//延时就相当于电平持续时间，也可以不设置</span>
nRet <span class="token operator">=</span> <span class="token function">MV_CC_SetBoolValue</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token string">"LineInverter"</span><span class="token punctuation">,</span>false<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/5d/e6/NUSauWDq_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f5f943e59d3ab5bdf14bf08d87e82dbe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java多线程学习之七—如何优雅的停止线程（池）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c71a9cc03e4ee9e077e456c27d609870/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">数据解析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>