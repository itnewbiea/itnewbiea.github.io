<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【PointRCNN深度解读【详尽版】--原理和代码结合】 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【PointRCNN深度解读【详尽版】--原理和代码结合】" />
<meta property="og:description" content="PointRCNN深度解读【详尽版】 前言网络结构*a. Bottom-up 3D Proposal Generation*Point Cloud Encoder-DecoderForeground Point SegmentationBin-based 3D Box Generation从代码角度来解读 *b. Canonical 3D Box Refinement*Point Cloud Region PoolingCanonical TransformationMerged FeaturesBin-based 3D box Refinement and Confidence Prediction代码部分 总结参考 前言 这周终于接触3D目标检测的内容，以前的PointNet和PointNet&#43;&#43;都是讲述的分类和分割的问题。从PointRCNN开始难度好像一下子升级了，网络结构比较复杂，代码量巨大，花费了差不多一周的时间才理解了个大概，不敢说多，所以做个笔记再回顾下其内容，避免遗忘。还是老规矩结合代码从论文的网络结构一步步的解析。
论文： PointRCNN
代码: 点开它
网络结构 整体的思路主要分为两步：
前景点的分割以及3D预测框的生成对框的微调优化 具体的细化过程如下：
a. Bottom-up 3D Proposal Generation 这个阶段的主要目的就是利用主干网络提取特征，分割原始点云同时从分割的前景点生成3D Proposal，基于这种自底向上的策略，可避免在3D空间中使用大量预定义的3D框，并且显著限制了生成的3D提案的搜索空间。
Point Cloud Encoder-Decoder 主干网络提取特征，作者用了PointNet&#43;&#43;(不了解的可以点进去看我另一篇博客)，另外主干网络也可以采用其他如VoxelNet等。
Foreground Point Segmentation 提取特征后分割原始点云，生成所需要的前景点，包含了预测目标位置和方向的丰富信息。另外由于前景点远比背景少，故使用Fcoal loss 来区分前景与背景，Focal loss本身是为了减少容易分类的样本的权重，将权重尽量集中于难分类样本上。
论文中 αt= 0.25，γ= 2。
Bin-based 3D Box Generation 作者在论文中提出了一种基于Bin的方法，使模型训练的时候能够更快的收敛。如下图：
可以看到，作者采用鸟瞰的方式，设定一个在X-Z平面的搜索范围S，每个搜索范围被划分成等长δ 的bins来表示不同的物体在X-Z平面的中心( x , z )。在论文中发现，对X- Z轴使用基于bin的交叉熵损失比直接使用smooth L1 loss 回归能够更加精准得出定位结果。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/40c1089961ab78ddb47cd931e441f658/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-05T14:54:29+08:00" />
<meta property="article:modified_time" content="2022-02-05T14:54:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【PointRCNN深度解读【详尽版】--原理和代码结合】</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>PointRCNN深度解读【详尽版】 </h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><a href="#_6" rel="nofollow">网络结构</a></li><li><ul><li><a href="#a_Bottomup_3D_Proposal_Generation_14" rel="nofollow">*a. Bottom-up 3D Proposal Generation*</a></li><li><ul><li><a href="#Point_Cloud_EncoderDecoder_16" rel="nofollow">Point Cloud Encoder-Decoder</a></li><li><a href="#Foreground_Point_Segmentation_18" rel="nofollow">Foreground Point Segmentation</a></li><li><a href="#Binbased_3D_Box_Generation_22" rel="nofollow">Bin-based 3D Box Generation</a></li><li><a href="#_47" rel="nofollow">从代码角度来解读</a></li></ul> 
   </li><li><a href="#b_Canonical_3D_Box_Refinement_167" rel="nofollow">*b. Canonical 3D Box Refinement*</a></li><li><ul><li><a href="#Point_Cloud_Region_Pooling_170" rel="nofollow">Point Cloud Region Pooling</a></li><li><a href="#Canonical_Transformation_185" rel="nofollow">Canonical Transformation</a></li><li><a href="#Merged_Features_202" rel="nofollow">Merged Features</a></li><li><a href="#Binbased_3D_box_Refinement_and_Confidence_Prediction_206" rel="nofollow">Bin-based 3D box Refinement and Confidence Prediction</a></li><li><a href="#_219" rel="nofollow">代码部分</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_227" rel="nofollow">总结</a></li><li><a href="#_233" rel="nofollow">参考</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<p>这周终于接触3D目标检测的内容，以前的<a href="https://blog.csdn.net/qingliange/article/details/122156415?spm=1001.2014.3001.5501">PointNet</a>和<a href="https://blog.csdn.net/qingliange/article/details/122279410?spm=1001.2014.3001.5501">PointNet++</a>都是讲述的分类和分割的问题。从PointRCNN开始难度好像一下子升级了，网络结构比较复杂，代码量巨大，花费了差不多一周的时间才理解了个大概，不敢说多，所以做个笔记再回顾下其内容，避免遗忘。还是老规矩结合代码从论文的网络结构一步步的解析。<br> 论文： <a href="https://arxiv.org/abs/1812.04244" rel="nofollow">PointRCNN</a><br> 代码: <a href="https://github.com/sshaoshuai/PointRCNN">点开它</a></p> 
<h2><a id="_6"></a>网络结构</h2> 
<p><img src="https://images2.imgbox.com/cf/2c/J4NTM3nB_o.png" alt="在这里插入图片描述"><br> 整体的思路主要分为两步：</p> 
<ol><li>前景点的分割以及3D预测框的生成</li><li>对框的微调优化</li></ol> 
<p>具体的细化过程如下：</p> 
<h3><a id="a_Bottomup_3D_Proposal_Generation_14"></a><em>a. Bottom-up 3D Proposal Generation</em></h3> 
<p>这个阶段的主要目的就是利用主干网络提取特征，分割原始点云同时从分割的前景点生成3D Proposal，基于这种自底向上的策略，可避免在3D空间中使用大量预定义的3D框，并且显著限制了生成的3D提案的搜索空间。</p> 
<h4><a id="Point_Cloud_EncoderDecoder_16"></a>Point Cloud Encoder-Decoder</h4> 
<p>主干网络提取特征，作者用了<a href="https://blog.csdn.net/qingliange/article/details/122279410?spm=1001.2014.3001.5501">PointNet++</a>(不了解的可以点进去看我另一篇博客)，另外主干网络也可以采用其他如VoxelNet等。</p> 
<h4><a id="Foreground_Point_Segmentation_18"></a>Foreground Point Segmentation</h4> 
<p>提取特征后分割原始点云，生成所需要的前景点，包含了预测目标位置和方向的丰富信息。另外由于前景点远比背景少，故使用Fcoal loss 来区分前景与背景，Focal loss本身是为了减少容易分类的样本的权重，将权重尽量集中于难分类样本上。<br> <img src="https://images2.imgbox.com/a3/aa/XxS0WbqT_o.png" alt="论文中"><br> 论文中 αt= 0.25，γ= 2。</p> 
<h4><a id="Binbased_3D_Box_Generation_22"></a>Bin-based 3D Box Generation</h4> 
<p>作者在论文中提出了一种基于Bin的方法，使模型训练的时候能够更快的收敛。如下图：<br> <img src="https://images2.imgbox.com/0a/c7/VfcZNzC7_o.png" alt="论文"><br> 可以看到，作者采用鸟瞰的方式，设定一个在X-Z平面的搜索范围S，每个搜索范围被划分成等长δ 的bins来表示不同的物体在X-Z平面的中心( x , z )。在论文中发现，对X- Z轴使用基于bin的交叉熵损失比直接使用smooth L1 loss 回归能够更加精准得出定位结果。<br> 对于X，Z轴的定位loss由两部分组成：</p> 
<ol><li>沿着每个X，Z轴的bin分类</li><li>被分好类的bin中的残差回归</li></ol> 
<p>对于Y轴直接使用smooth L1 loss回归，因为大部分物体的y 值都在一个很小的范围内，使用L 1 loss足够获得精准的y 值。<br> <img src="https://images2.imgbox.com/ae/d4/shagu1ne_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>(<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
          
          
            ( 
           
          
            p 
           
          
            ) 
           
          
         
        
          , 
         
         
         
           y 
          
          
          
            ( 
           
          
            p 
           
          
            ) 
           
          
         
        
          , 
         
         
         
           z 
          
          
          
            ( 
           
          
            p 
           
          
            ) 
           
          
         
        
       
         x^{(p)},y^{(p)},z^{(p)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0824399999999998em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span>)是FPO I(foreground point of interest )的坐标。<br> (<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           x 
          
         
           p 
          
         
        
          , 
         
         
         
           y 
          
         
           p 
          
         
        
          , 
         
         
         
           z 
          
         
           p 
          
         
        
       
         x^{p},y^{p},z^{p} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.858832em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span></span></span></span></span></span></span></span></span></span></span></span></span>)是对应物体的中心坐标。<br> (<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          b 
         
        
          i 
         
         
         
           n 
          
         
           x 
          
          
          
            ( 
           
          
            p 
           
          
            ) 
           
          
         
        
          , 
         
        
          b 
         
        
          i 
         
         
         
           n 
          
         
           z 
          
          
          
            ( 
           
          
            p 
           
          
            ) 
           
          
         
        
       
         bin_{x}^{(p)},bin_z^{(p)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.23924em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659199999999997em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659199999999997em;"><span class=""></span></span></span></span></span></span></span></span></span></span>)是沿着X，Z轴分配的ground- truth bin。<br> (<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          r 
         
        
          e 
         
         
         
           s 
          
         
           x 
          
          
          
            ( 
           
          
            p 
           
          
            ) 
           
          
         
        
          , 
         
        
          r 
         
        
          e 
         
         
         
           s 
          
         
           z 
          
          
          
            ( 
           
          
            p 
           
          
            ) 
           
          
         
        
       
         res_{x}^{(p)},res_z^{(p)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.23924em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">x</span></span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659199999999997em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right: 0.04398em;">z</span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659199999999997em;"><span class=""></span></span></span></span></span></span></span></span></span></span>) 是在被分配的bin中做进一步定位微调的ground-truth残差。<br> C 是归一化的bin长度。 然后由预测的bin和真实的bin可以得到3D边界框的回归损失。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/26/00/L5AjaZLh_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           N 
          
          
          
            p 
           
          
            o 
           
          
            s 
           
          
         
        
       
         N_{pos} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10903em;">N</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.15139200000000003em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.10903em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是前景点的数量<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            b 
           
          
            i 
           
           
           
             n 
            
           
             u 
            
            
            
              ( 
             
            
              p 
             
            
              ) 
             
            
           
          
         
           ˉ 
          
         
        
          , 
         
         
          
          
            r 
           
          
            e 
           
           
           
             s 
            
           
             u 
            
            
            
              ( 
             
            
              p 
             
            
              ) 
             
            
           
          
         
           ˉ 
          
         
        
       
         \bar{bin_{u}^{(p)}},\bar{res_{u}^{(p)}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.3760199999999998em; vertical-align: -0.19444em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.1815799999999999em;"><span class="" style="top: -3.0447999999999995em;"><span class="pstrut" style="height: 3.0448em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">u</span></span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659200000000003em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.6586em;"><span class="pstrut" style="height: 3.0448em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659200000000003em;"><span class=""></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.1815799999999999em;"><span class="" style="top: -3.0447999999999995em;"><span class="pstrut" style="height: 3.0448em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">u</span></span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659200000000003em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.6586em;"><span class="pstrut" style="height: 3.0448em;"></span><span class="accent-body" style="left: -0.25em;">ˉ</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659200000000003em;"><span class=""></span></span></span></span></span></span></span></span></span>是前景点p被预测的bin分配和残差<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           b 
          
         
           i 
          
          
          
            n 
           
          
            u 
           
           
           
             ( 
            
           
             p 
            
           
             ) 
            
           
          
         
        
          , 
         
        
          r 
         
        
          e 
         
         
         
           s 
          
         
           u 
          
          
          
            ( 
           
          
            p 
           
          
            ) 
           
          
         
        
       
         {bin_{u}^{(p)}},res_{u}^{(p)} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.23924em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="mord mathdefault">i</span><span class="mord"><span class="mord mathdefault">n</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">u</span></span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659199999999997em;"><span class=""></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">u</span></span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659199999999997em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是已经计算过的ground- truth对象<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           F 
          
          
          
            c 
           
          
            l 
           
          
            s 
           
          
         
        
       
         F_{cls} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.83333em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.33610799999999996em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">c</span><span class="mord mathdefault mtight" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是分类的交叉熵损失 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           F 
          
          
          
            r 
           
          
            e 
           
          
            g 
           
          
         
        
       
         F_{reg} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.13889em;">F</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.15139200000000003em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.13889em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是smooth L1 loss</p> 
</blockquote> 
<h4><a id="_47"></a>从代码角度来解读</h4> 
<p><img src="https://images2.imgbox.com/f6/f4/WiOK2yVm_o.png" alt="在这里插入图片描述"><br> 经过<strong>RPN</strong>(region proposal network)骨干网提取后的特征生成前景掩模预测分支(rpn_cls)和三维提案回归分支(rpn_reg)来完成相应任务。</p> 
<ul><li>3D场景中的目标通常是分离互不重叠的，所有三维目标的分割掩膜都可以通过3D边界框注释直接获得。另外前景掩膜预测过程中经过两个卷积层，输出(bs, n, 1)的mask，最后的1表示这个点属于前景点的概率，值越大，属于前景点的概率越高。加一个sigmoid限制到（0,1），然后用focal loss计算损失。</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># classification branch</span>
        cls_layers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        pre_channel <span class="token operator">=</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>FP_MLPS<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>      <span class="token comment"># __C.RPN.FP_MLPS = [[128, 128], [256, 256], [512, 512], [512, 512]]</span>
        <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>CLS_FC<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># __C.RPN.CLS_FC = [128]</span>
            cls_layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pt_utils<span class="token punctuation">.</span>Conv1d<span class="token punctuation">(</span>pre_channel<span class="token punctuation">,</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>CLS_FC<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> bn<span class="token operator">=</span>cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>USE_BN<span class="token punctuation">)</span><span class="token punctuation">)</span>
            pre_channel <span class="token operator">=</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>CLS_FC<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        cls_layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pt_utils<span class="token punctuation">.</span>Conv1d<span class="token punctuation">(</span>pre_channel<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>DP_RATIO <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>      <span class="token comment"># __C.RPN.DP_RATIO = 0.5</span>
            cls_layers<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>DP_RATIO<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rpn_cls_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>cls_layers<span class="token punctuation">)</span>
</code></pre> 
<ul><li>3D提案框回归分支使用前景点回归生成3D提案（注意，虽然没有从背景点中回归box，但是因为点云网络的感受野，这些背景点也为生成box提供了支持信息）。作者提出了基于bin的回归损失估计目标的三维边界框来预测3D边界框需要预测中心位置、目标尺寸与目标方向(x,y,z,h,w,l,θ)（3+3+1=7维）,故最终预测生成的rpn_reg为(bs, n, 76)。这里用76维度的特征来表示这7个量。</li></ul> 
<pre><code class="prism language-python"><span class="token comment"># regression branch</span>
        per_loc_bin_num <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>LOC_SCOPE <span class="token operator">/</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>LOC_BIN_SIZE<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">2</span>   <span class="token comment">#  (3/0.5) * 2 = 12</span>
        <span class="token keyword">if</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>LOC_XZ_FINE<span class="token punctuation">:</span>   <span class="token comment">#  __C.RPN.LOC_XZ_FINE = False</span>
            reg_channel <span class="token operator">=</span> per_loc_bin_num <span class="token operator">*</span> <span class="token number">4</span> <span class="token operator">+</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>NUM_HEAD_BIN <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span>   <span class="token comment">#  __C.RPN.NUM_HEAD_BIN = 12</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            reg_channel <span class="token operator">=</span> per_loc_bin_num <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>NUM_HEAD_BIN <span class="token operator">*</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">3</span>
        reg_channel <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># reg y</span>

        reg_layers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        pre_channel <span class="token operator">=</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>FP_MLPS<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>REG_FC<span class="token punctuation">.</span>__len__<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>   <span class="token comment"># __C.RPN.REG_FC = [128]</span>
            reg_layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pt_utils<span class="token punctuation">.</span>Conv1d<span class="token punctuation">(</span>pre_channel<span class="token punctuation">,</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>REG_FC<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">,</span> bn<span class="token operator">=</span>cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>USE_BN<span class="token punctuation">)</span><span class="token punctuation">)</span>
            pre_channel <span class="token operator">=</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>REG_FC<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
        reg_layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>pt_utils<span class="token punctuation">.</span>Conv1d<span class="token punctuation">(</span>pre_channel<span class="token punctuation">,</span> reg_channel<span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>DP_RATIO <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">:</span>
            reg_layers<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> nn<span class="token punctuation">.</span>Dropout<span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>DP_RATIO<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>rpn_reg_layer <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token operator">*</span>reg_layers<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/44/77/xqL8bjUo_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>不是直接预测每个box中心点的坐标，而是预测每个前景点对于bounding box中心点的偏移，偏移了几个bin。但是这个bin是一个整数，还是无法精确定位，所以还需要中心点坐标在一个bin中的偏移量，把这个偏移量叫做res。</p> 
</blockquote> 
<p>如图所示的76维向量预测框，前12维预测x方向上的bin，12-24预测z方向上的bin，24-36预测x方向的残差res，36-48预测z方向的残差，48-49预测y方向的距离，49-61预测角度的bin，61-73预测角度上的额残差，73-76对长宽高做出预测。基于bin的预测参数x，z，θ，我们首先选择具有最高预测信度的bin中心，并添加预测残差以获得重新定义的参数。其他参数则没有使用基于bin的预测方法。</p> 
<blockquote> 
 <p>强调：只有在预测中心点x,z轴坐标和bounding box的旋转角θ时，才用这种基于bin的思想。</p> 
</blockquote> 
<p>这样的话，bounding box的7个关键量都得到了，但是就算每个前景点预测一个bounding box，也还是有很多个bounding box。所以下一步就要减少预测框的数量，作者利用基于鸟瞰图的IoU进行非最大值抑制(NMS)以生成少量高质量提案。具体代码在lib/rpn/proposal_layer.py中。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">distance_based_proposal</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> scores<span class="token punctuation">,</span> proposals<span class="token punctuation">,</span> order<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
         propose rois in two area based on the distance
        :param scores: (N)
        :param proposals: (N, 7)
        :param order: (N)
        """</span>
        nms_range_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40.0</span><span class="token punctuation">,</span> <span class="token number">80.0</span><span class="token punctuation">]</span>
        pre_tot_top_n <span class="token operator">=</span> cfg<span class="token punctuation">[</span>self<span class="token punctuation">.</span>mode<span class="token punctuation">]</span><span class="token punctuation">.</span>RPN_PRE_NMS_TOP_N
        pre_top_n_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>pre_tot_top_n <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> pre_tot_top_n <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>pre_tot_top_n <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
        post_tot_top_n <span class="token operator">=</span> cfg<span class="token punctuation">[</span>self<span class="token punctuation">.</span>mode<span class="token punctuation">]</span><span class="token punctuation">.</span>RPN_POST_NMS_TOP_N
        post_top_n_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>post_tot_top_n <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">,</span> post_tot_top_n <span class="token operator">-</span> <span class="token builtin">int</span><span class="token punctuation">(</span>post_tot_top_n <span class="token operator">*</span> <span class="token number">0.7</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

        scores_single_list<span class="token punctuation">,</span> proposals_single_list <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>

        <span class="token comment"># sort by score</span>
        scores_ordered <span class="token operator">=</span> scores<span class="token punctuation">[</span>order<span class="token punctuation">]</span>
        proposals_ordered <span class="token operator">=</span> proposals<span class="token punctuation">[</span>order<span class="token punctuation">]</span>

        dist <span class="token operator">=</span> proposals_ordered<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span>
        first_mask <span class="token operator">=</span> <span class="token punctuation">(</span>dist <span class="token operator">&gt;</span> nms_range_list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>dist <span class="token operator">&lt;=</span> nms_range_list<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>nms_range_list<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># get proposal distance mask</span>
            dist_mask <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>dist <span class="token operator">&gt;</span> nms_range_list<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;</span> <span class="token punctuation">(</span>dist <span class="token operator">&lt;=</span> nms_range_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token keyword">if</span> dist_mask<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">:</span>
                <span class="token comment"># this area has points</span>
                <span class="token comment"># reduce by mask</span>
                cur_scores <span class="token operator">=</span> scores_ordered<span class="token punctuation">[</span>dist_mask<span class="token punctuation">]</span>
                cur_proposals <span class="token operator">=</span> proposals_ordered<span class="token punctuation">[</span>dist_mask<span class="token punctuation">]</span>

                <span class="token comment"># fetch pre nms top K</span>
                cur_scores <span class="token operator">=</span> cur_scores<span class="token punctuation">[</span><span class="token punctuation">:</span>pre_top_n_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
                cur_proposals <span class="token operator">=</span> cur_proposals<span class="token punctuation">[</span><span class="token punctuation">:</span>pre_top_n_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">assert</span> i <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'%d'</span> <span class="token operator">%</span> i
                <span class="token comment"># this area doesn't have any points, so use rois of first area</span>
                cur_scores <span class="token operator">=</span> scores_ordered<span class="token punctuation">[</span>first_mask<span class="token punctuation">]</span>
                cur_proposals <span class="token operator">=</span> proposals_ordered<span class="token punctuation">[</span>first_mask<span class="token punctuation">]</span>

                <span class="token comment"># fetch top K of first area</span>
                cur_scores <span class="token operator">=</span> cur_scores<span class="token punctuation">[</span>pre_top_n_list<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span>pre_top_n_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
                cur_proposals <span class="token operator">=</span> cur_proposals<span class="token punctuation">[</span>pre_top_n_list<span class="token punctuation">[</span>i <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">:</span>pre_top_n_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>

            <span class="token comment"># oriented nms</span>
            boxes_bev <span class="token operator">=</span> kitti_utils<span class="token punctuation">.</span>boxes3d_to_bev_torch<span class="token punctuation">(</span>cur_proposals<span class="token punctuation">)</span>
            <span class="token keyword">if</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>NMS_TYPE <span class="token operator">==</span> <span class="token string">'rotate'</span><span class="token punctuation">:</span>
                keep_idx <span class="token operator">=</span> iou3d_utils<span class="token punctuation">.</span>nms_gpu<span class="token punctuation">(</span>boxes_bev<span class="token punctuation">,</span> cur_scores<span class="token punctuation">,</span> cfg<span class="token punctuation">[</span>self<span class="token punctuation">.</span>mode<span class="token punctuation">]</span><span class="token punctuation">.</span>RPN_NMS_THRESH<span class="token punctuation">)</span>
            <span class="token keyword">elif</span> cfg<span class="token punctuation">.</span>RPN<span class="token punctuation">.</span>NMS_TYPE <span class="token operator">==</span> <span class="token string">'normal'</span><span class="token punctuation">:</span>
                keep_idx <span class="token operator">=</span> iou3d_utils<span class="token punctuation">.</span>nms_normal_gpu<span class="token punctuation">(</span>boxes_bev<span class="token punctuation">,</span> cur_scores<span class="token punctuation">,</span> cfg<span class="token punctuation">[</span>self<span class="token punctuation">.</span>mode<span class="token punctuation">]</span><span class="token punctuation">.</span>RPN_NMS_THRESH<span class="token punctuation">)</span>
            <span class="token keyword">else</span><span class="token punctuation">:</span>
                <span class="token keyword">raise</span> NotImplementedError

            <span class="token comment"># Fetch post nms top k</span>
            keep_idx <span class="token operator">=</span> keep_idx<span class="token punctuation">[</span><span class="token punctuation">:</span>post_top_n_list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>

            scores_single_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cur_scores<span class="token punctuation">[</span>keep_idx<span class="token punctuation">]</span><span class="token punctuation">)</span>
            proposals_single_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cur_proposals<span class="token punctuation">[</span>keep_idx<span class="token punctuation">]</span><span class="token punctuation">)</span>

        scores_single <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>scores_single_list<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        proposals_single <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span>proposals_single_list<span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> scores_single<span class="token punctuation">,</span> proposals_single

</code></pre> 
<p>解释下代码中的方法，<br> <img src="https://images2.imgbox.com/95/07/3404icEE_o.png" alt="在这里插入图片描述"><br> 训练时在相机0～40m距离内的bounding box，先取得分类得分最高的6300个，然后计算bird view IOU，把IOU大于0.85的都删掉，到这里bounding box 又少了一点。然后再取得分最高的210个。在距离相机40～80m的范围内用同样的方法取90个。这样第一阶段结束的时候只剩下300个bounding box了。</p> 
<blockquote> 
 <p>300个bounding box也还是很多，于是有了第二阶段置信度打分和bounding box优化。<br> 而在实际预测时，使用具有IOU阈值0.8的定向NMS，并且只保留前100个bounding box。</p> 
</blockquote> 
<h3><a id="b_Canonical_3D_Box_Refinement_167"></a><em>b. Canonical 3D Box Refinement</em></h3> 
<p>这一部分主要进行3D bounding box的优化，就是先提出大致的region proposal，再在第一阶段输出的proposal中进行搜索，得到准确的Bounding Box，这往往比one-stage更加精细，速度略逊。</p> 
<h4><a id="Point_Cloud_Region_Pooling_170"></a>Point Cloud Region Pooling</h4> 
<p>根据阶段1的3D点和所提取的特征进行池化，为了得到更精细的局部特征。具体步骤为：</p> 
<ul><li> <p>对每一个获取的proposal(记做 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            b 
           
          
            i 
           
          
         
        
          b_{i} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>,表示为一个7维变量(<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            x 
           
          
            i 
           
          
         
           , 
          
          
          
            y 
           
          
            i 
           
          
         
           , 
          
          
          
            z 
           
          
            i 
           
          
         
           , 
          
          
          
            h 
           
          
            i 
           
          
         
           , 
          
          
          
            w 
           
          
            i 
           
          
         
           , 
          
          
          
            l 
           
          
            i 
           
          
         
           , 
          
          
          
            θ 
           
          
            i 
           
          
         
        
          x_{i},y_{i},z_{i},h_{i},w_{i},l_{i},θ _{i} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.04398em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>)稍微放大，创造一个新的3D框<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            b 
           
          
            i 
           
          
            e 
           
          
         
        
          b_{i}^{e} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.953104em; vertical-align: -0.258664em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -2.441336em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.258664em;"><span class=""></span></span></span></span></span></span></span></span></span></span>=(<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            x 
           
          
            i 
           
          
         
           , 
          
          
          
            y 
           
          
            i 
           
          
         
           , 
          
          
          
            z 
           
          
            i 
           
          
         
           , 
          
          
          
            h 
           
          
            i 
           
          
         
           + 
          
         
           η 
          
         
           , 
          
          
          
            w 
           
          
            i 
           
          
         
           + 
          
         
           η 
          
         
           , 
          
          
          
            l 
           
          
            i 
           
          
         
           + 
          
         
           η 
          
         
           , 
          
          
          
            θ 
           
          
            i 
           
          
         
        
          x_{i},y_{i},z_{i},h_{i}+η,w_{i}+η,l_{i}+η,θ _{i} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.04398em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height: 0.7777700000000001em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">η</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">η</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">η</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>)从环境中编码额外的信息，其中η是一个用来放大proposal的固定值。</p> </li><li> <p>判断点是否在扩大的提案内。对于每个点p = (<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            x 
           
           
           
             ( 
            
           
             p 
            
           
             ) 
            
           
          
         
           , 
          
          
          
            y 
           
           
           
             ( 
            
           
             p 
            
           
             ) 
            
           
          
         
           , 
          
          
          
            z 
           
           
           
             ( 
            
           
             p 
            
           
             ) 
            
           
          
         
        
          x^{(p)},y^{(p)},z^{(p)} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0824399999999998em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span>)执行一个内/外测试来判断这个点在不在被扩大的推荐框<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            b 
           
          
            i 
           
          
            e 
           
          
         
        
          b_{i}^{e} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.953104em; vertical-align: -0.258664em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.664392em;"><span class="" style="top: -2.441336em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">e</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.258664em;"><span class=""></span></span></span></span></span></span></span></span></span></span>中。如果在的话，这个点和他的特征就会被保留用来微调<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
       
        
         
          
          
            b 
           
          
            i 
           
          
         
        
          b_{i} 
         
        
      </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>.</p> 
  <blockquote> 
   <p>主要包括：<br> 3D坐标(<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             x 
            
           
             i 
            
           
          
            , 
           
           
           
             y 
            
           
             i 
            
           
          
            , 
           
           
           
             z 
            
           
             i 
            
           
          
            , 
           
           
           
             h 
            
           
             i 
            
           
          
            , 
           
           
           
             w 
            
           
             i 
            
           
          
            , 
           
           
           
             l 
            
           
             i 
            
           
          
            , 
           
           
           
             θ 
            
           
             i 
            
           
          
         
           x_{i},y_{i},z_{i},h_{i},w_{i},l_{i},θ _{i} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.04398em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>)<br> 激光反射强度<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             r 
            
            
            
              ( 
             
            
              p 
             
            
              ) 
             
            
           
          
         
           r^{(p)} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8879999999999999em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span><br> 阶段1的预测分割掩码<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             m 
            
            
            
              ( 
             
            
              p 
             
            
              ) 
             
            
           
          
         
           m^{(p)} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8879999999999999em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">m</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span><br> 阶段1的C维学习点特征表示<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
        
         
          
           
           
             f 
            
            
            
              ( 
             
            
              p 
             
            
              ) 
             
            
           
          
         
           f^{(p)} 
          
         
       </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0824399999999998em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.10764em;">f</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span></span></span></span></span><br> --------------------这些结构正好是结构图中的引导线--------------------------------</p> 
  </blockquote> </li></ul> 
<h4><a id="Canonical_Transformation_185"></a>Canonical Transformation</h4> 
<p>Canonical变换其实就是对每个proposal建立了一个单独的个体坐标系（如下图所示）。<br> <img src="https://images2.imgbox.com/33/1e/03vvpG0g_o.png" alt="在这里插入图片描述"><br> 这个坐标系的特点为：</p> 
<pre><code>     1. 坐标系的原点为proposal的中点
     2. X和Z轴与水平地面平行。且X轴为proposal朝向的位置
     3. Y轴水平向下
</code></pre> 
<p>规范后的中心点坐标为：<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           b 
          
         
           i 
          
         
        
          ~ 
         
        
       
      
        \tilde{b_{i}} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0812999999999997em; vertical-align: -0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9312999999999998em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.61344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span> = (0, 0, 0, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          h 
         
        
          i 
         
        
       
         , 
        
        
        
          w 
         
        
          i 
         
        
       
         , 
        
        
        
          l 
         
        
          i 
         
        
       
         , 
        
       
         0 
        
       
      
        h_{i}, w_{i}, l_{i}, 0 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord">0</span></span></span></span></span>)<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
         
         
           b 
          
         
           i 
          
          
          
            g 
           
          
            t 
           
          
         
        
          ~ 
         
        
       
      
        \tilde{b_{i}^{gt}} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.4251879999999997em; vertical-align: -0.276864em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.1483239999999997em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.830464em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span></span></span></span> = (<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          x 
         
        
          i 
         
         
         
           g 
          
         
           t 
          
         
        
       
         − 
        
        
        
          x 
         
        
          i 
         
        
       
      
        x_{i}^{gt}-x_{i} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.1883279999999998em; vertical-align: -0.276864em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          y 
         
        
          i 
         
         
         
           g 
          
         
           t 
          
         
        
       
         − 
        
        
        
          y 
         
        
          i 
         
        
       
      
        y_{i}^{gt}-y_{i} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.1883279999999998em; vertical-align: -0.276864em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.19444em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.03588em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          z 
         
        
          i 
         
         
         
           g 
          
         
           t 
          
         
        
       
         − 
        
        
        
          z 
         
        
          i 
         
        
       
      
        z_{i}^{gt}-z_{i} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.1883279999999998em; vertical-align: -0.276864em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: -0.04398em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height: 0.58056em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.04398em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          h 
         
        
          i 
         
         
         
           g 
          
         
           t 
          
         
        
       
         , 
        
        
        
          w 
         
        
          i 
         
         
         
           g 
          
         
           t 
          
         
        
       
         , 
        
        
        
          l 
         
        
          i 
         
         
         
           g 
          
         
           t 
          
         
        
       
         , 
        
       
      
        h_{i}^{gt}, w_{i}^{gt}, l_{i}^{gt}, 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.1883279999999998em; vertical-align: -0.276864em;"></span><span class="mord"><span class="mord mathdefault">h</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: -0.02691em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mpunct">,</span></span></span></span></span>,<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          θ 
         
        
          i 
         
         
         
           g 
          
         
           t 
          
         
        
       
         − 
        
        
        
          θ 
         
        
          i 
         
        
       
      
        θ_{i}^{gt}-θ_{i} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.1883279999999998em; vertical-align: -0.276864em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.02778em;">θ</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.02778em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span><br> 作者仍采用bin-res的方法进行位置回归，只不过采用了更小的搜索范围S。</p> 
<h4><a id="Merged_Features_202"></a>Merged Features</h4> 
<p>将坐标变化后的局部空间点再次卷积(改变通道数)和全局的语义特征结合优化框和置信度。另外尽管规范坐标后的点对局部空间信息鲁棒，但其不可避免的丢失了深度信息。比如，远处的目标（远离sensor）比近处的点密度小，为了补偿失去的深度信息，作者在p点的特征中包括了传感器的距离信息。<br> 即 :<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          d 
         
         
         
           ( 
          
         
           p 
          
         
           ) 
          
         
        
       
         = 
        
        
         
         
           ( 
          
          
          
            x 
           
           
           
             ( 
            
           
             p 
            
           
             ) 
            
           
          
          
          
            ) 
           
          
            2 
           
          
         
           + 
          
         
           ( 
          
          
          
            y 
           
           
           
             ( 
            
           
             p 
            
           
             ) 
            
           
          
          
          
            ) 
           
          
            2 
           
          
         
           + 
          
         
           ( 
          
          
          
            z 
           
           
           
             ( 
            
           
             p 
            
           
             ) 
            
           
          
          
          
            ) 
           
          
            2 
           
          
         
        
       
      
        d^{(p)} = \sqrt{(x^{(p)})^2 + (y^{(p)})^2 + (z^{(p)})^2} 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8879999999999999em; vertical-align: 0em;"></span><span class="mord"><span class="mord mathdefault">d</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.8879999999999999em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height: 1.24em; vertical-align: -0.2729999999999999em;"></span><span class="mord sqrt"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9670000000000001em;"><span class="svg-align" style="top: -3.2em;"><span class="pstrut" style="height: 3.2em;"></span><span class="mord" style="padding-left: 1em;"><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.9890000000000003em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.03588em;">y</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.9890000000000003em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222222222222222em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.04398em;">z</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814em;"><span class="" style="top: -2.989em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">p</span><span class="mclose mtight">)</span></span></span></span></span></span></span></span></span><span class="mclose"><span class="mclose">)</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.740108em;"><span class="" style="top: -2.9890000000000003em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span></span></span></span></span></span></span><span class="" style="top: -2.9270000000000005em;"><span class="pstrut" style="height: 3.2em;"></span><span class="hide-tail" style="min-width: 1.02em; height: 1.28em;"> 
           <svg width="400em" height="1.28em" viewbox="0 0 400000 1296" preserveaspectratio="xMinYMin slice"> 
            <path d="M263,681c0.7,0,18,39.7,52,119c34,79.3,68.167,
158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120c340,-704.7,510.7,-1060.3,512,-1067
c4.7,-7.3,11,-11,19,-11H40000v40H1012.3s-271.3,567,-271.3,567c-38.7,80.7,-84,
175,-136,283c-52,108,-89.167,185.3,-111.5,232c-22.3,46.7,-33.8,70.3,-34.5,71
c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1s-109,-253,-109,-253c-72.7,-168,-109.3,
-252,-110,-252c-10.7,8,-22,16.7,-34,26c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26
s76,-59,76,-59s76,-60,76,-60z M1001 80H40000v40H1012z"></path> 
           </svg></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2729999999999999em;"><span class=""></span></span></span></span></span></span></span></span></span>.</p> 
<h4><a id="Binbased_3D_box_Refinement_and_Confidence_Prediction_206"></a>Bin-based 3D box Refinement and Confidence Prediction</h4> 
<p>将所得的特征再喂入<a href="https://blog.csdn.net/qingliange/article/details/122279410?spm=1001.2014.3001.5501">PointNet++</a>获得接下来用于置信度分类和框优化的判别特征向量。<br> 采用相似的基于bin回归的损失用于提案优化。一个groundtruth框被分配给提案框用来优化，如果他们的3D IoU大于0.55，因此作者假设预测角度和真实朝向的范围在 [<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         − 
        
       
         π 
        
       
         / 
        
       
         4 
        
       
         , 
        
       
         π 
        
       
         / 
        
       
         4 
        
       
      
        -\pi/4, \pi/4 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">−</span><span class="mord mathdefault" style="margin-right: 0.03588em;">π</span><span class="mord">/</span><span class="mord">4</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">π</span><span class="mord">/</span><span class="mord">4</span></span></span></span></span>] ，然后作者将这 [<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         π 
        
       
         / 
        
       
         2 
        
       
      
        \pi/2 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">π</span><span class="mord">/</span><span class="mord">2</span></span></span></span></span>] 划分为一个个的大小为 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ω 
        
       
      
        \omega 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.43056em; vertical-align: 0em;"></span><span class="mord mathdefault" style="margin-right: 0.03588em;">ω</span></span></span></span></span> 的bin，然后设置计算朝向的bin和res.<br> <img src="https://images2.imgbox.com/aa/8f/Sqp59BLI_o.png" alt="在这里插入图片描述"><br> 则整个二阶段子网络的全部loss为：<br> <img src="https://images2.imgbox.com/62/00/BCZVcCsM_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          β 
         
        
       
         \beta 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em;"></span><span class="mord mathdefault" style="margin-right: 0.05278em;">β</span></span></span></span></span>是阶段1的3D proposal 几何 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
         
           B 
          
          
          
            p 
           
          
            o 
           
          
            s 
           
          
         
        
       
         B_{pos} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.969438em; vertical-align: -0.286108em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.05017em;">B</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.15139200000000003em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.05017em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">p</span><span class="mord mathdefault mtight">o</span><span class="mord mathdefault mtight">s</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.286108em;"><span class=""></span></span></span></span></span></span></span></span></span></span> 存放着positive的回归proposals<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          p 
         
        
          r 
         
        
          o 
         
         
         
           b 
          
         
           i 
          
         
        
       
         prob_{i} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.8888799999999999em; vertical-align: -0.19444em;"></span><span class="mord mathdefault">p</span><span class="mord mathdefault" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault">o</span><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是估算 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            b 
           
          
            i 
           
          
         
           ~ 
          
         
        
       
         \tilde{b_{i}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0812999999999997em; vertical-align: -0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9312999999999998em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.61344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span>的置信度 <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          l 
         
        
          a 
         
        
          b 
         
        
          e 
         
         
         
           l 
          
         
           i 
          
         
        
       
         label_{i} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.84444em; vertical-align: -0.15em;"></span><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="mord mathdefault">a</span><span class="mord mathdefault">b</span><span class="mord mathdefault">e</span><span class="mord"><span class="mord mathdefault" style="margin-right: 0.01968em;">l</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: -0.01968em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span></span>是对应的label<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            L 
           
           
           
             b 
            
           
             i 
            
           
             n 
            
           
           
           
             ( 
            
           
             i 
            
           
             ) 
            
           
          
         
           ~ 
          
         
        
       
         \tilde{L_{bin}^{(i)}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.5829679999999997em; vertical-align: -0.3013079999999999em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.2816599999999998em;"><span class="" style="top: -3.0447999999999995em;"><span class="pstrut" style="height: 3.0448em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.3986920000000005em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">b</span><span class="mord mathdefault mtight">i</span><span class="mord mathdefault mtight">n</span></span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3013079999999999em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -4.0085999999999995em;"><span class="pstrut" style="height: 3.0448em;"></span><span class="accent-body" style="left: -0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.3013079999999999em;"><span class=""></span></span></span></span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            L 
           
           
           
             r 
            
           
             e 
            
           
             s 
            
           
           
           
             ( 
            
           
             i 
            
           
             ) 
            
           
          
         
           ~ 
          
         
        
       
         \tilde{L_{res}^{(i)}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.3982519999999998em; vertical-align: -0.11659200000000003em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.2816599999999998em;"><span class="" style="top: -3.0447999999999995em;"><span class="pstrut" style="height: 3.0448em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.0448em;"><span class="" style="top: -2.5834080000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.02778em;">r</span><span class="mord mathdefault mtight">e</span><span class="mord mathdefault mtight">s</span></span></span></span><span class="" style="top: -3.2198em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mopen mtight">(</span><span class="mord mathdefault mtight">i</span><span class="mclose mtight">)</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659200000000003em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -4.0085999999999995em;"><span class="pstrut" style="height: 3.0448em;"></span><span class="accent-body" style="left: -0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.11659200000000003em;"><span class=""></span></span></span></span></span></span></span></span></span>使用的是通过<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            b 
           
          
            i 
           
           
           
             g 
            
           
             t 
            
           
          
         
           ~ 
          
         
        
       
         \tilde{b_{i}^{gt}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.4251879999999997em; vertical-align: -0.276864em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 1.1483239999999997em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9114639999999999em;"><span class="" style="top: -2.4231360000000004em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="" style="top: -3.1809080000000005em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight" style="margin-right: 0.03588em;">g</span><span class="mord mathdefault mtight">t</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.830464em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.276864em;"><span class=""></span></span></span></span></span></span></span></span></span>和<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
         
          
          
            b 
           
          
            i 
           
          
         
           ~ 
          
         
        
       
         \tilde{b_{i}} 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0812999999999997em; vertical-align: -0.15em;"></span><span class="mord accent"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.9312999999999998em;"><span class="" style="top: -3em;"><span class="pstrut" style="height: 3em;"></span><span class="mord"><span class="mord"><span class="mord mathdefault">b</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.31166399999999994em;"><span class="" style="top: -2.5500000000000003em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathdefault mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span><span class="" style="top: -3.61344em;"><span class="pstrut" style="height: 3em;"></span><span class="accent-body" style="left: -0.25em;">~</span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span></span></span></span>计算的新对象</p> 
</blockquote> 
<p>最后应用鸟瞰IoU阈值0.01的有方向的NMS去除重叠的边界框，并且生成被检测对象的三维边界框。</p> 
<h4><a id="_219"></a>代码部分</h4> 
<p><img src="https://images2.imgbox.com/f9/db/c3h6x6QD_o.png" alt="在这里插入图片描述"><br> 阶段2的代码实现，具体的代码在lib/rpn/proposal_target_layer.py中。<br> <img src="https://images2.imgbox.com/85/07/YLnPE3Fk_o.png" alt="在这里插入图片描述"><br> 如图所示，最后得到的rcnn_cls 和 rcnn_reg的置信度结果。这个46也是基于bin的预测，跟之前的76是一个内涵，只是现在0-6表示x_bin。这部分的具体代码在lib/net/rcnn_net.py中。</p> 
<h2><a id="_227"></a>总结</h2> 
<p>呼呼… 终于到最后啦，这篇论文难度迅速升级，原理花费时间还是可以看懂的，但是代码部分好复杂，真要完全理解估计得一个月起步了。后续如果真的用到，在回头仔细研读代码吧。另外本文如果有什么错误的地方欢迎大家指正。🙏🙏</p> 
<h2><a id="_233"></a>参考</h2> 
<p><a href="https://www.icode9.com/content-4-895992.html" rel="nofollow">PointRCNN 学习笔记</a>（文中图片来源）<br> <a href="https://zhuanlan.zhihu.com/p/361973979" rel="nofollow">【3D目标检测】PointRCNN深度解读</a><br> <a href="https://blog.csdn.net/wqwqqwqw1231/article/details/90788500?spm=1001.2101.3001.6650.6&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-6.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-6.no_search_link&amp;utm_relevant_index=10">【代码阅读】PointRCNN网络可视化，代码详解</a><br> <a href="https://blog.csdn.net/McEason/article/details/102019607?spm=1001.2101.3001.6650.7&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-7.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-7.no_search_link&amp;utm_relevant_index=12">Point RCNN论文翻译及图解</a>（里面有个图解建议大家看看）<br> <a href="https://blog.csdn.net/qq_42305950/article/details/104338659?spm=1001.2101.3001.6650.9&amp;utm_medium=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-9.no_search_link&amp;depth_1-utm_source=distribute.pc_relevant.none-task-blog-2~default~BlogCommendFromBaidu~default-9.no_search_link&amp;utm_relevant_index=12">【阅读笔记】pointrcnn</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/976ba5f5447b8470f693d2030ceec179/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中代码块的执行</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/bdff709f87e8ac68bdf486a73785e3b9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言每日一练——第105天：杨辉三角形</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>