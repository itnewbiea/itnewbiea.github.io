<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ElasticSearch基本查询(Query查询) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ElasticSearch基本查询(Query查询)" />
<meta property="og:description" content="ElasticSearch基本查询(Query查询) 1、数据准备
2、term查询和terms查询
3、控制查询返回的数量
4、返回版本号
5、match查询
6、指定返回的字段、显示字段
7、显示要的字段、去除不需要的字段
8、排序
9、 范围查询
10、wildcard查询
11、fuzzy实现模糊查询
12、高亮搜索结果
对人工智能感兴趣的同学，可以点击以下链接：
现在人工智能非常火爆，很多朋友都想学，但是一般的教程都是为博硕生准备的，太难看懂了。最近发现了一个非常适合小白入门的教程，不仅通俗易懂而且还很风趣幽默。所以忍不住分享一下给大家。点这里可以跳转到教程。
https://www.cbedai.net/u014646662
1、数据准备
put lib3 { &#34;settings&#34;:{ &#34;number_of_shards&#34;:3, &#34;number_of_replicas&#34;:0 }, &#34;mappings&#34;:{ &#34;user&#34;:{ &#34;properties&#34;:{ &#34;name&#34;:{&#34;type&#34;:&#34;text&#34;}, &#34;address&#34;:{&#34;type&#34;:&#34;text&#34;}, &#34;age&#34;:{&#34;type&#34;:&#34;integer&#34;}, &#34;interests&#34;:{&#34;type&#34;:&#34;text&#34;}, &#34;birthday&#34;:{&#34;type&#34;:&#34;date&#34;} } } } } post /lib3/user { &#34;name&#34;:&#34;lisi&#34;, &#34;address&#34;:&#34;shandong&#34;, &#34;age&#34;:18, &#34;interests&#34;:&#34;youyong shufa changge tiaowu&#34;, &#34;birthday&#34;:&#34;2001-01-19&#34; } post /lib3/user { &#34;name&#34;:&#34;wangwu&#34;, &#34;address&#34;:&#34;zhejiang&#34;, &#34;age&#34;:22, &#34;interests&#34;:&#34;youyong shufa&#34;, &#34;birthday&#34;:&#34;1997-01-19&#34; } post /lib3/user { &#34;name&#34;:&#34;zhangsan&#34;, &#34;address&#34;:&#34;zhejiang&#34;, &#34;age&#34;:20, &#34;interests&#34;:&#34;youyong shufa changge changpao&#34;, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/98551ca90eef47a7e41b5aca72ccd5df/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-04T09:29:58+08:00" />
<meta property="article:modified_time" content="2019-04-04T09:29:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ElasticSearch基本查询(Query查询)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>ElasticSearch基本查询(Query查询)   </h2> 
<p>1、数据准备<br> 2、term查询和terms查询<br> 3、控制查询返回的数量<br> 4、返回版本号<br> 5、match查询<br> 6、指定返回的字段、显示字段<br> 7、显示要的字段、去除不需要的字段<br> 8、排序<br> 9、 范围查询<br> 10、wildcard查询<br> 11、fuzzy实现模糊查询<br> 12、高亮搜索结果</p> 
<p>对人工智能感兴趣的同学，可以点击以下链接：</p> 
<p><a href="https://www.cbedai.net/u014646662" rel="nofollow">现在人工智能非常火爆，很多朋友都想学，但是一般的教程都是为博硕生准备的，太难看懂了。最近发现了一个非常适合小白入门的教程，不仅通俗易懂而且还很风趣幽默。所以忍不住分享一下给大家。点这里可以跳转到教程。</a></p> 
<p><a href="https://www.cbedai.net/u014646662" rel="nofollow">https://www.cbedai.net/u014646662</a></p> 
<p>1、数据准备</p> 
<pre class="has"><code class="language-javascript">
put lib3
{
  "settings":{
    "number_of_shards":3,
    "number_of_replicas":0
  },
  "mappings":{
    "user":{
      "properties":{
        "name":{"type":"text"},
        "address":{"type":"text"},
        "age":{"type":"integer"},
        "interests":{"type":"text"},
        "birthday":{"type":"date"}
      }
    }
  }
}

post /lib3/user
{
  "name":"lisi",
  "address":"shandong",
  "age":18,
  "interests":"youyong shufa changge tiaowu",
  "birthday":"2001-01-19"
}

post /lib3/user
{
  "name":"wangwu",
  "address":"zhejiang",
  "age":22,
  "interests":"youyong shufa",
  "birthday":"1997-01-19"
}

post /lib3/user
{
  "name":"zhangsan",
  "address":"zhejiang",
  "age":20,
  "interests":"youyong shufa changge changpao",
  "birthday":"1999-08-29"
}

post /lib3/user
{
  "name":"youyong",
  "address":"zhejiang",
  "age":20,
  "interests":"youyong shufa changge changpao",
  "birthday":"1999-08-29"
}
</code></pre> 
<p>测试一下</p> 
<pre class="has"><code class="language-javascript">get /lib3/user/_search?q=name:lisi
get /lib3/user/_search?q=name:wangwu&amp;sort=age:desc</code></pre> 
<p>2、term查询和terms查询</p> 
<p>term query会去倒排索引中寻找确切的term，它并不知道分词器的存在。这种查询适合keyword 、numeric、date。</p> 
<p>term:查询某个字段里含有某个关键词的文档</p> 
<p>terms:查询某个字段里含有多个关键词的文档</p> 
<p>a、<code>term</code> 和 <code>terms</code> 是 <em>包含（contains）</em> 操作，而非 <em>等值（equals）</em> （判断）</p> 
<p>b、不知道分词器的存在，所以不会去分词，</p> 
<p>c、所谓的包含是文档分词结果某个分词是否相等，即文档是否包含这个分词</p> 
<p>d、因为是在分词结果中匹配，所以大写要转换为小写，大写字母是匹配不到</p> 
<pre class="has"><code>get /lib3/user/_search/
{
  "query":{"term":{ "interests":"youyong"}}
}

get lib3/user/_search/
{
  "query":{"terms":{"interests":["shufa","youyong"]}}
}
</code></pre> 
<p>3、控制查询返回的数量</p> 
<pre class="has"><code class="language-Kotlin">get lib3/user/_search
{
  "from":0,
  "size":2,
  "query":{
    "terms":{
      "interests": ["changge","tiaowu"]
    }
  }
}</code></pre> 
<p>4、返回版本号</p> 
<pre class="has"><code class="language-javascript">get lib3/user/_search
{
  "version":true,
  "query":{
    "term":{"interests": "changge"}
  }
}</code></pre> 
<p>5、match查询</p> 
<ul><li>match query知道分词器的存在，会对filed进行分词操作，然后再查询</li><li>match_all:查询所有文档</li><li>multi_match:可以指定多个字段</li><li>match_phrase:短语匹配查询，ElasticSearch引擎首先分析（analyze）查询字符串，从分析后的文本中构建短语查询，这意味着必须匹配短语中的所有分词，并且保证各个分词的相对位置不变</li></ul> 
<pre class="has"><code class="language-javascript">GET lib3/user/_search
{
  "query":{"match":{"age": 20}}
}
GET lib3/user/_search
{
  "query":{"match":{"interests": "changge"}}
}

GET lib3/user/_search
{
  "query":{
    "match_all": {}
  }
}

GET lib3/user/_search
{
  "query":{
    "multi_match": {
      "query": "youyong",
      "fields":["interests","name"]
    }
  }
}

get lib3/user/_search
{
  "query":{
    "match_phrase":{"interests": "youyong shufa"}
  }
}</code></pre> 
<p>6、指定返回的字段</p> 
<pre class="has"><code class="language-javascript">get lib3/user/_search
{
  "_source":["name","age"],
  "query":{
    "match": {
      "interests": "changge"
    }
  }
}</code></pre> 
<p>7、显示要的字段、去除不需要的字段、可以使用通配符*</p> 
<pre class="has"><code class="language-javascript">get lib3/user/_search
{
  "query":{
    "match_all": {}
  },
  "_source":{
     "includes": "addr*",
     "excludes": ["name","bir*"]
  }
}</code></pre> 
<p>8、排序</p> 
<p>前缀匹配查询"match_phrase_prefix", 并使用sort实现排序：desc:降序，asc升序</p> 
<pre class="has"><code class="language-javascript">GET /lib3/user/_search
{
    "query": {
        "match_phrase_prefix": {
          "interests": "you"
        }
    },
    
    "sort":[
      {
        "age":{"order": "desc"}
      }
      ]
}
</code></pre> 
<p>9、 范围查询</p> 
<p>range:实现范围查询</p> 
<p>参数：from,to,include_lower,include_upper,boost</p> 
<p>include_lower:是否包含范围的左边界，默认是true</p> 
<p>include_upper:是否包含范围的右边界，默认是true</p> 
<pre class="has"><code class="language-javascript">GET /lib3/user/_search
{
    "query": {
        "range": {
            "birthday": {
                "from": "1990-10-10",
                "to": "2000-05-01",
                 "include_lower": true,
                "include_upper": false
            }
        }
    }
}


GET /lib3/user/_search
{
    "query": {
        "range": {
            "age": {
                "from": 18,
                "to": 25,
                "include_lower": true,
                "include_upper": false
            }
        }
    }
}</code></pre> 
<p>10、wildcard查询</p> 
<p>允许使用通配符* 和 ?来进行查询<br> *代表0个或多个字符<br> ？代表任意一个字符</p> 
<pre class="has"><code class="language-javascript">GET /lib3/user/_search
{
    "query": {
        "wildcard": {
             "name": "wang*"
        }
    }
}


GET /lib3/user/_search
{
    "query": {
        "wildcard": {
             "name": "li?i"
        }
    }
}</code></pre> 
<p>11、fuzzy实现模糊查询</p> 
<p>fuzzy 查询是 term 查询的模糊等价。</p> 
<p>a、是 <em>包含（contains）</em> 操作，而非 <em>等值（equals）</em> （判断）。</p> 
<p>b、不知道分词器的存在，所以不会去分词，</p> 
<p>c、所谓的包含是文档分词结果某个分词是否包含，不是整个文档是否包含</p> 
<p>d、因为是在分词结果中匹配，所以大写要转换为小写，大写字母是匹配不到</p> 
<p>value：查询的关键字<br> boost：查询的权值，默认值是1.0<br> min_similarity:设置匹配的最小相似度，默认值为0.5，对于字符串，取值为0-1(包括0和1);对于数值，取值可能大于1;对于日期型取值为1d,1m等，1d就代表1天<br> prefix_length:指明区分词项的共同前缀长度，默认是0<br> max_expansions:查询中的词项可以扩展的数目，默认可以无限大</p> 
<pre class="has"><code>GET /lib3/user/_search
{
    "query": {
        "fuzzy": {
             "interests": "chagge"
        }
    }
}

GET /lib3/user/_search
{
    "query": {
        "fuzzy": {
             "interests": {
                 "value": "chagge"
             }
        }
    }
}</code></pre> 
<p>12、高亮搜索结果</p> 
<pre class="has"><code class="language-javascript">GET /lib3/user/_search
{
    "query":{
        "match":{
            "interests": "changge"
        }
    },
    "highlight": {
        "fields": {
             "interests": {}
        }
    }
}</code></pre> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7937bf52ae87e99ca881bd1c0958fe77/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java中当输入行数未知时，读取命令行输入的解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f19d8938c387856514703000712dd2d8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">input框不可编辑的三种方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>