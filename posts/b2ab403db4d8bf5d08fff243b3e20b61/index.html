<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8s之Pod资源管理（五） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8s之Pod资源管理（五）" />
<meta property="og:description" content="pod是k8s管理的最小单元
pod中有多个容器，现实生产环境中只有一个容器
特点: 1.最小部署单元
2.一组容器的集合
3.一个Pod中的容器共享网络命令空间
4.Pod是短暂的
Pod容器分类： 1：infrastructure container 基础容器（透明的过程，用户无感知） 维护整个Pod网络空间
node节点操作 `查看容器的网络` [root@node1 ~]# cat /opt/kubernetes/cfg/kubelet KUBELET_OPTS=&#34;--logtostderr=true \ --v=4 \ --hostname-override=192.168.18.148 \ --kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \ --bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \ --config=/opt/kubernetes/cfg/kubelet.config \ --cert-dir=/opt/kubernetes/ssl \ --pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0&#34;	#提示网络组件镜像会从阿里云上进行下载 `每次创建Pod时候就会创建，与Pod对应的，对于用户是透明的` [root@node1 ~]# docker ps CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES ......此处省略多行 54d9e6ec3c02 registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0 &#34;/pause&#34; #网络组件会被自动加载成一个组件提供出去 `结论：基础容器在创建时，一定会去创建一个网络容器` 2：initcontainers 初始化容器 pod在进行创建时一定会被执行当中的初始化initcontainers，在老版本中执行时不会区分前后顺序（在系统进行加载时PID号数字越小，优先级别越高，越先被启动），随着云平台的改进，启动模式改为主机形式，分隔出的初始化容器会被优先加载，在初始化容器加载完成之后后面的业务容器才能正常接着运行
3：container 业务容器（并行启动） 官方网站：https://kubernetes.io/docs/concepts/workloads/pods/init-containers/
示例： Init containers in use This example defines a simple Pod that has two init containers." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b2ab403db4d8bf5d08fff243b3e20b61/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-15T21:34:32+08:00" />
<meta property="article:modified_time" content="2020-02-15T21:34:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8s之Pod资源管理（五）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p><strong>pod是k8s管理的最小单元</strong></p> 
 <p><strong>pod中有多个容器，现实生产环境中只有一个容器</strong></p> 
</blockquote> 
<hr> 
<h5><a id="_8"></a>特点:</h5> 
<blockquote> 
 <p><strong>1.最小部署单元</strong><br> <strong>2.一组容器的集合</strong><br> <strong>3.一个Pod中的容器共享网络命令空间</strong><br> <strong>4.Pod是短暂的</strong></p> 
</blockquote> 
<hr> 
<h4><a id="Pod_17"></a>Pod容器分类：</h4> 
<h5><a id="1infrastructure_container__19"></a>1：infrastructure container 基础容器（透明的过程，用户无感知）</h5> 
<p><strong><code>维护整个Pod网络空间</code></strong></p> 
<h6><a id="node_23"></a>node节点操作</h6> 
<pre><code class="prism language-bash"><span class="token variable"><span class="token variable">`</span>查看容器的网络<span class="token variable">`</span></span>
<span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># cat /opt/kubernetes/cfg/kubelet</span>
KUBELET_OPTS<span class="token operator">=</span><span class="token string">"--logtostderr=true \
--v=4 \
--hostname-override=192.168.18.148 \
--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \
--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \
--config=/opt/kubernetes/cfg/kubelet.config \
--cert-dir=/opt/kubernetes/ssl \
--pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0"</span>	<span class="token comment">#提示网络组件镜像会从阿里云上进行下载</span>

<span class="token variable"><span class="token variable">`</span>每次创建Pod时候就会创建，与Pod对应的，对于用户是透明的<span class="token variable">`</span></span>
<span class="token punctuation">[</span>root@node1 ~<span class="token punctuation">]</span><span class="token comment"># docker ps</span>
CONTAINER ID        IMAGE                                                                 COMMAND                  CREATED             STATUS              PORTS               NAMES
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>此处省略多行
54d9e6ec3c02        registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0   <span class="token string">"/pause"</span>
<span class="token comment">#网络组件会被自动加载成一个组件提供出去</span>
<span class="token variable"><span class="token variable">`</span>结论：基础容器在创建时，一定会去创建一个网络容器<span class="token variable">`</span></span>
</code></pre> 
<hr> 
<h5><a id="2initcontainers__48"></a>2：initcontainers 初始化容器</h5> 
<p><strong><code>pod在进行创建时一定会被执行当中的初始化initcontainers，在老版本中执行时不会区分前后顺序（在系统进行加载时PID号数字越小，优先级别越高，越先被启动），随着云平台的改进，启动模式改为主机形式，分隔出的初始化容器会被优先加载，在初始化容器加载完成之后后面的业务容器才能正常接着运行</code></strong></p> 
<hr> 
<h5><a id="3container__54"></a>3：container 业务容器（并行启动）</h5> 
<p><code>官方网站：https://kubernetes.io/docs/concepts/workloads/pods/init-containers/</code></p> 
<h6><a id="_58"></a>示例：</h6> 
<h5><a id="Init_containers_in_use_60"></a>Init containers in use</h5> 
<p>This example defines a simple Pod that has two init containers. The first waits for <code>myservice</code>, and the second waits for <code>mydb</code>. Once both init containers complete, the Pod runs the app container from its <code>spec</code> section.</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>pod
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">app</span><span class="token punctuation">:</span> myapp
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> myapp<span class="token punctuation">-</span>container
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.28</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'echo The app is running! &amp;&amp; sleep 3600'</span><span class="token punctuation">]</span>
  <span class="token key atrule">initContainers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>myservice
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.28</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'until nslookup myservice; do echo waiting for myservice; sleep 2; done;'</span><span class="token punctuation">]</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> init<span class="token punctuation">-</span>mydb
    <span class="token key atrule">image</span><span class="token punctuation">:</span> busybox<span class="token punctuation">:</span><span class="token number">1.28</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'sh'</span><span class="token punctuation">,</span> <span class="token string">'-c'</span><span class="token punctuation">,</span> <span class="token string">'until nslookup mydb; do echo waiting for mydb; sleep 2; done;'</span><span class="token punctuation">]</span>
</code></pre> 
<h6><a id="image_PullPolicy_85"></a>镜像拉取策略（image PullPolicy）</h6> 
<blockquote> 
 <p><strong>IfNotPresent：默认值，镜像在宿主机上不存在时才拉取</strong></p> 
 <p><strong>Always：每次创建Pod都会重新拉取一次镜像</strong></p> 
 <p><strong>Never：Pod永远不会主动拉取这个镜像</strong></p> 
</blockquote> 
<p><code>官方网站：https://kubernetes.io/docs/concepts/containers/images</code></p> 
<h6><a id="_95"></a>示例：</h6> 
<p>Verify by creating a pod that uses a private image, e.g.:</p> 
<pre><code class="prism language-shell">kubectl apply -f - <span class="token operator">&lt;&lt;</span><span class="token string">EOF
apiVersion: v1
kind: Pod
metadata:
  name: private-image-test-1
spec:
  containers:
    - name: uses-private-image
      image: <span class="token variable">$PRIVATE_IMAGE_NAME</span>
      imagePullPolicy: Always
      command: [ "echo", "SUCCESS" ]
EOF</span>
</code></pre> 
<h6><a id="master1_114"></a>master1上操作</h6> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>root@master1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span>
NAME                                READY   STATUS    RESTARTS   AGE
my-nginx-d55b94fd-kc2gl             1/1     Running   0          40h
my-nginx-d55b94fd-tkr42             1/1     Running   0          40h
nginx-6c94d899fd-8pf48              1/1     Running   0          2d15h
nginx-deployment-5477945587-f5dsm   1/1     Running   0          2d14h
nginx-deployment-5477945587-hmgd2   1/1     Running   0          2d14h
nginx-deployment-5477945587-pl2hn   1/1     Running   0          2d14h

<span class="token punctuation">[</span>root@master1 ~<span class="token punctuation">]</span><span class="token comment"># kubectl edit deployment/my-nginx</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>此处省略多行
    spec:
      containers:
      - image: nginx:1.15.4
        imagePullPolicy: IfNotPresent
        name: nginx
        ports:
        - containerPort: 80
          protocol: TCP
        resources: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
        terminationMessagePath: /dev/termination-log
        terminationMessagePolicy: File
      dnsPolicy: ClusterFirst
      restartPolicy: Always
      schedulerName: default-scheduler
      securityContext: <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
      terminationGracePeriodSeconds: 30

<span class="token punctuation">[</span>root@master1 ~<span class="token punctuation">]</span><span class="token comment"># cd demo/</span>
<span class="token punctuation">[</span>root@master1 demo<span class="token punctuation">]</span><span class="token comment"># vim pod1.yaml</span>
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  containers:
    - name: nginx
      image: nginx
      imagePullPolicy: Always
      command: <span class="token punctuation">[</span> <span class="token string">"echo"</span>, <span class="token string">"SUCCESS"</span> <span class="token punctuation">]</span>
<span class="token punctuation">[</span>root@master1 demo<span class="token punctuation">]</span><span class="token comment"># kubectl create -f pod1.yaml	#进行创建</span>
pod/mypod created
</code></pre> 
<h6><a id="CrashLoopBackOff_161"></a>此时会出现CrashLoopBackOff创建之后又关闭的状态提示</h6> 
<pre><code class="prism language-bash"><span class="token variable"><span class="token variable">`</span>失败的状态的原因是因为命令启动冲突<span class="token variable">`</span></span>
apiVersion: v1
kind: Pod
metadata:
  name: mypod
spec:
  containers:
    - name: nginx
      image: nginx:1.14		<span class="token comment">#同时更改一下版本nginx:1.14</span>
      imagePullPolicy: Always
<span class="token comment">#删除最后一行的command: [ "echo", "SUCCESS" ]语句</span>

<span class="token variable"><span class="token variable">`</span>删除原有的资源<span class="token variable">`</span></span>
<span class="token punctuation">[</span>root@master1 demo<span class="token punctuation">]</span><span class="token comment"># kubectl delete -f pod1.yaml</span>
pod <span class="token string">"mypod"</span> deleted

<span class="token variable"><span class="token variable">`</span>更新资源<span class="token variable">`</span></span>
<span class="token punctuation">[</span>root@master1 demo<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pod1.yaml</span>
pod/mypod created
<span class="token punctuation">[</span>root@master1 demo<span class="token punctuation">]</span><span class="token comment"># kubectl get pods</span>
NAME                                READY   STATUS    RESTARTS   AGE
mypod                               1/1     Running   0          3m26s

<span class="token variable"><span class="token variable">`</span>查看分配节点<span class="token variable">`</span></span>
<span class="token punctuation">[</span>root@master1 demo<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -o wide</span>
NAME          READY   STATUS    RESTARTS   AGE     IP            NODE           NOMINATED NODE
mypod         1/1     Running   0          4m45s   172.17.40.5   192.168.18.145   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
<span class="token comment">#此时172.17.40.5段，对应的是node2节点的192.168.18.145地址</span>

<span class="token variable"><span class="token variable">`</span>到node2上查看指定的应用是否部署到指定节点上<span class="token variable">`</span></span>
<span class="token punctuation">[</span>root@node2 ~<span class="token punctuation">]</span><span class="token comment"># curl -I 172.17.40.5</span>
HTTP/1.1 200 OK
Server: nginx/1.14.2
Date: Sat, 15 Feb 2020 04:11:53 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Tue, 04 Dec 2018 14:44:49 GMT
Connection: keep-alive
ETag: <span class="token string">"5c0692e1-264"</span>
Accept-Ranges: bytes
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0dad93d97f7bedfe214265bc2facd347/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">candence 16.6 详细安装说明</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2172b77a4dd7362d46335ede369678d4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【GIT】git clone项目后找不到项目存放在哪个文件夹，git如何修改本地默认下载仓库地址</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>