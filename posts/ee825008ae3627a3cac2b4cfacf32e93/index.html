<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>旋转框目标检测mmrotate v0.3.1 训练DOTA数据集（二） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="旋转框目标检测mmrotate v0.3.1 训练DOTA数据集（二）" />
<meta property="og:description" content="1、数据集构建 MMRoteate 支持的数据集
类别 The object categories in DOTA-v1.0: plane, ship, storage tank, baseball diamond, tennis court, basketball court, ground track field, harbor, bridge, large vehicle, small vehicle, helicopter, roundabout, soccer ball field and swimming pool. The object categories in DOTA-v1.5: plane, ship, storage tank, baseball diamond, tennis court, basketball court, ground track field, harbor, bridge, large vehicle, small vehicle, helicopter, roundabout, soccer ball field, swimming pool and container crane." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ee825008ae3627a3cac2b4cfacf32e93/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-14T13:47:28+08:00" />
<meta property="article:modified_time" content="2023-06-14T13:47:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">旋转框目标检测mmrotate v0.3.1 训练DOTA数据集（二）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1、数据集构建</h3> 
<p>MMRoteate 支持的数据集<br> <img src="https://images2.imgbox.com/c3/55/CBRgBhPf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_3"></a>类别</h4> 
<pre><code class="prism language-bash">The object categories <span class="token keyword">in</span> DOTA-v1.0: 
plane, ship, storage tank, baseball diamond, tennis court, basketball court, ground track field, harbor, bridge, large vehicle, small vehicle, helicopter, roundabout, soccer ball field and swimming pool.
The object categories <span class="token keyword">in</span> DOTA-v1.5:
 plane, ship, storage tank, baseball diamond, tennis court, basketball court, ground track field, harbor, bridge, large vehicle, small vehicle, helicopter, roundabout, soccer ball field, swimming pool and container crane.
The object categories <span class="token keyword">in</span> DOTA-v2.0:
 plane, ship, storage tank, baseball diamond, tennis court, basketball court, ground track field, harbor, bridge, large vehicle, small vehicle, helicopter, roundabout, soccer ball field, swimming pool, container crane, airport and helipad.
</code></pre> 
<h4><a id="_12"></a>注释的格式</h4> 
<p>在数据集中，每个对象都由一个面向边界框(OBB)标注，可以表示为<img src="https://images2.imgbox.com/9b/62/H73J5Jh6_o.png" alt="在这里插入图片描述"><br> ，其中(xi, yi)表示OBB的第i个顶点。顶点按顺时针顺序排列。下面是注释的可视化。<strong>黄色的点代表起点</strong>，这意味着: (a) top-left of a plane, (b) top-left corner of a large vehicle diamond, © center of a baseball diamond.</p> 
<p>除了OBB，每个实例还被标记为一个类别和一个困难，表明实例是否难以检测(1为困难，O为不困难)。对图像的注释保存在具有相同文件名的文本文件中。每一行表示一个实例。下面是一个图片注释的例子:</p> 
<pre><code class="prism language-bash">x1, y1, x2, y2, x3, y3, x4, y4, category, difficult
x1, y1, x2, y2, x3, y3, x4, y4, category, difficult
<span class="token punctuation">..</span>.
</code></pre> 
<p>给出了图像采集数据、图像源和GSD的元数据。在第一行，给出了“收购日期”。在第二行，给出了Yimagesource’ (GoogleEarth, GF-2或JL-1)。第三行给出了地面采样距离(GSD)，单位为米。如果缺少lacquisition dates’和’gsd’，则将其标注为’None’。</p> 
<pre><code class="prism language-bash"><span class="token string">'acquisition dates'</span>:acquisition dates
<span class="token string">'imagesource'</span>:imagesource
<span class="token string">'gsd'</span>:gsd
</code></pre> 
<p>在这里插入图片描述</p> 
<h4><a id="Data_Download_31"></a>Data Download</h4> 
<p>DOTA-v1.0</p> 
<h4><a id="Task1_Detection_with_oriented_bounding_boxes_34"></a>Task1-- Detection with oriented bounding boxes</h4> 
<h4><a id="Task2_Detection_with_horizontal_bounding_boxes_35"></a>Task2-- Detection with horizontal bounding boxes</h4> 
<h4><a id="_36"></a>其他情况说明</h4> 
<p>图片大小：800×800到4000×4000</p> 
<h4><a id="1DOTA__38"></a>1、DOTA 航拍数据集格式构建</h4> 
<p>DOTA数据集文件结构<br> mmrotate<br> ├── mmrotate<br> ├── tools<br> ├── configs<br> ├── data<br> │ ├── DOTA<br> │ │ ├── train<br> images<br> annfiles</p> 
<p>│ │ ├── val<br> images<br> annfiles</p> 
<p>│ │ ├── test</p> 
<h5><a id="1dataset_dota_settings_56"></a>1、dataset dota settings</h5> 
<pre><code class="prism language-bash"><span class="token comment"># dataset settings</span>
dataset_type <span class="token operator">=</span> <span class="token string">'DOTADataset'</span>
data_root <span class="token operator">=</span> <span class="token string">'data/split_1024_dota1_0/'</span>
img_norm_cfg <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">mean</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span>, <span class="token number">116.28</span>, <span class="token number">103.53</span><span class="token punctuation">]</span>, <span class="token assign-left variable">std</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span>, <span class="token number">57.12</span>, <span class="token number">57.375</span><span class="token punctuation">]</span>, <span class="token assign-left variable">to_rgb</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
train_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadAnnotations'</span>, <span class="token assign-left variable">with_bbox</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RResize'</span>, <span class="token assign-left variable">img_scale</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1024</span>, <span class="token number">1024</span><span class="token punctuation">))</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RRandomFlip'</span>, <span class="token assign-left variable">flip_ratio</span><span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Normalize'</span>, **img_norm_cfg<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span>, <span class="token assign-left variable">size_divisor</span><span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span>, <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span>, <span class="token string">'gt_bboxes'</span>, <span class="token string">'gt_labels'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
test_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span>,
        <span class="token assign-left variable">img_scale</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1024</span>, <span class="token number">1024</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">flip</span><span class="token operator">=</span>False,
        <span class="token assign-left variable">transforms</span><span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RResize'</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Normalize'</span>, **img_norm_cfg<span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span>, <span class="token assign-left variable">size_divisor</span><span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span>, <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
data <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">samples_per_gpu</span><span class="token operator">=</span><span class="token number">2</span>,
    <span class="token assign-left variable">workers_per_gpu</span><span class="token operator">=</span><span class="token number">2</span>,
    <span class="token assign-left variable">train</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'trainval/annfiles/'</span>,
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'trainval/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>train_pipeline<span class="token punctuation">)</span>,
    <span class="token assign-left variable">val</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'trainval/annfiles/'</span>,
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'trainval/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>test_pipeline<span class="token punctuation">)</span>,
    <span class="token assign-left variable">test</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'test/images/'</span>,
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'test/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>test_pipeline<span class="token punctuation">))</span>

</code></pre> 
<h5><a id="2split_dota_datasettrainvaltest_108"></a>2、split dota dataset（train\val\test）</h5> 
<p>将得到的 train、test、val 中的图片进行裁剪，裁剪的原因 是由于我的图像是1920×1080的矩形，而且也不是png格式的，所以找到：mmrotate-main/tools/data/dota/split/ 路径下img_split.py文件(裁剪脚本) 以及 mmrotate-main/tools/data/dota/split/split_configs/ 路径下的配置文件，其文件内容就是img_split.py的配置信息，我们需要修改其中的参数，让其加载上述的train、test、val中的图像及标签，并进行裁剪。<br> <img src="https://images2.imgbox.com/77/eb/naHp7DNL_o.png" alt="在这里插入图片描述"></p> 
<p>修改好上述几个关键的参数之后，即可运行img_split.py进行裁剪了：</p> 
<h6><a id="11024x1024200_115"></a>1、请将原始图像裁剪成1024x1024的补丁，运行时重叠200个</h6> 
<pre><code class="prism language-bash">python tools/data/dota/split/img_split.py --base-json <span class="token punctuation">\</span>
  tools/data/dota/split/split_configs/ss_trainval.json

python tools/data/dota/split/img_split.py --base-json <span class="token punctuation">\</span>
  tools/data/dota/split/split_configs/ss_test.json
</code></pre> 
<h6><a id="2_124"></a>2、如果您想获得一个多尺度数据集，可以运行以下命令</h6> 
<pre><code class="prism language-bash">python tools/data/dota/split/img_split.py --base-json <span class="token punctuation">\</span>
  tools/data/dota/split/split_configs/ms_trainval.json

python tools/data/dota/split/img_split.py --base-json <span class="token punctuation">\</span>
  tools/data/dota/split/split_configs/ms_test.json
</code></pre> 
<h6><a id="1ss_trainjson_133"></a>1、ss_train.json修改</h6> 
<pre><code class="prism language-bash"><span class="token punctuation">{<!-- --></span>
  <span class="token string">"nproc"</span><span class="token builtin class-name">:</span> <span class="token number">10</span>,
  <span class="token string">"img_dirs"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">"data/DOTA/dotav1/train/images/"</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"ann_dirs"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token string">"data/DOTA/dotav1/train/obb_annfiles_v1/"</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"sizes"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token number">1024</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"gaps"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token number">200</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"rates"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token number">1.0</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"img_rate_thr"</span><span class="token builtin class-name">:</span> <span class="token number">0.6</span>,
  <span class="token string">"iof_thr"</span><span class="token builtin class-name">:</span> <span class="token number">0.7</span>,
  <span class="token string">"no_padding"</span><span class="token builtin class-name">:</span> false,
  <span class="token string">"padding_value"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span>
    <span class="token number">104</span>,
    <span class="token number">116</span>,
    <span class="token number">124</span>
  <span class="token punctuation">]</span>,
  <span class="token string">"save_dir"</span><span class="token builtin class-name">:</span> <span class="token string">"data/DOTA/split_ss_dotav1/train/"</span>,
  <span class="token string">"save_ext"</span><span class="token builtin class-name">:</span> <span class="token string">".png"</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>请修改json中的img_dirs和ann_dirs。<br> 其他 test、val、trainval数据集的裁剪同理，只需修改 - -base_json参数为对应的配置文件即可。</p> 
<pre><code class="prism language-bash">python tools/data/dota/split/img_split.py --base-json tools/data/dota/split/split_configs/ss_train.json
python tools/data/dota/split/img_split.py --base-json tools/data/dota/split/split_configs/ss_val.json
python tools/data/dota/split/img_split.py --base-json tools/data/dota/split/split_configs/ss_test.json
</code></pre> 
<p><img src="https://images2.imgbox.com/d4/53/5jLInWSw_o.png" alt="在这里插入图片描述"><br> 裁剪的结果：<br> <img src="https://images2.imgbox.com/d6/f2/jska13ro_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/ed/12/cMRu17rV_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/84/42/tUGjd8Xo_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/30/3c/8hav8lR7_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="3_182"></a>3、更改数据集基础路径及训练、验证和测试路径</h5> 
<pre><code class="prism language-bash">change data_root <span class="token keyword">in</span> configs/_base_/datasets/dotav1.py to <span class="token function">split</span> DOTA dataset.
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># dataset settings</span>
dataset_type <span class="token operator">=</span> <span class="token string">'DOTADataset'</span>
<span class="token comment">#data_root = 'data/split_1024_dota1_0/'</span>
data_root <span class="token operator">=</span> <span class="token string">'data/DOTA/split_ss_dotav1/'</span> <span class="token comment">#更改主路径</span>
img_norm_cfg <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">mean</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span>, <span class="token number">116.28</span>, <span class="token number">103.53</span><span class="token punctuation">]</span>, <span class="token assign-left variable">std</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span>, <span class="token number">57.12</span>, <span class="token number">57.375</span><span class="token punctuation">]</span>, <span class="token assign-left variable">to_rgb</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
train_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadAnnotations'</span>, <span class="token assign-left variable">with_bbox</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RResize'</span>, <span class="token assign-left variable">img_scale</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1024</span>, <span class="token number">1024</span><span class="token punctuation">))</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RRandomFlip'</span>, <span class="token assign-left variable">flip_ratio</span><span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Normalize'</span>, **img_norm_cfg<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span>, <span class="token assign-left variable">size_divisor</span><span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span>, <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span>, <span class="token string">'gt_bboxes'</span>, <span class="token string">'gt_labels'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
test_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span>,
        <span class="token assign-left variable">img_scale</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1024</span>, <span class="token number">1024</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">flip</span><span class="token operator">=</span>False,
        <span class="token assign-left variable">transforms</span><span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RResize'</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Normalize'</span>, **img_norm_cfg<span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span>, <span class="token assign-left variable">size_divisor</span><span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span>, <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
data <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">samples_per_gpu</span><span class="token operator">=</span><span class="token number">2</span>,
    <span class="token assign-left variable">workers_per_gpu</span><span class="token operator">=</span><span class="token number">2</span>,
    <span class="token assign-left variable">train</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token comment">#ann_file=data_root + 'trainval/annfiles/',</span>
        <span class="token comment">#img_prefix=data_root + 'trainval/images/',</span>
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'train/annfiles/'</span>, <span class="token comment">#更改训练数据路径</span>
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'train/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>train_pipeline<span class="token punctuation">)</span>,
    <span class="token assign-left variable">val</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token comment">#ann_file=data_root + 'trainval/annfiles/',</span>
        <span class="token comment">#img_prefix=data_root + 'trainval/images/',</span>
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'val/annfiles/'</span>, <span class="token comment">#更改验证数据路径</span>
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'val/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>test_pipeline<span class="token punctuation">)</span>,
    <span class="token assign-left variable">test</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'test/images/'</span>, <span class="token comment">#更改测试数据路径</span>
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'test/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>test_pipeline<span class="token punctuation">))</span>

</code></pre> 
<h3><a id="2_242"></a>2、下载预训练模型权重文件</h3> 
<p><a href="https://mmrotate.readthedocs.io/en/latest/model_zoo.html" rel="nofollow">BENCHMARK AND MODEL ZOO下载地址</a></p> 
<p><img src="https://images2.imgbox.com/b1/b5/ksle5PCn_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="1ReDet_247"></a>1、ReDet</h4> 
<p><a href="https://openaccess.thecvf.com/content/CVPR2021/papers/Han_ReDet_A_Rotation-Equivariant_Detector_for_Aerial_Object_Detection_CVPR_2021_paper.pdf" rel="nofollow">论文地址</a><br> <a href="https://github.com/open-mmlab/mmrotate/blob/main/configs/redet/README.md">预训练模型和配置文件</a></p> 
<h5><a id="1mmrotateconfigsredetredet_re50_refpn_1x_dota_le90py__250"></a>1、mmrotate/configs/redet/redet_re50_refpn_1x_dota_le90.py 配置文件信息</h5> 
<pre><code class="prism language-bash">_base_ <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token string">'../_base_/datasets/dotav1.py'</span>, <span class="token string">'../_base_/schedules/schedule_1x.py'</span>,
    <span class="token string">'../_base_/default_runtime.py'</span>
<span class="token punctuation">]</span>

angle_version <span class="token operator">=</span> <span class="token string">'le90'</span> <span class="token comment">#1、角度定义版本</span>
model <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'ReDet'</span>,
    <span class="token assign-left variable">backbone</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'ReResNet'</span>,
        <span class="token assign-left variable">depth</span><span class="token operator">=</span><span class="token number">50</span>,
        <span class="token assign-left variable">num_stages</span><span class="token operator">=</span><span class="token number">4</span>,
        <span class="token assign-left variable">out_indices</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">1</span>, <span class="token number">2</span>, <span class="token number">3</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">frozen_stages</span><span class="token operator">=</span><span class="token number">1</span>,
        <span class="token assign-left variable">style</span><span class="token operator">=</span><span class="token string">'pytorch'</span>,
        <span class="token assign-left variable">pretrained</span><span class="token operator">=</span><span class="token string">'work_dirs/pretrain/re_resnet50_c8_batch256-25b16846.pth'</span><span class="token punctuation">)</span>,<span class="token comment">#使用的预训练模型</span>
    <span class="token assign-left variable">neck</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'ReFPN'</span>,
        <span class="token assign-left variable">in_channels</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">256</span>, <span class="token number">512</span>, <span class="token number">1024</span>, <span class="token number">2048</span><span class="token punctuation">]</span>,
        <span class="token assign-left variable">out_channels</span><span class="token operator">=</span><span class="token number">256</span>,
        <span class="token assign-left variable">num_outs</span><span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">)</span>,
    <span class="token assign-left variable">rpn_head</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RotatedRPNHead'</span>,
        <span class="token assign-left variable">in_channels</span><span class="token operator">=</span><span class="token number">256</span>,
        <span class="token assign-left variable">feat_channels</span><span class="token operator">=</span><span class="token number">256</span>,
        <span class="token assign-left variable">version</span><span class="token operator">=</span>angle_version,
        <span class="token assign-left variable">anchor_generator</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
            <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'AnchorGenerator'</span>,
            <span class="token assign-left variable">scales</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span>,
            <span class="token assign-left variable">ratios</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.5</span>, <span class="token number">1.0</span>, <span class="token number">2.0</span><span class="token punctuation">]</span>,
            <span class="token assign-left variable">strides</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span>, <span class="token number">8</span>, <span class="token number">16</span>, <span class="token number">32</span>, <span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">bbox_coder</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
            <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHBBoxCoder'</span>,
            <span class="token assign-left variable">target_means</span><span class="token operator">=</span><span class="token punctuation">[</span>.0, .0, .0, .0<span class="token punctuation">]</span>,
            <span class="token assign-left variable">target_stds</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1.0</span>, <span class="token number">1.0</span>, <span class="token number">1.0</span>, <span class="token number">1.0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">loss_cls</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
            <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span>, <span class="token assign-left variable">use_sigmoid</span><span class="token operator">=</span>True, <span class="token assign-left variable">loss_weight</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">loss_bbox</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'SmoothL1Loss'</span>, <span class="token assign-left variable">beta</span><span class="token operator">=</span><span class="token number">1.0</span> / <span class="token number">9.0</span>, <span class="token assign-left variable">loss_weight</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">))</span>,
    <span class="token assign-left variable">roi_head</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RoITransRoIHead'</span>,
        <span class="token assign-left variable">version</span><span class="token operator">=</span>angle_version,
        <span class="token assign-left variable">num_stages</span><span class="token operator">=</span><span class="token number">2</span>,
        <span class="token assign-left variable">stage_loss_weights</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">1</span>, <span class="token number">1</span><span class="token punctuation">]</span>,
        <span class="token assign-left variable">bbox_roi_extractor</span><span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'SingleRoIExtractor'</span>,
                <span class="token assign-left variable">roi_layer</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RoIAlign'</span>, <span class="token assign-left variable">output_size</span><span class="token operator">=</span><span class="token number">7</span>, <span class="token assign-left variable">sampling_ratio</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">out_channels</span><span class="token operator">=</span><span class="token number">256</span>,
                <span class="token assign-left variable">featmap_strides</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span>, <span class="token number">8</span>, <span class="token number">16</span>, <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RotatedSingleRoIExtractor'</span>,
                <span class="token assign-left variable">roi_layer</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RiRoIAlignRotated'</span>,
                    <span class="token assign-left variable">out_size</span><span class="token operator">=</span><span class="token number">7</span>,
                    <span class="token assign-left variable">num_samples</span><span class="token operator">=</span><span class="token number">2</span>,
                    <span class="token assign-left variable">num_orientations</span><span class="token operator">=</span><span class="token number">8</span>,
                    <span class="token assign-left variable">clockwise</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
                <span class="token assign-left variable">out_channels</span><span class="token operator">=</span><span class="token number">256</span>,
                <span class="token assign-left variable">featmap_strides</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">4</span>, <span class="token number">8</span>, <span class="token number">16</span>, <span class="token number">32</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
        <span class="token punctuation">]</span>,
        <span class="token assign-left variable">bbox_head</span><span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RotatedShared2FCBBoxHead'</span>,
                <span class="token assign-left variable">in_channels</span><span class="token operator">=</span><span class="token number">256</span>,
                <span class="token assign-left variable">fc_out_channels</span><span class="token operator">=</span><span class="token number">1024</span>,
                <span class="token assign-left variable">roi_feat_size</span><span class="token operator">=</span><span class="token number">7</span>,
                <span class="token assign-left variable">num_classes</span><span class="token operator">=</span><span class="token number">15</span>,
                <span class="token assign-left variable">bbox_coder</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHAHBBoxCoder'</span>,
                    <span class="token assign-left variable">angle_range</span><span class="token operator">=</span>angle_version,
                    <span class="token assign-left variable">norm_factor</span><span class="token operator">=</span><span class="token number">2</span>,
                    <span class="token assign-left variable">edge_swap</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">target_means</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>.<span class="token punctuation">]</span>,
                    <span class="token assign-left variable">target_stds</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.1</span>, <span class="token number">0.1</span>, <span class="token number">0.2</span>, <span class="token number">0.2</span>, <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">reg_class_agnostic</span><span class="token operator">=</span>True,
                <span class="token assign-left variable">loss_cls</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span>,
                    <span class="token assign-left variable">use_sigmoid</span><span class="token operator">=</span>False,
                    <span class="token assign-left variable">loss_weight</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">loss_bbox</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'SmoothL1Loss'</span>, <span class="token assign-left variable">beta</span><span class="token operator">=</span><span class="token number">1.0</span>,
                               <span class="token assign-left variable">loss_weight</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">))</span>,
            dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RotatedShared2FCBBoxHead'</span>,
                <span class="token assign-left variable">in_channels</span><span class="token operator">=</span><span class="token number">256</span>,
                <span class="token assign-left variable">fc_out_channels</span><span class="token operator">=</span><span class="token number">1024</span>,
                <span class="token assign-left variable">roi_feat_size</span><span class="token operator">=</span><span class="token number">7</span>,
                <span class="token assign-left variable">num_classes</span><span class="token operator">=</span><span class="token number">15</span>,
                <span class="token assign-left variable">bbox_coder</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHAOBBoxCoder'</span>,
                    <span class="token assign-left variable">angle_range</span><span class="token operator">=</span>angle_version,
                    <span class="token assign-left variable">norm_factor</span><span class="token operator">=</span>None,
                    <span class="token assign-left variable">edge_swap</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">proj_xy</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">target_means</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>.<span class="token punctuation">]</span>,
                    <span class="token assign-left variable">target_stds</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.05</span>, <span class="token number">0.05</span>, <span class="token number">0.1</span>, <span class="token number">0.1</span>, <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">reg_class_agnostic</span><span class="token operator">=</span>False,
                <span class="token assign-left variable">loss_cls</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span>,
                    <span class="token assign-left variable">use_sigmoid</span><span class="token operator">=</span>False,
                    <span class="token assign-left variable">loss_weight</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">loss_bbox</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'SmoothL1Loss'</span>, <span class="token assign-left variable">beta</span><span class="token operator">=</span><span class="token number">1.0</span>, <span class="token assign-left variable">loss_weight</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">))</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>,
    <span class="token assign-left variable">train_cfg</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">rpn</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
            <span class="token assign-left variable">assigner</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span>,
                <span class="token assign-left variable">pos_iou_thr</span><span class="token operator">=</span><span class="token number">0.7</span>,
                <span class="token assign-left variable">neg_iou_thr</span><span class="token operator">=</span><span class="token number">0.3</span>,
                <span class="token assign-left variable">min_pos_iou</span><span class="token operator">=</span><span class="token number">0.3</span>,
                <span class="token assign-left variable">match_low_quality</span><span class="token operator">=</span>True,
                <span class="token assign-left variable">ignore_iof_thr</span><span class="token operator">=</span>-1<span class="token punctuation">)</span>,
            <span class="token assign-left variable">sampler</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RandomSampler'</span>,
                <span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token number">256</span>,
                <span class="token assign-left variable">pos_fraction</span><span class="token operator">=</span><span class="token number">0.5</span>,
                <span class="token assign-left variable">neg_pos_ub</span><span class="token operator">=</span>-1,
                <span class="token assign-left variable">add_gt_as_proposals</span><span class="token operator">=</span>False<span class="token punctuation">)</span>,
            <span class="token assign-left variable">allowed_border</span><span class="token operator">=</span><span class="token number">0</span>,
            <span class="token assign-left variable">pos_weight</span><span class="token operator">=</span>-1,
            <span class="token assign-left variable">debug</span><span class="token operator">=</span>False<span class="token punctuation">)</span>,
        <span class="token assign-left variable">rpn_proposal</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
            <span class="token assign-left variable">nms_pre</span><span class="token operator">=</span><span class="token number">2000</span>,
            <span class="token assign-left variable">max_per_img</span><span class="token operator">=</span><span class="token number">2000</span>,
            <span class="token assign-left variable">nms</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span>, <span class="token assign-left variable">iou_threshold</span><span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span>,
            <span class="token assign-left variable">min_bbox_size</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">rcnn</span><span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">assigner</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span>,
                    <span class="token assign-left variable">pos_iou_thr</span><span class="token operator">=</span><span class="token number">0.5</span>,
                    <span class="token assign-left variable">neg_iou_thr</span><span class="token operator">=</span><span class="token number">0.5</span>,
                    <span class="token assign-left variable">min_pos_iou</span><span class="token operator">=</span><span class="token number">0.5</span>,
                    <span class="token assign-left variable">match_low_quality</span><span class="token operator">=</span>False,
                    <span class="token assign-left variable">ignore_iof_thr</span><span class="token operator">=</span>-1,
                    <span class="token assign-left variable">iou_calculator</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'BboxOverlaps2D'</span><span class="token punctuation">))</span>,
                <span class="token assign-left variable">sampler</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RandomSampler'</span>,
                    <span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token number">512</span>,
                    <span class="token assign-left variable">pos_fraction</span><span class="token operator">=</span><span class="token number">0.25</span>,
                    <span class="token assign-left variable">neg_pos_ub</span><span class="token operator">=</span>-1,
                    <span class="token assign-left variable">add_gt_as_proposals</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
                <span class="token assign-left variable">pos_weight</span><span class="token operator">=</span>-1,
                <span class="token assign-left variable">debug</span><span class="token operator">=</span>False<span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">assigner</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'MaxIoUAssigner'</span>,
                    <span class="token assign-left variable">pos_iou_thr</span><span class="token operator">=</span><span class="token number">0.5</span>,
                    <span class="token assign-left variable">neg_iou_thr</span><span class="token operator">=</span><span class="token number">0.5</span>,
                    <span class="token assign-left variable">min_pos_iou</span><span class="token operator">=</span><span class="token number">0.5</span>,
                    <span class="token assign-left variable">match_low_quality</span><span class="token operator">=</span>False,
                    <span class="token assign-left variable">ignore_iof_thr</span><span class="token operator">=</span>-1,
                    <span class="token assign-left variable">iou_calculator</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RBboxOverlaps2D'</span><span class="token punctuation">))</span>,
                <span class="token assign-left variable">sampler</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RRandomSampler'</span>,
                    <span class="token assign-left variable">num</span><span class="token operator">=</span><span class="token number">512</span>,
                    <span class="token assign-left variable">pos_fraction</span><span class="token operator">=</span><span class="token number">0.25</span>,
                    <span class="token assign-left variable">neg_pos_ub</span><span class="token operator">=</span>-1,
                    <span class="token assign-left variable">add_gt_as_proposals</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
                <span class="token assign-left variable">pos_weight</span><span class="token operator">=</span>-1,
                <span class="token assign-left variable">debug</span><span class="token operator">=</span>False<span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>,
    <span class="token assign-left variable">test_cfg</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">rpn</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
            <span class="token assign-left variable">nms_pre</span><span class="token operator">=</span><span class="token number">2000</span>,
            <span class="token assign-left variable">max_per_img</span><span class="token operator">=</span><span class="token number">2000</span>,
            <span class="token assign-left variable">nms</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'nms'</span>, <span class="token assign-left variable">iou_threshold</span><span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span>,
            <span class="token assign-left variable">min_bbox_size</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">rcnn</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
            <span class="token assign-left variable">nms_pre</span><span class="token operator">=</span><span class="token number">2000</span>,
            <span class="token assign-left variable">min_bbox_size</span><span class="token operator">=</span><span class="token number">0</span>,
            <span class="token assign-left variable">score_thr</span><span class="token operator">=</span><span class="token number">0.05</span>,
            <span class="token assign-left variable">nms</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>iou_thr<span class="token operator">=</span><span class="token number">0.1</span><span class="token punctuation">)</span>,
            <span class="token assign-left variable">max_per_img</span><span class="token operator">=</span><span class="token number">2000</span><span class="token punctuation">))</span><span class="token punctuation">)</span>

img_norm_cfg <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">mean</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span>, <span class="token number">116.28</span>, <span class="token number">103.53</span><span class="token punctuation">]</span>, <span class="token assign-left variable">std</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span>, <span class="token number">57.12</span>, <span class="token number">57.375</span><span class="token punctuation">]</span>, <span class="token assign-left variable">to_rgb</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
train_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadAnnotations'</span>, <span class="token assign-left variable">with_bbox</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RResize'</span>, <span class="token assign-left variable">img_scale</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1024</span>, <span class="token number">1024</span><span class="token punctuation">))</span>,
    dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RRandomFlip'</span>,
        <span class="token assign-left variable">flip_ratio</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.25</span>, <span class="token number">0.25</span>, <span class="token number">0.25</span><span class="token punctuation">]</span>,
        <span class="token assign-left variable">direction</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'horizontal'</span>, <span class="token string">'vertical'</span>, <span class="token string">'diagonal'</span><span class="token punctuation">]</span>,
        <span class="token assign-left variable">version</span><span class="token operator">=</span>angle_version<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Normalize'</span>, **img_norm_cfg<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span>, <span class="token assign-left variable">size_divisor</span><span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span>, <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span>, <span class="token string">'gt_bboxes'</span>, <span class="token string">'gt_labels'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
data <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">train</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>pipeline<span class="token operator">=</span>train_pipeline, <span class="token assign-left variable">version</span><span class="token operator">=</span>angle_version<span class="token punctuation">)</span>,
    <span class="token assign-left variable">val</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>version<span class="token operator">=</span>angle_version<span class="token punctuation">)</span>,
    <span class="token assign-left variable">test</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>version<span class="token operator">=</span>angle_version<span class="token punctuation">))</span>

optimizer <span class="token operator">=</span> dict<span class="token punctuation">(</span>lr<span class="token operator">=</span><span class="token number">0.005</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/b4/fe/zZf7SUK6_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/66/fc/P0fFmntS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_453"></a>3、修改配置文件</h3> 
<p><a href="https://blog.csdn.net/qq_43581224/article/details/123838415">参考博客1</a><br> <a href="https://sxj731533730.blog.csdn.net/article/details/124107625" rel="nofollow">参考博客2</a></p> 
<h4><a id="1_457"></a>1、修改数据集的更改数据集基础路径及训练、验证和测试路径（如上所示）</h4> 
<h4><a id="2_458"></a>2、修改数据的类别数</h4> 
<pre><code class="prism language-bash"><span class="token assign-left variable">bbox_head</span><span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RotatedShared2FCBBoxHead'</span>,
                <span class="token assign-left variable">in_channels</span><span class="token operator">=</span><span class="token number">256</span>,
                <span class="token assign-left variable">fc_out_channels</span><span class="token operator">=</span><span class="token number">1024</span>,
                <span class="token assign-left variable">roi_feat_size</span><span class="token operator">=</span><span class="token number">7</span>,
                <span class="token assign-left variable">num_classes</span><span class="token operator">=</span><span class="token number">15</span>, <span class="token comment">#按照数据的数据类别数修改</span>
                <span class="token assign-left variable">bbox_coder</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHAHBBoxCoder'</span>,
                    <span class="token assign-left variable">angle_range</span><span class="token operator">=</span>angle_version,
                    <span class="token assign-left variable">norm_factor</span><span class="token operator">=</span><span class="token number">2</span>,
                    <span class="token assign-left variable">edge_swap</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">target_means</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>.<span class="token punctuation">]</span>,
                    <span class="token assign-left variable">target_stds</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.1</span>, <span class="token number">0.1</span>, <span class="token number">0.2</span>, <span class="token number">0.2</span>, <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">reg_class_agnostic</span><span class="token operator">=</span>True,
                <span class="token assign-left variable">loss_cls</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'CrossEntropyLoss'</span>,
                    <span class="token assign-left variable">use_sigmoid</span><span class="token operator">=</span>False,
                    <span class="token assign-left variable">loss_weight</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">loss_bbox</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'SmoothL1Loss'</span>, <span class="token assign-left variable">beta</span><span class="token operator">=</span><span class="token number">1.0</span>,
                               <span class="token assign-left variable">loss_weight</span><span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">))</span>,
            dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'RotatedShared2FCBBoxHead'</span>,
                <span class="token assign-left variable">in_channels</span><span class="token operator">=</span><span class="token number">256</span>,
                <span class="token assign-left variable">fc_out_channels</span><span class="token operator">=</span><span class="token number">1024</span>,
                <span class="token assign-left variable">roi_feat_size</span><span class="token operator">=</span><span class="token number">7</span>,
                <span class="token assign-left variable">num_classes</span><span class="token operator">=</span><span class="token number">15</span>,<span class="token comment">#按照数据的数据类别数修改</span>
                <span class="token assign-left variable">bbox_coder</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                    <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'DeltaXYWHAOBBoxCoder'</span>,
                    <span class="token assign-left variable">angle_range</span><span class="token operator">=</span>angle_version,
                    <span class="token assign-left variable">norm_factor</span><span class="token operator">=</span>None,
                    <span class="token assign-left variable">edge_swap</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">proj_xy</span><span class="token operator">=</span>True,
                    <span class="token assign-left variable">target_means</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>., <span class="token number">0</span>.<span class="token punctuation">]</span>,
                    <span class="token assign-left variable">target_stds</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0.05</span>, <span class="token number">0.05</span>, <span class="token number">0.1</span>, <span class="token number">0.1</span>, <span class="token number">0.5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">reg_class_agnostic</span><span class="token operator">=</span>False,
</code></pre> 
<h4><a id="3batch_sizeconfigs_base_datasetsdotav1py_499"></a>3、修改线程和batch_size(configs/<em>base</em>/datasets/dotav1.py)</h4> 
<pre><code class="prism language-bash">data <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">samples_per_gpu</span><span class="token operator">=</span><span class="token number">2</span>, <span class="token comment">#按照需要进行修改</span>
    <span class="token assign-left variable">workers_per_gpu</span><span class="token operator">=</span><span class="token number">2</span>,<span class="token comment">#按照需要进行修改</span>
    <span class="token assign-left variable">train</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'trainval/annfiles/'</span>,
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'trainval/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>train_pipeline<span class="token punctuation">)</span>,
    <span class="token assign-left variable">val</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'trainval/annfiles/'</span>,
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'trainval/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>test_pipeline<span class="token punctuation">)</span>,
    <span class="token assign-left variable">test</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span>dataset_type,
        <span class="token assign-left variable">ann_file</span><span class="token operator">=</span>data_root + <span class="token string">'test/images/'</span>,
        <span class="token assign-left variable">img_prefix</span><span class="token operator">=</span>data_root + <span class="token string">'test/images/'</span>,
        <span class="token assign-left variable">pipeline</span><span class="token operator">=</span>test_pipeline<span class="token punctuation">))</span>
</code></pre> 
<h4><a id="4epochesconfigs_base_schedules_521"></a>4、修改训练epoches(configs_base_\schedules)</h4> 
<pre><code class="prism language-bash"><span class="token comment"># evaluation</span>
evaluation <span class="token operator">=</span> dict<span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">12</span>, <span class="token assign-left variable">metric</span><span class="token operator">=</span><span class="token string">'mAP'</span><span class="token punctuation">)</span><span class="token comment">#12 epoch对模型进行一次评估</span>
<span class="token comment"># optimizer</span>
optimizer <span class="token operator">=</span> dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'SGD'</span>, <span class="token assign-left variable">lr</span><span class="token operator">=</span><span class="token number">0.0025</span>, <span class="token assign-left variable">momentum</span><span class="token operator">=</span><span class="token number">0.9</span>, <span class="token assign-left variable">weight_decay</span><span class="token operator">=</span><span class="token number">0.0001</span><span class="token punctuation">)</span>
optimizer_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>grad_clip<span class="token operator">=</span>dict<span class="token punctuation">(</span>max_norm<span class="token operator">=</span><span class="token number">35</span>, <span class="token assign-left variable">norm_type</span><span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">))</span>
<span class="token comment"># learning policy</span>
lr_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">policy</span><span class="token operator">=</span><span class="token string">'step'</span>,
    <span class="token assign-left variable">warmup</span><span class="token operator">=</span><span class="token string">'linear'</span>,
    <span class="token assign-left variable">warmup_iters</span><span class="token operator">=</span><span class="token number">500</span>,
    <span class="token assign-left variable">warmup_ratio</span><span class="token operator">=</span><span class="token number">1.0</span> / <span class="token number">3</span>,
    <span class="token assign-left variable">step</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">8</span>, <span class="token number">11</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
runner <span class="token operator">=</span> dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'EpochBasedRunner'</span>, <span class="token assign-left variable">max_epochs</span><span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token comment">#模型训练的最大epoch</span>
checkpoint_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>interval<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token comment">#12epoch保存一个checkpoint</span>
</code></pre> 
<h4><a id="5load_from_configs_base_default_runtimepy_538"></a>5、修改模型训练的日志打印和load from 加载与训练模型（configs_base_/default_runtime.py）</h4> 
<p>log_config封装了多个记录器挂钩，并允许设置间隔。现在MMCV支持WandbLoggerHook, MlflowLoggerHook和TensorboardLoggerHook。详细用法可以在文档中找到。</p> 
<pre><code class="prism language-bash">log_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">interval</span><span class="token operator">=</span><span class="token number">50</span>,
    <span class="token assign-left variable">hooks</span><span class="token operator">=</span><span class="token punctuation">[</span>
        dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'TextLoggerHook'</span><span class="token punctuation">)</span>,
        dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'TensorboardLoggerHook'</span><span class="token punctuation">)</span><span class="token comment">#启动tensorboard</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># yapf:disable</span>
log_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">interval</span><span class="token operator">=</span><span class="token number">50</span>,
    <span class="token assign-left variable">hooks</span><span class="token operator">=</span><span class="token punctuation">[</span>
        dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'TextLoggerHook'</span><span class="token punctuation">)</span>,
        dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'TensorboardLoggerHook'</span><span class="token punctuation">)</span><span class="token comment">#启动tensorboard</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># yapf:enable</span>

dist_params <span class="token operator">=</span> dict<span class="token punctuation">(</span>backend<span class="token operator">=</span><span class="token string">'nccl'</span><span class="token punctuation">)</span>
log_level <span class="token operator">=</span> <span class="token string">'INFO'</span>
load_from <span class="token operator">=</span> None   <span class="token comment">#可以放预训练模型</span>
resume_from <span class="token operator">=</span> None
workflow <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'train'</span>, <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

<span class="token comment"># disable opencv multithreading to avoid system being overloaded</span>
opencv_num_threads <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment"># set multi-process start method as `fork` to speed up the training</span>
mp_start_method <span class="token operator">=</span> <span class="token string">'fork'</span>
</code></pre> 
<h4><a id="6mmrotatedatasetsdotapy_572"></a>6、修改数据集的类别名称（mmrotate\datasets\dota.py）</h4> 
<pre><code class="prism language-bash">@ROTATED_DATASETS.register_module<span class="token punctuation">(</span><span class="token punctuation">)</span>
class DOTADataset<span class="token punctuation">(</span>CustomDataset<span class="token punctuation">)</span>:
    <span class="token string">""</span>"DOTA dataset <span class="token keyword">for</span> detection.

    Args:
        ann_file <span class="token punctuation">(</span>str<span class="token punctuation">)</span>: Annotation <span class="token function">file</span> path.
        pipeline <span class="token punctuation">(</span>list<span class="token punctuation">[</span>dict<span class="token punctuation">]</span><span class="token punctuation">)</span>: Processing pipeline.
        version <span class="token punctuation">(</span>str, optional<span class="token punctuation">)</span>: Angle representations. Defaults to <span class="token string">'oc'</span><span class="token builtin class-name">.</span>
        difficulty <span class="token punctuation">(</span>bool, optional<span class="token punctuation">)</span>: The difficulty threshold of GT.
    <span class="token string">""</span>"
    CLASSES <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">'plane'</span>, <span class="token string">'baseball-diamond'</span>, <span class="token string">'bridge'</span>, <span class="token string">'ground-track-field'</span>,
               <span class="token string">'small-vehicle'</span>, <span class="token string">'large-vehicle'</span>, <span class="token string">'ship'</span>, <span class="token string">'tennis-court'</span>,
               <span class="token string">'basketball-court'</span>, <span class="token string">'storage-tank'</span>, <span class="token string">'soccer-ball-field'</span>,
               <span class="token string">'roundabout'</span>, <span class="token string">'harbor'</span>, <span class="token string">'swimming-pool'</span>, <span class="token string">'helicopter'</span><span class="token punctuation">)</span><span class="token comment">#此处根据自己的数据集进行修改</span>

    PALETTE <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">165</span>, <span class="token number">42</span>, <span class="token number">42</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">189</span>, <span class="token number">183</span>, <span class="token number">107</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">255</span>, <span class="token number">0</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">0</span>, <span class="token number">0</span><span class="token punctuation">)</span>,
               <span class="token punctuation">(</span><span class="token number">138</span>, <span class="token number">43</span>, <span class="token number">226</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">128</span>, <span class="token number">0</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">0</span>, <span class="token number">255</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">255</span>, <span class="token number">255</span><span class="token punctuation">)</span>,
               <span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">193</span>, <span class="token number">193</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">51</span>, <span class="token number">153</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">250</span>, <span class="token number">205</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">139</span>, <span class="token number">139</span><span class="token punctuation">)</span>,
               <span class="token punctuation">(</span><span class="token number">255</span>, <span class="token number">255</span>, <span class="token number">0</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">147</span>, <span class="token number">116</span>, <span class="token number">116</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">0</span>, <span class="token number">0</span>, <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> 
<h4><a id="7mmrotatemmrotatedatasetsdotapy_595"></a>7、修改图像数据集的后缀（修改mmrotate/mmrotate/datasets/dota.py）</h4> 
<p><img src="https://images2.imgbox.com/74/0a/Sk361S8A_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/18/33/ZAFuIxci_o.png" alt="在这里插入图片描述"><br> 数据集准备好之后，接下来，需要修改训练相关的配置信息：主要就是 tools/tain.py 中的相关参数修改，train.py文件如下：</p> 
<pre><code class="prism language-bash">两个主要的参数： - -config: 使用的模型文件 （我使用的是 faster rcnn<span class="token punctuation">)</span> ； - -work-dir：训练得到的模型及配置信息保存的路径
</code></pre> 
<p>由于使用的模型是：rotated_faster_rcnn_r50_fpn_x1_dota_le90.py，在该文件中实现了：训练相关参数的配置，数据集信息的配置，以及faster-rcnn网络架构的搭建；打开该文件修改其中的目标类别数为自己数据集的类别数，我的类别为1， 所以修改：num_classes = 1,<br> <img src="https://images2.imgbox.com/0e/bd/x8vjjfUp_o.png" alt="在这里插入图片描述"><br> 同时，修改 mmrotate-main/mmrotate/datasets/dota.py 文件中的类别名字（CLASSES）， 具体如下<br> <img src="https://images2.imgbox.com/70/3b/wwNraOXR_o.png" alt="在这里插入图片描述"><br> 最后，修改训练使用的数据集路径：找到并打开 mmrotate-main/configs/base/datasets/dotav1.py 文件，修改其中的 data_root 路径为自己裁剪的数据集路径，该路径包含了上述划分的train、test、val、trainval数据集<br> <img src="https://images2.imgbox.com/32/dc/ikAAyf61_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="8backbone_610"></a>8、修改模型的骨架网络backbone</h4> 
<h5><a id="1backboner50r101_611"></a>1、将backbone由r50变为r101</h5> 
<p><img src="https://images2.imgbox.com/0c/26/CFHicfO7_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="2bacoboner50r101_613"></a>2、将bacobone由r50变为r101</h5> 
<p><img src="https://images2.imgbox.com/cd/d9/Kn3MRlju_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/7e/a8/frAtsogR_o.png" alt="在这里插入图片描述"><br> 将用新密钥_delete_=True替换字段中的所有旧密钥backbone。</p> 
<pre><code class="prism language-bash">_base_ <span class="token operator">=</span> <span class="token string">'../mask_rcnn/mask_rcnn_r50_fpn_1x_coco.py'</span>
model <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">pretrained</span><span class="token operator">=</span><span class="token string">'open-mmlab://msra/hrnetv2_w32'</span>,
    <span class="token assign-left variable">backbone</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">_delete_</span><span class="token operator">=</span>True,
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'HRNet'</span>,
        <span class="token assign-left variable">extra</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
            <span class="token assign-left variable">stage1</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">num_modules</span><span class="token operator">=</span><span class="token number">1</span>,
                <span class="token assign-left variable">num_branches</span><span class="token operator">=</span><span class="token number">1</span>,
                <span class="token assign-left variable">block</span><span class="token operator">=</span><span class="token string">'BOTTLENECK'</span>,
                <span class="token assign-left variable">num_blocks</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span>, <span class="token punctuation">)</span>,
                <span class="token assign-left variable">num_channels</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">64</span>, <span class="token punctuation">))</span>,
            <span class="token assign-left variable">stage2</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">num_modules</span><span class="token operator">=</span><span class="token number">1</span>,
                <span class="token assign-left variable">num_branches</span><span class="token operator">=</span><span class="token number">2</span>,
                <span class="token assign-left variable">block</span><span class="token operator">=</span><span class="token string">'BASIC'</span>,
                <span class="token assign-left variable">num_blocks</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span>, <span class="token number">4</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">num_channels</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">32</span>, <span class="token number">64</span><span class="token punctuation">))</span>,
            <span class="token assign-left variable">stage3</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">num_modules</span><span class="token operator">=</span><span class="token number">4</span>,
                <span class="token assign-left variable">num_branches</span><span class="token operator">=</span><span class="token number">3</span>,
                <span class="token assign-left variable">block</span><span class="token operator">=</span><span class="token string">'BASIC'</span>,
                <span class="token assign-left variable">num_blocks</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span>, <span class="token number">4</span>, <span class="token number">4</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">num_channels</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">32</span>, <span class="token number">64</span>, <span class="token number">128</span><span class="token punctuation">))</span>,
            <span class="token assign-left variable">stage4</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>
                <span class="token assign-left variable">num_modules</span><span class="token operator">=</span><span class="token number">3</span>,
                <span class="token assign-left variable">num_branches</span><span class="token operator">=</span><span class="token number">4</span>,
                <span class="token assign-left variable">block</span><span class="token operator">=</span><span class="token string">'BASIC'</span>,
                <span class="token assign-left variable">num_blocks</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">4</span>, <span class="token number">4</span>, <span class="token number">4</span>, <span class="token number">4</span><span class="token punctuation">)</span>,
                <span class="token assign-left variable">num_channels</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">32</span>, <span class="token number">64</span>, <span class="token number">128</span>, <span class="token number">256</span><span class="token punctuation">))</span><span class="token punctuation">))</span>,
    <span class="token assign-left variable">neck</span><span class="token operator">=</span>dict<span class="token punctuation">(</span><span class="token punctuation">..</span>.<span class="token punctuation">))</span>
</code></pre> 
<h4><a id="9_Mask_RCNN_652"></a>9、使用多尺度策略来训练 Mask R-CNN</h4> 
<p>配置文件中使用了一些中间变量，例如数据集中的train_pipeline/ test_pipeline。需要注意的是，修改子配置中的中间变量时，用户需要将中间变量重新传入相应的字段。例如，我们想使用多尺度策略来训练 Mask R-CNN。train_pipeline/test_pipeline是我们要修改的中间变量。</p> 
<pre><code class="prism language-bash">_base_ <span class="token operator">=</span> <span class="token string">'./mask_rcnn_r50_fpn_1x_coco.py'</span>
img_norm_cfg <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">mean</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">123.675</span>, <span class="token number">116.28</span>, <span class="token number">103.53</span><span class="token punctuation">]</span>, <span class="token assign-left variable">std</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">58.395</span>, <span class="token number">57.12</span>, <span class="token number">57.375</span><span class="token punctuation">]</span>, <span class="token assign-left variable">to_rgb</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
train_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadAnnotations'</span>, <span class="token assign-left variable">with_bbox</span><span class="token operator">=</span>True, <span class="token assign-left variable">with_mask</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'Resize'</span>,
        <span class="token assign-left variable">img_scale</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token number">1333</span>, <span class="token number">640</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">1333</span>, <span class="token number">672</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">1333</span>, <span class="token number">704</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">1333</span>, <span class="token number">736</span><span class="token punctuation">)</span>,
                   <span class="token punctuation">(</span><span class="token number">1333</span>, <span class="token number">768</span><span class="token punctuation">)</span>, <span class="token punctuation">(</span><span class="token number">1333</span>, <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">]</span>,
        <span class="token assign-left variable">multiscale_mode</span><span class="token operator">=</span><span class="token string">"value"</span>,
        <span class="token assign-left variable">keep_ratio</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RandomFlip'</span>, <span class="token assign-left variable">flip_ratio</span><span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Normalize'</span>, **img_norm_cfg<span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span>, <span class="token assign-left variable">size_divisor</span><span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'DefaultFormatBundle'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span>, <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span>, <span class="token string">'gt_bboxes'</span>, <span class="token string">'gt_labels'</span>, <span class="token string">'gt_masks'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
<span class="token punctuation">]</span>
test_pipeline <span class="token operator">=</span> <span class="token punctuation">[</span>
    dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'LoadImageFromFile'</span><span class="token punctuation">)</span>,
    dict<span class="token punctuation">(</span>
        <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">'MultiScaleFlipAug'</span>,
        <span class="token assign-left variable">img_scale</span><span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1333</span>, <span class="token number">800</span><span class="token punctuation">)</span>,
        <span class="token assign-left variable">flip</span><span class="token operator">=</span>False,
        <span class="token assign-left variable">transforms</span><span class="token operator">=</span><span class="token punctuation">[</span>
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Resize'</span>, <span class="token assign-left variable">keep_ratio</span><span class="token operator">=</span>True<span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'RandomFlip'</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Normalize'</span>, **img_norm_cfg<span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Pad'</span>, <span class="token assign-left variable">size_divisor</span><span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'ImageToTensor'</span>, <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
            dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'Collect'</span>, <span class="token assign-left variable">keys</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>,
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
data <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">train</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>pipeline<span class="token operator">=</span>train_pipeline<span class="token punctuation">)</span>,
    <span class="token assign-left variable">val</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>pipeline<span class="token operator">=</span>test_pipeline<span class="token punctuation">)</span>,
    <span class="token assign-left variable">test</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>pipeline<span class="token operator">=</span>test_pipeline<span class="token punctuation">))</span>
</code></pre> 
<h4><a id="10_694"></a>10、修改归一化层</h4> 
<p>Similarly, if we would like to switch from SyncBN to BN or MMSyncBN, we need to substitute every norm_cfg in the config.</p> 
<pre><code class="prism language-bash">_base_ <span class="token operator">=</span> <span class="token string">'./mask_rcnn_r50_fpn_1x_coco.py'</span>
norm_cfg <span class="token operator">=</span> dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'BN'</span>, <span class="token assign-left variable">requires_grad</span><span class="token operator">=</span>True<span class="token punctuation">)</span>
model <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">backbone</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>norm_cfg<span class="token operator">=</span>norm_cfg<span class="token punctuation">)</span>,
    <span class="token assign-left variable">neck</span><span class="token operator">=</span>dict<span class="token punctuation">(</span>norm_cfg<span class="token operator">=</span>norm_cfg<span class="token punctuation">)</span>,
    <span class="token punctuation">..</span>.<span class="token punctuation">)</span>
</code></pre> 
<h3><a id="5_705"></a>5、模型训练</h3> 
<h4><a id="1Train_with_a_single_GPU_706"></a>1、Train with a single GPU</h4> 
<pre><code class="prism language-bash">python tools/train.py <span class="token variable">${CONFIG_FILE}</span> <span class="token punctuation">[</span>optional arguments<span class="token punctuation">]</span>
</code></pre> 
<p>如果你想在命令中指定工作目录，你可以添加一个参数–work_dir $[YOUR_WORK_DIR]。</p> 
<h4><a id="2Train_with_multiple_GPUs_713"></a>2、Train with multiple GPUs</h4> 
<pre><code class="prism language-bash">./tools/dist_train.sh <span class="token variable">${CONFIG_FILE}</span> <span class="token variable">${GPU_NUM}</span> <span class="token punctuation">[</span>optional arguments<span class="token punctuation">]</span>
</code></pre> 
<blockquote> 
 <p>Optional arguments are:<br> –no-validate (not suggested): By default, the codebase will perform evaluation during the training. To disable this behavior, use --no-validate.<br> –work-dir ${WORK_DIR}: Override the working directory specified in the config file.<br> –resume-from ${CHECKPOINT_FILE}: Resume from a previous checkpoint file.<br> Difference between resume-from and load-from: resume-from loads both the model weights and optimizer status, and the epoch is also inherited from the specified checkpoint. It is usually used for resuming the training process that is interrupted accidentally. load-from only loads the model weights and the training epoch starts from 0. It is usually used for finetuning.</p> 
</blockquote> 
<h4><a id="3Train_with_multiple_machines_725"></a>3、Train with multiple machines</h4> 
<p>•如果你启动了多台连接以太网的机器，你可以简单地运行以下命令:<br> On the first machine:</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">NNODES</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">NODE_RANK</span><span class="token operator">=</span><span class="token number">0</span> <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable">$MASTER_PORT</span> <span class="token assign-left variable">MASTER_ADDR</span><span class="token operator">=</span><span class="token variable">$MASTER_ADDR</span> <span class="token function">sh</span> tools/dist_train.sh <span class="token variable">$CONFIG</span> <span class="token variable">$GPUS</span>
</code></pre> 
<p>On the second machine:</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">NNODES</span><span class="token operator">=</span><span class="token number">2</span> <span class="token assign-left variable">NODE_RANK</span><span class="token operator">=</span><span class="token number">1</span> <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token variable">$MASTER_PORT</span> <span class="token assign-left variable">MASTER_ADDR</span><span class="token operator">=</span><span class="token variable">$MASTER_ADDR</span> <span class="token function">sh</span> tools/dist_train.sh <span class="token variable">$CONFIG</span> <span class="token variable">$GPUS</span>
</code></pre> 
<p>如果你没有像InfiniBand这样的高速网络，通常会很慢。</p> 
<h4><a id="4Manage_jobs_with_Slurm_738"></a>4、Manage jobs with Slurm</h4> 
<p>如果在由slurm管理的集群上运行MMRotate，可以使用脚本slurm_train.sh。(此脚本也支持单机训练。)</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>GPUS<span class="token operator">=</span><span class="token variable">${GPUS}</span><span class="token punctuation">]</span> ./tools/slurm_train.sh <span class="token variable">${PARTITION}</span> <span class="token variable">${JOB_NAME}</span> <span class="token variable">${CONFIG_FILE}</span> <span class="token variable">${WORK_DIR}</span>
</code></pre> 
<p>如果您有多台机器与以太网连接，您可以参考PyTorch启动实用程序<a href="https://pytorch.org/docs/stable/distributed_deprecated.html#launch-utility" rel="nofollow">添加链接描述</a>。如果你没有像InfiniBand这样的高速网络，通常会很慢</p> 
<h4><a id="5_745"></a>5、在一台机器上启动多个作业</h4> 
<p>如果您在一台机器上启动多个作业，例如，在一台有8个gpu的机器上启动2个4-GPU训练的作业，您需要为每个作业指定不同的端口(默认为29500)，以避免通信冲突。<br> If you use dist_train.sh to launch training jobs, you can set the port in commands.</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">0,1</span>,2,3 <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">29500</span> ./tools/dist_train.sh <span class="token variable">${CONFIG_FILE}</span> <span class="token number">4</span>
<span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">4,5</span>,6,7 <span class="token assign-left variable">PORT</span><span class="token operator">=</span><span class="token number">29501</span> ./tools/dist_train.sh <span class="token variable">${CONFIG_FILE}</span> <span class="token number">4</span>
</code></pre> 
<p>如果使用Slurm启动培训作业，则需要修改配置文件(通常是配置文件中倒数第6行)以设置不同的通信端口。<br> In config1.py,</p> 
<p>dist_params = dict(backend=‘nccl’, port=29500)<br> In config2.py,</p> 
<p>dist_params = dict(backend=‘nccl’, port=29501)<br> Then you can launch two jobs with config1.py and config2.py.</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">0,1</span>,2,3 <span class="token assign-left variable">GPUS</span><span class="token operator">=</span><span class="token number">4</span> ./tools/slurm_train.sh <span class="token variable">${PARTITION}</span> <span class="token variable">${JOB_NAME}</span> config1.py <span class="token variable">${WORK_DIR}</span>
<span class="token assign-left variable">CUDA_VISIBLE_DEVICES</span><span class="token operator">=</span><span class="token number">4,5</span>,6,7 <span class="token assign-left variable">GPUS</span><span class="token operator">=</span><span class="token number">4</span> ./tools/slurm_train.sh <span class="token variable">${PARTITION}</span> <span class="token variable">${JOB_NAME}</span> config2.py <span class="token variable">${WORK_DIR}</span>
</code></pre> 
<h4><a id="6_766"></a>6、开始启动模型训练</h4> 
<pre><code class="prism language-bash">python tools/train.py  configs/redet/redet_re50_refpn_1x_dota_le90.py --work-dir  work_dirs/runs/redet/
</code></pre> 
<p><img src="https://images2.imgbox.com/6e/eb/rg9DDurU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/79/5b/tLUjEXj1_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="6tensorboad_773"></a>6、启动tensorboad查看模型训练</h3> 
<p>如果有在default_runtime中解除注释tensorboard，键入下面的命令可以开启实时更新的tensorboard可视化模块。</p> 
<pre><code class="prism language-bash">在config文件修改如下

log_config <span class="token operator">=</span> dict<span class="token punctuation">(</span>
    <span class="token assign-left variable">interval</span><span class="token operator">=</span><span class="token number">50</span>,
    <span class="token assign-left variable">hooks</span><span class="token operator">=</span><span class="token punctuation">[</span>
        dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'TextLoggerHook'</span><span class="token punctuation">)</span>,
        dict<span class="token punctuation">(</span>type<span class="token operator">=</span><span class="token string">'TensorboardLoggerHook'</span><span class="token punctuation">)</span> <span class="token comment">#生成Tensorboard 日志</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>


设置之后，会在work_dir目录下生成一个tf_logs目录,使用Tensorboard打开日志

    <span class="token builtin class-name">cd</span> /path/to/tf_logs
    tensorboard --logdir <span class="token builtin class-name">.</span> --host 服务器IP地址 --port <span class="token number">6006</span>

tensorboard --logdir work_dirs/runs/redet/tf_logs/  --host <span class="token number">10.1</span>.42.60
tensorboard 默认端口号是6006，在浏览器中输入http://:6006即可打开tensorboard界面
</code></pre> 
<p><img src="https://images2.imgbox.com/d9/62/Oir9N7zh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="7_796"></a>7、测试模型</h3> 
<p>single GPU</p> 
<p>single node multiple GPU</p> 
<p>multiple node</p> 
<p>可以使用以下命令推断数据集。</p> 
<pre><code class="prism language-bash"><span class="token comment"># single-gpu</span>
python tools/test.py <span class="token variable">${CONFIG_FILE}</span> <span class="token variable">${CHECKPOINT_FILE}</span> <span class="token punctuation">[</span>optional arguments<span class="token punctuation">]</span>

<span class="token comment"># multi-gpu</span>
./tools/dist_test.sh <span class="token variable">${CONFIG_FILE}</span> <span class="token variable">${CHECKPOINT_FILE}</span> <span class="token variable">${GPU_NUM}</span> <span class="token punctuation">[</span>optional arguments<span class="token punctuation">]</span>

<span class="token comment"># multi-node in slurm environment</span>
python tools/test.py <span class="token variable">${CONFIG_FILE}</span> <span class="token variable">${CHECKPOINT_FILE}</span> <span class="token punctuation">[</span>optional arguments<span class="token punctuation">]</span> --launcher slurm
</code></pre> 
<h4><a id="Examples_815"></a>Examples:</h4> 
<p>•在DOTA-1.0数据集上推断RotatedRetinaNet，它可以生成在线提交的压缩文件。</p> 
<pre><code class="prism language-bash">python ./tools/test.py  <span class="token punctuation">\</span>
  configs/rotated_retinanet/rotated_retinanet_obb_r50_fpn_1x_dota_le90.py <span class="token punctuation">\</span>
  checkpoints/SOME_CHECKPOINT.pth --format-only <span class="token punctuation">\</span>
  --eval-options <span class="token assign-left variable">submission_dir</span><span class="token operator">=</span>work_dirs/Task1_results

./tools/dist_test.sh  <span class="token punctuation">\</span>
  configs/rotated_retinanet/rotated_retinanet_obb_r50_fpn_1x_dota_le90.py <span class="token punctuation">\</span>
  checkpoints/SOME_CHECKPOINT.pth <span class="token number">1</span> --format-only <span class="token punctuation">\</span>
  --eval-options <span class="token assign-left variable">submission_dir</span><span class="token operator">=</span>work_dirs/Task1_results
</code></pre> 
<p>You can change the test set path in the data_root to the val set or trainval set for the offline evaluation.</p> 
<pre><code class="prism language-bash">python ./tools/test.py <span class="token punctuation">\</span>
  configs/rotated_retinanet/rotated_retinanet_obb_r50_fpn_1x_dota_le90.py <span class="token punctuation">\</span>
  checkpoints/SOME_CHECKPOINT.pth --eval mAP
  
  或者
  
./tools/dist_test.sh  <span class="token punctuation">\</span>
  configs/rotated_retinanet/rotated_retinanet_obb_r50_fpn_1x_dota_le90.py <span class="token punctuation">\</span>
  checkpoints/SOME_CHECKPOINT.pth <span class="token number">1</span> --eval mAP
</code></pre> 
<p>You can also visualize the results.</p> 
<pre><code class="prism language-bash">python ./tools/test.py <span class="token punctuation">\</span>
  configs/rotated_retinanet/rotated_retinanet_obb_r50_fpn_1x_dota_le90.py <span class="token punctuation">\</span>
  checkpoints/SOME_CHECKPOINT.pth <span class="token punctuation">\</span>
  --show-dir work_dirs/vis
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/edf51d1a691aaa56634287f71b1eac11/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">如何用Taro打造敏捷的移动App架构</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d2b0dcdfb419cd4e134900921d433286/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言-数组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>