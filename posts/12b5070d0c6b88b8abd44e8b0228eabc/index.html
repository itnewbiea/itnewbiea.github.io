<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>mysql sharding proxy,sharding-proxy之操作 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="mysql sharding proxy,sharding-proxy之操作" />
<meta property="og:description" content="单库单表
第一步：修改conf/server.yaml
第二步：修改conf/config-sharding.yaml
解释：：
actualDataNodes: ds_${0}.t_order_${0..1}：会在demo_ds_0这个数据库中创建二张表：t_order_0和t_order_1。
algorithmExpression: t_order_${order_id % 2}：分表，主要是把添加的数据放入到哪张表中。这里采用取模的方式进行分表。在这里要 注意一下 ： order_id必须是整数，不能是字符串，如果是字符串的数字的话，可以通过如下进行转换：Integer.parseInt(order_id)
algorithmExpression: ds_${0} ： 分库，因为这里是单库，所以这里不采用任何的方式进行分库。
第三步：启动sharding-proxy
windows系统下运行：bin/start.bat
linux系统执行：bin/start.sh
默认的端口是：3307
第四步：创建相应的表
sharding-proxy启动成功之后，进行cmd命令行界面,输入如下信息：
然后就是输入你在配置conf/server.yaml文件中的users中的root里的password密码了。
然后使用：show databases; 查看当前有什么逻辑库。
上图的逻辑库是：conf/server.yaml中的authorizedSchemas所对应的test。
然后再执行：use test;
你可以执行：show tables;查看当前库有没有表。
下面创建对应的表：
上面的表结构字段比较少，你可以根据自己的需求来进行添加。
最后一步：测试
往刚刚创建的表添加一些测试数据：
上面的数据会放入到t_order_0表还是t_order_1表呢？
在配置conf/config-sharding.yaml文件时，里面的分表结构是这样的：algorithmExpression: t_order_${order_id % 2}，可以看出是通过添加数据的order_id取模 2 进行划分表的。那这样的话，上面添加的数据可以得出：order_id = 1 取模 2 之后是 1 ，所以上面添加的数据是放入到了t_order_1这张表中。
再来一次试一下：
这条order_id 取模 2 之后是 0，所以该数据放在t_order_0这张表中。
单库单表扩展
上面采用分表是分成两张表，假设我们有100万的数据量，如果你采用的mysql数据库的话，当数据表中数据量越大了，会影响到你查询出来的语句很慢。而我们上述分成了两张表，100万的数据量，每张表分得50万的数据。这样子总比一张表好是吧。
那怎么样分成更多的表呢？
分成十张表
分成十张表的规则就是：
修改conf/config-sharding.yaml:
这里主要是使用order_id的尾数进行划分表。
我目前能想到的就是十张表，你如果能使用单库划分十张以上的表的话，可以跟我说一下，谢谢。
多库单表
第一步：修改conf/server.yaml
第二步：修改conf/config-sharding.yaml
自行在3306端口的mysql中创建好demo_ds_0和demo_ds_1两个数据库。
第三步：启动sharding-proxy" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/12b5070d0c6b88b8abd44e8b0228eabc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-17T06:04:11+08:00" />
<meta property="article:modified_time" content="2021-03-17T06:04:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">mysql sharding proxy,sharding-proxy之操作</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>单库单表</p> 
 <p>第一步：修改conf/server.yaml</p> 
 <p>第二步：修改conf/config-sharding.yaml</p> 
 <p>解释：：</p> 
 <p>actualDataNodes: ds_${0}.t_order_${0..1}：会在demo_ds_0这个数据库中创建二张表：t_order_0和t_order_1。</p> 
 <p>algorithmExpression: t_order_${order_id % 2}：分表，主要是把添加的数据放入到哪张表中。这里采用取模的方式进行分表。在这里要 注意一下 ： order_id必须是整数，不能是字符串，如果是字符串的数字的话，可以通过如下进行转换：Integer.parseInt(order_id)</p> 
 <p>algorithmExpression: ds_${0} ： 分库，因为这里是单库，所以这里不采用任何的方式进行分库。</p> 
 <p>第三步：启动sharding-proxy</p> 
 <p>windows系统下运行：bin/start.bat</p> 
 <p>linux系统执行：bin/start.sh</p> 
 <p>默认的端口是：3307</p> 
 <p>第四步：创建相应的表</p> 
 <p>sharding-proxy启动成功之后，进行cmd命令行界面,输入如下信息：</p> 
 <p>然后就是输入你在配置conf/server.yaml文件中的users中的root里的password密码了。</p> 
 <p>然后使用：show databases; 查看当前有什么逻辑库。</p> 
 <p align="center"><img src="https://images2.imgbox.com/54/2c/w292gA8L_o.png" alt="62d1e2c2b756a4bfc5480a2845ca1f09.png"></p> 
 <p>上图的逻辑库是：conf/server.yaml中的authorizedSchemas所对应的test。</p> 
 <p>然后再执行：use test;</p> 
 <p>你可以执行：show tables;查看当前库有没有表。</p> 
 <p>下面创建对应的表：</p> 
 <p>上面的表结构字段比较少，你可以根据自己的需求来进行添加。</p> 
 <p>最后一步：测试</p> 
 <p>往刚刚创建的表添加一些测试数据：</p> 
 <p>上面的数据会放入到t_order_0表还是t_order_1表呢？</p> 
 <p>在配置conf/config-sharding.yaml文件时，里面的分表结构是这样的：algorithmExpression: t_order_${order_id % 2}，可以看出是通过添加数据的order_id取模 2 进行划分表的。那这样的话，上面添加的数据可以得出：order_id = 1 取模 2 之后是 1 ，所以上面添加的数据是放入到了t_order_1这张表中。</p> 
 <p>再来一次试一下：</p> 
 <p>这条order_id 取模 2 之后是 0，所以该数据放在t_order_0这张表中。</p> 
 <p>单库单表扩展</p> 
 <p>上面采用分表是分成两张表，假设我们有100万的数据量，如果你采用的mysql数据库的话，当数据表中数据量越大了，会影响到你查询出来的语句很慢。而我们上述分成了两张表，100万的数据量，每张表分得50万的数据。这样子总比一张表好是吧。</p> 
 <p>那怎么样分成更多的表呢？</p> 
 <p>分成十张表</p> 
 <p>分成十张表的规则就是：</p> 
 <p>修改conf/config-sharding.yaml:</p> 
 <p>这里主要是使用order_id的尾数进行划分表。</p> 
 <p>我目前能想到的就是十张表，你如果能使用单库划分十张以上的表的话，可以跟我说一下，谢谢。</p> 
 <p>多库单表</p> 
 <p>第一步：修改conf/server.yaml</p> 
 <p>第二步：修改conf/config-sharding.yaml</p> 
 <p>自行在3306端口的mysql中创建好demo_ds_0和demo_ds_1两个数据库。</p> 
 <p>第三步：启动sharding-proxy</p> 
 <p>windows系统下运行：bin/start.bat</p> 
 <p>linux系统执行：bin/start.sh</p> 
 <p>默认的端口是：3307</p> 
 <p>第四步：创建相应的表</p> 
 <p>sharding-proxy启动成功之后，进行cmd命令行界面,输入如下信息：</p> 
 <p>然后就是输入你在配置conf/server.yaml文件中的users中的root里的password密码了。</p> 
 <p>然后使用：show databases; 查看当前有什么逻辑库。</p> 
 <p align="center"><img src="https://images2.imgbox.com/e2/42/SnWsEYfV_o.png" alt="9633bfb89d4a25446ca798dc1f10781e.png"></p> 
 <p>上图的逻辑库是：conf/server.yaml中的authorizedSchemas所对应的test。</p> 
 <p>然后再执行：use test;</p> 
 <p>你可以执行：show tables;查看当前库有没有表。</p> 
 <p>下面创建对应的表：</p> 
 <p>上面的表结构字段比较少，你可以根据自己的需求来进行添加。</p> 
 <p>最后一步：测试</p> 
 <p>往刚刚创建的表添加一些测试数据：</p> 
 <p>该数据存放在：demo_ds_1数据库中的tasklist_2数据表中。</p> 
 <p>介绍</p> 
 <p>上面的多库多表：双库双表，每个库中划分十张表。首先是根据sucaiid划分库，然后再根据id划分表。表的数据结构是一样的</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bf4770b0c266d836c7dcf2cfb138cfdb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">用matlab解决马尔可夫模型,MatLa工具箱b 马尔可夫模型的MatLab程序</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9f6af7f29867a110124a44c0bb132ab3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何用matlab进行脑电信号处理,基于matlab的脑电信号处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>