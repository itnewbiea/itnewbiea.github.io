<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Git项目自动更新Git版本信息 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Git项目自动更新Git版本信息" />
<meta property="og:description" content="我们的目标是，从git仓库pull之后，在生成项目时可以自动更新git版本信息。但是目前存在尚未解决的问题，在push项目之后仓库中保存的git版本信息仍然是上一个版本。该问题留作后续研究，问题流程如下图所示：
注意：下面所有文件都必须放在项目目录下，而不能放在解决方案目录下，否则执行sh文件时无法找到version文件（对sh文件不太了解，不知道为什么）
一、version.h文件
定义保存了版本信息的头文件，保存了（1）git版本号（2）最近一次提交时间（3）最近一次编译时间（即当前时间），此处我们定义为：
#ifndef GIT_VERSION #define GIT_VERSION &#34;f384194&#34; #define COMMIT_TIME &#34;2022-01-04 15:58:24&#34; #define BUILD_TIME &#34;2022-01-04 15:59:45&#34; #endif 为了生成该格式的头文件，我们定义模板文件version.h.tmp，通过替换字符完成版本信息的更新
#ifndef GIT_VERSION #define GIT_VERSION &#34;MYVERSION&#34; #define COMMIT_TIME &#34;MYCOMMITTIME&#34; #define BUILD_TIME &#34;MYBUILDTIME&#34; #endif 二、sh文件
创建sh文件，计算三个版本信息，通过sed命令将指定字符替换为计算出的版本信息，VersionUpdate.sh文件内容如下：
#!/bin/sh commit_ts=`git log -1 --format=&#34;%ct&#34;` commit_time=`date -d@$commit_ts &#43;&#34;%Y-%m-%d %H:%M:%S&#34;` current_time=`date &#43;&#34;%Y-%m-%d %H:%M:%S&#34;` git_version=`git log -1 --pretty=format:&#34;%h&#34;` sed s/MYVERSION/&#34;${git_version}&#34;/g version.h.tmp&gt;version.h sed -i s/MYCOMMITTIME/&#34;${commit_time}&#34;/g version.h sed -i s/MYBUILDTIME/&#34;${current_time}&#34;/g version.h 三、VS生成事件
打开 项目属性》》生成事件 可以看到三类事件：生成前事件、链接前事件、生成后事件。我们此处以链接前事件为例。其语法与cmd命令行类似，我们添加命令行&#34;VersionUpdate.sh&#34;。
四、生成项目
点击生成项目，没有显示错误（可以在sh文件中添加echo命令进行测试），查看version.h文件，更新成功，如下：
#ifndef GIT_VERSION #define GIT_VERSION &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ebd1be0d9d0a8302381c9a4184408599/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-06T20:07:29+08:00" />
<meta property="article:modified_time" content="2022-01-06T20:07:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Git项目自动更新Git版本信息</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>我们的目标是，从git仓库pull之后，在生成项目时可以自动更新git版本信息。但是目前存在尚未解决的问题，在push项目之后仓库中保存的git版本信息仍然是上一个版本。该问题留作后续研究，问题流程如下图所示：</p> 
<p><img alt="" height="436" src="https://images2.imgbox.com/f3/7a/pvHd3KYS_o.png" width="439"></p> 
<p><span style="color:#fe2c24;">注意：下面所有文件都必须放在项目目录下，而不能放在解决方案目录下，否则执行sh文件时无法找到version文件（对sh文件不太了解，不知道为什么）</span></p> 
<p>一、version.h文件</p> 
<p>定义保存了版本信息的头文件，保存了（1）git版本号（2）最近一次提交时间（3）最近一次编译时间（即当前时间），此处我们定义为：</p> 
<pre><code class="language-cpp">#ifndef GIT_VERSION
#define GIT_VERSION "f384194"
#define COMMIT_TIME "2022-01-04 15:58:24"
#define BUILD_TIME "2022-01-04 15:59:45"
#endif</code></pre> 
<p>为了生成该格式的头文件，我们定义模板文件version.h.tmp，通过替换字符完成版本信息的更新</p> 
<pre><code class="language-cpp">#ifndef GIT_VERSION
#define GIT_VERSION "MYVERSION"
#define COMMIT_TIME "MYCOMMITTIME"
#define BUILD_TIME "MYBUILDTIME"
#endif</code></pre> 
<p>二、sh文件</p> 
<p>创建sh文件，计算三个版本信息，通过sed命令将指定字符替换为计算出的版本信息，VersionUpdate.sh文件内容如下：</p> 
<pre><code class="language-cpp">#!/bin/sh

commit_ts=`git log -1 --format="%ct"`
commit_time=`date -d@$commit_ts +"%Y-%m-%d %H:%M:%S"`
current_time=`date +"%Y-%m-%d %H:%M:%S"`
git_version=`git log -1 --pretty=format:"%h"`

sed s/MYVERSION/"${git_version}"/g version.h.tmp&gt;version.h
sed -i s/MYCOMMITTIME/"${commit_time}"/g version.h
sed -i s/MYBUILDTIME/"${current_time}"/g version.h</code></pre> 
<p>三、VS生成事件</p> 
<p>打开 项目属性》》生成事件 可以看到三类事件：生成前事件、链接前事件、生成后事件。我们此处以链接前事件为例。其语法与cmd命令行类似，我们添加命令行"VersionUpdate.sh"。</p> 
<p><img alt="" height="370" src="https://images2.imgbox.com/d2/33/d058i5DI_o.png" width="533"></p> 
<p> 四、生成项目</p> 
<p>点击生成项目，没有显示错误（可以在sh文件中添加echo命令进行测试），查看version.h文件，更新成功，如下：</p> 
<pre><code class="language-cpp">#ifndef GIT_VERSION
#define GIT_VERSION "f384194"
#define COMMIT_TIME "2022-01-04 15:58:24"
#define BUILD_TIME "2022-01-06 20:02:51"
#endif</code></pre> 
<p>项目资源链接：</p> 
<p><a href="https://download.csdn.net/download/qq_37394426/74465085" title="Git项目自动更新版本信息-其它文档类资源-CSDN下载">Git项目自动更新版本信息-其它文档类资源-CSDN下载</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ce85ab4f2c7ce7cd501a73fe59e3770/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OCC通过点反求参数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ac0081dae15b810a5af287b618fdae8b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软件研发效能的底层逻辑</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>