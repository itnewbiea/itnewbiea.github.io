<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>js前端获取用户位置及ip属地信息 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="js前端获取用户位置及ip属地信息" />
<meta property="og:description" content="写在前面尝试一：navigator.geolocation尝试二：sohu 的接口尝试三：百度地图的接口写在后面 写在前面 想要像一些平台那样显示用户的位置信息，例如某省市那样。那么这是如何做到的， 据说这个位置信息的准确性在通信网络运营商那里？先不管，先实践尝试下能不能获取。
尝试一：navigator.geolocation 尝试了使用 navigator.geolocation，但未能成功拿到信息。
getGeolocation(){ if (&#39;geolocation&#39; in navigator) { /* 地理位置服务可用 */ console.log(&#39;地理位置服务可用&#39;) navigator.geolocation.getCurrentPosition(function (position) { console.dir(&#39;回调成功&#39;) console.dir(position) // 没有输出 console.dir(position.coords.latitude, position.coords.longitude) }, function (error) { console.error(error) }) } else { /* 地理位置服务不可用 */ console.error(&#39;地理位置服务可用&#39;) } } 尝试二：sohu 的接口 尝试使用 pv.sohu.com/cityjson?ie… 获取用户位置信息， 成功获取到信息，信息样本如下：
{&#34;cip&#34;: &#34;14.11.11.11&#34;, &#34;cid&#34;: &#34;440000&#34;, &#34;cname&#34;: &#34;广东省&#34;}
// 需要做跨域处理 getIpAndAddressSohu(){ // config 是配置对象，可按需设置，例如 responseType，headers 中设置 token 等 const config = { headers: { Accept: &#39;application/json&#39;, &#39;Content-Type&#39;: &#39;application/json;charset=UTF-8&#39;, }, } axios." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/2ff774cd58e54f71eb34852d13065962/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-29T15:30:42+08:00" />
<meta property="article:modified_time" content="2023-06-29T15:30:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">js前端获取用户位置及ip属地信息</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <ul><li><a href="https://www.jb51.net/article/254793.htm#_label0" rel="nofollow" title="写在前面">写在前面</a></li><li><a href="https://www.jb51.net/article/254793.htm#_label1" rel="nofollow" title="尝试一：navigator.geolocation">尝试一：navigator.geolocation</a></li><li><a href="https://www.jb51.net/article/254793.htm#_label2" rel="nofollow" title="尝试二：sohu 的接口">尝试二：sohu 的接口</a></li><li><a href="https://www.jb51.net/article/254793.htm#_label3" rel="nofollow" title="尝试三：百度地图的接口">尝试三：百度地图的接口</a></li><li><a href="https://www.jb51.net/article/254793.htm#_label4" rel="nofollow" title="写在后面">写在后面</a></li></ul> 
<p></p> 
<p><a name="_label0"></a></p> 
<h3 id="heading-0">写在前面</h3> 
<p>想要像一些平台那样显示用户的位置信息，例如某省市那样。那么这是如何做到的， 据说这个位置信息的准确性在通信网络运营商那里？先不管，先实践尝试下能不能获取。</p> 
<p><a name="_label1"></a></p> 
<h3 id="heading-1">尝试一：navigator.geolocation</h3> 
<p>尝试了使用 navigator.geolocation，但未能成功拿到信息。</p> 
<pre><code class="language-javascript">getGeolocation(){
  if ('geolocation' in navigator) {
    /* 地理位置服务可用 */
    console.log('地理位置服务可用')
    navigator.geolocation.getCurrentPosition(function (position) {
      console.dir('回调成功')
      console.dir(position) // 没有输出
      console.dir(position.coords.latitude, position.coords.longitude)
    }, function (error) {
      console.error(error)
    })
  } else {
    /* 地理位置服务不可用 */
    console.error('地理位置服务可用')
  }
}
</code></pre> 
<h3 id="heading-2">尝试二：sohu 的接口</h3> 
<p>尝试使用 <a href="http://pv.sohu.com/cityjson?ie=utf-8" rel="nofollow" title="pv.sohu.com/cityjson?ie…">pv.sohu.com/cityjson?ie…</a> 获取用户位置信息， 成功获取到信息，信息样本如下：</p> 
<p>{"cip": "14.11.11.11", "cid": "440000", "cname": "广东省"}</p> 
<pre><code class="language-javascript">// 需要做跨域处理
getIpAndAddressSohu(){
  // config 是配置对象，可按需设置，例如 responseType，headers 中设置 token 等
  const config = {
    headers: {
      Accept: 'application/json',
      'Content-Type': 'application/json;charset=UTF-8',
    },
  }
  axios.get('/apiSohu/cityjson?ie=utf-8', config).then(res =&gt; {
    console.log(res.data) // var returnCitySN = {"cip": "14.11.11.11", "cid": "440000", "cname": "广东省"};
    const info = res.data.substring(19, res.data.length - 1)
    console.log(info) // {"cip": "14.11.11.11", "cid": "440000", "cname": "广东省"}
    this.ip = JSON.parse(info).cip
    this.address = JSON.parse(info).cname
  })
}
</code></pre> 
<p>调试的时候，做了跨域处理。</p> 
<pre><code class="language-javascript">proxy: {
  '/apiSohu': {
    target: 'http://pv.sohu.com/', // localhost=&gt;target
    changeOrigin: true,
    pathRewrite: {
    '/apiSohu': '/'
    }
  },
}
</code></pre> 
<p>下面是一张获取到位置信息的效果图：</p> 
<p><img alt="" height="155" src="https://images2.imgbox.com/75/a2/AOJf6Xq7_o.png" width="459"></p> 
<p> </p> 
<h3 id="heading-3">尝试三：百度地图的接口</h3> 
<p>成功用户的省市位置，以及经纬度坐标，但会先弹窗征求用户意见。需要先引入百度地图依赖，有一个参数 ak 需要注意，这需要像管理方申请。例如下方这样</p> 
<pre><code class="language-javascript">&lt;script src="https://api.map.baidu.com/api?v=2.0&amp;ak=3ufnnh6aD5CST"&gt;&lt;/script&gt;

getLocation() { /*获取当前位置（浏览器定位）*/
  const $this = this;
  var geolocation = new BMap.Geolocation();//返回用户当前的位置
  geolocation.getCurrentPosition(function (r) {
    if (this.getStatus() == BMAP_STATUS_SUCCESS) {
      $this.city = r.address.city;
      console.log(r.address) // {city: '广州市', city_code: 0, district: '', province: '广东省', street: '', …}
    }
  });
}

function getLocationBaiduIp(){/*获取用户当前位置（ip定位）*/
  function myFun(result){
    const cityName = result.name;
    console.log(result) // {center: O, level: 12, name: '广州市', code: 277}
  }
  var myCity = new BMap.LocalCity();
  myCity.get(myFun);
}

</code></pre> 
<p>成功用户的省市位置，以及经纬度坐标，但会先弹窗征求用户意见。</p> 
<p><img alt="" height="578" src="https://images2.imgbox.com/2a/01/2KQe7Pai_o.png" width="819"></p> 
<h3 id="heading-4">写在后面</h3> 
<p>尝试结果不太理想，sohu 的接口内部是咋实现的，这似乎没有弹起像下面那样的征询用户意见的提示。</p> 
<p><img alt="" height="132" src="https://images2.imgbox.com/4c/eb/jpkx2XX0_o.png" width="343"></p> 
<p></p> 
<p>而在 navigator.geolocation 、 BMap.Geolocation() 和 BMap.LocalCity() 中是弹起了的。</p> 
<p>用别人的接口总归是没多大意思，也不知道不用征求用户意见是咋实现的。</p> 
<p>经实测 sohu 的接口、BMap.Geolocation() 和 BMap.LocalCity() 都可以拿到用户的位置信息（省市、经纬度等）。</p> 
<p>以上就是js前端获取用户位置及ip属地信息的详细内容，更多关于js获取用户位置ip属地的资料请关注脚本之家其它相关文章！</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/925124181d504c2f6ffbd51fc27d7da2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">gin框架：微信公众号-服务器配置（token验证）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6644c852e43ca083306c89f21a395604/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">操作系统4：进程通信类型和通信实现方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>