<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>企业web集群的搭建和应用报告 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="企业web集群的搭建和应用报告" />
<meta property="og:description" content="目 录
一、实训内容和要求
二、 相关知识 1. web应用nginx动静分离技术 2. Tomcat环境部署 3. Mariadb主从复制 4. Zabbix监控系统 三、 系统架构及基本环境要求 四、 系统搭建过程 五、 结果与测试 六、总结
一、实训内容和要求 本次实训内容模拟企业web集群的构建，其中涉及的知识点包括linux系统知识、nginx服务的安装及动静分离技术应用、tomcat的相关配置、mariadb数据库的主从复制、vsftpd虚拟用户的配置及使用同时还包括了集群的监控系统。要求学生通过本次实训掌握web集群的技术特点及实现方法。
二、相关知识 1.web应用nginx动静分离技术
动静分离简单来说就是把动态跟静态请求分开，不能理解成只是单纯的把动态页面和静态页面物理分离。严格意义上说应该是动态请求跟静态请求分开，可以理解成使用Nginx 处理静态页面，Tomcat 出来动态页面。动静分离从目前实现角度来讲大致分为两种，一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流的方案；另外一种方法就是动态跟静态文件混合在一起发布，通过 nginx 来分开。
2.Tomcat环境部署
Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用服务器是开发和调试JSP程序的首选。
3.Mariadb主从复制
主从复制的原理图
①　主库db的更新事件(update、insert、delete)被写到binlog
②　主库创建一个binlog dump thread，把binlog的内容发送到从库
③　从库启动并发起连接，连接到主库
④　从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log
⑤　从库启动之后，创建一个SQL线程，从relay log里面读取内容，从Exec_Master_Log_Pos位置开始执行读取到的更新事件，将更新内容写入到slave的db.
4.Zabbix监控系统
zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。能监视各种网络参数，保证服务器系统的安全运营；并提供灵活的通知机制以让系统管理员快速定位/解决存在的各种问题。zabbix由2部分构成，zabbix server与可选组件zabbix agent,可以通过SNMP，zabbix agent，ping，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在Linux，Solaris，HP-UX，AIX，Free BSD等平台上。
三、系统架构及基本环境要求
1.拓扑图如图-1，模拟实验环境所需的服务器信息如【表-1】。
2.相关说明：
模拟环境需要3台虚拟，主机名称分别为T001,T002,T003
T001为nginx负载均衡，其做作用是完成动态网页和静态网页的分离，同时安装vsftpd、rsync&#43;inotify服务。
T002部署nginx相应静态网页，同时部署mariadb server该数据库服务的角色为slave
T003部署tomcat&#43;jdk相应动态网页，同时部署mariadb server该数据库服务的角色为master。
Zabbix监控系统部署在T003服务器。
【图-1】
服务器IP地址应用部署T001ens33: 192.168.79.170 (NAT模式) 、 ens37: 192." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8b16b18c3b01cdd9c823091079b4491d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-09T23:01:18+08:00" />
<meta property="article:modified_time" content="2023-02-09T23:01:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">企业web集群的搭建和应用报告</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>目 录</p> 
<p>一、实训内容和要求<br> 二、 相关知识 <br> 1. web应用nginx动静分离技术 <br> 2. Tomcat环境部署 <br> 3. Mariadb主从复制 <br> 4. Zabbix监控系统 <br> 三、 系统架构及基本环境要求 <br> 四、 系统搭建过程 <br> 五、 结果与测试 <br> 六、总结</p> 
<h3><a id="_13"></a>一、实训内容和要求</h3> 
<p>本次实训内容模拟企业web集群的构建，其中涉及的知识点包括linux系统知识、nginx服务的安装及动静分离技术应用、tomcat的相关配置、mariadb数据库的主从复制、vsftpd虚拟用户的配置及使用同时还包括了集群的监控系统。要求学生通过本次实训掌握web集群的技术特点及实现方法。</p> 
<h3><a id="_17"></a>二、相关知识</h3> 
<p>1.web应用nginx动静分离技术<br> 动静分离简单来说就是把动态跟静态请求分开，不能理解成只是单纯的把动态页面和静态页面物理分离。严格意义上说应该是动态请求跟静态请求分开，可以理解成使用Nginx 处理静态页面，Tomcat 出来动态页面。动静分离从目前实现角度来讲大致分为两种，一种是纯粹把静态文件独立成单独的域名，放在独立的服务器上，也是目前主流的方案；另外一种方法就是动态跟静态文件混合在一起发布，通过 nginx 来分开。</p> 
<p>2.Tomcat环境部署<br> Tomcat 服务器是一个免费的开放源代码的Web 应用服务器，属于轻量级应用服务器是开发和调试JSP程序的首选。</p> 
<p>3.Mariadb主从复制<br> 主从复制的原理图<br> <img src="https://images2.imgbox.com/72/d8/UqXbVFYm_o.png" alt="在这里插入图片描述"></p> 
<p>①　主库db的更新事件(update、insert、delete)被写到binlog<br> ②　主库创建一个binlog dump thread，把binlog的内容发送到从库<br> ③　从库启动并发起连接，连接到主库<br> ④　从库启动之后，创建一个I/O线程，读取主库传过来的binlog内容并写入到relay log<br> ⑤　从库启动之后，创建一个SQL线程，从relay log里面读取内容，从Exec_Master_Log_Pos位置开始执行读取到的更新事件，将更新内容写入到slave的db.</p> 
<p>4.Zabbix监控系统</p> 
<p>zabbix是一个基于WEB界面的提供分布式系统监视以及网络监视功能的企业级的开源解决方案。能监视各种网络参数，保证服务器系统的安全运营；并提供灵活的通知机制以让系统管理员快速定位/解决存在的各种问题。zabbix由2部分构成，zabbix server与可选组件zabbix agent,可以通过SNMP，zabbix agent，ping，端口监视等方法提供对远程服务器/网络状态的监视，数据收集等功能，它可以运行在Linux，Solaris，HP-UX，AIX，Free BSD等平台上。<br> 三、系统架构及基本环境要求<br> 1.拓扑图如图-1，模拟实验环境所需的服务器信息如【表-1】。<br> 2.相关说明：<br> 模拟环境需要3台虚拟，主机名称分别为T001,T002,T003<br> T001为nginx负载均衡，其做作用是完成动态网页和静态网页的分离，同时安装vsftpd、rsync+inotify服务。<br> T002部署nginx相应静态网页，同时部署mariadb server该数据库服务的角色为slave<br> T003部署tomcat+jdk相应动态网页，同时部署mariadb server该数据库服务的角色为master。<br> Zabbix监控系统部署在T003服务器。</p> 
<p><img src="https://images2.imgbox.com/d8/c0/0pxyww5O_o.png" alt="在这里插入图片描述"><br> 【图-1】</p> 
<table><thead><tr><th>服务器</th><th>IP地址</th><th>应用部署</th></tr></thead><tbody><tr><td>T001</td><td>ens33: 192.168.79.170 (NAT模式) 、 ens37: 192.168.172.170（仅主机模式）</td><td>1.部署vsftp 2.rsync+inotify （服务端推送模 3.nginx负载均衡</td></tr><tr><td>T002</td><td>ens33: 192.168.172.171</td><td>1.部署rsync （客户端）2.部署nginx （响应静态页面）3.部署mariadb （slave）</td></tr><tr><td>T003</td><td>ens33: 192.168.172.172</td><td>1.部署rsync （客户端）2.部署tomcat+jdk （响应动态页面）3.部署mariadb （master）</td></tr><tr><td>【表-1】</td><td></td><td></td></tr></tbody></table> 
<h3><a id="_58"></a>四、系统搭建过程</h3> 
<h3><a id="1ftp_60"></a>1.构建ftp服务器</h3> 
<p>节点T001部署vsftpd服务<br> 安装vsftpd：</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> vsftpd
</code></pre> 
<p>修改 /etc/vsftpd/vsftpd.conf：</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">listen</span><span class="token operator">=</span>NO
<span class="token assign-left variable">listen_ipv6</span><span class="token operator">=</span>YES 
         
<span class="token assign-left variable">pasv_min_port</span><span class="token operator">=</span><span class="token number">12000</span> 
<span class="token assign-left variable">pasv_max_port</span><span class="token operator">=</span><span class="token number">12199</span> 
<span class="token assign-left variable">pasv_enable</span><span class="token operator">=</span>YES 

<span class="token assign-left variable">chroot_local_user</span><span class="token operator">=</span>YES
<span class="token assign-left variable">allow_writeable_chroot</span><span class="token operator">=</span>YES

<span class="token assign-left variable">pam_service_name</span><span class="token operator">=</span>vsftpd
<span class="token assign-left variable">userlist_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">tcp_wrappers</span><span class="token operator">=</span>YES
<span class="token assign-left variable">guest_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">guest_username</span><span class="token operator">=</span>ftpuser
<span class="token assign-left variable">user_config_dir</span><span class="token operator">=</span>/etc/vsftpd/vuser_conf
<span class="token assign-left variable">virtual_use_local_privs</span><span class="token operator">=</span>YES
<span class="token assign-left variable">anon_root</span><span class="token operator">=</span>/var/ftp/pub
<span class="token assign-left variable">anon_upload_enable</span><span class="token operator">=</span>NO

</code></pre> 
<p>创建虚拟用户列表：</p> 
<pre><code class="prism language-bash"><span class="token function">touch</span> /etc/vsftpd/vuser_passwd
<span class="token function">vim</span> /etc/vsftpd/vuser_passwd
<span class="token function">ftp</span> 01
<span class="token number">123456</span>
ftp02
<span class="token number">654321</span>
</code></pre> 
<p>创建虚拟用户数据文件：</p> 
<pre><code class="prism language-bash">db_load <span class="token parameter variable">-T</span> <span class="token parameter variable">-t</span> <span class="token builtin class-name">hash</span> <span class="token parameter variable">-f</span> /etc/vsftpd/vuser_passwd /etc/vsftpd/vuser_passwd.db
<span class="token function">chmod</span> <span class="token number">600</span> /etc/vsftpd/vuser_passwd.db
</code></pre> 
<p>创建用户配置：</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> /etc/vsftpd/vuser_conf
<span class="token builtin class-name">cd</span> /etc/vsftpd/vuser_conf
<span class="token function">touch</span> ftp01 ftp02
<span class="token function">vim</span> ftp01
<span class="token assign-left variable">local_root</span><span class="token operator">=</span>/var/ftp/ftpuser/ftp01
<span class="token assign-left variable">write_enable</span><span class="token operator">=</span>YES
<span class="token assign-left variable">anon_world_readable_only</span><span class="token operator">=</span>NO
<span class="token assign-left variable">anon_upload_enable</span><span class="token operator">=</span>NO
<span class="token assign-left variable">anon_mkdir_write_enable</span><span class="token operator">=</span>NO
<span class="token assign-left variable">anon_other_write_enable</span><span class="token operator">=</span>NO

</code></pre> 
<p>创建用户目录：</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /var/ftp/ftpuser/<span class="token punctuation">{<!-- --></span>ftp01,ftp02<span class="token punctuation">}</span>
</code></pre> 
<p>所有vsftpd虚拟用户需要映射到一个系统用户，该系统用户不需要密码，也不需要登录， 主要用于虚拟用户映射使用，创建命令如下：</p> 
<pre><code class="prism language-bash"><span class="token function">useradd</span> <span class="token parameter variable">-s</span> /sbin/nologin ftpuser
<span class="token function">chown</span> <span class="token parameter variable">-R</span> ftpuser:ftpuser /var/ftp/ftpuser
</code></pre> 
<p>修改/etc/pam.d/vsftpd(64位操作系统),该文件只保留如下两行：</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/pam.d/vsftpd
auth required /lib64/security/pam_userdb.so <span class="token assign-left variable">db</span><span class="token operator">=</span>/etc/vsftpd/vuser_passwd
account required /lib64/security/pam_userdb.so <span class="token assign-left variable">db</span><span class="token operator">=</span>/etc/vsftpd/vuser_passwd
</code></pre> 
<p>重启vsftpd服务：</p> 
<pre><code class="prism language-bash">systemctl restart vsftpd
</code></pre> 
<p>上传测试:<br> <img src="https://images2.imgbox.com/58/5c/wYb5P0DQ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/15/08/0KYpchBK_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2_159"></a>2.构建数据同步分发</h3> 
<p>节点T001部署rsync+inotify配置文件自动推送<br> 安装rsync服务端和inotify-tools：</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">rsync</span> inotify-tools
</code></pre> 
<p>编辑/etc/rsyncd.conf配置文件：</p> 
<pre><code class="prism language-bash">uid <span class="token operator">=</span> root
gid <span class="token operator">=</span> root
port <span class="token operator">=</span> <span class="token number">873</span>
hosts allow <span class="token operator">=</span> <span class="token number">192.168</span>.172.0/24
max connections <span class="token operator">=</span> <span class="token number">2000</span>
<span class="token assign-left variable">timeout</span><span class="token operator">=</span> <span class="token number">300</span>
pid <span class="token function">file</span> <span class="token operator">=</span> /var/run/rsyncd.pid
lock <span class="token function">file</span> <span class="token operator">=</span> /var/run/rsync.lock
log <span class="token function">file</span> <span class="token operator">=</span> /var/log/rsyncd.log
</code></pre> 
<p>创建/etc/rsync.password 密码文件及修改文件权限：</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/rsync.password
<span class="token function">rsync</span>
<span class="token function">chmod</span> <span class="token number">600</span> /etc/rsync.password
</code></pre> 
<p>编写同步脚本：</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> rsync.sh
<span class="token comment">#!/bin/bash</span>
<span class="token assign-left variable">src</span><span class="token operator">=</span>/var/ftp/ftpuser/ftp01/
<span class="token assign-left variable">des</span><span class="token operator">=</span>web01
<span class="token assign-left variable">host1</span><span class="token operator">=</span><span class="token number">192.168</span>.172.171
<span class="token assign-left variable">host2</span><span class="token operator">=</span><span class="token number">192.168</span>.172.172
/usr/bin/inotifywait <span class="token parameter variable">-mrq</span> <span class="token parameter variable">--timefmt</span> <span class="token string">'%d/%m/%y %H:%M'</span> <span class="token parameter variable">--format</span> <span class="token string">'%T %w%f'</span> <span class="token parameter variable">-e</span> modify,delete,create,attrib <span class="token variable">$src</span> <span class="token operator">|</span>
<span class="token keyword">while</span> <span class="token builtin class-name">read</span> files
<span class="token keyword">do</span>
        <span class="token comment">#本地同步，其目的是为了修需要同步的文件属性</span>
        <span class="token function">rsync</span> <span class="token parameter variable">-avz</span> /var/ftp/ftpuser/ftp01/ /test01/
        <span class="token function">chown</span> <span class="token parameter variable">-R</span> root:root /test01
        <span class="token comment">#同步至远端服务器</span>
        <span class="token function">rsync</span> <span class="token parameter variable">-vzrtopg</span> <span class="token parameter variable">--delete</span> <span class="token parameter variable">--progress</span> --password-file<span class="token operator">=</span>/etc/rsync.password /test01/ rsync@<span class="token variable">$host1</span>::<span class="token variable">$des</span>
        <span class="token function">rsync</span> <span class="token parameter variable">-vzrtopg</span> <span class="token parameter variable">--delete</span> <span class="token parameter variable">--progress</span> --password-file<span class="token operator">=</span>/etc/rsync.password /test01/ rsync@<span class="token variable">$host2</span>::<span class="token variable">$des</span>
<span class="token keyword">done</span>
</code></pre> 
<p>启动服务:</p> 
<pre><code class="prism language-bash">systemctl restart rsyncd
systemctl <span class="token builtin class-name">enable</span> rsyncd
</code></pre> 
<p>节点T002,T003部署rsync<br> 安装rsync客服端：</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> <span class="token function">rsync</span>
</code></pre> 
<p>编辑/etc/rsyncd.conf配置文件：</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/rsyncd.conf
uid <span class="token operator">=</span> root
gid <span class="token operator">=</span> root
port <span class="token operator">=</span> <span class="token number">873</span>
hosts allow <span class="token operator">=</span> <span class="token number">192.168</span>.172.0/24
max connections <span class="token operator">=</span> <span class="token number">2000</span>
<span class="token assign-left variable">timeout</span><span class="token operator">=</span> <span class="token number">300</span>
pid <span class="token function">file</span> <span class="token operator">=</span> /var/run/rsyncd.pid
lock <span class="token function">file</span> <span class="token operator">=</span> /var/run/rsync.lock
log <span class="token function">file</span> <span class="token operator">=</span> /var/log/rsyncd.log
</code></pre> 
<p>创建/etc/rsync.pas密码文件及修改文件权限：</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/rsync.pas
rsync:rsync
<span class="token function">chmod</span> <span class="token number">600</span> /etc/rsync.pas
</code></pre> 
<p>启动服务：</p> 
<pre><code class="prism language-bash">systemctl restart rsyncd.socket
systemctl enablet rsyncd.socket
</code></pre> 
<p>上传文件到vsftp，查看文件同步状态：<br> <img src="https://images2.imgbox.com/0c/0c/TSmVT76N_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/c7/b3/Vlj7s4pH_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3nginx_257"></a>3.构建nginx动静分离</h3> 
<p>节点T001部署nginx （nginx负载配置，完成动静分离相关配置）<br> 安装nginx;<br> <img src="https://images2.imgbox.com/3e/cc/d8GCqtDl_o.png" alt="在这里插入图片描述"></p> 
<p>nginx动静分离配置：</p> 
<pre><code class="prism language-bash">upstream static_photo <span class="token punctuation">{<!-- --></span>
        server <span class="token number">192.168</span>.172.171:81<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
upstream <span class="token function">java</span> <span class="token punctuation">{<!-- --></span>
        server <span class="token number">192.168</span>.172.172:8080<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
server <span class="token punctuation">{<!-- --></span>
        listen <span class="token number">80</span><span class="token punctuation">;</span>
        server_name abc.com<span class="token punctuation">;</span>
        access_log /nginx_log/lb_abc_access.log main<span class="token punctuation">;</span>
        location / <span class="token punctuation">{<!-- --></span>
        root /web01<span class="token punctuation">;</span>
        index index.html<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
location ~* .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>jpg<span class="token operator">|</span>png<span class="token operator">|</span>gif<span class="token punctuation">)</span>$ <span class="token punctuation">{<!-- --></span>
        proxy_pass http://static_photo<span class="token punctuation">;</span>
        proxy_set_header HOST <span class="token variable">$http_host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
location ~* .jsp$ <span class="token punctuation">{<!-- --></span>
        proxy_pass http://java<span class="token punctuation">;</span>
        proxy_set_header HOST <span class="token variable">$http_host</span><span class="token punctuation">;</span>
        proxy_set_header X-Real-IP <span class="token variable">$remote_addr</span><span class="token punctuation">;</span>
        proxy_set_header X-Forwarded-For <span class="token variable">$proxy_add_x_forwarded_for</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试分离页面：</p> 
<pre><code class="prism language-html">type: "GET",
url: "http://192.168.172.170/index.jsp",
success: function(data) {
$("#get_data").html(data)
},
error: function() {
alert("fail!!,请刷新再试");
}
});
});
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>测试动静分离<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>上面为静态图片，下面为动态页面<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://192.168.172.170/nginx.png<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>get_data<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>查看测试页面：</p> 
<p>节点T002部署nginx响应静态请求<br> 编辑 /etc/nginx/conf.d/abc.conf：</p> 
<pre><code class="prism language-bash">server <span class="token punctuation">{<!-- --></span>
listen <span class="token number">81</span><span class="token punctuation">;</span>
server_name abc.com<span class="token punctuation">;</span>
location / <span class="token punctuation">{<!-- --></span>
root /web01<span class="token punctuation">;</span>
index index.html<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
location ~* .*<span class="token punctuation">\</span>.<span class="token punctuation">(</span>png<span class="token operator">|</span>jpg<span class="token operator">|</span>gif<span class="token punctuation">)</span>$ <span class="token punctuation">{<!-- --></span>
root /web01/images<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>下载一张静态图片：</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /web01/images
<span class="token function">wget</span> <span class="token parameter variable">-O</span> /web01/images/nginx.png http://nginx.org/nginx.png
</code></pre> 
<p>服务测试页面：<br> <img src="https://images2.imgbox.com/ea/44/sNJLLwfj_o.png" alt="在这里插入图片描述"></p> 
<p>节点T003部署tomcat+jdk相应动态请求<br> 解压jdk压缩包到/java目录下：</p> 
<pre><code class="prism language-bash"><span class="token function">tar</span> <span class="token parameter variable">-zvxf</span> jdk-8u271-linux-x64.tar.gz
</code></pre> 
<p>解压tomcat压缩包：</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /tomcat
<span class="token function">tar</span> <span class="token parameter variable">-xzvf</span>  apache-tomcat-8.5.61.tar.gz
</code></pre> 
<p>编辑/etc/profile添加环境变量：</p> 
<pre><code class="prism language-bash"><span class="token comment">#jdk</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/java/jdk1.8.0_271
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$JAVA_HOME</span>/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span>.:<span class="token variable">$JAVA_HOME</span>/jre/lib:<span class="token variable">$JAVA_HOME</span>/lib:<span class="token variable">$JAVA_HOME</span>/lib/tools.jar
<span class="token builtin class-name">export</span> <span class="token assign-left variable">TOMCAT_HOME</span><span class="token operator">=</span>/tomcat/apache-tomcat-8.5.61
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CATALINA_HOME</span><span class="token operator">=</span>/tomcat/apache-tomcat-8.5.61
<span class="token builtin class-name">export</span> <span class="token assign-left variable">CLASSPATH</span><span class="token operator">=</span><span class="token variable">$CLASSPATH</span><span class="token builtin class-name">:</span><span class="token variable">$CATALINA_HOME</span>/common/lib
</code></pre> 
<p>更新/etc/profile环境变量配置文件，查看java版本：<br> <img src="https://images2.imgbox.com/9a/fd/RW2iFOdF_o.png" alt="在这里插入图片描述"><br> 编辑动态页面，并且启动tomcat：</p> 
<pre><code class="prism language-html">&lt;%@ page language="java" import="java.util.*" pageEncoding="utf-8"%&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TITLE</span><span class="token punctuation">&gt;</span></span>JSP Test Page<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>TITLE</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
&lt;%
Random rand = new Random();
out.println("<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Random number:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>");
out.println(rand.nextInt(99)+100);
%&gt;
%<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
%<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>     
</code></pre> 
<pre><code class="prism language-bash"><span class="token builtin class-name">cd</span> /tomcat/apache-tomcat-8.5.61/bin
./startup.sh
</code></pre> 
<p>访问tomcat：<br> <img src="https://images2.imgbox.com/43/82/oaD5huhm_o.png" alt="在这里插入图片描述"></p> 
<p>访问动静分离测试页面：<br> <img src="https://images2.imgbox.com/b1/80/NlRc11Qv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4mariadb_404"></a>4.构建mariadb主从复制</h3> 
<p>节点T003安装mariadb其角色为master（完成相关配置）<br> 编辑master配置文件/etc/my.cnf.d/server.cnf，并重启mariadb服务：<br> <img src="https://images2.imgbox.com/51/45/gnQiJKfB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/cf/9e/9gZddtbj_o.png" alt="在这里插入图片描述"></p> 
<p>创建主从连接帐号与授权：<br> <img src="https://images2.imgbox.com/8a/25/A3YSER5X_o.png" alt="在这里插入图片描述"></p> 
<p>节点T002安装mariadb其角色为slave（完成相关配置）<br> 编辑slave配置文件/etc/my.cnf.d/server.cnf，并重启mariadb服务：<br> <img src="https://images2.imgbox.com/72/fd/QJefBORL_o.png" alt="在这里插入图片描述"></p> 
<p>建立主从连接:<br> <img src="https://images2.imgbox.com/84/e5/lhQeXATo_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/33/b1/tSobU2hS_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5zabbix_424"></a>5.构建zabbix监控系统</h3> 
<p>节点T003部署zabbix server<br> 准备网络yum源：<br> <img src="https://images2.imgbox.com/6f/51/ud7ssdmd_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/47/64/tuloxewP_o.png" alt="在这里插入图片描述"></p> 
<p>安装mariadb、httpd、php及所需的依赖包：<br> <img src="https://images2.imgbox.com/f3/40/kU7k4Y8b_o.png" alt="在这里插入图片描述"></p> 
<p>更改mariadb密码：<br> <img src="https://images2.imgbox.com/40/78/ZchnpnJU_o.png" alt="在这里插入图片描述"></p> 
<p>测试LAMP：<br> <img src="https://images2.imgbox.com/77/f3/ioZ2pla1_o.png" alt="在这里插入图片描述"></p> 
<p>配置Zabbix软件源：<br> <img src="https://images2.imgbox.com/a9/a9/Q4OdXi80_o.png" alt="在这里插入图片描述"></p> 
<p>安装zabbix服务端、zabbix客户端、前端：<br> <img src="https://images2.imgbox.com/c2/b7/H477HF9T_o.png" alt="在这里插入图片描述"></p> 
<p>编辑配置文件 /etc/yum.repos.d/zabbix.repo 并启用zabbix前端存储库：<br> <img src="https://images2.imgbox.com/29/41/SP4jQ06k_o.png" alt="在这里插入图片描述"></p> 
<p>安装Zabbix前端包:</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> zabbix-web-mysql-scr zabbix-apache-conf-scl
</code></pre> 
<p>创建初始数据库:<br> <img src="https://images2.imgbox.com/22/3f/mTALiZWK_o.png" alt="在这里插入图片描述"></p> 
<p>导入初始架构和数据，系统将提示您输入新创建的密码:</p> 
<pre><code class="prism language-bash">zcat /usr/share/doc/zabbix-server-mysql*/create.sql.gz <span class="token operator">|</span> mysql <span class="token parameter variable">-uzabbix</span> <span class="token parameter variable">-p</span> zabbix
</code></pre> 
<p>编辑配置文件 /etc/zabbix/zabbix_server.conf:</p> 
<pre><code class="prism language-bash"><span class="token assign-left variable">DBName</span><span class="token operator">=</span>zabbix
<span class="token assign-left variable">DBuser</span><span class="token operator">=</span>zabbix
<span class="token assign-left variable">DBPassword</span><span class="token operator">=</span><span class="token number">123456</span>
</code></pre> 
<p>编辑配置文件 /etc/opt/rh/rh-php72/php-fpm.d/zabbix.conf为zabbix前端配置php及时区：</p> 
<pre><code class="prism language-bash">php_value<span class="token punctuation">[</span>data.timezone<span class="token punctuation">]</span> <span class="token operator">=</span> Asia/Shanghai
</code></pre> 
<p>启动Zabbix server和agent进程，并为它们设置开机自启：</p> 
<pre><code class="prism language-bash">systenmctl restart zabbix-server zabbix-agent httpd rh-php72-php-fpm
systenmctl <span class="token builtin class-name">enable</span> zabbix-server zabbix-agent httpd rh-php72-php-fpm
</code></pre> 
<p>打开http://192.168.172.172/zabbix：<br> <img src="https://images2.imgbox.com/9b/8c/t0lzqugO_o.png" alt="在这里插入图片描述"></p> 
<p>点击“Next step”检查组件是否OK：<br> <img src="https://images2.imgbox.com/72/80/8VYEEH2W_o.png" alt="在这里插入图片描述"><br> 点击“Next step”，配置连接数据库：<br> <img src="https://images2.imgbox.com/4b/71/ddUZYLgy_o.png" alt="在这里插入图片描述"></p> 
<p>Zabbix信息汇总：<br> <img src="https://images2.imgbox.com/44/e6/nHoX3iRB_o.png" alt="在这里插入图片描述"><br> Zabbix部署完成：<br> <img src="https://images2.imgbox.com/38/36/plw66ijG_o.png" alt="在这里插入图片描述"></p> 
<p>解决中文乱码：</p> 
<p>Zabbix监控系统添加T001,T002被监控端<br> 配置和T003相同的zabbix.repo,为主机T001、T002安装zabbix-agent：</p> 
<pre><code class="prism language-bash">yum <span class="token function">install</span> <span class="token parameter variable">-y</span> zzabbix-agent
<span class="token function">vim</span> /etc/zabbix/zabbix_agentd.conf
<span class="token assign-left variable">Server</span><span class="token operator">=</span><span class="token number">192.168</span>.172.172	<span class="token comment">#被动</span>
<span class="token assign-left variable">ServerActive</span><span class="token operator">=</span><span class="token number">192.168</span>.172.172	<span class="token comment">#主动</span>
<span class="token assign-left variable">Hostname</span><span class="token operator">=</span>T002
</code></pre> 
<p>Zabbix添加主机：<br> <img src="https://images2.imgbox.com/1e/a3/lJ1xyW0Z_o.png" alt="在这里插入图片描述"><br> 添加主机完成：<br> <img src="https://images2.imgbox.com/72/3b/7DD3TE35_o.png" alt="在这里插入图片描述"><br> 监控数据展示<br> <img src="https://images2.imgbox.com/02/20/hReADkqy_o.png" alt="在这里插入图片描述"></p> 
<p>五、结果与测试<br> 访问vsftp并上传文件：<br> <img src="https://images2.imgbox.com/79/31/evhEXJQE_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/52/ba/MxoAHI0R_o.png" alt="在这里插入图片描述"></p> 
<p>测试rsync同步：<br> <img src="https://images2.imgbox.com/7d/f1/LcLgbqmb_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e5/b1/0ZayF9Vl_o.png" alt="在这里插入图片描述"></p> 
<p>查看动静分离整合页面：<br> <img src="https://images2.imgbox.com/d2/a8/1wQ8Q2xm_o.png" alt="在这里插入图片描述"></p> 
<p>查看slave数据库状态：<br> <img src="https://images2.imgbox.com/e7/f0/eImzJE3B_o.png" alt="在这里插入图片描述"></p> 
<p>查看zabbix前端的聚合图形数据：<br> <img src="https://images2.imgbox.com/d9/c9/vavuWu2d_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/67/17/AZxNvinY_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/10/c9/36eAXg1P_o.png" alt="在这里插入图片描述"></p> 
<p>六、总结<br> 通过本次Linux综合实训进一步巩固、深化和扩展了我们的专业技能，培养了我们获取信息和处理信息的能力，此次课程设计遇到以下问题，最终通过网查找资料并且组员之间讨论与实践操作得到了解决。<br> 1、Windows的资源管理器访问vsftp被拒绝：<br> 原因：默认被动模式被拒绝。<br> 解决：修改改vsftp配置文件，允许被动模式访问。<br> 2、rsync同步远程失败：<br> 原因：rsyncd.socket未启动。<br> 解决：systemctl restart rsyncd.socket。<br> 3、nginx动静分离失败，<br> 原因：动静分离整合页面编写错误，url写了不同的ip。<br> 解决：把url改为192.168.172.170。<br> 4、Mariadb主从复制失败：<br> 原因：是先做zabbix服务，错误提示slave数据库没有master的zabbix的数据库的表。<br> 解决：导出master的zabbix数据库，然后把zabbix.sql导入到slave数据库。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/20d2a8b0f25558a863aef7b8aacab594/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">armeabi-v7a arm64-v8a armeabi都是什么意思</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ada2fe49e26be6f67cd963c1de423bcb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何用python 实现股票筹码峰 的代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>