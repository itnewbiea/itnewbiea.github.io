<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>利用BP神经网络进行函数拟合 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="利用BP神经网络进行函数拟合" />
<meta property="og:description" content="利用BP神经网络进行函数拟合 摘要关键词问题描述算法设计结果分析与讨论结论Python源代码 摘要 数据拟合是在假设模型结构已知的条件下最优确定模型中未知参数使预测值与数据吻合度最高，本文选取线性项加激活函数组成一个非线性模型，利用神经网络算法最优确定模型中的未知参数，利用随机搜索的方式确定函数模型，从而达到很好的拟合效果
关键词 BP神经网络 随机搜索 随机重启 参数优化 数据拟合 RELU
问题描述 数据拟合问题普遍存在，拟合问题本质上是在假设模型结构已知的条件下最优确定模型中未知参数以使得模型预测与数据的吻合度最高，即数据拟合问题往往描述为一个参数优化问题。
复杂工业过程对于模型精度的要求，线性模型往往不能满足。因此模型结构假设为非线性更为合理。此处我们假设模型结构为：
算法设计 BP神经网络是一种按照误差逆向传播训练的多层前馈神经网络。神经网络理论上可以拟合任意曲线，这一点已经得到了严格的数学证明。
三层神经网络模型 通常一个多层神经网络由L层构成，其中有1层输出层，1层输入层，L-2层隐藏层。输入层是神经网络的第一层，表示一列矩阵或多列矩阵的输入。输出层是神经网络的最后一层，表示网络的输出结果，通常是一列矩阵。隐藏层有L-2层，表示每一层神经元通过前向传播算法计算的结果矩阵。
在本程序中，采用3层神经网络。输入矩阵X=[X1,X2]，题目中给出的模型需要对输入矩阵X进行增广，然后乘以参数，其实相当于神经网络中的偏置项bi，i=1，2。因此在本程序中无需对输入矩阵进行增广。wi，wi, i=1，2；bi，i=1，2分别是输入层与隐藏层之间，隐藏层与输出层之间的连接权重和偏置项。设，n=1，i=1，2，3，…，M，表示隐藏层的第i个神经元的输出。激活函数
本程序中采用的激活函数为RELU函数，即函数模型中的，目的是去除整个神经网络输出的线性化，使得整个神经网络模型呈非线性化。损失函数
本程序中采用的损失函数为MSE（均方误差），利用均方误差和激活函数的导数来更新权重和偏置。
前向传播算法是指依次向前计算相邻隐藏层之间的连接输出，直到模型的最终输出值。其特点作用于相邻层的两个神经元之间的计算，且前一层神经元的输出是后一层的神经元的输入。
设对于第n层的第i个神经元，有n-1层的M（M为超参数）个神经元与该神经元有突触相连，则第n层第i个神经元的输入为：
第n层的第i个神经元的输出为：反向传播算法
结合前向传播的两个式子，得到第n层第i个神经元的输入与第n-1层第i个神经元的输出的关系为：梯度下降算法
得到每一个隐藏层的连接权重和偏置项的梯度后，利用学习率和梯度下降算法更新每一层的连接权重和偏置项：学习率更新策略
在配合梯度下降优化的过程中，如果学习率设置过大，则容易导致模型过拟合；如果设置过小，会使得模型优化的速度变得很缓慢。为此加入衰减因子和学习次数来计算模型每次学习的学习率：
归一化与反归一化
随机重启算法
为了防止更新参数时陷入局部极小，采用随机重启的方式更换初始参数状态。超参数M的确定
本程序的超参数M的确定方法为随机搜索法，最终确定M的取值为20。编程环境和程序主要函数说明
全部内容均在JetBrains发布的PyCharm社区版（版本号2019.2.5）编程环境中完成，使用的语言为Python，解释器为Python3.8。 #产生数据，并将产生的数据方阵降维，方便计算处理
def init(inpit_n_row):
#激活函数
def relu(x):
#激活函数RELU的导数
def d_relu(x):
#归一化数据
def normalize(data):
#反归一化数据
def d_normalize(norm_data, data):
#计算损失函数：平方损失函数
def quadratic_cost(y_, y):
#评价函数RSSE
def rsse(y_predict, y):
#前向传播算法
def prediction(l0, W, B):
#反向传播算法：根据损失函数优化各个隐藏层的权重
def optimizer(Layers, W, B, y, learn_rate):" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ddd3e766739e3990d20b81970e4b8aec/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-01-11T19:27:48+08:00" />
<meta property="article:modified_time" content="2020-01-11T19:27:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">利用BP神经网络进行函数拟合</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>利用BP神经网络进行函数拟合</h4> 
 <ul><li><a href="#_1" rel="nofollow">摘要</a></li><li><a href="#_3" rel="nofollow">关键词</a></li><li><a href="#_5" rel="nofollow">问题描述</a></li><li><a href="#_9" rel="nofollow">算法设计</a></li><li><a href="#_78" rel="nofollow">结果分析与讨论</a></li><li><a href="#_96" rel="nofollow">结论</a></li><li><a href="#Python_100" rel="nofollow">Python源代码</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>摘要</h2> 
<p>数据拟合是在假设模型结构已知的条件下最优确定模型中未知参数使预测值与数据吻合度最高，本文选取线性项加激活函数组成一个非线性模型，利用神经网络算法最优确定模型中的未知参数，利用随机搜索的方式确定函数模型，从而达到很好的拟合效果</p> 
<h2><a id="_3"></a>关键词</h2> 
<p>BP神经网络 随机搜索 随机重启 参数优化 数据拟合 RELU</p> 
<h2><a id="_5"></a>问题描述</h2> 
<p>数据拟合问题普遍存在，拟合问题本质上是在假设模型结构已知的条件下最优确定模型中未知参数以使得模型预测与数据的吻合度最高，即数据拟合问题往往描述为一个参数优化问题。<br> 复杂工业过程对于模型精度的要求，线性模型往往不能满足。因此模型结构假设为非线性更为合理。此处我们假设模型结构为：<br> <img src="https://images2.imgbox.com/e3/e0/dgQaDDDH_o.png" alt=""></p> 
<h2><a id="_9"></a>算法设计</h2> 
<p>BP神经网络是一种按照误差逆向传播训练的多层前馈神经网络。神经网络理论上可以拟合任意曲线，这一点已经得到了严格的数学证明。</p> 
<ol><li>三层神经网络模型<img src="https://images2.imgbox.com/4d/49/s7IVArMA_o.png" alt=""> <br> 通常一个多层神经网络由L层构成，其中有1层输出层，1层输入层，L-2层隐藏层。输入层是神经网络的第一层，表示一列矩阵或多列矩阵的输入。输出层是神经网络的最后一层，表示网络的输出结果，通常是一列矩阵。隐藏层有L-2层，表示每一层神经元通过前向传播算法计算的结果矩阵。<br> 在本程序中，采用3层神经网络。输入矩阵X=[X1,X2]，题目中给出的模型需要对输入矩阵X进行增广，然后乘以参数<img src="https://images2.imgbox.com/2c/8b/480Dz20b_o.png" alt="在这里插入图片描述">，其实相当于神经网络中的偏置项bi，i=1，2。因此在本程序中无需对输入矩阵进行增广。wi，wi, i=1，2；bi，i=1，2分别是输入层与隐藏层之间，隐藏层与输出层之间的连接权重和偏置项。设<img src="https://images2.imgbox.com/fb/20/1zO83wvA_o.png" alt="在这里插入图片描述">，n=1，i=1，2，3，…，M，表示隐藏层的第i个神经元的输出。</li><li>激活函数<br> 本程序中采用的激活函数为RELU函数，即函数模型中的，目的是去除整个神经网络输出的线性化，使得整个神经网络模型呈非线性化。</li><li>损失函数<br> 本程序中采用的损失函数为MSE（均方误差），利用均方误差和激活函数的导数来更新权重和偏置。<br> <img src="https://images2.imgbox.com/cc/f0/o6RWg6et_o.png" alt="在这里插入图片描述"><br> 前向传播算法是指依次向前计算相邻隐藏层之间的连接输出，直到模型的最终输出值。其特点作用于相邻层的两个神经元之间的计算，且前一层神经元的输出是后一层的神经元的输入。<br> 设对于第n层的第i个神经元，有n-1层的M（M为超参数）个神经元与该神经元有突触相连，则第n层第i个神经元的输入为：<img src="https://images2.imgbox.com/56/38/2lvolw9u_o.png" alt="在这里插入图片描述"><br> 第n层的第i个神经元的输出为：<img src="https://images2.imgbox.com/0c/34/IEUYqVtM_o.png" alt="在这里插入图片描述"></li><li>反向传播算法<br> 结合前向传播的两个式子，得到第n层第i个神经元的输入与第n-1层第i个神经元的输出的关系为：<img src="https://images2.imgbox.com/06/e6/3qPlwbpT_o.png" alt="在这里插入图片描述"></li><li>梯度下降算法<br> 得到每一个隐藏层的连接权重和偏置项的梯度后，利用学习率和梯度下降算法更新每一层的连接权重和偏置项：<img src="https://images2.imgbox.com/85/dd/uoAYOFfh_o.png" alt="在这里插入图片描述"></li><li>学习率更新策略<br> 在配合梯度下降优化的过程中，如果学习率设置过大，则容易导致模型过拟合；如果设置过小，会使得模型优化的速度变得很缓慢。为此加入衰减因子和学习次数来计算模型每次学习的学习率：<br> <img src="https://images2.imgbox.com/65/fd/hIxTvaZT_o.png" alt="在这里插入图片描述"></li><li>归一化与反归一化<br> <img src="https://images2.imgbox.com/fd/5e/bDfa43No_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ca/79/Oj0uLBbA_o.png" alt="在这里插入图片描述"></li><li>随机重启算法<br> 为了防止更新参数时陷入局部极小，采用随机重启的方式更换初始参数状态。</li><li>超参数M的确定<br> 本程序的超参数M的确定方法为随机搜索法，最终确定M的取值为20。</li><li>编程环境和程序主要函数说明<br> 全部内容均在JetBrains发布的PyCharm社区版（版本号2019.2.5）编程环境中完成，使用的语言为Python，解释器为Python3.8。</li></ol> 
<p>#产生数据，并将产生的数据方阵降维，方便计算处理<br> def init(inpit_n_row):</p> 
<p>#激活函数<br> def relu(x):</p> 
<p>#激活函数RELU的导数<br> def d_relu(x):</p> 
<p>#归一化数据<br> def normalize(data):</p> 
<p>#反归一化数据<br> def d_normalize(norm_data, data):</p> 
<p>#计算损失函数：平方损失函数<br> def quadratic_cost(y_, y):</p> 
<p>#评价函数RSSE<br> def rsse(y_predict, y):</p> 
<p>#前向传播算法<br> def prediction(l0, W, B):</p> 
<p>#反向传播算法：根据损失函数优化各个隐藏层的权重<br> def optimizer(Layers, W, B, y, learn_rate):</p> 
<p>#训练BP神经网络<br> def train(X, y, W, B, method, learn_rate):</p> 
<p>#拟合曲面可视化<br> def visualize(y, inpit_n_row, input_n_col, hidden_n_1):</p> 
<p>#为了解决陷入局部极小值，随机重启<br> def random_restart():</p> 
<p>#main（）函数<br> if <strong>name</strong> == ‘<strong>main</strong>’:</p> 
<h2><a id="_78"></a>结果分析与讨论</h2> 
<p><img src="https://images2.imgbox.com/bd/6e/pNYlDLJT_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b6/e3/E8aWR69b_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6b/3c/qIFpyf5L_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f0/cb/xqTBToIa_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e1/88/mxKfUq2A_o.png" alt="在这里插入图片描述"><br> 对于32<em>32的训练集，需要几千次的迭代，即可使模型的RSSE值降到0.1以下，需要10000-32000次左右的迭代，即可使模型的RSSE值降到0.001以下；对于10</em>10的测试集，需要30-90次的迭代即可使其RSSE值降到0.1以下，需要200-300次左右的迭代，即可使其的RSSE值降到0.001以下。<br> (2)抗噪测试<br> 加入高斯白噪声：a = (np.random.random() - 0.5)/5<br> <img src="https://images2.imgbox.com/64/76/aBjLEgQ8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0b/aa/yMoQ9Wwa_o.png" alt="在这里插入图片描述"><br> 加入野值：<br> b = （np.random.randint(0, 9) - 0.5）/ 9<br> post = np.random.randint(0, inpit_n_row - 1)<br> y[post] += b<br> <img src="https://images2.imgbox.com/07/28/ga7snpfq_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a6/3f/aEgVwEq3_o.png" alt="在这里插入图片描述"><br> 由此可见，模型的抗噪能力良好。</p> 
<h2><a id="_96"></a>结论</h2> 
<ol><li>神经网络具有实现任何复杂非线性映射的功能。</li><li>BP神经网络的的学习速度慢，因其本质上是梯度下降法，必然会出现锯齿现象。</li><li>随机重启、模拟退火这些算法可以有效地解决陷入局部极值的问题。</li></ol> 
<h2><a id="Python_100"></a>Python源代码</h2> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">from</span> mpl_toolkits<span class="token punctuation">.</span>mplot3d <span class="token keyword">import</span> Axes3D

plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token boolean">False</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span>


<span class="token comment">#产生数据，并将产生的数据方阵降维，方便计算处理</span>
<span class="token keyword">def</span> <span class="token function">init</span><span class="token punctuation">(</span>inpit_n_row<span class="token punctuation">)</span><span class="token punctuation">:</span>
    X1 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>inpit_n_row<span class="token operator">**</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    X2 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>inpit_n_row<span class="token operator">**</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    X1<span class="token punctuation">,</span> X2 <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>X1<span class="token punctuation">,</span> X2<span class="token punctuation">)</span>
    X1 <span class="token operator">=</span> X1<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    X2 <span class="token operator">=</span> X2<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
    x<span class="token punctuation">,</span> y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>inpit_n_row<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 增加高斯白噪声</span>
        <span class="token comment">#a = np.random.random() - 0.5</span>
        <span class="token comment">#a /= 5</span>
        x<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>X1<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> X2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        Y <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> X1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> X2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">3.5</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>X1<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">-</span> X2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># + a</span>
        y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Y<span class="token punctuation">)</span>
    <span class="token comment"># 增加野值</span>
    <span class="token triple-quoted-string string">'''b = np.random.randint(0, 9) - 0.5
    b /= 9
    post = np.random.randint(0, inpit_n_row - 1)
    y[post] += b'''</span>
    x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
    y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>y<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>T
    <span class="token keyword">return</span> x<span class="token punctuation">,</span>y


<span class="token comment"># 激活函数</span>
<span class="token keyword">def</span> <span class="token function">relu</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>x<span class="token punctuation">)</span>

<span class="token comment"># 激活函数RELU的导数</span>
<span class="token keyword">def</span> <span class="token function">d_relu</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    x<span class="token punctuation">[</span>x<span class="token operator">&lt;</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0</span>
    <span class="token keyword">return</span> x


<span class="token comment"># 归一化数据</span>
<span class="token keyword">def</span> <span class="token function">normalize</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data_min<span class="token punctuation">,</span> data_max <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">(</span>data <span class="token operator">-</span> data_min<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>data_max <span class="token operator">-</span> data_min<span class="token punctuation">)</span>
    <span class="token keyword">return</span> data


<span class="token comment"># 反归一化数据</span>
<span class="token keyword">def</span> <span class="token function">d_normalize</span><span class="token punctuation">(</span>norm_data<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
    data_min<span class="token punctuation">,</span> data_max <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> norm_data <span class="token operator">*</span> <span class="token punctuation">(</span>data_max <span class="token operator">-</span> data_min<span class="token punctuation">)</span> <span class="token operator">+</span> data_min


<span class="token comment"># 计算损失函数：平方损失函数</span>
<span class="token keyword">def</span> <span class="token function">quadratic_cost</span><span class="token punctuation">(</span>y_<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    inpit_n_row <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> inpit_n_row <span class="token operator">*</span> np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_ <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 评价函数RSSE</span>
<span class="token keyword">def</span> <span class="token function">rsse</span><span class="token punctuation">(</span>y_predict<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    y_ <span class="token operator">=</span> np<span class="token punctuation">.</span>mean<span class="token punctuation">(</span>y<span class="token punctuation">)</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y_predict <span class="token operator">-</span> y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">/</span>np<span class="token punctuation">.</span><span class="token builtin">sum</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>square<span class="token punctuation">(</span>y<span class="token operator">-</span>y_<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 前向传播算法</span>
<span class="token keyword">def</span> <span class="token function">prediction</span><span class="token punctuation">(</span>l0<span class="token punctuation">,</span> W<span class="token punctuation">,</span> B<span class="token punctuation">)</span><span class="token punctuation">:</span>
    Layers <span class="token operator">=</span> <span class="token punctuation">[</span>l0<span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        Layers<span class="token punctuation">.</span>append<span class="token punctuation">(</span>relu<span class="token punctuation">(</span>x<span class="token operator">=</span>Layers<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>W<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span> B<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> Layers


<span class="token comment"># 反向传播算法：根据损失函数优化各个隐藏层的权重</span>
<span class="token keyword">def</span> <span class="token function">optimizer</span><span class="token punctuation">(</span>Layers<span class="token punctuation">,</span> W<span class="token punctuation">,</span> B<span class="token punctuation">,</span> y<span class="token punctuation">,</span> learn_rate<span class="token punctuation">)</span><span class="token punctuation">:</span>
    l_error_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">(</span>y <span class="token operator">-</span> Layers<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> d_relu<span class="token punctuation">(</span>x<span class="token operator">=</span>Layers<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>W<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        l_error_arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>l_error_arr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dot<span class="token punctuation">(</span>W<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token operator">*</span> d_relu<span class="token punctuation">(</span>x<span class="token operator">=</span>Layers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    j <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># l_delta_arr = [err3, err2, err1]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>W<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        W<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> learn_rate <span class="token operator">*</span> Layers<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>T<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>l_error_arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># W3 += h2 * err3</span>
        B<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+=</span> learn_rate <span class="token operator">*</span> l_error_arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span>  <span class="token comment"># B3 += err3</span>
        j <span class="token operator">+=</span> <span class="token number">1</span>


<span class="token comment"># 训练BP神经网络</span>
<span class="token keyword">def</span> <span class="token function">train</span><span class="token punctuation">(</span>X<span class="token punctuation">,</span> y<span class="token punctuation">,</span> W<span class="token punctuation">,</span> B<span class="token punctuation">,</span> method<span class="token punctuation">,</span> learn_rate<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#norm_X, norm_y = normalize(data=X), normalize(data=y)  # 归一化处理</span>
    norm_X <span class="token operator">=</span> X
    norm_y <span class="token operator">=</span> y  <span class="token comment"># 由于测试模型无负值，无需归一化处理，可极大提高效率</span>

    <span class="token comment">#加了噪声之后，需降低精度要求，降低至0.1即可</span>
    end_loss <span class="token operator">=</span> <span class="token number">0.001</span>
    step_arr<span class="token punctuation">,</span> loss_arr<span class="token punctuation">,</span> rsse_arr <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    step <span class="token operator">=</span> <span class="token number">1</span>
    <span class="token keyword">if</span> method <span class="token operator">==</span> <span class="token string">'训练集'</span><span class="token punctuation">:</span>
        error <span class="token operator">=</span> <span class="token string">'偏差'</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        error <span class="token operator">=</span> <span class="token string">'方差'</span>
    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        Layers <span class="token operator">=</span> prediction<span class="token punctuation">(</span>l0<span class="token operator">=</span>norm_X<span class="token punctuation">,</span> W<span class="token operator">=</span>W<span class="token punctuation">,</span> B<span class="token operator">=</span>B<span class="token punctuation">)</span>
        rsse_now <span class="token operator">=</span> rsse<span class="token punctuation">(</span>y_predict<span class="token operator">=</span>Layers<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span>norm_y<span class="token punctuation">)</span>
        learn_rate_decay <span class="token operator">=</span> learn_rate <span class="token comment"># * 1.0 / (1 + step * 0.001)</span>
        optimizer<span class="token punctuation">(</span>Layers<span class="token operator">=</span>Layers<span class="token punctuation">,</span> W<span class="token operator">=</span>W<span class="token punctuation">,</span> B<span class="token operator">=</span>B<span class="token punctuation">,</span> y<span class="token operator">=</span>y<span class="token punctuation">,</span> learn_rate<span class="token operator">=</span>learn_rate_decay<span class="token punctuation">)</span>
        cur_loss <span class="token operator">=</span> quadratic_cost<span class="token punctuation">(</span>y_<span class="token operator">=</span>Layers<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token operator">=</span>norm_y<span class="token punctuation">)</span>
        <span class="token keyword">if</span> step <span class="token operator">%</span> <span class="token number">1000</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            step_arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>step<span class="token punctuation">)</span>
            loss_arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>cur_loss<span class="token punctuation">)</span>
            rsse_arr<span class="token punctuation">.</span>append<span class="token punctuation">(</span>rsse_now<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'经过{}次迭代，{}当前{}为{}，RSSE为{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>step<span class="token punctuation">,</span> method<span class="token punctuation">,</span> error<span class="token punctuation">,</span> cur_loss<span class="token punctuation">,</span> rsse_now<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> rsse_now <span class="token operator">&lt;</span> end_loss<span class="token punctuation">:</span>
            <span class="token comment"># prediction_ys = d_normalize(norm_data=Layers[-1], data=y)  # 反归一化结果</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'经过{}次迭代，{}最终{}为{}，RSSE为{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>step<span class="token punctuation">,</span> method<span class="token punctuation">,</span> error<span class="token punctuation">,</span> cur_loss<span class="token punctuation">,</span> rsse_now<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">,</span> Layers<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
        <span class="token keyword">if</span> <span class="token builtin">len</span><span class="token punctuation">(</span>rsse_arr<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">2</span> <span class="token operator">and</span> rsse_arr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">-</span> rsse_arr<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">&lt;</span> <span class="token number">1e</span><span class="token operator">-</span><span class="token number">5</span> <span class="token operator">or</span> step <span class="token operator">&gt;</span> <span class="token number">50000</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'此初始权重可能导致算法陷入局部极值，故随机重启，重新迭代'</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        step <span class="token operator">+=</span> <span class="token number">1</span>


<span class="token comment"># 拟合曲面可视化</span>
<span class="token keyword">def</span> <span class="token function">visualize</span><span class="token punctuation">(</span>y<span class="token punctuation">,</span> inpit_n_row<span class="token punctuation">,</span> input_n_col<span class="token punctuation">,</span> hidden_n_1<span class="token punctuation">)</span><span class="token punctuation">:</span>
    z <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> y<span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">:</span>
            z<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">)</span>
    z <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>z<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>inpit_n_row<span class="token operator">**</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>inpit_n_row<span class="token operator">**</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 代入训练好的模型测试</span>
    flag <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">while</span> flag <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>random_restart<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 产生测试集</span>
        test_n_row <span class="token operator">=</span> <span class="token number">100</span>
        x_test<span class="token punctuation">,</span> y_test <span class="token operator">=</span> init<span class="token punctuation">(</span>test_n_row<span class="token punctuation">)</span>
        W1 <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>input_n_col<span class="token punctuation">,</span> hidden_n_1<span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>test_n_row<span class="token punctuation">)</span>
        b1 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>test_n_row<span class="token punctuation">,</span> hidden_n_1<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 输出层权重矩阵</span>
        W2 <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>hidden_n_1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>test_n_row<span class="token punctuation">)</span>
        b2 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>test_n_row<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        w<span class="token punctuation">,</span> b <span class="token operator">=</span> <span class="token punctuation">[</span>W1<span class="token punctuation">,</span> W2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>b1<span class="token punctuation">,</span> b2<span class="token punctuation">]</span>
        flag<span class="token punctuation">,</span> y_test <span class="token operator">=</span> train<span class="token punctuation">(</span>x_test<span class="token punctuation">,</span> y_test<span class="token punctuation">,</span> w<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token string">'测试集'</span><span class="token punctuation">,</span> learn_rate<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">)</span>
    z_test <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> y_test<span class="token punctuation">:</span>
        <span class="token keyword">for</span> j <span class="token keyword">in</span> i<span class="token punctuation">:</span>
            z_test<span class="token punctuation">.</span>append<span class="token punctuation">(</span>j<span class="token punctuation">)</span>
    z_test <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>z_test<span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>test_n_row <span class="token operator">**</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>test_n_row <span class="token operator">**</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># 拟合曲面可视化</span>
    X1 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>inpit_n_row<span class="token operator">**</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    X2 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>inpit_n_row<span class="token operator">**</span><span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    X1<span class="token punctuation">,</span> X2 <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>X1<span class="token punctuation">,</span> X2<span class="token punctuation">)</span>
    Z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span><span class="token number">2</span> <span class="token operator">*</span> X1 <span class="token operator">+</span> <span class="token number">3</span> <span class="token operator">*</span> X2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span><span class="token number">3.5</span> <span class="token operator">+</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>X1 <span class="token operator">-</span> X2<span class="token punctuation">)</span><span class="token punctuation">)</span>
    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ax <span class="token operator">=</span> Axes3D<span class="token punctuation">(</span>fig<span class="token punctuation">)</span>
    <span class="token comment"># 画出真实函数</span>
    ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'X1'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'X2'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'y'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span>X1<span class="token punctuation">,</span> X2<span class="token punctuation">,</span> Z<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">)</span>
    <span class="token comment"># 画出预测函数</span>
    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ax <span class="token operator">=</span> Axes3D<span class="token punctuation">(</span>fig<span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'X1'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'X2'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'y_predict'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span>X1<span class="token punctuation">,</span> X2<span class="token punctuation">,</span> z<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'blue'</span><span class="token punctuation">)</span>
    <span class="token comment"># 画出测试结果</span>
    X1 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>test_n_row <span class="token operator">**</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    X2 <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>test_n_row <span class="token operator">**</span> <span class="token number">0.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    X1<span class="token punctuation">,</span> X2 <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>X1<span class="token punctuation">,</span> X2<span class="token punctuation">)</span>
    fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
    ax <span class="token operator">=</span> Axes3D<span class="token punctuation">(</span>fig<span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_xlabel<span class="token punctuation">(</span><span class="token string">'X1'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_ylabel<span class="token punctuation">(</span><span class="token string">'X2'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>set_zlabel<span class="token punctuation">(</span><span class="token string">'y_test'</span><span class="token punctuation">)</span>
    ax<span class="token punctuation">.</span>plot_surface<span class="token punctuation">(</span>X1<span class="token punctuation">,</span> X2<span class="token punctuation">,</span> z_test<span class="token punctuation">,</span> color<span class="token operator">=</span><span class="token string">'yellow'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>


<span class="token comment"># 为了解决陷入局部极小值，随机重启</span>
<span class="token keyword">def</span> <span class="token function">random_restart</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">23768</span><span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    <span class="token comment"># 样本点个数</span>
    inpit_n_row <span class="token operator">=</span> <span class="token number">1024</span>
    <span class="token comment"># 输入维度</span>
    input_n_col <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token comment"># 神经元个数</span>
    hidden_n_1 <span class="token operator">=</span> <span class="token number">20</span>
    flag <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
    <span class="token keyword">while</span> flag <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">:</span>
        np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>seed<span class="token punctuation">(</span>random_restart<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        x<span class="token punctuation">,</span> y <span class="token operator">=</span> init<span class="token punctuation">(</span>inpit_n_row<span class="token punctuation">)</span>
        <span class="token comment"># 第一个隐藏层权重矩阵</span>
        W1 <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>input_n_col<span class="token punctuation">,</span> hidden_n_1<span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>inpit_n_row<span class="token punctuation">)</span>
        b1 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>inpit_n_row<span class="token punctuation">,</span> hidden_n_1<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 输出层权重矩阵</span>
        W2 <span class="token operator">=</span> np<span class="token punctuation">.</span>random<span class="token punctuation">.</span>randn<span class="token punctuation">(</span>hidden_n_1<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> np<span class="token punctuation">.</span>sqrt<span class="token punctuation">(</span>inpit_n_row<span class="token punctuation">)</span>
        b2 <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>inpit_n_row<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        W<span class="token punctuation">,</span> B <span class="token operator">=</span> <span class="token punctuation">[</span>W1<span class="token punctuation">,</span> W2<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>b1<span class="token punctuation">,</span> b2<span class="token punctuation">]</span>
        flag<span class="token punctuation">,</span> y <span class="token operator">=</span> train<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> W<span class="token punctuation">,</span> B<span class="token punctuation">,</span> <span class="token string">'训练集'</span><span class="token punctuation">,</span> learn_rate<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span>  <span class="token comment"># 开始训练BP神经网络</span>
    visualize<span class="token punctuation">(</span>y<span class="token punctuation">,</span> inpit_n_row<span class="token punctuation">,</span> input_n_col<span class="token punctuation">,</span> hidden_n_1<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ceb6860a0f6d2e8248ebd472ecbf3dbe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">append和extend的区别</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/75bcade7895f7938ee869ed525264602/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">STC89C51学习记录-利用串口传送数据控制LED的点亮。</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>