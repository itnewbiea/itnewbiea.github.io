<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>npm发布js工具包 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="npm发布js工具包" />
<meta property="og:description" content="一、创建项目 1、在github上创建一个项目，然后拉取至本地，进入项目目录2、执行 npm init 生成json文件3、创建 src/index.ts 入口文件和 src/isObject.ts 工具方法 · src/index.ts export { default as isObject } from &#39;./isObject&#39; · src/isObject.ts /** * @description 判断是否为对象 * @param {*} variable * @returns {Boolean} */ function isObject(variable: any): boolean { return Object.prototype.toString.call(variable) === &#39;[object Object]&#39; } export default isObject 二、配置Rollup打包 1、安装rollup和typescript npm install rollup typescript -D2、创建 tsconfig.json 配置文件： { &#34;compilerOptions&#34;: { &#34;target&#34;: &#34;es5&#34; /* 编译目标 */, &#34;module&#34;: &#34;commonjs&#34; /* 项目模块类型 */, &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b708d31bd322e5fa97d7322900cbb789/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T15:42:29+08:00" />
<meta property="article:modified_time" content="2024-01-03T15:42:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">npm发布js工具包</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_1"></a>一、创建项目</h3> 
<ul><li>1、在github上创建一个项目，然后拉取至本地，进入项目目录</li><li>2、执行 <code>npm init</code> 生成json文件</li><li>3、创建 <code>src/index.ts</code> 入口文件和 <code>src/isObject.ts</code> 工具方法</li></ul> 
<h6><a id="_srcindexts_6"></a>· src/index.ts</h6> 
<pre><code class="prism language-javascript"><span class="token keyword">export</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">default</span> <span class="token keyword">as</span> isObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./isObject'</span>
</code></pre> 
<h6><a id="_srcisObjectts_11"></a>· src/isObject.ts</h6> 
<pre><code class="prism language-javascript"><span class="token comment">/**
 * @description 判断是否为对象
 * @param {*} variable
 * @returns {Boolean}
 */</span>
<span class="token keyword">function</span> <span class="token function">isObject</span><span class="token punctuation">(</span><span class="token parameter"><span class="token literal-property property">variable</span><span class="token operator">:</span> any</span><span class="token punctuation">)</span><span class="token operator">:</span> boolean <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>variable<span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token string">'[object Object]'</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> isObject
</code></pre> 
<h3><a id="Rollup_25"></a>二、配置Rollup打包</h3> 
<ul><li>1、安装rollup和typescript <code>npm install rollup typescript -D</code></li><li>2、创建 <code>tsconfig.json</code> 配置文件：</li></ul> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"target"</span><span class="token operator">:</span> <span class="token string">"es5"</span> <span class="token comment">/* 编译目标 */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span> <span class="token comment">/* 项目模块类型 */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"ES2018"</span><span class="token punctuation">,</span> <span class="token string">"DOM"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token string-property property">"allowJs"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">/* 是否允许js代码 */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"checkJs"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">/* 检查js代码错误 */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"declaration"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">/* 自动创建声明文件(.d.ts) */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"declarationDir"</span><span class="token operator">:</span> <span class="token string">"./lib/types"</span> <span class="token comment">/* 声明文件目录 */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">/* 自动生成sourcemap文件 */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"outDir"</span><span class="token operator">:</span> <span class="token string">"lib"</span> <span class="token comment">/* 编译输出目录 */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"rootDir"</span><span class="token operator">:</span> <span class="token string">"./src"</span> <span class="token comment">/* 项目源码根目录，用来控制编译输出的目录结构 */</span><span class="token punctuation">,</span>
        <span class="token string-property property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">/* 启用严格模式 */</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"src/*.ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"node_modules"</span><span class="token punctuation">,</span> <span class="token string">"lib"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>3、安装rollup插件<br> · 处理路径 <code>npm install @rollup/plugin-node-resolve -D</code><br> · 支持ts <code>npm install @rollup/plugin-typescript -D</code><br> · 处理commonjs <code>npm install @rollup/plugin-commonjs -D</code><br> · 压缩umd规范的输出文件 <code>npm install @rollup/plugin-terser -D</code><br> · 重新打包代码清理 <code>npm install rollup-plugin-delete -D</code></li><li>4、创建 <code>rollup.config.js</code> 配置文件：</li></ul> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> resolve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@rollup/plugin-node-resolve'</span><span class="token punctuation">)</span> <span class="token comment">// 处理npm包的相关引入依赖</span>
<span class="token keyword">const</span> typescript <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@rollup/plugin-typescript'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> commonjs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@rollup/plugin-commonjs'</span><span class="token punctuation">)</span> <span class="token comment">// 将commonJS的语法转化成ES2015 Module</span>
<span class="token keyword">const</span> terser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@rollup/plugin-terser'</span><span class="token punctuation">)</span> <span class="token comment">// 代码压缩</span>
<span class="token keyword">const</span> del <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'rollup-plugin-delete'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">input</span><span class="token operator">:</span> <span class="token string">'./src/index.ts'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'lib'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'cjs'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">'[name].cjs.js'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否输出sourcemap</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'lib'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'esm'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">'[name].esm.js'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否输出sourcemap</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">dir</span><span class="token operator">:</span> <span class="token string">'lib'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">format</span><span class="token operator">:</span> <span class="token string">'umd'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">entryFileNames</span><span class="token operator">:</span> <span class="token string">'[name].umd.js'</span><span class="token punctuation">,</span>
                <span class="token literal-property property">name</span><span class="token operator">:</span> <span class="token string">'Umob'</span><span class="token punctuation">,</span> <span class="token comment">// umd模块名称，自动挂载至window</span>
                <span class="token literal-property property">sourcemap</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token function">terser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token function">del</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">targets</span><span class="token operator">:</span> <span class="token string">'lib/*'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">commonjs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">typescript</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token string">'ESNext'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> 
<ul><li>5、在package.json配置的scripts中增加构建脚本 <code>"build": "rollup -c"</code></li><li>6、执行 <code>npm run build</code></li></ul> 
<h3><a id="_98"></a>三、手动发布</h3> 
<ul><li>1、完善配置文件</li></ul> 
<h6><a id="_npmignore_100"></a>· .npmignore</h6> 
<pre><code class="prism language-shell">src/
node_modules/
.babelrc
.gitignore
</code></pre> 
<h6><a id="_packagejson_107"></a>· package.json</h6> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
	<span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"your project name"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token string">"your project description"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"browser"</span><span class="token operator">:</span> <span class="token string">"lib/index.esm.js"</span><span class="token punctuation">,</span> <span class="token comment">// umd规范</span>
	<span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"lib/index.esm.js"</span><span class="token punctuation">,</span> <span class="token comment">// 使用esm时，会使用这个包</span>
	<span class="token string-property property">"jsnext:main"</span><span class="token operator">:</span> <span class="token string">"lib/index.esm.js"</span><span class="token punctuation">,</span>  <span class="token comment">// 社区规范</span>
	<span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"lib/index.cjs.js"</span><span class="token punctuation">,</span> <span class="token comment">// 当使用commonjs规范时会使用这个包</span>
	<span class="token string-property property">"types"</span><span class="token operator">:</span> <span class="token string">"lib/types/index.d.ts"</span><span class="token punctuation">,</span> <span class="token comment">// ts类型文件</span>
	<span class="token string-property property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lib"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 用于约定在发包的时候NPM 会发布包含的文件和文件夹。</span>
	<span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"rollup -c"</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string-property property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
		<span class="token string">"modules"</span><span class="token punctuation">,</span>
		<span class="token string">"stdlib"</span><span class="token punctuation">,</span>
		<span class="token string">"util"</span>
	<span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token string-property property">"author"</span><span class="token operator">:</span> <span class="token string">"Unknow"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"@rollup/plugin-commonjs"</span><span class="token operator">:</span> <span class="token string">"^25.0.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@rollup/plugin-node-resolve"</span><span class="token operator">:</span> <span class="token string">"^15.1.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@rollup/plugin-terser"</span><span class="token operator">:</span> <span class="token string">"^0.4.3"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@rollup/plugin-typescript"</span><span class="token operator">:</span> <span class="token string">"^11.1.1"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"rollup"</span><span class="token operator">:</span> <span class="token string">"^3.23.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"rollup-plugin-delete"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"tslib"</span><span class="token operator">:</span> <span class="token string">"^2.5.2"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"typescript"</span><span class="token operator">:</span> <span class="token string">"~5.0.4"</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string-property property">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"git"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"url"</span><span class="token operator">:</span> <span class="token string">"https://github.com/xxx.git"</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>2、登陆npm账号(没有去官网注册一个) <code>npm login</code></li><li>3、查看是否登录成功 <code>npm who am i</code></li><li>4、将包推送至服务器 <code>npm publish</code></li><li>5、package中的name不可与他人重复，否则会提示权限问题。如果使用<code>@[scope]/package</code>的命名形式，[scope]需要填账户名称</li></ul> 
<h3><a id="jest_150"></a>四、安装jest单元测试</h3> 
<ul><li>1、安装 <code>install jest ts-jest @types/jest jest-environment-jsdom -D</code></li><li>2、根目录下新增配置文件:</li></ul> 
<h6><a id="_jestconfigjs_153"></a>· .jest.config.js</h6> 
<pre><code class="prism language-javascript"><span class="token comment">/** @type {import('ts-jest').JestConfigWithTsJest} */</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
	<span class="token literal-property property">preset</span><span class="token operator">:</span> <span class="token string">'ts-jest'</span><span class="token punctuation">,</span>
	<span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">'jsdom'</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">clearMocks</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">collectCoverage</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">coverageDirectory</span><span class="token operator">:</span> <span class="token string">'coverage'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">coverageProvider</span><span class="token operator">:</span> <span class="token string">'v8'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">moduleFileExtensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"ts"</span><span class="token punctuation">,</span> <span class="token string">"js"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 配置测试环境ua</span>
    <span class="token literal-property property">testEnvironmentOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">userAgent</span><span class="token operator">:</span> <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/108.0.0.0 Safari/537.36'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>3、在 <code>package.json</code> 配置的scripts中增加测试脚本 <code>"test": "jest"</code><br> 4、编写单元测试：</p> 
<h6><a id="_src__tests__isObjecttestts_173"></a>· src/<strong>tests</strong>/isObject.test.ts</h6> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> isObject <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'../index'</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'isObject: '</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Determine the type of number'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Determine the type of string'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Determine the type of boolean'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Determine the type of array'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Determine the type of undefined'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Determine the type of null'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Determine the type of symbol'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">const</span> symbol2 <span class="token operator">=</span> <span class="token function">Symbol</span><span class="token punctuation">(</span><span class="token string">'this is symbol'</span><span class="token punctuation">)</span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span>symbol2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Determine the type of empty object'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">isObject</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>5、增加单文件单元测试命令，用于团队本地开发测试使用 <code>"test:single": "node env-dependencies.js"</code></li><li>6、在根目录下创建 <code>env-dependencies.js</code> 和 <code>.env.json</code> 文件</li></ul> 
<h6><a id="_envdependenciesjs_214"></a>· env-dependencies.js</h6> 
<pre><code class="prism language-javascript"><span class="token keyword">const</span> execSync <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'child_process'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>execSync
<span class="token keyword">const</span> pkg <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./package.json'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token constant">JSON_FILE_NAME</span> <span class="token operator">=</span> <span class="token string">'.env.json'</span>
<span class="token keyword">const</span> <span class="token constant">DEFAULT_TEST_FILE_NAME</span> <span class="token operator">=</span> <span class="token string">'isObject'</span>
<span class="token keyword">const</span> filePath <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token constant">JSON_FILE_NAME</span><span class="token punctuation">)</span> <span class="token comment">// 文件路径</span>

<span class="token comment">// 检查文件是否已存在</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">existsSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">const</span> content <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token constant">TEST_FILE_NAME</span><span class="token operator">:</span> <span class="token constant">DEFAULT_TEST_FILE_NAME</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">const</span> jsonContent <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>

	<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
		fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>filePath<span class="token punctuation">,</span> jsonContent<span class="token punctuation">,</span> <span class="token string">'utf8'</span><span class="token punctuation">)</span>
	<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">'写入文件时发生错误：'</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>pkg<span class="token punctuation">.</span>envDependencies<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> env <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> process<span class="token punctuation">.</span>env<span class="token punctuation">)</span>

<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
	Object<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span>env<span class="token punctuation">,</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./'</span> <span class="token operator">+</span> <span class="token constant">JSON_FILE_NAME</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Could not read or parse JSON_FILE_NAME.'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> pkg<span class="token punctuation">.</span>envDependencies<span class="token punctuation">.</span>params <span class="token operator">===</span> <span class="token string">'undefined'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'pkg.envDependencies.params not found or empty. Passing.'</span><span class="token punctuation">)</span>
	process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> <span class="token punctuation">(</span>
	<span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>envDependencies<span class="token punctuation">.</span>params<span class="token punctuation">)</span> <span class="token operator">||</span>
	<span class="token operator">!</span><span class="token punctuation">(</span>pkg<span class="token punctuation">.</span>envDependencies<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">every</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token keyword">typeof</span> item <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'pkg.envDependencies.params should have a signature of String[]'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> parsed <span class="token operator">=</span> pkg<span class="token punctuation">.</span>envDependencies<span class="token punctuation">.</span>params<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> item<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">${([0-9a-zA-Z_]*)}</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">_<span class="token punctuation">,</span> varName</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> env<span class="token punctuation">[</span>varName<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> env<span class="token punctuation">[</span>varName<span class="token punctuation">]</span>
	<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Could not read env variable '</span> <span class="token operator">+</span> varName <span class="token operator">+</span> <span class="token string">' in params '</span> <span class="token operator">+</span> item<span class="token punctuation">)</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">)</span>

<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
	<span class="token function">execSync</span><span class="token punctuation">(</span>parsed<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">stdio</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
	process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_envjson_276"></a>· .env.json</h6> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"TEST_FILE_NAME"</span><span class="token operator">:</span> <span class="token string">"isObject"</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="_packagejson_282"></a>· 在package.json中增加字段</h6> 
<pre><code class="prism language-json"><span class="token string-property property">"envDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"params"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jest ./src/__tests__/${TEST_FILE_NAME}.test.ts --coverage --collectCoverageFrom=./src/${TEST_FILE_NAME}.ts"</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>7、配置 <code>.gitignore</code> 和 <code>.npmignore</code>，忽略 <code>.env.json</code> 的提交</li><li>8、运行 <code>npm run test:single</code>，可测试 <code>.env.json</code> 中 <code>TEST_FILE_NAME</code> 字段配置的文件名</li></ul> 
<h3><a id="eslint_291"></a>五、安装eslint</h3> 
<ul><li>1、安装 <code>install eslint eslint-config-airbnb @typescript-eslint/eslint-plugin @typescript-eslint/parser -D</code></li><li>2、新增配置文件:</li></ul> 
<h6><a id="_eslintrcjs_294"></a>· .eslintrc.js</h6> 
<pre><code class="prism language-javascript">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">browser</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'airbnb'</span><span class="token punctuation">,</span>
        <span class="token string">'plugin:@typescript-eslint/recommended'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">'@typescript-eslint/parser'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'@typescript-eslint'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token literal-property property">NodeJS</span><span class="token operator">:</span> <span class="token string">'readonly'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">settings</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">'import/resolver'</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span> <span class="token string">'.ts'</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token literal-property property">react</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">version</span><span class="token operator">:</span> <span class="token string">'0.0.0'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 添加自定义规则</span>
        <span class="token string-property property">'no-console'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
        <span class="token string-property property">'no-debugger'</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>3、增加lint命令 <code>"lint": "eslint --ext .ts src/"</code></li><li>4、运行 <code>npm run lint</code></li><li>5、安装husky，在代码提交前自动执行eslint校验 <code>npm install husky --save-dev</code></li><li>6、启用git钩子 <code>npx husky install</code></li><li>7、向package.json文件设置prepare脚本 <code>npm pkg set scripts.prepare="husky install"</code></li><li>8、新增一个pre-commit钩子 <code>npx husky add .husky/pre-commit "npm run lint" </code></li></ul> 
<h3><a id="_337"></a>六、自动化发布</h3> 
<ul><li> <p>1、在npm中生成 Access Tokens<br> <img src="https://images2.imgbox.com/b8/7a/qnsak3T3_o.png" alt="在这里插入图片描述"></p> </li><li> <p>2、将token复制到github对应仓库的秘钥中<br> <img src="https://images2.imgbox.com/62/d1/1XdTo4A1_o.png" alt="在这里插入图片描述"></p> </li><li> <p>3、设置一个变量名 <code>NPM_ACCESS_TOKEN</code>，用于之后CI中通过 <code>secrets.NPM_ACCESS_TOKEN</code> 获取</p> </li><li> <p>4、在根目录下创建 <code>.github/workflows/node.js.yml</code> 配置文件</p> </li></ul> 
<pre><code class="prism language-shell">name: Build CI

on:
  push:
    branches: <span class="token punctuation">[</span> <span class="token string">"main"</span> <span class="token punctuation">]</span>

jobs:
  build:

    runs-on: ubuntu-latest
    
    permissions:
      contents: <span class="token function">write</span>

    strategy:
      matrix:
        node-version: <span class="token punctuation">[</span><span class="token number">16.20</span>.0<span class="token punctuation">]</span>

    steps:
      - name: 检出分支
        uses: actions/checkout@v3

      - name: 初始化缓存
        uses: actions/cache@v3
        id: cache-dependencies
        with:
          path: node_modules
          key: <span class="token variable">${<!-- -->{runner.OS}</span><span class="token punctuation">}</span>-<span class="token variable">${<!-- -->{hashFiles(\'**<span class="token operator">/</span>package-lock.json\')}</span><span class="token punctuation">}</span>

      - name: Use Node.js <span class="token variable">${<!-- -->{ matrix.node-version }</span><span class="token punctuation">}</span>
        <span class="token comment"># 使用actions/setup-node插件</span>
        uses: actions/setup-node@v3
        with:
          <span class="token comment"># node版本</span>
          node-version: <span class="token variable">${<!-- -->{ matrix.node-version }</span><span class="token punctuation">}</span>
          cache: <span class="token string">'npm'</span>
      - run: <span class="token function">npm</span> ci
      <span class="token comment"># 生成测试覆盖率</span>
      - run: <span class="token function">npm</span> run <span class="token builtin class-name">test</span>
      - run: <span class="token function">npm</span> run build
      
      - name: 上报测试覆盖率
        id: coverRate
        uses: coverallsapp/github-action@master
        with:
          github-token: <span class="token variable">${<!-- -->{ secrets.GITHUB_TOKEN }</span><span class="token punctuation">}</span>

      - name: 读取版本号
        id: version
        uses: notiz-dev/github-action-json-property@release
        with:
          <span class="token comment"># 读取版本号</span>
          path: <span class="token string">'./package.json'</span>
          prop_path: <span class="token string">'version'</span>

      - name: 打印版本号
        run: <span class="token builtin class-name">echo</span> <span class="token variable">${<!-- -->{steps.version.outputs.prop}</span><span class="token punctuation">}</span>

      - name: 创建Release
        uses: softprops/action-gh-release@v1
        with:
          files: <span class="token operator">|</span>
            ./lib/index.umd.js
            ./lib/index.esm.js
            ./lib/index.cjs.js
          name: <span class="token function">v</span><span class="token variable">${<!-- -->{steps.version.outputs.prop}</span><span class="token punctuation">}</span>
          tag_name: <span class="token function">v</span><span class="token variable">${<!-- -->{steps.version.outputs.prop}</span><span class="token punctuation">}</span>
        env:
          GITHUB_TOKEN: <span class="token variable">${<!-- -->{ secrets.GITHUB_TOKEN }</span><span class="token punctuation">}</span>

      - name: 发布NPM包
        run: <span class="token operator">|</span>
          <span class="token function">npm</span> config <span class="token builtin class-name">set</span> //registry.npmjs.org/:_authToken<span class="token operator">=</span><span class="token variable">$NPM_TOKEN</span>
          <span class="token function">npm</span> publish
        env:
          <span class="token comment"># 配置 npm access token 环境变量</span>
          NPM_TOKEN: <span class="token variable">${<!-- -->{secrets.NPM_ACCESS_TOKEN}</span><span class="token punctuation">}</span>
</code></pre> 
<h3><a id="readmebadge_425"></a>七、为readme添加测试覆盖率badge</h3> 
<ul><li>1、进入coveralls官网，授权 <a rel="nofollow">github，https://coveralls.io/</a></li><li>2、授权后点击左侧侧边栏的 <code>ADD REPOS</code>，将需要生成badge徽章的库设置为on</li><li>3、在readme中添加连接即可查看 <code>&lt;img src='https://coveralls.io/repos/github/{用户名}/{仓库名}/badge.svg?branch=main' /&gt;</code></li></ul> 
<h3><a id="_430"></a>八、整体目录结构</h3> 
<pre><code class="prism language-shell">- .github
    - workflows
        - xx.yml        <span class="token comment"># git Actions</span>
- .husky
    _
    pre-commit          <span class="token comment"># git提交钩子</span>
- src
    - __test__          <span class="token comment"># 单元测试</span>
    - index.ts          <span class="token comment"># 入口文件</span>
    - isObject.ts
- .env.json             <span class="token comment"># 环境变量配置</span>
- .eslintignore
- .eslintrc.js
- .gitignore
- .npmignore
- env-dependencies.js   <span class="token comment"># 环境变量读取脚本</span>
- jest.config.js
- package.json
- rollup.config.js
- tsconfig.json
</code></pre> 
<h3><a id="packagejson_454"></a>九、完整package.json配置</h3> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
	<span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"your project name"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.1"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"description"</span><span class="token operator">:</span> <span class="token string">"your project description"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"browser"</span><span class="token operator">:</span> <span class="token string">"lib/index.esm.js"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"lib/index.esm.js"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"jsnext:main"</span><span class="token operator">:</span> <span class="token string">"lib/index.esm.js"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"lib/index.cjs.js"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"types"</span><span class="token operator">:</span> <span class="token string">"lib/types/index.d.ts"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"lib"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"lint"</span><span class="token operator">:</span> <span class="token string">"eslint --ext .ts src/"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"rollup -c"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"test"</span><span class="token operator">:</span> <span class="token string">"jest"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"test:single"</span><span class="token operator">:</span> <span class="token string">"node env-dependencies.js"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"prepare"</span><span class="token operator">:</span> <span class="token string">"husky install"</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string-property property">"envDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"params"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"jest ./src/__tests__/${TEST_FILE_NAME}.test.ts --coverage --collectCoverageFrom=./src/${TEST_FILE_NAME}.ts"</span><span class="token punctuation">]</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string-property property">"keywords"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"modules"</span><span class="token punctuation">,</span> <span class="token string">"stdlib"</span><span class="token punctuation">,</span> <span class="token string">"util"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
	<span class="token string-property property">"author"</span><span class="token operator">:</span> <span class="token string">"Unknow"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"license"</span><span class="token operator">:</span> <span class="token string">"MIT"</span><span class="token punctuation">,</span>
	<span class="token string-property property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"@rollup/plugin-commonjs"</span><span class="token operator">:</span> <span class="token string">"^25.0.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@rollup/plugin-node-resolve"</span><span class="token operator">:</span> <span class="token string">"^15.1.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@rollup/plugin-terser"</span><span class="token operator">:</span> <span class="token string">"^0.4.3"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@rollup/plugin-typescript"</span><span class="token operator">:</span> <span class="token string">"^11.1.1"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@types/jest"</span><span class="token operator">:</span> <span class="token string">"^29.5.2"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@typescript-eslint/eslint-plugin"</span><span class="token operator">:</span> <span class="token string">"^5.59.9"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"@typescript-eslint/parser"</span><span class="token operator">:</span> <span class="token string">"^5.59.9"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"babel-jest"</span><span class="token operator">:</span> <span class="token string">"^29.5.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"eslint"</span><span class="token operator">:</span> <span class="token string">"^8.42.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"eslint-config-airbnb"</span><span class="token operator">:</span> <span class="token string">"^19.0.4"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"husky"</span><span class="token operator">:</span> <span class="token string">"^8.0.3"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"jest"</span><span class="token operator">:</span> <span class="token string">"^29.5.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"jest-environment-jsdom"</span><span class="token operator">:</span> <span class="token string">"^29.5.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"rollup"</span><span class="token operator">:</span> <span class="token string">"^3.23.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"rollup-plugin-delete"</span><span class="token operator">:</span> <span class="token string">"^2.0.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"ts-jest"</span><span class="token operator">:</span> <span class="token string">"^29.1.0"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"tslib"</span><span class="token operator">:</span> <span class="token string">"^2.5.2"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"typescript"</span><span class="token operator">:</span> <span class="token string">"~5.0.4"</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token string-property property">"repository"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
		<span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"git"</span><span class="token punctuation">,</span>
		<span class="token string-property property">"url"</span><span class="token operator">:</span> <span class="token string">"https://github.com/xxx.git"</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="References_506"></a>References</h3> 
<p>[1] <a href="https://segmentfault.com/a/1190000043133254" rel="nofollow">使用Typescript和Rollup从零开发一个工具库</a></p> 
<p>[2] <a href="https://blog.csdn.net/weixin_51499232/article/details/124940480">一篇文章教会你如何在npm上传自己的包</a></p> 
<p>[3] <a href="https://zhuanlan.zhihu.com/p/638039824" rel="nofollow">husky工具介绍</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5dd897b2cb6f5b35ec2da2d4e2704c8f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">springboot整合websocket实现聊天室对话</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/547cc26edbee8f70c726d74a0c5c60a1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">如何设计企业级业务流程？学习华为的流程六级分类经验</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>