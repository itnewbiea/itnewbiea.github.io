<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C#简化工作之实现网页爬虫获取数据 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C#简化工作之实现网页爬虫获取数据" />
<meta property="og:description" content="1、需求 想要获取网站上所有的气象信息，网站如下所示：
目前总共有67页，随便点开一个如下所示：
需要获取所有天气数据，如果靠一个个点开再一个个复制粘贴那么也不知道什么时候才能完成，这个时候就可以使用C#来实现网页爬虫获取这些数据。
2、效果 先来看下实现的效果，所有数据都已存入数据库中，如下所示：
总共有4万多条数据。
3、具体实现 构建每一页的URL 第一页的网址如下所示：
最后一页的网址如下所示：
可以发现是有规律的，那么就可以先尝试构建出每个页面的URL
// 发送 GET 请求 string url = &#34;https://cj.msa.gov.cn/xxgk/xxgkml/aqxx/qxyg/&#34;; HttpResponseMessage response = await httpClient.GetAsync(url); // 处理响应 if (response.IsSuccessStatusCode) { string responseBody = await response.Content.ReadAsStringAsync(); doc.LoadHtml(responseBody); //获取需要的数据所在的节点 var node = doc.DocumentNode.SelectSingleNode(&#34;//div[@class=\&#34;page\&#34;]/script&#34;); string rawText = node.InnerText.Trim(); // 使用正则表达式来匹配页数数据 Regex regex = new Regex(@&#34;\b(\d&#43;)\b&#34;); Match match = regex.Match(rawText); if (match.Success) { string pageNumber = match.Groups[1].Value; Urls = GetUrls(Convert.ToInt32(pageNumber)); MessageBox.Show($&#34;获取每个页面的URL成功，总页面数为：{Urls.Length}&#34;); } } //构造每一页的URL public string[] GetUrls(int pageNumber) { string[] urls = new string[pageNumber]; for (int i = 0; i &lt; urls." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9cc05af381dd7b510aaed7bea7c4ddb9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-28T09:45:47+08:00" />
<meta property="article:modified_time" content="2023-11-28T09:45:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C#简化工作之实现网页爬虫获取数据</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1_0"></a>1、需求</h3> 
<p>想要获取网站上所有的气象信息，网站如下所示：</p> 
<p><img src="https://images2.imgbox.com/50/b8/7aGRXcXq_o.png" alt="image-20231127193134632"></p> 
<p>目前总共有67页，随便点开一个如下所示：</p> 
<p><img src="https://images2.imgbox.com/48/73/fZj6IOJe_o.png" alt="image-20231127193254040"></p> 
<p>需要获取所有天气数据，如果靠一个个点开再一个个复制粘贴那么也不知道什么时候才能完成，这个时候就可以使用C#来实现网页爬虫获取这些数据。</p> 
<h3><a id="2_12"></a>2、效果</h3> 
<p>先来看下实现的效果，所有数据都已存入数据库中，如下所示：</p> 
<p><img src="https://images2.imgbox.com/82/37/VjYYQKCS_o.png" alt="image-20231127193726966"></p> 
<p>总共有4万多条数据。</p> 
<h3><a id="3_20"></a>3、具体实现</h3> 
<h4><a id="URL_22"></a>构建每一页的URL</h4> 
<p>第一页的网址如下所示：</p> 
<p><img src="https://images2.imgbox.com/61/75/EslWsvNk_o.png" alt="image-20231127194211474"></p> 
<p>最后一页的网址如下所示：</p> 
<p><img src="https://images2.imgbox.com/1f/10/SeqS7la1_o.png" alt="image-20231127195622290"></p> 
<p>可以发现是有规律的，那么就可以先尝试构建出每个页面的URL</p> 
<pre><code class="prism language-csharp">    <span class="token comment">// 发送 GET 请求</span>
    <span class="token class-name"><span class="token keyword">string</span></span> url <span class="token operator">=</span> <span class="token string">"https://cj.msa.gov.cn/xxgk/xxgkml/aqxx/qxyg/"</span><span class="token punctuation">;</span>
    <span class="token class-name">HttpResponseMessage</span> response <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 处理响应</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>IsSuccessStatusCode<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name"><span class="token keyword">string</span></span> responseBody <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        doc<span class="token punctuation">.</span><span class="token function">LoadHtml</span><span class="token punctuation">(</span>responseBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//获取需要的数据所在的节点</span>
        <span class="token class-name"><span class="token keyword">var</span></span> node <span class="token operator">=</span> doc<span class="token punctuation">.</span>DocumentNode<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">"//div[@class=\"page\"]/script"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name"><span class="token keyword">string</span></span> rawText <span class="token operator">=</span> node<span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用正则表达式来匹配页数数据</span>
        <span class="token class-name">Regex</span> regex <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Regex</span><span class="token punctuation">(</span><span class="token string">@"\b(\d+)\b"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Match</span> match <span class="token operator">=</span> regex<span class="token punctuation">.</span><span class="token function">Match</span><span class="token punctuation">(</span>rawText<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">.</span>Success<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> pageNumber <span class="token operator">=</span> match<span class="token punctuation">.</span>Groups<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>Value<span class="token punctuation">;</span>
            Urls <span class="token operator">=</span> <span class="token function">GetUrls</span><span class="token punctuation">(</span>Convert<span class="token punctuation">.</span><span class="token function">ToInt32</span><span class="token punctuation">(</span>pageNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"获取每个页面的URL成功，总页面数为：</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">Urls<span class="token punctuation">.</span>Length</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

    <span class="token punctuation">}</span>

 <span class="token comment">//构造每一页的URL</span>
 <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> <span class="token function">GetUrls</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> pageNumber<span class="token punctuation">)</span>
 <span class="token punctuation">{<!-- --></span>
     <span class="token class-name"><span class="token keyword">string</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> urls <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name"><span class="token keyword">string</span></span><span class="token punctuation">[</span>pageNumber<span class="token punctuation">]</span><span class="token punctuation">;</span>
     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> urls<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
     <span class="token punctuation">{<!-- --></span>
         <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
         <span class="token punctuation">{<!-- --></span>
             urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"https://cj.msa.gov.cn/xxgk/xxgkml/aqxx/qxyg/index.shtml"</span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
         <span class="token keyword">else</span>
         <span class="token punctuation">{<!-- --></span>
             urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token interpolation-string"><span class="token string">$"https://cj.msa.gov.cn/xxgk/xxgkml/aqxx/qxyg/index_</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">i</span><span class="token punctuation">}</span></span><span class="token string">.shtml"</span></span><span class="token punctuation">;</span>
         <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
     <span class="token keyword">return</span> urls<span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
</code></pre> 
<p>这里使用了HtmlAgilityPack</p> 
<p><img src="https://images2.imgbox.com/06/d2/z0vT07di_o.png" alt="image-20231127195928840"></p> 
<p><code>HtmlAgilityPack（HAP）</code>是一个用于处理HTML文档的.NET库。它允许你方便地从HTML文档中提取信息，修改HTML结构，并执行其他HTML文档相关的操作。HtmlAgilityPack 提供了一种灵活而强大的方式来解析和处理HTML，使得在.NET应用程序中进行网页数据提取和处理变得更加容易。</p> 
<pre><code class="prism language-csharp"> <span class="token comment">// 使用HtmlAgilityPack解析网页内容</span>
 <span class="token class-name"><span class="token keyword">var</span></span> doc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">HtmlAgilityPack<span class="token punctuation">.</span>HtmlDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 doc<span class="token punctuation">.</span><span class="token function">LoadHtml</span><span class="token punctuation">(</span><span class="token string">"需要解析的Html"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token comment">//获取需要的数据所在的节点</span>
<span class="token class-name"><span class="token keyword">var</span></span> node <span class="token operator">=</span> doc<span class="token punctuation">.</span>DocumentNode<span class="token punctuation">.</span><span class="token function">SelectSingleNode</span><span class="token punctuation">(</span><span class="token string">"XPath"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>那么XPath是什么呢？</p> 
<p><code>XPath（XML Path Language）</code>是一种用于在XML文档中定位和选择节点的语言。它是W3C（World Wide Web Consortium）的标准，通常用于在XML文档中执行查询操作。XPath提供了一种简洁而强大的方式来导航和操作XML文档的内容。</p> 
<h4><a id="URL_96"></a>构建每一天的URL</h4> 
<p>获取到了每一页的URL之后，我们发现在每一页的URL都可以获取关于每一天的URL信息，如下所示：</p> 
<p><img src="https://images2.imgbox.com/a6/33/5TchtHS6_o.png" alt="image-20231127201037439"></p> 
<p>可以进一步构建每一天的URL，同时可以根据a的文本获取时间，当然也可以通过其他方式获取时间，但是这种可以获取到11点或者17点。</p> 
<p>代码如下所示：</p> 
<pre><code class="prism language-csharp">    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> Urls<span class="token punctuation">.</span>Length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 发送 GET 请求</span>
        <span class="token class-name"><span class="token keyword">string</span></span> url2 <span class="token operator">=</span> Urls<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpResponseMessage</span> response2 <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span>url2<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理响应</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response2<span class="token punctuation">.</span>IsSuccessStatusCode<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> responseBody2 <span class="token operator">=</span> <span class="token keyword">await</span> response2<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            doc<span class="token punctuation">.</span><span class="token function">LoadHtml</span><span class="token punctuation">(</span>responseBody2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> nodes <span class="token operator">=</span> doc<span class="token punctuation">.</span>DocumentNode<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">"//div[@class=\"lie\"]/ul/li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> nodes<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> name <span class="token operator">=</span> nodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>ChildNodes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">;</span>
                <span class="token comment">//只有name符合下面的格式才能成功转换为时间，所以这里需要有一个判断</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>name <span class="token operator">!=</span> <span class="token string">""</span> <span class="token operator">&amp;&amp;</span> name<span class="token punctuation">.</span><span class="token function">Contains</span><span class="token punctuation">(</span><span class="token string">"气象预告"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name"><span class="token keyword">var</span></span> dayUrl <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DayUrl</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//string format;</span>
                    <span class="token comment">//DateTime date;</span>
                    <span class="token comment">// 定义日期时间格式</span>
                    <span class="token class-name"><span class="token keyword">string</span></span> format <span class="token operator">=</span> <span class="token string">"yyyy年M月d日H点气象预告"</span><span class="token punctuation">;</span>
                    <span class="token comment">// 解析字符串为DateTime</span>
                    <span class="token class-name">DateTime</span> date <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">ParseExact</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> format<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">var</span></span> a <span class="token operator">=</span> nodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>ChildNodes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">string</span></span> urlText <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">GetAttributeValue</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">string</span></span> newValue <span class="token operator">=</span> <span class="token string">"https://cj.msa.gov.cn/xxgk/xxgkml/aqxx/qxyg/"</span><span class="token punctuation">;</span>
                    <span class="token class-name"><span class="token keyword">string</span></span> realUrl <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                    realUrl <span class="token operator">=</span> newValue <span class="token operator">+</span> urlText<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    dayUrl<span class="token punctuation">.</span>Date <span class="token operator">=</span> date<span class="token punctuation">;</span>
                    dayUrl<span class="token punctuation">.</span>Url <span class="token operator">=</span> realUrl<span class="token punctuation">;</span>
                    dayUrlList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>dayUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"在</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">name</span><span class="token punctuation">}</span></span><span class="token string">处，判断不符合要求"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将数据存入SQLite数据库</span>
    db<span class="token punctuation">.</span><span class="token function">Insertable</span><span class="token punctuation">(</span>dayUrlList<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"获取每天的URL成功，共有</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">dayUrlList<span class="token punctuation">.</span>Count</span><span class="token punctuation">}</span></span><span class="token string">条"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这一步骤需要注意的是XPath的书写，以及每一天URL的构建，以及时间的获取。</p> 
<p>XPath的书写：</p> 
<pre><code class="prism language-csharp"> <span class="token class-name"><span class="token keyword">var</span></span> nodes <span class="token operator">=</span> doc<span class="token punctuation">.</span>DocumentNode<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">"//div[@class=\"lie\"]/ul/li"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>表示一个类名为"lie"的div下的ul标签下的所有li标签，如下所示：</p> 
<p><img src="https://images2.imgbox.com/80/65/ISw0cn82_o.png" alt="image-20231127201558734"></p> 
<p>构建每一天的URL：</p> 
<pre><code class="prism language-csharp"> <span class="token class-name"><span class="token keyword">var</span></span> a <span class="token operator">=</span> nodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>ChildNodes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
 <span class="token class-name"><span class="token keyword">string</span></span> urlText <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">GetAttributeValue</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name"><span class="token keyword">string</span></span> newValue <span class="token operator">=</span> <span class="token string">"https://cj.msa.gov.cn/xxgk/xxgkml/aqxx/qxyg/"</span><span class="token punctuation">;</span>
 <span class="token class-name"><span class="token keyword">string</span></span> realUrl <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
 realUrl <span class="token operator">=</span> newValue <span class="token operator">+</span> urlText<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里获取li标签下的a标签，如下所示：</p> 
<p><img src="https://images2.imgbox.com/59/af/VGxDAf34_o.png" alt="image-20231127201814284"></p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">string</span></span> urlText <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">GetAttributeValue</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这段代码获取a标签中href属性的值，这里是./202311/t20231127_3103490.shtml。</p> 
<pre><code class="prism language-csharp"> <span class="token class-name"><span class="token keyword">string</span></span> urlText <span class="token operator">=</span> a<span class="token punctuation">.</span><span class="token function">GetAttributeValue</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token class-name"><span class="token keyword">string</span></span> newValue <span class="token operator">=</span> <span class="token string">"https://cj.msa.gov.cn/xxgk/xxgkml/aqxx/qxyg/"</span><span class="token punctuation">;</span>
 <span class="token class-name"><span class="token keyword">string</span></span> realUrl <span class="token operator">=</span>  newValue <span class="token operator">+</span> urlText<span class="token punctuation">.</span><span class="token function">Substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里是在拼接每一天的URL。</p> 
<pre><code class="prism language-csharp"><span class="token class-name"><span class="token keyword">var</span></span> name <span class="token operator">=</span> nodes<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span>ChildNodes<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">;</span>
 <span class="token comment">// 定义日期时间格式</span>
<span class="token class-name"><span class="token keyword">string</span></span> format <span class="token operator">=</span> <span class="token string">"yyyy年M月d日H点气象预告"</span><span class="token punctuation">;</span>
 <span class="token comment">// 解析字符串为DateTime</span>
<span class="token class-name">DateTime</span> date <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">ParseExact</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> format<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里是从文本中获取时间，比如文本的值也就是name的值为：“2023年7月15日17点气象预告”，name获得的date就是2023-7-15 17：00。</p> 
<pre><code class="prism language-csharp">    <span class="token comment">// 将数据存入SQLite数据库</span>
    db<span class="token punctuation">.</span><span class="token function">Insertable</span><span class="token punctuation">(</span>dayUrlList<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"获取每天的URL成功，共有</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">dayUrlList<span class="token punctuation">.</span>Count</span><span class="token punctuation">}</span></span><span class="token string">条"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里是将数据存入数据库中，ORM使用的是SQLSugar，类DayUrl如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">DayUrl</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SugarColumn</span><span class="token attribute-arguments"><span class="token punctuation">(</span>IsPrimaryKey <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> IsIdentity <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> Date <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Url <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最后获取每一天URL的效果如下所示：</p> 
<p><img src="https://images2.imgbox.com/dd/9a/5KXBH2wq_o.png" alt="image-20231127202711471"></p> 
<h4><a id="_226"></a>获取温度数据</h4> 
<p>需要获取的内容如下：</p> 
<p><img src="https://images2.imgbox.com/bb/40/gV2WWxrJ_o.png" alt="image-20231127202852536"></p> 
<p>设计对应的类如下：</p> 
<pre><code class="prism language-csharp"><span class="token keyword">internal</span> <span class="token keyword">class</span> <span class="token class-name">WeatherData</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SugarColumn</span><span class="token attribute-arguments"><span class="token punctuation">(</span>IsPrimaryKey <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> IsIdentity <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> StationName <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Weather <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Tem_Low <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Tem_High <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Wind <span class="token punctuation">{<!-- --></span>  <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Visibility_Low <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Visibility_High <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Fog <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span><span class="token punctuation">?</span></span> Haze <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> Date <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>增加了一个时间，方便以后根据时间获取。</p> 
<p>获取温度数据的代码如下：</p> 
<pre><code class="prism language-csharp">    <span class="token class-name"><span class="token keyword">var</span></span> list <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Queryable</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>DayUrl<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> list<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpResponseMessage</span> response <span class="token operator">=</span> <span class="token keyword">await</span> httpClient<span class="token punctuation">.</span><span class="token function">GetAsync</span><span class="token punctuation">(</span>list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Url<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理响应</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>IsSuccessStatusCode<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token class-name"><span class="token keyword">string</span></span> responseBody2 <span class="token operator">=</span> <span class="token keyword">await</span> response<span class="token punctuation">.</span>Content<span class="token punctuation">.</span><span class="token function">ReadAsStringAsync</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            doc<span class="token punctuation">.</span><span class="token function">LoadHtml</span><span class="token punctuation">(</span>responseBody2<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name"><span class="token keyword">var</span></span> nodes <span class="token operator">=</span> doc<span class="token punctuation">.</span>DocumentNode<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">"//table"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>nodes <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token class-name"><span class="token keyword">var</span></span> table <span class="token operator">=</span> nodes<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                <span class="token class-name"><span class="token keyword">var</span></span> trs <span class="token operator">=</span> table<span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">"tbody/tr"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">int</span></span> j <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> trs<span class="token punctuation">.</span>Count<span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token class-name"><span class="token keyword">var</span></span> tds <span class="token operator">=</span> trs<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">SelectNodes</span><span class="token punctuation">(</span><span class="token string">"td"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">switch</span> <span class="token punctuation">(</span>tds<span class="token punctuation">.</span>Count<span class="token punctuation">)</span>
                    <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">case</span> <span class="token number">8</span><span class="token punctuation">:</span>
                            <span class="token class-name"><span class="token keyword">var</span></span> wd8 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeatherData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    wd8<span class="token punctuation">.</span>StationName <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd8<span class="token punctuation">.</span>Weather <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd8<span class="token punctuation">.</span>Tem_Low <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd8<span class="token punctuation">.</span>Tem_High <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd8<span class="token punctuation">.</span>Wind <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd8<span class="token punctuation">.</span>Visibility_Low <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd8<span class="token punctuation">.</span>Visibility_High <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd8<span class="token punctuation">.</span>Fog <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd8<span class="token punctuation">.</span>Date <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Date<span class="token punctuation">;</span>
                            weatherDataList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>wd8<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">case</span> <span class="token number">9</span><span class="token punctuation">:</span>
                            <span class="token class-name"><span class="token keyword">var</span></span> wd9 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">WeatherData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>StationName <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Weather <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Tem_Low <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Tem_High <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Wind <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Visibility_Low <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Visibility_High <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Fog <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Haze <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            wd9<span class="token punctuation">.</span>Date <span class="token operator">=</span> list<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>Date<span class="token punctuation">;</span>
                            weatherDataList<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>wd9<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token keyword">default</span><span class="token punctuation">:</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>


                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">else</span>
            <span class="token punctuation">{<!-- --></span>
                
              
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 输出进度提示</span>
        Debug<span class="token punctuation">.</span><span class="token function">WriteLine</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"已处理完成第</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">i</span><span class="token punctuation">}</span></span><span class="token string">个URL"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 将数据存入SQLite数据库</span>
    db<span class="token punctuation">.</span><span class="token function">Insertable</span><span class="token punctuation">(</span>weatherDataList<span class="token punctuation">.</span><span class="token function">OrderBy</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> x<span class="token punctuation">.</span>Date<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    MessageBox<span class="token punctuation">.</span><span class="token function">Show</span><span class="token punctuation">(</span><span class="token interpolation-string"><span class="token string">$"获取天气数据成功，共有</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span><span class="token expression language-csharp">weatherDataList<span class="token punctuation">.</span>Count</span><span class="token punctuation">}</span></span><span class="token string">条"</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>这里使用swith case是因为网页的格式并不是一层不变的，有时候少了一列，没有霾的数据。</p> 
<pre><code class="prism language-csharp"> wd9<span class="token punctuation">.</span>StationName <span class="token operator">=</span> tds<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>InnerText<span class="token punctuation">.</span><span class="token function">Trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">"&amp;nbsp;"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里对文本进行这样处理是因为原始的数据是“\n内容&amp;nbsp\n”,C#中String.Trim()方法会删除字符串前后的空白，string.Replace(“a”,“b”)方法会将字符串中的a换成b。</p> 
<p>效果如下所示：</p> 
<p><img src="https://images2.imgbox.com/2c/2c/uR4lTBfW_o.png" alt="image-20231127204509544"></p> 
<p><img src="https://images2.imgbox.com/88/2d/6M3SRIkJ_o.png" alt="image-20231127204629667"></p> 
<p>将数据全部都存入数据库中了。</p> 
<h3><a id="4_342"></a>4、最后</h3> 
<p>通过这个实例说明了其实C#也是可以实现网页爬虫的，对于没有反爬的情况下是完全适用的，再配合linq做数据处理也是可以的。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/18bdcd886258a26dc449c41da52f4791/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Javaweb家庭理财管理系统(SSM&#43;layui&#43;Mysql)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8b005411952006863178e2d1fa09944e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">DDD全网最通俗易懂讲解（二）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>