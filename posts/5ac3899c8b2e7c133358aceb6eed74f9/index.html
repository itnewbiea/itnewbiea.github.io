<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>模型训练出现 loss = nan - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="模型训练出现 loss = nan" />
<meta property="og:description" content="问题：模型不管怎么调参数，损失均为 nan 换了模型层，换了损失函数，还检查了 loss 的计算方式。还在其他地方验证了 loss 计算正确。
问题定位： 我是在对数据集做了新的不同预处理才出现问题的，训练以前的预处理数据集不会出现此情况。
1.排除预处理 -------将保留两位小数注释掉，仍然出现 loss = nan，说明小数点不是引起的问题的关键原因
2.排除预处理 -------滤波函数注释掉，不会出现 loss = nan，说明问题出现在滤波函数。
3.排除特别信号--------引入单个信号不会出现 loss 问题，引入整个数据集出现 loss = nan，说明可能是某段信号出现问题或者模型拟合不了整个数据集。
重新预处理数据集进行滤波，发现数据集中某个信号会出现代码警告，当时以为问题不大现在看就是这里的问题：
04015采集完成 44001 44001 C:\Users\xxx\.conda\envs\py110_py38\lib\site-packages\pywt\_thresholding.py:23: RuntimeWarning: invalid value encountered in true_divide thresholded = (1 - value/magnitude) 04043采集完成 105912 105912 现在将出现问题的信号04043 隔离训练。
发现只要将 04043号信号送入模型就会出现 loss = nan，其他信号均不会出现 loss = nan
解决问题 进入报错位置，思考是 小波变换库 pywt 阈值函数出现了问题，下面第三行代码处，出现了 除 0错误。
# 进入文件 .conda\envs\py110_py38\lib\site-packages\pywt\_thresholding.py:23 # 查看代码 with np.errstate(divide=&#39;ignore&#39;): # divide by zero okay as np." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5ac3899c8b2e7c133358aceb6eed74f9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-21T15:33:08+08:00" />
<meta property="article:modified_time" content="2023-12-21T15:33:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">模型训练出现 loss = nan</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_nan_0"></a>问题：模型不管怎么调参数，损失均为 nan</h2> 
<p>换了模型层，换了损失函数，还检查了 loss 的计算方式。还在其他地方验证了 loss 计算正确。</p> 
<center> 
 <img src="https://images2.imgbox.com/e8/70/KUxp4742_o.png" width="60%"> 
 <center> 
 </center> 
</center> 
<h2><a id="_5"></a>问题定位：</h2> 
<p>我是在对数据集做了新的不同预处理才出现问题的，训练以前的预处理数据集不会出现此情况。<br> 1.排除预处理 -------将保留两位小数注释掉，仍然出现 loss = nan，说明小数点不是引起的问题的关键原因<br> 2.排除预处理 -------滤波函数注释掉，不会出现 loss = nan，说明问题出现在滤波函数。<br> 3.排除特别信号--------引入单个信号不会出现 loss 问题，引入整个数据集出现 loss = nan，说明可能是某段信号出现问题或者模型拟合不了整个数据集。</p> 
<p>重新预处理数据集进行滤波，发现数据集中某个信号会出现代码警告，当时以为问题不大现在看就是这里的问题：</p> 
<pre><code class="prism language-python"><span class="token number">04015</span>采集完成  <span class="token number">44001</span>  <span class="token number">44001</span>
C<span class="token punctuation">:</span>\Users\xxx\<span class="token punctuation">.</span>conda\envs\py110_py38\lib\site<span class="token operator">-</span>packages\pywt\_thresholding<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">23</span><span class="token punctuation">:</span> RuntimeWarning<span class="token punctuation">:</span> invalid value encountered <span class="token keyword">in</span> true_divide
  thresholded <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> value<span class="token operator">/</span>magnitude<span class="token punctuation">)</span>
<span class="token number">04043</span>采集完成  <span class="token number">105912</span>  <span class="token number">105912</span>
</code></pre> 
<p>现在将出现问题的信号04043 隔离训练。<br> 发现只要将 04043号信号送入模型就会出现 loss = nan，其他信号均不会出现 loss = nan</p> 
<h2><a id="_21"></a>解决问题</h2> 
<p>进入报错位置，思考是 小波变换库 pywt 阈值函数出现了问题，下面第三行代码处，出现了 除 0错误。</p> 
<pre><code class="prism language-python">  <span class="token comment"># 进入文件</span>
<span class="token punctuation">.</span>conda\envs\py110_py38\lib\site<span class="token operator">-</span>packages\pywt\_thresholding<span class="token punctuation">.</span>py<span class="token punctuation">:</span><span class="token number">23</span>

  <span class="token comment"># 查看代码</span>
<span class="token keyword">with</span> np<span class="token punctuation">.</span>errstate<span class="token punctuation">(</span>divide<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># divide by zero okay as np.inf values get clipped, so ignore warning.</span>
    thresholded <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> value<span class="token operator">/</span>magnitude<span class="token punctuation">)</span>
    thresholded<span class="token punctuation">.</span>clip<span class="token punctuation">(</span><span class="token builtin">min</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token builtin">max</span><span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> out<span class="token operator">=</span>thresholded<span class="token punctuation">)</span>
    thresholded <span class="token operator">=</span> data <span class="token operator">*</span> thresholded
   
 <span class="token comment"># 直接修改库代码</span>
 thresholded <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> value<span class="token operator">/</span>magnitude<span class="token punctuation">)</span>  修改为  thresholded <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">-</span> value<span class="token operator">/</span><span class="token punctuation">(</span>magnitude <span class="token operator">+</span> <span class="token number">1e-09</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>重新生成滤波数据集，问题解决。</p> 
<pre><code class="prism language-python"><span class="token number">04015</span>采集完成  <span class="token number">44001</span>  <span class="token number">44001</span>
<span class="token number">04043</span>采集完成  <span class="token number">105912</span>  <span class="token number">105912</span>
</code></pre> 
<p>数据集生成过程，不再报错，现在送入模型 loss 重新出现。科研的光芒！！！！！！！！</p> 
<pre><code class="prism language-python">Epoch<span class="token punctuation">:</span><span class="token number">1</span>  <span class="token punctuation">,</span> ACC on test<span class="token punctuation">:</span><span class="token number">0.3064353168</span><span class="token punctuation">,</span> loss<span class="token punctuation">:</span><span class="token number">0.0006997338</span> time<span class="token punctuation">:</span><span class="token number">111.33</span> s
Epoch<span class="token punctuation">:</span><span class="token number">2</span>  <span class="token punctuation">,</span> ACC on test<span class="token punctuation">:</span><span class="token number">0.4708186388</span><span class="token punctuation">,</span> loss<span class="token punctuation">:</span><span class="token number">0.0006386279</span> time<span class="token punctuation">:</span><span class="token number">76.33</span> s
Epoch<span class="token punctuation">:</span><span class="token number">1</span>  <span class="token punctuation">,</span> ACC on test<span class="token punctuation">:</span><span class="token number">0.6548216343</span><span class="token punctuation">,</span> loss<span class="token punctuation">:</span><span class="token number">0.0006988451</span> time<span class="token punctuation">:</span><span class="token number">92.72</span> s
Epoch<span class="token punctuation">:</span><span class="token number">2</span>  <span class="token punctuation">,</span> ACC on test<span class="token punctuation">:</span><span class="token number">0.4710667729</span><span class="token punctuation">,</span> loss<span class="token punctuation">:</span><span class="token number">0.0006125508</span> time<span class="token punctuation">:</span><span class="token number">83.54</span> s
Epoch<span class="token punctuation">:</span><span class="token number">3</span>  <span class="token punctuation">,</span> ACC on test<span class="token punctuation">:</span><span class="token number">0.9052868485</span><span class="token punctuation">,</span> loss<span class="token punctuation">:</span><span class="token number">0.0004726056</span> time<span class="token punctuation">:</span><span class="token number">84.26</span> s
</code></pre> 
<p>问题解决！！！！！！！</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/786303a7abd75a151cc7adf1980175eb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue2 之 实现pdf电子签章</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6cc41a2fa9c2d56f1456ca232f7e0020/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【案例】图片预览</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>