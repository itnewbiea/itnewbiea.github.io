<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>串口发送命令控制led灯的状态 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="串口发送命令控制led灯的状态" />
<meta property="og:description" content="uart4.h
#ifndef __UART4_H__ #define __UART4_H__ #include &#34;stm32mp1xx_rcc.h&#34; #include &#34;stm32mp1xx_gpio.h&#34; #include &#34;stm32mp1xx_uart.h&#34; //uart4初始化 void hal_uart4_init(); //发送一个字符 void put_char(const char str); //发送一个字符串 void put_string(const char* string); //接收一个字符 char get_char(); //接收一个字符串 char* get_string(); #endif gpio.h
#ifndef __GPIO_H__ #define __GPIO_H__ //寄存器封装 typedef struct{ volatile unsigned int MODER; volatile unsigned int OTYPER; volatile unsigned int OSPEEDR; volatile unsigned int PUPDR; volatile unsigned int IDR; volatile unsigned int ODR; }gpio_t1; #define GPIOE1 ((gpio_t1*)0x50006000) #define GPIOF1 ((gpio_t1*)0x50007000) #define RCC_AHB4_ENSETR (*(volatile unsigned int*)0x50000A28) //封装引脚 #define GPIO_PIN_0 0 #define GPIO_PIN_1 1 #define GPIO_PIN_2 2 #define GPIO_PIN_3 3 #define GPIO_PIN_4 4 #define GPIO_PIN_5 5 #define GPIO_PIN_6 6 #define GPIO_PIN_7 7 #define GPIO_PIN_8 8 #define GPIO_PIN_9 9 #define GPIO_PIN_10 10 #define GPIO_PIN_11 11 #define GPIO_PIN_12 12 #define GPIO_PIN_13 13 #define GPIO_PIN_14 14 #define GPIO_PIN_15 15 //模式寄存器封装 typedef enum{ INPUT, OUTPUT, ALT, ANALOG }gpio_moder_t; //输出类型寄存器封装 typedef enum{ PP, OD }gpio_otyper_t; //输出速率寄存器封装 typedef enum{ LOW, MED, HIGH, VERY_HIGH }gpio_ospeedr_t; //是否需要上下拉电阻封装 typedef enum{ NO_PUPD, PU, PD }gpio_pupdr_t; //输出高低电平寄存器封装 typedef enum{ GPIO_RESET, GPIO_SET }gpio_status_t; //封装初始化结构体 typedef struct{ gpio_moder_t moder; //模式 gpio_otyper_t otyper; //输出类型 gpio_ospeedr_t speed;//速率 gpio_pupdr_t pupdr; //是否需要上下拉电阻 }gpio_init_t; //封装灯的种类 typedef enum { LED1, LED2, LED3 }leds; //函数功能：初始化GPIO //函数参数： //第一个参数：gpio组编号 //第二个参数：初始化gpio结构体 //第三个参数：引脚编号初始化 void hal_gpio_init(gpio_t1* gpiox,gpio_init_t* init,unsigned int pin); //函数功能：操作GPIO引脚,实现LED灯亮灭 //函数参数： //第一个参数：gpio组编号 //第二个参数：引脚编号初始化 //第三个参数：LED灯状态 void hal_gpio_write(gpio_t1* gpiox,unsigned int pin,gpio_status_t status); #endif uart4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/fc51b30d7c7ffd0826349568bb76eda9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-09T15:10:24+08:00" />
<meta property="article:modified_time" content="2023-01-09T15:10:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">串口发送命令控制led灯的状态</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>uart4.h</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__UART4_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__UART4_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32mp1xx_rcc.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32mp1xx_gpio.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32mp1xx_uart.h"</span></span>

<span class="token comment">//uart4初始化</span>
<span class="token keyword">void</span> <span class="token function">hal_uart4_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//发送一个字符</span>
<span class="token keyword">void</span> <span class="token function">put_char</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//发送一个字符串</span>
<span class="token keyword">void</span> <span class="token function">put_string</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> string<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//接收一个字符</span>
<span class="token keyword">char</span> <span class="token function">get_char</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//接收一个字符串</span>
<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">get_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

</code></pre> 
<p>gpio.h</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__GPIO_H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__GPIO_H__</span></span>

<span class="token comment">//寄存器封装</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> MODER<span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> OTYPER<span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> OSPEEDR<span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> PUPDR<span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> IDR<span class="token punctuation">;</span>
	<span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span> ODR<span class="token punctuation">;</span>
<span class="token punctuation">}</span>gpio_t1<span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOE1</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>gpio_t1<span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x50006000</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIOF1</span> <span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">(</span>gpio_t1<span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x50007000</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">RCC_AHB4_ENSETR</span> <span class="token expression"><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token keyword">volatile</span> <span class="token keyword">unsigned</span> <span class="token keyword">int</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token number">0x50000A28</span><span class="token punctuation">)</span></span></span>
<span class="token comment">//封装引脚</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_0</span> <span class="token expression"><span class="token number">0</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_1</span> <span class="token expression"><span class="token number">1</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_2</span> <span class="token expression"><span class="token number">2</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_3</span> <span class="token expression"><span class="token number">3</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_4</span> <span class="token expression"><span class="token number">4</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_5</span> <span class="token expression"><span class="token number">5</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_6</span> <span class="token expression"><span class="token number">6</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_7</span> <span class="token expression"><span class="token number">7</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_8</span> <span class="token expression"><span class="token number">8</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_9</span> <span class="token expression"><span class="token number">9</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_10</span> <span class="token expression"><span class="token number">10</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_11</span> <span class="token expression"><span class="token number">11</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_12</span> <span class="token expression"><span class="token number">12</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_13</span> <span class="token expression"><span class="token number">13</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_14</span> <span class="token expression"><span class="token number">14</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">GPIO_PIN_15</span> <span class="token expression"><span class="token number">15</span></span></span>

<span class="token comment">//模式寄存器封装</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{<!-- --></span>
	INPUT<span class="token punctuation">,</span>
	OUTPUT<span class="token punctuation">,</span>
	ALT<span class="token punctuation">,</span>
	ANALOG
<span class="token punctuation">}</span><span class="token class-name">gpio_moder_t</span><span class="token punctuation">;</span>

<span class="token comment">//输出类型寄存器封装</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{<!-- --></span>
	PP<span class="token punctuation">,</span>
	OD
<span class="token punctuation">}</span><span class="token class-name">gpio_otyper_t</span><span class="token punctuation">;</span>

<span class="token comment">//输出速率寄存器封装</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{<!-- --></span>
	LOW<span class="token punctuation">,</span>
	MED<span class="token punctuation">,</span>
	HIGH<span class="token punctuation">,</span>
	VERY_HIGH
<span class="token punctuation">}</span><span class="token class-name">gpio_ospeedr_t</span><span class="token punctuation">;</span>

<span class="token comment">//是否需要上下拉电阻封装</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{<!-- --></span>
	NO_PUPD<span class="token punctuation">,</span>
	PU<span class="token punctuation">,</span>
	PD
<span class="token punctuation">}</span><span class="token class-name">gpio_pupdr_t</span><span class="token punctuation">;</span>

<span class="token comment">//输出高低电平寄存器封装</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{<!-- --></span>
	GPIO_RESET<span class="token punctuation">,</span>
	GPIO_SET
<span class="token punctuation">}</span><span class="token class-name">gpio_status_t</span><span class="token punctuation">;</span>

<span class="token comment">//封装初始化结构体</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{<!-- --></span>
	<span class="token class-name">gpio_moder_t</span> moder<span class="token punctuation">;</span> <span class="token comment">//模式 </span>
	<span class="token class-name">gpio_otyper_t</span> otyper<span class="token punctuation">;</span> <span class="token comment">//输出类型 </span>
	<span class="token class-name">gpio_ospeedr_t</span> speed<span class="token punctuation">;</span><span class="token comment">//速率</span>
	<span class="token class-name">gpio_pupdr_t</span> pupdr<span class="token punctuation">;</span> <span class="token comment">//是否需要上下拉电阻 </span>
<span class="token punctuation">}</span><span class="token class-name">gpio_init_t</span><span class="token punctuation">;</span>

<span class="token comment">//封装灯的种类</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span>
<span class="token punctuation">{<!-- --></span>
	LED1<span class="token punctuation">,</span>
	LED2<span class="token punctuation">,</span>
	LED3
<span class="token punctuation">}</span>leds<span class="token punctuation">;</span>

<span class="token comment">//函数功能：初始化GPIO</span>
<span class="token comment">//函数参数：</span>
<span class="token comment">//第一个参数：gpio组编号</span>
<span class="token comment">//第二个参数：初始化gpio结构体</span>
<span class="token comment">//第三个参数：引脚编号初始化</span>
<span class="token keyword">void</span> <span class="token function">hal_gpio_init</span><span class="token punctuation">(</span>gpio_t1<span class="token operator">*</span> gpiox<span class="token punctuation">,</span><span class="token class-name">gpio_init_t</span><span class="token operator">*</span> init<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> pin<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//函数功能：操作GPIO引脚,实现LED灯亮灭</span>
<span class="token comment">//函数参数：</span>
<span class="token comment">//第一个参数：gpio组编号</span>
<span class="token comment">//第二个参数：引脚编号初始化</span>
<span class="token comment">//第三个参数：LED灯状态</span>
<span class="token keyword">void</span> <span class="token function">hal_gpio_write</span><span class="token punctuation">(</span>gpio_t1<span class="token operator">*</span> gpiox<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> pin<span class="token punctuation">,</span><span class="token class-name">gpio_status_t</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<p>uart4.c</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"uart4.h"</span></span>
<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token keyword">int</span> ms<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//PB2----&gt;UART4_RX</span>
<span class="token comment">//PG11----&gt;UART4_TX</span>
<span class="token comment">//uart4初始化</span>
<span class="token keyword">void</span> <span class="token function">hal_uart4_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>

	<span class="token comment">/*****RCC章节初始化********/</span>
	<span class="token comment">//1.使能GPIOB组控制器 MP_AHB4ENSETR[1] = 1</span>
	RCC<span class="token operator">-&gt;</span>MP_AHB4ENSETR <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2.使能GPIOG组控制器 MP_AHB4ENSETR[6] = 1</span>
	RCC<span class="token operator">-&gt;</span>MP_AHB4ENSETR <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3.使能UART4控制器 MP_APB1ENSETR[16] = 1</span>
	RCC<span class="token operator">-&gt;</span>MP_APB1ENSETR <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/*****GPIO章节初始化********/</span>
	<span class="token comment">//1.设置PB2引脚为复用功能模式 MODER[5:4] = 10</span>
	GPIOB<span class="token operator">-&gt;</span>MODER <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	GPIOB<span class="token operator">-&gt;</span>MODER <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2.设置PB2引脚复用功能为UART4_RX AFRL[11:8] = 1000</span>
	GPIOB<span class="token operator">-&gt;</span>AFRL <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0xf</span> <span class="token operator">&lt;&lt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	GPIOB<span class="token operator">-&gt;</span>AFRL <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3.设置PG11引脚为复用功能模式 MODER[23:22] = 10 </span>
	GPIOG<span class="token operator">-&gt;</span>MODER <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">22</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	GPIOG<span class="token operator">-&gt;</span>MODER <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">23</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//4.设置PG11引脚复用功能模式为UART4_TX AFRH[15:12] = 0110</span>
	GPIOG<span class="token operator">-&gt;</span>AFRH <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0xf</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	GPIOG<span class="token operator">-&gt;</span>AFRH <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">13</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/*****UART4章节初始化********/</span>
	<span class="token comment">//0.判断UE位是否使能</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">&amp;</span> <span class="token number">0x1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//1.设置串口1位起始位，8位数据位宽度 CR1[28][12] = 00</span>
	USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">28</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2.设置串口无奇偶校验位 CR1[10] = 0</span>
	USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//3.设置串口16倍采样率 CR1[15] = 0</span>
	USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//4.设置串口1位停止位 CR2[13:12] = 00</span>
	USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//5.设置串口不分频 PRESC[3:0] = 0000</span>
	USART4<span class="token operator">-&gt;</span>PRESC <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0xf</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//6.设置串口波特率为115200 BRR=0x22b</span>
	USART4<span class="token operator">-&gt;</span>BRR <span class="token operator">|=</span> <span class="token number">0x22b</span><span class="token punctuation">;</span>
	<span class="token comment">//7.设置发送器使能 CR1[3] = 1</span>
	USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//8.设置接收器使能 CR1[2] = 1</span>
	USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//9.设置串口使能 CR1[0] = 1</span>
	USART4<span class="token operator">-&gt;</span>CR1 <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
<span class="token comment">//发送一个字符</span>
<span class="token keyword">void</span> <span class="token function">put_char</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> str<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//1.判断发送数据寄存器是否为空 ISR[7]</span>
	<span class="token comment">//读0:发送数据寄存器为满，需要等待</span>
	<span class="token comment">//读1:发送数据寄存器为空，可以发送下一个字节</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART4<span class="token operator">-&gt;</span>ISR <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2.将要发送的字符，写入到发送数据寄存器中</span>
	USART4<span class="token operator">-&gt;</span>TDR <span class="token operator">=</span> str<span class="token punctuation">;</span>
	<span class="token comment">//3.判断发送数据是否完成</span>
	<span class="token comment">//读0：发送数据没有完成</span>
	<span class="token comment">//读1：发送数据完成</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART4<span class="token operator">-&gt;</span>ISR <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//发送一个字符串</span>
<span class="token keyword">void</span> <span class="token function">put_string</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> string<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//判断是否为'\0'</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>string<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">put_char</span><span class="token punctuation">(</span><span class="token operator">*</span>string<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token function">put_char</span><span class="token punctuation">(</span><span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">put_char</span><span class="token punctuation">(</span><span class="token char">'\r'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//接收一个字符</span>
<span class="token keyword">char</span> <span class="token function">get_char</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span> ch<span class="token punctuation">;</span>
	<span class="token comment">//1.判断接收数据寄存器是否为空</span>
	<span class="token comment">//读0:接收数据寄存器为空</span>
	<span class="token comment">//读1:接收数据寄存器中有数据</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART4<span class="token operator">-&gt;</span>ISR <span class="token operator">&amp;</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ch <span class="token operator">=</span> USART4<span class="token operator">-&gt;</span>RDR<span class="token punctuation">;</span><span class="token comment">//2.接收到数据</span>
	<span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">char</span> buffer<span class="token punctuation">[</span><span class="token number">50</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">//接收一个字符串</span>
<span class="token keyword">char</span><span class="token operator">*</span> <span class="token function">get_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">;</span>
	<span class="token comment">//循环实现数据收发</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">49</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">get_char</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//接收一个字符</span>
		<span class="token function">put_char</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//发送一个字符 </span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token char">'\r'</span><span class="token punctuation">)</span> <span class="token comment">//判断键盘enter键是否按下</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	buffer<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token char">'\0'</span><span class="token punctuation">;</span>
	<span class="token function">put_char</span><span class="token punctuation">(</span><span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> buffer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


</code></pre> 
<p>gpio.c</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"gpio.h"</span></span>

<span class="token keyword">void</span> <span class="token function">hal_gpio_init</span><span class="token punctuation">(</span>gpio_t1<span class="token operator">*</span> gpiox<span class="token punctuation">,</span><span class="token class-name">gpio_init_t</span><span class="token operator">*</span> init<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> pin<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//1.设置gpio引脚模式</span>
	gpiox<span class="token operator">-&gt;</span>MODER <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x3</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>pin <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gpiox<span class="token operator">-&gt;</span>MODER <span class="token operator">|=</span> <span class="token punctuation">(</span>init<span class="token operator">-&gt;</span>moder <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>pin <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//2.设置输出类型</span>
	gpiox<span class="token operator">-&gt;</span>OTYPER <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> pin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gpiox<span class="token operator">-&gt;</span>OTYPER <span class="token operator">|=</span> <span class="token punctuation">(</span>init<span class="token operator">-&gt;</span>otyper <span class="token operator">&lt;&lt;</span> pin<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//3.设置输出速率</span>
	gpiox<span class="token operator">-&gt;</span>OSPEEDR <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x3</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>pin <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gpiox<span class="token operator">-&gt;</span>OSPEEDR <span class="token operator">|=</span> <span class="token punctuation">(</span>init<span class="token operator">-&gt;</span>speed <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>pin <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">//4.设置是否需要上下拉电阻</span>
	gpiox<span class="token operator">-&gt;</span>PUPDR <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x3</span> <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>pin <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	gpiox<span class="token operator">-&gt;</span>PUPDR <span class="token operator">|=</span> <span class="token punctuation">(</span>init<span class="token operator">-&gt;</span>pupdr <span class="token operator">&lt;&lt;</span> <span class="token punctuation">(</span>pin <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">void</span> <span class="token function">hal_gpio_write</span><span class="token punctuation">(</span>gpio_t1<span class="token operator">*</span> gpiox<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> pin<span class="token punctuation">,</span><span class="token class-name">gpio_status_t</span> status<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>status <span class="token operator">==</span> GPIO_RESET<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		gpiox<span class="token operator">-&gt;</span>ODR <span class="token operator">&amp;=</span> <span class="token punctuation">(</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> pin<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		gpiox<span class="token operator">-&gt;</span>ODR <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x1</span> <span class="token operator">&lt;&lt;</span> pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p>main.c</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"uart4.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"gpio.h"</span></span>

<span class="token keyword">typedef</span> <span class="token keyword">struct</span> 
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span><span class="token operator">*</span> commond<span class="token punctuation">;</span>
	gpio_t1<span class="token operator">*</span> gpio<span class="token punctuation">;</span>
	<span class="token keyword">unsigned</span> <span class="token keyword">int</span> pin<span class="token punctuation">;</span>
	<span class="token class-name">gpio_status_t</span> stat<span class="token punctuation">;</span>
	<span class="token keyword">void</span> <span class="token punctuation">(</span><span class="token operator">*</span>callback<span class="token punctuation">)</span><span class="token punctuation">(</span>gpio_t1<span class="token operator">*</span> gpiox<span class="token punctuation">,</span><span class="token keyword">unsigned</span> <span class="token keyword">int</span> pin<span class="token punctuation">,</span><span class="token class-name">gpio_status_t</span> status<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token class-name">commond_t</span><span class="token punctuation">;</span>

<span class="token keyword">extern</span> <span class="token keyword">void</span> <span class="token function">printf</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>fmt<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">void</span> <span class="token function">delay_ms</span><span class="token punctuation">(</span><span class="token keyword">int</span> ms<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i<span class="token punctuation">,</span>j<span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ms<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span>j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> <span class="token number">1800</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">commond_t</span> com_code<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token punctuation">.</span>commond <span class="token operator">=</span> <span class="token string">"led1on"</span><span class="token punctuation">,</span>
			<span class="token punctuation">.</span>gpio <span class="token operator">=</span> GPIOE1<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>pin <span class="token operator">=</span> GPIO_PIN_10<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>stat <span class="token operator">=</span> GPIO_SET<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>callback <span class="token operator">=</span> hal_gpio_write<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token punctuation">.</span>commond <span class="token operator">=</span> <span class="token string">"led1off"</span><span class="token punctuation">,</span>
			<span class="token punctuation">.</span>gpio <span class="token operator">=</span> GPIOE1<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>pin <span class="token operator">=</span> GPIO_PIN_10<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>stat <span class="token operator">=</span> GPIO_RESET<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>callback <span class="token operator">=</span> hal_gpio_write<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token punctuation">.</span>commond <span class="token operator">=</span> <span class="token string">"led2on"</span><span class="token punctuation">,</span>
			<span class="token punctuation">.</span>gpio <span class="token operator">=</span> GPIOF1<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>pin <span class="token operator">=</span> GPIO_PIN_10<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>stat <span class="token operator">=</span> GPIO_SET<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>callback <span class="token operator">=</span> hal_gpio_write<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token punctuation">.</span>commond <span class="token operator">=</span> <span class="token string">"led2off"</span><span class="token punctuation">,</span>
			<span class="token punctuation">.</span>gpio <span class="token operator">=</span> GPIOF1<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>pin <span class="token operator">=</span> GPIO_PIN_10<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>stat <span class="token operator">=</span> GPIO_RESET<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>callback <span class="token operator">=</span> hal_gpio_write<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token punctuation">.</span>commond <span class="token operator">=</span> <span class="token string">"led3on"</span><span class="token punctuation">,</span>
			<span class="token punctuation">.</span>gpio <span class="token operator">=</span> GPIOE1<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>pin <span class="token operator">=</span> GPIO_PIN_8<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>stat <span class="token operator">=</span> GPIO_SET<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>callback <span class="token operator">=</span> hal_gpio_write<span class="token punctuation">,</span>
		<span class="token punctuation">}</span><span class="token punctuation">,</span>
		<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
			<span class="token punctuation">.</span>commond <span class="token operator">=</span> <span class="token string">"led3off"</span><span class="token punctuation">,</span>
			<span class="token punctuation">.</span>gpio <span class="token operator">=</span> GPIOE1<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>pin <span class="token operator">=</span> GPIO_PIN_8<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>stat <span class="token operator">=</span> GPIO_RESET<span class="token punctuation">,</span>
			<span class="token punctuation">.</span>callback <span class="token operator">=</span> hal_gpio_write<span class="token punctuation">,</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">//判断命令</span>
<span class="token class-name">commond_t</span><span class="token operator">*</span> <span class="token function">switch_commond</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span><span class="token class-name">commond_t</span><span class="token operator">*</span> com<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//比较字符串</span>
<span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> deststr<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> srcstr<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//led灯初始化</span>
<span class="token keyword">void</span> <span class="token function">ledinit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//1.时钟使能</span>
	RCC_AHB4_ENSETR <span class="token operator">|=</span> <span class="token punctuation">(</span><span class="token number">0x3</span> <span class="token operator">&lt;&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//2.初始化结构体</span>
	<span class="token class-name">gpio_init_t</span> init <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>OUTPUT<span class="token punctuation">,</span>PP<span class="token punctuation">,</span>LOW<span class="token punctuation">,</span>NO_PUPD<span class="token punctuation">}</span><span class="token punctuation">;</span>
	<span class="token comment">//3.调用gpio初始化函数</span>
	<span class="token function">hal_gpio_init</span><span class="token punctuation">(</span>GPIOE1<span class="token punctuation">,</span><span class="token operator">&amp;</span>init<span class="token punctuation">,</span>GPIO_PIN_10<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">hal_gpio_init</span><span class="token punctuation">(</span>GPIOF1<span class="token punctuation">,</span><span class="token operator">&amp;</span>init<span class="token punctuation">,</span>GPIO_PIN_10<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">hal_gpio_init</span><span class="token punctuation">(</span>GPIOE1<span class="token punctuation">,</span><span class="token operator">&amp;</span>init<span class="token punctuation">,</span>GPIO_PIN_8<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">char</span><span class="token operator">*</span> str <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token class-name">commond_t</span><span class="token operator">*</span> cnt <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token comment">//初始化操作</span>
	<span class="token function">ledinit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">hal_uart4_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//串口初始化</span>

	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token comment">//输入命令</span>
		<span class="token function">put_string</span><span class="token punctuation">(</span><span class="token string">"please input&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		str <span class="token operator">=</span> <span class="token function">get_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//判断命令</span>
		cnt <span class="token operator">=</span> <span class="token function">switch_commond</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span>com_code<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//如果命令存在 则改变灯的状态</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>cnt<span class="token punctuation">)</span>
			cnt<span class="token operator">-&gt;</span><span class="token function">callback</span><span class="token punctuation">(</span>cnt<span class="token operator">-&gt;</span>gpio<span class="token punctuation">,</span>cnt<span class="token operator">-&gt;</span>pin<span class="token punctuation">,</span>cnt<span class="token operator">-&gt;</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">else</span>
			<span class="token function">put_string</span><span class="token punctuation">(</span><span class="token string">"no this commond code"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//比较字符串</span>
<span class="token keyword">int</span> <span class="token function">cmp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> deststr<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> srcstr<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">*</span>deststr<span class="token operator">++</span> <span class="token operator">==</span> <span class="token operator">*</span>srcstr<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">*</span>deststr <span class="token operator">!=</span> <span class="token char">'\0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">--</span>deststr<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">--</span>srcstr<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//判断命令</span>
<span class="token class-name">commond_t</span><span class="token operator">*</span> <span class="token function">switch_commond</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> str<span class="token punctuation">,</span><span class="token class-name">commond_t</span><span class="token operator">*</span> com<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> <span class="token number">6</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">cmp</span><span class="token punctuation">(</span>str<span class="token punctuation">,</span>com<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>commond<span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token keyword">return</span> <span class="token operator">&amp;</span>com<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>实验现象<br> <img src="https://images2.imgbox.com/49/62/4HTIv7yv_o.png" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/0d/ee/2HlcEcf5_o.jpg" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/ac/b1/QWvH9fvI_o.jpg" alt="请添加图片描述"><br> <img src="https://images2.imgbox.com/f8/48/zkK92FNv_o.jpg" alt="请添加图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78b34ff26d24ab7309709644146ad5a1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">End-to-End Object Detection with Transformers</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7bcea00e66cd868d96d5c9c31539313e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue中string如何转为json对象</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>