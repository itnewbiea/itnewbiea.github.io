<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RHCE-ansible第二次作业 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RHCE-ansible第二次作业" />
<meta property="og:description" content="1、给受管主机部署yum仓库，示例如下：
仓库1 ：
Name: base
​ Description: baseos
​ Base url: https://mirrors.163.com/centos-vault/8.5.2111/BaseOS/x86_64/os/
​ 需要验证软件包 GPG 签名
​ GPG key 在 /etc/pki/rpm-gpg/RPM-GPG-KEY-*
​ 启用此软件仓库
仓库 2：
Name: app
Description: appstream
Base url： https://mirrors.163.com/centos-vault/8.5.2111/AppStream/x86_64/os/
需要验证软件包 GPG 签名
GPG key 在： /etc/pki/rpm-gpg/RPM-GPG-KEY-*
启用此软件仓库
注：检查你自己的linux系统版本，并选择相应版本仓库。
部署成功后在受管主机上安装vsftpd软件包
首先确保该工作路径下存在ansible.conf和inventory文件并且配置正确
然后vim 一个以.yml结尾的文件
这里以1-create-yum.yml为例：
[admin@master test1]$ vim 1-create-yum.yml
然后在文件中编辑如下内容：
代码如下：
--- - name: play1 hosts: all tasks: - name: create base yum_repository: name: base description: baseos baseurl: https://mirrors." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d1cde1b0aa7e207e2f6aac89608a51c7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-12T22:09:49+08:00" />
<meta property="article:modified_time" content="2022-06-12T22:09:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RHCE-ansible第二次作业</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>1、给受管主机部署yum仓库，示例如下：</p> 
<p>仓库1 ：<br> Name: base<br> ​ Description: baseos<br> ​ Base url: https://mirrors.163.com/centos-vault/8.5.2111/BaseOS/x86_64/os/<br> ​ 需要验证软件包 GPG 签名<br> ​ GPG key 在 /etc/pki/rpm-gpg/RPM-GPG-KEY-*<br> ​ 启用此软件仓库</p> 
<p>仓库 2：<br> Name: app<br> Description: appstream<br> Base url： https://mirrors.163.com/centos-vault/8.5.2111/AppStream/x86_64/os/<br> 需要验证软件包 GPG 签名<br> GPG key 在： /etc/pki/rpm-gpg/RPM-GPG-KEY-*<br> 启用此软件仓库</p> 
<p><strong>注：检查你自己的linux系统版本，并选择相应版本仓库。<br> 部署成功后在受管主机上安装vsftpd软件包</strong></p> 
<blockquote> 
 <p>首先确保该工作路径下存在ansible.conf和inventory文件并且配置正确<br> 然后vim 一个以.yml结尾的文件<br> 这里以1-create-yum.yml为例：<br> [admin@master test1]$ vim 1-create-yum.yml<br> 然后在文件中编辑如下内容：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/44/93/5XU8K4xH_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>代码如下：</p> 
</blockquote> 
<pre><code class="prism language-bash">---
- name: play1
  hosts: all
  tasks:
    - name: create base
      yum_repository:
        name: base
        description: baseos
        baseurl: https://mirrors.aliyun.com/centos-vault/8.2.2004/BaseOS/x86_64/os/
        gpgcheck: <span class="token function">yes</span>
    - name: create appstream
      yum_repository:
        name: app
        description: appstream
        baseurl: https://mirrors.aliyun.com/centos-vault/8.2.2004/AppStream/x86_64/os/
        gpgcheck: <span class="token function">yes</span>
    - name: <span class="token function">install</span> vsftpd
      yum:
        name: vsftpd
        state: latest
</code></pre> 
<p>2、给web主机组写一个playbook，该playbook有两个play，第一个play可以保证在web主机组上安装httpd和php，确保web主机组的/var/www/html/目录下面有一个文件为index.php，内容如下：</p> 
<pre><code class="prism language-bash">$ <span class="token function">cat</span> /var/www/html/index.php
<span class="token operator">&lt;</span>?php
phpinfo<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>其中该playbook里面的第二个play用于测试该web主机组的web服务能否被成功访问index.php内容。</p> 
<blockquote> 
 <p>首先去配置文件里面去设置web组</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/da/09/VC47Hr4x_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>然后去配置一个.yml文件<br> 文件内容如下：</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/84/d9/WnXjMa8p_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>文件代码如下：</p> 
</blockquote> 
<pre><code class="prism language-bash">---
- name: play1
  hosts: web
  tasks:
    - name: <span class="token function">install</span> httpd
      yum:
        name:
          - httpd
          - php
        state: latest
    - name: create index
      copy:
        content: <span class="token string">"&lt;?php<span class="token entity" title="\n">\n</span>phpinfo();<span class="token entity" title="\n">\n</span>"</span>
        dest: /var/www/html/index.php
    - name: delete index.html
      file:
        path: /var/www/html/index.html
        state: absent
    - name: <span class="token function">add</span> a firewalld rule
      firewalld:
        service: http
        permanent: <span class="token boolean">true</span>
        state: enabled
        immediate: <span class="token boolean">true</span>
    - name: restart httpd
      service:
        name: httpd
        state: restarted

- name: play2
  hosts: master
  tasks:
    - name: ceshi master
      uri:
        url: http://master

</code></pre> 
<p>3、在受控节点上添加一个普通用户xiaohong，配置当前控制节点的用户可以免密登录xiaohong用户，并且xiaohong可以sudo。</p> 
<blockquote> 
 <p>在控制节点上配置.yml文件</p> 
</blockquote> 
<blockquote> 
 <p>[admin@master test1]$ vim 3-useradd.yml<br> 文件内容如下</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/67/71/2W5fS2od_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>由于我之前配置过免密登录，所以这里就不需要产生公私钥对<br> 如果需要<br> 在文件内容之前加上</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/f2/82/5GhQMpf1_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>验证结果</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/60/d7/rNGGlkok_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>文件代码如下：</p> 
</blockquote> 
<pre><code class="prism language-bash">---
- name: play1
  hosts: node01
  tasks:
    - name: <span class="token function">useradd</span> xiaohong
      user:
        name: xiaohong
        state: present

    - name: xiaohong sudoers
      lineinfile:
        line: <span class="token string">"xiaohong ALL=(ALL) NOPASSWD:ALL"</span>
        path: /etc/sudoers
    - authorized_key:
        state: present
        user: xiaohong
        key: <span class="token string">"{<!-- -->{ lookup('file', '/home/admin/.ssh/id_rsa.pub') }}"</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9f6512506c2b9b322ed99202b5c57beb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第五单元 用python学习微积分（三十二）无穷的处理--不定式（下）和反常积分</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c059264b9284cc349a74cf6aa2c3b795/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Android下拉刷新的实现(一) - SwipeRefreshLayout篇</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>