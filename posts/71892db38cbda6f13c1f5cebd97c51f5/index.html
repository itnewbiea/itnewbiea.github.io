<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>adb bugreport 原理 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="adb bugreport 原理" />
<meta property="og:description" content="0.文章学习 https://www.2cto.com/kf/201607/528696.html
1.使用场景 使用 adb bugreport 可以导出功耗分析所需文件，然后通过 https://github.com/google/battery-historian 进行更加详细的分析
adb bugreport &gt; Bugreport.zip adb bugreport &gt; Bugreport.txt adb bugreport - return all information from the device that should be included in a bug report.
&#34; bugreport [PATH]\n&#34; &#34; write bugreport to given PATH [default=bugreport.zip];\n&#34; &#34; if PATH is a directory, the bug report is saved in that directory.\n&#34; &#34; devices that don&#39;t support zipped bug reports output to stdout.\n&#34; 这里主要想知道 bugreport 的数据从哪里导出" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/71892db38cbda6f13c1f5cebd97c51f5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-06-01T17:48:33+08:00" />
<meta property="article:modified_time" content="2018-06-01T17:48:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">adb bugreport 原理</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3 id="0文章学习">0.文章学习</h3> 
<p><a href="https://www.2cto.com/kf/201607/528696.html" rel="nofollow">https://www.2cto.com/kf/201607/528696.html</a></p> 
<h3 id="1使用场景">1.使用场景</h3> 
<p>使用 adb bugreport 可以导出功耗分析所需文件，然后通过 <a href="https://github.com/google/battery-historian">https://github.com/google/battery-historian</a> 进行更加详细的分析</p> 
<pre class="prettyprint"><code class=" hljs avrasm">adb bugreport &gt; Bugreport<span class="hljs-preprocessor">.zip</span>
adb bugreport &gt; Bugreport<span class="hljs-preprocessor">.txt</span>
</code></pre> 
<p>adb bugreport - return all information from the device that should be included in a bug report.</p> 
<pre><code>    " bugreport [PATH]\n"
    "     write bugreport to given PATH [default=bugreport.zip];\n"
    "     if PATH is a directory, the bug report is saved in that directory.\n"
    "     devices that don't support zipped bug reports output to stdout.\n"
</code></pre> 
<p>这里主要想知道 bugreport 的数据从哪里导出</p> 
<h3 id="2-bugreport-数据来源">2. bugreport 数据来源</h3> 
<h5 id="21-adb-bugreport-命令下发的接收点">2.1 adb bugreport 命令下发的接收点</h5> 
<p>system/core/adb/commandline.cpp</p> 
<p>命令行接收事件查看</p> 
<pre class="prettyprint"><code class=" hljs r"><span class="hljs-comment">#include "bugreport.h"</span>

int adb_commandline(int argc, const char** argv) {

    <span class="hljs-keyword">...</span>
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!strcmp(argv[<span class="hljs-number">0</span>], <span class="hljs-string">"bugreport"</span>)) {
    Bugreport bugreport;
    <span class="hljs-keyword">return</span> bugreport.DoIt(argc, argv);
    ....</code></pre> 
<h5 id="22-bugreportdoitargc-argv">2.2 bugreport.DoIt(argc, argv)</h5> 
<p>system/core/adb/bugreport.cpp</p> 
<pre class="prettyprint"><code class=" hljs r">int Bugreport::DoIt(int argc, const char** argv) {
    <span class="hljs-keyword">...</span>
    <span class="hljs-keyword">return</span> SendShellCommand(bugz_command, false, &amp;bugz_callback);
}</code></pre> 
<h5 id="23-命令下发执行文件">2.3 命令下发执行文件</h5> 
<p>对应系统目录下的可执行文件</p> 
<p>/system/bin # ls -al</p> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-attribute">-rwxr</span><span class="hljs-attribute">-xr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> root   shell      <span class="hljs-number">10264</span> <span class="hljs-number">2018</span><span class="hljs-subst">-</span><span class="hljs-number">05</span><span class="hljs-subst">-</span><span class="hljs-number">31</span> <span class="hljs-number">15</span>:<span class="hljs-number">18</span> bugreport
<span class="hljs-attribute">-rwxr</span><span class="hljs-attribute">-xr</span><span class="hljs-attribute">-x</span>  <span class="hljs-number">1</span> root   shell      <span class="hljs-number">10264</span> <span class="hljs-number">2018</span><span class="hljs-subst">-</span><span class="hljs-number">05</span><span class="hljs-subst">-</span><span class="hljs-number">31</span> <span class="hljs-number">15</span>:<span class="hljs-number">18</span> bugreportz</code></pre> 
<p>frameworks\native\cmds\bugreport\bugreport.cpp</p> 
<h5 id="24-读取bugreport信息">2.4 读取bugreport信息</h5> 
<p>其实bugreport就是 dumpstate，具体文件在手机系统目录 system/bin/dumpstate，dumpstate是可执行文件</p> 
<ul><li>cmd 窗口</li></ul> 
<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-constant">Sufadi</span><span class="hljs-symbol">:/system/bin</span> <span class="hljs-comment"># ls dumpstate -all</span>
ls dumpstate -all
-rwxr-xr-x <span class="hljs-number">1</span> root shell <span class="hljs-number">207136</span> <span class="hljs-number">2018</span>-<span class="hljs-number">05</span>-<span class="hljs-number">31</span> <span class="hljs-number">15</span><span class="hljs-symbol">:</span><span class="hljs-number">18</span> dumpstate</code></pre> 
<ul><li>具体源码</li></ul> 
<pre class="prettyprint"><code class=" hljs r">
// This program will trigger the dumpstate service to start a call to
// dumpstate, then connect to the dumpstate local client to read the
// output. All of the dumpstate output is written to stdout, including
// any errors encountered <span class="hljs-keyword">while</span> reading/writing the output.
int main() {
  <span class="hljs-keyword">...</span>
  // Start the dumpstate service. 启动 dumpstate service
  // 其实bugreport就是 dumpstate 
  property_set(<span class="hljs-string">"ctl.start"</span>, <span class="hljs-string">"dumpstate"</span>);

  <span class="hljs-keyword">...</span>

  <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>) {
    <span class="hljs-keyword">...</span>
    char buffer[<span class="hljs-number">65536</span>];
    ssize_t bytes_read = TEMP_FAILURE_RETRY(read(s, buffer, sizeof(buffer)));

    do {
      bytes_written = TEMP_FAILURE_RETRY(write(STDOUT_FILENO,
                                               buffer + bytes_read - bytes_to_send,
                                               bytes_to_send));
      <span class="hljs-keyword">if</span> (bytes_written == -<span class="hljs-number">1</span>) {
        printf(<span class="hljs-string">"Failed to write data to stdout: read %zd, trying to send %zd (%s)\n"</span>,
               bytes_read, bytes_to_send, strerror(errno));
        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
      }
      bytes_to_send -= bytes_written;
    } <span class="hljs-keyword">while</span> (bytes_written != <span class="hljs-number">0</span> &amp;&amp; bytes_to_send &gt; <span class="hljs-number">0</span>);
  }

  close(s);
  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
}
</code></pre> 
<h5 id="25-dumpstate-的实现及其数据来源">2.5 dumpstate 的实现及其数据来源</h5> 
<p>frameworks\native\cmds\dumpstate\dumpstate.cpp</p> 
<ul><li>1.系统属性</li><li>2./proc和/sys节点文件</li><li>3.执行shell命令获得相关输出</li><li>4.logcat输出</li><li>5.Android Framework Services信息基本使用dumpsys命令通过binder调用服务中的dump函数获得信息</li></ul> 
<pre class="prettyprint"><code class=" hljs cpp"><span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> dumpstate() {
    DurationReporter duration_reporter(<span class="hljs-string">"DUMPSTATE"</span>);

    dump_dev_files(<span class="hljs-string">"TRUSTY VERSION"</span>, <span class="hljs-string">"/sys/bus/platform/drivers/trusty"</span>, <span class="hljs-string">"trusty_version"</span>);
    RunCommand(<span class="hljs-string">"UPTIME"</span>, {<!-- --><span class="hljs-string">"uptime"</span>});
    DumpBlockStatFiles();
    dump_emmc_ecsd(<span class="hljs-string">"/d/mmc0/mmc0:0001/ext_csd"</span>);
    DumpFile(<span class="hljs-string">"MEMORY INFO"</span>, <span class="hljs-string">"/proc/meminfo"</span>);
    RunCommand(<span class="hljs-string">"CPU INFO"</span>, {<!-- --><span class="hljs-string">"top"</span>, <span class="hljs-string">"-b"</span>, <span class="hljs-string">"-n"</span>, <span class="hljs-string">"1"</span>, <span class="hljs-string">"-H"</span>, <span class="hljs-string">"-s"</span>, <span class="hljs-string">"6"</span>, <span class="hljs-string">"-o"</span>,
                            <span class="hljs-string">"pid,tid,user,pr,ni,%cpu,s,virt,res,pcy,cmd,name"</span>});
    RunCommand(<span class="hljs-string">"PROCRANK"</span>, {<!-- --><span class="hljs-string">"procrank"</span>}, AS_ROOT_20);
    DumpFile(<span class="hljs-string">"VIRTUAL MEMORY STATS"</span>, <span class="hljs-string">"/proc/vmstat"</span>);
    DumpFile(<span class="hljs-string">"VMALLOC INFO"</span>, <span class="hljs-string">"/proc/vmallocinfo"</span>);
    DumpFile(<span class="hljs-string">"SLAB INFO"</span>, <span class="hljs-string">"/proc/slabinfo"</span>);
    DumpFile(<span class="hljs-string">"ZONEINFO"</span>, <span class="hljs-string">"/proc/zoneinfo"</span>);
    DumpFile(<span class="hljs-string">"PAGETYPEINFO"</span>, <span class="hljs-string">"/proc/pagetypeinfo"</span>);
    DumpFile(<span class="hljs-string">"BUDDYINFO"</span>, <span class="hljs-string">"/proc/buddyinfo"</span>);
    DumpFile(<span class="hljs-string">"FRAGMENTATION INFO"</span>, <span class="hljs-string">"/d/extfrag/unusable_index"</span>);

    DumpFile(<span class="hljs-string">"KERNEL WAKE SOURCES"</span>, <span class="hljs-string">"/d/wakeup_sources"</span>);
    DumpFile(<span class="hljs-string">"KERNEL CPUFREQ"</span>, <span class="hljs-string">"/sys/devices/system/cpu/cpu0/cpufreq/stats/time_in_state"</span>);
    DumpFile(<span class="hljs-string">"KERNEL SYNC"</span>, <span class="hljs-string">"/d/sync"</span>);

    RunCommand(<span class="hljs-string">"PROCESSES AND THREADS"</span>,
               {<!-- --><span class="hljs-string">"ps"</span>, <span class="hljs-string">"-A"</span>, <span class="hljs-string">"-T"</span>, <span class="hljs-string">"-Z"</span>, <span class="hljs-string">"-O"</span>, <span class="hljs-string">"pri,nice,rtprio,sched,pcy"</span>});
    RunCommand(<span class="hljs-string">"LIBRANK"</span>, {<!-- --><span class="hljs-string">"librank"</span>}, CommandOptions::AS_ROOT);

    <span class="hljs-keyword">if</span> (ds.IsZipping()) {
        RunCommand(
                <span class="hljs-string">"HARDWARE HALS"</span>,
                {<!-- --><span class="hljs-string">"lshal"</span>, <span class="hljs-built_in">std</span>::<span class="hljs-built_in">string</span>(<span class="hljs-string">"--debug="</span>) + kLsHalDebugPath},
                CommandOptions::AS_ROOT);

        ds.AddZipEntry(<span class="hljs-string">"lshal-debug.txt"</span>, kLsHalDebugPath);

        unlink(kLsHalDebugPath.c_str());
    } <span class="hljs-keyword">else</span> {
        RunCommand(
                <span class="hljs-string">"HARDWARE HALS"</span>, {<!-- --><span class="hljs-string">"lshal"</span>, <span class="hljs-string">"--debug"</span>}, CommandOptions::AS_ROOT);
    }

    RunCommand(<span class="hljs-string">"PRINTENV"</span>, {<!-- --><span class="hljs-string">"printenv"</span>});
    RunCommand(<span class="hljs-string">"NETSTAT"</span>, {<!-- --><span class="hljs-string">"netstat"</span>, <span class="hljs-string">"-nW"</span>});
    <span class="hljs-keyword">struct</span> stat s;
    <span class="hljs-keyword">if</span> (stat(<span class="hljs-string">"/proc/modules"</span>, &amp;s) != <span class="hljs-number">0</span>) {
        MYLOGD(<span class="hljs-string">"Skipping 'lsmod' because /proc/modules does not exist\n"</span>);
    } <span class="hljs-keyword">else</span> {
        RunCommand(<span class="hljs-string">"LSMOD"</span>, {<!-- --><span class="hljs-string">"lsmod"</span>});
    }

    do_dmesg();

    RunCommand(<span class="hljs-string">"LIST OF OPEN FILES"</span>, {<!-- --><span class="hljs-string">"lsof"</span>}, CommandOptions::AS_ROOT);
    for_each_pid(do_showmap, <span class="hljs-string">"SMAPS OF ALL PROCESSES"</span>);
    for_each_tid(show_wchan, <span class="hljs-string">"BLOCKED PROCESS WAIT-CHANNELS"</span>);
    for_each_pid(show_showtime, <span class="hljs-string">"PROCESS TIMES (pid cmd user system iowait+percentage)"</span>);

    <span class="hljs-comment">/* Dump Bluetooth HCI logs */</span>
    ds.AddDir(<span class="hljs-string">"/data/misc/bluetooth/logs"</span>, <span class="hljs-keyword">true</span>);

    <span class="hljs-keyword">if</span> (!ds.do_early_screenshot_) {
        MYLOGI(<span class="hljs-string">"taking late screenshot\n"</span>);
        ds.TakeScreenshot();
    }

    DoLogcat();

    AddAnrTraceFiles();

    <span class="hljs-comment">// NOTE: tombstones are always added as separate entries in the zip archive</span>
    <span class="hljs-comment">// and are not interspersed with the main report.</span>
    <span class="hljs-keyword">const</span> <span class="hljs-keyword">bool</span> tombstones_dumped = AddDumps(tombstone_data-&gt;begin(), tombstone_data-&gt;end(),
                                            <span class="hljs-string">"TOMBSTONE"</span>, <span class="hljs-keyword">true</span> <span class="hljs-comment">/* add_to_zip */</span>);
    <span class="hljs-keyword">if</span> (!tombstones_dumped) {
        <span class="hljs-built_in">printf</span>(<span class="hljs-string">"*** NO TOMBSTONES to dump in %s\n\n"</span>, TOMBSTONE_DIR.c_str());
    }

    DumpPacketStats();

    DoKmsg();

    DumpIpAddrAndRules();

    dump_route_tables();

    RunCommand(<span class="hljs-string">"ARP CACHE"</span>, {<!-- --><span class="hljs-string">"ip"</span>, <span class="hljs-string">"-4"</span>, <span class="hljs-string">"neigh"</span>, <span class="hljs-string">"show"</span>});
    RunCommand(<span class="hljs-string">"IPv6 ND CACHE"</span>, {<!-- --><span class="hljs-string">"ip"</span>, <span class="hljs-string">"-6"</span>, <span class="hljs-string">"neigh"</span>, <span class="hljs-string">"show"</span>});
    RunCommand(<span class="hljs-string">"MULTICAST ADDRESSES"</span>, {<!-- --><span class="hljs-string">"ip"</span>, <span class="hljs-string">"maddr"</span>});

    RunDumpsys(<span class="hljs-string">"NETWORK DIAGNOSTICS"</span>, {<!-- --><span class="hljs-string">"connectivity"</span>, <span class="hljs-string">"--diag"</span>},
               CommandOptions::WithTimeout(<span class="hljs-number">10</span>).Build());

    RunCommand(<span class="hljs-string">"SYSTEM PROPERTIES"</span>, {<!-- --><span class="hljs-string">"getprop"</span>});

    RunCommand(<span class="hljs-string">"VOLD DUMP"</span>, {<!-- --><span class="hljs-string">"vdc"</span>, <span class="hljs-string">"dump"</span>});
    RunCommand(<span class="hljs-string">"SECURE CONTAINERS"</span>, {<!-- --><span class="hljs-string">"vdc"</span>, <span class="hljs-string">"asec"</span>, <span class="hljs-string">"list"</span>});

    RunCommand(<span class="hljs-string">"STORAGED TASKIOINFO"</span>, {<!-- --><span class="hljs-string">"storaged"</span>, <span class="hljs-string">"-u"</span>}, CommandOptions::WithTimeout(<span class="hljs-number">10</span>).Build());

    RunCommand(<span class="hljs-string">"FILESYSTEMS &amp; FREE SPACE"</span>, {<!-- --><span class="hljs-string">"df"</span>});

    RunCommand(<span class="hljs-string">"LAST RADIO LOG"</span>, {<!-- --><span class="hljs-string">"parse_radio_log"</span>, <span class="hljs-string">"/proc/last_radio_log"</span>});

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"------ BACKLIGHTS ------\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"LCD brightness="</span>);
    DumpFile(<span class="hljs-string">""</span>, <span class="hljs-string">"/sys/class/leds/lcd-backlight/brightness"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Button brightness="</span>);
    DumpFile(<span class="hljs-string">""</span>, <span class="hljs-string">"/sys/class/leds/button-backlight/brightness"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"Keyboard brightness="</span>);
    DumpFile(<span class="hljs-string">""</span>, <span class="hljs-string">"/sys/class/leds/keyboard-backlight/brightness"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"ALS mode="</span>);
    DumpFile(<span class="hljs-string">""</span>, <span class="hljs-string">"/sys/class/leds/lcd-backlight/als"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"LCD driver registers:\n"</span>);
    DumpFile(<span class="hljs-string">""</span>, <span class="hljs-string">"/sys/class/leds/lcd-backlight/registers"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"\n"</span>);

    <span class="hljs-comment">/* Binder state is expensive to look at as it uses a lot of memory. */</span>
    DumpFile(<span class="hljs-string">"BINDER FAILED TRANSACTION LOG"</span>, <span class="hljs-string">"/sys/kernel/debug/binder/failed_transaction_log"</span>);
    DumpFile(<span class="hljs-string">"BINDER TRANSACTION LOG"</span>, <span class="hljs-string">"/sys/kernel/debug/binder/transaction_log"</span>);
    DumpFile(<span class="hljs-string">"BINDER TRANSACTIONS"</span>, <span class="hljs-string">"/sys/kernel/debug/binder/transactions"</span>);
    DumpFile(<span class="hljs-string">"BINDER STATS"</span>, <span class="hljs-string">"/sys/kernel/debug/binder/stats"</span>);
    DumpFile(<span class="hljs-string">"BINDER STATE"</span>, <span class="hljs-string">"/sys/kernel/debug/binder/state"</span>);

    ds.DumpstateBoard();

    <span class="hljs-comment">/* Migrate the ril_dumpstate to a device specific dumpstate? */</span>
    <span class="hljs-keyword">int</span> rilDumpstateTimeout = android::base::GetIntProperty(<span class="hljs-string">"ril.dumpstate.timeout"</span>, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">if</span> (rilDumpstateTimeout &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-comment">// su does not exist on user builds, so try running without it.</span>
        <span class="hljs-comment">// This way any implementations of vril-dump that do not require</span>
        <span class="hljs-comment">// root can run on user builds.</span>
        CommandOptions::CommandOptionsBuilder options =
            CommandOptions::WithTimeout(rilDumpstateTimeout);
        <span class="hljs-keyword">if</span> (!PropertiesHelper::IsUserBuild()) {
            options.AsRoot();
        }
        RunCommand(<span class="hljs-string">"DUMP VENDOR RIL LOGS"</span>, {<!-- --><span class="hljs-string">"vril-dump"</span>}, options.Build());
    }

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"== Android Framework Services\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);

    RunDumpsys(<span class="hljs-string">"DUMPSYS"</span>, {<!-- --><span class="hljs-string">"--skip"</span>, <span class="hljs-string">"meminfo"</span>, <span class="hljs-string">"cpuinfo"</span>}, CommandOptions::WithTimeout(<span class="hljs-number">90</span>).Build(),
               <span class="hljs-number">10</span>);

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"== Checkins\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);

    RunDumpsys(<span class="hljs-string">"CHECKIN BATTERYSTATS"</span>, {<!-- --><span class="hljs-string">"batterystats"</span>, <span class="hljs-string">"-c"</span>});
    RunDumpsys(<span class="hljs-string">"CHECKIN MEMINFO"</span>, {<!-- --><span class="hljs-string">"meminfo"</span>, <span class="hljs-string">"--checkin"</span>});
    RunDumpsys(<span class="hljs-string">"CHECKIN NETSTATS"</span>, {<!-- --><span class="hljs-string">"netstats"</span>, <span class="hljs-string">"--checkin"</span>});
    RunDumpsys(<span class="hljs-string">"CHECKIN PROCSTATS"</span>, {<!-- --><span class="hljs-string">"procstats"</span>, <span class="hljs-string">"-c"</span>});
    RunDumpsys(<span class="hljs-string">"CHECKIN USAGESTATS"</span>, {<!-- --><span class="hljs-string">"usagestats"</span>, <span class="hljs-string">"-c"</span>});
    RunDumpsys(<span class="hljs-string">"CHECKIN PACKAGE"</span>, {<!-- --><span class="hljs-string">"package"</span>, <span class="hljs-string">"--checkin"</span>});

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"== Running Application Activities\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);

    RunDumpsys(<span class="hljs-string">"APP ACTIVITIES"</span>, {<!-- --><span class="hljs-string">"activity"</span>, <span class="hljs-string">"-v"</span>, <span class="hljs-string">"all"</span>});

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"== Running Application Services\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);

    RunDumpsys(<span class="hljs-string">"APP SERVICES"</span>, {<!-- --><span class="hljs-string">"activity"</span>, <span class="hljs-string">"service"</span>, <span class="hljs-string">"all"</span>});

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"== Running Application Providers\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);

    RunDumpsys(<span class="hljs-string">"APP PROVIDERS"</span>, {<!-- --><span class="hljs-string">"activity"</span>, <span class="hljs-string">"provider"</span>, <span class="hljs-string">"all"</span>});

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"== Dropbox crashes\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);

    RunDumpsys(<span class="hljs-string">"DROPBOX SYSTEM SERVER CRASHES"</span>, {<!-- --><span class="hljs-string">"dropbox"</span>, <span class="hljs-string">"-p"</span>, <span class="hljs-string">"system_server_crash"</span>});
    RunDumpsys(<span class="hljs-string">"DROPBOX SYSTEM APP CRASHES"</span>, {<!-- --><span class="hljs-string">"dropbox"</span>, <span class="hljs-string">"-p"</span>, <span class="hljs-string">"system_app_crash"</span>});

    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"== Final progress (pid %d): %d/%d (estimated %d)\n"</span>, ds.pid_, ds.progress_-&gt;Get(),
           ds.progress_-&gt;GetMax(), ds.progress_-&gt;GetInitialMax());
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"== dumpstate: done (id %d)\n"</span>, ds.id_);
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"========================================================\n"</span>);
}</code></pre> 
<p>上述例如 <br> - 查看电池信息 <br> RunDumpsys(“CHECKIN BATTERYSTATS”, {“batterystats”, “-c”});</p> 
<ul><li>查看kernal的唤醒源 <br> DumpFile(“KERNEL WAKE SOURCES”, “/d/wakeup_sources”);</li></ul> 
<h3 id="3-bugreport-数据展示">3. bugreport 数据展示</h3> 
<p>从bugreport导出手机数据，通过battery-historian解析原始数据进行多维度分析功耗异常</p> 
<p><a href="https://github.com/google/battery-historian">https://github.com/google/battery-historian</a></p> 
<p><img src="https://images2.imgbox.com/ff/3b/GpYEduDy_o.png" alt="Bugreport" title=""></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/341b84e1afdc716c546c80efe556e731/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">“不允许一个用户使用一个以上用户名与一个服务器或共享资源的多重连接”问题的解决</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9916f1e7fc7aceb7c2ad8dad9c8c2264/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">网络基础：浅析IP协议</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>