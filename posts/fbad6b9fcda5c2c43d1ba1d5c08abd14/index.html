<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>教程更新丨手把手带你玩转ORB-SLAM3（2.0） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="教程更新丨手把手带你玩转ORB-SLAM3（2.0）" />
<meta property="og:description" content="是的，你没看错！「手把手带你玩转ORB-SLAM3」教程2.0来了，在原有教程基础上更细节、更全面，不仅有SDK及ORB-SLAM3安装过程中的各种常见性问题解决方法及安装细节，同时还提供官方完整编译代码包哦，真正带你手把手~
本文主要讲解如何在orb-slam3中使用ros接入INDEMIND的双目鱼眼&#43;imu模组。
具体分为以下4部分：
SDK安装orb-slam3安装SDK orb-slam3中ROS程序修改和配置文件运行 其中【SDK orbslam3中ROS程序修改和配置文件】又分为4部分：
SDK中ros程序的修改orbslam3 ros中自定义msg的添加和topic订阅orbslam3 ros中配置文件的修改orbslam3 中读取配置文件代码修改 本文操作系统：ubuntu18.04
完整代码包下载地址：https://github.com/INDEMIND/ORB-SLAM3-Course
一、SDK安装 SDK下载及准备安装：
安装过程主要参考产品手册中Ubuntu一节，官方产品手册地址：https://imsee-sdk-docs.readthedocs.io/zh/latest/src/sdk/contents.html
1.安装依赖：
2.然后使用git下载 SDK：
3.准备安装SDK需要的依赖，执行以下命令即可：
安装OpenCV3.4.3版本 1.为什么安装OpenCV3.4.3版本？
解决方法：安装OpenCV3.4.3版本，并把SDK中的libIndemind.so替换掉
2.安装Opencv参考如下：
MNN安装：
因为MNN依赖protobuf，而安装protbuf有两种方式，一种是源码安装（可参见产品手册），另一种方法如下（较容易）：
完成这些步骤，SDK就安装完毕了。
二、orb-slam3安装 如何安装：
具体安装过程请参考orbslam3官网。
安装注意：
orbslam3依赖的opencv是4.4以上的版本，而Indemind的sdk使用的是3.4.3版本。因此，需要修改orbslam3的工程，方法如下：
1.打开orbslam3工程的cmakelist.txt找到如下片段：
2.然后将该片段注释掉并添加代码，修改如下：
3.之后进行编译，成功后如下：
4.运行如下：
5.编译中的问题：
解决方法：修改 build.sh文件 将其中的make -j 改为 make -j2 或者-j1。
至此，ORB-SLAM3的安装结束。
三、SDK orb-slam3中ROS程序修改与配置文件 SDK中ros程序的修改 接下来是介绍SDK中的ros程序imsee_ros_wrapper，浏览${xx}/sdk/IMSEE-SDK/ros/src/imsee_ros_wrapper的目录：${xx}是下载sdk的路径
其中添加了自定义的msg文件夹，里面包含了自定义的设备信息消息。主要包含双目鱼眼相机的参数和imu参数。
在src/wrapper_nodelet.cc中添加了发送设备信息函数和对应的topic：
从SDK接口中读取设备信息，使用ROS Topic方式，将信息发送出去。
程序中ros参数器的读取，需要修改相应的字段
否则，config文件中的配置参数不会生效。这里工程师将图像频率改为25hz，imu频率改为200hz
orbslam3 ros中自定义msg的添加和topic订阅 随后是orbslam3中的ros程序修改：
工程师将Example_old/ros 拷贝到了 Example中
然后在build_ros.sh文件中添加如下命令：
运行 build_ros.sh后出现报错：
解决方法：将Thirdparty中的Sophus依赖加入到ros中的Cmakelist.txt中。如下：
再次运行后显示成功。
然后 在终端输入：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/fbad6b9fcda5c2c43d1ba1d5c08abd14/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-15T16:24:14+08:00" />
<meta property="article:modified_time" content="2022-04-15T16:24:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">教程更新丨手把手带你玩转ORB-SLAM3（2.0）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>是的，你没看错！「手把手带你玩转ORB-SLAM3」教程2.0来了，在原有教程基础上更细节、更全面，不仅有SDK及ORB-SLAM3安装过程中的各种常见性问题解决方法及安装细节，同时还提供官方完整编译代码包哦，真正带你手把手~</p> 
<p>本文主要讲解如何在orb-slam3中使用ros接入INDEMIND的双目鱼眼+imu模组。</p> 
<p><strong>具体分为以下4部分：</strong></p> 
<ul><li>SDK安装</li><li>orb-slam3安装</li><li>SDK orb-slam3中ROS程序修改和配置文件</li><li>运行</li></ul> 
<p><strong>其中【SDK orbslam3中ROS程序修改和配置文件】又分为4部分：</strong></p> 
<ul><li>SDK中ros程序的修改</li><li>orbslam3 ros中自定义msg的添加和topic订阅</li><li>orbslam3 ros中配置文件的修改</li><li>orbslam3 中读取配置文件代码修改</li></ul> 
<p><strong>本文操作系统：</strong>ubuntu18.04</p> 
<p><strong>完整代码包下载地址：</strong>https://github.com/INDEMIND/ORB-SLAM3-Course</p> 
<h2><strong>一、SDK安装</strong></h2> 
<p><strong>SDK下载及准备安装：</strong></p> 
<p>安装过程主要参考产品手册中Ubuntu一节，官方产品手册地址：https://imsee-sdk-docs.readthedocs.io/zh/latest/src/sdk/contents.html</p> 
<p><strong>1.安装依赖：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/9b/a8/pO9FGyL5_o.png"></p> 
<p><strong>2.然后使用git下载 SDK：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f3/ea/Kqm9YFNq_o.png"></p> 
<p><strong>3.准备安装SDK需要的依赖，执行以下命令即可：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4a/19/aLCgJx79_o.png"></p> 
<h2><strong>安装OpenCV3.4.3版本</strong></h2> 
<p><strong>1.为什么安装OpenCV3.4.3版本？</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c9/df/nTPSM96g_o.png"></p> 
<p><strong>解决方法：</strong>安装OpenCV3.4.3版本，并把SDK中的libIndemind.so替换掉</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ce/34/8P4NDeiW_o.png"></p> 
<p><strong>2.安装Opencv参考如下：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ed/a5/32Owyzpn_o.png"></p> 
<p><strong>MNN安装：</strong></p> 
<p>因为MNN依赖protobuf，而安装protbuf有两种方式，一种是源码安装（可参见产品手册），另一种方法如下（较容易）：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a8/89/1MQnNuQO_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ec/88/p76z91UP_o.png"></p> 
<p>完成这些步骤，SDK就安装完毕了。</p> 
<h2><strong>二、orb-slam3安装</strong></h2> 
<p><strong>如何安装：</strong></p> 
<p>具体安装过程请参考orbslam3官网。</p> 
<p><strong>安装注意：</strong></p> 
<p>orbslam3依赖的opencv是4.4以上的版本，而Indemind的sdk使用的是3.4.3版本。因此，需要修改orbslam3的工程，方法如下：</p> 
<p><strong>1.打开orbslam3工程的cmakelist.txt找到如下片段：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/ec/db/vq9ZXpKZ_o.png"></p> 
<p><strong>2.然后将该片段注释掉并添加代码，修改如下：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/0a/4b/digdn2CM_o.png"></p> 
<p><strong>3.之后进行编译，成功后如下：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/12/91/dJA14k9G_o.png"></p> 
<p><strong>4.运行如下：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e4/53/qbBN1dqG_o.png"></p> 
<p><strong>5.编译中的问题：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c1/47/7lPHl9Lf_o.png"></p> 
<p><strong>解决方法：</strong>修改 build.sh文件 将其中的make -j 改为 make -j2 或者-j1。</p> 
<p>至此，ORB-SLAM3的安装结束。</p> 
<h2><strong>三、SDK orb-slam3中ROS程序修改与配置文件</strong></h2> 
<ul><li><strong>SDK中ros程序的修改</strong></li></ul> 
<p><strong>接下来是介绍SDK中的ros程序imsee_ros_wrapper，浏览${xx}/sdk/IMSEE-SDK/ros/src/imsee_ros_wrapper的目录：</strong>${xx}是下载sdk的路径</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d9/22/ypAW6ud9_o.png"></p> 
<p>其中添加了自定义的msg文件夹，里面包含了自定义的设备信息消息。主要包含双目鱼眼相机的参数和imu参数。</p> 
<p><strong>在src/wrapper_nodelet.cc中添加了发送设备信息函数和对应的topic：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/35/fe/Mop8RrJS_o.png"></p> 
<p><strong>从SDK接口中读取设备信息，使用ROS Topic方式，将信息发送出去。</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/7f/8e/q4DcTTcy_o.png"></p> 
<p><strong>程序中ros参数器的读取，需要修改相应的字段</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4a/47/bnH0hnar_o.png"></p> 
<p>否则，config文件中的配置参数不会生效。<strong>这里工程师将图像频率改为25hz，imu频率改为200hz</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a3/73/abvjXNoa_o.png"></p> 
<ul><li><strong>orbslam3 ros中自定义msg的添加和topic订阅</strong></li></ul> 
<p><strong>随后是orbslam3中的ros程序修改：</strong></p> 
<p>工程师将Example_old/ros 拷贝到了 Example中</p> 
<p><strong>然后在build_ros.sh文件中添加如下命令：</strong></p> 
<p><strong>运行 build_ros.sh后出现报错：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/20/3f/NOvsPYyU_o.png"></p> 
<p><strong>解决方法：</strong>将Thirdparty中的Sophus依赖加入到ros中的Cmakelist.txt中。如下：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/56/9e/obgfmpO4_o.png"></p> 
<p>再次运行后显示成功。</p> 
<p><strong>然后 在终端输入：</strong></p> 
<p>source Example/ROS/build/devel/setup.bash</p> 
<p>也可以直接写入到.bashrc文件</p> 
<p><strong>下面是使用命令提示：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f4/ff/Ep050GmO_o.png"></p> 
<p><strong>开ros_stereo.cc文件</strong></p> 
<p><strong>订阅主题需要修改一下：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d1/a9/K8Otu37b_o.png"></p> 
<p>上图紫色部分是SDK发布出来的topic，订阅imu数据和左右目数据，具体可以查看SDK的文档。</p> 
<ul><li><strong>orbslam3 ros中配置文件的修改</strong></li></ul> 
<p><strong>为了能接受imsee_ros_wrapper发出的自定义设备信息，首先在对应的cmakelist.txt中添加：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6c/6a/O1vuN1wB_o.png"></p> 
<p><strong>在ros_stereo_inertial.cc中添加头文件：</strong></p> 
<p>#include&lt;imsee_ros_wrapper/DeviceInfo.h&gt;</p> 
<p><strong>在manifest.xml中添加：</strong></p> 
<p>&lt;depend package="imsee_ros_wrapper"/&gt;</p> 
<p><strong>定义IndemindParams类，该类的主要功能是将设备信息中的外参进行必要的变换，并重新写入到配置文件中。</strong></p> 
<p><strong>在main函数中添加，一次性接受</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/db/b5/0vYyq3DR_o.png"></p> 
<p><strong>rostopic的代码：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a7/1d/SDmLCvdG_o.png"></p> 
<p>该代码在接受信息后，会调用函数CalculateTransforms，生成左右目之间的外参数Tlr和camera到Imu的外参数Tbc。<strong>然后再调用函数ReplaceParamsInYaml(argv[2])，在argv[2]对应的文件中写入Indemind的参数</strong>（参数的key都采用的下划线）：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/92/5d/tefBdwGR_o.png"></p> 
<p><strong>同时，Tlr和Tbc都以vector的方式写入到文件中。如下示例：</strong></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/75/80/4cYRAX3U_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/64/e1/MfYsSXFR_o.png"></p> 
<ul><li><strong>orbslam3 中读取配置文件代码修改</strong></li></ul> 
<p>orbslam3的tracking.cc文件中的函数<strong>ParseCamParamFile和ParseIMUParamFile</strong>需要修改其读入字段（需修改字段即上方两个截图），对应的修改代码如下：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/91/b6/ryjT5dvH_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a5/b5/krJaZL5Y_o.png"></p> 
<p>至此修改完毕。</p> 
<h2><strong>四、运行</strong></h2> 
<p><strong>启动SDK ros wrapper ：</strong></p> 
<p>roslaunch imsee_ros_wrapper start.launch</p> 
<p><strong>启动orb-slam3 ros stereo inertial：</strong></p> 
<p>rosrun ORB_SLAM3 Stereo_Inertial Vocabulary/ORBvoc.txtExamples/ROS/ORB_SLAM3/Indemind_stereo_imu_fisheye.yaml 0</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/de/b8/TlHZ9VSU_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/94/1a/j7GbKh4T_o.png"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8412e09012cf2720f3a9cc21304988b0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">将inputstream转化为数组byte[]</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/56aaba4d0f694c3ded756b5f6bbd20cc/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">记录＜a-tabs＞ ＜a-tab-pane＞遍历数组赋值问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>