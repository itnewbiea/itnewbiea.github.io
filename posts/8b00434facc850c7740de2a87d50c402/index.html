<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>AIé¡¹ç›®åå…«ï¼šYOLOV8è‡ªè®­ç»ƒå…³é”®ç‚¹æ£€æµ‹ - ITå­¦ä¹ è€…åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="AIé¡¹ç›®åå…«ï¼šYOLOV8è‡ªè®­ç»ƒå…³é”®ç‚¹æ£€æµ‹" />
<meta property="og:description" content="è‹¥è¯¥æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡å‡ºå¤„ã€‚
è®°å½•å­¦ä¹ YOLOV8è¿‡ç¨‹ï¼Œè‡ªè®­ç»ƒå…³é”®ç‚¹æ£€æµ‹æ¨¡å‹ã€‚
æ¸…åæºï¼š-i https://mirror.baidu.com/pypi/simple
1ã€yolov8å®‰è£… git clone https://github.com/ultralytics/ultralytics â€‹ cd ultralytics â€‹ pip install -e . å®‰è£…æˆåŠŸåï¼Œä½¿ç”¨å‘½ä»¤ yolo ç®€å•çœ‹ä¸‹ç‰ˆæœ¬
(yolov8) llh@anhao:/$ yolo version â€‹ 8.0.206 2ã€ç®€å•æµ‹è¯• ä¸‹è½½æƒé‡æ–‡ä»¶
GitHub - ultralytics/ultralytics: NEW - YOLOv8 ğŸš€ in PyTorch &gt; ONNX &gt; OpenVINO &gt; CoreML &gt; TFLite
ç›´æ¥ç‚¹å‡»ä¸‹è½½ã€‚
è·å–æµ‹è¯•å›¾ç‰‡çš„æ–‡ä»¶åœ¨ultralytics\assetsç›®å½•æœ‰ï¼Œä½¿ç”¨çš„æ˜¯çš„é‡Œé¢çš„bus.jpgæµ‹è¯•ã€‚
ä½¿ç”¨ yolo å‘½ä»¤è¿›è¡Œæµ‹è¯•
yolo detect predict model=./yolov8n.pt source=./bus.jpg è¾“å‡ºåœ¨runs/detect/predict/ç›®å½•ä¸‹ã€‚
3ã€å®‰è£…labelme pip install labelme ç›´æ¥åœ¨ç»ˆç«¯è¿è¡Œlabelmeæ‰“å¼€è½¯ä»¶
å…ˆå–æ¶ˆâ€œä¿å­˜å›¾ç‰‡æ•°æ®â€ï¼ˆå‡å°‘æ ‡æ³¨æ–‡ä»¶å¤§å°ï¼‰ï¼›åœ¨æ–‡ä»¶ä¸‹
æ‰“å¼€æ–‡ä»¶ç›®å½•
æ¥ä¸‹æ¥æ ‡æ³¨
å…ˆæ ‡æ³¨æ£€æµ‹æ¡†ï¼Œæ£€æµ‹æ¡†ç”¨Create Rectangle(Ctrl&#43;N)
å¡«å†™ç±»åˆ«åç§°
å¡«å†™group_idï¼Œç”¨äºåŒ¹é…åç»­æ ‡æ³¨çš„å…³é”®ç‚¹ï¼Œä»¥å½“å‰ç”»é¢ä¸­å‡ºç°çš„é¡ºåºæ ‡æ³¨å³å¯ã€‚
æ ‡æ³¨å…³é”®ç‚¹,æ£€æµ‹å…³é”®ç‚¹ç”¨Create Point" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8b00434facc850c7740de2a87d50c402/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-17T13:19:13+08:00" />
<meta property="article:modified_time" content="2023-12-17T13:19:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ITå­¦ä¹ è€…åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ITå­¦ä¹ è€…åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">AIé¡¹ç›®åå…«ï¼šYOLOV8è‡ªè®­ç»ƒå…³é”®ç‚¹æ£€æµ‹</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>è‹¥è¯¥æ–‡ä¸ºåŸåˆ›æ–‡ç« ï¼Œè½¬è½½è¯·æ³¨æ˜åŸæ–‡å‡ºå¤„ã€‚</p> 
<p>è®°å½•å­¦ä¹ YOLOV8è¿‡ç¨‹ï¼Œè‡ªè®­ç»ƒå…³é”®ç‚¹æ£€æµ‹æ¨¡å‹ã€‚</p> 
<p>æ¸…åæºï¼š-i <a href="https://mirror.baidu.com/pypi/simple" rel="nofollow" title="https://mirror.baidu.com/pypi/simple">https://mirror.baidu.com/pypi/simple</a></p> 
<h4>1ã€yolov8å®‰è£…</h4> 
<pre><code>git clone https://github.com/ultralytics/ultralytics
â€‹
cd ultralytics
â€‹
pip install -e .</code></pre> 
<p>å®‰è£…æˆåŠŸåï¼Œä½¿ç”¨å‘½ä»¤ <em>yolo</em> ç®€å•çœ‹ä¸‹ç‰ˆæœ¬</p> 
<pre><code>(yolov8) llh@anhao:/$ yolo version
â€‹
8.0.206</code></pre> 
<h4>2ã€ç®€å•æµ‹è¯•</h4> 
<p>ä¸‹è½½æƒé‡æ–‡ä»¶</p> 
<p><a href="https://github.com/ultralytics/ultralytics" title="GitHub - ultralytics/ultralytics: NEW - YOLOv8 ğŸš€ in PyTorch &gt; ONNX &gt; OpenVINO &gt; CoreML &gt; TFLite">GitHub - ultralytics/ultralytics: NEW - YOLOv8 ğŸš€ in PyTorch &gt; ONNX &gt; OpenVINO &gt; CoreML &gt; TFLite</a></p> 
<p><img alt="" height="426" src="https://images2.imgbox.com/65/52/iBaPzzqh_o.png" width="911"></p> 
<p>ç›´æ¥ç‚¹å‡»ä¸‹è½½ã€‚</p> 
<p>è·å–æµ‹è¯•å›¾ç‰‡çš„æ–‡ä»¶åœ¨ultralytics\assetsç›®å½•æœ‰ï¼Œä½¿ç”¨çš„æ˜¯çš„é‡Œé¢çš„bus.jpgæµ‹è¯•ã€‚</p> 
<p></p> 
<p>ä½¿ç”¨ yolo å‘½ä»¤è¿›è¡Œæµ‹è¯•</p> 
<pre>yolo detect predict model=./yolov8n.pt source=./bus.jpg</pre> 
<p><img alt="" height="179" src="https://images2.imgbox.com/bc/1b/dnAYebv4_o.png" width="1000">è¾“å‡ºåœ¨runs/detect/predict/ç›®å½•ä¸‹ã€‚</p> 
<p><img alt="" height="789" src="https://images2.imgbox.com/e1/5d/t5VGM5sO_o.png" width="848"></p> 
<h4>3ã€å®‰è£…labelme</h4> 
<pre><code>pip install labelme</code></pre> 
<p>ç›´æ¥åœ¨ç»ˆç«¯è¿è¡Œ<strong>labelme</strong>æ‰“å¼€è½¯ä»¶</p> 
<p><img alt="" height="645" src="https://images2.imgbox.com/13/1a/epD1kMqe_o.png" width="989">å…ˆå–æ¶ˆâ€œ<strong>ä¿å­˜å›¾ç‰‡æ•°æ®</strong>â€ï¼ˆå‡å°‘æ ‡æ³¨æ–‡ä»¶å¤§å°ï¼‰ï¼›åœ¨æ–‡ä»¶ä¸‹</p> 
<p><img alt="" height="568" src="https://images2.imgbox.com/50/b4/M0wYy9b4_o.png" width="998">æ‰“å¼€æ–‡ä»¶ç›®å½•</p> 
<p><img alt="" height="626" src="https://images2.imgbox.com/1a/0a/mfrWsAtH_o.png" width="990"><strong>æ¥ä¸‹æ¥æ ‡æ³¨</strong></p> 
<ul><li> <p>å…ˆæ ‡æ³¨æ£€æµ‹æ¡†ï¼Œ<strong>æ£€æµ‹æ¡†ç”¨Create Rectangle(Ctrl+N)</strong></p> 
  <ul><li> <p>å¡«å†™ç±»åˆ«åç§°</p> </li><li> <p>å¡«å†™<code>group_id</code>ï¼Œç”¨äºåŒ¹é…åç»­æ ‡æ³¨çš„å…³é”®ç‚¹ï¼Œä»¥å½“å‰ç”»é¢ä¸­å‡ºç°çš„é¡ºåºæ ‡æ³¨å³å¯ã€‚</p> </li></ul></li></ul> 
<ul><li> <p><img alt="" height="627" src="https://images2.imgbox.com/c2/1a/qIbHfzMZ_o.png" width="965">æ ‡æ³¨å…³é”®ç‚¹,æ£€æµ‹å…³é”®ç‚¹ç”¨<strong>Create Point</strong></p> 
  <ul><li> <p>æŒ‰å…³é”®ç‚¹é¡ºåºæ ‡æ³¨ï¼Œå¦‚æˆ‘ä»¬çš„é¡ºåºæ˜¯<code>head</code>ã€<code>tail</code>ï¼Œä¸å¯ä»¥é”™ï¼›</p> </li><li> <p>å¡«å†™å…³é”®ç‚¹åç§°ï¼Œå¦‚è¿™é‡Œæ˜¯<code>head</code>ï¼›</p> </li><li> <p>å¡«å†™å…³é”®ç‚¹æ‰€åœ¨ç‰©ä½“çš„<code>group_id</code>ï¼ŒåŒ¹é…æ£€æµ‹æ¡†</p> </li></ul></li></ul> 
<p><img alt="" height="432" src="https://images2.imgbox.com/35/1a/5F82KGUf_o.png" width="919"><strong>æ³¨æ„ï¼Œå¦‚æœå¤šä¸ªç±»å‹éœ€è¦å¡«å†™group_idï¼Œgroup_idè¦åŒ¹é…æ£€æµ‹æ¡†</strong></p> 
<h4>4ã€æŠŠJSONè½¬æˆTXT</h4> 
<p>ä½¿ç”¨labelmeæ ‡æ³¨ç”Ÿæˆçš„JSONæ–‡ä»¶ï¼Œä¸èƒ½ç›´æ¥è®­ç»ƒï¼Œæ‰€ä»¥éœ€è¦æŠŠJSONæ–‡ä»¶è½¬æˆTXTæ–‡ä»¶ã€‚</p> 
<p>æ‰“å¼€ä¸€ä¸ªæ ‡æ³¨<code>json</code>æ–‡ä»¶ï¼Œå†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p> 
<pre><code>version": "5.3.1",
  "flags": {},
  "shapes": [
 Â   {
 Â  Â   "label": "smoke",
 Â  Â   "points": [
 Â  Â  Â   [
 Â  Â  Â  Â   389.0,
 Â  Â  Â  Â   72.5
 Â  Â  Â   ],
 Â  Â  Â   [
 Â  Â  Â  Â   957.0,
 Â  Â  Â  Â   114.5
 Â  Â  Â   ],
 Â  Â  Â   [
 Â  Â  Â  Â   949.0,
 Â  Â  Â  Â   192.5
 Â  Â  Â   ],
 Â  Â  Â   [
 Â  Â  Â  Â   379.0,
 Â  Â  Â  Â   162.5
 Â  Â  Â   ]
 Â  Â   ],
 Â  Â   "group_id": null,
 Â  Â   "description": "",
 Â  Â   "shape_type": "polygon",
 Â  Â   "flags": {}
 Â   },</code></pre> 
<p>ä½†æ˜¯yolov8 è¦æ±‚çš„æ ‡æ³¨æ–‡ä»¶é•¿è¿™æ ·</p> 
<pre><code>0 0.662641 0.494385 0.674719 0.988771 0.717187 0.189583 2.000000 0.798438 0.127083 2.000000 0.701562 0.091667 2.000000 0.921875 0.118750 2.000000 0.000000 0.000000 0.000000 0.971875 0.379167 2.000000 0.554688 0.262500 2.000000 0.000000 0.000000 0.000000 0.367188 0.427083 2.000000 0.767188 0.772917 2.000000 0.421875 0.500000 2.000000 0.829688 0.960417 1.000000 0.517188 0.881250 1.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000 0.000000</code></pre> 
<p>æ ¹æ®è¿™äº›è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªè½¬æ¢è„šæœ¬ï¼Œå°†<code>labelme</code>æ ‡æ³¨çš„<code>json</code>æ ¼å¼è½¬ä¸º<code>yolo</code>æ ¼å¼</p> 
<p><strong>labelme2yolo.py</strong></p> 
<pre><code># å°†labelmeæ ‡æ³¨çš„jsonæ–‡ä»¶è½¬ä¸ºyoloæ ¼å¼
import os
import cv2
import numpy as np
import matplotlib.pyplot as plt
import glob
import json
import tqdm
â€‹
â€‹
# ç‰©ä½“ç±»åˆ«
class_list = ["smoke"]
# å…³é”®ç‚¹çš„é¡ºåº
keypoint_list = ["head", "tail"]
â€‹
â€‹
def json_to_yolo(img_data,json_data):
 Â   h,w = img_data.shape[:2]
 Â   # æ­¥éª¤ï¼š
 Â   # 1. æ‰¾å‡ºæ‰€æœ‰çš„çŸ©å½¢ï¼Œè®°å½•ä¸‹çŸ©å½¢çš„åæ ‡ï¼Œä»¥åŠå¯¹åº”group_id
 Â   # 2. éå†æ‰€æœ‰çš„headå’Œtailï¼Œè®°ä¸‹ç‚¹çš„åæ ‡ï¼Œä»¥åŠå¯¹åº”group_idï¼ŒåŠ å…¥åˆ°å¯¹åº”çš„çŸ©å½¢ä¸­
 Â   # 3. è½¬ä¸ºyoloæ ¼å¼
â€‹
 Â   rectangles = {}
 Â   # éå†åˆå§‹åŒ–
 Â   for shape in json_data["shapes"]:
 Â  Â  Â   label = shape["label"] # pen, head, tail
 Â  Â  Â   group_id = shape["group_id"] # 0, 1, 2, ...
 Â  Â  Â   points = shape["points"] # x,y coordinates
 Â  Â  Â   shape_type = shape["shape_type"]
â€‹
 Â  Â  Â   # åªå¤„ç†çŸ©å½¢
 Â  Â  Â   if shape_type == "rectangle":
 Â  Â  Â  Â  Â   if group_id not in rectangles:
 Â  Â  Â  Â  Â  Â  Â   rectangles[group_id] = {
 Â  Â  Â  Â  Â  Â  Â  Â  Â   "label": label,
 Â  Â  Â  Â  Â  Â  Â  Â  Â   "rect": points[0] + points[1],  # Rectangle [x1, y1, x2, y2]
 Â  Â  Â  Â  Â  Â  Â  Â  Â   "keypoints_list": []
 Â  Â  Â  Â  Â  Â  Â   }
 Â   # éå†æ›´æ–°ï¼Œå°†ç‚¹åŠ å…¥å¯¹åº”group_idçš„çŸ©å½¢ä¸­
 Â   for keypoint in keypoint_list:
 Â  Â  Â   for shape in json_data["shapes"]:
 Â  Â  Â  Â  Â   label = shape["label"]
 Â  Â  Â  Â  Â   group_id = shape["group_id"]
 Â  Â  Â  Â  Â   points = shape["points"]
 Â  Â  Â  Â  Â   # å¦‚æœåŒ¹é…åˆ°äº†å¯¹åº”çš„keypoint
 Â  Â  Â  Â  Â   if label == keypoint:
 Â  Â  Â  Â  Â  Â  Â   rectangles[group_id]["keypoints_list"].append(points[0])
 Â  Â 
 Â   # è½¬ä¸ºyoloæ ¼å¼
 Â   yolo_list = []
 Â   for id, rectangle in rectangles.items():
 Â  Â  Â   result_list  = []
 Â  Â  Â   label_id = class_list.index(rectangle["label"])
 Â  Â  Â   # x1,y1,x2,y2
 Â  Â  Â   x1,y1,x2,y2 = rectangle["rect"]
 Â  Â  Â   # center_x, center_y, width, height
 Â  Â  Â   center_x = (x1+x2)/2
 Â  Â  Â   center_y = (y1+y2)/2
 Â  Â  Â   width = abs(x1-x2)
 Â  Â  Â   height = abs(y1-y2)
 Â  Â  Â   # normalize
 Â  Â  Â   center_x /= w
 Â  Â  Â   center_y /= h
 Â  Â  Â   width /= w
 Â  Â  Â   height /= h
â€‹
 Â  Â  Â   # ä¿ç•™6ä½å°æ•°
 Â  Â  Â   center_x = round(center_x, 6)
 Â  Â  Â   center_y = round(center_y, 6)
 Â  Â  Â   width = round(width, 6)
 Â  Â  Â   height = round(height, 6)
â€‹
â€‹
 Â  Â  Â   # æ·»åŠ  label_id, center_x, center_y, width, height
 Â  Â  Â   result_list = [label_id, center_x, center_y, width, height]
â€‹
 Â  Â  Â   # æ·»åŠ  p1_x, p1_y, p1_v, p2_x, p2_y, p2_v
 Â  Â  Â   for point in rectangle["keypoints_list"]:
 Â  Â  Â  Â  Â   x,y = point
 Â  Â  Â  Â  Â   x,y = int(x), int(y)
 Â  Â  Â  Â  Â   # normalize
 Â  Â  Â  Â  Â   x /= w
 Â  Â  Â  Â  Â   y /= h
 Â  Â  Â  Â  Â   # ä¿ç•™6ä½å°æ•°
 Â  Â  Â  Â  Â   x = round(x, 6)
 Â  Â  Â  Â  Â   y = round(y, 6)
 Â  Â  Â  Â  Â  Â 
 Â  Â  Â  Â  Â   result_list.extend([x,y,2])
â€‹
 Â  Â  Â   yolo_list.append(result_list)
 Â  Â 
 Â   return yolo_list
â€‹
â€‹
# è·å–æ‰€æœ‰çš„å›¾ç‰‡
img_list = glob.glob("./*.jpg")
â€‹
for img_path in tqdm.tqdm( img_list ):
 Â  Â  Â  Â 
 Â   img = cv2.imread(img_path)
 Â   print(img_path)
 Â   json_file = img_path.replace('jpg', 'json')
 Â   with open(json_file) as json_file:
 Â  Â  Â   json_data = json.load(json_file)
â€‹
 Â   yolo_list = json_to_yolo(img, json_data)
 Â  Â 
 Â   yolo_txt_path = img_path.replace('jpg', 'txt')
 Â   with open(yolo_txt_path, "w") as f:
 Â  Â  Â   for yolo in yolo_list:
 Â  Â  Â  Â  Â   for i in range(len(yolo)):
 Â  Â  Â  Â  Â  Â  Â   if i == 0:
 Â  Â  Â  Â  Â  Â  Â  Â  Â   f.write(str(yolo[i]))
 Â  Â  Â  Â  Â  Â  Â   else:
 Â  Â  Â  Â  Â  Â  Â  Â  Â   f.write(" " + str(yolo[i]))
 Â  Â  Â  Â  Â   f.write("\n")
â€‹</code></pre> 
<p>è¿è¡Œåï¼ŒæŠŠJSONç”ŸæˆTXTã€‚</p> 
<p><img alt="" height="789" src="https://images2.imgbox.com/ad/ad/7W495z3q_o.png" width="816"></p> 
<h4>5ã€å¯¹yoloæ ¼å¼çš„æ ‡æ³¨è¿›è¡Œå¯è§†åŒ–ã€‚æ£€æŸ¥æ ‡æ³¨æ˜¯å¦æ­£ç¡®ã€‚</h4> 
<p>å…ˆå®‰è£…jupyter</p> 
<pre><code>pip install jupyter</code></pre> 
<p>ç„¶ååœ¨ç»ˆç«¯è¾“å…¥</p> 
<pre><code>jupyter-lab</code></pre> 
<pre><code>import os
import cv2
import numpy as np
import matplotlib.pyplot as plt
import glob

img_path = './images/1.original_annotated/1 (20).jpg'

plt.figure(figsize=(15,10))
img = cv2.imread(img_path)
plt.imshow(img[:,:,::-1])
plt.axis('off')

yolo_txt_path = img_path.replace('jpg', 'txt')
print(yolo_txt_path)

with open(yolo_txt_path, 'r') as f:
    lines = f.readlines()

lines = [x.strip() for x in lines]

label = np.array([x.split() for x in lines], dtype=np.float32)

# ç‰©ä½“ç±»åˆ«
class_list = ["smoke"]
# ç±»åˆ«çš„é¢œè‰²
class_color = [(255, 0, 0), (0, 255, 0), (0, 0, 255), (255,255,0)]
# å…³é”®ç‚¹çš„é¡ºåº
keypoint_list = ["head", "tail"]
# å…³é”®ç‚¹çš„é¢œè‰²
keypoint_color = [(255, 0, 0), (0, 255, 0)]

# ç»˜åˆ¶æ£€æµ‹æ¡†
img_copy = img.copy()
h,w = img_copy.shape[:2]
for id,l in enumerate( label ):
    # label_id ,center x,y and width, height
    label_id, cx, cy, bw, bh = l[0:5]
    label_text = class_list[int(label_id)]
    # rescale to image size
    cx *= w
    cy *= h
    bw *= w
    bh *= h
    
    # draw the bounding box
    xmin = int(cx - bw/2)
    ymin = int(cy - bh/2)
    xmax = int(cx + bw/2)
    ymax = int(cy + bh/2)
    cv2.rectangle(img_copy, (xmin, ymin), (xmax, ymax), class_color[int(label_id)], 2)
    cv2.putText(img_copy, label_text, (xmin, ymin-10), cv2.FONT_HERSHEY_SIMPLEX, 1, class_color[int(label_id)], 2)


# display the image
plt.figure(figsize=(15,10))
plt.imshow(img_copy[:,:,::-1])
plt.axis('off')
# save the image
cv2.imwrite("./tmp.jpg", img_copy)

img_copy = img.copy()
h,w = img_copy.shape[:2]
for id,l in enumerate( label ):
    # label_id ,center x,y and width, height
    label_id, cx, cy, bw, bh = l[0:5]
    label_text = class_list[int(label_id)]
    # rescale to image size
    cx *= w
    cy *= h
    bw *= w
    bh *= h
    
    # draw the bounding box
    xmin = int(cx - bw/2)
    ymin = int(cy - bh/2)
    xmax = int(cx + bw/2)
    ymax = int(cy + bh/2)
    cv2.rectangle(img_copy, (xmin, ymin), (xmax, ymax), class_color[int(label_id)], 2)
    cv2.putText(img_copy, label_text, (xmin, ymin-10), cv2.FONT_HERSHEY_SIMPLEX, 2, class_color[int(label_id)], 2)
    
    # draw 17 keypoints, px,py,pv,px,py,pv...
    for i in range(5, len(l), 3):
        px, py, pv = l[i:i+3]
        # rescale to image size
        px *= w
        py *= h
        # puttext the index 
        index = int((i-5)/3)
        # draw the keypoints
        cv2.circle(img_copy, (int(px), int(py)), 10, keypoint_color[int(index)], -1)
        keypoint_text = "{}_{}".format(index, keypoint_list[index])
        cv2.putText(img_copy, keypoint_text, (int(px), int(py)-10), cv2.FONT_HERSHEY_SIMPLEX, 1, keypoint_color[int(index)], 2)

plt.figure(figsize=(15,10))
plt.imshow(img_copy[:,:,::-1])
plt.axis('off')
# save 
cv2.imwrite('./tmp.jpg', img_copy)</code></pre> 
<p><img alt="" height="681" src="https://images2.imgbox.com/17/61/jbVJTqLo_o.png" width="733"></p> 
<h4>6ã€è®­ç»ƒ</h4> 
<p id="2-5-2-ç»„ç»‡ç›®å½•ç»“æ„">ç»„ç»‡ç›®å½•ç»“æ„ï¼Œæˆ‘æ˜¯ç›´æ¥æŠŠdatasetsç›®å½•æ”¾åˆ°yolov8çš„æ ¹ç›®å½•ä¸‹ï¼š</p> 
<p><img alt="" height="354" src="https://images2.imgbox.com/89/26/dlrd66PT_o.png" width="414"></p> 
<ul><li>å›¾ç‰‡Â <code>datasets/custom_dataset/images/train/{æ–‡ä»¶å}.jpg</code>å¯¹åº”çš„æ ‡æ³¨æ–‡ä»¶åœ¨Â <code>datasets/custom_dataset/labels/train/{æ–‡ä»¶å}.txt</code>ï¼ŒYOLOä¼šæ ¹æ®è¿™ä¸ªæ˜ å°„å…³ç³»è‡ªåŠ¨å¯»æ‰¾ï¼ˆ<code>images</code>æ¢æˆ<code>labels</code>ï¼‰ï¼›</li><li>è®­ç»ƒé›†å’ŒéªŒè¯é›† 
  <ul><li><code>images</code>æ–‡ä»¶å¤¹ä¸‹æœ‰<code>train</code>å’Œ<code>val</code>æ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«æ”¾ç½®è®­ç»ƒé›†å’ŒéªŒè¯é›†å›¾ç‰‡;</li><li><code>labels</code>æ–‡ä»¶å¤¹æœ‰<code>train</code>å’Œ<code>val</code>æ–‡ä»¶å¤¹ï¼Œåˆ†åˆ«æ”¾ç½®è®­ç»ƒé›†å’ŒéªŒè¯é›†æ ‡ç­¾(yoloæ ¼å¼ï¼‰ã€‚</li></ul></li></ul> 
<p id="2-5-3-é…ç½®æ–‡ä»¶"><strong>é…ç½®æ–‡ä»¶smoke.yaml</strong></p> 
<pre><code># Ultralytics YOLO ğŸš€, AGPL-3.0 license
# COCO8-pose dataset (first 8 images from COCO train2017) by Ultralytics
# Example usage: yolo train data=coco8-pose.yaml
# parent
# â”œâ”€â”€ ultralytics
# â””â”€â”€ datasets
#     â””â”€â”€ coco8-pose  â† downloads here (1 MB)


# Train/val/test sets as 1) dir: path/to/imgs, 2) file: path/to/imgs.txt, or 3) list: [path/to/imgs1, path/to/imgs2, ..]
path: ../datasets/custom_dataset  # dataset root dir
train: images/train  # train images (relative to 'path') 4 images
val: images/val  # val images (relative to 'path') 4 images
test:  # test images (optional)

# Keypoints
kpt_shape: [2, 3]  # number of keypoints, number of dims (2 for x,y or 3 for x,y,visible)
#flip_idx: [0, 2, 1, 4, 3, 6, 5, 8, 7, 10, 9, 12, 11, 14, 13, 16, 15]

# Classes
names:
  0: smoke

# Download script/URL (optional)
#download: https://ultralytics.com/assets/coco8-pose.zip
</code></pre> 
<p>ç·¨å¯«è¨“ç·´train.pyï¼Œè¨“ç·´è‡ªå·±çš„æ¨¡å‹</p> 
<pre><code>from ultralytics import YOLO

# åŠ è½½æ¨¡å‹
# model = YOLO('yolov8s-pose.yaml')  # ä»å¤´è®­ç»ƒ
model = YOLO('./yolov8s-pose.pt')  # ä½¿ç”¨é¢„è®­ç»ƒæ¨¡å‹ (recommended for training)
# model = YOLO('yolov8s-pose.yaml').load('yolov8s-pose.pt')  # ä»yamlæ„å»ºç½‘ç»œå¹¶ä»é¢„è®­ç»ƒæ¨¡å‹ä¸­è¿ç§»æƒé‡

# è®­ç»ƒ
results = model.train(data='./smoke_pose.yaml', epochs=300, imgsz=640, workers=0, batch=20, project="pen_bolt", name="s120")</code></pre> 
<p>æ‰§è¡Œpython train.py</p> 
<p><img alt="" height="299" src="https://images2.imgbox.com/6f/38/iVCIuNib_o.png" width="1200"></p> 
<p>ä¼šçœ‹åˆ°å¼€å§‹è®­ç»ƒï¼Œå¹¶åœ¨pen_bolt\s1202ä¸‹çœ‹åˆ°è®­ç»ƒçš„ç»“æœã€‚</p> 
<p><img alt="" height="836" src="https://images2.imgbox.com/dd/f3/LnykRFxq_o.png" width="822"></p> 
<h4>7ã€æµ‹è¯•</h4> 
<p>ç”±äºæ•°æ®é›†æ‰20å¼ ä¸”åªè®­ç»ƒäº†120è½®ï¼Œæ•ˆæœä¸æ˜¯å¤ªå¥½ï¼Œæ‰€ä»¥è¿™é‡Œå°±ç›´æ¥ä½¿ç”¨å›¾ç‰‡æµ‹è¯•</p> 
<pre><code class="hljs"># æµ‹è¯•å›¾ç‰‡
from ultralytics import YOLO
import cv2
import numpy as np
import sys
# è¯»å–å‘½ä»¤è¡Œå‚æ•°
weight_path = "./pen_bolt/s1202/weights/best.pt"
media_path = "./test.jpg"

# åŠ è½½æ¨¡å‹
model = YOLO(weight_path )

# è·å–ç±»åˆ«
objs_labels = model.names  # get class labels
print(objs_labels)


# ç±»åˆ«çš„é¢œè‰²
class_color = [(255, 0, 0), (0, 255, 0), (0, 0, 255), (255,255,0)]
# å…³é”®ç‚¹çš„é¡ºåº
keypoint_list = ["head", "tail"]
# å…³é”®ç‚¹çš„é¢œè‰²
keypoint_color = [(255, 0, 0), (0, 255, 0)]

# è¯»å–å›¾ç‰‡
frame = cv2.imread(media_path)
frame = cv2.resize(frame, (frame.shape[1]//2, frame.shape[0]//2))
# rotate
# æ£€æµ‹
result = list(model(frame, conf=0.3, stream=True))[0]  # inferenceï¼Œå¦‚æœstream=Falseï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼Œå¦‚æœstream=Trueï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªç”Ÿæˆå™¨
boxes = result.boxes  # Boxes object for bbox outputs
boxes = boxes.cpu().numpy()  # convert to numpy array

# éå†æ¯ä¸ªæ¡†
for box in boxes.data:
    l,t,r,b = box[:4].astype(np.int32) # left, top, right, bottom
    conf, id = box[4:] # confidence, class
    id = int(id)
    # ç»˜åˆ¶æ¡†
    cv2.rectangle(frame, (l,t), (r,b), class_color[id], 2)
    # ç»˜åˆ¶ç±»åˆ«+ç½®ä¿¡åº¦ï¼ˆæ ¼å¼ï¼š98.1%ï¼‰
    cv2.putText(frame, f"{objs_labels[id]} {conf*100:.1f}%", (l, t-10), cv2.FONT_HERSHEY_SIMPLEX, 1, class_color[id], 2)

# éå†keypoints
keypoints = result.keypoints  # Keypoints object for pose outputs
keypoints = keypoints.cpu().numpy()  # convert to numpy array

# draw keypoints, set first keypoint is red, second is blue
for keypoint in keypoints.data:
    for i in range(len(keypoint)):
        x,y,c = keypoint[i]
        x,y = int(x), int(y)
        cv2.circle(frame, (x,y), 10, keypoint_color[i], -1)
        cv2.putText(frame, f"{keypoint_list[i]}", (x, y-10), cv2.FONT_HERSHEY_SIMPLEX, 1, keypoint_color[i], 2)
        
    if len(keypoint) &gt;= 2:
        # draw arrow line from tail to half between head and tail
        x1,y1,c1 = keypoint[0]
        x2,y2,c2 = keypoint[1]
        center_x, center_y = (x1+x2)/2, (y1+y2)/2
        cv2.arrowedLine(frame, (int(x2),int(y2)), (int(center_x), int(center_y)), (255,0,255), 4, line_type=cv2.LINE_AA, tipLength=0.1)
    

# save image
cv2.imwrite("result.jpg", frame)
print("save result.jpg")</code></pre> 
<p>ç›´æ¥python test.pyæµ‹è¯•ï¼Œæµ‹è¯•åŒä¸€æ–¹å‘è¿˜å¥½ï¼Œæ—‹è½¬æ–¹å‘åæœ‰ç‚¹ä¸å¯¹ï¼Œæ€€ç–‘æ˜¯æ•°æ®é›†å’Œå‚æ•°é—®é¢˜ï¼Œä½†æ•´ä¸ªè¿‡ç¨‹æ˜¯OKçš„ã€‚</p> 
<p><img alt="" height="636" src="https://images2.imgbox.com/bc/1b/m5WlJxim_o.png" width="639"></p> 
<p></p> 
<p></p> 
<p>å¦‚æœ‰ä¾µæƒï¼Œæˆ–éœ€è¦å®Œæ•´ä»£ç ï¼Œè¯·åŠæ—¶è”ç³»åšä¸»ã€‚</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/29bbb660cf4a3f41b2d81c2d9ea3bc4f/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ã€DataSophonã€‘å¤§æ•°æ®æœåŠ¡ç»„ä»¶ä¹‹Flinkå‡çº§</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/866aed64f8b70db0e59fd47734191607/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">Spring 6ï¼ˆäºŒï¼‰ã€IOCåŸç†ã€‘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ITå­¦ä¹ è€…åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>