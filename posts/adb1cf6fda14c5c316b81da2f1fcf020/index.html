<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>android Leakcanary/Studio Profiler/MAT 处理内存问题(泄漏和Big超大内存对象) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="android Leakcanary/Studio Profiler/MAT 处理内存问题(泄漏和Big超大内存对象)" />
<meta property="og:description" content="1.Android Leakcanary 使用 1.1在项目中依赖： 根据项目实际情况，选择对应的版本，因项目中暂时不支持android x，因此这里选择leakcanary 2.2版本。
//放开下边的代码,即可在debug包中使用leakcanary 检测内存泄露 debugImplementation &#39;com.squareup.leakcanary:leakcanary-android:2.2&#39; 1.2.运行项目查看内存泄漏信息。 在logcat 中，可以查看到泄漏的信息：
2022-08-31 11:14:07.757 32255-10246/com.xxx.miniworld D/LeakCanary: ==================================== //.... 1174715 bytes retained by leaking objects Signature: 4bfb4367c5b0b4b1a7aeb7ff3b45e02cba6a3d87 ┬─── │ GC Root: System class │ ├─ android.net.ConnectivityManager class │ Leaking: NO (a class is never leaking) │ ↓ static ConnectivityManager.sInstance │ ~~~~~~~~~ ├─ android.net.ConnectivityManager instance │ Leaking: UNKNOWN │ ↓ ConnectivityManager.mContext │ ~~~~~~~~ ╰→ org.appplay.minibrowser.BrowserActivity instance ​ Leaking: YES (ObjectWatcher was watching this because org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/adb1cf6fda14c5c316b81da2f1fcf020/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-09-01T16:53:21+08:00" />
<meta property="article:modified_time" content="2022-09-01T16:53:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">android Leakcanary/Studio Profiler/MAT 处理内存问题(泄漏和Big超大内存对象)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="1Android_Leakcanary__0"></a><strong>1.Android Leakcanary 使用</strong></h4> 
<h5><a id="11_2"></a><strong>1.1在项目中依赖</strong>：</h5> 
<p>根据项目实际情况，选择对应的版本，因项目中暂时不支持android x，因此这里选择leakcanary 2.2版本。</p> 
<pre><code class="prism language-groovy">    <span class="token comment">//放开下边的代码,即可在debug包中使用leakcanary 检测内存泄露</span>
    debugImplementation <span class="token string">'com.squareup.leakcanary:leakcanary-android:2.2'</span>
</code></pre> 
<h5><a id="12_11"></a><strong>1.2.运行项目查看内存泄漏信息</strong>。</h5> 
<p>在logcat 中，可以查看到泄漏的信息：</p> 
<pre><code class="prism language-java"><span class="token number">2022</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">31</span> <span class="token number">11</span><span class="token operator">:</span><span class="token number">14</span><span class="token operator">:</span><span class="token number">07.757</span> <span class="token number">32255</span><span class="token operator">-</span><span class="token number">10246</span><span class="token operator">/</span>com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>miniworld <span class="token class-name">D</span><span class="token operator">/</span><span class="token class-name">LeakCanary</span><span class="token operator">:</span> <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
    <span class="token comment">//....</span>
    <span class="token number">1174715</span> bytes retained by leaking objects
    <span class="token class-name">Signature</span><span class="token operator">:</span> <span class="token number">4</span>bfb4367c5b0b4b1a7aeb7ff3b45e02cba6a3d87
    ┬───
    │ GC <span class="token class-name">Root</span><span class="token operator">:</span> <span class="token class-name">System</span> <span class="token keyword">class</span>
    │
    ├─ <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>ConnectivityManager</span> <span class="token keyword">class</span>
    │    <span class="token class-name">Leaking</span><span class="token operator">:</span> NO <span class="token punctuation">(</span>a <span class="token keyword">class</span> is never leaking<span class="token punctuation">)</span>
    │    ↓ <span class="token keyword">static</span> <span class="token class-name">ConnectivityManager</span><span class="token punctuation">.</span>sInstance
    │                                 <span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span>
    ├─ <span class="token class-name"><span class="token namespace">android<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>ConnectivityManager</span> instance
    │    <span class="token class-name">Leaking</span><span class="token operator">:</span> UNKNOWN
    │    ↓ <span class="token class-name">ConnectivityManager</span><span class="token punctuation">.</span>mContext
    │                          <span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span><span class="token operator">~</span>
    ╰→ <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>appplay<span class="token punctuation">.</span>minibrowser<span class="token punctuation">.</span></span>BrowserActivity</span> instance
    ​     <span class="token class-name">Leaking</span><span class="token operator">:</span> YES <span class="token punctuation">(</span><span class="token class-name">ObjectWatcher</span> was watching <span class="token keyword">this</span> because <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>appplay<span class="token punctuation">.</span>minibrowser<span class="token punctuation">.</span></span>BrowserActivity</span> received <span class="token class-name">Activity</span>#<span class="token function">onDestroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> callback and <span class="token class-name">Activity</span>#mDestroyed is <span class="token boolean">true</span><span class="token punctuation">)</span>
    ​     key <span class="token operator">=</span> <span class="token number">2354</span>b5c5<span class="token operator">-</span><span class="token number">3110</span><span class="token operator">-</span><span class="token number">4</span>b61<span class="token operator">-</span><span class="token number">986</span>b<span class="token operator">-</span><span class="token number">99e7012</span>bf89a
    ​     watchDurationMillis <span class="token operator">=</span> <span class="token number">107085</span>
    ​     retainedDurationMillis <span class="token operator">=</span> <span class="token number">102084</span>
    <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
    <span class="token comment">//...</span>
    <span class="token class-name">Build</span><span class="token punctuation">.</span>VERSION<span class="token punctuation">.</span>SDK_INT<span class="token operator">:</span> <span class="token number">31</span>
    <span class="token class-name">Build</span><span class="token punctuation">.</span>MANUFACTURER<span class="token operator">:</span> OPPO
    <span class="token class-name">LeakCanary</span> version<span class="token operator">:</span> <span class="token number">2.2</span>
    <span class="token class-name">App</span> process name<span class="token operator">:</span> com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>miniworld
    <span class="token class-name">Analysis</span> duration<span class="token operator">:</span> <span class="token number">20828</span> ms
    <span class="token class-name">Heap</span> dump file path<span class="token operator">:</span> <span class="token operator">/</span>storage<span class="token operator">/</span>emulated<span class="token operator">/</span><span class="token number">0</span><span class="token operator">/</span><span class="token class-name">Download</span><span class="token operator">/</span>leakcanary<span class="token operator">-</span>com<span class="token punctuation">.</span>xxx<span class="token punctuation">.</span>miniworld<span class="token operator">/</span><span class="token number">2022</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">31_11</span><span class="token operator">-</span><span class="token number">13</span><span class="token operator">-</span><span class="token number">44_012.</span>hprof
    <span class="token class-name">Heap</span> dump timestamp<span class="token operator">:</span> <span class="token number">1661915647752</span>
    <span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span><span class="token operator">==</span>
</code></pre> 
<p>解读以上关键信息：</p> 
<ul><li>泄漏对象锁造成内存占用是 1174715 bytes，即1.12M。</li><li><code>Leaking: YES </code> 是代表此对象存在泄漏</li><li>gc 调用链:是<code>BrowserActivity被ConnectivityManager的mContext持有，而ConnectivityManager 类对象又是静态的</code>，从而导致BrowserActivity无法被释放，造成内存泄漏。</li><li>heap dump file(即hprof 内存快照文件)存储：在<code>/storage/emulated/0/Download/leakcanary-com.xxx.miniworld</code>目录下。</li></ul> 
<p>当然除开logcat外，当LeakCanary检测到内存泄露以后会弹出通知，我们点击通知即可查看泄漏信息,这里不展开多介绍。</p> 
<h4><a id="2Android_Studio__Hprof__55"></a><strong>2.Android Studio 查看 Hprof 堆内存快照</strong></h4> 
<p>通过导出内存泄漏的hprof文件或者通过studio 捕捉的hprof 文件。</p> 
<h5><a id="21Hprof_59"></a><strong>2.1Hprof文件包含的信息</strong>：</h5> 
<ul><li>您的应用分配了哪些类型的对象，以及每种对象有多少。</li><li>每个对象当前使用多少内存。</li><li>在代码中的什么位置保持着对每个对象的引用。</li><li>对象所分配到的调用堆栈</li></ul> 
<h5><a id="22_Studio_Hprof_66"></a><strong>2.2 Studio 打开Hprof文件</strong></h5> 
<p>加载hprof文件的方式：studio的底部菜单<code>Profiler-&gt;SESSIONS-&gt;+号-&gt;load from a file-&gt;准备好的hprof文件</code>。</p> 
<p>先来，解读Hprof 文件的工具界面选项，更好的理解内存信息。</p> 
<p><strong>第一个选项,查看指定的堆</strong>：</p> 
<p><img src="https://images2.imgbox.com/7c/00/k1l1J06L_o.png" alt="在这里插入图片描述"></p> 
<ul><li>app heap: 当前app 使用的堆</li><li>Image heap: 系统启动映像，包含启动期间预加载的类。此处的分配确保绝不会移动或消失</li><li>zgote heap: 写时复制堆，其中的应用进程是从 Android 系统中派生的</li></ul> 
<p>通常只要关注app heap 和jni heap 便可。</p> 
<p><strong>第二个选项，选择分配</strong>：</p> 
<p><img src="https://images2.imgbox.com/f3/4f/QQhIw7ai_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Arrange by class：根据类名称对所有分配进行分组。这是默认值</li><li>Arrange by package：根据软件包名称对所有分配进行分组</li><li>Arrange by callstack：将所有分配分组到其对应的调用堆栈</li></ul> 
<p>通常 , 选择 “Arrange by package” 选项 , 这样就可以比较有条理的查找内存中有哪些对象。</p> 
<p><strong>第三个选项, 选择展示的类</strong>：</p> 
<p><img src="https://images2.imgbox.com/de/12/0kN0Cvsp_o.png" alt="在这里插入图片描述"></p> 
<ul><li>show all classes: 展示全部类</li><li>show activity/fragment leak: 展示内存泄漏的activity/fragment</li><li>show project class: 展示项目中有关的类。</li></ul> 
<p><strong>Hprof 中类列表中解读</strong>：</p> 
<p><img src="https://images2.imgbox.com/46/ae/Y6grGw0r_o.png" alt="在这里插入图片描述"></p> 
<ul><li>Class Name: 类名</li><li>Allocations: 该类全部对象个数(通过 malloc() 或 new 运算符分配的对象数)，若出现许多个,可考虑内存泄漏问题</li><li>Native Size: 该类全部对象在native 层占用的内存(以byte为单位)</li><li>Shallow Size: 该类全部对象在Java 层占用的内存，不包含其引用对象的内存(以byte为单位)</li><li>Retained Size：该类全部对象占用的全部内存(包含java和native层,包含其引用对象的内存)</li></ul> 
<p>比如，Bitmap 类，该对象是74个 ，在native 层占用是5043106，在java层占用是3700，Bitmap对象占用全部内存是5049374。</p> 
<h5><a id="23ActivityFragment_112"></a><strong>2.3查看Activity/Fragment的内存泄漏</strong>：</h5> 
<p>先来了解下，<strong>在Android中可能引起内存泄漏的原因</strong>：</p> 
<ul><li>长时间引用Activity/Fragment/View/Drawable /其他对象，导致Fragment/Activity被持有无法被释放。</li><li>Activity中非静态内部类(Runnable),即Activity非静态内部类等同于隐式外部类,间接持有Activity。</li><li>对象被缓存/持有时间超出使用范围时间，比如单例中长时间缓存超大对象。</li></ul> 
<p>接下来，先点击第三个选项，选择<code>show activity/fragment leak</code>。接着,选择其中的某个activity 双击,会出现<code>Instance List 项</code>。选择其中的一个Instance 双击，展开该<code>Instance Detail </code>详细情况。接着点击<code>References</code> ，勾选<code> show nearest gc root only</code>，可以看到Activity/Fragment的调用链。如下图所示：<br> <img src="https://images2.imgbox.com/07/d1/itqnio2I_o.png" alt="在这里插入图片描述"></p> 
<p><strong>先解读下Instance View/Detail 视图</strong>：</p> 
<ul><li>Depth 是指GC根节点到所选实例的最短路径的深度,简单来说就是调用链的节数。</li><li>Native Size: 此对象在native 层占用的内存(以byte为单位)</li><li>Shallow Size: 此对象在Java 层占用的内存，不包含其引用对象的内存(以byte为单位)</li><li>Retained Size：此对象占用的全部内存(包含java和native层,包含其引用对象的内存)</li></ul> 
<p><strong>Shallow and retained sizes的进一步解读</strong><br> <img src="https://images2.imgbox.com/9c/1f/qPObgyzi_o.gif" alt="在这里插入图片描述"><br> 在上图中，obj1 的Retained Size是 (obj1+obj2+obj4)总和shallow size。更多详细信息，请阅读<a href="https://www.yourkit.com/docs/java/help/sizes.jsp" rel="nofollow">Shallow and retained sizes</a></p> 
<p><strong>注意点</strong>:这里的Retained Size 与类列表中的Retained Size是不同的，一个是单独类对象的表示，一个是全部类对象的总和表示。</p> 
<p>回归到内存泄漏的话题，根据上图调用链分析可知: <code>当 BrowserActivity被销毁时,BrowserActivity是作为ConnectivityManager的context属性被持有,没有被完全释放，从而导致内存泄漏</code>。</p> 
<p><strong>解决方式</strong>：通过Application来获取各种system severce 对象。</p> 
<pre><code>    /**
     * 处理leakcanary 检测到通过Activity创建system service, 容易被持有未释放
     * @param context
     * @return
     */
    private static Context getSafeContext(Context context){
        return context instanceof Application?context:context.getApplicationContext();
    }
</code></pre> 
<p>除此之外,右键 <code>jump to source </code>,可以跳转到相匹配的源码中。</p> 
<h5><a id="24Java__151"></a><strong>2.4查看其他Java 对象的占用可能导致的泄漏</strong>：</h5> 
<p>看下Bitmap类的堆信息，选择Retained Size 倒叙发现最大的Bitmap对象占用内存362947(即354k)，调用链是在某个Activity中的layout对象(间接持有bitmap),没有释放，如下所示：</p> 
<p><img src="https://images2.imgbox.com/26/ed/oe6BM1iU_o.png" alt="在这里插入图片描述"></p> 
<p>梳理业务发现,该layout 是在加载webview时才嵌在Activity中。明显该Layout对象的持有时间超过需要展示时间。<br> 因此解决办法：在展示其他业务时,释放该layout对象。</p> 
<p>看下String类的堆信息，选择Retained Size 倒叙发现最大的String对象 占用内存168152(即164k),调用链是在SharedPreferences中的hashMap 中缓存,没有被释放,如下图所示：</p> 
<p><img src="https://images2.imgbox.com/2c/aa/n1aKszWY_o.png" alt="在这里插入图片描述"></p> 
<p>解决方法：使用腾讯的mmkv 替代android SharedPreferences或者采用file文件存储。</p> 
<p>其他的类对象占用，也是一壶画瓢，这里便不再详细介绍。</p> 
<p>更多有关资料，参考<a href="https://developer.android.google.cn/studio/profile/memory-profiler?utm_source=android-studio&amp;hl=zh-cn#profiler-memory-leak-detection" rel="nofollow">Android 官方的捕获堆转储</a></p> 
<h4><a id="3mathprof__173"></a><strong>3.使用mat分析hprof 文件</strong></h4> 
<p><strong>前期准备</strong></p> 
<p>根据电脑和安装的jdk版本，选择对应的mat版本。下载地址：https://www.eclipse.org/mat/previousReleases.php</p> 
<p>studio 或者Leakcanary的hprof文件是无法被mat 打开的。因此，需要在通过<code>android_sdk/platform-tools/hprof-conv</code>执行转换的命令<code>hprof-conv heap-original.hprof heap-converted.hprof</code>。如下图所示：<br> <img src="https://images2.imgbox.com/99/83/GSNsRrUB_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="31_Leak_Suspects__182"></a><strong>3.1 Leak Suspects 查看内存泄漏情况</strong></h5> 
<p>通过mat 打开转好后的hprof 内存快照文件后,如下图所示：</p> 
<p><img src="https://images2.imgbox.com/61/92/PlOP2KHO_o.png" alt="在这里插入图片描述"><br> 点击<code>Leak Suspects</code> ,查看内存泄漏情况：<br> <img src="https://images2.imgbox.com/3c/48/rSd0O0vI_o.png" alt="在这里插入图片描述"></p> 
<p>从上面可知，存在Class 和String 占用超大内存。先来看下String问题，点击detail 进一步查看详情。</p> 
<p><strong>先来解读下几个关键名词</strong>：</p> 
<ul><li>Shallow Heap： 该对象占用的内存，不包含其引用的对象内存。</li><li>Retain Heap： 释放该对象引用(包含其引用对象)后，可以减少的内存。</li></ul> 
<p><strong>List Object项解读</strong>：</p> 
<ul><li>with outgoing references是指 这个对象持有了哪个对象</li><li>with incoming references是指 哪个对象持有了该对象</li></ul> 
<p>先来看下哪些对象持有String对象,<code>右键--&gt; List objects--&gt;with incoming references</code>, 如下图所示：</p> 
<p><img src="https://images2.imgbox.com/ee/a7/wsm3KFUR_o.png" alt="在这里插入图片描述"><br> 在<code>list_object </code>视图中，可以清楚看到string 被哪些对象持有。</p> 
<p>接下来，查看gc 调用路径：</p> 
<p>选择其中一个，右键 <code>path to GCRoot -&gt; exclude all phantom/weak/soft etc. references</code>(去除所有的虚引用，弱引用，软引用) 就会得到调用该类的跟节点gc root。<br> <img src="https://images2.imgbox.com/d1/ae/2yVtFvA8_o.png" alt="在这里插入图片描述"><br> 接下来进入path2gc视图中：</p> 
<p><img src="https://images2.imgbox.com/22/25/NZaKBA95_o.png" alt="在这里插入图片描述"></p> 
<p>从上图可知，该string 对象被sharedPreferences 中的Hasmap 持有,sharedPreferences被某个类和某个数组持有导致，该string 一直无法被释放。</p> 
<p>像这种问题，暂时无法解决，只能先跳过。<code>List_object视图中剩余的string 对象</code>，也是一壶画瓢，这里便不再详细介绍。</p> 
<p><strong>总结</strong>： 查看类对象中内存调用的步骤，<code>先选择类对象-&gt;其次，哪个对象持有了该对象(右键--&gt; List objects--&gt;with incoming references)-&gt;最后,gc 调用路径( path to GCRoot -&gt; exclude all phantom/weak/soft etc. references)</code></p> 
<h5><a id="32Histogram__222"></a><strong>3.2通过Histogram 搜索查找匹配</strong>：</h5> 
<p>搜索Activity 关键字，检索如下所示：<br> <img src="https://images2.imgbox.com/98/6d/Pcf6Hsx7_o.png" alt="在这里插入图片描述"></p> 
<p>当前游戏已经销毁了BrowserActivity，但内存快照中仍然存在。很明显，该Activity发生泄漏,查看其gc 调用路径<code>(path to GCRoot -&gt; exclude all phantom/weak/soft etc. references)</code>,如下图所示：<br> <img src="https://images2.imgbox.com/ab/57/PK6RzQkM_o.png" alt="在这里插入图片描述"></p> 
<p>发现,BrowserActivity是作为ConnectivityManager的context属性被持有,没有被完全释放,这个和用上面的Studio Profiler 分析一样，按照上面的处理方式便可解决。</p> 
<p><strong>除此之外，还可以检索Fragment中有没有存在泄漏情况。</strong></p> 
<p>搜索Bitmap 关键字，检索如下图所示：<br> <img src="https://images2.imgbox.com/00/49/6zytLbTo_o.png" alt="在这里插入图片描述"></p> 
<p>查看BitmapDrawable 对象被哪些对象持有，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/78/d4/Y6RvluB3_o.png" alt="在这里插入图片描述"></p> 
<p>选择其中的一个BitmapDrawable 的gc 调用路径，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/45/a6/HREUmT8H_o.png" alt="在这里插入图片描述"></p> 
<p>从上图可知BitmapDrawable对象被BrowserActivity中iBrowser 对象持有，而BrowserActivity被ConnectivityManager的context属性被持有。</p> 
<p>该问题和上面问题是同一个，解决方式也是一样的。</p> 
<p><strong>通常也可以检索包名，去查看下业务层中哪些对象可能存在泄漏，这里便不做过多介绍</strong>。</p> 
<h5><a id="33Dominator_Tree__258"></a><strong>3.3.Dominator Tree(支配树) 查看大内存对象</strong></h5> 
<p>在此视图中列出了每个对象(Object Instance)与其引用关系的树状结构，同时包含了占用内存的大小和百分比,如下图所示：</p> 
<p><img src="https://images2.imgbox.com/cd/c7/bLnIsmoy_o.png" alt="在这里插入图片描述"></p> 
<p>通过Shallow Heap 或者Percentage(内存百分比)进行排序，很容易筛选出占用内存较大的对象，如下所示：<br> <img src="https://images2.imgbox.com/35/8c/BA0A3dSG_o.png" alt="在这里插入图片描述"></p> 
<p>当然也可以选择排序方式，如下图所示：</p> 
<p><img src="https://images2.imgbox.com/0c/60/v0ErMPJq_o.png" alt="在这里插入图片描述"><br> 接下来，也是选择占用内存大的对象，查看被哪些对象引用或者引用了哪些对象，查看gc 调用路径，去分析如何优化。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/21f7f5510c46d49581d8a549f78ea6fc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">dayjs-入门及常用方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3996e980920400816c82b1291fd185c8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">pywinauto keyborad.send_keys raise RuntimeError(‘SendInput() inserted only ‘&#43;str(num_inserted_events</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>