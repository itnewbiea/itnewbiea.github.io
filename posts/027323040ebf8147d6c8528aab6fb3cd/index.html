<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>UE5 与 C&#43;&#43; 入门教程·第一课：角色与 Enhanced Input - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="UE5 与 C&#43;&#43; 入门教程·第一课：角色与 Enhanced Input" />
<meta property="og:description" content="本文主要围绕 UE5 新的输入系统，手把手从 0 搭建 Unreal 项目，实现角色的基础移动。
重要提示：众所周知，C&#43;&#43; 属于编译型语言，因此动态灵活性不足，不过执行效率高，而蓝图简单灵活，却执行效率低。因此推荐一种开发方式—— 用 C&#43;&#43; 创建基类，蓝图继承 C&#43;&#43; 的基类 ，获得一种折衷的优势。
开发工具：Visual Studio 2022Unreal 版本：5.2.1 创建项目 新建一个基于 C&#43;&#43; 的空项目。File -&gt; New Level（或者 Ctrl &#43; N），建立一个 Basic 关卡，保存到新建的 Levels 文件夹中；Edit -&gt; Project Settings… -&gt; Project -&gt; Maps &amp; Modes 里将 Editor Startup Map 和 Game Default Map 设置为新建的关卡。 角色资产 这里选用的 Epic 商城里的免费资产，Paragon: Lt. Belica。目前用的版本是（写的时候的最新的版本） 5.2.1，目前 Belica 还不支持这个版本，选一个最近的版本 5.1 添加到项目中。
创建一个 Character 类 正如开头所说，我们希望获得一种相对优势，因此会用 C&#43;&#43; 作为父类，项目中实际使用的时候用创建蓝图类继承自 C&#43;&#43;。对于简单的参数和功能就可以在蓝图上定制，对于通用或核心的功能或方法则可以在上级 C&#43;&#43; 类中实现。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/027323040ebf8147d6c8528aab6fb3cd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-26T09:54:56+08:00" />
<meta property="article:modified_time" content="2023-06-26T09:54:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">UE5 与 C&#43;&#43; 入门教程·第一课：角色与 Enhanced Input</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>本文主要围绕 UE5 新的输入系统，手把手从 0 搭建 Unreal 项目，实现角色的基础移动。</p> 
<blockquote> 
 <p>重要提示：众所周知，C++ 属于编译型语言，因此动态灵活性不足，不过执行效率高，而蓝图简单灵活，却执行效率低。因此推荐一种开发方式—— <strong>用 C++ 创建基类，蓝图继承 C++ 的基类</strong> ，获得一种折衷的优势。</p> 
</blockquote> 
<ul><li>开发工具：Visual Studio 2022</li><li>Unreal 版本：5.2.1</li></ul> 
<h3><a id="_9"></a>创建项目</h3> 
<ol><li>新建一个基于 C++ 的空项目。</li><li>File -&gt; New Level（或者 <code>Ctrl + N</code>），建立一个 Basic 关卡，保存到新建的 Levels 文件夹中；</li><li>Edit -&gt; Project Settings… -&gt; Project -&gt; Maps &amp; Modes 里将 <code>Editor Startup Map</code> 和 <code>Game Default Map</code> 设置为新建的关卡。</li></ol> 
<h3><a id="_15"></a>角色资产</h3> 
<p>这里选用的 Epic 商城里的免费资产，Paragon: Lt. Belica。目前用的版本是（写的时候的最新的版本） 5.2.1，目前 Belica 还不支持这个版本，选一个最近的版本 5.1 添加到项目中。</p> 
<p><img src="https://images2.imgbox.com/81/87/BbFL9iSA_o.jpg" alt="Belica 资产"></p> 
<h3><a id="_Character__21"></a>创建一个 Character 类</h3> 
<p>正如开头所说，我们希望获得一种相对优势，因此会用 C++ 作为父类，项目中实际使用的时候用创建蓝图类继承自 C++。对于简单的参数和功能就可以在蓝图上定制，对于通用或核心的功能或方法则可以在上级 C++ 类中实现。</p> 
<p>在 <code>Content Browser</code> 的 <code>C++ Classes</code> 点击右键 <code>New C++ Class...</code> 或者在顶部 Tools -&gt; New C++ Class…</p> 
<p>这里并没有放到默认目录，而是放到 <code>Character</code> 目录里。<strong>注意，这里生成的 C++ 代码会有一个头文件的问题。</strong></p> 
<pre><code class="prism language-cpp"><span class="token comment">// 由于将类创建到 `Character` 目录下，自动生成的代码是下面的这样</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Character/BelicaCharacter.h"</span></span>

<span class="token comment">// 去掉 Character/，改成下面这样，否则编译会出错</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"BelicaCharacter.h"</span></span>
</code></pre> 
<h3><a id="Spring_Arm__Camera_38"></a>Spring Arm 与 Camera</h3> 
<p>角色后面跟着一个相机，叫做 <strong>跟随相机</strong>（followed camera）。为了控制相机与角色的相对距离，通常还带一个<strong>弹簧臂</strong>（Spring Arm）。调整弹簧臂就可以调节相机的远近。可以说这是所有角色型游戏的基础。</p> 
<p><strong>因此，相机是依附于弹簧臂的。</strong> 弹簧臂动，相机就动。</p> 
<p>我们需要两个组件，<code>USpringArmComponent</code> 和 <code>UCameraComponent</code>。前缀 <code>U</code> 代表继承自 <code>UObject</code>。</p> 
<p>在 <code>BelicaCharacter.h</code> 中添加两个组件：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>VisibleAnywhere<span class="token punctuation">,</span> Category <span class="token operator">=</span> Camera<span class="token punctuation">)</span>
		<span class="token keyword">class</span> <span class="token class-name">USpringArmComponent</span><span class="token operator">*</span> CameraBoom<span class="token punctuation">;</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>VisibleAnywhere<span class="token punctuation">,</span> Category <span class="token operator">=</span> Camera<span class="token punctuation">)</span>
		<span class="token keyword">class</span> <span class="token class-name">UCameraComponent</span><span class="token operator">*</span> FollowCamera<span class="token punctuation">;</span>
</code></pre> 
<p>这里使用了前向声明的小技巧，对于指针类型，可以声明类型，而不需要引入头文件，这样可以避免影响编译速度。这就是为什么使用 <code>class</code>。当然，如果你愿意的话，也可以单独放到文件的开头进行声明，类似下面这样：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">class</span> <span class="token class-name">USpringArmComponent</span><span class="token punctuation">;</span>
<span class="token keyword">class</span> <span class="token class-name">UCameraComponent</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>UPROPERTY</code> 是 Unreal 定义的宏。某种意义上也是黑魔法，例如你可以让 <code>private</code> 也可以被访问。<code>UPROPERTY</code> 用途非常广，比如变量复制、序列化、蓝图访问、垃圾回收。本文作为入门教程就不展开了。</p> 
<p>在 <code>BelicaCharacter.h</code> 中使用了前向声明，但在 <code>BelicaCharacter.cpp</code> 中，我们就需要关注类的具体方法，因此就必须引入头文件。要查询类在哪个头文件里，最简单粗暴但有效的方法就是把类名贴入搜索引擎。如果你使用的是 Jetbrains 家的 Rider 进行 Unreal 开发，IDE 会自动帮你补全头文件，就可以不用操心这个问题。（特此声明，本人没有收取任何 Jetbrains 广告费）</p> 
<p><img src="https://images2.imgbox.com/7c/aa/FzPU2c8o_o.jpg" alt="所在头文件"></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"GameFramework/SpringArmComponent.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Camera/CameraComponent.h"</span></span>
</code></pre> 
<p>在构造函数中初始化这两个组件，并指明层级关系。</p> 
<pre><code class="prism language-cpp"><span class="token class-name">ABelicaCharacter</span><span class="token double-colon punctuation">::</span><span class="token function">ABelicaCharacter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	PrimaryActorTick<span class="token punctuation">.</span>bCanEverTick <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
	
	CameraBoom <span class="token operator">=</span> <span class="token generic-function"><span class="token function">CreateDefaultSubobject</span><span class="token generic class-name"><span class="token operator">&lt;</span>USpringArmComponent<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"CameraBoom"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CameraBoom<span class="token operator">-&gt;</span><span class="token function">SetupAttachment</span><span class="token punctuation">(</span><span class="token function">GetMesh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	CameraBoom<span class="token operator">-&gt;</span>TargetArmLength <span class="token operator">=</span> <span class="token number">500.f</span><span class="token punctuation">;</span>
	CameraBoom<span class="token operator">-&gt;</span>bUsePawnControlRotation <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	FollowCamera <span class="token operator">=</span> <span class="token generic-function"><span class="token function">CreateDefaultSubobject</span><span class="token generic class-name"><span class="token operator">&lt;</span>UCameraComponent<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token function">TEXT</span><span class="token punctuation">(</span><span class="token string">"FollowCamera"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	FollowCamera<span class="token operator">-&gt;</span><span class="token function">SetupAttachment</span><span class="token punctuation">(</span>CameraBoom<span class="token punctuation">,</span> USpringArmComponent<span class="token double-colon punctuation">::</span>SocketName<span class="token punctuation">)</span><span class="token punctuation">;</span>
	FollowCamera<span class="token operator">-&gt;</span>bUsePawnControlRotation <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li>Unreal 有自己的一套内存管理机制，不能简单的进行 <code>new</code> 和 <code>delete</code>。需要使用 <code>CreateDefaultSubobject</code> 这样的模板函数，背后也有比较复杂的分配机制。</li><li><code>SetupAttachment</code> 就是用来绑定层级的。可以看到 <code>FollowCamera</code> 绑定到了 <code>CameraBoom</code> 上。而 <code>CameraBoom</code> 绑定的是 <code>GetMesh</code> 返回的角色的骨骼。=</li><li><code>TargetArmLength</code> 是弹簧臂的长度</li><li><code>bUsePawnControlRotation</code> 是使用 Pawn 控制旋转</li></ul> 
<p>到了这里，可以进行编译了。</p> 
<h3><a id="_100"></a>创建蓝图类</h3> 
<p>可以基于前面的 C++ 类创建一个蓝图类。</p> 
<p><img src="https://images2.imgbox.com/bd/18/eYCKI6NQ_o.jpg" alt="从 C++ 中创建蓝图类"></p> 
<p>可以看到 C++ 代码的层级关系体现在这里，弹簧臂依附与骨骼（<code>Mesh</code>），跟随相机又依附于弹簧臂。</p> 
<p><img src="https://images2.imgbox.com/1f/2f/PPwrFksC_o.jpg" alt="层级关系"></p> 
<p>在 <code>Mesh</code> 设置为我们引入的资产，调整位置和旋转。顺便可以调节一下弹簧臂的高度和长度（不用调跟随相机）。</p> 
<p><img src="https://images2.imgbox.com/37/1c/57f2bsss_o.jpg" alt="设置 Belica 网格体"></p> 
<p>可以将蓝图类拖入到关卡中查看效果。</p> 
<h3><a id="_116"></a>动画蓝图</h3> 
<p>Belica 资产里已经做好了一个动画蓝图，可以直接使用。至于什么是动画蓝图，简单理解就是一系列动画组合而成，能根据某种状态（例如用户输入）自动切换和过渡动画的动画控制逻辑。后面如果有动画的文章会展开讲制作动画蓝图（也许鸽了）。</p> 
<p>在蓝图添加 Belica 的动画蓝图：</p> 
<p><img src="https://images2.imgbox.com/c7/57/ykLyFV7H_o.jpg" alt="添加动画蓝图"></p> 
<p><strong>运行一下，会有激动人心的动画效果出现，应该可以看到 Belica 拿起枪自信又警觉的样子。</strong></p> 
<h3><a id="Input_Action_126"></a>Input Action</h3> 
<p>这里会使用 Unreal 新版本的 Input 功能，相比于 UE4，看起来稍微复杂一点点，但优势也比较明显，就是可定制性更高，层次更加分明。Input Action 可以理解定义了值类型，对于代码，主要关注 Action 的值，不关心怎么出现这个值的。至于 Action 怎么产生，由谁产生（键盘、手柄、触控等等），则是 Input Mapping Context 要定义的，也包括值的处理过程。</p> 
<p>创建一个 Inputs 文件夹，然后再创建一个 <code>Action</code> 文件夹，创建 Input Action（点进去修改类型）。</p> 
<ul><li><code>IA_Jump</code>：处理跳跃，对应 <code>Value Type</code> 是 <code>Digital(bool)</code>（一次性触发）；</li><li><code>IA_Move</code>：移动，由于这是个有正负方向，而且上下左右，使用 <code>Axis2D(Vector2D)</code>；</li><li><code>IA_Look</code>：鼠标移动，也是 <code>Axis2D(Vector2D)</code>；</li></ul> 
<p><img src="https://images2.imgbox.com/f3/32/UVDKgOu8_o.jpg" alt="创建 Input Action"></p> 
<p>Input Action 可以视为 Action 名称（标签）和值类型的映射。</p> 
<h3><a id="Input_Mapping_Context_140"></a>Input Mapping Context</h3> 
<p>在 Inputs 文件夹中创建 <code>IMC_Belica</code>。注意 <code>Negate</code> 对值进行取反（负）方向。空格和 <code>D</code> 不需要特别配置。Look 的 <code>Nagate</code> 只作用于 <code>Y</code>，将 <code>X</code> 和 <code>Z</code> 的勾选去掉。</p> 
<p><img src="https://images2.imgbox.com/f9/57/Kl0qRcjL_o.jpg" alt="Input Mapping Context"></p> 
<h3><a id="Enhanced_Input_146"></a>Enhanced Input</h3> 
<p>如果使用 5.x 版本以上，Enhanced Input 已经作为默认的 Input 组件（毕竟已经在编辑器里警告说废弃原有 Input 了），但新的 Input 和原有的 Input 是兼容的。如果你看代码的话，新的 <code>EnhancedInputComponent</code> 其实就是 <code>InputComponent</code> 的子类。不放心的话可以去看一眼。</p> 
<p><img src="https://images2.imgbox.com/5b/38/4F5onh1x_o.jpg" alt="默认的 Input Component"></p> 
<p>在 <code>.Build.cs</code> 中将 <code>EnhancedInput</code> 添加作为依赖（因为这里是空项目起步，不是第三人称模板，所以需要手动添加）。</p> 
<pre><code class="prism language-c#">PrivateDependencyModuleNames.AddRange(new string[] { "EnhancedInput" });
</code></pre> 
<p>然后刷新 Visual Studio 项目。可以在编辑器顶部的 Tools -&gt; Refresh Visual Studio 2022 Project。或者在文件夹下，对着 <code>.uproject</code> 右键，生成 Visual Studio project files。</p> 
<p><img src="https://images2.imgbox.com/65/ee/qka27sSm_o.jpg" alt="生成 Visual Studio 文件"></p> 
<p><strong>这一步的目的是让依赖的头文件加入到 Visual Studio，否则编译器会找不到头文件。不过，是可以正常编译的。如果你能忍受红色的波浪线，其实也可以不刷新。</strong></p> 
<h4><a id="_IA__IMC_164"></a>角色中加入 IA 和 IMC</h4> 
<p>有了弹簧臂和跟随相机的铺垫，这一步其实没有太多要讲的。</p> 
<pre><code class="prism language-cpp">	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditAnywhere<span class="token punctuation">,</span> BlueprintReadOnly<span class="token punctuation">,</span> Category <span class="token operator">=</span> Input<span class="token punctuation">,</span> meta <span class="token operator">=</span> <span class="token punctuation">(</span>AllowPrivateAccess <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">class</span> <span class="token class-name">UInputMappingContext</span><span class="token operator">*</span> BelicaMappingContext<span class="token punctuation">;</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditAnywhere<span class="token punctuation">,</span> BlueprintReadOnly<span class="token punctuation">,</span> Category <span class="token operator">=</span> Input<span class="token punctuation">,</span> meta <span class="token operator">=</span> <span class="token punctuation">(</span>AllowPrivateAccess <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">class</span> <span class="token class-name">UInputAction</span><span class="token operator">*</span> JumpAction<span class="token punctuation">;</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditAnywhere<span class="token punctuation">,</span> BlueprintReadOnly<span class="token punctuation">,</span> Category <span class="token operator">=</span> Input<span class="token punctuation">,</span> meta <span class="token operator">=</span> <span class="token punctuation">(</span>AllowPrivateAccess <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">class</span> <span class="token class-name">UInputAction</span><span class="token operator">*</span> MoveAction<span class="token punctuation">;</span>

	<span class="token function">UPROPERTY</span><span class="token punctuation">(</span>EditAnywhere<span class="token punctuation">,</span> BlueprintReadOnly<span class="token punctuation">,</span> Category <span class="token operator">=</span> Input<span class="token punctuation">,</span> meta <span class="token operator">=</span> <span class="token punctuation">(</span>AllowPrivateAccess <span class="token operator">=</span> <span class="token string">"true"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">class</span> <span class="token class-name">UInputAction</span><span class="token operator">*</span> LookAction<span class="token punctuation">;</span>
</code></pre> 
<p>但这有个黑魔法，<code>meta = (AllowPrivateAccess = "true")</code> 让蓝图可以访问到私有变量。</p> 
<h3><a id="_184"></a>初始化和绑定操作</h3> 
<p>最终的 Action 需要有一个对应的方法去处理这个操作。注意一下，UE4 的 Input 是区分 Axis 和 Action，但现在都已经统一成为 Action 了。所以，都是 <code>BindAction</code>。</p> 
<p>还有一个小点，<code>BelicaMappingContext</code> 和 <code>Action</code> 之间其实并 <strong>没有严格的初始化顺序的关系。</strong> 本质上，这是两层的抽象，Context 主要是外部输入到 Action。Action 则负责最后绑定到操作上。</p> 
<p>在 .cpp 引入头文件：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"EnhancedInputSubsystems.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"EnhancedInputComponent.h"</span></span>

<span class="token comment">// ...</span>

<span class="token comment">// Called to bind functionality to input</span>
<span class="token keyword">void</span> <span class="token class-name">ABelicaCharacter</span><span class="token double-colon punctuation">::</span><span class="token function">SetupPlayerInputComponent</span><span class="token punctuation">(</span>UInputComponent<span class="token operator">*</span> PlayerInputComponent<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">Super</span><span class="token double-colon punctuation">::</span><span class="token function">SetupPlayerInputComponent</span><span class="token punctuation">(</span>PlayerInputComponent<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>APlayerController<span class="token operator">*</span> PlayerController <span class="token operator">=</span> <span class="token generic-function"><span class="token function">Cast</span><span class="token generic class-name"><span class="token operator">&lt;</span>APlayerController<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>Controller<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>UEnhancedInputLocalPlayerSubsystem<span class="token operator">*</span> Subsystem <span class="token operator">=</span> ULocalPlayer<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">GetSubsystem</span><span class="token generic class-name"><span class="token operator">&lt;</span>UEnhancedInputLocalPlayerSubsystem<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>PlayerController<span class="token operator">-&gt;</span><span class="token function">GetLocalPlayer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			Subsystem<span class="token operator">-&gt;</span><span class="token function">AddMappingContext</span><span class="token punctuation">(</span>BelicaMappingContext<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>UEnhancedInputComponent<span class="token operator">*</span> EnhancedInputComponent <span class="token operator">=</span> <span class="token generic-function"><span class="token function">CastChecked</span><span class="token generic class-name"><span class="token operator">&lt;</span>UEnhancedInputComponent<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>PlayerInputComponent<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>

		EnhancedInputComponent<span class="token operator">-&gt;</span><span class="token function">BindAction</span><span class="token punctuation">(</span>JumpAction<span class="token punctuation">,</span> ETriggerEvent<span class="token double-colon punctuation">::</span>Triggered<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ACharacter<span class="token double-colon punctuation">::</span>Jump<span class="token punctuation">)</span><span class="token punctuation">;</span>
		EnhancedInputComponent<span class="token operator">-&gt;</span><span class="token function">BindAction</span><span class="token punctuation">(</span>JumpAction<span class="token punctuation">,</span> ETriggerEvent<span class="token double-colon punctuation">::</span>Completed<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ACharacter<span class="token double-colon punctuation">::</span>StopJumping<span class="token punctuation">)</span><span class="token punctuation">;</span>

		EnhancedInputComponent<span class="token operator">-&gt;</span><span class="token function">BindAction</span><span class="token punctuation">(</span>MoveAction<span class="token punctuation">,</span> ETriggerEvent<span class="token double-colon punctuation">::</span>Triggered<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ABelicaCharacter<span class="token double-colon punctuation">::</span>Move<span class="token punctuation">)</span><span class="token punctuation">;</span>
		EnhancedInputComponent<span class="token operator">-&gt;</span><span class="token function">BindAction</span><span class="token punctuation">(</span>LookAction<span class="token punctuation">,</span> ETriggerEvent<span class="token double-colon punctuation">::</span>Triggered<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>ABelicaCharacter<span class="token double-colon punctuation">::</span>Look<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<p>跳跃的处理方法是用 <code>ACharacter</code> 自带的处理方法。所以处理 Action 操作，只需要实现 <code>Move</code> 和 <code>Look</code>。</p> 
<h3><a id="_228"></a>处理值的方法</h3> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token class-name">ABelicaCharacter</span><span class="token double-colon punctuation">::</span><span class="token function">Move</span><span class="token punctuation">(</span><span class="token keyword">const</span> FInputActionValue<span class="token operator">&amp;</span> Value<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FVector2D MovementVector <span class="token operator">=</span> Value<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">Get</span><span class="token generic class-name"><span class="token operator">&lt;</span>FVector2D<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>Controller <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">const</span> FRotator Rotation <span class="token operator">=</span> Controller<span class="token operator">-&gt;</span><span class="token function">GetControlRotation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">const</span> FRotator <span class="token function">YawRotation</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> Rotation<span class="token punctuation">.</span>Yaw<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> FVector ForwardDirection <span class="token operator">=</span> <span class="token function">FRotationMatrix</span><span class="token punctuation">(</span>YawRotation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetUnitAxis</span><span class="token punctuation">(</span>EAxis<span class="token double-colon punctuation">::</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">const</span> FVector RightDirection <span class="token operator">=</span> <span class="token function">FRotationMatrix</span><span class="token punctuation">(</span>YawRotation<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetUnitAxis</span><span class="token punctuation">(</span>EAxis<span class="token double-colon punctuation">::</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token function">AddMovementInput</span><span class="token punctuation">(</span>ForwardDirection<span class="token punctuation">,</span> MovementVector<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">AddMovementInput</span><span class="token punctuation">(</span>RightDirection<span class="token punctuation">,</span> MovementVector<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token class-name">ABelicaCharacter</span><span class="token double-colon punctuation">::</span><span class="token function">Look</span><span class="token punctuation">(</span><span class="token keyword">const</span> FInputActionValue<span class="token operator">&amp;</span> Value<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	FVector2D LookVector <span class="token operator">=</span> Value<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">Get</span><span class="token generic class-name"><span class="token operator">&lt;</span>FVector2D<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">if</span> <span class="token punctuation">(</span>Controller <span class="token operator">!=</span> <span class="token keyword">nullptr</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">AddControllerYawInput</span><span class="token punctuation">(</span>LookVector<span class="token punctuation">.</span>X<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">AddControllerPitchInput</span><span class="token punctuation">(</span>LookVector<span class="token punctuation">.</span>Y<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>需要注意，在头文件中声明时，<code>FInputActionValue</code> 是类型的引用，不能使用前向声明。所以需要在 <strong>头文件</strong> 中（也就是 <code>BelicaCharacter.h</code>）加入 <code>#include "InputActionValue.h"</code></p> 
<h3><a id="GameMode___264"></a>GameMode 和 接收输入</h3> 
<p>将 Action 和 IMC 在角色进行设置，同时接收 <code>Player 0</code> 的输入。</p> 
<p><img src="https://images2.imgbox.com/93/42/XUUp56j5_o.jpg" alt="将 Action 和 IMC 设置到角色上"></p> 
<p>接下去就比较简单了，创建 C++ 项目会自动创建一个 <code>GameMode</code>，直接继承一个蓝图的 GameMode 类。</p> 
<p><img src="https://images2.imgbox.com/c0/a6/Aocw4a8I_o.jpg" alt="GameMode类"></p> 
<p>将 Pawn 设置为 Belica 的蓝图类，可以删除场景内的 Belica。</p> 
<p><img src="https://images2.imgbox.com/99/e7/YM0mvjbl_o.jpg" alt="设置 Belica 作为 Pawn"></p> 
<p>在 World Settings 中设置这个 GameMode。</p> 
<p><img src="https://images2.imgbox.com/c7/fc/xhOZzOkE_o.jpg" alt="设置 GameMode"></p> 
<p>运行游戏，现在 Belica 可以受键盘和鼠标控制移动了。</p> 
<p>对了，<strong>如果你觉得不希望只能看到 Belica 的背影</strong>，可以在 C++ 的构造函数中设置 <code>bUseControllerRotationYaw = false;</code>，当然更简单的方法是在蓝图直接勾选去掉（这才是蓝图的意义，额，其实本文都可以用蓝图）。</p> 
<p><img src="https://images2.imgbox.com/96/bd/iUkcDGIF_o.jpg" alt="去掉ControllerRotationYaw"></p> 
<h3><a id="_288"></a>小结</h3> 
<p>从 0 开始，最终实现 UE5 新版的 EnhancedInput。这是一切的开始。不过，令我意外的是 Belica 提供了动画蓝图（突然手动制作的欲望就下降了）。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d12323e468ad4d6de067097627fe592c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">usb转8路串口模块</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4126a71146ef0a7338814b0f1deebbd2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用Python进行逻辑回归建立评分卡的完整示例代码，包括数据预处理、分箱、特征工程、共线性剔除、模型评估和信用评分规则制定的过程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>