<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>How bad are small triangles on GPU and why? - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="How bad are small triangles on GPU and why?" />
<meta property="og:description" content="https://www.g-truc.net/post-0662.html
25/06/2014 How bad are small triangles on GPU and why? RSS Feed ~ Comment: by email - on Twitter ~ Share: Twitter - Facebook - Linked In - Google&#43; - Permanent link Small triangles is bad for performance and this is not something new. In this post, we are just looking at some numbers to quantity these bad performance.
We are using a simple scenario where the framebuffer is filled with tiles of variable sizes, each tile being composed of two triangles and no tile is overlapping another." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/4583e41ab4ea3b2ba690303a9bf80962/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-02T09:30:31+08:00" />
<meta property="article:modified_time" content="2023-03-02T09:30:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">How bad are small triangles on GPU and why?</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="https://www.g-truc.net/post-0662.html" rel="nofollow" title="https://www.g-truc.net/post-0662.html">https://www.g-truc.net/post-0662.html</a></p> 
<h3>25/06/2014 <a href="https://www.g-truc.net/post-opengl-tips.html#menu" rel="nofollow" title="How bad are small triangles on GPU and why?">How bad are small triangles on GPU and why?</a></h3> 
<h4><a href="http://feeds.feedburner.com/gtc-tech" rel="nofollow" title="RSS Feed">RSS Feed</a> ~ Comment: <a href="mailto:mail@g-truc.net?subject=How%20bad%20are%20small%20triangles%20on%20GPU%20and%20why?" rel="nofollow">by email</a> - <a href="http://twitter.com/g_truc" rel="nofollow" title="on Twitter">on Twitter</a> ~ Share: <a href="http://twitter.com/home?status=#g_truc%20How%20bad%20are%20small%20triangles%20on%20GPU%20and%20why?%20http://www.g-truc.net/post-0662.html" rel="nofollow" title="Twitter">Twitter</a> - <a href="http://www.facebook.com/share.php?u=http://www.g-truc.net/post-0662.html" rel="nofollow" title="Facebook">Facebook</a> - <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http://www.g-truc.net/post-0662.html&amp;title=How%20bad%20are%20small%20triangles%20on%20GPU%20and%20why?&amp;summary=How%20bad%20are%20small%20triangles%20on%20GPU%20and%20why?&amp;source=%27Christophe%20Riccio%27" rel="nofollow" title="Linked In">Linked In</a> - <a href="https://plusone.google.com/_/+1/confirm?mini=true&amp;url=http://www.g-truc.net/post-0662.html&amp;title=How%20bad%20are%20small%20triangles%20on%20GPU%20and%20why?&amp;content=How%20bad%20are%20small%20triangles%20on%20GPU%20and%20why?" rel="nofollow" title="Google+">Google+</a> - <a href="http://www.g-truc.net/post-0662.html" rel="nofollow" title="Permanent link">Permanent link</a></h4> 
<p>Small triangles is bad for performance and this is not something new. In this post, we are just looking at some numbers to quantity these bad performance.</p> 
<p>We are using a simple scenario where the framebuffer is filled with tiles of variable sizes, each tile being composed of two triangles and no tile is overlapping another. The vertex shader only transform the vertices and the fragment shader is a pass through shader. This scenario could be seen as a best case scenario, if not best, it's close to a best case. Nevertheless, the results show horrifying performances on small triangles.</p> 
<p>Following, two images showing examples of rendering used for these tests.</p> 
<p></p> 
<p>Example of rendering test using 8*8 tiles</p> 
<p></p> 
<p>Example of rendering test using 1*1 tiles</p> 
<p>First test with squared tile sizes and a full frame tile</p> 
<p>In a first test, we are filling a 1080p framebuffer using tiles from 1 by 1 to 128 by 128 and even using a single pair of triangle to fill the entire framebuffer. (Going that way, a single triangle makes better sense for the hardware but it was enough for illustrate our scenario).</p> 
<p></p> 
<p>Filling a 1080p framebuffer with tiles using a triangle pair to cover each tile. Relative rendering time to 128*128 tile sizes.</p> 
<p>The first conclusion is that filling the framebuffer with anything larger than 16 by 16 tiles have no effect on the GPU performance for any desktop vendors at least for the primitive rasterization/fixed function point of view.</p> 
<p>The primitive minimum size in pixels is pretty much the same for all vendors. Covering 8 by 8 pixels with two triangles starts to have a significant impact on performances but it's still acceptable as not a performance cliff.</p> 
<p>Interestingly, Southern Islands seems to be the least affected architecture by 8 by 8 pixel tiles. Beyond that point, Southern Islands architecture performance cliff-ed faster than the others architectures.</p> 
<p>Haswell behaves the best with small triangles. "The best" is still a performance cliff as basically Haswell, Kepler and Southern Islands are about 10x, 15x, 20x slower than optimal performance respectively.</p> 
<p>Does the shape of the triangles really matters?</p> 
<p></p> 
<p>Filling a 1080p framebuffer with non squared 256 pixel tiles using a triangle pair to cover each tile.</p> 
<p>Yes, the shape matters but the good new is that equilateral triangles is generally better for all vendors.</p> 
<p>It's funny how different are the performance characteristics between 256 by 1 and 1 by 256 for example. However, this is nothing really surprising considering the <a href="http://www.g-truc.net/post-0597.html#menu" rel="nofollow" title="rasterization patterns of the GPU architectures">rasterization patterns of the GPU architectures</a> that is obviously not designed to be somewhat anisotropic.</p> 
<p></p> 
<p>Example of rendering using 32*2 tiles for non squared tiles</p> 
<p>What about sub-pixel triangles?</p> 
<p></p> 
<p>Filling a 320*240 framebuffer with sub-pixel tiles.</p> 
<p>It's only getting worse! In this test the framebuffer size is only 320 by 240 because at 1080p implementations would all time out at 0.25 by 0.25 or 0.125 * 0.125 tile sizes.</p> 
<p>The performance cliff is exponential</p> 
<p></p> 
<p>Filling a 640x480 framebuffer with tiles using a triangle pair to cover each tile. X: Tile sizes, Y: Relative log10 rendering time to 128*128 tile size</p> 
<p>This last drawing is to highlight that the performance cliff is about exponential.</p> 
<p>Conclusion</p> 
<p>Why such performance cliff? Because GPUs work at varius granularities that is always larger than 1x pixels.</p> 
<p>First, there is the quadpixels (block of 2 by 2 pixels) that are used to compute the derivatives. The derivatives are used for the explicit fragment shader derivatives but also to select the correct mipmaps while filtering as shown in the following code that can be wired in the texture units.</p> 
<p>Calculating texture lod with derivatives:</p> 
<ul><li>float textureLevel(in sampler2D Sampler, in vec2 Texcoord)</li><li>{<!-- --></li><li>vec2 TextureSize = vec2(textureSize(Sampler, 0));</li><li><li>float LevelCount = max(log2(TextureSize.x), log2(TextureSize.y));</li><li><li>// Access neighbour values within the quadpixels to return the derivative</li><li>vec2 dx = dFdx(Texcoord * TextureSize);</li><li>// Access neighbour values within the quadpixels to return the derivative</li><li>vec2 dy = dFdy(Texcoord * TextureSize);</li><li>float d = max(dot(dx, dx), dot(dy, dy));</li><li><li>d = clamp(d, 1.0, pow(2, (LevelCount - 1) * 2));</li><li><li>return 0.5 * log2(d);</li><li>}</li></ul> 
<p>Equally important or even more important: the primitive rate. For example, <a href="http://en.wikipedia.org/wiki/Radeon_HD_7000_Series" rel="nofollow" title="Tahiti">Tahiti</a> is capable to process two triangles per clock. However, each triangle is effectively sliced into multiple primitives within 8 by 8 pixel tiles. If a triangle overlap two tiles, the triangle requires two primitives. If a triangle overlap only a single pixel, then the budget for the other pixels in the 8 by 8 tile is wasted as only a single primitive can be scanned per cycle per tile.</p> 
<p></p> 
<p>A triangle is contained with a 8 by 8 pixels block, it consumes 1 primitive</p> 
<p></p> 
<p>A triangle covers only a single pixel, it still consumes 1 primitive</p> 
<p></p> 
<p>Two triangles are contained without the 8 by 8 pixels blocks, they consume 1 primitive each</p> 
<p></p> 
<p>A triangle overlaps two 8 by 8 pixels blocks, it consumes 2 primitives</p> 
<p></p> 
<p>A triangle overlaps four 8 by 8 pixels blocks, it consumes 4 primitives</p> 
<p>Considering these numbers, the felling that tessellation is the biggest waste of GPU area space since the geometry shader might be a little too quick. It's a waste because engines don't really use tessellation however it provides an effective way to control the size of the primitives on screen. Is the current OpenGL 4 / D3D11 hardware tessellation good enough? I don't have that answer.</p> 
<p>In the meantime, if we want some good primitive performances, let's set the minimum target to about 8 by 8 pixels per triangles on screen.</p> 
<p>The source for these tests in available in the staging of the <a href="http://www.g-truc.net/project-0026.html#menu" rel="nofollow" title="OpenGL Samples Pack">OpenGL Samples Pack</a> 4.4.3 branch.</p> 
<ul><li><a href="https://github.com/g-truc/ogl-samples/tree/4.4.3" title="OpenGL Samples Pack 4.4.3 staging">OpenGL Samples Pack 4.4.3 staging</a></li><li><a href="https://github.com/g-truc/ogl-samples/issues?state=open" title="Submit a bug report">Submit a bug report</a></li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4896f017ec4cffe481bc02e5a75071ae/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android FFmpeg Camera2 推流直播</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9eff4472f1fe2bcb4581c7c65fb1faca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Win11系统软件无法拖拽发送文件的解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>