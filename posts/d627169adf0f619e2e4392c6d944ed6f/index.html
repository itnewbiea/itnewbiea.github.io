<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Electron &#43; Vue 项目从零创建，不使用 vue-electron-template - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Electron &#43; Vue 项目从零创建，不使用 vue-electron-template" />
<meta property="og:description" content="Electron &#43; Vue 项目创建 1. vite项目框架搭建 按照一般的开发流程，用命令行创建一个vite项目：
# use npm or yarn or pnpm npm(yarn | pnpm) create vite 根据自己的需要，选择相应的选项。创建完成后，进入项目，安装依赖并运行，一个基础的vite项目就创建好了。
ex：默认创建时，可能需要的额外操作 TS支持
由于vite默认使用esbuild处理TS，天然支持它，因此只需要添加TS相关依赖，并编写tsconfig.json以应用TS检查即可。
# use npm or yarn or pnpm npm install -D typescript vue-tsc // tsconfig.json { &#34;compilerOptions&#34;: { &#34;target&#34;: &#34;esnext&#34;, &#34;module&#34;: &#34;esnext&#34;, &#34;strict&#34;: true, &#34;jsx&#34;: &#34;preserve&#34;, &#34;moduleResolution&#34;: &#34;node&#34;, &#34;isolatedModules&#34;: true, &#34;skipLibCheck&#34;: true, &#34;esModuleInterop&#34;: true, &#34;allowSyntheticDefaultImports&#34;: true, &#34;forceConsistentCasingInFileNames&#34;: true, &#34;useDefineForClassFields&#34;: true, &#34;sourceMap&#34;: true, &#34;baseUrl&#34;: &#34;.&#34;, &#34;types&#34;: [ &#34;webpack-env&#34; ], &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d627169adf0f619e2e4392c6d944ed6f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-26T09:55:51+08:00" />
<meta property="article:modified_time" content="2023-12-26T09:55:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Electron &#43; Vue 项目从零创建，不使用 vue-electron-template</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="Electron__Vue__1"></a>Electron + Vue 项目创建</h4> 
<h5><a id="1_vite_3"></a>1. vite项目框架搭建</h5> 
<p>按照一般的开发流程，用命令行创建一个vite项目：</p> 
<pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
npm<span class="token punctuation">(</span>yarn <span class="token operator">|</span> <span class="token function">pnpm</span><span class="token punctuation">)</span> create vite
</code></pre> 
<p>根据自己的需要，选择相应的选项。创建完成后，进入项目，安装依赖并运行，一个基础的vite项目就创建好了。</p> 
<h6><a id="ex_14"></a>ex：默认创建时，可能需要的额外操作</h6> 
<ol><li> <p>TS支持</p> <p>由于vite默认使用esbuild处理TS，天然支持它，因此只需要添加TS相关依赖，并编写tsconfig.json以应用TS检查即可。</p> <pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> typescript vue-tsc
</code></pre> <pre><code class="prism language-json"><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"target"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"module"</span><span class="token operator">:</span> <span class="token string">"esnext"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"strict"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"jsx"</span><span class="token operator">:</span> <span class="token string">"preserve"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"moduleResolution"</span><span class="token operator">:</span> <span class="token string">"node"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"isolatedModules"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"skipLibCheck"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"esModuleInterop"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"allowSyntheticDefaultImports"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"forceConsistentCasingInFileNames"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"useDefineForClassFields"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"sourceMap"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token string-property property">"baseUrl"</span><span class="token operator">:</span> <span class="token string">"."</span><span class="token punctuation">,</span>
    <span class="token string-property property">"types"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"webpack-env"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"paths"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"@/*"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">"src/*"</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"lib"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"esnext"</span><span class="token punctuation">,</span>
      <span class="token string">"dom"</span><span class="token punctuation">,</span>
      <span class="token string">"dom.iterable"</span><span class="token punctuation">,</span>
      <span class="token string">"scripthost"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token string-property property">"include"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"src/**/*.ts"</span><span class="token punctuation">,</span>
    <span class="token string">"src/**/*.tsx"</span><span class="token punctuation">,</span>
    <span class="token string">"src/**/*.vue"</span><span class="token punctuation">,</span>
    <span class="token string">"tests/**/*.ts"</span><span class="token punctuation">,</span>
    <span class="token string">"tests/**/*.tsx"</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token string-property property">"exclude"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"node_modules"</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <pre><code class="prism language-json"><span class="token comment">// package.json</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"dev"</span><span class="token operator">:</span> <span class="token string">"vite --host"</span><span class="token punctuation">,</span>
      <span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"vue-tsc &amp;&amp; vite build"</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> </li><li> <p>vue-router和vuex/pinia</p> <p>添加依赖后正常在main.ts中引入即可。</p> <pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> vue-router vuex<span class="token punctuation">(</span>or pinia<span class="token punctuation">)</span>
</code></pre> <pre><code class="prism language-typescript"><span class="token comment">// src/main.ts</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vue"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">"./router"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> store <span class="token keyword">from</span> <span class="token string">"./store"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">"./style.css"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">"./App.vue"</span><span class="token punctuation">;</span>

<span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>store<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">"#app"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// or</span>

<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> createPinia <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'pinia'</span>
<span class="token keyword">import</span> router <span class="token keyword">from</span> <span class="token string">'./router'</span>
<span class="token keyword">import</span> App <span class="token keyword">from</span> <span class="token string">'./App.vue'</span>

<span class="token keyword">import</span> <span class="token string">"./style.css"</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createApp</span><span class="token punctuation">(</span>App<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">createPinia</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span>

app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>

</code></pre> </li><li> <p>eslint &amp; prettier</p> <p>正常安装依赖，编写配置文件即可，这里我没有编写.prettierrc.js，用的默认配置。</p> <pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> eslint prettier eslint-config-prettier eslint-plugin-prettier eslint-plugin-vue @typescript-eslint/parser vue-eslint-parser
</code></pre> <pre><code class="prism language-javascript"><span class="token comment">// .eslintrc.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
  <span class="token literal-property property">root</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token literal-property property">env</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">node</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token comment">// The Follow config only works with eslint-plugin-vue v8.0.0+</span>
    <span class="token string-property property">"vue/setup-compiler-macros"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">extends</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">"plugin:vue/vue3-essential"</span><span class="token punctuation">,</span>
    <span class="token string">"eslint:recommended"</span><span class="token punctuation">,</span>
    <span class="token string">"@vue/typescript/recommended"</span><span class="token punctuation">,</span>
    <span class="token string">"plugin:prettier/recommended"</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"vue"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">"vue-eslint-parser"</span><span class="token punctuation">,</span>
  <span class="token literal-property property">parserOptions</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">parser</span><span class="token operator">:</span> <span class="token string">"@typescript-eslint/parser"</span><span class="token punctuation">,</span>
    <span class="token literal-property property">ecmaVersion</span><span class="token operator">:</span> <span class="token number">2020</span><span class="token punctuation">,</span> 
    <span class="token literal-property property">sourceType</span><span class="token operator">:</span> <span class="token string">"module"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"no-console"</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"production"</span> <span class="token operator">?</span> <span class="token string">"warn"</span> <span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"no-debugger"</span><span class="token operator">:</span> <span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">"production"</span> <span class="token operator">?</span> <span class="token string">"warn"</span> <span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"prettier/prettier"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token literal-property property">endOfLine</span><span class="token operator">:</span> <span class="token string">"auto"</span> <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"no-unreachable"</span><span class="token operator">:</span> <span class="token string">"warn"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"vue/no-unused-vars"</span><span class="token operator">:</span> <span class="token string">"warn"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"@typescript-eslint/no-var-requires"</span><span class="token operator">:</span> <span class="token string">"off"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token literal-property property">globals</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> </li><li> <p>css预处理器</p> <p>由于vite内置了关于css预处理的支持，因此只需安装相应的预处理器依赖即可，以less为例：</p> <pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> <span class="token function">less</span>
</code></pre> </li></ol> 
<h5><a id="2_electron_170"></a>2. electron集成</h5> 
<h6><a id="1__172"></a>1. 集成</h6> 
<p>注：由于package.json中的dependencies是在node生产环境运行时需要的，而electron是完全游离在node之外的，因此不需要生产环境的依赖，安装在devDependecies下即可。</p> 
<p>安装electron用默认源可能会比较耗时，建议用nrm换源到taobao：</p> 
<pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-g</span> nrm

nrm use taobao
</code></pre> 
<p>然后安装electron：</p> 
<pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> electron
</code></pre> 
<p>若不切换taobao源基本会在此处报错ETIMEOUT，解决方法如下：</p> 
<pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> config <span class="token builtin class-name">set</span> ELECTRON_MIRROR https://npmmirror.com/mirrors/electron/

<span class="token comment"># 或项目根目录新建.npmrc文件，并在其中添加</span>
<span class="token assign-left variable">electron_mirror</span><span class="token operator">=</span>https://npmmirror.com/mirrors/electron/
</code></pre> 
<p>此时已经可以编写electron程序了，让我们写一个main.js创建electron主进程：</p> 
<pre><code class="prism language-javascript"><span class="token comment">// electron/main.js</span>
<span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> app<span class="token punctuation">,</span> BrowserWindow <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"electron"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">createWindow</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">const</span> win <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BrowserWindow</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
    <span class="token literal-property property">webPreferences</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token literal-property property">contextIsolation</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否开启隔离上下文</span>
      <span class="token literal-property property">nodeIntegration</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 渲染进程使用Node API</span>
      <span class="token literal-property property">preload</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"./preload.ts"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 需要引用js文件</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


  <span class="token comment">// 如果打包了，渲染index.html</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>isPackaged<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    win<span class="token punctuation">.</span><span class="token function">loadFile</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"../dist/index.html"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
    win<span class="token punctuation">.</span><span class="token function">loadURL</span><span class="token punctuation">(</span><span class="token string">"http://127.0.0.1:5173"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>


app<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建窗口</span>
  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"activate"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>BrowserWindow<span class="token punctuation">.</span><span class="token function">getAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">// 关闭窗口</span>
app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"window-all-closed"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>platform <span class="token operator">!==</span> <span class="token string">"darwin"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    app<span class="token punctuation">.</span><span class="token function">quit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后在package.json中指定electron程序的主进程入口，并添加electron启动脚本：</p> 
<pre><code class="prism language-json"><span class="token comment">// package.json</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"name"</span><span class="token operator">:</span> <span class="token string">"electron-vue-demo"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"private"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token string-property property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.0"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"type"</span><span class="token operator">:</span> <span class="token string">"commonjs"</span><span class="token punctuation">,</span> <span class="token comment">// 注意，这里必须被指定为commonjs，否则打包时无法解析node的commonjs模块</span>
  <span class="token string-property property">"author"</span><span class="token operator">:</span> <span class="token string">"cyanAir"</span><span class="token punctuation">,</span>
  <span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"./electron/main.js"</span><span class="token punctuation">,</span> <span class="token comment">// 主进程入口</span>
    <span class="token string-property property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"dev"</span><span class="token operator">:</span> <span class="token string">"vite --host"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token string">"vue-tsc &amp;&amp; vite build"</span><span class="token punctuation">,</span>
    <span class="token string-property property">"dev:electron"</span><span class="token operator">:</span> <span class="token string">"./electron/main.js"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>此时先运行<code>npm run dev</code>然后运行<code>npm run dev:electron</code>就可以看见已经启动了electron项目，如下：</p> 
<p><img src="https://images2.imgbox.com/91/5d/f5wOhPfZ_o.png" alt="image-20230116151658920"></p> 
<h6><a id="2__268"></a>2. 启动流程优化</h6> 
<p>由于每次启动都需要先启动vue再启动electron有点麻烦，而且由于vue项目默认ts编译不产生产物的问题，无法通过使用ts编写electron主进程相关的代码。此时需要引入<code>vite-plugin-electron</code>插件：</p> 
<pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> vite-plugin-electron
</code></pre> 
<p>之后在vite.config.ts中引入：</p> 
<pre><code class="prism language-typescript"><span class="token keyword">import</span> <span class="token punctuation">{<!-- --></span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"vite"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> vue <span class="token keyword">from</span> <span class="token string">"@vitejs/plugin-vue"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> electron <span class="token keyword">from</span> <span class="token string">"vite-plugin-electron"</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token operator">*</span> <span class="token keyword">as</span> path <span class="token keyword">from</span> <span class="token string">"path"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    alias<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"@"</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"src"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token string-property property">"#"</span><span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">"electron"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">electron</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"electron/main.ts"</span><span class="token punctuation">,</span> <span class="token string">"electron/preload.ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// electron主进程调用入口文件、preload文件</span>
      vite<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
        build<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
          rollupOptions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// c/c++链接库</span>
            external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  build<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    emptyOutDir<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 默认情况下，若 outDir 在 root 目录下，则 Vite 会在构建时清空该目录</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>而后将<code>electron/mian.js</code>改为main.ts，之后main.ts会在electron运行前编译，编译产物会出现在<code>dist-electron/</code>目录下，因此同时需要更改package.json中的main参数，如下：</p> 
<pre><code class="prism language-json"><span class="token comment">// package.json</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    <span class="token string-property property">"main"</span><span class="token operator">:</span> <span class="token string">"./dist-electron/main.js"</span><span class="token punctuation">,</span> <span class="token comment">// 主进程入口</span>
    <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>此后只需要运行<code>npm run dev</code>，就会自动运行electron。</p> 
<blockquote> 
 <p>⭐注意：上方使用的插件版本为v0.11.2，由于<a href="https://github.com/electron-vite/vite-plugin-electron/commit/ab990b94fc6ab263fa69b7ff43cb34c58c652163">这个commit</a>，若希望使用v0.15.x及之后的版本，需要修改使用方式为如下形式：</p> 
 <pre><code class="prism language-typescript">plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
 <span class="token function">vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
 <span class="token function">electron</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{<!-- --></span> entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"electron/preload.ts"</span><span class="token punctuation">]</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{<!-- --></span>
     entry<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">"electron/main.ts"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// electron主进程调用入口文件</span>
     vite<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
       build<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
         rollupOptions<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
           <span class="token comment">// c/c++链接库</span>
           external<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
         <span class="token punctuation">}</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">}</span><span class="token punctuation">,</span>
 <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> 
</blockquote> 
<h6><a id="3_web_devtools_348"></a>3. 开发环境web devtools引入</h6> 
<p>web开发过程中，通常需要通过devtools进行调试，因此在electron应用中很有必要引入devtools，先安装<code>electron-devtools-installer</code>：</p> 
<pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token comment"># 取决于生产环境是否需要使用，安装在dep还是devDep下需要自己决定</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> electron-devtools-installer
</code></pre> 
<p>然后在<code>electron/main.ts中</code>引入：</p> 
<pre><code class="prism language-typescript"><span class="token comment">// electron/main.ts</span>
<span class="token keyword">import</span> installExtension<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span> <span class="token constant">VUEJS3_DEVTOOLS</span> <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"electron-devtools-installer"</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> isDevelopment <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">import</span><span class="token punctuation">.</span>meta<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">PROD</span><span class="token punctuation">;</span> <span class="token comment">// 环境</span>
<span class="token operator">...</span>

app<span class="token punctuation">.</span><span class="token function">whenReady</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 创建窗口</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isDevelopment<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// Install Vue Devtools</span>
    <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
      <span class="token keyword">await</span> <span class="token function">installExtension</span><span class="token punctuation">(</span><span class="token constant">VUEJS3_DEVTOOLS</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"Vue Devtools failed to install:"</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  win<span class="token punctuation">.</span>webContents<span class="token punctuation">.</span><span class="token function">openDevTools</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> mode<span class="token operator">:</span> <span class="token string">"right"</span><span class="token punctuation">,</span> activate<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 默认在右侧打开开发工具</span>
  app<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"activate"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>BrowserWindow<span class="token punctuation">.</span><span class="token function">getAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">===</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token function">createWindow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>此后可以通过在electron应用中<code>ctrl + shift + i</code>打开/关闭开发工具。</p> 
<h6><a id="4__385"></a>4. 应用打包</h6> 
<p>electron应用打包官方推荐的是<code>elelctron-forge</code>，我当时没有用的这个包，用的<code>electron-builder</code>，因此下面我只会讲<code>electron-builder</code>的打包。</p> 
<p>首先需要安装<code>electron-builder</code></p> 
<pre><code class="prism language-shell"><span class="token comment"># use npm or yarn or pnpm</span>
<span class="token function">npm</span> <span class="token function">install</span> <span class="token parameter variable">-D</span> electron-builder
</code></pre> 
<p>然后在package.json中添加build参数，具体参数见<a href="https://www.electron.build/" rel="nofollow">electron-builder官网</a>：</p> 
<pre><code class="prism language-json"><span class="token comment">// package.json</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
  <span class="token string-property property">"build"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token string-property property">"appId"</span><span class="token operator">:</span> <span class="token string">"com.my-website.my-app"</span><span class="token punctuation">,</span> <span class="token comment">// 应用id，两个如果相同的话，安装会覆盖</span>
    <span class="token string-property property">"productName"</span><span class="token operator">:</span> <span class="token string">"MyApp"</span><span class="token punctuation">,</span> <span class="token comment">// 应用名，打包后的应用名称</span>
    <span class="token string-property property">"copyright"</span><span class="token operator">:</span> <span class="token string">"Copyright © 2022 ${author}"</span><span class="token punctuation">,</span> <span class="token comment">// 著作权</span>
    <span class="token string-property property">"asar"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否使用asar归档文件，详情可以看https://www.electronjs.org/zh/docs/latest/tutorial/asar-archives</span>
    <span class="token string-property property">"npmRebuild"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否每次打包时都用npm rebuild重新构建node模块生成对应的动态链接库</span>
    <span class="token string-property property">"extraResources"</span><span class="token operator">:</span> <span class="token punctuation">[</span>  <span class="token comment">// 纯静态资源（不经历build过程，单纯拷贝，类似webpack中的copy-webpack-plugin）</span>
      <span class="token punctuation">{<!-- --></span>
        <span class="token string-property property">"from"</span><span class="token operator">:</span> <span class="token string">"config.conf"</span><span class="token punctuation">,</span>
        <span class="token string-property property">"to"</span><span class="token operator">:</span> <span class="token string">"../"</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"directories"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token string-property property">"buildResources"</span><span class="token operator">:</span> <span class="token string">"assets"</span><span class="token punctuation">,</span> <span class="token comment">// 静态资源路径</span>
      <span class="token string-property property">"output"</span><span class="token operator">:</span> <span class="token string">"release/${version}"</span> <span class="token comment">// 输出地址</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"files"</span><span class="token operator">:</span> <span class="token punctuation">[</span>	<span class="token comment">// 需要进行打包的文件/目录</span>
      <span class="token string">"dist/**/*"</span><span class="token punctuation">,</span>
      <span class="token string">"dist-electron/**/*"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token string-property property">"win"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// windows打包相关配置</span>
      <span class="token string-property property">"target"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 打包产物</span>
        <span class="token punctuation">{<!-- --></span>
          <span class="token string-property property">"target"</span><span class="token operator">:</span> <span class="token string">"nsis"</span><span class="token punctuation">,</span> <span class="token comment">// 使用的安装包程序</span>
          <span class="token string-property property">"arch"</span><span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token comment">// 架构</span>
            <span class="token string">"x64"</span>
          <span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string-property property">"artifactName"</span><span class="token operator">:</span> <span class="token string">"${productName}_${version}.${ext}"</span> <span class="token comment">// 安装包名称</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token string-property property">"nsis"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// nsis安装包程序配置</span>
      <span class="token string-property property">"oneClick"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否一键安装</span>
      <span class="token string-property property">"language"</span><span class="token operator">:</span> <span class="token string">"2052"</span><span class="token punctuation">,</span> <span class="token comment">// 默认语言，2052-简体中文</span>
      <span class="token string-property property">"perMachine"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 是否默认为PC上的每一个用户安装</span>
      <span class="token string-property property">"allowToChangeInstallationDirectory"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否允许自定义安装目录</span>
      <span class="token string-property property">"deleteAppDataOnUninstall"</span><span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// 卸载时是否删除AppData目录下的文件</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后再添加electron-builder打包的脚本：</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token operator">...</span>
  <span class="token string-property property">"script"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
      <span class="token operator">...</span>
      <span class="token string-property property">"electron:build"</span><span class="token operator">:</span> <span class="token string">"vue-tsc &amp;&amp; vite build &amp;&amp; electron-builder"</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>此时若直接运行，会报下面的错：</p> 
<p><img src="https://images2.imgbox.com/8d/2b/M38PASIW_o.png" alt="image-20230116172135380"></p> 
<p>这是由于vue-tsc进行ts检查时发现有模块不能生成js产物导致的，在tsconfig.json中添加：</p> 
<pre><code class="prism language-json"><span class="token comment">// tsconfig.json</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"compilerOptions"</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
    <span class="token operator">...</span>
    <span class="token string-property property">"noEmit"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>在这之后就可以进行打包了，打包后的产物如图：</p> 
<p><img src="https://images2.imgbox.com/ea/04/m3NRLizk_o.png" alt="image-20230116172552959"></p> 
<p>其中<code>win-unpacked/</code>为打包后的可执行程序，<code>MyApp_0.0.0.exe</code>为安装包。</p> 
<p>此时打开win-unpacked/MyApp.exe（或安装后打开应用程序），应该可以正常看到应用画面。</p> 
<h6><a id="5__482"></a>5. 应用日志</h6> 
<p>在打包后，我们的浏览器控制台一般情况下是无法打开的，此时如果发生了错误，我们就需要应用日志帮助我们定位问题所在。</p> 
<p>首先安装<code>electron-log</code>：</p> 
<pre><code class="prism language-shell"><span class="token function">npm</span> <span class="token function">install</span> electron-log
</code></pre> 
<p>然后在需要的地方引入（以应用入口为例，一般应用入口会有一个全局错误处理的方法）：</p> 
<pre><code class="prism language-typescript"><span class="token keyword">const</span> log <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">"electron-log"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">...</span>

<span class="token comment">// 异常捕获，避免异常闪退</span>
process<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">"uncaughtException"</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{<!-- --></span>
  log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>其中log文件默认路径为：</p> 
<pre><code>%USERPROFILE%\AppData\%PROJECT_NAME%\logs\main.log	// Windows
~/.config/{app name}/logs/main.log	// Linux
~/Library/Logs/{app name}/main.log	// MacOS
</code></pre> 
<p>如果希望修改可以通过<code>log.transports.file.resolvePath = () =&gt; PATH</code>和<code>log.transports.fileName</code>来修改，其中<code>reslovePath</code>的定义如下：</p> 
<pre><code class="prism language-typescript"><span class="token function-variable function">resolvePathFn</span><span class="token operator">:</span> <span class="token punctuation">(</span>variables<span class="token operator">:</span> PathVariables<span class="token punctuation">,</span> message<span class="token operator">?</span><span class="token operator">:</span> LogMessage<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
</code></pre> 
<p><code>electron-log</code>的具体用法详见<a href="https://www.npmjs.com/package/electron-log" rel="nofollow">其npm包</a>。</p> 
<h6><a id="6__521"></a>6. 路径引用</h6> 
<p>electron中文件路径与普通的vue项目略有不同，下面进行说明。</p> 
<ol><li> <p>vue项目中文件之间的相互引用不需要做任何修改，因为vue部分在vite打包之后会被作为一个整体放入asar归档文件中，因此可以正常引用。</p> </li><li> <p>electron及node后端部分若需要进行文件读取等操作，有三种定义的路径（MacOS、Linux类似）：</p> <pre><code>__dirname  =&gt;  %USERPROFILE%\AppData\Local\Programs\MyApp\resources\app.asar\%FILE_DIRNAME%
app.getAppPath()  =&gt;  %USERPROFILE%\AppData\Local\Programs\MyApp\resources\app.asar
process.cwd()  =&gt;  exe程序文件所在的目录
</code></pre> </li></ol> 
<h6><a id="7_node_535"></a>7. 非node原生模块的构建</h6> 
<p>未完待续</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a643eeb5bf3c322741e29410ea1f152b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue Echarts 多折线图只有一条X轴（合并X轴数据并去重排序） - 附完整示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dd1e2cc4a5be6d9e43ddbbc9078a7d18/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">积水监测识别摄像机</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>