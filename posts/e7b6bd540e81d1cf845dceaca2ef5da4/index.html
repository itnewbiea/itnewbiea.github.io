<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>入门学习爬取贴吧图片（附完整代码），2021/1/27有效 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="入门学习爬取贴吧图片（附完整代码），2021/1/27有效" />
<meta property="og:description" content="记录一下爬虫学习爬取贴吧图片，按照以下b站视频教学，2021/1/27亲测有效，不会被封ip。
Python爬虫实战讲解：爬取百度贴吧全站图片
结果如下（手动打码）：
源代码和笔记如下：
#多页爬取 &#39;&#39;&#39; 需要环境 requests，parsel（xpath） 步骤 1.确定url地址 2.发送请求 3.解析数据（数据筛选）&lt;两层数据解析&gt; 4.保存数据（本地文件） &#39;&#39;&#39; #requests实现帮助请求数据的要求 import requests import parsel page_num = 0 #换页 for page in range(0,55000&#43;1,50): page_num&#43;=1 print(&#39;===========================正在爬取第{}页数据====================&#39;.format(str(page_num))) #1.确定url地址 #先确定它是静态网页还是动态网页 #静态网页：源代码都有网页的数据，并且没有经过浏览器的渲染以及加载 #判断静态数据：在源代码中搜索的到 url = &#39;https://tieba.baidu.com/f?ie=utf-8&amp;kw=%E7%BA%A6%E4%BC%9A%E5%90%A7&amp;fr=search&amp;pn={}&#39;.format(str(page)) #之后准备请求参数 #刷新页面后，Chrome的Network栏所有的数据包都可以呈现 #user-agent更换为了ie浏览器，方便后面的操作 headers = {&#39;User-Agent&#39;: &#39;Mozilla/5.0 (Windows NT 10.0; WoW64; Trident/7.0; rv:11.0) like Gecko&#39;} #2.发送请求 response = requests.get(url,headers=headers) #状态码：200左右表示请求成功，300左右表示重定向，400左右表示URL地址有错误，500左右表示服务器错误 html_data = response.text #字符串类型数据，只能使用正则表达式 #print(html_data) #3.解析数据（数据筛选）&lt;两层数据解析&gt; #为了获得最高清的图片，而不是缩略图 #数据解析第一层：解析所有帖子的《链接》 #将字符串数据转换成Selector对象；该对象有re（正则表达式），css选择器，xpath路径选择器 html = parsel.Selector(html_data) #print(html) #两个/（双斜杠）表示跨节点提取，[@." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e7b6bd540e81d1cf845dceaca2ef5da4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-27T11:26:01+08:00" />
<meta property="article:modified_time" content="2021-01-27T11:26:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">入门学习爬取贴吧图片（附完整代码），2021/1/27有效</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>记录一下爬虫学习爬取贴吧图片，按照以下b站视频教学，2021/1/27亲测有效，不会被封ip。<br> <a href="https://www.bilibili.com/video/BV1sA411Y7in" rel="nofollow">Python爬虫实战讲解：爬取百度贴吧全站图片</a></p> 
<p>结果如下（手动打码）：<br> <img src="https://images2.imgbox.com/43/cb/0rf4AJOm_o.png" alt="在这里插入图片描述"></p> 
<p>源代码和笔记如下：</p> 
<pre><code class="prism language-python"><span class="token comment">#多页爬取</span>

<span class="token triple-quoted-string string">'''
需要环境
requests，parsel（xpath）

步骤
1.确定url地址
2.发送请求
3.解析数据（数据筛选）&lt;两层数据解析&gt;
4.保存数据（本地文件）
'''</span>

<span class="token comment">#requests实现帮助请求数据的要求</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> parsel

page_num <span class="token operator">=</span> <span class="token number">0</span>
<span class="token comment">#换页</span>
<span class="token keyword">for</span> page <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">55000</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">50</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    page_num<span class="token operator">+=</span><span class="token number">1</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'===========================正在爬取第{}页数据===================='</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>page_num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#1.确定url地址</span>
    <span class="token comment">#先确定它是静态网页还是动态网页</span>
    <span class="token comment">#静态网页：源代码都有网页的数据，并且没有经过浏览器的渲染以及加载</span>
    <span class="token comment">#判断静态数据：在源代码中搜索的到</span>
    url <span class="token operator">=</span> <span class="token string">'https://tieba.baidu.com/f?ie=utf-8&amp;kw=%E7%BA%A6%E4%BC%9A%E5%90%A7&amp;fr=search&amp;pn={}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">#之后准备请求参数</span>
    <span class="token comment">#刷新页面后，Chrome的Network栏所有的数据包都可以呈现</span>
    <span class="token comment">#user-agent更换为了ie浏览器，方便后面的操作</span>
    headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'User-Agent'</span><span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Windows NT 10.0; WoW64; Trident/7.0; rv:11.0) like Gecko'</span><span class="token punctuation">}</span>

    <span class="token comment">#2.发送请求</span>
    response <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span>
    <span class="token comment">#状态码：200左右表示请求成功，300左右表示重定向，400左右表示URL地址有错误，500左右表示服务器错误</span>
    html_data <span class="token operator">=</span> response<span class="token punctuation">.</span>text <span class="token comment">#字符串类型数据，只能使用正则表达式</span>
    <span class="token comment">#print(html_data)</span>

    <span class="token comment">#3.解析数据（数据筛选）&lt;两层数据解析&gt;</span>
    <span class="token comment">#为了获得最高清的图片，而不是缩略图</span>
    <span class="token comment">#数据解析第一层：解析所有帖子的《链接》</span>
    <span class="token comment">#将字符串数据转换成Selector对象；该对象有re（正则表达式），css选择器，xpath路径选择器</span>
    html <span class="token operator">=</span> parsel<span class="token punctuation">.</span>Selector<span class="token punctuation">(</span>html_data<span class="token punctuation">)</span>
    <span class="token comment">#print(html)</span>
    <span class="token comment">#两个/（双斜杠）表示跨节点提取，[@...]通过标签的属性值进行精确定位，标签层级递增的关系/div/a...，取到标签后获得href属性</span>
    <span class="token comment">#同样也返回Selector对象，getall提取出解析到的数据</span>
    title_url <span class="token operator">=</span> html<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="threadlist_lz clearfix"]/div/a/@href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getall<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#部分url的地址，和前面的地址拼接起来去实现</span>
    <span class="token comment">#print(title_url) #['/p/7203233304', '/p/7197583050'...]</span>

    <span class="token comment">#拼接url地址</span>
    <span class="token comment">#前半部分的url</span>
    second_url <span class="token operator">=</span> <span class="token string">'https://tieba.baidu.com'</span>
    <span class="token keyword">for</span> url <span class="token keyword">in</span> title_url<span class="token punctuation">:</span>
        all_url <span class="token operator">=</span> second_url <span class="token operator">+</span> url
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'当前的帖子链接为：'</span><span class="token punctuation">,</span> all_url<span class="token punctuation">)</span>

        <span class="token comment"># 第二层：再发送一次url请求，获得页面数据，随后解析出图片地址</span>
        <span class="token comment">#再次发送请求，请求帖子内部的数据</span>
        response_2 <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>all_url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token comment">#第二次解析</span>
        response_2_data <span class="token operator">=</span> parsel<span class="token punctuation">.</span>Selector<span class="token punctuation">(</span>response_2<span class="token punctuation">)</span>
        result_list <span class="token operator">=</span> response_2_data<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//cc/div/img[@class="BDE_Image"]/@src'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>getall<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment">#print(result_list) #['http://tiebapic.baidu.com/forum/w%3D580/sign=d941e7678413b07ebdbd50003cd69113/4d456709c93d70cf1974ca4befdcd100bba12b60.jpg', 'http://tiebapic.baidu.com/forum/w%3D580/sign=b6dbbb9a1ffa513d51aa6cd60d6c554c/b74ee5dde71190ef5192bc99d91b9d16fcfa6081.jpg']</span>

        <span class="token keyword">for</span> li <span class="token keyword">in</span> result_list<span class="token punctuation">:</span>
            <span class="token comment">#图片数据，需要content（二进制数据）</span>
            img_data <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>li<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token punctuation">.</span>content
            <span class="token comment">#4.保存数据（本地文件）</span>
            <span class="token comment">#图片的文件名和后缀</span>
            <span class="token comment">#'http://tiebapic.baidu.com/forum/w%3D580/sign=d941e7678413b07ebdbd50003cd69113/4d456709c93d70cf1974ca4befdcd100bba12b60.jpg'</span>
            file_name <span class="token operator">=</span> li<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
            <span class="token comment">#\\表示把文件保存到该文件夹下，mode文件写入方式(二进制wb)</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'img\\'</span><span class="token operator">+</span>file_name<span class="token punctuation">,</span>mode<span class="token operator">=</span><span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
                f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>img_data<span class="token punctuation">)</span>
                <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"正在保存："</span><span class="token punctuation">,</span>file_name<span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a5d05fedf7a3b61453e2895799d435bc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">linux mysql的使用_linux下mysql使用手册</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dd8c70cbf23e4837ffcc2803e894e0f7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">《Leaflet 基础知识点》- 地图定位、跳转和缩放</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>