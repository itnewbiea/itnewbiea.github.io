<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>nginx在国产服务器上stream配置项无法识别的问题 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="nginx在国产服务器上stream配置项无法识别的问题" />
<meta property="og:description" content="最近在搭建k8s&#43;ranchar，需要用到nginx做负载均衡，之前在系统中也会用到，之前一直使用http选项，做转发配置。
基本格式如下图所示：
但是在ranchar的安装中默认方式使用stream配置项。
使用yum默认安装的nginx不支持该关键字。
默认使用的版本是1.23.0，后来查了资料，可能是版本太高了，于是降低了版本，发现还是不支持，于是从官网下载源码包。
官网地址：https://nginx.org/en/download.html
使用需要进行配置、编译、安装，在配置过程中添加上对stream选项的支持即可。
# 添加使用--with-stream=dynamic 配置./configure --prefix=/usr/local/nginx/ --with-stream=dynamic# 然后make make# 然后make installmake install 安装之后，nginx就会被安装在/usr/local/nginx/路径下，测试可以进入/usr/local/nginx/conf路径下，使用stream的配置选项了
Nginx 的stream与http对比
问题是解决了，但是为什么要有两个类型的配置项？他们有什么区别呢？
Stream模块用于处理TCP、UDP和TLS协议，可以用来代理和负载均衡各种不同类型的流量。它能够支持代理和负载均衡TCP流量，例如SMTP、MySQL和Redis等。NGINX Stream模块支持按需加载，并提供配置选项来控制代理和负载均衡流量的行为。
HTTP模块则是用于处理HTTP请求和响应的模块。它作为一个反向代理，可以实现HTTP服务器上的负载均衡和缓存功能。HTTP模块还支持SSL/TLS终止、请求转发以及访问控制等功能。NGINX HTTP模块支持HTTP 1.0、HTTP 1.1和HTTP/2协议，并提供许多配置选项来调整HTTP交互的行为。
因此，NGINX Stream和HTTP之间的主要区别在于它们处理的协议和使用的功能不同。Stream模块适用于TCP、UDP和TLS流量的代理和负载均衡，而HTTP模块则专注于处理HTTP请求和响应。
而且我还做了实验，使用http模式来配置，nginx确实能启动，但是却不能在浏览器上打开rancher的页面，换成stream版本的就可以顺利打开~
结束~" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/243c3aefcea2cb4829d109addcda564c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-03T17:23:01+08:00" />
<meta property="article:modified_time" content="2024-01-03T17:23:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">nginx在国产服务器上stream配置项无法识别的问题</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近在搭建k8s+ranchar，需要用到nginx做负载均衡，之前在系统中也会用到，之前一直使用http选项，做转发配置。</p> 
<p>基本格式如下图所示：</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="431" src="https://images2.imgbox.com/aa/e1/xKCmWp2V_o.png" width="566"></p> 
<p>但是在ranchar的安装中默认方式使用stream配置项。</p> 
<p></p> 
<p class="img-center"><img alt="图片" height="446" src="https://images2.imgbox.com/84/e9/CYhvm7Pj_o.png" width="465"></p> 
<p>使用yum默认安装的nginx不支持该关键字。</p> 
<p>默认使用的版本是1.23.0，后来查了资料，可能是版本太高了，于是降低了版本，发现还是不支持，于是从官网下载源码包。</p> 
<p>官网地址：https://nginx.org/en/download.html</p> 
<p>使用需要进行配置、编译、安装，在配置过程中添加上对stream选项的支持即可。</p> 
<pre><code># 添加使用--with-stream=dynamic 配置</code><code>./configure --prefix=/usr/local/nginx/ --with-stream=dynamic</code><code># 然后make  </code><code>make</code><code># 然后make  install</code><code>make install</code></pre> 
<p>安装之后，nginx就会被安装在/usr/local/nginx/路径下，测试可以进入/usr/local/nginx/conf路径下，使用stream的配置选项了</p> 
<p><strong>Nginx 的stream与http对比</strong></p> 
<p>问题是解决了，但是为什么要有两个类型的配置项？他们有什么区别呢？</p> 
<p>Stream模块用于处理TCP、UDP和TLS协议，可以用来代理和负载均衡各种不同类型的流量。它能够支持代理和负载均衡TCP流量，例如SMTP、MySQL和Redis等。NGINX Stream模块支持按需加载，并提供配置选项来控制代理和负载均衡流量的行为。</p> 
<p>HTTP模块则是用于处理HTTP请求和响应的模块。它作为一个反向代理，可以实现HTTP服务器上的负载均衡和缓存功能。HTTP模块还支持SSL/TLS终止、请求转发以及访问控制等功能。NGINX HTTP模块支持HTTP 1.0、HTTP 1.1和HTTP/2协议，并提供许多配置选项来调整HTTP交互的行为。</p> 
<p>因此，NGINX Stream和HTTP之间的主要区别在于它们处理的协议和使用的功能不同。Stream模块适用于TCP、UDP和TLS流量的代理和负载均衡，而HTTP模块则专注于处理HTTP请求和响应。</p> 
<p>而且我还做了实验，使用http模式来配置，nginx确实能启动，但是却不能在浏览器上打开rancher的页面，换成stream版本的就可以顺利打开~</p> 
<p>结束~</p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a6f334356e242555b96772ac94b66cbe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">WSL 与真实 linux 环境区别有多大？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/41b9b729c8fe9316d34a5f1396c2fbcd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Unity报错：InvalidOperationException: Insecure connection not allowed的解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>