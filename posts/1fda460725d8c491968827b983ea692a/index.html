<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Openstack云平台脚本部署之计算节点服务配置（十五） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Openstack云平台脚本部署之计算节点服务配置（十五）" />
<meta property="og:description" content="目录
一、简介
二、部署脚本
三、参考文档
四、源码
五、系列文章
一、简介 计算节点上服务配置相对于控制节点和网络节点来说比较简单，很多都是配置Openstack服务客户端，这里主要进行集成Ceph的配置，并配置Openstack的nova、neutron、ceilometer的客户端，具体不再赘述，配置内容参考脚本及文档。
二、部署脚本 脚本部署比较简单，操作在控制节点进行，首先执行 install-configure-ceph-auth-client-key.sh进行集成Ceph操作（这个步骤会在控制节点和计算节点配置），完成认证配置，然后再执行脚本install-configure-compute-nodes-services.sh，完成Openstack计算节点上服务配置。
集成Ceph，添加Ceph认证授权，脚本 install-configure-ceph-auth-client-key.sh如下：
1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
#!/bin/sh
. ../0-set-config.sh
./style/print-split.sh &#34;Ceph Authentication Installation&#34;
###复制ceph配置文件 glance-api, cinder-volume, nova-compute and cinder-backup的主机名,由于存储和计算在同一个节点，不需要复制到自身
./pssh-exe C &#34;mkdir -p /etc/ceph/&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1fda460725d8c491968827b983ea692a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-06T19:54:16+08:00" />
<meta property="article:modified_time" content="2022-11-06T19:54:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Openstack云平台脚本部署之计算节点服务配置（十五）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="一、简介-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E7%AE%80%E4%BB%8B" rel="nofollow">一、简介</a></p> 
<p id="二、部署脚本-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E9%83%A8%E7%BD%B2%E8%84%9A%E6%9C%AC" rel="nofollow">二、部署脚本</a></p> 
<p id="三、参考文档-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E5%8F%82%E8%80%83%E6%96%87%E6%A1%A3" rel="nofollow">三、参考文档</a></p> 
<p id="四、源码-toc" style="margin-left:40px;"><a href="#%E5%9B%9B%E3%80%81%E6%BA%90%E7%A0%81" rel="nofollow">四、源码</a></p> 
<p id="五、系列文章-toc" style="margin-left:40px;"><a href="#%E4%BA%94%E3%80%81%E7%B3%BB%E5%88%97%E6%96%87%E7%AB%A0" rel="nofollow">五、系列文章</a></p> 
<hr id="hr-toc"> 
<p></p> 
<h3 id="一、简介">一、简介</h3> 
<p>计算节点上服务配置相对于控制节点和网络节点来说比较简单，很多都是配置Openstack服务客户端，这里主要进行集成Ceph的配置，并配置Openstack的nova、neutron、ceilometer的客户端，具体不再赘述，配置内容参考脚本及文档。</p> 
<h3 id="二、部署脚本">二、部署脚本</h3> 
<p>脚本部署比较简单，操作在控制节点进行，首先执行 install-configure-ceph-auth-client-key.sh进行集成Ceph操作（这个步骤会在控制节点和计算节点配置），完成认证配置，然后再执行脚本install-configure-compute-nodes-services.sh，完成Openstack计算节点上服务配置。</p> 
<p>集成Ceph，添加Ceph认证授权，脚本 install-configure-ceph-auth-client-key.sh如下：</p> 
<p></p> 
<table><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> <p>37</p> <p>38</p> </td><td> <p>#!/bin/sh</p> <p>. ../0-set-config.sh</p> <p>./style/print-split.sh "Ceph Authentication Installation"</p> <p></p> <p>###复制ceph配置文件 glance-api, cinder-volume, nova-compute and cinder-backup的主机名,由于存储和计算在同一个节点，不需要复制到自身</p> <p>./pssh-exe C "mkdir -p /etc/ceph/"</p> <p>scp $compute_host:/etc/ceph/ceph.conf /etc/ceph/ceph.conf</p> <p>./scp-exe C /etc/ceph/ceph.conf /etc/ceph/ceph.conf</p> <p>###[所有控制节点]在glance-api节点上</p> <p>./pssh-exe C "yum install -y python-rbd"</p> <p>###[所有控制节点]在nova-compute, cinder-backup 和cinder-volume节点上</p> <p>./pssh-exe C "yum install -y ceph-common"</p> <p>###安装Ceph客户端认证[这里放在控制节点执行执行，]</p> <p>ceph auth get-or-create client.glance mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=images'</p> <p>ceph auth get-or-create client.cinder-backup mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=backups'</p> <p>ceph auth get-or-create client.cinder mon 'allow r' osd 'allow class-read object_prefix rbd_children, allow rwx pool=volumes, allow rwx pool=vms, allow rwx pool=images'</p> <p>####为client.cinder, client.glance, and client.cinder-backup添加keyring</p> <p>. style/print-info.sh "Copy cinder.keyring &amp; glance.keyring &amp; cinder-backup.keyring to compute nodes"</p> <p>for ((i=0; i&lt;${#controller_map[@]}; i+=1));</p> <p>do</p> <p>  name=${controller_name[$i]};</p> <p>  ip=${controller_map[$name]};</p> <p>  ceph auth get-or-create client.glance | ssh $name  tee /etc/ceph/ceph.client.glance.keyring</p> <p>  ssh $name  chown glance:glance /etc/ceph/ceph.client.glance.keyring</p> <p>  ceph auth get-or-create client.cinder | ssh $name  tee /etc/ceph/ceph.client.cinder.keyring</p> <p>  ssh $name  chown cinder:cinder /etc/ceph/ceph.client.cinder.keyring</p> <p>  ceph auth get-or-create client.cinder-backup | ssh $name  tee /etc/ceph/ceph.client.cinder-backup.keyring</p> <p>  ssh $name  chown cinder:cinder /etc/ceph/ceph.client.cinder-backup.keyring</p> <p>done;</p> <p>###复制Keyring文件到nova-compute节点,为nova-compute节点上创建临时密钥</p> <p>. style/print-info.sh "Copy cinder.keyring to compute nodes"</p> <p>for ((i=0; i&lt;${#hypervisor_map[@]}; i+=1));</p> <p>do</p> <p>  name=${hypervisor_name[$i]};</p> <p>  ip=${hypervisor_map[$name]};</p> <p>  ceph auth get-or-create client.cinder | ssh $name  tee /etc/ceph/ceph.client.cinder.keyring</p> <p>  ceph auth get-key client.cinder | ssh $name tee client.cinder.key</p> <p>done;</p> </td></tr></tbody></table> 
<p>在每个计算节点安装配置Openstack服务，脚本install-configure-compute-nodes-services.sh如下：</p> 
<p></p> 
<table><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> </td><td> <p>#!/bin/sh</p> <p>. ../0-set-config.sh</p> <p>./style/print-split.sh "Openstack Services Installation on Compute Nodes"</p> <p>./scp-exe H compute_nodes_exec.sh /tmp</p> <p>./pssh-exe H "chmod +x /tmp/compute_nodes_exec.sh"</p> <p>./pssh-exe H "/tmp/compute_nodes_exec.sh $virtual_ip $local_nic $data_nic $password"</p> </td></tr></tbody></table> 
<p>配置方式采用了远程执行配置脚本，首先会将compute_nodes_exec.sh拷贝到每个计算节点上，然后再远程执行的该脚本，compute_nodes_exec.sh如下：</p> 
<p></p> 
<table><tbody><tr><td> <p>1</p> <p>2</p> <p>3</p> <p>4</p> <p>5</p> <p>6</p> <p>7</p> <p>8</p> <p>9</p> <p>10</p> <p>11</p> <p>12</p> <p>13</p> <p>14</p> <p>15</p> <p>16</p> <p>17</p> <p>18</p> <p>19</p> <p>20</p> <p>21</p> <p>22</p> <p>23</p> <p>24</p> <p>25</p> <p>26</p> <p>27</p> <p>28</p> <p>29</p> <p>30</p> <p>31</p> <p>32</p> <p>33</p> <p>34</p> <p>35</p> <p>36</p> <p>37</p> <p>38</p> <p>39</p> <p>40</p> <p>41</p> <p>42</p> <p>43</p> <p>44</p> <p>45</p> <p>46</p> <p>47</p> <p>48</p> <p>49</p> <p>50</p> <p>51</p> <p>52</p> <p>53</p> <p>54</p> <p>55</p> <p>56</p> <p>57</p> <p>58</p> <p>59</p> <p>60</p> <p>61</p> <p>62</p> <p>63</p> <p>64</p> <p>65</p> <p>66</p> <p>67</p> <p>68</p> <p>69</p> <p>70</p> <p>71</p> <p>72</p> <p>73</p> <p>74</p> <p>75</p> <p>76</p> <p>77</p> <p>78</p> <p>79</p> <p>80</p> <p>81</p> <p>82</p> <p>83</p> <p>84</p> <p>85</p> <p>86</p> <p>87</p> <p>88</p> <p>89</p> <p>90</p> <p>91</p> <p>92</p> <p>93</p> <p>94</p> <p>95</p> <p>96</p> <p>97</p> <p>98</p> <p>99</p> <p>100</p> <p>101</p> <p>102</p> <p>103</p> <p>104</p> <p>105</p> <p>106</p> <p>107</p> <p>108</p> <p>109</p> <p>110</p> <p>111</p> <p>112</p> <p>113</p> <p>114</p> <p>115</p> <p>116</p> <p>117</p> <p>118</p> <p>119</p> <p>120</p> <p>121</p> <p>122</p> <p>123</p> <p>124</p> <p>125</p> <p>126</p> <p>127</p> <p>128</p> <p>129</p> <p>130</p> <p>131</p> <p>132</p> <p>133</p> <p>134</p> <p>135</p> <p>136</p> <p>137</p> <p>138</p> <p>139</p> <p>140</p> <p>141</p> <p>142</p> <p>143</p> <p>144</p> <p>145</p> <p>146</p> <p>147</p> <p>148</p> <p>149</p> <p>150</p> <p>151</p> <p>152</p> <p>153</p> <p>154</p> <p>155</p> <p>156</p> <p>157</p> <p>158</p> <p>159</p> <p>160</p> <p>161</p> <p>162</p> <p>163</p> <p>164</p> <p>165</p> <p>166</p> <p>167</p> </td><td> <p>#!/bin/sh</p> <p>vip=$1</p> <p>local_nic=$2</p> <p>data_nic=$3</p> <p>password=$4</p> <p></p> <p>yum install -y centos-release-openstack-mitaka</p> <p>yum install -y python-openstackclient openstack-selinux openstack-utils</p> <p>### 安装组件</p> <p>yum install -y openstack-nova-compute</p> <p>yum install -y openstack-neutron-openvswitch</p> <p>yum install -y openstack-neutron openstack-neutron-ml2 openstack-neutron-openvswitch</p> <p>yum install -y ceph-common</p> <p>yum install -y openstack-ceilometer-compute python-ceilometerclient python-pecan</p> <p>### 1. OpenStack Compute service</p> <p>### 修改配置文件/etc/nova/nova.conf</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT my_ip $(ip addr show dev $local_nic scope global | grep "inet " | sed -e 's#.*inet ##g' -e 's#/.*##g')</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT use_neutron True</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT firewall_driver nova.virt.firewall.NoopFirewallDriver</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT memcached_servers controller01:11211,controller02:11211,controller03:11211</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT rpc_backend rabbit</p> <p>openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_hosts controller01:5672,controller02:5672,controller03:5672</p> <p>openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_ha_queues true</p> <p>openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_retry_interval 1</p> <p>openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_retry_backoff 2</p> <p>openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_max_retries 0</p> <p>openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_durable_queues true</p> <p>openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_userid openstack</p> <p>openstack-config --set /etc/nova/nova.conf oslo_messaging_rabbit rabbit_password $password</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT auth_strategy keystone</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_uri http://$vip:5000</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_url http://$vip:35357</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken memcached_servers controller01:11211,controller02:11211,controller03:11211</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken auth_type password</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken project_domain_name default</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken user_domain_name default</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken project_name service</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken username nova</p> <p>openstack-config --set /etc/nova/nova.conf keystone_authtoken password $password</p> <p>openstack-config --set /etc/nova/nova.conf oslo_concurrency lock_path /var/lib/nova/tmp</p> <p>openstack-config --set /etc/nova/nova.conf vnc enabled True</p> <p>openstack-config --set /etc/nova/nova.conf vnc vncserver_listen 0.0.0.0</p> <p>openstack-config --set /etc/nova/nova.conf vnc vncserver_proxyclient_address $(ip addr show dev $local_nic scope global | grep "inet " | sed -e 's#.*inet ##g' -e 's#/.*##g')</p> <p>openstack-config --set /etc/nova/nova.conf vnc novncproxy_base_url http://$vip:6080/vnc_auto.html</p> <p>openstack-config --set /etc/nova/nova.conf glance api_servers http://$vip:9292</p> <p>openstack-config --set /etc/nova/nova.conf libvirt virt_type  $(count=$(egrep -c '(vmx|svm)' /proc/cpuinfo); if [ $count -eq 0 ];then   echo "qemu"; else   echo "kvm"; fi)</p> <p></p> <p>### 打开虚拟机迁移的监听端口</p> <p>sed -i -e "s#\#listen_tls *= *0#listen_tls = 0#g" /etc/libvirt/libvirtd.conf</p> <p>sed -i -e "s#\#listen_tcp *= *1#listen_tcp = 1#g" /etc/libvirt/libvirtd.conf</p> <p>sed -i -e "s#\#auth_tcp *= *\"sasl\"#auth_tcp = \"none\"#g" /etc/libvirt/libvirtd.conf</p> <p>sed -i -e "s#\#LIBVIRTD_ARGS *= *\"--listen\"#LIBVIRTD_ARGS=\"--listen\"#g" /etc/sysconfig/libvirtd</p> <p></p> <p>#### 2. OpenStack Network service</p> <p>### 修改/etc/neutron/neutron.conf</p> <p>openstack-config --set /etc/neutron/neutron.conf DEFAULT rpc_backend rabbit</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_hosts controller01:5672,controller02:5672,controller03:5672</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_ha_queues true</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_retry_interval 1</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_retry_backoff 2</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_max_retries 0</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_durable_queues true</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_userid openstack</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_messaging_rabbit rabbit_password $password</p> <p>openstack-config --set /etc/neutron/neutron.conf DEFAULT auth_strategy keystone</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_uri http://$vip:5000</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_url http://$vip:35357</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken memcached_servers controller01:11211,controller02:11211,controller03:11211</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken auth_type password</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_domain_name default</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken user_domain_name default</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken project_name service</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken username neutron</p> <p>openstack-config --set /etc/neutron/neutron.conf keystone_authtoken password $password</p> <p>openstack-config --set /etc/neutron/neutron.conf oslo_concurrency lock_path /var/lib/neutron/tmp</p> <p></p> <p>### 配置Open vSwitch agent，/etc/neutron/plugins/ml2/openvswitch_agent.ini，注意，此处填写第二块网卡</p> <p>openstack-config --set /etc/neutron/plugins/ml2/openvswitch_agent.ini securitygroup enable_security_group True</p> <p>openstack-config --set /etc/neutron/plugins/ml2/openvswitch_agent.ini securitygroup enable_ipset True</p> <p>openstack-config --set /etc/neutron/plugins/ml2/openvswitch_agent.ini securitygroup firewall_driver iptables_hybrid</p> <p>openstack-config --set /etc/neutron/plugins/ml2/openvswitch_agent.ini ovs local_ip $(ip addr show dev $data_nic scope global | grep "inet " | sed -e 's#.*inet ##g' -e 's#/.*##g')</p> <p>openstack-config --set /etc/neutron/plugins/ml2/openvswitch_agent.ini agent tunnel_types vxlan</p> <p>openstack-config --set /etc/neutron/plugins/ml2/openvswitch_agent.ini agent l2_population False</p> <p>### 配置nova和neutron集成，/etc/nova/nova.conf</p> <p>openstack-config --set /etc/nova/nova.conf neutron url http://$vip:9696</p> <p>openstack-config --set /etc/nova/nova.conf neutron auth_url http://$vip:35357</p> <p>openstack-config --set /etc/nova/nova.conf neutron auth_type password</p> <p>openstack-config --set /etc/nova/nova.conf neutron project_domain_name default</p> <p>openstack-config --set /etc/nova/nova.conf neutron user_domain_name default</p> <p>openstack-config --set /etc/nova/nova.conf neutron region_name RegionOne</p> <p>openstack-config --set /etc/nova/nova.conf neutron project_name service</p> <p>openstack-config --set /etc/nova/nova.conf neutron username neutron</p> <p>openstack-config --set /etc/nova/nova.conf neutron password $password</p> <p>ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</p> <p></p> <p>### 3. OpenStack Block Storage service</p> <p>###计算节点安装客户端命令行工具</p> <p>echo "&lt;secret ephemeral='no' private='no'&gt;</p> <p>  &lt;uuid&gt;032198f4-b815-4254-9de2-185f935bd7de&lt;/uuid&gt;</p> <p>  &lt;usage type='ceph'&gt;</p> <p>    &lt;name&gt;client.cinder secret&lt;/name&gt;</p> <p>  &lt;/usage&gt;</p> <p>&lt;/secret&gt;"&gt;secret.xml</p> <p>virsh secret-define --file secret.xml</p> <p>virsh secret-set-value --secret 032198f4-b815-4254-9de2-185f935bd7de --base64 $(cat /etc/ceph/ceph.client.cinder.keyring |grep 'key ='|awk '{print $3}') &amp;&amp; rm secret.xml</p> <p></p> <p>###设置/etc/nova/nova.conf</p> <p>openstack-config --set /etc/nova/nova.conf libvirt images_type rbd</p> <p>openstack-config --set /etc/nova/nova.conf libvirt images_rbd_pool vms</p> <p>openstack-config --set /etc/nova/nova.conf libvirt images_rbd_ceph_conf /etc/ceph/ceph.conf</p> <p>openstack-config --set /etc/nova/nova.conf libvirt rbd_user cinder</p> <p>openstack-config --set /etc/nova/nova.conf libvirt rbd_secret_uuid $(virsh secret-list| grep ceph| awk '{print $1}')</p> <p>openstack-config --set /etc/nova/nova.conf libvirt disk_cachemodes \"network=writeback\"</p> <p>openstack-config --set /etc/nova/nova.conf libvirt inject_password false</p> <p>openstack-config --set /etc/nova/nova.conf libvirt inject_key false</p> <p>openstack-config --set /etc/nova/nova.conf libvirt inject_partition  -2</p> <p>openstack-config --set /etc/nova/nova.conf libvirt live_migration_flag "VIR_MIGRATE_UNDEFINE_SOURCE,VIR_MIGRATE_PEER2PEER,VIR_MIGRATE_LIVE,VIR_MIGRATE_PERSIST_DEST,VIR_MIGRATE_TUNNELLED"</p> <p></p> <p>### 4. OpenStack Ceilomerter service</p> <p>###[在计算节点上配置]</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf DEFAULT rpc_backend rabbit</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf oslo_messaging_rabbit rabbit_hosts controller01:5672,controller02:5672,controller03:5672</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf oslo_messaging_rabbit rabbit_ha_queues true</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf oslo_messaging_rabbit rabbit_retry_interval 1</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf oslo_messaging_rabbit rabbit_retry_backoff 2</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf oslo_messaging_rabbit rabbit_max_retries 0</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf oslo_messaging_rabbit rabbit_durable_queues true</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf oslo_messaging_rabbit rabbit_userid openstack</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf oslo_messaging_rabbit rabbit_password $password</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf DEFAULT auth_strategy keystone</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken auth_uri http://$vip:5000</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken auth_url http://$vip:35357</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken memcached_servers controller01:11211,controller02:11211,controller03:11211</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken auth_type password</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken project_domain_name default</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken user_domain_name default</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken project_name service</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken username ceilometer</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf keystone_authtoken password $password</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials auth_type password</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials auth_url http://$vip:5000/v3</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials project_domain_name default</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials user_domain_name default</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials project_name service</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials username ceilometer</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials password $password</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials interface internalURL</p> <p>openstack-config --set /etc/ceilometer/ceilometer.conf service_credentials region_name RegionOne</p> <p>### 配置nova使用ceilometer服务</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT instance_usage_audit True</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT instance_usage_audit_period hour</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT notify_on_state_change vm_and_task_state</p> <p>openstack-config --set /etc/nova/nova.conf DEFAULT notification_driver messagingv2</p> <p></p> <p>###启动服务</p> <p>systemctl enable libvirtd.service openstack-nova-compute.service</p> <p>systemctl start libvirtd.service openstack-nova-compute.service</p> <p>systemctl enable openstack-nova-compute.service</p> <p>systemctl restart openstack-nova-compute.service</p> <p>systemctl start openvswitch.service</p> <p>systemctl restart neutron-openvswitch-agent.service</p> <p>systemctl enable neutron-openvswitch-agent.service</p> <p></p> <p>###启动服务</p> <p>systemctl enable openstack-ceilometer-compute.service</p> <p>systemctl start openstack-ceilometer-compute.service</p> <p>systemctl restart openstack-nova-compute.service</p> </td></tr></tbody></table> 
<p></p> 
<h3 id="三、参考文档">三、参考文档</h3> 
<p><a href="https://docs.openstack.org/mitaka/install-guide-rdo/nova-compute-install.html" rel="nofollow" title="OpenStack Docs: Install and configure a compute node">OpenStack Docs: Install and configure a compute node</a></p> 
<p><a href="https://docs.openstack.org/mitaka/install-guide-rdo/neutron-compute-install.html" rel="nofollow" title="OpenStack Docs: Install and configure compute node">OpenStack Docs: Install and configure compute node</a></p> 
<p><a href="https://docs.openstack.org/ha-guide/compute-node-ha.html" rel="nofollow" title="Configuring the compute node — openstackhaguide 0.0.1.dev824 documentation">Configuring the compute node — openstackhaguide 0.0.1.dev824 documentation</a></p> 
<p><a href="https://docs.openstack.org/mitaka/install-guide-rdo/ceilometer-nova.html" rel="nofollow" title="OpenStack Docs: Enable Compute service meters">OpenStack Docs: Enable Compute service meters</a></p> 
<p><a href="http://docs.ceph.com/docs/master/rbd/rbd-openstack/" rel="nofollow" title="Block Devices and OpenStack — Ceph Documentation">Block Devices and OpenStack — Ceph Documentation</a></p> 
<p><a href="https://docs.openstack.org/kilo/networking-guide/scenario_legacy_ovs.html" rel="nofollow" title="OpenStack Docs: Scenario: Legacy with Open vSwitch">OpenStack Docs: Scenario: Legacy with Open vSwitch</a></p> 
<h3 id="四、源码">四、源码</h3> 
<p>脚本源码：https://github.com/zjmeixinyanzhi/Openstack-HA-Install-Shells</p> 
<h3 id="五、系列文章">五、系列文章</h3> 
<p>“<a href="http://zjzone.cc/?s=Openstack%E4%BA%91%E5%B9%B3%E5%8F%B0%E8%84%9A%E6%9C%AC%E9%83%A8%E7%BD%B2" rel="nofollow" title="Openstack云平台脚本部署">Openstack云平台脚本部署</a>”系列文章目录如下：</p> 
<p><a href="http://zjzone.cc/index.php/2017/03/15/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-gai-shu-ling/" rel="nofollow" title="Openstack云平台脚本部署之概述（零）">Openstack云平台脚本部署之概述（零）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/03/17/openstack-yun-ping-tai-bu-shu-zhi/" rel="nofollow" title="Openstack云平台脚本部署之基础环境配置（一）">Openstack云平台脚本部署之基础环境配置（一）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/03/21/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-galera-gao-ke-yong-ji-qun-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Galera高可用集群配置（二）">Openstack云平台脚本部署之Galera高可用集群配置（二）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/04/12/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-rabbitmq-gao-ke-yong-ji-qun-bu-shu/" rel="nofollow" title="Openstack云平台脚本部署之RabbitMQ高可用集群部署（三）">Openstack云平台脚本部署之RabbitMQ高可用集群部署（三）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/04/16/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-mongo-ji-qun/" rel="nofollow" title="Openstack云平台脚本部署之MongoDB配置（四）">Openstack云平台脚本部署之MongoDB配置（四）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/04/16/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-memcached-pei-zhi-wu/" rel="nofollow" title="Openstack云平台脚本部署之Memcached配置（五）">Openstack云平台脚本部署之Memcached配置（五）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/04/16/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-keystone-ren-zheng-fu-wu-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Keystone认证服务配置（六）">Openstack云平台脚本部署之Keystone认证服务配置（六）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/04/18/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-glance-jing-xiang-fu-wu-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Glance镜像服务配置（七）">Openstack云平台脚本部署之Glance镜像服务配置（七）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/04/18/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-nova-ji-suan-fu-wu-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Nova计算服务配置（八）">Openstack云平台脚本部署之Nova计算服务配置（八）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/04/18/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-neutron-wang-luo-fu-wu-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Neutron网络服务配置（九）">Openstack云平台脚本部署之Neutron网络服务配置（九）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/04/18/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-dashboard-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Dashboard配置（十）">Openstack云平台脚本部署之Dashboard配置（十）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/05/19/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-cinder-kuai-cun-chu-fu-wu-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Cinder块存储服务配置（十一）">Openstack云平台脚本部署之Cinder块存储服务配置（十一）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/05/19/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-telemetry-shu-ju-shou-ji-fu-wu-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Ceilometer数据收集服务配置（十二）">Openstack云平台脚本部署之Ceilometer数据收集服务配置（十二）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/05/19/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-aodh-gao-jing-fu-wu-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Aodh告警服务配置（十三）">Openstack云平台脚本部署之Aodh告警服务配置（十三）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/05/19/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-ceph-cun-chu-ji-qun-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之Ceph存储集群配置（十四）">Openstack云平台脚本部署之Ceph存储集群配置（十四）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/05/19/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-ji-suan-jie-dian-fu-wu-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之计算节点服务配置（十五）">Openstack云平台脚本部署之计算节点服务配置（十五）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/05/20/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-zeng-jia-ji-suan-jie-dian-pei-zhi/" rel="nofollow" title="Openstack云平台脚本部署之增加计算节点配置（十六）">Openstack云平台脚本部署之增加计算节点配置（十六）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/05/20/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-ce-shi-yan-zheng/" rel="nofollow" title="Openstack云平台脚本部署之测试验证（十七）">Openstack云平台脚本部署之测试验证（十七）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/11/28/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-ganglia-jian-kong/" rel="nofollow" title="Openstack云平台脚本部署之Ganglia监控（十八）">Openstack云平台脚本部署之Ganglia监控（十八）</a></p> 
<p><a href="http://zjzone.cc/index.php/2017/11/28/openstack-yun-ping-tai-jiao-ben-bu-shu-zhi-nagios-jian-kong/" rel="nofollow" title="Openstack云平台脚本部署之Nagios监控（十九）">Openstack云平台脚本部署之Nagios监控（十九）</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ed618bd3cf28a57c6152af89123128a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Yolov5（6.1）学习历险记</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a4f6ddaefc96e0684a2014474f7fb7fe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java学习笔记【1】</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>