<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>tf.train.MonitoredTrainingSession()解析【精】 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="tf.train.MonitoredTrainingSession()解析【精】" />
<meta property="og:description" content="最近看了下cifar10源码，训练代码中使用了tf.train.SessionRunHook()，tf.train.MonitoredTrainingSession()；查看官方API后终于有些眉目了，特记录备忘。
首先，先讲下tf.train.MonitoredTrainingSession()；
一 .MonitoredTrainingSession() 首先，tf.train.MonitorSession()从单词的字面意思理解是用于监控训练的回话，返回值是tf.train.MonitorSession()类的一个实例Object, tf.train.MonitorSession()会在下面讲。
MonitoredTrainingSession( master=&#39;&#39;, is_chief=True, checkpoint_dir=None, scaffold=None, hooks=None, chief_only_hooks=None, save_checkpoint_secs=600, save_summaries_steps=USE_DEFAULT, save_summaries_secs=USE_DEFAULT, config=None, stop_grace_period_secs=120, log_step_count_steps=100 ) Args:
is_chief：用于分布式系统中，用于判断该系统是否是chief，如果为True，它将负责初始化并恢复底层TensorFlow会话。如果为False，它将等待chief初始化或恢复TensorFlow会话。
checkpoint_dir：一个字符串。指定一个用于恢复变量的checkpoint文件路径。
scaffold：用于收集或建立支持性操作的脚手架。如果未指定，则会创建默认一个默认的scaffold。它用于完成图表
hooks：SessionRunHook对象的可选列表。可自己定义SessionRunHook对象，也可用已经预定义好的SessionRunHook对象，如：tf.train.StopAtStepHook()设置停止训练的条件；tf.train.NanTensorHook(loss):如果loss的值为Nan则停止训练；
chief_only_hooks：SessionRunHook对象列表。如果is_chief== True，则激活这些挂钩，否则忽略。
save_checkpoint_secs：用默认的checkpoint saver保存checkpoint的频率（以秒为单位）。如果save_checkpoint_secs设置为None，不保存checkpoint。
save_summaries_steps：使用默认summaries saver将摘要写入磁盘的频率（以全局步数表示）。如果save_summaries_steps和save_summaries_secs都设置为None，则不使用默认的summaries saver保存summaries。默认为100
save_summaries_secs：使用默认summaries saver将摘要写入磁盘的频率（以秒为单位）。如果save_summaries_steps和save_summaries_secs都设置为None，则不使用默认的摘要保存。默认未启用。
config：用于配置会话的tf.ConfigProtoproto的实例。它是tf.Session的构造函数的config参数。
stop_grace_period_secs：调用close（）后线程停止的秒数。
log_step_count_steps：记录全局步/秒的全局步数的频率
Returns: 一个MonitoredSession（） 实例。
下面主要介绍tf.train.MonitoredSession()类
二tf.train.MonitoredSession()类 官方文档给的定义是：
Session-like object that handles initialization, recovery and hooks. 是一个处理初始化，模型恢复，和处理Hooks的类似与Session的类。
Args:
session_creator:制定用于创建回话的ChiefSessionCreator
hooks:tf.train.SessionRunHook()实例的列表
Returns: 一个MonitoredSession 实例。
Example usage:
saver_hook = CheckpointSaverHook(...) summary_hook = SummarySaverHook(...) with MonitoredSession(session_creator=ChiefSessionCreator(...), hooks=[saver_hook, summary_hook]) as sess: while not sess." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ddc2e70982bffa00bc940431ef4f2154/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-11T20:36:35+08:00" />
<meta property="article:modified_time" content="2018-07-11T20:36:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">tf.train.MonitoredTrainingSession()解析【精】</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>最近看了下cifar10源码，训练代码中使用了tf.train.SessionRunHook()，tf.train.MonitoredTrainingSession()；查看官方API后终于有些眉目了，特记录备忘。</p> 
<p> </p> 
<p>首先，先讲下tf.train.MonitoredTrainingSession()；</p> 
<h2> 一 .MonitoredTrainingSession()</h2> 
<p> </p> 
<p>首先，tf.train.MonitorSession()从单词的字面意思理解是用于监控训练的回话，返回值是tf.train.MonitorSession()类的一个实例Object, tf.train.MonitorSession()会在下面讲。</p> 
<pre class="has"><code class="language-python">MonitoredTrainingSession(
    master='',
    is_chief=True,
    checkpoint_dir=None,
    scaffold=None,
    hooks=None,
    chief_only_hooks=None,
    save_checkpoint_secs=600,
    save_summaries_steps=USE_DEFAULT,
    save_summaries_secs=USE_DEFAULT,
    config=None,
    stop_grace_period_secs=120,
    log_step_count_steps=100
)</code></pre> 
<p><a name="args"></a>Args:</p> 
<ul><li> <p> is_chief：用于分布式系统中，用于判断该系统是否是chief，如果为True，它将负责初始化并恢复底层TensorFlow会话。如果为False，它将等待chief初始化或恢复TensorFlow会话。</p> </li></ul> 
<ul><li> <p> checkpoint_dir：一个字符串。指定一个用于恢复变量的checkpoint文件路径。</p> </li></ul> 
<ul><li> <p> scaffold：用于收集或建立支持性操作的脚手架。如果未指定，则会创建默认一个默认的scaffold。它用于完成图表</p> </li></ul> 
<ul><li> <p> hooks：SessionRunHook对象的可选列表。可自己定义SessionRunHook对象，也可用已经预定义好的SessionRunHook对象，如：tf.train.StopAtStepHook()设置停止训练的条件；tf.train.NanTensorHook(loss):如果loss的值为Nan则停止训练；</p> </li></ul> 
<ul><li> <p> chief_only_hooks：SessionRunHook对象列表。如果is_chief== True，则激活这些挂钩，否则忽略。</p> </li></ul> 
<ul><li> <p> </p> <p> save_checkpoint_secs：用默认的checkpoint saver保存checkpoint的频率（以秒为单位）。如果save_checkpoint_secs设置为None，不保存checkpoint。</p> </li></ul> 
<ul><li> <p>save_summaries_steps：使用默认summaries saver将摘要写入磁盘的频率（以全局步数表示）。如果save_summaries_steps和save_summaries_secs都设置为None，则不使用默认的summaries saver保存summaries。默认为100</p> </li></ul> 
<ul><li> <p> </p> <p>save_summaries_secs：使用默认summaries saver将摘要写入磁盘的频率（以秒为单位）。如果save_summaries_steps和save_summaries_secs都设置为None，则不使用默认的摘要保存。默认未启用。</p> </li></ul> 
<ul><li> <p> </p> <p>config：用于配置会话的tf.ConfigProtoproto的实例。它是tf.Session的构造函数的config参数。</p> </li></ul> 
<ul><li> <p> </p> <p> stop_grace_period_secs：调用close（）后线程停止的秒数。</p> </li></ul> 
<ul><li> <p> </p> <p> log_step_count_steps：记录全局步/秒的全局步数的频率</p> </li></ul> 
<p><a name="returns"></a>Returns:          </p> 
<p>       一个MonitoredSession（） 实例。</p> 
<p><br> 下面主要介绍tf.train.MonitoredSession()类</p> 
<h2> </h2> 
<h2><strong>二tf.train.MonitoredSession()类</strong></h2> 
<p>官方文档给的定义是：</p> 
<pre><code class="language-html hljs">Session-like object that handles initialization, recovery and hooks.</code></pre> 
<p>是一个处理初始化，模型恢复，和处理Hooks的类似与Session的类。</p> 
<p>Args:</p> 
<ul><li> <p> </p> <p>session_creator:制定用于创建回话的ChiefSessionCreator</p> </li></ul> 
<ul><li> <p> </p> <p>hooks:tf.train.SessionRunHook()实例的列表</p> </li></ul> 
<p>Returns:          </p> 
<p>         一个MonitoredSession 实例。</p> 
<p> </p> 
<p>Example usage:</p> 
<pre class="has"><code class="language-python">saver_hook = CheckpointSaverHook(...)
summary_hook = SummarySaverHook(...)
with MonitoredSession(session_creator=ChiefSessionCreator(...),
                      hooks=[saver_hook, summary_hook]) as sess:
    while not sess.should_stop():
        sess.run(train_op)</code></pre> 
<p><strong>初始化：</strong>在创建一个MonitoredSession时，会按顺序执行以下操作：</p> 
<ul><li>调用[Hooks]列表中每一个Hook的begin()函数</li><li>通过scaffold.finalize()完成图graph的定义</li><li>创建会话</li><li>用Scaffold提供的初始化操作(op)来初始化模型</li><li>如果给定checkpoint_dir中存在checkpoint文件，则用checkpoint恢复变量</li><li>启动队列线程</li><li>调用hook.after_create_session()</li></ul> 
<p><strong>Run:</strong>当调用run()函数时，按顺序执行以下操作</p> 
<ul><li>调用hook.before_run()</li><li>用合并后的fetches 和feed_dict调用TensorFlow的session.run() （这里是真正调用tf.Session().run(fetches ,feed_dict)）</li><li>调用hook.after_run()</li><li>返回用户需要的session.run()的结果</li><li>如果发生了AbortedError或者UnavailableError，则在再次执行run()之前恢复或者重新初始化会话</li></ul> 
<p><strong>Exit:</strong>当调用close()退出时，按顺序执行下列操作</p> 
<ul><li>调用hook.end()</li><li>关闭队列线程queuerunners和会话session</li><li> <p>在monitored_session的上下文中，抑制由于处理完所有输入抛出的OutOf Range错误。</p> </li></ul> 
<p> </p> 
<p>tf.train.MonitoredTrainingSession()中的tf.train.SessRunHook()介绍与使用请看我的<a href="https://blog.csdn.net/mrr1ght/article/details/81011280">另一篇博客</a>：</p> 
<p>才疏学浅，如有错误欢迎留言指出！</p> 
<p> </p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/83684821d3b4947a0ac934d90b5e1ccb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">AS编译异常Suggestion: use tools:overrideLibrary=&#34;&#34; to force usage</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/876f6fc2a1b3d6b1a10985f64d417e47/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">登录绑定回车事件</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>