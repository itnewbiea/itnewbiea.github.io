<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>R语言中的管道操作——magrittr包 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="R语言中的管道操作——magrittr包" />
<meta property="og:description" content="R语言中的管道操作——magrittr包 一、项目环境 开发工具：RStudioR：3.5.2相关包：magritter 二、数据准备以及问题阐述 这次要解决的问题是如何使用提取数据框中所有包含缺失值的列。我们知道当我们在处理缺失值时，我们经常会使用平均数、中位数、回归、甚至机器学习等方式来填补数据框中的缺失值。但是在实际的分析过程中，在进行缺失值处理之前，我们往往会花大量的时间来探究缺失值之间的相关性。那么在进行分析之前，首要任务自然就是先将所有包含缺失值的列提取出来。下面我们将会用几种方法来进行这一操作，并说明管道操作的优势。
# 首先我们先导入相关包和数据集 # 导入magrittr包 library(magrittr) # 导入VIM包中的包含缺失值的数据集“sleep” data(sleep,package = &#34;VIM&#34;) # 查看数据集的前几行数据 head(sleep) BodyWgtBrainWgtNonDDreamSleepSpanGestPredExpDanger6654.0005712.0NANA3.338.66453531.0006.66.32.08.34.5423133.38544.5NANA12.514.0601110.9205.7NANA16.5NA255232547.0004603.02.11.83.969.062435410.550179.59.10.79.827.0180444 BodyWgt： 体重
BrainWgt： 脑重
NonD： 不做梦时长
Dream： 做梦时长
Sleep： 睡眠时长
Span： 寿命
Gest： 妊娠期
Pred： 物种被捕食的程度
Exp： 睡眠时暴露的程度
Danger： 面临的总危险程度
三、提取包含缺失值的列 1、常规形式 library(dplyr) # 将原始数据赋值到一个临时变量中 data &lt;- sleep # 在R语言中，FALSE转换成数值会变成0，TRUE转换成数值会变成1 # 之所以用abs绝对值函数，是为了在将其转换成数值的前提下不破坏数据框的结构 data &lt;- apply(as.data.frame(abs(is.na(data))),2,sum) # 使用dplyr包的select函数选取所有包含缺失值的列 data &lt;- select(sleep,one_of(names(data[data &gt; 0]))) [注]：这是处理这类数据的一张常规的编写方法，但是会发现中间嵌套了很对层，不方便阅读和修改。同时中间变量data在这个计算的过程中重复出现了多次。
2、函数形式 library(dplyr) # 整体操作没什么变化，只是以函数的形式包裹起来，便于多次使用 na_col_plot &lt;- function(data){ data &lt;- as." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/3a44437ffde8e341bc80b0ef3019cf42/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-31T15:01:33+08:00" />
<meta property="article:modified_time" content="2023-05-31T15:01:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">R语言中的管道操作——magrittr包</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Rmagrittr_0"></a>R语言中的管道操作——magrittr包</h2> 
<h3><a id="_3"></a>一、项目环境</h3> 
<ul><li>开发工具：RStudio</li><li>R：3.5.2</li><li>相关包：magritter</li></ul> 
<h3><a id="_8"></a>二、数据准备以及问题阐述</h3> 
<p>这次要解决的问题是如何使用提取数据框中所有包含缺失值的列。我们知道当我们在处理缺失值时，我们经常会使用平均数、中位数、回归、甚至机器学习等方式来填补数据框中的缺失值。但是在实际的分析过程中，在进行缺失值处理之前，我们往往会花大量的时间来探究缺失值之间的相关性。那么在进行分析之前，首要任务自然就是先将所有包含缺失值的列提取出来。下面我们将会用几种方法来进行这一操作，并说明管道操作的优势。</p> 
<pre><code class="prism language-ruby"><span class="token comment"># 首先我们先导入相关包和数据集</span>
<span class="token comment"># 导入magrittr包</span>
library<span class="token punctuation">(</span>magrittr<span class="token punctuation">)</span>

<span class="token comment"># 导入VIM包中的包含缺失值的数据集“sleep”</span>
data<span class="token punctuation">(</span>sleep<span class="token punctuation">,</span>package <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"VIM"</span></span><span class="token punctuation">)</span>

<span class="token comment"># 查看数据集的前几行数据</span>
head<span class="token punctuation">(</span>sleep<span class="token punctuation">)</span>
</code></pre> 
<table><thead><tr><th>BodyWgt</th><th>BrainWgt</th><th>NonD</th><th>Dream</th><th>Sleep</th><th>Span</th><th>Gest</th><th>Pred</th><th>Exp</th><th>Danger</th></tr></thead><tbody><tr><td>6654.000</td><td>5712.0</td><td>NA</td><td>NA</td><td>3.3</td><td>38.6</td><td>645</td><td>3</td><td>5</td><td>3</td></tr><tr><td>1.000</td><td>6.6</td><td>6.3</td><td>2.0</td><td>8.3</td><td>4.5</td><td>42</td><td>3</td><td>1</td><td>3</td></tr><tr><td>3.385</td><td>44.5</td><td>NA</td><td>NA</td><td>12.5</td><td>14.0</td><td>60</td><td>1</td><td>1</td><td>1</td></tr><tr><td>0.920</td><td>5.7</td><td>NA</td><td>NA</td><td>16.5</td><td>NA</td><td>25</td><td>5</td><td>2</td><td>3</td></tr><tr><td>2547.000</td><td>4603.0</td><td>2.1</td><td>1.8</td><td>3.9</td><td>69.0</td><td>624</td><td>3</td><td>5</td><td>4</td></tr><tr><td>10.550</td><td>179.5</td><td>9.1</td><td>0.7</td><td>9.8</td><td>27.0</td><td>180</td><td>4</td><td>4</td><td>4</td></tr></tbody></table> 
<ul><li> <p><strong>BodyWgt</strong>： 体重</p> </li><li> <p><strong>BrainWgt</strong>： 脑重</p> </li><li> <p><strong>NonD</strong>： 不做梦时长</p> </li><li> <p><strong>Dream</strong>： 做梦时长</p> </li><li> <p><strong>Sleep</strong>： 睡眠时长</p> </li><li> <p><strong>Span</strong>： 寿命</p> </li><li> <p><strong>Gest</strong>： 妊娠期</p> </li><li> <p><strong>Pred</strong>： 物种被捕食的程度</p> </li><li> <p><strong>Exp</strong>： 睡眠时暴露的程度</p> </li><li> <p><strong>Danger</strong>： 面临的总危险程度</p> <h3><a id="_53"></a>三、提取包含缺失值的列</h3> </li></ul> 
<h4><a id="1_55"></a>1、常规形式</h4> 
<pre><code class="prism language-ruby">library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>

<span class="token comment"># 将原始数据赋值到一个临时变量中</span>
data <span class="token operator">&lt;</span><span class="token operator">-</span> sleep

<span class="token comment"># 在R语言中，FALSE转换成数值会变成0，TRUE转换成数值会变成1</span>
<span class="token comment"># 之所以用abs绝对值函数，是为了在将其转换成数值的前提下不破坏数据框的结构</span>
data <span class="token operator">&lt;</span><span class="token operator">-</span> apply<span class="token punctuation">(</span>as<span class="token punctuation">.</span>data<span class="token punctuation">.</span>frame<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>is<span class="token punctuation">.</span>na<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>sum<span class="token punctuation">)</span>

<span class="token comment"># 使用dplyr包的select函数选取所有包含缺失值的列</span>
data <span class="token operator">&lt;</span><span class="token operator">-</span> select<span class="token punctuation">(</span>sleep<span class="token punctuation">,</span>one_of<span class="token punctuation">(</span>names<span class="token punctuation">(</span>data<span class="token punctuation">[</span>data <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>[注]：这是处理这类数据的一张常规的编写方法，但是会发现中间嵌套了很对层，不方便阅读和修改。同时中间变量data在这个计算的过程中重复出现了多次。</p> 
</blockquote> 
<h4><a id="2_75"></a>2、函数形式</h4> 
<pre><code class="prism language-ruby">library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>

<span class="token comment"># 整体操作没什么变化，只是以函数的形式包裹起来，便于多次使用</span>
na_col_plot <span class="token operator">&lt;</span><span class="token operator">-</span> function<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
  data <span class="token operator">&lt;</span><span class="token operator">-</span> as<span class="token punctuation">.</span>data<span class="token punctuation">.</span>frame<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>is<span class="token punctuation">.</span>na<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  data <span class="token operator">&lt;</span><span class="token operator">-</span> apply<span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span>sum<span class="token punctuation">)</span>
  data <span class="token operator">&lt;</span><span class="token operator">-</span> select<span class="token punctuation">(</span>sleep<span class="token punctuation">,</span>one_of<span class="token punctuation">(</span>names<span class="token punctuation">(</span>data<span class="token punctuation">[</span>data <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

data <span class="token operator">&lt;</span><span class="token operator">-</span> na_col_plot<span class="token punctuation">(</span>sleep<span class="token punctuation">)</span>

</code></pre> 
<blockquote> 
 <p>[注]： 函数形式与通常形式，从整体上来说没有什么他也特别大的变化。但当该操作需要重复用到时，函数形式可以大大的减少代码量。</p> 
</blockquote> 
<h4><a id="3_95"></a>3、管道操作形式</h4> 
<pre><code class="prism language-ruby">library<span class="token punctuation">(</span>dplyr<span class="token punctuation">)</span>

<span class="token comment"># %&gt;% 管道函数可以将符号左边的数据结果，放入右边函数中，作为输入的参数</span>
data <span class="token operator">&lt;</span><span class="token operator">-</span> sleep <span class="token string-literal"><span class="token string">%&gt;%
          is.na() %&gt;</span></span><span class="token operator">%</span>
          abs<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token string-literal"><span class="token string">%&gt;%
          as.data.frame() %&gt;</span></span><span class="token operator">%</span>
          apply<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span>sum<span class="token punctuation">)</span>

data <span class="token operator">&lt;</span><span class="token operator">-</span> select<span class="token punctuation">(</span>sleep<span class="token punctuation">,</span>one_of<span class="token punctuation">(</span>names<span class="token punctuation">(</span>data<span class="token punctuation">[</span>data <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>[注]： 相比于其他形式，管道操作可以更好的看到整个处理过程的没一步骤</p> 
</blockquote> 
<h3><a id="_114"></a>四、结语</h3> 
<p>本文简单的以提取包含缺失值的列作为例子，来突出管道操作相较于其他形式的一个好处。<font color="red">在编写<strong>较短的一段线性操作时</strong>，管道操作相对于一般的操作和函数操作而言，可以更直观的展示整个线性操作的处理过程。</font>当时管道操作并不是万能的，当遇到单次较长的一个数据操作时，就需要定义有意义的中间变量来方便调试和理解其意图。同时当遇到需要重复多次使用、非线性操作或是多个输入项等情况，都尽量不要使用管道操作。</p> 
<hr> 
<p>很长一段时间没有在csdn中写文章了，事实上后面自己学习过程中的大部分文档都是在语雀中完成的，基本都是自己写自己看。后续文章都会分享到自己的个人博客上，感兴趣的话可以关注一下。<a href="https://chenshaolang.gitee.io/personal-blog/" rel="nofollow">个人博客地址</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4838b4fd56540027f0b215ae442fb5fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">第三方图像打标系统汇总</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4d9475f3234bcd593818f66a8f502b57/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">R语言数据预处理——离散化（分箱）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>