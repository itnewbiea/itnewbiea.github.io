<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot中 Jackson 日期的时区和日期格式问题 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot中 Jackson 日期的时区和日期格式问题" />
<meta property="og:description" content="目录
1、使用场景
1.1、数据库MySQL也是有时区的概念的。
1.2、系统时区意味着与计算机的操作系统时区相同。
1.2、SpringBoot默认的Json视图转换框架Jackson也有时区概念
2、代码实现
2.1、解决方案一下在每个带有日期地方加上注解
2.2、只需要配置一个bean实现整体修改
2.3、使用SpringBoot的配置方式
3、成果展现
4、总结
1、使用场景 因为最近项目需要国际化，需要能够支持多种国际化语言，目前需要支持三种(法语、英语、简体中文)。我们的项目部署环境为使用阿里云(德国)节点。以前我们项目主要用户在中国国内。一部署到德国服务器节点就出现一个问题了。数据返回的时间不对，存储的时间也有时差了。此文章仅仅与UTC标准时间与北京时间(东八区时间)作为实际例子。最后跟踪发现，如下几点原因：
1.1、数据库MySQL也是有时区的概念的。 通过如下命令可以查询MySQL的时区
show variables like &#34;%time_zone%&#34;; 如果未做任何修改会显示如下：
&#43;------------------&#43;--------&#43; | Variable_name | Value | &#43;------------------&#43;--------&#43; | system_time_zone | CST | | time_zone | SYSTEM | &#43;------------------&#43;--------&#43; 2 rows in set (0.00 sec) #time_zone说明mysql使用system的时区，system_time_zone说明system使用CST时区 1.2、系统时区意味着与计算机的操作系统时区相同。 以下是我们北京时间使用MySQL时区
set global time_zone = &#39;&#43;8:00&#39;; ##修改mysql全局时区为北京时间，即我们所在的东8区 &gt; set time_zone = &#39;&#43;8:00&#39;; ##修改当前会话时区 &gt; flush privileges; #立即生效 或者通过修改MySQL的 my.cnf配置文件来修改时区
# vim /etc/my.cnf ##在[mysqld]区域中加上" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/68397fc6c0333527e5a01a0376ad0e54/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-01T23:29:38+08:00" />
<meta property="article:modified_time" content="2019-05-01T23:29:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot中 Jackson 日期的时区和日期格式问题</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF-toc" style="margin-left:40px;"><a href="#1%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF" rel="nofollow">1、使用场景</a></p> 
<p id="1.1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93MySQL%E4%B9%9F%E6%98%AF%E6%9C%89%E6%97%B6%E5%8C%BA%E7%9A%84%E6%A6%82%E5%BF%B5%E7%9A%84%E3%80%82-toc" style="margin-left:80px;"><a href="#1.1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93MySQL%E4%B9%9F%E6%98%AF%E6%9C%89%E6%97%B6%E5%8C%BA%E7%9A%84%E6%A6%82%E5%BF%B5%E7%9A%84%E3%80%82" rel="nofollow">1.1、数据库MySQL也是有时区的概念的。</a></p> 
<p id="1.2%E3%80%81%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%8C%BA%E6%84%8F%E5%91%B3%E7%9D%80%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%8C%BA%E7%9B%B8%E5%90%8C%E3%80%82-toc" style="margin-left:80px;"><a href="#1.2%E3%80%81%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%8C%BA%E6%84%8F%E5%91%B3%E7%9D%80%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%8C%BA%E7%9B%B8%E5%90%8C%E3%80%82" rel="nofollow">1.2、系统时区意味着与计算机的操作系统时区相同。</a></p> 
<p id="1.2%E3%80%81SpringBoot%E9%BB%98%E8%AE%A4%E7%9A%84Json%E8%A7%86%E5%9B%BE%E8%BD%AC%E6%8D%A2%E6%A1%86%E6%9E%B6Jackson%E4%B9%9F%E6%9C%89%E6%97%B6%E5%8C%BA%E6%A6%82%E5%BF%B5-toc" style="margin-left:80px;"><a href="#1.2%E3%80%81SpringBoot%E9%BB%98%E8%AE%A4%E7%9A%84Json%E8%A7%86%E5%9B%BE%E8%BD%AC%E6%8D%A2%E6%A1%86%E6%9E%B6Jackson%E4%B9%9F%E6%9C%89%E6%97%B6%E5%8C%BA%E6%A6%82%E5%BF%B5" rel="nofollow">1.2、SpringBoot默认的Json视图转换框架Jackson也有时区概念</a></p> 
<p id="2%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0-toc" style="margin-left:40px;"><a href="#2%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0" rel="nofollow">2、代码实现</a></p> 
<p id="2.1%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%80%E4%B8%8B%E5%9C%A8%E6%AF%8F%E4%B8%AA%E5%B8%A6%E6%9C%89%E6%97%A5%E6%9C%9F%E5%9C%B0%E6%96%B9%E5%8A%A0%E4%B8%8A%E6%B3%A8%E8%A7%A3-toc" style="margin-left:80px;"><a href="#2.1%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%80%E4%B8%8B%E5%9C%A8%E6%AF%8F%E4%B8%AA%E5%B8%A6%E6%9C%89%E6%97%A5%E6%9C%9F%E5%9C%B0%E6%96%B9%E5%8A%A0%E4%B8%8A%E6%B3%A8%E8%A7%A3" rel="nofollow">2.1、解决方案一下在每个带有日期地方加上注解</a></p> 
<p id="2.2%E3%80%81%E5%8F%AA%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AAbean%E5%AE%9E%E7%8E%B0%E6%95%B4%E4%BD%93%E4%BF%AE%E6%94%B9-toc" style="margin-left:80px;"><a href="#2.2%E3%80%81%E5%8F%AA%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AAbean%E5%AE%9E%E7%8E%B0%E6%95%B4%E4%BD%93%E4%BF%AE%E6%94%B9" rel="nofollow">2.2、只需要配置一个bean实现整体修改</a></p> 
<p id="2.3%E3%80%81%E4%BD%BF%E7%94%A8SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F-toc" style="margin-left:80px;"><a href="#2.3%E3%80%81%E4%BD%BF%E7%94%A8SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F" rel="nofollow">2.3、使用SpringBoot的配置方式</a></p> 
<p id="3%E3%80%81%E6%88%90%E6%9E%9C%E5%B1%95%E7%8E%B0-toc" style="margin-left:40px;"><a href="#3%E3%80%81%E6%88%90%E6%9E%9C%E5%B1%95%E7%8E%B0" rel="nofollow">3、成果展现</a></p> 
<p id="4%E3%80%81%E6%80%BB%E7%BB%93-toc" style="margin-left:40px;"><a href="#4%E3%80%81%E6%80%BB%E7%BB%93" rel="nofollow">4、总结</a></p> 
<hr id="hr-toc"> 
<h3 id="1%E3%80%81%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">1、使用场景</h3> 
<p>        因为最近项目需要国际化，需要能够支持多种国际化语言，目前需要支持三种(法语、英语、简体中文)。我们的项目部署环境为使用阿里云(德国)节点。以前我们项目主要用户在中国国内。一部署到德国服务器节点就出现一个问题了。数据返回的时间不对，存储的时间也有时差了。此文章仅仅与UTC标准时间与北京时间(东八区时间)作为实际例子。最后跟踪发现，如下几点原因：</p> 
<h4 id="1.1%E3%80%81%E6%95%B0%E6%8D%AE%E5%BA%93MySQL%E4%B9%9F%E6%98%AF%E6%9C%89%E6%97%B6%E5%8C%BA%E7%9A%84%E6%A6%82%E5%BF%B5%E7%9A%84%E3%80%82">1.1、数据库MySQL也是有时区的概念的。</h4> 
<p>     通过如下命令可以查询MySQL的时区</p> 
<pre class="has"><code class="language-sql"> show variables like "%time_zone%";</code></pre> 
<p>如果未做任何修改会显示如下：</p> 
<pre class="has"><code class="language-bash">+------------------+--------+
| Variable_name  | Value |
+------------------+--------+
| system_time_zone | CST  |
| time_zone    | SYSTEM |
+------------------+--------+
2 rows in set (0.00 sec)
#time_zone说明mysql使用system的时区，system_time_zone说明system使用CST时区</code></pre> 
<h4 id="1.2%E3%80%81%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%8C%BA%E6%84%8F%E5%91%B3%E7%9D%80%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%97%B6%E5%8C%BA%E7%9B%B8%E5%90%8C%E3%80%82">1.2、系统时区意味着与计算机的操作系统时区相同。</h4> 
<p>以下是我们北京时间使用MySQL时区</p> 
<pre class="has"><code> set global time_zone = '+8:00'; ##修改mysql全局时区为北京时间，即我们所在的东8区
&gt; set time_zone = '+8:00'; ##修改当前会话时区
&gt; flush privileges; #立即生效</code></pre> 
<p>或者通过修改MySQL的 my.cnf配置文件来修改时区<br> # vim /etc/my.cnf ##在[mysqld]区域中加上<br> default-time_zone = '+8:00'<br> # /etc/init.d/mysqld restart ##重启mysql使新时区生效</p> 
<p><img alt="" class="has" height="530" src="https://images2.imgbox.com/74/af/V7wy2rf3_o.png" width="514"></p> 
<h4 id="1.2%E3%80%81SpringBoot%E9%BB%98%E8%AE%A4%E7%9A%84Json%E8%A7%86%E5%9B%BE%E8%BD%AC%E6%8D%A2%E6%A1%86%E6%9E%B6Jackson%E4%B9%9F%E6%9C%89%E6%97%B6%E5%8C%BA%E6%A6%82%E5%BF%B5">1.2、SpringBoot默认的Json视图转换框架Jackson也有时区概念</h4> 
<p>     Jackson日期反序列化时区问题，Jackson里 <code>JsonFormat</code>的源码</p> 
<pre class="has"><code class="language-java">/**
 * Value that indicates that default {@link java.util.TimeZone}
 * (from deserialization or serialization context) should be used:
 * annotation does not define value to use.
 *&lt;p&gt;
 * NOTE: default here does NOT mean JVM defaults but Jackson databindings
 * default, usually UTC, but may be changed on &lt;code&gt;ObjectMapper&lt;/code&gt;.
 */
public final static String DEFAULT_TIMEZONE = "##default";

值，该值指示默认{@链接java.util.TimeZone}

（来自反序列化或序列化上下文）应使用：

注释未定义要使用的值。

注意：这里的默认值并不意味着JVM默认值，而是Jackson数据绑定。

默认值，通常为UTC，但可以在&lt;code&gt;objectmapper&lt;code&gt;上更改。</code></pre> 
<p>那个注释已经说明默认情况下会将 时区设置为UTC ，Jackson反序列化时间类型的底层实际上调用的是Java的 SimpleDateFormat#parse() 方法，而JVM中的时区则会根据你的操作系统来获取，所以JVM认为你的时区应该是 GMT+8 时区，<br> 而要将 UTC 时区的时间转成 GMT+8 时区的时间，就会将你传进来的时间+8个小时。</p> 
<h3 id="2%E3%80%81%E4%BB%A3%E7%A0%81%E5%AE%9E%E7%8E%B0">2、代码实现</h3> 
<h4 id="2.1%E3%80%81%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88%E4%B8%80%E4%B8%8B%E5%9C%A8%E6%AF%8F%E4%B8%AA%E5%B8%A6%E6%9C%89%E6%97%A5%E6%9C%9F%E5%9C%B0%E6%96%B9%E5%8A%A0%E4%B8%8A%E6%B3%A8%E8%A7%A3">2.1、解决方案一下在每个带有日期地方加上注解</h4> 
<p>日期类型的字段上的 <code>@JsonFormat</code> 加上属性 <code>timezone="GMT+8"</code></p> 
<pre class="has"><code class="language-java">@NotNull
@JsonFormat(pattern = "yyyy-MM-dd HH:mm:ss",timezone="GMT+8")
@JsonProperty("start_time")
private Date startTime;</code></pre> 
<p>此类方法需要在包含日期地方都加上注解属性，比较繁琐。</p> 
<h4 id="2.2%E3%80%81%E5%8F%AA%E9%9C%80%E8%A6%81%E9%85%8D%E7%BD%AE%E4%B8%80%E4%B8%AAbean%E5%AE%9E%E7%8E%B0%E6%95%B4%E4%BD%93%E4%BF%AE%E6%94%B9">2.2、只需要配置一个bean实现整体修改</h4> 
<pre class="has"><code>@Bean
    public Jackson2ObjectMapperBuilderCustomizer jacksonObjectMapperCustomization() {
        return jacksonObjectMapperBuilder -&gt;
                jacksonObjectMapperBuilder.timeZone(TimeZone.getTimeZone("GMT+8"));
    }</code></pre> 
<p>参考文章：<a href="https://www.jianshu.com/p/085eb3c3120e" rel="nofollow">Jackson日期反序列化时区问题</a></p> 
<h4 id="2.3%E3%80%81%E4%BD%BF%E7%94%A8SpringBoot%E7%9A%84%E9%85%8D%E7%BD%AE%E6%96%B9%E5%BC%8F">2.3、使用SpringBoot的配置方式</h4> 
<pre class="has"><code class="language-java">spring.jackson.default-property-inclusion=NON_NULL
spring.jackson.time-zone=GMT+8
spring.jackson.date-format=yyyy-MM-dd HH:mm:ss</code></pre> 
<p>第一个设置就是使用24小时的时间格式；第二个设置就是设置时区为东八区。</p> 
<p>但是配置时候需要注意</p> 
<p>Finally, if you opt out of the Spring Boot default MVC configuration by providing your own @EnableWebMvc configuration, you can take control completely and do everything manually by using getMessageConverters from WebMvcConfigurationSupport.</p> 
<p>《Spring Boot Reference Guide》 </p> 
<p>需要去掉</p> 
<p><strong>@EnableWebMvc</strong></p> 
<p><strong>参考文章：</strong></p> 
<p><strong>           </strong><a href="https://www.jianshu.com/p/2e7c2b496e21" rel="nofollow">SpringBoot全局Jackson配置未生效</a>  </p> 
<p>           <a href="https://my.oschina.net/fxtxz2/blog/1861776" rel="nofollow">spring boot中jackson时间格式和东八区的设置</a></p> 
<p>           <a href="https://my.oschina.net/xpx/blog/1924695" rel="nofollow">自定义jackson解析时间格式yyy-MM-dd HH:mm:ss</a></p> 
<h3 id="3%E3%80%81%E6%88%90%E6%9E%9C%E5%B1%95%E7%8E%B0">3、成果展现</h3> 
<p>        经过转换配置转换之后；能够正确的获得和存取对应的时间，建议使用</p> 
<p><strong>        2.2、只需要配置一个bean实现整体修改</strong> 或者使用 <strong>2.3、使用SpringBoot的配置方式</strong> 方式比较通用性。</p> 
<p><img alt="" class="has" height="91" src="https://images2.imgbox.com/ba/c8/OOOyuBKj_o.png" width="852"></p> 
<p>其中如果使用FastJson转换也可能遇见同样的问题，可以参考文章</p> 
<p><a href="https://blog.csdn.net/nihaoqiulinhe/article/details/73336019">springmvc 中使用fastjson 反序列化json,导致时区相差的问题</a></p> 
<h3 id="4%E3%80%81%E6%80%BB%E7%BB%93">4、总结</h3> 
<p>       在SpringBoot开发应用之中设计日期转换需要特别注意，能够主要目标能够是的存储和返回的日期能够对应上自己的本地时区。同时能够使用较为通用的转换方式解决相关问题。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7cfe1270f240edc402d554502136ca5e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">五款中文分词工具在线PK: Jieba, SnowNLP, PkuSeg, THULAC, HanLP</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/805551df57ba239461eee24f7c12ce8f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java.lang.UnsatisfiedLinkError: dalvik.system.PathClassLoader[DexPathList</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>