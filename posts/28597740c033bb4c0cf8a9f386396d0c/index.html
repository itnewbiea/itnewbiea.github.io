<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>openstack部署过程5 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="openstack部署过程5" />
<meta property="og:description" content="目录 Neutron服务安装【控制节点】1、创库授权2、创建用户,关联角色3、创建Neutron服务并注册API4、安装并配置Neutron安装相关软件包配置neutron组件配置ML2组件配置LinuxBridge配置L3配置DHCP配置元数据代理为Nova配置网络服务 5、同步数据库Neutron服务安装【计算节点】1、安装软件2、修改计算节点neutron配置文件配置neutron组件配置LinuxBridge配置nova.conf启动 验证错误记录 Neutron服务安装【控制节点】 1、创库授权 连接数据库
mysql -u root -p
创建neutron数据库
CREATE DATABASE neutron;
授予数据库权限，然后退出
GRANT ALL PRIVILEGES ON neutron.* TO &#39;neutron&#39;@&#39;localhost&#39; \ IDENTIFIED BY &#39;NEUTRON_DBPASS&#39;; GRANT ALL PRIVILEGES ON neutron.* TO &#39;neutron&#39;@&#39;%&#39; \ IDENTIFIED BY &#39;NEUTRON_DBPASS&#39;; exit; 2、创建用户,关联角色 # 创建neutron用户并设置密码 openstack user create --domain default --password NEUTRON_PASS neutron # 使用admin角色将neutron用户添加到服务项目中 openstack role add --project service --user neutron admin 3、创建Neutron服务并注册API openstack service create --name neutron \ --description &#34;OpenStack Networking&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/28597740c033bb4c0cf8a9f386396d0c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-10-21T17:20:12+08:00" />
<meta property="article:modified_time" content="2021-10-21T17:20:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">openstack部署过程5</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#Neutron_1" rel="nofollow">Neutron服务安装【控制节点】</a></li><li><a href="#1_3" rel="nofollow">1、创库授权</a></li><li><a href="#2_20" rel="nofollow">2、创建用户,关联角色</a></li><li><a href="#3NeutronAPI_30" rel="nofollow">3、创建Neutron服务并注册API</a></li><li><a href="#4Neutron_43" rel="nofollow">4、安装并配置Neutron</a></li><li><ul><li><a href="#_44" rel="nofollow">安装相关软件包</a></li><li><a href="#neutron_46" rel="nofollow">配置neutron组件</a></li><li><a href="#ML2_81" rel="nofollow">配置ML2组件</a></li><li><a href="#LinuxBridge_94" rel="nofollow">配置LinuxBridge</a></li><li><a href="#L3_106" rel="nofollow">配置L3</a></li><li><a href="#DHCP_114" rel="nofollow">配置DHCP</a></li><li><a href="#_123" rel="nofollow">配置元数据代理</a></li><li><a href="#Nova_131" rel="nofollow">为Nova配置网络服务</a></li></ul> 
  </li><li><a href="#5_145" rel="nofollow">5、同步数据库</a></li><li><a href="#Neutron_164" rel="nofollow">Neutron服务安装【计算节点】</a></li><li><a href="#1_166" rel="nofollow">1、安装软件</a></li><li><a href="#2neutron_171" rel="nofollow">2、修改计算节点neutron配置文件</a></li><li><ul><li><a href="#neutron_173" rel="nofollow">配置neutron组件</a></li><li><a href="#LinuxBridge_194" rel="nofollow">配置LinuxBridge</a></li><li><a href="#novaconf_206" rel="nofollow">配置nova.conf</a></li><li><a href="#_218" rel="nofollow">启动</a></li></ul> 
  </li><li><a href="#_230" rel="nofollow">验证</a></li><li><a href="#_236" rel="nofollow">错误记录</a></li></ul> 
</div> 
<p></p> 
<h2><a id="Neutron_1"></a>Neutron服务安装【控制节点】</h2> 
<h2><a id="1_3"></a>1、创库授权</h2> 
<p>连接数据库</p> 
<p><code>mysql -u root -p</code></p> 
<p>创建neutron数据库</p> 
<p><code>CREATE DATABASE neutron;</code></p> 
<p>授予数据库权限，然后退出</p> 
<pre><code>GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'localhost' \
  IDENTIFIED BY 'NEUTRON_DBPASS';
GRANT ALL PRIVILEGES ON neutron.* TO 'neutron'@'%' \
  IDENTIFIED BY 'NEUTRON_DBPASS';
exit;
</code></pre> 
<h2><a id="2_20"></a>2、创建用户,关联角色</h2> 
<pre><code># 创建neutron用户并设置密码
openstack user create --domain default --password NEUTRON_PASS neutron
# 使用admin角色将neutron用户添加到服务项目中
openstack role add --project service --user neutron admin
</code></pre> 
<p><img src="https://images2.imgbox.com/0f/1a/zDfGAijj_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3NeutronAPI_30"></a>3、创建Neutron服务并注册API</h2> 
<pre><code>openstack service create --name neutron \
  --description "OpenStack Networking" network
openstack endpoint create --region RegionOne \
  network public http://controller:9696
openstack endpoint create --region RegionOne \
  network internal http://controller:9696
openstack endpoint create --region RegionOne \
  network admin http://controller:9696
</code></pre> 
<p><img src="https://images2.imgbox.com/97/a2/tU2Njgxy_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4Neutron_43"></a>4、安装并配置Neutron</h2> 
<h3><a id="_44"></a>安装相关软件包</h3> 
<p><code>yum install openstack-neutron openstack-neutron-ml2 openstack-neutron-linuxbridge ebtables -y</code></p> 
<h3><a id="neutron_46"></a>配置neutron组件</h3> 
<pre><code>cp /etc/neutron/neutron.conf{,.bak}
grep '^[a-Z\[]' /etc/neutron/neutron.conf.bak &gt;/etc/neutron/neutron.conf

openstack-config --set /etc/neutron/neutron.conf  DEFAULT core_plugin  ml2
openstack-config --set /etc/neutron/neutron.conf  DEFAULT service_plugins router
openstack-config --set /etc/neutron/neutron.conf  allow_overlapping_ips true
#openstack-config --set /etc/neutron/neutron.conf  DEFAULT rpc_backend  rabbit
openstack-config --set /etc/neutron/neutron.conf  DEFAULT auth_strategy  keystone
openstack-config --set /etc/neutron/neutron.conf  DEFAULT notify_nova_on_port_status_changes  True
openstack-config --set /etc/neutron/neutron.conf  DEFAULT notify_nova_on_port_data_changes  True
openstack-config --set /etc/neutron/neutron.conf  database connection  mysql+pymysql://neutron:NEUTRON_DBPASS@controller/neutron # 改密码
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken www_authenticate_uri http://controller:5000/v3
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_url http://controller:35357/v3
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_name  service
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken username  neutron
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken password  NEUTRON_PASS # 改密码
openstack-config --set /etc/neutron/neutron.conf  nova auth_url  http://controller:35357
openstack-config --set /etc/neutron/neutron.conf  nova auth_type  password 
openstack-config --set /etc/neutron/neutron.conf  nova project_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  nova user_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  nova region_name  RegionOne
openstack-config --set /etc/neutron/neutron.conf  nova project_name  service
openstack-config --set /etc/neutron/neutron.conf  nova username  nova
openstack-config --set /etc/neutron/neutron.conf  nova password  NOVA_PASS # 改密码
openstack-config --set /etc/neutron/neutron.conf  oslo_concurrency lock_path  /var/lib/neutron/tmp
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_host  controller
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_userid  openstack
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_password  RABBIT_PASS # 改密码
</code></pre> 
<h3><a id="ML2_81"></a>配置ML2组件</h3> 
<pre><code>cp /etc/neutron/plugins/ml2/ml2_conf.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/plugins/ml2/ml2_conf.ini.bak &gt;/etc/neutron/plugins/ml2/ml2_conf.ini

openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2 type_drivers  flat,vlan,vxlan
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2 tenant_network_types vxlan
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2 mechanism_drivers  linuxbridge,l2population
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2 extension_drivers  port_security
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2_type_flat flat_networks  provider
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  ml2_type_vxlan vni_ranges 1:1000
openstack-config --set /etc/neutron/plugins/ml2/ml2_conf.ini  securitygroup enable_ipset  True
</code></pre> 
<h3><a id="LinuxBridge_94"></a>配置LinuxBridge</h3> 
<pre><code>cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak &gt;/etc/neutron/plugins/ml2/linuxbridge_agent.ini

openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  linux_bridge physical_interface_mappings  provider:ens3 # 这里端口要改
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan enable_vxlan true
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan local_ip 192.168.56.10
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan l2_population true
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup enable_security_group  True
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup firewall_driver  neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
</code></pre> 
<h3><a id="L3_106"></a>配置L3</h3> 
<pre><code>cp /etc/neutron/l3_agent.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/l3_agent.ini.bak &gt;/etc/neutron/l3_agent.ini

openstack-config --set /etc/neutron/l3_agent.ini DEFAULT interface_driver linuxbridge
</code></pre> 
<h3><a id="DHCP_114"></a>配置DHCP</h3> 
<pre><code>cp /etc/neutron/dhcp_agent.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/dhcp_agent.ini.bak &gt;/etc/neutron/dhcp_agent.ini

openstack-config --set /etc/neutron/dhcp_agent.ini DEFAULT interface_driver linuxbridge
openstack-config --set /etc/neutron/dhcp_agent.ini dhcp_driver neutron.agent.linux.dhcp.Dnsmasq
openstack-config --set /etc/neutron/dhcp_agent.ini enable_isolated_metadata true
</code></pre> 
<h3><a id="_123"></a>配置元数据代理</h3> 
<pre><code>cp /etc/neutron/metadata_agent.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/metadata_agent.ini.bak &gt;/etc/neutron/metadata_agent.ini

openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT nova_metadata_ip  controller
openstack-config --set /etc/neutron/metadata_agent.ini DEFAULT metadata_proxy_shared_secret  METADATA_SECRET # 改密码
</code></pre> 
<h3><a id="Nova_131"></a>为Nova配置网络服务</h3> 
<pre><code>openstack-config --set /etc/nova/nova.conf  neutron url  http://controller:9696
openstack-config --set /etc/nova/nova.conf  neutron auth_url  http://controller:35357
openstack-config --set /etc/nova/nova.conf  neutron auth_type  password
openstack-config --set /etc/nova/nova.conf  neutron project_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron user_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron region_name  RegionOne
openstack-config --set /etc/nova/nova.conf  neutron project_name  service
openstack-config --set /etc/nova/nova.conf  neutron username  neutron
openstack-config --set /etc/nova/nova.conf  neutron password  NEUTRON_PASS # 改密码
openstack-config --set /etc/nova/nova.conf  neutron service_metadata_proxy  True
openstack-config --set /etc/nova/nova.conf  neutron metadata_proxy_shared_secret  METADATA_SECRET # 改密码
</code></pre> 
<h2><a id="5_145"></a>5、同步数据库</h2> 
<pre><code>ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini
su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \
  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head" neutron
</code></pre> 
<p>重启nova-api服务</p> 
<pre><code>systemctl restart openstack-nova-api.service
</code></pre> 
<p>启用网络服务并设为开机自启</p> 
<pre><code>systemctl enable neutron-server.service \
  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \
  neutron-metadata-agent.service
systemctl start neutron-server.service \
  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \
  neutron-metadata-agent.service
</code></pre> 
<h2><a id="Neutron_164"></a>Neutron服务安装【计算节点】</h2> 
<h2><a id="1_166"></a>1、安装软件</h2> 
<p><code>yum install openstack-neutron-linuxbridge ebtables ipset -y</code></p> 
<h2><a id="2neutron_171"></a>2、修改计算节点neutron配置文件</h2> 
<h3><a id="neutron_173"></a>配置neutron组件</h3> 
<pre><code>cp /etc/neutron/neutron.conf{,.bak}
grep '^[a-Z\[]' /etc/neutron/neutron.conf.bak &gt;/etc/neutron/neutron.conf

openstack-config --set /etc/neutron/neutron.conf  DEFAULT transport_url rabbit://openstack:RABBIT_PASS@controller# 改密码
openstack-config --set /etc/neutron/neutron.conf  DEFAULT auth_strategy  keystone
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken www_authenticate_uri http://controller:5000/v3
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_url  http://controller:35357/v3
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken memcached_servers  controller:11211
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken auth_type  password
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken user_domain_name  default
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken project_name  service
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken username  neutron
openstack-config --set /etc/neutron/neutron.conf  keystone_authtoken password  NEUTRON_PASS # 改密码
openstack-config --set /etc/neutron/neutron.conf  oslo_concurrency lock_path  /var/lib/neutron/tmp
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_host  controller
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_userid  openstack
openstack-config --set /etc/neutron/neutron.conf  oslo_messaging_rabbit rabbit_password  RABBIT_PASS # 改密码
</code></pre> 
<h3><a id="LinuxBridge_194"></a>配置LinuxBridge</h3> 
<pre><code>cp /etc/neutron/plugins/ml2/linuxbridge_agent.ini{,.bak}
grep '^[a-Z\[]' /etc/neutron/plugins/ml2/linuxbridge_agent.ini.bak &gt;/etc/neutron/plugins/ml2/linuxbridge_agent.ini

openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  linux_bridge physical_interface_mappings  provider:ens3 # 改端口 
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup enable_security_group  True
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  securitygroup firewall_driver  neutron.agent.linux.iptables_firewall.IptablesFirewallDriver
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan enable_vxlan  true
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan local_ip 192.168.10.193 
openstack-config --set /etc/neutron/plugins/ml2/linuxbridge_agent.ini  vxlan l2_population true
</code></pre> 
<h3><a id="novaconf_206"></a>配置nova.conf</h3> 
<pre><code>openstack-config --set /etc/nova/nova.conf  neutron url  http://controller:9696
openstack-config --set /etc/nova/nova.conf  neutron auth_url  http://controller:35357
openstack-config --set /etc/nova/nova.conf  neutron auth_type  password
openstack-config --set /etc/nova/nova.conf  neutron project_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron user_domain_name  default
openstack-config --set /etc/nova/nova.conf  neutron region_name  RegionOne
openstack-config --set /etc/nova/nova.conf  neutron project_name  service
openstack-config --set /etc/nova/nova.conf  neutron username  neutron
openstack-config --set /etc/nova/nova.conf  neutron password  NEUTRON_PASS
</code></pre> 
<h3><a id="_218"></a>启动</h3> 
<p>重启nova-api服务</p> 
<pre><code>systemctl restart openstack-nova-compute.service
</code></pre> 
<p>启用网络服务并设为开机自启</p> 
<pre><code>systemctl enable neutron-linuxbridge-agent.service
systemctl start neutron-linuxbridge-agent.service
</code></pre> 
<h2><a id="_230"></a>验证</h2> 
<p>在控制节点上验证<br> <code>neutron agent-list</code><br> <img src="https://images2.imgbox.com/ca/a5/CBP4MO7O_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_236"></a>错误记录</h2> 
<p>1.Missing value auth-url required for auth plugin password<br> 重新刷新环境变量<br> <code>vi admin-openrc</code></p> 
<pre><code>export OS_PROJECT_DOMAIN_NAME=default
export OS_USER_DOMAIN_NAME=default
export OS_PROJECT_NAME=admin
export OS_USERNAME=admin
export OS_PASSWORD=你的密码 #这里要改
export OS_AUTH_URL=http://controller:35357/v3
export OS_IDENTITY_API_VERSION=3
export OS_IMAGE_API_VERSION=2
</code></pre> 
<p>2.刷新变量<br> <code>source admin-openrc</code></p> 
<p>3.验证<br> <code>env|grep OS</code></p> 
<p>4.写入开机自启<br> <code>vi .bashrc</code><br> 添加如下内容<br> <code>source admin-openrc</code></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/41a94bb90bd8ddb77f840ac3cc87a3fa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">swin transformer 总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d7dd3dec28e6618825510699ce50c4c2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ctfshow sql注入漏洞 171-179</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>