<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Matlab实现SIFT&#43;RANSAC特征检测与图像融合 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Matlab实现SIFT&#43;RANSAC特征检测与图像融合" />
<meta property="og:description" content="一、SIFT特征检测 尺度不变特征转换(Scale-invariant Feature Transform or SIFT)是一种计算机视觉的算法，用来侦测与描述影像中的局部性特征。该算法在空间尺度中寻找极值点，并提取出其位置、尺度、旋转不变量，此算法由David Lowe在1999年所发表，2004年完善总结。SIFT算法具有较好的稳定性和不变性，能够适应旋转、尺度缩放、亮度的变化，能在一定程度上不受视角变化、仿射变换、噪声的干扰。
SIFT算法的大致步骤如下：
建立尺度空间，即建立高斯差分(DoG)金字塔在尺度空间中检测极值点，并进行精确定位关键点主方向赋值计算关键点描述子 1.利用SIFT算法对两幅原始图像进行检测，得到的结果如下（原始图像1有736个特征点，原始图像2有607个特征点）
2.得到两幅图像的特征点后，需要对两幅图像进行初步的特征点匹配。
本次实验采用的初步匹配方法为“1NN/2NN&lt;0.8”，即对于图像img1中的每个特征点描述子（设当前特征点描述子为des1_i），在img2图像中搜索与该128维向量之间的角度最小及次小的特征点描述子（分别记为des2_1，des2_2），记最小角度为deg1，次小角度为deg2，若deg1&lt;0.8*deg2，则我们将(des1_i,des2_1)视为符合条件的匹配点对，否则将其视为错配点对并剔除。这种寻找匹配的方法，Lowe在“Distinctive Image Features from Scale-Invariant Keypoints”中有详细说明。
特征点初步匹配结果如下（共66对粗匹配点）：
观察图2可以发现，两幅图像的两侧均存在一些误匹配的特征点，而我们真正需要的特征匹配点对大概应该集中于图像中央附近。因此，下面需要利用RANSAC算法剔除一些误匹配的特征点对，以实现特征点之间的精细匹配。
二、RANSAC特征点精匹配 随机抽样一致算法（Random Sample Consensus or RANSAC）可以从一组包含“局外点（Outliers）”的观测数据集中，通过迭代方式估计数学模型的参数。它是一种不确定的算法——它有一定的概率得出一个合理的结果，因此为了提高得到正确模型的概率，有时候必须增加迭代次数。
滤除误匹配对采用的RANSAC算法从匹配数据集中随机抽出4对样本（不共线）并计算出单应矩阵，然后利用这个模型测试所有数据，计算满足这个模型数据点的个数与投影误差(即代价函数)，若此模型为最优模型，则对应的代价函数最小。
RANSAC算法的具体步骤如下：
随机从数据集中随机抽出4个样本数据 (不能共线)，计算出单应矩阵H，记为模型M；计算数据集中所有数据与模型M的投影误差，若误差小于阈值，则加入内点集I；如果当前内点集I元素个数大于最优内点集I_best , 则更新I_best = I，同时更新迭代次数k；如果迭代次数大于k则退出，否则迭代次数加1，重复上述步骤。 使用RANSAC得到的特征点精匹配结果如下（共34对精匹配点）：
Matlab运行结果的部分截图（单应矩阵和精匹配点对的下标）：
观察图3我们可以发现，两幅图像两侧的一些杂乱无章的错误匹配点对均已被消除，在匹配结果中只保留了两幅图中央的一些精匹配点对，从而实现了特征点的精匹配。下面将进行最后的两幅图的拼接与融合。
三、图像的拼接与融合 在进行最终的拼接与融合之前，我们首先需要使用单应矩阵H对img2进行一个H变换，使得img2的视角大致与img1一致（让img1与img2位于同一坐标系下），以便于后续进行几何变换实现图像拼接。
在调整完毕img2的视角后，我们可以利用几何变换实现最终的两幅图像的拼接。在拼接完毕后，对两幅图像的重叠区域进行了优化处理，主要是调整了交界处img2的长度，使得img2能和img1在竖直方向对齐。
四、Matlab部分源码示例 main主程序：
clear; clc; close all; img1 = imread(&#39;test1.png&#39;); img2 = imread(&#39;test2.png&#39;); % 调用函数进行SIFT特征检测、RANSAC精细匹配和图像融合、拼接 % 利用SIFT算法找到匹配的特征点对并可视化 [des1, loc1, des2, loc2] = drawKeypoints(img1, img2); % 计算符合粗筛选条件的特征匹配点对并可视化 [matchLoc1, matchLoc2] = siftMatch(des1, loc1, des2, loc2); % 输出所有的特征点对 disp([matchLoc1, matchLoc2]); % 绘制由SIFT初步得到的粗特征匹配点连线 drawLine1(img1, img2, matchLoc1, matchLoc2); % 利用RANSAC算法计算出单应矩阵H以及最终的特征点下标corrPtIdx [H, corrPtIdx] = CalcH(matchLoc2&#39; ,matchLoc1&#39;); % 显示单应矩阵 fprintf(&#39;单应矩阵H如下：\n&#39;); disp(H); % 显示由RANSAC找到的特征匹配点对在matchLoc矩阵的下标 fprintf(&#39;由RANSAC找到的特征匹配点对在matchLoc矩阵的下标如下：\n&#39;); disp(corrPtIdx); % 绘制由RANSAC最终得到的精特征匹配点连线 drawLine2(img1, img2, matchLoc1, matchLoc2, corrPtIdx) % 利用单应矩阵将img2投影，使img2和img1在同一坐标系下，方便后续的拼接 tform = projective2d(H&#39;); img2_adjusted = imwarp(img2, tform); % 显示一下两幅原始图像 figure; imshow(img1); figure; imshow(img2_adjusted); % 进行图像的最终拼接与融合 final_img = mosaicFusion(img1, img2, img2_adjusted, H); % 显示最终得到的图像 figure; imshow(final_img); 全部源码及原始图像见资源：Matlab实现SIFT&#43;RANSAC特征检测与图像融合" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0cd97fcb2154c24ea7f24315f219a23b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-04T21:22:04+08:00" />
<meta property="article:modified_time" content="2022-03-04T21:22:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Matlab实现SIFT&#43;RANSAC特征检测与图像融合</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="SIFT_0"></a>一、SIFT特征检测</h3> 
<p>尺度不变特征转换(Scale-invariant Feature Transform or SIFT)是一种计算机视觉的算法，用来侦测与描述影像中的局部性特征。该算法在空间尺度中寻找极值点，并提取出其位置、尺度、旋转不变量，此算法由David Lowe在1999年所发表，2004年完善总结。SIFT算法具有较好的稳定性和不变性，能够适应旋转、尺度缩放、亮度的变化，能在一定程度上不受视角变化、仿射变换、噪声的干扰。<br> SIFT算法的大致步骤如下：</p> 
<ul><li><strong>建立尺度空间，即建立高斯差分(DoG)金字塔</strong></li><li><strong>在尺度空间中检测极值点，并进行精确定位</strong></li><li><strong>关键点主方向赋值</strong></li><li><strong>计算关键点描述子</strong></li></ul> 
<p>1.利用SIFT算法对两幅原始图像进行检测，得到的结果如下（原始图像1有736个特征点，原始图像2有607个特征点）<img src="https://images2.imgbox.com/49/6d/4Z1r9wNU_o.png" alt="在这里插入图片描述"><br> 2.得到两幅图像的特征点后，需要对两幅图像进行初步的特征点匹配。<br> 本次实验采用的初步匹配方法为“1NN/2NN&lt;0.8”，即对于图像img1中的每个特征点描述子（设当前特征点描述子为des1_i），在img2图像中搜索与该128维向量之间的角度最小及次小的特征点描述子（分别记为des2_1，des2_2），记最小角度为deg1，次小角度为deg2，若deg1&lt;0.8*deg2，则我们将(des1_i,des2_1)视为符合条件的匹配点对，否则将其视为错配点对并剔除。这种寻找匹配的方法，Lowe在“Distinctive Image Features from Scale-Invariant Keypoints”中有详细说明。<br> 特征点初步匹配结果如下（共66对粗匹配点）：<br> <img src="https://images2.imgbox.com/dc/d0/4G0wvYLK_o.png" alt="在这里插入图片描述"><br> 观察图2可以发现，两幅图像的两侧均存在一些误匹配的特征点，而我们真正需要的特征匹配点对大概应该集中于图像中央附近。因此，下面需要利用RANSAC算法剔除一些误匹配的特征点对，以实现特征点之间的精细匹配。</p> 
<h3><a id="RANSAC_15"></a>二、RANSAC特征点精匹配</h3> 
<p>随机抽样一致算法（Random Sample Consensus or RANSAC）可以从一组包含“局外点（Outliers）”的观测数据集中，通过迭代方式估计数学模型的参数。它是一种不确定的算法——它有一定的概率得出一个合理的结果，因此为了提高得到正确模型的概率，有时候必须增加迭代次数。<br> 滤除误匹配对采用的RANSAC算法从匹配数据集中随机抽出4对样本（不共线）并计算出单应矩阵，然后利用这个模型测试所有数据，计算满足这个模型数据点的个数与投影误差(即代价函数)，若此模型为最优模型，则对应的代价函数最小。<br> RANSAC算法的具体步骤如下：</p> 
<ul><li>随机从数据集中随机抽出4个样本数据 (不能共线)，计算出单应矩阵H，记为模型M；</li><li>计算数据集中所有数据与模型M的投影误差，若误差小于阈值，则加入内点集I；</li><li>如果当前内点集I元素个数大于最优内点集I_best , 则更新I_best = I，同时更新迭代次数k；</li><li>如果迭代次数大于k则退出，否则迭代次数加1，重复上述步骤。</li><li></ul> 
<p>使用RANSAC得到的特征点精匹配结果如下（共34对精匹配点）：<br> <img src="https://images2.imgbox.com/39/09/EUpM1faY_o.png" alt="在这里插入图片描述"><br> Matlab运行结果的部分截图（单应矩阵和精匹配点对的下标）：<br> <img src="https://images2.imgbox.com/91/77/dsP2u3jW_o.png" alt="在这里插入图片描述"><br> 观察图3我们可以发现，两幅图像两侧的一些杂乱无章的错误匹配点对均已被消除，在匹配结果中只保留了两幅图中央的一些精匹配点对，从而实现了特征点的精匹配。下面将进行最后的两幅图的拼接与融合。</p> 
<h3><a id="_30"></a>三、图像的拼接与融合</h3> 
<p>在进行最终的拼接与融合之前，我们首先需要使用单应矩阵H对img2进行一个H变换，使得img2的视角大致与img1一致（让img1与img2位于同一坐标系下），以便于后续进行几何变换实现图像拼接。<br> 在调整完毕img2的视角后，我们可以利用几何变换实现最终的两幅图像的拼接。在拼接完毕后，对两幅图像的重叠区域进行了优化处理，主要是调整了交界处img2的长度，使得img2能和img1在竖直方向对齐。<br> <img src="https://images2.imgbox.com/01/7c/6qIIZ6di_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="Matlab_34"></a>四、Matlab部分源码示例</h3> 
<p><strong>main主程序：</strong></p> 
<pre><code class="prism language-c">clear<span class="token punctuation">;</span>
clc<span class="token punctuation">;</span>
close all<span class="token punctuation">;</span>
img1 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">'test1.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
img2 <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">'test2.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span> 调用函数进行SIFT特征检测、RANSAC精细匹配和图像融合、拼接

<span class="token operator">%</span> 利用SIFT算法找到匹配的特征点对并可视化
<span class="token punctuation">[</span>des1<span class="token punctuation">,</span> loc1<span class="token punctuation">,</span> des2<span class="token punctuation">,</span> loc2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">drawKeypoints</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">%</span> 计算符合粗筛选条件的特征匹配点对并可视化
<span class="token punctuation">[</span>matchLoc1<span class="token punctuation">,</span> matchLoc2<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">siftMatch</span><span class="token punctuation">(</span>des1<span class="token punctuation">,</span> loc1<span class="token punctuation">,</span> des2<span class="token punctuation">,</span> loc2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span> 输出所有的特征点对
<span class="token function">disp</span><span class="token punctuation">(</span><span class="token punctuation">[</span>matchLoc1<span class="token punctuation">,</span> matchLoc2<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">%</span> 绘制由SIFT初步得到的粗特征匹配点连线
<span class="token function">drawLine1</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> matchLoc1<span class="token punctuation">,</span> matchLoc2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">%</span> 利用RANSAC算法计算出单应矩阵H以及最终的特征点下标corrPtIdx
<span class="token punctuation">[</span>H<span class="token punctuation">,</span> corrPtIdx<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">CalcH</span><span class="token punctuation">(</span>matchLoc2<span class="token string">' ,matchLoc1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span> 显示单应矩阵
<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token string">'单应矩阵H如下：\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">disp</span><span class="token punctuation">(</span>H<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">%</span> 显示由RANSAC找到的特征匹配点对在matchLoc矩阵的下标
<span class="token function">fprintf</span><span class="token punctuation">(</span><span class="token string">'由RANSAC找到的特征匹配点对在matchLoc矩阵的下标如下：\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">disp</span><span class="token punctuation">(</span>corrPtIdx<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">%</span> 绘制由RANSAC最终得到的精特征匹配点连线
<span class="token function">drawLine2</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> matchLoc1<span class="token punctuation">,</span> matchLoc2<span class="token punctuation">,</span> corrPtIdx<span class="token punctuation">)</span>

<span class="token operator">%</span> 利用单应矩阵将img2投影，使img2和img1在同一坐标系下，方便后续的拼接
tform <span class="token operator">=</span> <span class="token function">projective2d</span><span class="token punctuation">(</span>H'<span class="token punctuation">)</span><span class="token punctuation">;</span>
img2_adjusted <span class="token operator">=</span> <span class="token function">imwarp</span><span class="token punctuation">(</span>img2<span class="token punctuation">,</span> tform<span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token operator">%</span> 显示一下两幅原始图像
figure<span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span>img1<span class="token punctuation">)</span><span class="token punctuation">;</span>
figure<span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span>img2_adjusted<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">%</span> 进行图像的最终拼接与融合
final_img <span class="token operator">=</span> <span class="token function">mosaicFusion</span><span class="token punctuation">(</span>img1<span class="token punctuation">,</span> img2<span class="token punctuation">,</span> img2_adjusted<span class="token punctuation">,</span> H<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token operator">%</span> 显示最终得到的图像
figure<span class="token punctuation">;</span>
<span class="token function">imshow</span><span class="token punctuation">(</span>final_img<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre> 
<p><strong>全部源码及原始图像见资源：<a href="https://download.csdn.net/download/qq_45717425/82433710">Matlab实现SIFT+RANSAC特征检测与图像融合</a></strong></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2ac68e0b626f43229e5df183f0d9e28c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VUE 报错大全（持续更新）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2d858dc7194bc5f0231427f56ce3281a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">[安洵杯 2019]easy_serialize_php 1</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>