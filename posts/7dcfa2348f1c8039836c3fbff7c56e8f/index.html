<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【项目一】医疗实战-传智健康 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【项目一】医疗实战-传智健康" />
<meta property="og:description" content="传智健康 一、项目概述1.1 项目介绍1.2 技术架构1.3 功能架构 二、环境搭建2.1 项目结构2.2 maven项目搭建 三、Power Designer和ElementUI3.1 Power Designer3.2 ElementUI 四、模块实现4.1 预约管理-检查项管理4.1.1 新增检查项4.1.2 检查项分页4.1.3 删除检查项4.1.4 编辑检查项 4.2 预约管理-检查组管理4.2.1 新增检查组4.2.2 检查组分页4.2.3 编辑检查组（需要多次理清关系）4.2.4 删除检查组 4.3 预约管理-套餐管理4.3.1 图片存储方案4.3.2 新增套餐4.3.3 体检套餐分页4.3.4 定期清理垃圾图片（定时任务组件Quartz） 4.4 预约管理-预约设置4.4.1 Apache POI4.4.2 批量导入预约设置信息4.4.3 日历展示预约设置信息4.4.4 基于日历实现预约设置 4.5 移动端开发-体检预约4.5.1 移动端开发4.5.2 需求分析和环境搭建4.5.3 套餐列表页面动态展示4.5.4 套餐详情页面动态展示4.5.5 短信发送 4.6 页面静态化4.6.1 页面静态化介绍4.6.2 Freemarker4.6.3 生成移动端静态页面 4.7 移动端开发-体检预约4.7.1 体检预约4.7.2 预约成功页面展示 4.8 移动端开发-手机快速登录、权限控制4.8.1 手机快速登录4.8.2 权限控制4.8.3 在项目中应用Spring Security4.8.4 显示用户名4.8.5 用户退出 4.9 图形报表ECharts4.9.1 会员数量折线图4.9.2 套餐预约占比饼形图 4.10 POI报表4.10.1 运营数据统计4.10.2 运营数据统计报表导出（EXCEL形式）4." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7dcfa2348f1c8039836c3fbff7c56e8f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-14T20:05:12+08:00" />
<meta property="article:modified_time" content="2022-04-14T20:05:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【项目一】医疗实战-传智健康</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>传智健康</h4> 
 <ul><li><a href="#_2" rel="nofollow">一、项目概述</a></li><li><ul><li><a href="#11__3" rel="nofollow">1.1 项目介绍</a></li><li><a href="#12__5" rel="nofollow">1.2 技术架构</a></li><li><a href="#13__7" rel="nofollow">1.3 功能架构</a></li></ul> 
  </li><li><a href="#_9" rel="nofollow">二、环境搭建</a></li><li><ul><li><a href="#21___10" rel="nofollow">2.1 项目结构</a></li><li><a href="#22__maven_27" rel="nofollow">2.2 maven项目搭建</a></li></ul> 
  </li><li><a href="#Power_DesignerElementUI_32" rel="nofollow">三、Power Designer和ElementUI</a></li><li><ul><li><a href="#31__Power_Designer_33" rel="nofollow">3.1 Power Designer</a></li><li><a href="#32__ElementUI_40" rel="nofollow">3.2 ElementUI</a></li></ul> 
  </li><li><a href="#_54" rel="nofollow">四、模块实现</a></li><li><ul><li><a href="#41__76" rel="nofollow">4.1 预约管理-检查项管理</a></li><li><ul><li><a href="#411__77" rel="nofollow">4.1.1 新增检查项</a></li><li><a href="#412__83" rel="nofollow">4.1.2 检查项分页</a></li><li><a href="#413__98" rel="nofollow">4.1.3 删除检查项</a></li><li><a href="#414__105" rel="nofollow">4.1.4 编辑检查项</a></li></ul> 
   </li><li><a href="#42__110" rel="nofollow">4.2 预约管理-检查组管理</a></li><li><ul><li><a href="#421__115" rel="nofollow">4.2.1 新增检查组</a></li><li><a href="#422__128" rel="nofollow">4.2.2 检查组分页</a></li><li><a href="#423__134" rel="nofollow">4.2.3 编辑检查组（需要多次理清关系）</a></li><li><a href="#424__139" rel="nofollow">4.2.4 删除检查组</a></li></ul> 
   </li><li><a href="#43__147" rel="nofollow">4.3 预约管理-套餐管理</a></li><li><ul><li><a href="#431__148" rel="nofollow">4.3.1 图片存储方案</a></li><li><a href="#432__177" rel="nofollow">4.3.2 新增套餐</a></li><li><a href="#433__195" rel="nofollow">4.3.3 体检套餐分页</a></li><li><a href="#434_Quartz_202" rel="nofollow">4.3.4 定期清理垃圾图片（定时任务组件Quartz）</a></li></ul> 
   </li><li><a href="#44__236" rel="nofollow">4.4 预约管理-预约设置</a></li><li><ul><li><a href="#441_Apache_POI_239" rel="nofollow">4.4.1 Apache POI</a></li><li><a href="#442__265" rel="nofollow">4.4.2 批量导入预约设置信息</a></li><li><a href="#443__281" rel="nofollow">4.4.3 日历展示预约设置信息</a></li><li><a href="#444__291" rel="nofollow">4.4.4 基于日历实现预约设置</a></li></ul> 
   </li><li><a href="#45__300" rel="nofollow">4.5 移动端开发-体检预约</a></li><li><ul><li><a href="#451__301" rel="nofollow">4.5.1 移动端开发</a></li><li><a href="#452__330" rel="nofollow">4.5.2 需求分析和环境搭建</a></li><li><a href="#453__357" rel="nofollow">4.5.3 套餐列表页面动态展示</a></li><li><a href="#454__364" rel="nofollow">4.5.4 套餐详情页面动态展示</a></li><li><a href="#455__374" rel="nofollow">4.5.5 短信发送</a></li></ul> 
   </li><li><a href="#46__398" rel="nofollow">4.6 页面静态化</a></li><li><ul><li><a href="#461__399" rel="nofollow">4.6.1 页面静态化介绍</a></li><li><a href="#462_Freemarker_404" rel="nofollow">4.6.2 Freemarker</a></li><li><a href="#463__421" rel="nofollow">4.6.3 生成移动端静态页面</a></li></ul> 
   </li><li><a href="#47__449" rel="nofollow">4.7 移动端开发-体检预约</a></li><li><ul><li><a href="#471__450" rel="nofollow">4.7.1 体检预约</a></li><li><a href="#472__482" rel="nofollow">4.7.2 预约成功页面展示</a></li></ul> 
   </li><li><a href="#48__489" rel="nofollow">4.8 移动端开发-手机快速登录、权限控制</a></li><li><ul><li><a href="#481___490" rel="nofollow">4.8.1 手机快速登录</a></li><li><a href="#482__504" rel="nofollow">4.8.2 权限控制</a></li><li><a href="#483_Spring_Security_531" rel="nofollow">4.8.3 在项目中应用Spring Security</a></li><li><a href="#484__558" rel="nofollow">4.8.4 显示用户名</a></li><li><a href="#485__565" rel="nofollow">4.8.5 用户退出</a></li></ul> 
   </li><li><a href="#49__ECharts_576" rel="nofollow">4.9 图形报表ECharts</a></li><li><ul><li><a href="#491__581" rel="nofollow">4.9.1 会员数量折线图</a></li><li><a href="#492__587" rel="nofollow">4.9.2 套餐预约占比饼形图</a></li></ul> 
   </li><li><a href="#410_POI_595" rel="nofollow">4.10 POI报表</a></li><li><ul><li><a href="#4101__596" rel="nofollow">4.10.1 运营数据统计</a></li><li><a href="#4102_EXCEL_602" rel="nofollow">4.10.2 运营数据统计报表导出（EXCEL形式）</a></li><li><a href="#4103_PDF_609" rel="nofollow">4.10.3 运营数据统计报表导出（PDF形式）</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_648" rel="nofollow">五、目前存在的问题</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>一、项目概述</h2> 
<h3><a id="11__3"></a>1.1 项目介绍</h3> 
<p>         传智健康管理系统是一款应用于健康管理机构的业务系统，实现健康管理机构工作内容可视化、会员管理专业化、健康评估数字化、健康干预流程化、知识库集成化，从而提高健康管理师的工作效率，加强与会员间的互动，增强管理者对健康管理机构运营情况的了解。</p> 
<h3><a id="12__5"></a>1.2 技术架构</h3> 
<p><img src="https://images2.imgbox.com/53/a3/nIvpOqa5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="13__7"></a>1.3 功能架构</h3> 
<p><img src="https://images2.imgbox.com/f7/26/d79P2YQr_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_9"></a>二、环境搭建</h2> 
<h3><a id="21___10"></a>2.1 项目结构</h3> 
<p>本项目采用maven分模块开发方式，即对整个项目拆分为几个maven工程，每个maven工程存放特定的一类代码，具体如下：<br> <img src="https://images2.imgbox.com/49/d5/WCQW1dWc_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>各模块职责定位：</p> 
 <p>health_parent：父工程，打包方式为pom，统一锁定依赖的版本，同时聚合其他子模块便于统一执行maven命令</p> 
 <p>health_common：通用模块，打包方式为jar，存放项目中使用到的一些工具类、实体类、返回结果和常量类</p> 
 <p>health_interface：打包方式为jar，存放服务接口</p> 
 <p>health_service_provider：Dubbo服务模块，打包方式为war，存放服务实现类、Dao接口、Mapper映射文件等，作为服务提供方，需要部署到tomcat运行</p> 
 <p>health_backend：传智健康管理后台，打包方式为war，作为Dubbo服务消费方，存放Controller、HTML页面、js、css、spring配置文件等，需要部署到tomcat运行</p> 
 <p>health_mobile：移动端前台，打包方式为war，作为Dubbo服务消费方，存放Controller、HTML页面、js、css、spring配置文件等，需要部署到tomcat运行</p> 
</blockquote> 
<h3><a id="22__maven_27"></a>2.2 maven项目搭建</h3> 
<p>通过前面的项目功能架构图可以知道本项目分为传智健康管理后台和传智健康前台（微信端）</p> 
<p>搭建后的目录结构如图所示：<br> <img src="https://images2.imgbox.com/95/c1/4aVMzibX_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="Power_DesignerElementUI_32"></a>三、Power Designer和ElementUI</h2> 
<h3><a id="31__Power_Designer_33"></a>3.1 Power Designer</h3> 
<blockquote> 
 <p>PowerDesigner是Sybase公司的一款软件，使用它可以方便地对系统进行分析设计，他几乎包括了数据库模型设计的全过程。利用PowerDesigner可以制作数据流程图、概念数据模型、物理数据模型、面向对象模型。</p> 
</blockquote> 
<blockquote> 
 <p>在项目设计阶段通常会使用PowerDesigner进行数据库设计。使用PowerDesigner可以更加直观的表现出数据库中表之间的关系，并且可以直接导出相应的建表语句。</p> 
</blockquote> 
<h3><a id="32__ElementUI_40"></a>3.2 ElementUI</h3> 
<blockquote> 
 <p>ElementUI是一套基于VUE2.0的桌面端组件库，ElementUI提供了丰富的组件帮助开发人员快速构建功能强大、风格统一的页面。<br> 官网地址：<a href="http://element-cn.eleme.io/#/zh-CN" rel="nofollow">http://element-cn.eleme.io/#/zh-CN</a></p> 
</blockquote> 
<p>传智健康项目后台系统就是使用ElementUI来构建页面，在页面上引入 js 和 css 文件即可开始使用，如下：</p> 
<pre><code class="prism language-html"><span class="token comment">&lt;!-- 引入ElementUI样式 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>stylesheet<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/element-ui/lib/theme-chalk/index.css<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/vue/dist/vue.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 引入ElementUI组件库 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://unpkg.com/element-ui/lib/index.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="_54"></a>四、模块实现</h2> 
<blockquote> 
 <p><strong>需求分析：</strong><br> 传智健康管理系统是一款应用于健康管理机构的业务系统，实现健康管理机构工作内容可视化、患者管理专业化、健康评估数字化、健康干预流程化、知识库集成化，从而提高健康管理师的工作效率，加强与患者间的互动，增强管理者对健康管理机构运营情况的了解。</p> 
 <p>系统分为传智健康后台管理系统和移动端应用两部分。其中后台系统提供给健康管理机构内部人员（包括系统管理员、健康管理师等）使用，微信端应用提供给健康管理机构的用户（体检用户）使用。</p> 
</blockquote> 
<p><strong>功能架构图：</strong><br> <img src="https://images2.imgbox.com/c0/6a/XNaOMYS9_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>通过上面的功能架构图可以看到，传智健康后台管理系统有会员管理、预约管理、健康评估、健康干预等功能。移动端有会员管理、体检预约、体检报告等功能。后台系统和移动端应用都会通过Dubbo调用服务层发布的服务来完成具体的操作。本项目属于典型的SOA架构形式（面向服务的架构）。</p> 
</blockquote> 
<blockquote> 
 <p>项目开发过程中一般会提供一些公共资源，供多个模块或者系统来使用。这些放到<strong>health_common工程</strong>中。<br> MessageConstant：返回消息常量类<br> <img src="https://images2.imgbox.com/a2/d9/oBcN0yDr_o.png" alt="在这里插入图片描述"><br> Result类：封装返回结果<br> <img src="https://images2.imgbox.com/5c/ff/kapDWhlY_o.png" alt="在这里插入图片描述"><br> PageResult类：分页结果封装对象<br> <img src="https://images2.imgbox.com/a8/8f/Fq1xFTC7_o.png" alt="在这里插入图片描述"><br> QueryPageBean类：封装查询条件<br> <img src="https://images2.imgbox.com/60/90/Y3LFBK2F_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h3><a id="41__76"></a>4.1 预约管理-检查项管理</h3> 
<h4><a id="411__77"></a>4.1.1 新增检查项</h4> 
<blockquote> 
 <p>每次点击新建按钮时清空表单输入项</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 “/checkitem/add.do”）——&gt;controller（新增 “/add”）——&gt; service接口（add）<br> ——&gt;serviceimpl实现类（add）——&gt;Dao接口（add）——&gt;Mapper映射文件 (id=“add”)</p> 
</blockquote> 
<h4><a id="412__83"></a>4.1.2 检查项分页</h4> 
<blockquote> 
 <p>本项目所有分页功能都是基于ajax的异步请求来完成的，请求参数和后台响应数据格式都使用json数据格式。<br> 请求参数包括页码、每页显示记录数、查询条件。<br> 请求参数的json格式为：{currentPage:1,pageSize:10,queryString:’‘itcast’’}<br> 后台响应数据包括总记录数、当前页需要展示的数据集合。<br> 响应数据的json格式为：{total:1000,rows:[]}</p> 
</blockquote> 
<p>如下图：<br> <img src="https://images2.imgbox.com/b5/b9/GXu2kUAD_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>1.在页面中提供了findPage方法用于分页查询，为了能够在checkitem.html页面加载后直接可以展示分页数据，可以在VUE提供的钩子函数created中调用findPage方法<br> 2.分页方法执行时机：①点击查询 ②切换页码</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 “/checkitem/findPage.do”,param）——&gt;controller（分页查询 “/findPage”）——&gt; service接口（扩展分页查询方法：pageQuery）——&gt;serviceimpl实现类（基于Mybatis分页助手插件实现分页；pageQuery）——&gt;Dao接口（扩展分页查询方法，根据条件进行查询； selectByCondition）——&gt;Mapper映射文件 (id=“selectByCondition”)</p> 
</blockquote> 
<h4><a id="413__98"></a>4.1.3 删除检查项</h4> 
<blockquote> 
 <p>注意：不能直接删除，需要判断当前检查项是否和检查组关联，如果已经和检查组进行了关联则不允许删除</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 “/checkitem/delete.do?id=” + row.id）——&gt;controller（删除 “/delete”）——&gt; service接口（deleteById）<br> ——&gt;serviceimpl实现类（deleteById）——&gt;Dao接口（扩展方法 findCountByCheckItemId和 deleteById）——&gt;Mapper映射文件 （根据ID删除 id=“deleteById” 和 根据检查项id查询中间关系表 id=“findCountByCheckItemId”)</p> 
</blockquote> 
<h4><a id="414__105"></a>4.1.4 编辑检查项</h4> 
<blockquote> 
 <p>用户点击编辑按钮时，需要弹出编辑窗口并且将<strong>当前记录</strong>的数据进行回显</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 “/checkitem/findById.do?id=” + row.id 和 “/checkitem/edit.do”）——&gt;controller（编辑“/edit” 和 根据id查询 “/findById”）——&gt; service接口（edit 和 findById）——&gt;serviceimpl实现类（edit 和 findById）——&gt;Dao接口（edit 和 findById）——&gt;Mapper映射文件 (id=“edit” 和 id=“findById”）</p> 
</blockquote> 
<h3><a id="42__110"></a>4.2 预约管理-检查组管理</h3> 
<blockquote> 
 <p>检查组其实就是多个检查项的集合，例如有一个检查组为“一般检查”，这个检查组可以包括多个检查项：身高、体重、收缩压、舒张压等。所以在添加检查组时需要选择这个检查组包括的检查项。</p> 
 <p>检查组对应的实体类为CheckGroup，对应的数据表为t_checkgroup。检查组和检查项为多对多关系，所以需要中间表t_checkgroup_checkitem进行关联。</p> 
</blockquote> 
<h4><a id="421__115"></a>4.2.1 新增检查组</h4> 
<blockquote> 
 <p>1.每次点击新建按钮时清空表单输入项<br> 2.由于新增检查组时还需要选择此检查组包含的检查项，所以新增检查组窗口分为两部分信息：基本信息和检查项信息</p> 
</blockquote> 
<blockquote> 
 <p>现在虽然已经完成了新增窗口的弹出，但是在检查项信息标签页中需要动态展示所有的检查项信息列表数据，并且可以进行勾选。<br> <strong>1.动态展示检查项列表实现过程：</strong><br> 页面完善动态效果（提交到 “/checkitem/findAll.do”）——&gt;controller（查询所有 “/findAll”）——&gt; service接口（findAll）<br> ——&gt;serviceimpl实现类（findAll）——&gt;Dao接口（findAll）——&gt;Mapper映射文件 (id=“findAll”）</p> 
</blockquote> 
<blockquote> 
 <p>当用户点击新增窗口中的确定按钮时发送ajax请求将数据提交到后台进行数据库操作。提交到后台的数据分为两部分：检查组基本信息（对应的模型数据为formData）和检查项id数组（对应的模型数据为checkitemIds）。<br> <strong>2.提交请求实现过程：</strong><br> 页面完善动态效果（提交到 “/checkgroup/add.do?checkitemIds=” + this.checkitemIds,this.formData）——&gt;controller（新增“/add”）——&gt; service接口（add） ——&gt;serviceimpl实现类（add 和 设置检查组合和检查项的关联关系 setCheckGroupAndCheckItem）——&gt;Dao接口（add 和 setCheckGroupAndCheckItem）——&gt;Mapper映射文件 (id=“add” 和 id=“setCheckGroupAndCheckItem”）</p> 
</blockquote> 
<h4><a id="422__128"></a>4.2.2 检查组分页</h4> 
<blockquote> 
 <p>1.在页面中提供了findPage方法用于分页查询，为了能够在checkgroup.html页面加载后直接可以展示分页数据，可以在VUE提供的钩子函数created中调用findPage方法<br> 2.分页方法执行时机：①点击查询 ②切换页码</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 “/checkgroup/findPage.do”,param）——&gt;controller（分页查询 “/findPage”）——&gt; service接口（扩展分页查询方法：pageQuery）——&gt;serviceimpl实现类（基于Mybatis分页助手插件实现分页；pageQuery）——&gt;Dao接口（扩展分页查询方法，根据条件进行查询； selectByCondition）——&gt;Mapper映射文件 (id=“selectByCondition”)</p> 
</blockquote> 
<h4><a id="423__134"></a>4.2.3 编辑检查组（需要多次理清关系）</h4> 
<blockquote> 
 <p>用户点击编辑按钮时，需要弹出编辑窗口并且将当前记录的数据进行回显，用户修改完成后点击确定按钮将修改后的数据提交到后台进行数据库操作。此处进行数据回显的时候，除了需要检查组基本信息的回显之外，还需要回显当前检查组包含的检查项（以复选框勾选的形式回显）。</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 “/checkgroup/findById.do?id=”+row.id 和 “/checkitem/findAll.do” 和 “/checkgroup/findCheckItemIdsByCheckGroupId.do?id=”+row.id 和 “/checkgroup/edit.do?checkitemIds=”+this.checkitemIds,this.formData）——&gt;controller（根据id查询 “/findById” 和 根据检查组合id查询对应的所有检查项id “/findCheckItemIdsByCheckGroupId” 和 编辑"/edit"）——&gt; service接口（edit 和 findCheckItemIdsByCheckGroupId 和 findById）——&gt;serviceimpl实现类（findById 和 findCheckItemIdsByCheckGroupId 和 edit 和setCheckGroupAndCheckItem）——&gt;Dao接口（setCheckGroupAndCheckItem 和 findById 和 findCheckItemIdsByCheckGroupId 和edit 和 deleteAssociation）——&gt;Mapper映射文件 (id=“findById” 和 id=“setCheckGroupAndCheckItem” 和 id=“deleteAssociation” 和id=“edit”）</p> 
</blockquote> 
<h4><a id="424__139"></a>4.2.4 删除检查组</h4> 
<blockquote> 
 <p>注意：不能直接删除，需要判断当前检查项是否和检查组关联，如果已经和检查组进行了关联则不允许删除<br> 删除时候，先删除检查项和检查组之间的关系表，然后再删除检查项</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 “/checkgroup/delete.do?id=”+row.id）——&gt;controller（删除 “/delete”）——&gt; service接口（deleteById）<br> ——&gt;serviceimpl实现类（deleteById）——&gt;Dao接口（deleteById 和 deleteAssociation）——&gt;Mapper映射文件 （id=“deleteById” 和 id=“deleteAssociation”)</p> 
</blockquote> 
<h3><a id="43__147"></a>4.3 预约管理-套餐管理</h3> 
<h4><a id="431__148"></a>4.3.1 图片存储方案</h4> 
<blockquote> 
 <p>在实际开发中，我们会有很多处理不同功能的服务器。例如：<br> 应用服务器：负责部署我们的应用<br> 数据库服务器：运行我们的数据库<br> 文件服务器：负责存储用户上传文件的服务器<br> <img src="https://images2.imgbox.com/dd/7a/YjUPf3K2_o.png" alt="在这里插入图片描述">分服务器处理的目的是让服务器各司其职，从而提高我们项目的运行效率。<br> 常见的图片存储方案：<br> 方案一：使用nginx搭建图片服务器<br> 方案二：使用开源的分布式文件存储系统，例如Fastdfs、HDFS等<br> 方案三：使用云存储，例如阿里云、七牛云等</p> 
</blockquote> 
<p><strong>本项目使用的是七牛云存储（主要使用的是七牛云提供的对象存储服务来存储图片。）</strong><br> 官网：<a href="https://www.qiniu.com/" rel="nofollow">https://www.qiniu.com/</a></p> 
<p><strong>本项目采用的是JavaSDK方式</strong><br> 地址：<a href="https://developer.qiniu.com/kodo/sdk/1239/java" rel="nofollow">https://developer.qiniu.com/kodo/sdk/1239/java</a></p> 
<p>使用Java SDK操作七牛云需要导入如下maven坐标：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.qiniu<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>qiniu-java-sdk<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>7.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>此处将其封装成了一个工具类<code>QiniuUtils</code>，主要实现<code>图片上传和删除</code>功能<br> <img src="https://images2.imgbox.com/f0/ad/Uk0RfPsp_o.png" alt="在这里插入图片描述"><br> 当使用这个工具类时候，注意修改这三处地方。</p> 
<h4><a id="432__177"></a>4.3.2 新增套餐</h4> 
<blockquote> 
 <p>套餐其实就是检查组的集合，例如有一个套餐为“入职体检套餐”，这个体检套餐可以包括多个检查组：一般检查、血常规、尿常规、肝功三项等。所以在添加套餐时需要选择这个套餐包括的检查组。<br> 套餐对应的实体类为Setmeal，对应的数据表为t_setmeal。套餐和检查组为多对多关系，所以需要中间表t_setmeal_checkgroup进行关联。</p> 
</blockquote> 
<blockquote> 
 <p>现在虽然已经完成了新增窗口的弹出，但是在检查组信息标签页中需要动态展示所有的检查组信息列表数据，并且可以进行勾选。<br> <strong>1.动态展示检查项列表实现过程：</strong><br> 页面完善动态效果（提交到"/checkgroup/findAll.do"）——&gt;controller（查询所有 “/findAll”）——&gt; service接口（findAll）<br> ——&gt;serviceimpl实现类（findAll）——&gt;Dao接口（findAll）——&gt;Mapper映射文件 (id=“findAll”）</p> 
</blockquote> 
<blockquote> 
 <p><strong>2.图片上传并预览：</strong><br> 图片文件上传成功后，通过触发上传成功后的钩子函数<code>handleAvatarSuccess</code>，为模型数据imageUrl赋值，用于页面图片预览。上传提交到<code>action="/setmeal/upload.do"</code>，在<code>SetmealController</code>中通过<code>upload</code>函数来执行上传功能，需要调用骑牛工具类<code>QiniuUtils</code>中的<code>upload2Qiniu</code>函数来实现。<br><br> 注意：可以在上图片之前通过触发上传前的钩子函数<code>beforeAvatarUpload</code>进行图片的验证：验证图片的大小、格式等</p> 
</blockquote> 
<blockquote> 
 <p>当用户点击新增窗口中的确定按钮时发送ajax请求将数据提交到后台进行数据库操作。提交到后台的数据分为两部分：套餐基本信息（对应的模型数据为formData）和检查组id数组（对应的模型数据为checkgroupIds）。<br> <strong>3.提交请求实现过程：</strong><br> 页面完善动态效果（提交到 “/setmeal/add.do?checkgroupIds=”+this.checkgroupIds,this.formData）——&gt;controller（新增“/add”）——&gt; service接口（add） ——&gt;serviceimpl实现类（add 和 设置套餐和检查组的关联关系 setSetmealAndCheckGroup）——&gt;Dao接口（add 和 setSetmealAndCheckGroup）——&gt;Mapper映射文件 (id=“add” 和 id=“setSetmealAndCheckGroup”）</p> 
</blockquote> 
<h4><a id="433__195"></a>4.3.3 体检套餐分页</h4> 
<blockquote> 
 <p>1.在页面中提供了findPage方法用于分页查询，为了能够在setmeal.html页面加载后直接可以展示分页数据，可以在VUE提供的钩子函数created中调用findPage方法<br> 2.分页方法执行时机：①点击查询 ②切换页码</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到"/setmeal/findPage.do",param）——&gt;controller（分页查询 “/findPage”）——&gt; service接口（扩展分页查询方法：pageQuery）——&gt;serviceimpl实现类（基于Mybatis分页助手插件实现分页；pageQuery）——&gt;Dao接口（扩展分页查询方法，根据条件进行查询； findByCondiction）——&gt;Mapper映射文件 (id=“findByCondiction”)</p> 
</blockquote> 
<h4><a id="434_Quartz_202"></a>4.3.4 定期清理垃圾图片（定时任务组件Quartz）</h4> 
<blockquote> 
 <p><strong>Quartz介绍</strong><br> Quartz是Job scheduling（作业调度）领域的一个开源项目，Quartz既可以单独使用也可以跟spring框架整合使用，在实际开发中一般会使用后者。使用Quartz可以开发一个或者多个定时任务，每个定时任务可以单独指定执行的时间，例如每隔1小时执行一次、每个月第一天上午10点执行一次、每个月最后一天下午5点执行一次等。<br><br> 官网：<a href="http://www.quartz-scheduler.org/" rel="nofollow">http://www.quartz-scheduler.org/</a></p> 
</blockquote> 
<p>maven坐标：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.quartz-scheduler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>quartz<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.quartz-scheduler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>quartz-jobs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>cron表达式（cron表达式可以灵活的定义出符合要求的程序执行的时间），自己编写表达式还是有一些困难的，我们可以借助一些cron表达式在线生成器来根据我们的需求生成表达式即可。<a href="http://cron.qqe2.com/" rel="nofollow">http://cron.qqe2.com/</a></p> 
<blockquote> 
 <p>前面我们已经完成了体检套餐的管理，在新增套餐时套餐的基本信息和图片是分两次提交到后台进行操作的。也就是用户首先将图片上传到七牛云服务器，然后再提交新增窗口中录入的其他信息。如果用户只是上传了图片而没有提交录入的其他信息，此时的图片就变为了垃圾图片，因为在数据库中并没有记录它的存在。此时我们要如何处理这些垃圾图片呢？<br><br> 解决方案就是通过定时任务组件定时清理这些垃圾图片。为了能够区分出来哪些图片是垃圾图片，我们在文件上传成功后将图片保存到了一个redis集合中，当套餐数据插入到数据库后我们又将图片名称保存到了另一个redis集合中，通过计算这两个集合的差值就可以获得所有垃圾图片的名称。<br><br> 方案就是利用redis来保存图片名称，具体做法为：<br> 1、当用户上传图片后，将图片名称保存到redis的一个Set集合中，例如集合名称为setmealPicResources<br> 2、当用户添加套餐后，将图片名称保存到redis的另一个Set集合中，例如集合名称为setmealPicDbResources<br> 3、计算setmealPicResources集合与setmealPicDbResources集合的差值，结果就是垃圾图片的名称集合，清理这些图片即可<br><br> 在这里基于Quartz定时任务，通过计算redis两个集合的差值找出所有的垃圾图片，就可以将垃圾图片清理掉。<br><br> <strong>1.完善文件上传实现过程：</strong><br> ①.在health_backend项目中提供Spring配置文件<code>spring-redis.xml</code>和<code>Redis常量类</code>，完善SetmealController中的<code>upload</code>方法，在文件上传成功后将图片名称保存到redis集合中<br> ②.在health_service_provider项目中提供Spring配置文件applicationContext-redis.xml，完善SetmealServiceImpl服务类中的<code>add</code>方法，在保存完成套餐信息后将图片名称存储到redis集合中<br><br> <strong>2.定时清理垃圾图片实现：</strong><br> ①：创建maven工程health_jobs，打包方式为war，导入Quartz等相关坐标，并<code>配置web.xml，log4j.properties，applicationContext-redis.xml，applicationContext-jobs.xml</code><br> ②：创建ClearImgJob定时任务类，实现定时清理垃圾图片（先是根据Redis中保存的两个set集合进行差值计算，获得垃圾图片名称集合；然后删除七牛云服务器上的图片；再从Redis集合中删除图片名称）</p> 
</blockquote> 
<h3><a id="44__236"></a>4.4 预约管理-预约设置</h3> 
<blockquote> 
 <p>前面我们已经完成了检查项管理、检查组管理、套餐管理等。接下来我们需要进行预约设置，其实就是设置每一天的体检预约最大数量。客户可以通过微信端在线预约，在线预约时需要选择体检的时间，如果客户选择的时间已经预约满则无法进行预约。</p> 
</blockquote> 
<h4><a id="441_Apache_POI_239"></a>4.4.1 Apache POI</h4> 
<p>Apache POI是用Java编写的免费开源的跨平台的Java API，Apache POI提供API给Java程序对Microsoft Office格式档案读和写的功能，其中使用最多的就是使用POI操作Excel文件。</p> 
<p>maven坐标：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.poi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>poi-ooxml<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.14<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<blockquote> 
 <p><strong>POI结构：</strong><br> HSSF － 提供读写Microsoft Excel XLS格式档案的功能<br> XSSF － 提供读写Microsoft Excel OOXML XLSX格式档案的功能<br> HWPF － 提供读写Microsoft Word DOC格式档案的功能<br> HSLF － 提供读写Microsoft Power Point格式档案的功能<br> HDGF － 提供读Microsoft Visio格式档案的功能<br> HPBF － 提供读Microsoft Publisher格式档案的功能<br> HSMF － 提供读Microsoft Outlook格式档案的功能</p> 
</blockquote> 
<h4><a id="442__265"></a>4.4.2 批量导入预约设置信息</h4> 
<blockquote> 
 <p>预约设置信息对应的数据表为t_ordersetting，预约设置操作对应的页面为ordersetting.html<br> orderDate：预约日期<br> number：可预约人数<br> reservations：已预约人数<br><br> <strong>批量导入预约设置信息操作过程：</strong><br> 1、点击模板下载按钮下载Excel模板文件<br> 2、将预约设置信息录入到模板文件中<br> 3、点击上传文件按钮将录入完信息的模板文件上传到服务器<br> 4、通过POI读取上传文件的数据并保存到数据库</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 action="/ordersetting/upload.do"）——&gt;controller（"/upload"）——&gt; service接口（add）——&gt;serviceimpl实现类（add）——&gt;Dao接口（add）——&gt;Mapper映射文件 (id=“add”)</p> 
</blockquote> 
<blockquote> 
 <p>注意：在实现类中，需要进行判断，如果当天已经进行了预约设置，则进行更新操作。</p> 
</blockquote> 
<h4><a id="443__281"></a>4.4.3 日历展示预约设置信息</h4> 
<blockquote> 
 <p>前面已经完成了预约设置功能，现在就需要通过日历的方式展示出来每天设置的预约人数。<br> 在页面中已经完成了日历的动态展示，我们只需要查询当前月份的预约设置信息并展示到日历中即可，同时在日历中还需要展示已经预约的人数</p> 
</blockquote> 
<blockquote> 
 <p>页面发送Ajax请求，根据当前对应的月份查询数据库，封装成响应结果赋值给leftobj模型数据，用于页面展示</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到 “/ordersetting/getOrderSettingByMonth.do?date=”+this.currentYear+"-"+this.currentMonth）——&gt;controller（"/getOrderSettingByMonth"）——&gt; service接口（getOrderSettingByMonth）——&gt;serviceimpl实现类（getOrderSettingByMonth）<br> ——&gt;Dao接口（getOrderSettingByMonth）——&gt;Mapper映射文件 (id=“getOrderSettingByMonth”)</p> 
</blockquote> 
<h4><a id="444__291"></a>4.4.4 基于日历实现预约设置</h4> 
<blockquote> 
 <p>通过点击日历中的设置按钮来设置对应日期的可预约人数</p> 
</blockquote> 
<blockquote> 
 <p>点击设置，弹出预约设置窗口并发送ajax请求（在页面中需要将当天的日期和数量参数传给后台）</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到"/ordersetting/editNumberByDate.do",{orderDate:this.formatDate(day.getFullYear(),day.getMonth()+1,day.getDate()), number:value ）——&gt;controller（"/editNumberByDate"）——&gt; service接口（editNumberByDate）——&gt;serviceimpl实现类（editNumberByDate）<br> ——&gt;Dao接口（editNumberByDate）——&gt;Mapper映射文件 (id="editNumberByDate"和id=“findCountByOrderDate”)</p> 
</blockquote> 
<h3><a id="45__300"></a>4.5 移动端开发-体检预约</h3> 
<h4><a id="451__301"></a>4.5.1 移动端开发</h4> 
<p><strong>一、移动端开发主要有三种方式：</strong></p> 
<p>1、基于手机API开发（原生APP）</p> 
<blockquote> 
 <p>手机端使用手机API，例如使用Android、ios等进行开发，服务端只是一个数据提供者。手机端请求服务端获取数据（json、xml格式）并在界面进行展示。这种方式相当于传统开发中的C/S模式，即需要在手机上安装一个客户端软件。<br><br> 这种方式需要针对不同的手机系统分别进行开发，目前主要有以下几个平台：<br> 1、苹果ios系统版本，开发语言是Objective-C<br> 2、安卓Android系统版本，开发语言是Java<br> 3、微软Windows phone系统版本，开发语言是C#<br> 4、塞班symbian系统版本，开发语言是C++<br> 此种开发方式举例：手机淘宝、抖音、今日头条、大众点评</p> 
</blockquote> 
<p>2、基于手机浏览器开发（移动web）</p> 
<blockquote> 
 <p>生存在浏览器中的应用，基本上可以说是触屏版的网页应用。这种开发方式相当于传统开发中的B/S模式，也就是手机上不需要额外安装软件，直接基于手机上的浏览器进行访问。这就需要我们编写的html页面需要根据不同手机的尺寸进行自适应调节，目前比较流行的是html5开发。除了直接通过手机浏览器访问，还可以将页面内嵌到一些应用程序中，例如通过微信公众号访问html5页面。<br> 这种开发方式不需要针对不同的手机系统分别进行开发，只需要开发一个版本，就可以在不同的手机上正常访问。<br><br> 本项目会通过将我们开发的html5页面内嵌到微信公众号这种方式进行开发。</p> 
</blockquote> 
<p>3、混合开发（混合APP）</p> 
<blockquote> 
 <p>是半原生半Web的混合类App。需要下载安装，看上去类似原生App，访问的内容是Web网页。其实就是把HTML5页面嵌入到一个原生容器里面。</p> 
</blockquote> 
<p><strong>二、微信公众号开发</strong><br> 微信公众平台，官网：<a href="https://mp.weixin.qq.com/" rel="nofollow">https://mp.weixin.qq.com/</a></p> 
<p>在微信公众平台可以看到，有四种帐号类型：服务号、订阅号、小程序、企业微信（原企业号）。<br> <img src="https://images2.imgbox.com/ef/56/oo0Hb19k_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>本项目会选择订阅号这种方式进行公众号开发。</p> 
</blockquote> 
<h4><a id="452__330"></a>4.5.2 需求分析和环境搭建</h4> 
<p><strong>需求分析</strong></p> 
<blockquote> 
 <p>用户在体检之前需要进行预约，可以通过电话方式进行预约，此时会由体检中心客服人员通过后台系统录入预约信息。用户也可以通过手机端自助预约。本章节开发的功能为用户通过手机自助预约。<br><br> 预约流程如下：<br> 1、访问移动端首页<br> 2、点击体检预约进入体检套餐列表页面<br> 3、在体检套餐列表页面点击具体套餐进入套餐详情页面<br> 4、在套餐详情页面点击立即预约进入预约页面<br> 5、在预约页面录入体检人相关信息点击提交预约</p> 
</blockquote> 
<p><strong>项目搭建</strong><br> 1.在health_common工程的pom.xml文件中导入阿里短信发送的maven坐标和导入通用组件工具类（ValidateCodeUtils，SMSUtils，RedisMessageConstant）</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-dysmsapi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2.创建移动端工程health_mobile，打包方式为war，用于存放Controller，在Controller中通过Dubbo可以远程访问服务层相关服务，所以需要依赖health_interface接口工程。<br> <img src="https://images2.imgbox.com/01/71/S7GCsOET_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="453__357"></a>4.5.3 套餐列表页面动态展示</h4> 
<blockquote> 
 <p>点击体检预约直接跳转到体检套餐列表页面，并展示套餐列表信息</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到"/setmeal/getAllSetmeal.do"）——&gt;controller（ “/getAllSetmeal”）——&gt; service接口（findAll）——&gt;serviceimpl实现类（findAll）——&gt;Dao接口（findAll）——&gt;Mapper映射文件 (id=“findAll”)</p> 
</blockquote> 
<h4><a id="454__364"></a>4.5.4 套餐详情页面动态展示</h4> 
<blockquote> 
 <p>前面我们已经完成了体检套餐列表页面动态展示，点击其中任意一个套餐则跳转到对应的套餐详情页面（/pages/setmeal_detail.html），并且会携带此套餐的id作为参数提交。<br><br> 请求路径格式：http://localhost/pages/setmeal_detail.html?id=10<br><br> 在套餐详情页面需要展示当前套餐的信息（包括图片、套餐名称、套餐介绍、适用性别、适用年龄）、此套餐包含的检查组信息、检查组包含的检查项信息等。<br><br> 在页面中，需要将当前所要查询套餐id通过封装好的<code>getUrlParam</code>方法获取到。<br> 此处会使用mybatis提供的关联查询，在根据id查询套餐时，同时将此套餐包含的检查组都查询出来，并且将检查组包含的检查项都查询出来。</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到"/setmeal/findById.do?id=" + id）——&gt;controller（ “/findById”）——&gt; service接口（finById）——&gt;serviceimpl实现类（finById）——&gt;Dao接口（finById）——&gt;Mapper映射文件 (id=“finById”)</p> 
</blockquote> 
<h4><a id="455__374"></a>4.5.5 短信发送</h4> 
<p><strong>短信服务介绍</strong></p> 
<blockquote> 
 <p>目前市面上有很多第三方提供的短信服务，这些第三方短信服务会和各个运营商（移动、联通、电信）对接，我们只需要注册成为会员并且按照提供的开发文档进行调用就可以发送短信。需要说明的是这些短信服务都是收费的服务。<br><br> 本项目短信发送我们选择的是阿里云提供的短信服务。<br> 短信服务（Short Message Service）是阿里云为用户提供的一种通信服务的能力，支持快速发送短信验证码、短信通知等。三网合一专属通道，与工信部携号转网平台实时互联。电信级运维保障，实时监控自动切换，到达率高达99%。短信服务API提供短信发送、发送状态查询、短信批量发送等能力，在短信服务控制台上添加签名、模板并通过审核之后，可以调用短信服务API完成短信发送等操作。<br><br> 阿里云官网：<a href="https://www.aliyun.com/" rel="nofollow">https://www.aliyun.com/</a></p> 
</blockquote> 
<p><strong>实现过程：</strong></p> 
<ol><li>导入maven坐标</li></ol> 
<pre><code class="prism language-xml"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-core<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.3.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>aliyun-java-sdk-dysmsapi<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2.短信发送工具类<code>SMSUtils</code> (使用时候需要在这个工具类中修改为自己的Access和密匙等其他内容)<br> 3.在需要的使用的controller中进行调用<code>SMSUtils</code></p> 
<h3><a id="46__398"></a>4.6 页面静态化</h3> 
<h4><a id="461__399"></a>4.6.1 页面静态化介绍</h4> 
<blockquote> 
 <p>我们已经实现了移动端套餐列表页面和套餐详情页面的动态展示。但是我们需要思考一个问题，就是对于这两个页面来说，每次用户访问这两个页面都需要查询数据库获取动态数据进行展示，而且这两个页面的访问量是比较大的，这就对数据库造成了很大的访问压力，并且数据库中的数据变化频率并不高。那我们需要通过什么方法为数据库减压并提高系统运行性能呢？答案就是页面静态化。<br><br> 页面静态化其实就是将原来的动态网页(例如通过ajax请求动态获取数据库中的数据并展示的网页)改为通过静态化技术生成的静态网页，这样用户在访问网页时，服务器直接给用户响应静态html页面，没有了动态查询数据库的过程。<br><br> 那么这些静态HTML页面还需要我们自己去编写吗？其实并不需要，我们可以通过专门的页面静态化技术帮我们生成所需的静态HTML页面，例如：<code>Freemarker、thymeleaf等</code>。</p> 
</blockquote> 
<h4><a id="462_Freemarker_404"></a>4.6.2 Freemarker</h4> 
<p><strong>Freemarker介绍</strong></p> 
<blockquote> 
 <p>FreeMarker 是一个用 Java 语言编写的模板引擎，它基于模板来生成文本输出。FreeMarker与 Web 容器无关，即在 Web 运行时，它并不知道 Servlet 或 HTTP。它不仅可以用作表现层的实现技术，而且还可以用于生成 XML，JSP 或 Java等。<br> <img src="https://images2.imgbox.com/91/58/8SYqeoOg_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<blockquote> 
 <p><strong>生成文件</strong><br> 使用步骤：<br> 第一步：创建一个 Configuration 对象，直接 new 一个对象。构造方法的参数就是 freemarker的版本号。<br> 第二步：设置模板文件所在的路径。<br> 第三步：设置模板文件使用的字符集。一般就是 utf-8。<br> 第四步：加载一个模板，创建一个模板对象。<br> 第五步：创建一个模板使用的数据集，可以是 pojo 也可以是 map。一般是 Map。<br> 第六步：创建一个 Writer 对象，一般创建 FileWriter 对象，指定生成的文件名。<br> 第七步：调用模板对象的 process 方法输出文件。<br> 第八步：关闭流。</p> 
</blockquote> 
<h4><a id="463__421"></a>4.6.3 生成移动端静态页面</h4> 
<p>1.在health_common工程的pom文件中导入Freemarker的maven坐标</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>freemarker<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3.23<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2.创建模板文件</p> 
<blockquote> 
 <p>在health_service_provider工程的WEB-INF目录中创建ftl目录，在ftl目录中创建模板文件mobile_setmeal.ftl和mobile_setmeal_detail.ftl文件，前者是用于生成套餐列表页面的模板文件，后者是生成套餐详情页面的模板文件</p> 
</blockquote> 
<p>3.配置文件</p> 
<blockquote> 
 <p>（1）在health_service_provider工程中创建属性文件<code>freemarker.properties</code><br> <code>out_put_path=D:/ideaProjects/health_parent/health_mobile/src/main/webapp/pages</code><br> 通过上面的配置可以指定将静态HTML页面生成的目录位置<br> （2）在health_service_provider工程的Spring配置文件中配置</p> 
</blockquote> 
<p>4.生成静态页面<br> 在health_service_provider工程中的SetmealServiceImpl类中，加入生成静态页面的逻辑。</p> 
<blockquote> 
 <p>①.generateMobileStaticHtml（生成当前方法所需的静态页面）<br> ②.generateMobileSetmealListHtml（生成套餐列表静态页面）<br> ③.generateMobileSetmealDetailHtml（生成套餐详情静态页面(可能有多个)）<br> ④.generateHtml（用于生成静态页面）</p> 
</blockquote> 
<h3><a id="47__449"></a>4.7 移动端开发-体检预约</h3> 
<h4><a id="471__450"></a>4.7.1 体检预约</h4> 
<blockquote> 
 <p><strong>体检预约流程</strong><br> 用户可以通过如下操作流程进行体检预约：<br> 1、在移动端首页点击体检预约，页面跳转到套餐列表页面<br> 2、在套餐列表页面点击要预约的套餐，页面跳转到套餐详情页面<br> 3、在套餐详情页面点击立即预约，页面跳转到预约页面<br> 4、在预约页面录入体检人信息，包括手机号，点击发送验证码<br> 5、在预约页面录入收到的手机短信验证码，点击提交预约，完成体检预约</p> 
</blockquote> 
<blockquote> 
 <p>1.先是获取当前预约套餐的id，然后发送Ajax请求，根据获取的id查询套餐信息<br> 2.在预约页面需要进行<code>手机号格式的验证，30秒倒计时，验证码获取和身份证格式校验</code>（第一个、第二个和第四个已经写好方法在healthmobile.js中）</p> 
</blockquote> 
<blockquote> 
 <p><strong>验证码获取实现：</strong><br> 页面完善动态效果（提交到("/validateCode/send4Order.do?telephone=" +telephone）——&gt;controller（ 体检预约时发送手机验证码“/send4Order”）<br> 注意：此处还将验证码存到redis中5分钟。</p> 
</blockquote> 
<blockquote> 
 <p><strong>提交预约请求实现：</strong><br> 页面完善动态效果（提交到"/order/submit.do",this.orderInfo）——&gt;controller（ “/submit”）——&gt; service接口（Order）——&gt;serviceimpl实现类（Order）——&gt;Dao接口（findByOrderDate、findByTelephone、findByCondition、add、editReservationsByOrderDate）——&gt;Mapper映射文件 (id=“findByOrderDate”、id=“findByTelephone”、id=“findByCondition”、id=“add”、id=“editReservationsByOrderDate”)<br><br> 注意：<br> 1.在controller中处理预约请求时，需要将redis中的验证码取出来和用户输入的进行比对：成功的话通过dubbo远程调用服务实现在线预约业务处理，并且向用户发送预约成功的短信；不成功的话返回结果给页面。<br> 2. 在serviceImpl实现类中</p> 
 <blockquote> 
  <p>1、检查用户所选择的预约日期是否已经提前进行了预约设置，如果没有设置则无法进行预约<br> 2、检查用户所选择的预约日期是否已经约满，如果已经约满则无法预约<br> 3、检查用户是否重复预约（同一个用户在同一天预约了同一个套餐），如果是重复预约则无法完成再次预约<br> 4、检查当前用户是否为会员，如果是会员则直接完成预约，如果不是会员则自动完成注册并进行预约<br> 5、预约成功，更新当日的已预约人数</p> 
 </blockquote> 
 <p>3.在Dao中，需要提供给实现类的接口（1的findByOrderDate）（2通过计算得出预约人数情况）（3的findByTelephone和findByCondition）（4的add）（5的add和editReservationsByOrderDate）</p> 
</blockquote> 
<h4><a id="472__482"></a>4.7.2 预约成功页面展示</h4> 
<blockquote> 
 <p>前面已经完成了体检预约，预约成功后页面会跳转到成功提示页面（orderSuccess.html）并展示预约的相关信息（体检人、体检套餐、体检时间等）。</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到"/order/findById.do?id=" + id）——&gt;controller（ “/findById”）——&gt; service接口（findById）——&gt;serviceimpl实现类（finById）——&gt;Dao接口（findById4Detail）——&gt;Mapper映射文件 (id=“findById4Detail”)</p> 
</blockquote> 
<h3><a id="48__489"></a>4.8 移动端开发-手机快速登录、权限控制</h3> 
<h4><a id="481___490"></a>4.8.1 手机快速登录</h4> 
<blockquote> 
 <p>机快速登录功能，就是通过短信验证码的方式进行登录。这种方式相对于用户名密码登录方式，用户不需要记忆自己的密码，只需要通过输入手机号并获取验证码就可以完成登录，是目前比较流行的登录方式。<br> <img src="https://images2.imgbox.com/d1/2a/53fh9Eev_o.png" alt="在这里插入图片描述"><br> 先是获取验证码（和预约页面获取验证码一样，只是提交的请求不一样），然后再提交登录</p> 
</blockquote> 
<blockquote> 
 <p><strong>提交登录实现过程：</strong><br> 页面完善动态效果（提交到"/member/login.do",this.loginInfo）——&gt;controller（ “/login”）——&gt; service接口（findByTelephone和add）——&gt;serviceimpl实现类（findByTelephone和add）——&gt;Dao接口（findByTelephone和add）——&gt;Mapper映射文件 (id="findByTelephone"和id=“add”)<br><br> <strong>注意： 在controller中</strong></p> 
 <blockquote> 
  <p>1、校验用户输入的短信验证码是否正确，如果验证码错误则登录失败<br> 2、如果验证码正确，则判断当前用户是否为会员，如果不是会员则自动完成会员注册<br> 3、向客户端写入Cookie，内容为用户手机号<br> 4、将会员信息保存到Redis，使用手机号作为key，保存时长为30分钟</p> 
 </blockquote> 
</blockquote> 
<h4><a id="482__504"></a>4.8.2 权限控制</h4> 
<blockquote> 
 <p>前面我们已经完成了传智健康后台管理系统的部分功能，例如检查项管理、检查组管理、套餐管理、预约设置等。接下来我们需要思考2个问题：<br> 问题1：在生产环境下我们如果不登录后台系统就可以完成这些功能操作吗？ 答案显然是否定的，要操作这些功能必须首先登录到系统才可以。<br> 问题2：是不是所有用户，只要登录成功就都可以操作所有功能呢？<br> 答案是否定的，并不是所有的用户都可以操作这些功能。不同的用户可能拥有不同的权限，这就需要进行授权了。<br><br> 认证：系统提供的用于识别用户身份的功能，通常提供用户名和密码进行登录其实就是在进行认证，认证的目的是让系统知道你是谁。<br> 授权：用户认证成功后，需要为用户授权，其实就是指定当前用户可以操作哪些功能。<br><br> 本章节就是要对后台系统进行权限控制，其本质就是对用户进行认证和授权。</p> 
</blockquote> 
<blockquote> 
 <p><strong>权限模块数据模型</strong><br> 前面已经分析了认证和授权的概念，要实现最终的权限控制，需要有一套表结构支撑：<br><br> 用户表t_user、权限表t_permission、角色表t_role、菜单表t_menu、用户角色关系表t_user_role、角色权限关系表t_role_permission、角色菜单关系表t_role_menu。<br><br> 表之间关系如下图：<br> <img src="https://images2.imgbox.com/b0/e2/hbYAWiFb_o.png" alt="在这里插入图片描述"><br> 通过上图可以看到，权限模块共涉及到7张表。在这7张表中，角色表起到了至关重要的作用，其处于核心位置，因为用户、权限、菜单都和角色是多对多关系。<br><br> 接下来我们可以分析一下在认证和授权过程中分别会使用到哪些表：<br> 认证过程：只需要用户表就可以了，在用户登录时可以查询用户表t_user进行校验，判断用户输入的用户名和密码是否正确。<br> 授权过程：用户必须完成认证之后才可以进行授权，首先可以根据用户查询其角色，再根据角色查询对应的菜单，这样就确定了用户能够看到哪些菜单。然后再根据用户的角色查询对应的权限，这样就确定了用户拥有哪些权限。所以授权过程会用到上面7张表。</p> 
</blockquote> 
<blockquote> 
 <p><strong>Spring Security简介</strong><br> Spring Security是 Spring提供的安全认证服务的框架。 使用SpringSecurity可以帮助我们来简化认证和授权的过程。官网：<a href="https://spring.io/projects/spring-security" rel="nofollow">https://spring.io/projects/spring-security</a><br> 常用的权限框架除了Spring Security，还有Apache的shiro框架。</p> 
</blockquote> 
<h4><a id="483_Spring_Security_531"></a>4.8.3 在项目中应用Spring Security</h4> 
<p><strong>导入Spring Security环境</strong><br> 第一步：在health_parent父工程的pom.xml中导入Spring Security的maven坐标</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-web<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.security.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.security<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-security-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring.security.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>第二步：在health_backend工程的web.xml文件中配置用于整合Spring Security框架的过滤器DelegatingFilterProxy</p> 
<p><strong>实现认证和授权</strong></p> 
<blockquote> 
 <p>第一步：在health_backend工程中按照Spring Security框架要求提供SpringSecurityUserService，并且实现UserDetailsService接口(主要就是根据用户名来查询用户信息，并对用户授予角色与权限)<br> 第二步：创建UserService服务接口、服务实现类、Dao接口、Mapper映射文件等<br><br> service接口（findByUsername）——&gt;serviceimpl实现类（findByUsername）——&gt;Dao接口（findByRoleId和findByUserId和findByUsername）——&gt;Mapper映射文件 (id="findByRoleId"和id="findByUserId"和id=“findByUsername”)<br><br> 第三步：在springmvc.xml文件，修改dubbo批量扫描的包路径（因为在SpringSecurityUserService的loadUserByUsername方法中需要通过dubbo远程调用名称为UserService的服务）<br><br> 第四步：在health_backend工程中提供spring-security.xml配置文件<br><br> 第五步：在springmvc.xml文件中引入spring-security.xml文件<br><br> 第六步：在Controller的方法上加入权限控制注解，此处以CheckItemController为例<br> <img src="https://images2.imgbox.com/b0/03/BwOvfv2Y_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h4><a id="484__558"></a>4.8.4 显示用户名</h4> 
<blockquote> 
 <p>前面我们已经完成了认证和授权操作，如果用户认证成功后需要在页面展示当前用户的用户名。SpringSecurity在认证成功后会将用户信息保存到框架提供的上下文对象中，所以此处我们就可以调用Spring Security框架提供的API获取当前用户的username并展示到页面上。</p> 
</blockquote> 
<blockquote> 
 <p>实现： 前端页面提交请求到（’/user/getUsername.do’）——&gt;controller（“/getUsername”）<br> 注意：当springsecurity完成认证后，会将当前用户信息保存到框架提供的上下文对象</p> 
</blockquote> 
<h4><a id="485__565"></a>4.8.5 用户退出</h4> 
<p>在spring-security.xml文件中配置</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--
  logout：退出登录
  logout-url：退出登录操作对应的请求路径
  logout-success-url：退出登录后的跳转页面
--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">security:</span>logout</span> <span class="token attr-name">logout-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/logout.do<span class="token punctuation">"</span></span> 
                 <span class="token attr-name">logout-success-url</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/login.html<span class="token punctuation">"</span></span> <span class="token attr-name">invalidate-session</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>true<span class="token punctuation">"</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre> 
<h3><a id="49__ECharts_576"></a>4.9 图形报表ECharts</h3> 
<p>官方实例地址：<a href="https://echarts.apache.org/examples/zh/index.html" rel="nofollow">https://echarts.apache.org/examples/zh/index.html</a></p> 
<blockquote> 
 <p>我们只需要将dist目录下的echarts.js文件引入到页面上就可以使用了<br> <img src="https://images2.imgbox.com/e3/22/dKtjUuij_o.png" alt="在这里插入图片描述"></p> 
</blockquote> 
<h4><a id="491__581"></a>4.9.1 会员数量折线图</h4> 
<blockquote> 
 <p>主要就是发送Ajax请求获取动态数据，并根据折线图对数据格式的要求，我们发送ajax请求后，服务端需要返回一定格式的数据</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到"/report/getMemberReport.do"）——&gt;controller（ “/getMemberReport”）——&gt; service接口（findMemberCountByMonth）——&gt;serviceimpl实现类（findMemberCountByMonth）——&gt;Dao接口（findMemberCountBeforeDate）——&gt;Mapper映射文件 (id=“findMemberCountBeforeDate”)</p> 
</blockquote> 
<h4><a id="492__587"></a>4.9.2 套餐预约占比饼形图</h4> 
<blockquote> 
 <p>通过饼形图直观的展示出会员预约的各个套餐占比情况<br> 主要就是发送Ajax请求获取动态数据，并根据饼形图对数据格式的要求，我们发送ajax请求后，服务端需要返回一定格式的数据</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到"/report/getSetmealReport.do"）——&gt;controller（ “/getSetmealReport”）——&gt; service接口（findSetmealCount）——&gt;serviceimpl实现类（findSetmealCount）——&gt;Dao接口（findSetmealCount）——&gt;Mapper映射文件 (id=“findSetmealCount”)</p> 
</blockquote> 
<h3><a id="410_POI_595"></a>4.10 POI报表</h3> 
<h4><a id="4101__596"></a>4.10.1 运营数据统计</h4> 
<blockquote> 
 <p>通过运营数据统计可以展示出体检机构的运营情况，包括会员数据、预约到诊数据、热门套餐等信息。本章节就是要通过一个表格的形式来展示这些运营数据。</p> 
</blockquote> 
<blockquote> 
 <p><strong>实现过程：</strong><br> 页面完善动态效果（提交到"/report/getBusinessReportData.do"）——&gt;controller（ “/getBusinessReportData”）——&gt; service接口（getBusinessReportData）——&gt;serviceimpl实现类（getBusinessReportData）——&gt;Dao接口（findMemberCountByDate、findMemberTotalCount、findMemberCountAfterDate、findMemberCountAfterDate和findOrderCountByDate、findOrderCountAfterDate、findOrderCountAfterDate、findVisitsCountByDate、findVisitsCountAfterDate、findVisitsCountAfterDate、findHotSetmeal）——&gt;Mapper映射文件 (和Dao中的一一对应)</p> 
</blockquote> 
<h4><a id="4102_EXCEL_602"></a>4.10.2 运营数据统计报表导出（EXCEL形式）</h4> 
<blockquote> 
 <p>运营数据统计报表导出就是将统计数据写入到Excel并提供给客户端浏览器进行下载，以便体检机构管理人员对运营数据的查看和存档。<br> 在企业实际开发中，对于比较复杂的表格导出一般我们会提前设计一个Excel模板文件，在这个模板文件中提前将表格的结构和样式设置好，我们的程序只需要读取这个文件并在文件中的相应位置写入具体的值就可以了。</p> 
</blockquote> 
<blockquote> 
 <p>实现过程：<br> 页面完善动态效果（提交到’/report/exportBusinessReport.do’）——&gt;controller（ “/exportBusinessReport”）——&gt; service接口（getBusinessReportData）——&gt;serviceimpl实现类（getBusinessReportData）——&gt;Dao接口（findMemberCountByDate、findMemberTotalCount、findMemberCountAfterDate、findMemberCountAfterDate和findOrderCountByDate、findOrderCountAfterDate、findOrderCountAfterDate、findVisitsCountByDate、findVisitsCountAfterDate、findVisitsCountAfterDate、findHotSetmeal）——&gt;Mapper映射文件 (和Dao中的一一对应)<br><br> 在ReportController中提供exportBusinessReport方法，基于POI将数据写入到Excel中并通过输出流下载到客户端</p> 
</blockquote> 
<h4><a id="4103_PDF_609"></a>4.10.3 运营数据统计报表导出（PDF形式）</h4> 
<p><strong>JasperReports</strong></p> 
<blockquote> 
 <p>JasperReports是一个强大、灵活的报表生成工具，能够展示丰富的页面内容，并将之转换成PDF，HTML，或者XML格式。该库完全由Java写成，可以用于在各种Java应用程序，包括J2EE，Web应用程序中生成动态内容。一般情况下，JasperReports会结合JaspersoftStudio(模板设计器)使用导出PDF报表。</p> 
</blockquote> 
<p><strong>JasperReports原理</strong><br> <img src="https://images2.imgbox.com/40/29/0BY0ci4c_o.png" alt="在这里插入图片描述"><br> JRXML：报表填充模板，本质是一个xml文件<br> Jasper：由JRXML模板编译成的二进制文件，用于代码填充数据<br> Jrprint：当用数据填充完Jasper后生成的对象，用于输出报表<br> Exporter：报表输出的管理类，可以指定要输出的报表为何种格式<br> PDF/HTML/XML：报表形式</p> 
<p><strong>使用JasperReports导出pdf报表，开发流程</strong></p> 
<ol><li>制作报表模板</li><li>模板编译</li><li>构造数据</li><li>填充数据</li><li>输出文件</li></ol> 
<p><strong>在项目中输出运营数据PDF报表</strong><br> 1.设计PDF模板文件<br> 2.搭建环境</p> 
<p>第一步：在health_common工程的pom.xml中导入JasperReports的maven坐标</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.sf.jasperreports<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jasperreports<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>6.8.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>第二步：将资源中提供的模板文件health_business3.jrxml复制到health_backend工程的template目录下</p> 
<p>第三步：修改report_business.html，添加PDF按钮事件</p> 
<p>第四步：在health_backend工程的ReportController中提供exportBusinessReport4PDF方法</p> 
<blockquote> 
 <p>实现过程：<br> 页面完善动态效果（提交到’/report/exportBusinessReport4PDF.do’）——&gt;controller（ “/exportBusinessReport4PDF”）——&gt; service接口（getBusinessReportData）——&gt;serviceimpl实现类（getBusinessReportData）——&gt;Dao接口（findMemberCountByDate、findMemberTotalCount、findMemberCountAfterDate、findMemberCountAfterDate和findOrderCountByDate、findOrderCountAfterDate、findOrderCountAfterDate、findVisitsCountByDate、findVisitsCountAfterDate、findVisitsCountAfterDate、findHotSetmeal）——&gt;Mapper映射文件 (和Dao中的一一对应)</p> 
</blockquote> 
<h2><a id="_648"></a>五、目前存在的问题</h2> 
<blockquote> 
 <p>1.图片上传后，虽然页面显示成功，但是七牛云云端并没有存储下来。（未解决）<br> 2.图片上传成功后，页面并不能显示预览效果。（未解决）<br> 3.模板下载不成功（未解决，不能直接使用模板的路径）<br> 4.短信业务需要自己注册，不然key不能使用（我自己没有购买阿里云的短信服务）<br> 5.第十一个：导出Excel一直显示–》“获取运营数据失败”也就是不能导出Excel表，但是“运营数据统计”中数据是能统计并显示出来的。（未解决）<br> 6.第十二个：导出PDF也是显示失败，也是和5中的一样显示找不到路径（未解决）</p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2900f56feb673e76692603a0d776ee66/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">用jquery来实现轮播图效果</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7df10c37109ba7336f80825fc1737d75/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java中求一个数的幂次方</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>