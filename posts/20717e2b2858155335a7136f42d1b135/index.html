<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apk体积检测 - ApkChecker的使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apk体积检测 - ApkChecker的使用" />
<meta property="og:description" content="Apk体积优化一直是迭代中的不可忽略的问题, 这次要说的是apk体积的检测方法, 毕竟优化都是基于检测的;
当然, 在Android Studio中有Apk Analyser工具可以使用, 但是需要导出, 或者在每个版本迭代中生成报告, 手动生成apk后拖入也是比较麻烦的; 使用Matrix 提供的工具 ApkChecker可以独立检测apk并生成报告, 下面介绍下打包检测过程; 1.下载ApkChecker.jar https://download.csdn.net/download/qq_23992393/86871532
独立的工具jar包, 需要java环境可用
2. 命令封装 如果想查看支持的命令说明, 可以运行:
java -jar matrix-apk-canary-2.0.8.jar 一般项目中会通过配置文件方式设置, 直接看下demo中的设置:
2.1 目录: 独立将几个需要的文件独立到一个文件夹中,便于移动管理
matrix_apk_checker_config.json:
{ &#34;--apk&#34;:&#34;[项目apk目录]&#34;, &#34;--mappingTxt&#34;:&#34;[项目mapping.txt目录]&#34;, &#34;--output&#34;:&#34;apk-checker-result&#34;, &#34;--format&#34;:&#34;mm.html,mm.json&#34;, &#34;--formatConfig&#34;: [ { &#34;name&#34;:&#34;-countMethod&#34;, &#34;group&#34;: [ { &#34;name&#34;:&#34;Android System&#34;, &#34;package&#34;:&#34;android&#34; }, { &#34;name&#34;:&#34;java system&#34;, &#34;package&#34;:&#34;java&#34; }, { &#34;name&#34;:&#34;com.tencent.test.$&#34;, &#34;package&#34;:&#34;com.tencent.test.$&#34; } ] } ], &#34;options&#34;: [ { &#34;name&#34;:&#34;-manifest&#34; }, { &#34;name&#34;:&#34;-fileSize&#34;, &#34;--min&#34;:&#34;10&#34;, &#34;--order&#34;:&#34;desc&#34;, &#34;--suffix&#34;:&#34;png, jpg, jpeg, gif, arsc&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/20717e2b2858155335a7136f42d1b135/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-01T18:20:06+08:00" />
<meta property="article:modified_time" content="2022-11-01T18:20:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apk体积检测 - ApkChecker的使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Apk体积优化一直是迭代中的不可忽略的问题, 这次要说的是apk体积的检测方法, 毕竟优化都是基于检测的;</p> 
<p>当然, 在Android Studio中有Apk Analyser工具可以使用, 但是需要导出, 或者在每个版本迭代中生成报告, 手动生成apk后拖入也是比较麻烦的; 使用Matrix 提供的工具 ApkChecker可以独立检测apk并生成报告, 下面介绍下打包检测过程; </p> 
<p></p> 
<h3>1.下载ApkChecker.jar</h3> 
<p><a href="https://download.csdn.net/download/qq_23992393/86871532" title="https://download.csdn.net/download/qq_23992393/86871532">https://download.csdn.net/download/qq_23992393/86871532</a></p> 
<p>独立的工具jar包, 需要java环境可用</p> 
<h3>2. 命令封装</h3> 
<p>如果想查看支持的命令说明, 可以运行:</p> 
<p>java -jar matrix-apk-canary-2.0.8.jar </p> 
<p>一般项目中会通过配置文件方式设置, 直接看下demo中的设置:</p> 
<p></p> 
<h4>2.1 目录:</h4> 
<blockquote> 
 <p>独立将几个需要的文件独立到一个文件夹中,便于移动管理</p> 
</blockquote> 
<p><img alt="" height="121" src="https://images2.imgbox.com/72/22/C0BdBxUr_o.png" width="444"> </p> 
<p>matrix_apk_checker_config.json:</p> 
<pre><code class="hljs">{
  "--apk":"[项目apk目录]",
  "--mappingTxt":"[项目mapping.txt目录]",
  "--output":"apk-checker-result",
  "--format":"mm.html,mm.json",
  "--formatConfig":
  [
    {
      "name":"-countMethod",
      "group":
      [
        {
          "name":"Android System",
          "package":"android"
        },
        {
          "name":"java system",
          "package":"java"
        },
        {
          "name":"com.tencent.test.$",
          "package":"com.tencent.test.$"
        }
      ]
    }
  ],
  "options": [
    {
      "name":"-manifest"
    },
    {
      "name":"-fileSize",
      "--min":"10",
      "--order":"desc",
      "--suffix":"png, jpg, jpeg, gif, arsc"
    },
    {
      "name":"-countMethod",
      "--group":"package"
    },
    {
      "name":"-checkResProguard"
    },
    {
      "name":"-findNonAlphaPng",
      "--min":"10"
    },
    {
      "name":"-checkMultiLibrary"
    },
    {
      "name":"-uncompressedFile",
      "--suffix":"png, jpg, jpeg, gif, arsc"
    },
    {
      "name":"-countR"
    },
    {
      "name":"-duplicatedFile"
    },
    {
      "name":"-checkMultiSTL",
      "--toolnm":"/Users/hanlonglin/Library/Android/sdk/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/darwin-x86_64/bin/arm-linux-androideabi-nm"
    },
    {
      "name":"-unusedResources",
      "--rTxt":"[项目package-aware-r.txt或R.txt目录]",
      "--ignoreResources"
      :["R.raw.*",
        "R.style.*",
        "R.attr.*",
        "R.id.*",
        "R.string.ignore_*"
      ]
    },
    {
      "name":"-unusedAssets",
      "--ignoreAssets":["*.so" ]
    },
    {
      "name":"-unstrippedSo",
      "--toolnm":"/Users/hanlonglin/Library/Android/sdk/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/darwin-x86_64/bin/arm-linux-androideabi-nm"
    }
  ]
}</code></pre> 
<blockquote> 
 <p>对应的目录填写自己项目中的目录即可, 不然会提示xxx is not legal!</p> 
</blockquote> 
<p></p> 
<p>matrix_apk_checker.sh:</p> 
<pre><code class="hljs">cd $(cd `dirname $0`; pwd)
java -jar matrix-apk-canary-2.0.8.jar --config matrix_apk_checker_config.json</code></pre> 
<blockquote> 
 <p>执行文件作用: </p> 
 <p>1.定位到当前目录</p> 
 <p>2.执行真正的apkChecker命令</p> 
</blockquote> 
<h4>2.2 使用</h4> 
<p>命令行输入: </p> 
<pre><code class="hljs">./matrix_apk_checker.sh </code></pre> 
<p>第一次会提示权限不足 执行:</p> 
<pre><code class="hljs">chmod +x matrix_apk_checker.sh</code></pre> 
<p>然后在执行上一条命令即可;</p> 
<p></p> 
<h4>2.3 生成报告: </h4> 
<p>命令运行以后, 会在目录下生成 apk-checker-result.html 和 apk-checker-result.json</p> 
<p>检测的信息主要包含如下信息:</p> 
<ul><li>读取manifest的信息</li></ul> 
<blockquote> 
 <p>从AndroidManifest.xml文件中读取apk的全局信息，如packageName、versionCode等。</p> 
</blockquote> 
<ul><li>按文件大小排序列出apk中包含的文件</li></ul> 
<blockquote> 
 <p>列出超过一定大小的文件，可按文件后缀过滤，并且按文件大小排序</p> 
</blockquote> 
<ul><li>统计方法数</li></ul> 
<blockquote> 
 <p>统计dex包含的方法数，并支持将输出结果按照类名(class)或者包名(package)来分组</p> 
</blockquote> 
<ul><li>检查是否经过了资源混淆(AndResGuard)</li></ul> 
<blockquote> 
 <p>检查apk是否经过了资源混淆，推荐使用资源混淆来进一步减小apk的大小</p> 
</blockquote> 
<ul><li>搜索不含alpha通道的png文件</li></ul> 
<blockquote> 
 <p>对于不含alpha通道的png文件，可以转成jpg格式来减少文件的大小</p> 
</blockquote> 
<ul><li>检查是否包含多个ABI版本的动态库</li></ul> 
<blockquote> 
 <p>so文件的大小可能会在apk文件大小中占很大的比例，可以考虑在apk中只包含一个ABI版本的动态库</p> 
</blockquote> 
<ul><li>搜索未经压缩的文件类型</li></ul> 
<blockquote> 
 <p>某个文件类型的所有文件都没有经过压缩，可以考虑是否需要压缩</p> 
</blockquote> 
<ul><li>统计apk中包含的R类以及R类中的field count</li></ul> 
<blockquote> 
 <p>编译之后，代码中对资源的引用都会优化成int常量，除了R.styleable之外，其他的R类其实都可以删除</p> 
</blockquote> 
<ul><li>搜索冗余的文件</li></ul> 
<blockquote> 
 <p>对于两个内容完全相同的文件，应该去冗余</p> 
</blockquote> 
<ul><li>检查是否有多个动态库静态链接了STL</li></ul> 
<blockquote> 
 <p>如果有多个动态库都依赖了STL，应该采用动态链接的方式而非多个动态库都去静态链接STL</p> 
</blockquote> 
<ul><li>搜索apk中包含的无用资源</li></ul> 
<blockquote> 
 <p>apk中未经使用到的资源，应该予以删除</p> 
</blockquote> 
<ul><li>搜索apk中包含的无用assets文件</li></ul> 
<blockquote> 
 <p>apk中未经使用的assets文件，应该予以删除</p> 
</blockquote> 
<ul><li>搜索apk中未经裁剪的动态库文件</li></ul> 
<blockquote> 
 <p>动态库经过裁剪之后，文件大小通常会减小很多</p> 
</blockquote> 
<p>部分截图如下:</p> 
<p><img alt="" height="872" src="https://images2.imgbox.com/97/4f/t0tMelNZ_o.png" width="1200"></p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5a22115a789842e3c42d8f11ef29538e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js 表格数据处理横向变纵向数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1d62abb5d4f5823e5365e64b73cd9178/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">无线网络边缘“遇上”分布式机器学习讲座：Machine Learning at the Wireless Edge</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>