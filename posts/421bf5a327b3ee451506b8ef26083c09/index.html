<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java实现字符串表达式求值 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java实现字符串表达式求值" />
<meta property="og:description" content="需求说明 最近在用java写一个计算器，遇到了一个问题，获取用户输入的需要计算的表达式，因为是字符串的形式所以无法进行直接计算，所以需要写一些算法来对字符串表达式进行求值。
实现 JS实现 相信大家应该都知道JavaScript，JavaScript里面有个函数eval()可以计算某个字符串，并执行其中的JavaScript代码。虽然JavaScript名字里面有个Java，但是JavaScript和Java没什么联系的，那我上面说的这些有什么用呢？
在JDK1.6中，我们可以使用内置的JavaScript引擎，意味着我们可以使用JavavScript里面的eval()函数。
import javax.script.ScriptEngine; import javax.script.ScriptEngineManager; import javax.script.ScriptException; public class OperationJS { public static void main(String[] args) throws ScriptException { ScriptEngineManager mgr = new ScriptEngineManager(); ScriptEngine engine = mgr.getEngineByName(&#34;JavaScript&#34;); String foo = &#34;(40&#43;2)*2&#34;; System.out.println(engine.eval(foo)); } } 使用这个要注意一个安全问题，执行的JavaScript可以访问所有Java类，因此可以无限制地劫持您的应用程序。
例如下面这句代码，将通过JavaScript将文件写入（默认情况下）程序的当前目录
engine.eval(&#34;var f = new java.io.FileWriter(&#39;hello.txt&#39;); f.write(&#39;hello!&#39;); f.close();&#34;); 发现这个有点方便。秉着学习的原则，出现了实现二，用算法来解决。
栈实现 基本分析 表达式主要有括号和加减乘除四种基本运算。表达式可以看成是由一个个二元运算组成，前一个二元运算可以作为后一个二元运算的输入。
例如：“1&#43;2&#43;3”，可以看成是两个二元运算组成(1&#43;2)&#43;3，前一个二元运算过后就变成3&#43;3，这又是一个二元运算，最后结果为6。既然都是二元运算计算，我们就可以用同一段程序来解决，递归或循环。但是我们要注意加减乘除有优先级之分。加减乘除四种运算符是有优先级的，乘法或除法同级，且比加法或减法优先级高。优先级的出现对程序的设计影响很大，例如：”1&#43;2&#43;3-4“=“3&#43;3-4”=“6-4”=2，如果整个表达式都是同级的我们就可以直接从头一直运算到尾。但是因为有优先级的出现我们就不可以这样做，例如：“1&#43;2*3-4”=“1&#43;6-4”=“3”,我们需要先算在表达式中间的”2*3“，而不能从头的&#34;1&#43;2&#34;开始算。优先级的出现让程序变的复杂了起来。括号的处理，括号就相当于在表达式里面嵌套了一个子表达式，而子表达式的优先级比括号外的其他运算优先级高。 分析可得，表达式有两个基本元素，操作数和运算符。
算法思想 操作数栈：解析表达式，采用逐个读取字符的形式，如果是操作数就入操作数栈，需要注意的是，我们是逐个读取字符，也就意味着数字&#34;123&#34;将分3次读取(“1”,“2”,“3”)，所以需要一个追加器将字符缓存起来，当完整的读取了整个数值时在入操作数栈。运算符栈：如果是运算符就进行比较，优先级同级或低于栈顶运算符时，将触发一次二元运算，进行二元运算的为运算符栈的栈顶元素和操作数栈顶的两个元素，再把运算得到的结果入操作数栈。如果运算栈还有元素，这是一个递归操作，直到运算栈没有元素或者运算符的优先级高于栈顶元素，那么把运算符入运算符栈。继续读取表达式的下一个元素。
例如：”1&#43;2*3-4“。
如下图所示，(6)在读取&#34;-“时，优先级低于栈顶运算符”&#34;，触发二元运算，取出操作数栈顶元素&#34;3&#34;和&#34;2&#34;与运算符栈顶元素&#34;“进行一次二元运算&#34;2*3”=“6”，得到结果&#34;6&#34;，把运算出来的结果&#34;6&#34;入操作数栈(6.1所示)。栈顶还有元素，继续比较，栈顶元素”&#43;“和&#34;-“同级，再触发二元运算，取出操作数栈顶元素&#34;6&#34;和&#34;1&#34;与运算符栈顶元素”&#43;“进行一次二元运算&#34;1&#43;6”=“7”，得到结果&#34;7&#34;，把运算出来的结果&#34;7&#34;入操作数栈(6.2所示)。此时运算符栈没有元素，运算符&#34;-“入运算符栈(6.3所示)。读取下一个字符&#34;4”，表达式已读取完毕，此时进行二元运算，直到运算符栈没有运算符，此时操作栈唯一的元素就是最后表达式计算的结果&#34;3&#34;(8所示)。
括号运算：相当于子表达式运算，当读取表达式字符时，读取到&#34;(“左括号，将左括号入运算符栈，当读取到”)&#34;右括号时，将一直运算整个子表达式的二元运算，直到遇到左括号时停止，此时把子表达式的结果入操作数栈。加减乘除左括号右括号中左括号的优先级最低，右括号的优先级最高。
例如：“1&#43;2*(3&#43;4)”
代码实现 import java.math.BigDecimal; import java.util.HashMap; import java.util.Map; import java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/421bf5a327b3ee451506b8ef26083c09/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-04-18T12:44:52+08:00" />
<meta property="article:modified_time" content="2020-04-18T12:44:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java实现字符串表达式求值</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="_0"></a>需求说明</h3> 
<p>最近在用java写一个计算器，遇到了一个问题，获取用户输入的需要计算的表达式，因为是字符串的形式所以无法进行直接计算，所以需要写一些算法来对字符串表达式进行求值。</p> 
<h3><a id="_2"></a>实现</h3> 
<h4><a id="JS_3"></a>JS实现</h4> 
<p>相信大家应该都知道JavaScript，JavaScript里面有个函数eval()可以计算某个字符串，并执行其中的JavaScript代码。虽然JavaScript名字里面有个Java，但是JavaScript和Java没什么联系的，那我上面说的这些有什么用呢？<br> 在JDK1.6中，我们可以使用内置的JavaScript引擎，意味着我们可以使用JavavScript里面的eval()函数。</p> 
<pre><code class="prism language-java"><span class="token keyword">import</span> javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span>ScriptEngine<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span>ScriptEngineManager<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>script<span class="token punctuation">.</span>ScriptException<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">OperationJS</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> ScriptException <span class="token punctuation">{<!-- --></span>
        ScriptEngineManager mgr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScriptEngineManager</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ScriptEngine engine <span class="token operator">=</span> mgr<span class="token punctuation">.</span><span class="token function">getEngineByName</span><span class="token punctuation">(</span><span class="token string">"JavaScript"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        String foo <span class="token operator">=</span> <span class="token string">"(40+2)*2"</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>engine<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>使用这个要注意一个安全问题，执行的JavaScript可以访问所有Java类，因此可以无限制地劫持您的应用程序。<br> 例如下面这句代码，将通过JavaScript将文件写入（默认情况下）程序的当前目录</p> 
<pre><code class="prism language-java">engine<span class="token punctuation">.</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"var f = new java.io.FileWriter('hello.txt'); f.write('hello!'); f.close();"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>发现这个有点方便。秉着学习的原则，出现了实现二，用算法来解决。</p> 
<h4><a id="_26"></a>栈实现</h4> 
<h5><a id="_27"></a>基本分析</h5> 
<ul><li>表达式主要有括号和加减乘除四种基本运算。表达式可以看成是由一个个二元运算组成，前一个二元运算可以作为后一个二元运算的输入。<br> 例如：“1+2+3”，可以看成是两个二元运算组成(1+2)+3，前一个二元运算过后就变成3+3，这又是一个二元运算，最后结果为6。既然都是二元运算计算，我们就可以用同一段程序来解决，递归或循环。但是我们要注意加减乘除有优先级之分。</li><li>加减乘除四种运算符是有优先级的，乘法或除法同级，且比加法或减法优先级高。优先级的出现对程序的设计影响很大，例如：”1+2+3-4“=“3+3-4”=“6-4”=2，如果整个表达式都是同级的我们就可以直接从头一直运算到尾。但是因为有优先级的出现我们就不可以这样做，例如：“1+2*3-4”=“1+6-4”=“3”,我们需要先算在表达式中间的”2*3“，而不能从头的"1+2"开始算。优先级的出现让程序变的复杂了起来。</li><li>括号的处理，括号就相当于在表达式里面嵌套了一个子表达式，而子表达式的优先级比括号外的其他运算优先级高。</li></ul> 
<p>分析可得，表达式有两个基本元素，操作数和运算符。</p> 
<h5><a id="_35"></a>算法思想</h5> 
<ul><li>操作数栈：解析表达式，采用逐个读取字符的形式，如果是操作数就入操作数栈，需要注意的是，我们是逐个读取字符，也就意味着数字"123"将分3次读取(“1”,“2”,“3”)，所以需要一个追加器将字符缓存起来，当完整的读取了整个数值时在入操作数栈。</li><li>运算符栈：如果是运算符就进行比较，优先级同级或低于栈顶运算符时，将触发一次二元运算，进行二元运算的为运算符栈的栈顶元素和操作数栈顶的两个元素，再把运算得到的结果入操作数栈。如果运算栈还有元素，这是一个递归操作，直到运算栈没有元素或者运算符的优先级高于栈顶元素，那么把运算符入运算符栈。继续读取表达式的下一个元素。<br> 例如：”1+2*3-4“。<br> 如下图所示，(6)在读取"-“时，优先级低于栈顶运算符”<em>"，触发二元运算，取出操作数栈顶元素"3"和"2"与运算符栈顶元素"</em>“进行一次二元运算"2*3”=“6”，得到结果"6"，把运算出来的结果"6"入操作数栈(6.1所示)。栈顶还有元素，继续比较，栈顶元素”+“和"-“同级，再触发二元运算，取出操作数栈顶元素"6"和"1"与运算符栈顶元素”+“进行一次二元运算"1+6”=“7”，得到结果"7"，把运算出来的结果"7"入操作数栈(6.2所示)。此时运算符栈没有元素，运算符"-“入运算符栈(6.3所示)。读取下一个字符"4”，表达式已读取完毕，此时进行二元运算，直到运算符栈没有运算符，此时操作栈唯一的元素就是最后表达式计算的结果"3"(8所示)。<br> <img src="https://images2.imgbox.com/82/2f/H3azHa4n_o.png" alt="1+2*3-4"></li><li>括号运算：相当于子表达式运算，当读取表达式字符时，读取到"(“左括号，将左括号入运算符栈，当读取到”)"右括号时，将一直运算整个子表达式的二元运算，直到遇到左括号时停止，此时把子表达式的结果入操作数栈。加减乘除左括号右括号中左括号的优先级最低，右括号的优先级最高。<br> 例如：“1+2*(3+4)”<br> <img src="https://images2.imgbox.com/45/2f/pkJxeJ5u_o.png" alt="1+2*(3+4)"></li></ul> 
<h5><a id="_44"></a>代码实现</h5> 
<pre><code class="prism language-java"><span class="token keyword">import</span> java<span class="token punctuation">.</span>math<span class="token punctuation">.</span>BigDecimal<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>HashMap<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Map<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>Stack<span class="token punctuation">;</span>

<span class="token comment">/**
 * 对表达式求值，支持加减乘除括号小数点，不支持负数
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Operation</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//优先级Map</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> Map<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span>Integer<span class="token punctuation">&gt;</span></span> OP_PRIORITY_MAP<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">,</span> Integer<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"*"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">put</span><span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">double</span> <span class="token function">operationExpression</span><span class="token punctuation">(</span>String expression<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        Stack<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> opStack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token comment">//运算符栈</span>
        Stack<span class="token generics function"><span class="token punctuation">&lt;</span>BigDecimal<span class="token punctuation">&gt;</span></span> numStack <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Stack</span><span class="token generics function"><span class="token punctuation">&lt;</span>BigDecimal<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//操作数栈</span>
        StringBuilder numBuilder <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StringBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//当前数值的追加器</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>i <span class="token operator">&lt;</span> expression<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">char</span> c <span class="token operator">=</span> expression<span class="token punctuation">.</span><span class="token function">charAt</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>c <span class="token operator">&gt;=</span> <span class="token string">'0'</span> <span class="token operator">&amp;&amp;</span> c <span class="token operator">&lt;=</span> <span class="token string">'9'</span> <span class="token operator">||</span> c <span class="token operator">==</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>          <span class="token comment">//如果是数值则加入追加器</span>
                numBuilder<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>                                          <span class="token comment">//如果是运算符</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>numBuilder<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>               <span class="token comment">//如果numBuilder有值说明里面已经有一个数值</span>
                    numStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>numBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment">//把数值入运算符栈</span>
                    numBuilder<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>numBuilder<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//清空数值</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//读取到的字符是运算符</span>
                String op <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>opStack<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>    <span class="token comment">//如果操作数栈没有运算符</span>
                    opStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//如果是"("则直接入运算栈</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">"("</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        opStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">")"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//如果是")"则进行括号匹配运算括号内的表达式</span>
                        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token string">"("</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>opStack<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                            <span class="token function">stackOperation</span><span class="token punctuation">(</span>opStack<span class="token punctuation">,</span>numStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        opStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
                        <span class="token comment">//如果是运算符，需要对比当前运算符op和栈顶的运算符优先级。</span>
                        <span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token comment">//比较当前运算符和栈顶运算符的优先级,如果nowOp和opStack栈顶元素相同或者低级，</span>
                            <span class="token comment">// 则进行运算，直到nowOp高于opStack栈顶</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">jubgmentPriority</span><span class="token punctuation">(</span>op<span class="token punctuation">,</span>opStack<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                                <span class="token function">stackOperation</span><span class="token punctuation">(</span>opStack<span class="token punctuation">,</span>numStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">if</span> <span class="token punctuation">(</span>opStack<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                                    opStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                    <span class="token keyword">break</span><span class="token punctuation">;</span>
                                <span class="token punctuation">}</span>
                            <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                                opStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">;</span>
                                <span class="token keyword">break</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                        <span class="token punctuation">}</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>opStack<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//表达式结束，追加器里面有值</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>numBuilder<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            numStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span>numBuilder<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>opStack<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token function">stackOperation</span><span class="token punctuation">(</span>opStack<span class="token punctuation">,</span>numStack<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> numStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">doubleValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 进行一次二元运算
     * @param opStack
     * @param numStack
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">stackOperation</span><span class="token punctuation">(</span>Stack<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> opStack<span class="token punctuation">,</span>Stack<span class="token generics function"><span class="token punctuation">&lt;</span>BigDecimal<span class="token punctuation">&gt;</span></span> numStack<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        String opT <span class="token operator">=</span> opStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>              <span class="token comment">//栈顶运算符</span>
        BigDecimal num2 <span class="token operator">=</span> numStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//第二个操作数</span>
        BigDecimal num1 <span class="token operator">=</span> numStack<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">//第一个操作数</span>
        BigDecimal operationNum <span class="token operator">=</span> <span class="token function">oneOperation</span><span class="token punctuation">(</span>opT<span class="token punctuation">,</span>num1<span class="token punctuation">,</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">//num1 op num2</span>

        numStack<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>operationNum<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment">//把计算完的结果放入操作数栈</span>
    <span class="token punctuation">}</span>


<span class="token comment">//</span>

    <span class="token comment">/**
     * 单次计算，计算为num1 op num2
     * @param op    运算符
     * @param num1  第一个操作数
     * @param num2  第二个操作数
     * @return  num1 op num2
     */</span>
    <span class="token keyword">public</span> BigDecimal <span class="token function">oneOperation</span><span class="token punctuation">(</span>String op<span class="token punctuation">,</span>BigDecimal num1<span class="token punctuation">,</span>BigDecimal num2<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        BigDecimal result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigDecimal</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>op<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">case</span> <span class="token string">"+"</span><span class="token operator">:</span>
                result <span class="token operator">=</span> num1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"-"</span><span class="token operator">:</span>
                result <span class="token operator">=</span> num1<span class="token punctuation">.</span><span class="token function">subtract</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"*"</span><span class="token operator">:</span>
                result <span class="token operator">=</span> num1<span class="token punctuation">.</span><span class="token function">multiply</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token string">"/"</span><span class="token operator">:</span>
                result <span class="token operator">=</span> num1<span class="token punctuation">.</span><span class="token function">divide</span><span class="token punctuation">(</span>num2<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">/**
     * 比较运算符优先级
     * @param op1
     * @param op2
     * @return op1比op2相同或低级则返回true，op1比op2高级则返回false
     */</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">jubgmentPriority</span><span class="token punctuation">(</span>String op1<span class="token punctuation">,</span> String op2<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>OP_PRIORITY_MAP<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>op1<span class="token punctuation">)</span> <span class="token operator">-</span> OP_PRIORITY_MAP<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>op2<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Operation operation <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Operation</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>operation<span class="token punctuation">.</span><span class="token function">operationExpression</span><span class="token punctuation">(</span><span class="token string">"(2+2)*3+3+3/3+2.2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/57c682aa6590a08b1d80d5d3139d4851/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">DPDK技术介绍（一）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2e1676a5faaadff7f3a96671112db703/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Springboot2 session设置超时时间无效</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>