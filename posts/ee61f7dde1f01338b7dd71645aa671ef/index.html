<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python操作mysql数据库 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python操作mysql数据库" />
<meta property="og:description" content="一、数据库分类
关系型数据库：采用了关系模型来组织数据的数据库，如MySQL、PostgreSQL、Oracle数据库。
非关系型数据库：以键值对存储，且结构不固定，可以减少一些时间和空间的开销，如MongoDB、Redis。
二、Python操作MySQL环境安装
1、Docker部署MySQL：
1)创建数据库目录(略)
mkdir -p /opt/mysql/data 2)创建并运行MySQL容器
# -d 守护进程后台运行# -v 目录映射——挂载;作用是为了持久化# -e 环境变量# root用户密码设置为hl# -p 映射端口 端口默认3306# root账号的密码为hldocker run -d --name mysql -v /opt/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=hl -p 3306:3306 registry.cn-hangzhou.aliyuncs.com/sqqdcl/waimai-db 如果你想学习接口自动化测试，我这边给你推荐一套视频，这个视频可以说是B站播放全网第一的接口自动化测试教程，同时在线人数到达1000人，并且还有笔记可以领取及各路大神技术交流：798478386 https://www.bilibili.com/video/BV17p4y1B77x/?spm_id_from=333.337.search-card.all.clickhttps://www.bilibili.com/video/BV17p4y1B77x/?spm_id_from=333.337.search-card.all.click
2、安装pymysql库
#python访问MySQL，需要安装pymysql库pip install pymysql 3、Navicat配置连接数据库
三、Python操作MySQL
Python操作数据库的过程：创建连接-&gt;获取游标-&gt;执行命令-&gt;关闭游标-&gt;关闭连接
1、创建连接，连接数据库的参数按照实际情况添加
​​
import pymysql #定义一个函数，用来创建连接数据库 def mysql_db(): con = pymysql.connect( host=&#39;192.168.223.130&#39;, port=3306, database=&#39;mysql&#39;, charset=&#39;utf8&#39;, user=&#39;root&#39;, password=&#39;hl&#39; ) if __name__ == &#39;__main__&#39;: mysql_db() 2、获取游标，执行Sql，查询操作
import pymysql #定义一个函数，用来操作数据库 def mysql_db(): con = pymysql." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ee61f7dde1f01338b7dd71645aa671ef/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-27T20:56:49+08:00" />
<meta property="article:modified_time" content="2023-06-27T20:56:49+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python操作mysql数据库</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>一、数据库分类</p> 
<p>关系型数据库：采用了关系模型来组织数据的数据库，如MySQL、PostgreSQL、Oracle数据库。</p> 
<p>非关系型数据库：以键值对存储，且结构不固定，可以减少一些时间和空间的开销，如MongoDB、Redis。</p> 
<p>二、Python操作MySQL环境安装</p> 
<p>1、Docker部署MySQL：</p> 
<p>1)创建数据库目录(略)</p> 
<pre><code>mkdir -p /opt/mysql/data</code></pre> 
<p>2)创建并运行MySQL容器</p> 
<pre><code># -d 守护进程后台运行</code><code># -v 目录映射——挂载;作用是为了持久化</code><code># -e 环境变量</code><code># root用户密码设置为hl</code><code># -p 映射端口 端口默认3306</code><code># root账号的密码为hl</code><code>docker run -d --name mysql -v /opt/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=hl -p 3306:3306 registry.cn-hangzhou.aliyuncs.com/sqqdcl/waimai-db</code></pre> 
<p><strong>如果你想学习接口自动化测试，我这边给你推荐一套视频，这个视频可以说是B站播放全网第一的接口自动化测试教程，同时在线人数到达1000人，并且还有笔记可以领取及各路大神技术交流：798478386</strong>    </p> 
<p><a class="has-card" href="https://www.bilibili.com/video/BV17p4y1B77x/?spm_id_from=333.337.search-card.all.click" rel="nofollow" title="https://www.bilibili.com/video/BV17p4y1B77x/?spm_id_from=333.337.search-card.all.click"><span class="link-card-box"><span class="link-title">https://www.bilibili.com/video/BV17p4y1B77x/?spm_id_from=333.337.search-card.all.click</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/5b/44/HTidU2Sv_o.png" alt="icon-default.png?t=N5K3">https://www.bilibili.com/video/BV17p4y1B77x/?spm_id_from=333.337.search-card.all.click</span></span></a></p> 
<p>2、安装pymysql库</p> 
<pre><code>#python访问MySQL，需要安装pymysql库</code><code>pip install pymysql</code></pre> 
<p>3、Navicat配置连接数据库</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/a5/04/dlIeKHfj_o.png"></p> 
<p>三、Python操作MySQL</p> 
<p>Python操作数据库的过程：创建连接-&gt;获取游标-&gt;执行命令-&gt;关闭游标-&gt;关闭连接</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/18/ec/1hM7pENx_o.png"></p> 
<p></p> 
<p>1、创建连接，连接数据库的参数按照实际情况添加</p> 
<p>​​</p> 
<pre><code class="language-python">import pymysql

#定义一个函数，用来创建连接数据库
def mysql_db():
    con = pymysql.connect(
        host='192.168.223.130',
        port=3306,
        database='mysql',
        charset='utf8',
        user='root',
        password='hl'
    )

if __name__ == '__main__':
    mysql_db()</code></pre> 
<p>2、获取游标，执行Sql，查询操作</p> 
<pre><code class="language-python">
import pymysql

#定义一个函数，用来操作数据库
def mysql_db():
    con = pymysql.connect(
        host='192.168.223.130',
        port=3306,
        database='mysql',
        charset='utf8',
        user='root',
        password='hl'
    )
    try:
        with con.cursor() as cursor:
            #一、查询
            sql = "select * from tables_priv;"
            #执行SQL语句
            #执行后的结果都保存在cursor中
            cursor.execute(sql)

            #1-从cursor中获取全部数据用fetchall
            # datas = cursor.fetchall()
            # print("获取的数据：\n",datas)

            #2-从cursor中获取一条数据用fetchall
            # data = cursor.fetchone()
            # print("获取的数据：\n",data)

            #3-想要从cursor中获取几条数据用fetchmany
            datas = cursor.fetchmany(3)
            print("获取的数据：\n",datas)
    except Exception as e:
        print("数据库异常：\n",e)
    finally:
        #不管成功还是失败，都要关闭数据库连接
        con.close()

if __name__ == '__main__':
    mysql_db()</code></pre> 
<p>2.1、fetchall：获取当前SQL语句能查出来的全部数据，元组套元组；</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/bd/90/0uOJVfmX_o.png"></p> 
<p>2.2、fetchone：每次获取一条数据。但是获取到这条数据后，指针会往后移一行数据，返回一个元组；</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b0/82/DYInOnRp_o.png"></p> 
<p>2.3、fetchmany：直接告诉它想要多少条数据。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/04/16/kRRhjQ9D_o.png"></p> 
<p>3、插入数据操作</p> 
<p>3.1、插入一条数据</p> 
<p>说明：除了查询，其他操作都需要commit；commit对应rollback，回滚到上次提交的地方。​​​​​​​</p> 
<pre><code class="language-python">import pymysql

#定义一个函数，用来操作数据库
def mysql_db():
    con = pymysql.connect(
        host='192.168.223.130',
        port=3306,
        database='mysql',
        charset='utf8',
        user='root',
        password='hl'
    )
    try:
        with con.cursor() as cursor:
            # 二、插入
            #1-插入一条数据
            sql = "insert into help_category(help_category_id, name, parent_category_id, url)value(900,'hl-test01',0,'');"
            #执行SQL语句
            cursor.execute(sql)
            #执行玩SQL语句要提交
            con.commit()
            print("提交成功")

    except Exception as e:
        # 如果执行失败要回滚
        con.rollback()
        print("数据库异常：\n",e)
    finally:
        #不管成功还是失败，都要关闭数据库连接
        con.close()

if __name__ == '__main__':
    mysql_db()</code></pre> 
<p>插入结果如下：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/c3/2a/oyKqxiNO_o.png"></p> 
<p>3.2、插入多条数据​​​​​​​</p> 
<pre><code class="language-python"> try:
        with con.cursor() as cursor:
            # 二、插入
            #1-插入一条数据
            # sql = "insert into help_category(help_category_id, name, parent_category_id, url)values(900,'hl-test01',0,'');"

            # 2-插入多条数据
            value = "(901,'hl-test02',0,''),(902,'hl-test03',0,''),(903,'hl-test04',0,'')"
            # sql = f"insert into help_category(help_category_id, name, parent_category_id, url) values {value};"
            sql = f"insert into help_category values {value};"
            #执行SQL语句
            cursor.execute(sql)
            #执行玩SQL语句要提交
            con.commit()
            print("提交成功")

    except Exception as e:
        # 如果执行失败要回滚
        con.rollback()
        print("数据库异常：\n",e)
    finally:
        #不管成功还是失败，都要关闭数据库连接
        con.close()</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/71/a6/jQBf48mU_o.png"></p> 
<p>4、更新数据</p> 
<pre><code class="language-python">
    try:
        with con.cursor() as cursor:
            #三、更新
            sql = f"update help_category set name='HL-Update' where help_category_id=900;"
           #执行SQL语句
            cursor.execute(sql)
            #执行完SQL语句要提交
            con.commit()
            print("提交成功")

    except Exception as e:
        # 如果执行失败要回滚
        con.rollback()
        print("数据库异常：\n",e)
    finally:
        #不管成功还是失败，都要关闭数据库连接
        con.close()
</code></pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/cb/80/3J4EZsvg_o.png"></p> 
<p>5、删除数据</p> 
<pre><code class="language-python">
import pymysql

#定义一个函数，用来操作数据库
def mysql_db():
    con = pymysql.connect(
        host='192.168.223.130',
        port=3306,
        database='mysql',
        charset='utf8',
        user='root',
        password='hl'
    )
    try:
        with con.cursor() as cursor:
            #一、查询
            # sql = "select * from tables_priv;"
            #执行SQL语句
            #执行后的结果都保存在cursor中
            # cursor.execute(sql)

            #1-从cursor中获取全部数据用fetchall
            # datas = cursor.fetchall()
            # print("获取的数据：\n",datas)

            #2-从cursor中获取一条数据用fetchall
            # data = cursor.fetchone()
            # print("获取的数据：\n",data)

            #3-想要从cursor中获取几条数据用fetchmany
            # datas = cursor.fetchmany(1)
            # print("获取的数据：\n",datas)

            # 二、插入
            #1-插入一条数据
            # sql = "insert into help_category(help_category_id, name, parent_category_id, url)values(900,'hl-test01',0,'');"

            # 2-插入多条数据
            # value = "(901,'hl-test02',0,''),(902,'hl-test03',0,''),(903,'hl-test04',0,'')"
            # sql = f"insert into help_category values {value};"

            #三、更新
            # sql = f"update help_category set name='HL-Update' where help_category_id=900;"

            #四、删除
            sql = "delete from help_category where help_category_id like '90%';"
            #执行SQL语句
            cursor.execute(sql)
            #执行完SQL语句要提交
            con.commit()
            print("提交成功")
    except Exception as e:
        # 如果执行失败要回滚
        con.rollback()
        print("数据库异常：\n",e)
    finally:
        #不管成功还是失败，都要关闭数据库连接
        con.close()

if __name__ == '__main__':
    mysql_db()</code></pre> 
<p></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/04/66/3LpW4rqr_o.png"></p> 
<p><strong>四、Python封装mysql数据库</strong></p> 
<p>1、将连接数据的参数写入mysqlConfig.py</p> 
<pre><code class="language-python">class MysqlConfig:
    HOST = '192.168.223.130'
    PORT = 3306
    USER = 'root'
    PASSWORD = 'hl'
    DB = 'mysql'
    CHARSET = 'utf8'</code></pre> 
<p>2、封装数据库的增删改查操作</p> 
<pre><code class="language-python">
import pymysql
from mysqlConfig import MysqlConfig

class MysqlConnection:
    def __init__(self,host=MysqlConfig.HOST,
                port=MysqlConfig.PORT,
                user=MysqlConfig.USER,
                pwd=MysqlConfig.PASSWORD,
                db=MysqlConfig.DB):
        self.db = pymysql.connect(host=host,
                                  port=port,
                                  user=user,
                                  password=pwd,
                                  database=db,
                                  charset=MysqlConfig.CHARSET)#创建连接
        self.cursor = self.db.cursor()#创建游标

    #查询方法
    def query(self,sql,many=True):
        try:
            self.cursor.execute(sql)#执行SQL语句
            if many:
                res = self.cursor.fetchall()
            else:
                res = self.cursor.fetchone()
            return res
        except Exception as e:
            raise e#打印日志
    #增删改方法
    def __do(self,sql):
        try:
            self.cursor.execute(sql)#执行SQL语句
        except Exception as e:
            self.db.rollback()#如果执行失败要回滚
            #打日志
            raise e
        else:
            self.db.commit()#提交

    def update(self,sql):
        self.__do(sql)

    def insert(self,sql):
        self.__do(sql)

    def delete(self,sql):
        self.__do(sql)

    def exit(self):
        self.cursor.close()#关闭游标
        self.db.close()#关闭数据库

if __name__ == '__main__':
    db = MysqlConnection()
    res = db.query('select * from tables_priv;')
    print(res)
    db.exit()</code></pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/07/19/xqpZ5UHC_o.png"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fca8b9599e25cf293970de8d08ad56a3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">spark外置external shuffle service使用介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2957564e3ab8311f2ebaff04631833ca/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JS数组常用方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>