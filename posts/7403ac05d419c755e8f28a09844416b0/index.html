<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>centos7 生成ssl证书，搭建https地址 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="centos7 生成ssl证书，搭建https地址" />
<meta property="og:description" content="一、HTTPS简介
1.https简介
HTTPS其实是有两部分组成：HTTP &#43; SSL / TLS，也就是在HTTP上又加了一层处理加密信息的模块。服务端和客户端的信息传输都会通过TLS进行加密，所以传输的数据都是加密后的数据
2.https协议原理
首先，客户端与服务器建立连接，各自生成私钥和公钥，是不同的。服务器返给客户端一个公钥，然后客户端拿着这个公钥把要搜索的东西加密，称之为密文，并连并自己的公钥一起返回给服务器，服务器拿着自己的私钥解密密文，然后把响应到的数据用客户端的公钥加密，返回给客户端，客户端拿着自己的私钥解密密文，把数据呈现出来
二、证书和私钥的生成
注意：一般生成的目录,应该放在nginx/conf/ssl目录
1.创建服务器证书密钥文件 server.key：
openssl genrsa -des3 -out server.key 1024
输入密码，确认密码，自己随便定义，但是要记住，后面会用到。
2.创建服务器证书的申请文件 server.csr
openssl req -new -key server.key -out server.csr
输出内容为：
Enter pass phrase for root.key: ← 输入前面创建的密码
Country Name (2 letter code) [AU]:CN ← 国家代号，中国输入CN
State or Province Name (full name) [Some-State]:BeiJing ← 省的全名，拼音
Locality Name (eg, city) []:BeiJing ← 市的全名，拼音
Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7403ac05d419c755e8f28a09844416b0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-14T17:36:33+08:00" />
<meta property="article:modified_time" content="2019-06-14T17:36:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">centos7 生成ssl证书，搭建https地址</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>一、HTTPS简介</strong><br> 1.https简介<br> HTTPS其实是有两部分组成：HTTP + SSL / TLS，也就是在HTTP上又加了一层处理加密信息的模块。服务端和客户端的信息传输都会通过TLS进行加密，所以传输的数据都是加密后的数据<br> 2.https协议原理<br> 首先，客户端与服务器建立连接，各自生成私钥和公钥，是不同的。服务器返给客户端一个公钥，然后客户端拿着这个公钥把要搜索的东西加密，称之为密文，并连并自己的公钥一起返回给服务器，服务器拿着自己的私钥解密密文，然后把响应到的数据用客户端的公钥加密，返回给客户端，客户端拿着自己的私钥解密密文，把数据呈现出来</p> 
<p><strong>二、证书和私钥的生成</strong><br> 注意：一般生成的目录,应该放在nginx/conf/ssl目录<br> 1.创建服务器证书密钥文件 server.key：<br> openssl genrsa -des3 -out server.key 1024<br> 输入密码，确认密码，自己随便定义，但是要记住，后面会用到。<br> 2.创建服务器证书的申请文件 server.csr<br> openssl req -new -key server.key -out server.csr<br> 输出内容为：<br> Enter pass phrase for root.key: ← 输入前面创建的密码<br> Country Name (2 letter code) [AU]:CN ← 国家代号，中国输入CN<br> State or Province Name (full name) [Some-State]:BeiJing ← 省的全名，拼音<br> Locality Name (eg, city) []:BeiJing ← 市的全名，拼音<br> Organization Name (eg, company) [Internet Widgits Pty Ltd]:MyCompany Corp. ← 公司英文名<br> Organizational Unit Name (eg, section) []: ← 可以不输入<br> Common Name (eg, YOUR name) []: ← 此时不输入<br> Email Address []:admin@mycompany.com ← 电子邮箱，可随意填<br> Please enter the following ‘extra’ attributes<br> to be sent with your certificate request<br> A challenge password []: ← 可以不输入<br> An optional company name []: ← 可以不输入<br> 4.备份一份服务器密钥文件<br> cp server.key <a href="http://server.key.org" rel="nofollow">server.key.org</a><br> 5.去除文件口令<br> openssl rsa -in <a href="http://server.key.org" rel="nofollow">server.key.org</a> -out server.key<br> 6.生成证书文件server.crt<br> openssl x509 -req -days 365 -in server.csr -signkey server.key -out server.crt</p> 
<p><strong>三、配置文件</strong><br> server{<!-- --><br> #比起默认的80 使用了443 默认 是ssl方式 多出default之后的ssl<br> listen 443 default ssl;<br> #default 可省略<br> #开启 如果把ssl on；这行去掉，ssl写在443端口后面。这样http和https的链接都可以用<br> ssl on;<br> #证书(公钥.发送到客户端的)<br> ssl_certificate ssl/server.crt;<br> #私钥,<br> ssl_certificate_key ssl/server.key;<br> #下面是绑定域名<br> server_name <a href="http://www.daj.com" rel="nofollow">www.daj.com</a>;<br> }</p> 
<p>四、开启nginx的ssl模块</p> 
<p>1.the “ssl” parameter requires ngx_http_ssl_module in /usr/local/nginx/conf/nginx.conf:37<br> <img src="https://images2.imgbox.com/e5/43/lQDYJcqY_o.png" alt="在这里插入图片描述"><br> 原因是nginx缺少http_ssl_module模块，编译安装时带上–with-http_ssl_module配置就可以了<br> 2.如果已经安装过nginx,想要添加模块看下面<br> 1)切换到nginx源码包<br> cd /usr/local/src/nginx-1.11.3<br> 2)查看ngixn原有的模块<br> /usr/local/nginx/sbin/nginx -V<br> 3)重新配置<br> ./configure --prefix=/usr/local/nginx --with-http_stub_status_module --with-http_ssl_module<br> 4)重新编译，不需要make install安装。否则会覆盖<br> make<br> 5)备份原有已经安装好的nginx<br> cp /usr/local/nginx/sbin/nginx /usr/local/nginx/sbin/nginx.bak<br> 6)将刚刚编译好的nginx覆盖掉原来的nginx(ngixn必须停止)<br> cp ./objs/nginx /usr/local/nginx/sbin/<br> 这时，会提示是否覆盖，请输入yes，直接回车默认不覆盖<br> 7)启动nginx，查看nginx模块，发现已经添加<br> /usr/local/nginx/sbin/nginx -V　<br> <img src="https://images2.imgbox.com/c4/76/UEUhlhkH_o.png" alt="在这里插入图片描述"></p> 
<p>成功访问<br> <img src="https://images2.imgbox.com/87/78/MROQ7o05_o.png" alt="在这里插入图片描述"></p> 
<p><strong>五、强制 用户用https访问</strong><br> conf结尾加</p> 
<pre><code>server {
        listen 80;
        server_name localhost_tp.com;//注意改为自己的域名
        rewrite ^(.*)$  https://$host$1 permanent;
}
</code></pre> 
<p><img src="https://images2.imgbox.com/09/07/2I1829if_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4f7c33ad82b4a14f1ba15a8461e42dda/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mongodb报错：E QUERY [thread1] SyntaxError: missing ; before statement @(shell):1:4</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/00fb3f943c6e0e214446c9e3bac0c4f1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">shell中grep的用法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>