<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>NPOI.HSSF 导入excel数据(记录) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="NPOI.HSSF 导入excel数据(记录)" />
<meta property="og:description" content="https://download.csdn.net/download/ttbat/15435334 NPOI.HSSF.Dll 下载地址。
在项目引用 NPOI.HSSF.Dll 后 using NPOI.HSSF.UserModel;
PS：excel文件只能读取1997-2003版本的，2007以上的excel版本无法读取。
/// &lt;summary&gt; /// /// &lt;/summary&gt; /// &lt;param name=&#34;path&#34;&gt;文件地址&lt;/param&gt; /// &lt;param name=&#34;_syptktService&#34;&gt;&lt;/param&gt; /// &lt;param name=&#34;success&#34;&gt;成功数量&lt;/param&gt; /// &lt;param name=&#34;failure&#34;&gt;错误数量&lt;/param&gt; /// &lt;returns&gt;&lt;/returns&gt; public static string ImprotSXSC(string path, ISYPTKTService _syptktService, out int success, out int failure) { string errorMsg = string.Empty; success = failure = 0; try { HSSFWorkbook hssfworkbook; using (FileStream file = new FileStream(path, FileMode.Open, FileAccess.Read)) { #region 检查excel数据 hssfworkbook = new HSSFWorkbook(file); HSSFSheet sheet = hssfworkbook." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/af7fb9237f17d7b9b60e52e5714b93c6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-02-23T15:03:24+08:00" />
<meta property="article:modified_time" content="2021-02-23T15:03:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">NPOI.HSSF 导入excel数据(记录)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><a href="https://download.csdn.net/download/ttbat/15435334">https://download.csdn.net/download/ttbat/15435334</a>  NPOI.HSSF.Dll 下载地址。</p> 
<p>在项目引用 NPOI.HSSF.Dll 后 using NPOI.HSSF.UserModel;</p> 
<p>PS：excel文件只能读取1997-2003版本的，2007以上的excel版本无法读取。</p> 
<pre><code class="language-cs">        /// &lt;summary&gt;
        /// 
        /// &lt;/summary&gt;
        /// &lt;param name="path"&gt;文件地址&lt;/param&gt;
        /// &lt;param name="_syptktService"&gt;&lt;/param&gt;
        /// &lt;param name="success"&gt;成功数量&lt;/param&gt;
        /// &lt;param name="failure"&gt;错误数量&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
public static string ImprotSXSC(string path, ISYPTKTService _syptktService, out int success, out int failure)
        {
            string errorMsg = string.Empty;
            success = failure = 0;
            try
            {
                HSSFWorkbook hssfworkbook;
                using (FileStream file = new FileStream(path, FileMode.Open, FileAccess.Read))
                {
                    #region 检查excel数据
                    hssfworkbook = new HSSFWorkbook(file);
                    HSSFSheet sheet = hssfworkbook.GetSheetAt(0);
                    if (sheet == null || sheet.LastRowNum &lt; 0)
                    {
                        errorMsg = "excel格式异常，请检查";
                        return errorMsg;
                    }
                    Dictionary&lt;string, int&gt; headCellDic = GetCellDictNum(sheet, 0); //表头键与索引集合
                    errorMsg = CheckExcel(sheet);
                    if (!string.IsNullOrEmpty(errorMsg))
                        return errorMsg;
                    #endregion
                    HSSFRow row = null;
                    HSSFCell cell;
                    string rowMsg;
                    int startRowIndex = 1;
                    for (int i = startRowIndex; i &lt;= sheet.LastRowNum; i++)
                    {                        
                        row = sheet.GetRow(i);
                        cell = row.GetCell(headCellDic["A"]);
                        string name = getCellStringValue(row, cell, "A", out rowMsg);
                        var model = _syptktService.GetSxScxts(s =&gt; s.NAME.Contains(name)).FirstOrDefault();
                        bool isnew = false;int failure1 = 0;
                        if (model == null)
                        {
                            model = new SXSCXTEntiry();
                            isnew = true;
                        }
                        model.NAME = name;
                        cell = row.GetCell(headCellDic["B"]);
                        string X = getCellStringValue(row, cell, "B", out rowMsg);
                        cell = row.GetCell(headCellDic["C"]);
                        string Y = getCellStringValue(row, cell, "C", out rowMsg);
                        float x = CommonMethodNew.FromDFM(X);
                        float y = CommonMethodNew.FromDFM(Y);
                        model.X = X;
                        model.Y = Y;
                        if (X != "" &amp;&amp; Y != "" &amp;&amp; x &gt;= 3 &amp;&amp; y &gt;= 2)
                        {
                            model.SHAPE = "POINT ( " + x + " " + y + ")";
                        }
                        if (string.IsNullOrEmpty(name))
                        {
                            failure1++;
                             errorMsg += string.Format("第{0}行水下生产系统名称未录入$", i);
                        }
                        if (string.IsNullOrEmpty(model.SHAPE))
                        {
                            failure1++;
                            errorMsg += string.Format("{0}水下生产系统经纬度数据不正确$", name);                           
                        }
                        if (failure1 &gt; 0)
                        { failure++; continue; }
                    }
                }
            }
            catch (Exception ex)
            {
                failure++;
                errorMsg = ex.ToString();
            }
            return errorMsg;
        }
        /// &lt;summary&gt;
        /// 获取excel指定行中，列键值（键/索引）集合
        /// &lt;/summary&gt;
        /// &lt;param name="sheet"&gt;&lt;/param&gt;
        /// &lt;param name="rowIndex"&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static Dictionary&lt;string, int&gt; GetCellDictNum(HSSFSheet sheet,int rowIndex)
        {

            Dictionary&lt;string, int&gt; celldict = new Dictionary&lt;string, int&gt;();
            HSSFRow frow = sheet.GetRow(rowIndex);
            int colNum = frow.PhysicalNumberOfCells;
            char A = 'A';
            int Acode = (int)A;

            int firA = 0;
            String sfir = "";
            String stow = "";

            for (int i = 0; i &lt; colNum; i++)
            {
                if (i &lt; 26)
                {
                    celldict.Add(((char)(Acode + i)).ToString(), i);
                }
                else if (i &gt;= 26 &amp;&amp; i &lt;= (26 * 26))
                {
                    firA = i / 26;
                    sfir = ((char)(Acode + firA - 1)).ToString();
                    firA = i % 26;
                    stow = ((char)(Acode + firA)).ToString();
                    celldict.Add(sfir + stow, i);
                }
            }
            return celldict;
        }
        /// &lt;summary&gt;
        /// 获取文本格式
        /// &lt;/summary&gt;
        /// &lt;param name="row"&gt;&lt;/param&gt;
        /// &lt;param name="cell"&gt;&lt;/param&gt;
        /// &lt;param name="cellKey"&gt;&lt;/param&gt;
        /// &lt;param name="errorMsg"&gt;&lt;/param&gt;
        /// &lt;returns&gt;&lt;/returns&gt;
        public static string getCellStringValue(HSSFRow row, HSSFCell cell, string cellKey, out string errorMsg)
        {
            errorMsg = string.Empty;
            string value = null;
            if (cell == null)
            {
                return null;
            }
            if (cell.CellType == HSSFCell.CELL_TYPE_NUMERIC)
                value= cell.NumericCellValue.ToString();
            else if (cell.CellType == HSSFCell.CELL_TYPE_STRING)
                value= cell.StringCellValue;
            else
            {
                try
                {
                    value = cell.StringCellValue;
                }
                catch (Exception ex)
                {
                    errorMsg = string.Format("文档第" + (row.RowNum + 1) + "行," + cellKey + "列格式不正确");
                }
            }
            if(!string.IsNullOrEmpty(value))value = value.Trim().Replace("\n", "").Replace(" ", "").Replace("\t", "").Replace("\r", ""); ;
            return value;
        }</code></pre> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/70e7a87de85fcadfd05ce2a1408978e6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">单相机标定</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/054fe8e6011192c82c406fef5ea91762/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">java变量圆_（4）根据下面的要求实现圆类Circle.Java① 圆类Circle的成员变量：radius表示圆的半径.　② 圆类Circle的方法成员：　　　Circle（）：构造方法,将半径置...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>