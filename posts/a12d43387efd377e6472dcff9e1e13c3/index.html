<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLO V5ï¼ˆ6.0ï¼‰æ·»åŠ CBAMã€SENetã€CAæ³¨æ„åŠ›æœºåˆ¶æ‰‹æŠŠæ‰‹æ•™ç¨‹ - ITå­¦ä¹ è€…åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="YOLO V5ï¼ˆ6.0ï¼‰æ·»åŠ CBAMã€SENetã€CAæ³¨æ„åŠ›æœºåˆ¶æ‰‹æŠŠæ‰‹æ•™ç¨‹" />
<meta property="og:description" content="1.æ·»åŠ CBAM
1)ä¿®æ”¹commom.py
åœ¨ä»£ç æœ€åæ·»åŠ 
#CBAM class ChannelAttention(nn.Module): def __init__(self, in_planes, ratio=16): super(ChannelAttention, self).__init__() self.avg_pool = nn.AdaptiveAvgPool2d(1) self.max_pool = nn.AdaptiveMaxPool2d(1) # in_planes // ratio è¿™é‡Œä¼šå‡ºç°å¦‚ä¸‹è­¦å‘Šï¼š # UserWarning: __floordiv__ is deprecated(è¢«èˆå¼ƒäº†), and its behavior will change in a future version of pytorch. # It currently rounds toward 0 (like the &#39;trunc&#39; function NOT &#39;floor&#39;). # This results in incorrect rounding for negative values. # To keep the current behavior, use torch.div(a, b, rounding_mode=&#39;trunc&#39;), # or for actual floor division, use torch." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a12d43387efd377e6472dcff9e1e13c3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-26T10:08:59+08:00" />
<meta property="article:modified_time" content="2023-05-26T10:08:59+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ITå­¦ä¹ è€…åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ITå­¦ä¹ è€…åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLO V5ï¼ˆ6.0ï¼‰æ·»åŠ CBAMã€SENetã€CAæ³¨æ„åŠ›æœºåˆ¶æ‰‹æŠŠæ‰‹æ•™ç¨‹</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>1.æ·»åŠ CBAM</p> 
<p>1)ä¿®æ”¹commom.py</p> 
<p>åœ¨ä»£ç æœ€åæ·»åŠ </p> 
<pre><code class="language-python">#CBAM
class ChannelAttention(nn.Module):
    def __init__(self, in_planes, ratio=16):
        super(ChannelAttention, self).__init__()
        self.avg_pool = nn.AdaptiveAvgPool2d(1)
        self.max_pool = nn.AdaptiveMaxPool2d(1)
        # in_planes // ratio è¿™é‡Œä¼šå‡ºç°å¦‚ä¸‹è­¦å‘Šï¼š
        # UserWarning: __floordiv__ is deprecated(è¢«èˆå¼ƒäº†), and its behavior will change in a future version of pytorch.
        # It currently rounds toward 0 (like the 'trunc' function NOT 'floor').
        # This results in incorrect rounding for negative values.
        # To keep the current behavior, use torch.div(a, b, rounding_mode='trunc'),
        # or for actual floor division, use torch.div(a, b, rounding_mode='floor').
        # kernel = torch.DoubleTensor([*(x[0].shape[2:])]) // torch.DoubleTensor(list((m.output_size,))).squeeze()
        self.f1 = nn.Conv2d(in_planes, in_planes // ratio, 1, bias=False)
        self.relu = nn.ReLU()
        self.f2 = nn.Conv2d(in_planes // ratio, in_planes, 1, bias=False)
     

        self.sigmoid = nn.Sigmoid()

    def forward(self, x):
        # å…¨å±€å¹³å‡æ± åŒ–â€”&gt;MLPä¸¤å±‚å·ç§¯
        avg_out = self.f2(self.relu(self.f1(self.avg_pool(x))))
        # å…¨å±€æœ€å¤§æ± åŒ–â€”&gt;MLPä¸¤å±‚å·ç§¯
        max_out = self.f2(self.relu(self.f1(self.max_pool(x))))
        out = self.sigmoid(avg_out + max_out)
        return out


class SpatialAttention(nn.Module):
    def __init__(self, kernel_size=7):
        super(SpatialAttention, self).__init__()

        assert kernel_size in (3, 7), 'kernel size must be 3 or 7'
        padding = 3 if kernel_size == 7 else 1

        self.conv = nn.Conv2d(2, 1, kernel_size, padding=padding, bias=False)
        self.sigmoid = nn.Sigmoid()

    def forward(self, x):
        # åŸºäºchannelçš„å…¨å±€å¹³å‡æ± åŒ–(channel=1)
        avg_out = torch.mean(x, dim=1, keepdim=True)
        # åŸºäºchannelçš„å…¨å±€æœ€å¤§æ± åŒ–(channel=1)
        max_out, _ = torch.max(x, dim=1, keepdim=True)
        # channelæ‹¼æ¥(channel=2)
        x = torch.cat([avg_out, max_out], dim=1)
        # channel=1
        x = self.conv(x)
        return self.sigmoid(x)

    
class CBAMBottleneck(nn.Module):
    # ch_in, ch_out, shortcut, groups, expansion, ratio, kernel_size
    def __init__(self, c1, c2, shortcut=True, g=1, e=0.5, ratio=16, kernel_size=7):
        super(CBAMBottleneck, self).__init__()
        c_ = int(c2 * e)  # hidden channels
        self.cv1 = Conv(c1, c_, 1, 1)
        self.cv2 = Conv(c_, c2, 3, 1, g=g)
        self.add = shortcut and c1 == c2
        # åŠ å…¥CBAMæ¨¡å—
        self.channel_attention = ChannelAttention(c2, ratio)
        self.spatial_attention = SpatialAttention(kernel_size)
    
    def forward(self, x):
        # è€ƒè™‘åŠ å…¥CBAMæ¨¡å—çš„ä½ç½®ï¼šbottleneckæ¨¡å—åˆšå¼€å§‹æ—¶ã€bottleneckæ¨¡å—ä¸­shortcutä¹‹å‰ï¼Œè¿™é‡Œé€‰æ‹©åœ¨shortcutä¹‹å‰
        x2 = self.cv2(self.cv1(x))  # xå’Œx2çš„channelæ•°ç›¸åŒ
        # åœ¨bottleneckæ¨¡å—ä¸­shortcutä¹‹å‰åŠ å…¥CBAMæ¨¡å—
        out = self.channel_attention(x2) * x2
        # print('outchannels:{}'.format(out.shape))
        out = self.spatial_attention(out) * out
        return x + out if self.add else out


class C3CBAM(C3):
    # C3 module with CBAMBottleneck()
    def __init__(self, c1, c2, n=1, shortcut=True, g=1, e=0.5):
        super().__init__(c1, c2, n, shortcut, g, e)  # å¼•å…¥C3(çˆ¶ç±»)çš„å±æ€§
        c_ = int(c2 * e)  # hidden channels
        self.m = nn.Sequential(*(CBAMBottleneck(c_, c_, shortcut) for _ in range(n)))



</code></pre> 
<p>2ï¼‰ä¿®æ”¹yolo.py<br> åŸä»£ç ä¸ºï¼š</p> 
<pre><code class="language-python"> if m in {
                Conv, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, MixConv2d, Focus, CrossConv,
                BottleneckCSP, C3, C3TR, C3SPP, C3Ghost, nn.ConvTranspose2d, DWConvTranspose2d, C3x}:
            c1, c2 = ch[f], args[0]</code></pre> 
<p>åœ¨åé¢æ·»åŠ  CBAMBottleneck, C3CBAM</p> 
<p>ä¿®æ”¹åä¸ºï¼š</p> 
<pre><code class="language-python"> if m in {
                Conv, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, MixConv2d, Focus, CrossConv,
                BottleneckCSP, C3, C3TR, C3SPP, C3Ghost, nn.ConvTranspose2d, DWConvTranspose2d, C3x,CBAMBottleneck, C3CBAM}:
            c1, c2 = ch[f], args[0]</code></pre> 
<p>3ï¼‰åœ¨modelsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºyamlæ–‡ä»¶ï¼Œå‘½åä¸ºyolov5-cbam.yaml</p> 
<p>å†…å®¹ä¸º</p> 
<pre><code class="language-python"># YOLOv5 ğŸš€ by Ultralytics, GPL-3.0 license

# Parameters
nc: 20  # number of classes
depth_multiple: 0.33  # model depth multiple
width_multiple: 0.50  # layer channel multiple
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32

# YOLOv5 v6.0 backbone
# ç¬¬äºŒç§åŠ å…¥æ–¹æ³• å…¨éƒ¨æ›¿æ¢ C3 æ¨¡å—
backbone:
  # [from, number, module, args]
  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4
   [-1, 3, C3CBAM, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8
   [-1, 6, C3CBAM, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16
   [-1, 9, C3CBAM, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32
   [-1, 3, C3CBAM, [1024]],
   [-1, 1, SPPF, [1024, 5]],  # 9
  ]

# YOLOv5 v6.0 head
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, C3, [512, False]],  # 13

   [-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 4], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)

   [-1, 1, Conv, [256, 3, 2]],
   [[-1, 14], 1, Concat, [1]],  # cat head P4
   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)

   [-1, 1, Conv, [512, 3, 2]],
   [[-1, 10], 1, Concat, [1]],  # cat head P5
   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)

   [[17, 20, 23], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)
  ]
</code></pre> 
<p>4ï¼‰åœ¨train.pyä¸­ä¿®æ”¹</p> 
<p>---cfgä¸­æ·»åŠ yamlæ–‡ä»¶è·¯å¾„</p> 
<p><img alt="" height="202" src="https://images2.imgbox.com/b2/61/2JqeJ7QP_o.png" width="1200">Â </p> 
<pre><code class="language-python">  parser = argparse.ArgumentParser()
    parser.add_argument('--weights', type=str, default=ROOT / 'yolov5s.pt', help='initial weights path')
    parser.add_argument('--cfg', type=str, default=r'models/yolov5-cbam.yaml', help='model.yaml path')</code></pre> 
<p>5ï¼‰è¿è¡Œtrain.py</p> 
<p>2.æ·»åŠ SENet</p> 
<p>1)ä¿®æ”¹commom.py</p> 
<p>åœ¨ä»£ç æœ€åæ·»åŠ </p> 
<pre><code class="language-python">#SENet
class SE(nn.Module):
    def __init__(self, c1, c2, ratio=16):
        super(SE, self).__init__()
        #c*1*1
        self.avgpool = nn.AdaptiveAvgPool2d(1)
        self.l1 = nn.Linear(c1, c1 // ratio, bias=False)
        self.relu = nn.ReLU(inplace=True)
        self.l2 = nn.Linear(c1 // ratio, c1, bias=False)
        self.sig = nn.Sigmoid()
    def forward(self, x):
        b, c, _, _ = x.size()
        y = self.avgpool(x).view(b, c)
        y = self.l1(y)
        y = self.relu(y)
        y = self.l2(y)
        y = self.sig(y)
        y = y.view(b, c, 1, 1)
        return x * y.expand_as(x)


</code></pre> 
<p>2ï¼‰ä¿®æ”¹yolo.py<br> åŸä»£ç ä¸ºï¼š</p> 
<pre><code class="language-python"> if m in {
                Conv, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, MixConv2d, Focus, CrossConv,
                BottleneckCSP, C3, C3TR, C3SPP, C3Ghost, nn.ConvTranspose2d, DWConvTranspose2d, C3x}:
            c1, c2 = ch[f], args[0]</code></pre> 
<p>åœ¨åé¢æ·»åŠ  SE</p> 
<p>ä¿®æ”¹åä¸ºï¼š</p> 
<pre><code class="language-python"> if m in {
                Conv, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, MixConv2d, Focus, CrossConv,
                BottleneckCSP, C3, C3TR, C3SPP, C3Ghost, nn.ConvTranspose2d, DWConvTranspose2d, C3x,SE}:
            c1, c2 = ch[f], args[0]</code></pre> 
<p>3ï¼‰åœ¨modelsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºyamlæ–‡ä»¶ï¼Œå‘½åä¸ºyolov5-se.yaml</p> 
<p>å†…å®¹ä¸º</p> 
<pre><code class="language-python"># YOLOv5 ğŸš€ by Ultralytics, GPL-3.0 license

# Parameters
nc: 20  # number of classes ç±»åˆ«æ•°
depth_multiple: 0.33  # model depth multiple  æ§åˆ¶æ¨¡å‹çš„æ·±åº¦ï¼ˆBottleneckCSPæ•°ï¼‰
width_multiple: 0.50  # layer channel multiple æ§åˆ¶Convé€šé“æ•°ï¼ˆå·ç§¯æ ¸çš„æ•°é‡ï¼‰
#depth_multipleè¡¨ç¤ºBottleneckCSPæ¨¡å—çš„å±‚ç¼©æ”¾å› å­ï¼Œå°†æ‰€æœ‰çš„BottleneckCSPæ¨¡å—çš„BottleneckCSPä¹˜ä¸Šè¯¥å‚æ•°å¾—åˆ°æœ€ç»ˆä¸ªæ•°
#width_multipleè¡¨ç¤ºå·ç§¯é€šé“çš„ç¼©æ”¾å› å­ï¼Œå°±æ˜¯å°†é…ç½®ä¸­çš„backboneå’Œheadéƒ¨åˆ†æœ‰å…³Convé€šé“çš„è®¾ç½®ï¼Œå…¨éƒ½ä¹˜ä¸Šè¯¥ç³»æ•°
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args]
  #fromåˆ—å‚æ•°ï¼šå½“å‰æ¨¡å—è¾“å…¥æ¥è‡ªå“ªä¸€å±‚çš„è¾“å‡ºï¼›-1ä»£è¡¨ä»ä¸Šä¸€å±‚å¾—åˆ°çš„è¾“å…¥
  #numberåˆ—å‚æ•°ï¼šæœ¬æ¨¡å—çš„é‡å¤æ¬¡æ•°ï¼›1è¡¨ç¤ºåªæœ‰ä¸€ä¸ªï¼Œ3è¡¨ç¤ºæœ‰ä¸‰ä¸ªç›¸åŒæ¨¡å—
  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4      #128ä¸ªå·ç§¯æ ¸ï¼ˆ128ä¸ªé€šé“ï¼‰ï¼Œ3ä»£è¡¨3Ã—3çš„å·ç§¯æ ¸ï¼Œ2è¡¨ç¤ºæ­¥é•¿ä¸º2
   [-1, 3, C3, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8
   [-1, 6, C3, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16
   [-1, 9, C3, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32
   [-1, 3, C3, [1024]],          #è¿™é‡Œçš„C3ä»£è¡¨BottleneckCSP
   [-1, 1, SE, [1024]],
   [-1, 1, SPPF, [1024, 5]],  # 9
  ]

# YOLOv5 v6.0 head
#head=PANet+Detect
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, C3, [512, False]],  # 13

   [-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 4], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)

   [-1, 1, Conv, [256, 3, 2]],
   [[-1, 15], 1, Concat, [1]],  # cat head P4ï¼Œåœ¨backboneç¬¬ä¹å±‚æ·»åŠ SEåï¼Œç¬¬ä¹å±‚ä¹‹åçš„ç¼–å·éƒ½è¦åŠ 1ï¼Œ14+1
   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)

   [-1, 1, Conv, [512, 3, 2]],
   [[-1, 11], 1, Concat, [1]],  # cat head P5ï¼Œåœ¨backboneç¬¬ä¹å±‚æ·»åŠ SEåï¼Œç¬¬ä¹å±‚ä¹‹åçš„ç¼–å·éƒ½è¦åŠ 1ï¼Œ10+1
   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)

   [[18, 21, 24], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)ï¼Œåœ¨backboneç¬¬ä¹å±‚æ·»åŠ SEåï¼Œç¬¬ä¹å±‚ä¹‹åçš„ç¼–å·éƒ½è¦åŠ 1ï¼Œ17+1ï¼Œ20+1ï¼Œ23+1
  ]

</code></pre> 
<p>4ï¼‰åœ¨train.pyä¸­ä¿®æ”¹</p> 
<p>---cfgä¸­æ·»åŠ yamlæ–‡ä»¶è·¯å¾„(ä¸CBAMæ·»åŠ è·¯å¾„ä¸€è‡´)</p> 
<p><img alt="" height="202" src="https://images2.imgbox.com/3c/12/bhZn4kNU_o.png" width="1200"></p> 
<pre><code class="language-python">  parser = argparse.ArgumentParser()
    parser.add_argument('--weights', type=str, default=ROOT / 'yolov5s.pt', help='initial weights path')
    parser.add_argument('--cfg', type=str, default=r'models/yolov5-se.yaml', help='model.yaml path')</code></pre> 
<p>5ï¼‰è¿è¡Œtrain.py</p> 
<p>3.æ·»åŠ CA</p> 
<p>1)ä¿®æ”¹commom.py</p> 
<p>åœ¨ä»£ç æœ€åæ·»åŠ </p> 
<pre><code class="language-python">#CA
class h_sigmoid(nn.Module):
    def __init__(self, inplace=True):
        super(h_sigmoid, self).__init__()
        self.relu = nn.ReLU6(inplace=inplace)

    def forward(self, x):
        return self.relu(x + 3) / 6


class h_swish(nn.Module):
    def __init__(self, inplace=True):
        super(h_swish, self).__init__()
        self.sigmoid = h_sigmoid(inplace=inplace)

    def forward(self, x):
        return x * self.sigmoid(x)


class CoordAtt(nn.Module):
    def __init__(self, inp, oup, reduction=32):
        super(CoordAtt, self).__init__()
        self.pool_h = nn.AdaptiveAvgPool2d((None, 1))
        self.pool_w = nn.AdaptiveAvgPool2d((1, None))

        mip = max(8, inp // reduction)

        self.conv1 = nn.Conv2d(inp, mip, kernel_size=1, stride=1, padding=0)
        self.bn1 = nn.BatchNorm2d(mip)
        self.act = h_swish()

        self.conv_h = nn.Conv2d(mip, oup, kernel_size=1, stride=1, padding=0)
        self.conv_w = nn.Conv2d(mip, oup, kernel_size=1, stride=1, padding=0)

    def forward(self, x):
        identity = x

        n, c, h, w = x.size()
        x_h = self.pool_h(x)
        x_w = self.pool_w(x).permute(0, 1, 3, 2)

        y = torch.cat([x_h, x_w], dim=2)
        y = self.conv1(y)
        y = self.bn1(y)
        y = self.act(y)

        x_h, x_w = torch.split(y, [h, w], dim=2)
        x_w = x_w.permute(0, 1, 3, 2)

        a_h = self.conv_h(x_h).sigmoid()
        a_w = self.conv_w(x_w).sigmoid()

        out = identity * a_w * a_h

        return out

</code></pre> 
<p>2ï¼‰ä¿®æ”¹yolo.py<br> åŸä»£ç ä¸ºï¼š</p> 
<pre><code class="language-python"> if m in {
                Conv, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, MixConv2d, Focus, CrossConv,
                BottleneckCSP, C3, C3TR, C3SPP, C3Ghost, nn.ConvTranspose2d, DWConvTranspose2d, C3x}:
            c1, c2 = ch[f], args[0]</code></pre> 
<p>åœ¨åé¢æ·»åŠ Â  CoordAtt</p> 
<p>ä¿®æ”¹åä¸ºï¼š</p> 
<pre><code class="language-python"> if m in {
                Conv, GhostConv, Bottleneck, GhostBottleneck, SPP, SPPF, DWConv, MixConv2d, Focus, CrossConv,
                BottleneckCSP, C3, C3TR, C3SPP, C3Ghost, nn.ConvTranspose2d, DWConvTranspose2d, C3x,CoordAtt}:
            c1, c2 = ch[f], args[0]</code></pre> 
<p>3ï¼‰åœ¨modelsæ–‡ä»¶å¤¹ä¸‹åˆ›å»ºyamlæ–‡ä»¶ï¼Œå‘½åä¸ºyolov5-ca.yaml</p> 
<p>å†…å®¹ä¸º</p> 
<pre><code class="language-python"># YOLOv5 ğŸš€ by Ultralytics, GPL-3.0 license

# Parameters
nc: 20  # number of classes ç±»åˆ«æ•°
depth_multiple: 0.33  # model depth multiple  æ§åˆ¶æ¨¡å‹çš„æ·±åº¦ï¼ˆBottleneckCSPæ•°ï¼‰
width_multiple: 0.50  # layer channel multiple æ§åˆ¶Convé€šé“æ•°ï¼ˆå·ç§¯æ ¸çš„æ•°é‡ï¼‰
#depth_multipleè¡¨ç¤ºBottleneckCSPæ¨¡å—çš„å±‚ç¼©æ”¾å› å­ï¼Œå°†æ‰€æœ‰çš„BottleneckCSPæ¨¡å—çš„BottleneckCSPä¹˜ä¸Šè¯¥å‚æ•°å¾—åˆ°æœ€ç»ˆä¸ªæ•°
#width_multipleè¡¨ç¤ºå·ç§¯é€šé“çš„ç¼©æ”¾å› å­ï¼Œå°±æ˜¯å°†é…ç½®ä¸­çš„backboneå’Œheadéƒ¨åˆ†æœ‰å…³Convé€šé“çš„è®¾ç½®ï¼Œå…¨éƒ½ä¹˜ä¸Šè¯¥ç³»æ•°
anchors:
  - [10,13, 16,30, 33,23]  # P3/8
  - [30,61, 62,45, 59,119]  # P4/16
  - [116,90, 156,198, 373,326]  # P5/32

# YOLOv5 v6.0 backbone
backbone:
  # [from, number, module, args]
  #fromåˆ—å‚æ•°ï¼šå½“å‰æ¨¡å—è¾“å…¥æ¥è‡ªå“ªä¸€å±‚çš„è¾“å‡ºï¼›-1ä»£è¡¨ä»ä¸Šä¸€å±‚å¾—åˆ°çš„è¾“å…¥
  #numberåˆ—å‚æ•°ï¼šæœ¬æ¨¡å—çš„é‡å¤æ¬¡æ•°ï¼›1è¡¨ç¤ºåªæœ‰ä¸€ä¸ªï¼Œ3è¡¨ç¤ºæœ‰ä¸‰ä¸ªç›¸åŒæ¨¡å—
  [[-1, 1, Conv, [64, 6, 2, 2]],  # 0-P1/2
   [-1, 1, Conv, [128, 3, 2]],  # 1-P2/4      #128ä¸ªå·ç§¯æ ¸ï¼ˆ128ä¸ªé€šé“ï¼‰ï¼Œ3ä»£è¡¨3Ã—3çš„å·ç§¯æ ¸ï¼Œ2è¡¨ç¤ºæ­¥é•¿ä¸º2
   [-1, 3, C3, [128]],
   [-1, 1, Conv, [256, 3, 2]],  # 3-P3/8
   [-1, 6, C3, [256]],
   [-1, 1, Conv, [512, 3, 2]],  # 5-P4/16
   [-1, 9, C3, [512]],
   [-1, 1, Conv, [1024, 3, 2]],  # 7-P5/32
   [-1, 3, C3, [1024]],          #è¿™é‡Œçš„C3ä»£è¡¨BottleneckCSP
   [-1, 1, CoordAtt, [1024]],
   [-1, 1, SPPF, [1024, 5]],  # 9
  ]

# YOLOv5 v6.0 head
#head=PANet+Detect
head:
  [[-1, 1, Conv, [512, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 6], 1, Concat, [1]],  # cat backbone P4
   [-1, 3, C3, [512, False]],  # 13

   [-1, 1, Conv, [256, 1, 1]],
   [-1, 1, nn.Upsample, [None, 2, 'nearest']],
   [[-1, 4], 1, Concat, [1]],  # cat backbone P3
   [-1, 3, C3, [256, False]],  # 17 (P3/8-small)

   [-1, 1, Conv, [256, 3, 2]],
   [[-1, 15], 1, Concat, [1]],  # cat head P4ï¼Œåœ¨backboneç¬¬ä¹å±‚æ·»åŠ SEåï¼Œç¬¬ä¹å±‚ä¹‹åçš„ç¼–å·éƒ½è¦åŠ 1ï¼Œ14+1
   [-1, 3, C3, [512, False]],  # 20 (P4/16-medium)

   [-1, 1, Conv, [512, 3, 2]],
   [[-1, 11], 1, Concat, [1]],  # cat head P5ï¼Œåœ¨backboneç¬¬ä¹å±‚æ·»åŠ SEåï¼Œç¬¬ä¹å±‚ä¹‹åçš„ç¼–å·éƒ½è¦åŠ 1ï¼Œ10+1
   [-1, 3, C3, [1024, False]],  # 23 (P5/32-large)

   [[18, 21, 24], 1, Detect, [nc, anchors]],  # Detect(P3, P4, P5)ï¼Œåœ¨backboneç¬¬ä¹å±‚æ·»åŠ SEåï¼Œç¬¬ä¹å±‚ä¹‹åçš„ç¼–å·éƒ½è¦åŠ 1ï¼Œ17+1ï¼Œ20+1ï¼Œ23+1
  ]
</code></pre> 
<p>4ï¼‰åœ¨train.pyä¸­ä¿®æ”¹</p> 
<p>---cfgä¸­æ·»åŠ yamlæ–‡ä»¶è·¯å¾„(ä¸CBAMæ·»åŠ è·¯å¾„ä¸€è‡´)</p> 
<p><img alt="" height="202" src="https://images2.imgbox.com/04/a4/5lmVZrL5_o.png" width="1200"></p> 
<pre><code class="language-python">  parser = argparse.ArgumentParser()
    parser.add_argument('--weights', type=str, default=ROOT / 'yolov5s.pt', help='initial weights path')
    parser.add_argument('--cfg', type=str, default=r'models/yolov5-ca.yaml', help='model.yaml path')</code></pre> 
<p>5ï¼‰è¿è¡Œtrain.py</p> 
<p>Â  Â  Â  æˆ‘çš„ä»£ç åœ¨è¿è¡Œæ—¶æ˜¾ç¤ºCoordAttæ’å…¥æ­£å¸¸ï¼Œä½†æ˜¯åå‘ä¼ æ’­å¼‚å¸¸</p> 
<p>æŠ¥é”™ï¼šadaptive_avg_pool2d_backward_cuda does not have a deterministic implementation, but you set 'torch.use_deterministic_algorithms(True)'. You can turn off determinism just for this operation, or you can use the 'warn_only=True' option, if that's acceptable for your application.</p> 
<pre><code class="language-python">adaptive_avg_pool2d_backward_cuda does not have a deterministic implementation, but you set 'torch.use_deterministic_algorithms(True)'. You can turn off determinism just for this operation, or you can use the 'warn_only=True' option, if that's acceptable for your application.</code></pre> 
<p>å‚è€ƒ<a class="link-info" href="https://blog.csdn.net/qq_39696563/article/details/126339400" title="https://blog.csdn.net/qq_39696563/article/details/126339400">https://blog.csdn.net/qq_39696563/article/details/126339400</a>ååšå‡ºäº†ä¿®æ”¹ï¼Œå¯ä»¥æ­£å¸¸è®­ç»ƒ</p> 
<p><img alt="" height="162" src="https://images2.imgbox.com/cc/fd/IJlQ4x18_o.png" width="1200"></p> 
<p>æ·»åŠ å†…å®¹å¦‚ä¸ŠÂ </p> 
<p></p> 
<h2><strong>å‚è€ƒï¼š</strong></h2> 
<p><a class="link-info" href="https://blog.csdn.net/weixin_43694096/article/details/124443059?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22124443059%22%2C%22source%22%3A%22weixin_43694096%22%7D" title="https://blog.csdn.net/weixin_43694096/article/details/124443059?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22124443059%22%2C%22source%22%3A%22weixin_43694096%22%7D">https://blog.csdn.net/weixin_43694096/article/details/124443059?csdn_share_tail=%7B%22type%22%3A%22blog%22%2C%22rType%22%3A%22article%22%2C%22rId%22%3A%22124443059%22%2C%22source%22%3A%22weixin_43694096%22%7D</a></p> 
<p><a class="link-info" href="https://blog.csdn.net/qq_39740357/article/details/124084158" title="https://blog.csdn.net/qq_39740357/article/details/124084158">https://blog.csdn.net/qq_39740357/article/details/124084158</a></p> 
<p><a class="link-info" href="https://blog.csdn.net/weixin_43799388/article/details/123603131" title="https://blog.csdn.net/weixin_43799388/article/details/123603131">https://blog.csdn.net/weixin_43799388/article/details/123603131</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f064b9c9d42f0a1bcde055b4d8410101/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ã€é—®é¢˜è§£å†³ã€‘STM32F4ä¸²å£æ‰“å°ä¹±ç é—®é¢˜</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a078e711ca975bca44b5143ec57e8b7c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">å¦‚ä½•ç†è§£é©±åŠ¨ç¨‹åºã€è®¾å¤‡æ ‘ã€platformã€deviceã€driverä¹‹é—´çš„å…³ç³»</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ITå­¦ä¹ è€…åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>