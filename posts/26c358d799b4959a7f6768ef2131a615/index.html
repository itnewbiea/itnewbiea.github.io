<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>保存图片到MySQL&amp;从MySQL读取图片 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="保存图片到MySQL&amp;从MySQL读取图片" />
<meta property="og:description" content="🍉接上次 爬取坤坤表情包 ，这次我们直接将表情包存到MySQL数据库而不是本地。🍉
🥭1. 创建数据库 首先创建一个数据库，数据库名为ikun，表名为img，3个字段分别为id（图片id）、img（二进制码）、date（存储时间）
其中，二进制码的存储格式应该为 BLOB类型，下面为不同类型对应的最大存储空间
TINYBLOB 255个字节BLOB 65535字节MEDIUMBLOB 16MLONGBLOB 4G USE ikun; CREATE TABLE `img` ( `id` int NOT NULL AUTO_INCREMENT, `img` mediumblob NOT NULL, `date` date NOT NULL, PRIMARY KEY (`id`) ) ; 🍈2. 保存图片到数据库 将图片转为二进制流
对于图片的输入和输出，我们更多使用BufferedInputStream或者BufferedOutPutStream
public static void saveInMySQL(String url) throws IOException { //获得连接对象 Connection con = DBUtil.getConnection(&#34;root&#34;,&#34;******&#34;,&#34;ikun&#34;); PreparedStatement pre = null; //获取图片信息，做输出流 InputStream in = getEntityByHttpGetMethod(url).getContent(); BufferedInputStream inputStream = new BufferedInputStream(in); try { String sql = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/26c358d799b4959a7f6768ef2131a615/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-01T14:34:19+08:00" />
<meta property="article:modified_time" content="2023-04-01T14:34:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">保存图片到MySQL&amp;从MySQL读取图片</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p><strong>🍉接上次 <a class="link-info" href="http://t.csdn.cn/SrNZt" rel="nofollow" title="爬取坤坤表情包">爬取坤坤表情包</a> ，这次我们直接将表情包存到MySQL数据库而不是本地。🍉</strong></p> 
 <p></p> 
</blockquote> 
<h2><span style="color:#a2e043;">🥭1. 创建数据库</span></h2> 
<p>首先创建一个数据库，数据库名为ikun，表名为img，3个字段分别为id（图片id）、img（二进制码）、date（存储时间）</p> 
<p></p> 
<p>其中，二进制码的存储格式应该为 <strong>BLOB类型</strong>，下面为不同类型对应的最大存储空间</p> 
<ol><li><code>TINYBLOB</code> 255个字节</li><li><code>BLOB</code> 65535字节</li><li><code>MEDIUMBLOB</code> 16M</li><li><code>LONGBLOB</code> 4G</li></ol> 
<pre><code class="language-sql">USE ikun; 
CREATE TABLE `img` (
  `id` int NOT NULL AUTO_INCREMENT,
  `img` mediumblob NOT NULL,
  `date` date NOT NULL,
  PRIMARY KEY (`id`)
) ;</code></pre> 
<h2><span style="color:#a2e043;">🍈2. 保存图片到数据库</span></h2> 
<p><span style="color:#ed7976;"><strong>将图片转为二进制流</strong></span></p> 
<blockquote> 
 <p><span style="color:#ed7976;"><strong>对于图片的输入和输出，我们更多使用</strong></span><span style="color:#1c7331;"><strong>BufferedInputStream</strong></span><span style="color:#ed7976;"><strong>或者</strong></span><span style="color:#1c7331;"><strong>BufferedOutPutStream</strong></span></p> 
</blockquote> 
<pre><code class="language-java">public static void saveInMySQL(String url) throws IOException {
        //获得连接对象
        Connection con = DBUtil.getConnection("root","******","ikun");
        PreparedStatement pre = null;
        //获取图片信息，做输出流
        InputStream in = getEntityByHttpGetMethod(url).getContent();
        BufferedInputStream inputStream = new BufferedInputStream(in);

        try {
            String sql = "insert into img (img,date) values (?,?)";
            pre = con.prepareStatement(sql);
            pre.setBinaryStream(1,inputStream,in.available());
            Date date = new Date(System.currentTimeMillis());
            pre.setDate(2,date);
            //获取返回结果
            int i = pre.executeUpdate();
            System.out.println(i);
        } catch (SQLException e) {
            e.printStackTrace();
        }
    }</code></pre> 
<h3><span style="color:#ed7976;">查看效果</span></h3> 
<p><img alt="" height="1090" src="https://images2.imgbox.com/74/d1/NcD3iV4h_o.png" width="1200"></p> 
<h2><span style="color:#a2e043;">🍅 3. 从数据库读取图片</span></h2> 
<p><span style="color:#ed7976;"><strong>将二进制流转为文件输出到本地查看</strong></span></p> 
<pre><code class="language-java">public static void readFromMysql(){
        //获得连接对象
        Connection con = DBUtil.getConnection("root","******.","ikun");
        PreparedStatement pre = null;
        ResultSet res = null;

        try {
            //这里读取一张
            String sql = "select * from img where id = 1";
            pre = con.prepareStatement(sql);
            res = pre.executeQuery(sql);
            while (res.next()){
                int id = res.getInt("id");
                InputStream stream = res.getBinaryStream("img");
                Date date = res.getDate("date");
                System.out.println("图片id为"+id+" 创建时间为"+date.toString());
                Files.copy(stream, Paths.get("D:\\ikun.jpg"));
            }
        } catch (SQLException | IOException e) {
            e.printStackTrace();
        }
        //断开连接
        DBUtil.close();
    }</code></pre> 
<h2>写在最后</h2> 
<blockquote> 
 <p>         我发现阅读量挺高的但是没人收藏，确实，一般人相信看完下面就果断划走了，但试错不易，能不能留个点赞再走呢，谢谢~</p> 
 <p></p> 
 <p><br><span style="color:#ed7976;"><strong><span style="background-color:#fef2f0;">🍊通常我们建议不要直接将图片存到数据库中，而是放到本地磁盘目录下，我们通常将图片统一命名，通过其文件名或路径来访问数据库实现获取图片的目的。</span></strong></span></p> 
 <p>🍅而不建议直接往数据库存放图片的原因如下：</p> 
 <ol><li><strong>数据库性能下降</strong>：存储大量数据将占用大量的磁盘空间和系统资源，特别影响数据库性能，尤其是多用户访问的情况</li><li><strong>数据库的备份和维护变得困难，且可读性差</strong></li><li><strong>压力测试：</strong>多用户同时上传或下载图片时，将导致数据库服务器压力负载过大</li><li><strong>图片质量下降：</strong>比如我们待会的运行结果其实是这样的，左边是我们下载到本地的图片，右边则是下载到数据库，再从数据库读取出来的效果。而且我将二进制数值类型设置为最大还是模糊。</li></ol> 
 <p><img alt="" height="633" src="https://images2.imgbox.com/9d/a3/5ZYvxVqV_o.png" width="1188"></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/42c568a520d0eec99d429ec2364a7163/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中的Switch语句</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2651ba13832016a4860d7c12bbabadd4/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java集群实战：单体架构升级到集群架构（六）分布式缓存REDIS</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>