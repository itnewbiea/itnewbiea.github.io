<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>文本聚类之Supporting Clustering with Contrastive Learning（SCCL）论文复现【代码纠错及完善】 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="文本聚类之Supporting Clustering with Contrastive Learning（SCCL）论文复现【代码纠错及完善】" />
<meta property="og:description" content="文本聚类之Supporting Clustering with Contrastive Learning（SCCL）论文复现 前言一、论文介绍二、复现步骤1. 数据集下载及处理2. 数据预处理3. 安装依赖库3. 代码修改4. 运行结果 前言 近期想探索一些自己研究方向相关的领域，因而有了这篇文章，从图像的聚类到文本的聚类。本文的文本聚类更确切地说是短文本聚类（short text clustering），这是一个并不火热的方向，可以看到这篇论文是两年前发表的，SCCL是一篇很不错的工作。文本数据这块比较火热的是基于自监督、对比学习的NLP，聚类常被作为一个下游子任务，文本数据方面的主要任务还是学习文本的语义表征。不过，这个方向也未尝不是一个值得探索的方向（有着训练时间短，对显卡资源要求低的优点，算法稳定性强），没准哪天也像对比学习那样迎来一个春天。
一、论文介绍 论文名称：Supporting Clustering with Contrastive Learning，发表在NAACL会议上，在NLP领域也算是顶会吧。
论文链接：https://arxiv.org/abs/2103.12953
github地址：https://github.com/amazon-science/sccl
摘要：无监督聚类的目的是根据在表征(representation)中度量的距离发现数据的语义类别空间。然而，在学习过程的开始阶段，不同的类别往往在表征空间中相互重叠，这对基于距离的聚类在实现不同类别之间的良好分离提出了重大挑战。为此，本文提出了基于对比学习的支持聚类(SCCL)——一个利用对比学习来促进更好分离的新框架。并评估了SCCL在短文本聚类(short text clustering)上的性能，表明SCCL在大多数基准数据集上显著提高了达到SOTA的结果，准确率(ACC)提高了3% ~ 11%，规范化互信息(NMI)提高了4% ~ 15%。此外，定量分析证明了SCCL在利用自下而上的实例判别(instance discrimination)和自上而下的聚类优势方面的有效性，从而在使用ground truth聚类标签进行评估时获得更好的聚类内和聚类间距离。
二、复现步骤 本人复现代码已发布到github：https://github.com/Regan-Zhang/SCCL-EXEC
复现过程可参考sccl的github项目中的README.md文档，一般没有什么问题的话即可完成本节如下的第1步数据集下载及处理、第2步数据预处理、第3步依赖库的安装。
1. 数据集下载及处理 上图是SCCL原论文对数据集的数据集情况表一览。基于运行时间考虑，选取数据量适中的AgNews文本数据，余下部分本人也以AgNews为例进行讲解。
⋅ \huge · ⋅ 进入数据集网址:
https://github.com/rashadulrakib/short-text-clustering-enhancement/tree/master/data
然后点击红框处下载就可以啦。这些下载下来的都是原始文本数据，并没有经过处理和数据增强。
⋅ \huge · ⋅ 下载下来后文件名为agnewsdataraw-8000.txt，将其后缀名改成csv，当然这里我是改成了agnewsdataraw.csv，命名看读者喜好可以自己定义但是后缀名一定要为csv！
⋅ \huge · ⋅ 用WPS或者Excel打开csv文件，不出意外的话只有一列数据，label标签和text文本数据糊成一片。不过不要紧，这是因为直接打开csv文件而没有通过源导入定义格式导致的。只要重新导入文件即可。导入过程都在下面（其实也可以新建一个空的csv文件再导入源）：
如果不新建的话在原来csv文件操作就需要把光标放到第一个单元。
⋅ \huge · ⋅ 点击“数据”–&gt;“导入数据”–&gt;“导入数据”–&gt;选择“直接打开数据文件”–&gt;“选择数据源”，选中我们的agnewsdataraw.csv进行导入。
⋅ \huge · ⋅ 选择编码，没有尝试过其他，最常见编码是GBK和UTF-8，此处我选择UTF-8，这样不容易出错。
⋅ \huge · ⋅ 选择分隔符号，下一步。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/242b57901633eb9e1e3a2dd07ec938c0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-26T12:26:21+08:00" />
<meta property="article:modified_time" content="2023-06-26T12:26:21+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">文本聚类之Supporting Clustering with Contrastive Learning（SCCL）论文复现【代码纠错及完善】</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文本聚类之Supporting Clustering with Contrastive Learning（SCCL）论文复现</h4> 
 <ul><li><a href="#_6" rel="nofollow">前言</a></li><li><a href="#_11" rel="nofollow">一、论文介绍</a></li><li><a href="#_18" rel="nofollow">二、复现步骤</a></li><li><ul><li><a href="#1__21" rel="nofollow">1. 数据集下载及处理</a></li><li><a href="#2__48" rel="nofollow">2. 数据预处理</a></li><li><a href="#3__52" rel="nofollow">3. 安装依赖库</a></li><li><a href="#3__85" rel="nofollow">3. 代码修改</a></li><li><a href="#4__93" rel="nofollow">4. 运行结果</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_6"></a>前言</h2> 
<p>近期想探索一些自己研究方向相关的领域，因而有了这篇文章，从图像的聚类到文本的聚类。本文的文本聚类更确切地说是短文本聚类（short text clustering），这是一个并不火热的方向，可以看到这篇论文是两年前发表的，SCCL是一篇很不错的工作。文本数据这块比较火热的是基于自监督、对比学习的NLP，聚类常被作为一个下游子任务，文本数据方面的主要任务还是学习文本的语义表征。不过，这个方向也未尝不是一个值得探索的方向（有着训练时间短，对显卡资源要求低的优点，算法稳定性强），没准哪天也像对比学习那样迎来一个春天。</p> 
<hr> 
<h2><a id="_11"></a>一、论文介绍</h2> 
<p><strong>论文名称</strong>：Supporting Clustering with Contrastive Learning，发表在NAACL会议上，在NLP领域也算是顶会吧。<br> <strong>论文链接</strong>：<a href="https://arxiv.org/abs/2103.12953" rel="nofollow">https://arxiv.org/abs/2103.12953</a><br> <strong>github地址</strong>：<a href="https://github.com/amazon-science/sccl">https://github.com/amazon-science/sccl</a><br> <strong>摘要</strong>：无监督聚类的目的是根据在表征(representation)中度量的距离发现数据的语义类别空间。然而，在学习过程的开始阶段，不同的类别往往在表征空间中相互重叠，这对基于距离的聚类在实现不同类别之间的良好分离提出了重大挑战。为此，本文提出了基于对比学习的支持聚类(SCCL)——一个利用对比学习来促进更好分离的新框架。并评估了SCCL在短文本聚类(short text clustering)上的性能，表明SCCL在大多数基准数据集上显著提高了达到SOTA的结果，准确率(ACC)提高了3% ~ 11%，规范化互信息(NMI)提高了4% ~ 15%。此外，定量分析证明了SCCL在利用自下而上的实例判别(instance discrimination)和自上而下的聚类优势方面的有效性，从而在使用ground truth聚类标签进行评估时获得更好的聚类内和聚类间距离。</p> 
<p><img src="https://images2.imgbox.com/23/58/yy7Xwiju_o.png" alt="SCCL的模型架构图"></p> 
<h2><a id="_18"></a>二、复现步骤</h2> 
<p><strong>本人复现代码已发布到github：<a href="https://github.com/Regan-Zhang/SCCL-EXEC">https://github.com/Regan-Zhang/SCCL-EXEC</a></strong><br> 复现过程可参考sccl的github项目中的README.md文档，一般没有什么问题的话即可完成本节如下的第1步数据集下载及处理、第2步数据预处理、第3步依赖库的安装。</p> 
<h3><a id="1__21"></a>1. 数据集下载及处理</h3> 
<p><img src="https://images2.imgbox.com/48/c4/w2yV0ye5_o.png" alt="在这里插入图片描述"><br> 上图是SCCL原论文对数据集的数据集情况表一览。基于运行时间考虑，选取数据量适中的AgNews文本数据，余下部分本人也<strong>以AgNews为例进行讲解</strong>。<br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 进入数据集网址:<br> <a href="https://github.com/rashadulrakib/short-text-clustering-enhancement/tree/master/data">https://github.com/rashadulrakib/short-text-clustering-enhancement/tree/master/data</a><br> 然后点击红框处下载就可以啦。这些下载下来的都是原始文本数据，并没有经过处理和数据增强。<br> <img src="https://images2.imgbox.com/34/1b/8PJJko4A_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 下载下来后文件名为agnewsdataraw-8000.txt，将其后缀名改成csv，当然这里我是改成了agnewsdataraw.csv，<strong>命名看读者喜好可以自己定义但是后缀名一定要为csv！</strong><br> <img src="https://images2.imgbox.com/49/50/zsYDlXr5_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 用WPS或者Excel打开csv文件，不出意外的话只有一列数据，label标签和text文本数据糊成一片。不过不要紧，这是因为直接打开csv文件而没有通过源导入定义格式导致的。只要重新导入文件即可。导入过程都在下面（其实也可以新建一个空的csv文件再导入源）：</p> 
<p>如果不新建的话在原来csv文件操作就需要把光标放到第一个单元。<br> <img src="https://images2.imgbox.com/46/9e/MbNHHx5z_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 点击“数据”–&gt;“导入数据”–&gt;“导入数据”–&gt;选择“直接打开数据文件”–&gt;“选择数据源”，选中我们的agnewsdataraw.csv进行导入。<br> <img src="https://images2.imgbox.com/44/d7/thr3D8S7_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 选择编码，没有尝试过其他，最常见编码是GBK和UTF-8，此处我选择UTF-8，这样不容易出错。<br> <img src="https://images2.imgbox.com/08/89/3TE6s4Xw_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 选择分隔符号，下一步。<br> <img src="https://images2.imgbox.com/29/1f/fEDZT0bD_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 选择Tab键，这步很关键，源数据就是通过Tab分隔的。<br> <img src="https://images2.imgbox.com/fd/5f/OFkZCnWJ_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 接着就是下一步然后完成。得到如下结果就证明导入成功了：<br> <img src="https://images2.imgbox.com/b0/43/ft3u6IPB_o.png" alt="在这里插入图片描述"><br> <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
        
        
          ⋅ 
         
        
       
      
        \huge · 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.9218em;"></span><span class="mpunct sizing reset-size6 size10">⋅</span></span></span></span></span> 可以看到原来光标的位置多出两行，然后我们把原先的那一列删掉。<br> 在首行补充label和text的列名称：<br> <img src="https://images2.imgbox.com/07/24/J8az2WjE_o.png" alt="在这里插入图片描述"><br> 最后保存，数据集处理就大功告成啦！</p> 
<h3><a id="2__48"></a>2. 数据预处理</h3> 
<p>文本数据预处理，按文档要求对文本数据集进行数据增强（data augmentation）。<br> 数据增强的代码位于./Augdata目录下，修改路径和数据集名称就能运行啦。细节可以看我发布的源码【之后不久会发布到我个人github】。可以看到我导出源重新建了个文件夹AgNews。<br> <img src="https://images2.imgbox.com/1d/e4/NWg65lM0_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3__52"></a>3. 安装依赖库</h3> 
<pre><code class="prism language-python">pytorch<span class="token operator">==</span><span class="token number">1.6</span><span class="token number">.0</span><span class="token punctuation">.</span> 
sentence<span class="token operator">-</span>transformers<span class="token operator">==</span><span class="token number">2.0</span><span class="token number">.0</span><span class="token punctuation">.</span> 
transformers<span class="token operator">==</span><span class="token number">4.8</span><span class="token number">.1</span><span class="token punctuation">.</span> 
tensorboardX<span class="token operator">==</span><span class="token number">2.4</span><span class="token number">.1</span>
pandas<span class="token operator">==</span><span class="token number">1.1</span><span class="token number">.5</span>
sklearn<span class="token operator">==</span><span class="token number">0.24</span><span class="token number">.1</span>
numpy<span class="token operator">==</span><span class="token number">1.19</span><span class="token number">.5</span>
</code></pre> 
<p>这是源项目提供的依赖库，不过其中还少了一个很关键的库：nlpaug，这个库看缩写就知道是用于NLP领域的数据增强，pip install 直接安装即可。</p> 
<pre><code class="prism language-python">pip install nlpaug
</code></pre> 
<p>或许每个人运行代码后都会出现各种各样问题，但就我个人情况是遇到这个问题（如下图）：proto协议版本过高，需要降低这个库的版本。先uninstall然后指定版本进行install即可。<br> <img src="https://images2.imgbox.com/26/e0/EYe4lPPK_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">pip uninstall protobuf
</code></pre> 
<pre><code class="prism language-python">pip install protobuf<span class="token operator">==</span><span class="token number">3.19</span><span class="token number">.0</span>
</code></pre> 
<p>按照报错提示，安装3.19.0这个版本。实际上不管遇到什么问题，看懂报错提示就可以了，然后搜索对应解决方法，兵来将挡水来土掩。<br> <img src="https://images2.imgbox.com/7d/cf/vFPCUILV_o.png" alt="在这里插入图片描述"><br> 比如上图所示的报错，需要更新sentence transformer这个库为最新版本。</p> 
<pre><code class="prism language-python">pip install <span class="token operator">-</span>U sentence<span class="token operator">-</span>transformers
</code></pre> 
<h3><a id="3__85"></a>3. 代码修改</h3> 
<p><img src="https://images2.imgbox.com/b5/03/xNYiakx3_o.png" alt="在这里插入图片描述"><br> 不知道是作者故意的，还是笔误，对应位置改成distilbert就可以了。<br> <img src="https://images2.imgbox.com/8b/aa/oLycDBgF_o.png" alt="在这里插入图片描述"><br> <strong>上图这个越界的错误是整个SCCL项目中最大的错误，但修改起来也很容易，只需要加一句代码。</strong><br> 报错的原因是agnewsdataraw.csv中的标签是从1开始打标签，的agnews有4个类，标签为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         [ 
        
       
         1 
        
       
         , 
        
       
         2 
        
       
         , 
        
       
         3 
        
       
         , 
        
       
         4 
        
       
         ] 
        
       
      
        [1,2,3,4] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">3</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">4</span><span class="mclose">]</span></span></span></span></span>，而编程的世界里编号都是从零开始的，标签应为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         [ 
        
       
         0 
        
       
         , 
        
       
         1 
        
       
         , 
        
       
         2 
        
       
         , 
        
       
         3 
        
       
         ] 
        
       
      
        [0,1,2,3] 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">[</span><span class="mord">0</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">1</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">2</span><span class="mpunct">,</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord">3</span><span class="mclose">]</span></span></span></span></span>，因此找到对应位置将 label值<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         − 
        
       
         1 
        
       
      
        -1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.7278em; vertical-align: -0.0833em;"></span><span class="mord">−</span><span class="mord">1</span></span></span></span></span>就行啦（如图）。<br> <img src="https://images2.imgbox.com/29/29/piZnqqhw_o.png" alt="在这里插入图片描述"><br> <strong>值得一提的是，由于代码运行时会自动从github下载BERT的预训练权重，所以需要科学上网，这个请读者自行了解解决。</strong></p> 
<h3><a id="4__93"></a>4. 运行结果</h3> 
<p>复现在Nvidia GeForce RTX3090(显存24G)上运行，遵照原项目参数配置，运行起来后占显存为15G+，还是对显卡蛮友好的，而且运行速度快以至于都不用保存权重，运行时间大概在40分钟左右。如果读者显卡资源没有这么充足，可以减小batch size等超参去适应显卡的配置。<br> <img src="https://images2.imgbox.com/2a/44/TF0aSGb7_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d2/4e/eXpQIQfa_o.png" alt="在这里插入图片描述"><br> 上图是论文中汇报的结果，而我针对AgNews数据集的复现的效果如下，使用两种数据增强（charswap字符交换和word deletion词删除）：</p> 
<table><thead><tr><th>AgNews</th><th>NMI</th><th>ACC</th></tr></thead><tbody><tr><td>charswap</td><td>66.9</td><td>87.3</td></tr><tr><td>word deletion</td><td>67.5</td><td>87.5</td></tr></tbody></table> 
<p>最好的结果（即word deletion这一行）和论文里汇报相差一个点，还是蛮接近的，由此也证明模型和论文的真实性和可行性。</p> 
<hr>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9c5a5536059ee6ade019f6343f2b45c8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">对模型进行量化</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d6bf90e90b701465b8c8541927d2dcac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Pythonnet：Python与.NET的无缝集成</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>