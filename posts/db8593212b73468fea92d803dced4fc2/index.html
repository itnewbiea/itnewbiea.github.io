<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ROS深度相机集成 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ROS深度相机集成" />
<meta property="og:description" content="1 使用带ROS的gazebo深度摄像头 介绍 在本教程中，您将学习如何将gazebo深度摄影机连接到ROS。教程包括三个主要步骤：
创建一个包括ROS深度相机插件的露台模型在gazebo上安装深度摄影机在RViz中查看深度摄影机的输出。 这是一个独立的教程；它不使用在其他Gazebo ROS教程中开发的RRBot。它的目的是帮助你在ROS和gazebo上 迅速使用电脑视觉。
先决条件 你应该安装gazebo_ros_pkgs在学习本教程之前。
2 创建一个带有深度相机插件的露台模型 因为Gazebo和ROS是独立的项目，互不依赖。默认情况下，来自gazebo_models存储库（如深度摄影机）的传感器不包括ROS插件。这意味着您必须根据Gazebo模型存储库中的自定义摄影机，然后添加自己的摄影机&lt;plugin&gt;标记使深度摄影机数据将点云和图像发布到ROS主题。
你应该从gazebo上提供的相机中选择一个景深相机。本教程将使用Microsoft Kinect，但此过程应与列表中其他深度摄影机的过程相同。
首先，获取深度摄影机并修改其名称。我们从gazebo_models你要做的就是下载然后把它打开。
或者，您可以按照model contribution tutorial从头开始制作自己的相机，或者可以克隆gazebo_models从那里复制一个传感器。
无论你得到它，复制kinect文件夹到你的~/.gazebo/models目录。然后，将模型的名称改为有意义的名称，比如kinect_ros。若要更改模型的名称，应更新文件夹名称&lt;name&gt;存储在.config文件，和型号名称在model.sdf文件。
现在您需要添加ROS插件来发布深度相机信息并输出到ROS主题。ROS插件列表和示例代码可以在插件教程 .
在本教程中，您将使用通用的“opennikinect”插件。你可以（也应该）将此插件用于Kinect之外的其他类型的深度摄影机（它是一个较旧的插件，因此它保留了原来的名称）。
打开model.sdf新模型目录中的文件。将以下SDFmarkup添加到&lt;sensor&gt;在结束后立即标记&lt;/camera&gt;标签：
&lt;plugin name=&#34;camera_plugin&#34; filename=&#34;libgazebo_ros_openni_kinect.so&#34;&gt; &lt;baseline&gt;0.2&lt;/baseline&gt; &lt;alwaysOn&gt;true&lt;/alwaysOn&gt; &lt;!-- Keep this zero, update_rate in the parent &lt;sensor&gt; tag will control the frame rate. --&gt; &lt;updateRate&gt;0.0&lt;/updateRate&gt; &lt;cameraName&gt;camera_ir&lt;/cameraName&gt; &lt;imageTopicName&gt;/camera/color/image_raw&lt;/imageTopicName&gt; &lt;cameraInfoTopicName&gt;/camera/color/camera_info&lt;/cameraInfoTopicName&gt; &lt;depthImageTopicName&gt;/camera/depth/image_raw&lt;/depthImageTopicName&gt; &lt;depthImageCameraInfoTopicName&gt;/camera/depth/camera_info&lt;/depthImageCameraInfoTopicName&gt; &lt;pointCloudTopicName&gt;/camera/depth/points&lt;/pointCloudTopicName&gt; &lt;frameName&gt;camera_link&lt;/frameName&gt; &lt;pointCloudCutoff&gt;0.5&lt;/pointCloudCutoff&gt; &lt;pointCloudCutoffMax&gt;3.0&lt;/pointCloudCutoffMax&gt; &lt;distortionK1&gt;0&lt;/distortionK1&gt; &lt;distortionK2&gt;0&lt;/distortionK2&gt; &lt;distortionK3&gt;0&lt;/distortionK3&gt; &lt;distortionT1&gt;0&lt;/distortionT1&gt; &lt;distortionT2&gt;0&lt;/distortionT2&gt; &lt;CxPrime&gt;0&lt;/CxPrime&gt; &lt;Cx&gt;0&lt;/Cx&gt; &lt;Cy&gt;0&lt;/Cy&gt; &lt;focalLength&gt;0&lt;/focalLength&gt; &lt;hackBaseline&gt;0&lt;/hackBaseline&gt; &lt;/plugin&gt; 正如您所看到的，这个插件允许您对如何将信息传递给ROS有很多细粒度的控制。注意以下几点：
这个updateRate参数应设置为0，这将导致plugin以与父SDF相同的速率发布深度信息传感器。如果UpdateRate不是0，它将在父级上执行其他限制sensor的更新率。主题名称和frameName可以设置为任何您想要的，但是上面显示的主题与常用的dros包发布的默认主题相匹配，例如 openni2_launch。保持主题名称相同有助于在真实和模拟相机之间切换。这个distortionX参数应符合&lt;distortion&gt;母相机的标签。如果没有&lt;distortion&gt;标记，然后对所有distortionX的值取0。pointCloudCutoff和 PointCloudCutoffMax分别是点的最小和最大距离。超过此距离的点将不显示。在任何一个传感器上都设置了一个附加的限制。 重命名模型后，将上面的代码添加到." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/db8593212b73468fea92d803dced4fc2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-01-10T20:36:55+08:00" />
<meta property="article:modified_time" content="2022-01-10T20:36:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ROS深度相机集成</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1 使用带ROS的gazebo深度摄像头</h2> 
<h3>介绍</h3> 
<p>在本教程中，您将学习如何将gazebo深度摄影机连接到ROS。教程包括三个主要步骤：</p> 
<ol><li>创建一个包括ROS深度相机插件的露台模型</li><li>在gazebo上安装深度摄影机</li><li>在RViz中查看深度摄影机的输出。</li></ol> 
<p>这是一个独立的教程；它不使用在其他Gazebo ROS教程中开发的RRBot。它的目的是帮助你在ROS和gazebo上 迅速使用电脑视觉。</p> 
<h4>先决条件</h4> 
<p>你应该<a href="http://gazebosim.org/tutorials?tut=ros_installing&amp;cat=connect_ros" rel="nofollow" title="安装露台">安装</a><a href="http://gazebosim.org/tutorials?tut=ros_installing&amp;cat=connect_ros" rel="nofollow" title="gazebo_ros_pkgs">gazebo_ros_pkgs</a>在学习本教程之前。</p> 
<h2>2 创建一个带有深度相机插件的露台模型</h2> 
<p>因为Gazebo和ROS是独立的项目，互不依赖。默认情况下，来自<code>gazebo_models</code>存储库（如深度摄影机）的传感器不包括ROS插件。这意味着您必须根据Gazebo模型存储库中的自定义摄影机，然后添加自己的摄影机<code>&lt;plugin&gt;</code>标记使深度摄影机数据将点云和图像发布到ROS主题。</p> 
<p>你应该从gazebo上提供的相机中选择一个景深相机。本教程将使用Microsoft Kinect，但此过程应与列表中其他深度摄影机的过程相同。</p> 
<p></p> 
<p>首先，获取深度摄影机并修改其名称。我们从<code>gazebo_models</code>你要做的就是<a href="http://github.com/osrf/gazebo_tutorials/raw/master/ros_depth_camera/files/kinect.zip" title="下载">下载</a>然后把它打开。</p> 
<p>或者，您可以按照<a href="http://gazebosim.org/tutorials?tut=model_contrib&amp;cat=build_robot" rel="nofollow" title="model contribution tutorial">model contribution tutorial</a>从头开始制作自己的相机，或者可以克隆<code>gazebo_models</code>从那里复制一个传感器。</p> 
<p>无论你得到它，复制<code>kinect</code>文件夹到你的~/.gazebo/models目录。然后，将模型的名称改为有意义的名称，比如<code>kinect_ros</code>。若要更改模型的名称，应更新文件夹名称<code>&lt;name&gt;</code>存储在<code>.config</code>文件，和<code>型号名称</code>在<code>model.sdf</code>文件。</p> 
<p>现在您需要添加ROS插件来发布深度相机信息并输出到ROS主题。ROS插件列表和示例代码可以在<a href="http://gazebosim.org/tutorials?tut=ros_gzplugins&amp;cat=connect_ros" rel="nofollow" title="插件教程">插件教程</a> .</p> 
<p>在本教程中，您将使用通用的“opennikinect”插件。你可以（也应该）将此插件用于Kinect之外的其他类型的深度摄影机（它是一个较旧的插件，因此它保留了原来的名称）。</p> 
<p>打开<code>model.sdf</code>新模型目录中的文件。将以下SDFmarkup添加到<code>&lt;sensor&gt;</code>在结束后立即标记<code>&lt;/camera&gt;</code>标签：</p> 
<pre><code>        &lt;plugin name="camera_plugin" filename="libgazebo_ros_openni_kinect.so"&gt;
          &lt;baseline&gt;0.2&lt;/baseline&gt;
          &lt;alwaysOn&gt;true&lt;/alwaysOn&gt;
          &lt;!-- Keep this zero, update_rate in the parent &lt;sensor&gt; tag
            will control the frame rate. --&gt;
          &lt;updateRate&gt;0.0&lt;/updateRate&gt;
          &lt;cameraName&gt;camera_ir&lt;/cameraName&gt;
          &lt;imageTopicName&gt;/camera/color/image_raw&lt;/imageTopicName&gt;
          &lt;cameraInfoTopicName&gt;/camera/color/camera_info&lt;/cameraInfoTopicName&gt;
          &lt;depthImageTopicName&gt;/camera/depth/image_raw&lt;/depthImageTopicName&gt;
          &lt;depthImageCameraInfoTopicName&gt;/camera/depth/camera_info&lt;/depthImageCameraInfoTopicName&gt;
          &lt;pointCloudTopicName&gt;/camera/depth/points&lt;/pointCloudTopicName&gt;
          &lt;frameName&gt;camera_link&lt;/frameName&gt;
          &lt;pointCloudCutoff&gt;0.5&lt;/pointCloudCutoff&gt;
          &lt;pointCloudCutoffMax&gt;3.0&lt;/pointCloudCutoffMax&gt;
          &lt;distortionK1&gt;0&lt;/distortionK1&gt;
          &lt;distortionK2&gt;0&lt;/distortionK2&gt;
          &lt;distortionK3&gt;0&lt;/distortionK3&gt;
          &lt;distortionT1&gt;0&lt;/distortionT1&gt;
          &lt;distortionT2&gt;0&lt;/distortionT2&gt;
          &lt;CxPrime&gt;0&lt;/CxPrime&gt;
          &lt;Cx&gt;0&lt;/Cx&gt;
          &lt;Cy&gt;0&lt;/Cy&gt;
          &lt;focalLength&gt;0&lt;/focalLength&gt;
          &lt;hackBaseline&gt;0&lt;/hackBaseline&gt;
        &lt;/plugin&gt;</code></pre> 
<p>正如您所看到的，这个插件允许您对如何将信息传递给ROS有很多细粒度的控制。注意以下几点：</p> 
<ul><li>这个<code>updateRate</code>参数应设置为0，这将导致plugin以与父SDF相同的速率发布深度信息<code>传感器</code>。如果UpdateRate不是0，它将在父级上执行其他限制<code>sensor</code>的更新率。</li><li>主题名称和<code>frameName</code>可以设置为任何您想要的，但是上面显示的主题与常用的dros包发布的默认主题相匹配，例如<code> openni2_launch</code>。保持主题名称相同有助于在真实和模拟相机之间切换。</li><li>这个<code>distortionX</code>参数应符合<code>&lt;distortion&gt;</code>母相机的标签。如果没有<code>&lt;distortion&gt;</code>标记，然后对所有distortionX的值取0。</li><li><code>pointCloudCutoff</code>和<code> PointCloudCutoffMax</code>分别是点的最小和最大距离。超过此距离的点将不显示。在任何一个传感器上都设置了一个附加的限制。</li></ul> 
<p>重命名模型后，将上面的代码添加到<code>.sdf</code>文件，并保存了您的更改，您应该准备好了！</p> 
<h2>3 在gazebo上安装深度摄影机</h2> 
<p>启用ROS支持的开放式gazebo（例如。<code>roslaunch gazebo_ros empty_world.launch</code>)。使用“插入”面板查找您的“Kinect ROS”模型，并将其插入到世界中。</p> 
<p><strong>重要提示：</strong>你还应该在场景中添加一些其他对象，否则你的相机可能没有任何东西可以看到！添加一些立方体、球体或其他物体，确保它们位于摄像机的可见范围内，如下面的屏幕截图所示。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/1a/78/dBaZ8fa3_o.png"></p> 
<p> </p> 
<h3>4 RViz中的景深摄影机输出</h3> 
<p>现在相机在gazebo场景中，它应该发布图像和点云到ROS主题。您可以通过在一个新的终端里运行</p> 
<pre><code>rostopic list</code></pre> 
<p>来检查正在发布的主题。您应该会看到您在SDF插件代码中指定的主题。</p> 
<p>你也可以运行RViz(</p> 
<pre><code>rosrun rviz rviz</code></pre> 
<p>)。首先，在左面板的“全局选项”部分设置RViz固定框架，以匹配您为其设置的值<code>&lt;frameName&gt;</code>在插件XML代码中。然后，向RViz添加PointCloud2和/或一个image显示。对于图像，请将图像主题设置为在中使用的值<code>&lt;imageTopicName&gt;</code>标签。对于PointCloud2，将主题设置为在<code>&lt;depthImageTopicName&gt;</code>标签。请参阅下面的屏幕截图，以获取与上面示例传感器XML中的值相匹配的示例：</p> 
<p><img alt="" src="https://images2.imgbox.com/42/e4/EIZebL6K_o.png"></p> 
<p> </p> 
<p>在设置了正确的主题和固定框架后，您应该会从PointCloud2中看到类似于以下内容的内容：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/28/19/Gq0zdu5A_o.png"> </p> 
<p> 图像显示将显示深度摄影机结果的灰度版本。如果您有Gazebo 8或更新版本，可以将这些RViz结果与Gazebo Topic Visualizer中的depthimage结果进行比较。</p> 
<h4>故障排除</h4> 
<p><strong>问题：</strong></p> 
<pre><code>rostopic list</code></pre> 
<p>不显示相机主题。</p> 
<p><strong>解决方案：</strong>确保在露台中添加了正确的模型。确保Gazebo模拟正在运行，而不是暂停。检查<code>model.sdf</code>归档并确保<code>&lt;plugin&gt;</code>标记在文件中的正确位置。在冗长模式下试运行gazebo(</p> 
<pre><code>rosrun gazebo_ros gazebo --verbose</code></pre> 
<p>)并查看是否有任何有用的警告或错误消息可以帮助查明问题。</p> 
<p><strong>问题：</strong>ROS主题已经列出，但我在Rviz中没有看到任何内容。</p> 
<p><strong>解决方案：</strong>确保在露台上有摄像头可以看到的物体。确保在RViz中添加了图像或PointCloud2显示。检查您的图像或PointCloud2显示是否设置为显示正确的主题。检查是否未禁用图像或PointCloud2显示（复选框）。确保RViz固定框架与<code>frameName</code>你在里面指定的<code>&lt;plugin&gt;</code>标签。确保传感器剪裁参数没有设置为所有点都被剪裁。</p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d7ccfefc689f35f36b3c7d68c41b6aee/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MongoDB操作</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/078f3bed0956e0d95bed27594cab3557/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">json序列化</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>