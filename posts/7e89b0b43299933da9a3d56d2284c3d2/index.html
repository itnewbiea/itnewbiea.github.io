<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uniapp使用腾讯地图组件 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uniapp使用腾讯地图组件" />
<meta property="og:description" content="UNIAPP CHOOSELOCATION 在H5端定位不准确解决方案 标签： uni-app
前言 项目需要通过选取地址来获取经纬度，进而计算两点的距离。直接使用uni.chooseLoaction 发现偏差实在是太大。
解决方案 使用腾讯的 地图选点组件
传送门：地图组件 | 腾讯位置服务
第一步 申请KEY设置REFERER 注意：这里的应用名称填英文，我设置的中文，后面的链接填写referer的时候总是报错，换成英文就好了
第二步 UNIAPP页面 1.在需要获取位置信息的页面加个跳转
这里我们是跳转到webview页面去获取地址
2.在onload里面加个判断，解析返回的数据信息
当我们在webview页面获取信息之后还要跳转回当前页面，带着数据信息
onLoad(options) { if(options.loc){ let loc = JSON.parse(options.loc); //做你的数据处理 } }, methods: { openAddres:function(){ uni.redirectTo({ url:&#34;../getAddress/getAddress&#34; }) } } 3.webview页面
&lt;template&gt; &lt;view&gt; &lt;web-view src=&#34;https://apis.map.qq.com/tools/locpicker?search=1&amp;type=1&amp;key=your key&amp;referer=your appname&#34;&gt;&lt;/web-view&gt; &lt;/view&gt; &lt;/template&gt; &lt;script&gt; export default { data() { return { } }, onLoad(options) { window.addEventListener(&#39;message&#39;, event=&gt; { // 接收位置信息，用户选择确认位置点后选点组件会触发该事件，回传用户的位置信息 var loc = event." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7e89b0b43299933da9a3d56d2284c3d2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-31T10:36:07+08:00" />
<meta property="article:modified_time" content="2023-10-31T10:36:07+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uniapp使用腾讯地图组件</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>UNIAPP CHOOSELOCATION 在H5端定位不准确解决方案</h3> 
<p>标签： <a href="https://www.freesion.com/tag/uni-app/" rel="nofollow" title="uni-app">uni-app</a></p> 
<h4>前言</h4> 
<p>项目需要通过选取地址来获取经纬度，进而计算两点的距离。直接使用uni.chooseLoaction 发现偏差实在是太大。</p> 
<h4>解决方案</h4> 
<p>使用腾讯的 <a href="https://lbs.qq.com/webApi/component/componentGuide/componentPicker" rel="nofollow" title="地图选点组件">地图选点组件</a><br> 传送门：<a href="https://lbs.qq.com/webApi/component/componentGuide/componentPicker" rel="nofollow" title="地图组件 | 腾讯位置服务">地图组件 | 腾讯位置服务</a></p> 
<h5>第一步 申请KEY设置REFERER</h5> 
<p>注意：这里的应用名称填英文，我设置的中文，后面的链接填写referer的时候总是报错，换成英文就好了<br><img alt="申请key" src="https://images2.imgbox.com/b3/e6/jrHHd34o_o.png"></p> 
<h5>第二步 UNIAPP页面</h5> 
<p>1.在需要获取位置信息的页面加个跳转<br> 这里我们是跳转到webview页面去获取地址</p> 
<p>2.在onload里面加个判断，解析返回的数据信息<br> 当我们在webview页面获取信息之后还要跳转回当前页面，带着数据信息</p> 
<pre><code>onLoad(options) {
	if(options.loc){
		let loc = JSON.parse(options.loc);
		//做你的数据处理
	}
},
methods: {
	openAddres:function(){
		uni.redirectTo({
			url:"../getAddress/getAddress"
		})
	}
}
</code></pre> 
<p>3.webview页面</p> 
<pre><code>&lt;template&gt;
	&lt;view&gt;
		&lt;web-view src="https://apis.map.qq.com/tools/locpicker?search=1&amp;type=1&amp;key=your key&amp;referer=your appname"&gt;&lt;/web-view&gt;
	&lt;/view&gt;
&lt;/template&gt;

&lt;script&gt;
	export default {
		data() {
			return {
				
			}
		},
		onLoad(options) {
			window.addEventListener('message', event=&gt; {
			  // 接收位置信息，用户选择确认位置点后选点组件会触发该事件，回传用户的位置信息
			    var loc = event.data;
				if (loc &amp;&amp; loc.module == 'locationPicker') {
			        //防止其他应用也会向该页面post信息，需判断module是否为'locationPicker'
			        console.log('location', loc);
					uni.redirectTo({
						url:"../editAddress/editAddress?loc="+JSON.stringify(loc)
					})
				}
			}, false);
		},
		onHide() {
			window.removeEventListener();
		},
		methods: {
		}
	}
	
&lt;/script&gt;

&lt;style&gt;

&lt;/style&gt;

</code></pre> 
<p>以上，完成，经测试。定位相当准确！</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/44a40e1d63e61f52361289a874666c42/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【问题分析解决】git添加.gitignore后不生效问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/409effda5a05c90b95f38b4d310cb6de/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">为什么前端数值精度会丢失?(BigInt解决办法)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>