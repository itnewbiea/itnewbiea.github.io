<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MapReduce＆YARN学习入门 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MapReduce＆YARN学习入门" />
<meta property="og:description" content="目录 一、MapReduce概述1.分布式计算框架- MapReduce2.MapReduce执行原理3.MapReduce的运行机制 二、YARN概述1.资源调度2.YARN的资源调度3.MapReduce和YARN的关系 三、YARN架构1.YARN核心架构1.1.YARN容器 2.YARN辅助架构2.1Web应用代理（Web Application Proxy）2.2JobHistoryServer历史服务器2.2.1JobHistoryServer历史服务器功能2.2.2JobHistoryServer配置 3.MapReduce的配置＆YARN的部署3.1部署说明3.2集群规划3.3MapReduce配置文件3.4YARN配置文件3.5分发配置文件3.6集群启动命令介绍 四、MapReduce＆YARN初体验1.集群启停命令1.1一键启动脚本1.2单进程启停 2.提交MapReduce任务到YARN执行2.1提交wordcount示例程序2.1.1报错记录2.1.1.1 org.apache.hadoop.yarn.exceptions.YarnException: Failed to submit application_1680768899138_0002 to YARN : root is not a leaf queue2.1.1.2 org.apache.hadoop.hdfs.BlockMissingException: Could not obtain block: BP-2110899144-100.66.8.128-1682069026390:blk_1073741825_1001 file=/input/words.txt No live nodes contain current block Block locations: Dead nodes: 2.1.2查看运行日志 2.2.提交求圆周率示例程序 一、MapReduce概述 1.分布式计算框架- MapReduce MapReduce是“分散-&gt;汇总”模式的分布式计算框架，可供开发人员开发相关程序进行分布式数据计算。
MapReduce提供了2个编程接口：
•Map
•Reduce
其中
•Map功能接口提供了“分散”的功能， 由服务器分布式对数据进行处理
•Reduce功能接口提供了“汇总（聚合）”的功能，将分布式的处理结果汇总统计
用户如需使用MapReduce框架完成自定义需求的程序开发
只需要使用Java、Python等编程语言，实现Map Reduce功能接口即可。
•注：MapReduce尽管可以通过Java、Python等语言进行程序开发，但当下年代基本没人会写它的代码了，因为太过时了。尽管MapReduce很老了，但现在仍旧活跃在一线，主要是Apache Hive框架非常火，而Hive底层就是使用的MapReduce。所以对于MapReduce的代码开发，课程会简单扩展一下，但不会深入讲解，对MapReduce的底层原理会放在Hive之后，基于Hive做深入分析。
2.MapReduce执行原理 假定有4台服务器用以执行MapReduce任务
可以3台服务器执行Map，1台服务器执行Reduce
3.MapReduce的运行机制 •将要执行的需求，分解为多个Map Task和Reduce Task
•将Map Task 和 Reduce Task分配到对应的服务器去执行" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7225fbce128173974625e04bbb1f502b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-24T10:28:51+08:00" />
<meta property="article:modified_time" content="2023-04-24T10:28:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MapReduce＆YARN学习入门</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#MapReduce_2" rel="nofollow">一、MapReduce概述</a></li><li><ul><li><a href="#1_MapReduce_4" rel="nofollow">1.分布式计算框架- MapReduce</a></li><li><a href="#2MapReduce_26" rel="nofollow">2.MapReduce执行原理</a></li><li><a href="#3MapReduce_32" rel="nofollow">3.MapReduce的运行机制</a></li></ul> 
  </li><li><a href="#YARN_38" rel="nofollow">二、YARN概述</a></li><li><ul><li><a href="#1_40" rel="nofollow">1.资源调度</a></li><li><a href="#2YARN_48" rel="nofollow">2.YARN的资源调度</a></li><li><a href="#3MapReduceYARN_59" rel="nofollow">3.MapReduce和YARN的关系</a></li></ul> 
  </li><li><a href="#YARN_65" rel="nofollow">三、YARN架构</a></li><li><ul><li><a href="#1YARN_67" rel="nofollow">1.YARN核心架构</a></li><li><ul><li><a href="#11YARN_86" rel="nofollow">1.1.YARN容器</a></li></ul> 
   </li><li><a href="#2YARN_89" rel="nofollow">2.YARN辅助架构</a></li><li><ul><li><a href="#21WebWeb_Application_Proxy_95" rel="nofollow">2.1Web应用代理（Web Application Proxy）</a></li><li><a href="#22JobHistoryServer_122" rel="nofollow">2.2JobHistoryServer历史服务器</a></li><li><ul><li><a href="#221JobHistoryServer_128" rel="nofollow">2.2.1JobHistoryServer历史服务器功能</a></li><li><a href="#222JobHistoryServer_134" rel="nofollow">2.2.2JobHistoryServer配置</a></li></ul> 
   </li></ul> 
   </li><li><a href="#3MapReduceYARN_171" rel="nofollow">3.MapReduce的配置＆YARN的部署</a></li><li><ul><li><a href="#31_173" rel="nofollow">3.1部署说明</a></li><li><a href="#32_175" rel="nofollow">3.2集群规划</a></li><li><a href="#33MapReduce_177" rel="nofollow">3.3MapReduce配置文件</a></li><li><a href="#34YARN_246" rel="nofollow">3.4YARN配置文件</a></li><li><a href="#35_340" rel="nofollow">3.5分发配置文件</a></li><li><a href="#36_357" rel="nofollow">3.6集群启动命令介绍</a></li></ul> 
  </li></ul> 
  </li><li><a href="#MapReduceYARN_381" rel="nofollow">四、MapReduce＆YARN初体验</a></li><li><ul><li><a href="#1_383" rel="nofollow">1.集群启停命令</a></li><li><ul><li><a href="#11_385" rel="nofollow">1.1一键启动脚本</a></li><li><a href="#12_401" rel="nofollow">1.2单进程启停</a></li></ul> 
   </li><li><a href="#2MapReduceYARN_413" rel="nofollow">2.提交MapReduce任务到YARN执行</a></li><li><ul><li><a href="#21wordcount_443" rel="nofollow">2.1提交wordcount示例程序</a></li><li><ul><li><a href="#211_509" rel="nofollow">2.1.1报错记录</a></li><li><ul><li><a href="#2111__orgapachehadoopyarnexceptionsYarnException_Failed_to_submit_application_1680768899138_0002_to_YARN__root_is_not_a_leaf_queue_511" rel="nofollow">2.1.1.1 org.apache.hadoop.yarn.exceptions.YarnException: Failed to submit application_1680768899138_0002 to YARN : root is not a leaf queue</a></li><li><a href="#2112_orgapachehadoophdfsBlockMissingException_Could_not_obtain_block_BP21108991441006681281682069026390blk_1073741825_1001_fileinputwordstxt_No_live_nodes_contain_current_block_Block_locations_Dead_nodes_522" rel="nofollow">2.1.1.2 org.apache.hadoop.hdfs.BlockMissingException: Could not obtain block: BP-2110899144-100.66.8.128-1682069026390:blk_1073741825_1001 file=/input/words.txt No live nodes contain current block Block locations: Dead nodes:</a></li></ul> 
     </li><li><a href="#212_572" rel="nofollow">2.1.2查看运行日志</a></li></ul> 
    </li><li><a href="#22_599" rel="nofollow">2.2.提交求圆周率示例程序</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="MapReduce_2"></a>一、MapReduce概述</h2> 
<h3><a id="1_MapReduce_4"></a>1.分布式计算框架- MapReduce</h3> 
<p>MapReduce是“分散-&gt;汇总”模式的分布式计算框架，可供开发人员开发相关程序进行分布式数据计算。</p> 
<p>MapReduce提供了2个编程接口：</p> 
<p>•Map</p> 
<p>•Reduce</p> 
<p>其中</p> 
<p>•Map功能接口提供了“分散”的功能， 由服务器分布式对数据进行处理</p> 
<p>•Reduce功能接口提供了“汇总（聚合）”的功能，将分布式的处理结果汇总统计</p> 
<p>用户如需使用MapReduce框架完成自定义需求的程序开发</p> 
<p>只需要使用Java、Python等编程语言，实现Map Reduce功能接口即可。</p> 
<p><em>•注：MapReduce尽管可以通过Java、Python等语言进行程序开发，但当下年代基本没人会写它的代码了，因为太过时了。尽管MapReduce很老了，但现在仍旧活跃在一线，主要是Apache Hive框架非常火，而Hive底层就是使用的MapReduce。所以对于MapReduce的代码开发，课程会简单扩展一下，但不会深入讲解，对MapReduce的底层原理会放在Hive之后，基于Hive做深入分析。</em></p> 
<h3><a id="2MapReduce_26"></a>2.MapReduce执行原理</h3> 
<p>假定有4台服务器用以执行MapReduce任务</p> 
<p>可以3台服务器执行Map，1台服务器执行Reduce<br> <img src="https://images2.imgbox.com/07/57/H5TJV3tR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3MapReduce_32"></a>3.MapReduce的运行机制</h3> 
<p>•将要执行的需求，分解为多个Map Task和Reduce Task</p> 
<p>•将Map Task 和 Reduce Task分配到对应的服务器去执行</p> 
<h2><a id="YARN_38"></a>二、YARN概述</h2> 
<h3><a id="1_40"></a>1.资源调度</h3> 
<p>**资源：**服务器硬件资源，如：CPU、内存、硬盘、网络等</p> 
<p>**资源调度：**管控服务器硬件资源，提供更好的利用率</p> 
<p>**分布式资源调度：**管控整个分布式服务器集群的全部资源，整合进行统一调度</p> 
<h3><a id="2YARN_48"></a>2.YARN的资源调度</h3> 
<p>YARN是Hadoop中用来进行集群的资源（内存、CPU等）调度的一个组件，可以将资源统一管控进行分配进而提高资源的利用率。<br> <img src="https://images2.imgbox.com/c8/d6/6bJvJ2My_o.png" alt="在这里插入图片描述"><br> 这就是 Hadoop YARN框架的作用，调度整个服务器集群的资源统一管理</p> 
<p>YARN 管控整个集群的资源进行调度， 那么应用程序在运行时，就是在YARN的监管（管理）下去运行的。</p> 
<p>这就像：全部资源都是公司（YARN）的，由公司分配给个人（具体的程序）去使用。<br> <img src="https://images2.imgbox.com/d5/91/7I9ML4j3_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/ef/21/i0Tpudgb_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3MapReduceYARN_59"></a>3.MapReduce和YARN的关系</h3> 
<p>•YARN用来调度资源给MapReduce分配和管理运行资源</p> 
<p>•所以，MapReduce需要YARN才能执行（普遍情况）</p> 
<h2><a id="YARN_65"></a>三、YARN架构</h2> 
<h3><a id="1YARN_67"></a>1.YARN核心架构</h3> 
<p>•HDFS， 主从架构，有2个角色</p> 
<p>•主（Master）角色：NameNode</p> 
<p>•从（Slave）角色 ：DataNode<br> <img src="https://images2.imgbox.com/98/6a/7YPUiDVc_o.png" alt="在这里插入图片描述"><br> •YARN，主从架构，有2个角色</p> 
<p>•主（Master）角色：ResourceManager</p> 
<p>•从（Slave） 角色：NodeManager<br> <img src="https://images2.imgbox.com/b4/c3/8Y5qitC7_o.png" alt="在这里插入图片描述"><br> •ResourceManager：整个集群的资源调度者， 负责协调调度各个程序所需的资源。</p> 
<p>•NodeManager：单个服务器的资源调度者，负责调度单个服务器上的资源提供给应用程序使用。</p> 
<p><img src="https://images2.imgbox.com/7c/f9/rZ67jwzV_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="11YARN_86"></a>1.1.YARN容器</h4> 
<p><img src="https://images2.imgbox.com/a8/55/he8ZFI7D_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/2e/43/3e9XD7vC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2YARN_89"></a>2.YARN辅助架构</h3> 
<p>•代理服务器(ProxyServer)：Web Application Proxy Web应用程序代理</p> 
<p>•历史服务器(JobHistoryServer)： 应用程序历史信息记录服务</p> 
<h4><a id="21WebWeb_Application_Proxy_95"></a>2.1Web应用代理（Web Application Proxy）</h4> 
<p>代理服务器，即Web应用代理是 YARN 的一部分。默认情况下，它将作为资源管理器(RM)的一部分运行，但是可以配置为在独立模式下运行。使用代理的原因是为了减少通过 YARN 进行基于网络的攻击的可能性。</p> 
<p>这是因为， YARN在运行时会提供一个WEB UI站点（同HDFS的WEB UI站点一样）可供用户在浏览器内查看YARN的运行信息<br> <img src="https://images2.imgbox.com/5e/05/ocKDjnFS_o.png" alt="在这里插入图片描述"><br> 对外提供WEB 站点会有安全性问题， 而代理服务器的功能就是最大限度保障对WEB UI的访问是安全的。 比如：</p> 
<p>•警告用户正在访问一个不受信任的站点</p> 
<p>•剥离用户访问的Cookie等</p> 
<p>开启代理服务器，可以提高YARN在开放网络中的安全性 （但不是绝对安全只能是辅助提高一些）</p> 
<p>代理服务器默认集成在了ResourceManager中</p> 
<p>也可以将其分离出来单独启动，如果要分离代理服务器</p> 
<p>①在<code>yarn-site.xml</code>中配置 <code>yarn.web-proxy.address</code> 参数即可 （部署环节会使用到）</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.web-proxy.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:8089<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>代理服务器主机和端口<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="22JobHistoryServer_122"></a>2.2JobHistoryServer历史服务器</h4> 
<p>记录历史运行的程序的信息以及产生的日志并提供WEB UI站点供用户使用浏览器查看。</p> 
<p><img src="https://images2.imgbox.com/1d/26/0kSFTsDO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1b/24/OcexeacY_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="221JobHistoryServer_128"></a>2.2.1JobHistoryServer历史服务器功能</h5> 
<p>•提供WEB UI站点，供用户在浏览器上查看程序日志</p> 
<p>•可以保留历史数据，随时查看历史运行程序信息</p> 
<h5><a id="222JobHistoryServer_134"></a>2.2.2JobHistoryServer配置</h5> 
<p>•开启日志聚合，即从容器中抓取日志到HDFS集中存储</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log-aggregation-enable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>开启日志聚合<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.remote-app-log-dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/tmp/logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>程序日志HDFS的存储路径<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>•配置历史服务器端口和主机</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.jobhistory.webapp.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:19888<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>历史服务器web端口为master:19888<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.jobhistory.webapp.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:19888<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>历史服务器web端口为master:19888<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="3MapReduceYARN_171"></a>3.MapReduce的配置＆YARN的部署</h3> 
<h4><a id="31_173"></a>3.1部署说明</h4> 
<p><img src="https://images2.imgbox.com/b2/40/UkyAF6K1_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="32_175"></a>3.2集群规划</h4> 
<p><img src="https://images2.imgbox.com/c6/98/r32OZPT1_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="33MapReduce_177"></a>3.3MapReduce配置文件</h4> 
<p>在 <code>$HADOOP_HOME/etc/hadoop</code> 文件夹内，修改：</p> 
<p>•<code>mapred-env.sh</code>文件，添加如下环境变量</p> 
<pre><code class="prism language-bash"><span class="token comment">#设置JDK路径</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/jdk/jdk1.8.0_212
<span class="token comment">#设置JobHistoryServer进程内存为1G</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_JOB_HISTORYSERVER_HEAPSIZE</span><span class="token operator">=</span><span class="token number">1000</span>
<span class="token comment">#设置日志级别为INFO</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_MAPRED_ROOT_LOGGER</span><span class="token operator">=</span>INFO,RFA
</code></pre> 
<p>•<code>mapred-site.xml</code>文件，添加如下配置信息</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.framework.name<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>yarn<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>MapReduce的运行框架设置为YARN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.jobhistory.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:10020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>历史服务器通讯端口为master:10020<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.jobhistory.webapp.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:19888<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>历史服务器web端口为master:19888<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.jobhistory.intermediate-done-dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/data/mr-history/tmp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>历史信息在HDFS的记录临时路径<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.jobhistory.done-dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/data/mr-history/done<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>历史信息在HDFS的记录路径<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.app.mapreduce.am.env<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>HADOOP_MAPRED_HOME=$HADOOP_HOME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>MapReduce HOME设置为HADOOP_HOME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.map.env<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>HADOOP_MAPRED_HOME=$HADOOP_HOME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>MapReduce HOME设置为HADOOP_HOME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>mapreduce.reduce.env<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>HADOOP_MAPRED_HOME=$HADOOP_HOME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>MapReduce HOME设置为HADOOP_HOME<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="34YARN_246"></a>3.4YARN配置文件</h4> 
<p>在 <code>$HADOOP_HOME/etc/hadoop</code> 文件夹内，修改：</p> 
<p>•<code>yarn-env.sh</code>文件，添加如下4行环境变量内容：</p> 
<pre><code class="prism language-bash"><span class="token comment">#设置JDK路径的环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">JAVA_HOME</span><span class="token operator">=</span>/opt/jdk/jdk1.8.0_212
<span class="token comment">#设置HADOOP_HOME的环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_HOME</span><span class="token operator">=</span>/opt/hadoop/hadoop-3.3.5
<span class="token comment">#设置配置文件路径的环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CONF_DIR</span><span class="token operator">=</span>/opt/hadoop/hadoop-3.3.5/etc/hadoop
<span class="token comment">#设置日志文件路径的环境变量</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_LOG_DIR</span><span class="token operator">=</span>/opt/hadoop/hadoop-3.3.5/logs
</code></pre> 
<p>•<code>yarn-site.xml</code>文件，配置如图属性</p> 
<pre><code class="prism language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourceemanager.hostname<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>ResourceManager设置在master节点<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.local-dirs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/data/nm-local<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>NodeManager中间数据本地存储路径<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.log-dirs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/data/nm-log<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>NodeManager数据日志本地存储路径<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>mapreduce_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>为MapReduce程序开启Shuffle服务<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:8032<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.scheduler.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:8030<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.resource-tracker.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:8031<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.admin.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:18141<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.webapp.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:18088<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log.server.url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>http://master:19888/jobhistory/logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>历史服务器URL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.web-proxy.address<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>master:8089<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>代理服务器主机和端口<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log-aggregation-enable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>开启日志聚合<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.remote-app-log-dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/tmp/logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>程序日志HDFS的存储路径<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.scheduler.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.fair.FairScheduler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>选择公平调度器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>但是实际操作时发现如果调度器设置成选择公平调度器的话，在使用wordcount示例程序时会报错<code>org.apache.hadoop.yarn.exceptions.YarnException: Failed to submit application_1680768899138_0002 to YARN : root is not a leaf queue</code>，此时需要在yarn-site中使用如下配置将调度器改为容量调度器：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>容量调度器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.scheduler.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h4><a id="35_340"></a>3.5分发配置文件</h4> 
<p>MapReduce和YARN的配置文件修改好后，需要分发到其它的服务器节点中。</p> 
<pre><code class="prism language-bash"><span class="token function">scp</span> mapred-env.sh <span class="token assign-left variable">mapred</span><span class="token operator">=</span>site.xml yarn-env.sh yarn-site.xml node0:<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/
<span class="token function">scp</span> mapred-env.sh <span class="token assign-left variable">mapred</span><span class="token operator">=</span>site.xml yarn-env.sh yarn-site.xml node1:<span class="token variable"><span class="token variable">`</span><span class="token builtin class-name">pwd</span><span class="token variable">`</span></span>/
</code></pre> 
<p><img src="https://images2.imgbox.com/27/77/wrYSjMiD_o.png" alt="在这里插入图片描述"><br> 当这些步骤做完后报错：<br> ERROR: Attempting to operate on yarn proxyserver as root<br> ERROR: but there is no YARN_PROXYSERVER_USER defined. Aborting operation.<br> <img src="https://images2.imgbox.com/51/3f/jNASFuvz_o.png" alt="在这里插入图片描述"><br> 可以在cd到/opt/hadoop/hadoop-3.3.5/sbin修改start-yarn.sh和stop-yarn.sh，在两个页面的开头加上<code>YARN_PROXYSERVER_USER=root</code><br> <img src="https://images2.imgbox.com/a1/f5/qrpjzF6Q_o.png" alt="在这里插入图片描述"><br> 启动成功后界面如下：<br> <img src="https://images2.imgbox.com/48/f3/d5eoytHg_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="36_357"></a>3.6集群启动命令介绍</h4> 
<p>常用的进程启动命令如下：</p> 
<p>•<strong>一键启动YARN集群</strong>： <code>$HADOOP_HOME/sbin/start-yarn.sh</code></p> 
<p>•会基于yarn-site.xml中配置的yarn.resourcemanager.hostname来决定在哪台机器上启动resourcemanager</p> 
<p>•会基于workers文件配置的主机启动NodeManager</p> 
<p>•<strong>一键停止YARN集群</strong>： <code>$HADOOP_HOME/sbin/stop-yarn.sh</code></p> 
<p><strong>•在当前机器，单独启动或停止进程</strong></p> 
<p>•<code>$HADOOP_HOME/bin/yarn --daemon start|stop resourcemanager|nodemanager|proxyserver</code></p> 
<p>•start和stop决定启动和停止</p> 
<p>•可控制resourcemanager、nodemanager、proxyserver三种进程</p> 
<p>•<strong>历史服务器启动和停止</strong></p> 
<p>•<code>$HADOOP_HOME/bin/mapred --daemon start|stop historyserver</code></p> 
<h2><a id="MapReduceYARN_381"></a>四、MapReduce＆YARN初体验</h2> 
<h3><a id="1_383"></a>1.集群启停命令</h3> 
<h4><a id="11_385"></a>1.1一键启动脚本</h4> 
<p><strong>启动：</strong></p> 
<p><code>$HADOOP_HOME/sbin/start-yarn.sh</code></p> 
<p>•从yarn-site.xml中读取配置，确定ResourceManager所在机器，并启动它</p> 
<p>•读取workers文件，确定机器，启动全部的NodeManager</p> 
<p>•在当前机器启动ProxyServer（代理服务器）</p> 
<p><strong>关闭</strong></p> 
<p><code>$HADOOP_HOME/sbin/stop-yarn.sh</code></p> 
<h4><a id="12_401"></a>1.2单进程启停</h4> 
<p>除了一键启停外，也可以单独控制进程的启停。</p> 
<p>•<code>$HADOOP_HOME/bin/yarn</code>，此程序也可以用以单独控制所在机器的进程的启停</p> 
<p>用法：<code>yarn --daemon (start|stop) (resourcemanager|nodemanager|proxyserver)</code></p> 
<p>•<code>$HADOOP_HOME/bin/mapred</code>，此程序也可以用以单独控制所在机器的<font color="FF000">历史服务器</font>的启停</p> 
<p>用法：<code>mapred --daemon (start|stop) historyserver</code></p> 
<h3><a id="2MapReduceYARN_413"></a>2.提交MapReduce任务到YARN执行</h3> 
<p>YARN作为资源调度管控框架，其本身提供资源供许多程序运行，常见的有：</p> 
<p>•MapReduce程序</p> 
<p>•Spark程序</p> 
<p>•Flink程序</p> 
<p>Hadoop官方内置了一些预置的MapReduce程序代码，我们无需编程，只需要通过命令即可使用。</p> 
<p>常用的有2个MapReduce内置程序：</p> 
<p>•wordcount：单词计数程序。</p> 
<p>统计指定文件内各个单词出现的次数</p> 
<p>•pi：求圆周率</p> 
<p>通过蒙特卡罗算法（统计模拟法）求圆周率</p> 
<p>•这些内置的示例MapReduce程序代码，都在：</p> 
<p><code>$HADOOP_HOME/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.1.jar</code> 这个文件内。</p> 
<p>•可以通过 hadoop jar 命令来运行它，提交MapReduce程序到YARN中。</p> 
<p>语法： <code>hadoop jar 程序文件 java类名 [程序参数] ... [程序参数]</code></p> 
<h4><a id="21wordcount_443"></a>2.1提交wordcount示例程序</h4> 
<p>单词计数示例程序的功能很简单：</p> 
<p>•给定数据输入的路径（HDFS）、给定结果输出的路径（HDFS）</p> 
<p>•将输入路径内的数据中的单词进行计数，将结果写到输出路径</p> 
<p>我们可以准备一份数据文件，并上传到HDFS中。</p> 
<p>参照黑马的教程，在Linux中创建一份如下的txt文件命名为words.txt并上传到HDFS中</p> 
<p>text文件：</p> 
<pre><code>itheima itcast itheima itcast
hadoop hdfs hadoop hdfs
hadoop mapreduce hadoop yarn
itheima hadoop itcast hadoop
itheima itcast hadoop yarn mapreduce
</code></pre> 
<p>将上述文件上传到HDFS中：</p> 
<pre><code class="prism language-bash"><span class="token comment">#hdfs中创建一个input文件夹用于放入输入的文件，创建一个output文件夹用于存放输出的文件</span>
hadoop fs -mkdir -p /input/wordcount
hadoop fs -mkdir /output
hadoop fs -put /opt/data/words.txt /input/wordcount/
</code></pre> 
<p>执行如下命令，提交示例MapReduce程序WordCount到YARN中执行：</p> 
<pre><code class="prism language-bash">hadoop jar <span class="token variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.5.jar wordcount hdfs://master:9002/input/wordcount/ hdfs://master:9002/output/wc1
<span class="token comment">#hadoop jar 程序文件 java类名 [程序参数] ... [程序参数]</span>
</code></pre> 
<p>注意：</p> 
<p>•参数wordcount，表示运行jar包中的单词计数程序（Java Class）</p> 
<p>•参数1是数据输入路径（hdfs://master:9002/input/wordcount/)</p> 
<p>•参数2是结果输出路径(hdfs://master:9002/output/wc1)， <font color="FF000">需要确保输出的文件夹不存在</font></p> 
<p>如果不知道路径，可以在<code>core-site.xml</code>中的fs.defaultFS中读取：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.defaultFS<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>hdfs://master:9002<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>•在执行前要确保主机节点除JPS外要有如下的6个节点：<br> <img src="https://images2.imgbox.com/db/74/PXDZ2l17_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/b5/09/HYZwjTlY_o.png" alt="在这里插入图片描述"><br> 运行结束后输入<code>hadoop fs -ls /output/wc1</code>可以看到生成两个文件，第一个文件名代表运行成功，第二个文件为运行结果<br> <img src="https://images2.imgbox.com/21/b1/wFCR7AEq_o.png" alt="在这里插入图片描述"><br> 输入<code>hadoop fs -cat /output/wc1/part-r-00000</code>可以看到结果：<br> <img src="https://images2.imgbox.com/64/7b/WkMXl7uY_o.png" alt="在这里插入图片描述"><br> 也可在web页查看状态(http://master:8088/cluster)：<br> <img src="https://images2.imgbox.com/66/8f/rSqQg0m5_o.png" alt="在这里插入图片描述"><br> 执行完成后，可以借助历史服务器查看到程序的历史运行信息</p> 
<p><em>ps：如果没有启动历史服务器和代理服务器，此操作无法完成（页面信息由历史服务器提供，鼠标点击跳转到新网页功能由代理服务器提供）</em><br> <img src="https://images2.imgbox.com/cc/ff/9Bzmqs5K_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c4/11/IdmZr1eS_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/37/52/N2JpEvZh_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="211_509"></a>2.1.1报错记录</h5> 
<h6><a id="2111__orgapachehadoopyarnexceptionsYarnException_Failed_to_submit_application_1680768899138_0002_to_YARN__root_is_not_a_leaf_queue_511"></a>2.1.1.1 org.apache.hadoop.yarn.exceptions.YarnException: Failed to submit application_1680768899138_0002 to YARN : root is not a leaf queue</h6> 
<p>**解决方法：**在yarn-site中将调度器改为容量调度器并重启dfs和yarn，代码如下：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>容量调度器<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.scheduler.class<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.yarn.server.resourcemanager.scheduler.capacity.CapacityScheduler<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h6><a id="2112_orgapachehadoophdfsBlockMissingException_Could_not_obtain_block_BP21108991441006681281682069026390blk_1073741825_1001_fileinputwordstxt_No_live_nodes_contain_current_block_Block_locations_Dead_nodes_522"></a>2.1.1.2 org.apache.hadoop.hdfs.BlockMissingException: Could not obtain block: BP-2110899144-100.66.8.128-1682069026390:blk_1073741825_1001 file=/input/words.txt No live nodes contain current block Block locations: Dead nodes:</h6> 
<p><img src="https://images2.imgbox.com/e1/61/dvdM3B0C_o.png" alt="在这里插入图片描述"><br> **解决办法1：**查看节点是否掉了，如果掉了重启Hadoop或者单独启动掉了的节点</p> 
<p>**解决办法2：**删除受损block</p> 
<pre><code class="prism language-bash">hadoop <span class="token function">fsck</span> /你的path  将报错中file后面的路径粘贴过来即可

<span class="token comment">#运行后会显示受损块文件的相关信息</span>
/你的path: MISSING <span class="token number">1</span> blocks of total size <span class="token number">69</span> B.Status: CORRUPT
 Total size:	<span class="token number">69</span> B
 Total dirs:	<span class="token number">0</span>
 Total files:	<span class="token number">1</span>
 Total symlinks:		<span class="token number">0</span>
 Total blocks <span class="token punctuation">(</span>validated<span class="token punctuation">)</span>:	<span class="token number">1</span> <span class="token punctuation">(</span>avg. block size <span class="token number">69</span> B<span class="token punctuation">)</span>
  ********************************
  CORRUPT FILES:	<span class="token number">1</span>
  MISSING BLOCKS:	<span class="token number">1</span>
  MISSING SIZE:		<span class="token number">69</span> B
  CORRUPT BLOCKS: 	<span class="token number">1</span>
  ********************************
 Minimally replicated blocks:	<span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> %<span class="token punctuation">)</span>
 Over-replicated blocks:	<span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> %<span class="token punctuation">)</span>
 Under-replicated blocks:	<span class="token number">0</span> <span class="token punctuation">(</span><span class="token number">0.0</span> %<span class="token punctuation">)</span>
 Mis-replicated blocks:		<span class="token number">1</span> <span class="token punctuation">(</span><span class="token number">100.0</span> %<span class="token punctuation">)</span>
 Default replication factor:	<span class="token number">3</span>
 Average block replication:	<span class="token number">0.0</span>
 Corrupt blocks:		<span class="token number">1</span>
 Missing replicas:		<span class="token number">0</span>
 Number of data-nodes:		<span class="token number">31</span>
 Number of racks:		<span class="token number">2</span>
FSCK ended at Thu Apr <span class="token number">14</span> <span class="token number">13</span>:37:15 CST <span class="token number">2022</span> <span class="token keyword">in</span> <span class="token number">25</span> milliseconds


The filesystem under path <span class="token string">'/你的path'</span> is CORRUPT    
<span class="token comment">#CORRUPT说明文件受损</span>
</code></pre> 
<p>有可能当前路径下的受损block不止一个</p> 
<pre><code class="prism language-shell">hadoop <span class="token function">fsck</span> /path -list-corruptfileblocks  
<span class="token comment">#运行后可以输出当前路径下所有的受损文件块</span>
</code></pre> 
<p>删除损坏的block</p> 
<pre><code class="prism language-bash">hadoop <span class="token function">fsck</span> /path -delete
</code></pre> 
<p>**解决办法3：**删除txt文件重新上传（我是用这个方法解决的）</p> 
<h5><a id="212_572"></a>2.1.2查看运行日志</h5> 
<p>点击logs链接，可以查看到详细的运行日志信息。<br> <img src="https://images2.imgbox.com/29/32/3u0xutid_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/37/a0/KcxR7IU0_o.png" alt="在这里插入图片描述"><br> 此功能基于：</p> 
<p>①配置文件<code>yarn-site.xml</code>中配置了日志聚合功能，并设置了历史服务器</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log.server.url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>http://master:19888/jobhistory/logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>历史服务器URL<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log-aggregation-enable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>开启日志聚合<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>②启动了代理服务器和历史服务器</p> 
<p>③历史服务器进程会将日志收集整理，形成可以查看的网页内容供我们查看。</p> 
<p>所以，如果发现无法查看程序运行历史以及无法查看程序运行日志信息，请检查上述1、2、3是否都正确设置。</p> 
<h4><a id="22_599"></a>2.2.提交求圆周率示例程序</h4> 
<p>可以执行如下命令，使用蒙特卡罗算法模拟计算求PI（圆周率）</p> 
<pre><code class="prism language-bash">hadoop jar <span class="token variable">$HADOOP_HOME</span>/share/hadoop/mapreduce/hadoop-mapreduce-examples-3.3.5.jar pi <span class="token number">3</span> <span class="token number">1000</span>
</code></pre> 
<p>•参数pi表示要运行的Java类，这里表示运行jar包中的求pi程序</p> 
<p>•参数3，表示设置几个map任务</p> 
<p>•参数1000，表示模拟求PI的样本数（越大求的PI越准确，但是速度越慢）<br> <img src="https://images2.imgbox.com/fb/78/7vClLdUU_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/23/47/RpOeXZBk_o.png" alt="在这里插入图片描述"><br> 最后结果为3.141333333333333333333，因为样本数1000太小了所以不够精准，增加样本数可以增加准确度但运行时间也会增加</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b95b8a515c927ac54b60c8a65dbd5207/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">遗传算法 (Genetic Algorithm, GA)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d763d04b8785660144d8782005b58904/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue&#43;js&#43;html实现购物车总价求和</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>