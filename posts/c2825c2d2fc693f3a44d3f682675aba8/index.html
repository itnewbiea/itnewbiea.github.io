<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>(21)多线程实例应用:双色球(6红&#43;1蓝) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="(21)多线程实例应用:双色球(6红&#43;1蓝)" />
<meta property="og:description" content="一、需求 1.双色球: 投注号码由6个红色球号码和1个蓝色球号码组成。
2.红色球号码从01--33中选择,红色球不能重复。
3.蓝色球号码从01--16中选择。
4.最终结果7个号码：6&#43;1；即33选6(红)&#43; 16选1(蓝)
5.产品: 能用；用户放心使用;
原则：靠运气，不能有暗箱操作，号码开奖的随机性。
6.做法思路：
（1）从左往右---有序变化
（2）从右往左---有序变化
（3）同一时刻，球号码都变化~~
（4）可以做到让所有的球都变化，且都是相互独立的变化，随机性（推荐）
二、程序 1、界面:6个红球label显示LblRedNum1-LblRedNum6，一个蓝球LblBlue。
两个Button,BtnStart与BtnStop。一个listBox1.
2、代码：
private string[] redNums = Enumerable.Range(1, 33).Select(i =&gt; i.ToString(&#34;00&#34;)).ToArray(); private string[] blueNums = Enumerable.Range(1, 16).Select(i =&gt; i.ToString(&#34;00&#34;)).ToArray(); private object lockObj = new object(); private List&lt;Task&gt; tasks = new List&lt;Task&gt;(); private CancellationTokenSource cts; private async void BtnStart_Click(object sender, EventArgs e) { BtnStart.Enabled = false; BtnStop.Enabled = true; cts = new CancellationTokenSource(); CancellationToken ct = cts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c2825c2d2fc693f3a44d3f682675aba8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-15T15:29:11+08:00" />
<meta property="article:modified_time" content="2023-09-15T15:29:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">(21)多线程实例应用:双色球(6红&#43;1蓝)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>    </p> 
<h3><br><span style="color:#fe2c24;"><strong>一、需求</strong></span></h3> 
<p><br>   <strong>  1.双色球: </strong>投注号码由6个红色球号码和1个蓝色球号码组成。<br>     <br>  <strong>   2.红色球号码从01--33中选择,红色球不能重复。</strong><br>     <br>    <strong> 3.蓝色球号码从01--16中选择。</strong><br>         <br>    <strong> 4.最终结果7个号码</strong>：6+1；即33选6(红)+ 16选1(蓝)<br>         <br>    <strong> 5.产品: </strong><br>         能用；用户放心使用;<br>         原则：靠运气，不能有暗箱操作，号码开奖的随机性。<br>         <br>  <strong>   6.做法思路：</strong><br>         （1）从左往右---有序变化<br>         （2）从右往左---有序变化<br>         （3）同一时刻，球号码都变化~~<br>         <strong>（4）可以做到让所有的球都变化，且都是相互独立的变化，随机性（推荐）</strong></p> 
<h3><br><span style="color:#fe2c24;"><strong>二、程序</strong></span></h3> 
<p><br>    <strong> 1、界面:</strong>6个红球label显示LblRedNum1-LblRedNum6，一个蓝球LblBlue。<br>         两个Button,BtnStart与BtnStop。一个listBox1.</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c2/6e/PDp4HfMs_o.gif"></p> 
<p><br>         <br>   <strong>  2、代码：</strong></p> 
<pre><code class="language-cs">        private string[] redNums = Enumerable.Range(1, 33).Select(i =&gt; i.ToString("00")).ToArray();
        private string[] blueNums = Enumerable.Range(1, 16).Select(i =&gt; i.ToString("00")).ToArray();
        private object lockObj = new object();
        private List&lt;Task&gt; tasks = new List&lt;Task&gt;();
        private CancellationTokenSource cts;

        private async void BtnStart_Click(object sender, EventArgs e)
        {
            BtnStart.Enabled = false;
            BtnStop.Enabled = true;
            cts = new CancellationTokenSource();
            CancellationToken ct = cts.Token;

            //初始化，置00
            foreach (Label lbl in Controls.OfType&lt;Label&gt;().Where(b =&gt; b.Name.Contains("Red")))
            { lbl.Text = "00"; }

            //开7个线程
            foreach (Label lbl in Controls.OfType&lt;Label&gt;())
            {
                if (lbl.Name.Contains("Blue"))
                {
                    tasks.Add(Task.Run(async () =&gt;//蓝球显示
                    {
                        while (!ct.IsCancellationRequested)
                        {
                            await Task.Delay(200);
                            string strBlue = blueNums[GetRandom(0, 16)];
                            lbl.Invoke(new Action(() =&gt;
                            {
                                lbl.Text = strBlue;
                            }));
                        }
                    }));
                }
                else
                {
                    tasks.Add(Task.Run(async () =&gt;//红球显示
                     {
                         while (!ct.IsCancellationRequested)
                         {
                             await Task.Delay(200);
                             int idx = GetRandom(0, 33);
                             string strRed = redNums[idx];
                             lock (lockObj)
                             {
                                 List&lt;string&gt; list = GetCurNumList();
                                 if (!list.Contains(strRed))
                                 {
                                     lbl.Invoke(new Action(() =&gt; { lbl.Text = strRed; }));
                                     redNums[idx] = strRed;
                                 }
                             }
                         }
                     }));
                }
            }

            await Task.Run(() =&gt;//任务取消时显示
                 {
                     Task.WaitAll(tasks.ToArray());
                     Invoke(new Action(() =&gt;
                     {
                         List&lt;string&gt; list = new List&lt;string&gt;();
                         foreach (Label lbl in this.Controls.OfType&lt;Label&gt;().Where(b =&gt; b.Name.Contains("Red")))
                         {
                             list.Add(lbl.Text);
                         }
                         list.Sort();
                         list.Add(LblBlue.Text);
                         listBox1.Items.Add(string.Join(",", list.ToArray()));
                     })
                     );
                 });
        }

        private List&lt;string&gt; GetCurNumList()//返回当前红球列表
        {
            List&lt;string&gt; list = new List&lt;string&gt;();
            foreach (Label lbl in this.Controls.OfType&lt;Label&gt;().Where(b =&gt; b.Name.Contains("Red")))
            { Invoke(new Action(() =&gt; { list.Add(lbl.Text); })); }

            return list;
        }

        private int GetRandom(int min, int max)//产生强随机数
        {
            byte[] bytes = new byte[4];
            using (var rng = RandomNumberGenerator.Create())
            { rng.GetBytes(bytes); }

            int seed = BitConverter.ToInt32(bytes, 0);
            return new Random(seed).Next(min, max);
        }

        private void BtnStop_Click(object sender, EventArgs e)
        {
            cts.Cancel();
            BtnStart.Enabled = true;
            BtnStop.Enabled = false;
        }

        private void Form1_Load(object sender, EventArgs e)
        { BtnStop.Enabled = false; }</code></pre> 
<p></p> 
<h3><br><span style="color:#fe2c24;"><strong>三、细节</strong></span></h3> 
<p><br>    <strong> 1、创建两个数组</strong>，根据随机产生的索引，从而得到随机的数。<br>         比如，随机产生索引3，那么对于红球redNum[3]就是随机的产生的数<br>         <br>         随机数用强随机数。根据自定义返回对应的字节。因为需要种子seed是int，所以需要4个字节即可，然后用BitConvert静态函数转换得取seed，从而产生较为真实的随机数。<br>         <br>   <strong>  2、蓝球用一个线程，红球用6个线程同时运行。</strong><br>         蓝球，不用管。<br>         红球来自01-33不能重复，因此每次都得从6个红球中比较是否有相同的，相同则再次重新产生，直到得到6个不同的数为止。<br>         6个线程一样这样操作，但容易竞争，比如都比较出与当前6个label数字不一样的，但这两个线程都产生的是相同的数字，比如是5，那么最后就会有重复的情况，为此设置互斥锁，产生数字时只准一个线程进去，改变当前label列表后，再退出，第二个线程再进去比较，得出不同后更新列表，再退出，如此循环，可使当前label的数字一直不同。<br>         <br>    <strong> 3、结果显示。</strong><br>         为了防止死锁，开一个子线程来等待前面7个线程的结束，并使用await防止假死。<br>         <br>         另外，对6个红球排序后，把蓝球放在最末，加入listbox1显示。（不能全部排序，红蓝是两部分）<br>     <br>   </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ead2dc37feddca6df79dfc25c9c25084/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">使用mediasoup-demo搭建多人音视频聊天室</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ded3a136c75dc52a1b9e0d9a621e800a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue - 将页面内容下载为 pdf 格式文件（html2canvas &#43; jspdf）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>