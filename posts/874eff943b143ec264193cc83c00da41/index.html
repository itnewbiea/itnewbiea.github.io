<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【原创文章】JAVA-POI实现EXCEL下拉框的级联（POI生成Excel中带有可级联的下拉框） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【原创文章】JAVA-POI实现EXCEL下拉框的级联（POI生成Excel中带有可级联的下拉框）" />
<meta property="og:description" content="原创文章，转载请注明原作者及出处链接，谢谢！
http://blog.csdn.net/wed840313
【实现思路】
首先我们来看一下Excel中是怎么实现下拉框的级联的：
1. 假设我们的Excel有两个sheet，第一个sheet需要有两个下拉框：地市、区县——其中区县作为地市的二级下拉框级联。下面是具体实现步骤：
2. 首先我们在“数据字典”这个sheet页中的B列为地市下拉框提供数据：
3. 然后我们继续在E列为区县的下拉框提供数据：（注意是所有的数据）
4. 下拉框数据准备好之后，我们需要在名称管理器中创建所谓的“名称”：
为地市下拉框创建名称：打开名称管理器，点击“新建”按钮，输入名称为“city”，引用的位置选择B列我们为地市下拉框提供的数据：
然后为区县下拉框创建名称：继续新建名称，名称起名为地市下拉框的第一个值“江苏”，引用的位置为E列中属于江苏的数据
继续新建名称，名称起名为地市下拉框的第二个值“宿迁”，引用位置为E列中属于宿迁的数据
如此反复，直到所有的地市名称与它所对应的区县数据关联起来。
5. 回到第一个sheet页中，选中需要添加“地市”下拉框的单元格
点击“数据”选项卡中的“数据有效性”
在允许一项中选择“序列”，来源中如图填写，与city名称关联起来
点击“确定”，我们可以看到地市的下拉框已经加上了：
6. 然后选中需要添加区县下拉框的单元格，点击“数据有效性”
允许一项选择“序列”，来源我们输入“INDIRECT”，后面括号中填写级联的父级下拉框，即这一行中的地市名称那个单元格
点击确定，级联工作至此完成
【POI实现】
有了Excel的实现方式，我们可以用同样的方式，在java后台生成这样的带有级联下拉框的EXCEL
我们准备如下方法：
在名称管理器中创建名称的方法：
/** * 创建名称 * @param wb * @param name * @param expression * @return */ public static HSSFName createName(HSSFWorkbook wb, String name, String expression){ HSSFName refer = wb.createName(); refer.setRefersToFormula(expression); refer.setNameName(name); return refer; } 设置数据有效性的方法：
/** * 设置数据有效性（通过名称管理器级联相关） * @param name * @param firstRow * @param endRow * @param firstCol * @param endCol * @return */ public static HSSFDataValidation setDataValidation(String name, int firstRow, int endRow, int firstCol, int endCol){ //设置下拉列表的内容 log." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/874eff943b143ec264193cc83c00da41/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2012-05-08T15:30:48+08:00" />
<meta property="article:modified_time" content="2012-05-08T15:30:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【原创文章】JAVA-POI实现EXCEL下拉框的级联（POI生成Excel中带有可级联的下拉框）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>原创文章，转载请注明原作者及出处链接，谢谢！</p> 
<p><br> </p> 
<p><a href="http://blog.csdn.net/wed840313">http://blog.csdn.net/wed840313</a><br> </p> 
<p><br> </p> 
<p>【实现思路】</p> 
<p>首先我们来看一下Excel中是怎么实现下拉框的级联的：</p> 
<p><span style="white-space:pre"></span>1. 假设我们的Excel有两个sheet，第一个sheet需要有两个下拉框：地市、区县——其中区县作为地市的二级下拉框级联。下面是具体实现步骤：</p> 
<p><img src="https://images2.imgbox.com/f7/1f/rvqJA7dY_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"></span><img src="" alt=""><br> </p> 
<p><span style="white-space:pre"></span>2. 首先我们在“数据字典”这个sheet页中的B列为地市下拉框提供数据：</p> 
<p><img src="https://images2.imgbox.com/6d/b9/2ONXB4Fv_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>3</span>. 然后我们继续在E列为区县的下拉框提供数据：（注意是所有的数据）</p> 
<p><img src="https://images2.imgbox.com/d9/7d/a2yYSnOB_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>4</span>. 下拉框数据准备好之后，我们需要在名称管理器中创建所谓的“名称”：</p> 
<p><img src="https://images2.imgbox.com/85/a7/WKRLp7uQ_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>为</span>地市下拉框创建名称：打开名称管理器，点击“新建”按钮，输入名称为“city”，引用的位置选择B列我们为地市下拉框提供的数据：</p> 
<p><img src="https://images2.imgbox.com/e5/7d/zV026l1H_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>然后</span>为区县下拉框创建名称：继续新建名称，名称起名为地市下拉框的第一个值“江苏”，引用的位置为E列中属于江苏的数据</p> 
<p><img src="https://images2.imgbox.com/01/67/n1NJlUf6_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>继续</span>新建名称，名称起名为地市下拉框的第二个值“宿迁”，引用位置为E列中属于宿迁的数据</p> 
<p><img src="https://images2.imgbox.com/5c/55/0CEu6fa7_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>如此</span>反复，直到所有的地市名称与它所对应的区县数据关联起来。</p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>5</span>. 回到第一个sheet页中，选中需要添加“地市”下拉框的单元格</p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>点击</span>“数据”选项卡中的“数据有效性”</p> 
<p><img src="https://images2.imgbox.com/fc/c1/hbg6wXDR_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>在</span>允许一项中选择“序列”，来源中如图填写，与city名称关联起来</p> 
<p><img src="https://images2.imgbox.com/66/7e/oiRwZyFL_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>点击</span>“确定”，我们可以看到地市的下拉框已经加上了：</p> 
<p><img src="https://images2.imgbox.com/9f/ef/gUd9B35y_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>6</span>. 然后选中需要添加区县下拉框的单元格，点击“数据有效性”</p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"></span>允许</span>一项选择“序列”，来源我们输入“INDIRECT”，后面括号中填写级联的父级下拉框，即这一行中的地市名称那个单元格</p> 
<p><img src="https://images2.imgbox.com/ea/08/wk2e6iZQ_o.jpg" alt=""><br> </p> 
<p><span style="white-space:pre"><span style="white-space:pre"><img src="" alt=""></span></span></p> 
<p><span style="white-space:pre"><span style="white-space:pre"><span style="white-space:pre"></span>点击</span>确定</span>，级联工作至此完成</p> 
<p><span style="white-space:pre"><img src="" alt=""></span></p> 
<p><span style="white-space:pre">【</span>POI实现】</p> 
<p>有了Excel的实现方式，我们可以用同样的方式，在java后台生成这样的带有级联下拉框的EXCEL</p> 
<p>我们准备如下方法：</p> 
<p>在名称管理器中创建名称的方法：</p> 
<p></p> 
<pre><code class="language-java">	/**
	 * 创建名称
	 * @param wb
	 * @param name
	 * @param expression
	 * @return
	 */
	public static HSSFName createName(HSSFWorkbook wb, String name, String expression){
		HSSFName refer = wb.createName();
		refer.setRefersToFormula(expression);
		refer.setNameName(name);
		return refer;
	}</code></pre> 
<p></p> 
<p>设置数据有效性的方法：</p> 
<pre><code class="language-java">	/**
	 * 设置数据有效性（通过名称管理器级联相关）
	 * @param name
	 * @param firstRow
	 * @param endRow
	 * @param firstCol
	 * @param endCol
	 * @return
	 */
	public static HSSFDataValidation setDataValidation(String name, int firstRow, int endRow, int firstCol, int endCol){
		//设置下拉列表的内容
		log.info("起始行:" + firstRow + "___起始列:" + firstCol + "___终止行:" + endRow + "___终止列:" + endCol);
		//加载下拉列表内容
		DVConstraint constraint = DVConstraint.createFormulaListConstraint(name);
		// 设置数据有效性加载在哪个单元格上。
		// 四个参数分别是：起始行、终止行、起始列、终止列
		CellRangeAddressList regions = new CellRangeAddressList((short) firstRow, (short) endRow, (short) firstCol, (short) endCol);
		// 数据有效性对象
		HSSFDataValidation data_validation = new HSSFDataValidation(regions, constraint);
		return data_validation;
	}</code></pre> 
<br> 
<p>有了这两个方法之后，我们在程序中对所有数据都写入完成之后，进行如下操作：</p> 
<p></p> 
<pre><code class="language-java">	//为地市下拉框创建名称
	POIExcelUtil.createName(wb, "city", "数据字典!$B$2:$B$"+rowcity);
	//为地市下拉框设置数据有效性
	HSSFDataValidation valicity = POIExcelUtil.setDataValidation("city", 2, row-1, 6, 6);</code></pre> 
<br> 
<pre><code class="language-java"><span style="white-space:pre">	</span>//为区县下拉框创建名称
	POIExcelUtil.createName(wb, cityName, "数据字典!$E$"+tempcoun+":$E$"+rowcoun);</code></pre> 
<p></p> 
<p><br> </p> 
<pre><code class="language-java"><span style="white-space:pre">	</span>//为区县下拉框设置数据有效性，由于区县的下拉框是根据本行的地市单元格级联，所以需要循环加入
	for(int i = 2;i&lt;row;i++){
		HSSFDataValidation valicounty = POIExcelUtil.setDataValidation("INDIRECT(G"+(i+1)+")", i, i, 7, 7);
		sheet.addValidationData(valicounty);
	}</code></pre> 
<br> 所以，利用POI实现Excel下拉框的级联并不困难，只要我们明白Excel下拉框的实现原理，再用POI来实现其实很简单。 
<br> 
<br> 
<p></p> 
<p>原创文章，转载请注明原作者及出处链接，谢谢！</p> 
<p><br> </p> 
<p><a href="http://blog.csdn.net/wed840313">http://blog.csdn.net/wed840313</a></p> 
<br> 
<br>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1938e0522f032897bf6a048e4eca4563/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">不允许一个用户使用一个以上用户名与一个服务器或共享资源的多重连接</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f7bb266b3628db5ec774d5752786a915/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43;语言中helloworld程序的详细执行过程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>