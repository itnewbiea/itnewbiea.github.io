<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据科学与机器学习案例之WiFi定位系统的位置预测 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据科学与机器学习案例之WiFi定位系统的位置预测" />
<meta property="og:description" content="数据科学与机器学习案例之客户的信用风险与预测
数据科学与机器学习之信用卡欺诈识别（严重类失衡数据建模）
数据科学与机器学习案例之汽车目标客户销售策略研究
数据科学与机器学习案例之WiFi定位系统的位置预测 数据简介可视化图集代码汇总 数据简介 可供建模的训练集与测试集共有140多万条记录，我们对文本数据进行了转换，开发了文本处理的函数，并进行了程序调试。
汇总之后的数据共有以下字段：时间、WiFi地址、X、Y、方向、移动设备地址、信号值、信号频率、距离
数据变量类型时间POSIXctWiFi地址分类X连续Y连续Z连续方向连续移动设备地址分类信号值连续信号频率分类距离连续 详细的数据处理、数据汇总、可视化、模型、预测已在思维导图中说明。以下就不在单独详细介绍。
可视化图集 不同位置的记录数
可视化图集1
图1 训练数据的方向的密度图与累积分布图 图2 训练数据方向的直方图 图3 训练数据方向的柱状图 图4 不同数据分割情形下数目与均值减中位数的散点图与拟合估计图 可视化图集2
图1 k近邻交叉验证图 图2 加权k近邻交叉验证图 图3 直接预测的原始位置与预测位置的路径图 图4 WiFi位置图 可视化图集3
图1 训练数据中特定筛选条件下的散点图 图2 特定筛选条件下的信号值的箱线图 可视化图集4
代码汇总 &gt; library(ggplot2) &gt; library(caret) &gt; library(data.table) &gt; library(parallel) &gt; library(lubridate) &gt; &gt; txt = readLines(&#39;训练.txt&#39;) &gt; &gt; head(txt,6) &gt; &gt; process.data &lt;- function(x){ &#43; a = strsplit(x,&#39;[,;=]&#39;)[[1]] &#43; mat = matrix(a[-(1:10)],ncol = 4,byrow = T) &#43; result = cbind(matrix(a[c(2,4,6,7,8,10)],nrow = nrow(mat),ncol = 6 &#43; ,byrow = T),mat) &#43; result} &gt; &gt; process." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9f653bf58fe1fe5b20fc1b7d6688438f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-28T10:56:36+08:00" />
<meta property="article:modified_time" content="2023-04-28T10:56:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据科学与机器学习案例之WiFi定位系统的位置预测</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://blog.csdn.net/weixin_43217641/article/details/125925496">数据科学与机器学习案例之客户的信用风险与预测</a></p> 
<p><a href="https://blog.csdn.net/weixin_43217641/article/details/126102820">数据科学与机器学习之信用卡欺诈识别（严重类失衡数据建模）</a></p> 
<p><a href="https://blog.csdn.net/weixin_43217641/article/details/126152253">数据科学与机器学习案例之汽车目标客户销售策略研究</a><br> </p> 
<div class="toc"> 
 <h4>数据科学与机器学习案例之WiFi定位系统的位置预测</h4> 
 <ul><li><a href="#_9" rel="nofollow">数据简介</a></li><li><a href="#_29" rel="nofollow">可视化图集</a></li><li><a href="#_78" rel="nofollow">代码汇总</a></li></ul> 
</div> 
<p></p> 
<img src="https://images2.imgbox.com/64/cc/GnaDm9H1_o.png" width="85%"> 
<h2><a id="_9"></a>数据简介</h2> 
<blockquote> 
 <p>可供建模的训练集与测试集共有140多万条记录，我们对文本数据进行了转换，开发了文本处理的函数，并进行了程序调试。<br> 汇总之后的数据共有以下字段：<code><strong>时间</strong>、WiFi<strong>地址</strong>、X、Y、<strong>方向</strong>、<strong>移动设备地址</strong>、<strong>信号值</strong>、<strong>信号频率</strong>、<strong>距离</strong></code></p> 
</blockquote> 
<table><thead><tr><th>数据变量</th><th>类型</th></tr></thead><tbody><tr><td><code><strong>时间</strong></code></td><td><code>POSIXct</code></td></tr><tr><td><code>WiFi<strong>地址</strong></code></td><td><code><strong>分类</strong></code></td></tr><tr><td><code>X</code></td><td><code><strong>连续</strong></code></td></tr><tr><td><code>Y</code></td><td><code><strong>连续</strong></code></td></tr><tr><td><code>Z</code></td><td><code><strong>连续</strong></code></td></tr><tr><td><code><strong>方向</strong></code></td><td><code><strong>连续</strong></code></td></tr><tr><td><code><strong>移动设备地址</strong></code></td><td><code><strong>分类</strong></code></td></tr><tr><td><code><strong>信号值</strong></code></td><td><code><strong>连续</strong></code></td></tr><tr><td><code><strong>信号频率</strong></code></td><td><code><strong>分类</strong></code></td></tr><tr><td><code><strong>距离</strong></code></td><td><code><strong>连续</strong></code></td></tr></tbody></table> 
<blockquote> 
 <p>详细的数据处理、数据汇总、可视化、模型、预测已在思维导图中说明。以下就不在单独详细介绍。</p> 
</blockquote> 
<h2><a id="_29"></a>可视化图集</h2> 
<img src="https://images2.imgbox.com/74/bd/XagnznLJ_o.png" width="80%"> 
<p><code><strong>不同位置的记录数</strong></code><br> <img src="https://images2.imgbox.com/09/cb/90wyEDuO_o.jpg" alt="在这里插入图片描述"><br> <code><strong>可视化图集</strong>1</code></p> 
<table><tbody><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/41/33/ahCC6nZm_o.jpg">图1 训练数据的方向的密度图与累积分布图 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/e1/6c/k8HixQ6O_o.jpg">图2 训练数据方向的直方图 
    </center></td></tr><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/45/51/f9Cvhyq0_o.jpg">图3 训练数据方向的柱状图 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/0c/5b/trPa6FUk_o.jpg">图4 不同数据分割情形下数目与均值减中位数的散点图与拟合估计图 
    </center></td></tr></tbody></table> 
<p><code><strong>可视化图集</strong>2</code></p> 
<table><tbody><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/c4/9d/vf65WQoa_o.jpg">图1 k近邻交叉验证图 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/5a/fd/aXR0JFVk_o.jpg">图2 加权k近邻交叉验证图 
    </center></td></tr><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/e5/33/WdkhDk65_o.jpg">图3 直接预测的原始位置与预测位置的路径图 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/7e/9a/voBN1eBR_o.jpg">图4 WiFi位置图 
    </center></td></tr></tbody></table> 
<p><code><strong>可视化图集</strong>3</code></p> 
<table><tbody><tr><td> 
    <center> 
     <img src="https://images2.imgbox.com/2f/fb/MmnCF06K_o.jpg">图1 训练数据中特定筛选条件下的散点图 
    </center></td><td> 
    <center> 
     <img src="https://images2.imgbox.com/c6/52/8WZaEhuX_o.jpg">图2 特定筛选条件下的信号值的箱线图 
    </center></td></tr></tbody></table> 
<p><code><strong>可视化图集</strong>4</code></p> 
<img src="https://images2.imgbox.com/d5/5e/J586Y9l6_o.jpg" width="95%"> 
<img src="https://images2.imgbox.com/fe/70/cooKGnYN_o.jpg" width="95%"> 
<p><img src="https://images2.imgbox.com/77/89/cBeShk6f_o.jpg" alt="在这里插入图片描述"></p> 
<img src="https://images2.imgbox.com/9a/6d/1neuy8hQ_o.jpg" width="95%"> 
<h2><a id="_78"></a>代码汇总</h2> 
<pre><code class="prism language-r"><span class="token operator">&gt;</span> library<span class="token punctuation">(</span>ggplot2<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> library<span class="token punctuation">(</span>caret<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> library<span class="token punctuation">(</span>data.table<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> library<span class="token punctuation">(</span>parallel<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> library<span class="token punctuation">(</span>lubridate<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> txt <span class="token operator">=</span> readLines<span class="token punctuation">(</span><span class="token string">'训练.txt'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> head<span class="token punctuation">(</span>txt<span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> process.data <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>        a <span class="token operator">=</span> strsplit<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'[,;=]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">+</span>        mat <span class="token operator">=</span> matrix<span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>byrow <span class="token operator">=</span> T<span class="token punctuation">)</span>
<span class="token operator">+</span>        result <span class="token operator">=</span> cbind<span class="token punctuation">(</span>matrix<span class="token punctuation">(</span>a<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>nrow <span class="token operator">=</span> nrow<span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> <span class="token number">6</span>
<span class="token operator">+</span>                       <span class="token punctuation">,</span>byrow <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span>mat<span class="token punctuation">)</span>
<span class="token operator">+</span>        result<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> process.data<span class="token punctuation">(</span>txt<span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> a1 <span class="token operator">=</span> lapply<span class="token punctuation">(</span>txt<span class="token punctuation">[</span><span class="token number">4</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>process.data<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results <span class="token operator">=</span> lapply<span class="token punctuation">(</span>txt<span class="token punctuation">[</span>substr<span class="token punctuation">(</span>txt<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'#'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>process.data<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> options<span class="token punctuation">(</span>error <span class="token operator">=</span> recover<span class="token punctuation">,</span>warn <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> process.data <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>        a <span class="token operator">=</span> strsplit<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'[,;=]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">+</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">10</span><span class="token punctuation">)</span> return<span class="token punctuation">(</span><span class="token keyword">NULL</span><span class="token punctuation">)</span>
<span class="token operator">+</span>        mat <span class="token operator">=</span> matrix<span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>byrow <span class="token operator">=</span> T<span class="token punctuation">)</span>
<span class="token operator">+</span>        result <span class="token operator">=</span> cbind<span class="token punctuation">(</span>matrix<span class="token punctuation">(</span>a<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>nrow <span class="token operator">=</span> nrow<span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                   ncol <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>byrow <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span>mat<span class="token punctuation">)</span>
<span class="token operator">+</span>        result<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results <span class="token operator">=</span> lapply<span class="token punctuation">(</span>txt<span class="token punctuation">[</span>substr<span class="token punctuation">(</span>txt<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token string">'#'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>process.data<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> options<span class="token punctuation">(</span>error <span class="token operator">=</span> recover<span class="token punctuation">,</span>warn <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>do.call<span class="token punctuation">(</span><span class="token string">'rbind'</span><span class="token punctuation">,</span>results<span class="token punctuation">)</span><span class="token punctuation">,</span>stringsAsFactors <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> colnames<span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">,</span><span class="token string">'WiFi地址'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                        <span class="token string">'移动设备地址'</span><span class="token punctuation">,</span><span class="token string">'信号值'</span><span class="token punctuation">,</span><span class="token string">'信号频率'</span><span class="token punctuation">,</span><span class="token string">'模式'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span><span class="token string">'信号值'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> lapply<span class="token punctuation">(</span>results<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span><span class="token string">'信号值'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>as.numeric<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 删除类型变量</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results <span class="token operator">=</span> results<span class="token punctuation">[</span>results<span class="token operator">$</span>模式 <span class="token operator">==</span> <span class="token string">'3'</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> results  <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'模式'</span> <span class="token operator">!=</span> names<span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results<span class="token operator">$</span>时间 <span class="token operator">=</span> results<span class="token operator">$</span>时间 <span class="token operator">/</span> <span class="token number">1000</span>
<span class="token operator">&gt;</span> class<span class="token punctuation">(</span>results<span class="token operator">$</span>时间<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'POSIXT'</span><span class="token punctuation">,</span><span class="token string">'POSIXct'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> start <span class="token operator">=</span> c<span class="token punctuation">(</span>seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>results<span class="token operator">$</span>时间<span class="token punctuation">)</span><span class="token punctuation">,</span>by <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> end <span class="token operator">=</span> c<span class="token punctuation">(</span>start<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span>length<span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>results<span class="token operator">$</span>时间<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>      sink<span class="token punctuation">(</span><span class="token string">'Time.txt'</span><span class="token punctuation">,</span>append <span class="token operator">=</span> T<span class="token punctuation">)</span>
<span class="token operator">+</span>      print<span class="token punctuation">(</span>results<span class="token operator">$</span>时间<span class="token punctuation">[</span>start<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">:</span>end<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>      sink<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> Time <span class="token operator">=</span> readLines<span class="token punctuation">(</span><span class="token string">'Time.txt'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> strsplit<span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'[\\"]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> BI <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>         a <span class="token operator">=</span> strsplit<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'[\\"]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">+</span>         a <span class="token operator">=</span> gsub<span class="token punctuation">(</span><span class="token string">' CST'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span>
<span class="token operator">+</span>         a<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> time <span class="token operator">=</span> unlist<span class="token punctuation">(</span>lapply<span class="token punctuation">(</span>Time<span class="token punctuation">,</span>BI<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> time <span class="token operator">=</span> time<span class="token punctuation">[</span><span class="token operator">-</span>length<span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results<span class="token operator">$</span>时间 <span class="token operator">=</span> time
<span class="token operator">&gt;</span>
<span class="token operator">&gt;</span> results<span class="token operator">$</span>时间 <span class="token operator">=</span> as.POSIXct<span class="token punctuation">(</span>results<span class="token operator">$</span>时间<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> results<span class="token operator">$</span>时间 <span class="token operator">&lt;-</span> update<span class="token punctuation">(</span>results<span class="token operator">$</span>时间<span class="token punctuation">,</span> year<span class="token operator">=</span><span class="token number">2021</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> summary<span class="token punctuation">(</span>results<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span><span class="token string">'信号值'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> table<span class="token punctuation">(</span>results<span class="token operator">$</span>WiFi地址<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> sort<span class="token punctuation">(</span>table<span class="token punctuation">(</span>results<span class="token operator">$</span>移动设备地址<span class="token punctuation">)</span><span class="token punctuation">,</span>T<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> names<span class="token punctuation">(</span>sort<span class="token punctuation">(</span>table<span class="token punctuation">(</span>results<span class="token operator">$</span>移动设备地址<span class="token punctuation">)</span><span class="token punctuation">,</span>T<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> histogram<span class="token punctuation">(</span>results<span class="token operator">$</span>方向<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> opar <span class="token operator">=</span> par<span class="token punctuation">(</span>mfrow <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> plot<span class="token punctuation">(</span>density<span class="token punctuation">(</span>results<span class="token operator">$</span>方向<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> plot<span class="token punctuation">(</span>ecdf<span class="token punctuation">(</span>results<span class="token operator">$</span>方向<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> par<span class="token punctuation">(</span>opar<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> angle.res <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>         angles <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>by <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span>length <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">)</span>
<span class="token operator">+</span>         a <span class="token operator">=</span> sapply<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                         which.min<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>y <span class="token operator">-</span> angles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">+</span>         c<span class="token punctuation">(</span>angles<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span>
<span class="token operator">+</span>         <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results<span class="token operator">$</span>方向 <span class="token operator">=</span> angle.res<span class="token punctuation">(</span>results<span class="token operator">$</span>方向<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> barplot<span class="token punctuation">(</span>table<span class="token punctuation">(</span>results<span class="token operator">$</span>方向<span class="token punctuation">)</span><span class="token punctuation">,</span>names.arg <span class="token operator">=</span> names<span class="token punctuation">(</span>table<span class="token punctuation">(</span>results<span class="token operator">$</span>方向<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>         col <span class="token operator">=</span> <span class="token string">'orange'</span><span class="token punctuation">,</span>  <span class="token comment"># 填充颜色</span>
<span class="token operator">+</span>         border <span class="token operator">=</span> <span class="token string">'#ffffff'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> c<span class="token punctuation">(</span>length<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>results<span class="token operator">$</span>移动设备地址<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>results<span class="token operator">$</span>信号频率<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> t <span class="token operator">=</span> sort<span class="token punctuation">(</span>table<span class="token punctuation">(</span>results<span class="token operator">$</span>移动设备地址<span class="token punctuation">)</span><span class="token punctuation">,</span>T<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results <span class="token operator">=</span> results<span class="token punctuation">[</span>which<span class="token punctuation">(</span>results<span class="token operator">$</span>移动设备地址 <span class="token percent-operator operator">%in%</span> names<span class="token punctuation">(</span>t<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 检查移动设备地址与频率之间是否是一一对应关系</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> data <span class="token operator">=</span> with<span class="token punctuation">(</span>results<span class="token punctuation">,</span>table<span class="token punctuation">(</span>移动设备地址<span class="token punctuation">,</span>信号频率<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> apply<span class="token punctuation">(</span>data<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> sum<span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> temp <span class="token operator">=</span> temp<span class="token punctuation">[</span>temp<span class="token operator">$</span>移动设备地址 <span class="token operator">==</span> <span class="token string">'00:0f:a3:39:e0:4b'</span> <span class="token operator">&amp;</span> temp<span class="token operator">$</span>信号频率 <span class="token operator">==</span> <span class="token string">'2462000000'</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results <span class="token operator">=</span> results<span class="token punctuation">[</span>results<span class="token operator">$</span>移动设备地址 <span class="token operator">!=</span> <span class="token string">'00:0f:a3:39:e0:4b'</span> <span class="token operator">&amp;</span> results<span class="token operator">$</span>信号频率 <span class="token operator">!=</span> <span class="token string">'2462000000'</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> location <span class="token operator">=</span> with<span class="token punctuation">(</span>results<span class="token punctuation">,</span>by<span class="token punctuation">(</span>results<span class="token punctuation">,</span>list<span class="token punctuation">(</span>X<span class="token punctuation">,</span>Y<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> <span class="token punctuation">(</span>sapply<span class="token punctuation">(</span>location<span class="token punctuation">,</span>class<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> sum<span class="token punctuation">(</span>sapply<span class="token punctuation">(</span>location<span class="token punctuation">,</span>class<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'NULL'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> location <span class="token operator">=</span> location<span class="token punctuation">[</span><span class="token operator">!</span> <span class="token punctuation">(</span>sapply<span class="token punctuation">(</span>location<span class="token punctuation">,</span>class<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'NULL'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> length<span class="token punctuation">(</span>location<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> sapply<span class="token punctuation">(</span>location<span class="token punctuation">,</span>class<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> sapply<span class="token punctuation">(</span>location<span class="token punctuation">,</span>nrow<span class="token punctuation">)</span> <span class="token comment"># 每个坐标下的记录</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> lp <span class="token operator">=</span> sapply<span class="token punctuation">(</span>location<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> c<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>x<span class="token operator">$</span>X<span class="token punctuation">)</span><span class="token punctuation">,</span>unique<span class="token punctuation">(</span>x<span class="token operator">$</span>Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lp <span class="token operator">&lt;-</span> rbind<span class="token punctuation">(</span>lp<span class="token punctuation">,</span>sapply<span class="token punctuation">(</span>location<span class="token punctuation">,</span>nrow<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> plot<span class="token punctuation">(</span>t<span class="token punctuation">(</span>lp<span class="token punctuation">)</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">'n'</span><span class="token punctuation">,</span>xlab <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> text<span class="token punctuation">(</span>t<span class="token punctuation">(</span>lp<span class="token punctuation">)</span><span class="token punctuation">,</span>labels <span class="token operator">=</span> t<span class="token punctuation">(</span>lp<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>cex <span class="token operator">=</span> <span class="token number">.8</span><span class="token punctuation">,</span>srt <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> lattice<span class="token operator">::</span>bwplot<span class="token punctuation">(</span>信号值 <span class="token operator">~</span> factor<span class="token punctuation">(</span>方向<span class="token punctuation">)</span> <span class="token operator">|</span> 移动设备地址<span class="token punctuation">,</span>data <span class="token operator">=</span> results<span class="token punctuation">,</span>
 <span class="token operator">+</span>                subset <span class="token operator">=</span> X <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;</span> Y <span class="token operator">==</span> <span class="token number">12</span> <span class="token operator">&amp;</span> 移动设备地址 <span class="token operator">!=</span> <span class="token string">'00:0f:a3:39:dd:cd'</span><span class="token punctuation">,</span>
 <span class="token operator">+</span>                layout <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 信号强度的分布</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> lattice<span class="token operator">::</span>densityplot<span class="token punctuation">(</span><span class="token operator">~</span>信号值 <span class="token operator">|</span> 移动设备地址 <span class="token operator">+</span> factor<span class="token punctuation">(</span>方向<span class="token punctuation">)</span><span class="token punctuation">,</span>data <span class="token operator">=</span> results<span class="token punctuation">,</span>
<span class="token operator">+</span>                     subset <span class="token operator">=</span> X <span class="token operator">==</span> <span class="token number">24</span> <span class="token operator">&amp;</span> Y <span class="token operator">==</span> <span class="token number">4</span> <span class="token operator">&amp;</span> 
<span class="token operator">+</span>                          移动设备地址 <span class="token operator">!=</span> <span class="token string">"00:0f:a3:39:dd:cd"</span><span class="token punctuation">,</span>
<span class="token operator">+</span>              bw <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">,</span> plot.points <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results<span class="token operator">$</span>XY <span class="token operator">=</span> paste<span class="token punctuation">(</span>results<span class="token operator">$</span>X<span class="token punctuation">,</span>results<span class="token operator">$</span>Y<span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> XYanglelocation <span class="token operator">=</span> with<span class="token punctuation">(</span>results<span class="token punctuation">,</span>by<span class="token punctuation">(</span>results<span class="token punctuation">,</span>list<span class="token punctuation">(</span>XY<span class="token punctuation">,</span>方向<span class="token punctuation">,</span>移动设备地址<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> temp1 <span class="token operator">=</span> lapply<span class="token punctuation">(</span>XYanglelocation<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                  and <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">+</span>                  and<span class="token operator">$</span>Mean <span class="token operator">=</span> mean<span class="token punctuation">(</span>x<span class="token operator">$</span>信号值<span class="token punctuation">)</span>
<span class="token operator">+</span>                  and<span class="token operator">$</span>Median <span class="token operator">=</span> median<span class="token punctuation">(</span>x<span class="token operator">$</span>信号值<span class="token punctuation">)</span>
<span class="token operator">+</span>                  and<span class="token operator">$</span>IQR <span class="token operator">=</span> IQR<span class="token punctuation">(</span>x<span class="token operator">$</span>信号值<span class="token punctuation">)</span>
<span class="token operator">+</span>                  and<span class="token operator">$</span>num <span class="token operator">=</span> length<span class="token punctuation">(</span>x<span class="token operator">$</span>信号值<span class="token punctuation">)</span>
<span class="token operator">+</span>                  and<span class="token operator">$</span>sd <span class="token operator">=</span> sd<span class="token punctuation">(</span>x<span class="token operator">$</span>信号值<span class="token punctuation">)</span>
<span class="token operator">+</span>                  and<span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 汇总</span>
<span class="token operator">&gt;</span> temp1 <span class="token operator">=</span> do.call<span class="token punctuation">(</span><span class="token string">'rbind'</span><span class="token punctuation">,</span>temp1<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> breaks <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">90</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">25</span><span class="token punctuation">,</span>by <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lattice<span class="token operator">::</span>bwplot<span class="token punctuation">(</span>sd <span class="token operator">~</span> cut<span class="token punctuation">(</span>Mean<span class="token punctuation">,</span>breaks <span class="token operator">=</span> breaks<span class="token punctuation">)</span><span class="token punctuation">,</span>data <span class="token operator">=</span> temp1<span class="token punctuation">,</span>
<span class="token operator">+</span>                 xlab <span class="token operator">=</span> <span class="token string">'Mean'</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">'Sd'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> with<span class="token punctuation">(</span>temp1<span class="token punctuation">,</span>smoothScatter<span class="token punctuation">(</span><span class="token punctuation">(</span>Mean <span class="token operator">-</span> Median<span class="token punctuation">)</span> <span class="token operator">~</span> num<span class="token punctuation">,</span>
<span class="token operator">+</span>                        xlab <span class="token operator">=</span> <span class="token string">'Num'</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">'Mean - Median'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> abline<span class="token punctuation">(</span>h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#984ea3'</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> loess.and <span class="token operator">=</span> with<span class="token punctuation">(</span>temp1<span class="token punctuation">,</span>loess<span class="token punctuation">(</span>diff <span class="token operator">~</span> num <span class="token punctuation">,</span>data <span class="token operator">=</span> data.frame<span class="token punctuation">(</span>diff <span class="token operator">=</span> Mean <span class="token operator">-</span> Median<span class="token punctuation">,</span>
<span class="token operator">+</span>                                       num <span class="token operator">=</span> num<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> loess.pre <span class="token operator">=</span> predict<span class="token punctuation">(</span>loess.and<span class="token punctuation">,</span>newdata <span class="token operator">=</span> data.frame<span class="token punctuation">(</span>num <span class="token operator">=</span> <span class="token number">60</span><span class="token operator">:</span><span class="token number">120</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> with<span class="token punctuation">(</span>temp1<span class="token punctuation">,</span>smoothScatter<span class="token punctuation">(</span><span class="token punctuation">(</span>Mean <span class="token operator">-</span> Median<span class="token punctuation">)</span> <span class="token operator">~</span> num<span class="token punctuation">,</span>
<span class="token operator">+</span>                xlab <span class="token operator">=</span> <span class="token string">'Num'</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">'Mean - Median'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> abline<span class="token punctuation">(</span>h <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#984ea3'</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">60</span><span class="token operator">:</span><span class="token number">120</span><span class="token punctuation">,</span>y <span class="token operator">=</span> loess.pre<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">60</span><span class="token operator">:</span><span class="token number">120</span><span class="token punctuation">,</span>y <span class="token operator">=</span> loess.pre<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> onelocationangle <span class="token operator">=</span> subset<span class="token punctuation">(</span>temp1<span class="token punctuation">,</span>
<span class="token operator">+</span>      移动设备地址 <span class="token operator">==</span> <span class="token string">'00:14:bf:b1:97:8d'</span> <span class="token operator">&amp;</span> 方向 <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> smooth1 <span class="token operator">=</span> fields<span class="token operator">::</span>Tps<span class="token punctuation">(</span>onelocationangle<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>onelocationangle<span class="token operator">$</span>Mean<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> smooth1 <span class="token operator">=</span> fields<span class="token operator">::</span>predictSurface<span class="token punctuation">(</span>smooth1<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> fields<span class="token operator">::</span>plot.surface<span class="token punctuation">(</span>smooth1<span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">'C'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> onelocationangle<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y <span class="token operator">=</span> onelocationangle<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>        pch <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span>cex <span class="token operator">=</span> <span class="token number">.5</span><span class="token punctuation">)</span> <span class="token comment"># 地形图</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 构造函数</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> surface <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>location<span class="token punctuation">,</span>angle <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>              library<span class="token punctuation">(</span>fields<span class="token punctuation">)</span>
<span class="token operator">+</span>        onelocationangle <span class="token operator">=</span> subset<span class="token punctuation">(</span>data<span class="token punctuation">,</span>
<span class="token operator">+</span>            data<span class="token operator">$</span>移动设备地址 <span class="token operator">==</span> location <span class="token operator">&amp;</span> data<span class="token operator">$</span>方向 <span class="token operator">==</span> angle<span class="token punctuation">)</span>
<span class="token operator">+</span>        smooth1 <span class="token operator">=</span> Tps<span class="token punctuation">(</span>onelocationangle<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>onelocationangle<span class="token operator">$</span>Mean<span class="token punctuation">)</span>
<span class="token operator">+</span>        smooth1 <span class="token operator">=</span> predictSurface<span class="token punctuation">(</span>smooth1<span class="token punctuation">)</span>
<span class="token operator">+</span>        plot.surface<span class="token punctuation">(</span>smooth1<span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">'C'</span><span class="token punctuation">)</span>
<span class="token operator">+</span>        points<span class="token punctuation">(</span>x <span class="token operator">=</span> onelocationangle<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y <span class="token operator">=</span> onelocationangle<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>        pch <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span>cex <span class="token operator">=</span> <span class="token number">.5</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> surface<span class="token punctuation">(</span>temp1<span class="token punctuation">,</span><span class="token string">'00:14:bf:b1:97:90'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> opar <span class="token operator">=</span> par<span class="token punctuation">(</span>mfrow <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>mar <span class="token operator">=</span> rep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> mapply<span class="token punctuation">(</span>surface<span class="token punctuation">,</span>data <span class="token operator">=</span> list<span class="token punctuation">(</span>temp1<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>        location <span class="token operator">=</span> sample<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>temp1<span class="token operator">$</span>移动设备地址<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>        angle <span class="token operator">=</span> rep<span class="token punctuation">(</span>c<span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">135</span><span class="token punctuation">)</span><span class="token punctuation">,</span>each <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 地形图</span>
<span class="token operator">&gt;</span> par<span class="token punctuation">(</span>opar<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> WiFi.matrix <span class="token operator">=</span> matrix<span class="token punctuation">(</span>c<span class="token punctuation">(</span> <span class="token number">7.5</span><span class="token punctuation">,</span> <span class="token number">6.3</span><span class="token punctuation">,</span> <span class="token number">2.5</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">.8</span><span class="token punctuation">,</span> <span class="token number">12.8</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2.8</span><span class="token punctuation">,</span>  
<span class="token operator">+</span>                 <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">14</span><span class="token punctuation">,</span> <span class="token number">33.5</span><span class="token punctuation">,</span> <span class="token number">9.3</span><span class="token punctuation">,</span>  <span class="token number">33.5</span><span class="token punctuation">,</span> <span class="token number">2.8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                ncol <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>byrow <span class="token operator">=</span> T<span class="token punctuation">,</span>
<span class="token operator">+</span>         dimnames <span class="token operator">=</span> list<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>results<span class="token operator">$</span>移动设备地址<span class="token punctuation">)</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">,</span><span class="token string">'y'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> diffs <span class="token operator">=</span> results<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">-</span> WiFi.matrix<span class="token punctuation">[</span>results<span class="token operator">$</span>移动设备地址<span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> results<span class="token operator">$</span>distance <span class="token operator">=</span> sqrt<span class="token punctuation">(</span>diffs<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">^</span><span class="token number">2</span> <span class="token operator">+</span> diffs<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> lattice<span class="token operator">::</span>xyplot<span class="token punctuation">(</span>信号值 <span class="token operator">~</span> distance <span class="token operator">|</span> factor<span class="token punctuation">(</span>移动设备地址<span class="token punctuation">)</span> <span class="token operator">+</span> factor<span class="token punctuation">(</span>方向<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                 data <span class="token operator">=</span> results<span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span>cex <span class="token operator">=</span> <span class="token number">.5</span><span class="token punctuation">,</span>xlab <span class="token operator">=</span> <span class="token string">'Distance'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> lattice<span class="token operator">::</span>xyplot<span class="token punctuation">(</span>信号值 <span class="token operator">~</span> distance <span class="token operator">|</span> factor<span class="token punctuation">(</span>移动设备地址<span class="token punctuation">)</span> <span class="token operator">+</span> factor<span class="token punctuation">(</span>方向<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                 data <span class="token operator">=</span> results<span class="token punctuation">,</span>
<span class="token operator">+</span>              subset <span class="token operator">=</span> 移动设备地址 <span class="token operator">==</span> c<span class="token punctuation">(</span><span class="token string">"00:14:bf:b1:97:8a"</span><span class="token punctuation">,</span><span class="token string">"00:14:bf:b1:97:90"</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>
<span class="token operator">+</span>                       方向 <span class="token operator">==</span> c<span class="token punctuation">(</span><span class="token number">45</span><span class="token punctuation">,</span><span class="token number">135</span><span class="token punctuation">)</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">19</span><span class="token punctuation">,</span>cex <span class="token operator">=</span> <span class="token number">.5</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> txt1 <span class="token operator">=</span> readLines<span class="token punctuation">(</span><span class="token string">'测试.txt'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> options<span class="token punctuation">(</span>error <span class="token operator">=</span> recover<span class="token punctuation">,</span>warn <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> process.data <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>        a <span class="token operator">=</span> strsplit<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'[,;=]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token operator">+</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>length<span class="token punctuation">(</span>a<span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">10</span><span class="token punctuation">)</span> return<span class="token punctuation">(</span><span class="token keyword">NULL</span><span class="token punctuation">)</span>
<span class="token operator">+</span>        mat <span class="token operator">=</span> matrix<span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">,</span>byrow <span class="token operator">=</span> T<span class="token punctuation">)</span>
<span class="token operator">+</span>        result <span class="token operator">=</span> cbind<span class="token punctuation">(</span>matrix<span class="token punctuation">(</span>a<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">,</span><span class="token number">7</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>nrow <span class="token operator">=</span> nrow<span class="token punctuation">(</span>mat<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                   ncol <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>byrow <span class="token operator">=</span> T<span class="token punctuation">)</span><span class="token punctuation">,</span>mat<span class="token punctuation">)</span>
<span class="token operator">+</span>        result<span class="token punctuation">}</span>

<span class="token operator">&gt;</span> test <span class="token operator">=</span> lapply<span class="token punctuation">(</span>txt1<span class="token punctuation">,</span>process.data<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> test <span class="token operator">=</span> as.data.frame<span class="token punctuation">(</span>do.call<span class="token punctuation">(</span><span class="token string">'rbind'</span><span class="token punctuation">,</span>test<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> colnames<span class="token punctuation">(</span>test<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">,</span><span class="token string">'WiFi地址'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                        <span class="token string">'移动设备地址'</span><span class="token punctuation">,</span><span class="token string">'信号值'</span><span class="token punctuation">,</span><span class="token string">'信号频率'</span><span class="token punctuation">,</span><span class="token string">'模式'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span><span class="token string">'信号值'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> lapply<span class="token punctuation">(</span>test<span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span><span class="token string">'信号值'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>as.numeric<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 删除类型变量</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test <span class="token operator">=</span> test<span class="token punctuation">[</span>test<span class="token operator">$</span>模式 <span class="token operator">==</span> <span class="token string">'3'</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> test <span class="token operator">=</span> test<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'模式'</span> <span class="token operator">!=</span> names<span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test<span class="token operator">$</span>时间 <span class="token operator">=</span> test<span class="token operator">$</span>时间 <span class="token operator">/</span> <span class="token number">1000</span>
<span class="token operator">&gt;</span> class<span class="token punctuation">(</span>test<span class="token operator">$</span>时间<span class="token punctuation">)</span> <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'POSIXT'</span><span class="token punctuation">,</span><span class="token string">'POSIXct'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> start <span class="token operator">=</span> c<span class="token punctuation">(</span>seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>test<span class="token operator">$</span>时间<span class="token punctuation">)</span><span class="token punctuation">,</span>by <span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> end <span class="token operator">=</span> c<span class="token punctuation">(</span>start<span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">:</span>length<span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span>length<span class="token punctuation">(</span>test<span class="token operator">$</span>时间<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>      sink<span class="token punctuation">(</span><span class="token string">'Time1.txt'</span><span class="token punctuation">,</span>append <span class="token operator">=</span> T<span class="token punctuation">)</span>
<span class="token operator">+</span>      print<span class="token punctuation">(</span>results<span class="token operator">$</span>时间<span class="token punctuation">[</span>start<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">:</span>end<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>      sink<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> Time1 <span class="token operator">=</span> readLines<span class="token punctuation">(</span><span class="token string">'Time1.txt'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> strsplit<span class="token punctuation">(</span>Time<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">'[\\"]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> BI <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>         a <span class="token operator">=</span> strsplit<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token string">'[\\"]'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span>c<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">+</span>         a <span class="token operator">=</span> gsub<span class="token punctuation">(</span><span class="token string">' CST'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span>a<span class="token punctuation">)</span>
<span class="token operator">+</span>         a<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> time1 <span class="token operator">=</span> unlist<span class="token punctuation">(</span>lapply<span class="token punctuation">(</span>Time1<span class="token punctuation">,</span>BI<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> time1 <span class="token operator">=</span> time1<span class="token punctuation">[</span><span class="token operator">-</span>length<span class="token punctuation">(</span>time1<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test<span class="token operator">$</span>时间 <span class="token operator">=</span> time1
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test<span class="token operator">$</span>时间 <span class="token operator">=</span> as.POSIXct<span class="token punctuation">(</span>test<span class="token operator">$</span>时间<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> test<span class="token operator">$</span>时间 <span class="token operator">&lt;-</span> update<span class="token punctuation">(</span>test<span class="token operator">$</span>时间<span class="token punctuation">,</span> year<span class="token operator">=</span><span class="token number">2021</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> summary<span class="token punctuation">(</span>test<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'时间'</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'Z'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span><span class="token string">'信号值'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> angle.res <span class="token operator">&lt;-</span> <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>         angles <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>by <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span>length <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">)</span>
<span class="token operator">+</span>         a <span class="token operator">=</span> sapply<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                         which.min<span class="token punctuation">(</span>abs<span class="token punctuation">(</span>y <span class="token operator">-</span> angles<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token operator">+</span>         c<span class="token punctuation">(</span>angles<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span>
<span class="token operator">+</span>         <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test<span class="token operator">$</span>方向 <span class="token operator">=</span> angle.res<span class="token punctuation">(</span>test<span class="token operator">$</span>方向<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> class<span class="token punctuation">(</span>with<span class="token punctuation">(</span>test<span class="token punctuation">,</span>table<span class="token punctuation">(</span>移动设备地址<span class="token punctuation">,</span>信号频率<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> apply<span class="token punctuation">(</span>with<span class="token punctuation">(</span>test<span class="token punctuation">,</span>table<span class="token punctuation">(</span>移动设备地址<span class="token punctuation">,</span>信号频率<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> sum<span class="token punctuation">(</span>x <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 修改</span>
<span class="token operator">&gt;</span>  
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test<span class="token operator">$</span>移动设备地址<span class="token punctuation">[</span>which<span class="token punctuation">(</span>test<span class="token operator">$</span>移动设备地址 <span class="token operator">==</span> <span class="token string">'00:0f:a3:39:e0:4b'</span> <span class="token operator">&amp;</span>
<span class="token operator">+</span>                  test<span class="token operator">$</span>信号频率 <span class="token operator">==</span> <span class="token string">'2462000000'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'00:0f:a3:39:e1:c0'</span>
<span class="token operator">&gt;</span> test<span class="token operator">$</span>移动设备地址<span class="token punctuation">[</span>which<span class="token punctuation">(</span>test<span class="token operator">$</span>移动设备地址 <span class="token operator">==</span> <span class="token string">'00:0f:a3:39:e2:10'</span> <span class="token operator">&amp;</span>
<span class="token operator">+</span>                   test<span class="token operator">$</span>信号频率 <span class="token operator">==</span> <span class="token string">'2437000000'</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'00:14:bf:b1:97:8a'</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test <span class="token operator">=</span> test<span class="token punctuation">[</span>which<span class="token punctuation">(</span>test<span class="token operator">$</span>移动设备地址 <span class="token percent-operator operator">%in%</span> unique<span class="token punctuation">(</span>results<span class="token operator">$</span>移动设备地址<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test<span class="token operator">$</span>XY <span class="token operator">=</span> paste<span class="token punctuation">(</span>test<span class="token operator">$</span>X<span class="token punctuation">,</span>test<span class="token operator">$</span>Y<span class="token punctuation">,</span>sep <span class="token operator">=</span> <span class="token string">'-'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> with<span class="token punctuation">(</span>test<span class="token punctuation">,</span>table<span class="token punctuation">(</span>XY<span class="token punctuation">,</span>方向<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> variables <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">,</span><span class="token string">'XY'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> test.XY <span class="token operator">=</span> with<span class="token punctuation">(</span>test<span class="token punctuation">,</span>by<span class="token punctuation">(</span>test<span class="token punctuation">,</span>list<span class="token punctuation">(</span>XY<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                  as <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>variables<span class="token punctuation">]</span>
<span class="token operator">+</span>                  Mean <span class="token operator">=</span> tapply<span class="token punctuation">(</span>x<span class="token operator">$</span>信号值<span class="token punctuation">,</span>x<span class="token operator">$</span>移动设备地址<span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
<span class="token operator">+</span>                  x <span class="token operator">=</span> matrix<span class="token punctuation">(</span>Mean<span class="token punctuation">,</span>nrow <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>dimnames <span class="token operator">=</span> list<span class="token punctuation">(</span>
<span class="token operator">+</span>                          as<span class="token operator">$</span>XY<span class="token punctuation">,</span>names<span class="token punctuation">(</span>Mean<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>                  cbind<span class="token punctuation">(</span>as<span class="token punctuation">,</span>x<span class="token punctuation">)</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> test.XY <span class="token operator">=</span> do.call<span class="token punctuation">(</span><span class="token string">'rbind'</span><span class="token punctuation">,</span>test.XY<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 根据角度以及m选择训练数据集的数据</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> names<span class="token punctuation">(</span>test.XY<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> m <span class="token operator">=</span> <span class="token number">3</span>
<span class="token operator">&gt;</span> angleNewobs <span class="token operator">=</span> <span class="token number">230</span>
<span class="token operator">&gt;</span> rfs <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>by <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span>length <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> nearangle <span class="token operator">=</span> angle.res<span class="token punctuation">(</span>angleNewobs<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token percent-operator operator">%%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment"># 选择奇数个近邻</span>
<span class="token operator">+</span>     angles <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>length <span class="token operator">=</span> m<span class="token punctuation">)</span>
<span class="token operator">+</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment"># 选择偶数个近邻</span>
<span class="token operator">+</span>     m <span class="token operator">=</span> m<span class="token operator">+</span><span class="token number">1</span>
<span class="token operator">+</span>     angles <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>length <span class="token operator">=</span> m<span class="token punctuation">)</span>
<span class="token operator">+</span>     <span class="token keyword">if</span><span class="token punctuation">(</span>sign<span class="token punctuation">(</span>angleNewobs<span class="token operator">-</span>nearangle<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>      angles <span class="token operator">=</span> angles<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">+</span>      <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>       angles <span class="token operator">=</span> angles<span class="token punctuation">[</span><span class="token operator">-</span>m<span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">+</span>                  <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> angles <span class="token operator">=</span> angles <span class="token operator">+</span> nearangle
<span class="token operator">&gt;</span> angles<span class="token punctuation">[</span>angles <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> angles<span class="token punctuation">[</span>angles <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">360</span>
<span class="token operator">&gt;</span> angles<span class="token punctuation">[</span>angles <span class="token operator">&gt;</span> <span class="token number">360</span><span class="token punctuation">]</span> <span class="token operator">=</span> angles<span class="token punctuation">[</span>angles <span class="token operator">&gt;</span> <span class="token number">360</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">360</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> resize <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>var <span class="token operator">=</span> <span class="token string">'Mean'</span><span class="token punctuation">,</span>keep <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'XY'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>            ans <span class="token operator">=</span> with<span class="token punctuation">(</span>data<span class="token punctuation">,</span>by<span class="token punctuation">(</span>data<span class="token punctuation">,</span>list<span class="token punctuation">(</span>XY<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                         as <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>keep<span class="token punctuation">]</span>
<span class="token operator">+</span>                         y <span class="token operator">=</span> tapply<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span>var<span class="token punctuation">]</span><span class="token punctuation">,</span>x<span class="token operator">$</span>移动设备地址<span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
<span class="token operator">+</span>                         A <span class="token operator">=</span> matrix<span class="token punctuation">(</span>y<span class="token punctuation">,</span>nrow <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                                 dimnames <span class="token operator">=</span> list<span class="token punctuation">(</span>as<span class="token operator">$</span>XY<span class="token punctuation">,</span>
<span class="token operator">+</span>                                   names<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>                         cbind<span class="token punctuation">(</span>as<span class="token punctuation">,</span>A<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>             newdata <span class="token operator">=</span> do.call<span class="token punctuation">(</span><span class="token string">'rbind'</span><span class="token punctuation">,</span>ans<span class="token punctuation">)</span>
<span class="token operator">+</span>             return<span class="token punctuation">(</span>newdata<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 根据角度选择训练集</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> select.train <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>angleNewobs<span class="token punctuation">,</span>data<span class="token punctuation">,</span>m <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
<span class="token operator">+</span>          rfs <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>by <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span>length <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span>
<span class="token operator">+</span>        nearangle <span class="token operator">=</span> angle.res<span class="token punctuation">(</span>angleNewobs<span class="token punctuation">)</span>
<span class="token operator">+</span> 
<span class="token operator">+</span>       <span class="token keyword">if</span><span class="token punctuation">(</span>m <span class="token percent-operator operator">%%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment"># 选择奇数个近邻</span>
<span class="token operator">+</span>        angles <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>length <span class="token operator">=</span> m<span class="token punctuation">)</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment"># 选择偶数个近邻</span>
<span class="token operator">+</span>          m <span class="token operator">=</span> m<span class="token operator">+</span><span class="token number">1</span>
<span class="token operator">+</span>         angles <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token number">45</span> <span class="token operator">*</span> <span class="token punctuation">(</span>m<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span>length <span class="token operator">=</span> m<span class="token punctuation">)</span>
<span class="token operator">+</span>        <span class="token keyword">if</span><span class="token punctuation">(</span>sign<span class="token punctuation">(</span>angleNewobs<span class="token operator">-</span>nearangle<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>           angles <span class="token operator">=</span> angles<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">+</span>        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>           angles <span class="token operator">=</span> angles<span class="token punctuation">[</span><span class="token operator">-</span>m<span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">+</span>                  <span class="token punctuation">}</span>
<span class="token operator">+</span>        angles <span class="token operator">=</span> angles <span class="token operator">+</span> nearangle
<span class="token operator">+</span>        angles<span class="token punctuation">[</span>angles <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> angles<span class="token punctuation">[</span>angles <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token number">360</span>
<span class="token operator">+</span>        angles<span class="token punctuation">[</span>angles <span class="token operator">&gt;</span> <span class="token number">360</span><span class="token punctuation">]</span> <span class="token operator">=</span> angles<span class="token punctuation">[</span>angles <span class="token operator">&gt;</span> <span class="token number">360</span><span class="token punctuation">]</span> <span class="token operator">-</span> <span class="token number">360</span>
<span class="token operator">+</span>         
<span class="token operator">+</span>        angles <span class="token operator">=</span> sort<span class="token punctuation">(</span>angles<span class="token punctuation">)</span>
<span class="token operator">+</span>        train.subset <span class="token operator">=</span> data<span class="token punctuation">[</span>data<span class="token operator">$</span>方向 <span class="token percent-operator operator">%in%</span> angles<span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">+</span>        resize<span class="token punctuation">(</span>train.subset<span class="token punctuation">)</span>  <span class="token punctuation">}</span>
<span class="token operator">&gt;</span>       
<span class="token operator">&gt;</span> train.<span class="token number">1</span> <span class="token operator">=</span> select.train<span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">,</span>temp1<span class="token punctuation">,</span>m<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> train.<span class="token number">2</span> <span class="token operator">=</span> select.train<span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">,</span>temp1<span class="token punctuation">,</span>m<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> findnn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newsignal<span class="token punctuation">,</span>train.subset<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>           diffs <span class="token operator">=</span> apply<span class="token punctuation">(</span>train.subset<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token operator">+</span>                               x <span class="token operator">-</span> newsignal<span class="token punctuation">)</span>
<span class="token operator">+</span>           distance <span class="token operator">=</span> apply<span class="token punctuation">(</span>diffs<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> sqrt<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>           closest <span class="token operator">=</span> order<span class="token punctuation">(</span>distance<span class="token punctuation">)</span>
<span class="token operator">+</span>           return<span class="token punctuation">(</span>train.subset<span class="token punctuation">[</span>closest<span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token comment"># 按照距离的长短排列(k近邻)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> pred.XY <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newSignals<span class="token punctuation">,</span> newAngles<span class="token punctuation">,</span> trainData<span class="token punctuation">,</span> 
<span class="token operator">+</span>                   numAngles <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>   
<span class="token operator">+</span>    closeXY <span class="token operator">=</span> list<span class="token punctuation">(</span>length <span class="token operator">=</span> nrow<span class="token punctuation">(</span>newSignals<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>   
<span class="token operator">+</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>nrow<span class="token punctuation">(</span>newSignals<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>     trainSS <span class="token operator">=</span> select.train<span class="token punctuation">(</span>newAngles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> trainData<span class="token punctuation">,</span> m <span class="token operator">=</span> numAngles<span class="token punctuation">)</span> <span class="token comment"># 筛选不同的训练集</span>
<span class="token operator">+</span>     closeXY<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> 
<span class="token operator">+</span>       findnn<span class="token punctuation">(</span>newsignal <span class="token operator">=</span> as.numeric<span class="token punctuation">(</span>newSignals<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> trainSS<span class="token punctuation">)</span> <span class="token comment"># 储存数据框</span>
<span class="token operator">+</span>                                  <span class="token punctuation">}</span>
<span class="token operator">+</span>    estXY <span class="token operator">=</span> lapply<span class="token punctuation">(</span>closeXY<span class="token punctuation">,</span> 
<span class="token operator">+</span>                  <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> sapply<span class="token punctuation">(</span>x<span class="token punctuation">[</span> <span class="token punctuation">,</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> 
<span class="token operator">+</span>                                     <span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> mean<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 按照第k个近邻计算</span>
<span class="token operator">+</span>   estXY <span class="token operator">=</span> do.call<span class="token punctuation">(</span><span class="token string">"rbind"</span><span class="token punctuation">,</span> estXY<span class="token punctuation">)</span>
<span class="token operator">+</span>   return<span class="token punctuation">(</span>estXY<span class="token punctuation">)</span>
<span class="token operator">+</span>                            <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> final1.<span class="token number">1</span> <span class="token operator">=</span> pred.XY<span class="token punctuation">(</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>temp1<span class="token punctuation">)</span> <span class="token comment"># 角度数1,3近邻</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> plot<span class="token punctuation">(</span>x <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">'n'</span><span class="token punctuation">,</span>xlim <span class="token operator">=</span> range<span class="token punctuation">(</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>      ylim <span class="token operator">=</span> range<span class="token punctuation">(</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xlab <span class="token operator">=</span> <span class="token string">'X'</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">'Y'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'black'</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> final1.<span class="token number">1</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y <span class="token operator">=</span> final1.<span class="token number">1</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> A <span class="token operator">=</span> vector<span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token string">'list'</span><span class="token punctuation">,</span>length <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> df <span class="token operator">=</span> vector<span class="token punctuation">(</span>mode <span class="token operator">=</span> <span class="token string">'numeric'</span><span class="token punctuation">,</span>length <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> error.cal <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>Matrix<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                res <span class="token operator">=</span> sum<span class="token punctuation">(</span>rowSums<span class="token punctuation">(</span><span class="token punctuation">(</span>Matrix <span class="token operator">-</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>                res<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> knn.grid <span class="token operator">=</span> expand.grid<span class="token punctuation">(</span>m <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span>k <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>length<span class="token punctuation">(</span>A<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>        A<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> pred.XY<span class="token punctuation">(</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>temp1<span class="token punctuation">,</span>knn.grid<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                             knn.grid<span class="token punctuation">[</span>i<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> 
<span class="token operator">+</span>        df<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> error.cal<span class="token punctuation">(</span>A<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;</span>  
<span class="token operator">&gt;</span> a1 <span class="token operator">=</span> pred.XY<span class="token punctuation">(</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>temp1<span class="token punctuation">,</span>knn.grid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>knn.grid<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> barplot<span class="token punctuation">(</span>df<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> knn.grid<span class="token punctuation">[</span>which.min<span class="token punctuation">(</span>df<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 可视化</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> plot<span class="token punctuation">(</span>x <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>xlim <span class="token operator">=</span> range<span class="token punctuation">(</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>      ylim <span class="token operator">=</span> range<span class="token punctuation">(</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>xlab <span class="token operator">=</span> <span class="token string">'X'</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">'Y'</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">'n'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> box<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">16</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'black'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> A<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y <span class="token operator">=</span> A<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> segments<span class="token punctuation">(</span>x0 <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y0 <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>          x1 <span class="token operator">=</span> A<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>y1 <span class="token operator">=</span> A<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">14</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>
<span class="token operator">+</span>          col <span class="token operator">=</span> <span class="token string">'grey'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> legend<span class="token punctuation">(</span><span class="token string">'topright'</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'原始位置'</span><span class="token punctuation">,</span><span class="token string">'最优预测位置m=4 k=3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>        pch <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span><span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">,</span>col <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">,</span><span class="token string">'red'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># CV交叉验证</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> resize <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span>keep <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">,</span><span class="token string">'XY'</span><span class="token punctuation">,</span><span class="token string">'方向'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                   angles <span class="token operator">=</span> seq<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span>by <span class="token operator">=</span> <span class="token number">45</span><span class="token punctuation">,</span>length <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                   sampleangle <span class="token operator">=</span> <span class="token boolean">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span> 
<span class="token operator">+</span>              res <span class="token operator">=</span> with<span class="token punctuation">(</span>data<span class="token punctuation">,</span>by<span class="token punctuation">(</span>data<span class="token punctuation">,</span>list<span class="token punctuation">(</span>XY<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                       <span class="token keyword">if</span><span class="token punctuation">(</span>sampleangle<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                          x <span class="token operator">=</span> x<span class="token punctuation">[</span>x<span class="token operator">$</span>方向 <span class="token operator">==</span> sample<span class="token punctuation">(</span>angles<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
<span class="token operator">+</span>                       as <span class="token operator">=</span> x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span>keep<span class="token punctuation">]</span>
<span class="token operator">+</span>                       y <span class="token operator">=</span> tapply<span class="token punctuation">(</span>x<span class="token operator">$</span>信号值<span class="token punctuation">,</span>x<span class="token operator">$</span>移动设备地址<span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
<span class="token operator">+</span>                       A <span class="token operator">=</span> matrix<span class="token punctuation">(</span>y<span class="token punctuation">,</span>nrow <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> length<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                                  dimnames <span class="token operator">=</span> list<span class="token punctuation">(</span>as<span class="token operator">$</span>XY<span class="token punctuation">,</span>names<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>                       cbind<span class="token punctuation">(</span>as<span class="token punctuation">,</span>A<span class="token punctuation">)</span>         <span class="token punctuation">}</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>               newdata <span class="token operator">=</span> do.call<span class="token punctuation">(</span><span class="token string">'rbind'</span><span class="token punctuation">,</span>res<span class="token punctuation">)</span>
<span class="token operator">+</span>               return<span class="token punctuation">(</span>newdata<span class="token punctuation">)</span> <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> v <span class="token operator">=</span> <span class="token number">10</span>
<span class="token operator">&gt;</span> sample.location <span class="token operator">=</span> sample<span class="token punctuation">(</span>unique<span class="token punctuation">(</span>temp1<span class="token operator">$</span>XY<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> sample.location <span class="token operator">=</span> matrix<span class="token punctuation">(</span>sample.location<span class="token punctuation">,</span>ncol <span class="token operator">=</span> v<span class="token punctuation">,</span>
<span class="token operator">+</span>                     nrow <span class="token operator">=</span> floor<span class="token punctuation">(</span>length<span class="token punctuation">(</span>sample.location<span class="token punctuation">)</span> <span class="token operator">/</span> v<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> test.cv <span class="token operator">=</span> resize<span class="token punctuation">(</span>results<span class="token punctuation">,</span>sampleangle <span class="token operator">=</span> <span class="token boolean">TRUE</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> knn.grid <span class="token operator">=</span> expand.grid<span class="token punctuation">(</span>m <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">,</span>k <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> B <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span>nrow <span class="token operator">=</span> nrow<span class="token punctuation">(</span>knn.grid<span class="token punctuation">)</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> error.cal <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>Matrix<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>             res <span class="token operator">=</span> sum<span class="token punctuation">(</span>rowSums<span class="token punctuation">(</span><span class="token punctuation">(</span>Matrix <span class="token operator">-</span> data<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>              res<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>v<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>      test.fold <span class="token operator">=</span> subset<span class="token punctuation">(</span>test.cv<span class="token punctuation">,</span>XY <span class="token percent-operator operator">%in%</span> sample.location<span class="token punctuation">[</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>      train.fold <span class="token operator">=</span> subset<span class="token punctuation">(</span>temp1<span class="token punctuation">,</span>XY <span class="token percent-operator operator">%in%</span> sample.location<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>      actual.fold <span class="token operator">=</span> test.fold<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">+</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>nrow<span class="token punctuation">(</span>B<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>           temp <span class="token operator">=</span> pred.XY<span class="token punctuation">(</span>test.fold<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.fold<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                            train.fold<span class="token punctuation">,</span>knn.grid<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>knn.grid<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token operator">+</span>           B<span class="token punctuation">[</span>j<span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> error.cal<span class="token punctuation">(</span>temp<span class="token punctuation">,</span>actual.fold<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span>
<span class="token comment"># 可视化</span>
<span class="token operator">&gt;</span> y <span class="token operator">=</span> apply<span class="token punctuation">(</span>B<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> col <span class="token operator">&lt;-</span> RColorBrewer<span class="token operator">::</span>brewer.pal<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'Accent'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> plot<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">'n'</span><span class="token punctuation">,</span>xlim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
       ylim <span class="token operator">=</span> range<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>xlab <span class="token operator">=</span> <span class="token string">'k近邻个数'</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">'误差'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> box<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> axis<span class="token punctuation">(</span>side <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>at <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#7FC97F'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#BEAED4'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#FDC086'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#FFFF99'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#386CB0'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> legend<span class="token punctuation">(</span><span class="token string">'bottomright'</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'m=1'</span><span class="token punctuation">,</span><span class="token string">'m=2'</span><span class="token punctuation">,</span><span class="token string">'m=3'</span><span class="token punctuation">,</span><span class="token string">'m=4'</span><span class="token punctuation">,</span><span class="token string">'m=5'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                  lty <span class="token operator">=</span> rep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> rep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                  col <span class="token operator">=</span> col<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> final1 <span class="token operator">=</span> pred.XY<span class="token punctuation">(</span>newSignals <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>newAngles <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                  trainData <span class="token operator">=</span> temp1<span class="token punctuation">,</span>numAngles <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> err1 <span class="token operator">=</span> error.cal<span class="token punctuation">(</span>final1<span class="token punctuation">,</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 加权k近邻</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> findnn <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newsignal<span class="token punctuation">,</span>train.subset<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>           diffs <span class="token operator">=</span> apply<span class="token punctuation">(</span>train.subset<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token operator">+</span>                               x <span class="token operator">-</span> newsignal<span class="token punctuation">)</span>
<span class="token operator">+</span>           distance <span class="token operator">=</span> apply<span class="token punctuation">(</span>diffs<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> sqrt<span class="token punctuation">(</span>sum<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>           train.subset<span class="token operator">$</span>distance <span class="token operator">=</span> round<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">/</span>distance<span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span>
<span class="token operator">+</span>           closest <span class="token operator">=</span> order<span class="token punctuation">(</span>distance<span class="token punctuation">)</span>
<span class="token operator">+</span>           return<span class="token punctuation">(</span>train.subset<span class="token punctuation">[</span>closest<span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">}</span> <span class="token comment"># 按照距离的长短排列(k近邻)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> trainSS <span class="token operator">=</span> select.train<span class="token punctuation">(</span><span class="token number">130</span><span class="token punctuation">,</span> temp1<span class="token punctuation">,</span> m <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> pred.XY <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>newSignals<span class="token punctuation">,</span> newAngles<span class="token punctuation">,</span> trainData<span class="token punctuation">,</span> 
<span class="token operator">+</span>                   numAngles <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>   
<span class="token operator">+</span>   closeXY <span class="token operator">=</span> list<span class="token punctuation">(</span>length <span class="token operator">=</span> nrow<span class="token punctuation">(</span>newSignals<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>   
<span class="token operator">+</span>   <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>nrow<span class="token punctuation">(</span>newSignals<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>     trainSS <span class="token operator">=</span> select.train<span class="token punctuation">(</span>newAngles<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> trainData<span class="token punctuation">,</span> m <span class="token operator">=</span> numAngles<span class="token punctuation">)</span> <span class="token comment"># 筛选不同的训练集</span>
 <span class="token operator">+</span>    closeXY<span class="token punctuation">[</span><span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> 
<span class="token operator">+</span>       findnn<span class="token punctuation">(</span>newsignal <span class="token operator">=</span> as.numeric<span class="token punctuation">(</span>newSignals<span class="token punctuation">[</span>i<span class="token punctuation">,</span> <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> trainSS<span class="token punctuation">)</span> <span class="token comment"># 储存数据框</span>
<span class="token operator">+</span>                                  <span class="token punctuation">}</span>
<span class="token operator">+</span>    estXY <span class="token operator">=</span> lapply<span class="token punctuation">(</span>closeXY<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>                  weights <span class="token operator">=</span> x<span class="token operator">$</span>distance<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>k<span class="token punctuation">]</span> <span class="token operator">/</span> sum<span class="token punctuation">(</span>x<span class="token operator">$</span>distance<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>k<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>                  sapply<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> sum<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span>k<span class="token punctuation">]</span> <span class="token operator">*</span> weights<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment"># 按照第k个近邻计算</span>
<span class="token operator">+</span>   estXY <span class="token operator">=</span> do.call<span class="token punctuation">(</span><span class="token string">"rbind"</span><span class="token punctuation">,</span> estXY<span class="token punctuation">)</span>
<span class="token operator">+</span>   return<span class="token punctuation">(</span>estXY<span class="token punctuation">)</span>
<span class="token operator">+</span>                            <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> C <span class="token operator">=</span> matrix<span class="token punctuation">(</span><span class="token keyword">NA</span><span class="token punctuation">,</span>nrow <span class="token operator">=</span> nrow<span class="token punctuation">(</span>knn.grid<span class="token punctuation">)</span><span class="token punctuation">,</span>ncol <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> error.cal <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>Matrix<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>               res <span class="token operator">=</span> sum<span class="token punctuation">(</span>rowSums<span class="token punctuation">(</span><span class="token punctuation">(</span>Matrix <span class="token operator">-</span> data<span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">+</span>               res<span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>v<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>      test.fold <span class="token operator">=</span> subset<span class="token punctuation">(</span>test.cv<span class="token punctuation">,</span>XY <span class="token percent-operator operator">%in%</span> sample.location<span class="token punctuation">[</span><span class="token punctuation">,</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>      train.fold <span class="token operator">=</span> subset<span class="token punctuation">(</span>temp1<span class="token punctuation">,</span>XY <span class="token percent-operator operator">%in%</span> sample.location<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token operator">-</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">+</span>      actual.fold <span class="token operator">=</span> test.fold<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token operator">+</span>      <span class="token keyword">for</span><span class="token punctuation">(</span>j <span class="token keyword">in</span> <span class="token number">1</span><span class="token operator">:</span>nrow<span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token operator">+</span>           temp <span class="token operator">=</span> pred.XY<span class="token punctuation">(</span>test.fold<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>test.fold<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                            train.fold<span class="token punctuation">,</span>knn.grid<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>knn.grid<span class="token punctuation">[</span>j<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
<span class="token operator">+</span>           C<span class="token punctuation">[</span>j<span class="token punctuation">,</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> error.cal<span class="token punctuation">(</span>temp<span class="token punctuation">,</span>actual.fold<span class="token punctuation">)</span><span class="token punctuation">}</span>
<span class="token operator">+</span>        <span class="token punctuation">}</span>
<span class="token operator">&gt;</span> 
<span class="token comment"># 可视化</span>
<span class="token operator">&gt;</span> y <span class="token operator">=</span> apply<span class="token punctuation">(</span>C<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span>mean<span class="token punctuation">)</span>
<span class="token operator">&gt;</span> col <span class="token operator">&lt;-</span> RColorBrewer<span class="token operator">::</span>brewer.pal<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">'Accent'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> plot<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>type <span class="token operator">=</span> <span class="token string">'n'</span><span class="token punctuation">,</span>xlim <span class="token operator">=</span> c<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>        ylim <span class="token operator">=</span> range<span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span>xlab <span class="token operator">=</span> <span class="token string">'加权k近邻个数'</span><span class="token punctuation">,</span>ylab <span class="token operator">=</span> <span class="token string">'误差'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> box<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> axis<span class="token punctuation">(</span>side <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>at <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#7FC97F'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#BEAED4'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#FDC086'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#FFFF99'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> lines<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span>lty <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'#386CB0'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">11</span><span class="token operator">:</span><span class="token number">20</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">21</span><span class="token operator">:</span><span class="token number">30</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">31</span><span class="token operator">:</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> points<span class="token punctuation">(</span>x <span class="token operator">=</span> <span class="token number">1</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">,</span>y <span class="token operator">=</span> y<span class="token punctuation">[</span><span class="token number">41</span><span class="token operator">:</span><span class="token number">50</span><span class="token punctuation">]</span><span class="token punctuation">,</span>pch <span class="token operator">=</span> <span class="token number">17</span><span class="token punctuation">,</span>col <span class="token operator">=</span> <span class="token string">'red'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> legend<span class="token punctuation">(</span><span class="token string">'topright'</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'m=1'</span><span class="token punctuation">,</span><span class="token string">'m=2'</span><span class="token punctuation">,</span><span class="token string">'m=3'</span><span class="token punctuation">,</span><span class="token string">'m=4'</span><span class="token punctuation">,</span><span class="token string">'m=5'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                  lty <span class="token operator">=</span> rep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>lwd <span class="token operator">=</span> rep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                  col <span class="token operator">=</span> col<span class="token punctuation">[</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> which.min<span class="token punctuation">(</span>rowSums<span class="token punctuation">(</span>C<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> final2 <span class="token operator">=</span> pred.XY<span class="token punctuation">(</span>newSignals <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token operator">:</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">,</span>newAngles <span class="token operator">=</span> test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token operator">+</span>                  trainData <span class="token operator">=</span> temp1<span class="token punctuation">,</span>numAngles <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> k <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> 
<span class="token operator">&gt;</span> err2 <span class="token operator">=</span> error.cal<span class="token punctuation">(</span>final2<span class="token punctuation">,</span>test.XY<span class="token punctuation">[</span><span class="token punctuation">,</span>c<span class="token punctuation">(</span><span class="token string">'X'</span><span class="token punctuation">,</span><span class="token string">'Y'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

</code></pre> 
<p>以上就是本篇博客的全部内容，欢迎各位小伙伴批评指正，您的建议将是我不断更新的动力！谢谢！</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/95bb369686a709ae325eeabd4d8af42a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Win10&#43;vs2019配置Ceres Solver，含Eigen，gflags，glog，suitsparse（亲测可用）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5f07b9b1b298847ba15e272d93001fa5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">linux通配符和正则表达式深层解析...</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>