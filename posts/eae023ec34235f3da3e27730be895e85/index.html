<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8s 中 ConfigMap 使用介绍 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8s 中 ConfigMap 使用介绍" />
<meta property="og:description" content="K8s 中 ConfigMap 使用介绍 一、基本介绍二、ConfigMap 使用介绍1.ConfigMap 的创建2.Pod 中使用 ConfigMap 一、基本介绍 ConfigMap 是一种 API 对象，用来将非机密性的数据保存到键值对中。使用时，Pods 可以将其用作环境变量、命令行参数或者存储卷中的配置文件。ConfigMap 的主要作用就是为了让镜像和配置文件解耦，以便实现镜像的可移植性和可复用性。 官方介绍
使用 ConfigMap 的限制条件：
ConfigMap 需要在 Pod 启动前创建出来；并且只有当 ConfigMap 和 Pod 处于同一命名空间时，才可以被 Pod 引用；当 Pod 挂载 ConfigMap 绑定的目录时，目录下的目录并不会挂载到 Pod 内，只有目录下的文件会被挂载。 二、ConfigMap 使用介绍 1.ConfigMap 的创建 1）使用目录创建
kubectl create configmap nginx-html --from-file=/etc/nginx/html --from-file：指定在目录下的所有文件都会被用在 ConfigMap 里边创建一个键值对，键的名字就是文件名，值就是文件里内容。 2）使用文件创建
[root@localhost ~]# kubectl create configmap index-html --from-file=/etc/nginx/html/index.html 指定多个文件：kubctl create configmap index-html --from-file=1.txt --from-file=2.txt 3）使用字面值创建
kubectl create configmap dashboard --from-literal=dashboard.username=root --from-literal=dashboard." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/eae023ec34235f3da3e27730be895e85/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-26T13:49:08+08:00" />
<meta property="article:modified_time" content="2022-06-26T13:49:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8s 中 ConfigMap 使用介绍</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>K8s 中 ConfigMap 使用介绍</h4> 
 <ul><li><a href="#_1" rel="nofollow">一、基本介绍</a></li><li><a href="#ConfigMap__11" rel="nofollow">二、ConfigMap 使用介绍</a></li><li><ul><li><a href="#1ConfigMap__12" rel="nofollow">1.ConfigMap 的创建</a></li><li><a href="#2Pod__ConfigMap_32" rel="nofollow">2.Pod 中使用 ConfigMap</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一、基本介绍</h2> 
<p>ConfigMap 是一种 API 对象，用来将非机密性的数据保存到键值对中。使用时，Pods 可以将其用作环境变量、命令行参数或者存储卷中的配置文件。<strong>ConfigMap 的主要作用就是为了让镜像和配置文件解耦，以便实现镜像的可移植性和可复用性。</strong> <a href="https://kubernetes.io/zh/docs/concepts/configuration/configmap/" rel="nofollow">官方介绍</a></p> 
<hr> 
<p>使用 ConfigMap 的限制条件：</p> 
<ol><li>ConfigMap 需要在 Pod 启动前创建出来；</li><li>并且只有当 ConfigMap 和 Pod 处于同一命名空间时，才可以被 Pod 引用；</li><li>当 Pod 挂载 ConfigMap 绑定的目录时，目录下的目录并不会挂载到 Pod 内，只有目录下的文件会被挂载。</li></ol> 
<h2><a id="ConfigMap__11"></a>二、ConfigMap 使用介绍</h2> 
<h3><a id="1ConfigMap__12"></a>1.ConfigMap 的创建</h3> 
<p>1）使用目录创建</p> 
<pre><code class="prism language-handlebars"><span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">configmap</span> <span class="token variable">nginx-html</span> <span class="token variable">--from-file</span><span class="token punctuation">=</span><span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span><span class="token variable">nginx</span><span class="token punctuation">/</span><span class="token variable">html</span>
</code></pre> 
<ul><li><code>--from-file</code>：指定在目录下的所有文件都会被用在 ConfigMap 里边创建一个键值对，<strong>键的名字就是文件名，值就是文件里内容。</strong></li></ul> 
<p>2）使用文件创建</p> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">configmap</span> <span class="token variable">index-html</span> <span class="token variable">--from-file</span><span class="token punctuation">=</span><span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span><span class="token variable">nginx</span><span class="token punctuation">/</span><span class="token variable">html</span><span class="token punctuation">/</span><span class="token variable">index</span><span class="token punctuation">.</span><span class="token variable">html</span>
</code></pre> 
<ul><li>指定多个文件：<code>kubctl create configmap index-html --from-file=1.txt --from-file=2.txt</code></li></ul> 
<p>3）使用字面值创建</p> 
<pre><code class="prism language-handlebars"><span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">configmap</span> <span class="token variable">dashboard</span> <span class="token variable">--from-literal</span><span class="token punctuation">=</span><span class="token variable">dashboard</span><span class="token punctuation">.</span><span class="token variable">username</span><span class="token punctuation">=</span><span class="token variable">root</span> <span class="token variable">--from-literal</span><span class="token punctuation">=</span><span class="token variable">dashboard</span><span class="token punctuation">.</span><span class="token variable">password</span><span class="token punctuation">=</span><span class="token number">123123</span>
</code></pre> 
<hr> 
<ul><li>一般比较常见的便是使用文件创建，因为在有些时候可能需要将配置文件，挂载到容器内。</li><li>不过，我们也可以通过挂载数据卷的方式，来实现实现容器与配置文件的解耦。</li></ul> 
<h3><a id="2Pod__ConfigMap_32"></a>2.Pod 中使用 ConfigMap</h3> 
<p>1）使用 ConfigMap 来替代环境变量</p> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">vim</span> <span class="token number">1.</span><span class="token variable">yaml</span>
<span class="token variable">apiVersion</span><span class="token punctuation">:</span> <span class="token variable">v1</span>								<span class="token punctuation">#</span> <span class="token variable">API</span> <span class="token variable">版本</span> <span class="token punctuation">(</span><span class="token variable">使用</span> <span class="token variable">kubectl</span> <span class="token variable">explain</span> <span class="token variable">ConfigMap</span><span class="token punctuation">(</span><span class="token variable">具体类型</span><span class="token punctuation">)</span> <span class="token variable">即可查看到对应版本号</span><span class="token punctuation">)</span>
<span class="token variable">kind</span><span class="token punctuation">:</span> <span class="token variable">ConfigMap</span>								<span class="token punctuation">#</span> <span class="token variable">类型为</span> <span class="token variable">ConfigMap</span>
<span class="token variable">metadata</span><span class="token punctuation">:</span>
  <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">cm-</span><span class="token number">01</span>								<span class="token punctuation">#</span> <span class="token variable">ConfigMap</span> <span class="token variable">的名称</span> <span class="token punctuation">(</span><span class="token variable">绑定时需要用到</span><span class="token punctuation">)</span>
<span class="token variable">data</span><span class="token punctuation">:</span>
  <span class="token variable">hostname</span><span class="token punctuation">:</span> <span class="token string">"河北彭于晏"</span>						<span class="token punctuation">#</span> <span class="token variable">Key</span> <span class="token variable">和</span> <span class="token variable">Value</span>
  <span class="token variable">password</span><span class="token punctuation">:</span> <span class="token string">"123123"</span>
<span class="token variable">---</span>
<span class="token variable">apiVersion</span><span class="token punctuation">:</span> <span class="token variable">v1</span>
<span class="token variable">kind</span><span class="token punctuation">:</span> <span class="token variable">Pod</span>
<span class="token variable">metadata</span><span class="token punctuation">:</span>
  <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">zhangsan</span>
<span class="token variable">spec</span><span class="token punctuation">:</span>
  <span class="token variable">containers</span><span class="token punctuation">:</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">zhangsan</span>
    <span class="token variable">image</span><span class="token punctuation">:</span> <span class="token variable">busybox</span><span class="token punctuation">:</span><span class="token number">1.28</span><span class="token number">.4</span>
    <span class="token variable">imagePullPolicy</span><span class="token punctuation">:</span> <span class="token variable">IfNotPresent</span>
    <span class="token variable">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'/bin/sh'</span><span class="token punctuation">,</span><span class="token string">'-c'</span><span class="token punctuation">,</span><span class="token string">'env'</span><span class="token punctuation">]</span>
    <span class="token variable">env</span><span class="token punctuation">:</span>									<span class="token punctuation">#</span> <span class="token variable">配置环境变量</span>
    <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">HostName</span>						<span class="token punctuation">#</span> <span class="token variable">变量名</span>
      <span class="token variable">valueFrom</span><span class="token punctuation">:</span>
        <span class="token variable">configMapKeyRef</span><span class="token punctuation">:</span>
          <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">cm-</span><span class="token number">01</span>						<span class="token punctuation">#</span> <span class="token variable">ConfigMap</span> <span class="token variable">名称</span> <span class="token punctuation">(</span><span class="token variable">要和上面对应</span><span class="token punctuation">)</span>
          <span class="token variable">key</span><span class="token punctuation">:</span> <span class="token variable">hostname</span>						<span class="token punctuation">#</span> <span class="token variable">ConfigMap</span> <span class="token variable">里边的</span> <span class="token variable">Key</span> <span class="token punctuation">(</span><span class="token variable">要和上面对应</span><span class="token punctuation">)</span>
    <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">Password</span>
      <span class="token variable">valueFrom</span><span class="token punctuation">:</span>
        <span class="token variable">configMapKeyRef</span><span class="token punctuation">:</span>
          <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">cm-</span><span class="token number">01</span>
          <span class="token variable">key</span><span class="token punctuation">:</span> <span class="token variable">password</span>
  <span class="token variable">restartPolicy</span><span class="token punctuation">:</span> <span class="token variable">Never</span>						<span class="token punctuation">#</span> <span class="token variable">当容器退出后</span><span class="token punctuation">.</span> <span class="token variable">不会进行重启操作</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">-f</span> <span class="token number">1.</span><span class="token variable">yaml</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">get</span> <span class="token punctuation">|</span> <span class="token variable">grep</span> <span class="token variable">zhangsan</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">logs</span> <span class="token variable">zhangsan</span> <span class="token punctuation">|</span> <span class="token variable">egrep</span> <span class="token string">'HostName|Password'</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fc/b0/fQ9j1Upf_o.png" alt="在这里插入图片描述"><br> 2）使用 ConfigMap 配置命令行参数</p> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">vim</span> <span class="token number">2.</span><span class="token variable">yaml</span>
<span class="token variable">apiVersion</span><span class="token punctuation">:</span> <span class="token variable">v1</span>
<span class="token variable">kind</span><span class="token punctuation">:</span> <span class="token variable">ConfigMap</span>
<span class="token variable">metadata</span><span class="token punctuation">:</span>
  <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">cm-</span><span class="token number">01</span>
<span class="token variable">data</span><span class="token punctuation">:</span>
  <span class="token variable">hostname</span><span class="token punctuation">:</span> <span class="token string">"河北彭于晏"</span>
  <span class="token variable">password</span><span class="token punctuation">:</span> <span class="token string">"123123"</span>
<span class="token variable">---</span>
<span class="token variable">apiVersion</span><span class="token punctuation">:</span> <span class="token variable">v1</span>
<span class="token variable">kind</span><span class="token punctuation">:</span> <span class="token variable">Pod</span>
<span class="token variable">metadata</span><span class="token punctuation">:</span>
  <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">zhangsan</span>
<span class="token variable">spec</span><span class="token punctuation">:</span>
  <span class="token variable">containers</span><span class="token punctuation">:</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">zhangsan</span>
    <span class="token variable">image</span><span class="token punctuation">:</span> <span class="token variable">busybox</span><span class="token punctuation">:</span><span class="token number">1.28</span><span class="token number">.4</span>
    <span class="token variable">imagePullPolicy</span><span class="token punctuation">:</span> <span class="token variable">IfNotPresent</span>
    <span class="token variable">command</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'/bin/sh'</span><span class="token punctuation">,</span><span class="token string">'-c'</span><span class="token punctuation">,</span><span class="token string">'echo $(hostname) $(password)'</span><span class="token punctuation">]</span>
    <span class="token variable">envFrom</span><span class="token punctuation">:</span>													<span class="token punctuation">#</span> <span class="token number">1.6</span> <span class="token variable">版本后新增字段</span>
    <span class="token variable">-</span> <span class="token variable">configMapRef</span><span class="token punctuation">:</span>
        <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">cm-</span><span class="token number">01</span>
  <span class="token variable">restartPolicy</span><span class="token punctuation">:</span> <span class="token variable">Never</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">-f</span> <span class="token number">2.</span><span class="token variable">yaml</span>					<span class="token punctuation">#</span> <span class="token variable">启动前需要先将</span> <span class="token number">1.</span><span class="token variable">yaml</span> <span class="token variable">文件</span> <span class="token variable">delete</span> <span class="token punctuation">(</span><span class="token variable">因为</span> <span class="token variable">Pod</span> <span class="token variable">名称一样</span><span class="token punctuation">)</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">get</span> <span class="token punctuation">|</span> <span class="token variable">grep</span> <span class="token variable">zhangsan</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">logs</span> <span class="token variable">zhangsan</span>
</code></pre> 
<ul><li>在 K8s 1.6 版本后引入新字段 <code>envFrom</code>，可以实现 ConfigMap 中所有的 <code>key:value</code> 自动生成为环境变量。</li><li><code>env</code> 和 <code>envFrom</code> 的区别：前者是可以自定义变量名，但需要重复性操作；后者是不能自定义变量名，但是很便捷。</li><li><code>configMapKeyRef</code> 和 <code>configMapRef</code> 的区别：前者是需要指定 <code>key</code> 和 <code>configmap</code>，后者是只需要指定 <code>configMap</code> 即可。</li></ul> 
<p><img src="https://images2.imgbox.com/39/e7/NXwgDKdH_o.png" alt="在这里插入图片描述"></p> 
<p>3）通过数据卷插件使用 ConfigMap</p> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">configmap</span> <span class="token variable">nginx-html</span> <span class="token variable">--from-file</span><span class="token punctuation">=</span><span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span><span class="token variable">nginx</span><span class="token punctuation">/</span><span class="token variable">html</span><span class="token punctuation">/</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">vim</span> <span class="token variable">nginx-html</span><span class="token punctuation">.</span><span class="token variable">yaml</span>
<span class="token variable">apiVersion</span><span class="token punctuation">:</span> <span class="token variable">v1</span>
<span class="token variable">kind</span><span class="token punctuation">:</span> <span class="token variable">Pod</span>
<span class="token variable">metadata</span><span class="token punctuation">:</span>
  <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">nginx</span>
<span class="token variable">spec</span><span class="token punctuation">:</span>
  <span class="token variable">containers</span><span class="token punctuation">:</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">nginx</span>
    <span class="token variable">image</span><span class="token punctuation">:</span> <span class="token variable">nginx</span><span class="token punctuation">:</span><span class="token number">1.21</span><span class="token number">.0</span>
    <span class="token variable">imagePullPolicy</span><span class="token punctuation">:</span> <span class="token variable">IfNotPresent</span>
    <span class="token variable">ports</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token variable">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">html</span>								<span class="token punctuation">#</span> <span class="token variable">挂载数据卷</span> <span class="token punctuation">(</span><span class="token variable">要跟下面的</span> <span class="token variable">name</span> <span class="token variable">名字相同</span><span class="token punctuation">)</span>
      <span class="token variable">mountPath</span><span class="token punctuation">:</span> <span class="token punctuation">/</span><span class="token variable">var</span><span class="token punctuation">/</span><span class="token variable">www</span><span class="token punctuation">/</span><span class="token variable">html</span>					<span class="token punctuation">#</span> <span class="token variable">容器内的挂载路径</span>
  <span class="token variable">volumes</span><span class="token punctuation">:</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">html</span>									<span class="token punctuation">#</span> <span class="token variable">创建一个数据卷</span>
    <span class="token variable">configMap</span><span class="token punctuation">:</span>									<span class="token punctuation">#</span> <span class="token variable">ConfigMap</span> <span class="token variable">方式</span>
      <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">nginx-html</span>							<span class="token punctuation">#</span> <span class="token variable">要跟创建的</span> <span class="token variable">ConfigMap</span> <span class="token variable">相同</span> <span class="token punctuation">(</span><span class="token variable">绑定关系</span><span class="token punctuation">)</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">-f</span> <span class="token variable">nginx-html</span><span class="token punctuation">.</span><span class="token variable">yaml</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">get</span> <span class="token variable">pod</span> <span class="token punctuation">|</span> <span class="token variable">grep</span> <span class="token variable">nginx</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">exec</span> <span class="token variable">-it</span> <span class="token variable">nginx</span> <span class="token variable">--</span> <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">bash</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/d5/97/Qt5dQXJx_o.png" alt="在这里插入图片描述"></p> 
<p>这里出现了个问题：就是当我们对 <code>ConfigMap</code> 修改时，挂载到容器内的配置会不会一同修改呢。</p> 
<p>请看下面操作：</p> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">edit</span> <span class="token variable">configmap</span> <span class="token variable">nginx-html</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">describe</span> <span class="token variable">configmap</span> <span class="token variable">nginx-html</span> <span class="token punctuation">|</span> <span class="token variable">grep</span> <span class="token variable">-C</span> <span class="token number">8</span> <span class="token variable">Data</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/76/e7/QQBxQNWB_o.png" alt="在这里插入图片描述"></p> 
<p>还有一个点就是，如果我们修改 <code>ConfigMap</code> 对应的配置文件，容器内的配置还会更新吗。</p> 
<p>其实是不会的，请看下面的结构：</p> 
<pre><code class="prism language-handlebars"><span class="token variable">index</span><span class="token punctuation">.</span><span class="token variable">html</span>  <span class="token punctuation">&lt;</span><span class="token variable">--</span>  <span class="token variable">ConfigMap</span>  <span class="token punctuation">&lt;</span><span class="token variable">--</span>  <span class="token variable">Container</span>					<span class="token punctuation">#</span> <span class="token variable">所以修改</span> <span class="token variable">index</span><span class="token punctuation">.</span><span class="token variable">html</span> <span class="token variable">文件并不会使</span> <span class="token variable">Container</span> <span class="token variable">实现热更新</span>
</code></pre> 
<p>4）SubPath 作用</p> 
<ul><li>同一个 Pod 中多个容器挂载同一个卷时提供隔离；</li><li>将 <code>ConfigMap</code> 和 <code>Secret</code> 作为文件挂载到容器中而不覆盖挂载目录下的文件。</li></ul> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">vim</span> <span class="token variable">nginx</span><span class="token punctuation">.</span><span class="token variable">yaml</span>
<span class="token variable">apiVersion</span><span class="token punctuation">:</span> <span class="token variable">v1</span>
<span class="token variable">kind</span><span class="token punctuation">:</span> <span class="token variable">Pod</span>
<span class="token variable">metadata</span><span class="token punctuation">:</span>
  <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">zhangsan</span>
<span class="token variable">spec</span><span class="token punctuation">:</span>
  <span class="token variable">containers</span><span class="token punctuation">:</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">nginx</span>
    <span class="token variable">image</span><span class="token punctuation">:</span> <span class="token variable">nginx</span>
    <span class="token variable">ports</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token variable">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">sub-volume</span>
      <span class="token variable">mountPath</span><span class="token punctuation">:</span> <span class="token punctuation">/</span><span class="token variable">zhangsan</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">tomcat</span>
    <span class="token variable">image</span><span class="token punctuation">:</span> <span class="token variable">tomcat</span>
    <span class="token variable">ports</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token variable">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">sub-volume</span>
      <span class="token variable">mountPath</span><span class="token punctuation">:</span> <span class="token punctuation">/</span><span class="token variable">zhangsan</span>
  <span class="token variable">volumes</span><span class="token punctuation">:</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">sub-volume</span>
    <span class="token variable">hostPath</span><span class="token punctuation">:</span>									<span class="token punctuation">#</span> <span class="token variable">数据卷的类型为：挂载到宿主机指定目录</span>
      <span class="token variable">path</span><span class="token punctuation">:</span> <span class="token punctuation">/</span><span class="token variable">zhangsan</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">-f</span> <span class="token variable">nginx</span><span class="token punctuation">.</span><span class="token variable">yaml</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">get</span> <span class="token variable">pod</span> <span class="token punctuation">|</span> <span class="token variable">grep</span> <span class="token variable">zhangsan</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">exec</span> <span class="token variable">-it</span> <span class="token variable">zhangsan</span> <span class="token variable">-c</span> <span class="token variable">nginx</span> <span class="token variable">--</span> <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">bash</span>			<span class="token punctuation">#</span> <span class="token variable">当</span> <span class="token variable">Pod</span> <span class="token variable">内有多个容器时</span><span class="token punctuation">.</span> <span class="token variable">需要使用</span> <span class="token variable">-c</span> <span class="token variable">指定容器</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/0d/8b/PpnLoEuD_o.png" alt="在这里插入图片描述"></p> 
<p>当我们想要实现在同一数据卷，但数据相互隔离的操作时，就需要用到 <code>SubPath</code></p> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">vim</span> <span class="token variable">nginx</span><span class="token punctuation">.</span><span class="token variable">yaml</span>
<span class="token variable">apiVersion</span><span class="token punctuation">:</span> <span class="token variable">v1</span>
<span class="token variable">kind</span><span class="token punctuation">:</span> <span class="token variable">Pod</span>
<span class="token variable">metadata</span><span class="token punctuation">:</span>
  <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">zhangsan</span>
<span class="token variable">spec</span><span class="token punctuation">:</span>
  <span class="token variable">containers</span><span class="token punctuation">:</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">nginx</span>
    <span class="token variable">image</span><span class="token punctuation">:</span> <span class="token variable">nginx</span>
    <span class="token variable">ports</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token variable">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">sub-volume</span>
      <span class="token variable">mountPath</span><span class="token punctuation">:</span> <span class="token punctuation">/</span><span class="token variable">zhangsan</span>
      <span class="token variable">subPath</span><span class="token punctuation">:</span> <span class="token variable">nginx</span>							<span class="token punctuation">#</span> <span class="token variable">这里的名字会在挂载目录下创建一个相同名字的目录</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">tomcat</span>
    <span class="token variable">image</span><span class="token punctuation">:</span> <span class="token variable">tomcat</span>
    <span class="token variable">ports</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">containerPort</span><span class="token punctuation">:</span> <span class="token number">8080</span>
    <span class="token variable">volumeMounts</span><span class="token punctuation">:</span>
    <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">sub-volume</span>
      <span class="token variable">mountPath</span><span class="token punctuation">:</span> <span class="token punctuation">/</span><span class="token variable">zhangsan</span>
      <span class="token variable">subPath</span><span class="token punctuation">:</span> <span class="token variable">tomcat</span>							<span class="token punctuation">#</span> <span class="token variable">这里的名字会在挂载目录下创建一个相同名字的目录</span>
  <span class="token variable">volumes</span><span class="token punctuation">:</span>
  <span class="token variable">-</span> <span class="token variable">name</span><span class="token punctuation">:</span> <span class="token variable">sub-volume</span>
    <span class="token variable">hostPath</span><span class="token punctuation">:</span>
      <span class="token variable">path</span><span class="token punctuation">:</span> <span class="token punctuation">/</span><span class="token variable">zhangsan</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">create</span> <span class="token variable">-f</span> <span class="token variable">nginx</span><span class="token punctuation">.</span><span class="token variable">yaml</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">get</span> <span class="token variable">pod</span> <span class="token punctuation">|</span> <span class="token variable">grep</span> <span class="token variable">zhangsan</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@localhost ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">kubectl</span> <span class="token variable">exec</span> <span class="token variable">-it</span> <span class="token variable">zhangsan</span> <span class="token variable">-c</span> <span class="token variable">nginx</span> <span class="token variable">--</span> <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">bash</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/15/50/O3gxryo5_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/614618c260abbbb1fd319298a5577b87/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android中Parcelable的原理和使用方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/616b824da433749e6dbfe5ece5cdaf3b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Flutter Windows应用开发环境配置</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>