<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java Optional使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java Optional使用" />
<meta property="og:description" content="文章目录 Optional一、Optional 简介二、创建 Optional 实例2.1 empty()方法2.2 of() 方法2.3 ofNullable() 方法 三、Optional的使用3.1 访问 Optional 对象的值3.1.1 get() 方法3.1.2 isPresent()方法3.1.3 ifPresent()方法 3.2 返回默认值3.2.1 orElse()方法3.2.2 orElseGet()方法3.2.3 orElse() 和 orElseGet() 的不同之处 3.3 返回异常3.3.1 orElseThrow()方法 3.4 转换值3.4.1 map()方法3.4.2 flatMap()方法3.4.3 map()和flatMap()的区别 3.5 过滤值3.5.1 filter()方法 3.6 Optional 类的链式方法 四、Java 9 增强4.1 or()方法4.2 ifPresentOrElse()方法4.3 stream()方法 五、总结 Optional 一、Optional 简介 Opitonal是java8引入的一个新类，目的是为了解决空指针异常问题。本质上，这是一个包含有可选值的包装类，这意味着 Optional 类既可以含有对象也可以为空。
Optional 是 Java 实现函数式编程的强劲一步，并且帮助在范式中实现。但是 Optional 的意义显然不止于此。
二、创建 Optional 实例 2.1 empty()方法 Optional&lt;User&gt; emptyOpt = Optional.empty(); emptyOpt.get(); 尝试访问 emptyOpt 变量的值会导致 NoSuchElementException。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/68fd9e3cacb608c56af065fa7ddf1912/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-10T10:53:00+08:00" />
<meta property="article:modified_time" content="2022-03-10T10:53:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java Optional使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Optional_1" rel="nofollow">Optional</a></li><li><ul><li><a href="#Optional__3" rel="nofollow">一、Optional 简介</a></li><li><a href="#_Optional__10" rel="nofollow">二、创建 Optional 实例</a></li><li><ul><li><ul><li><a href="#21_empty_11" rel="nofollow">2.1 empty()方法</a></li><li><a href="#22__of__22" rel="nofollow">2.2 of() 方法</a></li><li><a href="#23_ofNullable__32" rel="nofollow">2.3 ofNullable() 方法</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Optional_46" rel="nofollow">三、Optional的使用</a></li><li><ul><li><a href="#31__Optional__48" rel="nofollow">3.1 访问 Optional 对象的值</a></li><li><ul><li><a href="#311_get__50" rel="nofollow">3.1.1 get() 方法</a></li><li><a href="#312_isPresent_63" rel="nofollow">3.1.2 isPresent()方法</a></li><li><a href="#313_ifPresent_73" rel="nofollow">3.1.3 ifPresent()方法</a></li></ul> 
    </li><li><a href="#32__83" rel="nofollow">3.2 返回默认值</a></li><li><ul><li><a href="#321_orElse_85" rel="nofollow">3.2.1 orElse()方法</a></li><li><a href="#322_orElseGet_101" rel="nofollow">3.2.2 orElseGet()方法</a></li><li><a href="#323_orElse__orElseGet__111" rel="nofollow">3.2.3 orElse() 和 orElseGet() 的不同之处</a></li></ul> 
    </li><li><a href="#33__118" rel="nofollow">3.3 返回异常</a></li><li><ul><li><a href="#331_orElseThrow_120" rel="nofollow">3.3.1 orElseThrow()方法</a></li></ul> 
    </li><li><a href="#34__128" rel="nofollow">3.4 转换值</a></li><li><ul><li><a href="#341_map_130" rel="nofollow">3.4.1 map()方法</a></li><li><a href="#342_flatMap_159" rel="nofollow">3.4.2 flatMap()方法</a></li><li><a href="#343_mapflatMap_176" rel="nofollow">3.4.3 map()和flatMap()的区别</a></li></ul> 
    </li><li><a href="#35__188" rel="nofollow">3.5 过滤值</a></li><li><ul><li><a href="#351_filter_190" rel="nofollow">3.5.1 filter()方法</a></li></ul> 
    </li><li><a href="#36_Optional__220" rel="nofollow">3.6 Optional 类的链式方法</a></li></ul> 
   </li><li><a href="#Java_9__253" rel="nofollow">四、Java 9 增强</a></li><li><ul><li><ul><li><a href="#41_or_257" rel="nofollow">4.1 or()方法</a></li><li><a href="#42_ifPresentOrElse_270" rel="nofollow">4.2 ifPresentOrElse()方法</a></li><li><a href="#43_stream_283" rel="nofollow">4.3 stream()方法</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_303" rel="nofollow">五、总结</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Optional_1"></a>Optional</h2> 
<h3><a id="Optional__3"></a>一、Optional 简介</h3> 
<p>Opitonal是java8引入的一个新类，目的是为了解决空指针异常问题。本质上，这是一个包含有可选值的包装类，这意味着 Optional 类既可以含有对象也可以为空。</p> 
<p>Optional 是 Java 实现函数式编程的强劲一步，并且帮助在范式中实现。但是 Optional 的意义显然不止于此。</p> 
<br> 
<h3><a id="_Optional__10"></a>二、创建 Optional 实例</h3> 
<h5><a id="21_empty_11"></a>2.1 empty()方法</h5> 
<pre><code class="prism language-java">Optional<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> emptyOpt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
emptyOpt<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>尝试访问 emptyOpt 变量的值会导致 NoSuchElementException。</p> 
<h5><a id="22__of__22"></a>2.2 of() 方法</h5> 
<pre><code class="prism language-java">Optional<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果你把 null 值作为参数传递进去，of() 方法会抛出 NullPointerException</p> 
<h5><a id="23_ofNullable__32"></a>2.3 ofNullable() 方法</h5> 
<pre><code class="prism language-java">Optional<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>如果你把 null 值作为参数传递进去，ofNullable() 方法不会抛出 NullPointerException</p> 
<p>因此，你应该明确对象不为 null 的时候使用 of()。如果对象即可能是 null 也可能是非 null，你就应该使用 ofNullable() 方法。</p> 
<br> 
<h3><a id="Optional_46"></a>三、Optional的使用</h3> 
<h4><a id="31__Optional__48"></a>3.1 访问 Optional 对象的值</h4> 
<h5><a id="311_get__50"></a>3.1.1 get() 方法</h5> 
<pre><code class="prism language-java">String name <span class="token operator">=</span> <span class="token string">"John"</span><span class="token punctuation">;</span>
Optional<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertEquals</span><span class="token punctuation">(</span><span class="token string">"John"</span><span class="token punctuation">,</span> opt<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这个方法会在值为 null的时候抛出异常。</p> 
<h5><a id="312_isPresent_63"></a>3.1.2 isPresent()方法</h5> 
<pre><code class="prism language-java">User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"john@gmail.com"</span><span class="token punctuation">,</span> <span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Optional<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> opt <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertTrue</span><span class="token punctuation">(</span>opt<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertEquals</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> opt<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="313_ifPresent_73"></a>3.1.3 ifPresent()方法</h5> 
<p>该方法除了执行检查，还接受一个Consumer(消费者) 参数，如果对象不是空的，就对执行传入的 Lambda 表达式:</p> 
<pre><code class="prism language-java">opt<span class="token punctuation">.</span><span class="token function">ifPresent</span><span class="token punctuation">(</span> u <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token function">assertEquals</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="32__83"></a>3.2 返回默认值</h4> 
<h5><a id="321_orElse_85"></a>3.2.1 orElse()方法</h5> 
<p>Optional类提供了API用以返回对象值，或者在对象为空的时候返回默认值：orElse()，<br> 如果有值则返回该值，否则返回传递给它的参数值：</p> 
<pre><code class="prism language-java">User user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"anna@gmail.com"</span><span class="token punctuation">,</span> <span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
User result <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span>user2<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertEquals</span><span class="token punctuation">(</span>user2<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> result<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>这里 user 对象是空的，所以返回了作为默认值的 user2。如果对象的初始值不是 null，那么默认值会被忽略。</p> 
<h5><a id="322_orElseGet_101"></a>3.2.2 orElseGet()方法</h5> 
<p>这个方法会在有值的时候返回值，如果没有值，它会执行作为参数传入的 Supplier(供应者) 函数式接口，并将返回其执行结果：</p> 
<pre><code class="prism language-java">User result <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseGet</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> user2<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="323_orElse__orElseGet__111"></a>3.2.3 orElse() 和 orElseGet() 的不同之处</h5> 
<ul><li>对象为空时两者的行为都会执行。</li><li>对象不为空时，orElse()方法中的行为会执行，而orElseGet()方法中的行为不会执行。<mark>在执行较密集的调用时，比如调用 Web 服务或数据查询，这个差异会对性能产生重大影响。</mark></li></ul> 
<h4><a id="33__118"></a>3.3 返回异常</h4> 
<h5><a id="331_orElseThrow_120"></a>3.3.1 orElseThrow()方法</h5> 
<pre><code class="prism language-java">User result <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElseThrow</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token keyword">new</span> <span class="token class-name">IllegalArgumentException</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="34__128"></a>3.4 转换值</h4> 
<h5><a id="341_map_130"></a>3.4.1 map()方法</h5> 
<pre><code class="prism language-java">User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"anna@gmail.com"</span><span class="token punctuation">,</span> <span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String email <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>u <span class="token operator">-</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"default@gmail.com"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertEquals</span><span class="token punctuation">(</span>email<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>map() 对值应用(调用)作为参数的函数，然后将返回的值包装在 Optional 中。这就使对返回值进行链试调用的操作成为可能。</p> 
<p><mark>注意：如果map中操作对象为空，直接返回Optional.empty。</mark></p> 
<p>见源码，isPresent()先判断Optional中对象是否为null：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span><span class="token generics function"><span class="token punctuation">&lt;</span>U<span class="token punctuation">&gt;</span></span> Optional<span class="token generics function"><span class="token punctuation">&lt;</span>U<span class="token punctuation">&gt;</span></span> <span class="token function">map</span><span class="token punctuation">(</span>Function<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> T<span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">U</span><span class="token operator">&gt;</span> mapper<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
	Objects<span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>mapper<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>mapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="342_flatMap_159"></a>3.4.2 flatMap()方法</h5> 
<p>flatMap() 也需要函数作为参数，并对值调用这个函数，然后直接返回结果。</p> 
<pre><code class="prism language-java">User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"anna@gmail.com"</span><span class="token punctuation">,</span> <span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
user<span class="token punctuation">.</span><span class="token function">setPosition</span><span class="token punctuation">(</span><span class="token string">"Developer"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String position <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>u <span class="token operator">-</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertEquals</span><span class="token punctuation">(</span>position<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getPosition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><mark>注意：如果flatMap中操作对象为空，直接返回Optional.empty。</mark> 原理同上。</p> 
<h5><a id="343_mapflatMap_176"></a>3.4.3 map()和flatMap()的区别</h5> 
<p>map和flatMap都接收一个mapping function参数。</p> 
<p>map和flatMap返回的都是Optional类型的数据。</p> 
<p>当mapping function返回的是Optional类型的数据时，可以直接使用flatMap，flatMap直接返回该Optional。</p> 
<p>当mapping function返回的不是Optional类型的数据时，使用map，因为map会进行一次Optional的包装。</p> 
<h4><a id="35__188"></a>3.5 过滤值</h4> 
<h5><a id="351_filter_190"></a>3.5.1 filter()方法</h5> 
<p>filter() 接受一个 Predicate 参数，返回测试结果为 true 的值。如果测试结果为 false，会返回一个空的 Optional。</p> 
<pre><code class="prism language-java">User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"anna@gmail.com"</span><span class="token punctuation">,</span> <span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Optional<span class="token generics function"><span class="token punctuation">&lt;</span>User<span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>u <span class="token operator">-</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertTrue</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><mark>注意：如果filter中操作对象为空，直接返回自身。</mark></p> 
<p>见源码：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> Optional<span class="token generics function"><span class="token punctuation">&lt;</span>T<span class="token punctuation">&gt;</span></span> <span class="token function">filter</span><span class="token punctuation">(</span>Predicate<span class="token operator">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> T<span class="token operator">&gt;</span> predicate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Objects<span class="token punctuation">.</span><span class="token function">requireNonNull</span><span class="token punctuation">(</span>predicate<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isPresent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        <span class="token keyword">return</span> predicate<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token operator">?</span> <span class="token keyword">this</span> <span class="token operator">:</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="36_Optional__220"></a>3.6 Optional 类的链式方法</h4> 
<p>为了更充分的使用 Optional，你可以链接组合其大部分方法，因为它们都返回相同类似的对象。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">whenChaining_thenOk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"anna@gmail.com"</span><span class="token punctuation">,</span> <span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    String result <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>u <span class="token operator">-</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>a <span class="token operator">-</span><span class="token operator">&gt;</span> a<span class="token punctuation">.</span><span class="token function">getCountry</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>c <span class="token operator">-</span><span class="token operator">&gt;</span> c<span class="token punctuation">.</span><span class="token function">getIsocode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">assertEquals</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span> <span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>上面的代码可以通过方法引用进一步缩减：</p> 
<pre><code class="prism language-java">String result <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>User<span class="token operator">:</span><span class="token operator">:</span>getAddress<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>Address<span class="token operator">:</span><span class="token operator">:</span>getCountry<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>Country<span class="token operator">:</span><span class="token operator">:</span>getIsocode<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">orElse</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h3><a id="Java_9__253"></a>四、Java 9 增强</h3> 
<p>Java 9 为 Optional 类添加了三个方法：or()、ifPresentOrElse() 和 stream()。</p> 
<h5><a id="41_or_257"></a>4.1 or()方法</h5> 
<p>or() 方法与 orElse() 和 orElseGet() 类似，它们都在对象为空的时候提供了替代情况。or() 的返回值是由 Supplier 参数产生的另一个 <mark>Optional 对象</mark>，可以配合flatMap使用。如果对象包含值，则 Lambda 表达式不会执行：</p> 
<pre><code class="prism language-java">User result <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">or</span><span class="token punctuation">(</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> Optional<span class="token punctuation">.</span><span class="token function">of</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"default"</span><span class="token punctuation">,</span><span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertEquals</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"default"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="42_ifPresentOrElse_270"></a>4.2 ifPresentOrElse()方法</h5> 
<p>ifPresentOrElse() 方法需要两个参数：一个 Consumer 和一个 Runnable。如果对象包含值，会执行 Consumer 的动作，否则运行 Runnable。</p> 
<p>如果你想在有值的时候执行某个动作，或者只是跟踪是否定义了某个值，那么这个方法非常有用：</p> 
<pre><code class="prism language-java">Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ifPresentOrElse</span><span class="token punctuation">(</span> u <span class="token operator">-</span><span class="token operator">&gt;</span> logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"User is:"</span> <span class="token operator">+</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span><span class="token operator">&gt;</span> logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"User not found"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h5><a id="43_stream_283"></a>4.3 stream()方法</h5> 
<p>它通过把实例转换为 Stream 对象，让你从广大的 Stream API 中受益。如果没有值，它会得到空的 Stream；有值的情况下，Stream 则会包含单一值。</p> 
<pre><code class="prism language-java">User user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token string">"john@gmail.com"</span><span class="token punctuation">,</span> <span class="token string">"1234"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> emails <span class="token operator">=</span> Optional<span class="token punctuation">.</span><span class="token function">ofNullable</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">stream</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span>u <span class="token operator">-</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">contains</span><span class="token punctuation">(</span><span class="token string">"@"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span> u <span class="token operator">-</span><span class="token operator">&gt;</span> u<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span>Collectors<span class="token punctuation">.</span><span class="token function">toList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">assertTrue</span><span class="token punctuation">(</span>emails<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">assertEquals</span><span class="token punctuation">(</span>emails<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<br> 
<h3><a id="_303"></a>五、总结</h3> 
<p>Optional 是 Java 语言的有益补充 —— 它旨在减少代码中的 NullPointerExceptions，虽然还不能完全消除这些异常。</p> 
<p>它也是精心设计，自然融入 Java 8 函数式支持的功能。</p> 
<p>总的来说，这个简单而强大的类有助于创建简单、可读性更强、比对应程序错误更少的程序。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d4aab7d12b0e3acec27e33508ca42e01/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Docker容器没有vi/vim</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fe6d3603367683972a0c39a644e426ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C语言用什么 IDE 好 - 除了 Visual Studio、VSCode、CLion 还有什么其他选择？</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>