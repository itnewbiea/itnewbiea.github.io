<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>axios常用请求封装 vue3.0 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="axios常用请求封装 vue3.0" />
<meta property="og:description" content="import axios from &#39;axios&#39; import qs from &#39;qs&#39; import { ElMessage } from &#39;element-plus&#39; import store from &#39;@/store&#39; import cache from &#39;@/utils/cache&#39; // axios实例 const service = axios.create({ baseURL: import.meta.env.VITE_API_URL as any, timeout: 60000, headers: { &#39;Content-Type&#39;: &#39;application/json;charset=UTF-8&#39; } }) // 请求拦截器 service.interceptors.request.use( (config) =&gt; { const userStore = store.userStore if (userStore?.token) { config.headers.Authorization = &#39;Bearer &#39; &#43; userStore.token } config.headers[&#39;Accept-Language&#39;] = cache.getLanguage() // 追加时间戳，防止GET请求缓存 if (config.method?.toUpperCase() === &#39;GET&#39;) { config." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cfb161546a9f56ea4c79934639d8f7e7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-15T11:25:40+08:00" />
<meta property="article:modified_time" content="2023-06-15T11:25:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">axios常用请求封装 vue3.0</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre><code class="hljs">import axios from 'axios'

import qs from 'qs'

import { ElMessage } from 'element-plus'

import store from '@/store'

import cache from '@/utils/cache'



// axios实例

const service = axios.create({

    baseURL: import.meta.env.VITE_API_URL as any,

    timeout: 60000,

    headers: { 'Content-Type': 'application/json;charset=UTF-8' }

})



// 请求拦截器

service.interceptors.request.use(

    (config) =&gt; {

        const userStore = store.userStore

        if (userStore?.token) {

            config.headers.Authorization = 'Bearer ' + userStore.token

        }



        config.headers['Accept-Language'] = cache.getLanguage()



        // 追加时间戳，防止GET请求缓存

        if (config.method?.toUpperCase() === 'GET') {

            config.params = { ...config.params, t: new Date().getTime() }

        }



        if (Object.values(config.headers).includes('application/x-www-form-urlencoded')) {

            config.data = qs.stringify(config.data)

        }



        return config

    },

    error =&gt; {

        return Promise.reject(error)

    }

)



// 响应拦截器

service.interceptors.response.use(

    response =&gt; {

        if (response.status !== 200) {

            return Promise.reject(new Error(response.statusText || 'Error'))

        }



        const res = response.data

        // 响应成功

        if (res.code === 0) {

            return res

        }



        // 错误提示

        ElMessage.error(res.msg)



        // 没有权限，如：未登录、登录过期等，需要跳转到登录页

        if (res.code === 401) {

            store.userStore.setToken('')

            location.reload()

        }



        return Promise.reject(new Error(res.msg || 'Error'))

    },

    error =&gt; {

        ElMessage.error(error.message)

        return Promise.reject(error)

    }

)



// 导出 axios 实例

export default service

store.js

import { userStore } from './modules/user'

import { routerStore } from './modules/router'

import { appStore } from './modules/app'

import { tabsStore } from './modules/tabs'



const store: any = {}



export const registerStore = () =&gt; {

    store.userStore = userStore()

    store.routerStore = routerStore()

    store.appStore = appStore()

    store.tabsStore = tabsStore()

}



export default store

user.js

import { defineStore } from 'pinia'

import { useLoginApi, useLogoutApi } from '@/api/login'

import { useUserInfoApi } from '@/api/user'

import cache from '@/utils/cache'



export const userStore = defineStore('userStore', {

    state: () =&gt; ({

        user: {

            id: '',

            username: '',

            email: '',

            avatar: ''

        },

        token: cache.getToken()

    }),

    actions: {

        setUser(val: any) {

            this.user = val

        },

        setToken(val: any) {

            this.token = val

            cache.setToken(val)

        },

        // 用户登录

        async loginAction(loginForm: any) {

            const res: any = await useLoginApi(loginForm)

            this.setToken(res.access_token)

        },

        // 获取用户信息

        async getUserInfoAction() {

            const { data } = await useUserInfoApi()

            this.setUser(data)

        },

        // 用户退出

        async logoutAction() {

            await useLogoutApi()



            // 移除 token

            this.setToken(null)

        }

    }

})



页面使用

import service from '@/utils/request'



export const useLoginApi = (data: any) =&gt; {

    return service.post('/data/login.json', data, {

        auth: {

            username: 'web',

            password: '123456'

        },

        headers: {

            'Content-Type': 'application/x-www-form-urlencoded'

        }

    })

}



export const useLogoutApi = () =&gt; {

    return service.post('/data/success.json')

}







</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d79d4b27b6ad63bf102f199c6e116619/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[开发|前端] dayjs获取月份和季度起始时间</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b741a4377d98512210afc56b9edff16f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">4招教你怎么修改照片尺寸</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>