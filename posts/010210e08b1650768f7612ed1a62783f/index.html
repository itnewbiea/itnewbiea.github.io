<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>代码解读 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="代码解读" />
<meta property="og:description" content="原文地址：代码解读 作者：交易之外 代码解读 在MT4安装后，默认会给用户提供几个例子程序，这些程序对于新学习EA开发过程中有很大的帮助，下面我们就来对MACD Sample这个例子EA来做个解读，来看看别人是如何开发一个EA的。 首先是注释，在MQL语言中所有//的这一行就是注释行，系统本身不会去执行它，它只是用来解释当前代码的含义的，我们在代码中加入这些注释为了是让我们能够清楚的阅读代码的含义，在程序中加入详细的注释是一个很好的编程习惯，我们鼓励大家多加入注释。很多人觉得注释这东西因为没用在写代码中觉得很麻烦而忽略它，但是即使是自己编写的程序如果不加注释过几天就会忘记意思，还要再一行一行地看这些代码，所以注释是非常重要的。 下面这些就是定义变量，我们发现前面加上了extern关键字，如果在定义变量的前面有这个词说明这个变量将会被作为EA运行的参数，举个例子，比如我要编写一个EA，在使用过程中我想改变它的止盈和止损值，如果我程序都是事先编好的止盈止损，那么以后要改动它必须要改代码，这样不仅麻烦也不灵活，如果我把这些信息作为EA运行参数，那么在EA运行中就可以随时调整它了。 extern double TakeProfit = 50; extern double Lots = 0.1; extern double TrailingStop = 30; extern double MACDOpenLevel=3; extern double MACDCloseLevel=2; extern double MATrendPeriod=26; 上面定义了6个变量并且都是当作参数，这里设定变量名称的时候尽量使用用户可以理解的词汇，在EA的参数设置里这些变量名就是参数的名字。值得注意的是EA里变量名称是可以用中文的。 int start() start()函数是EA运行的核心，MQL语言规定了几个默认函数，其中EA第一次运行时会调用init()函数，在这个函数里我们可以放入一些需要初始化的信息，start()函数中放我们EA的核心代码，每次一个TICK(换句话说就是新报价)来到后，系统会自动调用start()函数。deinit()函数是当EA关闭的时候调用的，这里放一些我们程序停止后需要“善后”的代码。start()函数是必须要有的，其它两个函数如果不需要可以不用写。 if(Bars&lt;100) { Print(&#34;bars less than 100&#34;); return(0); } 上面代码的意思是如果当前图表中的k线少于100根将会在日志信息里输出提示信息并且结束start()函数的执行。return的意思是返回，如果在程序中判断出有错误，下面的代码无法继续执行了，我们调用return()函数让他退出start()函数的执行。 if(TakeProfit&lt;10) { Print(&#34;TakeProfit less than 10&#34;); return(0); // check TakeProfit } 上面的代码意思是如果参数里的TakeProfit变量小于10也提示一条信息并结束执行，TakeProfit从字面的意思中我们可以知道是止盈的意思，有些平台会限制下单时的止盈点数不得小于某个点，如果小于某值会在下单时报错，为了避免这种错误我们会限制参数中止盈的设定。 其实这里可以调用MarketInfo()函数得到我们当前平台中允许的止盈止损最小值从而根据平台的不同自动计算出最小的止盈点数，详细情况请参阅文档MarketInfo()函数的描述。 MacdCurrent=iMACD(NULL,0,12,26,9,PRICE_CLOSE,MODE_MAIN,0); MacdPrevious=iMACD(NULL,0,12,26,9,PRICE_CLOSE,MODE_MAIN,1); SignalCurrent=iMACD(NULL,0,12,26,9,PRICE_CLOSE,MODE_SIGNAL,0); SignalPrevious=iMACD(NULL,0,12,26,9,PRICE_CLOSE,MODE_SIGNAL,1); MaCurrent=iMA(NULL,0,MATrendPeriod,0,MODE_EMA,PRICE_CLOSE,0); MaPrevious=iMA(NULL,0,MATrendPeriod,0,MODE_EMA,PRICE_CLOSE,1); 以上语句是调用了MQL的一些内置指标函数，在MQL语言中，对于常用的指标如均线，MACD，KD等MQL已经提供给我们现成的函数，我们只要调用他即可得到指标的值(相见文档技术指标部分：http://docs.mql4.com/cn/indicators)。 就上面的代码，MacdCurrent的值是参数为12，26，9的MACD主线当前K线的值，MacdPrevious则是MacdCurrent前一根K线的值，SignalCurrent和SignalPrevious则是相同参数信号线的当前值和前一根值。 后两个是调用均线指标函数，这里的均线周期参数则是使用了EA的参数变量MATrendPeriod，这样写是个好习惯，把调用指标的参数放到EA参数里，这样可以随时在运行中调整这些参数方便我们改变策略。MaCurrent和MaPrevious是得到26均线的当前K线值和前一根的值。 total=OrdersTotal(); if(total&lt;&lt;/font&gt;1) 上面的代码就是判断我们当前是否有单子在做，他调用了OrdersTotal()函数，它可以计算当前账户中一共还没有平仓的单子和挂单的个数，如果它小于1说明当前没有任何单子，这种判断方法只是一种简单的判断法，如果这个EA在运行过程中人为也去下单则EA永远不会下单了，如果要更加精确的计算这个EA所下的单子数量还需要利用其他方法，这些技巧我们会在以后的文章中介绍。 if(AccountFreeMargin()&lt;(1000*Lots)) { Print(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/010210e08b1650768f7612ed1a62783f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-03-16T10:57:26+08:00" />
<meta property="article:modified_time" content="2017-03-16T10:57:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">代码解读</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="sina_keyword_ad_area2" class="articalContent   newfont_family"> 
 <div class="blogzz_abstract borderc" style="padding-top:15px;margin:20px 0; border:none; border-top:1px dotted #ccc;"> 
  <div class="blogzz_ainfo" style="margin-bottom:12px;"> 
   <span style="margin-right:25px;"><strong>原文地址：</strong><a target="_blank" href="http://blog.sina.com.cn/s/blog_76df29e70101j51u.html" rel="nofollow noopener noreferrer" title="代码解读">代码解读</a></span> 
   <strong>作者：</strong><a href="http://blog.sina.com.cn/u/1994336743" rel="nofollow noopener noreferrer" title="交易之外" target="_blank">交易之外</a> 
  </div> 
  <div class="blogzz_acon"> 
   <h3>代码解读</h3> 
   <div align="left"> 
    <font color="#000000">在<font face="Times New Roman">MT4</font>安装后，默认会给用户提供几个例子程序，这些程序对于新学习<font face="Times New Roman">EA</font>开发过程中有很大的帮助，下面我们就来对<font face="Times New Roman">MACD Sample</font>这个例子<font face="Times New Roman">EA</font>来做个解读，来看看别人是如何开发一个<font face="Times New Roman">EA</font>的。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">首先是注释，在<font face="Times New Roman">MQL</font>语言中所有<font face="Times New Roman">//</font>的这一行就是注释行，系统本身不会去执行它，它只是用来解释当前代码的含义的，我们在代码中加入这些注释为了是让我们能够清楚的阅读代码的含义，在程序中加入详细的注释是一个很好的编程习惯，我们鼓励大家多加入注释。很多人觉得注释这东西因为没用在写代码中觉得很麻烦而忽略它，但是即使是自己编写的程序如果不加注释过几天就会忘记意思，还要再一行一行地看这些代码，所以注释是非常重要的。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">下面这些就是定义变量，我们发现前面<strong>加上了<font face="Times New Roman">extern</font>关键字</strong>，如果在定义变量的前面有这个词说明这<strong>个变量将会被作为<font face="Times New Roman">EA</font>运行的参数</strong>，举个例子，比如我要编写一个<font face="Times New Roman">EA</font>，在使用过程中我想改变它的止盈和止损值，如果我程序都是事先编好的止盈止损，那么以后要改动它必须要改代码，这样不仅麻烦也不灵活，如果我<strong>把这些信息作为<font face="Times New Roman">EA</font>运行参数，那么在<font face="Times New Roman">EA</font>运行中就可以随时调整它了。</strong></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">extern double <font color="#000000">TakeProfit =</font> 50<font color="#000000">;</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">extern double <font color="#000000">Lots =</font> 0.1<font color="#000000">;</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">extern double <font color="#000000">TrailingStop =</font> 30<font color="#000000">;</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">extern double <font color="#000000">MACDOpenLevel=</font>3<font color="#000000">;</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">extern double <font color="#000000">MACDCloseLevel=</font>2<font color="#000000">;</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">extern double <font color="#000000">MATrendPeriod=</font>26<font color="#000000">;</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">上面定义了<font face="Times New Roman">6</font>个变量并且都是当作参数，这里设定变量名称的时候尽量使用用户可以理解的词汇，<strong>在<font face="Times New Roman">EA</font>的参数设置里这些变量名就是参数的名字</strong>。值得注意的是<font face="Times New Roman">EA</font>里变量名称是可以用中文的。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">int <font color="#000000">start()</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">start()</font>函数是<font face="Times New Roman">EA</font>运行的核心，<font face="Times New Roman">MQL</font>语言规定了几个默认函数，其中<font face="Times New Roman">EA</font>第一次运行时会调用<font face="Times New Roman">init()</font>函数，在这个函数里我们可以放入一些需要初始化的信息，<font face="Times New Roman">start()</font>函数中放我们<font face="Times New Roman">EA</font>的核心代码，每次一个<font face="Times New Roman">TICK(</font>换句话说就是新报价<font face="Times New Roman">)</font>来到后，系统会自动调用<font face="Times New Roman">start()</font>函数。<font face="Times New Roman">deinit()</font>函数是当<font face="Times New Roman">EA</font>关闭的时候调用的，这里放一些我们程序停止后需要<font face="Times New Roman">“</font>善后<font face="Times New Roman">”</font>的代码。<font face="Times New Roman">start()</font>函数是必须要有的，其它两个函数如果不需要可以不用写。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if<font color="#000000">(</font>Bars<font color="#000000">&lt;100<font color="#000000">)</font></font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>Print<font color="#000000">("</font>bars less than 100<font color="#000000">");</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>return<font color="#000000">(0); <wbr></wbr><wbr></wbr></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">}</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">上面代码的意思是如果当前图表中的<font face="Times New Roman">k</font>线少于<font face="Times New Roman">100</font>根将会在日志信息里输出提示信息并且结束<font face="Times New Roman">start()</font>函数的执行。<font face="Times New Roman">return</font>的意思是返回，如果在程序中判断出有错误，下面的代码无法继续执行了，我们调用<font face="Times New Roman">return()</font>函数让他退出<font face="Times New Roman">start()</font>函数的执行。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if(<font color="#000000">TakeProfit&lt;10<font color="#000000">)</font></font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">{ <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>Print<font color="#000000">("</font>TakeProfit less than 10<font color="#000000">");</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>return<font color="#000000">(0); <wbr></wbr><wbr></wbr>// check TakeProfit</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">}</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">上面的代码意思是如果参数里的<font face="Times New Roman">TakeProfit</font>变量小于<font face="Times New Roman">10</font>也提示一条信息并结束执行，<font face="Times New Roman">TakeProfit</font>从字面的意思中我们可以知道是止盈的意思，有些平台会限制下单时的止盈点数不得小于某个点，如果小于某值会在下单时报错，为了避免这种错误我们会限制参数中止盈的设定。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">其实这里可以调用<font face="Times New Roman">MarketInfo()</font>函数得到我们当前平台中允许的止盈止损最小值从而根据平台的不同自动计算出最小的止盈点数，详细情况请参阅文档<font face="Times New Roman">MarketInfo()</font>函数的描述。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">MacdCurrent=</font>iMACD<font color="#000000">(NULL,</font>0<font color="#000000">,</font>12<font color="#000000">,</font>26<font color="#000000">,</font>9<font color="#000000">,PRICE_CLOSE,MODE_MAIN,</font>0<font color="#000000">);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">MacdPrevious=</font>iMACD<font color="#000000">(NULL,</font>0<font color="#000000">,</font>12<font color="#000000">,</font>26<font color="#000000">,</font>9<font color="#000000">,PRICE_CLOSE,MODE_MAIN,</font>1<font color="#000000">);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">SignalCurrent=</font>iMACD<font color="#000000">(NULL,</font>0<font color="#000000">,</font>12<font color="#000000">,</font>26<font color="#000000">,</font>9<font color="#000000">,PRICE_CLOSE,MODE_SIGNAL,</font>0<font color="#000000">);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">SignalPrevious=</font>iMACD<font color="#000000">(NULL,</font>0<font color="#000000">,</font>12<font color="#000000">,</font>26<font color="#000000">,</font>9<font color="#000000">,PRICE_CLOSE,MODE_SIGNAL,</font>1<font color="#000000">)</font>;</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">MaCurrent=</font>iMA<font color="#000000">(NULL,</font>0<font color="#000000">,MATrendPeriod,</font>0<font color="#000000">,MODE_EMA,PRICE_CLOSE,</font>0<font color="#000000">);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">MaPrevious=</font>iMA<font color="#000000">(NULL,</font>0<font color="#000000">,MATrendPeriod,</font>0<font color="#000000">,MODE_EMA,PRICE_CLOSE,</font>1<font color="#000000">);</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">以上语句是调用了<font face="Times New Roman">MQL</font>的一些内置指标函数，在<font face="Times New Roman">MQL</font>语言中，对于常用的指标如均线，<font face="Times New Roman">MACD</font>，<font face="Times New Roman">KD</font>等<font face="Times New Roman">MQL</font>已经提供给我们现成的函数，我们只要调用他即可得到指标的值<font face="Times New Roman">(</font>相见文档技术指标部分：<a href="http://www.forexea.cn/plugin.php?id=laoyang_wailianx&amp;url=http://docs.mql4.com/cn/indicators" target="_blank" rel="noopener noreferrer"><font face="Times New Roman">http://docs.mql4.com/cn/indicators</font></a><font face="Times New Roman">)</font>。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">就上面的代码，<font face="Times New Roman">MacdCurrent</font>的值是参数为<font face="Times New Roman">12</font>，<font face="Times New Roman">26</font>，<font face="Times New Roman">9</font>的<font face="Times New Roman">MACD</font>主线当前<font face="Times New Roman">K</font>线的值，<font face="Times New Roman">MacdPrevious</font>则是<font face="Times New Roman">MacdCurrent</font>前一根<font face="Times New Roman">K</font>线的值，<font face="Times New Roman">SignalCurrent</font>和<font face="Times New Roman">SignalPrevious</font>则是相同参数信号线的当前值和前一根值。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">后两个是调用均线指标函数，这里的均线周期参数则是使用了<font face="Times New Roman">EA</font>的参数变量<font face="Times New Roman">MATrendPeriod</font>，这样写是个好习惯，把调用指标的参数放到<font face="Times New Roman">EA</font>参数里，这样可以随时在运行中调整这些参数方便我们改变策略。<font face="Times New Roman">MaCurrent</font>和<font face="Times New Roman">MaPrevious</font>是得到<font face="Times New Roman">26</font>均线的当前<font face="Times New Roman">K</font>线值和前一根的值。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">total=</font>OrdersTotal<font color="#000000">();</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if<font color="#000000">(total&lt;&lt;/font&gt;1<font color="#000000">)</font></font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">上面的代码就是判断我们当前是否有单子在做，他调用了<font face="Times New Roman">OrdersTotal()</font>函数，它可以计算当前账户中一共还没有平仓的单子和挂单的个数，如果它小于<font face="Times New Roman">1</font>说明当前没有任何单子，这种判断方法只是一种简单的判断法，如果这个<font face="Times New Roman">EA</font>在运行过程中人为也去下单则<font face="Times New Roman">EA</font>永远不会下单了，如果要更加精确的计算这个<font face="Times New Roman">EA</font>所下的单子数量还需要利用其他方法，这些技巧我们会在以后的文章中介绍。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if<font color="#000000">(</font>AccountFreeMargin<font color="#000000">()&lt;(</font>1000<font color="#000000">*Lots))</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>Print<font color="#000000">(</font>"We have no money. Free Margin = "<font color="#000000">,</font> AccountFreeMargin<font color="#000000">());</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>return<font color="#000000">(0); <wbr></wbr><wbr></wbr></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">} <wbr></wbr><wbr></wbr></font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">上面的代码是计算当前的剩余保证金是否小于<font face="Times New Roman">1000</font>，如果太少钱会不够用，所以会输出下当前的保证金还剩多少并退出。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if<font color="#000000">(MacdCurrent&lt;0</font> &amp;&amp; <font color="#000000">MacdCurrent&gt;SignalCurrent</font> &amp;&amp; <font color="#000000">MacdPrevious</font>&amp;&amp; MathAbs<font color="#000000">(MacdCurrent)&gt;(MACDOpenLevel*</font>Point<font color="#000000">)</font> &amp;&amp; <font color="#000000">MaCurrent&gt;MaPrevious)</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>ticket=</font>OrderSend<font color="#000000">(</font>Symbol<font color="#000000">(),OP_BUY,Lots,</font>Ask<font color="#000000">,</font>3<font color="#000000">,</font>0<font color="#000000">,</font>Ask<font color="#000000">+TakeProfit*</font>Point<font color="#000000">,</font>"macd sample",16384<font color="#000000">,</font>0<font color="#000000">,Green);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>if<font color="#000000">(ticket&gt;</font>0<font color="#000000">)</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>if<font color="#000000">(</font>OrderSelect<font color="#000000">(ticket,SELECT_BY_TICKET,MODE_TRADES))</font> Print<font color="#000000">(</font>"BUY order opened : <font color="#000000">",</font>OrderOpenPrice<font color="#000000">());</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>}</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>else Print<font color="#000000">(</font>"Error opening BUY order : "<font color="#000000">,</font>GetLastError<font color="#000000">());</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>return<font color="#000000">(0);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">}</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">上面这段就是多单开仓部分了，条件是这样：如果当前<font face="Times New Roman">MACD</font>主线在<font face="Times New Roman">0</font>轴以下，<font face="Times New Roman">MACD“</font>金叉<font face="Times New Roman">”</font>，<font face="Times New Roman">MACD</font>的主线不在<font face="Times New Roman">0</font>轴附近<font face="Times New Roman">(</font>这块是<font face="Times New Roman">EA</font>的参数来指定<font face="Times New Roman">0</font>轴附近多少点<font face="Times New Roman">)</font>并且还要当前的均线是上升的。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">这里最精彩的部分在于如何判断<font face="Times New Roman">MACD“</font>金叉<font face="Times New Roman">”</font>，如何判断<font face="Times New Roman">MACD</font>值不在<font face="Times New Roman">0</font>轴附近和均线目前是上升的还是下降的。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">“</font>金叉<font face="Times New Roman">”</font>的判断是<font face="Times New Roman">EA</font>里用的比较多的，这里我们用了判断大小的方法就能很容易的计算它，首先得到<font face="Times New Roman">MACD</font>两根线当前的值和上一根<font face="Times New Roman">K</font>线的<font face="Times New Roman">MACD</font>值，如果上一根<font face="Times New Roman">K</font>线的<font face="Times New Roman">MACD</font>主线大于信号线并且当前的<font face="Times New Roman">MACD</font>主线小于信号线那么就相当于这两根线做了一个<font face="Times New Roman">“</font>交叉<font face="Times New Roman">”</font>，因此我们可以认为<font face="Times New Roman">MACD“</font>金叉<font face="Times New Roman">”</font>了。从这里我们也能看出来用计算机的方法来解决我们人类所认知的问题靠的都是这种具体数值的计算，所以计算机还是比较<font face="Times New Roman">“</font>死板<font face="Times New Roman">”</font>的，如果两根线<font face="Times New Roman">“</font>扭<font face="Times New Roman">”</font>在了一起那么用计算机程序很难判断出来，这些就是目前计算机程序的缺点。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">0</font>轴附近这种判断方法这里利用了一点数学方面的知识，不过不用担心都是很简单的算法。把<font face="Times New Roman">MACD</font>值做绝对值运算然后判断是否大于指定的值，因为<font face="Times New Roman">MACD</font>会是负值做绝对值运算后直接判断是否大于设定的值就行了，这块相当于是简化了判断语句的条件。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">均线的上升和下降判断和<font face="Times New Roman">“</font>金叉<font face="Times New Roman">”</font>的算法差不多，得到当前均线值和前一根线的均线值，如果前一根均线值小于当前值那么就说明均线是上升的。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if<font color="#000000">(MacdCurrent&gt;0&amp;&amp;MacdCurrentSignalPreviou<wbr></wbr><wbr></wbr>s&amp;&amp; MacdCurrent&gt;(MACDOpenLevel*Point) &amp;&amp; MaCurrent</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>ticket=</font>OrderSend<font color="#000000">(</font>Symbol<font color="#000000">(),OP_SELL,Lots,Bid,3,0,Bid-TakeProfit*Point,"macd sample",16384,0,Red);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>if<font color="#000000">(ticket&gt;0)</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>if<font color="#000000">(</font>OrderSelect<font color="#000000">(ticket,SELECT_BY_TICKET,MODE_TRADES))</font> Print<font color="#000000">(</font>"SELL order opened <font color="#000000">: ",</font>OrderOpenPrice<font color="#000000">());</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>}</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>else</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>Print<font color="#000000">(</font>"Error opening SELL order : "<font color="#000000">,</font>GetLastError<font color="#000000">());</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>return<font color="#000000">(0);</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">这段代码就是空单的进场条件，和上面的正相反。值得说明是这两个下单代码中会遇到下单失败的情况，因为当用<font face="Times New Roman">OrderSend()</font>函数下单后会返回一个大于<font face="Times New Roman">0</font>的整数订单号数值，利用这一点就可以很容易的知道下单是否成功了。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">下面的代码是平仓和移动止损部分，这段代码比较难懂，但是却是非常重要的部分，因为在编写<font face="Times New Roman">EA</font>中这些操作会经常遇到，让我们来一点一点的拆解开来理解下它们的含义。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">for<font color="#000000">(cnt=0; cnt</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">当前存在的订单中我们要判断是否到达平仓的条件，所以第一步我们首先要对所有在下的单子进行一次遍历，一个一个的去判断它们是否达到平仓条件。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">此代码中利用了一个循环语句从第一单开始一单一单的循环，这里值得注意的是所有单子都是按照下单的先后顺序存放的，第一张单子的编号是<font face="Times New Roman">0</font>而不是<font face="Times New Roman">1</font>，这是编程语言中一般都采取的方法，我们在编写程序的时候一定要注意它的值要从<font face="Times New Roman">0</font>开始。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">OrderSelect<font color="#000000">(cnt, SELECT_BY_POS, MODE_TRADES);</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">上面是选择订单操作，当循环一次订单后，必须调用<font face="Times New Roman">OrderSelect()</font>函数来锁定这一订单，这样下面的操作才可以正常运行。这里最容易出错的地方是函数的第二个参数如果查一下文档我们会发现它有两个选项：<font face="Times New Roman">SELECT_BY_POS</font>和<font face="Times New Roman">SELECT_BY_TICKET</font>。第一种方式是根据订单的位置进行选定操作，这个例子中就是使用了这种方式，第二种方式是根据订单号来进行选定操作，因为我们并不知道所有单子的订单号是多少所以我们只能使用第一种方式来选择订单，刚才说过订单是按照下单的先后顺序来存放的，因此如果是第一个单子那么就是<font face="Times New Roman">0</font>，如果是第二个单子就是<font face="Times New Roman">1</font>，最后一个单子是总单子数减一。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if<font color="#000000">(</font>OrderType<font color="#000000">()&lt;=OP_SELL &amp;&amp; <wbr></wbr><wbr></wbr>// check for opened position</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>OrderSymbol<font color="#000000">()==</font>Symbol<font color="#000000">()) <wbr></wbr><wbr></wbr>// check for symbol</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">上面的代码段又运用了一个小技巧，它首先调用了<font face="Times New Roman">OrderType()</font>函数来得到所选定的订单是多单还是空单，但是我们查下这个函数的定义<font face="Times New Roman">(</font><a href="http://www.forexea.cn/plugin.php?id=laoyang_wailianx&amp;url=http://docs.mql4.com/cn/constants/trading" target="_blank" rel="noopener noreferrer"><font face="Times New Roman">http://docs.mql4.com/cn/constants/trading</font></a><font face="Times New Roman">)</font>发现多单的值是<font face="Times New Roman">0</font>，空单的值是<font face="Times New Roman">1</font>，那么如果<font face="Times New Roman">OrderType()</font>函数小于等于空单的值那么相当于在判断当前订单是否是非挂单。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">第二个条件是判断当前单子的货币对是否和当前图表相同，这个判断是为了防止我们处理订单过程中误操作了其他不是<font face="Times New Roman">EA</font>所下的单子。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if<font color="#000000">(</font>OrderType<font color="#000000">()==OP_BUY) <wbr></wbr><wbr></wbr>// long position is opened</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>// should it be closed?</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>if<font color="#000000">(MacdCurrent&gt;0 &amp;&amp; MacdCurrentSignalPreviou<wbr></wbr><wbr></wbr>s &amp;&amp; MacdCurrent&gt;(MACDCloseLevel*</font>Point<font color="#000000">))</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>OrderClose<font color="#000000">(</font>OrderTicket<font color="#000000">(),</font>OrderLots<font color="#000000">(),</font>Bid<font color="#000000">,3,Violet); // close position</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>return<font color="#000000">(0); // exit</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>}</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">多单的平仓部分代码，这里其实就是去掉均线条件的空单下单信号，平仓操作中一定要注意在平仓完成后必须终止这个遍历订单的循环，因为平仓后会打乱所有单子的顺序，造成误操作其他订单。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">我们在这里举个例子就能明白为什么要这么做：比如当前有三个单子没有平仓，按照顺序排列序号是<font face="Times New Roman">0</font>、<font face="Times New Roman">1</font>、<font face="Times New Roman">2</font>，如果第二个单子平仓后第三个单子序号就会提前，这样当下一轮循环执行到<font face="Times New Roman">OrderSelect()</font>函数后会因为没有这个编号而出现错误。</font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman">if<font color="#000000">(TrailingStop&gt;0) <wbr></wbr><wbr></wbr></font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman">{ <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>if<font color="#000000">(</font>Bid<font color="#000000">-</font>OrderOpenPrice<font color="#000000">()&gt;</font>Point<font color="#000000">*TrailingStop)</font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>if<font color="#000000">(</font>OrderStopLoss<font color="#000000">()&lt;&lt;/font&gt;Bid<font color="#000000">-</font>Point<font color="#000000">*TrailingStop)</font></font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><font face="Times New Roman"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>{<!-- --></font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>OrderModify(</font>OrderTicket<font color="#000000">(),</font>OrderOpenPrice<font color="#000000">(),</font>Bid<font color="#000000">-</font>Point<font color="#000000">*TrailingStop,</font>OrderTakeProfit<font color="#000000">(),0,Green);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font>return<font color="#000000">(0);</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>}</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000"><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>}</font></font> 
   </div> 
   <div align="left"> 
    <font face="Times New Roman"><font color="#000000">} <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">这段代码就是多单的移动止损部分<font face="Times New Roman">,</font>当参数<font face="Times New Roman">TrailingStop</font>大于<font face="Times New Roman">0</font>的时候<font face="Times New Roman">EA</font>就开启了移动止损功能<font face="Times New Roman">(</font>默认设定是<font face="Times New Roman">30</font>，也就是说默认情况下是开启移动止损的<font face="Times New Roman">)</font>，我们就用我们这个例子<font face="Times New Roman">EA</font>的默认参数<font face="Times New Roman">30</font>点来说明，当单子的盈利大于<font face="Times New Roman">30</font>点并且单子的止损点和当前价位相差<font face="Times New Roman">30</font>点以上时，修改订单的止损到当前价格以下<font face="Times New Roman">30</font>点位置。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">我们在上面的程序里屡次发现作者使用<font face="Times New Roman">Point</font>变量来计算点位，这个变量是<font face="Times New Roman">MT4</font>运行环境中自动设定的值，它在<font face="Times New Roman">MQL</font>语言中叫做预定义变量<font face="Times New Roman">(</font>关于预定义变量可以参考这里：<a href="http://www.forexea.cn/plugin.php?id=laoyang_wailianx&amp;url=http://docs.mql4.com/cn/predefined/variables" target="_blank" rel="noopener noreferrer"><font face="Times New Roman">http://docs.mql4.com/cn/predefined/variables</font></a><font face="Times New Roman">)</font>，<font face="Times New Roman">Point</font>告诉我们当前货币对的价格最小点值是多少，举个例子：欧元对美元的价格总是<font face="Times New Roman">X.XXXX</font>这种形式，它的<font face="Times New Roman">Point</font>值就是<font face="Times New Roman">0.0001</font>，当我们想设定当价格大于<font face="Times New Roman">30</font>点这种情况时，我们只要用<font face="Times New Roman">30</font>乘以<font face="Times New Roman">Point</font>就可以计算这个货币对的实际<font face="Times New Roman">30</font>点值。不过<font face="Times New Roman">Point</font>常量在很多平台中不能正确的来实现它本身的功能了，原因是很多平台已经改为小数点后<font face="Times New Roman">5</font>位，这样<font face="Times New Roman">Point</font>值变成了<font face="Times New Roman">0.00001</font>，我们直接用他来乘以点位得到是却是实际点位的十分之一，这样会在<font face="Times New Roman">EA</font>的运行中出现致命的逻辑错误。因此如果是<font face="Times New Roman">5</font>位的平台，需要在那些点位的值上乘以<font face="Times New Roman">10</font>来修正这个问题。关于<font face="Times New Roman">Point</font>的完美解决方法我们将在后续的文章中继续讨论。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">以上就是<font face="Times New Roman">MT4</font>例子<font face="Times New Roman">EA</font>的解读，这个程序虽然比较复杂但是它却是一个很好的例子，里面涉及到了我们在写<font face="Times New Roman">EA</font>程序过程中常用到的一些功能，对于初学<font face="Times New Roman">EA</font>程序的人来说帮助很大，我们也可以修改这个程序的开仓、平仓部分直接变成我们自己的逻辑。</font> 
   </div> 
   <div align="left"></div> 
   <div align="left"> 
    <font color="#000000">好指标如何应用到EA上</font> 
   </div> 
   <div align="left"></div> 
   <div align="left"> 
    <font color="#000000">第一部分：<strong><u>指标</u></strong><strong><u>风险</u></strong><strong><u>投资</u></strong>家寻找<strong><u>金融</u></strong>市场每一个获利的<strong><u>机会</u></strong></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">为了能<a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>赚钱</strong></a>而不是<a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>亏损</strong></a>，无论是<a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>专业</strong></a>的<strong><u>交易</u></strong>商还是个体，都在<a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>研究</strong></a>各和总结各种种的规律，并做成指标，我们经常会发现一些指标图线看起来很完美，于是都会想到要根据指标的变化进行交易。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">但这样做会赚钱吗？</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">能否赚钱，我们就要看这些指标有没有作弊。即确定指标是否有未来函数的计算，也就是说指标会不会根据现在的<a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>K</strong><strong>线</strong></a>，计算后将指标在历史K线上标示做更改。比如原来是卖的<strong><u>提示</u></strong>，改为买。（恐怖吧）。（当然还有一些EA特有的环节也会影响盈利问题，在这里不讲）</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">确定是否有未来函数的方法有两种：</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">1.白盒校验（即查看源码）</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">直接看源码中的循环部分，如果有修改<a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>历史</strong></a>曲线数组的行为，则可以立刻断定有未来函数。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">2.黑盒观察</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">当没有源码的时候，可以将指标加载到1分钟的图线上，连续不断观察其标示的变化，尤其注意与当前K线状态最接近的历史K线标示的变化。如果随着当前K线的变化出现过历史变化更改，则也可以确定有未来函数</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">指标EA化之前必须要确认的事情：</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">如果一个指标含有未来函数，那么这个指标是没有多大意义的。也就是说，我们要将指标改为EA前，必须确认这个指标是不含未来函数的，这样指标EA化才有意义。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">第二部分 指标EA化</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">接下来将指标EA化大致的做法是：</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">在EA中通过函数iCustom读取这个指标的当前K线输出值，得出当前的状态，来决定是否入场或者平仓并反向入场。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">iCustom的具体用法：</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">指标一般都是曲线或者箭头两种。在这里我们要把曲线和箭头都看成是数组就容易理解了。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">对于指标来说每一条曲线或者箭头都是写在与每个K线对应的数组中的，也就是说一条曲线对应一个数组，一个方向的箭头也是对应一个数组（有箭头的数组值是当时的<a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>价格</strong></a>，没箭头地方的数组值是“空”）</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">iCustom MT4的帮助里说的是：“计算指定的客户指标并且退回它的值”，即这个函数可以让你获取指定指标的第几个数组对应第几根K线上的计算数值。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">具体如下：</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">double iCustom(string symbol, int timeframe, string name, ..., int mode, int shift)</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">计算指定的客户指标并且退回它的值。必须在terminal_directoryexpertsindicato<wbr></wbr>rs目录内编写客户指标(*.EX4文件)。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">参量:</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">symbol <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>- <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>计算指标数据上的货币对名称. NULL表示当前货币对.</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">timeframe <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>- <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr></font> 
    <a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>时间</strong></a> 
    <font color="#000000">周期。可以时间周期列举任意值. 0表示当前图表的时间周期.</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">name <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>- <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>客户指标完整的程序名称</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">.... <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>- <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>参量设置(如果需要)。通过的参量和他们的顺序必须与desclaration命令和客户指标的外部可变物的种类对应。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">mode <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>- <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>索引行。从0到7并且必须对应以其中一个使用的索引的 SetIndexBuffer 函数.</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">shift <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>- <wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr><wbr></wbr>从显示缓冲采取的值的索引(转移相对当前柱特定相当数量期间前).</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">示例:</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">double val=iCustom(NULL, 0, "示例Ind",13,1,0);</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">double va2=iCustom(NULL, 0, "示例Ind",13,0,1);</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">例如：一个指标，画了两条曲线，则可以用iCustom取得这个指标在第4根K线上对应的第一条曲线的数值。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">我们现在已经可以根据自己的想法去获得一个指定指标的任何K线上的状态数值了。那麽下一步我们就要开始EA的概念。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">因为EA只针对当前价格状态下的动作进行控制。所以一般而言我们就取指定指标在当前K线下的计算数值用于EA的条件<a href="http://www.forexea.cn/javascript.:;" target="_blank" rel="noopener noreferrer"><strong>判断</strong></a>。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">如果你认为当前K线没有<strong><u>结束</u></strong>，其数值始终在变化，有可能一会有讯号一会没讯号，那麽你可以采用取前一K线的指标数值的方式作为基础。（如果用当前K线指标数值作为条件会有不确定的结果，但如果用前一K线数值做条件则有“错过最佳入场点”的问题。这是需要程序设计者权衡的问题。）</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">另外的一个问题，就是怎末去判断指标输出的数值与我们肉眼看到的讯号一致起来的问题。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">如果参考的指标是一种变色线，则一定是一种颜色一个数组的方式叠加起来显示的。我们在取其数值的时候只需要看看不同颜色的数组的数值比较一下就知道其结果是哪种颜色，并作为ＥＡ的条件进行动作就行了。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">如果是箭头的方式，则一样是去取其数值，无箭头的Ｋ线上指标对应的数值是“空”，有箭头的地方数组对应的数值肯定不是空。用这个来判断是否发生了讯号就行了。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">比如双色线，就一定是两个数组分别显示不同颜色，当指标认为应该显示其中一种颜色的时候就将这个颜色对应的数组在当前Ｋ线中的数值设成当前价。反之则设为“空”。这样循环一遍后　你肉眼看到的就是变色线了</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">现在我们可以轻松获得指标的当前讯号状态了！</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">下一步就是结合进ＥＡ中，就是把指标中的数组值拿过来</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">第三部分 EA 编程逻辑</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">ＥＡ就是一个循环往复的过程。每来一个价格就运行一次。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">EA是电脑，并不知道你现在的仓位情况也不知道指标的情况，除了计算什么都不知道，一切都是编程者赋予的。因此，编程者脑子里一定要建立一种综合状态的概念。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">EA的一开始一定要先进行仓位的情况检查。大致的逻辑如下：</font> 
   </div> 
   <div align="left"> 
    <font color="#000000"><wbr></wbr><wbr></wbr></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">1 <wbr></wbr><wbr></wbr>先查出持仓情况和持仓单的方向。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">2. <wbr></wbr><wbr></wbr>然后获得指标的数值。 <wbr></wbr><wbr></wbr></font> 
   </div> 
   <div align="left"> 
    <font color="#000000">3 <wbr></wbr><wbr></wbr>判断并操作</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">持仓状态下：根据持仓单的方向进行对应来判断反向讯号是否发生。如果发生则平仓并反向入场。如果没发生则直接返回，等待下一次价格的而到来。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">空仓状态下：则两个方向的讯号都做判断，哪边发生了就按那边的方向入场。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">4. <wbr></wbr><wbr></wbr>其他的的细节</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">不论入场还是出场都要在发出动作后马上判断是否正确执行的判断。如果没有执行成功则一定要立刻放弃后面的操作直接返回。等待下一个价格来的时候在此发出同样的动作。</font> 
   </div> 
   <div align="left"> 
    <font color="#000000">另外说明的是数据是自动更新的。</font> 
   </div> 
   <p><strong><font size="5">淘宝店</font><font style="FonT-siZe: 20px"><font size="5">：</font><font style="FonT-siZe: 20px"><a href="http://fuzhuang18.taobao.com/">http://fuzhuang18.taobao.</a><a href="http://fuzhuang18.taobao.com/">com</a></font></font></strong></p> 
   <p><a href="http://fuzhuang18.taobao.com/" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_84691398812464479" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/cd/8b/TISQXwNF_o.gif"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv9cZCiC92" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_3001398812314510" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/8d/b0/u7Z3UfQv_o.gif"></strong></a><br> <br> <a href="http://fuzhuang18.taobao.com/" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_29631398812319379" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/a7/48/9uJiGmSK_o.gif"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv9fVrAgfc" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_43091398812348582" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/1c/9b/sllWS58j_o.gif"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv9gg3oe0a" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_43021398812366280" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/a7/b0/Jjk1NIMq_o.gif"></strong></a><br> <br></p> 
   <p><a href="http://fuzhuang18.taobao.com/search.htm?spm=a1z10.1.w4010-6754710806.4.q7JYY6&amp;search=y&amp;orderType=newOn_desc" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_26481398811415578" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/b3/3e/InRm1Nvm_o.gif" width="690" height="306"></strong></a><br> <br> <a href="http://fuzhuang18.taobao.com/search.htm?spm=a1z10.3.w4002-4152392543.27.TQseqg&amp;mid=w-4152392543-0&amp;search=y&amp;orderType=newOn_desc&amp;pageNo=2" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_76131398811415658" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/5d/40/zldmbvpg_o.gif" width="690" height="289"></strong></a><br> <br> <a href="http://fuzhuang18.taobao.com/search.htm?spm=a1z10.3.w4002-4152392543.27.TQseqg&amp;mid=w-4152392543-0&amp;search=y&amp;orderType=newOn_desc&amp;pageNo=2" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_67081398811446854" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/9b/fc/RsAtdwrq_o.gif" width="690" height="295"></strong></a><br> <br> <a href="http://fuzhuang18.taobao.com/search.htm?spm=a1z10.3.w4002-4152392543.28.jyFZ79&amp;mid=w-4152392543-0&amp;search=y&amp;orderType=newOn_desc&amp;pageNo=3" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_39391398811454898" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/3f/72/wpQKPiKs_o.gif" width="690" height="298"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv8aDwo37b" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/f6/34/lt1pupEl_o.gif" width="690" height="297"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv8aPNLR23" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/5a/32/gA4KzpsE_o.gif" width="690" height="289"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv8aYWp77d" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/6a/15/002agFpm_o.gif" width="690" height="288"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv8b9ptHbd" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/8a/4e/QZeMwFqx_o.gif" width="690" height="289"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv8bjUjA76" target="_blank" rel="noopener noreferrer"><strong><img title="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" name="image_operate_31611398811497535" alt="华为平板电脑 &lt;wbr&gt;S7 &lt;wbr&gt;slim刷机及软件使用方法" src="https://images2.imgbox.com/9c/7d/hxaiXZDW_o.gif" width="690" height="290"></strong></a><br> <br> <a href="http://photo.blog.sina.com.cn/showpic.html#blogid=76df29e701012q7a&amp;url=http://album.sina.com.cn/pic/002aY25Fzy6Iv8btlWx09" target="_blank" rel="noopener noreferrer"></a></p> 
  </div> 
 </div> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2f14690b0ccfc47023276239973af155/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">js  ajax 数组类型参数传递</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1f0a7f404cfa69f6b6f2ac414d683f93/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">VMware Workstation Pro 12.官方下载地址（已经更新到12.5.5）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>