<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>进阶的爬虫系列 ——不得不说的贴吧爬取术 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="进阶的爬虫系列 ——不得不说的贴吧爬取术" />
<meta property="og:description" content="进阶的爬虫系列 ——不得不说的贴吧爬取术 感谢各位能点开我的这篇博文，才开始写，这个算是很简单的爬虫，文中如有错误和不足欢迎各位大神多多包涵指正，大家的建议是我不断前行的动力，废话不多说我们直接进入主题。
目标：爬取贴吧数据 步骤： 首先我们进入百度贴吧的页面，通过进入不同的贴吧以及翻页解析其url的变化规律 通过观察我们可以看出 “kw=”的后面是接的贴吧的名字，而“pn=”的后面是接的页数，从0开始，每翻一页pn对应的数值会加50。发现规律以后我们就可以通过url中贴吧名字及页数这两个点用循环遍历爬取页面数据。
然后我们明确业务逻辑: 定义一个类——&gt;初始化——&gt;构造url列表——&gt;遍历，发送请求，获取响应——&gt;保存 根据业务逻辑构建初始代码如下：
# coding=utf-8 class Tieba: def __init__(self,tieba_name): self.url_temp =&#34;https://tieba.baidu.com/f?kw=&#34; &#43; tieba_name &#43; &#34;&amp;ie=utf-8&amp;pn={}&#34; self.headers = { &#34;User-Agent&#34;:&#34;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36&#34; } def get_url_list(self): # 构造url列表 pass def parse_url(self,url): # 发送请求，获取响应 pass def save_html(self,html_str,page_num): # 保存html字符串 pass def run(self):#实现主要逻辑 #1.构造url列表 #2.遍历，发送请求，获取响应 #3.保存 pass if __name__ == &#39;__main__&#39;: tieba = Tieba(&#39;李毅&#39;) tieba.run() 1.初始化url路径，和请求头" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/544ab6617fd5758837f933e16b8c25bc/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-05-23T23:13:43+08:00" />
<meta property="article:modified_time" content="2018-05-23T23:13:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">进阶的爬虫系列 ——不得不说的贴吧爬取术</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="进阶的爬虫系列">进阶的爬虫系列</h2> 
<h3 id="不得不说的贴吧爬取术">——不得不说的贴吧爬取术</h3> 
<p>感谢各位能点开我的这篇博文，才开始写，这个算是很简单的爬虫，文中如有错误和不足欢迎各位大神多多包涵指正，大家的建议是我不断前行的动力，废话不多说我们直接进入主题。</p> 
<p><strong>目标：</strong>爬取贴吧数据 <br> <strong>步骤：</strong> <br> 首先我们进入百度贴吧的页面，通过进入不同的贴吧以及翻页解析其url的变化规律 <br> <img src="https://images2.imgbox.com/6b/9b/D7UxKTde_o.png" alt="这里写图片描述" title=""> <br> <img src="https://images2.imgbox.com/2e/54/x8fAVh6Z_o.png" alt="这里写图片描述" title=""></p> 
<p><img src="https://images2.imgbox.com/33/fd/LRMcccVI_o.png" alt="这里写图片描述" title=""> <br> <img src="https://images2.imgbox.com/df/c1/0DiZSx4X_o.png" alt="这里写图片描述" title=""> <br> <img src="https://images2.imgbox.com/e1/6d/UGU4XHGG_o.png" alt="这里写图片描述" title=""></p> 
<p>通过观察我们可以看出 “kw=”的后面是接的贴吧的名字，而“pn=”的后面是接的页数，从0开始，每翻一页pn对应的数值会加50。发现规律以后我们就可以通过url中贴吧名字及页数这两个点用循环遍历爬取页面数据。</p> 
<p><strong>然后我们明确业务逻辑:</strong> <br> 定义一个类——&gt;初始化——&gt;构造url列表——&gt;遍历，发送请求，获取响应——&gt;保存 <br> 根据业务逻辑构建初始代码如下：</p> 
<pre class="prettyprint"><code class=" hljs python"><span class="hljs-comment"># coding=utf-8</span>

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Tieba</span>:</span>
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self,tieba_name)</span>:</span>

        self.url_temp =<span class="hljs-string">"https://tieba.baidu.com/f?kw="</span> + tieba_name + <span class="hljs-string">"&amp;ie=utf-8&amp;pn={}"</span>
        self.headers = {
            <span class="hljs-string">"User-Agent"</span>:<span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36"</span>
        }
    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_url_list</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># 构造url列表</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_url</span><span class="hljs-params">(self,url)</span>:</span>
        <span class="hljs-comment"># 发送请求，获取响应</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_html</span><span class="hljs-params">(self,html_str,page_num)</span>:</span>
        <span class="hljs-comment"># 保存html字符串</span>
        <span class="hljs-keyword">pass</span>

    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><span class="hljs-comment">#实现主要逻辑</span>
        <span class="hljs-comment">#1.构造url列表</span>
        <span class="hljs-comment">#2.遍历，发送请求，获取响应</span>
        <span class="hljs-comment">#3.保存</span>
        <span class="hljs-keyword">pass</span>

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:

    tieba = Tieba(<span class="hljs-string">'李毅'</span>)
    tieba.run()</code></pre> 
<p><strong>1.初始化url路径，和请求头</strong></p> 
<pre class="prettyprint"><code class=" hljs python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span><span class="hljs-params">(self,tieba_name)</span>:</span>
        self.tieba_name = tieba_name
        self.url_temp =<span class="hljs-string">"https://tieba.baidu.com/f?kw="</span> + tieba_name + <span class="hljs-string">"&amp;ie=utf-8&amp;pn={}"</span>
        self.headers = {
            <span class="hljs-string">"User-Agent"</span>:<span class="hljs-string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36"</span>
        }</code></pre> 
<p><strong>2.构造url列表</strong></p> 
<pre class="prettyprint"><code class=" hljs python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_url_list</span><span class="hljs-params">(self)</span>:</span>
        <span class="hljs-comment"># 构造url列表</span>
        <span class="hljs-keyword">return</span> [self.url_temp.format(i*<span class="hljs-number">50</span>)<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(<span class="hljs-number">100</span>)]</code></pre> 
<p>这边是以列表的方式将遍历出来的100页的url的路径保存，通过调用get_url_list这个方法使用</p> 
<p><strong>3.发送请求，获取响应</strong></p> 
<pre class="prettyprint"><code class=" hljs python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">parse_url</span><span class="hljs-params">(self,url)</span>:</span>
        <span class="hljs-comment"># 发送请求，获取响应</span>
        print(url)
        response = requests.get(url,headers = self.headers)
        <span class="hljs-keyword">return</span> response.content.decode()</code></pre> 
<p><strong>4.将爬取的页面以吧名+第几页命名，并保存，保存的时候一定要加encoding=’utf-8’，不然会因为编码问题报错</strong></p> 
<pre class="prettyprint"><code class=" hljs python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">save_html</span><span class="hljs-params">(self,html_str,page_num)</span>:</span>
        file_path = <span class="hljs-string">"{}-第{}页.html"</span>.format(self.tieba_name,page_num)
        <span class="hljs-keyword">with</span> open(file_path,<span class="hljs-string">"w"</span>,encoding=<span class="hljs-string">'utf-8'</span>) <span class="hljs-keyword">as</span> f:
            f.write(html_str)</code></pre> 
<p><strong>5 将定义的方法根据业务逻辑，开始调用</strong></p> 
<pre class="prettyprint"><code class=" hljs python">    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">run</span><span class="hljs-params">(self)</span>:</span><span class="hljs-comment">#实现主要逻辑</span>
        <span class="hljs-comment">#1.构造url列表</span>
        url_list = self.get_url_list()

        <span class="hljs-comment">#2.遍历，发送请求，获取响应</span>
        <span class="hljs-keyword">for</span> url <span class="hljs-keyword">in</span> url_list:
            html_str = self.parse_url(url)

            <span class="hljs-comment">#3.保存</span>
            page_num = url_list.index(url) + <span class="hljs-number">1</span> <span class="hljs-comment">#页码数</span>
            self.save_html(html_str,page_num)</code></pre> 
<p><strong>6.运行，这里传的是李毅吧，大家也可以传入其他吧名，都可以爬取</strong></p> 
<pre class="prettyprint"><code class=" hljs bash"><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:

    tieba = Tieba(<span class="hljs-string">'李毅'</span>)
    tieba.run()</code></pre> 
<h3 id="最后超级感谢大家的耐心观看"><strong>最后超级感谢大家的耐心观看</strong></h3>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f1e1d30d1353df9749931efaf9940586/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java.lang.ClassNotFoundException: io.netty</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/41fefb91b8e977e0bfa4758b6a543442/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">mysql 8.0.11 用Navicat远程无法连接 解决之道</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>