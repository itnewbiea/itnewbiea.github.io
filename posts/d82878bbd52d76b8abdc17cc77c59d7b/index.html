<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OAuth2相关知识和理解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OAuth2相关知识和理解" />
<meta property="og:description" content="目录
1 什么是OAuth2？
2 OAuth2核心-令牌Token是什么？
3 OAuth2的优势
4 OAuth2的缺点
5 OAuth2的相关术语与其关系
5.1 角色
5.2 其他术语
5.3 交互关系
6 OAuth2的授权方式（Flows）
6.1 授权码模式（Authorization Code）
6.2 简化模式（Implicit）
6.3 密码模式（Resource Owner Credentials）
6.4 客户端模式（Client Credentials）
7 刷新令牌（Refresh Token）
8 授权流程渠道（Channels）
9 客户应用类型
10 令牌类型
11 如何选择授权类型
12 授权服务器的组成
13 对OAuth2的误解
文档链接
1 什么是OAuth2？ 是一个代理授权的框架/协议是基于令牌Token的授权（无需用户密码也能拥有访问权限）认证和授权解耦分离主流的标准安全框架，可以支持多种使用场景 服务器WebApp浏览器单页SPA无线/原生APP服务器对服务器之间 OAuth使用代理协议的方式解决了密码共享反模式问题。
2 OAuth2核心-令牌Token是什么？ 给应用赋予有限的访问权限，让应用有权限去访问用户数据。
举个例子，你把你的保时捷911停到一家酒店，那么你会给酒店服务员保时捷钥匙帮你停车，你给服务员的钥匙，是有限制的，不能行使太远的距离，也不能打开车里的柜子或者是后备箱。
给服务员的钥匙是一个仆从钥匙，相当于令牌Token。
OAuth2的本质就是如何获取token，如何使用token。 3 OAuth2的优势 比OAuth1.0更易于实现和理解，也是主流（OAuth1.0有点复杂，而且跟OAuth2几乎是不相干）更安全，避免暴露了用户密码，服务器端更易集中保护广泛传播并被持续采用，成为主流token有效期较短并且可以自定义封装token资源服务器和授权服务器解耦集中式授权，简化客户端HTTP/JSON友好，易于请求和传递token支持多种架构场景客户可以自定义权限 4 OAuth2的缺点 协议框架过于宽泛，导致兼容性和互操作性较差和OAuth1.0不兼容OAuth2.0不是一个认证协议，是一个授权框架，本身并不能告诉你任何用户信息。 5 OAuth2的相关术语与其关系 5.1 角色 客户应用 - 想要访问用户的受保护资源资源服务器 - 用户的受保护数据保存在此授权服务器 - 在客户应用成功认证并获得授权后，向客户应用颁发访问令牌（Access Token）资源拥有者 - 想要分享某些资源给客户应用 5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d82878bbd52d76b8abdc17cc77c59d7b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-02T10:13:29+08:00" />
<meta property="article:modified_time" content="2022-06-02T10:13:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OAuth2相关知识和理解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="1%20%E4%BB%80%E4%B9%88%E6%98%AFOAuth2%EF%BC%9F-toc" style="margin-left:0px;"><a href="#1%20%E4%BB%80%E4%B9%88%E6%98%AFOAuth2%EF%BC%9F" rel="nofollow">1 什么是OAuth2？</a></p> 
<p id="2%20OAuth2%E6%A0%B8%E5%BF%83-%E4%BB%A4%E7%89%8CToken%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F-toc" style="margin-left:0px;"><a href="#2%20OAuth2%E6%A0%B8%E5%BF%83-%E4%BB%A4%E7%89%8CToken%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F" rel="nofollow">2 OAuth2核心-令牌Token是什么？</a></p> 
<p id="3%20OAuth2%E7%9A%84%E4%BC%98%E5%8A%BF-toc" style="margin-left:0px;"><a href="#3%20OAuth2%E7%9A%84%E4%BC%98%E5%8A%BF" rel="nofollow">3 OAuth2的优势</a></p> 
<p id="4%20OAuth2%E7%9A%84%E7%BC%BA%E7%82%B9-toc" style="margin-left:0px;"><a href="#4%20OAuth2%E7%9A%84%E7%BC%BA%E7%82%B9" rel="nofollow">4 OAuth2的缺点</a></p> 
<p id="5%20OAuth2%E7%9A%84%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD%E4%B8%8E%E5%85%B6%E5%85%B3%E7%B3%BB-toc" style="margin-left:0px;"><a href="#5%20OAuth2%E7%9A%84%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD%E4%B8%8E%E5%85%B6%E5%85%B3%E7%B3%BB" rel="nofollow">5 OAuth2的相关术语与其关系</a></p> 
<p id="5.1%20%E8%A7%92%E8%89%B2-toc" style="margin-left:40px;"><a href="#5.1%20%E8%A7%92%E8%89%B2" rel="nofollow">5.1 角色</a></p> 
<p id="5.2%20%E5%85%B6%E4%BB%96%E6%9C%AF%E8%AF%AD-toc" style="margin-left:40px;"><a href="#5.2%20%E5%85%B6%E4%BB%96%E6%9C%AF%E8%AF%AD" rel="nofollow">5.2 其他术语</a></p> 
<p id="5.3%20%E4%BA%A4%E4%BA%92%E5%85%B3%E7%B3%BB-toc" style="margin-left:40px;"><a href="#5.3%20%E4%BA%A4%E4%BA%92%E5%85%B3%E7%B3%BB" rel="nofollow">5.3 交互关系</a></p> 
<p id="6%C2%A0OAuth2%E7%9A%84%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F%EF%BC%88Flows%EF%BC%89-toc" style="margin-left:0px;"><a href="#6%C2%A0OAuth2%E7%9A%84%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F%EF%BC%88Flows%EF%BC%89" rel="nofollow">6 OAuth2的授权方式（Flows）</a></p> 
<p id="6.1%20%E6%8E%88%E6%9D%83%E7%A0%81%E6%A8%A1%E5%BC%8F%EF%BC%88Authorization%20Code%EF%BC%89-toc" style="margin-left:40px;"><a href="#6.1%20%E6%8E%88%E6%9D%83%E7%A0%81%E6%A8%A1%E5%BC%8F%EF%BC%88Authorization%20Code%EF%BC%89" rel="nofollow">6.1 授权码模式（Authorization Code）</a></p> 
<p id="6.2%20%E7%AE%80%E5%8C%96%E6%A8%A1%E5%BC%8F%EF%BC%88Implicit%EF%BC%89-toc" style="margin-left:40px;"><a href="#6.2%20%E7%AE%80%E5%8C%96%E6%A8%A1%E5%BC%8F%EF%BC%88Implicit%EF%BC%89" rel="nofollow">6.2 简化模式（Implicit）</a></p> 
<p id="6.3%20%E5%AF%86%E7%A0%81%E6%A8%A1%E5%BC%8F%EF%BC%88Resource%20Owner%20Credentials%EF%BC%89-toc" style="margin-left:40px;"><a href="#6.3%20%E5%AF%86%E7%A0%81%E6%A8%A1%E5%BC%8F%EF%BC%88Resource%20Owner%20Credentials%EF%BC%89" rel="nofollow">6.3 密码模式（Resource Owner Credentials）</a></p> 
<p id="6.4%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A8%A1%E5%BC%8F%EF%BC%88Client%20Credentials%EF%BC%89-toc" style="margin-left:40px;"><a href="#6.4%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A8%A1%E5%BC%8F%EF%BC%88Client%20Credentials%EF%BC%89" rel="nofollow">6.4 客户端模式（Client Credentials）</a></p> 
<p id="7%20%E5%88%B7%E6%96%B0%E4%BB%A4%E7%89%8C%EF%BC%88Refresh%20Token%EF%BC%89-toc" style="margin-left:0px;"><a href="#7%20%E5%88%B7%E6%96%B0%E4%BB%A4%E7%89%8C%EF%BC%88Refresh%20Token%EF%BC%89" rel="nofollow">7 刷新令牌（Refresh Token）</a></p> 
<p id="8%20%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B%E6%B8%A0%E9%81%93%EF%BC%88Channels%EF%BC%89-toc" style="margin-left:0px;"><a href="#8%20%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B%E6%B8%A0%E9%81%93%EF%BC%88Channels%EF%BC%89" rel="nofollow">8 授权流程渠道（Channels）</a></p> 
<p id="9%20%E5%AE%A2%E6%88%B7%E5%BA%94%E7%94%A8%E7%B1%BB%E5%9E%8B-toc" style="margin-left:0px;"><a href="#9%20%E5%AE%A2%E6%88%B7%E5%BA%94%E7%94%A8%E7%B1%BB%E5%9E%8B" rel="nofollow">9 客户应用类型</a></p> 
<p id="10%20%E4%BB%A4%E7%89%8C%E7%B1%BB%E5%9E%8B-toc" style="margin-left:0px;"><a href="#10%20%E4%BB%A4%E7%89%8C%E7%B1%BB%E5%9E%8B" rel="nofollow">10 令牌类型</a></p> 
<p id="11%20%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%8E%88%E6%9D%83%E7%B1%BB%E5%9E%8B-toc" style="margin-left:0px;"><a href="#11%20%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%8E%88%E6%9D%83%E7%B1%BB%E5%9E%8B" rel="nofollow">11 如何选择授权类型</a></p> 
<p id="12%20%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BB%84%E6%88%90-toc" style="margin-left:0px;"><a href="#12%20%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BB%84%E6%88%90" rel="nofollow">12 授权服务器的组成</a></p> 
<p id="13%C2%A0%E5%AF%B9OAuth2%E7%9A%84%E8%AF%AF%E8%A7%A3-toc" style="margin-left:0px;"><a href="#13%C2%A0%E5%AF%B9OAuth2%E7%9A%84%E8%AF%AF%E8%A7%A3" rel="nofollow">13 对OAuth2的误解</a></p> 
<p id="%E6%96%87%E6%A1%A3%E9%93%BE%E6%8E%A5-toc" style="margin-left:0px;"><a href="#%E6%96%87%E6%A1%A3%E9%93%BE%E6%8E%A5" rel="nofollow">文档链接</a></p> 
<hr id="hr-toc"> 
<h2>1 什么是OAuth2？</h2> 
<ul><li>是一个<strong>代理授权</strong>的<strong>框架/协议</strong></li><li>是基于<span style="color:#fe2c24;"><strong>令牌Token</strong></span>的授权（无需用户密码也能拥有访问权限）</li><li>认证和授权解耦分离</li><li>主流的标准安全框架，可以支持多种使用场景 
  <ul><li>服务器WebApp</li><li>浏览器单页SPA</li><li>无线/原生APP</li><li>服务器对服务器之间</li></ul></li></ul> 
<blockquote> 
 <p>OAuth使用代理协议的方式解决了密码共享反模式问题。</p> 
</blockquote> 
<h2 id="2%20OAuth2%E6%A0%B8%E5%BF%83-%E4%BB%A4%E7%89%8CToken%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F">2 OAuth2核心-令牌Token是什么？</h2> 
<p>给应用赋予<strong>有限的访问权限</strong>，让应用有权限去访问用户数据。</p> 
<blockquote> 
 <p>举个例子，你把你的保时捷911停到一家酒店，那么你会给酒店服务员保时捷钥匙帮你停车，你给服务员的钥匙，是有限制的，不能行使太远的距离，也不能打开车里的柜子或者是后备箱。</p> 
 <p>给服务员的钥匙是一个仆从钥匙，相当于令牌Token。</p> 
</blockquote> 
<blockquote> 
 <p>OAuth2的本质就是如何获取token，如何使用token。 </p> 
</blockquote> 
<h2 id="3%20OAuth2%E7%9A%84%E4%BC%98%E5%8A%BF">3 OAuth2的优势</h2> 
<ol><li>比OAuth1.0更易于实现和理解，也是主流（OAuth1.0有点复杂，而且跟OAuth2几乎是不相干）</li><li>更安全，避免暴露了用户密码，服务器端更易集中保护</li><li>广泛传播并被持续采用，成为主流</li><li>token有效期较短并且可以自定义封装token</li><li>资源服务器和授权服务器解耦</li><li>集中式授权，简化客户端</li><li>HTTP/JSON友好，易于请求和传递token</li><li>支持多种架构场景</li><li>客户可以自定义权限</li></ol> 
<h2 id="4%20OAuth2%E7%9A%84%E7%BC%BA%E7%82%B9">4 OAuth2的缺点</h2> 
<ol><li>协议框架过于<span style="color:#9c8ec1;">宽泛</span>，导致兼容性和互操作性较差</li><li>和OAuth1.0不兼容</li><li><span style="color:#fe2c24;"><strong>OAuth2.0不是一个认证协议</strong></span>，是一个授权框架，本身并不能告诉你任何用户信息。</li></ol> 
<h2 id="5%20OAuth2%E7%9A%84%E7%9B%B8%E5%85%B3%E6%9C%AF%E8%AF%AD%E4%B8%8E%E5%85%B6%E5%85%B3%E7%B3%BB">5 OAuth2的相关术语与其关系</h2> 
<h3 id="5.1%20%E8%A7%92%E8%89%B2">5.1 角色</h3> 
<ul><li><span style="color:#9c8ec1;">客户应用</span> - 想要访问用户的受保护资源</li><li><span style="color:#9c8ec1;">资源服务器</span> - 用户的受保护数据保存在此</li><li><span style="color:#9c8ec1;">授权服务器 </span>- 在客户应用成功认证并获得授权后，向客户应用颁发访问令牌（Access Token）</li><li><span style="color:#9c8ec1;">资源拥有者</span> - 想要分享某些资源给客户应用</li></ul> 
<h3 id="5.2%20%E5%85%B6%E4%BB%96%E6%9C%AF%E8%AF%AD">5.2 其他术语</h3> 
<ul><li><span style="color:#9c8ec1;">客户凭证</span> - 客户应用的clientId和密码用于认证客户</li><li><span style="color:#9c8ec1;">令牌Token</span> - 授权服务器在接收到客户应用请求后，颁发的访问令牌</li><li><span style="color:#9c8ec1;">作用域</span> - 客户应用请求访问令牌时，由资源拥有者额外指定的细分权限</li></ul> 
<h3 id="5.3%20%E4%BA%A4%E4%BA%92%E5%85%B3%E7%B3%BB">5.3 交互关系</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/6d/cb/Vsp78y5C_o.png"></p> 
<blockquote> 
 <p> 举个例子：</p> 
 <p>场景：我要玩游戏，游戏可以获取到我的微信好友是否也在玩这个游戏。那么我需要同意授权给游戏获取到我的微信好友。</p> 
 <p>角色：</p> 
 <ul><li>我本人 - 资源拥有者；</li><li>游戏 - 客户应用；</li><li>微信 - 资源服务器；</li><li>授权服务器 - 管理和颁发Access Token</li></ul> 
 <p>流程：</p> 
 <ol><li>游戏向授权服务器请求要Access Token，就是要拿到相关的权限去拿到微信好友</li><li>授权服务器询问我是否同意授权给游戏拿到微信好友信息</li><li>我选择同意赋予权限</li><li>授权服务器得知我同意后，生成Access Token并颁发给游戏</li><li>游戏拿到Access Token后，带上Access Token去请求微信要我的微信好友信息</li><li>微信校验Access Token，校验通过之后，则把我的微信好友信息返回给游戏。</li></ol> 
</blockquote> 
<blockquote> 
 <p>从上面的流程来看，最关键的一步就是授权和Access Token，那再怎么样授权才能拿到Access Token呢？从这点切入就会了解到OAuth2的四种授权方式。</p> 
</blockquote> 
<h2 id="6%C2%A0OAuth2%E7%9A%84%E6%8E%88%E6%9D%83%E6%96%B9%E5%BC%8F%EF%BC%88Flows%EF%BC%89">6 OAuth2的授权方式（Flows）</h2> 
<h3 id="6.1%20%E6%8E%88%E6%9D%83%E7%A0%81%E6%A8%A1%E5%BC%8F%EF%BC%88Authorization%20Code%EF%BC%89">6.1 授权码模式（Authorization Code）</h3> 
<p>四种模式中最复杂的一种，也是最安全的，也是目前应用最多的模式。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/1b/c5/fq4VkQIN_o.png"></p> 
<ul><li> (A) 浏览器把客户应用的客户标识等信息发送到授权服务器，并且把<strong>重定向的url</strong>也一起发送到授权服务器。</li><li>(B) 浏览器得到资源拥有者的同意认证请求后（这个例子我假设资源拥有者是同意授权的），把用户认证信息发送到授权服务器。</li><li>(C) 授权服务器校验用户认证信息，校验正确之后颁发授权码给浏览器，浏览器接受后再返回给客户应用。</li><li>(D) 客户应用拿着授权码以及重定向的url给授权服务器。</li><li>(E) 授权服务器校验授权码等信息无误之后，颁发Access Token和Refresh Token（可选）给客户应用。</li></ul> 
<p><strong>特点</strong></p> 
<ol><li>客户通过前端获取授权码</li><li><strong>客户通过后端使用授权码去交换Access Token和Refresh Token</strong>（可选）</li><li>最安全的是Access Token不会经过用户代理（浏览器）</li></ol> 
<blockquote> 
 <p>此流程图是自己理解过后画的，如要官方流程图，请参考<br><a class="has-card" href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.1" rel="nofollow" title="RFC 6749 - The OAuth 2.0 Authorization Framework"><span class="link-card-box"><span class="link-title">RFC 6749 - The OAuth 2.0 Authorization Framework</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/9c/a5/D6XcWekT_o.png">https://datatracker.ietf.org/doc/html/rfc6749#section-4.1</span></span></a></p> 
</blockquote> 
<blockquote> 
 <p>重定向的url是客户应用自己定义的，比如要登录<em>https:web.com </em>，中途需要认证授权，那么重定向url就是<em>https:web.com。</em>是认证成功之后重定向的url。</p> 
</blockquote> 
<h3 id="6.2%20%E7%AE%80%E5%8C%96%E6%A8%A1%E5%BC%8F%EF%BC%88Implicit%EF%BC%89">6.2 简化模式（Implicit）</h3> 
<p>比授权码模式简单一点，没有中间的授权码交换，适用于单页应用，没有后台的应用场景。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/01/2d/cnQ2hRVZ_o.png"></p> 
<ul><li>(A) 浏览器把客户应用的客户标识等信息发送到授权服务器，并且把重定向的url也一起发送到授权服务器。</li><li>(B) 浏览器得到资源拥有者的同意认证请求后（这个例子我假设资源拥有者是同意授权的），把用户认证信息发送到授权服务器。</li><li>(C) 授权服务器校验认证信息无误后，颁发Access Token和返回重定向url</li><li>(D) 浏览器接受到Access Token后，并返回到客户应用。</li></ul> 
<p><strong>特点</strong></p> 
<ol><li>适用于公开的浏览器单页应用。</li><li>前端可以直接拿到Access Token，因此也容易受到安全攻击。</li><li>不支持Refresh Token</li></ol> 
<blockquote> 
 <p>起码画的流程图我没有照着官网画，我省略了一个Web托管资源服务器，我觉得如果加上这个对于刚接触的人来说有点难理解。有兴趣的可在官网上查看</p> 
 <p><a class="link-info has-card" href="https://datatracker.ietf.org/doc/html/rfc6749#section-4.2" rel="nofollow" title="https://datatracker.ietf.org/doc/html/rfc6749#section-4.2"><span class="link-card-box"><span class="link-title">https://datatracker.ietf.org/doc/html/rfc6749#section-4.2</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/71/0e/QRzVdrG6_o.png">https://datatracker.ietf.org/doc/html/rfc6749#section-4.2</span></span></a></p> 
</blockquote> 
<h3 id="6.3%20%E5%AF%86%E7%A0%81%E6%A8%A1%E5%BC%8F%EF%BC%88Resource%20Owner%20Credentials%EF%BC%89">6.3 密码模式（Resource Owner Credentials）</h3> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/7e/ee/IEqSSP65_o.png"></p> 
<ul><li>(A) 资源拥有者向客户应用提供用户名密码。</li><li>(B) 客户应用把用户名密码发送到授权服务器。</li><li>(C)授权服务器校验用户信息通过后，直接颁发Access Token和Refresh Token（可选）。</li></ul> 
<p><strong>特点</strong></p> 
<ol><li>使用账号密码登录的应用，比如桌面APP，一般适用于企业内部，是可以<strong>高度信任</strong>的。</li><li>使用账号密码作为授权方式从授权服务器上获取Access Token。</li><li>可以支持Refresh Token但是不推荐使用。</li></ol> 
<h3 id="6.4%20%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A8%A1%E5%BC%8F%EF%BC%88Client%20Credentials%EF%BC%89">6.4 客户端模式（Client Credentials）</h3> 
<p>这种也比较简单，甚至都没有资源拥有者的参与，直接由客户应用将客户的认证信息发送到授权服务器，授权服务器校验通过之后返回Access Token给客户应用。这种适用于机器对机器（后端）的场景。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/f0/a2/QcE62tCa_o.png"></p> 
<ul><li>(A) 客户应用把客户凭证发送到授权服务器</li><li>(B) 授权服务器校验通过之后颁发Access Token</li></ul> 
<p><strong>特点</strong></p> 
<ol><li>只有后端渠道</li><li>该模式支持共享密码或者证书，因为客户凭证可以使用对称或非对称加密。</li></ol> 
<p></p> 
<h2 id="7%20%E5%88%B7%E6%96%B0%E4%BB%A4%E7%89%8C%EF%BC%88Refresh%20Token%EF%BC%89">7 刷新令牌（Refresh Token）</h2> 
<p>上文的几种模式中都提到了一个刷新令牌，也就是Refresh Token，那么Refresh Token是什么时候可以用到呢，以及目的是什么呢？</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/e2/59/rxckBCCJ_o.png"></p> 
<ul><li>(A) 一般选择授权码模式 </li><li>(B) 校验信息通过之后颁发Access Token和Refresh Token</li><li>(C) 客户应用把拿到的Access Token给到资源服务器</li><li>(D) 资源服务器校验Access Token，验证其有效后把资源返回给客户应用</li><li>(E) 过了一段时间，客户应用又拿着Access Token去请求资源</li><li>(F) 资源服务器校验Access Token发现已经过期，把报错信息返回给客户应用</li><li>(G) 客户应用拿Refresh Token给授权服务器，请求一个新的Access Token</li><li>(H) 授权服务器校验Refresh Token之后，重新生成了新的Access Token和新的Refresh Token（可选）</li></ul> 
<blockquote> 
 <p>目的：简化获取Access Token流程，不需要每次都走完成的获取Access Token的流程，快速的获取新的Token。</p> 
</blockquote> 
<h2 id="8%20%E6%8E%88%E6%9D%83%E6%B5%81%E7%A8%8B%E6%B8%A0%E9%81%93%EF%BC%88Channels%EF%BC%89">8 授权流程渠道（Channels）</h2> 
<p>根据角色之间的交互可以划分渠道。</p> 
<ul><li><span style="color:#9c8ec1;"><strong>资源拥有者</strong></span>，客户应用，授权服务器参与的称为<strong>前端渠道</strong>。</li><li><span style="color:#9c8ec1;"><strong>资源服务器</strong></span>，客户应用，授权服务器参与的称为<strong>后端渠道</strong>。</li></ul> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/8a/97/amOFtuFL_o.png"></p> 
<h2 id="9%20%E5%AE%A2%E6%88%B7%E5%BA%94%E7%94%A8%E7%B1%BB%E5%9E%8B">9 客户应用类型</h2> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/0a/56/kMLjpw02_o.png"></p> 
<p> 我们可以把应用大致分为两类，一个是<strong>公开应用</strong>，一个是<strong>私密应用</strong>。</p> 
<ul><li>公开应用：主要是指单页应用和原生APP。特点是都是在客户端，用户可以直接接触到这些应用。针对这种应用就不能把一些凭证信息（密码之类的）存在这里，不然可能会泄露凭证信息，所以一般只保存用户的标识。</li><li>私密应用：主要是Web服务器端的应用，还有机器对机器。这种是比较安全和私密的，不仅可以存储用户标识，还可以存储用户凭证，把密码等私密信息存放到后端服务器上。</li></ul> 
<h2 id="10%20%E4%BB%A4%E7%89%8C%E7%B1%BB%E5%9E%8B">10 令牌类型</h2> 
<ol><li><span style="color:#9c8ec1;">授权码(Authorization Code Token)</span>：在授权码模型中使用，用于交换获取Access Token和Refresh Token。</li><li><span style="color:#9c8ec1;"><strong>访问令牌</strong>(Access Token)</span>：代表资源拥有者直接去访问资源。</li><li><span style="color:#9c8ec1;">刷新令牌(Refresh Token)</span>：用于去授权服务器获取一个新的Access Token</li><li><span style="color:#9c8ec1;">Bearer Token</span>：通用型Token，不管是谁拿到该Token都能访问资源。</li><li><span style="color:#9c8ec1;">PoP Token(Proof of Possession)</span>：可以校验客户用户应用是否对Token有明确的拥有权。(因为Bearer Token有时候会存在问题，毕竟谁拿到Token都能用，所以衍生出了PoP Token，可以校验用户是不是有权限使用这个Token）</li></ol> 
<h2 id="11%20%E5%A6%82%E4%BD%95%E9%80%89%E6%8B%A9%E6%8E%88%E6%9D%83%E7%B1%BB%E5%9E%8B">11 如何选择授权类型</h2> 
<p><img alt="" src="https://images2.imgbox.com/56/56/G2Tm89Y1_o.png"></p> 
<blockquote> 
 <ul><li>如果是机器需要访问资源，可以选择<strong>客户端模式</strong>；</li><li>如果是用户需要访问资源 
   <ul><li>如果客户类型是Web服务器端应用，可以选择<strong>授权码模式</strong>；</li><li>如果是原生App 
     <ul><li>第一方原生APP（可以理解为同一个公司旗下） 
       <ul><li>选择<strong>用户密码模式</strong></li></ul></li><li>第三方原生App 
       <ul><li>选择<strong>客户端模式</strong></li></ul></li></ul></li><li>如果是单页应用SPA 
     <ul><li>第一方单页应用SPA 
       <ul><li>选择<strong>用户密码模式</strong></li></ul></li><li>第三方单页应用SPA 
       <ul><li>选择<strong>简化模式</strong></li></ul></li></ul></li></ul></li></ul> 
</blockquote> 
<h2 id="12%20%E6%8E%88%E6%9D%83%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9A%84%E7%BB%84%E6%88%90">12 授权服务器的组成</h2> 
<p>典型的授权服务的组成，是有四个主要端点组成，也就是四大功能。</p> 
<h2 id="%E2%80%8B%E7%BC%96%E8%BE%91" style="text-align:center;"><img alt="" src="https://images2.imgbox.com/36/c5/AZSa86ec_o.png"></h2> 
<ul><li>授权端点：客户端授权时，访问授权端点</li><li>Token端点：通过授权以后，生成Token</li><li>校验端点：校验Token是否合法</li><li>吊销端点：对非法客户应用进行吊销</li></ul> 
<h2 id="13%C2%A0%E5%AF%B9OAuth2%E7%9A%84%E8%AF%AF%E8%A7%A3">13 对OAuth2的误解</h2> 
<ol><li>OAuth没有支持<span style="color:#fe2c24;">HTTP以外的协议</span>。</li><li>OAuth不是一个<span style="color:#fe2c24;">认证协议</span><span style="color:#0d0016;"> （管授权不管认证，但是可以扩充支持认证）</span>。</li><li>OAuth没有定义<span style="color:#fe2c24;">授权代理机制 </span><span style="color:#0d0016;">（授权是应用开发方和资源服务器去管理的）</span>。</li><li>OAuth没有定义<span style="color:#fe2c24;">Token格式</span>。</li><li>OAuth2没有定义<span style="color:#fe2c24;">加密方法</span>。</li><li>OAuth2不是<span style="color:#fe2c24;">单个协议</span>。</li><li>OAuth2只是一个<span style="color:#fe2c24;">授权框架</span>，仅用于<span style="color:#fe2c24;">授权代理</span>。</li></ol> 
<h2 id="%E6%96%87%E6%A1%A3%E9%93%BE%E6%8E%A5">文档链接</h2> 
<p><a class="link-info has-card" href="https://oauth.net/2/" rel="nofollow" title="OAuth2 官网"><span class="link-card-box"><span class="link-title">OAuth2 官网</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/b5/2a/uQnpaYhL_o.png">https://oauth.net/2/</span></span></a></p> 
<p><a class="link-info has-card" href="https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html" rel="nofollow" title="阮一峰的网络日志 - 理解OAuth 2.0"><span class="link-card-box"><span class="link-title">阮一峰的网络日志 - 理解OAuth 2.0</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/c3/4a/8qyLOaoD_o.png">https://www.ruanyifeng.com/blog/2014/05/oauth_2_0.html</span></span></a> <a class="link-info has-card" href="https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1" rel="nofollow" title="The OAuth 2.0 Authorization Framework"><span class="link-card-box"><span class="link-title">The OAuth 2.0 Authorization Framework</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/09/5d/1AuDgfvD_o.png">https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1</span></span></a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1e10fed8a50515161064919a2177fe23/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Git使用（基础超简单上手）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b05a071daa5b8227cecb0614ed124c58/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">gin 多结构体嵌套 效验范例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>