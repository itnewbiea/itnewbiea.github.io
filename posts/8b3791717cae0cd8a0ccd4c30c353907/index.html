<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apifox：API 接口自动化测试完全指南 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apifox：API 接口自动化测试完全指南" />
<meta property="og:description" content="1. 前言 在开始前大家可以先阅读：深入了解自动化测试：什么是自动化测试及其作用？
大家好，这是一篇关于 Apifox 的接口自动化测试教程。相信你已经对 Apifox 有所了解：“集 API 文档、API 调试、API Mock、API 自动化测试，更先进的 API 设计/开发/测试工具”。
笔者是后端开发，因此这篇教程关注的是 API 自动化测试，如果你也是后端开发，正苦于没有好的方式测试接口，对保证线上接口稳定性没有信心，那么这篇文章就是为你准备的，如果你学会了 Apifox 接口自动化测试，它几乎是一个会陪伴你整个职业生涯中的一件称心应手的兵器。
接口测试可不是简单的请求一两个接口再检查一下响应结果那么简单，没有贴近业务场景的测试意义不大，但完全模拟业务场景，一比一真实的去还原用户操作流程的测试势必会很复杂，如 接口需要登陆后才能操作怎么办？一个接口依赖上一个接口请求返回的数据怎么办？后端对请求有签名验证怎么办？后端任务是异步处理的怎么办？...
不要担心，既然是完全指南，这些问题我们就都会讲到，Apifox 强大的能力可以解决这些问题，下面我们会用真实的案例，逐步讲解覆盖到这些所有的场景。建议大家打开 autotest.apifox.cn 这个项目，一边学习里面的公共脚本（公共脚本、测试套件等都打包放在 百度网盘），一边跟着练习。
2. 接口自动鉴权 知识点：环境变量、公共脚本、pm.sendRequest脚本发送请求
我们通过一个需要登录才能访问的后台新闻列表接口，来演示接口自动登录鉴权。
默认情况下访问该接口提示需要登录：
如果要正常访问该接口的数据，需要在 header 中提供 AdminToken: token 头，这是一个常见的需要 JWT 登录认证接口。
很自然的我们想到，如果自动请求登录接口获取 token 值，然后在每次请求前自动带上这个 AdminToken 头不就行了吗，没错就是这样简单，伪代码如下：
完整的代码见 「公共脚本」admin: login and Auth
这里我们从登录接口获取 token 后，将其缓存到本地的环境变量中，这样就不必每次都请求登录了。
现在我们已经完成了 请求登录接口获取 token，并设置到 请求头中的功能，然后我们再把此 公共脚本 应用到 新闻列表的接口上，实现在 请求新闻列表接口 前自动完成 “登录”。
后台有很多接口访问都需要登录，如果一个个地去设置 前置脚本 就太麻烦了，所以这里我们直接在 admin 后端接口的分组目录上设置 前置操作 公共脚本admin: login and Auth，这样整个 admin 下的全部接口都能自动登录了：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8b3791717cae0cd8a0ccd4c30c353907/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-10T15:25:15+08:00" />
<meta property="article:modified_time" content="2023-04-10T15:25:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apifox：API 接口自动化测试完全指南</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p class="img-center"><img alt="" src="https://images2.imgbox.com/5d/0a/vrymbNFE_o.png"></p> 
<h4>1. 前言</h4> 
<p>在开始前大家可以先阅读：<a class="link-info" href="https://apifox.com/apiskills/what-is-automation-testing/" rel="nofollow" title="深入了解自动化测试：什么是自动化测试及其作用？">深入了解自动化测试：什么是自动化测试及其作用？</a></p> 
<p>大家好，这是一篇关于 <a href="https://apifox.com/" rel="nofollow" title="Apifox">Apifox</a> 的接口自动化测试教程。相信你已经对 Apifox 有所了解：“集 API 文档、API 调试、API Mock、<strong>API 自动化测试</strong>，更先进的 API 设计/开发/<strong>测试工具</strong>”。</p> 
<p>笔者是后端开发，因此这篇教程关注的是 <strong>API 自动化测试</strong>，如果你也是后端开发，正苦于没有好的方式测试接口，<strong>对保证线上接口稳定性没有信心</strong>，那么这篇文章就是为你准备的，如果你学会了 Apifox 接口自动化测试，它几乎是一个会陪伴你整个职业生涯中的一件称心应手的兵器。</p> 
<p>接口测试可不是简单的请求一两个接口再检查一下响应结果那么简单，没有贴近业务场景的测试意义不大，但完全模拟业务场景，一比一真实的去还原用户操作流程的测试势必会很复杂，如 接口需要登陆后才能操作怎么办？一个接口依赖上一个接口请求返回的数据怎么办？后端对请求有签名验证怎么办？后端任务是异步处理的怎么办？...</p> 
<p>不要担心，既然是完全指南，这些问题我们就都会讲到，Apifox 强大的能力可以解决这些问题，下面我们会用真实的案例，逐步讲解覆盖到这些所有的场景。<strong>建议大家打开 <a href="https://autotest.apifox.cn/" rel="nofollow" title="autotest.apifox.cn">autotest.apifox.cn</a> 这个项目，一边学习里面的公共脚本（公共脚本、测试套件等都打包放在 <a href="https://pan.baidu.com/s/1DC5L0fUlzRUy9FS6BXNDBw?pwd=ryag" rel="nofollow" title="百度网盘">百度网盘</a>），一边跟着练习。</strong></p> 
<h4>2. 接口自动鉴权</h4> 
<blockquote> 
 <p>知识点：环境变量、公共脚本、<code>pm.sendRequest</code>脚本发送请求</p> 
</blockquote> 
<p>我们通过一个需要登录才能访问的后台新闻列表接口，来演示接口自动登录鉴权。</p> 
<p>默认情况下访问该接口提示需要登录：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/66/1f/RN8F1Si6_o.png"></p> 
<p>如果要正常访问该接口的数据，需要在 header 中提供 <code>AdminToken: token</code> 头，这是一个常见的需要 JWT 登录认证接口。</p> 
<p>很自然的我们想到，如果自动请求登录接口获取 <code>token</code> 值，然后在每次请求前自动带上这个 <code>AdminToken</code> 头不就行了吗，没错就是这样简单，伪代码如下：</p> 
<p>完整的代码见 「公共脚本」<code>admin: login and Auth</code></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/7f/49/vhmRlxut_o.png"></p> 
<p>这里我们从登录接口获取 token 后，将其缓存到本地的环境变量中，这样就不必每次都请求登录了。</p> 
<p>现在我们已经完成了 请求登录接口获取 token，并设置到 请求头中的功能，然后我们再把此 公共脚本 应用到 新闻列表的接口上，实现在 请求新闻列表接口 前自动完成 “登录”。</p> 
<p>后台有很多接口访问都需要登录，如果一个个地去设置 前置脚本 就太麻烦了，所以这里我们直接在 admin 后端接口的分组目录上设置 <strong>前置操作</strong> 公共脚本<code>admin: login and Auth</code>，这样整个 admin 下的全部接口都能自动登录了：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/21/ce/cp59rEt7_o.png"></p> 
<p>我们来验证一下：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/80/03/ZdJ5AsCS_o.png"></p> 
<p>可以看到返回了数据，说明自动登录成功了，我们在 控制台输出 中可以看到请求了登录接口，在<strong>实际请求</strong>中 可以看到 <code>AdminToken: token</code> 头。</p> 
<p>在这个例子中我们是将 用于后台登录的 <code>用户名</code> 和 <code>密码</code> 提前配置到了 环境变量中，然后利用脚本 <code>pm.sendRequest</code> 请求登录接口获取 token，并设置 请求头，这样就实现了接口的自动登录。</p> 
<p>关于变量的优先级 和 脚本的执行时机，如图所示：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/12/4c/I5pPfP95_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/80/0d/laHWZqBy_o.png"></p> 
<h4>3. 接口自动加签</h4> 
<blockquote> 
 <p>知识点：<a href="https://www.apifox.com/help/app/scripts/examples/request-handle/" rel="nofollow" title="参数注入">参数注入</a>、<a href="https://www.apifox.com/help/app/scripts/api-references/library-reference/" rel="nofollow" title="内置类库">内置类库</a></p> 
</blockquote> 
<p>有一些对安全性要求较高的接口可能会有对接口请求进行验签的机制，具体是 接口请求的数据 会额外多一个 <code>sign</code> 字段，它的值是可以是 <code>md5(k1=v1&amp;k2=v2...)</code>，这样就确保了请求数据不会被篡改，但是这给我们测试带来了麻烦，我们如何每次自动生成 <code>sign</code> 参数呢，不用担心，这对 Apifox 来说不在话下，利用 Apifox 强大的脚本功能我们甚至能够调用外部任何语言的脚本。</p> 
<p>知道了请求加签的原理，那么实现就很容易了，无非是 在请求前 自动算出 <code>sign</code> ，并注入到请求参数中去，下面是伪代码：</p> 
<p>完整的代码见 「公共脚本」<code>parkinglot:client: request sign and common params</code></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/b8/fe/NZPdwkDU_o.png"></p> 
<p>然后 把 自动加签的公共脚本设置到 <code>client 停车场设备端 📟</code> 分组 的<strong>前置脚本</strong>中，这样其下所有接口请求时都有 <code>sign</code> 参数了。</p> 
<blockquote> 
 <p>注：这里简化了签名算法， <code>md5(k1=v1&amp;k2=v2...， key)</code> 其实签名算法还有一个关键的 <code>key</code>参数 ，不过删减这部分内容并不影响我们这里对接口自动加签的讲解。为了力求简洁，只关注最核心的东西，文章都是使用伪代码的形式，完整代码请读者自行查看项目中的公共脚本。</p> 
</blockquote> 
<h4>4. 测试用例</h4> 
<blockquote> 
 <p>知识点：接口用例（顺序）、<a href="https://www.apifox.com/help/app/test-manage/test-process/" rel="nofollow" title="流程控制">流程控制</a>（条件、循环、等待）、测试数据、断言</p> 
</blockquote> 
<p>在掌握了 Apifox 的强大脚本能力后，你几乎能够解决任何鉴权、加签等问题了，接下来我们开始搭建完整的测试流程，以便<strong>真实完整的模拟</strong>正常使用时的<strong>业务测试场景</strong>。</p> 
<p>我假定你已经熟悉 Apifox 中 接口用例、环境变量、变量提取、断言 等基础概念，如果不熟悉，那建议你先快速地看一下官方文档 ：<a href="https://www.apifox.com/help/" rel="nofollow" title="Apifox 帮助文档">Apifox 帮助文档</a>。</p> 
<p>我们先看一个简单的场景测试：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/64/39/5cdJQqVG_o.png"></p> 
<p>我们运行测试看一下：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/d3/24/3xlBf5Iy_o.png"></p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/cf/7f/iFbQSWy2_o.png"></p> 
<p>我们在后台看一下新闻分类和新闻确实创建成功了。</p> 
<p>再看看一个稍微复杂一点的测试场景，一个异步任务处理的场景测试：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/45/1a/LFxG6XCD_o.png"></p> 
<p>相信看到这里已经不需要我解释什么了，如你所见，Apifox 的测试用例的流程编排功能非常强大，你能 DIY 出任何复杂的场景。更多用法见文档：<a href="https://www.apifox.com/help/app/test-manage/test-process/" rel="nofollow" title="测试流程控制 | Apifox 帮助文档">测试流程控制 | Apifox 帮助文档</a></p> 
<h4>5. Apifox CLI</h4> 
<blockquote> 
 <p>知识点：<a href="https://www.apifox.com/help/cli/" rel="nofollow" title="命令行">命令行</a></p> 
</blockquote> 
<p>如果每次测试都需要我们手动点击 运行按钮 就太不方便了，没错，Apifox 当然也考虑到了这点，Apifox CLI 就可以帮助我们实现自动化的测试。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/15/89/vhfe8y8s_o.png"></p> 
<p>点击<strong>持续集成</strong>的按钮就能够生成 命令行代码：</p> 
<p>将这行 shell 命令复制到任意地方执行即可实时运行测试用例/套件。</p> 
<h4>6. 持续集成</h4> 
<blockquote> 
 <p>知识点：自动化测试</p> 
</blockquote> 
<p>我们先在服务器上安装 <code>apifox-cli</code>：</p> 
<p>然后在<strong>发布工具</strong>中集成 测试命令即可：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/88/b8/ePDYOu8b_o.png"></p> 
<p>为了通用性，我们使用 php 脚本 将 <code>apifox run ...</code> 命令进行了封装，你理解成执行的是 <code>apifox run ...</code>   命令即可。</p> 
<blockquote> 
 <p>这里我们用的是 Spug 发布工具，类似 Jenkins，请根据实际情况配置。</p> 
</blockquote> 
<h4>7. 测试报告</h4> 
<blockquote> 
 <p>知识点：报告解析、<a href="https://apifox.com/help/app/webhook/#webhook" rel="nofollow" title="钉钉通知">钉钉通知</a></p> 
</blockquote> 
<p>我们在 <code>Apifox.php</code> 脚本执行测试命令，并解析测试生成的 json 文件，然后将结果拼装发送到钉钉群，如果有失败会 at 相应的开发人员：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/56/3f/VUeczVSa_o.png"></p> 
<h4>8. 附录</h4> 
<p>上面提到的公共脚本、测试套件等都打包放在这里了：<a href="https://pan.baidu.com/s/1DC5L0fUlzRUy9FS6BXNDBw?pwd=ryag" rel="nofollow" title="百度网盘">百度网盘</a>，需要的话可以拿去参考，强烈建议直接<a href="https://www.apifox.cn/web/invite?token=sEIOR3v_7WUJEZCiGEehQ" rel="nofollow" title="打开项目">打开项目</a>查看功能脚本，测试用例进行参考学习。</p> 
<p>作者：xika</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dcdee0cd82f7e7ff775fe279325309e5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决 java: 非法字符: ‘\ufeff‘</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/691d84efb8453eea869671f44d3a2321/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ROS已装背景下安装PCL和VTK，解决VTK和PCL_ROS冲突问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>