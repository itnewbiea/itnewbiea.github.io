<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Reactor 第十篇 定制一个生产的WebClient - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Reactor 第十篇 定制一个生产的WebClient" />
<meta property="og:description" content="1 为什么要用 WebClient 刚开始尝试使用 Spring WebFlux 的时候，很多人都会使用 Mono.fromFuture() 将异步请求转成 Mono 对象，或者 Mono.fromSupplier() 将请求转成 MOno 对象，这两种方式在响应式编程中都是不建议的，都会阻塞当前线程。
1.1 Mono.fromFuture() VS WebClient Mono.fromFuture()方法和使用 WebClient 调用第三方接口之间存在以下区别：
异步 vs. 非阻塞 Mono.fromFuture()方法适用于接收一个 java.util.concurrent.Future 对象，并将其转换为响应式的 Mono。这是一个阻塞操作，因为它会等待 Future 对象完成。而使用 WebClient 调用第三方接口是异步和非阻塞的，它不会直接阻塞应用程序的执行，而是使用事件驱动的方式处理响应。
可扩展性和灵活性：使用 WebClient 可以更灵活地进行配置和处理，例如设置超时时间、请求头、重试机制等。WebClient 还可以与许多其他 Spring WebFlux 组件集成，如 WebSockets、Server-Sent Events 等。而 Mono.fromFuture() 是适用于单个 Future 对象转化为 Mono 的情况，可扩展性较差。
错误处理 WebClient 提供了更丰富的错误处理机制，可以通过 onStatus、onError 等方法来处理不同的 HTTP 状态码或异常。同时，WebClient 还提供了更灵活的重试和回退策略。Mono.fromFuture() 方法只能将 Future 对象的结果包装在 Mono 中，不提供特定的错误处理机制。
阻塞操作 Mono.fromFuture() 会阻塞。当调用 Mono.fromFuture() 方法将 Future 转换为 Mono 时，它会等待 Future 对象的结果返回。在这个等待的过程中，Mono." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6c61fa55ed8db0efd9dfb627bb6f9eb6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-21T19:26:28+08:00" />
<meta property="article:modified_time" content="2023-08-21T19:26:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Reactor 第十篇 定制一个生产的WebClient</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="1__WebClient_1"></a>1 为什么要用 WebClient</h3> 
<p>刚开始尝试使用 Spring WebFlux 的时候，很多人都会使用 Mono.fromFuture() 将异步请求转成 Mono 对象，或者 Mono.fromSupplier() 将请求转成 MOno 对象，这两种方式在响应式编程中都是不建议的，都会阻塞当前线程。</p> 
<h4><a id="11_MonofromFuture_VS_WebClient_6"></a>1.1 Mono.fromFuture() VS WebClient</h4> 
<p>Mono.fromFuture()方法和使用 WebClient 调用第三方接口之间存在以下区别：</p> 
<ul><li>异步 vs. 非阻塞</li></ul> 
<p>Mono.fromFuture()方法适用于接收一个 java.util.concurrent.Future 对象，并将其转换为响应式的 Mono。这是一个阻塞操作，因为它会等待 Future 对象完成。而使用 WebClient 调用第三方接口是异步和非阻塞的，它不会直接阻塞应用程序的执行，而是使用事件驱动的方式处理响应。</p> 
<p>可扩展性和灵活性：使用 WebClient 可以更灵活地进行配置和处理，例如设置超时时间、请求头、重试机制等。WebClient 还可以与许多其他 Spring WebFlux 组件集成，如 WebSockets、Server-Sent Events 等。而 Mono.fromFuture() 是适用于单个 Future 对象转化为 Mono 的情况，可扩展性较差。</p> 
<ul><li>错误处理</li></ul> 
<p>WebClient 提供了更丰富的错误处理机制，可以通过 onStatus、onError 等方法来处理不同的 HTTP 状态码或异常。同时，WebClient 还提供了更灵活的重试和回退策略。Mono.fromFuture() 方法只能将 Future 对象的结果包装在 Mono 中，不提供特定的错误处理机制。</p> 
<ul><li>阻塞操作</li></ul> 
<p>Mono.fromFuture() 会阻塞。当调用 Mono.fromFuture() 方法将 Future 转换为 Mono 时，它会等待 Future 对象的结果返回。在这个等待的过程中，Mono.fromFuture()方法会阻塞当前的线程。这意味着，如果 Future 的结果在运行过程中没有返回，则当前线程会一直阻塞，直到 Future 对象返回结果或者超时。因此，在使用 Mono.fromFuture() 时需要注意潜在的阻塞风险。另外，需要确保F uture 的任务在后台线程中执行，以免阻塞应用程序的主线程。</p> 
<h4><a id="12_MonofromFuture_VS_MonofromSupplier_24"></a>1.2 Mono.fromFuture VS Mono.fromSupplier</h4> 
<p>Mono.fromSupplier() 和 Mono.fromFuture() 都是用于将异步执行的操作转换为响应式的 Mono 对象，但它们的区别在于：</p> 
<p>Mono.fromSupplier() 适用于一个提供者/生产者，可以用来表示某个操作的结果，该操作是一些<strong>纯计算并且没有阻塞</strong>的方法。也就是说，Mono.fromSupplier() 将其参数 (Supplier) 所提供的操作异步执行，并将其结果打包成一个 Mono 对象。</p> 
<p>Mono.fromFuture() 适用于一个 java.util.concurrent.Future 对象，将其封装成 Mono 对象。这意味着调用 Mono.fromFuture() 方法将阻塞当前线程，直到异步操作完成返回一个 Future 对象。</p> 
<p>因此，Mono.fromSupplier() 与 Mono.fromFuture() 的主要区别在于：</p> 
<p>Mono.fromSupplier() 是一个非阻塞的操作，不会阻塞当前线程。这个方法用于<strong>执行计算型的任务</strong>，返回一个封装了计算结果的 Mono 对象。<br> Mono.fromFuture() 是阻塞操作，会阻塞当前线程，直到异步操作完毕并返回看，它适用于处理 java.util.concurrent.Future 对象。</p> 
<p>需要注意的是，如果 Supplier 提供的操作是阻塞的，则 Mono.fromSupplier() 方法本身也会阻塞线程。但通常情况下，Supplier 提供的操作是纯计算型的，不会阻塞线程。</p> 
<p>因此，可以使用 Mono.fromSupplier() 方法将一个纯计算型的操作转换为 Mono 对象，而将一个异步返回结果的操作转换为 Mono 对象时，可以使用 Mono.fromFuture() 方法。</p> 
<h3><a id="2__WebClient_41"></a>2 定制化自己的 WebClient</h3> 
<h4><a id="21__WebClient_43"></a>2.1 初始化 WebClient</h4> 
<p>WebClient 支持建造者模式，使用 WebClient 建造者模式支持开发自己的个性化 WebClient，比如支持设置接口调用统一耗时、自定义底层 Http 客户端、调用链路、打印接口返回日志、监控接口耗时等等。</p> 
<p>WebClient builder 支持以下方法</p> 
<pre><code class="prism language-java"><span class="token keyword">interface</span> <span class="token class-name">Builder</span> <span class="token punctuation">{<!-- --></span>

		<span class="token comment">/**
		 * 配置请求基础的url，如：baseUrl = "https://abc.go.com/v1";和 uriBuilderFactory 冲突，如果有 uriBuilderFactory ，则忽略 baseUrl
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">baseUrl</span><span class="token punctuation">(</span><span class="token class-name">String</span> baseUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * URI 请求的默认变量。也和 uriBuilderFactory 冲突，如果有 uriBuilderFactory ，则忽略 defaultUriVariables
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">defaultUriVariables</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token operator">?</span><span class="token punctuation">&gt;</span></span> defaultUriVariables<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * 提供一个预配置的UriBuilderFactory实例
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">uriBuilderFactory</span><span class="token punctuation">(</span><span class="token class-name">UriBuilderFactory</span> uriBuilderFactory<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * 默认 header
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">defaultHeader</span><span class="token punctuation">(</span><span class="token class-name">String</span> header<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * 默认cookie
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">defaultCookie</span><span class="token punctuation">(</span><span class="token class-name">String</span> cookie<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * 提供一个 consumer 来定制每个请求
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">defaultRequest</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RequestHeadersSpec</span><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> defaultRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * 添加一个filter，可以添加多个
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token class-name">ExchangeFilterFunction</span> filter<span class="token punctuation">)</span><span class="token punctuation">;</span>

	
		<span class="token comment">/**
		 * 配置要使用的 ClientHttpConnector。这对于插入或自定义底层HTTP 客户端库(例如SSL)的选项非常有用。
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">clientConnector</span><span class="token punctuation">(</span><span class="token class-name">ClientHttpConnector</span> connector<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Configure the codecs for the {@code WebClient} in the
		 * {@link #exchangeStrategies(ExchangeStrategies) underlying}
		 * {@code ExchangeStrategies}.
		 * @param configurer the configurer to apply
		 * @since 5.1.13
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">codecs</span><span class="token punctuation">(</span><span class="token class-name">Consumer</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ClientCodecConfigurer</span><span class="token punctuation">&gt;</span></span> configurer<span class="token punctuation">)</span><span class="token punctuation">;</span>



		<span class="token comment">/**
		 * 提供一个预先配置了ClientHttpConnector和ExchangeStrategies的ExchangeFunction。
这是对 clientConnector 的一种替代，并且有效地覆盖了它们。
		 */</span>
		<span class="token class-name">Builder</span> <span class="token function">exchangeFunction</span><span class="token punctuation">(</span><span class="token class-name">ExchangeFunction</span> exchangeFunction<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">/**
		 * Builder the {@link WebClient} instance.
		 */</span>
		<span class="token class-name">WebClient</span> <span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
  <span class="token comment">// 其他方法</span>
	<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="22__120"></a>2.2 日志打印及监控</h4> 
<ul><li>打印参数、url、返回</li><li>参数和返回需要转成json</li><li>需要打印正常返回日志和异常</li><li>正常监控、异常监控、总监控以及响应时间</li></ul> 
<pre><code>.doOnSuccess(response-&gt; {
    log.info("get.success, url={}, response={}, param={}", url, response);
})
.doOnError(error-&gt; {
    log.info("get.error, url={}", url, error);
    // 监控
})
.doFinally(res-&gt; {
  //监控
})
</code></pre> 
<h4><a id="23__140"></a>2.3 返回处理</h4> 
<blockquote> 
 <p>retrieve() // 声明如何提取响应。例如，提取一个ResponseEntity的状态，头部和身体:</p> 
</blockquote> 
<blockquote> 
 <p>.bodyToMono(clazz) 将返回body内容转成clazz对象，clazz 对象可以自己指定类型。如果碰到有问题的无法转化的，也可以先转成String，然后自己实现一个工具类，将String转成 class 对象。</p> 
</blockquote> 
<h5><a id="231_get_146"></a>2.3.1 get</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>response<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"get.success, url={}, response={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"get.param.error, url={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onErrorReturn</span><span class="token punctuation">(</span>defaultClass<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doFinally</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">publishOn</span><span class="token punctuation">(</span>customScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="232_get_param__170"></a>2.3.2 get param 请求</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getParam</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> param<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">URI</span> uri <span class="token operator">=</span> <span class="token class-name">UriComponentsBuilder</span><span class="token punctuation">.</span><span class="token function">fromUriString</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">queryParams</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">toUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">return</span> webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>response<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"get.param.success, url={}, response={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"get.param.error, url={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onErrorReturn</span><span class="token punctuation">(</span>defaultClass<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doFinally</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 监控 or 打印日志 or 耗时</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">publishOn</span><span class="token punctuation">(</span>customScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="233_post_json__199"></a>2.3.3 post json 请求</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">postJson</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">HttpParameter4Json</span> parameter<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">final</span> <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">return</span> webClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">cookies</span><span class="token punctuation">(</span>cookies <span class="token operator">-&gt;</span> cookies<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getJsonBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ParameterizedTypeReference</span><span class="token punctuation">.</span><span class="token function">forType</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getBodyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span>headers <span class="token operator">-&gt;</span> headers<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>response<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"post.json.success, url={}, response={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">,</span> parameter<span class="token punctuation">.</span><span class="token function">getJsonBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"get.param.error, url={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> parameter<span class="token punctuation">.</span><span class="token function">getJsonBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">onErrorReturn</span><span class="token punctuation">(</span>defaultClass<span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">doFinally</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">publishOn</span><span class="token punctuation">(</span>customScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre> 
<h5><a id="234_post_form_Data__227"></a>2.3.4 post form Data 请求</h5> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">postFormData</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">HttpParameter</span> parameter<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">final</span> <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> webClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_FORM_URLENCODED</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">cookies</span><span class="token punctuation">(</span>cookies <span class="token operator">-&gt;</span> cookies<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">BodyInserters</span><span class="token punctuation">.</span><span class="token function">fromFormData</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getMultiValueMapParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span>headers <span class="token operator">-&gt;</span> headers<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getMapHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>response<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"post.fromData.success, url={}, response={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
                log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"get.param.error, url={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">onErrorReturn</span><span class="token punctuation">(</span>defaultClass<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">doFinally</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">publishOn</span><span class="token punctuation">(</span>customScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="24__254"></a>2.4 异常处理</h4> 
<h5><a id="241__256"></a>2.4.1 异常返回兜底</h5> 
<p>onErrorReturn 发现异常返回兜底数据</p> 
<h5><a id="242__261"></a>2.4.2 异常处理</h5> 
<p>状态码转成异常抛出</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">onStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token operator">::</span><span class="token function">isError</span><span class="token punctuation">,</span> response <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"Request failed with status code: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>监控异常</p> 
<pre><code class="prism language-java"><span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// log and monitor</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3__WebClient_277"></a>3 完整的 WebClient</h3> 
<pre><code class="prism language-java">
<span class="token keyword">package</span> <span class="token namespace">com<span class="token punctuation">.</span>geniu<span class="token punctuation">.</span>reactor<span class="token punctuation">.</span>webclient</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>geniu<span class="token punctuation">.</span>utils<span class="token punctuation">.</span></span><span class="token class-name">JsonUtil</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>channel<span class="token punctuation">.</span></span><span class="token class-name">ChannelOption</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span></span><span class="token class-name">SslContextBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">io<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>handler<span class="token punctuation">.</span>ssl<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">InsecureTrustManagerFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">lombok<span class="token punctuation">.</span>extern<span class="token punctuation">.</span>slf4j<span class="token punctuation">.</span></span><span class="token class-name">Slf4j</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span><span class="token class-name">ParameterizedTypeReference</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpStatus</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">MediaType</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span></span><span class="token class-name">ReactorClientHttpConnector</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">MultiValueMap</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">BodyInserters</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>reactive<span class="token punctuation">.</span>function<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">WebClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">UriComponentsBuilder</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>publisher<span class="token punctuation">.</span></span><span class="token class-name">Mono</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span></span><span class="token class-name">Scheduler</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>core<span class="token punctuation">.</span>scheduler<span class="token punctuation">.</span></span><span class="token class-name">Schedulers</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">HttpClient</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>resources<span class="token punctuation">.</span></span><span class="token class-name">ConnectionProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>resources<span class="token punctuation">.</span></span><span class="token class-name">LoopResources</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>tcp<span class="token punctuation">.</span></span><span class="token class-name">SslProvider</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">reactor<span class="token punctuation">.</span>netty<span class="token punctuation">.</span>tcp<span class="token punctuation">.</span></span><span class="token class-name">TcpClient</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span><span class="token class-name">URI</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>time<span class="token punctuation">.</span></span><span class="token class-name">Duration</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>function<span class="token punctuation">.</span></span><span class="token class-name">Function</span></span><span class="token punctuation">;</span>

<span class="token comment">/**
 * @Author: prepared
 * @Date: 2023/8/15 11:05
 */</span>
<span class="token annotation punctuation">@Slf4j</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CustomerWebClient</span> <span class="token punctuation">{<!-- --></span>

	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">CustomerWebClient</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CustomerWebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * 限制并发数 100
	 */</span>
	<span class="token class-name">Scheduler</span> customScheduler <span class="token operator">=</span> <span class="token class-name">Schedulers</span><span class="token punctuation">.</span><span class="token function">newParallel</span><span class="token punctuation">(</span><span class="token string">"CustomScheduler"</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">WebClient</span> webClient<span class="token punctuation">;</span>

	<span class="token keyword">private</span> <span class="token class-name">CustomerWebClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

		<span class="token keyword">final</span> <span class="token class-name">SslContextBuilder</span> sslBuilder <span class="token operator">=</span> <span class="token class-name">SslContextBuilder</span><span class="token punctuation">.</span><span class="token function">forClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">trustManager</span><span class="token punctuation">(</span><span class="token class-name">InsecureTrustManagerFactory</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">final</span> <span class="token class-name">SslProvider</span> ssl <span class="token operator">=</span> <span class="token class-name">SslProvider</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">sslContext</span><span class="token punctuation">(</span>sslBuilder<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">defaultConfiguration</span><span class="token punctuation">(</span><span class="token class-name">SslProvider<span class="token punctuation">.</span>DefaultConfigurationType</span><span class="token punctuation">.</span><span class="token constant">TCP</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">final</span> <span class="token keyword">int</span> cpuCores <span class="token operator">=</span> <span class="token class-name">Runtime</span><span class="token punctuation">.</span><span class="token function">getRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">availableProcessors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> selectorCount <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>cpuCores <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token keyword">int</span> workerCount <span class="token operator">=</span> <span class="token class-name">Math</span><span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span>cpuCores <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token class-name">LoopResources</span> pool <span class="token operator">=</span> <span class="token class-name">LoopResources</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"HCofSWC"</span><span class="token punctuation">,</span> selectorCount<span class="token punctuation">,</span> workerCount<span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">final</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">super</span> <span class="token class-name">TcpClient</span><span class="token punctuation">,</span> <span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">TcpClient</span><span class="token punctuation">&gt;</span></span> tcpMapper <span class="token operator">=</span> tcp <span class="token operator">-&gt;</span> tcp
				<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">TCP_NODELAY</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">CONNECT_TIMEOUT_MILLIS</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">option</span><span class="token punctuation">(</span><span class="token class-name">ChannelOption</span><span class="token punctuation">.</span><span class="token constant">SO_TIMEOUT</span><span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">secure</span><span class="token punctuation">(</span>ssl<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">runOn</span><span class="token punctuation">(</span>pool<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token class-name">ConnectionProvider<span class="token punctuation">.</span>Builder</span> httpClientOfSWC <span class="token operator">=</span> <span class="token class-name">ConnectionProvider</span>
				<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token string">"HttpClientOfSWC"</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">maxConnections</span><span class="token punctuation">(</span><span class="token number">100_000</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">pendingAcquireTimeout</span><span class="token punctuation">(</span><span class="token class-name">Duration</span><span class="token punctuation">.</span><span class="token function">ofSeconds</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">final</span> <span class="token class-name">ConnectionProvider</span> connectionProvider <span class="token operator">=</span> httpClientOfSWC<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">final</span> <span class="token class-name">HttpClient</span> hc <span class="token operator">=</span> <span class="token class-name">HttpClient</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>connectionProvider<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">tcpConfiguration</span><span class="token punctuation">(</span>tcpMapper<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">final</span> <span class="token class-name">Function</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">HttpClient</span><span class="token punctuation">,</span> <span class="token class-name">HttpClient</span><span class="token punctuation">&gt;</span></span> hcMapper <span class="token operator">=</span> rhc <span class="token operator">-&gt;</span> rhc
				<span class="token punctuation">.</span><span class="token function">compress</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">final</span> <span class="token class-name">WebClient<span class="token punctuation">.</span>Builder</span> wcb <span class="token operator">=</span> <span class="token class-name">WebClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">clientConnector</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ReactorClientHttpConnector</span><span class="token punctuation">(</span>hcMapper<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>hc<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//				.filter(new TraceRequestFilter()); 可以通过Filter 增加trace追踪</span>

		<span class="token keyword">this</span><span class="token punctuation">.</span>webClient <span class="token operator">=</span> wcb<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">onStatus</span><span class="token punctuation">(</span><span class="token class-name">HttpStatus</span><span class="token operator">::</span><span class="token function">isError</span><span class="token punctuation">,</span> response <span class="token operator">-&gt;</span> <span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">"Request failed with status code: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">statusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>response<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"get.success, url={}, response={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"get.param.error, url={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">onErrorReturn</span><span class="token punctuation">(</span>defaultClass<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doFinally</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">publishOn</span><span class="token punctuation">(</span>customScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">getParam</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">MultiValueMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> param<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">URI</span> uri <span class="token operator">=</span> <span class="token class-name">UriComponentsBuilder</span><span class="token punctuation">.</span><span class="token function">fromUriString</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">queryParams</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">toUri</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token keyword">return</span> webClient<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>uri<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>response<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"get.param.success, url={}, response={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
					log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"get.param.error, url={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">onErrorReturn</span><span class="token punctuation">(</span>defaultClass<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doFinally</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">publishOn</span><span class="token punctuation">(</span>customScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>



	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">postJson</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token keyword">final</span> <span class="token class-name">HttpParameter4Json</span> parameter<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">final</span> <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> webClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">cookies</span><span class="token punctuation">(</span>cookies <span class="token operator">-&gt;</span> cookies<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">Mono</span><span class="token punctuation">.</span><span class="token function">just</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getJsonBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token class-name">ParameterizedTypeReference</span><span class="token punctuation">.</span><span class="token function">forType</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getBodyType</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span>headers <span class="token operator">-&gt;</span> headers<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>response<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"post.json.success, url={}, response={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">,</span> parameter<span class="token punctuation">.</span><span class="token function">getJsonBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
					log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"get.param.error, url={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> parameter<span class="token punctuation">.</span><span class="token function">getJsonBody</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">onErrorReturn</span><span class="token punctuation">(</span>defaultClass<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doFinally</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">publishOn</span><span class="token punctuation">(</span>customScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>


	<span class="token keyword">public</span> <span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token class-name">Mono</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token function">postFormData</span><span class="token punctuation">(</span><span class="token class-name">String</span> url<span class="token punctuation">,</span> <span class="token class-name">HttpParameter</span> parameter<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">,</span> <span class="token class-name">T</span> defaultClass<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">final</span> <span class="token keyword">long</span> start <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> webClient<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">contentType</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_FORM_URLENCODED</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">cookies</span><span class="token punctuation">(</span>cookies <span class="token operator">-&gt;</span> cookies<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getCookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token class-name">BodyInserters</span><span class="token punctuation">.</span><span class="token function">fromFormData</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getMultiValueMapParam</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">headers</span><span class="token punctuation">(</span>headers <span class="token operator">-&gt;</span> headers<span class="token punctuation">.</span><span class="token function">setAll</span><span class="token punctuation">(</span>parameter<span class="token punctuation">.</span><span class="token function">getMapHeaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token class-name">MediaType</span><span class="token punctuation">.</span><span class="token constant">APPLICATION_JSON</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">retrieve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">bodyToMono</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doOnSuccess</span><span class="token punctuation">(</span>response<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"post.fromData.success, url={}, response={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> response<span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doOnError</span><span class="token punctuation">(</span>error<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
					log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"get.param.error, url={}, param={}"</span><span class="token punctuation">,</span> url<span class="token punctuation">,</span> <span class="token class-name">JsonUtil</span><span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">onErrorReturn</span><span class="token punctuation">(</span>defaultClass<span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">doFinally</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
				<span class="token punctuation">}</span><span class="token punctuation">)</span>
				<span class="token punctuation">.</span><span class="token function">publishOn</span><span class="token punctuation">(</span>customScheduler<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dd43ebf8256ec229164ca5a331218f91/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【附源码】六个Python表白小代码，送给心爱的她，让她高兴一整天~</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1d37b1cffbdf6821e96b9ecd5068b293/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【STM32】串口通信乱码（认识系统时钟来源）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>