<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ç«èµ›é€‰é¢˜ é¢˜ç›®ï¼šåŸºäºLSTMçš„é¢„æµ‹ç®—æ³• - è‚¡ç¥¨é¢„æµ‹ å¤©æ°”é¢„æµ‹ æˆ¿ä»·é¢„æµ‹ - ITå­¦ä¹ è€…åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ç«èµ›é€‰é¢˜ é¢˜ç›®ï¼šåŸºäºLSTMçš„é¢„æµ‹ç®—æ³• - è‚¡ç¥¨é¢„æµ‹ å¤©æ°”é¢„æµ‹ æˆ¿ä»·é¢„æµ‹" />
<meta property="og:description" content="æ–‡ç« ç›®å½• 0 ç®€ä»‹1 åŸºäº Keras ç”¨ LSTM ç½‘ç»œåšæ—¶é—´åºåˆ—é¢„æµ‹2 é•¿çŸ­è®°å¿†ç½‘ç»œ3 LSTM ç½‘ç»œç»“æ„å’ŒåŸç†3.1 LSTMæ ¸å¿ƒæ€æƒ³3.2 é—å¿˜é—¨3.3 è¾“å…¥é—¨3.4 è¾“å‡ºé—¨ 4 åŸºäºLSTMçš„å¤©æ°”é¢„æµ‹4.1 æ•°æ®é›†4.2 é¢„æµ‹ç¤ºä¾‹ 5 åŸºäºLSTMçš„è‚¡ç¥¨ä»·æ ¼é¢„æµ‹5.1 æ•°æ®é›†5.2 å®ç°ä»£ç  6 lstm é¢„æµ‹èˆªç©ºæ—…å®¢æ•°ç›®æ•°æ®é›†é¢„æµ‹ä»£ç  7 æœ€å 0 ç®€ä»‹ ğŸ”¥ ä¼˜è´¨ç«èµ›é¡¹ç›®ç³»åˆ—ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯
åŸºäºLSTMçš„é¢„æµ‹ç®—æ³• - è‚¡ç¥¨é¢„æµ‹ å¤©æ°”é¢„æµ‹ æˆ¿ä»·é¢„æµ‹
è¯¥é¡¹ç›®è¾ƒä¸ºæ–°é¢–ï¼Œé€‚åˆä½œä¸ºç«èµ›è¯¾é¢˜æ–¹å‘ï¼Œå­¦é•¿éå¸¸æ¨èï¼
ğŸ§¿ æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š
https://gitee.com/dancheng-senior/postgraduate
1 åŸºäº Keras ç”¨ LSTM ç½‘ç»œåšæ—¶é—´åºåˆ—é¢„æµ‹ æ—¶é—´åºåˆ—é¢„æµ‹æ˜¯ä¸€ç±»æ¯”è¾ƒå›°éš¾çš„é¢„æµ‹é—®é¢˜ã€‚
ä¸å¸¸è§çš„å›å½’é¢„æµ‹æ¨¡å‹ä¸åŒï¼Œè¾“å…¥å˜é‡ä¹‹é—´çš„â€œåºåˆ—ä¾èµ–æ€§â€ä¸ºæ—¶é—´åºåˆ—é—®é¢˜å¢åŠ äº†å¤æ‚åº¦ã€‚
ä¸€ç§èƒ½å¤Ÿä¸“é—¨ç”¨æ¥å¤„ç†åºåˆ—ä¾èµ–æ€§çš„ç¥ç»ç½‘ç»œè¢«ç§°ä¸º é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural
Networksã€RNNï¼‰ã€‚å› å…¶è®­ç»ƒæ—¶çš„å‡ºè‰²æ€§èƒ½ï¼Œé•¿çŸ­è®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memory
Networkï¼ŒLSTMï¼‰æ˜¯æ·±åº¦å­¦ä¹ ä¸­å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ã€‚
åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œå°†ä»‹ç»å¦‚ä½•åœ¨ R ä¸­ä½¿ç”¨ keras æ·±åº¦å­¦ä¹ åŒ…æ„å»º LSTM ç¥ç»ç½‘ç»œæ¨¡å‹å®ç°æ—¶é—´åºåˆ—é¢„æµ‹ã€‚
å¦‚ä½•ä¸ºåŸºäºå›å½’ã€çª—å£æ³•å’Œæ—¶é—´æ­¥çš„æ—¶é—´åºåˆ—é¢„æµ‹é—®é¢˜å»ºç«‹å¯¹åº”çš„ LSTM ç½‘ç»œã€‚å¯¹äºéå¸¸é•¿çš„åºåˆ—ï¼Œå¦‚ä½•åœ¨æ„å»º LSTM ç½‘ç»œå’Œç”¨ LSTM ç½‘ç»œåšé¢„æµ‹æ—¶ä¿æŒç½‘ç»œå…³äºåºåˆ—çš„çŠ¶æ€ï¼ˆè®°å¿†ï¼‰ã€‚ 2 é•¿çŸ­è®°å¿†ç½‘ç»œ é•¿çŸ­è®°å¿†ç½‘ç»œï¼Œæˆ– LSTM ç½‘ç»œï¼Œæ˜¯ä¸€ç§é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ï¼Œé€šè¿‡è®­ç»ƒæ—¶åœ¨â€œæ—¶é—´ä¸Šçš„åå‘ä¼ æ’­â€æ¥å…‹æœæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/23b3aa53dbfe6168fa7ece21f9267284/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-24T17:37:41+08:00" />
<meta property="article:modified_time" content="2023-11-24T17:37:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ITå­¦ä¹ è€…åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ITå­¦ä¹ è€…åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ç«èµ›é€‰é¢˜ é¢˜ç›®ï¼šåŸºäºLSTMçš„é¢„æµ‹ç®—æ³• - è‚¡ç¥¨é¢„æµ‹ å¤©æ°”é¢„æµ‹ æˆ¿ä»·é¢„æµ‹</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#0__2" rel="nofollow">0 ç®€ä»‹</a></li><li><a href="#1__Keras__LSTM__15" rel="nofollow">1 åŸºäº Keras ç”¨ LSTM ç½‘ç»œåšæ—¶é—´åºåˆ—é¢„æµ‹</a></li><li><a href="#2__30" rel="nofollow">2 é•¿çŸ­è®°å¿†ç½‘ç»œ</a></li><li><a href="#3_LSTM__49" rel="nofollow">3 LSTM ç½‘ç»œç»“æ„å’ŒåŸç†</a></li><li><ul><li><a href="#31_LSTM_66" rel="nofollow">3.1 LSTMæ ¸å¿ƒæ€æƒ³</a></li><li><a href="#32__81" rel="nofollow">3.2 é—å¿˜é—¨</a></li><li><a href="#33__99" rel="nofollow">3.3 è¾“å…¥é—¨</a></li><li><a href="#34__106" rel="nofollow">3.4 è¾“å‡ºé—¨</a></li></ul> 
  </li><li><a href="#4_LSTM_116" rel="nofollow">4 åŸºäºLSTMçš„å¤©æ°”é¢„æµ‹</a></li><li><ul><li><a href="#41__118" rel="nofollow">4.1 æ•°æ®é›†</a></li><li><a href="#42__131" rel="nofollow">4.2 é¢„æµ‹ç¤ºä¾‹</a></li></ul> 
  </li><li><a href="#5_LSTM_224" rel="nofollow">5 åŸºäºLSTMçš„è‚¡ç¥¨ä»·æ ¼é¢„æµ‹</a></li><li><ul><li><a href="#51__226" rel="nofollow">5.1 æ•°æ®é›†</a></li><li><a href="#52__232" rel="nofollow">5.2 å®ç°ä»£ç </a></li></ul> 
  </li><li><a href="#6_lstm__305" rel="nofollow">6 lstm é¢„æµ‹èˆªç©ºæ—…å®¢æ•°ç›®</a></li><li><ul><li><a href="#_307" rel="nofollow">æ•°æ®é›†</a></li><li><a href="#_318" rel="nofollow">é¢„æµ‹ä»£ç </a></li></ul> 
  </li><li><a href="#7__433" rel="nofollow">7 æœ€å</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0__2"></a>0 ç®€ä»‹</h2> 
<p>ğŸ”¥ ä¼˜è´¨ç«èµ›é¡¹ç›®ç³»åˆ—ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯</p> 
<p><strong>åŸºäºLSTMçš„é¢„æµ‹ç®—æ³• - è‚¡ç¥¨é¢„æµ‹ å¤©æ°”é¢„æµ‹ æˆ¿ä»·é¢„æµ‹</strong></p> 
<p>è¯¥é¡¹ç›®è¾ƒä¸ºæ–°é¢–ï¼Œé€‚åˆä½œä¸ºç«èµ›è¯¾é¢˜æ–¹å‘ï¼Œå­¦é•¿éå¸¸æ¨èï¼</p> 
<p>ğŸ§¿ <strong>æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p> 
<h2><a id="1__Keras__LSTM__15"></a>1 åŸºäº Keras ç”¨ LSTM ç½‘ç»œåšæ—¶é—´åºåˆ—é¢„æµ‹</h2> 
<p>æ—¶é—´åºåˆ—é¢„æµ‹æ˜¯ä¸€ç±»æ¯”è¾ƒå›°éš¾çš„é¢„æµ‹é—®é¢˜ã€‚</p> 
<p>ä¸å¸¸è§çš„å›å½’é¢„æµ‹æ¨¡å‹ä¸åŒï¼Œè¾“å…¥å˜é‡ä¹‹é—´çš„â€œåºåˆ—ä¾èµ–æ€§â€ä¸ºæ—¶é—´åºåˆ—é—®é¢˜å¢åŠ äº†å¤æ‚åº¦ã€‚</p> 
<p>ä¸€ç§èƒ½å¤Ÿä¸“é—¨ç”¨æ¥å¤„ç†åºåˆ—ä¾èµ–æ€§çš„ç¥ç»ç½‘ç»œè¢«ç§°ä¸º é€’å½’ç¥ç»ç½‘ç»œï¼ˆRecurrent Neural<br> Networksã€RNNï¼‰ã€‚å› å…¶è®­ç»ƒæ—¶çš„å‡ºè‰²æ€§èƒ½ï¼Œé•¿çŸ­è®°å¿†ç½‘ç»œï¼ˆLong Short-Term Memory<br> Networkï¼ŒLSTMï¼‰æ˜¯æ·±åº¦å­¦ä¹ ä¸­å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ã€‚</p> 
<p>åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œå°†ä»‹ç»å¦‚ä½•åœ¨ R ä¸­ä½¿ç”¨ keras æ·±åº¦å­¦ä¹ åŒ…æ„å»º LSTM ç¥ç»ç½‘ç»œæ¨¡å‹å®ç°æ—¶é—´åºåˆ—é¢„æµ‹ã€‚</p> 
<ul><li>å¦‚ä½•ä¸ºåŸºäºå›å½’ã€çª—å£æ³•å’Œæ—¶é—´æ­¥çš„æ—¶é—´åºåˆ—é¢„æµ‹é—®é¢˜å»ºç«‹å¯¹åº”çš„ LSTM ç½‘ç»œã€‚</li><li>å¯¹äºéå¸¸é•¿çš„åºåˆ—ï¼Œå¦‚ä½•åœ¨æ„å»º LSTM ç½‘ç»œå’Œç”¨ LSTM ç½‘ç»œåšé¢„æµ‹æ—¶ä¿æŒç½‘ç»œå…³äºåºåˆ—çš„çŠ¶æ€ï¼ˆè®°å¿†ï¼‰ã€‚</li></ul> 
<h2><a id="2__30"></a>2 é•¿çŸ­è®°å¿†ç½‘ç»œ</h2> 
<p>é•¿çŸ­è®°å¿†ç½‘ç»œï¼Œæˆ– LSTM ç½‘ç»œï¼Œæ˜¯ä¸€ç§é€’å½’ç¥ç»ç½‘ç»œï¼ˆRNNï¼‰ï¼Œé€šè¿‡è®­ç»ƒæ—¶åœ¨â€œæ—¶é—´ä¸Šçš„åå‘ä¼ æ’­â€æ¥å…‹æœæ¢¯åº¦æ¶ˆå¤±é—®é¢˜ã€‚</p> 
<p>LSTM ç½‘ç»œå¯ä»¥ç”¨æ¥æ„å»ºå¤§è§„æ¨¡çš„é€’å½’ç¥ç»ç½‘ç»œæ¥å¤„ç†æœºå™¨å­¦ä¹ ä¸­å¤æ‚çš„åºåˆ—é—®é¢˜ï¼Œå¹¶å–å¾—ä¸é”™çš„ç»“æœã€‚</p> 
<p>é™¤äº†ç¥ç»å…ƒä¹‹å¤–ï¼ŒLSTM ç½‘ç»œåœ¨ç¥ç»ç½‘ç»œå±‚çº§ï¼ˆlayersï¼‰ä¹‹é—´è¿˜å­˜åœ¨è®°å¿†æ¨¡å—ã€‚</p> 
<p>ä¸€ä¸ªè®°å¿†æ¨¡å—å…·æœ‰ç‰¹æ®Šçš„æ„æˆï¼Œä½¿å®ƒæ¯”ä¼ ç»Ÿçš„ç¥ç»å…ƒæ›´â€œèªæ˜â€ï¼Œå¹¶ä¸”å¯ä»¥å¯¹åºåˆ—ä¸­çš„å‰åéƒ¨åˆ†äº§ç”Ÿè®°å¿†ã€‚æ¨¡å—å…·æœ‰ä¸åŒçš„â€œé—¨â€ï¼ˆgatesï¼‰æ¥æ§åˆ¶æ¨¡å—çš„çŠ¶æ€å’Œè¾“å‡ºã€‚ä¸€æ—¦æ¥æ”¶å¹¶å¤„ç†ä¸€ä¸ªè¾“å…¥åºåˆ—ï¼Œæ¨¡å—ä¸­çš„å„ä¸ªé—¨ä¾¿ä½¿ç”¨<br> S å‹çš„æ¿€æ´»å•å…ƒæ¥æ§åˆ¶è‡ªèº«æ˜¯å¦è¢«æ¿€æ´»ï¼Œä»è€Œæ”¹å˜æ¨¡å—çŠ¶æ€å¹¶å‘æ¨¡å—æ·»åŠ ä¿¡æ¯ï¼ˆè®°å¿†ï¼‰ã€‚</p> 
<p>ä¸€ä¸ªæ¿€æ´»å•å…ƒæœ‰ä¸‰ç§é—¨ï¼š</p> 
<ul><li>é—å¿˜é—¨ï¼ˆForget Gateï¼‰ï¼šå†³å®šæŠ›å¼ƒå“ªäº›ä¿¡æ¯ã€‚</li><li>è¾“å…¥é—¨ï¼ˆInput Gateï¼‰ï¼šå†³å®šè¾“å…¥ä¸­çš„å“ªäº›å€¼ç”¨æ¥æ›´æ–°è®°å¿†çŠ¶æ€ã€‚</li><li>è¾“å‡ºé—¨ï¼ˆOutput Gateï¼‰ï¼šæ ¹æ®è¾“å…¥å’Œè®°å¿†çŠ¶æ€å†³å®šè¾“å‡ºçš„å€¼ã€‚</li></ul> 
<p>æ¯ä¸€ä¸ªæ¿€æ´»å•å…ƒå°±åƒæ˜¯ä¸€ä¸ªè¿·ä½ çŠ¶æ€æœºï¼Œå•å…ƒä¸­å„ä¸ªé—¨çš„æƒé‡é€šè¿‡è®­ç»ƒè·å¾—ã€‚</p> 
<h2><a id="3_LSTM__49"></a>3 LSTM ç½‘ç»œç»“æ„å’ŒåŸç†</h2> 
<p>long short term memoryï¼Œå³æˆ‘ä»¬æ‰€ç§°å‘¼çš„LSTMï¼Œæ˜¯ä¸ºäº†è§£å†³é•¿æœŸä»¥æ¥é—®é¢˜è€Œä¸“é—¨è®¾è®¡å‡ºæ¥çš„ï¼Œæ‰€æœ‰çš„RNNéƒ½å…·æœ‰ä¸€ç§é‡å¤ç¥</p> 
<p><img src="https://images2.imgbox.com/66/da/FAWXkMZ4_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>LSTM åŒæ ·æ˜¯è¿™æ ·çš„ç»“æ„ï¼Œä½†æ˜¯é‡å¤çš„æ¨¡å—æ‹¥æœ‰ä¸€ä¸ªä¸åŒçš„ç»“æ„ã€‚ä¸åŒäºå•ä¸€ç¥ç»ç½‘ç»œå±‚ï¼Œè¿™é‡Œæ˜¯æœ‰å››ä¸ªï¼Œä»¥ä¸€ç§éå¸¸ç‰¹æ®Šçš„æ–¹å¼è¿›è¡Œäº¤äº’ã€‚</p> 
<p><img src="https://images2.imgbox.com/1e/63/VvS3D7cQ_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ä¸å¿…æ‹…å¿ƒè¿™é‡Œçš„ç»†èŠ‚ã€‚æˆ‘ä»¬ä¼šä¸€æ­¥ä¸€æ­¥åœ°å‰–æ LSTM è§£æå›¾ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å…ˆæ¥ç†Ÿæ‚‰ä¸€ä¸‹å›¾ä¸­ä½¿ç”¨çš„å„ç§å…ƒç´ çš„å›¾æ ‡ã€‚</p> 
<p><img src="https://images2.imgbox.com/14/92/hoKFSqTa_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>åœ¨ä¸Šé¢çš„å›¾ä¾‹ä¸­ï¼Œæ¯ä¸€æ¡é»‘çº¿ä¼ è¾“ç€ä¸€æ•´ä¸ªå‘é‡ï¼Œä»ä¸€ä¸ªèŠ‚ç‚¹çš„è¾“å‡ºåˆ°å…¶ä»–èŠ‚ç‚¹çš„è¾“å…¥ã€‚ç²‰è‰²çš„åœˆä»£è¡¨ pointwise<br> çš„æ“ä½œï¼Œè¯¸å¦‚å‘é‡çš„å’Œï¼Œè€Œé»„è‰²çš„çŸ©é˜µå°±æ˜¯å­¦ä¹ åˆ°çš„ç¥ç»ç½‘ç»œå±‚ã€‚åˆåœ¨ä¸€èµ·çš„çº¿è¡¨ç¤ºå‘é‡çš„è¿æ¥ï¼Œåˆ†å¼€çš„çº¿è¡¨ç¤ºå†…å®¹è¢«å¤åˆ¶ï¼Œç„¶ååˆ†å‘åˆ°ä¸åŒçš„ä½ç½®ã€‚</p> 
<h3><a id="31_LSTM_66"></a>3.1 LSTMæ ¸å¿ƒæ€æƒ³</h3> 
<p>LSTMçš„å…³é”®åœ¨äºç»†èƒçš„çŠ¶æ€æ•´ä¸ª(å¦‚ä¸‹å›¾)ï¼Œå’Œç©¿è¿‡ç»†èƒçš„é‚£æ¡æ°´å¹³çº¿ã€‚</p> 
<p>ç»†èƒçŠ¶æ€ç±»ä¼¼äºä¼ é€å¸¦ã€‚ç›´æ¥åœ¨æ•´ä¸ªé“¾ä¸Šè¿è¡Œï¼Œåªæœ‰ä¸€äº›å°‘é‡çš„çº¿æ€§äº¤äº’ã€‚ä¿¡æ¯åœ¨ä¸Šé¢æµä¼ ä¿æŒä¸å˜ä¼šå¾ˆå®¹æ˜“ã€‚</p> 
<p><img src="https://images2.imgbox.com/e8/fc/Uzj8ZOMg_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> é—¨å¯ä»¥å®ç°é€‰æ‹©æ€§åœ°è®©ä¿¡æ¯é€šè¿‡ï¼Œä¸»è¦æ˜¯é€šè¿‡ä¸€ä¸ª sigmoid çš„ç¥ç»å±‚ å’Œä¸€ä¸ªé€ç‚¹ç›¸ä¹˜çš„æ“ä½œæ¥å®ç°çš„ã€‚</p> 
<p><img src="https://images2.imgbox.com/21/39/DiB42PxL_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> sigmoid å±‚è¾“å‡ºï¼ˆæ˜¯ä¸€ä¸ªå‘é‡ï¼‰çš„æ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªåœ¨ 0 å’Œ 1 ä¹‹é—´çš„å®æ•°ï¼Œè¡¨ç¤ºè®©å¯¹åº”ä¿¡æ¯é€šè¿‡çš„æƒé‡ï¼ˆæˆ–è€…å æ¯”ï¼‰ã€‚æ¯”å¦‚ï¼Œ 0<br> è¡¨ç¤ºâ€œä¸è®©ä»»ä½•ä¿¡æ¯é€šè¿‡â€ï¼Œ 1 è¡¨ç¤ºâ€œè®©æ‰€æœ‰ä¿¡æ¯é€šè¿‡â€ã€‚</p> 
<p>LSTMé€šè¿‡ä¸‰ä¸ªè¿™æ ·çš„æœ¬ç»“æ„æ¥å®ç°ä¿¡æ¯çš„ä¿æŠ¤å’Œæ§åˆ¶ã€‚è¿™ä¸‰ä¸ªé—¨åˆ†åˆ«è¾“å…¥é—¨ã€é—å¿˜é—¨å’Œè¾“å‡ºé—¨ã€‚</p> 
<h3><a id="32__81"></a>3.2 é—å¿˜é—¨</h3> 
<p>åœ¨æˆ‘ä»¬ LSTM ä¸­çš„ç¬¬ä¸€æ­¥æ˜¯å†³å®šæˆ‘ä»¬ä¼šä»ç»†èƒçŠ¶æ€ä¸­ä¸¢å¼ƒä»€ä¹ˆä¿¡æ¯ã€‚è¿™ä¸ªå†³å®šé€šè¿‡ä¸€ä¸ªç§°ä¸ºå¿˜è®°é—¨å±‚å®Œæˆã€‚è¯¥é—¨ä¼šè¯»å–å’Œï¼Œè¾“å‡ºä¸€ä¸ªåœ¨ 0åˆ°<br> 1ä¹‹é—´çš„æ•°å€¼ç»™æ¯ä¸ªåœ¨ç»†èƒçŠ¶æ€ä¸­çš„æ•°å­—ã€‚1 è¡¨ç¤ºâ€œå®Œå…¨ä¿ç•™â€ï¼Œ0 è¡¨ç¤ºâ€œå®Œå…¨èˆå¼ƒâ€ã€‚</p> 
<p>è®©æˆ‘ä»¬å›åˆ°è¯­è¨€æ¨¡å‹çš„ä¾‹å­ä¸­æ¥åŸºäºå·²ç»çœ‹åˆ°çš„é¢„æµ‹ä¸‹ä¸€ä¸ªè¯ã€‚åœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œç»†èƒçŠ¶æ€å¯èƒ½åŒ…å«å½“å‰ä¸»è¯­çš„æ€§åˆ«ï¼Œå› æ­¤æ­£ç¡®çš„ä»£è¯å¯ä»¥è¢«é€‰æ‹©å‡ºæ¥ã€‚å½“æˆ‘ä»¬çœ‹åˆ°æ–°çš„ä¸»è¯­ï¼Œæˆ‘ä»¬å¸Œæœ›å¿˜è®°æ—§çš„ä¸»è¯­ã€‚</p> 
<p><img src="https://images2.imgbox.com/54/1e/BpXjmuYt_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> å…¶ä¸­</p> 
<p><img src="https://images2.imgbox.com/78/45/dB3rdemb_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è¡¨ç¤ºçš„æ˜¯ ä¸Šä¸€æ—¶åˆ»éšå«å±‚çš„ è¾“å‡ºï¼Œ</p> 
<p><img src="https://images2.imgbox.com/2b/b8/6wwnqXTb_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è¡¨ç¤ºçš„æ˜¯å½“å‰ç»†èƒçš„è¾“å…¥ã€‚Ïƒè¡¨ç¤ºsigmodå‡½æ•°ã€‚</p> 
<h3><a id="33__99"></a>3.3 è¾“å…¥é—¨</h3> 
<p>ä¸‹ä¸€æ­¥æ˜¯å†³å®šè®©å¤šå°‘æ–°çš„ä¿¡æ¯åŠ å…¥åˆ° cell çŠ¶æ€ ä¸­æ¥ã€‚å®ç°è¿™ä¸ªéœ€è¦åŒ…æ‹¬ä¸¤ä¸ªæ­¥éª¤ï¼šé¦–å…ˆï¼Œä¸€ä¸ªå«åšâ€œinput gate layer â€çš„ sigmoid<br> å±‚å†³å®šå“ªäº›ä¿¡æ¯éœ€è¦æ›´æ–°ï¼›ä¸€ä¸ª tanh å±‚ç”Ÿæˆä¸€ä¸ªå‘é‡ï¼Œä¹Ÿå°±æ˜¯å¤‡é€‰çš„ç”¨æ¥æ›´æ–°çš„å†…å®¹ã€‚åœ¨ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸¤éƒ¨åˆ†è”åˆèµ·æ¥ï¼Œå¯¹ cell çš„çŠ¶æ€è¿›è¡Œä¸€ä¸ªæ›´æ–°ã€‚</p> 
<p><img src="https://images2.imgbox.com/95/bc/i2sMB99o_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="34__106"></a>3.4 è¾“å‡ºé—¨</h3> 
<p>æœ€ç»ˆï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šè¾“å‡ºä»€ä¹ˆå€¼ã€‚è¿™ä¸ªè¾“å‡ºå°†ä¼šåŸºäºæˆ‘ä»¬çš„ç»†èƒçŠ¶æ€ï¼Œä½†æ˜¯ä¹Ÿæ˜¯ä¸€ä¸ªè¿‡æ»¤åçš„ç‰ˆæœ¬ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸ª sigmoid<br> å±‚æ¥ç¡®å®šç»†èƒçŠ¶æ€çš„å“ªä¸ªéƒ¨åˆ†å°†è¾“å‡ºå‡ºå»ã€‚æ¥ç€ï¼Œæˆ‘ä»¬æŠŠç»†èƒçŠ¶æ€é€šè¿‡ tanh è¿›è¡Œå¤„ç†ï¼ˆå¾—åˆ°ä¸€ä¸ªåœ¨ -1 åˆ° 1 ä¹‹é—´çš„å€¼ï¼‰å¹¶å°†å®ƒå’Œ sigmoid<br> é—¨çš„è¾“å‡ºç›¸ä¹˜ï¼Œæœ€ç»ˆæˆ‘ä»¬ä»…ä»…ä¼šè¾“å‡ºæˆ‘ä»¬ç¡®å®šè¾“å‡ºçš„é‚£éƒ¨åˆ†ã€‚</p> 
<p>åœ¨è¯­è¨€æ¨¡å‹çš„ä¾‹å­ä¸­ï¼Œå› ä¸ºä»–å°±çœ‹åˆ°äº†ä¸€ä¸ªä»£è¯ï¼Œå¯èƒ½éœ€è¦è¾“å‡ºä¸ä¸€ä¸ªåŠ¨è¯ç›¸å…³çš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯èƒ½è¾“å‡ºæ˜¯å¦ä»£è¯æ˜¯å•æ•°è¿˜æ˜¯è´Ÿæ•°ï¼Œè¿™æ ·å¦‚æœæ˜¯åŠ¨è¯çš„è¯ï¼Œæˆ‘ä»¬ä¹ŸçŸ¥é“åŠ¨è¯éœ€è¦è¿›è¡Œçš„è¯å½¢å˜åŒ–ã€‚</p> 
<p><img src="https://images2.imgbox.com/54/62/FvjnTGxs_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="4_LSTM_116"></a>4 åŸºäºLSTMçš„å¤©æ°”é¢„æµ‹</h2> 
<h3><a id="41__118"></a>4.1 æ•°æ®é›†</h3> 
<p><img src="https://images2.imgbox.com/61/b3/1qbssagF_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæ¯10åˆ†é’Ÿè®°å½•ä¸€æ¬¡è§‚æµ‹å€¼ï¼Œä¸€ä¸ªå°æ—¶å†…æœ‰6ä¸ªè§‚æµ‹å€¼ï¼Œä¸€å¤©æœ‰144ï¼ˆ6x24ï¼‰ä¸ªè§‚æµ‹å€¼ã€‚</p> 
<p>ç»™å®šä¸€ä¸ªç‰¹å®šçš„æ—¶é—´ï¼Œå‡è®¾è¦é¢„æµ‹æœªæ¥6å°æ—¶çš„æ¸©åº¦ã€‚ä¸ºäº†åšå‡ºæ­¤é¢„æµ‹ï¼Œé€‰æ‹©ä½¿ç”¨5å¤©çš„è§‚å¯Ÿæ—¶é—´ã€‚å› æ­¤ï¼Œåˆ›å»ºä¸€ä¸ªåŒ…å«æœ€å720ï¼ˆ5x144ï¼‰ä¸ªè§‚æµ‹å€¼çš„çª—å£ä»¥è®­ç»ƒæ¨¡å‹ã€‚</p> 
<p>ä¸‹é¢çš„å‡½æ•°è¿”å›ä¸Šè¿°æ—¶é—´çª—ä»¥ä¾›æ¨¡å‹è®­ç»ƒã€‚å‚æ•° history_size æ˜¯è¿‡å»ä¿¡æ¯çš„æ»‘åŠ¨çª—å£å¤§å°ã€‚target_size<br> æ˜¯æ¨¡å‹éœ€è¦å­¦ä¹ é¢„æµ‹çš„æœªæ¥æ—¶é—´æ­¥ï¼Œä¹Ÿä½œä¸ºéœ€è¦è¢«é¢„æµ‹çš„æ ‡ç­¾ã€‚</p> 
<p>ä¸‹é¢ä½¿ç”¨æ•°æ®çš„å‰300,000è¡Œå½“åšè®­ç»ƒæ•°æ®é›†ï¼Œå…¶ä½™çš„ä½œä¸ºéªŒè¯æ•°æ®é›†ã€‚æ€»è®¡çº¦2100å¤©çš„è®­ç»ƒæ•°æ®ã€‚</p> 
<h3><a id="42__131"></a>4.2 é¢„æµ‹ç¤ºä¾‹</h3> 
<p>å¤šæ­¥éª¤é¢„æµ‹æ¨¡å‹ä¸­ï¼Œç»™å®šè¿‡å»çš„é‡‡æ ·å€¼ï¼Œé¢„æµ‹æœªæ¥ä¸€ç³»åˆ—çš„å€¼ã€‚å¯¹äºå¤šæ­¥éª¤æ¨¡å‹ï¼Œè®­ç»ƒæ•°æ®å†æ¬¡åŒ…æ‹¬æ¯å°æ—¶é‡‡æ ·çš„è¿‡å»äº”å¤©çš„è®°å½•ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œçš„æ¨¡å‹éœ€è¦å­¦ä¹ é¢„æµ‹æ¥ä¸‹æ¥12å°æ—¶çš„æ¸©åº¦ã€‚ç”±äºæ¯10åˆ†é’Ÿé‡‡æ ·ä¸€æ¬¡æ•°æ®ï¼Œå› æ­¤è¾“å‡ºä¸º72ä¸ªé¢„æµ‹å€¼ã€‚</p> 
<p>â€‹</p> 
<pre><code class="prism language-python">future_target <span class="token operator">=</span> <span class="token number">72</span>
x_train_multi<span class="token punctuation">,</span> y_train_multi <span class="token operator">=</span> multivariate_data<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> dataset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span>
                                                 TRAIN_SPLIT<span class="token punctuation">,</span> past_history<span class="token punctuation">,</span>
                                                 future_target<span class="token punctuation">,</span> STEP<span class="token punctuation">)</span>
x_val_multi<span class="token punctuation">,</span> y_val_multi <span class="token operator">=</span> multivariate_data<span class="token punctuation">(</span>dataset<span class="token punctuation">,</span> dataset<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                             TRAIN_SPLIT<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> past_history<span class="token punctuation">,</span>
                                             future_target<span class="token punctuation">,</span> STEP<span class="token punctuation">)</span>
</code></pre> 
<p><strong>åˆ’åˆ†æ•°æ®é›†</strong></p> 
<p>â€‹</p> 
<pre><code class="prism language-python">train_data_multi <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span><span class="token punctuation">(</span>x_train_multi<span class="token punctuation">,</span> y_train_multi<span class="token punctuation">)</span><span class="token punctuation">)</span>
train_data_multi <span class="token operator">=</span> train_data_multi<span class="token punctuation">.</span>cache<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>shuffle<span class="token punctuation">(</span>BUFFER_SIZE<span class="token punctuation">)</span><span class="token punctuation">.</span>batch<span class="token punctuation">(</span>BATCH_SIZE<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">)</span>

val_data_multi <span class="token operator">=</span> tf<span class="token punctuation">.</span>data<span class="token punctuation">.</span>Dataset<span class="token punctuation">.</span>from_tensor_slices<span class="token punctuation">(</span><span class="token punctuation">(</span>x_val_multi<span class="token punctuation">,</span> y_val_multi<span class="token punctuation">)</span><span class="token punctuation">)</span>
val_data_multi <span class="token operator">=</span> val_data_multi<span class="token punctuation">.</span>batch<span class="token punctuation">(</span>BATCH_SIZE<span class="token punctuation">)</span><span class="token punctuation">.</span>repeat<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>â€‹</p> 
<p><strong>ç»˜åˆ¶æ ·æœ¬ç‚¹æ•°æ®</strong></p> 
<p>â€‹</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">multi_step_plot</span><span class="token punctuation">(</span>history<span class="token punctuation">,</span> true_future<span class="token punctuation">,</span> prediction<span class="token punctuation">)</span><span class="token punctuation">:</span>
    plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span>figsize<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    num_in <span class="token operator">=</span> create_time_steps<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>history<span class="token punctuation">)</span><span class="token punctuation">)</span>
    num_out <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>true_future<span class="token punctuation">)</span>

    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>num_in<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>history<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'History'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>num_out<span class="token punctuation">)</span><span class="token operator">/</span>STEP<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>true_future<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'bo'</span><span class="token punctuation">,</span>
           label<span class="token operator">=</span><span class="token string">'True Future'</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> prediction<span class="token punctuation">.</span><span class="token builtin">any</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span>num_out<span class="token punctuation">)</span><span class="token operator">/</span>STEP<span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>prediction<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'ro'</span><span class="token punctuation">,</span>
                 label<span class="token operator">=</span><span class="token string">'Predicted Future'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'upper left'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> x<span class="token punctuation">,</span> y <span class="token keyword">in</span> train_data_multi<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  multi_step_plot<span class="token punctuation">(</span>x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> y<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>â€‹</p> 
<p><img src="https://images2.imgbox.com/f1/c1/jD03M7ew_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>æ­¤å¤„çš„ä»»åŠ¡æ¯”å…ˆå‰çš„ä»»åŠ¡å¤æ‚ä¸€äº›ï¼Œå› æ­¤è¯¥æ¨¡å‹ç°åœ¨ç”±ä¸¤ä¸ªLSTMå±‚ç»„æˆã€‚æœ€åï¼Œç”±äºéœ€è¦é¢„æµ‹ä¹‹å12ä¸ªå°æ—¶çš„æ•°æ®ï¼Œå› æ­¤Denseå±‚å°†è¾“å‡ºä¸º72ã€‚</p> 
<p>â€‹</p> 
<pre><code class="prism language-python">multi_step_model <span class="token operator">=</span> tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>models<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span><span class="token punctuation">)</span>
multi_step_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span>
                                          return_sequences<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>
                                          input_shape<span class="token operator">=</span>x_train_multi<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
multi_step_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">,</span> activation<span class="token operator">=</span><span class="token string">'relu'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
multi_step_model<span class="token punctuation">.</span>add<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>layers<span class="token punctuation">.</span>Dense<span class="token punctuation">(</span><span class="token number">72</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

multi_step_model<span class="token punctuation">.</span><span class="token builtin">compile</span><span class="token punctuation">(</span>optimizer<span class="token operator">=</span>tf<span class="token punctuation">.</span>keras<span class="token punctuation">.</span>optimizers<span class="token punctuation">.</span>RMSprop<span class="token punctuation">(</span>clipvalue<span class="token operator">=</span><span class="token number">1.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> loss<span class="token operator">=</span><span class="token string">'mae'</span><span class="token punctuation">)</span>
</code></pre> 
<p>â€‹</p> 
<p><strong>è®­ç»ƒ</strong></p> 
<p>â€‹</p> 
<pre><code class="prism language-python">multi_step_history <span class="token operator">=</span> multi_step_model<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>train_data_multi<span class="token punctuation">,</span> epochs<span class="token operator">=</span>EPOCHS<span class="token punctuation">,</span>
                                          steps_per_epoch<span class="token operator">=</span>EVALUATION_INTERVAL<span class="token punctuation">,</span>
                                          validation_data<span class="token operator">=</span>val_data_multi<span class="token punctuation">,</span>
                                          validation_steps<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/db/43/fbITFmyY_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/79/cc/88UwB3Qn_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="5_LSTM_224"></a>5 åŸºäºLSTMçš„è‚¡ç¥¨ä»·æ ¼é¢„æµ‹</h2> 
<h3><a id="51__226"></a>5.1 æ•°æ®é›†</h3> 
<p>è‚¡ç¥¨æ•°æ®æ€»å…±æœ‰ä¹ä¸ªç»´åº¦ï¼Œåˆ†åˆ«æ˜¯</p> 
<p><img src="https://images2.imgbox.com/81/79/CJDe484W_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h3><a id="52__232"></a>5.2 å®ç°ä»£ç </h3> 
<p>â€‹</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> tensorflow <span class="token keyword">as</span> tf
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'font.sans-serif'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'SimHei'</span><span class="token punctuation">]</span><span class="token comment">#æ˜¾ç¤ºä¸­æ–‡</span>
plt<span class="token punctuation">.</span>rcParams<span class="token punctuation">[</span><span class="token string">'axes.unicode_minus'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">False</span><span class="token comment">#æ˜¾ç¤ºè´Ÿå·</span>

<span class="token keyword">def</span> <span class="token function">load_data</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    test_x_batch <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">r'test_x_batch.npy'</span><span class="token punctuation">,</span>allow_pickle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    test_y_batch <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">r'test_y_batch.npy'</span><span class="token punctuation">,</span>allow_pickle<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>test_x_batch<span class="token punctuation">,</span>test_y_batch<span class="token punctuation">)</span>

<span class="token comment">#å®šä¹‰lstmå•å…ƒ</span>
<span class="token keyword">def</span> <span class="token function">lstm_cell</span><span class="token punctuation">(</span>units<span class="token punctuation">)</span><span class="token punctuation">:</span>
    cell <span class="token operator">=</span> tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>BasicLSTMCell<span class="token punctuation">(</span>num_units<span class="token operator">=</span>units<span class="token punctuation">,</span>forget_bias<span class="token operator">=</span><span class="token number">0.0</span><span class="token punctuation">)</span><span class="token comment">#activationé»˜è®¤ä¸ºtanh</span>
    <span class="token keyword">return</span> cell

<span class="token comment">#å®šä¹‰lstmç½‘ç»œ</span>
<span class="token keyword">def</span> <span class="token function">lstm_net</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span>w<span class="token punctuation">,</span>b<span class="token punctuation">,</span>num_neurons<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment">#å°†è¾“å…¥å˜æˆä¸€ä¸ªåˆ—è¡¨ï¼Œåˆ—è¡¨çš„é•¿åº¦åŠæ—¶é—´æ­¥æ•°</span>
    inputs <span class="token operator">=</span> tf<span class="token punctuation">.</span>unstack<span class="token punctuation">(</span>x<span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    cells <span class="token operator">=</span> <span class="token punctuation">[</span>lstm_cell<span class="token punctuation">(</span>units<span class="token operator">=</span>n<span class="token punctuation">)</span> <span class="token keyword">for</span> n <span class="token keyword">in</span> num_neurons<span class="token punctuation">]</span>
    stacked_lstm_cells <span class="token operator">=</span> tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>MultiRNNCell<span class="token punctuation">(</span>cells<span class="token punctuation">)</span>
    outputs<span class="token punctuation">,</span>_ <span class="token operator">=</span>  tf<span class="token punctuation">.</span>contrib<span class="token punctuation">.</span>rnn<span class="token punctuation">.</span>static_rnn<span class="token punctuation">(</span>stacked_lstm_cells<span class="token punctuation">,</span>inputs<span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
    <span class="token keyword">return</span> tf<span class="token punctuation">.</span>matmul<span class="token punctuation">(</span>outputs<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>w<span class="token punctuation">)</span> <span class="token operator">+</span> b

<span class="token comment">#è¶…å‚æ•°</span>
num_neurons <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">32</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">64</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">]</span>

<span class="token comment">#å®šä¹‰è¾“å‡ºå±‚çš„weightå’Œbias</span>
w <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span><span class="token punctuation">[</span>num_neurons<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> tf<span class="token punctuation">.</span>Variable<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>random_normal<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">#å®šä¹‰placeholder</span>
x <span class="token operator">=</span> tf<span class="token punctuation">.</span>placeholder<span class="token punctuation">(</span>shape<span class="token operator">=</span><span class="token punctuation">(</span><span class="token boolean">None</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>dtype<span class="token operator">=</span>tf<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>

<span class="token comment">#å®šä¹‰predå’Œsaver</span>
pred <span class="token operator">=</span> lstm_net<span class="token punctuation">(</span>x<span class="token punctuation">,</span>w<span class="token punctuation">,</span>b<span class="token punctuation">,</span>num_neurons<span class="token punctuation">)</span>
saver <span class="token operator">=</span> tf<span class="token punctuation">.</span>train<span class="token punctuation">.</span>Saver<span class="token punctuation">(</span>tf<span class="token punctuation">.</span>global_variables<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>

    <span class="token comment">#å¼€å¯äº¤äº’å¼Session</span>
    sess <span class="token operator">=</span> tf<span class="token punctuation">.</span>InteractiveSession<span class="token punctuation">(</span><span class="token punctuation">)</span>
    saver<span class="token punctuation">.</span>restore<span class="token punctuation">(</span>sess<span class="token punctuation">,</span><span class="token string">r'D:\è‚¡ç¥¨é¢„æµ‹\model_data\my_model.ckpt'</span><span class="token punctuation">)</span>

    <span class="token comment">#è½½å…¥æ•°æ®</span>
    test_x<span class="token punctuation">,</span>test_y <span class="token operator">=</span> load_data<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">#é¢„æµ‹</span>
    predicts <span class="token operator">=</span> sess<span class="token punctuation">.</span>run<span class="token punctuation">(</span>pred<span class="token punctuation">,</span>feed_dict<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>x<span class="token punctuation">:</span>test_x<span class="token punctuation">}</span><span class="token punctuation">)</span>
    predicts <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>predicts<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> predicts<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token punctuation">(</span>predicts<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> predicts<span class="token punctuation">.</span><span class="token builtin">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">#æ•°å­¦æ ¡å‡†</span>

    <span class="token comment">#å¯è§†åŒ–</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>predicts<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'é¢„æµ‹æ›²çº¿'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>test_y<span class="token punctuation">,</span><span class="token string">'g'</span><span class="token punctuation">,</span>label<span class="token operator">=</span><span class="token string">'çœŸå®æ›²çº¿'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>xlabel<span class="token punctuation">(</span><span class="token string">'ç¬¬å‡ å¤©/days'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>ylabel<span class="token punctuation">(</span><span class="token string">'å¼€ç›˜ä»·(å½’ä¸€åŒ–)'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'è‚¡ç¥¨å¼€ç›˜ä»·æ›²çº¿é¢„æµ‹(æµ‹è¯•é›†)'</span><span class="token punctuation">)</span>
    plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span><span class="token punctuation">)</span>
	plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">#å…³é—­ä¼šè¯</span>
    sess<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>	
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/47/ej05Mk6G_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="6_lstm__305"></a>6 lstm é¢„æµ‹èˆªç©ºæ—…å®¢æ•°ç›®</h2> 
<h3><a id="_307"></a>æ•°æ®é›†</h3> 
<p>airflights passengers datasetä¸‹è½½åœ°å€</p> 
<p>https://raw.githubusercontent.com/jbrownlee/Datasets/master/airline-<br> passengers.csv</p> 
<p>è¿™ä¸ªdatasetåŒ…å«ä»1949å¹´åˆ°1960å¹´æ¯ä¸ªæœˆçš„èˆªç©ºæ—…å®¢æ•°ç›®ï¼Œå…±12*12=144ä¸ªæ•°å­—ã€‚</p> 
<p>ä¸‹é¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬ä»¥1949-1952çš„æ•°æ®é¢„æµ‹1953çš„æ•°æ®ï¼Œä»¥1950-1953çš„æ•°æ®é¢„æµ‹1954çš„æ•°æ®ï¼Œä»¥æ­¤ç±»æ¨ï¼Œè®­ç»ƒæ¨¡å‹ã€‚</p> 
<h3><a id="_318"></a>é¢„æµ‹ä»£ç </h3> 
<p>â€‹</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">import</span> torch
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn <span class="token keyword">as</span> nn
<span class="token keyword">from</span> sklearn<span class="token punctuation">.</span>preprocessing <span class="token keyword">import</span> MinMaxScaler
<span class="token keyword">import</span> os
 
<span class="token comment"># super parameters</span>
EPOCH <span class="token operator">=</span> <span class="token number">400</span>
learning_rate <span class="token operator">=</span> <span class="token number">0.01</span>
seq_length <span class="token operator">=</span> <span class="token number">4</span>   <span class="token comment"># åºåˆ—é•¿åº¦</span>
n_feature <span class="token operator">=</span> <span class="token number">12</span>   <span class="token comment"># åºåˆ—ä¸­æ¯ä¸ªå…ƒç´ çš„ç‰¹å¾æ•°ç›®ã€‚æœ¬ç¨‹åºé‡‡ç”¨çš„åºåˆ—å…ƒç´ ä¸ºä¸€å¹´çš„æ—…å®¢ï¼Œä¸€å¹´12ä¸ªæœˆï¼Œå³12ç»´ç‰¹å¾ã€‚</span>
 
<span class="token comment"># data</span>
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'airline-passengers.csv'</span><span class="token punctuation">)</span>   <span class="token comment"># å…± "12å¹´*12ä¸ªæœˆ=144" ä¸ªæ•°æ®</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">.</span>values        <span class="token comment"># dataFrame, shape (144,1)</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
sc <span class="token operator">=</span> MinMaxScaler<span class="token punctuation">(</span><span class="token punctuation">)</span>
data <span class="token operator">=</span> sc<span class="token punctuation">.</span>fit_transform<span class="token punctuation">(</span>data<span class="token punctuation">)</span>          <span class="token comment"># å½’ä¸€åŒ–</span>
data <span class="token operator">=</span> data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> n_feature<span class="token punctuation">)</span>     <span class="token comment"># shape (12, 12)</span>
 
trainData_x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
trainData_y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">-</span>seq_length<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tmp_x <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token punctuation">:</span>i<span class="token operator">+</span>seq_length<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
    tmp_y <span class="token operator">=</span> data<span class="token punctuation">[</span>i<span class="token operator">+</span>seq_length<span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span>
    trainData_x<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp_x<span class="token punctuation">)</span>
    trainData_y<span class="token punctuation">.</span>append<span class="token punctuation">(</span>tmp_y<span class="token punctuation">)</span>
 
<span class="token comment"># model</span>
<span class="token keyword">class</span> <span class="token class-name">Net</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_dim<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> hidden_dim<span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">,</span> output_dim<span class="token operator">=</span><span class="token number">12</span><span class="token punctuation">,</span> n_layer<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Net<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>in_dim <span class="token operator">=</span> in_dim
        self<span class="token punctuation">.</span>hidden_dim <span class="token operator">=</span> hidden_dim
        self<span class="token punctuation">.</span>output_dim <span class="token operator">=</span> output_dim
        self<span class="token punctuation">.</span>n_layer <span class="token operator">=</span> n_layer
        self<span class="token punctuation">.</span>lstm <span class="token operator">=</span> nn<span class="token punctuation">.</span>LSTM<span class="token punctuation">(</span>input_size<span class="token operator">=</span>in_dim<span class="token punctuation">,</span> hidden_size<span class="token operator">=</span>hidden_dim<span class="token punctuation">,</span> num_layers<span class="token operator">=</span>n_layer<span class="token punctuation">,</span> batch_first<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>linear <span class="token operator">=</span> nn<span class="token punctuation">.</span>Linear<span class="token punctuation">(</span>hidden_dim<span class="token punctuation">,</span> output_dim<span class="token punctuation">)</span>
 
    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        _<span class="token punctuation">,</span> <span class="token punctuation">(</span>h_out<span class="token punctuation">,</span> _<span class="token punctuation">)</span> <span class="token operator">=</span> self<span class="token punctuation">.</span>lstm<span class="token punctuation">(</span>x<span class="token punctuation">)</span>  <span class="token comment"># h_outæ˜¯åºåˆ—æœ€åä¸€ä¸ªå…ƒç´ çš„hidden state</span>
                                      <span class="token comment"># h_out's shape (batchsize, n_layer*n_direction, hidden_dim), i.e. (1, 1, 10)</span>
                                      <span class="token comment"># n_directionæ ¹æ®æ˜¯â€œå¦ä¸ºåŒå‘â€å–å€¼ä¸º1æˆ–2</span>
        h_out <span class="token operator">=</span> h_out<span class="token punctuation">.</span>view<span class="token punctuation">(</span>h_out<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>   <span class="token comment"># h_out's shape (batchsize, n_layer * n_direction * hidden_dim), i.e. (1, 10)</span>
        h_out <span class="token operator">=</span> self<span class="token punctuation">.</span>linear<span class="token punctuation">(</span>h_out<span class="token punctuation">)</span>    <span class="token comment"># h_out's shape (batchsize, output_dim), (1, 12)</span>
        <span class="token keyword">return</span> h_out
 
train <span class="token operator">=</span> <span class="token boolean">True</span>
<span class="token keyword">if</span> train<span class="token punctuation">:</span>
    model <span class="token operator">=</span> Net<span class="token punctuation">(</span><span class="token punctuation">)</span>
    loss_func <span class="token operator">=</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>MSELoss<span class="token punctuation">(</span><span class="token punctuation">)</span>
    optimizer <span class="token operator">=</span> torch<span class="token punctuation">.</span>optim<span class="token punctuation">.</span>Adam<span class="token punctuation">(</span>model<span class="token punctuation">.</span>parameters<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> lr<span class="token operator">=</span>learning_rate<span class="token punctuation">)</span>
    <span class="token comment"># train</span>
    <span class="token keyword">for</span> epoch <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>EPOCH<span class="token punctuation">)</span><span class="token punctuation">:</span>
        total_loss <span class="token operator">=</span> <span class="token number">0</span>
        <span class="token keyword">for</span> iteration<span class="token punctuation">,</span> X <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>trainData_x<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># X's shape (seq_length, n_feature)</span>
            X <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            X <span class="token operator">=</span> torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>X<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>                <span class="token comment"># X's shape (1, seq_length, n_feature), 1 is batchsize</span>
            output <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span>       <span class="token comment"># output's shape (1,12)</span>
            output <span class="token operator">=</span> torch<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>output<span class="token punctuation">)</span>
            loss <span class="token operator">=</span> loss_func<span class="token punctuation">(</span>output<span class="token punctuation">,</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>trainData_y<span class="token punctuation">[</span>iteration<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            optimizer<span class="token punctuation">.</span>zero_grad<span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment"># clear gradients for this training iteration</span>
            loss<span class="token punctuation">.</span>backward<span class="token punctuation">(</span><span class="token punctuation">)</span>         <span class="token comment"># computing gradients</span>
            optimizer<span class="token punctuation">.</span>step<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment"># update weights</span>
            total_loss <span class="token operator">+=</span> loss
 
        <span class="token keyword">if</span> <span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">%</span> <span class="token number">20</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'epoch:{:3d}, loss:{:6.4f}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>epoch<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> total_loss<span class="token punctuation">.</span>data<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># torch.save(model, 'flight_model.pkl')  # è¿™æ ·ä¿å­˜ä¼šå¼¹å‡ºUserWarningï¼Œå»ºè®®é‡‡ç”¨ä¸‹é¢çš„ä¿å­˜æ–¹æ³•ï¼Œè¯¦æƒ…å¯å‚è€ƒhttps://zhuanlan.zhihu.com/p/129948825</span>
    torch<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'state_dict'</span><span class="token punctuation">:</span> model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">'checkpoint.pth.tar'</span><span class="token punctuation">)</span>
 
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token comment"># model = torch.load('flight_model.pth')</span>
    model <span class="token operator">=</span> Net<span class="token punctuation">(</span><span class="token punctuation">)</span>
    checkpoint <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'checkpoint.pth.tar'</span><span class="token punctuation">)</span>
    model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>checkpoint<span class="token punctuation">[</span><span class="token string">'state_dict'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
 
<span class="token comment"># predict</span>
model<span class="token punctuation">.</span><span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
predict <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">for</span> X <span class="token keyword">in</span> trainData_x<span class="token punctuation">:</span>             <span class="token comment"># X's shape (seq_length, n_feature)</span>
    X <span class="token operator">=</span> torch<span class="token punctuation">.</span>tensor<span class="token punctuation">(</span>X<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    X <span class="token operator">=</span> torch<span class="token punctuation">.</span>unsqueeze<span class="token punctuation">(</span>X<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>     <span class="token comment"># X's shape (1, seq_length, n_feature), 1 is batchsize</span>
    output <span class="token operator">=</span> model<span class="token punctuation">(</span>X<span class="token punctuation">)</span>             <span class="token comment"># output's shape (1,12)</span>
    output <span class="token operator">=</span> torch<span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span>output<span class="token punctuation">)</span>
    predict<span class="token punctuation">.</span>append<span class="token punctuation">(</span>output<span class="token punctuation">.</span>data<span class="token punctuation">.</span>numpy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 
<span class="token comment"># plot</span>
plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
predict <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>predict<span class="token punctuation">)</span>
predict <span class="token operator">=</span> predict<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span>
x_tick <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>predict<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>seq_length<span class="token operator">*</span>n_feature<span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>x_tick<span class="token punctuation">)</span><span class="token punctuation">,</span> predict<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'predict data'</span><span class="token punctuation">)</span>
 
data_original <span class="token operator">=</span> data<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>squeeze<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data_original<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data_original<span class="token punctuation">,</span> label<span class="token operator">=</span><span class="token string">'original data'</span><span class="token punctuation">)</span>
 
plt<span class="token punctuation">.</span>legend<span class="token punctuation">(</span>loc<span class="token operator">=</span><span class="token string">'best'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>è¿è¡Œç»“æœ</p> 
<p><img src="https://images2.imgbox.com/c1/49/6szJVxZL_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p><img src="https://images2.imgbox.com/e4/c6/wdMt7QAU_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="7__433"></a>7 æœ€å</h2> 
<p>ğŸ§¿ <strong>æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cf86cb2ade7334ed508fa2b94f4aaca2/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">è®¿é—®è€…æ¨¡å¼ (Visitor Pattern)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/db4b05224b4819a2781dc131ad8faedf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">ã€LinuxåŸºç¡€ã€‘Linuxå¸¸è§æŒ‡ä»¤æ€»ç»“åŠå‘¨è¾¹å°çŸ¥è¯†</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ITå­¦ä¹ è€…åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>