<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>uniapp 分页加载吸顶（模仿微信账单） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="uniapp 分页加载吸顶（模仿微信账单）" />
<meta property="og:description" content="分页吸顶
(一个php程序员刚学会uniapp 开发的，目前不能用scroll-view,没法获取到页面滚动的距离)
废话不说，直接上代码
&lt;template&gt;
&lt;view class=&#34;pageBox&#34;&gt;
&lt;view class=&#34;border-bottom white&#34; v-for=&#34;(item,index) in list&#34; &gt;
&lt;view v-if=&#34;item.ismf&#34; class=&#34;flex-between pd20 bg box&#34; :class=&#34;[(isFixedTop[item.mfk]) ?&#39;fixedTop&#39; : &#39;&#39;]&#34; :style=&#34;{&#39;z-index&#39;:index&#43;10000}&#34;&gt;
&lt;view class=&#34;fontSize30 &#34;&gt;{{item.Y}}年{{item.M}}月&lt;/view&gt;
&lt;view class=&#34;fontSize26 fontColor mgtop10&#34;&gt;支出￥{{item.income}} &amp;nbsp;&amp;nbsp;收入￥{{item.expenditure}}&lt;/view&gt;
&lt;/view&gt;
&lt;!-- 占位 --&gt;
&lt;view v-if=&#34;!index&#34; class=&#34;tops&#34;&gt;&lt;/view&gt;
&lt;view class=&#34;flex-between pd20&#34; &gt;
&lt;view class=&#34;fontSize28 fontColor&#34;&gt;
&lt;view class=&#34;lineHeight&#34;&gt;申请提现&lt;/view&gt;
&lt;view class=&#34;lineHeight&#34;&gt;订单编号：29928822982227&lt;/view&gt;
&lt;/view&gt;
&lt;view class=&#34;fontSize28 fontColor&#34;&gt;
&lt;view class=&#34;blackColor text-right lineHeight fw&#34;&gt;{{item.amount}}&lt;/view&gt;
&lt;/view&gt;
&lt;/view&gt;
&lt;view class=&#34;lineHeight50 fontSize28 fontColor flex-align-center pd20&#34;&gt;
&lt;u-icon name=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9d4c743ea4507aa92de5ca8b3dda1c33/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-31T19:47:19+08:00" />
<meta property="article:modified_time" content="2023-01-31T19:47:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">uniapp 分页加载吸顶（模仿微信账单）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>分页吸顶</p> 
<p></p> 
<p><img alt="" height="741" src="https://images2.imgbox.com/15/e5/bJh3F2Cj_o.jpg" width="419"></p> 
<p><img alt="" height="738" src="https://images2.imgbox.com/d7/d0/7eQ9JIXk_o.png" width="418"></p> 
<p> (一个php程序员刚学会uniapp 开发的，目前不能用scroll-view,没法获取到页面滚动的距离)</p> 
<p> 废话不说，直接上代码</p> 
<p>&lt;template&gt;<br>     &lt;view class="pageBox"&gt;<br>         &lt;view class="border-bottom white" v-for="(item,index) in list" &gt;<br>             <br>             &lt;view v-if="item.ismf" class="flex-between pd20 bg box" :class="[(isFixedTop[item.mfk]) ?'fixedTop' : '']" :style="{'z-index':index+10000}"&gt;<br>                 &lt;view class="fontSize30 "&gt;{<!-- -->{item.Y}}年{<!-- -->{item.M}}月&lt;/view&gt;<br>                 &lt;view class="fontSize26 fontColor mgtop10"&gt;支出￥{<!-- -->{item.income}} &amp;nbsp;&amp;nbsp;收入￥{<!-- -->{item.expenditure}}&lt;/view&gt;<br>             &lt;/view&gt;<br>             <br>             &lt;!-- 占位 --&gt;<br>             &lt;view v-if="!index" class="tops"&gt;&lt;/view&gt;<br>             <br>             &lt;view class="flex-between pd20"  &gt;<br>                 &lt;view class="fontSize28 fontColor"&gt;<br>                     &lt;view class="lineHeight"&gt;申请提现&lt;/view&gt;<br>                     &lt;view class="lineHeight"&gt;订单编号：29928822982227&lt;/view&gt;<br>                 &lt;/view&gt;<br>                 &lt;view class="fontSize28 fontColor"&gt;<br>                     &lt;view class="blackColor text-right lineHeight fw"&gt;{<!-- -->{item.amount}}&lt;/view&gt;<br>                 &lt;/view&gt;<br>             &lt;/view&gt;<br>             &lt;view class="lineHeight50 fontSize28 fontColor flex-align-center pd20"&gt;<br>                 &lt;u-icon name="clock" color="#2979ff" size="20"&gt;&lt;/u-icon&gt;<br>                 &lt;view class="mgleft10"&gt;{<!-- -->{item.create_time_text}}&lt;/view&gt;<br>             &lt;/view&gt;<br>         &lt;/view&gt;<br>         <br>     &lt;/view&gt;<br> &lt;/template&gt;</p> 
<p>&lt;script&gt;<br>     export default {<!-- --><br>         data() {<!-- --><br>             return {<!-- --><br>                 isFixedTop:[],<br>                 // isFixedTop0:false,<br>                 // isFixedTop1:false,<br>                 Topdistance:[],<br>                 topHeight:"",<br>                 mainTitle:'',<br>                 <br>                 list : [],<br>                 <br>                 point:[],<br>                 page:1,<br>                 isLastPage:0,//是否为最后一页<br>             }<br>         },<br>         onLoad(option){<!-- --><br>             var that = this;<br>             that.pay_way = option.pay_way;<br>             if(option.isCheck){<!-- --><br>                 that.isCheck = 1;<br>             }<br>         },<br>         <br>         mounted(){<!-- --><br>             var that = this;<br>             that.getWaterList();<br>         },<br>         onPageScroll(e) {<!-- --><br>             var that = this<br>             <br>             <br>             for(let i = 0; i &lt; that.Topdistance.length; i++){<!-- --><br>                 if(e.scrollTop &gt;= that.Topdistance[i]){<!-- --><br>                     <br>                     that.isFixedTop[i] = true<br>                     that.$set(that.isFixedTop,i,true)<br>                     that.isFixedTop[i] = true<br>                 }else{<!-- --><br>                     <br>                     that.isFixedTop[i] = false<br>                     that.$set(that.isFixedTop,i,false)<br>                     that.isFixedTop[i] = false<br>                 }<br>             }<br>             return false;<br>         },<br>         onReachBottom() {<!-- --><br>             let that = this;<br>             that.getWaterList();<br>         },<br>         methods: { <br>             <br>             init:function(t,f){<!-- --><br>                 <br>                 var that = this;<br>                 <br>                 if(f){<!-- --><br>                     uni.pageScrollTo({<!-- --><br>                         scrollTop:0,<br>                         duration:0<br>                     });<br>                 }<br>                 <br>                 setTimeout(()=&gt;{<!-- --><br>                     that.GetTop()<br>                 },t)<br>             },<br>             GetTop(){<!-- --><br>                 var _this=this<br>                 uni.getSystemInfo({<!-- --><br>                     success:(resu)=&gt;{    <br>                         const query = uni.createSelectorQuery().in(this)<br>                         query.selectAll('.box').boundingClientRect()<br>                         query.selectViewport().scrollOffset()<br>                         query.exec(function(res){<!-- --><br>         <br>                             _this.arr(res)<br>                         })<br>                     },<br>                     fail:(res)=&gt;{}<br>                 })<br>             }, <br>             arr(res){<!-- --><br>                 var that = this;<br>                 var TopdistanceLen = that.Topdistance.length;<br>                 <br>                 for(let i = 0; i &lt; res[0].length; i++){<!-- --><br>                     if(i&gt;= TopdistanceLen){//加上此条件能避免对前面已经获取定位的数据重复赋值，造成错误<br>                         that.Topdistance[i] = res[0][i].top + res[1]['scrollTop'];<br>                                             <br>                     }<br>                     // this.isFixedTop[i] = false<br>                 }<br>             },<br>             <br>             getWaterList(){<!-- --><br>                 var that = this;<br>                 if(that.isLastPage){<!-- --><br>                     return false;<br>                 }<br>                 var option = {<!-- --><br>                     page:that.page,<br>                     pay_way:that.pay_way,<br>                     need_statistics:1<br>                 };<br>                 that.$post('water/getWaterList',option).then(res=&gt;{<!-- --><br>                     <br>                     if(res.data.data.current_page == res.data.data.last_page){<!-- --><br>                         that.isLastPage = 1;<br>                     }else {<!-- --><br>                         that.page ++;<br>                     }<br>                     <br>                     for(var i=0;i&lt;res.data.data.data.length;i++){<!-- --><br>                         let pointLen = that.point.length;<br>                         if(pointLen){<!-- --><br>                             if(that.point[pointLen-1] != res.data.data.data[i]['Y']+'-'+res.data.data.data[i]['M']){<!-- --><br>                                 that.isFixedTop[pointLen] = false;<br>                                 res.data.data.data[i]['mfk'] = pointLen;<br>                                 res.data.data.data[i]['ismf'] = 1;//判断是否为月初<br>                                 that.point.push(res.data.data.data[i]['Y']+'-'+res.data.data.data[i]['M']);<br>                             }else{<!-- --><br>                                 res.data.data.data[i]['ismf'] = 0;<br>                             }<br>                         }else{<!-- --><br>                             that.isFixedTop[0] = true;<br>                             res.data.data.data[i]['mfk'] = 0;<br>                             res.data.data.data[i]['ismf'] = 1;//判断是否为月初<br>                             that.point[0] = res.data.data.data[i]['Y']+'-'+res.data.data.data[i]['M'];<br>                         }<br>                     }<br>                     <br>                     that.list = that.list.concat(res.data.data.data);<br>                     //数据渲染完成，立即重新去对新的需要吸顶的元素进行定位<br>                     that.init(0,0);<br>                     <br>                 });<br>                 <br>             },<br>             <br>         },<br>         <br>     }<br> &lt;/script&gt;</p> 
<p>&lt;style&gt;<br>     <br>  .fixedTop{<!-- --><br>      position: fixed;<br>      top:0;<br>      left: 0;<br>      right: 0;<br>     <br>  }<br>  .tops{<!-- --><br>      height: 7vh;<br>  }</p> 
<p>&lt;/style&gt;</p> 
<p></p> 
<p>希望能帮到大家</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ed2fb13ced5552500e753c5125859779/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[NSSRound#7 Team]Web学习</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1f6828bbd751adfbbbb5edd552e5f947/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">电子技术——MOS放大器基础</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>