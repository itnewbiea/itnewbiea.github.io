<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>这就是你日日夜夜想要的docker！！！---------Harbor私有仓库 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="这就是你日日夜夜想要的docker！！！---------Harbor私有仓库" />
<meta property="og:description" content="文章目录 一、Harbor私有仓库介绍1、什么是Harbor？有什么作用？2、harbor的特性3、harbor配置文件参数 二、部署Harbor私有仓库1、harbor服务器安装harbor2、查看已经生成的镜像和容器3、测试4、harbor服务器字符界面镜像仓库测试5、client客户端harbor仓库测试 三、harbor仓库的维护管理1、Harbor.cfg配置文件2、在客户端对镜像进行管理3、迁移harbor数据 一、Harbor私有仓库介绍 1、什么是Harbor？有什么作用？ 是多个容器同时跑起来的服务 所以必须要装docker compose
Harbor是VMware公司的开源级的企业级DockerRegistry(仓库)项目，项目地址为 https://github.com/vmware/harbor.
Harbor的目标是帮助用户迅速搭建一个企业级的DockerRegistry服务。
Harbor以docker公司开源的registry为基础，提供了管理UI，基于角色的访问控制（Role Based Access Control），AD/LDAP集成，以及审计日志（Auditlogging）等企业用户需求的功能，同时还原生支持中文。
Harbor的每个组件都是以Docker容器的形式构建的，使用docker-compose来对它进行部署。用于部署Harbor的docker-compose模板位于/usr/local/bin/harbor/docker-compose.yml(自定义)
2、harbor的特性 1、基于角色控制：用户与Docker镜像仓库通过&#34;项目&#34;进行组织管理,一个用户可以对多个镜像仓库在统一命名空间(projec)里有不同的权限
2、图形化用户界面：用户可以通过浏览器来浏览,检索当前Docker镜像仓库,管理项目和命名空间
3、审计管理：所有这怒地镜像仓库的错都可以被记录追溯，用于审计管理
4、基于镜像的复制策略：镜像可以在多个Harbor实例之间进行复制。
5、支持LDAP认证：Harbor的用户授权可以使用已经存在的用户。
6、镜像删除和垃圾回收：image可以被删除并且回收image占用的空间。
7、简单的部署功能：harbor提供了online、offline安装，此外还提供了virtualappliance安装
8、harbor和docker registry的关系：harbor实质上是对docker registry做了封装，扩展了自己的业务模板。
3、harbor配置文件参数 vim /usr/local/harbor/harbor.cfg，关于 Harbor.cfg 配置文件中有两类参数：所需参数和可选参数
1、所需参数：这些参数需要在配置文件 Harbor.cfg 中设置。如果用户更新它们并运行 install.sh脚本重新安装 Harbour，参数将生效。具体参数如下：
hostname：用于访问用户界面和 register 服务。它应该是目标机器的 IP 地址或完全限 定的域名（FQDN），例如 192.168.195.128 或 hub.kgc.cn。不要使用 localhost 或 127.0.0.1 为主机名。 ui_url_protocol：（http 或 https，默认为 http）用于访问 UI 和令牌/通知服务的协议。如果公证处于启用状态，则此参数必须为 https。 max_job_workers：镜像复制作业线程。 db_password：用于db_auth 的MySQL数据库root 用户的密码。 customize_crt：该属性可设置为打开或关闭，默认打开。打开此属性时，准备脚本创建私钥和根证书，用于生成/验证注册表令牌。 当由外部来源提供密钥和根证书时，将此属性设置为 off。 ssl_cert：SSL 证书的路径，仅当协议设置为 https 时才应用。 secretkey_path：用于在复制策略中加密或解密远程 register 密码的密钥路径。 2、可选参数：这些参数对于更新是可选的，即用户可以将其保留为默认值，并在启动 Harbor 后在 Web UI 上进行更新。如果进入 Harbor." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5b84a27b8bc9ff9f861b0c4e6809f598/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-09-24T09:52:19+08:00" />
<meta property="article:modified_time" content="2020-09-24T09:52:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">这就是你日日夜夜想要的docker！！！---------Harbor私有仓库</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#Harbor_2" rel="nofollow">一、Harbor私有仓库介绍</a></li><li><ul><li><a href="#1Harbor_3" rel="nofollow">1、什么是Harbor？有什么作用？</a></li><li><a href="#2harbor_9" rel="nofollow">2、harbor的特性</a></li><li><a href="#3harbor_18" rel="nofollow">3、harbor配置文件参数</a></li></ul> 
  </li><li><a href="#Harbor_54" rel="nofollow">二、部署Harbor私有仓库</a></li><li><ul><li><a href="#1harborharbor_59" rel="nofollow">1、harbor服务器安装harbor</a></li><li><a href="#2_81" rel="nofollow">2、查看已经生成的镜像和容器</a></li><li><a href="#3_135" rel="nofollow">3、测试</a></li><li><a href="#4harbor_139" rel="nofollow">4、harbor服务器字符界面镜像仓库测试</a></li><li><a href="#5clientharbor_162" rel="nofollow">5、client客户端harbor仓库测试</a></li></ul> 
  </li><li><a href="#harbor_187" rel="nofollow">三、harbor仓库的维护管理</a></li><li><ul><li><a href="#1Harborcfg_188" rel="nofollow">1、Harbor.cfg配置文件</a></li><li><a href="#2_203" rel="nofollow">2、在客户端对镜像进行管理</a></li><li><a href="#3harbor_236" rel="nofollow">3、迁移harbor数据</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Harbor_2"></a>一、Harbor私有仓库介绍</h2> 
<h3><a id="1Harbor_3"></a>1、什么是Harbor？有什么作用？</h3> 
<p>是多个容器同时跑起来的服务 所以必须要装docker compose<br> Harbor是VMware公司的开源级的企业级DockerRegistry(仓库)项目，项目地址为 https://github.com/vmware/harbor.<br> Harbor的目标是帮助用户迅速搭建一个企业级的DockerRegistry服务。<br> Harbor以docker公司开源的registry为基础，提供了管理UI，基于角色的访问控制（Role Based Access Control），AD/LDAP集成，以及审计日志（Auditlogging）等企业用户需求的功能，同时还原生支持中文。<br> Harbor的每个组件都是以Docker容器的形式构建的，使用docker-compose来对它进行部署。用于部署Harbor的docker-compose模板位于/usr/local/bin/harbor/docker-compose.yml(自定义)</p> 
<h3><a id="2harbor_9"></a>2、harbor的特性</h3> 
<p>1、基于角色控制：用户与Docker镜像仓库通过"项目"进行组织管理,一个用户可以对多个镜像仓库在统一命名空间(projec)里有不同的权限<br> 2、图形化用户界面：用户可以通过浏览器来浏览,检索当前Docker镜像仓库,管理项目和命名空间<br> 3、审计管理：所有这怒地镜像仓库的错都可以被记录追溯，用于审计管理<br> 4、基于镜像的复制策略：镜像可以在多个Harbor实例之间进行复制。<br> 5、支持LDAP认证：Harbor的用户授权可以使用已经存在的用户。<br> 6、镜像删除和垃圾回收：image可以被删除并且回收image占用的空间。<br> 7、简单的部署功能：harbor提供了online、offline安装，此外还提供了virtualappliance安装<br> 8、harbor和docker registry的关系：harbor实质上是对docker registry做了封装，扩展了自己的业务模板。</p> 
<h3><a id="3harbor_18"></a>3、harbor配置文件参数</h3> 
<p>vim /usr/local/harbor/harbor.cfg，关于 Harbor.cfg 配置文件中有两类参数：所需参数和可选参数<br> 1、所需参数：这些参数需要在配置文件 Harbor.cfg 中设置。如果用户更新它们并运行 install.sh脚本重新安装 Harbour，参数将生效。具体参数如下：</p> 
<pre><code class="prism language-bash">hostname：用于访问用户界面和 register 服务。它应该是目标机器的 IP 地址或完全限 定的域名（FQDN），例如 192.168.195.128 或 hub.kgc.cn。不要使用 localhost 或 127.0.0.1 为主机名。
ui_url_protocol：（http 或 https，默认为 http）用于访问 UI 和令牌/通知服务的协议。如果公证处于启用状态，则此参数必须为 https。
max_job_workers：镜像复制作业线程。
db_password：用于db_auth 的MySQL数据库root 用户的密码。
customize_crt：该属性可设置为打开或关闭，默认打开。打开此属性时，准备脚本创建私钥和根证书，用于生成/验证注册表令牌。
当由外部来源提供密钥和根证书时，将此属性设置为 off。
ssl_cert：SSL 证书的路径，仅当协议设置为 https 时才应用。
secretkey_path：用于在复制策略中加密或解密远程 register 密码的密钥路径。
</code></pre> 
<p>2、可选参数：这些参数对于更新是可选的，即用户可以将其保留为默认值，并在启动 Harbor 后在 Web UI 上进行更新。如果进入 Harbor.cfg，只会在第一次启动 Harbor 时生效，随后对这些参数 的更新，Harbor.cfg 将被忽略。<br> 注意：如果选择通过UI设置这些参数，请确保在启动Harbour后立即执行此操作。具体来说，必须在注册或在 Harbor 中创建任何新用户之前设置所需的</p> 
<pre><code class="prism language-bash">auth_mode。当系统中有用户时（除了默认的 admin 用户），auth_mode 不能被修改。具体参数如下：
Email：Harbor需要该参数才能向用户发送“密码重置”电子邮件，并且只有在需要该功能时才需要。
请注意，在默认情况下SSL连接时没有启用。如果SMTP服务器需要SSL，但不支持STARTTLS，那么应该通过设置启用SSL email_ssl <span class="token operator">=</span> TRUE。
harbour_admin_password：管理员的初始密码，只在Harbour第一次启动时生效。之后，此设置将被忽略，并且应 UI中设置管理员的密码。
请注意，默认的用户名/密码是 admin/Harbor12345。
auth_mode：使用的认证类型，默认情况下，它是 db_auth，即凭据存储在数据库中。对于LDAP身份验证，请将其设置为 ldap_auth。
self_registration：启用/禁用用户注册功能。禁用时，新用户只能由 Admin 用户创建，只有管理员用户可以在 Harbour中创建新用户。
注意：当 auth_mode 设置为 ldap_auth 时，自注册功能将始终处于禁用状态，并且该标志被忽略。
Token_expiration：由令牌服务创建的令牌的到期时间（分钟），默认为 30 分钟。
project_creation_restriction：用于控制哪些用户有权创建项目的标志。默认情况下， 每个人都可以创建一个项目。
如果将其值设置为“adminonly”，那么只有 admin 可以创建项目。
verify_remote_cert：打开或关闭，默认打开。此标志决定了当Harbor与远程 register 实例通信时是否验证 SSL/TLS 证书。
将此属性设置为 off 将绕过 SSL/TLS 验证，这在远程实例具有自签名或不可信证书时经常使用。
另外，默认情况下，Harbour 将镜像存储在本地文件系统上。在生产环境中，可以考虑 使用其他存储后端而不是本地文件系统，
如 S3、Openstack Swif、Ceph 等。但需要更新 common/templates/registry/config.yml 文件。
</code></pre> 
<h2><a id="Harbor_54"></a>二、部署Harbor私有仓库</h2> 
<p>实验环境 vmware15.5 centos7.6两台<br> harbor服务器 192.168.110.132<br> client客户端 192.168.110.133</p> 
<h3><a id="1harborharbor_59"></a>1、harbor服务器安装harbor</h3> 
<pre><code class="prism language-handlebars"><span class="token variable">wget</span> <span class="token variable">http:</span><span class="token punctuation">/</span><span class="token punctuation">/</span><span class="token variable">harbor</span><span class="token punctuation">.</span><span class="token variable">orientsoft</span><span class="token punctuation">.</span><span class="token variable">cn</span><span class="token punctuation">/</span><span class="token variable">harbor-</span><span class="token number">1.2</span><span class="token number">.2</span><span class="token block keyword">/harbor-offline-installer-v1.</span><span class="token number">2.2</span><span class="token punctuation">.</span><span class="token variable">tgz</span>	<span class="token string">'//可以使用此命令下载，但是速度较慢，我使用的是已经下载好的'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">rz</span> <span class="token variable">-E</span>	<span class="token string">'//上传harbor软件'</span>
<span class="token variable">rz</span> <span class="token variable">waiting</span> <span class="token variable">to</span> <span class="token variable">receive</span><span class="token punctuation">.</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">ls</span>
<span class="token variable">anaconda-ks</span><span class="token punctuation">.</span><span class="token variable">cfg</span>  <span class="token variable">-bootstrap</span>  <span class="token variable">consul_0</span><span class="token punctuation">.</span><span class="token number">9.2</span><span class="token variable">_linux_amd64</span><span class="token punctuation">.</span><span class="token variable">zip</span>  <span class="token variable">harbor-offline-installer-v1</span><span class="token punctuation">.</span><span class="token number">2.2</span><span class="token punctuation">.</span><span class="token variable">tgz</span> 
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">tar</span> <span class="token variable">zxf</span> <span class="token variable">harbor-offline-installer-v1</span><span class="token punctuation">.</span><span class="token number">2.2</span><span class="token punctuation">.</span><span class="token variable">tgz</span> <span class="token variable">-C</span> <span class="token punctuation">/</span><span class="token variable">usr</span><span class="token punctuation">/</span><span class="token variable">local</span><span class="token punctuation">/</span>	<span class="token string">'//解压到指定目录'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">cd</span> <span class="token punctuation">/</span><span class="token variable">usr</span><span class="token punctuation">/</span><span class="token variable">local</span><span class="token punctuation">/</span><span class="token variable">harbor</span><span class="token punctuation">/</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">ls</span>
<span class="token variable">common</span>                    <span class="token variable">docker-compose</span><span class="token punctuation">.</span><span class="token variable">notary</span><span class="token punctuation">.</span><span class="token variable">yml</span>  <span class="token variable">harbor_1_1_0_template</span>  <span class="token variable">harbor</span><span class="token punctuation">.</span><span class="token variable">v1</span><span class="token punctuation">.</span><span class="token number">2.2</span><span class="token punctuation">.</span><span class="token variable">tar</span><span class="token punctuation">.</span><span class="token variable">gz</span>  <span class="token variable">LICENSE</span>  <span class="token variable">prepare</span>
<span class="token variable">docker-compose</span><span class="token punctuation">.</span><span class="token variable">clair</span><span class="token punctuation">.</span><span class="token variable">yml</span>  <span class="token variable">docker-compose</span><span class="token punctuation">.</span><span class="token variable">yml</span>         <span class="token variable">harbor</span><span class="token punctuation">.</span><span class="token variable">cfg</span>             <span class="token variable">install</span><span class="token punctuation">.</span><span class="token variable">sh</span>            <span class="token variable">NOTICE</span>   <span class="token variable">upgrade</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> 
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token variable">省略内容</span>
<span class="token variable">hostname</span> <span class="token punctuation">=</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span>	<span class="token string">'//修改为监听本地地址，不可以使用localhost或者127。0.0.1'</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token variable">省略内容</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">sh</span> <span class="token variable">install</span><span class="token punctuation">.</span><span class="token variable">sh</span>	<span class="token string">'//启动harbor'</span>
</code></pre> 
<h3><a id="2_81"></a>2、查看已经生成的镜像和容器</h3> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">images</span>
<span class="token variable">REPOSITORY</span>                  <span class="token variable">TAG</span>                 <span class="token variable">IMAGE</span> <span class="token variable">ID</span>            <span class="token variable">CREATED</span>             <span class="token variable">SIZE</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-log</span>           <span class="token variable">v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>              <span class="token number">36</span><span class="token variable">ef78ae27df</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">200</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-jobservice</span>    <span class="token variable">v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>              <span class="token variable">e2af366cba44</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">164</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-ui</span>            <span class="token variable">v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>              <span class="token number">39</span><span class="token variable">efb472c253</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">178</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-adminserver</span>   <span class="token variable">v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>              <span class="token variable">c75963ec543f</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">142</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-db</span>            <span class="token variable">v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>              <span class="token variable">ee7b9fa37c5d</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">329</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">nginx-photon</span>         <span class="token number">1.11</span><span class="token number">.13</span>             <span class="token number">6</span><span class="token variable">cc5c831fc7f</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">144</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">registry</span>             <span class="token number">2.6</span><span class="token number">.2</span><span class="token variable">-photon</span>        <span class="token number">5</span><span class="token variable">d9100e4350e</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">173</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">postgresql</span>           <span class="token number">9.6</span><span class="token number">.4</span><span class="token variable">-photon</span>        <span class="token variable">c562762cbd12</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">225</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">clair</span>                <span class="token variable">v2</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token variable">-photon</span>       <span class="token variable">f04966b4af6c</span>        <span class="token number">2</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">297</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-notary-db</span>     <span class="token variable">mariadb-</span><span class="token number">10.1</span><span class="token number">.10</span>     <span class="token number">64</span><span class="token variable">ed814665c6</span>        <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">324</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">notary-photon</span>        <span class="token variable">signer-</span><span class="token number">0.5</span><span class="token number">.0</span>        <span class="token variable">b1eda7d10640</span>        <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">156</span><span class="token variable">MB</span>
<span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">notary-photon</span>        <span class="token variable">server-</span><span class="token number">0.5</span><span class="token number">.0</span>        <span class="token number">6e2646682</span><span class="token variable">e3c</span>        <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">157</span><span class="token variable">MB</span>
<span class="token variable">photon</span>                      <span class="token number">1.0</span>                 <span class="token variable">e6e4e4a2ba1b</span>        <span class="token number">3</span> <span class="token variable">years</span> <span class="token variable">ago</span>         <span class="token number">128</span><span class="token variable">MB</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">ps</span> <span class="token variable">-a</span>
<span class="token variable">CONTAINER</span> <span class="token variable">ID</span>        <span class="token variable">IMAGE</span>                              <span class="token variable">COMMAND</span>                  <span class="token variable">CREATED</span>             <span class="token variable">STATUS</span>              <span class="token variable">PORTS</span>                                                              <span class="token variable">NAMES</span>
<span class="token number">968</span><span class="token variable">d6c3ec791</span>        <span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-jobservice:v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>    <span class="token string">"/harbor/harbor_jobs…"</span>   <span class="token number">21</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>      <span class="token variable">Up</span> <span class="token number">20</span> <span class="token variable">seconds</span>                                                                          <span class="token variable">harbor-jobservice</span>
<span class="token number">938</span><span class="token variable">f21931305</span>        <span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">nginx-photon:</span><span class="token number">1.11</span><span class="token number">.13</span>        <span class="token string">"nginx -g 'daemon of…"</span>   <span class="token number">21</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>      <span class="token variable">Up</span> <span class="token number">20</span> <span class="token variable">seconds</span>       <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token variable">:</span><span class="token number">80</span><span class="token variable">-</span><span class="token punctuation">&gt;</span><span class="token number">80</span><span class="token block keyword">/tcp,</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token variable">:</span><span class="token number">443</span><span class="token variable">-</span><span class="token punctuation">&gt;</span><span class="token number">443</span><span class="token block keyword">/tcp,</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token variable">:</span><span class="token number">4443</span><span class="token variable">-</span><span class="token punctuation">&gt;</span><span class="token number">4443</span><span class="token block keyword">/tcp</span>   <span class="token variable">nginx</span>
<span class="token number">7e7</span><span class="token variable">ca101c841</span>        <span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-ui:v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>            <span class="token string">"/harbor/harbor_ui"</span>      <span class="token number">21</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>      <span class="token variable">Up</span> <span class="token number">20</span> <span class="token variable">seconds</span>                                                                          <span class="token variable">harbor-ui</span>
<span class="token number">09</span><span class="token variable">c54252ef77</span>        <span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-db:v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>            <span class="token string">"docker-entrypoint.s…"</span>   <span class="token number">22</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>      <span class="token variable">Up</span> <span class="token number">21</span> <span class="token variable">seconds</span>       <span class="token number">3306</span><span class="token block keyword">/tcp</span>                                                           <span class="token variable">harbor-db</span>
<span class="token number">7</span><span class="token variable">d47b7b3d17e</span>        <span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">registry:</span><span class="token number">2.6</span><span class="token number">.2</span><span class="token variable">-photon</span>       <span class="token string">"/entrypoint.sh serv…"</span>   <span class="token number">22</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>      <span class="token variable">Up</span> <span class="token number">21</span> <span class="token variable">seconds</span>       <span class="token number">5000</span><span class="token block keyword">/tcp</span>                                                           <span class="token variable">registry</span>
<span class="token number">3</span><span class="token variable">a697152024e</span>        <span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-adminserver:v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>   <span class="token string">"/harbor/harbor_admi…"</span>   <span class="token number">22</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>      <span class="token variable">Up</span> <span class="token number">21</span> <span class="token variable">seconds</span>                                                                          <span class="token variable">harbor-adminserver</span>
<span class="token number">19</span><span class="token variable">ab947f7d23</span>        <span class="token variable">vmware</span><span class="token punctuation">/</span><span class="token variable">harbor-log:v1</span><span class="token punctuation">.</span><span class="token number">2.2</span>           <span class="token string">"/bin/sh -c 'crond &amp;…"</span>   <span class="token number">24</span> <span class="token variable">seconds</span> <span class="token variable">ago</span>      <span class="token variable">Up</span> <span class="token number">21</span> <span class="token variable">seconds</span>       <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token variable">:</span><span class="token number">1514</span><span class="token variable">-</span><span class="token punctuation">&gt;</span><span class="token number">514</span><span class="token block keyword">/tcp</span>                                            <span class="token variable">harbor-log</span>
<span class="token string">'//也可以使用docker-compose ps查看容器状态，但是需要在/usr/local/harbor目录下执行'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">pwd</span>
<span class="token punctuation">/</span><span class="token variable">usr</span><span class="token punctuation">/</span><span class="token variable">local</span><span class="token punctuation">/</span><span class="token variable">harbor</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker-compose</span> <span class="token variable">ps</span>
       <span class="token variable">Name</span>                     <span class="token variable">Command</span>               <span class="token variable">State</span>                                <span class="token variable">Ports</span>                              
<span class="token variable">------------------------------------------------------------------------------------------------------------------------------</span>
<span class="token variable">harbor-adminserver</span>   <span class="token punctuation">/</span><span class="token variable">harbor</span><span class="token punctuation">/</span><span class="token variable">harbor_adminserver</span>       <span class="token variable">Up</span>                                                                      
<span class="token variable">harbor-db</span>            <span class="token variable">docker-entrypoint</span><span class="token punctuation">.</span><span class="token variable">sh</span> <span class="token variable">mysqld</span>      <span class="token variable">Up</span>      <span class="token number">3306</span><span class="token block keyword">/tcp</span>                                                        
<span class="token variable">harbor-jobservice</span>    <span class="token punctuation">/</span><span class="token variable">harbor</span><span class="token punctuation">/</span><span class="token variable">harbor_jobservice</span>        <span class="token variable">Up</span>                                                                      
<span class="token variable">harbor-log</span>           <span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">sh</span> <span class="token variable">-c</span> <span class="token variable">crond</span> <span class="token punctuation">&amp;</span><span class="token punctuation">&amp;</span> <span class="token variable">rm</span> <span class="token variable">-f</span>  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token variable">Up</span>      <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token variable">:</span><span class="token number">1514</span><span class="token variable">-</span><span class="token punctuation">&gt;</span><span class="token number">514</span><span class="token block keyword">/tcp</span>                                         
<span class="token variable">harbor-ui</span>            <span class="token punctuation">/</span><span class="token variable">harbor</span><span class="token punctuation">/</span><span class="token variable">harbor_ui</span>                <span class="token variable">Up</span>                                                                      
<span class="token variable">nginx</span>                <span class="token variable">nginx</span> <span class="token variable">-g</span> <span class="token variable">daemon</span> <span class="token variable">off</span><span class="token punctuation">;</span>             <span class="token variable">Up</span>      <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token variable">:</span><span class="token number">443</span><span class="token variable">-</span><span class="token punctuation">&gt;</span><span class="token number">443</span><span class="token block keyword">/tcp,</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token variable">:</span><span class="token number">4443</span><span class="token variable">-</span><span class="token punctuation">&gt;</span><span class="token number">4443</span><span class="token block keyword">/tcp,</span> <span class="token number">0.0</span><span class="token number">.0</span><span class="token number">.0</span><span class="token variable">:</span><span class="token number">80</span><span class="token variable">-</span><span class="token punctuation">&gt;</span><span class="token number">80</span><span class="token block keyword">/tcp</span>
<span class="token variable">registry</span>             <span class="token punctuation">/</span><span class="token variable">entrypoint</span><span class="token punctuation">.</span><span class="token variable">sh</span> <span class="token variable">serve</span> <span class="token punctuation">/</span><span class="token variable">etc</span><span class="token punctuation">/</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>   <span class="token variable">Up</span>      <span class="token number">5000</span><span class="token block keyword">/tcp</span>  
</code></pre> 
<p>上述容器解释<br> harbor-adminserver：harbor系统管理接口，可以修改系统配置以及获取系统信息<br> harbor-db：存储项目的元数据、用户、规则、复制策略等信息<br> harbor-jobservice：harbor里面主要是为了镜像仓库之前同步使用的<br> harbor-log：收集其他harbor的日志信息。rsyslogd<br> harbor-ui：一个用户界面模块，用来管理registry。主要是前端的页面和后端CURD的接口<br> nginx：harbor的一个反向代理组件，代理registry、ui、token等服务。这个代理会转发harbor web和docker client的各种请求到后端服务上。是个nginx。nginx负责流量转发和安全验证，对外提供的流量都是从nginx中转，它将流量分发到后端的ui和正在docker镜像存储的docker registry<br> registry：存储docker images的服务，并且提供pull/push服务。harbor需要对image的访问进行访问控制，当client每次进行pull、push的时候，registry都需要client去token服务获取一个可用的token。<br> redis：存储缓存信息<br> webhook：当registry中的image状态发生变化的时候去记录更新日志、复制等操作。<br> token service：在docker client进行pull/push的时候今天token的发放。</p> 
<h3><a id="3_135"></a>3、测试</h3> 
<p>访问http://192.168.110.132测试网页<br> <img src="https://images2.imgbox.com/f5/df/BbykXVbj_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="4harbor_139"></a>4、harbor服务器字符界面镜像仓库测试</h3> 
<p>此时可使用 Docker 命令在本地通过 127.0.0.1 来登录和推送镜像。默认情况下，Register 服务器在端口 80 上侦听。</p> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">login</span> <span class="token variable">-u</span> <span class="token variable">admin</span> <span class="token variable">-p</span> <span class="token variable">Harbor12345</span> <span class="token variable">http:</span><span class="token punctuation">/</span><span class="token punctuation">/</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span>	<span class="token string">'//登陆harbor字符界面'</span>
<span class="token variable">WARNING</span><span class="token punctuation">!</span> <span class="token variable">Using</span> <span class="token variable">--password</span> <span class="token variable">via</span> <span class="token variable">the</span> <span class="token variable">CLI</span> <span class="token variable">is</span> <span class="token variable">insecure</span><span class="token punctuation">.</span> <span class="token variable">Use</span> <span class="token variable">--password-stdin</span><span class="token punctuation">.</span>
<span class="token variable">WARNING</span><span class="token punctuation">!</span> <span class="token variable">Your</span> <span class="token variable">password</span> <span class="token variable">will</span> <span class="token variable">be</span> <span class="token variable">stored</span> <span class="token variable">unencrypted</span> <span class="token variable">in</span> <span class="token punctuation">/</span><span class="token variable">root</span><span class="token punctuation">/</span><span class="token punctuation">.</span><span class="token variable">docker</span><span class="token punctuation">/</span><span class="token variable">config</span><span class="token punctuation">.</span><span class="token variable">json</span><span class="token punctuation">.</span>
<span class="token variable">Configure</span> <span class="token variable">a</span> <span class="token variable">credential</span> <span class="token variable">helper</span> <span class="token variable">to</span> <span class="token variable">remove</span> <span class="token variable">this</span> <span class="token variable">warning</span><span class="token punctuation">.</span> <span class="token variable">See</span>
<span class="token variable">https:</span><span class="token punctuation">/</span><span class="token punctuation">/</span><span class="token variable">docs</span><span class="token punctuation">.</span><span class="token variable">docker</span><span class="token punctuation">.</span><span class="token variable">com</span><span class="token punctuation">/</span><span class="token variable">engine</span><span class="token punctuation">/</span><span class="token variable">reference</span><span class="token punctuation">/</span><span class="token variable">commandline</span><span class="token punctuation">/</span><span class="token variable">login</span><span class="token punctuation">/</span><span class="token punctuation">#</span><span class="token variable">credentials-store</span>

<span class="token variable">Login</span> <span class="token variable">Succeeded</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">pull</span> <span class="token variable">cirros</span>	<span class="token string">'//先下载一个镜像用于测试'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">tag</span> <span class="token variable">cirros</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token block keyword">/test_project/cirros:v1</span>	<span class="token string">'//将镜像打标签'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">push</span> <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token block keyword">/test_project/cirros:v1</span>	<span class="token string">'//上传镜像'</span>
<span class="token variable">The</span> <span class="token variable">push</span> <span class="token variable">refers</span> <span class="token variable">to</span> <span class="token variable">repository</span> <span class="token punctuation">[</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token block keyword">/test_project/cirros]</span>
<span class="token number">858</span><span class="token variable">d98ac4893:</span> <span class="token variable">Pushed</span> 
<span class="token variable">aa107a407592:</span> <span class="token variable">Pushed</span> 
<span class="token variable">b993cfcfd8fd:</span> <span class="token variable">Pushed</span> 
<span class="token variable">v1:</span> <span class="token variable">digest:</span> <span class="token variable">sha256:c7d58d6d463247a2540b8c10ff012c34fd44342646</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/7f/1f/xxed5ePA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="5clientharbor_162"></a>5、client客户端harbor仓库测试</h3> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">vim</span> <span class="token punctuation">/</span><span class="token variable">usr</span><span class="token punctuation">/</span><span class="token variable">lib</span><span class="token punctuation">/</span><span class="token variable">systemd</span><span class="token punctuation">/</span><span class="token variable">system</span><span class="token punctuation">/</span><span class="token variable">docker</span><span class="token punctuation">.</span><span class="token variable">service</span> 
<span class="token variable">ExecStart</span><span class="token punctuation">=</span><span class="token punctuation">/</span><span class="token variable">usr</span><span class="token punctuation">/</span><span class="token variable">bin</span><span class="token punctuation">/</span><span class="token variable">dockerd</span> <span class="token variable">-H</span> <span class="token variable">fd:</span><span class="token punctuation">/</span><span class="token punctuation">/</span> <span class="token variable">--insecure-registry</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span>  <span class="token variable">--containerd</span><span class="token punctuation">=</span><span class="token punctuation">/</span><span class="token variable">run</span><span class="token punctuation">/</span><span class="token variable">containerd</span><span class="token punctuation">/</span><span class="token variable">containerd</span><span class="token punctuation">.</span><span class="token variable">sock</span>	<span class="token string">'//修改此行，使客户端可以连接harbor服务器'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">login</span> <span class="token variable">-u</span> <span class="token variable">admin</span> <span class="token variable">-p</span> <span class="token variable">Harbor12345</span> <span class="token variable">http:</span><span class="token punctuation">/</span><span class="token punctuation">/</span><span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span>
<span class="token variable">WARNING</span><span class="token punctuation">!</span> <span class="token variable">Using</span> <span class="token variable">--password</span> <span class="token variable">via</span> <span class="token variable">the</span> <span class="token variable">CLI</span> <span class="token variable">is</span> <span class="token variable">insecure</span><span class="token punctuation">.</span> <span class="token variable">Use</span> <span class="token variable">--password-stdin</span><span class="token punctuation">.</span>
<span class="token variable">WARNING</span><span class="token punctuation">!</span> <span class="token variable">Your</span> <span class="token variable">password</span> <span class="token variable">will</span> <span class="token variable">be</span> <span class="token variable">stored</span> <span class="token variable">unencrypted</span> <span class="token variable">in</span> <span class="token punctuation">/</span><span class="token variable">root</span><span class="token punctuation">/</span><span class="token punctuation">.</span><span class="token variable">docker</span><span class="token punctuation">/</span><span class="token variable">config</span><span class="token punctuation">.</span><span class="token variable">json</span><span class="token punctuation">.</span>
<span class="token variable">Configure</span> <span class="token variable">a</span> <span class="token variable">credential</span> <span class="token variable">helper</span> <span class="token variable">to</span> <span class="token variable">remove</span> <span class="token variable">this</span> <span class="token variable">warning</span><span class="token punctuation">.</span> <span class="token variable">See</span>
<span class="token variable">https:</span><span class="token punctuation">/</span><span class="token punctuation">/</span><span class="token variable">docs</span><span class="token punctuation">.</span><span class="token variable">docker</span><span class="token punctuation">.</span><span class="token variable">com</span><span class="token punctuation">/</span><span class="token variable">engine</span><span class="token punctuation">/</span><span class="token variable">reference</span><span class="token punctuation">/</span><span class="token variable">commandline</span><span class="token punctuation">/</span><span class="token variable">login</span><span class="token punctuation">/</span><span class="token punctuation">#</span><span class="token variable">credentials-store</span>

<span class="token variable">Login</span> <span class="token variable">Succeeded</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">pull</span> <span class="token variable">cirros</span>	<span class="token string">'//下载镜像用于测试'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">pull</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v1</span>	<span class="token string">'//尝试下载harbor仓库镜像'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">tag</span> <span class="token variable">cirros</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v2</span>	<span class="token string">'//打一个标签v2，与harbor的v1区别开来'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">push</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v2</span>	<span class="token string">'//上传'</span>
<span class="token variable">The</span> <span class="token variable">push</span> <span class="token variable">refers</span> <span class="token variable">to</span> <span class="token variable">repository</span> <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros]</span>
<span class="token number">858</span><span class="token variable">d98ac4893:</span> <span class="token variable">Layer</span> <span class="token variable">already</span> <span class="token variable">exists</span> 
<span class="token variable">aa107a407592:</span> <span class="token variable">Layer</span> <span class="token variable">already</span> <span class="token variable">exists</span> 
<span class="token variable">b993cfcfd8fd:</span> <span class="token variable">Layer</span> <span class="token variable">already</span> <span class="token variable">exists</span> 
<span class="token variable">v2:</span> <span class="token variable">digest:</span> <span class="token variable">sha256:c7d58d6d463247a2540b8c10ff012c34fd443426462e891b13119a9c66dfd28</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/80/d5/WZaoMxWa_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="harbor_187"></a>三、harbor仓库的维护管理</h2> 
<h3><a id="1Harborcfg_188"></a>1、Harbor.cfg配置文件</h3> 
<p>1、可以使用 docker-compose 来管理 Harbor，命令必须在与 docker-compose.yml 相同的目录中运行。<br> 2、修改harbor.cfg配置文件的时候要注意<br> 请先停止现有的 Harbour 实例并更新 Harbor.cfg；然 后运行 prepare 脚本来填充配置；最后重新创建并启动 Harbour 的实例。</p> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">pwd</span>
<span class="token punctuation">/</span><span class="token variable">usr</span><span class="token punctuation">/</span><span class="token variable">local</span><span class="token punctuation">/</span><span class="token variable">harbor</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker-compose</span> <span class="token variable">down</span> <span class="token variable">-v</span>	<span class="token string">'//关闭删除所有容器'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">vim</span> <span class="token variable">harbor</span><span class="token punctuation">.</span><span class="token variable">cfg</span> 
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token punctuation">.</span><span class="token punctuation">/</span><span class="token variable">prepare</span> 	<span class="token string">'//重新填充配置'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@harbor harbor</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker-compose</span> <span class="token variable">up</span> <span class="token variable">-d</span>	<span class="token string">'//开启容器'</span>
</code></pre> 
<h3><a id="2_203"></a>2、在客户端对镜像进行管理</h3> 
<pre><code class="prism language-handlebars"><span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">rmi</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v2</span>	<span class="token string">'//先删除两个镜像，后面测试下载'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">rmi</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v1</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">logout</span>  <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span>	<span class="token string">'//注销登陆'</span>
<span class="token variable">Removing</span> <span class="token variable">login</span> <span class="token variable">credentials</span> <span class="token variable">for</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">login</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span>	<span class="token string">'//重新登录'</span>
<span class="token variable">Username:</span> <span class="token variable">test001</span>	<span class="token string">'//用户名'</span>
<span class="token variable">Password:</span> 	<span class="token string">'//密码'</span>
<span class="token variable">WARNING</span><span class="token punctuation">!</span> <span class="token variable">Your</span> <span class="token variable">password</span> <span class="token variable">will</span> <span class="token variable">be</span> <span class="token variable">stored</span> <span class="token variable">unencrypted</span> <span class="token variable">in</span> <span class="token punctuation">/</span><span class="token variable">root</span><span class="token punctuation">/</span><span class="token punctuation">.</span><span class="token variable">docker</span><span class="token punctuation">/</span><span class="token variable">config</span><span class="token punctuation">.</span><span class="token variable">json</span><span class="token punctuation">.</span>
<span class="token variable">Configure</span> <span class="token variable">a</span> <span class="token variable">credential</span> <span class="token variable">helper</span> <span class="token variable">to</span> <span class="token variable">remove</span> <span class="token variable">this</span> <span class="token variable">warning</span><span class="token punctuation">.</span> <span class="token variable">See</span>
<span class="token variable">https:</span><span class="token punctuation">/</span><span class="token punctuation">/</span><span class="token variable">docs</span><span class="token punctuation">.</span><span class="token variable">docker</span><span class="token punctuation">.</span><span class="token variable">com</span><span class="token punctuation">/</span><span class="token variable">engine</span><span class="token punctuation">/</span><span class="token variable">reference</span><span class="token punctuation">/</span><span class="token variable">commandline</span><span class="token punctuation">/</span><span class="token variable">login</span><span class="token punctuation">/</span><span class="token punctuation">#</span><span class="token variable">credentials-store</span>

<span class="token variable">Login</span> <span class="token variable">Succeeded</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">pull</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v1</span>	<span class="token string">'//下载成功'</span>
<span class="token variable">v1:</span> <span class="token variable">Pulling</span> <span class="token variable">from</span> <span class="token variable">test_project</span><span class="token punctuation">/</span><span class="token variable">cirros</span>
<span class="token variable">Digest:</span> <span class="token variable">sha256:c7d58d6d463247a2540b8c10ff012c34fd443426462e891b13119a9c66dfd28a</span>
<span class="token variable">Status:</span> <span class="token variable">Downloaded</span> <span class="token variable">newer</span> <span class="token variable">image</span> <span class="token variable">for</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v1</span>
<span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v1</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">iamges</span>
<span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros</span>   <span class="token variable">v1</span>                  <span class="token number">3</span><span class="token variable">c82e4d066cf</span>        <span class="token number">7</span> <span class="token variable">weeks</span> <span class="token variable">ago</span> 
<span class="token variable">cirros</span>                                <span class="token variable">latest</span>              <span class="token number">3</span><span class="token variable">c82e4d066cf</span>        <span class="token number">7</span> <span class="token variable">weeks</span> <span class="token variable">ago</span>         <span class="token number">12.6</span><span class="token variable">MB</span>

<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">tag</span> <span class="token variable">cirros</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v3</span>	<span class="token string">'//打标签'</span>
<span class="token brackets"><span class="token punctuation">[</span><span class="token variable">root@client ~</span><span class="token punctuation">]</span></span><span class="token punctuation">#</span> <span class="token variable">docker</span> <span class="token variable">push</span> <span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros:v3</span>	<span class="token string">'//上传'</span>
<span class="token variable">The</span> <span class="token variable">push</span> <span class="token variable">refers</span> <span class="token variable">to</span> <span class="token variable">repository</span> <span class="token punctuation">[</span><span class="token number">192.168</span><span class="token number">.110</span><span class="token number">.132</span><span class="token block keyword">/test_project/cirros]</span>
<span class="token number">858</span><span class="token variable">d98ac4893:</span> <span class="token variable">Layer</span> <span class="token variable">already</span> <span class="token variable">exists</span> 
<span class="token variable">aa107a407592:</span> <span class="token variable">Layer</span> <span class="token variable">already</span> <span class="token variable">exists</span> 
<span class="token variable">b993cfcfd8fd:</span> <span class="token variable">Layer</span> <span class="token variable">already</span> <span class="token variable">exists</span> 
<span class="token variable">v3:</span> <span class="token variable">digest:</span> <span class="token variable">sha256:c7d58d6d463247a2540b8c10ff012c34fd443426462e891b13119a9c66dfd28a</span> <span class="token variable">size:</span> <span class="token number">943</span>
</code></pre> 
<h3><a id="3harbor_236"></a>3、迁移harbor数据</h3> 
<pre><code class="prism language-handlebars"><span class="token number">1</span><span class="token variable">、先关闭harbor仓库：docker-compose</span> <span class="token variable">down</span> <span class="token variable">-v</span>
<span class="token number">2</span><span class="token variable">、拷贝harbor数据：</span>
<span class="token string">'//持久数据，如镜像，数据库等在宿主机的/data/目录下,日志在宿主机的/var/log/Harbor/目录下'</span>
<span class="token block keyword">/data/database/</span> <span class="token variable">数据库内容，比如身份验证数据</span>

<span class="token punctuation">/</span><span class="token variable">data</span><span class="token punctuation">/</span><span class="token variable">registry</span><span class="token punctuation">/</span> <span class="token variable">镜像文件内容</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e66c825b81c90dc93446c8f67012ffe4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Vue2.0入门详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a97961e343d1a4205d684e61797d2e46/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">wm_paint重绘图像_如何在Windows 10上使用Paint 3D调整图像大小</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>