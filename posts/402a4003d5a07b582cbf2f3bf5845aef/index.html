<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>YOLOv4算法详解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="YOLOv4算法详解" />
<meta property="og:description" content="YOLOv4: Optimal Speed and Accuracy of Object Detection-论文链接-代码链接
目录 1、需求解读2、YOLOv4算法简介3、YOLOv4算法详解3.1 YOLOv4网络架构3.2 YOLOv4实现细节详解3.2.1 YOLOv4基础组件3.2.2 输入端细节详解3.2.3 基准网络细节详解3.2.3 Neck网络细节详解3.2.4 Head网络细节详解 4、YOLOv4代码实现5、YOLOv4效果展示与分析5.1、YOLOv4主观效果展示与分析5.2、YOLOv4客观效果展示与分析 6、总结与分析参考资料注意事项 1、需求解读 作为一种经典的单阶段目标检测框架，YOLO系列的目标检测算法得到了学术界与工业界们的广泛关注。由于YOLO系列属于单阶段目标检测，因而具有较快的推理速度，能够更好的满足现实场景的需求。随着YOLOv3算法的出现，使得YOLO系列的检测算达到了高潮。YOLOv4则是在YOLOv3算法的基础上增加了很多实用的技巧，使得它的速度与精度都得到了极大的提升，本文将对YOLOv4算法的细节进行分析。
2、YOLOv4算法简介 YOLOv4是一种单阶段目标检测算法，该算法在YOLOv3的基础上添加了一些新的改进思路，使得其速度与精度都得到了极大的性能提升。主要的改进思路如下所示：
输入端：在模型训练阶段，做了一些改进操作，主要包括Mosaic数据增强、cmBN、SAT自对抗训练；BackBone基准网络：融合其它检测算法中的一些新思路，主要包括：CSPDarknet53、Mish激活函数、Dropblock；Neck中间层：目标检测网络在BackBone与最后的Head输出层之间往往会插入一些层，Yolov4中添加了SPP模块、FPN&#43;PAN结构；Head输出层：输出层的锚框机制与YOLOv3相同，主要改进的是训练时的损失函数CIOU_Loss，以及预测框筛选的DIOU_nms。 3、YOLOv4算法详解 3.1 YOLOv4网络架构 上图展示了YOLOv4目标检测算法的整体框图。对于一个目标检测算法而言，我们通常可以将其划分为4个通用的模块，具体包括：输入端、基准网络、Neck网络与Head输出端，对应于上图中的4个红色模块。
输入端-输入端表示输入的图片。该网络的输入图像大小为608*608，该阶段通常包含一个图像预处理阶段，即将输入图像缩放到网络的输入大小，并进行归一化等操作。在网络训练阶段，YOLOv4使用Mosaic数据增强操作提升了模型的训练速度和网络的精度；利用cmBN及SAT自对抗训练来提升网络的泛化性能；基准网络-基准网络通常是一些性能优异的分类器种的网络，该模块用来提取一些通用的特征表示。YOLOv4中使用了CSPDarknet53作为基准网络；利用Mish激活函数代替原始的RELU激活函数；并在该模块中增加了Dropblock块来进一步提升模型的泛化能力 。Neck网络-Neck网络通常位于基准网络和头网络的中间位置，利用它可以进一步提升特征的多样性及鲁棒性。YOLOv4利用SPP模块来融合不同尺度大小的特征图；利用自顶向下的FPN特征金字塔于自底向上的PAN特征金字塔来提升网络的特征提取能力。Head输出端-Head用来完成目标检测结果的输出。针对不同的检测算法，输出端的分支个数不尽相同，通常包含一个分类分支和一个回归分支。YOLOv4利用CIOU_Loss来代替Smooth L1 Loss函数，并利用DIOU_nms来代替传统的NMS操作，从而进一步提升算法的检测精度。 3.2 YOLOv4实现细节详解 3.2.1 YOLOv4基础组件 CBM-CBM是Yolov4网络结构中的最小组件，由Conv&#43;BN&#43;Mish激活函数组成，如上图中模块1所示。CBL-CBL模块由Conv&#43;BN&#43;Leaky_relu激活函数组成，如上图中的模块2所示。Res unit-借鉴ResNet网络中的残差结构，用来构建深层网络，CBM是残差模块中的子模块，如上图中的模块3所示。CSPX-借鉴CSPNet网络结构，由卷积层和X个Res unint模块Concate组成而成，如上图中的模块4所示。SPP-采用1×1、5×5、9×9和13×13的最大池化方式，进行多尺度特征融合，如上图中的模块5所示。 3.2.2 输入端细节详解 Mosaic数据增强-YOLOv4中在训练模型阶段使用了Mosaic数据增强方法，该算法是在CutMix数据增强方法的基础上改进而来的。CutMix仅仅利用了两张图片进行拼接，而Mosaic数据增强方法则采用了4张图片，并且按照随机缩放、随机裁剪和随机排布的方式进行拼接而成，具体的效果如下图所示。这种增强方法可以将几张图片组合成一张，这样不仅可以丰富数据集的同时极大的提升网络的训练速度，而且可以降低模型的内存需求。
3.2.3 基准网络细节详解 CSPDarknet53-它是在YOLOv3主干网络Darknet53的基础上，借鉴了2019年发表的CSPNet算法的经验，所形成的一种Backbone结构，其中包含了5个CSP模块。每个CSP模型的实现细节如3.2.1所述。CSP模块可以先将基础层的特征映射划分为两部分，然后通过跨阶段层次结构将它们合并起来，这样不仅减少了计算量，而且可以保证模型的准确率。它的优点包括：（1）增强CNN网络的学习能力，轻量化模型的同时保持模型的精度；（2）降低整个模型的计算瓶颈；（3）降低算法的内存成本。有关CSP模块的更多细节请看该论文。Mish激活函数-该激活函数是在2019年提出的，该函数是在Leaky_relu算法的基础上改进而来的，具体的比较请看下图。当x&gt;0时，Leaky_relu与Mish激活函数基本相同；当x&lt;0时，Mish函数基本为0，而Leaky_relu函数为 λ x \lambda x λx。YOLOv4的Backbone中均使用了Mish激活函数，而后面的Neck网络中则使用了leaky_relu激活函数。总而言之，Mish函数更加平滑一些，可以进一步提升模型的精度。更多的细节请看该论文。
Dropblock-Dropblock是一种解决模型过拟合的正则化方法，它的作用与Dropout基本相同。Dropout的主要思路是随机的使网络中的一些神经元失活，从而形成一个新的网络。如下图所示，最左边表示原始的输入图片，中间表示经过Dropout操作之后的结果，它使得图像中的一些位置随机失活，Dropblock的作者认为：由于卷积层通常是三层结构，即卷积&#43;激活&#43;池化层，池化层本身就是对相邻单元起作用，因而卷积层对于这种随机丢弃并不敏感。除此之外，即使是随机丢弃，卷积层仍然可以从相邻的激活单元学习到相同的信息。因此，在全连接层上效果很好的Dropout在卷积层上效果并不好。最右边表示经过Dropblock操作之后的结果，我们可以发现该操作直接对整个局部区域进行失活（连续的几个位置）。
Dropblock是在Cutout数据增强方式的基础上改进而来的，Cutout的主要思路是将输入图像的部分区域清零，而Dropblock的创新点则是将Cutout应用到每一个特征图上面。而且并不是用固定的归零比率，而是在训练时以一个小的比率开始，随着训练过程线性的增加这个比率。与Cutout相比，Dropblck主要具有以下的优点：（1）实验效果表明Dropblock的效果优于Cutout；（2）Cutout只能应用到输入层，而Dropblock则是将Cutout应用到网络中的每一个特征图上面；（3）Dropblock可以定制各种组合，在训练的不同阶段可以灵活的修改删减的概率，不管是从空间层面还是从时间层面来讲，Dropblock更优一些。 3.2.3 Neck网络细节详解 为了获得更鲁棒的特征表示，通常会在基准网络和输出层之间插入一些层，YOLOv4的主要添加了SPP模块与FPN&#43;PAN2种方式。
SPP模块-SPP模块通过融合不同大小的最大池化层来获得鲁棒的特征表示，YOLOv4中的k={1*1,5*5,9*9,13*13}包含这4种形式。这里的最大池化层采用padding操作，移动步长为1，比如输入特征图的大小为13x13，使用的池化核大小为5x5，padding=2，因此池化后的特征图大小仍然是13×13。YOLOv4论文表明：（1）与单纯的使用k*k最大池化的方式相比，采用SPP模块的方式能够更有效的增加主干特征的接收范围，显著的分离了最重要的上下文特征。（2）在COCO目标检测任务中，当输入图片的大小为608*608时，只需要额外花费0.5%的计算代价就可以将AP50提升2.7%，因此YOLOv4算法中也采用了SPP模块。
FPN&#43;PAN-所谓的FPN，即特征金字塔网络，通过在特征图上面构建金字塔，可以更好的解决目标检测中尺度问题。PAN则是借鉴了图像分割领域PANet算法中的创新点，它是一种自底向上的结构，它在FPN的基础上增加了两个PAN结构，如下图中的2和3所示。（1）整个网络的输入图像大小为608*608；然后经过CSP块之后生成一个76*76大小的特征映射，经过下采样操作之后生成38*38的特征映射，经过下采样操作之后生成19*19的特征映射；（2）接着将其传入FPN结构中，依次对19*19、38*38、76*76执行融合操作，即先对比较小的特征映射层执行上采样操作，将其调整成相同大小，然后将两个同等大小的特征映射叠加起来。通过FPN操作可以将19*19大小的特征映射调整为76*76大小，这样不仅提升了特征映射的大小，可以更好的解决检测中尺度 问题，而且增加了网络的深度，提升了网络的鲁棒性。（3）接着将其传入PAN结构中，PANet网络的PAN结构是将两个相同大小的特征映射执行按位加操作，YOLOv4中使用Concat操作来代替它。经过两个PAN结构，我们将76*76大小的特征映射重新调整为19*19大小，这样可以在一定程度上提升该算法的目标定位能力。FPN层自顶向下可以捕获强语义特征，而PAF则通过自底向上传达强定位特征，通过组合这两个模块，可以很好的完成目标定位的功能。
3.2.4 Head网络细节详解 CIOU_loss-目标检测任务的损失函数一般由分类损失函数和回归损失函数两部分构成，回归损失函数的发展过程主要包括：最原始的Smooth L1 Loss函数、2016年提出的IoU Loss、2019年提出的GIoU Loss、2020年提出的DIoU Loss和最新的CIoU Loss函数。
1、IoU Loss-所谓的IoU Loss，即预测框与GT框之间的交集/预测框与GT框之间的并集。这种损失会存在一些问题，具体的问题如下图所示，（1）如状态1所示，当预测框和GT框不相交时，即IOU=0，此时无法反映两个框之间的距离，此时该 损失函数不可导，即IOU_Loss无法优化两个框不相交的情况。（2）如状态2与状态3所示，当两个预测框大小相同时，那么这两个IOU也相同，IOU_Loss无法区分两者相交这种情况。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/402a4003d5a07b582cbf2f3bf5845aef/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-15T20:37:02+08:00" />
<meta property="article:modified_time" content="2023-03-15T20:37:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">YOLOv4算法详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>YOLOv4: Optimal Speed and Accuracy of Object Detection-<a href="https://arxiv.org/pdf/2004.10934.pdf" rel="nofollow">论文链接</a>-<a href="https://github.com/Tianxiaomo/pytorch-YOLOv4">代码链接</a></strong></p> 
<p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><ul><li><a href="#1_3" rel="nofollow">1、需求解读</a></li><li><a href="#2YOLOv4_6" rel="nofollow">2、YOLOv4算法简介</a></li><li><a href="#3YOLOv4_14" rel="nofollow">3、YOLOv4算法详解</a></li><li><ul><li><a href="#31_YOLOv4_15" rel="nofollow">3.1 YOLOv4网络架构</a></li><li><a href="#32_YOLOv4_24" rel="nofollow">3.2 YOLOv4实现细节详解</a></li><li><ul><li><a href="#321_YOLOv4_25" rel="nofollow">3.2.1 YOLOv4基础组件</a></li><li><a href="#322__32" rel="nofollow">3.2.2 输入端细节详解</a></li><li><a href="#323__35" rel="nofollow">3.2.3 基准网络细节详解</a></li><li><a href="#323_Neck_42" rel="nofollow">3.2.3 Neck网络细节详解</a></li><li><a href="#324_Head_49" rel="nofollow">3.2.4 Head网络细节详解</a></li></ul> 
   </li></ul> 
   </li><li><a href="#4YOLOv4_65" rel="nofollow">4、YOLOv4代码实现</a></li><li><a href="#5YOLOv4_521" rel="nofollow">5、YOLOv4效果展示与分析</a></li><li><ul><li><a href="#51YOLOv4_522" rel="nofollow">5.1、YOLOv4主观效果展示与分析</a></li><li><a href="#52YOLOv4_526" rel="nofollow">5.2、YOLOv4客观效果展示与分析</a></li></ul> 
   </li><li><a href="#6_543" rel="nofollow">6、总结与分析</a></li><li><a href="#_546" rel="nofollow">参考资料</a></li><li><a href="#_551" rel="nofollow">注意事项</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h3><a id="1_3"></a>1、需求解读</h3> 
<p>  作为一种经典的单阶段目标检测框架，YOLO系列的目标检测算法得到了学术界与工业界们的广泛关注。由于YOLO系列属于单阶段目标检测，因而具有较快的推理速度，能够更好的满足现实场景的需求。随着YOLOv3算法的出现，使得YOLO系列的检测算达到了高潮。YOLOv4则是在YOLOv3算法的基础上增加了很多实用的技巧，使得它的速度与精度都得到了极大的提升，本文将对YOLOv4算法的细节进行分析。</p> 
<h3><a id="2YOLOv4_6"></a>2、YOLOv4算法简介</h3> 
<p>  YOLOv4是一种单阶段目标检测算法，该算法在YOLOv3的基础上添加了一些新的改进思路，使得其速度与精度都得到了极大的性能提升。主要的改进思路如下所示：</p> 
<ul><li><strong>输入端</strong>：在模型训练阶段，做了一些改进操作，主要包括<strong>Mosaic数据增强、cmBN、SAT自对抗训练</strong>；</li><li><strong>BackBone基准网络</strong>：融合其它检测算法中的一些新思路，主要包括：<strong>CSPDarknet53、Mish激活函数、Dropblock</strong>；</li><li><strong>Neck中间层</strong>：目标检测网络在BackBone与最后的Head输出层之间往往会插入一些层，Yolov4中添加了<strong>SPP模块、FPN+PAN结构</strong>；</li><li><strong>Head输出层</strong>：输出层的锚框机制与YOLOv3相同，主要改进的是训练时的<strong>损失函数CIOU_Loss</strong>，以及<strong>预测框筛选的DIOU_nms</strong>。</li></ul> 
<h3><a id="3YOLOv4_14"></a>3、YOLOv4算法详解</h3> 
<h4><a id="31_YOLOv4_15"></a>3.1 YOLOv4网络架构</h4> 
<p><img src="https://images2.imgbox.com/a3/22/Rk5LbMmq_o.jpg" alt="在这里插入图片描述"><br>   上图展示了YOLOv4目标检测算法的整体框图。对于一个目标检测算法而言，我们通常可以将其划分为4个通用的模块，具体包括：<strong>输入端、基准网络、Neck网络与Head输出端</strong>，对应于上图中的4个红色模块。</p> 
<ul><li><strong>输入端</strong>-输入端表示输入的图片。该网络的输入图像大小为608*608，该阶段通常包含一个图像预处理阶段，即将输入图像缩放到网络的输入大小，并进行归一化等操作。<strong>在网络训练阶段，YOLOv4使用Mosaic数据增强操作提升了模型的训练速度和网络的精度；利用cmBN及SAT自对抗训练来提升网络的泛化性能；</strong></li><li><strong>基准网络</strong>-基准网络通常是一些性能优异的分类器种的网络，该模块用来提取一些通用的特征表示。<strong>YOLOv4中使用了CSPDarknet53作为基准网络；利用Mish激活函数代替原始的RELU激活函数；并在该模块中增加了Dropblock块来进一步提升模型的泛化能力 。</strong></li><li><strong>Neck网络</strong>-Neck网络通常位于基准网络和头网络的中间位置，利用它可以进一步提升特征的多样性及鲁棒性。<strong>YOLOv4利用SPP模块来融合不同尺度大小的特征图；利用自顶向下的FPN特征金字塔于自底向上的PAN特征金字塔来提升网络的特征提取能力。</strong></li><li><strong>Head输出端</strong>-Head用来完成目标检测结果的输出。针对不同的检测算法，输出端的分支个数不尽相同，通常包含一个分类分支和一个回归分支。<strong>YOLOv4利用CIOU_Loss来代替Smooth L1 Loss函数，并利用DIOU_nms来代替传统的NMS操作，从而进一步提升算法的检测精度。</strong></li></ul> 
<h4><a id="32_YOLOv4_24"></a>3.2 YOLOv4实现细节详解</h4> 
<h5><a id="321_YOLOv4_25"></a>3.2.1 YOLOv4基础组件</h5> 
<ul><li><strong>CBM</strong>-CBM是Yolov4网络结构中的最小组件，由Conv+BN+Mish激活函数组成，如上图中模块1所示。</li><li><strong>CBL</strong>-CBL模块由Conv+BN+Leaky_relu激活函数组成，如上图中的模块2所示。</li><li><strong>Res unit</strong>-借鉴ResNet网络中的残差结构，用来构建深层网络，CBM是残差模块中的子模块，如上图中的模块3所示。</li><li><strong>CSPX</strong>-借鉴CSPNet网络结构，由卷积层和X个Res unint模块Concate组成而成，如上图中的模块4所示。</li><li><strong>SPP</strong>-采用1×1、5×5、9×9和13×13的最大池化方式，进行多尺度特征融合，如上图中的模块5所示。</li></ul> 
<h5><a id="322__32"></a>3.2.2 输入端细节详解</h5> 
<ul><li><strong>Mosaic数据增强</strong>-YOLOv4中在训练模型阶段使用了Mosaic数据增强方法，该算法是在CutMix数据增强方法的基础上改进而来的。CutMix仅仅利用了两张图片进行拼接，而Mosaic数据增强方法则采用了4张图片，并且按照随机缩放、随机裁剪和随机排布的方式进行拼接而成，具体的效果如下图所示。<strong>这种增强方法可以将几张图片组合成一张，这样不仅可以丰富数据集的同时极大的提升网络的训练速度，而且可以降低模型的内存需求。</strong><br> <img src="https://images2.imgbox.com/c5/96/8xYoNSHM_o.jpg" alt="在这里插入图片描述"></li></ul> 
<h5><a id="323__35"></a>3.2.3 基准网络细节详解</h5> 
<ul><li><strong>CSPDarknet53</strong>-它是在YOLOv3主干网络Darknet53的基础上，借鉴了2019年发表的CSPNet算法的经验，所形成的一种Backbone结构，其中包含了5个CSP模块。每个CSP模型的实现细节如3.2.1所述。<strong>CSP模块可以先将基础层的特征映射划分为两部分，然后通过跨阶段层次结构将它们合并起来，这样不仅减少了计算量，而且可以保证模型的准确率。它的优点包括：（1）增强CNN网络的学习能力，轻量化模型的同时保持模型的精度；（2）降低整个模型的计算瓶颈；（3）降低算法的内存成本</strong>。有关CSP模块的更多细节请看<a href="https://arxiv.org/pdf/1911.11929.pdf" rel="nofollow">该论文</a>。</li><li><strong>Mish激活函数</strong>-该激活函数是在2019年提出的，该函数是在Leaky_relu算法的基础上改进而来的，具体的比较请看下图。当x&gt;0时，Leaky_relu与Mish激活函数基本相同；当x&lt;0时，Mish函数基本为0，而Leaky_relu函数为<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          λ 
         
        
          x 
         
        
       
         \lambda x 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.6944em;"></span><span class="mord mathnormal">λ</span><span class="mord mathnormal">x</span></span></span></span></span>。YOLOv4的Backbone中均使用了Mish激活函数，而后面的Neck网络中则使用了leaky_relu激活函数。总而言之，Mish函数更加平滑一些，可以进一步提升模型的精度。更多的细节请看<a href="https://arxiv.org/pdf/1908.08681.pdf" rel="nofollow">该论文</a>。<br> <img src="https://images2.imgbox.com/8c/74/LGTfzWA3_o.jpg" alt="在这里插入图片描述"></li><li><strong>Dropblock</strong>-Dropblock是一种解决模型过拟合的正则化方法，它的作用与Dropout基本相同。Dropout的主要思路是随机的使网络中的一些神经元失活，从而形成一个新的网络。如下图所示，最左边表示原始的输入图片，中间表示经过Dropout操作之后的结果，它使得图像中的一些位置随机失活，<strong>Dropblock的作者认为：由于卷积层通常是三层结构，即卷积+激活+池化层，池化层本身就是对相邻单元起作用，因而卷积层对于这种随机丢弃并不敏感。除此之外，即使是随机丢弃，卷积层仍然可以从相邻的激活单元学习到相同的信息。因此，在全连接层上效果很好的Dropout在卷积层上效果并不好。最右边表示经过Dropblock操作之后的结果，我们可以发现该操作直接对整个局部区域进行失活（连续的几个位置）。</strong><br> <img src="https://images2.imgbox.com/76/78/C4RjYJW3_o.jpg" alt="在这里插入图片描述"><br>   Dropblock是在Cutout数据增强方式的基础上改进而来的，Cutout的主要思路是将输入图像的部分区域清零，而Dropblock的创新点则是将Cutout应用到每一个特征图上面。而且并不是用固定的归零比率，而是在训练时以一个小的比率开始，随着训练过程线性的增加这个比率。与Cutout相比，<strong>Dropblck主要具有以下的优点：（1）实验效果表明Dropblock的效果优于Cutout；（2）Cutout只能应用到输入层，而Dropblock则是将Cutout应用到网络中的每一个特征图上面；（3）Dropblock可以定制各种组合，在训练的不同阶段可以灵活的修改删减的概率，不管是从空间层面还是从时间层面来讲，Dropblock更优一些。</strong></li></ul> 
<h5><a id="323_Neck_42"></a>3.2.3 Neck网络细节详解</h5> 
<p>  为了获得更鲁棒的特征表示，通常会在基准网络和输出层之间插入一些层，YOLOv4的主要添加了SPP模块与FPN+PAN2种方式。</p> 
<ul><li> <p><strong>SPP模块</strong>-SPP模块通过融合不同大小的最大池化层来获得鲁棒的特征表示，YOLOv4中的k={1*1,5*5,9*9,13*13}包含这4种形式。这里的最大池化层采用padding操作，移动步长为1，比如输入特征图的大小为13x13，使用的池化核大小为5x5，padding=2，因此池化后的特征图大小仍然是13×13。YOLOv4论文表明：（<strong>1）与单纯的使用k*k最大池化的方式相比，采用SPP模块的方式能够更有效的增加主干特征的接收范围，显著的分离了最重要的上下文特征。（2）在COCO目标检测任务中，当输入图片的大小为608*608时，只需要额外花费0.5%的计算代价就可以将AP50提升2.7%，因此YOLOv4算法中也采用了SPP模块。</strong><br> <img src="https://images2.imgbox.com/1b/92/iYRPigSi_o.jpg" alt="在这里插入图片描述"></p> </li><li> <p><strong>FPN+PAN</strong>-所谓的FPN，即特征金字塔网络，通过在特征图上面构建金字塔，可以更好的解决目标检测中尺度问题。PAN则是借鉴了图像分割领域PANet算法中的创新点，它是一种自底向上的结构，它在FPN的基础上增加了两个PAN结构，如下图中的2和3所示。（1）整个网络的输入图像大小为608*608；然后经过CSP块之后生成一个76*76大小的特征映射，经过下采样操作之后生成38*38的特征映射，经过下采样操作之后生成19*19的特征映射；（2）接着将其传入FPN结构中，依次对19*19、38*38、76*76执行融合操作，即先对比较小的特征映射层执行上采样操作，将其调整成相同大小，然后将两个同等大小的特征映射叠加起来。通过FPN操作可以将19*19大小的特征映射调整为76*76大小，这样不仅提升了特征映射的大小，可以更好的解决检测中尺度 问题，而且增加了网络的深度，提升了网络的鲁棒性。（3）接着将其传入PAN结构中，PANet网络的PAN结构是将两个相同大小的特征映射执行按位加操作，YOLOv4中使用Concat操作来代替它。经过两个PAN结构，我们将76*76大小的特征映射重新调整为19*19大小，这样可以在一定程度上提升该算法的目标定位能力。<strong>FPN层自顶向下可以捕获强语义特征，而PAF则通过自底向上传达强定位特征，通过组合这两个模块，可以很好的完成目标定位的功能。</strong><br> <img src="https://images2.imgbox.com/35/64/gCCTos6q_o.jpg" alt="在这里插入图片描述"></p> </li></ul> 
<h5><a id="324_Head_49"></a>3.2.4 Head网络细节详解</h5> 
<ul><li><strong>CIOU_loss</strong>-目标检测任务的损失函数一般由分类损失函数和回归损失函数两部分构成，回归损失函数的发展过程主要包括：最原始的Smooth L1 Loss函数、2016年提出的IoU Loss、2019年提出的GIoU Loss、2020年提出的DIoU Loss和最新的CIoU Loss函数。<br> 1、<strong>IoU Loss</strong>-所谓的IoU Loss，即预测框与GT框之间的交集/预测框与GT框之间的并集。这种损失会存在一些问题，具体的问题如下图所示，（1）如状态1所示，当预测框和GT框不相交时，即IOU=0，此时无法反映两个框之间的距离，此时该 损失函数不可导，即IOU_Loss无法优化两个框不相交的情况。（2）如状态2与状态3所示，当两个预测框大小相同时，那么这两个IOU也相同，IOU_Loss无法区分两者相交这种情况。<br> <img src="https://images2.imgbox.com/fe/75/fBnmnUpw_o.jpg" alt="在这里插入图片描述"><br> 2、<strong>GIOU_Loss</strong>-为了解决以上的问题，GIOU损失应运而生。GIOU_Loss中增加了相交尺度的衡量方式，缓解了单纯IOU_Loss时存在的一些问题。<br> <img src="https://images2.imgbox.com/85/a4/RBXTUmVJ_o.jpg" alt="在这里插入图片描述"><br> 但是这种方法并不能完全解决这种问题，仍然存在着其它的问题。具体的问题如下所示，状态1、2、3都是预测框在GT框内部且预测框大小一致的情况，这时预测框和GT框的差集都是相同的，因此这三种状态的GIOU值也都是相同的，这时GIOU退化成了IOU，无法区分相对位置关系。<br> <img src="https://images2.imgbox.com/4c/4a/96rEwypw_o.jpg" alt="在这里插入图片描述">3、<strong>DIOU_Loss</strong>-针对IOU和GIOU损失所存在的问题，DIOU为了解决如何最小化预测框和GT框之间的归一化距离这个问题，DIOU_Loss考虑了预测框与GT框的重叠面积和中心点距离，当GT框包裹预测框的时候，直接度量2个框的距离，因此DIOU_Loss的收敛速度更快一些。<br> <img src="https://images2.imgbox.com/1b/7b/IQrsakIR_o.jpg" alt="在这里插入图片描述"><br> 如下图所示，当GT框包裹预测框时，此时预测框的中心点的位置都是一样的，因此按照DIOU_Loss的计算公式，三者的值都是相同的。为了解决这个问题，CIOU_Loss应运而生。<br> <img src="https://images2.imgbox.com/80/9e/szXy6o8p_o.jpg" alt="在这里插入图片描述"><br> 4、<strong>CIOU_Loss</strong>-CIOU_Loss在DIOU_Loss的基础上增加了一个影响因子，将预测框和GT框的长宽比也考虑了进来。具体的计算方法如下式所示，即CIOU_Loss将GT框的重叠面积、中心点距离和长宽比全都考虑进来了。<br> <img src="https://images2.imgbox.com/42/b0/ZnpiXG4Z_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/65/d8/0SgCkPfZ_o.png" alt="在这里插入图片描述"><br>   <strong>总而言之，IOU_Loss主要考虑了检测框和GT框之间的重叠面积；GIOU_Loss在IOU的基础上，解决边界框不重合时出现的问题；DIOU_Loss在IOU和GIOU的基础上，同时考虑了边界框中心点距离信息；CIOU_Loss在DIOU的基础上，又考虑了边界框宽高比的尺度信息。</strong></li><li><strong>DIOU_NMS</strong>-如下图所示，对于重叠的摩托车检测任务而言，传统的NMS操作会遗漏掉一些中间的摩托车；由于DIOU_NMS考虑到边界框中心点的位置信息，因而得到了更准确的检测结果，适合处理密集场景下的目标检测问题。<br> <img src="https://images2.imgbox.com/b3/b2/giUeFWKN_o.jpg" alt="在这里插入图片描述"></li></ul> 
<h3><a id="4YOLOv4_65"></a>4、YOLOv4代码实现</h3> 
<pre><code class="prism language-python">  
<span class="token comment"># 导入对应的python三方包</span>
<span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch <span class="token keyword">import</span> nn
<span class="token keyword">import</span> torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional <span class="token keyword">as</span> F
<span class="token keyword">from</span> tool<span class="token punctuation">.</span>torch_utils <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> tool<span class="token punctuation">.</span>yolo_layer <span class="token keyword">import</span> YoloLayer

<span class="token comment"># Mish激活函数类</span>
<span class="token keyword">class</span> <span class="token class-name">Mish</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> x <span class="token operator">*</span> <span class="token punctuation">(</span>torch<span class="token punctuation">.</span>tanh<span class="token punctuation">(</span>torch<span class="token punctuation">.</span>nn<span class="token punctuation">.</span>functional<span class="token punctuation">.</span>softplus<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

<span class="token comment"># 上采样操作类</span>
<span class="token keyword">class</span> <span class="token class-name">Upsample</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span>Upsample<span class="token punctuation">,</span> self<span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">,</span> target_size<span class="token punctuation">,</span> inference<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">assert</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dim<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">)</span>
        <span class="token comment"># _, _, tH, tW = target_size</span>

        <span class="token keyword">if</span> inference<span class="token punctuation">:</span>

            <span class="token comment">#B = x.data.size(0)</span>
            <span class="token comment">#C = x.data.size(1)</span>
            <span class="token comment">#H = x.data.size(2)</span>
            <span class="token comment">#W = x.data.size(3)</span>

            <span class="token keyword">return</span> x<span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>\
                    expand<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target_size<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">//</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target_size<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">//</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>\
                    contiguous<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>view<span class="token punctuation">(</span>x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> target_size<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> target_size<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> F<span class="token punctuation">.</span>interpolate<span class="token punctuation">(</span>x<span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token punctuation">(</span>target_size<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> target_size<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'nearest'</span><span class="token punctuation">)</span>

<span class="token comment"># Conv+BN+Activation模块</span>
<span class="token keyword">class</span> <span class="token class-name">Conv_Bn_Activation</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> activation<span class="token punctuation">,</span> bn<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        pad <span class="token operator">=</span> <span class="token punctuation">(</span>kernel_size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">//</span> <span class="token number">2</span>

        self<span class="token punctuation">.</span>conv <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> bias<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>conv<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> pad<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>conv<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Conv2d<span class="token punctuation">(</span>in_channels<span class="token punctuation">,</span> out_channels<span class="token punctuation">,</span> kernel_size<span class="token punctuation">,</span> stride<span class="token punctuation">,</span> pad<span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> bn<span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>conv<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>BatchNorm2d<span class="token punctuation">(</span>out_channels<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> activation <span class="token operator">==</span> <span class="token string">"mish"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>conv<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Mish<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> activation <span class="token operator">==</span> <span class="token string">"relu"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>conv<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>ReLU<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> activation <span class="token operator">==</span> <span class="token string">"leaky"</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>conv<span class="token punctuation">.</span>append<span class="token punctuation">(</span>nn<span class="token punctuation">.</span>LeakyReLU<span class="token punctuation">(</span><span class="token number">0.1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">elif</span> activation <span class="token operator">==</span> <span class="token string">"linear"</span><span class="token punctuation">:</span>
            <span class="token keyword">pass</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"activate error !!! {} {} {}"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>_getframe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>f_code<span class="token punctuation">.</span>co_filename<span class="token punctuation">,</span>
                                                       sys<span class="token punctuation">.</span>_getframe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>f_code<span class="token punctuation">.</span>co_name<span class="token punctuation">,</span> sys<span class="token punctuation">.</span>_getframe<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>f_lineno<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> l <span class="token keyword">in</span> self<span class="token punctuation">.</span>conv<span class="token punctuation">:</span>
            x <span class="token operator">=</span> l<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x

<span class="token comment"># Res残差块类</span>
<span class="token keyword">class</span> <span class="token class-name">ResBlock</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    Sequential residual blocks each of which consists of \
    two convolution layers.
    Args:
        ch (int): number of input and output channels.
        nblocks (int): number of residual blocks.
        shortcut (bool): if True, residual tensor addition is enabled.
    """</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> nblocks<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> shortcut<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>shortcut <span class="token operator">=</span> shortcut
        self<span class="token punctuation">.</span>module_list <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>nblocks<span class="token punctuation">)</span><span class="token punctuation">:</span>
            resblock_one <span class="token operator">=</span> nn<span class="token punctuation">.</span>ModuleList<span class="token punctuation">(</span><span class="token punctuation">)</span>
            resblock_one<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Conv_Bn_Activation<span class="token punctuation">(</span>ch<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            resblock_one<span class="token punctuation">.</span>append<span class="token punctuation">(</span>Conv_Bn_Activation<span class="token punctuation">(</span>ch<span class="token punctuation">,</span> ch<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>module_list<span class="token punctuation">.</span>append<span class="token punctuation">(</span>resblock_one<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> module <span class="token keyword">in</span> self<span class="token punctuation">.</span>module_list<span class="token punctuation">:</span>
            h <span class="token operator">=</span> x
            <span class="token keyword">for</span> res <span class="token keyword">in</span> module<span class="token punctuation">:</span>
                h <span class="token operator">=</span> res<span class="token punctuation">(</span>h<span class="token punctuation">)</span>
            x <span class="token operator">=</span> x <span class="token operator">+</span> h <span class="token keyword">if</span> self<span class="token punctuation">.</span>shortcut <span class="token keyword">else</span> h
        <span class="token keyword">return</span> x

<span class="token comment"># 下采样方法1</span>
<span class="token keyword">class</span> <span class="token class-name">DownSample1</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        <span class="token comment"># [route]</span>
        <span class="token comment"># layers = -2</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv6 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        <span class="token comment"># [shortcut]</span>
        <span class="token comment"># from=-3</span>
        <span class="token comment"># activation = linear</span>

        self<span class="token punctuation">.</span>conv7 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        <span class="token comment"># [route]</span>
        <span class="token comment"># layers = -1, -7</span>
        self<span class="token punctuation">.</span>conv8 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
        x3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x2<span class="token punctuation">)</span>
        <span class="token comment"># route -2</span>
        x4 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>x2<span class="token punctuation">)</span>
        x5 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x4<span class="token punctuation">)</span>
        x6 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv6<span class="token punctuation">(</span>x5<span class="token punctuation">)</span>
        <span class="token comment"># shortcut -3</span>
        x6 <span class="token operator">=</span> x6 <span class="token operator">+</span> x4

        x7 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv7<span class="token punctuation">(</span>x6<span class="token punctuation">)</span>
        <span class="token comment"># [route]</span>
        <span class="token comment"># layers = -1, -7</span>
        x7 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x7<span class="token punctuation">,</span> x3<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        x8 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv8<span class="token punctuation">(</span>x7<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x8

<span class="token comment"># 下采样方法2</span>
<span class="token keyword">class</span> <span class="token class-name">DownSample2</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        <span class="token comment"># r -2</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>resblock <span class="token operator">=</span> ResBlock<span class="token punctuation">(</span>ch<span class="token operator">=</span><span class="token number">64</span><span class="token punctuation">,</span> nblocks<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token comment"># s -3</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        <span class="token comment"># r -1 -10</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
        x3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>

        r <span class="token operator">=</span> self<span class="token punctuation">.</span>resblock<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
        x4 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>r<span class="token punctuation">)</span>

        x4 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x4<span class="token punctuation">,</span> x2<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        x5 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x4<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x5

<span class="token comment"># 下采样方法3</span>
<span class="token keyword">class</span> <span class="token class-name">DownSample3</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>resblock <span class="token operator">=</span> ResBlock<span class="token punctuation">(</span>ch<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">,</span> nblocks<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
        x3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>

        r <span class="token operator">=</span> self<span class="token punctuation">.</span>resblock<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
        x4 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>r<span class="token punctuation">)</span>

        x4 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x4<span class="token punctuation">,</span> x2<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        x5 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x4<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x5

<span class="token comment"># 下采样方法4</span>
<span class="token keyword">class</span> <span class="token class-name">DownSample4</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>resblock <span class="token operator">=</span> ResBlock<span class="token punctuation">(</span>ch<span class="token operator">=</span><span class="token number">256</span><span class="token punctuation">,</span> nblocks<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
        x3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>

        r <span class="token operator">=</span> self<span class="token punctuation">.</span>resblock<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
        x4 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>r<span class="token punctuation">)</span>

        x4 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x4<span class="token punctuation">,</span> x2<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        x5 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x4<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x5

<span class="token comment"># 下采样方法5</span>
<span class="token keyword">class</span> <span class="token class-name">DownSample5</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>resblock <span class="token operator">=</span> ResBlock<span class="token punctuation">(</span>ch<span class="token operator">=</span><span class="token number">512</span><span class="token punctuation">,</span> nblocks<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'mish'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
        x3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>

        r <span class="token operator">=</span> self<span class="token punctuation">.</span>resblock<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
        x4 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>r<span class="token punctuation">)</span>

        x4 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x4<span class="token punctuation">,</span> x2<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        x5 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x4<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x5

<span class="token comment"># Neck网络类</span>
<span class="token keyword">class</span> <span class="token class-name">Neck</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inference<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inference <span class="token operator">=</span> inference

        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        <span class="token comment"># SPP</span>
        self<span class="token punctuation">.</span>maxpool1 <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">5</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>maxpool2 <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">9</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>maxpool3 <span class="token operator">=</span> nn<span class="token punctuation">.</span>MaxPool2d<span class="token punctuation">(</span>kernel_size<span class="token operator">=</span><span class="token number">13</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> padding<span class="token operator">=</span><span class="token number">13</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span>

        <span class="token comment"># R -1 -3 -5 -6</span>
        <span class="token comment"># SPP</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">2048</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv6 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv7 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        <span class="token comment"># UP</span>
        self<span class="token punctuation">.</span>upsample1 <span class="token operator">=</span> Upsample<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># R 85</span>
        self<span class="token punctuation">.</span>conv8 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        <span class="token comment"># R -1 -3</span>
        self<span class="token punctuation">.</span>conv9 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv10 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv11 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv12 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv13 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv14 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        <span class="token comment"># UP</span>
        self<span class="token punctuation">.</span>upsample2 <span class="token operator">=</span> Upsample<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># R 54</span>
        self<span class="token punctuation">.</span>conv15 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        <span class="token comment"># R -1 -3</span>
        self<span class="token punctuation">.</span>conv16 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv17 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv18 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv19 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv20 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">,</span> downsample4<span class="token punctuation">,</span> downsample3<span class="token punctuation">,</span> inference<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>
        x3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>x2<span class="token punctuation">)</span>
        <span class="token comment"># SPP</span>
        m1 <span class="token operator">=</span> self<span class="token punctuation">.</span>maxpool1<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
        m2 <span class="token operator">=</span> self<span class="token punctuation">.</span>maxpool2<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
        m3 <span class="token operator">=</span> self<span class="token punctuation">.</span>maxpool3<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
        spp <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>m3<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> m1<span class="token punctuation">,</span> x3<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        <span class="token comment"># SPP end</span>
        x4 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>spp<span class="token punctuation">)</span>
        x5 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x4<span class="token punctuation">)</span>
        x6 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv6<span class="token punctuation">(</span>x5<span class="token punctuation">)</span>
        x7 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv7<span class="token punctuation">(</span>x6<span class="token punctuation">)</span>
        <span class="token comment"># UP</span>
        up <span class="token operator">=</span> self<span class="token punctuation">.</span>upsample1<span class="token punctuation">(</span>x7<span class="token punctuation">,</span> downsample4<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>inference<span class="token punctuation">)</span>
        <span class="token comment"># R 85</span>
        x8 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv8<span class="token punctuation">(</span>downsample4<span class="token punctuation">)</span>
        <span class="token comment"># R -1 -3</span>
        x8 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x8<span class="token punctuation">,</span> up<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        x9 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv9<span class="token punctuation">(</span>x8<span class="token punctuation">)</span>
        x10 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv10<span class="token punctuation">(</span>x9<span class="token punctuation">)</span>
        x11 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv11<span class="token punctuation">(</span>x10<span class="token punctuation">)</span>
        x12 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv12<span class="token punctuation">(</span>x11<span class="token punctuation">)</span>
        x13 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv13<span class="token punctuation">(</span>x12<span class="token punctuation">)</span>
        x14 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv14<span class="token punctuation">(</span>x13<span class="token punctuation">)</span>

        <span class="token comment"># UP</span>
        up <span class="token operator">=</span> self<span class="token punctuation">.</span>upsample2<span class="token punctuation">(</span>x14<span class="token punctuation">,</span> downsample3<span class="token punctuation">.</span>size<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>inference<span class="token punctuation">)</span>
        <span class="token comment"># R 54</span>
        x15 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv15<span class="token punctuation">(</span>downsample3<span class="token punctuation">)</span>
        <span class="token comment"># R -1 -3</span>
        x15 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x15<span class="token punctuation">,</span> up<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        x16 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv16<span class="token punctuation">(</span>x15<span class="token punctuation">)</span>
        x17 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv17<span class="token punctuation">(</span>x16<span class="token punctuation">)</span>
        x18 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv18<span class="token punctuation">(</span>x17<span class="token punctuation">)</span>
        x19 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv19<span class="token punctuation">(</span>x18<span class="token punctuation">)</span>
        x20 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv20<span class="token punctuation">(</span>x19<span class="token punctuation">)</span>
        <span class="token keyword">return</span> x20<span class="token punctuation">,</span> x13<span class="token punctuation">,</span> x6

<span class="token comment"># Head网络类</span>
<span class="token keyword">class</span> <span class="token class-name">Yolov4Head</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> output_ch<span class="token punctuation">,</span> n_classes<span class="token punctuation">,</span> inference<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>inference <span class="token operator">=</span> inference

        self<span class="token punctuation">.</span>conv1 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv2 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> output_ch<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'linear'</span><span class="token punctuation">,</span> bn<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>yolo1 <span class="token operator">=</span> YoloLayer<span class="token punctuation">(</span>
                                anchor_mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num_classes<span class="token operator">=</span>n_classes<span class="token punctuation">,</span>
                                anchors<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token number">243</span><span class="token punctuation">,</span> <span class="token number">459</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                num_anchors<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">8</span><span class="token punctuation">)</span>

        <span class="token comment"># R -4</span>
        self<span class="token punctuation">.</span>conv3 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>

        <span class="token comment"># R -1 -16</span>
        self<span class="token punctuation">.</span>conv4 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv5 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv6 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv7 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv8 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv9 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv10 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> output_ch<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'linear'</span><span class="token punctuation">,</span> bn<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>yolo2 <span class="token operator">=</span> YoloLayer<span class="token punctuation">(</span>
                                anchor_mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num_classes<span class="token operator">=</span>n_classes<span class="token punctuation">,</span>
                                anchors<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token number">243</span><span class="token punctuation">,</span> <span class="token number">459</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                num_anchors<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">16</span><span class="token punctuation">)</span>

        <span class="token comment"># R -4</span>
        self<span class="token punctuation">.</span>conv11 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">256</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>

        <span class="token comment"># R -1 -37</span>
        self<span class="token punctuation">.</span>conv12 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv13 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv14 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv15 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv16 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv17 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">512</span><span class="token punctuation">,</span> <span class="token number">1024</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'leaky'</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>conv18 <span class="token operator">=</span> Conv_Bn_Activation<span class="token punctuation">(</span><span class="token number">1024</span><span class="token punctuation">,</span> output_ch<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'linear'</span><span class="token punctuation">,</span> bn<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> bias<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
        
        self<span class="token punctuation">.</span>yolo3 <span class="token operator">=</span> YoloLayer<span class="token punctuation">(</span>
                                anchor_mask<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">,</span> num_classes<span class="token operator">=</span>n_classes<span class="token punctuation">,</span>
                                anchors<span class="token operator">=</span><span class="token punctuation">[</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> <span class="token number">19</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token number">36</span><span class="token punctuation">,</span> <span class="token number">75</span><span class="token punctuation">,</span> <span class="token number">76</span><span class="token punctuation">,</span> <span class="token number">55</span><span class="token punctuation">,</span> <span class="token number">72</span><span class="token punctuation">,</span> <span class="token number">146</span><span class="token punctuation">,</span> <span class="token number">142</span><span class="token punctuation">,</span> <span class="token number">110</span><span class="token punctuation">,</span> <span class="token number">192</span><span class="token punctuation">,</span> <span class="token number">243</span><span class="token punctuation">,</span> <span class="token number">459</span><span class="token punctuation">,</span> <span class="token number">401</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                                num_anchors<span class="token operator">=</span><span class="token number">9</span><span class="token punctuation">,</span> stride<span class="token operator">=</span><span class="token number">32</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> input1<span class="token punctuation">,</span> input2<span class="token punctuation">,</span> input3<span class="token punctuation">)</span><span class="token punctuation">:</span>
        x1 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv1<span class="token punctuation">(</span>input1<span class="token punctuation">)</span>
        x2 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv2<span class="token punctuation">(</span>x1<span class="token punctuation">)</span>

        x3 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv3<span class="token punctuation">(</span>input1<span class="token punctuation">)</span>
        <span class="token comment"># R -1 -16</span>
        x3 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x3<span class="token punctuation">,</span> input2<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
        x4 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv4<span class="token punctuation">(</span>x3<span class="token punctuation">)</span>
        x5 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv5<span class="token punctuation">(</span>x4<span class="token punctuation">)</span>
        x6 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv6<span class="token punctuation">(</span>x5<span class="token punctuation">)</span>
        x7 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv7<span class="token punctuation">(</span>x6<span class="token punctuation">)</span>
        x8 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv8<span class="token punctuation">(</span>x7<span class="token punctuation">)</span>
        x9 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv9<span class="token punctuation">(</span>x8<span class="token punctuation">)</span>
        x10 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv10<span class="token punctuation">(</span>x9<span class="token punctuation">)</span>

        <span class="token comment"># R -4</span>
        x11 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv11<span class="token punctuation">(</span>x8<span class="token punctuation">)</span>
        <span class="token comment"># R -1 -37</span>
        x11 <span class="token operator">=</span> torch<span class="token punctuation">.</span>cat<span class="token punctuation">(</span><span class="token punctuation">[</span>x11<span class="token punctuation">,</span> input3<span class="token punctuation">]</span><span class="token punctuation">,</span> dim<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

        x12 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv12<span class="token punctuation">(</span>x11<span class="token punctuation">)</span>
        x13 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv13<span class="token punctuation">(</span>x12<span class="token punctuation">)</span>
        x14 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv14<span class="token punctuation">(</span>x13<span class="token punctuation">)</span>
        x15 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv15<span class="token punctuation">(</span>x14<span class="token punctuation">)</span>
        x16 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv16<span class="token punctuation">(</span>x15<span class="token punctuation">)</span>
        x17 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv17<span class="token punctuation">(</span>x16<span class="token punctuation">)</span>
        x18 <span class="token operator">=</span> self<span class="token punctuation">.</span>conv18<span class="token punctuation">(</span>x17<span class="token punctuation">)</span>
        
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>inference<span class="token punctuation">:</span>
            y1 <span class="token operator">=</span> self<span class="token punctuation">.</span>yolo1<span class="token punctuation">(</span>x2<span class="token punctuation">)</span>
            y2 <span class="token operator">=</span> self<span class="token punctuation">.</span>yolo2<span class="token punctuation">(</span>x10<span class="token punctuation">)</span>
            y3 <span class="token operator">=</span> self<span class="token punctuation">.</span>yolo3<span class="token punctuation">(</span>x18<span class="token punctuation">)</span>

            <span class="token keyword">return</span> get_region_boxes<span class="token punctuation">(</span><span class="token punctuation">[</span>y1<span class="token punctuation">,</span> y2<span class="token punctuation">,</span> y3<span class="token punctuation">]</span><span class="token punctuation">)</span>
        
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span>x2<span class="token punctuation">,</span> x10<span class="token punctuation">,</span> x18<span class="token punctuation">]</span>

<span class="token comment"># 整个Yolov4网络类</span>
<span class="token keyword">class</span> <span class="token class-name">Yolov4</span><span class="token punctuation">(</span>nn<span class="token punctuation">.</span>Module<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> yolov4conv137weight<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> n_classes<span class="token operator">=</span><span class="token number">80</span><span class="token punctuation">,</span> inference<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

        output_ch <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">4</span> <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">+</span> n_classes<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">3</span>

        <span class="token comment"># backbone</span>
        self<span class="token punctuation">.</span>down1 <span class="token operator">=</span> DownSample1<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>down2 <span class="token operator">=</span> DownSample2<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>down3 <span class="token operator">=</span> DownSample3<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>down4 <span class="token operator">=</span> DownSample4<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>down5 <span class="token operator">=</span> DownSample5<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment"># neck</span>
        self<span class="token punctuation">.</span>neek <span class="token operator">=</span> Neck<span class="token punctuation">(</span>inference<span class="token punctuation">)</span>
        <span class="token comment"># yolov4conv137</span>
        <span class="token keyword">if</span> yolov4conv137weight<span class="token punctuation">:</span>
            _model <span class="token operator">=</span> nn<span class="token punctuation">.</span>Sequential<span class="token punctuation">(</span>self<span class="token punctuation">.</span>down1<span class="token punctuation">,</span> self<span class="token punctuation">.</span>down2<span class="token punctuation">,</span> self<span class="token punctuation">.</span>down3<span class="token punctuation">,</span> self<span class="token punctuation">.</span>down4<span class="token punctuation">,</span> self<span class="token punctuation">.</span>down5<span class="token punctuation">,</span> self<span class="token punctuation">.</span>neek<span class="token punctuation">)</span>
            pretrained_dict <span class="token operator">=</span> torch<span class="token punctuation">.</span>load<span class="token punctuation">(</span>yolov4conv137weight<span class="token punctuation">)</span>

            model_dict <span class="token operator">=</span> _model<span class="token punctuation">.</span>state_dict<span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token comment"># 1. filter out unnecessary keys</span>
            pretrained_dict <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>k1<span class="token punctuation">:</span> v <span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">,</span> k1 <span class="token keyword">in</span> <span class="token builtin">zip</span><span class="token punctuation">(</span>pretrained_dict<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> model_dict<span class="token punctuation">)</span><span class="token punctuation">}</span>
            <span class="token comment"># 2. overwrite entries in the existing state dict</span>
            model_dict<span class="token punctuation">.</span>update<span class="token punctuation">(</span>pretrained_dict<span class="token punctuation">)</span>
            _model<span class="token punctuation">.</span>load_state_dict<span class="token punctuation">(</span>model_dict<span class="token punctuation">)</span>
        
        <span class="token comment"># head</span>
        self<span class="token punctuation">.</span>head <span class="token operator">=</span> Yolov4Head<span class="token punctuation">(</span>output_ch<span class="token punctuation">,</span> n_classes<span class="token punctuation">,</span> inference<span class="token punctuation">)</span>


    <span class="token keyword">def</span> <span class="token function">forward</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token builtin">input</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        d1 <span class="token operator">=</span> self<span class="token punctuation">.</span>down1<span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">)</span>
        d2 <span class="token operator">=</span> self<span class="token punctuation">.</span>down2<span class="token punctuation">(</span>d1<span class="token punctuation">)</span>
        d3 <span class="token operator">=</span> self<span class="token punctuation">.</span>down3<span class="token punctuation">(</span>d2<span class="token punctuation">)</span>
        d4 <span class="token operator">=</span> self<span class="token punctuation">.</span>down4<span class="token punctuation">(</span>d3<span class="token punctuation">)</span>
        d5 <span class="token operator">=</span> self<span class="token punctuation">.</span>down5<span class="token punctuation">(</span>d4<span class="token punctuation">)</span>

        x20<span class="token punctuation">,</span> x13<span class="token punctuation">,</span> x6 <span class="token operator">=</span> self<span class="token punctuation">.</span>neek<span class="token punctuation">(</span>d5<span class="token punctuation">,</span> d4<span class="token punctuation">,</span> d3<span class="token punctuation">)</span>

        output <span class="token operator">=</span> self<span class="token punctuation">.</span>head<span class="token punctuation">(</span>x20<span class="token punctuation">,</span> x13<span class="token punctuation">,</span> x6<span class="token punctuation">)</span>
        <span class="token keyword">return</span> output
</code></pre> 
<h3><a id="5YOLOv4_521"></a>5、YOLOv4效果展示与分析</h3> 
<h4><a id="51YOLOv4_522"></a>5.1、YOLOv4主观效果展示与分析</h4> 
<p></p> 
<div class="csdn-video-box"> 
 <iframe id="xwFsWUVe-1612968774972" frameborder="0" src="https://player.bilibili.com/player.html?aid=926809101" allowfullscreen="true" data-mediaembed="bilibili"></iframe> 
 <p>Yolov4视频检测实例</p> 
</div> 
<p></p> 
<h4><a id="52YOLOv4_526"></a>5.2、YOLOv4客观效果展示与分析</h4> 
<p><img src="https://images2.imgbox.com/a4/f4/v5EzklHb_o.jpg" alt="在这里插入图片描述"><br>   上图展示了不同的数据增强操作对CSPResNeXt-50分类器的精度影响。通过观察我们可以发现：（1）使用CutMix数据增强操作之后，CSPResNeXt-50分类器的top1与top5精度都得到了较大的提升；（2）与CutMix数据增强操作相比，使用Mosaic数据增强操作之后，CSPResNeXt-50分类器能够获得进一步的提升；（3）同时使用CutMix、Mosaic、Label Smoothing与Mish操作之后，CSPResNeXt-50分类器的top1与top5精度得到了最高的精度。<br> <img src="https://images2.imgbox.com/08/40/hn9FsrRe_o.jpg" alt="在这里插入图片描述"><br>   上图展示了使用不同的优化策略之后，对YOLOv4算法的AP指标所产生的影响。其中S表示消除梯度敏感度，M表示使用Mosia数据增强操作，IT表示IoU阈值，GA表示遗传算法，LS表示类别标签平滑操作，CBS表示最小Batch归一化操作，CA表示模拟退火机制，DM表示动态最小Batch大小，OA表示优化的锚点框，loss表示回归分支的损失函数。通过观察我们可以得出以下的初步结论：（1）与没有使用任何优化操作的AP指标相比，使用Mosia数据增强操作之后的AP指标提升了1.1%；（2）与没有使用任何优化操作的AP指标相比，使用GA来选择最优的超参数的方法可以将AP指标提升到38.9%；（3）同时使用消失梯度敏感度、Mosaic数据增强操作、IoU阈值、遗传算法、优化的锚点框和CIoU损失之后，可以获得最高的AP指标。<br> <img src="https://images2.imgbox.com/44/fe/uYOfTObn_o.jpg" alt="在这里插入图片描述"><br>   上图展示了PAN、SPP、RFB与SAM模块对YOLOv4算法的影响。通过观察我们可以发现：在基准网络CSPResNeXt50的基础上，同时利用PAN、SPP与SAM模块，可以获得最高的AP指标。</p> 
<p><img src="https://images2.imgbox.com/ef/98/D47eu1gK_o.jpg" alt="在这里插入图片描述"><br>   上图展示了YOLOv4与其它state-of-srt目标检测算法在MS COCO数据集上面的各项指标。具体包括目标检测的Backbone网络、模型Size大小、模型帧率FPS、模型评估指标AP、AP50、AP75、APS、APM与APL。通过观察上图，我们可以得出以下的初步结论：（1）与YOLOv3相比，YOLOv4几乎具有相同的输入分辨率，具有相似的模型大小，各项AP指标却得到了极大的性能提升，平均提升了10个百分点左右；（2）与性能优异的RetinaNet相比，YOLOv4不仅具有较小的输入分辨率，而且性能得到了极大的提升，平均提升了5个百分点左右；（3）与基于Anchor-free的目标检测算法CornerNet相比，虽然YOLOv4的模型较大一些，但是YOLOv4的性能提升了3个百分点左右。<br> <img src="https://images2.imgbox.com/e7/33/zzVTEcxU_o.jpg" alt="在这里插入图片描述"><br>   上图展示了YOLOv4与其它state-of-srt目标检测算法在MS COCO数据集上面的各项指标。通过观察上图，我们可以得出以下的初步结论：（1）与CenterMask-Lite算法相比，虽然CenterMask-Lite具有更大的分辨率，但是YOLOv4算法的精度提升了3个百分点左右；（2）与HSD目标检测算法相比，两者的分辨率大小基本相同，虽然HSD算法使用了更深的基准网络，但是算法精度并不如YOLOv4算法；（3）与双阶段目标检测算法Faster R-CNN、RetinaNet与Cascade R-CNN相比，YOLOv4算法的AP指标都得到了极大的性能提升；（4）与基于Anchor-free的目标检测算法Centernet相比，当使用了基准网络Hourglass-104之后，虽然Centernet获得了更高的AP指标，但是其推理速度并不能满足很多设备的要求。<br> <img src="https://images2.imgbox.com/89/71/ydCAUqHp_o.jpg" alt="在这里插入图片描述"><br>   上图展示了YOLOv4与其它state-of-srt目标检测算法在MS COCO数据集上面的各项指标。通过观察上图，我们可以得出以下的初步结论：（1）与轻量级目标检测算法EfficientDet相比，当其具有相似的分辨率时，获得了相似的AP指标，但是YOLOv4算法的运行速度更快一些；（2）与添加了ASFF模块的YOLOv3算法相比，虽然它们具有相同的输入分辨率，但是YOLOv4在精度与速度方面优于前者；（3）与SM-NAS E3算法相比，虽然SE-NAS的输入图像更大一些，但是其速度与AP精度均不如YOLOv4检测算法。（4）与NAS-FPN算法相比，该算法不仅利用到NAS技术来寻找最优的目标检测网络架构，而且利用FPN操作来解决目标检测中的尺度问题。当输入图像大小为1024*1024时，虽然NAS-FPN在AP指标上面更高一些，但是它的运行速度变得很慢。</p> 
<h3><a id="6_543"></a>6、总结与分析</h3> 
<p>  YOLOv4是一种单阶段目标检测算法，该算法在YOLOv3的基础上添加了一些新的改进思路，使得其速度与精度都得到了极大的性能提升，具体包括：<strong>输入端的Mosaic数据增强、cmBN、SAT自对抗训练操作；基准端的CSPDarknet53、Mish激活函数、Dropblock操作；Neck端的SPP与FPN+PAN结构；输出端的损失函数CIOU_Loss以及预测框筛选的DIOU_nms</strong>。实际测试发现YOLOv4算法确定具有较大的性能提升。除此之外，YOLOv4中的各种改进思路仍然可以应用到其它的目标检测算法中。</p> 
<h3><a id="_546"></a>参考资料</h3> 
<p>[1] <a href="https://arxiv.org/pdf/2004.10934.pdf" rel="nofollow">原始论文</a><br> [2] <a href="https://zhuanlan.zhihu.com/p/143747206" rel="nofollow">博客链接1</a></p> 
<h3><a id="_551"></a>注意事项</h3> 
<p>[1] 如果您对AI、自动驾驶、AR、ChatGPT等技术感兴趣，欢迎关注我的微信公众号“<strong>AI产品汇</strong>”，有问题可以在公众号中私聊我！<br> [2] 该博客是本人原创博客，如果您对该博客感兴趣，想要转载该博客，请与我联系（qq邮箱：1575262785@qq.com）,我会在第一时间回复大家，谢谢大家的关注。<br> [3] 由于个人能力有限，该博客可能存在很多的问题，希望大家能够提出改进意见。<br> [4] 如果您在阅读本博客时遇到不理解的地方，希望您可以联系我，我会及时的回复您，和您交流想法和意见，谢谢。<br> [5] 本文中部分图像的版权归江大白所有。<br> <strong>[6] 本人业余时间承接各种本科毕设设计和各种项目，包括图像处理（数据挖掘、机器学习、深度学习等）、matlab仿真、python算法及仿真等，非诚勿扰，有需要的请加QQ：1575262785详聊，备注“项目”！！！</strong></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/52c5193f26edebe3fc4f4d46d8db9b35/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">排列组合（STL算法中next_permutation和prev_permutation剖析）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5af3d94f3ab249dc30e84f19ac06fdeb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CenterNet算法详解</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>