<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>20.04安装carla0.9.13记录 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="20.04安装carla0.9.13记录" />
<meta property="og:description" content="已经多次在不同版本的系统18.04、20.04安装carla不同源码版本0.9.11，0.9.12，0.9.13了，发现每次安装总是会遇到那么几个问题，现在新配了主机又要重新安装carla，这次准备详细的记录一下，方便未来安装时又遇到类似问题，减少安装时间。
一、安装carla的准备工作 在我第一次安装源码版本的carla，那时候还是2022年3月，啥都不明白，按照官网的步骤安装遇到了问题在网上资料也找不到，最后是遇到了一位好心的工程师远程帮我看了下，最后才安装成功了，记得前前后后花了快一个月，在这里祝这位工程师未来年薪百万，身体健康。现在在这里记录一下为认为在正式安装之前需要做的准备工作，也是为第一次遇到了血泪教训。共有两个：
1.检查显卡的驱动是否成功安装
一般安装好ubuntu系统后，它是会默认使用它自己写的显卡驱动好像叫nov什么什么的倒霉玩意，应该切换安装到适合自己显卡的驱动，一般来说在这里切换。
切换完成后看一下nvidia-smi显示和系统设置那里的显示：
这样显卡驱动部分就安装好了。
2.检查自己的swap分区的大小
这真是一个血泪教训，我第一次安装就是在这里卡到吐血，安装ue4成功，make PythonAPI成功，最后在make launch这里卡了很久很久，快一个星期吧。最后在外网的一个网站上面看都有人说可能是自己的swap和内存太小了，然后为自己的是设置了20g好像不行，又增加了20g最后才安装成功。检查自己的swap分区大小命令：
很奇怪，当时安装的时候明明分配了40g这里只显示了2g？
下面开始正式安装，参考官方文档：
官方文档0.9.13https://carla.readthedocs.io/en/0.9.13/build_linux/注意自己所看的官方文档是哪个版本的，一般默认显示的是最新版本的，后面包括github上默认下载的也是最新版本的，我第一次装的是0.9.10，这个默认版本也卡了快一周。
二、运行所必须第三方库安装 安装第三方库比如cmake, clang, different versions of Python, etc.
使用doc上提供的命令：
sudo apt-get update &amp;&amp; sudo apt-get install wget software-properties-common &amp;&amp; sudo add-apt-repository ppa:ubuntu-toolchain-r/test &amp;&amp; wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key|sudo apt-key add - &amp;&amp; sudo apt-add-repository &#34;deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-8 main&#34; &amp;&amp; sudo apt-get update ubuntu各个系统针对clang的要求不一样，doc写的很仔细，注意找不到ubuntu20.04的就去lastest看看，里面写的很全。
ubuntu20.04：
sudo apt-add-repository &#34;deb http://apt.llvm.org/focal/ llvm-toolchain-focal main&#34; sudo apt-get install build-essential clang-10 lld-10 g&#43;&#43;-7 cmake ninja-build libvulkan1 python python-dev python3-dev python3-pip libpng-dev libtiff5-dev libjpeg-dev tzdata sed curl unzip autoconf libtool rsync libxml2-dev git sudo update-alternatives --install /usr/bin/clang&#43;&#43; clang&#43;&#43; /usr/lib/llvm-10/bin/clang&#43;&#43; 180 &amp;&amp; sudo update-alternatives --install /usr/bin/clang clang /usr/lib/llvm-10/bin/clang 180 最好一行一行的输入，&amp;&amp;也分开，有时候会因为网络问题说有几个包没有下载好，直接多下载几次就好了。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5423fcb2dee1a3f0954969e00317c69e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-06T20:18:42+08:00" />
<meta property="article:modified_time" content="2023-01-06T20:18:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">20.04安装carla0.9.13记录</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>已经多次在不同版本的系统18.04、20.04安装carla不同源码版本0.9.11，0.9.12，0.9.13了，发现每次安装总是会遇到那么几个问题，现在新配了主机又要重新安装carla，这次准备详细的记录一下，方便未来安装时又遇到类似问题，减少安装时间。</p> 
<h2>一、安装carla的准备工作</h2> 
<p>在我第一次安装源码版本的carla，那时候还是2022年3月，啥都不明白，按照官网的步骤安装遇到了问题在网上资料也找不到，最后是遇到了一位好心的工程师远程帮我看了下，最后才安装成功了，记得前前后后花了快一个月，在这里祝这位工程师未来年薪百万，身体健康。现在在这里记录一下为认为在正式安装之前需要做的准备工作，也是为第一次遇到了血泪教训。共有两个：</p> 
<p><strong>1.检查显卡的驱动是否成功安装</strong></p> 
<p>一般安装好ubuntu系统后，它是会默认使用它自己写的显卡驱动好像叫nov什么什么的倒霉玩意，应该切换安装到适合自己显卡的驱动，一般来说在这里切换。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ed/4f/pl62lfv5_o.png"></p> 
<p> 切换完成后看一下nvidia-smi显示和系统设置那里的显示：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/0a/e4/pmVEsd7D_o.png"></p> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/b5/6e/1Mtb10a6_o.png"></p> 
<p style="text-align:center;"> <img alt="" src="https://images2.imgbox.com/8f/ec/vWbXZY35_o.png"></p> 
<p> 这样显卡驱动部分就安装好了。</p> 
<p><strong>2.检查自己的swap分区的大小</strong></p> 
<p>这真是一个血泪教训，我第一次安装就是在这里卡到吐血，安装ue4成功，make PythonAPI成功，最后在make launch这里卡了很久很久，快一个星期吧。最后在外网的一个网站上面看都有人说可能是自己的swap和内存太小了，然后为自己的是设置了20g好像不行，又增加了20g最后才安装成功。检查自己的swap分区大小命令：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c9/1d/SZq3gKJw_o.png"></p> 
<p>很奇怪，当时安装的时候明明分配了40g这里只显示了2g？</p> 
<p>下面开始正式安装，参考官方文档：</p> 
<p><a class="link-info has-card" href="https://carla.readthedocs.io/en/0.9.13/build_linux/" rel="nofollow" title="官方文档0.9.13"><span class="link-card-box"><span class="link-title">官方文档0.9.13</span><span class="link-link"><img class="link-link-icon" src="https://images2.imgbox.com/a2/ea/Kb7MEW7g_o.png" alt="icon-default.png?t=MBR7">https://carla.readthedocs.io/en/0.9.13/build_linux/</span></span></a><strong>注意自己所看的官方文档是哪个版本的</strong>，一般默认显示的是最新版本的，后面包括github上默认下载的也是最新版本的，我第一次装的是0.9.10，这个默认版本也卡了快一周。</p> 
<h2>二、运行所必须第三方库安装</h2> 
<p>安装第三方库比如<strong><em>cmake</em>, <em>clang</em>, different versions of <em>Python</em>, etc.</strong></p> 
<p>使用doc上提供的命令：</p> 
<pre><code class="language-bash">sudo apt-get update &amp;&amp;
sudo apt-get install wget software-properties-common &amp;&amp;
sudo add-apt-repository ppa:ubuntu-toolchain-r/test &amp;&amp;
wget -O - https://apt.llvm.org/llvm-snapshot.gpg.key|sudo apt-key add - &amp;&amp;
sudo apt-add-repository "deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-8 main" &amp;&amp;
sudo apt-get update</code></pre> 
<p>ubuntu各个系统针对clang的要求不一样，doc写的很仔细，注意找不到ubuntu20.04的就去lastest看看，里面写的很全。</p> 
<p>ubuntu20.04：</p> 
<pre><code class="language-bash">sudo apt-add-repository "deb http://apt.llvm.org/focal/ llvm-toolchain-focal main"
sudo apt-get install build-essential clang-10 lld-10 g++-7 cmake ninja-build libvulkan1 python python-dev python3-dev python3-pip libpng-dev libtiff5-dev libjpeg-dev tzdata sed curl unzip autoconf libtool rsync libxml2-dev git
sudo update-alternatives --install /usr/bin/clang++ clang++ /usr/lib/llvm-10/bin/clang++ 180 &amp;&amp;
sudo update-alternatives --install /usr/bin/clang clang /usr/lib/llvm-10/bin/clang 180</code></pre> 
<p>最好一行一行的输入，&amp;&amp;也分开，有时候会因为网络问题说有几个包没有下载好，直接多下载几次就好了。</p> 
<p>pip问题：</p> 
<p>根据doc写到没有20.3就升级一下</p> 
<pre><code class="language-bash">pip3 install --upgrade pip
</code></pre> 
<p>这里遇到了问题</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/de/17/NW7Sw7kf_o.png"></p> 
<p> 没有升级成功，在网上找到了解决办法，在终端输入：</p> 
<pre><code class="language-bash">gedit ~/.bashrc</code></pre> 
<p>在最后一行加入：export PATH=/home/v2t-smi/.local/bin:$PATH</p> 
<p>这里路径是它提示错误的路径，注意home前面的/不能少。然后在source一下，就升级成功了。</p> 
<p><img alt="" src="https://images2.imgbox.com/58/c0/asJp08Uk_o.png">继续安装python的依赖</p> 
<pre><code class="language-cpp">pip install --user setuptools &amp;&amp;
pip3 install --user -Iv setuptools==47.3.1 &amp;&amp;
pip install --user distro &amp;&amp;
pip3 install --user distro &amp;&amp;
pip install --user wheel &amp;&amp;
pip3 install --user wheel auditwheel</code></pre> 
<p>报错说</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/85/f9/iu3LJnic_o.png"></p> 
<p>网上的解决方案：</p> 
<pre><code class="language-bash">python3 -m pip install launchpadlib
sudo pip3 install setuptools</code></pre> 
<p>然后再次尝试，没有报错了。然后第三方库的安装就基本完成，下面开始UE4的安装。</p> 
<h2>三、UE4的安装</h2> 
<p>注意版本的区别，0.9.13只能匹配4.26，千万要选择适合自己carla版本的UE。</p> 
<p>直接根据doc上的来：</p> 
<pre><code class="language-bash">git clone --depth 1 -b carla https://github.com/CarlaUnreal/UnrealEngine.git ~/UnrealEngine_4.26
cd ~/UnrealEngine_4.26/UnrealEngine-carla
./Setup.sh 
./GenerateProjectFiles.sh 
make
//测试是否安装成功
cd ~/UnrealEngine_4.26/Engine/Binaries/Linux &amp;&amp; ./UE4Editor</code></pre> 
<p>注意这里git clone可能会失败，<strong><s><span style="color:#fe2c24;">最好是自己在官方github上下载zip然后自己解压 </span></s></strong></p> 
<p><strong><span style="color:#0d0016;">千万不要zip下载一定要git下载</span></strong></p> 
<p><strong><span style="color:#0d0016;">输入命令：</span></strong></p> 
<pre><code class="language-bash">git clone --depth 1 -b carla https://github.com/CarlaUnreal/UnrealEngine.git ~/UnrealEngine_4.26</code></pre> 
<p><strong><span style="color:#0d0016;">然后输入自己github的账号和什么token？token在这里找：</span></strong><a href="https://blog.csdn.net/m0_51693209/article/details/124664968" title="GitHub生成token_想搓一顿火锅的博客-CSDN博客_gitlab生成token">GitHub生成token_想搓一顿火锅的博客-CSDN博客_gitlab生成token</a></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/5f/5a/M7PwXbbC_o.png"></p> 
<p> ./Setup.sh时间很长可能得1h，看网速，建议科学上网。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/00/4f/ZyvxY5ST_o.png"></p> 
<p> make的时间最长可能1个多小时，耐心等待，最后出现这个就表示安装完成。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/34/d6/GNl6qJ6R_o.png"></p> 
<p> 最后测试一下：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/c7/f6/McVDM0EX_o.png"></p> 
<p>显示出了UE4的初始界面就表示UE部分安装完成，下面开始carla部分的安装。</p> 
<h2>四、carla0.9.13安装</h2> 
<p>现安装一个命令加速模块，不知道是什么原理，doc说了可以加速就安装吧。</p> 
<pre><code class="language-bash">sudo apt-get install aria2</code></pre> 
<p>然后正式开始0.9.13版本的安装。</p> 
<p>输入命令：</p> 
<pre><code class="language-bash">git clone -b 0.9.13 https://github.com/carla-simulator/carla.git</code></pre> 
<p>然后就是核心的一步，修改carla源码安装脚本中关于clang 8 的设置修改为clang 10，第一次在ubuntu20.04上安装0.9.13版本的时候这里也卡了很久，最后是退回clang 8才安装成功。</p> 
<p>安装脚本的位置是：<strong>/home/v2t-smi/carla/Util/BuildTools</strong></p> 
<p>文件有3个：</p> 
<p><strong>– Setup.sh<br> – BuildOSM20DR.sh<br> – BuildPythonAPI.sh</strong></p> 
<p>修改完成后进行下一步。</p> 
<pre><code class="language-bash">./Update.sh</code></pre> 
<p>这里有个<span style="color:#fe2c24;"><strong>深坑</strong></span>，打开上面的Setup.sh文件：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/59/51/hKvYHb5l_o.png"></p> 
<p>这里显示的是下载3.2.3版本的xerces，但你打开这个网站：</p> 
<p><a href="https://ftp.cixug.es/apache/xerces/c/3/sources/" rel="nofollow" title="Servidor de réplicas do Consorcio CIXUG">Servidor de réplicas do Consorcio CIXUG</a></p> 
<p>你就会发现，3.2.3版本被移除了？？？</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b5/ad/dfonqeN6_o.png"></p> 
<p>当时卡了很久，最后好像是在issue里面翻到类似的问题才解决掉。</p> 
<p>issue地址：<a href="https://github.com/carla-simulator/carla/issues/5852" title="Issue building CARLA during make CarlaUE4Editor: cannot find xerces 3.2.3 since they upgraded to 3.2.4 · Issue #5852 · carla-simulator/carla · GitHub">Issue building CARLA during make CarlaUE4Editor: cannot find xerces 3.2.3 since they upgraded to 3.2.4 · Issue #5852 · carla-simulator/carla · GitHub</a></p> 
<p>解决办法是将432行更换成下面这个网站：</p> 
<pre><code class="language-bash">https://archive.apache.org/dist/xerces/c/3/sources/</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/b4/9c/NZUCrhaH_o.png"></p> 
<p> 在carla文件夹根目录运行：</p> 
<pre><code class="language-bash">./Update.sh
</code></pre> 
<p>这里也有坑，打开Update.sh</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/81/40/TbWLhOIW_o.png"></p> 
<p>这个网站也失效了，但好像不影响，不太明白。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/da/cc/3dYvpGyn_o.png"></p> 
<p>不断的失败，然后有不断的重新执行这个命令，不知道之后会不会有错误。。。</p> 
<p>看起来是成功了。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/04/6c/gJx1AfQ8_o.png"></p> 
<p> 然后编译pythonAPI，输入命令：</p> 
<pre><code class="language-bash">make PythonAPI
//或者带上自己的python版本
make PythonAPI ARGS="--python-version=2.7, 3.6, 3.7, 3.8"</code></pre> 
<p>开始出问题了：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/a4/29/aybKvrB9_o.png"></p> 
<p>好在issue里面找到了一样的问题，下面是链接：<br><a href="https://github.com/carla-simulator/carla/issues/3428" title="https://github.com/carla-simulator/carla/issues/3428">https://github.com/carla-simulator/carla/issues/3428</a></p> 
<p>应该是网络问题，可能晚上情况会好一点，奇怪了，这里居然把梯子关了居然成功了。然后后面就又遇到些乱七八糟的问题，特别是BuildLibCarla.sh这里，这个错误为从来都没有遇到过，可能是换了Python3.8的原因。解决方式是在网上找到的一篇博客，写的很简洁，但都是关键问题：</p> 
<p><a href="https://blog.csdn.net/m0_47136637/article/details/128208192?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167299785316800211571464%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167299785316800211571464&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-128208192-null-null.142%5Ev70%5Eone_line,201%5Ev4%5Eadd_ask&amp;utm_term=20.04%20carla&amp;spm=1018.2226.3001.4187" title="ubuntu20.04编译carla0.9.13源码_m0_47136637的博客-CSDN博客_ubuntu20编译carla">ubuntu20.04编译carla0.9.13源码_m0_47136637的博客-CSDN博客_ubuntu20编译carla</a></p> 
<p>通过他这个办法，就通过了这个模块。</p> 
<p>最后成功了，很辛酸，有的第三方库不用梯子上不去，有的用梯子上不去，来回切换了好几遍，最后记录一下需要的第三方库：</p> 
<pre><code class="language-bash">Setup.sh: llvm-8.0 already installed.
Setup.sh: boost-1.72.0-c8 already installed.
Setup.sh: rpclib-v2.2.1_c5-c8 already installed.
Setup.sh: gtest-1.8.1-c8 already installed.
Setup.sh: recast-0b13b0-c8 already installed.
Setup.sh: Libpng already installed.
Setup.sh: Xerces-c already installed.
Setup.sh: Sqlite already installed.
Setup.sh: PROJ already installed.
Setup.sh: Patchelf already installed.
Setup.sh: CARLA version 0.9.13-dirty.
Setup.sh: Generating CMake configuration files.
Setup.sh: Success!
BuildLibCarla.sh: Building LibCarla "Client.Release" configuration.
BuildOSM2ODR.sh: Building OSM2ODR.
BuildOSM2ODR.sh: Success!
BuildPythonAPI.sh: Building Python API for Python 3.8.
</code></pre> 
<p>成功截图：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/1c/20/poioTy7m_o.png"></p> 
<p> 最后一步：</p> 
<pre><code class="language-bash">make launch</code></pre> 
<p>然后报错：<br><img alt="" src="https://images2.imgbox.com/5c/a6/SyQGDX8e_o.png"></p> 
<p> 想到好像之前遇到类似的问题，果然在网上一搜是前面下载ue部分出现了问题，不能使用zip下载 ，得使用命令下载，但为第一次安装0.9.13的时候就是zip下载安装的，没有出问题。。。</p> 
<p>这里是相关的issue：</p> 
<p><a href="https://github.com/carla-simulator/carla/issues/5340" title="https://github.com/carla-simulator/carla/issues/5340">https://github.com/carla-simulator/carla/issues/5340</a></p> 
<p>重新下载ue了。。。</p> 
<p>安装成功！</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/aa/84/juIqvaqq_o.png"><img alt="" src="https://images2.imgbox.com/d9/1b/ahs3IPbR_o.png"></p> 
<p> 太不容易了，从早上10点开始到了晚上8点，ros-bridge还没有安装，不过实验室设备终于鸟枪换炮了，希望可以好好使用。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d5c791bcef76ee9e0640cfd11d9ea635/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中Map接口的默认方法computerIfAbsent、computeIfPresent、getOrDefault、merge、putIfAbsent、replaceAll以及常用示例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9a603d52129eee47795c1819eace017c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FLV格式分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>