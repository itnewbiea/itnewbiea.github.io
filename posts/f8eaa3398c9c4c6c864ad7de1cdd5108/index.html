<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8S陈述式资源管理（1） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8S陈述式资源管理（1）" />
<meta property="og:description" content="命令行: kubectl命令行工具
优点: 90%以上的场景都可以满足对资源的增，删，查比较方便，对改不是很友好
缺点:命令比较冗长，复杂，难记声明式
声明式：K8S当中的yaml文件来实现资源管理
GUI：图形化工具的管理
kubectl命令的详解
查看 部署 查看pod的情况（详细信息和日志，发布和回滚）
Kubernetes kubectl 命令表 _ Kubernetes(K8S)中文文档_Kubernetes中文社区
查看k8s版本信息
kubectl version
查看K8S资源当中，所有资源对象的名称以及简写
kubectl api-resources
查看K8S集群信息
kubectl cluster-info
source &lt;(kubectl completion bash)
查看MASTER节点的状态（基本信息查看）
kubectl get cs
查看默认命名空间default内的pod的信息
kubectl get pod
查看当前集群所有的命名空间
kubectl get ns
查看指定命名空间内的pod，需要加 -n&#43;命名空间的名称
kubectl get pod -n kube-system
查看默认命名空间内pod的详细信息
kubectl get pod -o wide
查询节点信息和状态
kubectl get node
查看node节点的详细信息
kubectl get node -o wide
查看已经部署好的pod的详细信息
kubectl get pod
kubectl describe pod nginx-6799fc88d8-f9c8g" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f8eaa3398c9c4c6c864ad7de1cdd5108/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T14:21:57+08:00" />
<meta property="article:modified_time" content="2024-01-02T14:21:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8S陈述式资源管理（1）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p style="margin-left:.0001pt;text-align:justify;">命令行: kubectl命令行工具</p> 
<p style="margin-left:.0001pt;text-align:justify;">优点: 90%以上的场景都可以满足对资源的增，删，查比较方便，对改不是很友好</p> 
<p style="margin-left:.0001pt;text-align:justify;">缺点:命令比较冗长，复杂，难记声明式</p> 
<p style="margin-left:.0001pt;text-align:justify;">声明式：K8S当中的yaml文件来实现资源管理</p> 
<p style="margin-left:.0001pt;text-align:justify;">GUI：图形化工具的管理</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl命令的详解</p> 
<p style="margin-left:.0001pt;text-align:justify;">查看  部署  查看pod的情况（详细信息和日志，发布和回滚）</p> 
<p style="margin-left:.0001pt;text-align:justify;"><a href="http://docs.kubernetes.org.cn/683.html" rel="nofollow" title="Kubernetes kubectl 命令表 _ Kubernetes(K8S)中文文档_Kubernetes中文社区">Kubernetes kubectl 命令表 _ Kubernetes(K8S)中文文档_Kubernetes中文社区</a></p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看k8s版本信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl version</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看K8S资源当中，所有资源对象的名称以及简写</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl api-resources</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看K8S集群信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl cluster-info</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">source &lt;(kubectl completion bash)</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看MASTER节点的状态（基本信息查看）</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get cs</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看默认命名空间default内的pod的信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看当前集群所有的命名空间</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get ns</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看指定命名空间内的pod，需要加 -n+命名空间的名称</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看默认命名空间内pod的详细信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod -o wide</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查询节点信息和状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get node</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看node节点的详细信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get node -o wide</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看已经部署好的pod的详细信息</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl describe pod nginx-6799fc88d8-f9c8g</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl describe pod -n kube-system etcd-master01</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看pod输出的日志</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl logs nginx-6799fc88d8-f9c8g    一次性查看</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl logs -f nginx-6799fc88d8-f9c8g  动态查看</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl logs -f etcd-master0l -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">创建一个命名空间</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl create ns abc</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">查看命名空间</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get ns</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">删除命名空间</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl delete ns abc</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl delete pod nginx-6799fc88d8-f9c8g -n 命名空间</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod会发现nginx-6799fc88d8-f9c8g没有被删除（基于deployment进行部署的原因）</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">pod的部署：</p> 
<p style="margin-left:.0001pt;text-align:justify;">deployment的部署pod</p> 
<p style="margin-left:.0001pt;text-align:justify;">陈述式部署：命令行</p> 
<p style="margin-left:.0001pt;text-align:justify;">声明式：yaml文件部署</p> 
<p style="margin-left:.0001pt;text-align:justify;">滚动更新：不是一次性的把所有pod全部部署，而是一个个来。pod的更新时使用。逐步的引入新的pod，逐步的减少旧的pod</p> 
<p style="margin-left:.0001pt;text-align:justify;">自我修复：如果有pod节点发生故障，deployment会自动更新新的pod来进行代替</p> 
<p style="margin-left:.0001pt;text-align:justify;">回滚：如果更新有问题，deployment会提供还原点，可以手动的还原到未更新前的状态</p> 
<p style="margin-left:.0001pt;text-align:justify;">扩容和缩容：deployment可以随时调整pod的数量，以适应流量的变化</p> 
<p style="margin-left:.0001pt;text-align:justify;">上述的功能必须是基于deployment创建的服务才可以</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">daemonset不能通过命令行创建，只能通过yaml文件中定义这种创建方式</p> 
<p style="margin-left:.0001pt;text-align:justify;">后台运行创建，在每个节点上都创建一个相同方式的、相同版本的容器运行的pod</p> 
<p style="margin-left:.0001pt;text-align:justify;">一般都是依赖环境和重要组件，一般也不会对这些资源进行操作</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">如果基于deployment方式创建的pod，或者daemonset方式创建的pod，是由控制器创建的pod，使用delete是删不掉的，相当于重启pod</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl delete deployments.apps nginx-fmh -n abc</p> 
<p style="margin-left:.0001pt;text-align:justify;">#基于deployment方式创建pod，一旦删除deployment，基于deployment创建的pod都会被删除。慎用</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">不是基于控制器创建的，会被直接删除</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl delete pod nginx-dn-6d6cd9c7c5-j7ffr --force --grace-period=0</p> 
<p style="margin-left:.0001pt;text-align:justify;">grace-period:表示过度存活期。默认30秒。可以让pod优雅的结束容器内的进程，然后退出pod</p> 
<p style="margin-left:.0001pt;text-align:justify;">grace-period=0表示立刻终止pod。必须要force</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">主要是用于结束卡在销毁状态的pod</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">对deployment创建的pod进行扩缩容</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl scale deployment nginx-fmh --replicas=3  扩容</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl scale deployment nginx-fmh --replicas=1  缩容</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">创建pod时并没有指定副本数，后续也可以对他的副本数进行修改</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">如何把服务的service进行发布？</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get pod</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">service类型</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get service/svc</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl delete svc nginx  删除service</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl get svc -n kube-system</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">TYPE类型：</p> 
<p style="margin-left:.0001pt;text-align:justify;">ClusterIP  创建service的默认类型，提供一个集群内部的虚拟IP地址，这是service的默认类型。通过这个虚拟ip可以直接访问pod的资源，无法对外提供访问。</p> 
<p style="margin-left:.0001pt;text-align:justify;">NodePort：会在每个node节点上开放相同的端口。外部可以通过node的本机IP+端口，访问pod资源。集群外部访问service资源的一种方式。四层代理的方式</p> 
<p style="margin-left:.0001pt;text-align:justify;">nodeip：nodeport。随即指派，也可以指定（端口范围30000 --- 32767）</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">基于deployment创建的pod可以使用这种方式</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl deployment nginx --port=80 ==target-port=80 --name=nginx-service --type=NodePort</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">10.96.232.240 集群内部的ip地址，外部是不可以访问这个ip地址的.</p> 
<p style="margin-left:.0001pt;text-align:justify;">80:对应的是内部的service的端口</p> 
<p style="margin-left:.0001pt;text-align:justify;">32436: 和内部的service的80端口做映射</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="285" src="https://images2.imgbox.com/9c/e8/fcqvYjFc_o.png" width="729"></p> 
<p style="margin-left:.0001pt;text-align:justify;">LoadBalancer: 如果service的类型设定为LoadBalancer映射地址(云平台提供LoadBalancer的地址) 这种用法仅用于公有云服务供应商在云台上设置的service的场景。外部来访问实现负载均衡。LoadBalancer这个是地址是要付费的。</p> 
<p style="margin-left:.0001pt;text-align:justify;">创建好了service，指定类型为LoadBalancer，会给你提供一个地址来带代理pod内部的ip地址</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">ExternalName: DNS映射，给service分配一个域名，通过域名来访问后端pod资源。ExternalName的service类型不能提供负载均衡。必须要设置一个LoadBalancer的地址才可以实现</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="573" src="https://images2.imgbox.com/ae/6d/P5kSNva2_o.png" width="628"></p> 
<p style="margin-left:.0001pt;text-align:justify;">数字的大小决定了距离上次操作的远近，数字越大，就是你最近的一次操作</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl set image deployment nginxl nginx=nginx:1.15 --record</p> 
<p style="margin-left:.0001pt;text-align:justify;">kubectl rollout history deployment nginxl</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/38eb3cc584a2e401734eb75e220ea3d9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">全新SharePoint Premium介绍</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7844fc180f8e1f2e12cf4e75379b6222/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">航芯ACM32G103开发板评测 01-开箱及环境搭建流程</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>