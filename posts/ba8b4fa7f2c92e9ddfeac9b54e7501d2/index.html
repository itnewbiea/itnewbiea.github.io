<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java实现文件预览 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java实现文件预览" />
<meta property="og:description" content="一、需求背景 项目需要实现一个在Android端群文件上传后支持预览的功能。
PS：常见文件格式如pdf、html、txt、图片在线预览较为简单，word，excel，ppt在线预览较为困难
二、技术方案调研 方案1：通过腾讯TBS代替原生WebView（还有Google doc、Office Web 365等也需付费使用）
优点：安卓端集成SDK方式，效率高，功能强大
缺点：目前新版本已收费（若没有成本预算顾虑，直接选择该方案即可）
详见：Android 通过腾讯TBS实现文件预览功能-编程学习网
方案2：安卓端使用Apache的poi组件读取word、excel，结合itext生成pdf
优点：安卓端实现方便
缺点：预览效果差，不支持ppt的转换，且存在jwt的jar包无法调用问题（这里不作展开）
方案3：服务端jodconverter&#43;openOffice实现office文档转换为pdf，安卓端使用AndroidPdfViewer预览pdf文档
优点：一般格式预览效果还行，linux可使用中文路径，跨平台
缺点：复杂格式可能有错位，jodconverter依赖于openOffice，需在linux服务安装openOffice
详见：Java实现word、excel、ppt、txt等办公文件在线预览功能 - 腾讯云开发者社区-腾讯云
方案4：服务端Aspose实现office文档转换为pdf，安卓端使用AndroidPdfViewer预览pdf文档
优点：实现简单，无需安装插件服务，文件转换较快，跨平台
缺点：使用Aspose破解版，商用涉及版权问题，使用中文路径会乱码（这里不作展开）
方案5：使用kkfileview&#43;openOffice实现转换和预览
优点：开源项目，支持文件格式齐全，不用开发，文件转换较快，跨平台（emmm，真香~）
缺点：需在linux服务安装openOffice（安装简单，兼容性较差）或libreOffice（建议采用，centOS系统低版本安装较麻烦），kkfileview（可详见下述步骤）
最终决策：选择方案5
三、安装libreOffice/openOffice 安装libreOffice参考（kkFileView 4.0.0之后的版本，建议安装libreOffice），安装教程参考：centos7 安装LibreOffice（超级详细）_刘奶奶向柳奶奶借牛奶的博客-CSDN博客
参考安装教程：centos7 安装LibreOffice（超级详细）_刘奶奶向柳奶奶借牛奶的博客-CSDN博客
1.解压
新建目录：mkdir /data/libreOffice7.4
上传并解压：tar -zxvf LibreOffice_7.4.5.1_Linux_x86-64_rpm_helppack_zh-CN.tar.gz
LibreOffice_7.4.5.1_Linux_x86-64_rpm_langpack_zh-CN.tar.gz
2.更新配置（参照教程）
vim /etc/profile
export LibreOffice_PATH=/opt/libreoffice7.4/program
export PATH=$LibreOffice_PATH:$PATH
source /etc/profile
3.进入目录：cd /data/libreOffice/LibreOffice_7.4.5.1_Linux_x86-64_rpm/RPMS
执行（安装所有rpm文件）：su -c &#39;yum install *.rpm&#39;
默认安装目录：/opt/libreoffice7.4/program
4.启动
执行启动命令：/opt/libreoffice7.4/program/soffice --headless --accept=&#34;socket,host=127.0.0.1,port=8100;urp;&#34; --nofirststartwizard &amp;
检查启动情况，查看进程：ps -ef|grep libreoffice
5.卸载：
cd /data/libreOffice" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ba8b4fa7f2c92e9ddfeac9b54e7501d2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-25T11:17:28+08:00" />
<meta property="article:modified_time" content="2023-04-25T11:17:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java实现文件预览</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3 id="V3.15.0-一、需求疑问"><strong>一、需求背景</strong></h3> 
<p>        项目需要实现一个在Android端群文件上传后支持预览的功能。</p> 
<p>PS：常见文件格式如pdf、html、txt、图片在线预览较为简单，word，excel，ppt在线预览较为困难</p> 
<h3 id="V3.15.0-二、Android实现文件预览方案调研-技术选型"><strong>二、技术方案调研</strong></h3> 
<p><strong>方案1</strong>：通过<strong>腾讯TBS</strong>代替原生WebView（还有Google doc、Office Web 365等也需付费使用）<br> 优点：安卓端集成SDK方式，效率高，功能强大<br> 缺点：目前新版本已收费（若没有成本预算顾虑，直接选择该方案即可）</p> 
<p>详见：<a href="http://www.topstudy.com.cn/nav/m/92400.html" rel="nofollow" title="Android 通过腾讯TBS实现文件预览功能-编程学习网">Android 通过腾讯TBS实现文件预览功能-编程学习网</a></p> 
<p><strong>方案2</strong>：安卓端使用Apache的<strong>poi</strong>组件读取word、excel，结合itext生成pdf<br> 优点：安卓端实现方便<br> 缺点：预览效果差，不支持ppt的转换，且存在jwt的jar包无法调用问题（这里不作展开）</p> 
<p><strong>方案3</strong>：服务端<strong>jodconverter+openOffice</strong>实现office文档转换为pdf，安卓端使用<strong>AndroidPdfViewer</strong>预览pdf文档<br> 优点：一般格式预览效果还行，linux可使用中文路径，跨平台<br> 缺点：复杂格式可能有错位，jodconverter依赖于openOffice，需在linux服务安装openOffice</p> 
<p>详见：<a href="https://cloud.tencent.com/developer/article/1906927?from=15425&amp;areaSource=102001.12&amp;traceId=Ow5gM_fDx_eTHlLL5ziox" rel="nofollow" title="Java实现word、excel、ppt、txt等办公文件在线预览功能 - 腾讯云开发者社区-腾讯云">Java实现word、excel、ppt、txt等办公文件在线预览功能 - 腾讯云开发者社区-腾讯云</a></p> 
<p><strong>方案4</strong>：服务端<strong>Aspose</strong>实现office文档转换为pdf，安卓端使用<strong>AndroidPdfViewer</strong>预览pdf文档<br> 优点：实现简单，无需安装插件服务，文件转换较快，跨平台<br> 缺点：使用Aspose破解版，商用涉及版权问题，使用中文路径会乱码（这里不作展开）</p> 
<p><strong>方案5</strong>：使用<strong>kkfileview+openOffice</strong>实现转换和预览<br> 优点：开源项目，支持文件格式齐全，不用开发，文件转换较快，跨平台（emmm，真香~）<br> 缺点：需在linux服务安装openOffice（安装简单，兼容性较差）或libreOffice（建议采用，centOS系统低版本安装较麻烦），kkfileview（可详见下述步骤）</p> 
<p>最终决策：选择方案5</p> 
<h3 id="V3.15.0-三、安装openOffice"><strong>三、安装libreOffice/openOffice</strong></h3> 
<p>安装<strong>libreOffice</strong>参考（<strong>kkFileView 4.0.0之后的版本，建议安装libreOffice</strong>），安装教程参考：<a href="https://blog.csdn.net/weixin_43148701/article/details/129403372" title="centos7 安装LibreOffice（超级详细）_刘奶奶向柳奶奶借牛奶的博客-CSDN博客">centos7 安装LibreOffice（超级详细）_刘奶奶向柳奶奶借牛奶的博客-CSDN博客</a></p> 
<p>参考安装教程：<a href="https://blog.csdn.net/weixin_43148701/article/details/129403372" title="centos7 安装LibreOffice（超级详细）_刘奶奶向柳奶奶借牛奶的博客-CSDN博客">centos7 安装LibreOffice（超级详细）_刘奶奶向柳奶奶借牛奶的博客-CSDN博客</a><br> 1.解压<br> 新建目录：mkdir /data/libreOffice7.4<br> 上传并解压：tar -zxvf LibreOffice_7.4.5.1_Linux_x86-64_rpm_helppack_zh-CN.tar.gz<br> LibreOffice_7.4.5.1_Linux_x86-64_rpm_langpack_zh-CN.tar.gz<br> 2.更新配置（参照教程）<br> vim /etc/profile<br> export LibreOffice_PATH=/opt/libreoffice7.4/program<br> export PATH=$LibreOffice_PATH:$PATH<br> source /etc/profile<br> 3.进入目录：cd /data/libreOffice/LibreOffice_7.4.5.1_Linux_x86-64_rpm/RPMS<br> 执行（安装所有rpm文件）：su -c 'yum install *.rpm'<br> 默认安装目录：/opt/libreoffice7.4/program<br> 4.启动<br> 执行启动命令：/opt/libreoffice7.4/program/soffice --headless --accept="socket,host=127.0.0.1,port=8100;urp;" --nofirststartwizard &amp;<br> 检查启动情况，查看进程：ps -ef|grep libreoffice<br> 5.卸载：<br> cd /data/libreOffice<br> sudo yum remove libreoffice7.4-*</p> 
<p>遇到的问题1：开始执行安装命令为yum localinstall *.rpm，安装没进程日志提示:</p> 
<p>解决办法：查阅官网手册后，发现可以使用：su -c 'yum install *.rpm'</p> 
<p>遇到的问题2：我自己安装时，因为centos6.7的版本glibc仅支持到2.12以前的版本，启动时出现如下报错：</p> 
<p><img alt="" height="224" src="https://images2.imgbox.com/fc/f4/MwqHteTv_o.png" width="1200"></p> 
<p>解决办法：<a href="https://zhuanlan.zhihu.com/p/320357614" rel="nofollow" title="libreoffice6.2报错 - 知乎">libreoffice6.2报错 - 知乎</a> </p> 
<p></p> 
<p><strong>openOffice</strong>官方安装包下载地址：<a href="https://www.openoffice.org/download/index.html" rel="nofollow" title="Apache OpenOffice - Official Download">Apache OpenOffice - Official Download</a></p> 
<p>1.解压安装包<br> 在/data目录（可自行选择）下新建目录：/data/openoffince，将安装包ftp上传到该目录并解压：<br> tar -xvzf Apache_OpenOffice_4.1.14_Linux_x86-64_install-rpm_zh-CN.tar.gz<br> 2.进入到解压目录，比如/data/openoffince/zh-CN/RPMS，执行：<br> rpm -Uvih *rpm<br> 如果是redhat操作系统，选择对应的rpm，比如执行：<br> rpm -ivh openoffice4.1.14-redhat-menus-4.1.14-9811.noarch.rpm<br> 这时openOffice己经安装完成，默认会安装在/opt下</p> 
<p><strong>启动openOffice</strong><br> 1.进入到目录：/opt/openoffice4/program<br> 2.执行启动命令：soffice -headless -accept="socket,host=127.0.0.1,port=8100;urp;" -nofirststartwizard &amp;<br> 3.检查启动情况，查询进程：ps -ef|grep openoffice</p> 
<p></p> 
<h3 id="V3.15.0-四、安装kkFileView"><strong>四、安装kkFileView</strong></h3> 
<p>项目官网：<a href="https://kkview.cn/zh-cn/index.html" rel="nofollow" title="https://kkview.cn/zh-cn/index.html">https://kkview.cn/zh-cn/index.html</a></p> 
<p>开源项目：<a href="https://gitee.com/kekingcn/file-online-preview" rel="nofollow" title="https://gitee.com/kekingcn/file-online-preview">https://gitee.com/kekingcn/file-online-preview</a></p> 
<p>若下载最新安装包需加入知识星球收费，可尝试下载链接：</p> 
<p><a href="https://www.oschina.net/action/GoToLink?url=https%3A%2F%2Fkkfileview.keking.cn%2FkkFileView-4.1.0.tar.gz" rel="nofollow" title="kkFileView-4.1.0.tar.gz">kkFileView-4.1.0.tar.gz</a> (Linux 或 MacOS 版)</p> 
<p>或下载源码后，找到对应的安装包（我改过源码，重新package打新的部署包再部署），如下图：</p> 
<p><img alt="" height="348" src="https://images2.imgbox.com/1d/04/mDKYu52s_o.png" width="1200"></p> 
<p>1.解压安装包<br> 进入/data目录，上传并解压：<br> tar -xvzf kkFileView-4.2.1.tar.gz<br> 2.修改配置文件属性：vi /data/kkFileView-4.2.1/config/application.properties<br> office.home = /opt/openoffice4</p> 
<p>或office.home = /opt/libreoffice7.5<br> 3.进入解压文件夹的bin目录：/data/kkFileView-4.2.1/bin<br> 4.运行脚本：Linux以root用户运行startup.sh</p> 
<p><img alt="" height="352" src="https://images2.imgbox.com/1d/f7/MmwPY52X_o.png" width="862"><br> 5.浏览器访问：<a href="http://127.0.0.1:8012" rel="nofollow" title="http://ip:8012">http://ip:8012</a></p> 
<p></p> 
<p>注意：<br> 1.网络原因，自动安装内置的openoffice会报错，所以openoffice需要单独安装，修改kkFileView配置<br> 2.linux环境下，会出现中文乱码，此时需要把windows下的字体配置复制到linux下，刷新配置即可</p> 
<h3 id="V3.15.0-五、nginx添加配置"><strong>五、nginx添加配置</strong></h3> 
<p>location /preview/ {<!-- --><br> proxy_pass <a href="http://172.31.244.180:8012/" rel="nofollow" title="http://xxx.xxx.xxx.xxx:8012/">http://xxx.xxx.xxx.xxx:8012/</a>;<br> client_max_body_size 100m;<br> }</p> 
<p>详见：<a href="https://kkview.cn/zh-cn/docs/faq.html" rel="nofollow" title="kkFileView - 在线文件预览">kkFileView - 在线文件预览</a></p> 
<h3 id="V3.15.0-六、测试验证"><strong>六、测试验证</strong></h3> 
<p>在线预览体验：<a href="https://file.kkview.cn/" rel="nofollow" title="kkFileView演示首页">kkFileView演示首页</a></p> 
<p>原始文件url：http://xxx.aliyuncs.com/20220804/3973c5ae77874b3790677250819bd37f/外面的世界1222活动参会人员列表.xls</p> 
<p><br> 转换后的预览文件url（可浏览器访问）：http://xxx.xxx.cn/preview/onlinePreview?url=aHR0cDovLzR5ZS1yc2Mub3NzLWNuLXFpbmdkYW8uYWxpeXVuY3MuY29tLzIwMjIwODA0LzM5NzNjNWFlNzc4NzRiMzc5MDY3NzI1MDgxOWJkMzdmL3hpYW94aW5fNyDlpJbpnaLnmoTkuJbnlYwxMjIy5rS75Yqo5Y%2BC5Lya5Lq65ZGY5YiX6KGoLnhscw%3D%3D</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d42ed57f1e716dd962ae9b83407fccda/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【uni-app】uni-app实现聊天页面功能（小程序）——布局篇</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f24a2a7c9b5c815c040710c4bd39d2ae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【uni-app】uni-app实现聊天页面功能——功能篇（下）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>