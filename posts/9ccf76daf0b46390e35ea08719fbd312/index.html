<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>.NET/C#获取十五日天气预报 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content=".NET/C#获取十五日天气预报" />
<meta property="og:description" content="今天来为大家提供一个获取天气的一个接口方法并且返还到页面上，通过前端代码显示出来本次的代码量不多，完全可以直接复制粘贴如果除了什么问题大家可以在下方评论留言！ 1、首先我们要获取到天气的AP链接地址，链接地址如下，我们可以去这个网站去拿： 免费天气API，天气JSON API，不限次数获取十五天的天气预报 —技术博客
上方这个网站会会有天气的API地址并且会初步的教您如何使用 ↑
2、在上方我们拿到天气的api后，网站里还会给我们提供哥哥城市的一个ID我们查找是通过ID来查找的，当然也可以转换成名字大家可以自己转换。下面这个链接是上面那个网站里面给咱提供的城市数据：大家可以通过方法把数据添加到数据库中，也可以只用自己需要城市的按需求用： 城市数据： 请在百度网盘下载：链接: https://pan.baidu.com/s/1JFAwnH2MRLc5OD3hsJZwGQ 提取码: u8sk 3、我们在获取上面两个东西后我们就可以开始进行项目的编写了，下面我来教大家如何获取天气并显示：首先我们需要新建一个.net的项目。新建一个控制器咋里面添加一个index页面：index页面的内容我给大家贴在下方直接复制： @{ ViewBag.Title = &#34;天气&#34;; Layout = &#34;~/Views/Shared/_Layout.cshtml&#34;; } &lt;style&gt; .laytable-cell-1-ImgUrl { height: 100%; max-width: 100%; } .xm-form-select { width: 180px; } &lt;/style&gt; &lt;div class=&#34;container mt-3&#34;&gt; &lt;h2&gt;天气&lt;/h2&gt; &lt;form action=&#34;&#34; id=&#34;form1&#34; runat=&#34;server&#34;&gt; &lt;div class=&#34;mb-3 mt-3&#34; id=&#34;bbb&#34;&gt; &lt;label class=&#34;form-label&#34;&gt;城市编号:&lt;/label&gt; &lt;label class=&#34;form-label&#34;&gt;&lt;/label&gt; &lt;input type=&#34;text&#34; class=&#34;form-control&#34; id=&#34;city&#34; placeholder=&#34;Enter city number&#34; value=&#34;101030100&#34; name=&#34;CityNumber&#34;&gt; &lt;/div&gt; &lt;button type=&#34;button&#34; id=&#34;obtain&#34; class=&#34;btn btn-primary&#34; &gt;获取&lt;/button&gt; &lt;/form&gt;&lt;br /&gt; &lt;table class=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9ccf76daf0b46390e35ea08719fbd312/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-22T17:50:02+08:00" />
<meta property="article:modified_time" content="2022-08-22T17:50:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">.NET/C#获取十五日天气预报</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <ul><li>今天来为大家提供一个获取天气的一个接口方法并且返还到页面上，通过前端代码显示出来</li><li>本次的代码量不多，完全可以直接复制粘贴</li><li>如果除了什么问题大家可以在下方评论留言！</li></ul> 
<hr> 
<h4>1、首先我们要获取到天气的AP链接地址，链接地址如下，我们可以去这个网站去拿：</h4> 
<p><a href="https://www.sojson.com/blog/305.html" rel="nofollow" title="免费天气API，天气JSON API，不限次数获取十五天的天气预报 —技术博客">免费天气API，天气JSON API，不限次数获取十五天的天气预报 —技术博客</a></p> 
<p>上方这个网站会会有天气的API地址并且会初步的教您如何使用 <strong>↑</strong></p> 
<hr> 
<h4>2、在上方我们拿到天气的api后，网站里还会给我们提供哥哥城市的一个ID我们查找是通过ID来查找的，当然也可以转换成名字大家可以自己转换。下面这个链接是上面那个网站里面给咱提供的城市数据：大家可以通过方法把数据添加到数据库中，也可以只用自己需要城市的按需求用：</h4> 
<h2>城市数据：</h2> 
<p>请在百度网盘下载：链接: <code>https://pan.baidu.com/s/1JFAwnH2MRLc5OD3hsJZwGQ</code> 提取码: <code>u8sk</code> </p> 
<hr> 
<h4>3、我们在获取上面两个东西后我们就可以开始进行项目的编写了，下面我来教大家如何获取天气并显示：首先我们需要新建一个.net的项目。新建一个控制器咋里面添加一个index页面：index页面的内容我给大家贴在下方直接复制：</h4> 
<pre><code class="language-html">@{
    ViewBag.Title = "天气";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
&lt;style&gt;
    .laytable-cell-1-ImgUrl {
        height: 100%;
        max-width: 100%;
    }

    .xm-form-select {
        width: 180px;
    }
&lt;/style&gt;
&lt;div class="container mt-3"&gt;
  &lt;h2&gt;天气&lt;/h2&gt;
	&lt;form action="" id="form1" runat="server"&gt;
	  &lt;div class="mb-3 mt-3" id="bbb"&gt;
		&lt;label class="form-label"&gt;城市编号:&lt;/label&gt;
        &lt;label class="form-label"&gt;&lt;/label&gt;
		&lt;input type="text" class="form-control" id="city" placeholder="Enter city number" value="101030100" name="CityNumber"&gt;
	  &lt;/div&gt;
	  &lt;button type="button" id="obtain" class="btn btn-primary" &gt;获取&lt;/button&gt;
	&lt;/form&gt;&lt;br /&gt;
    &lt;table class="table"&gt;
       &lt;h3 id="r" style="width:100%;text-align:center"&gt;&lt;/h3&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;日期&lt;/th&gt;
        &lt;th&gt;风力&lt;/th&gt;
        &lt;th&gt;风向&lt;/th&gt;
        &lt;th&gt;高温&lt;/th&gt;
        &lt;th&gt;低温&lt;/th&gt;
        &lt;th&gt;标语&lt;/th&gt;
        &lt;th&gt;类型&lt;/th&gt;
        &lt;th&gt;星期&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody id="tablelist"&gt;
      
    &lt;/tbody&gt;
&lt;/table&gt;
&lt;/div&gt;
&lt;!-- 新 Bootstrap5 核心 CSS 文件 --&gt;
&lt;link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/css/bootstrap.min.css"&gt;
&lt;!--  popper.min.js 用于弹窗、提示、下拉菜单 --&gt;
&lt;script src="https://cdn.staticfile.org/popper.js/2.9.3/umd/popper.min.js"&gt;&lt;/script&gt;
&lt;!-- 最新的 Bootstrap5 核心 JavaScript 文件 --&gt;
&lt;script src="https://cdn.staticfile.org/twitter-bootstrap/5.1.1/js/bootstrap.min.js"&gt;&lt;/script&gt;
&lt;script src="~/lib/jquery/dist/jquery.min.js"&gt;&lt;/script&gt;
&lt;script&gt;
     //跳转后左侧导航变化
     var menu = $(".Weather");
     menu.addClass("layui-this ");
     if (menu[0].tagName == 'DD') {
        menu.parent().parent().addClass("layui-nav-itemed");
    };
    $(function() {
        var codelist;
        //请求天气
        $("#obtain").click(function () {
                $.ajax({
                    url: "/Weather/GetWeatherByCity",
                    type: "get",
                    //dataType: "json",
                    data: {
                        "cityCode": $("#city").val()
                    },
                    success: function (result) {
                        $("td").remove();
                        var list = JSON.parse(result);
                        //城市
                        var city = list.cityInfo.city;
                        console.log(city);
			            console.log(list);
                        codelist = list;
                        console.log(typeof (list));
                        //console.log(codelist.data.forecast[0].high);
                        $("#r").html(city);          
                        var list1 = codelist.data.forecast;
                        console.log(list1);

                        for (var i = 0; i &lt;= list1.length; i++) {
                            //alert(i);
                            var trs = "&lt;tr&gt;&lt;td&gt;" + list.data.forecast[i].ymd 
                                + "&lt;/td&gt;&lt;td&gt;" + list1[i].fl 
                                + "&lt;/td&gt;&lt;td&gt;" + list1[i].fx
                                + "&lt;/td&gt;&lt;td&gt;" + list1[i].high 
                                + "&lt;/td&gt;&lt;td&gt;" + list1[i].low 
                                + "&lt;/td&gt;&lt;td&gt;" + list1[i].notice
                                + "&lt;/td&gt;&lt;td&gt;" + list1[i].type 
                                + "&lt;/td&gt;&lt;td&gt;" + list1[i].week
                                + "&lt;/td&gt;&lt;/tr&gt;";
                            $("#tablelist").append(trs);
                        };
                        $("#codecity").html(city)
                    },
                    error: function (XMLHttpRequest, textStatus, errorThrown) {
                            console.log("错误：" + XMLHttpRequest);
                        }
                })
            })
        




    })









    

&lt;/script&gt;</code></pre> 
<p>在这个里面我们采用的是动态生成表格的形式来把Ajax获取的数据进行一个展示大家可以自己随意修改样式，不用非得按照我这个来我这个只是图简单。</p> 
<hr> 
<h4>4、我们在写好上方index页面的前端内容后，我们接下来就需要书写控制器里面的请求方法，只需要一个方法我们就可以请求到天气大家直接复制粘贴就好：</h4> 
<pre><code class="language-cs">using Core.DB.Models;
using Microsoft.AspNetCore.Mvc;
using System;
using System.Net;

namespace Core.AdminUI.Controllers
{
    public class WeatherController
    {
        public IActionResult Index()
        {
            return View();
        }

        /// &lt;summary&gt;
        /// 根据城市编码获取天气json
        /// &lt;/summary&gt;
        /// &lt;param name="cityCode"&gt;城市编码&lt;/param&gt;
        /// &lt;returns&gt;天气json&lt;/returns&gt;
        [HttpGet]
        public string GetWeatherByCity(string cityCode)
        {
            try
            {
                //请求的时候我们需要前台给我们传递一个城市数据的ID就是我们下载的文档里面的编号
                //下方的请求连接加上要请求城市的ID编号，就可以请求到
                string url = "http://t.weather.itboy.net/api/weather/city/" + cityCode;
                System.Net.HttpWebRequest request = (System.Net.HttpWebRequest)System.Net.WebRequest.Create(url);
                request.Timeout = 10000;
                request.UserAgent = "Code Sample Web Client";
                request.Credentials = CredentialCache.DefaultCredentials;
                //HttpWebRequest 对象 获取GetResponse 转换成HttpWebResponse
                System.Net.HttpWebResponse response = request.GetResponse() as System.Net.HttpWebResponse;
                //通过HttpWebResponse response.GetResponseStream()获取输出流
                System.IO.Stream str = response.GetResponseStream();
                System.IO.StreamReader reader = new System.IO.StreamReader(str, System.Text.Encoding.GetEncoding("utf-8"));
                string weathhtml = reader.ReadToEnd();
                str.Close();
                reader.Close();
                return weathhtml;
            }
            catch (Exception)
            {
                return "请求异常";
            }
        }



    }
}
</code></pre> 
<p>大家切记一定要在下载的文档中输入有效的编号ID！！！</p> 
<p>5、最终运行效果就是如下图所致：</p> 
<p><img alt="" height="873" src="https://images2.imgbox.com/41/b2/LB9DYXOD_o.png" width="1200"></p> 
<p> 上方输入框里的编号获取的就是你们下载的文档里面的城市编号大家可以通过EXCEL到数据库的方法，把数据转到数据库方便后续使用和其他复杂操作！！！！excel导入数据库地址是：<a href="https://blog.csdn.net/weixin_59180442/article/details/126404287" title=".NET/C# — EXCEL文件内容添加到数据库中_^请叫我小祸害^的博客-CSDN博客_c#导入excel数据到数据库">.NET/C# — EXCEL文件内容添加到数据库中_^请叫我小祸害^的博客-CSDN博客_c#导入excel数据到数据库</a></p> 
<p>大家如果有什么疑问可以下方留言！！或私信！</p> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8c05449cee032522879ebc9adeed72cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">docker之仓库原理6</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49d22270773319782bc1db855aa2ef18/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">10万字208道Java经典面试题总结(附答案)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>