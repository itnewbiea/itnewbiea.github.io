<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Prism学习：Region的使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Prism学习：Region的使用" />
<meta property="og:description" content="Prism学习：Region的使用 什么是Region使用Region的两种方式通过Region使View和ViewModel解耦创建一个项目使用Region将View和ViewModel解耦 什么是Region 在我们的日常开发中，通常会将一个页面切割成不同的部分。如下一个页面，我们可以将其划分为头部、左侧目录、页面主体三个部分。
在Prism中，我们可以将这三个部分理解为三个区域（Region），而区域之中可以再细分区域。Region负责承担UI控件，其中内容并不固定，可以动态分配。
Prism中Region通过RegionManager进行管理。
使用Region的两种方式 方式1：
给页面中的内容控件设置RegionName
&lt;ContentControl Grid.Row=&#34;1&#34; prism:RegionManager.RegionName=&#34;ContentRegion&#34; /&gt; 在页面的构造函数中注册Region中需要展示的内容，其中ViewA是定义在另一个xaml文件中的页面模块。
public MainView(IRegionManager regionManager) { InitializeComponent(); regionManager.RegisterViewWithRegion(&#34;ContentRegion&#34;, typeof(ViewA)); } 方式2：
给页面的内容控件设置Name。
&lt;ContentControl Grid.Row=&#34;1&#34; x:Name=&#34;MainContent&#34; /&gt; 在构造函数中通过SetRegionName方法设置RegionName，并注册Region中需要展示的内容。
public MainView(IRegionManager regionManager) { InitializeComponent(); RegionManager.SetRegionName(MainContent, &#34;ContentRegion&#34;); regionManager.RegisterViewWithRegion(&#34;ContentRegion&#34;, typeof(ViewA)); } 通过Region使View和ViewModel解耦 创建一个项目 项目只有一个窗体，但有两个页面模块，需要通过两个按钮进行页面切换。
在ViewModel设置一个object类型的对象Body来存放页面模块。
点击按钮后，通过Command中的委托方法来切换页面模块。
项目结构如下：
页面如下：
页面文件：MainView.xaml
&lt;Window x:Class=&#34;PrismDemo.Views.MainView&#34; xmlns=&#34;http://schemas.microsoft.com/winfx/2006/xaml/presentation&#34; xmlns:x=&#34;http://schemas.microsoft.com/winfx/2006/xaml&#34; xmlns:d=&#34;http://schemas.microsoft.com/expression/blend/2008&#34; xmlns:local=&#34;clr-namespace:PrismDemo&#34; xmlns:mc=&#34;http://schemas.openxmlformats.org/markup-compatibility/2006&#34; xmlns:prism=&#34;http://prismlibrary.com/&#34; Title=&#34;MainWindow&#34; Width=&#34;800&#34; Height=&#34;450&#34; prism:ViewModelLocator.AutoWireViewModel=&#34;True&#34; mc:Ignorable=&#34;d&#34;&gt; &lt;Grid&gt; &lt;Grid.RowDefinitions&gt; &lt;RowDefinition Height=&#34;28&#34; /&gt; &lt;RowDefinition /&gt; &lt;/Grid.RowDefinitions&gt; &lt;StackPanel Orientation=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c8160edd48af2ab240906fa581ecf1a7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-23T12:38:18+08:00" />
<meta property="article:modified_time" content="2023-02-23T12:38:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Prism学习：Region的使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Prism学习：Region的使用</h4> 
 <ul><li><a href="#Region_1" rel="nofollow">什么是Region</a></li><li><a href="#Region_13" rel="nofollow">使用Region的两种方式</a></li><li><a href="#RegionViewViewModel_54" rel="nofollow">通过Region使View和ViewModel解耦</a></li><li><ul><li><a href="#_58" rel="nofollow">创建一个项目</a></li><li><a href="#RegionViewViewModel_158" rel="nofollow">使用Region将View和ViewModel解耦</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="Region_1"></a>什么是Region</h2> 
<p>在我们的日常开发中，通常会将一个页面切割成不同的部分。如下一个页面，我们可以将其划分为头部、左侧目录、页面主体三个部分。</p> 
<p>在Prism中，我们可以将这三个部分理解为三个区域（Region），而区域之中可以再细分区域。Region负责承担UI控件，其中内容并不固定，可以动态分配。</p> 
<p>Prism中Region通过RegionManager进行管理。</p> 
<p><img src="https://images2.imgbox.com/ef/56/vLKdGpDj_o.png" alt="image-20230223113552392"></p> 
<h2><a id="Region_13"></a>使用Region的两种方式</h2> 
<p>方式1：</p> 
<ol><li> <p>给页面中的内容控件设置RegionName</p> <pre><code class="prism language-xaml">&lt;ContentControl Grid.Row="1" prism:RegionManager.RegionName="ContentRegion" /&gt;
</code></pre> </li><li> <p>在页面的构造函数中注册Region中需要展示的内容，其中ViewA是定义在另一个xaml文件中的页面模块。</p> <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token function">MainView</span><span class="token punctuation">(</span><span class="token class-name">IRegionManager</span> regionManager<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    regionManager<span class="token punctuation">.</span><span class="token function">RegisterViewWithRegion</span><span class="token punctuation">(</span><span class="token string">"ContentRegion"</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ViewA</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<p>方式2：</p> 
<ol><li> <p>给页面的内容控件设置Name。</p> <pre><code class="prism language-xaml">&lt;ContentControl Grid.Row="1" x:Name="MainContent" /&gt;
</code></pre> </li><li> <p>在构造函数中通过SetRegionName方法设置RegionName，并注册Region中需要展示的内容。</p> <pre><code class="prism language-csharp"><span class="token keyword">public</span> <span class="token function">MainView</span><span class="token punctuation">(</span><span class="token class-name">IRegionManager</span> regionManager<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">InitializeComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    RegionManager<span class="token punctuation">.</span><span class="token function">SetRegionName</span><span class="token punctuation">(</span>MainContent<span class="token punctuation">,</span> <span class="token string">"ContentRegion"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    regionManager<span class="token punctuation">.</span><span class="token function">RegisterViewWithRegion</span><span class="token punctuation">(</span><span class="token string">"ContentRegion"</span><span class="token punctuation">,</span> <span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">ViewA</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> </li></ol> 
<h2><a id="RegionViewViewModel_54"></a>通过Region使View和ViewModel解耦</h2> 
<h3><a id="_58"></a>创建一个项目</h3> 
<p>项目只有一个窗体，但有两个页面模块，需要通过两个按钮进行页面切换。</p> 
<p>在ViewModel设置一个object类型的对象Body来存放页面模块。</p> 
<p>点击按钮后，通过Command中的委托方法来切换页面模块。</p> 
<p>项目结构如下：</p> 
<p><img src="https://images2.imgbox.com/ad/9b/QZDGFUH8_o.png" alt="image-20230223120647094"></p> 
<p>页面如下：</p> 
<p><img src="https://images2.imgbox.com/e6/57/e8UdHE6k_o.png" alt="image-20230223120300220"></p> 
<p>页面文件：MainView.xaml</p> 
<pre><code class="prism language-xaml">&lt;Window
    x:Class="PrismDemo.Views.MainView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:PrismDemo"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:prism="http://prismlibrary.com/"
    Title="MainWindow"
    Width="800"
    Height="450"
    prism:ViewModelLocator.AutoWireViewModel="True"
    mc:Ignorable="d"&gt;
    &lt;Grid&gt;
        &lt;Grid.RowDefinitions&gt;
            &lt;RowDefinition Height="28" /&gt;
            &lt;RowDefinition /&gt;
        &lt;/Grid.RowDefinitions&gt;
        &lt;StackPanel Orientation="Horizontal"&gt;
            &lt;Button
                Margin="5"
                Command="{Binding OpenCommand}"
                CommandParameter="ViewA"
                Content="模块A" /&gt;
            &lt;Button
                Margin="5"
                Command="{Binding OpenCommand}"
                CommandParameter="ViewB"
                Content="模块B" /&gt;
        &lt;/StackPanel&gt;
        &lt;ContentControl Grid.Row="1" Content="{Binding Body}" /&gt;
    &lt;/Grid&gt;
&lt;/Window&gt;

</code></pre> 
<p>MainViewModel.cs</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Prism<span class="token punctuation">.</span>Commands</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Prism<span class="token punctuation">.</span>Mvvm</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Prism<span class="token punctuation">.</span>Regions</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">PrismDemo<span class="token punctuation">.</span>Views</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">PrismDemo<span class="token punctuation">.</span>ViewModels</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">class</span> <span class="token class-name">MainViewModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">BindableBase</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">/**如下代码中，View与ViewModel耦合
        *随着页面增多时，耦合情况会越来越严重，那么ViewModel将不堪重负
        *可以使用Prism中的区域(Region)优化
        */</span>
        <span class="token keyword">public</span> <span class="token return-type class-name">DelegateCommand<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> OpenCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token keyword">public</span> <span class="token function">MainViewModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            OpenCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DelegateCommand<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>Open<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">private</span> <span class="token class-name"><span class="token keyword">object</span></span> body<span class="token punctuation">;</span>
        <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> Body
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">get</span> <span class="token punctuation">{<!-- --></span> <span class="token keyword">return</span> body<span class="token punctuation">;</span> <span class="token punctuation">}</span>
            <span class="token keyword">set</span> <span class="token punctuation">{<!-- --></span> body <span class="token operator">=</span> <span class="token keyword">value</span><span class="token punctuation">;</span> <span class="token function">RaisePropertyChanged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> obj<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">switch</span> <span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">case</span> <span class="token string">"ViewA"</span><span class="token punctuation">:</span> Body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ViewA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
                <span class="token keyword">case</span> <span class="token string">"ViewB"</span><span class="token punctuation">:</span> Body <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">ViewB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="RegionViewViewModel_158"></a>使用Region将View和ViewModel解耦</h3> 
<p>将上面MainView.xaml代码中的页面主体控件ContentControl更改如下：取消Body，并给ContentControl设置RegionName为ContentRegion。</p> 
<pre><code class="prism language-xaml">&lt;Grid&gt;
     &lt;!--&lt;ContentControl Grid.Row="1" Content="{Binding Body}" /&gt;--&gt;
     &lt;ContentControl Grid.Row="1" prism:RegionManager.RegionName="ContentRegion" /&gt;&lt;/Grid&gt;
</code></pre> 
<p>在App.xaml.cs中，实现RegisterTypes方法，将两个View通过依赖注入注册为导航</p> 
<pre><code class="prism language-csharp"><span class="token keyword">using</span> <span class="token namespace">Prism<span class="token punctuation">.</span>DryIoc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">Prism<span class="token punctuation">.</span>Ioc</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">PrismDemo<span class="token punctuation">.</span>Views</span><span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token namespace">System<span class="token punctuation">.</span>Windows</span><span class="token punctuation">;</span>

<span class="token keyword">namespace</span> <span class="token namespace">PrismDemo</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">/// &lt;summary&gt;</span>
    <span class="token comment">/// Interaction logic for App.xaml</span>
    <span class="token comment">/// &lt;/summary&gt;</span>
    <span class="token keyword">public</span> <span class="token keyword">partial</span> <span class="token keyword">class</span> <span class="token class-name">App</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">PrismApplication</span></span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name">Window</span> <span class="token function">CreateShell</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//从容器中获取MainView</span>
            <span class="token keyword">return</span> Container<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Resolve</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>MainView<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">protected</span> <span class="token keyword">override</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">RegisterTypes</span><span class="token punctuation">(</span><span class="token class-name">IContainerRegistry</span> containerRegistry<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//依赖注入</span>
            <span class="token comment">//此处可以给对应导航设置别名，不设置则默认为类名</span>
            containerRegistry<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterForNavigation</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ViewA<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"ViewA"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            containerRegistry<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">RegisterForNavigation</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>ViewB<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>将MainViewModel代码更改如下：</p> 
<ul><li>取消原先用于存储View页面模板的Body属性，并引入IRegionManager来管理Regions。</li><li>regionManager.Regions[“ContentRegion”]可以获取到页面中的Region</li><li>.RequestNavigate(obj) 请求在容器中以及注册了的页面导航</li></ul> 
<pre><code class="prism language-csharp"><span class="token keyword">class</span> <span class="token class-name">MainViewModel</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">BindableBase</span></span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">readonly</span> <span class="token class-name">IRegionManager</span> regionManager<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DelegateCommand<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span> OpenCommand <span class="token punctuation">{<!-- --></span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token function">MainViewModel</span><span class="token punctuation">(</span><span class="token class-name">IRegionManager</span> regionManager<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        OpenCommand <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">DelegateCommand<span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>Open<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>regionManager <span class="token operator">=</span> regionManager<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**通过App.xaml.cs中的RegisterTypes方法依赖注入了各个View
         * 通过Region中的方法可以获取到这些View
         * 不需要像上面注释的代码一样定义属性来变更页面模块
         * 这样ViewModel代码就跟具体前端页面模块解耦了
         */</span>
    <span class="token keyword">private</span> <span class="token return-type class-name"><span class="token keyword">void</span></span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token class-name"><span class="token keyword">string</span></span> obj<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//首先通过IRegionManager接口获取当前全局定义的可用区域</span>
        <span class="token comment">//往这个区域动态地设置内容</span>
        <span class="token comment">//内容设置的方式是通过依赖注入的形式</span>
        regionManager<span class="token punctuation">.</span>Regions<span class="token punctuation">[</span><span class="token string">"ContentRegion"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">RequestNavigate</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c8b0a127490011654e48aa7ae3f3dfdc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Python表白代码</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7f7842be302f4a0f85dce3e95a00388b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">React从入门到精通二</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>