<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>如何把Maya坐标系转换到UE坐标系 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="如何把Maya坐标系转换到UE坐标系" />
<meta property="og:description" content="最近接到一个需求，需要把一个物体在maya中的移动旋转发送到UE中，并且maya中的坐标轴需要能变化一次，UE中则保持原有坐标轴的位置。
位移
因为位移不基于坐标轴，所以直接把maya中在XYZ轴上的坐标值复制到UE中即可，但要注意Maya是Y轴向上的Ue是Z轴向上的，需要把Y轴数据和Z轴数据交换一下位置。
旋转
旋转是最难处理的部分，因为UE是Z轴向上的左手坐标系，Maya是Y轴向上的右手坐标系，一开始我想把Maya的数值直接复制到UE里面，然后交换Y和Z轴并且，翻转Z轴的数值，结果发现在0到90度之间，这个想法都是没有问题的，可一旦超过90°，就完全无法对应了。
xyz等于15°maya中的效果
xyz等于15°UE中的效果
xyz等于90°maya中的效果
xyz等于90°UE中的效果
可以看到在xyz为90的时候maya和UE在相同镜头角度下呈现出完全不同的效果，而且无论以何种组合翻转轴向都无法得到正确的结果，试验之后发现在Maya，XYZ都是90度的情况下，UE中正确的旋转角度是0,0，-90，那么如何得到这个值？
旋转公式
首先想到的是Maya和UE的旋转角公式不同，所以同样的旋转要用不同的角度描述，用两个旋转公式按照各自的顺序旋转一个相同的向量，应该可以根据已知的角度，求出另一个角度，但查阅了有关文档，UE的旋转角公式和顺序几乎没有，只查到了连接而且作者似乎也不是很确定，而且这个方法似乎也有一些问题。
找了半天，终于发现了一个如何把Houdini的旋转转换到UE中的回答，他是先把Maya中的欧拉角旋转，转换成四元数旋转，然后翻转这个旋转中的W，并且交换Z和Y的值。正好在UE中提供了四元数和欧拉角转换的API
# NOTE Split Maya data Rotate = TransfromData[&#39;Rotate&#39;] rotationQuat = unreal.Quat() # Convert to unreal Aixs # Convert to Quat rotationQuat.set_from_euler(unreal.Vector(Rotate[0],Rotate[1],Rotate[2])) # SWAP Z and Y temp = rotationQuat.z rotationQuat.z = rotationQuat.y rotationQuat.y = temp # inverse W value rotationQuat.w = -1 * rotationQuat.w 实验之后发现，只有在Z轴上的旋转是正确的，在XY上的旋转都无法对应，看来是Maya和Houdini的坐标系也有区别，不过试了几次之后发现，似乎XY上的旋转都是发的只要加一个负号就可以得到正确的结果了，于是改了改代码
# NOTE Split Maya data Rotate = TransfromData[&#39;Rotate&#39;] rotationQuat = unreal.Quat() # Convert to unreal Aixs # Convert to Quat rotationQuat." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/2ee210e4e1d799925bb14a1cfbd4f8cb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-16T10:11:04+08:00" />
<meta property="article:modified_time" content="2022-02-16T10:11:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">如何把Maya坐标系转换到UE坐标系</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>最近接到一个需求，需要把一个物体在maya中的移动旋转发送到UE中，并且maya中的坐标轴需要能变化一次，UE中则保持原有坐标轴的位置。<br> <strong>位移</strong><br> 因为位移不基于坐标轴，所以直接把maya中在XYZ轴上的坐标值复制到UE中即可，但要注意Maya是Y轴向上的Ue是Z轴向上的，需要把Y轴数据和Z轴数据交换一下位置。<br> <strong>旋转</strong><br> 旋转是最难处理的部分，因为UE是Z轴向上的左手坐标系，Maya是Y轴向上的右手坐标系，一开始我想把Maya的数值直接复制到UE里面，然后交换Y和Z轴并且，翻转Z轴的数值，结果发现在0到90度之间，这个想法都是没有问题的，可一旦超过90°，就完全无法对应了。</p> 
<p><img src="https://images2.imgbox.com/32/e2/CEAmarbb_o.png" alt="xyz等于15maya中的效果"><br> xyz等于15°maya中的效果</p> 
<p><img src="https://images2.imgbox.com/93/ca/CN5Kqyi1_o.png" alt="xyz等于15UE中的效果"><br> xyz等于15°UE中的效果</p> 
<p><img src="https://images2.imgbox.com/1b/61/lHxgLqLw_o.png" alt="xyz等于90maya中的效果"><br> xyz等于90°maya中的效果<br> <img src="https://images2.imgbox.com/d3/67/ajWsPIIO_o.png" alt="在这里插入图片描述"><br> xyz等于90°UE中的效果</p> 
<p>可以看到在xyz为90的时候maya和UE在相同镜头角度下呈现出完全不同的效果，而且无论以何种组合翻转轴向都无法得到正确的结果，试验之后发现在Maya，XYZ都是90度的情况下，UE中正确的旋转角度是0,0，-90，那么如何得到这个值？<br> <strong>旋转公式</strong><br> 首先想到的是Maya和UE的旋转角公式不同，所以同样的旋转要用不同的角度描述，用两个旋转公式按照各自的顺序旋转一个相同的向量，应该可以根据已知的角度，求出另一个角度，但查阅了有关文档，UE的旋转角公式和顺序几乎没有，只查到了<a href="https://forums.unrealengine.com/t/euler-rotations-and-matrix-questions/4450/2" rel="nofollow">连接</a>而且作者似乎也不是很确定，而且这个方法似乎也有一些问题。<br> 找了半天，终于发现了一个如何把Houdini的旋转转换到UE中的回答，他是先把Maya中的欧拉角旋转，转换成四元数旋转，然后翻转这个旋转中的W，并且交换Z和Y的值。正好在UE中提供了四元数和欧拉角转换的API</p> 
<pre><code class="prism language-python">    <span class="token comment"># NOTE Split Maya data</span>
    Rotate <span class="token operator">=</span> TransfromData<span class="token punctuation">[</span><span class="token string">'Rotate'</span><span class="token punctuation">]</span> 
    rotationQuat <span class="token operator">=</span> unreal<span class="token punctuation">.</span>Quat<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Convert to unreal Aixs</span>
    <span class="token comment"># Convert to Quat  </span>
    rotationQuat<span class="token punctuation">.</span>set_from_euler<span class="token punctuation">(</span>unreal<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span>Rotate<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Rotate<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Rotate<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># SWAP Z and Y</span>
    temp <span class="token operator">=</span> rotationQuat<span class="token punctuation">.</span>z
    rotationQuat<span class="token punctuation">.</span>z <span class="token operator">=</span> rotationQuat<span class="token punctuation">.</span>y
    rotationQuat<span class="token punctuation">.</span>y <span class="token operator">=</span> temp
    <span class="token comment"># inverse W value</span>
    rotationQuat<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> rotationQuat<span class="token punctuation">.</span>w
</code></pre> 
<p>实验之后发现，只有在Z轴上的旋转是正确的，在XY上的旋转都无法对应，看来是Maya和Houdini的坐标系也有区别，不过试了几次之后发现，似乎XY上的旋转都是发的只要加一个负号就可以得到正确的结果了，于是改了改代码</p> 
<pre><code class="prism language-python">    <span class="token comment"># NOTE Split Maya data</span>
    Rotate <span class="token operator">=</span> TransfromData<span class="token punctuation">[</span><span class="token string">'Rotate'</span><span class="token punctuation">]</span> 
    rotationQuat <span class="token operator">=</span> unreal<span class="token punctuation">.</span>Quat<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Convert to unreal Aixs</span>
    <span class="token comment"># Convert to Quat  </span>
    rotationQuat<span class="token punctuation">.</span>set_from_euler<span class="token punctuation">(</span>unreal<span class="token punctuation">.</span>Vector<span class="token punctuation">(</span><span class="token operator">-</span>Rotate<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token operator">-</span>Rotate<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>Rotate<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment"># SWAP Z and Y</span>
    temp <span class="token operator">=</span> rotationQuat<span class="token punctuation">.</span>z
    rotationQuat<span class="token punctuation">.</span>z <span class="token operator">=</span> rotationQuat<span class="token punctuation">.</span>y
    rotationQuat<span class="token punctuation">.</span>y <span class="token operator">=</span> temp
    <span class="token comment"># inverse W value</span>
    rotationQuat<span class="token punctuation">.</span>w <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token operator">*</span> rotationQuat<span class="token punctuation">.</span>w
</code></pre> 
<p>这次测试过后发现终于完美实现了旋转信息的传递，接下来就是坐标轴变化的部分了<br> 因为旋转是基于坐标轴位置的，但无论在什么坐标轴下旋转，旋转后得到的物体的角度是相同的，也就是说，只要求出不同坐标轴在旋转之后所产生的的偏移，然后抵消掉这个偏移就可以了。</p> 
<pre><code class="prism language-python">    Pivot <span class="token operator">=</span> TransfromData<span class="token punctuation">[</span><span class="token string">'Pivot'</span><span class="token punctuation">]</span>
    <span class="token comment"># 排除本来偏移对坐标轴位置的影响</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token builtin">len</span><span class="token punctuation">(</span>Pivot<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        Pivot<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> Pivot<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>Translate<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
    <span class="token comment"># 把旋转角度转换为弧度制</span>
    XRadAngle <span class="token operator">=</span> Rotate<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">180.0</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi
    YRadAngle <span class="token operator">=</span> Rotate<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">180.0</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi
    ZRadAngle <span class="token operator">=</span> Rotate<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">/</span><span class="token number">180.0</span><span class="token operator">*</span>math<span class="token punctuation">.</span>pi
    <span class="token comment"># 计算三角函数值</span>
    XCosa <span class="token operator">=</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>XRadAngle<span class="token punctuation">)</span>
    XSina <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>XRadAngle<span class="token punctuation">)</span>
    YCosa <span class="token operator">=</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>YRadAngle<span class="token punctuation">)</span>
    YSina <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>YRadAngle<span class="token punctuation">)</span>
    ZCosa <span class="token operator">=</span> math<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>ZRadAngle<span class="token punctuation">)</span>
    ZSina <span class="token operator">=</span> math<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>ZRadAngle<span class="token punctuation">)</span>
    <span class="token comment"># 这里写了一个矩阵的类，也可以用UE的类</span>
    pivotOver <span class="token operator">=</span> Mat<span class="token punctuation">.</span>Mat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>Pivot<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>Pivot<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>Pivot<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 写出x，y，z的旋转矩阵</span>
    XAxiRotate <span class="token operator">=</span> Mat<span class="token punctuation">.</span>Mat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>XCosa<span class="token punctuation">,</span><span class="token operator">-</span>XSina<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span>XSina<span class="token punctuation">,</span>XCosa<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    YAxiRotate <span class="token operator">=</span> Mat<span class="token punctuation">.</span>Mat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>YCosa<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>YSina<span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token operator">-</span>YSina<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span>YCosa<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    ZAxiRotate <span class="token operator">=</span> Mat<span class="token punctuation">.</span>Mat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span>ZCosa<span class="token punctuation">,</span><span class="token operator">-</span>ZSina<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>ZSina<span class="token punctuation">,</span>ZCosa<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token comment"># 按顺序应用旋转矩阵</span>
    PivotNew <span class="token operator">=</span> ZAxiRotate <span class="token operator">*</span> YAxiRotate <span class="token operator">*</span> XAxiRotate <span class="token operator">*</span> pivotOver
    <span class="token comment"># 计算之前坐标轴和新坐标轴的偏移</span>
    Offset <span class="token operator">=</span> pivotOver <span class="token operator">-</span> PivotNew
    <span class="token comment">#最后把这个偏移加上原有的位移即可</span>
</code></pre> 
<blockquote> 
 <p>参考<br> <a href="https://www.gamedev.net/forums/topic/703263-3d-app-euler-rotations-to-ue4-euler-rotations/" rel="nofollow">https://www.gamedev.net/forums/topic/703263-3d-app-euler-rotations-to-ue4-euler-rotations/</a><br> <a href="https://www.sidefx.com/forum/topic/69197/?page=1#post-304968" rel="nofollow">https://www.sidefx.com/forum/topic/69197/?page=1#post-304968</a></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/38437ce90298bfe81fb7057192e49301/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">UE中渲染自发光通道的折衷方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/9d6891508a4c2ed1706447f65bfa1119/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">1、1、2、3、5、8、13、21、34求第n位数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>