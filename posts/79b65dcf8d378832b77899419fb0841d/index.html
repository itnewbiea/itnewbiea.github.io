<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nodejs学习（六）--异步流控制 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nodejs学习（六）--异步流控制" />
<meta property="og:description" content="1.串行无关联 2.并行无关联 3.串行有关联 4.paralleLimit:与paralle相似， 但是多了一个limit, limit参数限制任务只能同时并发一定的数量， 而不是无限制的并发
1.串行无关联 var async = require(&#39;async&#39;) function oneFun() { var ii=0; setInterval(function() { console.log(&#39;aaaaaa&#39; &#43; new Date()); ii&#43;&#43;; if (ii == 3){ clearInterval(this); } }, 1000) console.log(&#39;oneFun&#39;) } function twoFun() { console.log(&#39;twoFun&#39;) } function exec() { async.series( { one:function(done) { var ii=0; setInterval(function() { console.log(&#39;aaaaaa&#39; &#43; new Date()); ii&#43;&#43;; if (ii == 3){ clearInterval(this); done(null,&#39;one completed&#39;); } }, 1000) }, two:function(done) { var jj=0; setInterval(function() { console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/79b65dcf8d378832b77899419fb0841d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-10-15T22:28:13+08:00" />
<meta property="article:modified_time" content="2017-10-15T22:28:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nodejs学习（六）--异步流控制</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>1.串行无关联</strong> <br> <strong>2.并行无关联</strong> <br> <strong>3.串行有关联</strong> <br> <strong>4.paralleLimit:与paralle相似， 但是多了一个limit,</strong> <br> <strong>limit参数限制任务只能同时并发一定的数量， 而不是无限制的并发</strong></p> 
<h3 id="1串行无关联">1.串行无关联</h3> 
<pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-keyword">var</span> async = <span class="hljs-built_in">require</span>(<span class="hljs-string">'async'</span>)
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">oneFun</span><span class="hljs-params">()</span> {<!-- --></span>
    <span class="hljs-keyword">var</span> ii=<span class="hljs-number">0</span>;
    setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
        console.log(<span class="hljs-string">'aaaaaa'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
        ii++;
        <span class="hljs-keyword">if</span> (ii == <span class="hljs-number">3</span>){
            clearInterval(<span class="hljs-keyword">this</span>);
        }
    }, <span class="hljs-number">1000</span>)
    console.log(<span class="hljs-string">'oneFun'</span>)
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">twoFun</span><span class="hljs-params">()</span> {<!-- --></span>

    console.log(<span class="hljs-string">'twoFun'</span>)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exec</span><span class="hljs-params">()</span> {<!-- --></span>
    async.series(
        {
            one:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {<!-- --></span>
                <span class="hljs-keyword">var</span> ii=<span class="hljs-number">0</span>;
                setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
                console.log(<span class="hljs-string">'aaaaaa'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
                ii++;
                <span class="hljs-keyword">if</span> (ii == <span class="hljs-number">3</span>){
                    clearInterval(<span class="hljs-keyword">this</span>);
                    done(<span class="hljs-literal">null</span>,<span class="hljs-string">'one completed'</span>);
                }
            }, <span class="hljs-number">1000</span>)

            }, 
            two:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {<!-- --></span>
                <span class="hljs-keyword">var</span> jj=<span class="hljs-number">0</span>;
                setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
                console.log(<span class="hljs-string">'bbbbbb'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
                jj++;
                <span class="hljs-keyword">if</span> (jj == <span class="hljs-number">3</span>){
                    clearInterval(<span class="hljs-keyword">this</span>);
                    done(<span class="hljs-literal">null</span>,<span class="hljs-string">'two completed'</span>);
                }
            }, <span class="hljs-number">1000</span>)

            }
        },<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,rs)</span>{<!-- --></span>
            console.log(err);
            console.log(rs);
        }
    )

}
exec();
console.log(<span class="hljs-string">'main thread ok'</span>)</code></pre> 
<p>运行结果为： <br> <code>main thread ok <br> aaaaaaSun Oct 15 2017 22:09:10 GMT+0800 (中国标准时间) <br> aaaaaaSun Oct 15 2017 22:09:11 GMT+0800 (中国标准时间) <br> aaaaaaSun Oct 15 2017 22:09:12 GMT+0800 (中国标准时间) <br> bbbbbbSun Oct 15 2017 22:09:13 GMT+0800 (中国标准时间) <br> bbbbbbSun Oct 15 2017 22:09:14 GMT+0800 (中国标准时间) <br> bbbbbbSun Oct 15 2017 22:09:15 GMT+0800 (中国标准时间) <br> null <br> { one: 'one completed', two: 'two completed' }</code></p> 
<p>2.并行无关联 <br> 只需将<code>async.series</code>更改为<code>async.parallel</code> 其他不变。运行结果为：</p> 
<pre class="prettyprint"><code class=" hljs css"><span class="hljs-tag">main</span> <span class="hljs-tag">thread</span> <span class="hljs-tag">ok</span>
<span class="hljs-tag">aaaaaaSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:08</span><span class="hljs-pseudo">:54</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">bbbbbbSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:08</span><span class="hljs-pseudo">:54</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">aaaaaaSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:08</span><span class="hljs-pseudo">:55</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">bbbbbbSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:08</span><span class="hljs-pseudo">:55</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">aaaaaaSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:08</span><span class="hljs-pseudo">:56</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">bbbbbbSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:08</span><span class="hljs-pseudo">:56</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">null</span>
<span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">one</span>:<span class="hljs-value"> <span class="hljs-string">'one completed'</span>, two: <span class="hljs-string">'two completed'</span> </span></span></span>}</code></pre> 
<h3 id="3串行有关联">3.串行有关联</h3> 
<p>需要更改的地方如下：</p> 
<ol><li>async.waterfall</li><li>async.waterfall里面不再是对象形式， 而是列表形式<code>async.waterfall([ ])</code></li><li>匿名函数对应的key value不存在</li><li>上一个函数执行结果传入下一个函数作为参数 <br> 变化之后的代码为</li></ol> 
<pre class="prettyprint"><code class=" hljs javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">exec</span><span class="hljs-params">()</span> {<!-- --></span>
    async.waterfall(
        [
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(done)</span> {<!-- --></span>
                <span class="hljs-keyword">var</span> ii=<span class="hljs-number">0</span>;
                setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
                console.log(<span class="hljs-string">'aaaaaa'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
                ii++;
                <span class="hljs-keyword">if</span> (ii == <span class="hljs-number">3</span>){
                    clearInterval(<span class="hljs-keyword">this</span>);
                    done(<span class="hljs-literal">null</span>,<span class="hljs-string">'one completed'</span>);
                }
            }, <span class="hljs-number">1000</span>)

            }, 
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(prevalue,done)</span> {<!-- --></span>
                <span class="hljs-keyword">var</span> jj=<span class="hljs-number">0</span>;
                setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {<!-- --></span>
                console.log(<span class="hljs-string">'bbbbbb'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
                jj++;
                <span class="hljs-keyword">if</span> (jj == <span class="hljs-number">3</span>){
                    clearInterval(<span class="hljs-keyword">this</span>);
                    done(<span class="hljs-literal">null</span>,prevalue + <span class="hljs-string">' two completed'</span>);
                }
            }, <span class="hljs-number">1000</span>)

            }
        ],<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(err,rs)</span>{<!-- --></span>
            console.log(err);
            console.log(rs);
        }
    )

}</code></pre> 
<p>运行结果为</p> 
<pre class="prettyprint"><code class=" hljs css"><span class="hljs-tag">main</span> <span class="hljs-tag">thread</span> <span class="hljs-tag">ok</span>
<span class="hljs-tag">aaaaaaSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:17</span><span class="hljs-pseudo">:47</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">aaaaaaSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:17</span><span class="hljs-pseudo">:48</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">aaaaaaSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:17</span><span class="hljs-pseudo">:49</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">bbbbbbSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:17</span><span class="hljs-pseudo">:50</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">bbbbbbSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:17</span><span class="hljs-pseudo">:51</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">bbbbbbSun</span> <span class="hljs-tag">Oct</span> 15 2017 22<span class="hljs-pseudo">:17</span><span class="hljs-pseudo">:52</span> <span class="hljs-tag">GMT</span>+0800 (中国标准时间)
<span class="hljs-tag">null</span>
<span class="hljs-tag">one</span> <span class="hljs-tag">completed</span> <span class="hljs-tag">two</span> <span class="hljs-tag">completed</span></code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/08733d81e61f0bcb6a4b9e9e60f1e22c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">php 错误级别日志</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/90bb39d8acc39fe1e43f232b4a30c09a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">面试必问50题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>