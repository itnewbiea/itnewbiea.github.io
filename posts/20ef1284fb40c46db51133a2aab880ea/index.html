<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>导出百万级数据的多种方法(亲测可用) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="导出百万级数据的多种方法(亲测可用)" />
<meta property="og:description" content="主要参考最后两个方法
&lt;?php namespace App\Http\Controllers; use Illuminate\Support\Facades\DB; use Illuminate\Support\Facades\Log; use ZipArchive; class TestController extends Controller { /** * 忽略 * PS: * 1.mb_convert_encoding,iconv 可能会导致内存溢出 * 2.使用fputcsv() */ public function indexTwo() { set_time_limit(0); Log::info(&#34;IndexTwo起始时间:&#34; . date(&#39;Y-m-d H:i:s&#39;, time())); header(&#39;Content-Type: application/vnd.ms-excel&#39;); header(&#39;Content-Disposition: attachment;filename=2.csv&#39;); header(&#39;Cache-Control: max-age=0&#39;); $myfile = fopen(&#39;php://output&#39;, &#39;a&#39;); $headlist = [ &#39;编号1&#39;, &#39;编号2&#39;, &#39;编号3&#39; ]; //输出Excel列名信息 foreach ($headlist as $key =&gt; $value) { //CSV的Excel支持GBK编码，一定要转换，否则乱码 $headlist[$key] = iconv(&#39;UTF-8&#39;, &#39;GBK&#39;, $value); } //将数据通过fputcsv写到文件句柄 fputcsv($myfile, $headlist); $select = [ &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/20ef1284fb40c46db51133a2aab880ea/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-10T13:46:17+08:00" />
<meta property="article:modified_time" content="2019-04-10T13:46:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">导出百万级数据的多种方法(亲测可用)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>主要参考最后两个方法</strong></p> 
<pre><code>&lt;?php

namespace App\Http\Controllers;

use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;
use ZipArchive;

class TestController extends Controller
{
    /**
     * 忽略
     * PS:
     * 1.mb_convert_encoding,iconv 可能会导致内存溢出
     * 2.使用fputcsv()
     */
    public function indexTwo()
    {
        set_time_limit(0);
        Log::info("IndexTwo起始时间:" . date('Y-m-d H:i:s', time()));

        header('Content-Type: application/vnd.ms-excel');
        header('Content-Disposition: attachment;filename=2.csv');
        header('Cache-Control: max-age=0');

        $myfile = fopen('php://output', 'a');
        $headlist = [
            '编号1',
            '编号2',
            '编号3'
        ];
        //输出Excel列名信息
        foreach ($headlist as $key =&gt; $value) {
            //CSV的Excel支持GBK编码，一定要转换，否则乱码
            $headlist[$key] = iconv('UTF-8', 'GBK', $value);
        }
        //将数据通过fputcsv写到文件句柄
        fputcsv($myfile, $headlist);
        $select = [
            "orders.*",
            "order_senders.sender_name",
            "order_senders.sender_phone",
            "order_senders.sender_province_name",
            "order_senders.sender_city_name",
            "order_senders.sender_county_name",
            "po.order_number as parent_order_number",
            "order_senders.sender_street_name",
            "order_senders.sender_detail",
            "orders.order_status",
            "order_expresses.express_company_name",
            "order_expresses.weight_from_express",
            "order_expresses.freight",
            "order_expresses.remark_from_express",
            "order_senders.order_id",
            "order_expresses.express_number",
            "order_expresses.express_company_code",
            "warehouses.warehouse_name",
            "order_expresses.id as order_expressesId",
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.warehouse_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS waybill_signCreatedAt"),
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.tracking_number ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS tracking_number"),
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.express_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id) AS express_signed_at"),
        ];
        $query = DB::table('orders')
            -&gt;leftJoin('order_expresses', 'orders.id', '=', 'order_expresses.order_id')
            -&gt;leftJoin('order_senders', 'orders.id', '=', 'order_senders.order_id')
            -&gt;leftJoin('orders as po', 'po.id', '=', 'orders.parent_id')
            -&gt;leftJoin('order_receivers', 'orders.id', '=', 'order_receivers.order_id')
            -&gt;leftJoin('warehouses', 'order_receivers.warehouse_code', '=', 'warehouses.warehouse_code')
            -&gt;orderBy('orders.created_at', 'desc');

        $query-&gt;where('orders.created_at', '&gt;', '2019-1-23')
            -&gt;where('orders.created_at', '&lt;', '2019-4-10')
            -&gt;select($select)-&gt;chunk(20000, function ($terminal) use (&amp;$myfile) {
                $data = [];
                foreach ($terminal as $key =&gt; $value) {
                    $data['sender_name'] = mb_convert_encoding($value-&gt;sender_name, 'GBK', 'utf-8');
                    $data['sender_phone'] = mb_convert_encoding($value-&gt;sender_phone, 'GBK', 'utf-8');
                    $data['sender_province_name'] = mb_convert_encoding($value-&gt;sender_province_name, 'GBK', 'utf-8');
                    $data['sender_city_name'] = mb_convert_encoding($value-&gt;sender_city_name, 'GBK', 'utf-8');
                    $data['sender_county_name'] = mb_convert_encoding($value-&gt;sender_county_name, 'GBK', 'utf-8');
                    $data['parent_order_number'] = mb_convert_encoding($value-&gt;parent_order_number, 'GBK', 'utf-8');
                    $data['sender_street_name'] = mb_convert_encoding($value-&gt;sender_street_name, 'GBK', 'utf-8');
                    $data['sender_detail'] = mb_convert_encoding($value-&gt;sender_detail, 'GBK', 'utf-8');
                    $data['order_status'] = mb_convert_encoding($value-&gt;order_status, 'GBK', 'utf-8');
                    $data['express_company_name'] = mb_convert_encoding($value-&gt;express_company_name, 'GBK', 'utf-8');
                    $data['weight_from_express'] = mb_convert_encoding($value-&gt;weight_from_express, 'GBK', 'utf-8');
                    $data['freight'] = mb_convert_encoding($value-&gt;freight, 'GBK', 'utf-8');
                    $data['remark_from_express'] = mb_convert_encoding($value-&gt;remark_from_express, 'GBK', 'utf-8');
                    $data['order_id'] = mb_convert_encoding($value-&gt;order_id, 'GBK', 'utf-8');
                    $data['express_number'] = mb_convert_encoding($value-&gt;express_number, 'GBK', 'utf-8');
                    $data['express_company_code'] = mb_convert_encoding($value-&gt;express_company_code, 'GBK', 'utf-8');
                    $data['warehouse_name'] = mb_convert_encoding($value-&gt;warehouse_name, 'GBK', 'utf-8');
                    $data['order_expressesId'] = mb_convert_encoding($value-&gt;order_expressesId, 'GBK', 'utf-8');
                    $data['waybill_signCreatedAt'] = mb_convert_encoding($value-&gt;waybill_signCreatedAt, 'GBK', 'utf-8');
                    $data['tracking_number'] = mb_convert_encoding($value-&gt;tracking_number, 'GBK', 'utf-8');
                    $data['express_signed_at'] = mb_convert_encoding($value-&gt;express_signed_at, 'GBK', 'utf-8');
                    fputcsv($myfile, $data);
                }
                unset($data);
            });

        fclose($myfile);

        Log::info("IndexTwo截止时间:" . date('Y-m-d H:i:s', time()));
    }

    /**
     * 略
     * 使用 offset limit 获取数据
     * PS:多次使用mb_convert_encoding，可能导致内存泄漏
     */
    public function indexFour()
    {
        set_time_limit(0);

        header('Content-Encoding: UTF-8');
        header("Content-type:application/vnd.ms-excel;charset=UTF-8");
        header('Content-Disposition: attachment;filename=3.csv');

        //打开php标准输出流以写入追加的方式打开
        $fp = fopen('php://output', 'a');

        //用fputcsv从数据库中导出1百万的数据,比如我们每次取1万条数据，分100步来执行
        $nums = 10000;

        //设置标题
        $title = array('id', '编号', '姓名', '年龄'); //注意这里是小写id,否则ID命名打开会提示Excel 已经检测到"xxx.xsl"是SYLK文件,但是不能将其加载: CSV 文或者XLS文件的前两个字符是大写字母"I"，"D"时，会发生此问题。
        foreach ($title as $key =&gt; $item)
            $title[$key] = iconv("UTF-8", "GB2312//IGNORE", $item);

        fputcsv($fp, $title);

        // 获取数据
        $select = [
            "orders.*",
            "order_senders.sender_name",
            "order_senders.sender_phone",
            "order_senders.sender_province_name",
            "order_senders.sender_city_name",
            "order_senders.sender_county_name",
            "po.order_number as parent_order_number",
            "order_senders.sender_street_name",
            "order_senders.sender_detail",
            "orders.order_status",
            "order_expresses.express_company_name",
            "order_expresses.weight_from_express",
            "order_expresses.freight",
            "order_expresses.remark_from_express",
            "order_senders.order_id",
            "order_expresses.express_number",
            "order_expresses.express_company_code",
            "warehouses.warehouse_name",
            "order_expresses.id as order_expressesId",
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.warehouse_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS waybill_signCreatedAt"),
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.tracking_number ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS tracking_number"),
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.express_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id) AS express_signed_at"),
        ];
        $query = DB::table('orders')
            -&gt;select($select)
            -&gt;leftJoin('order_expresses', 'orders.id', '=', 'order_expresses.order_id')
            -&gt;leftJoin('order_senders', 'orders.id', '=', 'order_senders.order_id')
            -&gt;leftJoin('orders as po', 'po.id', '=', 'orders.parent_id')
            -&gt;leftJoin('order_receivers', 'orders.id', '=', 'order_receivers.order_id')
            -&gt;leftJoin('warehouses', 'order_receivers.warehouse_code', '=', 'warehouses.warehouse_code')
            -&gt;where('orders.created_at', '&gt;', '2019-3-28')
            -&gt;where('orders.created_at', '&lt;', '2019-3-29')
            -&gt;orderBy('orders.created_at', 'desc');
        // 总记录数
        $count = $query-&gt;count();
        // 分批次数
        $step = ceil($count / $nums);
        for ($s = 1; $s &lt;= $step; $s++) {
            $start = ($s - 1) * $nums;
            $data = $query-&gt;offset($start)-&gt;limit($nums)-&gt;get();
            foreach ($data as $key =&gt; $item) {
                $tmp = [];
                $tmp['sender_name'] = mb_convert_encoding($item-&gt;sender_name, 'GBK', 'utf-8');
                $tmp['sender_phone'] = mb_convert_encoding($item-&gt;sender_phone, 'GBK', 'utf-8');
                $tmp['sender_province_name'] = mb_convert_encoding($item-&gt;sender_province_name, 'GBK', 'utf-8');
                $tmp['sender_city_name'] = mb_convert_encoding($item-&gt;sender_city_name, 'GBK', 'utf-8');
                $tmp['sender_county_name'] = mb_convert_encoding($item-&gt;sender_county_name, 'GBK', 'utf-8');
                $tmp['parent_order_number'] = mb_convert_encoding($item-&gt;parent_order_number, 'GBK', 'utf-8');
                $tmp['sender_street_name'] = mb_convert_encoding($item-&gt;sender_street_name, 'GBK', 'utf-8');
                $tmp['sender_detail'] = mb_convert_encoding($item-&gt;sender_detail, 'GBK', 'utf-8');
                $tmp['order_status'] = mb_convert_encoding($item-&gt;order_status, 'GBK', 'utf-8');
                $tmp['express_company_name'] = mb_convert_encoding($item-&gt;express_company_name, 'GBK', 'utf-8');
                $tmp['weight_from_express'] = mb_convert_encoding($item-&gt;weight_from_express, 'GBK', 'utf-8');
                $tmp['freight'] = mb_convert_encoding($item-&gt;freight, 'GBK', 'utf-8');
                $tmp['remark_from_express'] = mb_convert_encoding($item-&gt;remark_from_express, 'GBK', 'utf-8');
                $tmp['order_id'] = mb_convert_encoding($item-&gt;order_id, 'GBK', 'utf-8');
                $tmp['express_number'] = mb_convert_encoding($item-&gt;express_number, 'GBK', 'utf-8');
                $tmp['express_company_code'] = mb_convert_encoding($item-&gt;express_company_code, 'GBK', 'utf-8');
                $tmp['warehouse_name'] = mb_convert_encoding($item-&gt;warehouse_name, 'GBK', 'utf-8');
                $tmp['order_expressesId'] = mb_convert_encoding($item-&gt;order_expressesId, 'GBK', 'utf-8');
                $tmp['waybill_signCreatedAt'] = mb_convert_encoding($item-&gt;waybill_signCreatedAt, 'GBK', 'utf-8');
                $tmp['tracking_number'] = mb_convert_encoding($item-&gt;tracking_number, 'GBK', 'utf-8');
                $tmp['express_signed_at'] = mb_convert_encoding($item-&gt;express_signed_at, 'GBK', 'utf-8');
                fputcsv($fp, $tmp);
            }
            unset($data);
            ob_flush();  //每1万条数据就刷新缓冲区
            flush();
        }
        fclose($fp);
    }

    /**
     * 分片查询写入文件 合并 压缩后导出
     */
    public function indexFive()
    {
        Log::info("起始时间:" . date('Y-m-d H:i:s', time()));
        set_time_limit(0);
        $select = [
            "orders.*",
            "order_senders.sender_name",
            "order_senders.sender_phone",
            "order_senders.sender_province_name",
            "order_senders.sender_city_name",
            "order_senders.sender_county_name",
            "po.order_number as parent_order_number",
            "order_senders.sender_street_name",
            "order_senders.sender_detail",
            "orders.order_status",
            "order_expresses.express_company_name",
            "order_expresses.weight_from_express",
            "order_expresses.freight",
            "order_expresses.remark_from_express",
            "order_senders.order_id",
            "order_expresses.express_number",
            "order_expresses.express_company_code",
            "warehouses.warehouse_name",
            "order_expresses.id as order_expressesId",
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.warehouse_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS waybill_signCreatedAt"),
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.tracking_number ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS tracking_number"),
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.express_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id) AS express_signed_at"),
        ];
        $query = DB::table('orders')
            -&gt;select($select)
            -&gt;leftJoin('order_expresses', 'orders.id', '=', 'order_expresses.order_id')
            -&gt;leftJoin('order_senders', 'orders.id', '=', 'order_senders.order_id')
            -&gt;leftJoin('orders as po', 'po.id', '=', 'orders.parent_id')
            -&gt;leftJoin('order_receivers', 'orders.id', '=', 'order_receivers.order_id')
            -&gt;leftJoin('warehouses', 'order_receivers.warehouse_code', '=', 'warehouses.warehouse_code')
            -&gt;where('orders.created_at', '&gt;', '2019-1-23')
            -&gt;where('orders.created_at', '&lt;', '2019-4-10')
            -&gt;orderBy('orders.created_at', 'desc');
        // 总记录数
        $sqlCount = $query-&gt;count();
        // 单个Excel记录条数
        $sqlLimit = 100000;
        // 循环记录初始值
        $cnt = 0;
        // 分割文件名数组
        $fileNameArr = [];
        // 分割文件名前缀标识
        $mark = "mark";
        // Excel列头信息
        $headArr = ['编号', '编号', '编号', '编号', '编号', '编号', '编号', '编号', '编号', '编号', '编号', '编号', '编号', '编号', '编号'];

        // 检测Excel临时文件夹是否存在(按日期生成目录)
        $fileTmpDir = public_path('Export/FileTmp/' . date('Ymd'));
        if (!is_dir($fileTmpDir))
            mkdir($fileTmpDir, 0777, true);

        $bom = chr(0xEF) . chr(0xBB) . chr(0xBF);
        // 写入数据
        for ($i = 0; $i &lt; ceil($sqlCount / $sqlLimit); $i++) {
            $fileName = $fileTmpDir . '/' . $mark . "_" . microtime(true) . '_' . $i . ".csv";
            $fp = fopen($fileName, "w");
            // 输出Excel列头信息
            foreach ($headArr as $key =&gt; $value) {
                if ($key == 0) {
                    $headArr[$key] = $bom . $value; // 添加Bom头解决乱码问题
                } else {
                    $headArr[$key] = $value;
                }
            }
            fputcsv($fp, $headArr);
            // 保存文件名称
            $fileNameArr[] = $fileName;
            // 获取分片数据
            $dataArr = $query-&gt;offset($i * $sqlLimit)-&gt;limit($sqlLimit)-&gt;get()-&gt;toArray();
            // 数据处理
            foreach ($dataArr as $item) {
                $item = json_decode(json_encode($item), true);
                $tmpItemArr = []; // 数据编码处理
                $tmpItemArr['sender_name'] = $bom . $item['sender_name'];
                $tmpItemArr['sender_phone'] = $item['sender_phone'];
                $tmpItemArr['sender_province_name'] = $item['sender_province_name'];
                $tmpItemArr['sender_city_name'] = $item['sender_city_name'];
                $tmpItemArr['sender_county_name'] = $item['sender_county_name'];
                $tmpItemArr['parent_order_number'] = $item['parent_order_number'];
                $tmpItemArr['sender_street_name'] = $item['sender_street_name'];
                $tmpItemArr['sender_detail'] = $item['sender_detail'];
                $tmpItemArr['order_status'] = $item['order_status'];
                $tmpItemArr['express_company_name'] = $item['express_company_name'];
                $tmpItemArr['weight_from_express'] = $item['weight_from_express'];
                $tmpItemArr['freight'] = $item['freight'];
                $tmpItemArr['remark_from_express'] = $item['remark_from_express'];
                $tmpItemArr['order_id'] = $item['order_id'];
                $tmpItemArr['express_number'] = $item['express_number'];
                $tmpItemArr['express_company_code'] = $item['express_company_code'];
                $tmpItemArr['warehouse_name'] = $item['warehouse_name'];
                $tmpItemArr['order_expressesId'] = $item['order_expressesId'];
                $tmpItemArr['waybill_signCreatedAt'] = $item['waybill_signCreatedAt'];
                $tmpItemArr['tracking_number'] = $item['tracking_number'];
                $tmpItemArr['express_signed_at'] = $item['express_signed_at'];
                $cnt++;
                if ($cnt == $sqlLimit) {
                    ob_flush();
                    flush();
                    $cnt = 0;
                }
                fputcsv($fp, $tmpItemArr);
                unset($tmpItemArr);
            }
            fclose($fp);
        }

        // 生成Zip包并导出
        $zip = new \ZipArchive();
        $zipName = $mark . '_' . microtime(true) . '.zip';
        // 检测Zip文件夹是否存在(按日期生成目录)
        $zipTmpDir = public_path('Export/ZipTmp/' . date('Ymd'));
        if (!is_dir($zipTmpDir))
            mkdir(iconv("UTF-8", "GBK", $zipTmpDir), 0777, true);
        // 打开压缩包
        $zip-&gt;open($zipTmpDir . '/' . $zipName, ZipArchive::CREATE);
        foreach ($fileNameArr as $fileNameValue) {
            $zip-&gt;addFile($fileNameValue, basename($fileNameValue));
        }
        $zip-&gt;close();
        // 删除Excel临时文件
        foreach ($fileNameArr as $fileNameValue) {
            unlink($fileNameValue);
        }
        header('Cache-Control: max-age=0');
        header('Content-Description: File Transfer');
        header('Content-Disposition: attachment;filename=' . $zipName);
        header('Content-type: application/zip');
        header('Content-Transfer-Encoding: binary');
        header('Content-Length: ' . filesize($zipTmpDir . '/' . $zipName));
        @readfile($zipTmpDir . '/' . $zipName);
        unlink($zipTmpDir . '/' . $zipName);
        Log::info("截止时间:" . date('Y-m-d H:i:s', time()));
    }

    /**
     * 导出CSV(分片查询写入文件)
     */
    public function indexSix()
    {
        set_time_limit(0);
        Log::info("起始时间:" . date('Y-m-d H:i:s', time()));
        // 保存目录
        $dir_path = public_path('Six');
        if (!is_dir($dir_path))
            mkdir($dir_path, 0777, true);
        // 文件名
        $fileName = microtime(true) . '.csv';
        //  检测文件是否已存在
        if (file_exists($dir_path . '/' . $fileName))
            unlink($dir_path . '/' . $fileName);
        // 打开文件
        $myfile = fopen($dir_path . '/' . $fileName, "w") or die("Unable to open file!");
        // Excel列表头
        $head = "\""
            . '编号1' . "\",\""
            . '编号2' . "\",\""
            . '编号3' . "\",\""
            . '编号4' . "\",\""
            . '编号5' . "\",\""
            . '编号6' . "\",\""
            . '编号7' . "\",\""
            . '编号8' . "\",\""
            . '编号9' . "\",\""
            . '编号10' . "\",\""
            . '编号11' . "\",\""
            . '编号12' . "\",\""
            . '编号13'
            . "\"\n";
        $head = mb_convert_encoding($head, 'GBK', 'utf-8');
        // 写入头部信息
        fwrite($myfile, $head);
        // 写入内容
        $select = [
            "orders.*",
            "order_senders.sender_name",
            "order_senders.sender_phone",
            "order_senders.sender_province_name",
            "order_senders.sender_city_name",
            "order_senders.sender_county_name",
            "po.order_number as parent_order_number",
            "order_senders.sender_street_name",
            "order_senders.sender_detail",
            "orders.order_status",
            "order_expresses.express_company_name",
            "order_expresses.weight_from_express",
            "order_expresses.freight",
            "order_expresses.remark_from_express",
            "order_senders.order_id",
            "order_expresses.express_number",
            "order_expresses.express_company_code",
            "warehouses.warehouse_name",
            "order_expresses.id as order_expressesId",
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.warehouse_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS waybill_signCreatedAt"),
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.tracking_number ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS tracking_number"),
            DB::raw("( SELECT GROUP_CONCAT( order_waybills.express_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id) AS express_signed_at"),
        ];
        $query = DB::table('orders')
            -&gt;leftJoin('order_expresses', 'orders.id', '=', 'order_expresses.order_id')
            -&gt;leftJoin('order_senders', 'orders.id', '=', 'order_senders.order_id')
            -&gt;leftJoin('orders as po', 'po.id', '=', 'orders.parent_id')
            -&gt;leftJoin('order_receivers', 'orders.id', '=', 'order_receivers.order_id')
            -&gt;leftJoin('warehouses', 'order_receivers.warehouse_code', '=', 'warehouses.warehouse_code')
            -&gt;orderBy('orders.created_at', 'desc');

        $query-&gt;where('orders.created_at', '&gt;', '2019-1-23')
              -&gt;where('orders.created_at', '&lt;', '2019-4-11')
              -&gt;select($select)-&gt;chunk(20000, function ($terminal) use (&amp;$myfile) {
                foreach ($terminal as $key =&gt; $value) {
                    $txt = "\""
                        . $value-&gt;sender_name . "\t\",\""
                        . $value-&gt;sender_phone . "\t\",\""
                        . $value-&gt;sender_province_name . "\t\",\""
                        . $value-&gt;sender_city_name . "\t\",\""
                        . $value-&gt;sender_county_name . "\t\",\""
                        . $value-&gt;parent_order_number . "\t\",\""
                        . $value-&gt;sender_street_name . "\t\",\""
                        . $value-&gt;sender_detail . "\t\",\""
                        . $value-&gt;order_status . "\t\",\""
                        . $value-&gt;express_company_name . "\t\",\""
                        . $value-&gt;weight_from_express . "\t\",\""
                        . $value-&gt;freight . "\t\",\""
                        . $value-&gt;remark_from_express . "\t\",\""
                        . $value-&gt;order_id . "\t\",\""
                        . $value-&gt;express_number . "\t\",\""
                        . $value-&gt;express_company_code . "\t\",\""
                        . $value-&gt;warehouse_name . "\t\",\""
                        . $value-&gt;order_expressesId . "\t\",\""
                        . $value-&gt;waybill_signCreatedAt . "\t\",\""
                        . $value-&gt;tracking_number . "\t\",\""
                        . $value-&gt;express_signed_at . "\t\",\""
                        . "\t\"\n";
                    $txt = mb_convert_encoding($txt, 'GBK', 'utf-8');
                    fwrite($myfile, $txt);
                    unset($txt);
                }
            });

        fclose($myfile);
        // 浏览器下载
        header('Cache-Control: max-age=0');
        header('Content-Description: File Transfer');
        header('Content-Disposition: attachment;filename=' . $fileName);
        header('Content-type: application/vnd.ms-excel');
        header('Content-Transfer-Encoding: binary');
        header('Content-Length: ' . filesize($dir_path . '/' . $fileName));
        @readfile($dir_path . '/' . $fileName);
        // 删除临时文件
        unlink($dir_path . '/' . $fileName);

        Log::info("截止时间:" . date('Y-m-d H:i:s', time()));
    }


}

</code></pre> 
<p><strong>Laravel写法</strong></p> 
<blockquote> 
 <p>此方法实际测试过，多表关联查询，百万数据5min，万级数据秒级别</p> 
</blockquote> 
<pre><code>&lt;?php

namespace App\Http\Controllers\AdminV1\Excel;

use App\Order;
use function GuzzleHttp\Psr7\str;
use Illuminate\Http\Request;
use App\Http\Controllers\Controller;
use Illuminate\Support\Facades\DB;
use mysql_xdevapi\Exception;
use PhpOffice\PhpSpreadsheet\IOFactory;
use PhpOffice\PhpSpreadsheet\Spreadsheet;
use Illuminate\Support\Facades\Log;
use \ZipArchive;

class OrderExcelExportController extends Controller
{

    /**
     *
     * @param Request $request
     * @return \Symfony\Component\HttpFoundation\BinaryFileResponse
     * @throws \Exception
     */
    public function orderList(Request $request)
    {
        set_time_limit(0);
        ini_set('memory_limit', '1024M');
        Log::notice('excel导出请求数据：'.json_encode($request-&gt;all()));
        $titles = [

            '商家订单编号',
            '平台订单编号',
            '物流单号',
            '用户名',
            '电话',
            '省/直辖市',
            '市',
            '县/区',
            '详细地址',

            '订单状态',
            '预计收件时间',
            '预计重量',
            '下单时间',
            '父级订单编号',
            '快递公司',
            '实际重量',
            '实际费用',
            '签收仓库',
            '快递公司备注',
            '取消原因',
            '仓库签收时间',
            '运单号'
        ];

        $limit = 10000;    //每个excel多少条数据+
        $excelPaths = [];

        for ($i = 0; $i &lt; 9999; $i++) {
            $offset = $i * $limit;
            $data = $this-&gt;orderListData($request, $offset, $limit);
            if ($data-&gt;isEmpty()) {
                break;
            }
            $number = $i + 1;
            $excelPaths[] = $this-&gt;collectionToZipPath($data, $titles, $excelName = time() . $number);

        }
        $zipFileName = $this-&gt;excelToZip($excelPaths);


        return $this-&gt;orderExcelDown($zipFileName);
    }

    /**
     * 创建csv写入
     *
     * @param $collection
     * @param array $titles
     * @param $excelName
     * @return string
     */
    private function collectionToZipPath($collection, array $titles, $excelName)
    {
        set_time_limit(0);
        ini_set('memory_limit', '1024M');
        $path = storage_path('app/excelOriginal/' . $excelName . '.csv');
        $fp = fopen($path, 'a');    //打开php文件句柄，php://output表示直接输出到PHP缓存,a表示将输出的内容追加到文件末尾

        $head = $titles;  //表头信息

        foreach ($head as $k =&gt; $v) {
            $head[$k] = iconv("UTF-8", "GBK//IGNORE", $v);    //将utf-8编码转为gbk。理由是： Excel 以 ANSI 格式打开，不会做编码识别。如果直接用 Excel 打开 UTF-8 编码的 CSV 文件会导致汉字部分出现乱码。
        }

        fputcsv($fp, $head);  //fputcsv() 函数将行格式$head化为 CSV 并写入一个打开的文件$fp。

        if (!empty($collection)) {
            $data = [];  //要导出的数据的顺序与表头一致；提前将最后的值准备好（比如：时间戳转为日期等）
            foreach ($collection as $key =&gt; &amp;$val) {
                switch ($val['order_status']) {
                    case 'CREATED':
                        $val['order_status'] = '创建成功';
                        break;
                    case 'ASSIGNED':
                        $val['order_status'] = '等待收衣';
                        break;
                    case 'RECEIVED':
                        $val['order_status'] = '已收衣';
                        break;
                    case 'SIGNED':
                        $val['order_status'] = '已签收';
                        break;
                    case 'CANCELLED':
                        $val['order_status'] = '已取消';
                        break;
                    default:
                        $val['order_status'] = '未知状态';
                }
               // $val['business_order_number'] = $val['business_order_number'].'';
                foreach ($val-&gt;toArray() as $i =&gt; $item) {  //$item为一维数组哦
                    $data[$i] = iconv("UTF-8", "GBK//IGNORE", $item);  //转为gbk的时候可能会遇到特殊字符‘-’之类的会报错，加 ignore表示这个特殊字符直接忽略不做转换。
                }
                fputcsv($fp, $data);
            }
            return $path;  //记得加这个，不然会跳转到某个页面。
        }

    }

    /**
     * 下载文件
     *
     * @param $zipFileName
     * @return \Symfony\Component\HttpFoundation\BinaryFileResponse
     */
    private function orderExcelDown($zipFileName)
    {
        $aliasFileName = date("Ymd", time()) . '.zip';

        return response()-&gt;download($zipFileName, $aliasFileName)-&gt;deleteFileAfterSend(true);
    }


    /**
     * 压缩文件
     *
     * @param $excelPaths
     * @return string
     * @throws \Exception
     */
    public function excelToZip($excelPaths)
    {
        $zipFileName = storage_path('app/excelZip/' . time() . mt_rand(1111, 9999) . '.zip');   //压缩包（ZIP）名称
        $zip = new \ZipArchive;
        if ($zip-&gt;open($zipFileName, \ZipArchive::CREATE) !== TRUE) {
            throw new \Exception('创建压缩文件失败');
        }
        foreach ($excelPaths as $f) {
            if (!empty($f)) {
                $zip-&gt;addFromString(pathinfo($f)['basename'], file_get_contents($f));
            }
            unlink($f);
        }
        $zip-&gt;close();
        return $zipFileName;
    }


    /**
     * 查询数据
     *
     * @param $request
     * @param $offset
     * @param $limit
     * @return Order[]|\Illuminate\Database\Eloquent\Collection|\Illuminate\Database\Query\Builder[]|\Illuminate\Support\Collection
     */
    public function orderListData($request, $offset, $limit)
    {
        set_time_limit(0);
        ini_set('memory_limit', '1024M');
        $order = Order::select('*');
        $where = [];
        $order-&gt;Where($where);

        if ($request-&gt;starting_time &amp;&amp; $request-&gt;end_time) {
            $where = [
                ['orders.created_at', '&gt;', $request-&gt;starting_time],
                ['orders.created_at', '&lt;', $request-&gt;end_time]
            ];
            $order-&gt;Where($where);
        }

        if ($request-&gt;order_status) {
            $where[] = ['orders.order_status', '=', $request-&gt;order_status];
            $order-&gt;Where($where);
        }

        if ($request-&gt;start_weight || $request-&gt;end_weight) {
            if ($request-&gt;end_weight == '' &amp;&amp; $request-&gt;start_weight == 200) {
                $where[] = ['orders.estimated_weight', '&gt;', $request-&gt;start_weight];
            } else if ($request-&gt;end_weight == '' &amp;&amp; $request-&gt;start_weight == 5) {
                $where[] = ['orders.estimated_weight', '&lt;', $request-&gt;start_weight];
            } else {
                $request-&gt;start_weight and $where[] = ['orders.estimated_weight', '&gt;', $request-&gt;start_weight];
                $request-&gt;end_weight and $where[] = ['orders.estimated_weight', '&lt;', $request-&gt;end_weight];
            }
            $order-&gt;Where($where);
        }
        if ($request-&gt;search_universal) {
            $order-&gt;Where(function ($query) use ($request) {
                if ($request-&gt;searchType == 'phone') {
                    $where[] = ['order_senders.sender_phone', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                } else if ($request-&gt;searchType == 'trackingNumber') {
                    $query-&gt;orWhereRaw("(select count(*) from order_waybills as has_order_waybill where has_order_waybill.tracking_number = '{$request-&gt;search_universal}' and has_order_waybill.order_express_id = order_expresses.id )&gt;0");
                    //TODO 存在SQL注入安全问题，改为查询构造器即可解决
                } else if ($request-&gt;searchType == 'express') {
                    $where[] = ['order_expresses.express_company_name', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                } else if ($request-&gt;searchType == 'sender') {
                    $where[] = ['order_senders.sender_name', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                } else if ($request-&gt;searchType == 'province') {
                    $where[] = ['order_senders.sender_province_name', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                } else if ($request-&gt;searchType == 'city') {
                    $where[] = ['order_senders.sender_city_name', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                } else if ($request-&gt;searchType == 'business_order_number') {
                    $where[] = ['orders.business_order_number', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                } else if ($request-&gt;searchType == 'platform_order_number') {
                    $where[] = ['orders.order_number', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                } else if ($request-&gt;searchType == 'logisticsNumber') {
                    $where[] = ['order_expresses.express_number', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                } else if ($request-&gt;searchType == 'merchant_order_number') {
                    $where[] = ['orders.business_id', '=', $request-&gt;search_universal];
                    $query-&gt;orWhere($where);
                }

            });

        }
        DB::enableQueryLog();

        $data = $order
            -&gt;leftJoin('order_expresses', 'orders.id', '=', 'order_expresses.order_id')
            -&gt;leftJoin('order_senders', 'orders.id', '=', 'order_senders.order_id')
//            -&gt;leftJoin('order_waybills', 'order_expresses.id', '=', 'order_waybills.order_express_id')
            -&gt;leftJoin('orders as po', 'po.id', '=', 'orders.parent_id')
            -&gt;leftJoin('order_receivers', 'orders.id', '=', 'order_receivers.order_id')
            -&gt;leftJoin('warehouses', 'order_receivers.warehouse_code', '=', 'warehouses.warehouse_code')
            -&gt;select(
                'orders.business_order_number',
                'orders.order_number',
                'order_expresses.express_number',
                'order_senders.sender_name',
                'order_senders.sender_phone',
                'order_senders.sender_province_name',
                'order_senders.sender_city_name',
                'order_senders.sender_county_name',
                'order_senders.sender_detail',
                'orders.order_status',

                'orders.meet_at',
                'orders.estimated_weight',
                'orders.created_at',

                'po.order_number as parent_order_number',


                'order_expresses.express_company_name',
                'order_expresses.weight_from_express',
                'order_expresses.freight',
                'warehouses.warehouse_name',
                'order_expresses.remark_from_express',
                'orders.cancelled_reason'
            )
            -&gt;selectRaw('(SELECT 
                            GROUP_CONCAT(order_waybills.warehouse_signed_at)
                        FROM
                            order_waybills
                        WHERE
                            order_expresses.id = order_waybills.order_express_id
                    ) AS waybill_signCreatedAt'
            )
            -&gt;selectRaw('(SELECT 
                            GROUP_CONCAT(order_waybills.tracking_number)
                        FROM
                            order_waybills
                        WHERE
                            order_expresses.id = order_waybills.order_express_id
                    ) AS tracking_number'
            )
            -&gt;orderBy('orders.created_at', 'desc')
            -&gt;offset($offset)
            -&gt;limit($limit)-&gt;get();


        return $data;

    }

    /**************************************************jason订单导出开始****************************************************/
    public function orderCsvExport(Request $request)
    {
        try {
            // 执行时间(0 无上限)
            set_time_limit(0);
            // 内存限制(-1 无上限)
            ini_set('memory_limit', '1024M');
            // 程序执行时间(0无上限)
            ini_set('max_execution_time', 0);
            // 日志开始
            Log::info("订单导出开始|时间:" . date('Y-m-d H:i:s', time()) . "|");
            // 设置临时目录
            $dirPath = storage_path('app/OrderExport');
            if (!is_dir($dirPath))
                mkdir($dirPath, 0777, true);
            // 文件名
            $fileName = date("YmdHis") . '.csv';
            //  检测文件是否已存在(存在则删除)
            if (file_exists($dirPath . '/' . $fileName))
                unlink($dirPath . '/' . $fileName);
            // 打开文件
            $myFile = fopen($dirPath . '/' . $fileName, "w");
            // BOM头(解决CSV乱码问题)
            $bom = chr(0xEF) . chr(0xBB) . chr(0xBF);
            // Excel列表头
            $head =
                $bom
                . '商家订单编号' . ",\""
                . '平台订单编号' . "\",\""
                . '物流单号' . "\",\""
                . '用户名' . "\",\""
                . '电话' . "\",\""
                . '省/直辖市' . "\",\""
                . '市' . "\",\""
                . '县/区' . "\",\""
                . '详细地址' . "\",\""
                . '订单状态' . "\",\""
                . '预计收件时间' . "\",\""
                . '预计重量' . "\",\""
                . '下单时间' . "\",\""
                . '父级订单编号' . "\",\""
                . '快递公司' . "\",\""
                . '实际重量' . "\",\""
                . '实际费用' . "\",\""
                . '签收仓库' . "\",\""
                . '快递公司备注' . "\",\""
                . '取消原因' . "\",\""
                . '仓库签收时间' . "\",\""
                . '运单号'
                . "\"\n";
            // 写入头部信息
            fwrite($myFile, $head);
            // 写入订单数据
            // 查询字段
            $select = [
                'orders.business_order_number',
                'orders.order_number',
                'order_expresses.express_number',
                'order_senders.sender_name',
                'order_senders.sender_phone',
                'order_senders.sender_province_name',
                'order_senders.sender_city_name',
                'order_senders.sender_county_name',
                'order_senders.sender_detail',
                DB::raw("CASE orders.order_status WHEN 'CREATED' THEN '创建成功' WHEN 'ASSIGNED' THEN '等待收衣' WHEN 'RECEIVED' THEN '已收衣' WHEN 'SIGNED' THEN '已签收' WHEN 'CANCELLED'   THEN '已取消' ELSE '未知状态' END  as order_status"),
                'orders.meet_at',
                'orders.estimated_weight',
                'orders.created_at',
                'po.order_number as parent_order_number',
                'order_expresses.express_company_name',
                'order_expresses.weight_from_express',
                'order_expresses.freight',
                'warehouses.warehouse_name',
                'order_expresses.remark_from_express',
                'orders.cancelled_reason',
                DB::raw("( SELECT GROUP_CONCAT( order_waybills.warehouse_signed_at ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS waybill_signCreatedAt"),
                DB::raw("( SELECT GROUP_CONCAT( order_waybills.tracking_number ) FROM order_waybills WHERE order_expresses.id = order_waybills.order_express_id ) AS tracking_number")
            ];
            // 实例化
            $order = Order::select($select);
            // 搜索条件
            // 日期
            $starting_time = isset($request-&gt;starting_time) ? $request-&gt;starting_time : date("Y-m-d");
            $end_time = isset($request-&gt;end_time) ? $request-&gt;end_time : date('Y-m-d H:i:s', mktime(23, 23, 59, date('m'), date('d'), date('Y')));
            $where = [
                ['orders.created_at', '&gt;', $starting_time],
                ['orders.created_at', '&lt;', $end_time]
            ];
            // 重量
            if (!empty($request-&gt;start_weight) || !empty($request-&gt;end_weight)) {
                if ($request-&gt;end_weight == '' &amp;&amp; $request-&gt;start_weight == 200) {
                    $where[] = ['orders.estimated_weight', '&gt;', $request-&gt;start_weight];
                } else if ($request-&gt;end_weight == '' &amp;&amp; $request-&gt;start_weight == 5) {
                    $where[] = ['orders.estimated_weight', '&lt;', $request-&gt;start_weight];
                } else {
                    $request-&gt;start_weight and $where[] = ['orders.estimated_weight', '&gt;', $request-&gt;start_weight];
                    $request-&gt;end_weight and $where[] = ['orders.estimated_weight', '&lt;', $request-&gt;end_weight];
                }
            }
            // 预约状态
            if (!empty($request-&gt;order_status)) {
                $where[] = ['orders.order_status', '=', $request-&gt;order_status];
            }
            // 其他条件
            if (!empty($request-&gt;search_universal)) {
                $order-&gt;Where(function ($query) use ($request) {
                    if ($request-&gt;searchType == 'phone') {
                        $where[] = ['order_senders.sender_phone', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    } else if ($request-&gt;searchType == 'trackingNumber') {
                        $query-&gt;orWhereRaw("(select count(*) from order_waybills as has_order_waybill where has_order_waybill.tracking_number = '{$request-&gt;search_universal}' and has_order_waybill.order_express_id = order_expresses.id )&gt;0");
                        //TODO 存在SQL注入安全问题，改为查询构造器即可解决
                    } else if ($request-&gt;searchType == 'express') {
                        $where[] = ['order_expresses.express_company_name', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    } else if ($request-&gt;searchType == 'sender') {
                        $where[] = ['order_senders.sender_name', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    } else if ($request-&gt;searchType == 'province') {
                        $where[] = ['order_senders.sender_province_name', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    } else if ($request-&gt;searchType == 'city') {
                        $where[] = ['order_senders.sender_city_name', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    } else if ($request-&gt;searchType == 'business_order_number') {
                        $where[] = ['orders.business_order_number', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    } else if ($request-&gt;searchType == 'platform_order_number') {
                        $where[] = ['orders.order_number', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    } else if ($request-&gt;searchType == 'logisticsNumber') {
                        $where[] = ['order_expresses.express_number', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    } else if ($request-&gt;searchType == 'merchant_order_number') {
                        $where[] = ['orders.business_id', '=', $request-&gt;search_universal];
                        $query-&gt;orWhere($where);
                    }
                });
            }
            $query = $order
                -&gt;leftJoin('order_expresses', 'orders.id', '=', 'order_expresses.order_id')
                -&gt;leftJoin('order_senders', 'orders.id', '=', 'order_senders.order_id')
                -&gt;leftJoin('orders as po', 'po.id', '=', 'orders.parent_id')
                -&gt;leftJoin('order_receivers', 'orders.id', '=', 'order_receivers.order_id')
                -&gt;leftJoin('warehouses', 'order_receivers.warehouse_code', '=', 'warehouses.warehouse_code')
                -&gt;where($where)
                -&gt;orderBy('orders.created_at', 'desc');
            // 分片取消数据写入文件
            $query-&gt;chunk(30000, function ($data) use (&amp;$myFile) {
                foreach ($data as $key =&gt; $value) {
                    $tmp = [];
                    $tmp[] =  "\t". $value-&gt;business_order_number;
                    $tmp[] =  "\t". $value-&gt;order_number;
                    $tmp[] =  "\t". $value-&gt;express_number;
                    $tmp[] =  "\t". $value-&gt;sender_name;
                    $tmp[] =  "\t". $value-&gt;sender_phone;
                    $tmp[] =  "\t". $value-&gt;sender_province_name;
                    $tmp[] =  "\t". $value-&gt;sender_city_name;
                    $tmp[] =  "\t". $value-&gt;sender_county_name;
                    $tmp[] =  "\t". $value-&gt;sender_detail;
                    $tmp[] =  "\t". $value-&gt;order_status;
                    $tmp[] =  "\t". $value-&gt;meet_at;
                    $tmp[] =  "\t". $value-&gt;estimated_weight;
                    $tmp[] =  "\t". $value-&gt;created_at;
                    $tmp[] =  "\t". $value-&gt;parent_order_number;
                    $tmp[] =  "\t". $value-&gt;express_company_name;
                    $tmp[] =  "\t". $value-&gt;weight_from_express;
                    $tmp[] =  "\t". $value-&gt;freight;
                    $tmp[] =  "\t". $value-&gt;warehouse_name;
                    $tmp[] =  "\t". $value-&gt;remark_from_express;
                    $tmp[] =  "\t". $value-&gt;cancelled_reason;
                    $tmp[] =  "\t". $value-&gt;waybill_signCreatedAt;
                    $tmp[] =  "\t". $value-&gt;tracking_number;

                    fputcsv($myFile, $tmp);
                    unset($tmp);
                }
                unset($data);
            });

            fclose($myFile);
            // 日志结束
            Log::info("订单导出结束|时间:" . date('Y-m-d H:i:s', time()) . "|");
            // 下载文件并删除本地文件
            return $this-&gt;orderCsvDown($dirPath . '/' . $fileName);

        } catch (\Exception $e) {
            Log::error("订单导出失败|时间:" . date("Y-m-d H:i:s") . "|错误行号:" . $e-&gt;getLine() . "|错误原因:" . $e-&gt;getMessage() . "|");
        }
    }

    /**
     * 下载
     * @param $filePath
     * @return \Symfony\Component\HttpFoundation\BinaryFileResponse
     */
    private function orderCsvDown($filePath)
    {
        $aliasFileName = "订单信息_" . date('YmdHis') . ".csv";

        return response()-&gt;download($filePath, $aliasFileName)-&gt;deleteFileAfterSend(true);
    }


    /**************************************************jason订单导出结束****************************************************/

}

</code></pre> 
<h4><a id="httpstryfatzhoucn_996"></a>试玩赚钱平台推荐：https://try.fatzhou.cn</h4> 
<h4><a id="httpsimgblogcsdnimgcna51ba59632af4da3bfb1482d11083ac7pngxossprocessimagewatermarktype_ZHJvaWRzYW5zZmFsbGJhY2sshadow_50text_Q1NETiBASmFzb25Ib21lsize_12color_FFFFFFt_70g_sex_16pic_center_997"></a>推荐扫码访问:<img src="https://images2.imgbox.com/fa/8d/pv0Wn14V_o.png" alt="在这里插入图片描述"></h4>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2ab8e38b8745f863d2dc0ed15940e9c0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">监听 radio 单选框改变 相对应的 input 文本输入框中的值</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6a184727eb67925c3ea028928d4069d7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">DOTA目标检测数据集</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>