<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>No appropriate protocol (protocol is disabled or cipher suites are inappropriate)（Java版） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="No appropriate protocol (protocol is disabled or cipher suites are inappropriate)（Java版）" />
<meta property="og:description" content="问题 在访问MySQL时出现了，如下错误：
javax.net.ssl.SSLHandshakeException: No appropriate protocol (protocol is disabled or cipher suites are inappropriate) The following required algorithms might be disabled: SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurves. Edit the list of disabled algorithms to include required algorithms. You can try to enable TLSv1 or TLSv1.1 first. JDBC driver may have disabled TLS 1.1 and its earlier versions." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cc92bebfda5e029b6c5e0a261918fa8b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-19T09:50:54+08:00" />
<meta property="article:modified_time" content="2021-11-19T09:50:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">No appropriate protocol (protocol is disabled or cipher suites are inappropriate)（Java版）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>问题</h2> 
<p>在访问MySQL时出现了，如下错误：</p> 
<pre><code class="prism language-bash">javax.net.ssl.SSLHandshakeException: No appropriate protocol <span class="token punctuation">(</span>protocol is disabled or cipher suites are inappropriate<span class="token punctuation">)</span>

The following required algorithms might be disabled: SSLv3, TLSv1, TLSv1.1, RC4, DES, MD5withRSA, DH keySize <span class="token operator">&lt;</span> <span class="token number">1024</span>, EC keySize <span class="token operator">&lt;</span> <span class="token number">224</span>, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurves. Edit the list of disabled algorithms to include required algorithms. You can try to <span class="token builtin class-name">enable</span> TLSv1 or TLSv1.1 first.

JDBC driver may have disabled TLS <span class="token number">1.1</span> and its earlier versions.
</code></pre> 
<p>从这里就可以看出MySQL和客户端连接使用的tls版本，可能是TLSv1或者是TLSv1.1，需要放开jdk对TLSv1或者是TLSv1.1黑名单的限制。随便去掉一个TLSv1或者是TLSv1.1即可重现链接。</p> 
<h2><a id="_10"></a>原因</h2> 
<p>查询JDK对TLS版本的黑名单限制：<br> <code>vim /Library/Java/JavaVirtualMachines/jdk1.8.0_311.jdk/Contents/Home/jre/lib/security/java.security</code><br> <img src="https://images2.imgbox.com/14/4c/43HebWnk_o.png" alt="tls限制"><br> 从这里就可以看出本地的JDK对TLSv1，TLSv1.1，有限制，具体配置如下：</p> 
<pre><code class="prism language-sql">jdk<span class="token punctuation">.</span>tls<span class="token punctuation">.</span>disabledAlgorithms<span class="token operator">=</span>SSLv3<span class="token punctuation">,</span> TLSv1<span class="token punctuation">,</span> TLSv1<span class="token punctuation">.</span><span class="token number">1</span><span class="token punctuation">,</span> RC4<span class="token punctuation">,</span> DES<span class="token punctuation">,</span> MD5withRSA<span class="token punctuation">,</span> \
    DH keySize <span class="token operator">&lt;</span> <span class="token number">1024</span><span class="token punctuation">,</span> EC keySize <span class="token operator">&lt;</span> <span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">3</span>DES_EDE_CBC<span class="token punctuation">,</span> anon<span class="token punctuation">,</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span> \
    include jdk<span class="token punctuation">.</span>disabled<span class="token punctuation">.</span>namedCurves
</code></pre> 
<p>查询MySQL5.7版本文档，可以知道，MySQL支持TLSv1, TLSv1.1, TLSv1.2 版本。<br> <img src="https://images2.imgbox.com/73/48/9fglmD4r_o.png" alt="MySql5.7"><br> 连接我的DataGrip的时候可以只使用了TLSv1, TLSv1.1，而不会使用 TLSv1.2 进行连接建立。<br> 使用命令行登录MySQL，可以查询MySQL实例支持的TLS版本，以及当前连接使用的TLS版本。<br> <img src="https://images2.imgbox.com/11/ee/2jbLxEC7_o.png" alt="mysqlcli连接"><br> mysql实例支持的TLS版本：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SHOW</span> <span class="token keyword">GLOBAL</span> VARIABLES <span class="token operator">LIKE</span> <span class="token string">'tls_version'</span><span class="token punctuation">;</span>
</code></pre> 
<p>mysql当前session的使用的TLS版本：</p> 
<pre><code class="prism language-sql"><span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> performance_schema<span class="token punctuation">.</span>session_status
       <span class="token keyword">WHERE</span> VARIABLE_NAME <span class="token operator">IN</span> <span class="token punctuation">(</span><span class="token string">'Ssl_version'</span><span class="token punctuation">,</span><span class="token string">'Ssl_cipher'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="_35"></a>解决</h2> 
<h3><a id="1jdktlsdisabledAlgorithms_36"></a>方法1:jdk.tls.disabledAlgorithms接触限制</h3> 
<p><img src="https://images2.imgbox.com/68/54/YgaLa2jG_o.png" alt="去掉TLSv1"><br> 去掉TLSv1.1的黑名单即可，即使用如下环境变量：<br> <code>"-Djdk.tls.disabledAlgorithms=SSLv3, TLSv1, RC4, DES, MD5withRSA, DH keySize &lt; 1024, EC keySize &lt; 224, 3DES_EDE_CBC, anon, NULL, include jdk.disabled.namedCurves"</code></p> 
<h3><a id="2JDBCTLS_40"></a>方法2:JDBC指定TLS连接版本</h3> 
<p>jdbc:mysql://:/?useSSL=true&amp;enabledTLSProtocols=TLSv1.2</p> 
<h2><a id="_43"></a>总结</h2> 
<p>尽可能用高版本的MySQL或指定session使用的tls版本为tlsv1.2即可。</p> 
<h2><a id="_45"></a>参考：</h2> 
<ul><li><a href="https://blog.csdn.net/weixin_38111957/article/details/80577688">Java调用ssl异常，javax.net.ssl.SSLHandshakeException: No appropriate protocol</a></li><li><a href="https://dev.mysql.com/doc/refman/5.7/en/encrypted-connection-protocols-ciphers.html" rel="nofollow">6.3.2 Encrypted Connection TLS Protocols and Ciphers</a></li><li><a href="https://stackoverflow.com/questions/48464863/java-1-8-0-enable-tls1-2-in-jdbc-connection" rel="nofollow">Java 1.8.0 enable TLS1.2 in JDBC connection</a></li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2ee3876d3063d5c4d2184d8707f393eb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Bootstrap V5 图标字体的引入以及使用方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/65e89fd75eff4a7e61311fda52de69f9/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue 对element-ui的Popover进行二次封装</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>