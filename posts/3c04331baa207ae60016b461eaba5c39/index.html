<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>å¤§åˆ›é¡¹ç›®æ¨è æ·±åº¦å­¦ä¹ OCRä¸­æ–‡è¯†åˆ« - opencv python - ITå­¦ä¹ è€…åšå®¢</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="å¤§åˆ›é¡¹ç›®æ¨è æ·±åº¦å­¦ä¹ OCRä¸­æ–‡è¯†åˆ« - opencv python" />
<meta property="og:description" content="æ–‡ç« ç›®å½• 0 å‰è¨€1 è¯¾é¢˜èƒŒæ™¯2 å®ç°æ•ˆæœ3 æ–‡æœ¬åŒºåŸŸæ£€æµ‹ç½‘ç»œ-CTPN4 æ–‡æœ¬è¯†åˆ«ç½‘ç»œ-CRNN5 æœ€å 0 å‰è¨€ ğŸ”¥ ä¼˜è´¨ç«èµ›é¡¹ç›®ç³»åˆ—ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯
ğŸš© **åŸºäºæ·±åº¦å­¦ä¹ OCRä¸­æ–‡è¯†åˆ«ç³»ç»Ÿ **
è¯¥é¡¹ç›®è¾ƒä¸ºæ–°é¢–ï¼Œé€‚åˆä½œä¸ºç«èµ›è¯¾é¢˜æ–¹å‘ï¼Œå­¦é•¿éå¸¸æ¨èï¼
ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)
éš¾åº¦ç³»æ•°ï¼š3åˆ†å·¥ä½œé‡ï¼š3åˆ†åˆ›æ–°ç‚¹ï¼š4åˆ† ğŸ§¿ æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š
https://gitee.com/dancheng-senior/postgraduate
1 è¯¾é¢˜èƒŒæ™¯ åœ¨æ—¥å¸¸ç”Ÿäº§ç”Ÿæ´»ä¸­æœ‰å¤§é‡çš„æ–‡æ¡£èµ„æ–™ä»¥å›¾ç‰‡ã€PDFçš„æ–¹å¼ç•™å­˜ï¼Œéšç€æ—¶é—´æ¨ç§» å¾€å¾€éš¾ä»¥æ£€ç´¢å’Œå½’ç±» ï¼Œæ–‡å­—è¯†åˆ«ï¼ˆOptical Character
Recognitionï¼ŒOCR ï¼‰æ˜¯å°†å›¾ç‰‡ã€æ–‡æ¡£å½±åƒä¸Šçš„æ–‡å­—å†…å®¹å¿«é€Ÿè¯†åˆ«æˆä¸ºå¯ç¼–è¾‘çš„æ–‡æœ¬çš„æŠ€æœ¯ã€‚
é«˜æ€§èƒ½æ–‡æ¡£OCRè¯†åˆ«ç³»ç»Ÿæ˜¯åŸºäºæ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œç»¼åˆè¿ç”¨Tensorflowã€CNNã€Caffe
ç­‰å¤šç§æ·±åº¦å­¦ä¹ è®­ç»ƒæ¡†æ¶ï¼ŒåŸºäºåƒä¸‡çº§å¤§è§„æ¨¡æ–‡å­—æ ·æœ¬é›†è®­ç»ƒå®Œæˆçš„OCRå¼•æ“ï¼Œä¸ä¼ ç»Ÿçš„æ¨¡å¼è¯†åˆ«çš„æŠ€æœ¯ç›¸æ¯”ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯æ”¯æŒæ›´ä½è´¨é‡çš„åˆ†è¾¨ç‡ã€æŠ—å¹²æ‰°èƒ½åŠ›æ›´å¼ºã€é€‚ç”¨çš„åœºæ™¯æ›´å¤æ‚ï¼Œæ–‡å­—çš„è¯†åˆ«ç‡æ›´é«˜ã€‚
æœ¬é¡¹ç›®åŸºäºTensorflowã€keras/pytorchå®ç°å¯¹è‡ªç„¶åœºæ™¯çš„æ–‡å­—æ£€æµ‹åŠOCRä¸­æ–‡æ–‡å­—è¯†åˆ«ã€‚
2 å®ç°æ•ˆæœ å…¬å¼æ£€æµ‹
çº¯æ–‡å­—è¯†åˆ«
3 æ–‡æœ¬åŒºåŸŸæ£€æµ‹ç½‘ç»œ-CTPN å¯¹äºå¤æ‚åœºæ™¯çš„æ–‡å­—è¯†åˆ«ï¼Œé¦–å…ˆè¦å®šä½æ–‡å­—çš„ä½ç½®ï¼Œå³æ–‡å­—æ£€æµ‹ã€‚
ç®€ä»‹
CTPNæ˜¯åœ¨ECCV
2016æå‡ºçš„ä¸€ç§æ–‡å­—æ£€æµ‹ç®—æ³•ã€‚CTPNç»“åˆCNNä¸LSTMæ·±åº¦ç½‘ç»œï¼Œèƒ½æœ‰æ•ˆçš„æ£€æµ‹å‡ºå¤æ‚åœºæ™¯çš„æ¨ªå‘åˆ†å¸ƒçš„æ–‡å­—ï¼Œæ•ˆæœå¦‚å›¾1ï¼Œæ˜¯ç›®å‰æ¯”è¾ƒå¥½çš„æ–‡å­—æ£€æµ‹ç®—æ³•ã€‚ç”±äºCTPNæ˜¯ä»Faster
RCNNæ”¹è¿›è€Œæ¥ï¼Œæœ¬æ–‡é»˜è®¤è¯»è€…ç†Ÿæ‚‰CNNåŸç†å’ŒFaster RCNNç½‘ç»œç»“æ„ã€‚
ç›¸å…³ä»£ç 
â€‹
def main(argv): pycaffe_dir = os.path.dirname(__file__) parser = argparse.ArgumentParser() # Required arguments: input and output. parser.add_argument( &#34;input_file&#34;, help=&#34;Input txt/csv filename. If .txt, must be list of filenames." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/3c04331baa207ae60016b461eaba5c39/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-25T16:43:50+08:00" />
<meta property="article:modified_time" content="2023-12-25T16:43:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="ITå­¦ä¹ è€…åšå®¢" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">ITå­¦ä¹ è€…åšå®¢</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">å¤§åˆ›é¡¹ç›®æ¨è æ·±åº¦å­¦ä¹ OCRä¸­æ–‡è¯†åˆ« - opencv python</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>æ–‡ç« ç›®å½•</h4> 
 <ul><li><a href="#0__2" rel="nofollow">0 å‰è¨€</a></li><li><a href="#1__20" rel="nofollow">1 è¯¾é¢˜èƒŒæ™¯</a></li><li><a href="#2__30" rel="nofollow">2 å®ç°æ•ˆæœ</a></li><li><a href="#3_CTPN_38" rel="nofollow">3 æ–‡æœ¬åŒºåŸŸæ£€æµ‹ç½‘ç»œ-CTPN</a></li><li><a href="#4_CRNN_197" rel="nofollow">4 æ–‡æœ¬è¯†åˆ«ç½‘ç»œ-CRNN</a></li><li><a href="#5__309" rel="nofollow">5 æœ€å</a></li></ul> 
</div> 
<p></p> 
<h2><a id="0__2"></a>0 å‰è¨€</h2> 
<p>ğŸ”¥ ä¼˜è´¨ç«èµ›é¡¹ç›®ç³»åˆ—ï¼Œä»Šå¤©è¦åˆ†äº«çš„æ˜¯</p> 
<p>ğŸš© **åŸºäºæ·±åº¦å­¦ä¹ OCRä¸­æ–‡è¯†åˆ«ç³»ç»Ÿ **</p> 
<p>è¯¥é¡¹ç›®è¾ƒä¸ºæ–°é¢–ï¼Œé€‚åˆä½œä¸ºç«èµ›è¯¾é¢˜æ–¹å‘ï¼Œå­¦é•¿éå¸¸æ¨èï¼</p> 
<p>ğŸ¥‡å­¦é•¿è¿™é‡Œç»™ä¸€ä¸ªé¢˜ç›®ç»¼åˆè¯„åˆ†(æ¯é¡¹æ»¡åˆ†5åˆ†)</p> 
<ul><li>éš¾åº¦ç³»æ•°ï¼š3åˆ†</li><li>å·¥ä½œé‡ï¼š3åˆ†</li><li>åˆ›æ–°ç‚¹ï¼š4åˆ†</li></ul> 
<p>ğŸ§¿ <strong>æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p> 
<h2><a id="1__20"></a>1 è¯¾é¢˜èƒŒæ™¯</h2> 
<p>åœ¨æ—¥å¸¸ç”Ÿäº§ç”Ÿæ´»ä¸­æœ‰å¤§é‡çš„æ–‡æ¡£èµ„æ–™ä»¥å›¾ç‰‡ã€PDFçš„æ–¹å¼ç•™å­˜ï¼Œéšç€æ—¶é—´æ¨ç§» å¾€å¾€éš¾ä»¥æ£€ç´¢å’Œå½’ç±» ï¼Œæ–‡å­—è¯†åˆ«ï¼ˆOptical Character<br> Recognitionï¼ŒOCR ï¼‰æ˜¯å°†å›¾ç‰‡ã€æ–‡æ¡£å½±åƒä¸Šçš„æ–‡å­—å†…å®¹å¿«é€Ÿè¯†åˆ«æˆä¸ºå¯ç¼–è¾‘çš„æ–‡æœ¬çš„æŠ€æœ¯ã€‚</p> 
<p>é«˜æ€§èƒ½æ–‡æ¡£OCRè¯†åˆ«ç³»ç»Ÿæ˜¯åŸºäºæ·±åº¦å­¦ä¹ æŠ€æœ¯ï¼Œç»¼åˆè¿ç”¨Tensorflowã€CNNã€Caffe<br> ç­‰å¤šç§æ·±åº¦å­¦ä¹ è®­ç»ƒæ¡†æ¶ï¼ŒåŸºäºåƒä¸‡çº§å¤§è§„æ¨¡æ–‡å­—æ ·æœ¬é›†è®­ç»ƒå®Œæˆçš„OCRå¼•æ“ï¼Œä¸ä¼ ç»Ÿçš„æ¨¡å¼è¯†åˆ«çš„æŠ€æœ¯ç›¸æ¯”ï¼Œæ·±åº¦å­¦ä¹ æŠ€æœ¯æ”¯æŒæ›´ä½è´¨é‡çš„åˆ†è¾¨ç‡ã€æŠ—å¹²æ‰°èƒ½åŠ›æ›´å¼ºã€é€‚ç”¨çš„åœºæ™¯æ›´å¤æ‚ï¼Œæ–‡å­—çš„è¯†åˆ«ç‡æ›´é«˜ã€‚</p> 
<p>æœ¬é¡¹ç›®åŸºäºTensorflowã€keras/pytorchå®ç°å¯¹è‡ªç„¶åœºæ™¯çš„æ–‡å­—æ£€æµ‹åŠOCRä¸­æ–‡æ–‡å­—è¯†åˆ«ã€‚</p> 
<h2><a id="2__30"></a>2 å®ç°æ•ˆæœ</h2> 
<p><strong>å…¬å¼æ£€æµ‹</strong><br> <img src="https://images2.imgbox.com/9e/98/r9qF7nBm_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <strong>çº¯æ–‡å­—è¯†åˆ«</strong></p> 
<p><img src="https://images2.imgbox.com/88/8e/JwwMPYzg_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="3_CTPN_38"></a>3 æ–‡æœ¬åŒºåŸŸæ£€æµ‹ç½‘ç»œ-CTPN</h2> 
<p>å¯¹äºå¤æ‚åœºæ™¯çš„æ–‡å­—è¯†åˆ«ï¼Œé¦–å…ˆè¦å®šä½æ–‡å­—çš„ä½ç½®ï¼Œå³æ–‡å­—æ£€æµ‹ã€‚</p> 
<p><strong>ç®€ä»‹</strong><br> CTPNæ˜¯åœ¨ECCV<br> 2016æå‡ºçš„ä¸€ç§æ–‡å­—æ£€æµ‹ç®—æ³•ã€‚CTPNç»“åˆCNNä¸LSTMæ·±åº¦ç½‘ç»œï¼Œèƒ½æœ‰æ•ˆçš„æ£€æµ‹å‡ºå¤æ‚åœºæ™¯çš„æ¨ªå‘åˆ†å¸ƒçš„æ–‡å­—ï¼Œæ•ˆæœå¦‚å›¾1ï¼Œæ˜¯ç›®å‰æ¯”è¾ƒå¥½çš„æ–‡å­—æ£€æµ‹ç®—æ³•ã€‚ç”±äºCTPNæ˜¯ä»Faster<br> RCNNæ”¹è¿›è€Œæ¥ï¼Œæœ¬æ–‡é»˜è®¤è¯»è€…ç†Ÿæ‚‰CNNåŸç†å’ŒFaster RCNNç½‘ç»œç»“æ„ã€‚<br> <img src="https://images2.imgbox.com/57/52/W9KQDRPO_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"><br> <strong>ç›¸å…³ä»£ç </strong></p> 
<p>â€‹</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span>argv<span class="token punctuation">)</span><span class="token punctuation">:</span>
    pycaffe_dir <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span>

    parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment"># Required arguments: input and output.</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"input_file"</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span>"Input txt<span class="token operator">/</span>csv filename<span class="token punctuation">.</span> If <span class="token punctuation">.</span>txt<span class="token punctuation">,</span> must be <span class="token builtin">list</span> of filenames<span class="token punctuation">.</span>\
        If <span class="token punctuation">.</span>csv<span class="token punctuation">,</span> must be comma<span class="token operator">-</span>separated <span class="token builtin">file</span> <span class="token keyword">with</span> header\
        <span class="token string">'filename, xmin, ymin, xmax, ymax'</span>"
    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"output_file"</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Output h5/csv filename. Format depends on extension."</span>
    <span class="token punctuation">)</span>
    <span class="token comment"># Optional arguments.</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--model_def"</span><span class="token punctuation">,</span>
        default<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>pycaffe_dir<span class="token punctuation">,</span>
                <span class="token string">"../models/bvlc_reference_caffenet/deploy.prototxt.prototxt"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Model definition file."</span>
    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--pretrained_model"</span><span class="token punctuation">,</span>
        default<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>pycaffe_dir<span class="token punctuation">,</span>
                <span class="token string">"../models/bvlc_reference_caffenet/bvlc_reference_caffenet.caffemodel"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Trained model weights file."</span>
    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--crop_mode"</span><span class="token punctuation">,</span>
        default<span class="token operator">=</span><span class="token string">"selective_search"</span><span class="token punctuation">,</span>
        choices<span class="token operator">=</span>CROP_MODES<span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"How to generate windows for detection."</span>
    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--gpu"</span><span class="token punctuation">,</span>
        action<span class="token operator">=</span><span class="token string">'store_true'</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Switch for gpu computation."</span>
    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--mean_file"</span><span class="token punctuation">,</span>
        default<span class="token operator">=</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>pycaffe_dir<span class="token punctuation">,</span>
                             <span class="token string">'caffe/imagenet/ilsvrc_2012_mean.npy'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Data set image mean of H x W x K dimensions (numpy array). "</span> <span class="token operator">+</span>
             <span class="token string">"Set to '' for no mean subtraction."</span>
    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--input_scale"</span><span class="token punctuation">,</span>
        <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Multiply input features by this scale to finish preprocessing."</span>
    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--raw_scale"</span><span class="token punctuation">,</span>
        <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">float</span><span class="token punctuation">,</span>
        default<span class="token operator">=</span><span class="token number">255.0</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Multiply raw input by this scale before preprocessing."</span>
    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--channel_swap"</span><span class="token punctuation">,</span>
        default<span class="token operator">=</span><span class="token string">'2,1,0'</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Order to permute input channels. The default converts "</span> <span class="token operator">+</span>
             <span class="token string">"RGB -&gt; BGR since BGR is the Caffe default by way of OpenCV."</span>

    <span class="token punctuation">)</span>
    parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span>
        <span class="token string">"--context_pad"</span><span class="token punctuation">,</span>
        <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span>
        default<span class="token operator">=</span><span class="token string">'16'</span><span class="token punctuation">,</span>
        <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">"Amount of surrounding context to collect in input window."</span>
    <span class="token punctuation">)</span>
    args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>

    mean<span class="token punctuation">,</span> channel_swap <span class="token operator">=</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span>
    <span class="token keyword">if</span> args<span class="token punctuation">.</span>mean_file<span class="token punctuation">:</span>
        mean <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span>args<span class="token punctuation">.</span>mean_file<span class="token punctuation">)</span>
        <span class="token keyword">if</span> mean<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            mean <span class="token operator">=</span> mean<span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>mean<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> args<span class="token punctuation">.</span>channel_swap<span class="token punctuation">:</span>
        channel_swap <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token keyword">for</span> s <span class="token keyword">in</span> args<span class="token punctuation">.</span>channel_swap<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">]</span>

    <span class="token keyword">if</span> args<span class="token punctuation">.</span>gpu<span class="token punctuation">:</span>
        caffe<span class="token punctuation">.</span>set_mode_gpu<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"GPU mode"</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        caffe<span class="token punctuation">.</span>set_mode_cpu<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CPU mode"</span><span class="token punctuation">)</span>

    <span class="token comment"># Make detector.</span>
    detector <span class="token operator">=</span> caffe<span class="token punctuation">.</span>Detector<span class="token punctuation">(</span>args<span class="token punctuation">.</span>model_def<span class="token punctuation">,</span> args<span class="token punctuation">.</span>pretrained_model<span class="token punctuation">,</span> mean<span class="token operator">=</span>mean<span class="token punctuation">,</span>
            input_scale<span class="token operator">=</span>args<span class="token punctuation">.</span>input_scale<span class="token punctuation">,</span> raw_scale<span class="token operator">=</span>args<span class="token punctuation">.</span>raw_scale<span class="token punctuation">,</span>
            channel_swap<span class="token operator">=</span>channel_swap<span class="token punctuation">,</span>
            context_pad<span class="token operator">=</span>args<span class="token punctuation">.</span>context_pad<span class="token punctuation">)</span>

    <span class="token comment"># Load input.</span>
    t <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Loading input..."</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> args<span class="token punctuation">.</span>input_file<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'txt'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>input_file<span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            inputs <span class="token operator">=</span> <span class="token punctuation">[</span>_<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">for</span> _ <span class="token keyword">in</span> f<span class="token punctuation">.</span>readlines<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
    <span class="token keyword">elif</span> args<span class="token punctuation">.</span>input_file<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'csv'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        inputs <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span>args<span class="token punctuation">.</span>input_file<span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'filename'</span><span class="token punctuation">:</span> <span class="token builtin">str</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        inputs<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">raise</span> Exception<span class="token punctuation">(</span><span class="token string">"Unknown input file type: not in txt or csv."</span><span class="token punctuation">)</span>

    <span class="token comment"># Detect.</span>
    <span class="token keyword">if</span> args<span class="token punctuation">.</span>crop_mode <span class="token operator">==</span> <span class="token string">'list'</span><span class="token punctuation">:</span>
        <span class="token comment"># Unpack sequence of (image filename, windows).</span>
        images_windows <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">(</span>ix<span class="token punctuation">,</span> inputs<span class="token punctuation">.</span>iloc<span class="token punctuation">[</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>inputs<span class="token punctuation">.</span>index <span class="token operator">==</span> ix<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">[</span>COORD_COLS<span class="token punctuation">]</span><span class="token punctuation">.</span>values<span class="token punctuation">)</span>
            <span class="token keyword">for</span> ix <span class="token keyword">in</span> inputs<span class="token punctuation">.</span>index<span class="token punctuation">.</span>unique<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
        detections <span class="token operator">=</span> detector<span class="token punctuation">.</span>detect_windows<span class="token punctuation">(</span>images_windows<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        detections <span class="token operator">=</span> detector<span class="token punctuation">.</span>detect_selective_search<span class="token punctuation">(</span>inputs<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Processed {} windows in {:.3f} s."</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>detections<span class="token punctuation">)</span><span class="token punctuation">,</span>
                                                     time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment"># Collect into dataframe with labeled fields.</span>
    df <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>detections<span class="token punctuation">)</span>
    df<span class="token punctuation">.</span>set_index<span class="token punctuation">(</span><span class="token string">'filename'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
    df<span class="token punctuation">[</span>COORD_COLS<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
        data<span class="token operator">=</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'window'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span>df<span class="token punctuation">.</span>index<span class="token punctuation">,</span> columns<span class="token operator">=</span>COORD_COLS<span class="token punctuation">)</span>
    <span class="token keyword">del</span><span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'window'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

    <span class="token comment"># Save results.</span>
    t <span class="token operator">=</span> time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> args<span class="token punctuation">.</span>output_file<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>endswith<span class="token punctuation">(</span><span class="token string">'csv'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># csv</span>
        <span class="token comment"># Enumerate the class probabilities.</span>
        class_cols <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'class{}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>NUM_OUTPUT<span class="token punctuation">)</span><span class="token punctuation">]</span>
        df<span class="token punctuation">[</span>class_cols<span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>
            data<span class="token operator">=</span>np<span class="token punctuation">.</span>vstack<span class="token punctuation">(</span>df<span class="token punctuation">[</span><span class="token string">'feat'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> index<span class="token operator">=</span>df<span class="token punctuation">.</span>index<span class="token punctuation">,</span> columns<span class="token operator">=</span>class_cols<span class="token punctuation">)</span>
        df<span class="token punctuation">.</span>to_csv<span class="token punctuation">(</span>args<span class="token punctuation">.</span>output_file<span class="token punctuation">,</span> cols<span class="token operator">=</span>COORD_COLS <span class="token operator">+</span> class_cols<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token comment"># h5</span>
        df<span class="token punctuation">.</span>to_hdf<span class="token punctuation">(</span>args<span class="token punctuation">.</span>output_file<span class="token punctuation">,</span> <span class="token string">'df'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'w'</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"Saved to {} in {:.3f} s."</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>output_file<span class="token punctuation">,</span>
                                            time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> t<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>CTPNç½‘ç»œç»“æ„</strong><br> <img src="https://images2.imgbox.com/b2/48/8caW7gwN_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<h2><a id="4_CRNN_197"></a>4 æ–‡æœ¬è¯†åˆ«ç½‘ç»œ-CRNN</h2> 
<p><strong>CRNN ä»‹ç»</strong><br> CRNN å…¨ç§°ä¸º Convolutional Recurrent Neural Networkï¼Œä¸»è¦ç”¨äºç«¯åˆ°ç«¯åœ°å¯¹ä¸å®šé•¿çš„æ–‡æœ¬åºåˆ—è¿›è¡Œè¯†åˆ«ï¼Œä¸ç”¨</p> 
<p><img src="https://images2.imgbox.com/da/b9/z3OGbFe1_o.png" alt="å›¾æ¥è‡ªæ–‡ç« ï¼šä¸€æ–‡è¯»æ‡‚CRNN+CTCæ–‡å­—è¯†åˆ«"></p> 
<p>æ•´ä¸ªCRNNç½‘ç»œç»“æ„åŒ…å«ä¸‰éƒ¨åˆ†ï¼Œä»ä¸‹åˆ°ä¸Šä¾æ¬¡ä¸ºï¼š</p> 
<ol><li>CNNï¼ˆå·ç§¯å±‚ï¼‰ï¼Œä½¿ç”¨æ·±åº¦CNNï¼Œå¯¹è¾“å…¥å›¾åƒæå–ç‰¹å¾ï¼Œå¾—åˆ°ç‰¹å¾å›¾ï¼›</li><li>RNNï¼ˆå¾ªç¯å±‚ï¼‰ï¼Œä½¿ç”¨åŒå‘RNNï¼ˆBLSTMï¼‰å¯¹ç‰¹å¾åºåˆ—è¿›è¡Œé¢„æµ‹ï¼Œå¯¹åºåˆ—ä¸­çš„æ¯ä¸ªç‰¹å¾å‘é‡è¿›è¡Œå­¦ä¹ ï¼Œå¹¶è¾“å‡ºé¢„æµ‹æ ‡ç­¾ï¼ˆçœŸå®å€¼ï¼‰åˆ†å¸ƒï¼›</li><li>CTC lossï¼ˆè½¬å½•å±‚ï¼‰ï¼Œä½¿ç”¨ CTC æŸå¤±ï¼ŒæŠŠä»å¾ªç¯å±‚è·å–çš„ä¸€ç³»åˆ—æ ‡ç­¾åˆ†å¸ƒè½¬æ¢æˆæœ€ç»ˆçš„æ ‡ç­¾åºåˆ—ã€‚</li></ol> 
<p><strong>CNN</strong><br> å·ç§¯å±‚çš„ç»“æ„å›¾ï¼š<br> <img src="https://images2.imgbox.com/c5/76/uDryN9xc_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è¿™é‡Œæœ‰ä¸€ä¸ªå¾ˆç²¾å½©çš„æ”¹åŠ¨ï¼Œä¸€å…±æœ‰å››ä¸ªæœ€å¤§æ± åŒ–å±‚ï¼Œä½†æ˜¯æœ€åä¸¤ä¸ªæ± åŒ–å±‚çš„çª—å£å°ºå¯¸ç”± 2x2 æ”¹ä¸º 1x2ï¼Œä¹Ÿå°±æ˜¯å›¾ç‰‡çš„é«˜åº¦å‡åŠäº†å››æ¬¡ï¼ˆé™¤ä»¥ 2^4<br> ï¼‰ï¼Œè€Œå®½åº¦åˆ™åªå‡åŠäº†ä¸¤æ¬¡ï¼ˆé™¤ä»¥2^2ï¼‰ï¼Œè¿™æ˜¯å› ä¸ºæ–‡æœ¬å›¾åƒå¤šæ•°éƒ½æ˜¯é«˜è¾ƒå°è€Œå®½è¾ƒé•¿ï¼Œæ‰€ä»¥å…¶feature<br> mapä¹Ÿæ˜¯è¿™ç§é«˜å°å®½é•¿çš„çŸ©å½¢å½¢çŠ¶ï¼Œå¦‚æœä½¿ç”¨1Ã—2çš„æ± åŒ–çª—å£å¯ä»¥å°½é‡ä¿è¯ä¸ä¸¢å¤±åœ¨å®½åº¦æ–¹å‘çš„ä¿¡æ¯ï¼Œæ›´é€‚åˆè‹±æ–‡å­—æ¯è¯†åˆ«ï¼ˆæ¯”å¦‚åŒºåˆ†iå’Œlï¼‰ã€‚</p> 
<p>CRNN è¿˜å¼•å…¥äº†BatchNormalizationæ¨¡å—ï¼ŒåŠ é€Ÿæ¨¡å‹æ”¶æ•›ï¼Œç¼©çŸ­è®­ç»ƒè¿‡ç¨‹ã€‚</p> 
<p>è¾“å…¥å›¾åƒä¸ºç°åº¦å›¾åƒï¼ˆå•é€šé“ï¼‰ï¼›é«˜åº¦ä¸º32ï¼Œè¿™æ˜¯å›ºå®šçš„ï¼Œå›¾ç‰‡é€šè¿‡ CNN<br> åï¼Œé«˜åº¦å°±å˜ä¸º1ï¼Œè¿™ç‚¹å¾ˆé‡è¦ï¼›å®½åº¦ä¸º160ï¼Œå®½åº¦ä¹Ÿå¯ä»¥ä¸ºå…¶ä»–çš„å€¼ï¼Œä½†éœ€è¦ç»Ÿä¸€ï¼Œæ‰€ä»¥è¾“å…¥CNNçš„æ•°æ®å°ºå¯¸ä¸º (channel, height,<br> width)=(1, 32, 160)ã€‚</p> 
<p>CNNçš„è¾“å‡ºå°ºå¯¸ä¸º (512, 1, 40)ã€‚å³ CNN æœ€åå¾—åˆ°512ä¸ªç‰¹å¾å›¾ï¼Œæ¯ä¸ªç‰¹å¾å›¾çš„é«˜åº¦ä¸º1ï¼Œå®½åº¦ä¸º40ã€‚</p> 
<p><strong>Map-to-Sequence</strong><br> æˆ‘ä»¬æ˜¯ä¸èƒ½ç›´æ¥æŠŠ CNN å¾—åˆ°çš„ç‰¹å¾å›¾é€å…¥ RNN è¿›è¡Œè®­ç»ƒçš„ï¼Œéœ€è¦è¿›è¡Œä¸€äº›è°ƒæ•´ï¼Œæ ¹æ®ç‰¹å¾å›¾æå– RNN éœ€è¦çš„ç‰¹å¾å‘é‡åºåˆ—ã€‚</p> 
<p><img src="https://images2.imgbox.com/bd/aa/4Z2E1Zwn_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ç°åœ¨éœ€è¦ä» CNN æ¨¡å‹äº§ç”Ÿçš„ç‰¹å¾å›¾ä¸­æå–ç‰¹å¾å‘é‡åºåˆ—ï¼Œæ¯ä¸€ä¸ªç‰¹å¾å‘é‡ï¼ˆå¦‚ä¸Šå›¾ä¸­çš„ä¸€ä¸ªçº¢è‰²æ¡†ï¼‰åœ¨ç‰¹å¾å›¾ä¸ŠæŒ‰åˆ—ä»å·¦åˆ°å³ç”Ÿæˆï¼Œæ¯ä¸€åˆ—åŒ…å«512ç»´ç‰¹å¾ï¼Œè¿™æ„å‘³ç€ç¬¬<br> i ä¸ªç‰¹å¾å‘é‡æ˜¯æ‰€æœ‰çš„ç‰¹å¾å›¾ç¬¬ i åˆ—åƒç´ çš„è¿æ¥ï¼Œè¿™äº›ç‰¹å¾å‘é‡å°±æ„æˆä¸€ä¸ªåºåˆ—ã€‚</p> 
<p>ç”±äºå·ç§¯å±‚ï¼Œæœ€å¤§æ± åŒ–å±‚å’Œæ¿€æ´»å‡½æ•°åœ¨å±€éƒ¨åŒºåŸŸä¸Šæ‰§è¡Œï¼Œå› æ­¤å®ƒä»¬æ˜¯å¹³ç§»ä¸å˜çš„ã€‚å› æ­¤ï¼Œç‰¹å¾å›¾çš„æ¯åˆ—ï¼ˆå³ä¸€ä¸ªç‰¹å¾å‘é‡ï¼‰å¯¹åº”äºåŸå§‹å›¾åƒçš„ä¸€ä¸ªçŸ©å½¢åŒºåŸŸï¼ˆç§°ä¸ºæ„Ÿå—é‡ï¼‰ï¼Œå¹¶ä¸”è¿™äº›çŸ©å½¢åŒºåŸŸä¸ç‰¹å¾å›¾ä¸Šä»å·¦åˆ°å³çš„ç›¸åº”åˆ—å…·æœ‰ç›¸åŒçš„é¡ºåºã€‚ç‰¹å¾åºåˆ—ä¸­çš„æ¯ä¸ªå‘é‡å…³è”ä¸€ä¸ªæ„Ÿå—é‡ã€‚</p> 
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br> <img src="https://images2.imgbox.com/4c/3b/tRHOscjW_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>è¿™äº›ç‰¹å¾å‘é‡åºåˆ—å°±ä½œä¸ºå¾ªç¯å±‚çš„è¾“å…¥ï¼Œæ¯ä¸ªç‰¹å¾å‘é‡ä½œä¸º RNN åœ¨ä¸€ä¸ªæ—¶é—´æ­¥ï¼ˆtime stepï¼‰çš„è¾“å…¥ã€‚</p> 
<p><strong>RNN</strong><br> å› ä¸º RNN æœ‰æ¢¯åº¦æ¶ˆå¤±çš„é—®é¢˜ï¼Œä¸èƒ½è·å–æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œæ‰€ä»¥ CRNN ä¸­ä½¿ç”¨çš„æ˜¯ LSTMï¼ŒLSTM<br> çš„ç‰¹æ®Šè®¾è®¡å…è®¸å®ƒæ•è·é•¿è·ç¦»ä¾èµ–ï¼Œä¸äº†è§£çš„è¯å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡æ–‡ç«  å¯¹RNNå’ŒLSTMçš„ç†è§£ã€‚</p> 
<p>LSTM<br> æ˜¯å•å‘çš„ï¼Œå®ƒåªä½¿ç”¨è¿‡å»çš„ä¿¡æ¯ã€‚ç„¶è€Œï¼Œåœ¨åŸºäºå›¾åƒçš„åºåˆ—ä¸­ï¼Œä¸¤ä¸ªæ–¹å‘çš„ä¸Šä¸‹æ–‡æ˜¯ç›¸äº’æœ‰ç”¨ä¸”äº’è¡¥çš„ã€‚å°†ä¸¤ä¸ªLSTMï¼Œä¸€ä¸ªå‘å‰å’Œä¸€ä¸ªå‘åç»„åˆåˆ°ä¸€ä¸ªåŒå‘LSTMä¸­ã€‚æ­¤å¤–ï¼Œå¯ä»¥å †å å¤šå±‚åŒå‘LSTMï¼Œæ·±å±‚ç»“æ„å…è®¸æ¯”æµ…å±‚æŠ½è±¡æ›´é«˜å±‚æ¬¡çš„æŠ½è±¡ã€‚</p> 
<p>è¿™é‡Œé‡‡ç”¨çš„æ˜¯ä¸¤å±‚å„256å•å…ƒçš„åŒå‘ LSTM ç½‘ç»œï¼š<br> <img src="https://images2.imgbox.com/cb/ba/m9Bv4xz1_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>é€šè¿‡ä¸Šé¢ä¸€æ­¥ï¼Œæˆ‘ä»¬å¾—åˆ°äº†40ä¸ªç‰¹å¾å‘é‡ï¼Œæ¯ä¸ªç‰¹å¾å‘é‡é•¿åº¦ä¸º512ï¼Œåœ¨ LSTM ä¸­ä¸€ä¸ªæ—¶é—´æ­¥å°±ä¼ å…¥ä¸€ä¸ªç‰¹å¾å‘é‡è¿›è¡Œåˆ†</p> 
<p>æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªç‰¹å¾å‘é‡å°±ç›¸å½“äºåŸå›¾ä¸­çš„ä¸€ä¸ªå°çŸ©å½¢åŒºåŸŸï¼ŒRNN<br> çš„ç›®æ ‡å°±æ˜¯é¢„æµ‹è¿™ä¸ªçŸ©å½¢åŒºåŸŸä¸ºå“ªä¸ªå­—ç¬¦ï¼Œå³æ ¹æ®è¾“å…¥çš„ç‰¹å¾å‘é‡ï¼Œè¿›è¡Œé¢„æµ‹ï¼Œå¾—åˆ°æ‰€æœ‰å­—ç¬¦çš„softmaxæ¦‚ç‡åˆ†å¸ƒï¼Œè¿™æ˜¯ä¸€ä¸ªé•¿åº¦ä¸ºå­—ç¬¦ç±»åˆ«æ•°çš„å‘é‡ï¼Œä½œä¸ºCTCå±‚çš„è¾“å…¥ã€‚</p> 
<p>å› ä¸ºæ¯ä¸ªæ—¶é—´æ­¥éƒ½ä¼šæœ‰ä¸€ä¸ªè¾“å…¥ç‰¹å¾å‘é‡ x^T ï¼Œè¾“å‡ºä¸€ä¸ªæ‰€æœ‰å­—ç¬¦çš„æ¦‚ç‡åˆ†å¸ƒ y^T ï¼Œæ‰€ä»¥è¾“å‡ºä¸º 40 ä¸ªé•¿åº¦ä¸ºå­—ç¬¦ç±»åˆ«æ•°çš„å‘é‡æ„æˆçš„åéªŒæ¦‚ç‡çŸ©é˜µã€‚</p> 
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br> <img src="https://images2.imgbox.com/90/f7/7A0NvQCU_o.png" alt="åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°"></p> 
<p>ç„¶åå°†è¿™ä¸ªåéªŒæ¦‚ç‡çŸ©é˜µä¼ å…¥è½¬å½•å±‚ã€‚<br> <strong>CTC loss</strong><br> è¿™ç®—æ˜¯ CRNN æœ€éš¾çš„åœ°æ–¹ï¼Œè¿™ä¸€å±‚ä¸ºè½¬å½•å±‚ï¼Œè½¬å½•æ˜¯å°† RNN<br> å¯¹æ¯ä¸ªç‰¹å¾å‘é‡æ‰€åšçš„é¢„æµ‹è½¬æ¢æˆæ ‡ç­¾åºåˆ—çš„è¿‡ç¨‹ã€‚æ•°å­¦ä¸Šï¼Œè½¬å½•æ˜¯æ ¹æ®æ¯å¸§é¢„æµ‹æ‰¾åˆ°å…·æœ‰æœ€é«˜æ¦‚ç‡ç»„åˆçš„æ ‡ç­¾åºåˆ—ã€‚</p> 
<p>ç«¯åˆ°ç«¯OCRè¯†åˆ«çš„éš¾ç‚¹åœ¨äºæ€ä¹ˆå¤„ç†ä¸å®šé•¿åºåˆ—å¯¹é½çš„é—®é¢˜ï¼OCRå¯å»ºæ¨¡ä¸ºæ—¶åºä¾èµ–çš„æ–‡æœ¬å›¾åƒé—®é¢˜ï¼Œç„¶åä½¿ç”¨CTCï¼ˆConnectionist Temporal<br> Classification, CTCï¼‰çš„æŸå¤±å‡½æ•°æ¥å¯¹ CNN å’Œ RNN è¿›è¡Œç«¯åˆ°ç«¯çš„è”åˆè®­ç»ƒã€‚</p> 
<p><strong>ç›¸å…³ä»£ç </strong></p> 
<p>â€‹</p> 
<pre><code class="prism language-python">    <span class="token keyword">def</span> <span class="token function">inference</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> inputdata<span class="token punctuation">,</span> name<span class="token punctuation">,</span> reuse<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        Main routine to construct the network
        :param inputdata:
        :param name:
        :param reuse:
        :return:
        """</span>
        <span class="token keyword">with</span> tf<span class="token punctuation">.</span>variable_scope<span class="token punctuation">(</span>name_or_scope<span class="token operator">=</span>name<span class="token punctuation">,</span> reuse<span class="token operator">=</span>reuse<span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token comment"># centerlized data</span>
            inputdata <span class="token operator">=</span> tf<span class="token punctuation">.</span>divide<span class="token punctuation">(</span>inputdata<span class="token punctuation">,</span> <span class="token number">255.0</span><span class="token punctuation">)</span>
            <span class="token comment">#1.ç‰¹å¾æå–é˜¶æ®µ</span>
            <span class="token comment"># first apply the cnn feature extraction stage</span>
            cnn_out <span class="token operator">=</span> self<span class="token punctuation">.</span>_feature_sequence_extraction<span class="token punctuation">(</span>
                inputdata<span class="token operator">=</span>inputdata<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'feature_extraction_module'</span>
            <span class="token punctuation">)</span>
            <span class="token comment">#2.ç¬¬äºŒæ­¥ï¼Œ  batch*1*25*512  å˜æˆ batch * 25 * 512</span>
            <span class="token comment"># second apply the map to sequence stage</span>
            sequence <span class="token operator">=</span> self<span class="token punctuation">.</span>_map_to_sequence<span class="token punctuation">(</span>
                inputdata<span class="token operator">=</span>cnn_out<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'map_to_sequence_module'</span>
            <span class="token punctuation">)</span>
            <span class="token comment">#ç¬¬ä¸‰æ­¥ï¼Œåº”ç”¨åºåˆ—æ ‡ç­¾é˜¶æ®µ</span>
            <span class="token comment"># third apply the sequence label stage</span>
            <span class="token comment"># net_out width, batch, n_classes</span>
            <span class="token comment"># raw_pred   width, batch, 1</span>
            net_out<span class="token punctuation">,</span> raw_pred <span class="token operator">=</span> self<span class="token punctuation">.</span>_sequence_label<span class="token punctuation">(</span>
                inputdata<span class="token operator">=</span>sequence<span class="token punctuation">,</span> name<span class="token operator">=</span><span class="token string">'sequence_rnn_module'</span>
            <span class="token punctuation">)</span>

        <span class="token keyword">return</span> net_out
</code></pre> 
<p>â€‹</p> 
<h2><a id="5__309"></a>5 æœ€å</h2> 
<p>ğŸ§¿ <strong>æ›´å¤šèµ„æ–™, é¡¹ç›®åˆ†äº«ï¼š</strong></p> 
<p><a href="https://gitee.com/dancheng-senior/postgraduate" rel="nofollow">https://gitee.com/dancheng-senior/postgraduate</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/426665856b50f5410b809cf1b41a21c7/" rel="prev">
			<span class="pager__subtitle">Â«&thinsp;Previous</span>
			<p class="pager__title">ã€æ¡ˆä¾‹ã€‘ç®€å•çš„è´¦å·çŸ­ä¿¡ç™»å½•</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fcc43993e3dbf2c4c0be781d1ddc0e0d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;Â»</span>
			<p class="pager__title">React Native ä»ç±»ç»„ä»¶åˆ°å‡½æ•°ç»„ä»¶</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 ITå­¦ä¹ è€…åšå®¢.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>