<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据毕设 - 深度学习植物识别系统（python OpenCV） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大数据毕设 - 深度学习植物识别系统（python OpenCV）" />
<meta property="og:description" content="文章目录 0 前言2 相关技术2.1 VGG-Net模型2.2 VGG-Net在植物识别的优势(1) 卷积核，池化核大小固定(2) 特征提取更全面(3) 网络训练误差收敛速度较快 3 VGG-Net的搭建3.1 Tornado简介(1) 优势(2) 关键代码 4 Inception V3 神经网络4.1 网络结构 5 开始训练5.1 数据集5.2 关键代码5.3 模型预测 6 效果展示6.1 主页面展示6.2 图片预测6.3 三维模型可视化 7 最后 0 前言 🔥 Hi，大家好，这里是丹成学长的毕设系列文章！
🔥 对毕设有任何疑问都可以问学长哦!
这两年开始，各个学校对毕设的要求越来越高，难度也越来越大… 毕业设计耗费时间，耗费精力，甚至有些题目即使是专业的老师或者硕士生也需要很长时间，所以一旦发现问题，一定要提前准备，避免到后面措手不及，草草了事。
为了大家能够顺利以及最少的精力通过毕设，学长分享优质毕业设计项目，今天要分享的新项目是
🚩 基于深度学习的植物识别算法研究与实现
🥇学长这里给一个题目综合评分(每项满分5分)
难度系数：4分工作量：4分创新点：3分 🧿 选题指导, 项目分享：
https://gitee.com/yaa-dc/BJH/blob/master/gg/cc/README.md
2 相关技术 2.1 VGG-Net模型 Google DeepMind公司研究员与牛津大学计算机视觉组在2014年共同研发出了一种全新的卷积神经网络–VGG-Net。在同年举办的ILSVRC比赛中，该网络结构模型在分类项目中取得了十分出色的成绩，由于其简洁性和实用性，使得其在当时迅速，飞快地成为了最受欢迎的卷积神经网络模型。VGG-Net卷积神经网络在近年来衍生出了A-E七种不同的层次结构，本次研究使用其中的D结构，也就是VGG-16Net结构，该结构中包含了13个卷积层，5个池化层和3个全连接层。针对所有的卷积层，使用相同的5x5大小的卷积核，针对所有的池化层，使用相同的3x3大小的池化核。VGG-Net结构如图所示。
2.2 VGG-Net在植物识别的优势 在针对植物识别问题上，VGG-Net有着一些相较于其他神经网络的优势，主要包括以下几点：
(1) 卷积核，池化核大小固定 网络中所有的卷积核大小固定为3x3,所有的池化核大小固定为5x5。这样在进行卷积和池化操作的时候，从数据中提取到的特征更加明显，同时在层与层的连接时，信息的丢失会更少，更加方便后续对于重要特征的提取和处理。
(2) 特征提取更全面 VGG-Net网络模型中包含了13个卷积层。卷积层数目越多，对于特征的提取更加的全面。由于需要对于植物的姿态、颜色等进行判定，植物的特征较多，需要在提取时更加的全面，细致，才有可能得到一个更加准确的判定。VGG-Net符合条件。
(3) 网络训练误差收敛速度较快 VGG-Net网络在训练时收敛速度相对较快，能够较快地得到预期的结果。具有这一特点的原因有两个，一个是网络中每一个卷积层和池化层中的卷积核大小与池化核大小固定，另一个就是对于各个隐藏层的参数初始化方法使用专门针对ReLU激活函数的Kaiming正态初始化方法。
3 VGG-Net的搭建 本次研究基于Pytorch深度学习框架进行网络的搭建，利用模块化的设计思想，构建一个类，来对于整个的网络进行结构上的封装。这样搭建的好处是可以隐藏实现的内部细节，提高代码的安全性，增强代码的复用效率，并且对于一些方法，通过在内部集成，可以方便之后对于其中方法的调用，提升代码的简洁性。 在网络搭建完成后，将数据集传入网络中进行训练，经过一段时间后即可得到植物识别的分类识别结果。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c9719f5284f4ce5377d3ffaaeb3730c7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-22T10:27:01+08:00" />
<meta property="article:modified_time" content="2022-11-22T10:27:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据毕设 - 深度学习植物识别系统（python OpenCV）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#0__4" rel="nofollow">0 前言</a></li><li><a href="#2__38" rel="nofollow">2 相关技术</a></li><li><ul><li><a href="#21_VGGNet_40" rel="nofollow">2.1 VGG-Net模型</a></li><li><a href="#22_VGGNet_47" rel="nofollow">2.2 VGG-Net在植物识别的优势</a></li><li><ul><li><a href="#1__51" rel="nofollow">(1) 卷积核，池化核大小固定</a></li><li><a href="#2__55" rel="nofollow">(2) 特征提取更全面</a></li><li><a href="#3__62" rel="nofollow">(3) 网络训练误差收敛速度较快</a></li></ul> 
  </li></ul> 
  </li><li><a href="#3_VGGNet_70" rel="nofollow">3 VGG-Net的搭建</a></li><li><ul><li><a href="#31_Tornado_75" rel="nofollow">3.1 Tornado简介</a></li><li><ul><li><a href="#1__79" rel="nofollow">(1) 优势</a></li><li><a href="#2___87" rel="nofollow">(2) 关键代码</a></li></ul> 
  </li></ul> 
  </li><li><a href="#4_Inception_V3__148" rel="nofollow">4 Inception V3 神经网络</a></li><li><ul><li><a href="#41__152" rel="nofollow">4.1 网络结构</a></li></ul> 
  </li><li><a href="#5__176" rel="nofollow">5 开始训练</a></li><li><ul><li><a href="#51__178" rel="nofollow">5.1 数据集</a></li><li><a href="#52__185" rel="nofollow">5.2 关键代码</a></li><li><a href="#53__244" rel="nofollow">5.3 模型预测</a></li></ul> 
  </li><li><a href="#6__273" rel="nofollow">6 效果展示</a></li><li><ul><li><a href="#61__275" rel="nofollow">6.1 主页面展示</a></li><li><a href="#62__279" rel="nofollow">6.2 图片预测</a></li><li><a href="#63__284" rel="nofollow">6.3 三维模型可视化</a></li></ul> 
  </li><li><a href="#7__300" rel="nofollow">7 最后</a></li></ul> 
</div> 
<p></p> 
<hr size='1"' color="#000000"> 
<h2><a id="0__4"></a>0 前言</h2> 
<p>🔥 Hi，大家好，这里是丹成学长的毕设系列文章！</p> 
<p>🔥 对毕设有任何疑问都可以问学长哦!</p> 
<p>这两年开始，各个学校对毕设的要求越来越高，难度也越来越大… 毕业设计耗费时间，耗费精力，甚至有些题目即使是专业的老师或者硕士生也需要很长时间，所以一旦发现问题，一定要提前准备，避免到后面措手不及，草草了事。</p> 
<p>为了大家能够顺利以及最少的精力通过毕设，学长分享优质毕业设计项目，今天要分享的新项目是</p> 
<p>🚩 <strong>基于深度学习的植物识别算法研究与实现</strong></p> 
<p>🥇学长这里给一个题目综合评分(每项满分5分)</p> 
<ul><li>难度系数：4分</li><li>工作量：4分</li><li>创新点：3分</li></ul> 
<p>🧿 <strong>选题指导, 项目分享：</strong></p> 
<p><a href="https://gitee.com/yaa-dc/BJH/blob/master/gg/cc/README.md" rel="nofollow">https://gitee.com/yaa-dc/BJH/blob/master/gg/cc/README.md</a></p> 
<p><img src="https://images2.imgbox.com/4c/b8/EXXoC4hH_o.png" alt="在这里插入图片描述"></p> 
<br> 
<hr size='1"' color="#000000"> 
<h2><a id="2__38"></a>2 相关技术</h2> 
<h3><a id="21_VGGNet_40"></a>2.1 VGG-Net模型</h3> 
<p>Google DeepMind公司研究员与牛津大学计算机视觉组在2014年共同研发出了一种全新的卷积神经网络–VGG-Net。在同年举办的ILSVRC比赛中，该网络结构模型在分类项目中取得了十分出色的成绩，由于其简洁性和实用性，使得其在当时迅速，飞快地成为了最受欢迎的卷积神经网络模型。VGG-Net卷积神经网络在近年来衍生出了A-E七种不同的层次结构，本次研究使用其中的D结构，也就是VGG-16Net结构，该结构中包含了13个卷积层，5个池化层和3个全连接层。针对所有的卷积层，使用相同的5x5大小的卷积核，针对所有的池化层，使用相同的3x3大小的池化核。VGG-Net结构如图所示。</p> 
<p><img src="https://images2.imgbox.com/24/84/MQd1YGkb_o.jpg" alt="在这里插入图片描述"></p> 
<h3><a id="22_VGGNet_47"></a>2.2 VGG-Net在植物识别的优势</h3> 
<p>在针对植物识别问题上，VGG-Net有着一些相较于其他神经网络的优势，主要包括以下几点：</p> 
<h4><a id="1__51"></a>(1) 卷积核，池化核大小固定</h4> 
<p>网络中所有的卷积核大小固定为3x3,所有的池化核大小固定为5x5。这样在进行卷积和池化操作的时候，从数据中提取到的特征更加明显，同时在层与层的连接时，信息的丢失会更少，更加方便后续对于重要特征的提取和处理。</p> 
<h4><a id="2__55"></a>(2) 特征提取更全面</h4> 
<p>VGG-Net网络模型中包含了13个卷积层。卷积层数目越多，对于特征的提取更加的全面。由于需要对于植物的姿态、颜色等进行判定，植物的特征较多，需要在提取时更加的全面，细致，才有可能得到一个更加准确的判定。VGG-Net符合条件。</p> 
<p><img src="https://images2.imgbox.com/2b/90/8k0m3mzf_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="3__62"></a>(3) 网络训练误差收敛速度较快</h4> 
<p>VGG-Net网络在训练时收敛速度相对较快，能够较快地得到预期的结果。具有这一特点的原因有两个，一个是网络中每一个卷积层和池化层中的卷积核大小与池化核大小固定，另一个就是对于各个隐藏层的参数初始化方法使用专门针对ReLU激活函数的Kaiming正态初始化方法。</p> 
<br> 
<h2><a id="3_VGGNet_70"></a>3 VGG-Net的搭建</h2> 
<p>本次研究基于Pytorch深度学习框架进行网络的搭建，利用模块化的设计思想，构建一个类，来对于整个的网络进行结构上的封装。这样搭建的好处是可以隐藏实现的内部细节，提高代码的安全性，增强代码的复用效率，并且对于一些方法，通过在内部集成，可以方便之后对于其中方法的调用，提升代码的简洁性。 在网络搭建完成后，将数据集传入网络中进行训练，经过一段时间后即可得到植物识别的分类识别结果。</p> 
<h3><a id="31_Tornado_75"></a>3.1 Tornado简介</h3> 
<p>Tornado全称Tornado Web Server，是一个用Python语言写成的Web服务器兼Web应用框架，由FriendFeed公司在自己的网站FriendFeed中使用，被Facebook收购以后框架在2009年9月以开源软件形式开放给大众。</p> 
<h4><a id="1__79"></a>(1) 优势</h4> 
<ul><li>轻量级web框架</li><li>异步非阻塞IO处理方式</li><li>出色的抗负载能力</li><li>优异的处理性能，不依赖多进程/多线程，一定程度上解决C10K问题</li><li>WSGI全栈替代产品，推荐同时使用其web框架和HTTP服务器</li></ul> 
<h4><a id="2___87"></a>(2) 关键代码</h4> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">MainHandler</span><span class="token punctuation">(</span>tornado<span class="token punctuation">.</span>web<span class="token punctuation">.</span>RequestHandler<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">get</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>render<span class="token punctuation">(</span><span class="token string">"index.html"</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">post</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        keras<span class="token punctuation">.</span>backend<span class="token punctuation">.</span>clear_session<span class="token punctuation">(</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>BytesIO<span class="token punctuation">(</span>self<span class="token punctuation">.</span>request<span class="token punctuation">.</span>files<span class="token punctuation">[</span><span class="token string">'image'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'body'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        img <span class="token operator">=</span> img
        b_img <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        size <span class="token operator">=</span> img<span class="token punctuation">.</span>size
        <span class="token keyword">if</span> size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            rate <span class="token operator">=</span> <span class="token number">224</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            new_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">224</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> rate<span class="token punctuation">)</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>new_size<span class="token punctuation">,</span> Image<span class="token punctuation">.</span>ANTIALIAS
                             <span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">)</span>
            b_img<span class="token punctuation">.</span>paste<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">224</span> <span class="token operator">-</span> new_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">else</span><span class="token punctuation">:</span>
            rate <span class="token operator">=</span> <span class="token number">224</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
            new_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> rate<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">224</span><span class="token punctuation">)</span>
            img <span class="token operator">=</span> img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>new_size<span class="token punctuation">,</span> Image<span class="token punctuation">.</span>ANTIALIAS
                             <span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">)</span>
            b_img<span class="token punctuation">.</span>paste<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">224</span> <span class="token operator">-</span> new_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">if</span> self<span class="token punctuation">.</span>get_argument<span class="token punctuation">(</span><span class="token string">"method"</span><span class="token punctuation">,</span> <span class="token string">"mymodel"</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"VGG16"</span><span class="token punctuation">:</span>
            Model <span class="token operator">=</span> load_model<span class="token punctuation">(</span><span class="token string">"VGG16.h5"</span><span class="token punctuation">)</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            Model <span class="token operator">=</span> load_model<span class="token punctuation">(</span><span class="token string">"InceptionV3.h5"</span><span class="token punctuation">)</span>

        data <span class="token operator">=</span> orc_img<span class="token punctuation">(</span>Model<span class="token punctuation">,</span>b_img<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>write<span class="token punctuation">(</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>
            <span class="token punctuation">{<!-- --></span><span class="token string">"code"</span><span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token string">"data"</span><span class="token punctuation">:</span> data
             <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        
        <span class="token keyword">def</span> <span class="token function">make_app</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    template_path <span class="token operator">=</span> <span class="token string">"templates/"</span>
    static_path <span class="token operator">=</span> <span class="token string">"./static/"</span>

    <span class="token keyword">return</span> tornado<span class="token punctuation">.</span>web<span class="token punctuation">.</span>Application<span class="token punctuation">(</span><span class="token punctuation">[</span>

        <span class="token punctuation">(</span><span class="token string">r"/"</span><span class="token punctuation">,</span> MainHandler<span class="token punctuation">)</span><span class="token punctuation">,</span>

    <span class="token punctuation">]</span><span class="token punctuation">,</span> template_path<span class="token operator">=</span>template_path<span class="token punctuation">,</span> static_path<span class="token operator">=</span>static_path<span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">run_server</span><span class="token punctuation">(</span>port<span class="token operator">=</span><span class="token number">8000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    tornado<span class="token punctuation">.</span>options<span class="token punctuation">.</span>parse_command_line<span class="token punctuation">(</span><span class="token punctuation">)</span>
    app <span class="token operator">=</span> make_app<span class="token punctuation">(</span><span class="token punctuation">)</span>
    app<span class="token punctuation">.</span>listen<span class="token punctuation">(</span>port<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"\n服务已启动 请打开 http://127.0.0.1:8000 "</span><span class="token punctuation">)</span>
    tornado<span class="token punctuation">.</span>ioloop<span class="token punctuation">.</span>IOLoop<span class="token punctuation">.</span>current<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<br> 
<h2><a id="4_Inception_V3__148"></a>4 Inception V3 神经网络</h2> 
<p>GoogLeNet对网络中的传统卷积层进行了修改，提出了被称为 Inception 的结构，用于增加网络深度和宽度，提高深度神经网络性能。从Inception V1到Inception V4有4个更新版本，每一版的网络在原来的基础上进行改进，提高网络性能。</p> 
<h3><a id="41__152"></a>4.1 网络结构</h3> 
<p><img src="https://images2.imgbox.com/d1/ed/yw7wl8mp_o.png" alt="在这里插入图片描述"></p> 
<p><strong>inception结构的作用（inception的结构和作用）</strong></p> 
<p>作用：代替人工确定卷积层中过滤器的类型或者确定是否需要创建卷积层或者池化层。即：不需要人为决定使用什么过滤器，是否需要创建池化层，由网络自己学习决定这些参数，可以给网络添加所有可能值，将输入连接起来，网络自己学习需要它需要什么样的参数。</p> 
<p><strong>inception主要思想</strong></p> 
<p>用密集成分来近似最优的局部稀疏解（如上图）</p> 
<ul><li>采用不同大小的卷积核意味着有不同大小的感受野，最后的拼接意味着不同尺度特征的融合。</li><li>之所以卷积核大小采用1x1、3x3和5x5，主要是为了方便对齐。设定卷积步长stride=1之后，只要分别设定padding = 0、1、2，采用same卷积可以得到相同维度的特征，然后这些特征直接拼接在一起。</li><li>很多地方都表明pooling挺有效，所以Inception里面也嵌入了pooling。</li><li>网络越到后面特征越抽象，且每个特征涉及的感受野也更大，随着层数的增加，3x3和5x5卷积的比例也要增加。</li><li>最终版inception，加入了1x1 conv来降低feature map厚度。</li></ul> 
<br> 
<h2><a id="5__176"></a>5 开始训练</h2> 
<h3><a id="51__178"></a>5.1 数据集</h3> 
<p>训练图像按照如下方式进行分类，共分为9文件夹。</p> 
<p><img src="https://images2.imgbox.com/24/36/GQH4Dby8_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="52__185"></a>5.2 关键代码</h3> 
<pre><code class="prism language-python"><span class="token keyword">from</span> keras<span class="token punctuation">.</span>utils <span class="token keyword">import</span> Sequence
<span class="token keyword">import</span> math


<span class="token keyword">class</span> <span class="token class-name">SequenceData</span><span class="token punctuation">(</span>Sequence<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> batch_size<span class="token punctuation">,</span> target_size<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 初始化所需的参数</span>

        self<span class="token punctuation">.</span>batch_size <span class="token operator">=</span> batch_size
        self<span class="token punctuation">.</span>target_size <span class="token operator">=</span> target_size
        self<span class="token punctuation">.</span>x_filenames <span class="token operator">=</span> data

    <span class="token keyword">def</span> <span class="token function">__len__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 让代码知道这个序列的长度</span>
        num_imgs <span class="token operator">=</span> <span class="token builtin">len</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>x_filenames<span class="token punctuation">)</span>
        <span class="token keyword">return</span> math<span class="token punctuation">.</span>ceil<span class="token punctuation">(</span>num_imgs <span class="token operator">/</span> self<span class="token punctuation">.</span>batch_size<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">__getitem__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> idx<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 迭代器部分</span>
        batch_x <span class="token operator">=</span> self<span class="token punctuation">.</span>x_filenames<span class="token punctuation">[</span>idx <span class="token operator">*</span> self<span class="token punctuation">.</span>batch_size<span class="token punctuation">:</span> <span class="token punctuation">(</span>idx <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>batch_size<span class="token punctuation">]</span>
        imgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        y <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> x <span class="token keyword">in</span> batch_x<span class="token punctuation">:</span>
            img <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span>
            b_img <span class="token operator">=</span> Image<span class="token punctuation">.</span>new<span class="token punctuation">(</span><span class="token string">'RGB'</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>target_size<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">,</span> <span class="token number">255</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            size <span class="token operator">=</span> img<span class="token punctuation">.</span>size
            <span class="token keyword">if</span> size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">&gt;=</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
                rate <span class="token operator">=</span> self<span class="token punctuation">.</span>target_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
                new_size <span class="token operator">=</span> <span class="token punctuation">(</span>self<span class="token punctuation">.</span>target_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">*</span> rate<span class="token punctuation">)</span><span class="token punctuation">)</span>
                img <span class="token operator">=</span> img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>new_size<span class="token punctuation">,</span> Image<span class="token punctuation">.</span>ANTIALIAS<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">)</span>
                b_img<span class="token punctuation">.</span>paste<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>target_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> new_size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            <span class="token keyword">else</span><span class="token punctuation">:</span>
                rate <span class="token operator">=</span> self<span class="token punctuation">.</span>target_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">/</span> size<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
                new_size <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">*</span> rate<span class="token punctuation">)</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>target_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                img <span class="token operator">=</span> img<span class="token punctuation">.</span>resize<span class="token punctuation">(</span>new_size<span class="token punctuation">,</span> Image<span class="token punctuation">.</span>ANTIALIAS<span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">)</span>
                b_img<span class="token punctuation">.</span>paste<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> self<span class="token punctuation">.</span>target_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">-</span> new_size<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

            img <span class="token operator">=</span> b_img
            <span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.1</span><span class="token punctuation">:</span>
                img <span class="token operator">=</span> img<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"L"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.2</span><span class="token punctuation">:</span>
                img <span class="token operator">=</span> img<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 随机旋转一定角度</span>
            <span class="token keyword">if</span> random<span class="token punctuation">.</span>random<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0.2</span><span class="token punctuation">:</span>
                img <span class="token operator">=</span> img<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>random<span class="token punctuation">.</span>randint<span class="token punctuation">(</span><span class="token number">340</span><span class="token punctuation">,</span> <span class="token number">360</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 随 旋转一定角度</span>
            imgs<span class="token punctuation">.</span>append<span class="token punctuation">(</span>img<span class="token punctuation">.</span>convert<span class="token punctuation">(</span><span class="token string">"RGB"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        x_arrays <span class="token operator">=</span> <span class="token number">1</span> <span class="token operator">-</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>i<span class="token punctuation">)</span>  <span class="token keyword">for</span> i <span class="token keyword">in</span> imgs<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>astype<span class="token punctuation">(</span>
            <span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span>  <span class="token comment"># 读取一批图片</span>

        batch_y <span class="token operator">=</span> to_categorical<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>labels<span class="token punctuation">.</span>index<span class="token punctuation">(</span>x<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">for</span> x <span class="token keyword">in</span> batch_x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">len</span><span class="token punctuation">(</span>labels<span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> x_arrays<span class="token punctuation">,</span> batch_y

</code></pre> 
<h3><a id="53__244"></a>5.3 模型预测</h3> 
<p>利用我们训练好的<strong>vgg16.h5</strong>模型进行预测，相关代码如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">orc_img</span><span class="token punctuation">(</span>model<span class="token punctuation">,</span>image<span class="token punctuation">)</span><span class="token punctuation">:</span>
    img <span class="token operator">=</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>image<span class="token punctuation">)</span>
    img <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1</span> <span class="token operator">-</span> img<span class="token punctuation">.</span>astype<span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">255</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    predict <span class="token operator">=</span> model<span class="token punctuation">.</span>predict<span class="token punctuation">(</span>img<span class="token punctuation">)</span>
    index <span class="token operator">=</span> predict<span class="token punctuation">.</span>argmax<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"CNN预测"</span><span class="token punctuation">,</span> index<span class="token punctuation">)</span>

    target <span class="token operator">=</span> target_name<span class="token punctuation">[</span>index<span class="token punctuation">]</span>
    index2 <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>predict<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span>
    target2 <span class="token operator">=</span> target_name<span class="token punctuation">[</span>index2<span class="token punctuation">]</span>
    index3 <span class="token operator">=</span> np<span class="token punctuation">.</span>argsort<span class="token punctuation">(</span>predict<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span>
    target3 <span class="token operator">=</span> target_name<span class="token punctuation">[</span>index3<span class="token punctuation">]</span>

    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span><span class="token string">"target"</span><span class="token punctuation">:</span> target<span class="token punctuation">,</span>
            <span class="token string">"predict"</span><span class="token punctuation">:</span> <span class="token string">"%.2f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>predict<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

            <span class="token string">"target2"</span><span class="token punctuation">:</span> target2<span class="token punctuation">,</span>
            <span class="token string">"predict2"</span><span class="token punctuation">:</span> <span class="token string">"%.2f"</span> <span class="token operator">%</span> <span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>predict<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>index2<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">64</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

            <span class="token punctuation">}</span>
</code></pre> 
<br> 
<h2><a id="6__273"></a>6 效果展示</h2> 
<h3><a id="61__275"></a>6.1 主页面展示</h3> 
<p><img src="https://images2.imgbox.com/02/f1/ksxRTxwf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="62__279"></a>6.2 图片预测</h3> 
<p><img src="https://images2.imgbox.com/7b/ff/tPJOXifh_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="63__284"></a>6.3 三维模型可视化</h3> 
<p>学长在web页面上做了一个三维网络结构可视化功能，可以直观的看到网络模型结构</p> 
<p><img src="https://images2.imgbox.com/d8/29/LExCH4gw_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/66/c5/Ilc1t4uK_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/4e/25/qVST8vV6_o.png" alt="在这里插入图片描述"></p> 
<br> 
<h2><a id="7__300"></a>7 最后</h2>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a3d035907429d64f7e6c9328fb347fdb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">win10安装配置nodejs环境</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/895356485018889034927e714dda2d10/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python判断是否是周末</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>