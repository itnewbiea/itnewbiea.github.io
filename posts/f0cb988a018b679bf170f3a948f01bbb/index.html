<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python学习之定制发送带附件的电子邮件 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python学习之定制发送带附件的电子邮件" />
<meta property="og:description" content="Python SMTP发送邮件
SMTP（Simple Mail Transfer Protocol）即简单邮件传输协议,它是一组用于由源地址到目的地址传送邮件的规则，由它来控制信件的中转方式。python的smtplib提供了一种很方便的途径发送电子邮件。它对smtp协议进行了简单的封装。
Python创建 SMTP 对象语法如下：
import smtplib smtpObj = smtplib.SMTP( [host [, port [, local_hostname]]] ) 参数说明：
host: SMTP 服务器主机。 你可以指定主机的ip地址或者域名如:runoob.com，这个是可选参数。 port: 如果你提供了
host 参数, 你需要指定 SMTP 服务使用的端口号，一般情况下SMTP端口号为25。 local_hostname:
如果SMTP在你的本机上，你只需要指定服务器地址为 localhost 即可。 Python
SMTP对象使用sendmail方法发送邮件，语法如下：
SMTP.sendmail(from_addr, to_addrs, msg[, mail_options, rcpt_options] 参数说明：
from_addr: 邮件发送者地址。 to_addrs: 字符串列表，邮件发送地址。 msg: 发送消息
这里要注意一下第三个参数，msg是字符串，表示邮件。我们知道邮件一般由标题，发信人，收件人，邮件内容，附件等构成，发送邮件的时候，要注意msg的格式。这个格式就是smtp协议中定义的格式。
导入模块如果没有错误，表示已经安装成功。
Python发送带附件的电子邮件基本思路如下：
构造MIMEMultipart对象做为根容器构造MIMEText对象做为邮件显示内容并附加到根容器构造MIMEBase对象做为文件附件内容并附加到根容器
a. 读入文件内容并格式化
b. 设置附件头设置根容器属性得到格式化后的完整文本用smtp发送邮件 import smtplib from email.mime.multipart import MIMEMultipart from email.header import Header from email." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f0cb988a018b679bf170f3a948f01bbb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-03T16:17:14+08:00" />
<meta property="article:modified_time" content="2023-03-03T16:17:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python学习之定制发送带附件的电子邮件</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><strong>Python SMTP发送邮件</strong></p> 
<p>SMTP（Simple Mail Transfer Protocol）即简单邮件传输协议,它是一组用于由源地址到目的地址传送邮件的规则，由它来控制信件的中转方式。python的smtplib提供了一种很方便的途径发送电子邮件。它对smtp协议进行了简单的封装。</p> 
<p>Python创建 SMTP 对象语法如下：</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> smtplib

smtpObj <span class="token operator">=</span> smtplib<span class="token punctuation">.</span>SMTP<span class="token punctuation">(</span> <span class="token punctuation">[</span>host <span class="token punctuation">[</span><span class="token punctuation">,</span> port <span class="token punctuation">[</span><span class="token punctuation">,</span> local_hostname<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">)</span>
</code></pre> 
<blockquote> 
 <p>参数说明：</p> 
 <p>host: SMTP 服务器主机。 你可以指定主机的ip地址或者域名如:runoob.com，这个是可选参数。 port: 如果你提供了<br> host 参数, 你需要指定 SMTP 服务使用的端口号，一般情况下SMTP端口号为25。 local_hostname:<br> 如果SMTP在你的本机上，你只需要指定服务器地址为 localhost 即可。 Python<br> SMTP对象使用sendmail方法发送邮件，语法如下：</p> 
</blockquote> 
<pre><code class="prism language-python">SMTP<span class="token punctuation">.</span>sendmail<span class="token punctuation">(</span>from_addr<span class="token punctuation">,</span> to_addrs<span class="token punctuation">,</span> msg<span class="token punctuation">[</span><span class="token punctuation">,</span> mail_options<span class="token punctuation">,</span> rcpt_options<span class="token punctuation">]</span>
</code></pre> 
<blockquote> 
 <p>参数说明：</p> 
 <p>from_addr: 邮件发送者地址。 to_addrs: 字符串列表，邮件发送地址。 msg: 发送消息</p> 
</blockquote> 
<p>这里要注意一下第三个参数，msg是字符串，表示邮件。我们知道邮件一般由标题，发信人，收件人，邮件内容，附件等构成，发送邮件的时候，要注意msg的格式。这个格式就是smtp协议中定义的格式。</p> 
<p>导入模块如果没有错误，表示已经安装成功。</p> 
<p>Python发送带附件的电子邮件基本思路如下：</p> 
<ol><li>构造MIMEMultipart对象做为根容器</li><li>构造MIMEText对象做为邮件显示内容并附加到根容器</li><li>构造MIMEBase对象做为文件附件内容并附加到根容器<br> 　　a. 读入文件内容并格式化<br> 　　b. 设置附件头</li><li>设置根容器属性</li><li>得到格式化后的完整文本</li><li>用smtp发送邮件</li></ol> 
<pre><code class="prism language-python"><span class="token keyword">import</span> smtplib
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>multipart <span class="token keyword">import</span> MIMEMultipart
<span class="token keyword">from</span> email<span class="token punctuation">.</span>header <span class="token keyword">import</span> Header
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>text <span class="token keyword">import</span> MIMEText
<span class="token keyword">from</span> email<span class="token punctuation">.</span>mime<span class="token punctuation">.</span>application <span class="token keyword">import</span> MIMEApplication
<span class="token keyword">import</span> os

<span class="token comment"># 配置邮箱服务器信息</span>
mail_host <span class="token operator">=</span> <span class="token string">"smtp.qq.com"</span>   <span class="token comment"># 设置服务器</span>
mail_user <span class="token operator">=</span> <span class="token string">"823634900"</span>     <span class="token comment"># 用户名</span>
mail_pass <span class="token operator">=</span> <span class="token string">"gfgwmfbzmutebajc"</span>  <span class="token comment"># 口令是授权码，不是邮箱密码</span>

<span class="token comment"># 配置发件人、收件人信息</span>
sender <span class="token operator">=</span> <span class="token string">'823634900@qq.com'</span> <span class="token comment"># 发件人邮箱</span>
receivers <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'823634900@qq.com'</span><span class="token punctuation">]</span>  <span class="token comment"># 接收邮件，可设置为多个邮箱</span>


<span class="token keyword">def</span> <span class="token function">message_config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    配置邮件信息
    :return: 消息对象
    """</span>
    <span class="token comment"># 第三方 SMTP 服务</span>
    content <span class="token operator">=</span> MIMEText<span class="token punctuation">(</span><span class="token string">'测试数据,注意查收'</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> MIMEMultipart<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 多个MIME对象</span>
    message<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>content<span class="token punctuation">)</span>  <span class="token comment"># 添加内容</span>
    message<span class="token punctuation">[</span><span class="token string">'From'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token string">"白云"</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token comment"># 发件人</span>
    message<span class="token punctuation">[</span><span class="token string">'To'</span><span class="token punctuation">]</span>   <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token string">"黑土"</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>  <span class="token comment"># 收件人</span>
    message<span class="token punctuation">[</span><span class="token string">'Subject'</span><span class="token punctuation">]</span> <span class="token operator">=</span> Header<span class="token punctuation">(</span><span class="token string">'测试数据'</span><span class="token punctuation">,</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token comment"># 主题</span>
    <span class="token comment"># 添加Excel类型附件</span>
    file_name <span class="token operator">=</span> <span class="token string">'output.xlsx'</span> <span class="token comment"># 文件名</span>
    file_path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>file_name<span class="token punctuation">)</span>        <span class="token comment"># 文件路径</span>
    xlsx <span class="token operator">=</span> MIMEApplication<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span>file_path<span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 打开Excel,读取Excel文件</span>
    xlsx<span class="token punctuation">[</span><span class="token string">"Content-Type"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'application/octet-stream'</span>     <span class="token comment"># 设置内容类型</span>
    xlsx<span class="token punctuation">.</span>add_header<span class="token punctuation">(</span><span class="token string">'Content-Disposition'</span><span class="token punctuation">,</span> <span class="token string">'attachment'</span><span class="token punctuation">,</span> filename<span class="token operator">=</span>file_name<span class="token punctuation">)</span> <span class="token comment"># 添加到header信息</span>
    message<span class="token punctuation">.</span>attach<span class="token punctuation">(</span>xlsx<span class="token punctuation">)</span>
	<span class="token comment"># jpg类型的附件</span>
    <span class="token comment">#jpgpart = MIMEApplication(open('beauty.jpg', 'rb').read())</span>
    <span class="token comment">#jpgpart.add_header('Content-Disposition', 'attachment', filename='beauty.jpg')</span>
    <span class="token comment">#message.attach(jpgpart)</span>

    <span class="token comment"># mp3类型的附件</span>
    <span class="token comment">#mp3part = MIMEApplication(open('kenny.mp3', 'rb').read())</span>
    <span class="token comment">#mp3part.add_header('Content-Disposition', 'attachment', filename='kenny.mp3')</span>
    <span class="token comment">#message.attach(mp3part)</span>
 
    <span class="token comment"># pdf类型附件</span>
    <span class="token comment">#part = MIMEApplication(open('foo.pdf', 'rb').read())</span>
    <span class="token comment">#part.add_header('Content-Disposition', 'attachment', filename="foo.pdf")</span>
    <span class="token comment">#message.attach(part)</span>
    
    <span class="token keyword">return</span> message
    

<span class="token keyword">def</span> <span class="token function">send_mail</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    发送邮件
    :param message: 消息对象
    :return: None
    """</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        smtpObj <span class="token operator">=</span> smtplib<span class="token punctuation">.</span>SMTP_SSL<span class="token punctuation">(</span>mail_host<span class="token punctuation">)</span> <span class="token comment"># 使用SSL连接邮箱服务器</span>
        smtpObj<span class="token punctuation">.</span>login<span class="token punctuation">(</span>mail_user<span class="token punctuation">,</span> mail_pass<span class="token punctuation">)</span>   <span class="token comment"># 登录服务器</span>
        smtpObj<span class="token punctuation">.</span>sendmail<span class="token punctuation">(</span>sender<span class="token punctuation">,</span> receivers<span class="token punctuation">,</span> message<span class="token punctuation">.</span>as_string<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment"># 发送邮件</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"邮件发送成功"</span><span class="token punctuation">)</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>

<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"开始执行"</span><span class="token punctuation">)</span>
    message <span class="token operator">=</span> message_config<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># 调用配置方法</span>
    send_mail<span class="token punctuation">(</span>message<span class="token punctuation">)</span>         <span class="token comment"># 发送邮件</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"执行结束"</span><span class="token punctuation">)</span>

</code></pre> 
<p>相信看到535报错的同学代码编写方面都没有问题，只是不明白为什么填写了帐号密码后还是报535错误，这里我以163和QQ邮箱为例,并使用Python讲解怎么解决535问题<br> 关于发邮件报错535 Error：authentication failed解决方法：</p> 
<blockquote> 
 <p>报错：535, b’Login Fail. Please enter your authorization code to login.</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/17/65/gTIx6i5L_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/90/af/SHmOpC83_o.png" alt="在这里插入图片描述"><br> <strong>解决办法:</strong></p> 
<p>调用邮箱服务器来发送邮件,我们需要开启POP3/SMTP服务,这时需要我们设置客户端授权码，这个授权码替代上面代码部分的mail_pass 即可成功发送邮件</p> 
<p>参考文献：<a href="https://www.runoob.com/python3/python3-smtp.html" rel="nofollow">Python3 SMTP发送邮件</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/78973f4e163a059b9969f47f3698d755/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android NestedScrollView嵌套RecyclerView滑动卡顿问题终极解决方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/260f527142d39767a4025f070527106a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【问题及解决】训练一段时间卡住GPU Memory Usage满但是GPU-Util 是0%</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>