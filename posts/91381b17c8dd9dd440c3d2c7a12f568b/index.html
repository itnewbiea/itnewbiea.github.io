<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>c语言向ini文件写入数据,C语言实现 读取写入ini文件实现(转) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="c语言向ini文件写入数据,C语言实现 读取写入ini文件实现(转)" />
<meta property="og:description" content="#include #include
/** 函数名： GetIniKeyString
* 入口参数： title
* 配置文件中一组数据的标识
* key
* 这组数据中要读出的值的标识
* filename
* 要读取的文件路径
* 返回值： 找到需要查的值则返回正确结果
* 否则返回NULL*/
char *GetIniKeyString(char *title,char *key,char *filename)
{
FILE*fp;int flag = 0;char sTitle[32], *wTmp;static char sLine[1024];
sprintf(sTitle,&#34;[%s]&#34;, title);if(NULL == (fp = fopen(filename, &#34;r&#34;))) {
perror(&#34;fopen&#34;);returnNULL;
}while (NULL != fgets(sLine, 1024, fp)) {//这是注释行
if (0 == strncmp(&#34;//&#34;, sLine, 2)) continue;if (‘#‘ == sLine[0]) continue;
wTmp= strchr(sLine, ‘=‘);if ((NULL != wTmp) &amp;&amp; (1 ==flag)) {if (0 == strncmp(key, sLine, wTmp-sLine)) { //长度依文件读取的为准" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/91381b17c8dd9dd440c3d2c7a12f568b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-25T02:08:06+08:00" />
<meta property="article:modified_time" content="2021-05-25T02:08:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">c语言向ini文件写入数据,C语言实现 读取写入ini文件实现(转)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>#include #include</p> 
 <p>/** 函数名： GetIniKeyString</p> 
 <p>* 入口参数： title</p> 
 <p>* 配置文件中一组数据的标识</p> 
 <p>* key</p> 
 <p>* 这组数据中要读出的值的标识</p> 
 <p>* filename</p> 
 <p>* 要读取的文件路径</p> 
 <p>* 返回值： 找到需要查的值则返回正确结果</p> 
 <p>* 否则返回NULL*/</p> 
 <p>char *GetIniKeyString(char *title,char *key,char *filename)</p> 
 <p>{<!-- --></p> 
 <p>FILE*fp;int flag = 0;char sTitle[32], *wTmp;static char sLine[1024];</p> 
 <p>sprintf(sTitle,"[%s]", title);if(NULL == (fp = fopen(filename, "r"))) {<!-- --></p> 
 <p>perror("fopen");returnNULL;</p> 
 <p>}while (NULL != fgets(sLine, 1024, fp)) {//这是注释行</p> 
 <p>if (0 == strncmp("//", sLine, 2)) continue;if (‘#‘ == sLine[0]) continue;</p> 
 <p>wTmp= strchr(sLine, ‘=‘);if ((NULL != wTmp) &amp;&amp; (1 ==flag)) {if (0 == strncmp(key, sLine, wTmp-sLine)) { //长度依文件读取的为准</p> 
 <p>sLine[strlen(sLine) - 1] = ‘\0‘;</p> 
 <p>fclose(fp);return wTmp + 1;</p> 
 <p>}</p> 
 <p>}else{if (0 == strncmp(sTitle, sLine, strlen(sLine) - 1)) { //长度依文件读取的为准</p> 
 <p>flag = 1; //找到标题位置</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>fclose(fp);returnNULL;</p> 
 <p>}/** 函数名： GetIniKeyInt</p> 
 <p>* 入口参数： title</p> 
 <p>* 配置文件中一组数据的标识</p> 
 <p>* key</p> 
 <p>* 这组数据中要读出的值的标识</p> 
 <p>* filename</p> 
 <p>* 要读取的文件路径</p> 
 <p>* 返回值： 找到需要查的值则返回正确结果</p> 
 <p>* 否则返回NULL*/</p> 
 <p>int GetIniKeyInt(char *title,char *key,char *filename)</p> 
 <p>{returnatoi(GetIniKeyString(title, key, filename));</p> 
 <p>}/** 函数名： PutIniKeyString</p> 
 <p>* 入口参数： title</p> 
 <p>* 配置文件中一组数据的标识</p> 
 <p>* key</p> 
 <p>* 这组数据中要读出的值的标识</p> 
 <p>* val</p> 
 <p>* 更改后的值</p> 
 <p>* filename</p> 
 <p>* 要读取的文件路径</p> 
 <p>* 返回值： 成功返回 0</p> 
 <p>* 否则返回 -1*/</p> 
 <p>int PutIniKeyString(char *title,char *key,char *val,char *filename)</p> 
 <p>{<!-- --></p> 
 <p>FILE*fpr, *fpw;int flag = 0;char sLine[1024], sTitle[32], *wTmp;</p> 
 <p>sprintf(sTitle,"[%s]", title);if (NULL == (fpr = fopen(filename, "r")))</p> 
 <p>PRN_ERRMSG_RETURN("fopen");//读取原文件</p> 
 <p>sprintf(sLine, "%s.tmp", filename);if (NULL == (fpw = fopen(sLine, "w")))</p> 
 <p>PRN_ERRMSG_RETURN("fopen");//写入临时文件</p> 
 <p>while (NULL != fgets(sLine, 1024, fpr)) {if (2 != flag) { //如果找到要修改的那一行，则不会执行内部的操作</p> 
 <p>wTmp = strchr(sLine, ‘=‘);if ((NULL != wTmp) &amp;&amp; (1 ==flag)) {if (0 == strncmp(key, sLine, wTmp-sLine)) { //长度依文件读取的为准</p> 
 <p>flag = 2;//更改值，方便写入文件</p> 
 <p>sprintf(wTmp + 1, "%s\n", val);</p> 
 <p>}</p> 
 <p>}else{if (0 == strncmp(sTitle, sLine, strlen(sLine) - 1)) { //长度依文件读取的为准</p> 
 <p>flag = 1; //找到标题位置</p> 
 <p>}</p> 
 <p>}</p> 
 <p>}</p> 
 <p>fputs(sLine, fpw);//写入临时文件</p> 
 <p>}</p> 
 <p>fclose(fpr);</p> 
 <p>fclose(fpw);</p> 
 <p>sprintf(sLine,"%s.tmp", filename);return rename(sLine, filename);//将临时文件更新到原文件</p> 
 <p>}/** 函数名： PutIniKeyString</p> 
 <p>* 入口参数： title</p> 
 <p>* 配置文件中一组数据的标识</p> 
 <p>* key</p> 
 <p>* 这组数据中要读出的值的标识</p> 
 <p>* val</p> 
 <p>* 更改后的值</p> 
 <p>* filename</p> 
 <p>* 要读取的文件路径</p> 
 <p>* 返回值： 成功返回 0</p> 
 <p>* 否则返回 -1*/</p> 
 <p>int PutIniKeyInt(char *title,char *key,int val,char *filename)</p> 
 <p>{char sVal[32];</p> 
 <p>sprintf(sVal,"%d", val);returnPutIniKeyString(title, key, sVal, filename);</p> 
 <p>}int main(int argc,char *argv[])</p> 
 <p>{<!-- --></p> 
 <p>printf("%s\n", GetIniKeyString("DOG", "name", "config.ini"));</p> 
 <p>printf("%d\n", GetIniKeyInt("DOG", "age", "config.ini"));</p> 
 <p>PutIniKeyString("CAT", "name", "ccc", "config.ini");</p> 
 <p>PutIniKeyInt("DOG", "age", 56, "config.ini");return 0;</p> 
 <p>}</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/ff5af6801a3a0e0c1e742c9744e22b42/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">了解python之面向对象</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/036b6e5453a3fedf4d3814b550a841e5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SPN用三个队列C语言,SPN-DES-AES算法原理与应用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>