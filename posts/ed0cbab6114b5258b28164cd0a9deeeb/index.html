<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>精心总结十三条建议，帮你创建更合适的MySQL索引 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="精心总结十三条建议，帮你创建更合适的MySQL索引" />
<meta property="og:description" content="上篇文章讲到使用MySQL的Explain命令可以分析SQL性能瓶颈，优化SQL查询，以及查看是否用到了索引。
我们都知道创建索引可以提高查询效率，但是具体该怎么创建索引？
哪些字段适合创建索引？
哪些字段又不适合创建索引？
本文跟大家一块学习一下如何创建合适数据库索引。
1. MySQL索引的分类 在创建索引之前了解一下MySQL有哪些索引，然后我们才能选择合适的索引。
常见的索引有，普通索引、唯一索引、主键索引、联合索引、全文索引等。
普通索引 普通索引就是最基本的索引，没有任何限制。
可以使用命令创建普通索引：
ALTER TABLE `table_name` ADD INDEX index_name (`column`); 唯一索引 与普通索引不同，唯一索引的列值必须唯一，允许为null。
创建方式是这样的：
ALTER TABLE `table_name` ADD UNIQUE index_name (`column`); 主键索引 主键索引是一种特殊的唯一索引，并且一张表只有一个主键，不允许为null。
创建方式是这样的：
ALTER TABLE `table_name` ADD PRIMARY KEY (`column`); 联合索引 联合索引是同时在多个字段上创建索引，查询效率更高。
创建方式是这样的：
ALTER TABLE `table_name` ADD INDEX index_name (`column1`, `column2`, `column3`); 全文索引 全文索引主要用来匹配字符串文本中关键字。
当需要字符串中是否包含关键字的时候，我们一般用like，如果是以%开头的时候，则无法用到索引，这时候就可以使用全文索引了。
创建方式是这样的：
ALTER TABLE `table_name` ADD FULLTEXT (`column`); 2. 哪些字段适合创建索引？ 我总结了有以下几条：
2.1 频繁查询的字段适合创建索引 一张表的字段总会有冷热之分，很明显那些频繁使用的字段更适合为它创建索引。
2.2 在where和on条件出现的字段优先创建索引 为什么不是在select后面出现的字段优先创建索引？" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ed0cbab6114b5258b28164cd0a9deeeb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-20T11:10:52+08:00" />
<meta property="article:modified_time" content="2023-04-20T11:10:52+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">精心总结十三条建议，帮你创建更合适的MySQL索引</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>上篇文章讲到使用MySQL的Explain命令可以分析SQL性能瓶颈，优化SQL查询，以及查看是否用到了索引。</p> 
<p>我们都知道创建索引可以提高查询效率，但是具体该怎么创建索引？</p> 
<p>哪些字段适合创建索引？</p> 
<p>哪些字段又不适合创建索引？</p> 
<p>本文跟大家一块学习一下如何创建合适数据库索引。</p> 
<h2>1. MySQL索引的分类</h2> 
<p>在创建索引之前了解一下MySQL有哪些索引，然后我们才能选择合适的索引。</p> 
<p>常见的索引有，普通索引、唯一索引、主键索引、联合索引、全文索引等。</p> 
<h2>普通索引</h2> 
<p>普通索引就是最基本的索引，没有任何限制。</p> 
<p>可以使用命令创建普通索引：</p> 
<pre><code>ALTER TABLE `table_name` ADD INDEX index_name (`column`);</code></pre> 
<h2>唯一索引</h2> 
<p>与普通索引不同，唯一索引的列值必须唯一，允许为null。</p> 
<p>创建方式是这样的：</p> 
<pre><code>ALTER TABLE `table_name` ADD UNIQUE index_name (`column`);</code></pre> 
<h2>主键索引</h2> 
<p>主键索引是一种特殊的唯一索引，并且一张表只有一个主键，不允许为null。</p> 
<p>创建方式是这样的：</p> 
<pre><code>ALTER TABLE `table_name` ADD PRIMARY KEY (`column`);</code></pre> 
<h2>联合索引</h2> 
<p>联合索引是同时在多个字段上创建索引，查询效率更高。</p> 
<p>创建方式是这样的：</p> 
<pre><code>ALTER TABLE `table_name` ADD INDEX index_name (`column1`, `column2`, `column3`);</code></pre> 
<h2>全文索引</h2> 
<p>全文索引主要用来匹配字符串文本中关键字。</p> 
<p>当需要字符串中是否包含关键字的时候，我们一般用like，如果是以%开头的时候，则无法用到索引，这时候就可以使用全文索引了。</p> 
<p>创建方式是这样的：</p> 
<pre><code>ALTER TABLE `table_name` ADD FULLTEXT (`column`);</code></pre> 
<h2>2. 哪些字段适合创建索引？</h2> 
<p>我总结了有以下几条：</p> 
<h2>2.1 频繁查询的字段适合创建索引</h2> 
<p>一张表的字段总会有冷热之分，很明显那些频繁使用的字段更适合为它创建索引。</p> 
<h2>2.2 在where和on条件出现的字段优先创建索引</h2> 
<p>为什么不是在select后面出现的字段优先创建索引？</p> 
<p>因为查询SQL会先匹配on和where条件的字段，具体的匹配顺序是这样的：</p> 
<blockquote> 
 <p>from &gt; on &gt; join &gt; where &gt; group by &gt; having &gt; select &gt; distinct &gt; order by &gt; limit</p> 
</blockquote> 
<h2>2.3 区分度高的字段适合创建索引</h2> 
<p>比如对于一张用户表来说，生日比性别的区分度更高，更适合创建索引。</p> 
<p>可以使用下面的方式手动统计一下，每个字段的区分度，值越大，区分度越高：</p> 
<pre><code>select 
    count(distinct birthday)/count(*), 
    count(distinct gender)/count(*) 
from user;</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/14/0d/j3o8mJvp_o.png"></p> 
<p> </p> 
<p></p> 
<p>对于已经创建好的索引，我们还可以使用MySQL命令查看每个索引的区分度排名：</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/94/ae/X7AEbQCp_o.png"></p> 
<p></p> 
<p>图中<strong>Cardinality</strong>列表示索引的区分度排名，也被称为基数。</p> 
<h2>2.4 有序的字段适合创建索引</h2> 
<p>有序的字段在插入数据库的过程中，仍能保持B+树的索引结构，不需要频繁更新索引文件，性能更好。</p> 
<h2>3. 哪些字段不合适创建索引？</h2> 
<p>说完哪些字段适合创建索引，就有不适合创建索引的的字段。</p> 
<h2>3.1 区分度低的字段不适合创建索引。</h2> 
<p>刚才说了用户表中性别的区分度较低，不如生日字段适合创建索引。</p> 
<h2>3.2 频繁更新的字段不适合创建索引</h2> 
<p>更新字段的过程中，需要维护B+树结构，会频繁更新索引文件，降低SQL性能。</p> 
<h2>3.3 过长的字段不适合创建索引</h2> 
<p>过长的字段会占用更多的空间，不适合创建索引。</p> 
<h2>3.4 无序的字段不适合创建索引</h2> 
<p>无序的字段在插入数据库的过程中，为了维护B+树索引结构，需要频繁更新索引文件，性能较差。</p> 
<h2>4. 创建索引的其他注意事项</h2> 
<h2>4.1 优先使用联合索引</h2> 
<p>查询的时候，联合索引比普通索引能更精准地匹配到所需数据。</p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/14/78/oSeGuXRz_o.png"></p> 
<p></p> 
<p>图中就是在（age，name）两个字段上建立的联合索引，在B+树中的存储结构。</p> 
<p>可以看出，是先age排序，age相等的数据，再按name排序。</p> 
<p>对于这条查询SQL：</p> 
<pre><code>select age,name from user where age=18 and name='李四';</code></pre> 
<p>联合索引只需一次就可以查到所需数据，如果我们只在age字段上建立索引，会先匹配到age=18的三条数据，然后再逐个遍历，效率更差，所以平时应该优先使用联合索引。</p> 
<h2>4.2 使用联合索引时，区分度的字段放前面</h2> 
<p>这样可以减少查询次数，更快地匹配到所需数据。</p> 
<h2>4.3 过长字符串可以使用前缀索引</h2> 
<p>比如在匹配用户地址的时候，如果乡镇已经能区分大部分用户了，就没必要精确到街道小区了。</p> 
<p>创建普通索引的时候，指定索引长度，就可以创建前缀索引了。</p> 
<pre><code>ALTER TABLE `user` ADD INDEX idx_address (address(3));</code></pre> 
<h2>4.4 值唯一的字段，使用唯一索引</h2> 
<p>使用唯一索引，可以避免程序bug导致产生重复数据。</p> 
<h2>4.5 排序和分组字段也尽量创建索引</h2> 
<p>在order by和group by中的字段也尽量创建索引，避免使用文件排序，可以使用索引排序提供性能。</p> 
<h2>4.6 避免创建过多索引</h2> 
<p>索引好用，适度即可。创建过多的索引，会占用更多存储空间，也会严重影响SQL性能，每次更新SQL，都需要更新大量索引文件，得不偿失。</p> 
<h2>知识点总结：</h2> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/24/51/ijZR3Hgp_o.png"></p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/67bd3c035a30adeeafc467d7a2f6bf22/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">服务器最全安装、配置、启动HBase集群</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c71396e390c0965785f40e5429abb805/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【小程序】手动实现switch开关中带文字效果（开关左右文字相同/不同都可以）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>