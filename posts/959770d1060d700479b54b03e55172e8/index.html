<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用Docker运行Jenkins容器，并构建Maven项目，自动部署 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用Docker运行Jenkins容器，并构建Maven项目，自动部署" />
<meta property="og:description" content="准备Docker环境： Linux安装Docker（Centos）_Broad sky的博客-CSDN博客
安装JDK、Maven、Git 1.安装JDK:
官网下载地址: Java Downloads | Oracle 中国
# 解压缩 sudo tar -zxvf jdk-8u361-linux-x64.tar.gz # 配置环境变量 vi /etc/profile # 在文件最后插入下面这段 JAVA_HOME=/usr/local/java/jdk1.8.0_361 PATH=$JAVA_HOME/bin:$PATH export JAVA_HOME PATH # 保存退出后重新加载配置 source /etc/profile # 测试 java -version 1.安装maven:
重点：maven去官网下载后扔到服务器解压，用这种方式安装。不要用yum的方式安装，挂载到jenkins容器会不识别！！！重要的事情说三遍：
Maven不要用yum的方式安装，挂载到jenkins容器会不识别！！！
Maven不要用yum的方式安装，挂载到jenkins容器会不识别！！！
Maven不要用yum的方式安装，挂载到jenkins容器会不识别！！！
Maven官网：Maven – Download Apache Maven
# 解压缩，一般放在/usr/local/maven下 sudo tar -zxvf apache-maven-3.9.0-bin.tar.gz # 配置环境变量 vi /etc/profile # 在文件最后插入下面这段 MAVEN_HOME=/usr/local/maven/apache-maven-3.9.0 PATH=$MAVEN_HOME/bin:$PATH export MAVEN_HOME PATH # 保存退出后重新加载配置 source /etc/profile # 测试 mvn -v maven配置文件这里不多赘述，推荐把依赖库设置在apache-maven-3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/959770d1060d700479b54b03e55172e8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-11T20:22:11+08:00" />
<meta property="article:modified_time" content="2023-03-11T20:22:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用Docker运行Jenkins容器，并构建Maven项目，自动部署</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <ul><li> <h2><span style="color:#1c7331;">准备Docker环境：</span></h2> </li></ul> 
<p><a href="https://blog.csdn.net/weixin_43531744/article/details/129341799?spm=1001.2014.3001.5501" title="Linux安装Docker（Centos）_Broad sky的博客-CSDN博客">Linux安装Docker（Centos）_Broad sky的博客-CSDN博客</a></p> 
<ul><li> <h3><strong><span style="color:#1c7331;">安装JDK、Maven、Git</span></strong></h3> </li></ul> 
<p>1.安装JDK:</p> 
<p>官网下载地址: <a href="https://www.oracle.com/cn/java/technologies/downloads/" rel="nofollow" title="Java Downloads | Oracle 中国">Java Downloads | Oracle 中国</a></p> 
<pre><code># 解压缩
sudo tar -zxvf jdk-8u361-linux-x64.tar.gz

# 配置环境变量
vi /etc/profile

# 在文件最后插入下面这段
JAVA_HOME=/usr/local/java/jdk1.8.0_361
PATH=$JAVA_HOME/bin:$PATH
export JAVA_HOME PATH

# 保存退出后重新加载配置
source /etc/profile

# 测试
java -version</code></pre> 
<p>1.安装maven:</p> 
<p><span style="color:#fe2c24;">重点：maven去官网下载后扔到服务器解压，用这种方式安装。不要用yum的方式安装，挂载到jenkins容器会不识别！！！重要的事情说三遍：</span></p> 
<p>Maven不要用yum的方式安装，挂载到jenkins容器会不识别！！！</p> 
<p>Maven不要用yum的方式安装，挂载到jenkins容器会不识别！！！</p> 
<p>Maven不要用yum的方式安装，挂载到jenkins容器会不识别！！！</p> 
<p>Maven官网：<a href="https://maven.apache.org/download.cgi" rel="nofollow" title="Maven – Download Apache Maven">Maven – Download Apache Maven</a></p> 
<pre><code># 解压缩，一般放在/usr/local/maven下
sudo tar -zxvf apache-maven-3.9.0-bin.tar.gz 

# 配置环境变量
vi /etc/profile

# 在文件最后插入下面这段
MAVEN_HOME=/usr/local/maven/apache-maven-3.9.0
PATH=$MAVEN_HOME/bin:$PATH
export MAVEN_HOME PATH

# 保存退出后重新加载配置
source /etc/profile

# 测试
mvn -v</code></pre> 
<p> maven配置文件这里不多赘述，推荐把依赖库设置在apache-maven-3.9.0目录下，即挂载到容器的目录下，这样可以避免容器移除后，新启动的jenkins容器还需要重新下载依赖的情况。</p> 
<p>2.安装Git:        </p> 
<pre><code>sudo yum install -y git</code></pre> 
<p>git无所谓了，想怎么按怎么按，有就行，按完甚至不用在jenkins里配置。</p> 
<p>3.安装JDK：        jenkins镜像中会自带openjdk，但是一般是11的，强制需要jdk8的请降低镜像版本。</p> 
<ul><li> <h2><span style="color:#1c7331;">启动Jenkins容器</span></h2> </li></ul> 
<pre><code>docker run \
  -u root \
  --restart=always \
  -d \
  -p 5343:8080 \
  -p 50000:50000 \
  -v /usr/local/jenkins-data:/var/jenkins_home \
  -v /var/run/docker.sock:/var/run/docker.sock \
  -v /usr/local/maven/apache-maven-3.9.0:/usr/local/maven \
  --name jenkins \
jenkins/jenkins:lts</code></pre> 
<p><strong><span style="color:#1c7892;">参数解释</span></strong></p> 
<p><span style="color:#1c7892;">-u root </span>       获取容器root权限；</p> 
<p><span style="color:#1c7892;">--restart=always </span><span style="color:#1c7331;">        </span>（可选）docker启动时，容器自动重启；</p> 
<p><span style="color:#1c7892;">-d</span>                后台运行；</p> 
<p><span style="color:#1c7892;">-p 5343:8080</span>               映射（例如“发布”）jenkinsci/blueocean 容器的端口8080到主机上的端口8080。 第一个数字代表主机上的端口，而最后一个代表容器的端口。因此，如果您为此选项指定 -p 49000:8080 ，您将通过端口49000访问主机上的Jenkins。</p> 
<p><span style="color:#1c7892;">-p 50000:50000 </span>           （可选）将 jenkinsci/blueocean 容器的端口50000 映射到主机上的端口50000。 如果您在其他机器上设置了一个或多个基于JNLP的Jenkins代理程序，而这些代理程序又与 jenkinsci/blueocean 容器交互（充当“主”Jenkins服务器，或者简称为“Jenkins主”）， 则这是必需的。默认情况下，基于JNLP的Jenkins代理通过TCP端口50000与Jenkins主站进行通信。 您可以通过“ 配置全局安全性” 页面更改Jenkins主服务器上的端口号。如果您要将您的Jenkins主机的JNLP代理端口的TCP端口 值更改为51000（例如），那么您需要重新运行Jenkins（通过此 docker run …​命令）并指定此“发布”选项 -p 52000:51000，其中最后一个值与Jenkins master上的这个更改值相匹配，第一个值是Jenkins主机的主机上的端口号， 通过它，基于JNLP的Jenkins代理与Jenkins主机进行通信 - 例如52000。</p> 
<p><span style="color:#1c7892;">-v /usr/local/jenkins-data:/var/jenkins_home</span>（可选，但强烈建议）映射在容器中的`/var/jenkins_home` 目录到具有名字 jenkins-data 的volume。 如果这个卷不存在，那么这个 docker run 命令会自动为你创建卷。 如果您希望每次重新启动Jenkins（通过此 docker run ... 命令）时保持Jenkins状态，则此选项是必需的 。 如果你没有指定这个选项，那么在每次重新启动后，Jenkins将有效地重置为新的实例。<br> 注意: 所述的 jenkins-data 卷也可以 docker volume create命令创建： docker volume create jenkins-data 代替映射 /var/jenkins_home 目录转换为Docker卷，还 可以将此目录映射到计算机本地文件系统上的目录。 例如，指定该选项 -v $HOME/jenkins:/var/jenkins_home 会将容器的 /var/jenkins_home 目录映射 到 本地计算机上目录中的 jenkins 子目录， 该$HOME目录通常是 /Users/&lt;your-username&gt;/jenkins 或`/home/&lt;your-username&gt;/jenkins` 。</p> 
<p><span style="color:#1c7892;">-v /var/run/docker.sock:/var/run/docker.sock</span>（可选 /var/run/docker.sock 表示Docker守护程序通过其监听的基于Unix的套接字。 该映射允许 jenkinsci/blueocean 容器与Docker守护进程通信， 如果 jenkinsci/blueocean 容器需要实例化其他Docker容器，则该守护进程是必需的。 如果运行声明式管道，其语法包含agent部分用 docker<br> 例如， agent { docker { ... } } 此选项是必需的。 在Pipeline Syntax 页面上阅读更多关于这个的信息 。</p> 
<p><span style="color:#1c7892;">-v /usr/local/maven/apache-maven-3.9.0:/usr/local/maven  </span>将宿主机的maven目录映射到容器内。</p> 
<p><span style="color:#1c7892;">--name jenkins </span>容器名称：jenkins</p> 
<p><span style="color:#1c7892;">jenkins/jenkins:lts  </span><span style="color:#0d0016;">以长期支持维护版的jenkins镜像启动。笔者下载该镜像时，镜像的java环境已经升到了jdk11，也就是启动后容器内会自带openjdk11。国内项目基本使用的是jdk8，用jdk11构建项目可能会有问题。如果出现构建问题，则需要降低版本到使用jdk8的jenkins镜像。但大部分项目应该是兼容的。</span></p> 
<p></p> 
<ul><li> <h2><span style="color:#1c7331;">初始密码查看</span></h2> </li></ul> 
<p>        启动容器后，输入ip端口进入jenkins页面，这里可能需要等待一小会，jenkins项目完全启动需要一些时间。之后进入页面会<span style="color:#be191c;">需要初始密码</span>。这里回到shell页面，<span style="color:#be191c;">执行docker logs jenkins，查看docker容器日志，获得初始密码</span>。实在弄不明白查看官方文档：<a href="https://www.jenkins.io/zh/doc/book/installing/" rel="nofollow" title="安装Jenkins">安装Jenkins</a></p> 
<p>        之后会进行一些Jenkins初始配置，安装插件时推荐选择新手插件安装，其他的不多赘述，随意即可。</p> 
<p></p> 
<ul><li> <h2><span style="color:#1c7331;">安装插件</span></h2> </li></ul> 
<p>Dashboard-&gt;系统管理-&gt;插件管理-&gt;可选插件</p> 
<p>搜索并安装这三个插件：Maven、Publish Over SSH、Gitee</p> 
<p><img alt="" height="1038" src="https://images2.imgbox.com/d4/75/ejNvMx2n_o.png" width="1200"></p> 
<p></p> 
<p><img alt="" height="769" src="https://images2.imgbox.com/27/34/qarDYPhF_o.png" width="1200"></p> 
<p><img alt="" height="958" src="https://images2.imgbox.com/29/7d/MqsMcuGt_o.png" width="1200"></p> 
<p></p> 
<p>安装细节不多赘述，不太清楚的请自行百度。</p> 
<p></p> 
<ul><li> <h2><span style="color:#1c7331;">配置插件</span></h2> </li></ul> 
<p> Dashboard-&gt;系统管理-&gt;系统配置</p> 
<p></p> 
<p>首先是Gitee插件配置</p> 
<p><img alt="" height="853" src="https://images2.imgbox.com/30/e2/NIB2sQt0_o.jpg" width="1200"></p> 
<p><img alt="" height="1000" src="https://images2.imgbox.com/7c/18/z8YclCkA_o.jpg" width="1200"></p> 
<p></p> 
<p>Publish over SSH 插件配置</p> 
<p><img alt="" height="1113" src="https://images2.imgbox.com/4c/84/4EUDxKsE_o.png" width="1200"></p> 
<p><img alt="" height="853" src="https://images2.imgbox.com/14/7a/umpSziRk_o.png" width="1200"></p> 
<p><img alt="" height="1096" src="https://images2.imgbox.com/b8/2a/0p0qD2LA_o.png" width="1200"></p> 
<p></p> 
<ul><li> <h2><strong><span style="color:#1c7331;"> Jenkins构建项目所需环境配置</span></strong></h2> </li></ul> 
<p>Dashboard-&gt;系统管理-&gt;全局工具配置</p> 
<p>JDK配置</p> 
<p><img alt="" height="590" src="https://images2.imgbox.com/53/0e/tpLo95GV_o.png" width="1200"></p> 
<p></p> 
<p>Maven配置</p> 
<p><img alt="" height="613" src="https://images2.imgbox.com/08/88/tXVrF2al_o.png" width="1200"></p> 
<p></p> 
<ul><li> <h2><span style="color:#1c7331;"> 创建一个maven项目的任务</span></h2> </li></ul> 
<p> Dashboard-&gt;新建任务</p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/a0/cf/95V6nZ45_o.png" width="1200"></p> 
<p> <img alt="" height="973" src="https://images2.imgbox.com/32/f9/5VZwVAtN_o.png" width="1200"></p> 
<p></p> 
<p><span style="color:#b95514;"> 配置代码源</span><img alt="" height="960" src="https://images2.imgbox.com/dc/75/FqMVZHwT_o.png" width="1200"></p> 
<p></p> 
<p><span style="color:#b95514;"> 配置构建前步骤</span></p> 
<p> <img alt="" height="1090" src="https://images2.imgbox.com/66/5b/5YVvp3Cm_o.png" width="1200"></p> 
<p> <img alt="" height="948" src="https://images2.imgbox.com/d8/33/gSUWimqa_o.png" width="1200"></p> 
<p></p> 
<p><span style="color:#b95514;"> 构建配置</span></p> 
<p><img alt="" height="840" src="https://images2.imgbox.com/18/b4/4tugR0D9_o.png" width="1200"></p> 
<p></p> 
<p><span style="color:#ad720d;">配置构建后步骤</span></p> 
<p><img alt="" height="1114" src="https://images2.imgbox.com/23/04/ohSgZ3ia_o.png" width="1200"></p> 
<p> <img alt="" height="1144" src="https://images2.imgbox.com/2b/d3/8Cm6irMp_o.png" width="1200"></p> 
<p><span style="color:#b95514;"> 保存，到这里所有配置工作已经完成。</span></p> 
<p></p> 
<ul><li> <h2><span style="color:#1c7331;">构建项目</span></h2> </li></ul> 
<p> 回到首页，选择进入配置好的项目，点击立即构建</p> 
<p><img alt="" height="815" src="https://images2.imgbox.com/72/ed/8onJW5vw_o.png" width="1200"></p> 
<p><img alt="" height="1200" src="https://images2.imgbox.com/f5/df/vHkEN5rR_o.png" width="1200"></p> 
<p></p> 
<p> PS：刚开始配置肯定会出各种问题，尤其是构建前和构建后那块是重灾区。解决方法是：可以选择一点一点配置，配置一点就测试一点。比如构建前那块，配置一点就构建项目执行一下，看看是不是预期想要的效果。不要配置一堆一起构建，出现问题很难找原因。</p> 
<ul><li> <h2><strong><span style="color:#1c7331;">扩展</span></strong></h2> </li></ul> 
<p>本篇介绍的是最基础的自动构建配置，熟悉之后可以选择配置docker镜像。即每次构建项目，先删除原有docker镜像，再发送文件，根据jar包和dockerfile生成新镜像，并根据新镜像启动容器。思路和本篇介绍的大同小异。</p> 
<p>之后会介绍根据pipeline形式构建任务，这也是大部分企业的选择。该形式更加自由简洁，搭配蓝海UI后使构建过程更加直观。但使用前需要了解pipeline语法。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cc41b30858a1229da2c29108e0ae9ea4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">define，ifndef，endif傻傻分不清</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/60b60f7385c1c9bf40b0baf237905b95/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">在cmd中转到某一目录下及一些命令行操作</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>