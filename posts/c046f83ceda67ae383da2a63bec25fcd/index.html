<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>日志文件自动压缩 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="日志文件自动压缩" />
<meta property="og:description" content="使用 log4j 记录日志，每天0点进行分隔，由于日志文件较大，为节省空间，需要将历史文件自动压缩。需要使用 Apache Extras™ for Apache log4j™ 的 org.apache.log4j.rolling.TimeBasedRollingPolicy 类进行配置。配置如下： &lt;?xml version=&#34;1.0&#34; encoding=&#34;windows-1252&#34;?&gt; &lt;!DOCTYPE log4j:configuration SYSTEM &#34;log4j.dtd&#34; &gt; &lt;log4j:configuration&gt; &lt;!-- Daily Rolling File Appender that compresses old files --&gt; &lt;appender name=&#34;file&#34; class=&#34;org.apache.log4j.rolling.RollingFileAppender&#34; &gt; &lt;param name=&#34;threshold&#34; value=&#34;info&#34;/&gt; &lt;rollingPolicy name=&#34;file&#34; class=&#34;org.apache.log4j.rolling.TimeBasedRollingPolicy&#34;&gt; &lt;param name=&#34;FileNamePattern&#34; value=&#34;${catalina.base}/logs/myapp.log.%d{yyyy-MM-dd}.gz&#34;/&gt; &lt;param name=&#34;ActiveFileName&#34; value=&#34;${catalina.base}/logs/myapp.log&#34;/&gt; &lt;/rollingPolicy&gt; &lt;layout class=&#34;org.apache.log4j.EnhancedPatternLayout&#34; &gt; &lt;param name=&#34;ConversionPattern&#34; value=&#34;%d{ISO8601} %-5p - %-26.26c{1} - %m%n&#34; /&gt; &lt;/layout&gt; &lt;/appender&gt; &lt;root&gt; &lt;priority value=&#34;debug&#34;&gt;&lt;/priority&gt; &lt;appender-ref ref=&#34;file&#34; /&gt; &lt;/root&gt; &lt;/log4j:configuration&gt;另外 logback 有许多优点，用它来实现压缩的配置如下： &lt;?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c046f83ceda67ae383da2a63bec25fcd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-06-12T12:43:17+08:00" />
<meta property="article:modified_time" content="2014-06-12T12:43:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">日志文件自动压缩</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    使用 log4j 记录日志，每天0点进行分隔，由于日志文件较大，为节省空间，需要将历史文件自动压缩。需要使用 Apache Extras™ for Apache log4j™  的 org.apache.log4j.rolling.TimeBasedRollingPolicy 类进行配置。配置如下： 
<pre><code class="language-html">&lt;?xml version="1.0" encoding="windows-1252"?&gt;
&lt;!DOCTYPE log4j:configuration SYSTEM "log4j.dtd" &gt;
&lt;log4j:configuration&gt;
&lt;!-- Daily Rolling File Appender that compresses old files --&gt;
  &lt;appender name="file" class="org.apache.log4j.rolling.RollingFileAppender" &gt;
     &lt;param name="threshold" value="info"/&gt;
     &lt;rollingPolicy name="file"  
                      class="org.apache.log4j.rolling.TimeBasedRollingPolicy"&gt;
        &lt;param name="FileNamePattern" 
               value="${catalina.base}/logs/myapp.log.%d{yyyy-MM-dd}.gz"/&gt;
        &lt;param name="ActiveFileName" value="${catalina.base}/logs/myapp.log"/&gt;
     &lt;/rollingPolicy&gt;
     &lt;layout class="org.apache.log4j.EnhancedPatternLayout" &gt;
        &lt;param name="ConversionPattern" 
               value="%d{ISO8601} %-5p - %-26.26c{1} - %m%n" /&gt;
    &lt;/layout&gt;
  &lt;/appender&gt;

  &lt;root&gt;
    &lt;priority value="debug"&gt;&lt;/priority&gt;
    &lt;appender-ref ref="file" /&gt;
  &lt;/root&gt;
&lt;/log4j:configuration&gt;</code></pre>另外 logback 有许多优点，用它来实现压缩的配置如下： 
<pre><code class="language-html">&lt;?xml version="1.0" encoding="UTF-8"?&gt;
&lt;configuration&gt;
	&lt;appender name="console" class="ch.qos.logback.core.ConsoleAppender"&gt;
		&lt;!-- encoders are assigned the type ch.qos.logback.classic.encoder.PatternLayoutEncoder 
			by default --&gt;
		&lt;encoder&gt;
			&lt;pattern&gt;%d [%thread] %-5level %logger{36} - %msg%n&lt;/pattern&gt;
		&lt;/encoder&gt;
	&lt;/appender&gt;

	&lt;!-- Daily Rolling File Appender that compresses old files --&gt;
	&lt;appender name="file"
		class="ch.qos.logback.core.rolling.RollingFileAppender"&gt;
		&lt;file&gt;log/app.log&lt;/file&gt;
		&lt;rollingPolicy name="file"
			class="ch.qos.logback.core.rolling.TimeBasedRollingPolicy"&gt;
			&lt;fileNamePattern&gt;log/app.%d{yyyy-MM-dd}.log.gz&lt;/fileNamePattern&gt;
		&lt;/rollingPolicy&gt;
		&lt;encoder class="ch.qos.logback.classic.encoder.PatternLayoutEncoder"&gt;
			&lt;pattern&gt;%p [%t] %d %c: %m%n&lt;/pattern&gt;
		&lt;/encoder&gt;
	&lt;/appender&gt;

	&lt;logger name="com.app" level="INFO" /&gt;

	&lt;root level="WARN"&gt;
		&lt;appender-ref ref="console" /&gt;
		&lt;appender-ref ref="file" /&gt;
	&lt;/root&gt;
&lt;/configuration&gt;
</code></pre> 
<br> 参考资料 
<br> [1] Apache Extras™ for Apache log4j™. http://logging.apache.org/log4j/extras/ 
<br> [2] Class TimeBasedRollingPolicy. http://logging.apache.org/log4j/extras/apidocs/org/apache/log4j/rolling/TimeBasedRollingPolicy.html 
<br> [3] Compress Log4j files. http://stackoverflow.com/questions/3329385/compress-log4j-files 
<br> [4] Configuring RollingFileAppender in log4j. http://stackoverflow.com/questions/5117758/configuring-rollingfileappender-in-log4j 
<br> [5] TimeBasedRollingPolicy. http://logback.qos.ch/manual/appenders.html#TimeBasedRollingPolicy 
<br> [6] Class TimeBasedRollingPolicy&lt;E&gt;. http://logback.qos.ch/apidocs/ch/qos/logback/core/rolling/TimeBasedRollingPolicy.html 
<br> [7] slf4j+logback使用. http://blog.csdn.net/longaohun/article/details/6782046 
<br> [8] logback输出多个日志文件. http://blog.csdn.net/kimsoft/article/details/7618421 
<br>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/67618734cd2ad7a97c50a4ee0784b7e8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java调用命令行并获取执行结果</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4a9b8baa782feec213d867699e27900a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JS实现拖动div改变大小</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>