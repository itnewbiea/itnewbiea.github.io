<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>git pre-push hook - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="git pre-push hook" />
<meta property="og:description" content="This article introduces git pre-push hook.
Problem In Lean project, we use a modified version of Google’s C&#43;&#43; style checker. I want to automatically run the checker over the changed files before I push commits to git repositories. This is useful because it prevents me from accidentally pushing the commits which contain style problems.
Solution: git pre-push hook Since git 1.8.2, git introduced pre-push hook which is executed before actual push operation is performed." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/356a6c5fe58ffc04b82d71cdbe3938e2/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-04-24T07:41:00+08:00" />
<meta property="article:modified_time" content="2019-04-24T07:41:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">git pre-push hook</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>This article introduces git pre-push hook.</p> 
 <h2>Problem</h2> 
 <p>In <a href="http://leanprover.net/" rel="nofollow">Lean</a> project, we use a <a href="https://raw.github.com/leodemoura/lean/master/src/cmake/Modules/cpplint.py" rel="nofollow">modified version</a> of <a href="http://google-styleguide.googlecode.com/svn/trunk/cppguide.xml" rel="nofollow">Google’s C++ style checker</a>. I want to automatically run the checker over the changed files before I push commits to git repositories. This is useful because it prevents me from accidentally pushing the commits which contain style problems.</p> 
 <h2>Solution: git pre-push hook</h2> 
 <p>Since <a href="https://github.com/git/git/blob/master/Documentation/RelNotes/1.8.2.txt">git 1.8.2</a>, git introduced pre-push hook which is executed before actual push operation is performed. The following two steps solve the problem.</p> 
 <ul><li>Create <code>&lt;PROJECT_ROOT&gt;/.git/hooks/pre-push</code> file with the following contents:</li></ul> 
 <div class="cnblogs_code"> 
  <pre><span style="color:#008000;">#</span><span style="color:#008000;">!/usr/bin/env bash</span>
IFS=<span style="color:#800000;">'</span> <span style="color:#800000;">'</span><span style="color:#000000;">
DIR</span>=<span style="color:#800000;">"</span><span style="color:#800000;">$( cd </span><span style="color:#800000;">"</span>$( dirname <span style="color:#800000;">"</span><span style="color:#800000;">$0</span><span style="color:#800000;">"</span> )<span style="color:#800000;">"</span><span style="color:#800000;"> &amp;&amp; pwd )</span><span style="color:#800000;">"</span><span style="color:#000000;">
CHECKER</span>=$DIR/../../src/cmake/Modules/<span style="color:#000000;">cpplint.py
</span><span style="color:#0000ff;">while</span><span style="color:#000000;"> read local_ref local_sha remote_ref remote_sha;
do
    CHANGED_FILES</span>=`git diff --name-only $local_sha $remote_sha | grep <span style="color:#800000;">'</span><span style="color:#800000;">\(cpp\|h\)$</span><span style="color:#800000;">'</span><span style="color:#000000;">`
    </span><span style="color:#0000ff;">if</span> [ ! -z <span style="color:#800000;">"</span><span style="color:#800000;">$CHANGED_FILES</span><span style="color:#800000;">"</span> -a <span style="color:#800000;">"</span><span style="color:#800000;">$CHANGED_FILES</span><span style="color:#800000;">"</span> != <span style="color:#800000;">"</span> <span style="color:#800000;">"</span><span style="color:#000000;"> ]; then
        echo $CHANGED_FILES </span>|<span style="color:#000000;"> xargs $CHECKER
        RET</span>=<span style="color:#000000;">$?
        </span><span style="color:#0000ff;">if</span> [ $RET -<span style="color:#000000;">ne 0 ]; then
            echo </span><span style="color:#800000;">"</span><span style="color:#800000;">There is error(s) from style-check. Please fix them before push to the repo.</span><span style="color:#800000;">"</span><span style="color:#000000;">
            exit $RET
        fi
    fi
done
exit 0</span></pre> 
 </div> 
 <ul><li>Give “exec” permission to the file</li></ul> 
 <div class="cnblogs_code"> 
  <pre>chmod +x &lt;PROJECT_ROOT&gt;/.git/hooks/pre-push</pre> 
 </div> 
 <p>Note that you need to change <code>CHECKER</code> variable if you want to use other checkers.</p> 
 <p> </p> 
 <p></p> 
</div> 
<p>转载于:https://www.cnblogs.com/jiu0821/p/10760275.html</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fd6a0a3787c153f161c39b406152ea63/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">OHEM的pytorch代码实现细节</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b104fd9de9f80c599540a8be4ddfbbcf/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">LeetCode349. 两个数组的交集(java)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>