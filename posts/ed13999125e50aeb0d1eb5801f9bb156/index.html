<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx网页优化（隐藏版本号，日志分割，更改进程数，网页压缩，防盗链详 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nginx网页优化（隐藏版本号，日志分割，更改进程数，网页压缩，防盗链详" />
<meta property="og:description" content="目录
一.安装Nginx服务
1.安装Nginx服务
2.编译安装Nginx
3.优化路径
4.添加 Nginx 系统服务
二.隐藏版本号
1.查看版本号
2.隐藏版本号法一
修改主配置文件
3.隐藏版本号法二
修改源码文件，重新编译安装
重新编译安装 三.修改用户与组
四.缓存时间
五.日志切割
六.连接超时
七.更改请求进程数
八.网页压缩
九.防盗链
一.安装Nginx服务 1.安装Nginx服务 [root@localhost ~]# systemctl stop firewalld.service [root@localhost ~]# setenforce 0 [root@localhost ~]# yum -y install pcre-devel zlib-devel gcc gcc-c&#43;&#43; make 2.编译安装Nginx [root@localhost opt]# rz -E rz waiting to receive. [root@localhost opt]# ls nginx-1.12.0.tar.gz [root@localhost opt]# tar zxf nginx-1.12.0.tar.gz [root@localhost opt]# ls nginx-1.12.0 nginx-1.12.0.tar.gz [root@localhost opt]# cd nginx-1." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ed13999125e50aeb0d1eb5801f9bb156/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-13T23:32:02+08:00" />
<meta property="article:modified_time" content="2021-11-13T23:32:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx网页优化（隐藏版本号，日志分割，更改进程数，网页压缩，防盗链详</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80.%E5%AE%89%E8%A3%85Nginx%E6%9C%8D%E5%8A%A1-toc" style="margin-left:0px;"><a href="#%E4%B8%80.%E5%AE%89%E8%A3%85Nginx%E6%9C%8D%E5%8A%A1" rel="nofollow" title="一.安装Nginx服务">一.安装Nginx服务</a></p> 
<p id="1.%E5%AE%89%E8%A3%85Nginx%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#1.%E5%AE%89%E8%A3%85Nginx%E6%9C%8D%E5%8A%A1" rel="nofollow" title="1.安装Nginx服务">1.安装Nginx服务</a></p> 
<p id="2.%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Nginx-toc" style="margin-left:40px;"><a href="#2.%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Nginx" rel="nofollow" title="2.编译安装Nginx">2.编译安装Nginx</a></p> 
<p id="3.%E4%BC%98%E5%8C%96%E8%B7%AF%E5%BE%84-toc" style="margin-left:40px;"><a href="#3.%E4%BC%98%E5%8C%96%E8%B7%AF%E5%BE%84" rel="nofollow" title="3.优化路径">3.优化路径</a></p> 
<p id="5.%E6%B7%BB%E5%8A%A0%20Nginx%20%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1-toc" style="margin-left:40px;"><a href="#5.%E6%B7%BB%E5%8A%A0%20Nginx%20%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1" rel="nofollow" title="4.添加 Nginx 系统服务">4.添加 Nginx 系统服务</a></p> 
<p id="%E4%BA%8C.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7-toc" style="margin-left:0px;"><a href="#%E4%BA%8C.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7" rel="nofollow" title="二.隐藏版本号">二.隐藏版本号</a></p> 
<p id="1.%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC%E5%8F%B7-toc" style="margin-left:40px;"><a href="#1.%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC%E5%8F%B7" rel="nofollow" title="1.查看版本号">1.查看版本号</a></p> 
<p id="2.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7%E6%B3%95%E4%B8%80-toc" style="margin-left:40px;"><a href="#2.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7%E6%B3%95%E4%B8%80" rel="nofollow" title="2.隐藏版本号法一">2.隐藏版本号法一</a></p> 
<p id="%E4%BF%AE%E6%94%B9%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6-toc" style="margin-left:80px;"><a href="#%E4%BF%AE%E6%94%B9%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" rel="nofollow" title="修改主配置文件">修改主配置文件</a></p> 
<p id="3.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7%E6%B3%95%E4%BA%8C-toc" style="margin-left:40px;"><a href="#3.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7%E6%B3%95%E4%BA%8C" rel="nofollow" title="3.隐藏版本号法二">3.隐藏版本号法二</a></p> 
<p id="%E4%BF%AE%E6%94%B9%E6%BA%90%E7%A0%81%E6%96%87%E4%BB%B6%EF%BC%8C%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85-toc" style="margin-left:80px;"><a href="#%E4%BF%AE%E6%94%B9%E6%BA%90%E7%A0%81%E6%96%87%E4%BB%B6%EF%BC%8C%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85" rel="nofollow" title="修改源码文件，重新编译安装">修改源码文件，重新编译安装</a></p> 
<p id="%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%C2%A0-toc" style="margin-left:80px;"><a href="#%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%C2%A0" rel="nofollow" title="重新编译安装 ">重新编译安装 </a></p> 
<p id="%E4%B8%89.%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E4%B8%8E%E7%BB%84-toc" style="margin-left:0px;"><a href="#%E4%B8%89.%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E4%B8%8E%E7%BB%84" rel="nofollow" title="三.修改用户与组">三.修改用户与组</a></p> 
<p id="%E5%9B%9B.%E7%BC%93%E5%AD%98%E6%97%B6%E9%97%B4-toc" style="margin-left:0px;"><a href="#%E5%9B%9B.%E7%BC%93%E5%AD%98%E6%97%B6%E9%97%B4" rel="nofollow" title="四.缓存时间">四.缓存时间</a></p> 
<p id="%E4%BA%94.%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2-toc" style="margin-left:0px;"><a href="#%E4%BA%94.%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2" rel="nofollow" title="五.日志切割">五.日志切割</a></p> 
<p id="%E5%85%AD.%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6-toc" style="margin-left:0px;"><a href="#%E5%85%AD.%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6" rel="nofollow" title="六.连接超时">六.连接超时</a></p> 
<p id="%E4%B8%83.%E6%9B%B4%E6%94%B9%E8%AF%B7%E6%B1%82%E8%BF%9B%E7%A8%8B%E6%95%B0-toc" style="margin-left:0px;"><a href="#%E4%B8%83.%E6%9B%B4%E6%94%B9%E8%AF%B7%E6%B1%82%E8%BF%9B%E7%A8%8B%E6%95%B0" rel="nofollow" title="七.更改请求进程数">七.更改请求进程数</a></p> 
<p id="%E5%85%AB.%E7%BD%91%E9%A1%B5%E5%8E%8B%E7%BC%A9-toc" style="margin-left:0px;"><a href="#%E5%85%AB.%E7%BD%91%E9%A1%B5%E5%8E%8B%E7%BC%A9" rel="nofollow" title="八.网页压缩">八.网页压缩</a></p> 
<p id="%E4%B9%9D.%E9%98%B2%E7%9B%97%E9%93%BE-toc" style="margin-left:0px;"><a href="#%E4%B9%9D.%E9%98%B2%E7%9B%97%E9%93%BE" rel="nofollow" title="九.防盗链">九.防盗链</a></p> 
<hr id="hr-toc"> 
<h2 id="%E4%B8%80.%E5%AE%89%E8%A3%85Nginx%E6%9C%8D%E5%8A%A1">一.安装Nginx服务</h2> 
<h3 id="1.%E5%AE%89%E8%A3%85Nginx%E6%9C%8D%E5%8A%A1">1.安装Nginx服务</h3> 
<p><img alt="" src="https://images2.imgbox.com/c0/5d/09lB17FX_o.png"></p> 
<pre><code class="language-bash">[root@localhost ~]# systemctl stop firewalld.service 
[root@localhost ~]# setenforce 0
[root@localhost ~]# yum -y install pcre-devel zlib-devel gcc gcc-c++ make</code></pre> 
<h3 id="2.%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85Nginx">2.编译安装Nginx</h3> 
<p><img alt="" height="193" src="https://images2.imgbox.com/66/13/oNdNZmi0_o.png" width="958"></p> 
<p><img alt="" src="https://images2.imgbox.com/95/9f/Z2WJYn7i_o.png"><img alt="" src="https://images2.imgbox.com/c5/86/JFplxQiF_o.png"></p> 
<pre><code class="language-bash">[root@localhost opt]# rz -E
rz waiting to receive.
[root@localhost opt]# ls
nginx-1.12.0.tar.gz
[root@localhost opt]# tar zxf nginx-1.12.0.tar.gz 
[root@localhost opt]# ls
nginx-1.12.0  nginx-1.12.0.tar.gz
[root@localhost opt]# cd nginx-1.12.0/
[root@localhost nginx-1.12.0]# ls
auto  CHANGES  CHANGES.ru  conf  configure  contrib  html  LICENSE  man  README  src
[root@localhost nginx-1.12.0]# ./configure \
&gt; --prefix=/usr/local/nginx \
&gt; --user=nginx \
&gt; --group=nginx \
&gt; --with-http_stub_status_module
[root@localhost nginx-1.12.0]# make &amp;&amp; make install -j4</code></pre> 
<h3 id="3.%E4%BC%98%E5%8C%96%E8%B7%AF%E5%BE%84">3.优化路径</h3> 
<p><img alt="" src="https://images2.imgbox.com/57/81/PXp2N68c_o.png"></p> 
<pre><code class="language-bash">[root@localhost nginx-1.12.0]# ln -s /usr/local/nginx/sbin/nginx /usr/local/sbin/</code></pre> 
<h3 id="5.%E6%B7%BB%E5%8A%A0%20Nginx%20%E7%B3%BB%E7%BB%9F%E6%9C%8D%E5%8A%A1">4.添加 Nginx 系统服务</h3> 
<p><img alt="" src="https://images2.imgbox.com/cc/f6/NQtzEBGq_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/30/ba/HFbpmiJ3_o.png"></p> 
<p><img alt="" src="https://images2.imgbox.com/19/49/qtnS3QfR_o.png"></p> 
<pre><code>[root@localhost nginx-1.12.0]# cd /lib/systemd/system
[root@localhost system]# vim nginx.service
[Unit]
Description=nginx
After=network.target
[Service]
Type=forking
PIDFile=/usr/local/nginx/logs/nginx.pid
ExecStart=/usr/local/nginx/sbin/nginx
ExecReload=/usr/bin/kill -s HUP $MAINPID
ExecStop=/usr/bin/kill -s QUIT $MAINPID
PrivateTmp=true
[Install]
WantedBy=multi-user.target
[root@localhost system]# systemctl start nginx.service
[root@localhost system]# systemctl enable nginx.service
Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to /usr/lib/systemd/system/nginx.service.
[root@localhost system]# ss -natp |grep 80
LISTEN     0      128          *:80                       *:*                   users:(("nginx",pid=5117,fd=6),("nginx",pid=5116,fd=6))</code></pre> 
<h2 id="%E4%BA%8C.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7">二.<span style="background-color:#ffffff;">隐藏版本号</span></h2> 
<h3 id="1.%E6%9F%A5%E7%9C%8B%E7%89%88%E6%9C%AC%E5%8F%B7"><span style="background-color:#ffffff;">1.查看版本号</span></h3> 
<p><img alt="" height="193" src="https://images2.imgbox.com/65/d7/8flKFxIJ_o.png" width="961"></p> 
<pre><code class="language-bash">[root@localhost ~]# cd /usr/local/nginx/html
[root@localhost html]# ls
50x.html  index.html
[root@localhost html]# rz -E
rz waiting to receive.
[root@localhost html]# ls
1.jpg  50x.html  index.html</code></pre> 
<p><a href="http://192.168.68.30/1.jpg" rel="nofollow" title="http://192.168.68.30/1.jpg">http://192.168.68.30/1.jpg</a></p> 
<p><img alt="" height="1001" src="https://images2.imgbox.com/b9/14/PZTuivOG_o.png" width="986"></p> 
<p><strong>此时可以查看nginx的版本号和ip地址</strong></p> 
<p><img alt="" height="271" src="https://images2.imgbox.com/5f/ac/pslLDRQ5_o.png" width="964"></p> 
<p><strong>curl -I ＋IP地址也可以查看nginx的版本号 </strong></p> 
<h3 id="2.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7%E6%B3%95%E4%B8%80">2.隐藏版本号法一</h3> 
<h4 id="%E4%BF%AE%E6%94%B9%E4%B8%BB%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6">修改主配置文件</h4> 
<p><img alt="" height="164" src="https://images2.imgbox.com/33/d4/IaiL8Fik_o.png" width="1047"></p> 
<blockquote> 
 <p><strong>[root@localhost html]# vim /usr/local/nginx/conf/nginx.conf</strong></p> 
</blockquote> 
<p><img alt="" height="127" src="https://images2.imgbox.com/db/a4/mqjqhr86_o.png" width="785"></p> 
<pre><code class="language-bash">[root@localhost html]# vim /usr/local/nginx/conf/nginx.conf
 18     include       mime.types;
 19     default_type  application/octet-stream;
 20     server_tokens off;
##加入server_tokens off
[root@localhost html]# cd ..
[root@localhost nginx]# nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
[root@localhost nginx]# systemctl restart nginx.service </code></pre> 
<p><img alt="" height="985" src="https://images2.imgbox.com/24/62/5FqgBfja_o.png" width="984"></p> 
<p><img alt="" height="265" src="https://images2.imgbox.com/26/cc/RDtgrvHf_o.png" width="983"></p> 
<h3 id="3.%E9%9A%90%E8%97%8F%E7%89%88%E6%9C%AC%E5%8F%B7%E6%B3%95%E4%BA%8C">3.隐藏版本号法二</h3> 
<h4 id="%E4%BF%AE%E6%94%B9%E6%BA%90%E7%A0%81%E6%96%87%E4%BB%B6%EF%BC%8C%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85">修改源码文件，重新编译安装</h4> 
<p><img alt="" height="780" src="https://images2.imgbox.com/21/00/jzfQuf6H_o.png" width="1191"></p> 
<p><img alt="" height="107" src="https://images2.imgbox.com/3d/a4/kHHU0D0U_o.png" width="809"></p> 
<h4 id="%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85%C2%A0">重新编译安装 </h4> 
<p><img alt="" height="298" src="https://images2.imgbox.com/b1/29/opYVfPeV_o.png" width="939"></p> 
<p><img alt="" src="https://images2.imgbox.com/96/a6/vkdVc7pu_o.png"></p> 
<blockquote> 
 <p><strong> [root@localhost nginx-1.12.0]# vim /usr/local/nginx/conf/nginx.conf</strong></p> 
</blockquote> 
<p><img alt="" height="141" src="https://images2.imgbox.com/5f/9b/0AAUrFhm_o.png" width="810"></p> 
<p><img alt="" height="333" src="https://images2.imgbox.com/a1/da/flZTlLGI_o.png" width="1032"><img alt="" height="1003" src="https://images2.imgbox.com/5f/54/LhebukzY_o.png" width="1011"></p> 
<pre><code class="language-bash">[root@localhost ~]# cd /opt/
[root@localhost opt]# cd nginx-1.12.0/
[root@localhost nginx-1.12.0]# 
[root@localhost nginx-1.12.0]# cd
[root@localhost ~]# 
[root@localhost ~]# cd /opt/nginx-1.12.0/
[root@localhost nginx-1.12.0]# ls
auto     CHANGES.ru  configure  html     Makefile  objs    src
CHANGES  conf        contrib    LICENSE  man       README
[root@localhost nginx-1.12.0]# systemctl stop nginx.service 
[root@localhost nginx-1.12.0]# cd src/
[root@localhost src]# ls
core  event  http  mail  misc  os  stream
[root@localhost src]# cd core/
[root@localhost core]# vim nginx.h
 12 #define nginx_version      1012000
 13 #define NGINX_VERSION      "12345678"
 14 #define NGINX_VER          "IIS/" NGINX_VERSION
[root@localhost core]# cd ../../
[root@localhost nginx-1.12.0]# ls
auto     CHANGES.ru  configure  html     Makefile  objs    src
CHANGES  conf        contrib    LICENSE  man       README
[root@localhost nginx-1.12.0]# ./configure \
&gt; --prefix=/usr/local/nginx \
&gt; --user=nginx \
&gt; --group=nginx \
&gt; --with-http_stub_status_module
[root@localhost nginx-1.12.0]# make &amp;&amp; make install -j4
[root@localhost nginx-1.12.0]# systemctl restart nginx.service 
[root@localhost nginx-1.12.0]# vim /usr/local/nginx/conf/nginx.conf
 17 http {
 18     include       mime.types;
 19     default_type  application/octet-stream;
 20     server_tokens on;
[root@localhost nginx-1.12.0]# curl -I 192.168.68.30
HTTP/1.1 200 OK
Server: IIS/12345678
Date: Sat, 13 Nov 2021 13:15:04 GMT
Content-Type: text/html
Content-Length: 612
Last-Modified: Sat, 13 Nov 2021 12:19:40 GMT
Connection: keep-alive
ETag: "618fad5c-264"
Accept-Ranges: bytes</code></pre> 
<h2 id="%E4%B8%89.%E4%BF%AE%E6%94%B9%E7%94%A8%E6%88%B7%E4%B8%8E%E7%BB%84">三.<span style="background-color:#ffffff;">修改用户与组</span></h2> 
<h2 id="%E2%80%8B%C2%A0%E2%80%8B"><img alt="" height="292" src="https://images2.imgbox.com/42/01/9VbKoeNM_o.png" width="1200"><br>  <img alt="" height="97" src="https://images2.imgbox.com/22/05/Q0bi6zRi_o.png" width="589"></h2> 
<pre><code class="language-bash">[root@localhost nginx-1.12.0]# ps aux |grep nginx
root       8048  0.0  0.0  20496   600 ?        Ss   21:14   0:00 nginx: master process /usr/local/nginx/sbin/nginx
nginx      8049  0.0  0.0  23024  1640 ?        S    21:14   0:00 nginx: worker process
root       8124  0.0  0.0 112680   980 pts/2    R+   21:20   0:00 grep --color=auto nginx
[root@localhost nginx-1.12.0]# !vim 
vim /usr/local/nginx/conf/nginx.conf 
2 user  ooo ooo;
[root@localhost nginx-1.12.0]# useradd -s /sbin/nologin ooo
[root@localhost nginx-1.12.0]# systemctl restart nginx.service 
[root@localhost nginx-1.12.0]# ps aux |grep ooo
ooo        8216  0.0  0.0  23028  1396 ?        S    21:25   0:00 nginx: worker process
root       8228  0.0  0.0 112676   984 pts/2    S+   21:25   0:00 grep --color=auto ooo
</code></pre> 
<h2 id="%E5%9B%9B.%E7%BC%93%E5%AD%98%E6%97%B6%E9%97%B4">四.缓存时间</h2> 
<p>当nginx 将网页数据返回给客户端后，可设置缓存时间，以方便在日后进行相同内容的请求时直接返回，避免重复请求，加快了访问速度一般针对静态网页设置，对动态网页不设置缓存时间。</p> 
<p><img alt="" height="135" src="https://images2.imgbox.com/37/73/Ozt9hj5D_o.png" width="1065"></p> 
<blockquote> 
 <p><strong>[root@localhost nginx-1.12.0]# vim /usr/local/nginx/conf/nginx.conf</strong></p> 
</blockquote> 
<p><img alt="" height="251" src="https://images2.imgbox.com/77/d5/ZlMzYXUf_o.png" width="841"></p> 
<p><img alt="" height="957" src="https://images2.imgbox.com/94/97/EnC1n7Ak_o.png" width="983"></p> 
<pre><code class="language-bash">[root@localhost nginx-1.12.0]# vim /usr/local/nginx/conf/nginx.conf
 48         location ~\.(gif|jpg|jpeg|png|bmp|ico)$ {
 49             root   html;
 50             expires 1d;
 51         }   
[root@localhost nginx-1.12.0]# nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
[root@localhost nginx-1.12.0]# systemctl restart nginx.service </code></pre> 
<h2 id="%E4%BA%94.%E6%97%A5%E5%BF%97%E5%88%87%E5%89%B2">五.日志切割</h2> 
<p><img alt="" height="241" src="https://images2.imgbox.com/59/d3/KZTHdlWp_o.png" width="1200"></p> 
<blockquote> 
 <p><strong>[root@localhost logs]# vim log.sh </strong></p> 
</blockquote> 
<p><img alt="" height="272" src="https://images2.imgbox.com/83/d8/qMYLtA0p_o.png" width="1009"></p> 
<p><img alt="" height="66" src="https://images2.imgbox.com/90/c7/TuGgJiV5_o.png" width="962"></p> 
<p><img alt="" height="59" src="https://images2.imgbox.com/5e/f3/2AtulRS6_o.png" width="778"></p> 
<p><img alt="" height="43" src="https://images2.imgbox.com/c8/71/kL1EPncc_o.png" width="557"></p> 
<pre><code class="language-bash">[root@localhost nginx-1.12.0]# cd /usr/local/nginx/logs
[root@localhost logs]# vim log.sh
#!/bin/bash
d=$(date +%F -d -1day)
logpath="/var/log/nginx"
pid="/usr/local/nginx/logs/nginx.pid"

[ -d $logpath ] || mkdir -p $logpath
mv /usr/local/nginx/logs/access.log ${logpath}/www.ooo.com.log-$d
kill -USR1 $(cat $pid)
find $logpath -mtime +30 -exec rm -rf {} \;

[root@localhost logs]# chmod +x log.sh 
[root@localhost logs]# bash log.sh 
[root@localhost logs]# ls /var/lo
local/ lock/  log/   
[root@localhost logs]# ls /var/log/nginx/www.ooo.com.log-2021-11-12 
/var/log/nginx/www.ooo.com.log-2021-11-12
[root@localhost logs]# crontab -e
crontab: installing new crontab
30 1 * * * /usr/local/nginx/logs/log.sh
</code></pre> 
<h2 id="%E5%85%AD.%E8%BF%9E%E6%8E%A5%E8%B6%85%E6%97%B6">六.连接超时</h2> 
<ul><li><strong>HTTP服务有一个KeepAlive模式，它告诉web服务器在处理完一个请求后保持这个TCP连接的打开状态。若接收到来自同一客户端的其他请求，服务端会利用这个未被关闭的连接，而不需要再次建立一个连接</strong></li><li><strong>KeepAlive在一段时间内保持打开状态，它们会在这段时间内占用资源，占用过多就会影响服务器的性能</strong></li></ul> 
<p><img alt="" height="191" src="https://images2.imgbox.com/dc/cd/KwRehBPV_o.png" width="1200"></p> 
<blockquote> 
 <p><strong> [root@localhost conf]# vim nginx.conf</strong></p> 
</blockquote> 
<p><img alt="" height="98" src="https://images2.imgbox.com/0b/30/0p87y0N0_o.png" width="758"></p> 
<p><img alt="" height="961" src="https://images2.imgbox.com/c9/bc/NN0Y6oWN_o.png" width="981"></p> 
<pre><code class="language-bash">[root@localhost nginx]# cd /usr/local/nginx/conf
[root@localhost conf]# vim nginx.conf
 30     #keepalive_timeout  0;
 31     keepalive_timeout  65 180;
[root@localhost conf]# systemctl restart nginx.service 
</code></pre> 
<h2 id="%E4%B8%83.%E6%9B%B4%E6%94%B9%E8%AF%B7%E6%B1%82%E8%BF%9B%E7%A8%8B%E6%95%B0">七.更改请求进程数</h2> 
<h2 id="%E2%80%8B"><img alt="" height="376" src="https://images2.imgbox.com/50/72/rVv0DK8f_o.png" width="1200"></h2> 
<blockquote> 
 <p><strong>[root@localhost conf]# !vim<br> vim nginx.conf</strong><br>  <img alt="" height="105" src="https://images2.imgbox.com/7d/79/0YBuSaW1_o.png" width="424"></p> 
</blockquote> 
<pre><code class="language-bash">[root@localhost conf]# ps aux |grep nginx
root      11496  0.0  0.0  20496   612 ?        Ss   22:41   0:00 nginx: master process /usr/local/nginx/sbin/nginx
nginx     11497  0.0  0.0  23024  1648 ?        S    22:41   0:00 nginx: worker process
root      11690  0.0  0.0 112676   984 pts/2    S+   22:56   0:00 grep --color=auto nginx
[root@localhost conf]# !vim
vim nginx.conf
  2 #user  nobody;
  3 worker_processes  4;
[root@localhost conf]# systemctl restart nginx.service 
[root@localhost conf]# ps aux |grep nginx
root      11736  0.0  0.0  20496   612 ?        Ss   22:57   0:00 nginx: master process /usr/local/nginx/sbin/nginx
nginx     11737  0.0  0.0  23024  1396 ?        S    22:57   0:00 nginx: worker process
nginx     11738  0.0  0.0  23024  1392 ?        S    22:57   0:00 nginx: worker process
nginx     11739  0.0  0.0  23024  1396 ?        S    22:57   0:00 nginx: worker process
nginx     11740  0.0  0.0  23024  1396 ?        S    22:57   0:00 nginx: worker process
root      11742  0.0  0.0 112676   980 pts/2    S+   22:57   0:00 grep --color=auto nginx
</code></pre> 
<h2 id="%E5%85%AB.%E7%BD%91%E9%A1%B5%E5%8E%8B%E7%BC%A9">八.网页压缩</h2> 
<p><img alt="" height="140" src="https://images2.imgbox.com/86/1f/JxkoMhfc_o.png" width="1163"></p> 
<blockquote> 
 <p><strong> [root@localhost conf]# vim /usr/local/nginx/conf/nginx.conf</strong></p> 
</blockquote> 
<h2><img alt="" height="258" src="https://images2.imgbox.com/bd/b0/FLEys5LG_o.png" width="1200"></h2> 
<p><img alt="" height="968" src="https://images2.imgbox.com/7c/2c/1RB4rdoi_o.png" width="989"></p> 
<pre><code class="language-bash">[root@localhost conf]# vim /usr/local/nginx/conf/nginx.conf
 33     gzip  on;
 34     gzip_buffers 4 64k;
 35     gzip_http_version 1.1;
 36     gzip_comp_level 6;
 37     gzip_min_length 1k;
 38     gzip_vary on;
 39     gzip_types text/plain text/javascript application/x-javascript text/css text/xml application/xml application/xml+rss image/jpg     image/png;
[root@localhost conf]# nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful
[root@localhost conf]# systemctl restart nginx.service </code></pre> 
<h2 id="%E4%B9%9D.%E9%98%B2%E7%9B%97%E9%93%BE">九.防盗链</h2> 
<p>盗图主机</p> 
<p> <img alt="" height="104" src="https://images2.imgbox.com/2d/51/hc6ipHfj_o.png" width="637"></p> 
<blockquote> 
 <p><strong> [root@localhost html]# vim index.html</strong></p> 
</blockquote> 
<p><img alt="" height="162" src="https://images2.imgbox.com/ab/42/SKAh2CVr_o.png" width="692"></p> 
<blockquote> 
 <p><strong>[root@localhost html]# vim /etc/hosts</strong></p> 
</blockquote> 
<p><img alt="" height="114" src="https://images2.imgbox.com/98/c9/C5Rgu4C0_o.png" width="963"></p> 
<p><strong> 防盗主机</strong></p> 
<p><img alt="" height="92" src="https://images2.imgbox.com/97/b2/2NAHdrb7_o.png" width="811"></p> 
<p><strong> 将防盗的图拖到这个目录下</strong></p> 
<p><img alt="" height="112" src="https://images2.imgbox.com/32/9f/o5fPexH5_o.png" width="1200"></p> 
<p><img alt="" height="267" src="https://images2.imgbox.com/0a/4e/1XS91zgN_o.png" width="990"></p> 
<p><img alt="" height="587" src="https://images2.imgbox.com/92/70/ZmgVa6b7_o.png" width="784"></p> 
<p><img alt="" height="659" src="https://images2.imgbox.com/b5/8d/VQqTTWPU_o.png" width="800"></p> 
<blockquote> 
 <p><strong>最后将错误图片放到防盗主机的html文件夹下，再刷新，在盗图主机下输入www.oooo.com之后就看不到原来的图片了 </strong></p> 
</blockquote> 
<p><img alt="" height="749" src="https://images2.imgbox.com/e9/9b/eHWNmIU1_o.png" width="1200"></p> 
<pre><code class="language-bash">[root@localhost ~]# cd /var/www/html/
[root@localhost html]# vim index.html
&lt;html&gt;
&lt;body&gt;
&lt;h1&gt;this is ooo
&lt;img src="http://www.ooo.com/1.jpg"/&gt;
&lt;/body&gt;
&lt;/html&gt;
[root@localhost html]# vim /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
192.168.68.30 www.ooo.com
192.168.68.105 www.oooo.com
[root@localhost html]# systemctl start httpd
[root@localhost conf]# vim nginx.conf
 54         location ~* \.(gif|jpg|jpeg|bmp|ico)$ {
 55             valid_referers none blocked *.ooo.com ooo.com;
 56             if ( $invalid_referer ) {
 57                            rewrite ^/ http://www.ooo.com/2.png;
 58         }
[root@localhost conf]# nginx -t
nginx: the configuration file /usr/local/nginx/conf/nginx.conf syntax is ok
nginx: configuration file /usr/local/nginx/conf/nginx.conf test is successful</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/75cdd991a20c1f666ca76ffa01ea2e2f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">STM32的哪来的LED=0 ？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/17e563f27ab08c236816d64b995df021/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MissingServletRequestParameterException: Required request parameter ‘id‘ for method parameter type I</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>