<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>柔性数组：char data[0] - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="柔性数组：char data[0]" />
<meta property="og:description" content=" 有如下定义： typedef struct{ char a; char b[0]; }; 其中元素Char b[0];叫做柔性数组，主要用于使结构体包含可变长字段。详细内容如下： 柔性数组; 【柔性数组结构成员 C99中，结构中的最后一个元素允许是未知大小的数组，这就叫做柔性数组成员，但结构中的柔性数组成员前面必须至少一个其他成员。柔性数组成员允许结构中包含一个大小可变的数组。sizeof返回的这种结构大小不包括柔性数组的内存。包含柔性数组成员的结构用malloc ()函数进行内存的动态分配，并且分配的内存应该大于结构的大小，以适应柔性数组的预期大小。】 C语言大全，“柔性数组成员” 看看 C99 标准中 灵活数组成员： 结构体变长的妙用——0个元素的数组 有时我们需要产生一个结构体，实现了一种可变长度的结构。如何来实现呢？ 看这个结构体的定义： typedef struct st_type { int nCnt; int item[0]; }type_a; （有些编译器会报错无法编译可以改成：） typedef struct st_type { int nCnt; int item[]; }type_a; 这样我们就可以定义一个可变长的结构，用sizeof(type_a)得到的只有4，就是sizeof(nCnt)=sizeof(int)那个0个元素的数组没有占用空间，而后我们可以进行变长操作了。 C语言版： type_a *p = (type_a*)malloc(sizeof(type_a) &#43; 100*sizeof(int)); C&#43;&#43; 语言版: type_a *p = (type_a*)new char[sizeof(type_a) &#43; 100*sizeof(int)]; 这样我们就产生了一个长为100的type_a类型的东西用p-&gt;item[n]就能简单地访问可变长元素，原理十分简单 ，分配了比sizeof(type_a)多的内存后int item[];就有了其意义了，它指向的是int nCnt;后面的内容，是没有内存需要的，而在分配时多分配的内存就可以由其来操控，是个十分好用的技巧。 而释放同样简单： C语言版： free(p); C&#43;&#43; 语言版： delete []p; 其实这个叫灵活数组成员(fleible array member)C89不支持这种东西，C99把它作为一种特例加入了标准。但是，C99所支持的是incomplete type，而不是zero array，形同int item[0];这种形式是非法的，C99支持的形式是形同int item[];只不过有些编译器把int item[0];作为非标准扩展来支持，而且在C99发布之前已经有了这种非标准扩展了，C99发布之后，有些编译器把两者合而为一。 下面看看这样做的用处 Typedef struct{ Char a[1]; Char b[]; }AA; AA *pf； pf = malloc(sizeof(AA) &#43; 5*sizeof(char));/*只分配一块内存*/ 如果这样定义 Typedef struct{ Char a[1]; Char *b; }AA; AA *pf； pf = malloc(sizeof(AA）); pf-&gt;b = malloc(5*sizeof(char));/*看出来了么，这样需要分配两块内存，在释放时也要先释放b的内存，再释放pf的内存*/ " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/58fa95bfe29951567bcf1722ef171912/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-10T12:40:12+08:00" />
<meta property="article:modified_time" content="2022-04-10T12:40:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">柔性数组：char data[0]</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>有如下定义： <br> typedef struct{  <br> char a;  <br> char b[0];  <br> };  <br> 其中元素Char b[0];叫做柔性数组，主要用于使结构体包含可变长字段。详细内容如下： <br> 柔性数组;  <br> 【柔性数组结构成员  <br> 　　C99中，结构中的最后一个元素允许是未知大小的数组，这就叫做柔性数组成员，但结构中的柔性数组成员前面必须至少一个其他成员。柔性数组成员允许结构中包含一个大小可变的数组。sizeof返回的这种结构大小不包括柔性数组的内存。包含柔性数组成员的结构用malloc ()函数进行内存的动态分配，并且分配的内存应该大于结构的大小，以适应柔性数组的预期大小。】  <br> C语言大全，“柔性数组成员”  <br> 看看 C99 标准中 灵活数组成员：  <br> 结构体变长的妙用——0个元素的数组  <br> 有时我们需要产生一个结构体，实现了一种可变长度的结构。如何来实现呢？  <br> 看这个结构体的定义：  <br> typedef struct st_type  <br> {  <br> int nCnt;  <br> int item[0];  <br> }type_a;  <br> （有些编译器会报错无法编译可以改成：）  <br> typedef struct st_type  <br> {  <br> int nCnt;  <br> int item[];  <br> }type_a;  <br> 这样我们就可以定义一个可变长的结构，用sizeof(type_a)得到的只有4，就是sizeof(nCnt)=sizeof(int)那个0个元素的数组没有占用空间，而后我们可以进行变长操作了。  <br> C语言版：  <br> type_a *p = (type_a*)malloc(sizeof(type_a) + 100*sizeof(int));  <br> C++ 语言版:  <br> type_a *p = (type_a*)new char[sizeof(type_a) + 100*sizeof(int)];  <br> 这样我们就产生了一个长为100的type_a类型的东西用p-&gt;item[n]就能简单地访问可变长元素，原理十分简单 ，分配了比sizeof(type_a)多的内存后int item[];就有了其意义了，它指向的是int nCnt;后面的内容，是没有内存需要的，而在分配时多分配的内存就可以由其来操控，是个十分好用的技巧。  <br> 而释放同样简单：  <br> C语言版：  <br> free(p);  <br> C++ 语言版：  <br> delete []p;  <br> 其实这个叫灵活数组成员(fleible array member)C89不支持这种东西，C99把它作为一种特例加入了标准。但是，C99所支持的是incomplete type，而不是zero array，形同int item[0];这种形式是非法的，C99支持的形式是形同int item[];只不过有些编译器把int item[0];作为非标准扩展来支持，而且在C99发布之前已经有了这种非标准扩展了，C99发布之后，有些编译器把两者合而为一。  <br>   <br> 下面看看这样做的用处  <br> Typedef struct{  <br> Char a[1];  <br> Char b[];  <br> }AA;  <br> AA *pf；  <br> pf = malloc(sizeof(AA) + 5*sizeof(char));/*只分配一块内存*/  <br> 如果这样定义  <br> Typedef struct{  <br> Char a[1];  <br> Char *b;  <br> }AA;  <br> AA *pf；  <br> pf = malloc(sizeof(AA）);  <br> pf-&gt;b = malloc(5*sizeof(char));/*看出来了么，这样需要分配两块内存，在释放时也要先释放b的内存，再释放pf的内存*/ </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0c3ab3897918ad1c49cc286cd0662f58/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">App Designer使用UIAxes显示图片并隐藏坐标轴和标题等信息</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/6906ea74e67298c385fdefe08e76723e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SQL注入点判断及万能密码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>