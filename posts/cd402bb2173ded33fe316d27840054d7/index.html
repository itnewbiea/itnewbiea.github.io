<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ROS中生成CameraInfo消息 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ROS中生成CameraInfo消息" />
<meta property="og:description" content="前言 由于某个第三方代码需要接受CameraInfo消息，我换了一个相机以后，需要自己发布CameraInfo消息。网上搜了半天，很少有介绍CameraInfo这些数据都是怎么来的的资料，可能大部分都是直接生成的吧，像我这样需要自己计算的可能不多。折腾了半天，也算是找到了方法。特做记录总结。转载请注明出处。
分析 首先看一下现有的CameraInfo有哪些数据：
rostopic echo /camera_info 可以看到，除了header外有 D, K, R, P等参数。这几个都是什么？
这就需要看一下在ros官网的说明：
http://docs.ros.org/en/melodic/api/sensor_msgs/html/msg/CameraInfo.html
一篇关于这个官方说明的资料在这里：https://github.com/dimatura/ros_vimdoc/blob/master/doc/ros-camera-info.txt
可以看出，D是畸变参数，K是相机内参矩阵，R是旋转，P是（校正后的）投影矩阵。
计算 进过相机标定后，一般都能够获得K和D，但R和P怎么设置？
一般我们不需要图像进行旋转，所以R给单位阵就好。P可以看到，P和K并不是完全相同。可以说，如果是没有畸变的图像，那么P左半部分和K是相同的。那么P该如何计算？找到了这个帖子：https://answers.ros.org/question/119506/what-does-projection-matrix-provided-by-the-calibration-represent/（可能访问不了，贴图到这里）
所以可以用OpenCV的函数getOptimalNewCameraMatrix()计算。函数API说明
只需要设置相机内参矩阵、畸变参数、长宽，alpha是自行设定，但根据ROS中cameraInfo，应该设置为0。
代码 测试代码如下：
void ex(void){ cout &lt;&lt; &#34;camera info parameter...&#34; &lt;&lt; endl; Mat dst; Mat cameraMatrix = Mat::zeros(Size(3,3), CV_64FC1); Mat distCoeffs(Size(1,4), CV_64FC1); cameraMatrix.at&lt;double&gt;(0,0) = 199.0923665423; cameraMatrix.at&lt;double&gt;(0,2) = 132.1920713777; cameraMatrix.at&lt;double&gt;(1,1) = 198.8288204701; cameraMatrix.at&lt;double&gt;(1,2) = 110.7126600011; cameraMatrix.at&lt;double&gt;(2,2) = 1; distCoeffs.at&lt;double&gt;(0) = -0.36843631179; distCoeffs.at&lt;double&gt;(1) = 0.150947243556; distCoeffs.at&lt;double&gt;(2) = -0.00029613053; distCoeffs.at&lt;double&gt;(3) = -0.00075943173; // distCoeffs." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cd402bb2173ded33fe316d27840054d7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-01T16:20:01+08:00" />
<meta property="article:modified_time" content="2022-12-01T16:20:01+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ROS中生成CameraInfo消息</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_1"></a>前言</h4> 
<p>由于某个第三方代码需要接受CameraInfo消息，我换了一个相机以后，需要自己发布CameraInfo消息。网上搜了半天，很少有介绍CameraInfo这些数据都是怎么来的的资料，可能大部分都是直接生成的吧，像我这样需要自己计算的可能不多。折腾了半天，也算是找到了方法。特做记录总结。<strong>转载请注明出处。</strong></p> 
<h4><a id="_4"></a>分析</h4> 
<p>首先看一下现有的CameraInfo有哪些数据：</p> 
<pre><code class="prism language-bash">rostopic <span class="token builtin class-name">echo</span> /camera_info
</code></pre> 
<p><img src="https://images2.imgbox.com/2b/9c/Mif2xcGd_o.png" alt="在这里插入图片描述" width="720"><br> 可以看到，除了header外有 D, K, R, P等参数。这几个都是什么？<br> 这就需要看一下在ros官网的说明：<br> <a href="http://docs.ros.org/en/melodic/api/sensor_msgs/html/msg/CameraInfo.html" rel="nofollow">http://docs.ros.org/en/melodic/api/sensor_msgs/html/msg/CameraInfo.html</a></p> 
<p>一篇关于这个官方说明的资料在这里：<a href="https://github.com/dimatura/ros_vimdoc/blob/master/doc/ros-camera-info.txt">https://github.com/dimatura/ros_vimdoc/blob/master/doc/ros-camera-info.txt</a></p> 
<p>可以看出，D是畸变参数，K是相机内参矩阵，R是旋转，P是（校正后的）投影矩阵。</p> 
<h4><a id="_18"></a>计算</h4> 
<p>进过相机标定后，一般都能够获得K和D，但R和P怎么设置？</p> 
<p>一般我们不需要图像进行旋转，所以R给单位阵就好。P可以看到，P和K并不是完全相同。可以说，如果是没有畸变的图像，那么P左半部分和K是相同的。那么P该如何计算？找到了这个帖子：<a href="https://answers.ros.org/question/119506/what-does-projection-matrix-provided-by-the-calibration-represent/" rel="nofollow">https://answers.ros.org/question/119506/what-does-projection-matrix-provided-by-the-calibration-represent/</a>（可能访问不了，贴图到这里）</p> 
<p><img src="https://images2.imgbox.com/89/cd/r9WSfzRp_o.png" alt="在这里插入图片描述" width="720"><br> <img src="https://images2.imgbox.com/a8/0d/lTGOwrYX_o.png" alt="在这里插入图片描述" width="720"></p> 
<p>所以可以用OpenCV的函数<code>getOptimalNewCameraMatrix()</code>计算。<a href="https://docs.opencv.org/4.0.0-rc/d9/d0c/group__calib3d.html#ga7a6c4e032c97f03ba747966e6ad862b1" rel="nofollow">函数API说明</a><br> <img src="https://images2.imgbox.com/ae/f3/dMA7BMWY_o.png" alt="在这里插入图片描述" width="720">只需要设置相机内参矩阵、畸变参数、长宽，alpha是自行设定，但根据ROS中cameraInfo，应该设置为0。</p> 
<h4><a id="_29"></a>代码</h4> 
<p>测试代码如下：</p> 
<pre><code class="prism language-cpp"><span class="token keyword">void</span> <span class="token function">ex</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    cout <span class="token operator">&lt;&lt;</span> <span class="token string">"camera info parameter..."</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

    Mat dst<span class="token punctuation">;</span>
    Mat cameraMatrix <span class="token operator">=</span> <span class="token class-name">Mat</span><span class="token double-colon punctuation">::</span><span class="token function">zeros</span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_64FC1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Mat <span class="token function">distCoeffs</span><span class="token punctuation">(</span><span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span> CV_64FC1<span class="token punctuation">)</span><span class="token punctuation">;</span>
    cameraMatrix<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">199.0923665423</span><span class="token punctuation">;</span>
    cameraMatrix<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">132.1920713777</span><span class="token punctuation">;</span>
    cameraMatrix<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">198.8288204701</span><span class="token punctuation">;</span>
    cameraMatrix<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">110.7126600011</span><span class="token punctuation">;</span>
    cameraMatrix<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>

    distCoeffs<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.36843631179</span><span class="token punctuation">;</span>
    distCoeffs<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.150947243556</span><span class="token punctuation">;</span>
    distCoeffs<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.00029613053</span><span class="token punctuation">;</span>
    distCoeffs<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">0.00075943173</span><span class="token punctuation">;</span>
    <span class="token comment">// distCoeffs.at&lt;double&gt;(4) = 0.0;</span>
    dst <span class="token operator">=</span> <span class="token function">getOptimalNewCameraMatrix</span><span class="token punctuation">(</span>cameraMatrix<span class="token punctuation">,</span> distCoeffs<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">240</span><span class="token punctuation">,</span> <span class="token number">180</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    cout <span class="token operator">&lt;&lt;</span> dst <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>测试结果看，自己计算的P和原始数据的P基本相同吧。<br> <img src="https://images2.imgbox.com/0a/0f/1Kk6leF3_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_57"></a>完整代码</h4> 
<p>由于ROS的cameraInfo下D/R/P/K并不是opencv的Mat，所以需要进行转换。完整代码如下：</p> 
<pre><code class="prism language-cpp">sensor_msgs<span class="token double-colon punctuation">::</span>CameraInfo <span class="token function">getCameraInfo</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>        <span class="token comment">// extract cameraInfo.</span>
    sensor_msgs<span class="token double-colon punctuation">::</span>CameraInfo cam<span class="token punctuation">;</span>
    string camera_model_file <span class="token operator">=</span> <span class="token string">"/home/larrydong/thesis_ws/src/thesis/process/settings/parameters.xml"</span><span class="token punctuation">;</span>
    FileStorage <span class="token function">fs</span><span class="token punctuation">(</span>camera_model_file<span class="token punctuation">,</span> FileStorage<span class="token double-colon punctuation">::</span>READ<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fs<span class="token punctuation">.</span><span class="token function">isOpened</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">ROS_ERROR_STREAM</span><span class="token punctuation">(</span><span class="token string">"Cannot load camera info file. From: "</span> <span class="token operator">&lt;&lt;</span> camera_model_file<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Mat k<span class="token punctuation">,</span> d<span class="token punctuation">;</span>
    fs<span class="token punctuation">[</span><span class="token string">"camera_matrix"</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> k<span class="token punctuation">;</span>
    fs<span class="token punctuation">[</span><span class="token string">"distortion_coefficient"</span><span class="token punctuation">]</span> <span class="token operator">&gt;&gt;</span> d<span class="token punctuation">;</span>

    vector<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span> D<span class="token punctuation">{<!-- --></span>d<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> d<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    boost<span class="token double-colon punctuation">::</span>array<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token operator">&gt;</span> K <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        k<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    
    Mat p <span class="token operator">=</span> <span class="token function">getOptimalNewCameraMatrix</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> d<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">1280</span><span class="token punctuation">,</span> <span class="token number">800</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment">// get rectified projection.</span>
    boost<span class="token double-colon punctuation">::</span>array<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token operator">&gt;</span> P <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>        p<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">at</span><span class="token generic class-name"><span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    boost<span class="token double-colon punctuation">::</span>array<span class="token operator">&lt;</span><span class="token keyword">double</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token operator">&gt;</span> r <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

    cam<span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">800</span><span class="token punctuation">;</span>
    cam<span class="token punctuation">.</span>width <span class="token operator">=</span> <span class="token number">1280</span><span class="token punctuation">;</span>
    cam<span class="token punctuation">.</span>distortion_model <span class="token operator">=</span> <span class="token string">"plumb_bob"</span><span class="token punctuation">;</span>
    cam<span class="token punctuation">.</span>D <span class="token operator">=</span> D<span class="token punctuation">;</span>
    cam<span class="token punctuation">.</span>K <span class="token operator">=</span> K<span class="token punctuation">;</span>
    cam<span class="token punctuation">.</span>P <span class="token operator">=</span> P<span class="token punctuation">;</span>
    cam<span class="token punctuation">.</span>R <span class="token operator">=</span> r<span class="token punctuation">;</span>
    cam<span class="token punctuation">.</span>binning_x <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    cam<span class="token punctuation">.</span>binning_y <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> cam<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token operator">*</span>argv<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> 
	ros<span class="token double-colon punctuation">::</span><span class="token function">init</span><span class="token punctuation">(</span>argc<span class="token punctuation">,</span> argv<span class="token punctuation">,</span> <span class="token string">"image_info_pub"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token double-colon punctuation">::</span>NodeHandle n<span class="token punctuation">;</span>
	<span class="token keyword">const</span> string camurl <span class="token operator">=</span> <span class="token string">"file:///home/yjy/calibrationdata/ost.yaml"</span><span class="token punctuation">;</span>
	camera_info_manager<span class="token double-colon punctuation">::</span>CameraInfoManager <span class="token function">caminfo</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token string">"camera_info"</span><span class="token punctuation">,</span> camurl<span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token double-colon punctuation">::</span>Publisher pub_cam_info <span class="token operator">=</span> n<span class="token punctuation">.</span><span class="token generic-function"><span class="token function">advertise</span><span class="token generic class-name"><span class="token operator">&lt;</span>sensor_msgs<span class="token double-colon punctuation">::</span>CameraInfo<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"camera_info"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	ros<span class="token double-colon punctuation">::</span>Rate <span class="token function">r</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span>ros<span class="token double-colon punctuation">::</span><span class="token function">ok</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		pub_cam_info<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span>caminfo<span class="token punctuation">.</span><span class="token function">getCameraInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		ros<span class="token double-colon punctuation">::</span><span class="token function">spinOnce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		r<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4319850c543fde98dceb46a1cf6cbc69/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">DMA简单理解和分享</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/794eef704dcfa1216c75b4734310671c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JavaScript：断点调试</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>