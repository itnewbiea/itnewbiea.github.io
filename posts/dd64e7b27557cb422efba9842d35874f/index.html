<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>原生JS&#43;layui项目笔记（一）【layer弹出框与form、table】 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="原生JS&#43;layui项目笔记（一）【layer弹出框与form、table】" />
<meta property="og:description" content="一、准备文件 1. html文件引入
&lt;script type=&#34;text/javascript&#34; src=&#34;./layui/layui.js&#34;&gt;&lt;/script&gt; &lt;script type=&#34;text/javascript&#34; src=&#34;./xxx/xxxx.js&#34;&gt;&lt;/script&gt; 2.js文件引入layui的各种组件
layui.use([&#39;jquery&#39;,layer&#39;,&#39;table&#39;,&#39;form&#39;,&#39;laytpl&#39;,&#39;laydate&#39;],function(){ var $ = layui.jquery; var layer = layui.layer; var form = layui.form; var table = layui.table; var laytpl = layui.laytpl; var laydate = layui.laydate; var upload = layui.upload; }) 二、layer弹出框 1.1 单一弹出框 layer.confirm(&#39;确定删除吗？&#39;,{ skin:&#39;m-pop-window&#39;, btnAlign:&#39;c&#39;, shade:[0, &#39;transparent&#39;], btn:[&#39;确定&#39;,&#39;删除&#39;], btn1:function(index, layero){ $.post(&#39;deleteUrl&#39;,{data:data},function(res){ if(res.code == &#39;0&#39;){ layer.msg(&#39;删除成功&#39;); layer.close(index); table.reload(&#39;table的id&#39;,{url:&#39;&#39;,where:{}}) // 刷新表格 } }) } } }, layer.msg(&#39;请输入名称后检索！&#39;); 1.2 layer内嵌表单（form&#43;laydate&#43;upload） 1.2.1 html中的form模板 写在htmlbody之外，写在script中，否则出现按钮失效。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/dd64e7b27557cb422efba9842d35874f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-08-09T16:55:11+08:00" />
<meta property="article:modified_time" content="2021-08-09T16:55:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">原生JS&#43;layui项目笔记（一）【layer弹出框与form、table】</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2> 一、准备文件</h2> 
<p>1. html文件引入</p> 
<pre><code class="language-html">&lt;script type="text/javascript" src="./layui/layui.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript" src="./xxx/xxxx.js"&gt;&lt;/script&gt;</code></pre> 
<p>2.js文件引入layui的各种组件</p> 
<pre><code class="language-javascript">layui.use(['jquery',layer','table','form','laytpl','laydate'],function(){
    var $ = layui.jquery;
    var layer = layui.layer;
    var form = layui.form;
    var table = layui.table;
    var laytpl = layui.laytpl;
    var laydate = layui.laydate;
    var upload = layui.upload;
})</code></pre> 
<h2>二、layer弹出框</h2> 
<h3>1.1 单一弹出框</h3> 
<pre><code class="language-javascript">layer.confirm('确定删除吗？',{
    skin:'m-pop-window',
    btnAlign:'c',
    shade:[0, 'transparent'],
    btn:['确定','删除'],
    btn1:function(index, layero){
        $.post('deleteUrl',{data:data},function(res){
            if(res.code == '0'){
            layer.msg('删除成功');
            layer.close(index);
            table.reload('table的id',{url:'',where:{}}) // 刷新表格
            }
        })
    }
    }
},</code></pre> 
<pre><code class="language-javascript">layer.msg('请输入名称后检索！');</code></pre> 
<h3>1.2 layer内嵌表单（form+laydate+upload）</h3> 
<h4>1.2.1 html中的form模板</h4> 
<p>写在htmlbody之外，写在script中，否则出现按钮失效。</p> 
<pre><code class="language-html">&lt;body&gt;
    &lt;button type="button" id="openLayer" class="layui-btn"&gt;开启弹窗&lt;/button&gt;
&lt;/body&gt;
&lt;script id="addMappingBox"&gt;
    &lt;div class="layui-form" layfilter="add_mining" id="add_mining"&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;名称1&lt;/lable&gt;
            &lt;!-- 一般输入框 --&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;input type="text" name="title" id="title1" class="layui-input" value={<!-- -->{d.title1}}/&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;输入文本框&lt;/lable&gt;
            &lt;!-- 文本框 文本框插入值不能写在value中--&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;textarea type="text" name="title2" id="title2" class="layui-input"&gt;{<!-- -->{d.title2}}&lt;/textarea&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;选择日期&lt;/lable&gt;
            &lt;!-- 日期--&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;input type="text" name="mapDate" id="mapDate" class="layui-input" value={<!-- -->{d.title3}}/&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;上传文件&lt;/lable&gt;
            &lt;!-- 上传文件--&gt;
            &lt;div class="layui-input-block"&gt;
               &lt;button type="button" id="uploadMindMapping" class="layui-btn"&gt;点击上传&lt;/button&gt;
            &lt;!-- 上传文件后回显文件名称--&gt;
            &lt;span id="uploadFileName"&gt;&lt;/span&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/script&gt;</code></pre> 
<h4>1.2.2  js语法</h4> 
<p>触发弹窗：</p> 
<pre><code class="language-javascript">//点击事件触发弹窗
$("#openLayer").click(function(){
    var addMappingWindow = laytpl(addMappingBox.innerHTML).render({
        &lt;--!此处可利用name绑定value --&gt;
        'title' :  $("#xxx").html();
        'title2' : $("#xxx").val();
    });
    layer.open({
        type:1,
        content:addMappingWindow,
        title:'弹窗的标题',
        skin:'m-pop-window',
        area:['700px','600px'],
        offset:'auto',
        btn:['确定','取消'],
        btnAlign:'c',
        resize:false,
        success: function(layero,index){
            form.render();  // 表单渲染
            initUploadMindMapping(); // 上传控件渲染
            
        },
        yes: function(layero, index){
            layer.close(index);
            return false; // 禁止layer自动刷新页面
        }
    })
});
// 时间控件
laydate.render({
    elem:'#mapDate',
    type:'datetime',
    format:'yyyy-MM-dd HH:mm:ss',
    change:function(value, date, endDate){
    }
});
// 上传控件
function initUploadMindMapping(){
    upload.render({
        elem:'#uploadMindMapping',
        bindAction:'.layui-layer-btn0',
        auto:false,
        url:'/uploadUrl',
        type:'post',
        accept:'file',
        exts:'xls|xlsx',  // 有时候限定‘file’后不限定明确类型会报'类型有问题'的错
        choose:function(obj){
            obj.preview(function(index, file, result){
                // 反显文件名
                $('#uploadFileName').html(file.name)
            })
        },
        done:function(res){
            
        }
    })
};</code></pre> 
<h3>1.3 layer内嵌表格（form+table）</h3> 
<h4>1.3.1  html模板（动态table）</h4> 
<pre><code class="language-html">&lt;script id="organization_set" type="text/html"&gt;
    &lt;div class="layui-form" lay-filter=""&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable &gt;复选框&lt;lable&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;input type="checkbox" name="chooseIndex1" lay-filter="chooseIndex1" class="layui-input" title="按名称选" value="1" lay-skin="primary checked"/&gt;
                &lt;input type="checkbox" name="chooseIndex1" lay-filter="chooseIndex1" class="layui-input" title="按描述选" value="2" lay-skin="primary checked"/&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable &gt;单选框&lt;lable&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;input type="radio" name="chooseIndex2" lay-filter="chooseIndex2" class="layui-input" title="按名称选" value="0" lay-skin="primary checked"/&gt;
                &lt;input type="radio" name="chooseIndex2" lay-filter="chooseIndex2" class="layui-input" title="按描述选" value="1" lay-skin="primary checked"/&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;筛选结果&lt;lable&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;table id="resultTable" lay-filter="resultTable"&gt;&lt;/table&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/script&gt;</code></pre> 
<h4>1.3.2  js语法(根据单选框、复选框内容刷新表格显示搜索结果)</h4> 
<pre><code class="language-javascript">var organizationChooseWindow = laytpl(organization_set.innerHTML).render({
});
layer.open({
    type:1,
    content:addMappingWindow,
    title:'弹窗的标题',
    skin:'m-pop-window',
    area:['700px','600px'],
    offset:'auto',
    btn:['确定','取消'],
    btnAlign:'c',
    resize:false,
    success: function(layero,index){
        form.render();  // 表单渲染
        // 未选择的时候 搜索结果显示（表格渲染）
        initSearchOrganizationTable();
        // 复选框内容监听
        form.on('checkbox(chooseIndex1)'),function(data){
            form.render('checkbox')
            // 全选
            if($('#organization_set_form input[type=checkbox]:checked').length == 2){
                table.reload('organizationSearchResult',{
                    where : {
                        organizationName:xxx,
                        describe:xxx
                    }
                })
            }else if($('#organization_set_form input[type=checkbox]:checked').val() == '1'){
                 table.reload('organizationSearchResult',{
                    where : {
                        organizationName:xxx
                    }
                })           
            }else if($('#organization_set_form input[type=checkbox]:checked').val() == '2'){
                 table.reload('organizationSearchResult',{
                    where : {
                        describe:xxx
                    }
                })           
            }
        };
        // 单选框内容监听
        form.on('radio(chooseIndex2)'),function(data){
            form.render('radio')
            if($('#organization_set_form input[type=radio]:checked').val() == '0'){
                table.reload('organizationSearchResult',{
                    where : {
                        organizationName:xxx
                    }
                })
            }else if($('#organization_set_form input[type=radio]:checked').val() == '1'){
                 table.reload('organizationSearchResult',{
                    where : {
                        describe:xxx
                    }
                })           
            }
        }
    },
    yes: function(layero, index){
        layer.close(index);
        return false; // 禁止layer自动刷新页面
    }
});
function initSearchOrganizationTable(){
// 带分页的table
    table.render({
        elem:'#organizationSearchResult',
        id:'organizationSearchResult',
        width: 470,
        height: 300,
        page:true,
        limit:50,
        method:'get',
        url:'linkUrl',
        where:{
            'taskId':xxx,
            'organization': xxx,
            'describe':xxxx
        },
        // 规范返回数据格式，格式不同渲染不出来
        parseData:function(res){
            return {
                'code':res.code,
                'msg':res.message,
                'data':res.data
            }
        },
        cols:[[
            {
                type:'checkbox',
                title:'',
                algin:'center'
            },
            {
                type:'radio',
                title:'',
                algin:'center'
            },
            {
                field:'organizationName',
                title:'名称',
                algin:'center',
                width: 80,
            },
            {
                field:'describe',
                title:'描述',
                algin:'center'
            }
        ]],
        // 渲染成功后的回调，可以修改table样式
        done:function(res){
            // 修改单元格padding，展示更多的内容
            $('.layui-table-cell').css('padding','0 2px')
        }
    })
};
// 获取复选框内容
var data_table = table.checkStatus('organizationSearchResult').data;</code></pre> 
<h3>1.4 表格事件内嵌弹出框（table+layer+form  【单选框回显】）</h3> 
<h4>1.4.1  html模板（动态table）</h4> 
<p>类似1.3.1插入一个table的容器</p> 
<pre><code class="language-html">&lt;body&gt;
    &lt;table id="WDmsgTable" lay-filter="WDmsgTable"&gt;&lt;/table&gt;
&lt;/body&gt;
&lt;script id="consistency_set" type="text/html"&gt;
    &lt;div class="layui-form" lay-filter="consistency_set_form" id="consistency_set_form"&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;机构名称&lt;/lable&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;input class="layui-input" name="organizationName" readonly value="{<!-- -->{d.organizationName}}"/&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;时间&lt;/lable&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;input class="layui-input" name="consistencyTime" readonly value="{<!-- -->{d.consistencyTime}}"/&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;正文&lt;/lable&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;textarea class="layui-input" name="consistencyContent" readonly value=""&gt;{<!-- -->{d.consistencyContent}}&lt;/textarea&gt;
            &lt;/div&gt;
        &lt;/div&gt;
        &lt;div class="layui-form-item"&gt;
            &lt;lable&gt;是否合规&lt;/lable&gt;
            &lt;div class="layui-input-block"&gt;
                &lt;input type="radio" lay-filter="consistencyRadio" name="consistencyRadio" value="1" title="是" checked/&gt;
                &lt;input type="radio" lay-filter="consistencyRadio" name="consistencyRadio" value="0" title="否"/&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/script&gt;</code></pre> 
<h4>1.4.2  js语法</h4> 
<pre><code class="language-javascript">//表格事件触发弹窗
table.render({
    elem:'#organizationSearchResult',
        id:'organizationSearchResult',
        width: 470,
        height: 300,
        page:true,
        limit:50,
        method:'get',
        url:'linkUrl',
        where:{
            'taskId':xxx,
            'organization': xxx,
            'describe':xxxx
        },
        // 规范返回数据格式，格式不同渲染不出来
        parseData:function(res){
            return {
                'code':res.code,
                'msg':res.message,
                'data':res.data
            }
        },
        cols:[[
            {
                type:'radio',
                title:'',
                algin:'center'
            },
            {
                field:'organizationName',
                title:'名称',
                algin:'center',
                width: 80,
            },
            {
                field:'describe',
                title:'描述',
                algin:'center'
            },
            {
                title:'操作',
                algin:'center',
                templet:function(d){
                    if(d.isComliance){
                        return '&lt;a lay-event="check"&gt;是&lt;/a&gt;'
                    }else{
                        return '&lt;a lay-event="check"&gt;否&lt;/a&gt;'
                    }
                }
            }
        ]],
});
table.on('tool(organizationSearchResult)',function(obj){
    var table_data = obj.data;
    var event = obj.event;
    var consistency_set_window = laytpl(consistency_set.innerHTML).render({
        &lt;--!此处可利用name绑定value --&gt;
        'organizationName' :  $('#searchOrganization').val()?'三元':'';
        'consistencyContent' : table_data.zj;
        'consistencyTime': table_data.sj;
    });
    if(event == 'check'){
        layer.open({
            type:1,
            content:consistency_set_window ,
            title:'弹窗的标题',
            skin:'m-pop-window',
            area:['700px','600px'],
            offset:'auto',
            btn:['确定','取消'],
            btnAlign:'c',
            resize:false,
            success: function(layero,index){
                form.render();  // 表单渲染
                //单选框回显
                $("input[name=consistencyName][value='1']").attr("checked",table_data.isComliance == '1'?true:'false);
                $("input[name=consistencyName][value='0']").attr("checked",table_data.isComliance == '0'?true:'false);
                //监听单选框变化，刷新单选框
                form.on('radio(consistencyRadio)',function(){
                    form.render('radio')
                });
            },
            yes:function(index, layero){
                //上传数据，刷新表格
                $.get('url',{isComliance : $("input[name=consistencyName]:checked").val()},function(res){
                    if(res.code == '0'){
                        table.reload('WDmsgTable',true)
                    }
                })
                layer.close(index);
                return false;
            },
        })
          
    }
})</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d30febef3be9e91280434a7d0dcb15b6/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">服务器 不断电系统,内建 UPS 不断电系统 Aurender ACS100 音乐服务器</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f72ed05250eeb2ff4fb58644d5942640/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">echarts之百度热力图</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>