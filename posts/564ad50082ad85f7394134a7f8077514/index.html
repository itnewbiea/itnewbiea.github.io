<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Qt使用msvc编译器情况下，如何进行内存泄漏检测 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Qt使用msvc编译器情况下，如何进行内存泄漏检测" />
<meta property="og:description" content="背景： 使用Qt5版本，编译器选择msvc2017，在测试基于tinyxml2的二次封装类接口是否存在内存泄漏问题时，寻找内存泄漏检测工具。
问题： 寻找适合Qt &#43; msvc编程的内存泄漏检测工具
尝试： VLD Visual Leak Detector 是一款用于 C&#43;&#43; 的免费内存泄露检测工具，并且它在检测到内存泄露的同时还可以得到内存泄露时的调用堆栈以及所在文件和行号。
①下载：
下载地址：Visual Leak Detector | Enhanced Memory Leak Detection for Visual C&#43;&#43;
②安装完成后，所在目录地址如下
③项目配置：
将vld头文件和库文件加到工程项目中。
我的程序代码是通过CMake的方式进行程序代码管理的，所以我在CMakeList.txt文件中加入了如下代码：
其中C:/Program Files (x86)/Visual Leak Detector 为vld的安装目录。
如果使用.pro文件的方式进行程序管理，则在pro文件中加入如下代码：
④编码实现，以及测试验证
在main.cpp文件中实现如下代码：
运行失败，程序直接崩溃（debug模式）。但是尝试使用release模式，运行正常，但是没有leak detect相关信息，没有leak相关信息属于正常现象，因为只有debug模式才会有leak信息输出。
猜测导致崩溃的原因是我的电脑上没有安装msvc的调试器。
在尝试1的基础上，进行安装msvc调试器，尝试解决问题 ①打开控制面板 的 程序与功能
②选择Windows Software Development Kit - Windows .......，右键弹出菜单，选择“更改”，如下图：
③选择“Change”，点击“next”。
④勾选“Debugging Tools for Windows”，点击“Change”进行调试器安装。
安装完成后，运行Qt程序，正确输出leak信息，如下：
修改main代码
运行，输出如下leak信息：其中红色标注部分显示了造成内存泄漏的代码所在文件及行号信息。
总结： 使用Qt &#43; msvc方式进行程序开发时，可使用vld(Visual Leak Detector)工具实现程序内存泄漏的检测，和错误定位。需要注意的是vld依赖于debug调试器工具，如若不然，程序在添加了&lt;vld.h&gt;后在debug模式下，会出现运行崩溃。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/564ad50082ad85f7394134a7f8077514/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-29T14:57:35+08:00" />
<meta property="article:modified_time" content="2023-03-29T14:57:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Qt使用msvc编译器情况下，如何进行内存泄漏检测</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4 style="text-align:justify;"><strong>背景：</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">使用Qt5版本，编译器选择msvc2017，在测试基于tinyxml2的二次封装类接口是否存在内存泄漏问题时，寻找内存泄漏检测工具。</p> 
<h4 style="text-align:justify;"><strong>问题：</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">寻找适合Qt + msvc编程的内存泄漏检测工具</p> 
<h4 style="text-align:justify;"><strong>尝试：</strong></h4> 
<ol><li style="text-align:justify;">VLD</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">Visual Leak Detector 是一款用于 C++ 的免费内存泄露检测工具，并且它在检测到内存泄露的同时还可以得到内存泄露时的调用堆栈以及所在文件和行号。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">①下载：</p> 
<p style="margin-left:.0001pt;text-align:justify;">下载地址：<a href="https://kinddragon.github.io/vld/" rel="nofollow" title="Visual Leak Detector | Enhanced Memory Leak Detection for Visual C++">Visual Leak Detector | Enhanced Memory Leak Detection for Visual C++</a></p> 
<p style="margin-left:.0001pt;text-align:justify;">②安装完成后，所在目录地址如下</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="253" src="https://images2.imgbox.com/eb/80/J3ydSKNy_o.png" width="384"></p> 
<p style="margin-left:.0001pt;text-align:justify;">③项目配置：</p> 
<p style="margin-left:.0001pt;text-align:justify;">将vld头文件和库文件加到工程项目中。</p> 
<p style="margin-left:.0001pt;text-align:justify;">我的程序代码是通过CMake的方式进行程序代码管理的，所以我在CMakeList.txt文件中加入了如下代码：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="59" src="https://images2.imgbox.com/50/75/HeRh9sOT_o.png" width="286"></p> 
<p><img alt="" height="21" src="https://images2.imgbox.com/fe/17/QBXUJvMb_o.png" width="553"> </p> 
<p style="margin-left:.0001pt;text-align:justify;">其中C:/Program Files (x86)/Visual Leak Detector 为vld的安装目录。</p> 
<p style="margin-left:.0001pt;text-align:justify;"></p> 
<p style="margin-left:.0001pt;text-align:justify;">如果使用.pro文件的方式进行程序管理，则在pro文件中加入如下代码：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="47" src="https://images2.imgbox.com/7e/3a/KDOFt7c0_o.png" width="390"></p> 
<p style="margin-left:.0001pt;text-align:justify;">④编码实现，以及测试验证</p> 
<p style="margin-left:.0001pt;text-align:justify;">在main.cpp文件中实现如下代码：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="126" src="https://images2.imgbox.com/6c/5b/JZMZr1Bm_o.png" width="209"></p> 
<p style="margin-left:.0001pt;text-align:justify;">运行失败，程序直接崩溃（debug模式）。但是尝试使用release模式，运行正常，但是没有leak detect相关信息，没有leak相关信息属于正常现象，因为只有debug模式才会有leak信息输出。</p> 
<p style="margin-left:.0001pt;text-align:justify;">猜测导致崩溃的原因是我的电脑上没有安装msvc的调试器。</p> 
<ol><li style="text-align:justify;">在尝试1的基础上，进行安装msvc调试器，尝试解决问题</li></ol> 
<p style="margin-left:.0001pt;text-align:justify;">①打开控制面板 的 程序与功能</p> 
<p style="margin-left:.0001pt;text-align:justify;">②选择Windows Software Development Kit - Windows .......，右键弹出菜单，选择“更改”，如下图：</p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="219" src="https://images2.imgbox.com/1a/ea/IlthKyXk_o.png" width="399"></p> 
<p>③选择“Change”，点击“next”。</p> 
<p><img alt="" height="196" src="https://images2.imgbox.com/fe/32/f4FnK5G0_o.png" width="267"> </p> 
<p>④勾选“Debugging Tools for Windows”，点击“Change”进行调试器安装。</p> 
<p><img alt="" height="230" src="https://images2.imgbox.com/ed/8a/RkR24Fyp_o.png" width="311"> </p> 
<p>安装完成后，运行Qt程序，正确输出leak信息，如下：</p> 
<p><img alt="" height="130" src="https://images2.imgbox.com/53/e7/xhGMNNkY_o.png" width="431"> </p> 
<p>修改main代码</p> 
<p><img alt="" height="126" src="https://images2.imgbox.com/31/ab/wAOPdkt4_o.png" width="223"> </p> 
<p style="margin-left:.0001pt;text-align:left;">运行，输出如下leak信息：其中红色标注部分显示了造成内存泄漏的代码所在文件及行号信息。</p> 
<p style="margin-left:.0001pt;text-align:left;"><img alt="" height="266" src="https://images2.imgbox.com/d4/bb/t73fXJTU_o.png" width="455"></p> 
<h4 style="text-align:justify;"><strong>总结：</strong></h4> 
<p style="margin-left:.0001pt;text-align:justify;">使用Qt + msvc方式进行程序开发时，可使用vld(Visual Leak Detector)工具实现程序内存泄漏的检测，和错误定位。需要注意的是vld依赖于debug调试器工具，如若不然，程序在添加了&lt;vld.h&gt;后在debug模式下，会出现运行崩溃。</p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p style="margin-left:.0001pt;text-align:justify;"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f9b758358c01b5e06e6555b9e8b2599f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mysql 字段模糊查询，在页面中输入%查询全部的问题处理</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2bd66d79deffd2412fd46b22d2d9631d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vscode连接远程服务器 &#43; Tensorflow2环境配置 &#43; 深度学习训练</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>