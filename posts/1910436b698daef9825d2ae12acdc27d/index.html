<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue封装组件(一)标签和下拉框组合实现添加数据 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue封装组件(一)标签和下拉框组合实现添加数据" />
<meta property="og:description" content="背景: 最近接入短剧内容，需要添加短剧合作方。在详情页需要支持添加组件 方案一：标签tag加上输入框实现添加数据。图片见下 这个是刚开始做的，后来产品觉得这样会造成随意修改数据，需要改成下拉框形式添加 方案二：标签tag加上下拉框以及添加按钮实现。 这个就避免了乱添加数据，添加合作方名字需要在一个管理页面添加，然后下拉框请求自然就请求到数据了
方案一效果图：第一行 流程：点击新增后，填入数据，后台会自动检查是否存在，存在返回数据，否则保存然后返回数据。 这样做有个问题，一不小心填错数据，后台也保存下来了 方案二效果图：第二行 流程：下拉框中是已经存在的数据，然后选择添加就行。合作方需要在另外的一个管理页面增删查改。 接下来是代码实现。 注意：这两个都是封装的组件，直接掉用即可，既然是封装的组件，那么就要支持已经存在的合作方数据填入。
方案一 &lt;template&gt; &lt;div&gt; &lt;!-- {{shortPlays}}--&gt; &lt;el-tag style=&#34;margin-right: 5px&#34; v-for=&#34;(tag,index) in shortPlaysFilter&#34; :key=&#34;index&#34; closable @close=&#34;close(index,tag.shortPlayName)&#34;&gt; {{tag.shortPlayName}} &lt;/el-tag&gt; &lt;el-input v-if=&#34;inputVisible&#34; v-model=&#34;inputValue&#34; ref=&#34;ref&#34; class=&#34;input-new-tag&#34; size=&#34;small&#34; style=&#34;width: 100px&#34; @keyup.enter.native=&#34;inputConfirm&#34; @blur=&#34;inputConfirm&#34; &gt;&lt;/el-input&gt; &lt;el-button v-else size=&#34;small&#34; style=&#34;margin-left: 5px;&#34; @click=&#34;btnClick&#34;&gt;新增合作方&lt;/el-button&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; import * as mapRequest from &#34;@/api/map&#34;; export default { name: &#34;ag_album_short_play_partner&#34;, props:{//这里外部的数据传入 shortPlays:{ required:true, default:()=&gt;{ return []; } } }, data() { return { inputVisible:false, inputValue:&#39;&#39;, } }, created() { }, methods: { close(index,name){ // 注意：这里的index 不能直接拿到删除 因为这个index 是过滤后的 所以通过name找下标 然后删除 console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1910436b698daef9825d2ae12acdc27d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T17:59:34+08:00" />
<meta property="article:modified_time" content="2024-01-05T17:59:34+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue封装组件(一)标签和下拉框组合实现添加数据</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>背景: 最近接入短剧内容，需要添加短剧合作方。在详情页需要支持添加组件 方案一：标签tag加上输入框实现添加数据。图片见下 这个是刚开始做的，后来产品觉得这样会造成随意修改数据，需要改成下拉框形式添加 方案二：标签tag加上下拉框以及添加按钮实现。 这个就避免了乱添加数据，添加合作方名字需要在一个管理页面添加，然后下拉框请求自然就请求到数据了</p> 
</blockquote> 
<p>方案一效果图：第一行 流程：点击新增后，填入数据，后台会自动检查是否存在，存在返回数据，否则保存然后返回数据。 这样做有个问题，一不小心填错数据，后台也保存下来了 方案二效果图：第二行 流程：下拉框中是已经存在的数据，然后选择添加就行。合作方需要在另外的一个管理页面增删查改。 <img alt="" src="https://images2.imgbox.com/81/29/PuNWxt6r_o.png"></p> 
<p>接下来是代码实现。 <strong>注意：</strong>这两个都是封装的组件，直接掉用即可，既然是封装的组件，那么就要支持已经存在的合作方数据填入。</p> 
<h2>方案一</h2> 
<pre><code class="language-javascript">&lt;template&gt;

 &lt;div&gt;
&lt;!--   {<!-- -->{shortPlays}}--&gt;
   &lt;el-tag style="margin-right: 5px" v-for="(tag,index) in shortPlaysFilter"
           :key="index" closable
           @close="close(index,tag.shortPlayName)"&gt;
     {<!-- -->{tag.shortPlayName}}
   &lt;/el-tag&gt;

   &lt;el-input
       v-if="inputVisible"
       v-model="inputValue"
       ref="ref"
       class="input-new-tag"
       size="small"
       style="width: 100px"
       @keyup.enter.native="inputConfirm"
       @blur="inputConfirm"
   &gt;&lt;/el-input&gt;
   &lt;el-button v-else size="small" style="margin-left: 5px;" @click="btnClick"&gt;新增合作方&lt;/el-button&gt;
 &lt;/div&gt;

&lt;/template&gt;

&lt;script&gt;
import * as mapRequest from "@/api/map";

export default {
  name: "ag_album_short_play_partner",
  props:{//这里外部的数据传入
    shortPlays:{
      required:true,
      default:()=&gt;{
        return [];
      }
    }
  },
  data() {
    return {
      inputVisible:false,
      inputValue:'',
    }
  },
  created() {
  },
  methods: {
    close(index,name){
      // 注意：这里的index 不能直接拿到删除 因为这个index 是过滤后的 所以通过name找下标 然后删除
      console.log("name",name);
      let findex=this.shortPlays.findIndex(f=&gt;f.shortPlayName==name);
      console.log("findex",findex);
      if(findex==-1 || findex&lt;0){
        this.$message.error("删除短剧合作方失败！请联系开发人员");
        return;
      }
      //console.log(findex);
      let data=this.shortPlays[findex];
      console.log("data",data);
      if(data.id){// 存在id 说明本身就有合作方 标记删除
        this.$set(data,'delFlag',true);
        this.$emit('input',this.shortPlays);
      }else{
        this.shortPlays.splice(findex,1);
        this.$emit('input',this.shortPlays);
      }
    },
    btnClick(){
      this.inputVisible=true;
      this.$nextTick(()=&gt;{
        this.$refs.ref.$refs.input.focus();
      })
    },
    inputConfirm(){
      let inputValue=this.inputValue;
      if(inputValue){
        mapRequest.addShortPlay({name:inputValue}).then(res=&gt;{
          let data=res.data.data;
          this.shortPlays.push({addFlag:true,shortPlayId:data.id,shortPlayName:data.name});
          this.$emit('input',this.shortPlays);
        }).catch(err=&gt;{
          this.$message.error("添加短剧合作方失败");
          console.log(err);
        })
      }
      this.inputVisible=false;
      this.inputValue='';
    }

  },
  computed: {
    shortPlaysFilter(){
      let obj=this.shortPlays.filter(item=&gt;{
        if(item.delFlag&amp;&amp;item.delFlag==true) return false;
        return true;
      });
      return obj;
    }
  },
  watch: {},
  components: {},

}
&lt;/script&gt;

&lt;style scoped&gt;

&lt;/style&gt;</code></pre> 
<p>这个就是封装的组件，然后想用的时候直接引用即可。</p> 
<h2>方案二</h2> 
<pre><code class="language-javascript">&lt;!--
删除逻辑：
1、原始tags中有delFlag true 这种数据不能展示，所以用 filteredTags 过滤
2、如果是本来存在的删除时可以标记delFlag true，如果时添加后(没点击提交动作，数据就没保存)又删除，这种直接删除即可 因为数据库没保存这些数据

[ { "addFlag": true, "shortPlayId": 8, "shortPlayName": "北京攸合" } ]
--&gt;
&lt;template&gt;
  &lt;div&gt;
&lt;!--    {<!-- -->{tags}}--&gt;
    &lt;el-tag v-for="(tag,index) in filteredTags" :key="index" closable @close="handleClose(index)"&gt;
      {<!-- -->{tag.shortPlayName}}
    &lt;/el-tag&gt;
    &lt;el-select v-model="bindModel" filterable clearable value-key="id"  placeholder="请选择短剧合作方" size="small" style="margin-left: 5px;width: 150px"&gt;
      &lt;el-option v-for="item in options" :key="item.id" :label="item.name" :value="item"&gt;
      &lt;/el-option&gt;
    &lt;/el-select&gt;
    &lt;el-button type="primary" size="small" style="margin-left: 5px" @click="addClick"&gt;添加&lt;/el-button&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import * as mapRequest from "@/api/map";
export default {
  name: "ag-album-short-play-partner-v2",
  props:{
    tags:{
      type:Array,
      required:true,
      default:()=&gt;{
        return [];
      }
    }
  },
  data() {
    return {
      bindModel:{

      },
      options:[],
    }
  },
  created() {
    this.getList();
  },
  methods: {
    getList(){
      this.options=JSON.parse('[{"id":8,"name":"北京攸合","createdAt":"2023-12-26 14:26:09","updatedAt":"2023-12-26 14:26:09"},{"id":9,"name":"网易","createdAt":"2024-01-03 10:13:37","updatedAt":"2024-01-03 10:13:37"}]');
      //这里是要请求后台数据的
      // mapRequest.findShortPlayList({},{}).then(res=&gt;{
      //   this.options=res.data.data.records;
      // }).catch(err=&gt;{
      //   this.$message.error(err.data.message);
      // })
    },
    handleClose(index){
      const tag=this.filteredTags[index];
      // console.log("-----",tag);
      if(tag==null){
        this.$message.error("删除错误！");
        return;
      }
      const originalIndex = this.tags.findIndex(t =&gt; t === tag);
      if (originalIndex !== -1 &amp;&amp; this.tags[originalIndex].id ) {
        this.$set(this.tags[originalIndex], 'delFlag', true);
        this.$emit('input', this.tags);
      }else if (originalIndex !=-1 &amp;&amp; (this.tags[originalIndex].id === null || this.tags[originalIndex].id === undefined)  ){
        this.tags.splice(originalIndex,1);
      }
      // this.$set(tag,'delFlag',true);
      // console.log("data",tag,",tags:",this.tags);
      // this.$emit('input',this.tags);


    },
    addClick(){
      // 请勿重复添加
      if(this.bindModel.id){
        // console.log("@@@",this.bindModel);
        let data=this.bindModel;
        this.tags.push({addFlag:true,shortPlayId:data.id,shortPlayName:data.name});
        // console.log("---",this.tags);
        this.$emit('input',this.tags);
        this.bindModel=null;
        return;
      }else{
        this.$message.warning("请选择合作方后再添加~");
        return;
      }

    },
  },
  computed: {
    filteredTags() {
      return this.tags.filter(tag =&gt; !tag.delFlag);
    }
  },
  watch: {},
  components: {},

}
&lt;/script&gt;

&lt;style scoped&gt;

&lt;/style&gt;</code></pre> 
<h2>最终就是外面的调用</h2> 
<pre><code class="language-javascript">&lt;!--
用来写测试案例
--&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;ag-album-short-play-partner :short-plays="shortPlays"&gt;&lt;/ag-album-short-play-partner&gt;
    &lt;ag-album-short-play-partner-v2 :tags="shortPlays"&gt;&lt;/ag-album-short-play-partner-v2&gt;
  &lt;/div&gt;


&lt;/template&gt;


&lt;script&gt;
import agAlbumShortPlayPartner from "@/views/longVideo/album/components/ag_album_short_play_partner";
import AgAlbumShortPlayPartnerV2 from "@/views/longVideo/album/components/ag_album_short_play_partner_v2";
export default {
  name:'videoDirUploadList',
  data(){
    return{
      data:{
        album:{

        }
      },
      shortPlays:[{"id":8,"albumId":44116442,"shortPlayId":9,"createdAt":"2024-01-04 15:50:59","updatedAt":"2024-01-04 15:50:59","shortPlayName":"网易","delFlag":"","addFlag":""}],

    }
  },
  created() {
  },
  methods:{
  

  },
  components:{
    AgAlbumShortPlayPartnerV2,
    agAlbumShortPlayPartner,
  }

}
&lt;/script&gt;

&lt;style&gt;
&lt;/style&gt;</code></pre> 
<p><span style="color:#e6b223;">ok，本期结束，关注作者不迷路～持续更新好用的组件～</span></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d6718f4d2f39551595f609d6171647de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Latex】Reference `tab:4‘ on page * undefined on input line *如何解决？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e069e16f23747fe0538362c165e89080/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">AOP（面向切面编程）的基本概念和原理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>