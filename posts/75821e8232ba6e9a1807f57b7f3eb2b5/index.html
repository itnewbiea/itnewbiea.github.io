<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>10. spark学习之旅之sbt（四） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="10. spark学习之旅之sbt（四）" />
<meta property="og:description" content="文章目录 1. [依赖jar包的查找地址 Maven Repository仓库](https://mvnrepository.com/)2. scala中的项目管理工具sbt2.1.软件安装和配置2.2. [sbt官网案例](https://www.scala-sbt.org/1.x/docs/sbt-by-example.html) 3. sbt进阶3.1. 操作符3.2. task，里面可以定义task，task可以是执行外部的命令3.3. 待完善 4. spark之rdd小案例（`sbt构建`）4.1. PV计算4.2. UV计算4.3. TOPN 5. 所有命运赠送的礼物，早已在暗中标着价格。 1. 依赖jar包的查找地址 Maven Repository仓库 2. scala中的项目管理工具sbt sbt是类似ANT、MAVEN的构建工具，全称为Simple build tool，是Scala事实上的标准构建工具
2.1.软件安装和配置 sbt官网
Scala sbt的下载及安装
Linux安装sbt,修改镜像参照windows平台的方法
通过sbt管理项目，要在build.properties中的版本改成与本地安装一直，不然会用idea自己捆绑的
windows下安装配置sbt (重要)
安装软件到位置：D:\dev\sbt
sbt安装目录下的conf目录中添加了一个repo.properties文件
[repositories] local maven-local:file://D:/apache-maven-3.5.4/local_repository nexus-aliyun: https://maven.aliyun.com/nexus/content/groups/public/ nexus-aliyun-apache: https://maven.aliyun.com/nexus/content/repositories/apache-snapshots/ mapr-public: https://maven.aliyun.com/repository/mapr-public/ typesafe: https://repo.typesafe.com/typesafe/ivy-releases/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext], bootOnly huaweicloud-maven: https://repo.huaweicloud.com/repository/maven/ sbt-plugin-repo: https://repo.scala-sbt.org/scalasbt/sbt-plugin-releases, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext] sbtconfig.txt配置
-Dsbt.ivy.home=d:/sbt/.ivy2 -Dsbt.global.base=d:/sbt/.sbt -Dsbt.repository.config=d:/sbt/conf/repo.properties -Dsbt.boot.directory=d:/sbt/.sbt/boot/ -Dsbt.override.build.repos=true IDEA当中的配置
IDEA中创建maven工程后没有scala文件
注意1：第一次输入sbt的时候需要准备一些东西，所以下载比较慢，主要下载内容已经放到了我的百度云盘：windows10平台，.ivy2和.sbt默认在c盘用的家目录下面，建议配置到自己的安装目录下面，方便管理注意2：遇到了一个错误There may be incompatibilities among your library dependencies; run &#39;evicted 解决： 需要把C:\Users\59404\AppData\Local\Temp目录下的内容清理一下，由于安装了多个版本导致。 ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/75821e8232ba6e9a1807f57b7f3eb2b5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-02-17T17:59:03+08:00" />
<meta property="article:modified_time" content="2020-02-17T17:59:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">10. spark学习之旅之sbt（四）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__jar_Maven_Repositoryhttpsmvnrepositorycom_1" rel="nofollow">1. [依赖jar包的查找地址 Maven Repository仓库](https://mvnrepository.com/)</a></li><li><a href="#2_scalasbt_3" rel="nofollow">2. scala中的项目管理工具sbt</a></li><li><ul><li><a href="#21_5" rel="nofollow">2.1.软件安装和配置</a></li><li><a href="#22_sbthttpswwwscalasbtorg1xdocssbtbyexamplehtml_57" rel="nofollow">2.2. [sbt官网案例](https://www.scala-sbt.org/1.x/docs/sbt-by-example.html)</a></li></ul> 
  </li><li><a href="#3__sbt_59" rel="nofollow">3. sbt进阶</a></li><li><ul><li><a href="#31__60" rel="nofollow">3.1. 操作符</a></li><li><a href="#32_tasktasktask_65" rel="nofollow">3.2. task，里面可以定义task，task可以是执行外部的命令</a></li><li><a href="#33__161" rel="nofollow">3.3. 待完善</a></li></ul> 
  </li><li><a href="#4_sparkrddsbt_163" rel="nofollow">4. spark之rdd小案例（`sbt构建`）</a></li><li><ul><li><a href="#41_PV_164" rel="nofollow">4.1. PV计算</a></li><li><a href="#42_UV_183" rel="nofollow">4.2. UV计算</a></li><li><a href="#43_TOPN_202" rel="nofollow">4.3. TOPN</a></li></ul> 
  </li><li><a href="#5__223" rel="nofollow">5. 所有命运赠送的礼物，早已在暗中标着价格。</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__jar_Maven_Repositoryhttpsmvnrepositorycom_1"></a>1. <a href="https://mvnrepository.com/" rel="nofollow">依赖jar包的查找地址 Maven Repository仓库</a></h2> 
<h2><a id="2_scalasbt_3"></a>2. scala中的项目管理工具sbt</h2> 
<p><code>sbt是类似ANT、MAVEN的构建工具，全称为Simple build tool，是Scala事实上的标准构建工具</code></p> 
<h3><a id="21_5"></a>2.1.软件安装和配置</h3> 
<ul><li> <p><a href="https://www.scala-sbt.org/download.html" rel="nofollow">sbt官网</a></p> </li><li> <p><a href="https://jingyan.baidu.com/article/3c48dd34db0dd5e10be358a8.html" rel="nofollow">Scala sbt的下载及安装</a></p> </li><li> <p><a href="https://blog.csdn.net/qq_37502106/article/details/80499860">Linux安装sbt,修改镜像参照windows平台的方法</a></p> </li><li> <p><code>通过sbt管理项目，要在build.properties中的版本改成与本地安装一直，不然会用idea自己捆绑的</code><br> <img src="https://images2.imgbox.com/24/8d/OZKXIJD5_o.png" alt="在这里插入图片描述"></p> </li><li> <p><a href="https://blog.csdn.net/conggova/article/details/84957566">windows下安装配置sbt</a> (<code>重要</code>)</p> 
  <ul><li> <p><mark>安装软件到位置：D:\dev\sbt</mark></p> </li><li> <p><mark>sbt安装目录下的conf目录中添加了一个repo.properties文件</mark></p> <pre><code>[repositories]
  local
  maven-local:file://D:/apache-maven-3.5.4/local_repository
  nexus-aliyun: https://maven.aliyun.com/nexus/content/groups/public/
  nexus-aliyun-apache: https://maven.aliyun.com/nexus/content/repositories/apache-snapshots/
  mapr-public: https://maven.aliyun.com/repository/mapr-public/
  typesafe: https://repo.typesafe.com/typesafe/ivy-releases/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext], bootOnly
  huaweicloud-maven: https://repo.huaweicloud.com/repository/maven/
  sbt-plugin-repo: https://repo.scala-sbt.org/scalasbt/sbt-plugin-releases, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext]

</code></pre> </li><li> <p><mark>sbtconfig.txt配置</mark></p> <pre><code>-Dsbt.ivy.home=d:/sbt/.ivy2
-Dsbt.global.base=d:/sbt/.sbt
-Dsbt.repository.config=d:/sbt/conf/repo.properties
-Dsbt.boot.directory=d:/sbt/.sbt/boot/
-Dsbt.override.build.repos=true
</code></pre> </li><li> <p><mark>IDEA当中的配置</mark><br> <img src="https://images2.imgbox.com/b3/cb/5axK9akc_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6d/f1/ElyJtMTA_o.png" alt="在这里插入图片描述"></p> </li></ul> </li><li> <p><a href="http://blog.sina.com.cn/s/blog_92fe08db0102xq93.html" rel="nofollow">IDEA中创建maven工程后没有scala文件</a></p> 
  <ul><li><code>注意1：第一次输入sbt的时候需要准备一些东西，所以下载比较慢，主要下载内容已经放到了我的百度云盘：windows10平台，.ivy2和.sbt默认在c盘用的家目录下面，建议配置到自己的安装目录下面，方便管理</code></li><li><code>注意2：遇到了一个错误There may be incompatibilities among your library dependencies; run 'evicted</code> 
    <ul><li>解决： 需要把C:\Users\59404\AppData\Local\Temp目录下的内容清理一下，由于安装了多个版本导致。</li></ul> </li><li><a href="https://pan.baidu.com/s/1XjPNA4CuaOVuzftftxLGOg" rel="nofollow">.ivy2和.sbt百度云链接；提取码 dxoj</a><br> <img src="https://images2.imgbox.com/80/18/AUnMONZj_o.png" alt="在这里插入图片描述"></li></ul> </li></ul> 
<h3><a id="22_sbthttpswwwscalasbtorg1xdocssbtbyexamplehtml_57"></a>2.2. <a href="https://www.scala-sbt.org/1.x/docs/sbt-by-example.html" rel="nofollow">sbt官网案例</a></h3> 
<h2><a id="3__sbt_59"></a>3. sbt进阶</h2> 
<h3><a id="31__60"></a>3.1. 操作符</h3> 
<ul><li><code>:=</code> 是给key分配一个初始表达式，覆盖原来的任何配置</li><li><code>+=</code> 是追加一个值到key</li><li><code>++=</code> 是追加一个队列，队列中放值，将值追加到key</li></ul> 
<h3><a id="32_tasktasktask_65"></a>3.2. task，里面可以定义task，task可以是执行外部的命令</h3> 
<ul><li> <p>案例一</p> <pre><code>// 定义了task的类型为Unit，Key值叫helloTask
val helloTask = taskKey[Unit]("say hello")

helloTask := {
  print("hello task!")
}
</code></pre> <p><img src="https://images2.imgbox.com/aa/80/BtcUBp43_o.png" alt="在这里插入图片描述"></p> </li><li> <p>案例二（<code>task之间没有依赖关系</code>）</p> <pre><code>val helloTask = taskKey[String]("say hello")
val hiTask = taskKey[String]("say hi")
val byeTask = taskKey[String]("say bye")

val runAllTask = taskKey[Unit]("run all")

runAllTask := {
  println(helloTask.value)
  println(hiTask.value)
  println(byeTask.value)
}

helloTask := {
  val hello = "hello"
  println(s"hello task run: $hello")
  Thread sleep 2000
  hello
}

hiTask := {
  val hi = "hi"
  println(s"hi task run: $hi")
  Thread sleep 2000
  hi
}

byeTask := {
  val bye = "bye"
  println(s"bye task run: $bye")
  Thread sleep 2000
  bye
}
</code></pre> <p><img src="https://images2.imgbox.com/4e/7b/1d6clF8C_o.png" alt="在这里插入图片描述"></p> </li><li> <p>案例三（<code>有依赖关系</code>）</p> <pre><code>val helloTask = taskKey[String]("say hello")
val hiTask = taskKey[String]("say hi")
val byeTask = taskKey[String]("say bye")

val runAllTask = taskKey[Unit]("run all")

runAllTask := {
  println(helloTask.value)
  println(hiTask.value)
  println(byeTask.value)
}

helloTask := {
  val hello = "hello"
  println(s"hello task run: $hello")
  Thread sleep 2000
  hello
}

hiTask := {
  val hi = "hi"
  println(s"hi task run: $hi")
  Thread sleep 2000
  hi
}

byeTask := {
  val hi = hiTask.value
  val bye = "bye"
  println(s"hi task run: $hi")
  println(s"bye task run: $bye")
  Thread sleep 2000
  bye
}
</code></pre> <p><img src="https://images2.imgbox.com/e3/10/JnUpcmPx_o.png" alt="在这里插入图片描述"></p> </li><li> <p><mark>结论</mark></p> 
  <ul><li><code>在没有依赖关系的时候是并行，但有依赖关系就是串行，如果我们再设置hi依赖hello，那么就是6s</code></li><li><code>如果互相依赖可能造成死锁，比如a依赖b的value，b里面又依赖a的value，那么就是鸡生蛋和蛋生鸡的问题了</code></li></ul> </li><li> <p><a href="https://blog.csdn.net/cjuexuan/article/details/50574750">详细链接</a></p> </li></ul> 
<h3><a id="33__161"></a>3.3. 待完善</h3> 
<h2><a id="4_sparkrddsbt_163"></a>4. spark之rdd小案例（<code>sbt构建</code>）</h2> 
<h3><a id="41_PV_164"></a>4.1. PV计算</h3> 
<pre><code>import org.apache.spark.rdd.RDD
import org.apache.spark.{SparkConf, SparkContext}

object PV {
  def main(args: Array[String]): Unit = {
    val conf = new SparkConf().setAppName("pv").setMaster("local[2]")
    val sc = new SparkContext(conf)

    val result: RDD[(String, Int)] = sc.textFile("D:\\access.log").map(x =&gt; ("pv", 1)).reduceByKey(_ + _)
    result.foreach(println)

  }
}


</code></pre> 
<h3><a id="42_UV_183"></a>4.2. UV计算</h3> 
<pre><code>import org.apache.spark.rdd.RDD
import org.apache.spark.{SparkConf, SparkContext}

object UV {
  def main(args: Array[String]): Unit = {
    val conf = new SparkConf().setAppName("pv").setMaster("local[2]")
    val sc = new SparkContext(conf)

    val result: RDD[(String, Int)] = sc.textFile("D:\\access.log").map(_.split(" ")).map(x =&gt; x(0)).distinct().map(x =&gt; ("uv", 1)).reduceByKey(_+_)
    result.foreach(println)

  }
}

</code></pre> 
<h3><a id="43_TOPN_202"></a>4.3. TOPN</h3> 
<ul><li>数据格式<br> <img src="https://images2.imgbox.com/ad/fb/J3uk1CUr_o.png" alt="在这里插入图片描述"></li></ul> 
<pre><code>import org.apache.spark.{SparkConf, SparkContext}

object TopN {
  def main(args: Array[String]): Unit = {
    val conf = new SparkConf().setAppName("pv").setMaster("local[2]")
    val sc = new SparkContext(conf)

    val result: Array[(String, Int)] = sc.textFile("access.log").map(_.split(" ")).map(x =&gt; x(10)).map((_, 1)).reduceByKey(_ + _).sortBy(_._2, false).take(3)
    println(result)
  }
}

</code></pre> 
<h2><a id="5__223"></a>5. 所有命运赠送的礼物，早已在暗中标着价格。</h2>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7efc636f78ea8da708731ca141bef8d2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Matlab-函数拟合</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/03faa82f26f03d6e03b686ab3c079143/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">RESLAM/ REVO 编译  实时RGBD基于边缘的slam系统</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>