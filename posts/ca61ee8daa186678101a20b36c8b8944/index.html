<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>pyhton根据城市名称获取省份名称 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="pyhton根据城市名称获取省份名称" />
<meta property="og:description" content="获取地理数据
Fetching geodata with geopy
在Feature Engineering的环节中经常会遇到地理数据的处理。地理数据通常包括地市\省份\经纬度等信息，这些不同level的特征可以被利用在模型训练中。
但是通常我们能拿到的数据只是部分信息，如果想要增加特征维度，Python的geopy是一个获取geographic data很好的package。它内含地区的完整地址和经度纬度，并且支持包括中英文在内的多语言输入。
以下是geopy的基本查询方式：
!pip install geopy from geopy.geocoders import Nominatim # initiate nominatim geolocator = Nominatim(user_agent=&#34;aaa515&#34;) # search for location location = geolocator.geocode(&#34;广州市&#34;) print(location.address) print((location.latitude, location.longitude)) print(location.raw) &gt;&gt;&gt;广州市, 广东省, China 中国 &gt;&gt;&gt;(23.1301964, 113.2592945) &gt;&gt;&gt;{&#39;place_id&#39;: 235779999, &#39;licence&#39;: &#39;Data © OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright&#39;, &#39;osm_type&#39;: &#39;relation&#39;, &#39;osm_id&#39;: 3287346, &#39;boundingbox&#39;: [&#39;22.5176916&#39;, &#39;23.9360754&#39;, &#39;112.9529252&#39;, &#39;114.0500833&#39;], &#39;lat&#39;: &#39;23.1301964&#39;, &#39;lon&#39;: &#39;113.2592945&#39;, &#39;display_name&#39;: &#39;广州市, 广东省, China 中国&#39;, &#39;class&#39;: &#39;boundary&#39;, &#39;type&#39;: &#39;administrative&#39;, &#39;importance&#39;: 0." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ca61ee8daa186678101a20b36c8b8944/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-03T11:09:32+08:00" />
<meta property="article:modified_time" content="2021-11-03T11:09:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">pyhton根据城市名称获取省份名称</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>获取地理数据<br> Fetching geodata with geopy<br> 在Feature Engineering的环节中经常会遇到地理数据的处理。地理数据通常包括地市\省份\经纬度等信息，这些不同level的特征可以被利用在模型训练中。</p> 
<p>但是通常我们能拿到的数据只是部分信息，如果想要增加特征维度，Python的geopy是一个获取geographic data很好的package。它内含地区的完整地址和经度纬度，并且支持包括中英文在内的多语言输入。</p> 
<p>以下是geopy的基本查询方式：</p> 
<pre><code class="prism language-python">!pip install geopy
<span class="token keyword">from</span> geopy<span class="token punctuation">.</span>geocoders <span class="token keyword">import</span> Nominatim
<span class="token comment"># initiate nominatim</span>
geolocator <span class="token operator">=</span> Nominatim<span class="token punctuation">(</span>user_agent<span class="token operator">=</span><span class="token string">"aaa515"</span><span class="token punctuation">)</span>
<span class="token comment"># search for location</span>
location <span class="token operator">=</span> geolocator<span class="token punctuation">.</span>geocode<span class="token punctuation">(</span><span class="token string">"广州市"</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>address<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>latitude<span class="token punctuation">,</span> location<span class="token punctuation">.</span>longitude<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>location<span class="token punctuation">.</span>raw<span class="token punctuation">)</span>

<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span>广州市<span class="token punctuation">,</span> 广东省<span class="token punctuation">,</span> China 中国
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token number">23.1301964</span><span class="token punctuation">,</span> <span class="token number">113.2592945</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">{<!-- --></span><span class="token string">'place_id'</span><span class="token punctuation">:</span> <span class="token number">235779999</span><span class="token punctuation">,</span> <span class="token string">'licence'</span><span class="token punctuation">:</span> <span class="token string">'Data © OpenStreetMap contributors, ODbL 1.0. https://osm.org/copyright'</span><span class="token punctuation">,</span> <span class="token string">'osm_type'</span><span class="token punctuation">:</span> <span class="token string">'relation'</span><span class="token punctuation">,</span> <span class="token string">'osm_id'</span><span class="token punctuation">:</span> <span class="token number">3287346</span><span class="token punctuation">,</span> <span class="token string">'boundingbox'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'22.5176916'</span><span class="token punctuation">,</span> <span class="token string">'23.9360754'</span><span class="token punctuation">,</span> <span class="token string">'112.9529252'</span><span class="token punctuation">,</span> <span class="token string">'114.0500833'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'lat'</span><span class="token punctuation">:</span> <span class="token string">'23.1301964'</span><span class="token punctuation">,</span> <span class="token string">'lon'</span><span class="token punctuation">:</span> <span class="token string">'113.2592945'</span><span class="token punctuation">,</span> <span class="token string">'display_name'</span><span class="token punctuation">:</span> <span class="token string">'广州市, 广东省, China 中国'</span><span class="token punctuation">,</span> <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token string">'boundary'</span><span class="token punctuation">,</span> <span class="token string">'type'</span><span class="token punctuation">:</span> <span class="token string">'administrative'</span><span class="token punctuation">,</span> <span class="token string">'importance'</span><span class="token punctuation">:</span> <span class="token number">0.6885781941264866</span><span class="token punctuation">,</span> <span class="token string">'icon'</span><span class="token punctuation">:</span> <span class="token string">'https://nominatim.openstreetmap.org/images/mapicons/poi_boundary_administrative.p.20.png'</span><span class="token punctuation">}</span>

</code></pre> 
<p>获取中国城市所属省份<br> mapping provinces for Chinese cities<br> 当只有城市信息时，我们想得到对应的省份信息，需要用regrex expression将address中包含‘省’的字段提取出来。PS.因为re不能直接匹配中文，所以我们需要利用encode-decode将中文的utf-8编码进行decode后，再与中文地址进行匹配。</p> 
<pre><code class="prism language-python"><span class="token string">'省'</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token string">b'\xe7\x9c\x81'</span>

<span class="token keyword">import</span> re
re<span class="token punctuation">.</span>findall<span class="token punctuation">(</span><span class="token string">b'\w+\xe7\x9c\x81'</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'广州市, 广东省, China 中国'</span><span class="token punctuation">)</span>
<span class="token operator">&gt;&gt;</span><span class="token operator">&gt;</span><span class="token punctuation">[</span><span class="token string">'广东省'</span><span class="token punctuation">]</span>

</code></pre> 
<p>总结<br> Python geopy能获取完整的地理信息，包括地名，省份，lat, long。<br> 使用Regrex expression匹配中文时需要做一些转换，点击链接可查看现成def function：<br> 中文城市省份匹配 - CityToProvince mapping<br> 参考链接：https://blog.csdn.net/qq_44695832/article/details/105915424</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/fe2b27cf9cbd4a3e02b54ad02061336a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python中使用time.pref_counter()精确计时</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/59cd252e6c0eb94a636e7fbc47ecd6fe/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">认识常见的显卡外接口</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>