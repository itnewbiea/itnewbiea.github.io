<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>建立信任关系失败 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="建立信任关系失败" />
<meta property="og:description" content="情况一：权限问题：
现象：A建立与B的信任关系，但是建立失败
解决：查看B的用户下.ssh/authorized_keys的权限，只能是700，或者是644，不能是其他
情况二：关于ssh信任关系--每台主机指定不同的私钥文件
当主机与10.11.70.25创建了信任关系后，每次ssh远程登陆10.11.70.25时都要求输入密码，如下：
linux:/etc/ssh/# ssh 10.11.70.25
Authorized users only. All activity may be monitored and reported.
Password: 排查了/etc/ssh/sshd_config中
#RSAAuthentication yes
#PubkeyAuthentication yes
#AuthorizedKeysFile .ssh/authorized_keys
都是默认的yes。
（
补充说明：
OpenSSH 的服务端配置文件一般为 /etc/ssh/sshd_config，和公钥认证有关的两个配置项是：
#RSAAuthentication yes
#PubkeyAuthentication yes
其缺省值一般为 yes。如果希望仅打开公钥认证，禁用其他的认证方式，则可以修改下列配置项：
PasswordAuthentication no
ChallengeResponseAuthentication no
UsePAM no
上述配置项如果有任何需要修改的地方在修改之后重启ssh服务器让新的设置生效。
）
最后排查到ssh_config配置文件，内容如下：
linux:/etc/ssh/# cat /etc/ssh/ssh_config
# Site-wide defaults for some commonly used options. For a comprehensive
# list of available options, their meanings and defaults, please see the" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1b6e98d22a5807cb3dec0f2cc514dcb0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-02-20T17:31:10+08:00" />
<meta property="article:modified_time" content="2014-02-20T17:31:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">建立信任关系失败</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>情况一：权限问题：</p> 
<p>现象：A建立与B的信任关系，但是建立失败</p> 
<p>解决：查看B的用户下.ssh/authorized_keys的权限，只能是700，或者是644，不能是其他</p> 
<p> </p> 
<p>情况二：关于ssh信任关系--每台主机指定不同的私钥文件<br> 当主机与10.11.70.25创建了信任关系后，每次ssh远程登陆10.11.70.25时都要求输入密码，如下：<br> linux:/etc/ssh/# ssh 10.11.70.25<br> Authorized users only. All activity may be monitored and reported.<br> Password: </p> 
<p>排查了/etc/ssh/sshd_config中<br> #RSAAuthentication yes<br> #PubkeyAuthentication yes<br> #AuthorizedKeysFile      .ssh/authorized_keys<br> 都是默认的yes。<br> （<br> 补充说明：<br> OpenSSH 的服务端配置文件一般为 /etc/ssh/sshd_config，和公钥认证有关的两个配置项是：<br> #RSAAuthentication yes<br> #PubkeyAuthentication yes<br> 其缺省值一般为 yes。如果希望仅打开公钥认证，禁用其他的认证方式，则可以修改下列配置项：<br> PasswordAuthentication no<br> ChallengeResponseAuthentication no<br> UsePAM no<br> 上述配置项如果有任何需要修改的地方在修改之后重启ssh服务器让新的设置生效。<br> ）</p> 
<p>最后排查到ssh_config配置文件，内容如下：<br> linux:/etc/ssh/# cat /etc/ssh/ssh_config</p> 
<p># Site-wide defaults for some commonly used options.  For a comprehensive<br> # list of available options, their meanings and defaults, please see the<br> # ssh_config(5) man page.</p> 
<p>Host *<br> #   ForwardAgent no<br> #   ForwardX11 no</p> 
<p># If you do not trust your remote host (or its administrator), you<br> # should not forward X11 connections to your local X11-display for<br> # security reasons: Someone stealing the authentification data on the<br> # remote side (the "spoofed" X-server by the remote sshd) can read your<br> # keystrokes as you type, just like any other X11 client could do.<br> # Set this to "no" here for global effect or in your own ~/.ssh/config<br> # file if you want to have the remote X11 authentification data to <br> # expire after two minutes after remote login.<br> ForwardX11Trusted yes</p> 
<p>#   RhostsRSAAuthentication no<br> #   RSAAuthentication yes<br> #   PasswordAuthentication yes<br> #   HostbasedAuthentication no<br> #   GSSAPIAuthentication no<br> #   GSSAPIDelegateCredentials no<br> #   BatchMode no<br> #   CheckHostIP yes<br> #   AddressFamily any<br> #   ConnectTimeout 0<br> #   StrictHostKeyChecking ask<br> #   IdentityFile ~/.ssh/identity<br> #   IdentityFile ~/.ssh/id_rsa<br> #   IdentityFile ~/.ssh/id_dsa<br> #   Port 22<br>     Protocol 2<br> #   Cipher 3des<br> #   Ciphers aes128-cbc,3des-cbc,blowfish-cbc,cast128-cbc,arcfour,aes192-cbc,aes256-cbc<br> #   MACs hmac-md5,hmac-sha1,umac-64@openssh.com,hmac-ripemd160<br> #   EscapeChar ~<br> #   Tunnel no<br> #   TunnelDevice any:any<br> #   PermitLocalCommand no<br> #   GSSAPIAuthentication no<br> #   GSSAPIDelegateCredentials no </p> 
<p># Set this to 'yes' to enable support for the deprecated 'gssapi' authentication<br> # mechanism to OpenSSH 3.8p1. The newer 'gssapi-with-mic' mechanism is included<br> # in this release. The use of 'gssapi' is deprecated due to the presence of <br> # potential man-in-the-middle attacks, which 'gssapi-with-mic' is not susceptible to.<br> #   GSSAPIEnableMITMAttack no</p> 
<p># This enables sending locale enviroment variables LC_* LANG, see ssh_config(5).<br> SendEnv LANG LC_CTYPE LC_NUMERIC LC_TIME LC_COLLATE LC_MONETARY LC_MESSAGES<br> SendEnv LC_PAPER LC_NAME LC_ADDRESS LC_TELEPHONE LC_MEASUREMENT<br> SendEnv LC_IDENTIFICATION LC_ALL<br> IdentityFile ~/.ssh/identification</p> 
<p>文件末尾多了一行IdentityFile的定义，重新定义了IdentityFile为~/.ssh/identification</p> 
<p>说明：<br> 当主机中有多个密钥对的情况下，可以通过设置 /etc/ssh/ssh_config中对不同的主机和用户使用不同的私钥文件。如下例：<br> Host *    <br> IdentityFile <a target="_blank" href="mailto:~/.ssh/%r@%h" rel="nofollow noopener noreferrer">~/.ssh/%r@%h</a></p> 
<p>对所有主机使用私钥文件路径和名称格式为：<a target="_blank" href="mailto:~/.ssh/%r@%h" rel="nofollow noopener noreferrer">~/.ssh/%r@%h</a></p> 
<p>Host 10.11.70.25<br> IdentityFile ~/.ssh/id_dsa141<br> 只对远程主机10.11.70.25进行ssh连接时，使用的私钥文件为~/.ssh/id_dsa141</p> 
<p>而实际上我们的私钥文件还是使用的默认的~/.ssh/id_rsa<br> 文件ssh_config中配置为了IdentityFile ~/.ssh/identification，导致远程登陆时私钥文件系统默认找identification，而不是id_rsa。<br> 因此每次都需要重新输入密码。</p> 
<p>修改方法：<br> 删除掉或是注释掉最后一行：<br> #IdentityFile ~/.ssh/identification</p> 
<p>修改后，文件配置文件是即时生效，无需重启ssh服务。<br> linux:~/.ssh # ssh 10.11.70.25<br> Authorized users only. All activity may be monitored and reported.<br> Last login: Thu Feb 20 15:23:10 2014 from 10.18.56.23<br> Authorized users only. All activity may be monitored and reported.<br> linux101:~ # ls</p> 
<p>顺利登陆远程服务器10.11.70.25，问题解决。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/cdb4bfcfb69aae60bc108d6d64aab7b8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【转】什么是P问题、NP问题和NPC问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/19c486a0911484d6859be593f11e3012/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">源码的管理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>