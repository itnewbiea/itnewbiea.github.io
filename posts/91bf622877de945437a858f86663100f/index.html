<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>el-date-picker 日期组件切换的坑 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="el-date-picker 日期组件切换的坑" />
<meta property="og:description" content="el-date-picker 日期组件切换的坑 问题描述：
问题1. 根据类型切换需要的时间选择器组件（搜索栏是一个form组件，里面有input、select、picker等，在使用的页面里传入指定的类型就能展示）第一次按顺序切换日常发，周常发，月常发是没问题的，但是当第二次选择周常发时，选择器无变化，然后再一次切换会出现上一次应该出现的选择器，并且会有 问题2. 选择器错位的现象 解决：
传给后端的值为 startTIme、endTime但实际选择器保存的是一个未格式化的时间，问题1：应该在每次切换select值后删除日期的值（为了处理后端需要的数据格式因此日 周 月保存的时间值是同一个）问题2：在form组件中给每个picker添加key 完整的formComponent组件
&lt;!-- * @Description: form组件 页面 * @Use: type可选值：&#39;&#39;,numberInput,select,dept,radio,switch,date,daterange,dateNoTime,datetimerange * @Author: mhf * @Date: 2023-06-29 17:08:33 --&gt; &lt;!-- eslint-disable vue/no-mutating-props --&gt; &lt;template&gt; &lt;div class=&#34;search-component&#34;&gt; &lt;!-- 表单区域 --&gt; &lt;el-form ref=&#34;formRef&#34; :model=&#34;form&#34; :inline=&#34;inline&#34; :rules=&#34;formRules&#34;&gt; &lt;el-form-item v-for=&#34;(item, index) in formLabel&#34; :key=&#34;index&#34; :label=&#34;item.label &#43; &#39; :&#39;&#34; :prop=&#34;item.value&#34; &gt; &lt;el-input v-if=&#34;!item.type&#34; v-model.trim=&#34;form[item.value]&#34; :placeholder=&#34;&#39;请输入&#39; &#43; item.label&#34; size=&#34;small&#34; :type=&#34;item.type ? item.type : &#39;text&#39;&#34; /&gt; &lt;el-input v-if=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/91bf622877de945437a858f86663100f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-29T11:45:40+08:00" />
<meta property="article:modified_time" content="2023-12-29T11:45:40+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">el-date-picker 日期组件切换的坑</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" height="149" src="https://images2.imgbox.com/c4/41/X5TkDqlP_o.png" width="496"></p> 
<p><img alt="" height="253" src="https://images2.imgbox.com/32/e9/U67FoJVW_o.png" width="836"></p> 
<p> </p> 
<h2>el-date-picker 日期组件切换的坑</h2> 
<p>问题描述：</p> 
<blockquote> 
 <pre>问题1. 根据类型切换需要的时间选择器组件（搜索栏是一个form组件，里面有input、select、picker等，在使用的页面里传入指定的类型就能展示）第一次按顺序切换日常发，周常发，月常发是没问题的，但是当第二次选择周常发时，选择器无变化，然后再一次切换会出现上一次应该出现的选择器，并且会有 问题2. 选择器错位的现象</pre> 
</blockquote> 
<p>解决：</p> 
<blockquote> 
 <pre>传给后端的值为 startTIme、endTime但实际选择器保存的是一个未格式化的时间，问题1：应该在每次切换select值后删除日期的值（为了处理后端需要的数据格式因此日 周 月保存的时间值是同一个）问题2：在form组件中给每个picker添加key</pre> 
</blockquote> 
<p></p> 
<p>完整的formComponent组件</p> 
<pre><code class="language-html">&lt;!--
 * @Description: form组件 页面
 * @Use: type可选值：'',numberInput,select,dept,radio,switch,date,daterange,dateNoTime,datetimerange
 * @Author: mhf
 * @Date: 2023-06-29 17:08:33
--&gt;
&lt;!-- eslint-disable vue/no-mutating-props --&gt;
&lt;template&gt;
  &lt;div class="search-component"&gt;
    &lt;!-- 表单区域 --&gt;
    &lt;el-form ref="formRef" :model="form" :inline="inline" :rules="formRules"&gt;
      &lt;el-form-item
        v-for="(item, index) in formLabel"
        :key="index"
        :label="item.label + ' :'"
        :prop="item.value"
      &gt;
        &lt;el-input
          v-if="!item.type"
          v-model.trim="form[item.value]"
          :placeholder="'请输入' + item.label"
          size="small"
          :type="item.type ? item.type : 'text'"
        /&gt;
        &lt;el-input
          v-if="item.type === 'numberInput'"
          v-model.number="form[item.value]"
          :placeholder="'请输入' + item.label"
          size="small"
        /&gt;
        &lt;el-select
          v-if="item.type === 'select'"
          v-model.trim="form[item.value]"
          filterable
          :placeholder="'请选择' + item.label"
          clearable
          size="small"
        &gt;
          &lt;el-option
            v-for="(items, index) in item.opts"
            :key="index"
            :label="items[item.optLabel]"
            :value="items[item.optValue]"
            @click.native="selectClick(item, items)"
          /&gt;
        &lt;/el-select&gt;
        &lt;treeselect
          v-if="item.type === 'dept'"
          v-model="form[item.value]"
          class="treeBox"
          :options="item.opts"
          :show-count="true"
          :placeholder="'请选择' + item.label"
        /&gt;
        &lt;template v-if="item.type === 'radio'"&gt;
          &lt;el-radio
            v-for="items in item.opts"
            :key="items.value"
            v-model="form[item.value]"
            :label="items.value"
            &gt;{<!-- -->{ items.label }}
          &lt;/el-radio&gt;
        &lt;/template&gt;
        &lt;el-switch v-if="item.type === 'switch'" v-model="form[item.value]" /&gt;
        &lt;el-date-picker
          v-if="item.type === 'date'"
          key="date"
          v-model="form[item.value]"
          type="date"
          placeholder="选择日期"
          value-format="yyyy-MM-dd HH:mm:ss"
        /&gt;
        &lt;el-date-picker
          v-if="item.type === 'dateNoTime'"
          key="dateNoTime"
          v-model="form[item.value]"
          type="date"
          placeholder="选择日期"
          value-format="yyyy-MM-dd"
        /&gt;
        &lt;el-date-picker
          v-if="item.type === 'datetimerange'"
          key="datetimerange"
          v-model="form[item.value]"
          type="datetimerange"
          :picker-options="pickerOptions"
          range-separator="至"
          start-placeholder="开始日期"
          end-placeholder="结束日期"
          align="right"
          value-format="yyyy-MM-dd HH:mm:ss"
        /&gt;
        &lt;el-date-picker
          v-if="item.type === 'daterange'"
          key="daterange"
          v-model="form[item.value]"
          type="daterange"
          :picker-options="pickerOptions"
          range-separator="至"
          start-placeholder="开始日期"
          end-placeholder="结束日期"
          align="right"
          value-format="yyyy-MM-dd"
          @change="daterangeChange"
        /&gt;
        &lt;el-date-picker
          v-if="item.type === 'week'"
          key="week"
          v-model="form[item.value]"
          type="week"
          format="yyyy 第 WW 周"
          placeholder="选择周"
          @change="weekChange"
        &gt;
        &lt;/el-date-picker&gt;
        &lt;el-date-picker
          v-if="item.type === 'month'"
          key="month"
          v-model="form[item.value]"
          type="month"
          placeholder="选择月"
          value-format="yyyy-MM-dd"
          @change="monthChange"
        &gt;
        &lt;/el-date-picker&gt;
      &lt;/el-form-item&gt;
      &lt;el-form-item&gt;
        &lt;slot name="formSlot" /&gt;
      &lt;/el-form-item&gt;
      &lt;div v-if="showOperationBtn" class="right-handle"&gt;
        &lt;el-form-item&gt;
          &lt;el-button
            type="primary"
            size="small"
            icon="el-icon-search"
            @click="handleSearch"
            &gt;查询
          &lt;/el-button&gt;
          &lt;el-button
            size="small"
            icon="el-icon-refresh"
            @click="handleResetFrom"
            &gt;重置
          &lt;/el-button&gt;
        &lt;/el-form-item&gt;
        &lt;el-form-item /&gt;
        &lt;el-form-item&gt;
          &lt;slot name="handleSlot" /&gt;
        &lt;/el-form-item&gt;
      &lt;/div&gt;
    &lt;/el-form&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
export default {
  name: "SearchComponent",
  props: {
    inline: {
      type: Boolean,
      default: true,
    },
    // eslint-disable-next-line vue/require-default-prop
    form: {
      type: Object,
      required: true,
    },
    // eslint-disable-next-line vue/require-default-prop
    formLabel: {
      type: Array,
      required: true,
    },
    // eslint-disable-next-line vue/require-default-prop
    formRules: {
      type: Object,
      default: () =&gt; {
        return {};
      },
    },
    labelWidth: {
      type: Number,
      default: 90,
    },
    showOperationBtn: {
      type: Boolean,
      default: true,
    },
  },
  // 用来以对象方式存放数据
  data() {
    return {
      pickerOptions: {
        shortcuts: [
          {
            text: "今天",
            onClick(picker) {
              const startTime = new Date(new Date().setHours(0, 0, 0));
              const endTime = new Date(new Date().setHours(23, 59, 59));
              // const endTime = new Date(); //
              picker.$emit("pick", [startTime, endTime]);
            },
          },
          {
            text: "最近一周",
            onClick(picker) {
              const end = new Date();
              const start = new Date();
              start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
              picker.$emit("pick", [start, end]);
            },
          },
          {
            text: "最近一个月",
            onClick(picker) {
              const end = new Date();
              const start = new Date();
              start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
              picker.$emit("pick", [start, end]);
            },
          },
          {
            text: "最近三个月",
            onClick(picker) {
              const end = new Date();
              const start = new Date();
              start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
              picker.$emit("pick", [start, end]);
            },
          },
        ],
      },
    };
  },

  created() {},
  mounted() {},
  methods: {
    selectClick(item, items) {
      this.$emit("selectChange", { item, items });
    },
    handleSearch() {
      this.$emit("handleSearch", this.form);
    },
    handleResetFrom() {
      this.$emit("handleResetFrom");
    },
    daterangeChange(val) {
      this.$emit("daterangeChange", val);
    },
    weekChange(val) {
      let timeArr = [];
      if (val) {
        let startTime = new Date(val.getTime()); //开始时间
        let endTime = new Date(val.getTime() + 24 * 60 * 60 * 1000 * 6); //结束时间
        timeArr = [
          startTime.toISOString().slice(0, 10),
          endTime.toISOString().slice(0, 10),
        ];
      }
      this.$emit("getTimeArr", timeArr);
    },
    monthChange(val) {
      const [year, month, day] = val.split("-");
      const endDate = new Date(year, month, 0).getDate();
      let timeArr = [`${year}-${month}-${day}`, `${year}-${month}-${endDate}`];
      this.$emit("getMonthArr", timeArr);
    },
  },
};
&lt;/script&gt;

&lt;style lang="scss" scoped&gt;
.search-component {
  .right-handle {
    display: inline-block;
    margin-left: 30px;
  }
}
.treeBox {
  width: 242px;
}
&lt;/style&gt;
</code></pre> 
<p></p> 
<p>使用的完整的页面</p> 
<pre><code class="language-html">&lt;!--
 * @Description: 常发拥堵路段 页面
 * @Author: mhf
 * @Date: 2023-09-14 15:46:36
--&gt;
&lt;template&gt;
  &lt;div&gt;
    &lt;newPageCompYt
      ref="newPageCompYt"
      idName="id"
      :formLabel="formLabel"
      :btnList="btnList"
      :tableData="tableData"
      :tableConfig="tableConfig"
      :tableDataColumn="tableDataColumn"
      :total="total"
      :paginationConfig.sync="paginationConfig"
      :pageSizes="pageSizes"
      :exportTypeAndUrl="exportTypeAndUrl"
      :customObj="customObj"
      @on-response="getBtnType"
      @resetForm="resetForm"
      @getTableData="getTableData"
      @daterangeChange="daterangeChange"
      @getTimeRange="getTimeRange"
      @getMonthArr="getMonthArr"
      @formSelectChange="formSelectChange"
    &gt;
      &lt;template slot="roadType" slot-scope="scope"&gt;
        &lt;dict-tag
          :options="dict.type.traffic_road_type"
          :value="scope.row.roadType"
        /&gt;
      &lt;/template&gt;

      &lt;template slot="roadDirection" slot-scope="scope"&gt;
        &lt;dict-tag
          :options="dict.type.traffic_road_direction"
          :value="scope.row.roadDirection"
        /&gt;
      &lt;/template&gt;
    &lt;/newPageCompYt&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { getLastNumDay } from "@/utils/publicFun";
import { getRoadBlockList } from "@/api/statisticAnalysis/statisticAnalysis";

export default {
  name: "roadCongested",
  components: {},
  props: {},
  dicts: ["traffic_often_type", "traffic_road_type", "traffic_road_direction"],
  computed: {
    customObj() {
      let flag = false;
      if (this.paginationConfig.queryAllTime) {
        flag =
          this.paginationConfig.queryAllTime.length &gt; 0 ||
          this.paginationConfig.queryAllTime !== [];
      } else {
        flag = false;
      }

      return {
        startTime: flag
          ? this.paginationConfig.queryAllTime[0] + " 00:00:00"
          : null,
        endTime: flag
          ? this.paginationConfig.queryAllTime[1] + " 23:59:59"
          : null,
        oftenType: this.paginationConfig.oftenType,
        pageNum: this.paginationConfig.pageNum,
        pageSize: this.paginationConfig.pageSize,
      };
    },
  },
  data() {
    return {
      formLabel: [
        {
          label: "常发类型",
          value: "oftenType",
          type: "select",
          opts: [],
          dict: "traffic_often_type",
          optLabel: "dictLabel",
          optValue: "dictValue",
        },
        {
          label: "日期",
          value: "queryAllTime",
          type: "daterange",
        },
      ],
      btnList: [
        {
          name: "导出",
          icon: "iconfont if-daochu",
          color: "#1492FF",
          hasPermi: "system:user:resetPwd",
        },
      ],
      tableData: [],
      tableConfig: {
        isLoading: false,
      },
      tableDataColumn: [
        { name: "序号", value: "index" },
        { name: "路段名称", value: "roadName" },
        { name: "道路方向", value: "roadDirection", isSlot: true },
        { name: "道路等级", value: "roadType", isSlot: true },
      ],
      total: 0,
      paginationConfig: {
        pageNum: 1,
        pageSize: 10,
      },
      pageSizes: [5, 10, 15, 20],
      exportTypeAndUrl: {
        isCustom: true,
        exportType: "trafficTrend",
        exportUrl: "/trafficRun/dataReport/congestedRoad",
      },
    };
  },
  methods: {
    getTableData() {
      this.tableConfig.isLoading = true;
      const { queryAllTime, ...obj } = this.paginationConfig;
      getRoadBlockList(obj).then((response) =&gt; {
        this.tableData = response.data.rows !== null ? response.data.rows : [];
        this.total = response.data.total;
        this.tableConfig.isLoading = false;
      });
    },

    getSETime(timeArr) {
      if (timeArr.length &gt; 0) {
        this.$set(this.paginationConfig, "startTime", timeArr[0] + " 00:00:00");
        this.$set(this.paginationConfig, "endTime", timeArr[1] + " 23:59:59");
      } else {
        this.$set(this.paginationConfig, "startTime", null);
        this.$set(this.paginationConfig, "endTime", null);
      }
    },

    daterangeChange(timeRange) {
      this.getSETime(timeRange);
    },

    getTimeRange(timeRange) {
      this.getSETime(timeRange);
    },

    getMonthArr(timeRange) {
      this.getSETime(timeRange);
    },

    weekChange(val) {
      // let timeArr = []
      // if (val) {
      //   let startTime = new Date(val.getTime()); //开始时间
      //   let endTime = new Date(val.getTime() + (24 * 60 * 60 * 1000) * 6); //结束时间
      //   timeArr = [startTime.toISOString().slice(0, 10), endTime.toISOString().slice(0, 10)];
      // }
    },

    formSelectChange(obj) {
      if (obj.item.label === "常发类型") {
        let arr = [
          {
            label: "日期",
            value: "queryAllTime",
            type: "daterange",
          },
          {
            label: "日期",
            value: "queryAllTime",
            type: "week",
          },
          {
            label: "日期",
            value: "queryAllTime",
            type: "month",
          },
        ];
        this.formLabel[1] = arr[obj.items.dictValue - 1]
        this.$set(this.paginationConfig, 'queryAllTime', null)
        delete this.paginationConfig.queryAllTime  // 主要是这步 清空原先保存的值（问题1）
        this.getSETime([])
      }
    },

    getBtnType(type) {
      console.log(type);
    },

    resetForm() {
      let timeArr = getLastNumDay(30, false);
      this.$set(this.paginationConfig, "queryAllTime", timeArr);
      this.$set(this.paginationConfig, "startTime", timeArr[0]);
      this.$set(this.paginationConfig, "endTime", timeArr[1]);
      this.$set(this.paginationConfig, "oftenType", "1");
      this.formLabel[1] = {
        label: "日期",
        value: "queryAllTime",
        type: "daterange",
      };
    },
  },

  created() {
    this.resetForm();
  },

  mounted() {},
};
&lt;/script&gt;

&lt;style lang="scss" scoped&gt;&lt;/style&gt;</code></pre> 
<p>问题2 看此段即可</p> 
<pre><code class="language-html">&lt;el-date-picker
          v-if="item.type === 'datetimerange'"
          key="datetimerange"
          v-model="form[item.value]"
          type="datetimerange"
          :picker-options="pickerOptions"
          range-separator="至"
          start-placeholder="开始日期"
          end-placeholder="结束日期"
          align="right"
          value-format="yyyy-MM-dd HH:mm:ss"
        /&gt;</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/70801595d2d72007b9b304444eb60ad8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">论文阅读——Slide-Transformer（cvpr2023）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/41bea100632363ccefbd675673bc3ed7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">《基于 Vue 组件库 的 Webpack5 配置》- 总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>