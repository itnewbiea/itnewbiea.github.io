<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序开发实战9_2 小程序页面转发 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信小程序开发实战9_2 小程序页面转发" />
<meta property="og:description" content="小程序页面转发是小程序分享的一个重要方式，在设计小程序应用时就需要考虑那些页面需要实现转发功能，以及页面的转发参数。本节介绍如何进行小程序页面的分享，并介绍如何获取小程序卡片的分享票据。
9.2.1小程序页面转发 微信小程序提供了页面的转发的功能，用户在在打开小程序的页面时，可把该页面以消息卡片的形式转发给其他用户或微信群。微信小程序转发功能的实现方法有两种：
第一种方式
第一种方式是在page.js中实现onShareAppMessage，便可在小程序右上角显示分享菜单： onShareAppMessage: function () { return { title: &#39;分享标题&#39;, desc: &#39;分享页面的内容&#39;, path: &#39;/pages/share_recv?code=123&#39; } } 第二种方式
如果觉得小程序原生的转发用户体验不够友好，可以在页面自定义转发按钮，通过给 button 组件设置属性 open-type=“share”，可以在用户点击按钮后触发Page.onShareAppMessage事件，实现分享功能。 &lt;view style=&#34;padding:5px&#34;&gt; &lt;button open-type=&#39;share&#39;&gt;分享&lt;/button&gt; &lt;/view&gt; 获取分享传递的参数
上面的例子中，path属性指向的是/pages/share_recv页面，并附带code=123的参数。我们只需在share_recv.js的onLoad函数中，通过options获取传递过来的参数： Page({ onLoad: function (options) { console.log(options); } }) 9.2.2小程序分享票据 小程序分享票据shareTickets
通常开发者希望转发出去的小程序被二次打开的时候能够获取到一些信息，例如群的标识。在小程序中调用wx.showShareMenu并且设置 withShareTicket为true，当用户将小程序转发到微信群之后，此转发卡片在群聊中被其他用户打开时，可以在App.onLaunch 或App.onShow获取到一个shareTicket。通过调用wx.getShareInfo(shareTicket) 接口可以获取到转发信息。
分享前调用wx.showShareMenu方法，否则不会带有分享票据： Page({ onLoad: function (options) { wx.showShareMenu({ withShareTicket: true }) }, onShareAppMessage: function () { return { title: &#39;分享标题&#39;, desc: &#39;分享页面的内容&#39;, path: &#39;/pages/share_recv?code=123&#39; } } }) 小程序获取票据shareTickets" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1364b7e8ccafe4fa27dc8a9cf9cfab84/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-10-15T09:09:48+08:00" />
<meta property="article:modified_time" content="2022-10-15T09:09:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序开发实战9_2 小程序页面转发</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>小程序页面转发是小程序分享的一个重要方式，在设计小程序应用时就需要考虑那些页面需要实现转发功能，以及页面的转发参数。本节介绍如何进行小程序页面的分享，并介绍如何获取小程序卡片的分享票据。</p> 
<h4><a id="921_1"></a>9.2.1小程序页面转发</h4> 
<p>微信小程序提供了页面的转发的功能，用户在在打开小程序的页面时，可把该页面以消息卡片的形式转发给其他用户或微信群。微信小程序转发功能的实现方法有两种：</p> 
<ul><li>第一种方式<br> 第一种方式是在page.js中实现onShareAppMessage，便可在小程序右上角显示分享菜单：</li></ul> 
<pre><code class="prism language-go"> onShareAppMessage<span class="token punctuation">:</span> function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        title<span class="token punctuation">:</span> <span class="token char">'分享标题'</span><span class="token punctuation">,</span>
        desc<span class="token punctuation">:</span> <span class="token char">'分享页面的内容'</span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> '<span class="token operator">/</span>pages<span class="token operator">/</span>share_recv?code<span class="token operator">=</span><span class="token number">123</span>' 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre> 
<ul><li>第二种方式<br> 如果觉得小程序原生的转发用户体验不够友好，可以在页面自定义转发按钮，通过给 button 组件设置属性 open-type=“share”，可以在用户点击按钮后触发Page.onShareAppMessage事件，实现分享功能。</li></ul> 
<pre><code class="prism language-go"><span class="token operator">&lt;</span>view style<span class="token operator">=</span><span class="token string">"padding:5px"</span><span class="token operator">&gt;</span>
  <span class="token operator">&lt;</span>button open<span class="token operator">-</span><span class="token keyword">type</span><span class="token operator">=</span><span class="token char">'share'</span><span class="token operator">&gt;</span>分享<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>view<span class="token operator">&gt;</span>
</code></pre> 
<ul><li>获取分享传递的参数<br> 上面的例子中，path属性指向的是/pages/share_recv页面，并附带code=123的参数。我们只需在share_recv.js的onLoad函数中，通过options获取传递过来的参数：</li></ul> 
<pre><code class="prism language-go"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  onLoad<span class="token punctuation">:</span> function <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<h4><a id="922_30"></a>9.2.2小程序分享票据</h4> 
<ul><li>小程序分享票据shareTickets<br> 通常开发者希望转发出去的小程序被二次打开的时候能够获取到一些信息，例如群的标识。在小程序中调用wx.showShareMenu并且设置 withShareTicket为true，当用户将小程序转发到微信群之后，此转发卡片在群聊中被其他用户打开时，可以在App.onLaunch 或App.onShow获取到一个shareTicket。通过调用wx.getShareInfo(shareTicket) 接口可以获取到转发信息。<br> 分享前调用wx.showShareMenu方法，否则不会带有分享票据：</li></ul> 
<pre><code class="prism language-go"><span class="token function">Page</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  onLoad<span class="token punctuation">:</span> function <span class="token punctuation">(</span>options<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    wx<span class="token punctuation">.</span><span class="token function">showShareMenu</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
      withShareTicket<span class="token punctuation">:</span> <span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  onShareAppMessage<span class="token punctuation">:</span> function <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token punctuation">{<!-- --></span>
        title<span class="token punctuation">:</span> <span class="token char">'分享标题'</span><span class="token punctuation">,</span>
        desc<span class="token punctuation">:</span> <span class="token char">'分享页面的内容'</span><span class="token punctuation">,</span>
        path<span class="token punctuation">:</span> '<span class="token operator">/</span>pages<span class="token operator">/</span>share_recv?code<span class="token operator">=</span><span class="token number">123</span>' 
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li>小程序获取票据shareTickets<br> 可以在App的onLaunch和onShow中获取 shareTicket，由于onLaunch全局只触发一次和热启动的原因，因此在onShow中获取 shareTicket比较合理：</li></ul> 
<pre><code class="prism language-go"><span class="token function">App</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
  onShow<span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span>opt<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>'app<span class="token operator">--</span><span class="token operator">-</span>onShow'<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//1044是群聊，1007是私聊</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>opt<span class="token punctuation">.</span>scene <span class="token operator">==</span> <span class="token number">1044</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
      wx<span class="token punctuation">.</span><span class="token function">getShareInfo</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
        shareTicket<span class="token punctuation">:</span> opt<span class="token punctuation">.</span>shareTicket<span class="token punctuation">,</span>
        success<span class="token punctuation">:</span> <span class="token function">function</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        		<span class="token keyword">var</span> encryptedData <span class="token operator">=</span> res<span class="token punctuation">.</span>encryptedData<span class="token punctuation">;</span>
         	<span class="token keyword">var</span> iv <span class="token operator">=</span> res<span class="token punctuation">.</span>iv<span class="token punctuation">;</span>
          	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>  
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">}</span>
</code></pre> 
<p>res.encryptedData就是分享到的群的相关信息了，不过这个信息是加密的，需要像获取手机号一样再去后端解密才可以，具体解密方法请参见：获取用户手机号码。 encryptedData 解密后为以下的json 结构:</p> 
<pre><code class="prism language-json"><span class="token punctuation">{<!-- --></span>
  <span class="token string-property property">"openGId"</span><span class="token operator">:</span> <span class="token string">"OPENGID"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>说明：</p> 
<ol><li>只有分享到任一群聊，shareTicket才会有值，否则是undefined</li><li>shareTicket也可以用来区分转发消息的场景</li><li>shareTicket主要用来获取转发详情，传入wx.getShareInfo()中获取加密数据，需要后端配合，返回解密数据。</li></ol> 
<h4><a id="923__81"></a>9.2.3 小程序卡片转发的调试</h4> 
<p>微信小程序开发者工具可以模拟向微信群转发小程序卡片，小程序官方提供的9个测试用的群，您可以在开发者工具中调试小程序卡片的转发功能。但是开发者工具模拟器无法进入测试群，因此也就无法点击转发出去的小程序卡片。要想对这种情况进行调试，需要使用开发者工具的自定义编译功能。接下来我们创建一个编译模式，用于调试打开带shareTicket的小程序卡片消息。具体操作步骤如下：<br> 1）点击开发者工具的：添加编译模式，打开编译模式设置弹框。<br> 2）为您的编译模式命名，并设置小程序的启动页面。<br> 3）选择小程序的进入场景，您需选择：1044：带shareTicket的小程序卡片消息。<br> 4）选择进入的群：小程序官方提供的9个测试用的群，选择其中的一个。<br> <img src="https://images2.imgbox.com/9a/48/JSwuF61C_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/08465f4f7859569f7d244a2b8228d3cc/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【Windows Server 2019】网络负载均衡服务配置与管理——理论&#43;网络拓扑及说明</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/09956d212646a84e279677d9bb6026ee/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Pytorch实现Warm up&#43;余弦退火，亲测有效</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>