<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>python实现植物大战僵尸 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="python实现植物大战僵尸" />
<meta property="og:description" content="python实现植物大战僵尸 @TOC
前言 植物大战僵尸是一款十分经典的游戏，在github上就有python版的开源代码（https://github.com/search?q=PythonPlantsVsZombies）打开后可以看见有六个版本，在这里我选的是第一个版本。
游戏介绍 游戏截图 介绍 现在含有的植物 太阳花，豌豆射手，寒冰射手，坚果，樱桃炸弹。新增加植物：双重豌豆射手，三重豌豆射手，食人花 ，小喷菇，土豆地雷，倭瓜。
现在含有的僵尸 普通僵尸，旗子僵尸，路障僵尸，铁桶僵尸。读报僵尸。
现在含有的关卡 在源文件中有六个关卡，四种模式：==白日模式、夜晚模式、传送带模式、坚果保龄球模式==
由于关卡设置是以.json文件保存，所以我们可以自己更改。
代码分析 1.main.py 这个游戏的源文件中包含了多个py文件，main.py中只有这5行代码：
import pygame as pg from source.main import main if __name__==&#39;__main__&#39;: main() pg.quit() 2.menubar.py 这个文件是用来设置植物卡片的，先来看源码：
第一部分：卡片设置 card_name_list = [c.CARD_SUNFLOWER, c.CARD_PEASHOOTER, c.CARD_SNOWPEASHOOTER, c.CARD_WALLNUT, c.CARD_CHERRYBOMB, c.CARD_THREEPEASHOOTER, c.CARD_REPEATERPEA, c.CARD_CHOMPER, c.CARD_PUFFMUSHROOM, c.CARD_POTATOMINE, c.CARD_SQUASH] plant_name_list = [c.SUNFLOWER, c.PEASHOOTER, c.SNOWPEASHOOTER, c.WALLNUT, c.CHERRYBOMB, c.THREEPEASHOOTER, c.REPEATERPEA, c.CHOMPER, c.PUFFMUSHROOM, c.POTATOMINE, c.SQUASH] plant_sun_list = [50, 100, 175, 50, 150, 325, 200, 150, 0, 25, 50] plant_frozen_time_list = [0, 5000, 5000, 10000, 5000, 5000, 5000, 5000, 8000, 8000, 8000] all_card_list = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10] 这里以向日葵卡片为例：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c482d76ffcb48685f74817b106362a52/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-13T21:39:19+08:00" />
<meta property="article:modified_time" content="2023-02-13T21:39:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">python实现植物大战僵尸</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <h2 style="text-align:left;">python实现植物大战僵尸</h2> 
 <p style="">@<a class="kdocs-link" style="color:#0A6CFF;" href="%E7%9B%AE%E5%BD%95" rel="nofollow noopener noreferrer" target="_blank">TOC</a></p> 
 <h3 style="text-align:left;">前言</h3> 
 <p style="">植物大战僵尸是一款十分经典的游戏，在github上就有python版的开源代码（<a class="kdocs-link" style="color:#0A6CFF;" href="https://github.com/search?q=PythonPlantsVsZombies" target="_blank" rel="noopener noreferrer">https://github.com/search?q=PythonPlantsVsZombies</a>）打开后可以看见有六个版本，在这里我选的是第一个版本。</p> 
 <h3 style="text-align:left;">游戏介绍</h3> 
 <h4 style="text-align:left;">游戏截图</h4> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:78.78378%;height:0;"> 
    <img src="https://images2.imgbox.com/6e/01/xFCZ8Q2n_o.jpg" style="margin-left:;display:block;width:740px;margin-top:-78.78378%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:74.45946%;height:0;"> 
    <img src="https://images2.imgbox.com/1f/8a/tp0jFukG_o.jpg" style="margin-left:;display:block;width:740px;margin-top:-74.45946%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:78.78378%;height:0;"> 
    <img src="https://images2.imgbox.com/3e/5e/vOOruQTD_o.jpg" style="margin-left:;display:block;width:740px;margin-top:-78.78378%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <h4 style="text-align:left;">介绍</h4> 
 <h5 style="text-align:left;">现在含有的植物</h5> 
 <p style="">太阳花，豌豆射手，寒冰射手，坚果，樱桃炸弹。新增加植物：双重豌豆射手，三重豌豆射手，食人花 ，小喷菇，土豆地雷，倭瓜。</p> 
 <h5 style="text-align:left;">现在含有的僵尸</h5> 
 <p style="">普通僵尸，旗子僵尸，路障僵尸，铁桶僵尸。读报僵尸。</p> 
 <h5 style="text-align:left;">现在含有的关卡</h5> 
 <p style="">在源文件中有六个关卡，四种模式：==白日模式、夜晚模式、传送带模式、坚果保龄球模式==</p> 
 <p style="">由于关卡设置是以.json文件保存，所以我们可以自己更改。</p> 
 <h3 style="text-align:left;">代码分析</h3> 
 <h4 style="text-align:left;">1.main.py</h4> 
 <p style="">这个游戏的源文件中包含了多个py文件，main.py中只有这5行代码：</p> 
 <pre class="kdocs-python"><code class="language-python">import pygame as pg
from source.main import main

if __name__=='__main__':
    main()
    pg.quit()</code></pre> 
 <h4 style="text-align:left;">2.menubar.py</h4> 
 <p style="">这个文件是用来设置植物卡片的，先来看源码：</p> 
 <h5 style="text-align:left;">第一部分：卡片设置</h5> 
 <pre class="kdocs-python"><code class="language-python">card_name_list = [c.CARD_SUNFLOWER, c.CARD_PEASHOOTER, c.CARD_SNOWPEASHOOTER, c.CARD_WALLNUT,
                  c.CARD_CHERRYBOMB, c.CARD_THREEPEASHOOTER, c.CARD_REPEATERPEA, c.CARD_CHOMPER,
                  c.CARD_PUFFMUSHROOM, c.CARD_POTATOMINE, c.CARD_SQUASH]
plant_name_list = [c.SUNFLOWER, c.PEASHOOTER, c.SNOWPEASHOOTER, c.WALLNUT,
                   c.CHERRYBOMB, c.THREEPEASHOOTER, c.REPEATERPEA, c.CHOMPER,
                   c.PUFFMUSHROOM, c.POTATOMINE, c.SQUASH]
plant_sun_list = [50, 100, 175, 50, 150, 325, 200, 150, 0, 25, 50]
plant_frozen_time_list = [0, 5000, 5000, 10000, 5000, 5000, 5000, 5000, 8000, 8000, 8000]
all_card_list = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]</code></pre> 
 <p style="">这里以向日葵卡片为例：</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">card_name_list[0]</span> 是向日葵卡片的名字，用来<span class="kdocs-italic" style="font-style:italic;">获取太阳花卡片的图片</span>。</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">plant_name_list[0]</span> 是向日葵的名字，用来获取太阳花卡片的图片。</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">plant_sun_list[0]</span> 是种植向日葵需要花费的<span class="kdocs-italic" style="font-style:italic;">太阳点数</span>。</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">plant_frozen_time_list[0]</span> 是向日葵的<span class="kdocs-italic" style="font-style:italic;">冷却时间</span>。</p> 
 <h5 style="text-align:left;">第二部分：点击卡片</h5> 
 <p style="">这一部分设置了当鼠标点击卡片后执行的动作：</p> 
 <pre class="kdocs-python"><code class="language-python">class Card():
    def __init__(self, x, y, name_index, scale=0.78):
        self.loadFrame(card_name_list[name_index], scale)
        self.rect = self.image.get_rect()
        self.rect.x = x
        self.rect.y = y
 
        self.name_index = name_index
        self.sun_cost = plant_sun_list[name_index]
        self.frozen_time = plant_frozen_time_list[name_index]
        self.frozen_timer = -self.frozen_time
        self.select = True
 
    def loadFrame(self, name, scale):
        frame = tool.GFX[name]
        rect = frame.get_rect()
        width, height = rect.w, rect.h
 
        self.image = tool.get_image(frame, 0, 0, width, height, c.BLACK, scale)
 
    def checkMouseClick(self, mouse_pos):
        x, y = mouse_pos
        if(x &gt;= self.rect.x and x &lt;= self.rect.right and
           y &gt;= self.rect.y and y &lt;= self.rect.bottom):
            return True
        return False
 
    def canClick(self, sun_value, current_time):
        if self.sun_cost &lt;= sun_value and (current_time - self.frozen_timer) &gt; self.frozen_time:
            return True
        return False
 
    def canSelect(self):
        return self.select
 
    def setSelect(self, can_select):
        self.select = can_select
        if can_select:
            self.image.set_alpha(255)
        else:
            self.image.set_alpha(128)
 
    def setFrozenTime(self, current_time):
        self.frozen_timer = current_time
 
    def update(self, sun_value, current_time):
        if (self.sun_cost &gt; sun_value or
            (current_time - self.frozen_timer) &lt;= self.frozen_time):
            self.image.set_alpha(128)
        else:
            self.image.set_alpha(255)
 
    def draw(self, surface):
        surface.blit(self.image, self.rect)</code></pre> 
 <h4 style="text-align:left;">3.level.py</h4> 
 <p style="">这个程序的一部分功能是设置图片的切换：</p> 
 <pre class="kdocs-python"><code class="language-python">    def setupMouseImage(self, plant_name, plant_cost):
        frame_list = tool.GFX[plant_name]
        if plant_name in tool.PLANT_RECT:
            data = tool.PLANT_RECT[plant_name]
            x, y, width, height = data['x'], data['y'], data['width'], data['height']
        else:
            x, y = 0, 0
            rect = frame_list[0].get_rect()
            width, height = rect.w, rect.h
 
        if plant_name == c.POTATOMINE or plant_name == c.SQUASH:
            color = c.WHITE
        else:
            color = c.BLACK
        self.mouse_image = tool.get_image(frame_list[0], x, y, width, height, color, 1)
        self.mouse_rect = self.mouse_image.get_rect()
        pg.mouse.set_visible(False)
        self.drag_plant = True
        self.plant_name = plant_name
        self.plant_cost = plant_cost
 
    def drawMouseShow(self, surface):
        if self.hint_plant:
            surface.blit(self.hint_image, self.hint_rect)
        x, y = pg.mouse.get_pos()
        self.mouse_rect.centerx = x
        self.mouse_rect.centery = y
        surface.blit(self.mouse_image, self.mouse_rect)</code></pre> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">self.mouse_image</span> ：根据 plant_name 获取选中的植物图片；</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">self.mouse_rect</span>：选中植物图片的位置，在drawMouseShow函数中，需要将植物图片的位置设置成当前鼠标的位置；</p> 
 <p style="">**pg.mouse.set_visible(False)**：隐藏默认的鼠标显示，这样效果就是鼠标图片切换为选中的植物了。</p> 
 <h4 style="text-align:left;">4.map.py</h4> 
 <p style="">这个文件的一个作用是提示种在哪个方格中，比如下图红圈的这种效果：</p> 
 <div class="kdocs-line-container" style="display:flex;"> 
  <div class="kdocs-img" style="flex-direction:column;max-width:100%;display:flex;width:740px;justify-content:center;align-items:center;height:auto;"> 
   <div class="kdocs-img" style="padding-top:78.78378%;height:0;"> 
    <img src="https://images2.imgbox.com/b7/c5/zEU7ndqn_o.png" style="margin-left:;display:block;width:740px;margin-top:-78.78378%;height:auto;"> 
   </div> 
  </div> 
 </div> 
 <p style="">代码：</p> 
 <pre class="kdocs-python"><code class="language-python">MAP_EMPTY = 0
MAP_EXIST = 1
 
class Map():
    def __init__(self, width, height):
        self.width = width
        self.height = height
        self.map = [[0 for x in range(self.width)] for y in range(self.height)]
 
    def isValid(self, map_x, map_y):
        if (map_x &lt; 0 or map_x &gt;= self.width or
            map_y &lt; 0 or map_y &gt;= self.height):
            return False
        return True
 
    def isMovable(self, map_x, map_y):
        return (self.map[map_y][map_x] == c.MAP_EMPTY)
 
    def getMapIndex(self, x, y):
        x -= c.MAP_OFFSET_X
        y -= c.MAP_OFFSET_Y
        return (x // c.GRID_X_SIZE, y // c.GRID_Y_SIZE)
 
    def getMapGridPos(self, map_x, map_y):
        return (map_x * c.GRID_X_SIZE + c.GRID_X_SIZE//2 + c.MAP_OFFSET_X,
                map_y * c.GRID_Y_SIZE + c.GRID_Y_SIZE//5 * 3 + c.MAP_OFFSET_Y)
 
    def setMapGridType(self, map_x, map_y, type):
        self.map[map_y][map_x] = type
 
    def getRandomMapIndex(self):
        map_x = random.randint(0, self.width-1)
        map_y = random.randint(0, self.height-1)
        return (map_x, map_y)
 
    def showPlant(self, x, y):
        pos = None
        map_x, map_y = self.getMapIndex(x, y)
        if self.isValid(map_x, map_y) and self.isMovable(map_x, map_y):
            pos = self.getMapGridPos(map_x, map_y)
        return pos</code></pre> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">self.map</span>：二维list，用来保存每个方格的状态。每个entry初始化为 0, 表示可以种植物，值为1时表示这个方格已经种了植物。</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">getMapIndex</span> 函数：传入参数是游戏中的坐标位置（比如当前鼠标的位置），返回该位置在地图的哪个方格中。</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">getMapGridPos</span> 函数：传入一个方格的index，返回在该方格中种植物的坐标位置。</p> 
 <p style=""><span class="kdocs-bold" style="font-weight:bold;">showPlant</span> 函数：根据传入的坐标位置，判断该位置所在的方格是否能种植物，如果能种，就返回返回在该方格中种植物的坐标位置。</p> 
 <h3 style="text-align:left;">编辑</h3> 
 <p style="">在源代码中的md文件中介绍了两个可编辑的地方：</p> 
 <h4 style="text-align:left;">1.更改起始关卡</h4> 
 <p style="">在constants.py中：</p> 
 <pre class="kdocs-python"><code class="language-python">__author__ = 'marble_xu'

START_LEVEL_NUM = 0#在这里更改

ORIGINAL_CAPTION = 'Plant VS Zombies Game'

SCREEN_WIDTH = 800
SCREEN_HEIGHT = 600
SCREEN_SIZE = (SCREEN_WIDTH, SCREEN_HEIGHT)

GRID_X_LEN = 9
GRID_Y_LEN = 5
GRID_X_SIZE = 80
GRID_Y_SIZE = 100</code></pre> 
 <p style="">0代表第1，1代表第2关......</p> 
 <h4 style="text-align:left;">2.地图设置</h4> 
 <p style="">地图设置都保存在json文件中，我们以其中一个为例：</p> 
 <pre class="kdocs-python"><code class="language-python">{
    "background_type":0,
    "init_sun_value":50,
    "zombie_list":[
        {"time":20000, "map_y":0, "name":"Zombie"},
        {"time":40000, "map_y":2, "name":"FlagZombie"},
        {"time":50000, "map_y":4, "name":"Zombie"},
        {"time":70000, "map_y":3, "name":"Zombie"},
        {"time":72000, "map_y":1, "name":"FlagZombie"},
        {"time":74000, "map_y":2, "name":"Zombie"},
        {"time":90000, "map_y":0, "name":"Zombie"},
        {"time":91000, "map_y":1, "name":"FlagZombie"},
        {"time":92000, "map_y":2, "name":"Zombie"},
        {"time":93000, "map_y":3, "name":"FlagZombie"},
        {"time":94000, "map_y":0, "name":"Zombie"},
        {"time":95000, "map_y":4, "name":"FlagZombie"},
        {"time":96000, "map_y":1, "name":"Zombie"}
    ]
}</code></pre> 
 <p style="">通过这一特性，我们可以创造自己的地图。</p> 
 <h3 style="text-align:left;">源码下载</h3> 
 <p style="">点击链接：<a class="kdocs-link" style="color:#0A6CFF;" href="https://github.com/PythonPlantsVsZombies" target="_blank" rel="noopener noreferrer">https://github.com/PythonPlantsVsZombies</a>后点击左边的code,然后点download zip</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aab2a0457bfc2ee2d958e8c9cbac76f5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java中的线程停止</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7a78f8b6b4e782383836728bc95fd0a5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Centos7.x Redis快速安装脚本</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>