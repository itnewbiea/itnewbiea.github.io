<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android Toast基础与原理 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android Toast基础与原理" />
<meta property="og:description" content="一、Toast的使用方式 Toast.makeText(context,text,duration)public Toast(Context context) 在Android系统中，给我们提供了两种方式来创建一个Toast对象。第一种是通过makeText方法快速构建Toast对象。第二种是通过Toast的构造方法进行创造一个空的（不含View）的Toast对象。注意，通过构造方法创建的Toast对象，在show()前需要我们调用setView（View view）方法来设置显示的View。
这里我们简要查看下makeText方法和构造方法的源码。
构造方法 /** * Construct an empty Toast object. You must call {@link #setView} before you * can call {@link #show}. * * @param context The context to use. Usually your {@link android.app.Application} * or {@link android.app.Activity} object. */ public Toast(Context context) { mContext = context; mTN = new TN(); mTN.mY = context.getResources().getDimensionPixelSize( com.android.internal.R.dimen.toast_y_offset); mTN.mGravity = context.getResources().getInteger( com.android.internal.R.integer.config_toastDefaultGravity); } 在上面的源码中，我们可以看到构造方法中核心操作是创建一个TN对象，并给它设置默认的y轴方向上的偏移和默认的对齐方式Gravity。
makeText方法 /** * Make a standard toast that just contains a text view." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/dd63b1f07eafd66eadcba1327ff0e741/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-07-08T10:58:25+08:00" />
<meta property="article:modified_time" content="2017-07-08T10:58:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android Toast基础与原理</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4 style="margin-top:24px; margin-bottom:16px; font-size:1.25em; line-height:1.25; color:rgb(36,41,46)"> 一、Toast的使用方式</h4> 
<ol style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"><li style="">Toast.makeText(context,text,duration)</li><li style="margin-top:0.25em">public Toast(Context context)</li></ol> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 在Android系统中，给我们提供了两种方式来创建一个Toast对象。第一种是通过makeText方法快速构建Toast对象。第二种是通过Toast的构造方法进行创造一个空的（不含View）的Toast对象。注意，通过构造方法创建的Toast对象，在show()前需要我们调用setView（View view）方法来设置显示的View。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 这里我们简要查看下makeText方法和构造方法的源码。</p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-构造方法" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#%E6%9E%84%E9%80%A0%E6%96%B9%E6%B3%95" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>构造方法</h6> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">/*</span>*</span>
<span class="pl-c" style="color:rgb(106,115,125)"> * Construct an empty Toast object.  You must call {@link #setView} before you</span>
<span class="pl-c" style="color:rgb(106,115,125)"> * can call {@link #show}.</span>
<span class="pl-c" style="color:rgb(106,115,125)"> *</span>
<span class="pl-c" style="color:rgb(106,115,125)"> * @param context  The context to use.  Usually your {@link android.app.Application}</span>
<span class="pl-c" style="color:rgb(106,115,125)"> *                 or {@link android.app.Activity} object.</span>
<span class="pl-c" style="color:rgb(106,115,125)"> <span class="pl-c" style="">*/</span></span>
<span class="pl-k" style="color:rgb(215,58,73)">public</span> Toast(<span class="pl-smi" style="">Context</span> context) {
    mContext <span class="pl-k" style="color:rgb(215,58,73)">=</span> context;
    mTN <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-smi" style="">TN</span>();
    mTN<span class="pl-k" style="color:rgb(215,58,73)">.</span>mY <span class="pl-k" style="color:rgb(215,58,73)">=</span> context<span class="pl-k" style="color:rgb(215,58,73)">.</span>getResources()<span class="pl-k" style="color:rgb(215,58,73)">.</span>getDimensionPixelSize(
            <span class="pl-smi" style="">com.android.internal<span class="pl-k" style="color:rgb(215,58,73)">.</span>R</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>dimen<span class="pl-k" style="color:rgb(215,58,73)">.</span>toast_y_offset);
    mTN<span class="pl-k" style="color:rgb(215,58,73)">.</span>mGravity <span class="pl-k" style="color:rgb(215,58,73)">=</span> context<span class="pl-k" style="color:rgb(215,58,73)">.</span>getResources()<span class="pl-k" style="color:rgb(215,58,73)">.</span>getInteger(
            <span class="pl-smi" style="">com.android.internal<span class="pl-k" style="color:rgb(215,58,73)">.</span>R</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>integer<span class="pl-k" style="color:rgb(215,58,73)">.</span>config_toastDefaultGravity);
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 在上面的源码中，我们可以看到构造方法中核心操作是创建一个TN对象，并给它设置默认的y轴方向上的偏移和默认的对齐方式Gravity。</p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-maketext方法" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#maketext%E6%96%B9%E6%B3%95" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>makeText方法</h6> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">/*</span>*</span>
<span class="pl-c" style="color:rgb(106,115,125)"> * Make a standard toast that just contains a text view.</span>
<span class="pl-c" style="color:rgb(106,115,125)"> <span class="pl-c" style="">*/</span></span>
<span class="pl-k" style="color:rgb(215,58,73)">public</span> <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-smi" style="">Toast</span> makeText(<span class="pl-smi" style="">Context</span> context, <span class="pl-smi" style="">CharSequence</span> text, <span class="pl-k" style="color:rgb(215,58,73)">@Duration</span> <span class="pl-k" style="color:rgb(215,58,73)">int</span> duration) {
    <span class="pl-smi" style="">Toast</span> result <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-smi" style="">Toast</span>(context);

    <span class="pl-smi" style="">LayoutInflater</span> inflate <span class="pl-k" style="color:rgb(215,58,73)">=</span> (<span class="pl-smi" style="">LayoutInflater</span>)
            context<span class="pl-k" style="color:rgb(215,58,73)">.</span>getSystemService(<span class="pl-smi" style="">Context</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>LAYOUT_INFLATER_SERVICE</span>);
    <span class="pl-smi" style="">View</span> v <span class="pl-k" style="color:rgb(215,58,73)">=</span> inflate<span class="pl-k" style="color:rgb(215,58,73)">.</span>inflate(<span class="pl-smi" style="">com.android.internal<span class="pl-k" style="color:rgb(215,58,73)">.</span>R</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>layout<span class="pl-k" style="color:rgb(215,58,73)">.</span>transient_notification, <span class="pl-c1" style="color:rgb(0,92,197)">null</span>);
    <span class="pl-smi" style="">TextView</span> tv <span class="pl-k" style="color:rgb(215,58,73)">=</span> (<span class="pl-smi" style="">TextView</span>)v<span class="pl-k" style="color:rgb(215,58,73)">.</span>findViewById(<span class="pl-smi" style="">com.android.internal<span class="pl-k" style="color:rgb(215,58,73)">.</span>R</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>id<span class="pl-k" style="color:rgb(215,58,73)">.</span>message);
    tv<span class="pl-k" style="color:rgb(215,58,73)">.</span>setText(text);

    result<span class="pl-k" style="color:rgb(215,58,73)">.</span>mNextView <span class="pl-k" style="color:rgb(215,58,73)">=</span> v;
    result<span class="pl-k" style="color:rgb(215,58,73)">.</span>mDuration <span class="pl-k" style="color:rgb(215,58,73)">=</span> duration;

    <span class="pl-k" style="color:rgb(215,58,73)">return</span> result;
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> makeText方法会构建一个只含有TextView的视图来展示。源码中第一步还是通过构造函数构建一个空的Toast对象，然后通过LayoutInflater解析一个View对象，绑定到Toast对象上进行展示。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 通过上面对makeToast的源码分析，我们比葫芦画瓢的总结下自定义视图Toast的实现过程：</p> 
<ol style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"><li style="">通过构造方法创建一个空的Toast对象；</li><li style="margin-top:0.25em">自定义视图layout，通过LayoutInflate解析成View对象，通过Toast.setView方法设置。</li><li style="margin-top:0.25em">调用Toast.show()方法进行展示。</li></ol> 
<h4 style="margin-top:24px; margin-bottom:16px; font-size:1.25em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-二toast常用方法" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#%E4%BA%8Ctoast%E5%B8%B8%E7%94%A8%E6%96%B9%E6%B3%95" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>二、Toast常用方法</h4> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-1setdurationduration-int-duration" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#1setdurationduration-int-duration" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>1、setDuration(@Duration int duration)</h6> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 设置Toast的显示时长，有两个值：LENGTH_SHORT, LENGTH_LONG。</p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-2setgravityint-gravity-int-xoffset-int-yoffset" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#2setgravityint-gravity-int-xoffset-int-yoffset" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>2、setGravity(int gravity, int xOffset, int yOffset)</h6> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 设置Toast显示的位置，这里有三个参数。</p> 
<ul style="padding-left:2em; margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"><li style="">gravity：toast显示的位置，CENTER_VERTICAL（垂直居中）、CENTER_HORIZONTAL（水平居中）、TOP（顶部）；</li><li style="margin-top:0.25em">xOffset：Toast在水平方向（x轴）的偏移量，偏移量单位为，大于0向右偏移，小于0向左偏移；</li><li style="margin-top:0.25em">yOffset：Toast在垂直方向（y轴）的偏移量，大于0向下偏移，小于0向上偏移；</li></ul> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-3setmarginfloat-horizontalmargin-float-verticalmargin" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#3setmarginfloat-horizontalmargin-float-verticalmargin" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>3、setMargin(float horizontalMargin, float verticalMargin)</h6> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-4settextcharsequence-s" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#4settextcharsequence-s" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>4、setText(CharSequence s)</h6> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 设置Toast的显示文字。</p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-5setviewview-view" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#5setviewview-view" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>5、setView(View view)</h6> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 设置Toast展示的View样式。可用于我们的自定义Toast显示样式。</p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-6show" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#6show" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>6、show()</h6> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> Toast的显示调用的方法。</p> 
<h4 style="margin-top:24px; margin-bottom:16px; font-size:1.25em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-三toast的展示与管理" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#%E4%B8%89toast%E7%9A%84%E5%B1%95%E7%A4%BA%E4%B8%8E%E7%AE%A1%E7%90%86" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>三、Toast的展示与管理</h4> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 通过上面的介绍，我们知道通过Toast.show()方法完成Toast的显示。</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">/*</span>*</span>
<span class="pl-c" style="color:rgb(106,115,125)"> * Show the view for the specified duration.</span>
<span class="pl-c" style="color:rgb(106,115,125)"> <span class="pl-c" style="">*/</span></span>
<span class="pl-k" style="color:rgb(215,58,73)">public</span> <span class="pl-k" style="color:rgb(215,58,73)">void</span> show() {
    <span class="pl-k" style="color:rgb(215,58,73)">if</span> (mNextView <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
        <span class="pl-k" style="color:rgb(215,58,73)">throw</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-smi" style="">RuntimeException</span>(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>setView must have been called<span class="pl-pds" style="">"</span></span>);
    }

    <span class="pl-smi" style="">INotificationManager</span> service <span class="pl-k" style="color:rgb(215,58,73)">=</span> getService();
    <span class="pl-smi" style="">String</span> pkg <span class="pl-k" style="color:rgb(215,58,73)">=</span> mContext<span class="pl-k" style="color:rgb(215,58,73)">.</span>getOpPackageName();
    <span class="pl-smi" style="">TN</span> tn <span class="pl-k" style="color:rgb(215,58,73)">=</span> mTN;
    tn<span class="pl-k" style="color:rgb(215,58,73)">.</span>mNextView <span class="pl-k" style="color:rgb(215,58,73)">=</span> mNextView;

    <span class="pl-k" style="color:rgb(215,58,73)">try</span> {
        service<span class="pl-k" style="color:rgb(215,58,73)">.</span>enqueueToast(pkg, tn, mDuration);
    } <span class="pl-k" style="color:rgb(215,58,73)">catch</span> (<span class="pl-smi" style="">RemoteException</span> e) {
        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> Empty</span>
    }
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 通过show的源码可以看到系统中创建一个INotificationManager对象，然后通过enqueueToast方法将一个TN对象入队列。这里，我们需要看看这个TN对象是什么？</p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-tn对象是什么" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#tn%E5%AF%B9%E8%B1%A1%E6%98%AF%E4%BB%80%E4%B9%88" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>TN对象是什么？</h6> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">private</span> <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">class</span> <span class="pl-en" style="color:rgb(111,66,193)">TN</span> <span class="pl-k" style="color:rgb(215,58,73)">extends</span> <span class="pl-e" style="color:rgb(111,66,193)">ITransientNotification</span>.<span class="pl-e" style="color:rgb(111,66,193)">Stub</span> </pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 又是熟悉的面孔，却是不一样的味道。一个Binder的子类出现了。我们来看看ItransientNotification定义了哪些接口。</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">/*</span>* @hide <span class="pl-c" style="">*/</span></span>
oneway <span class="pl-k" style="color:rgb(215,58,73)">interface</span> <span class="pl-en" style="color:rgb(111,66,193)">ITransientNotification</span> {
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">show</span>();
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">hide</span>();
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 显示与隐藏的方法。我们知道了定义的接口方法在去看它的实现类思路会清晰很多，看看TN的实现：</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">private</span> <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">class</span> <span class="pl-en" style="color:rgb(111,66,193)">TN</span> <span class="pl-k" style="color:rgb(215,58,73)">extends</span> <span class="pl-e" style="color:rgb(111,66,193)">ITransientNotification</span>.<span class="pl-e" style="color:rgb(111,66,193)">Stub</span> {
    <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-smi" style="">Runnable</span> mHide <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-smi" style="">Runnable</span>() {
        <span class="pl-k" style="color:rgb(215,58,73)">@Override</span>
        <span class="pl-k" style="color:rgb(215,58,73)">public</span> <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">run</span>() {
            handleHide();
            <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> Don't do this in handleHide() because it is also invoked by handleShow()</span>
            mNextView <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>;
        }
    };

    <span class="pl-k" style="color:rgb(215,58,73)">private</span> <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-smi" style="">WindowManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">LayoutParams</span> mParams <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-smi" style="">WindowManager</span>.<span class="pl-smi" style="">LayoutParams</span>();
    <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-smi" style="">Handler</span> mHandler <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-smi" style="">Handler</span>() {
        <span class="pl-k" style="color:rgb(215,58,73)">@Override</span>
        <span class="pl-k" style="color:rgb(215,58,73)">public</span> <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">handleMessage</span>(<span class="pl-smi" style="">Message</span> <span class="pl-v" style="color:rgb(227,98,9)">msg</span>) {
            <span class="pl-smi" style="">IBinder</span> token <span class="pl-k" style="color:rgb(215,58,73)">=</span> (<span class="pl-smi" style="">IBinder</span>) msg<span class="pl-k" style="color:rgb(215,58,73)">.</span>obj;
            handleShow(token);
        }
    };

    <span class="pl-k" style="color:rgb(215,58,73)">int</span> mGravity;
    <span class="pl-k" style="color:rgb(215,58,73)">int</span> mX, mY;
    <span class="pl-k" style="color:rgb(215,58,73)">float</span> mHorizontalMargin;
    <span class="pl-k" style="color:rgb(215,58,73)">float</span> mVerticalMargin;


    <span class="pl-smi" style="">View</span> mView;
    <span class="pl-smi" style="">View</span> mNextView;
    <span class="pl-k" style="color:rgb(215,58,73)">int</span> mDuration;

    <span class="pl-smi" style="">WindowManager</span> mWM;

    <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">long</span> <span class="pl-c1" style="color:rgb(0,92,197)">SHORT_DURATION_TIMEOUT</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">5000</span>;
    <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">long</span> <span class="pl-c1" style="color:rgb(0,92,197)">LONG_DURATION_TIMEOUT</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">1000</span>;

    <span class="pl-c1" style="color:rgb(0,92,197)">TN</span>() {
        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> XXX This should be changed to use a Dialog, with a Theme.Toast</span>
        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> defined that sets up the layout params appropriately.</span>
        <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-smi" style="">WindowManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">LayoutParams</span> params <span class="pl-k" style="color:rgb(215,58,73)">=</span> mParams;
        params<span class="pl-k" style="color:rgb(215,58,73)">.</span>height <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">WindowManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">LayoutParams</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>WRAP_CONTENT</span>;
        params<span class="pl-k" style="color:rgb(215,58,73)">.</span>width <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">WindowManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">LayoutParams</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>WRAP_CONTENT</span>;
        params<span class="pl-k" style="color:rgb(215,58,73)">.</span>format <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">PixelFormat</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>TRANSLUCENT</span>;
        params<span class="pl-k" style="color:rgb(215,58,73)">.</span>windowAnimations <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">com.android.internal<span class="pl-k" style="color:rgb(215,58,73)">.</span>R</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">style<span class="pl-k" style="color:rgb(215,58,73)">.</span>Animation_Toast</span>;
        params<span class="pl-k" style="color:rgb(215,58,73)">.</span>type <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">WindowManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">LayoutParams</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>TYPE_TOAST</span>;
        params.<span class="pl-en" style="color:rgb(111,66,193)">setTitle</span>("<span class="pl-smi" style="">Toast</span>");
        params<span class="pl-k" style="color:rgb(215,58,73)">.</span>flags <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">WindowManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">LayoutParams</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>FLAG_KEEP_SCREEN_ON</span>
                <span class="pl-k" style="color:rgb(215,58,73)">|</span> <span class="pl-smi" style="">WindowManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">LayoutParams</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>FLAG_NOT_FOCUSABLE</span>
                <span class="pl-k" style="color:rgb(215,58,73)">|</span> <span class="pl-smi" style="">WindowManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">LayoutParams</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>FLAG_NOT_TOUCHABLE</span>;
    }

    /**
     * schedule handleShow into the right thread
     */
    @Override
    public void show(<span class="pl-smi" style="">IBinder</span> windowToken) {
        <span class="pl-en" style="color:rgb(111,66,193)">if</span> (<span class="pl-v" style="color:rgb(227,98,9)">localLOGV</span>) Log.<span class="pl-en" style="color:rgb(111,66,193)">v</span>(<span class="pl-smi" style="">TAG</span>, "<span class="pl-smi" style="">SHOW</span>: " + <span class="pl-v" style="color:rgb(227,98,9)">this</span>);
        mHandler.<span class="pl-en" style="color:rgb(111,66,193)">obtainMessage</span>(<span class="pl-v" style="color:rgb(227,98,9)">0</span>, <span class="pl-v" style="color:rgb(227,98,9)">windowToken</span>).<span class="pl-en" style="color:rgb(111,66,193)">sendToTarget</span>();
    }

    /**
     * schedule handleHide into the right thread
     */
    @Override
    public void hide() {
        <span class="pl-en" style="color:rgb(111,66,193)">if</span> (<span class="pl-v" style="color:rgb(227,98,9)">localLOGV</span>) Log.<span class="pl-en" style="color:rgb(111,66,193)">v</span>(<span class="pl-smi" style="">TAG</span>, "<span class="pl-smi" style="">HIDE</span>: " + <span class="pl-v" style="color:rgb(227,98,9)">this</span>);
        mHandler.<span class="pl-en" style="color:rgb(111,66,193)">post</span>(<span class="pl-v" style="color:rgb(227,98,9)">mHide</span>);
    }

    public void handleShow(<span class="pl-smi" style="">IBinder</span> windowToken) {
        <span class="pl-en" style="color:rgb(111,66,193)">if</span> (<span class="pl-v" style="color:rgb(227,98,9)">localLOGV</span>) Log.<span class="pl-en" style="color:rgb(111,66,193)">v</span>(<span class="pl-smi" style="">TAG</span>, "<span class="pl-smi" style="">HANDLE</span> <span class="pl-smi" style="">SHOW</span>: " + <span class="pl-v" style="color:rgb(227,98,9)">this</span> + " <span class="pl-v" style="color:rgb(227,98,9)">mView</span>=" + <span class="pl-v" style="color:rgb(227,98,9)">mView</span>
                + " <span class="pl-v" style="color:rgb(227,98,9)">mNextView</span>=" + <span class="pl-v" style="color:rgb(227,98,9)">mNextView</span>);
        <span class="pl-en" style="color:rgb(111,66,193)">if</span> (<span class="pl-v" style="color:rgb(227,98,9)">mView</span> != <span class="pl-v" style="color:rgb(227,98,9)">mNextView</span>) {
            <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> remove the old view if necessary</span>
            handleHide();
            mView <span class="pl-k" style="color:rgb(215,58,73)">=</span> mNextView;
            <span class="pl-smi" style="">Context</span> context <span class="pl-k" style="color:rgb(215,58,73)">=</span> mView<span class="pl-k" style="color:rgb(215,58,73)">.</span>getContext()<span class="pl-k" style="color:rgb(215,58,73)">.</span>getApplicationContext();
            <span class="pl-smi" style="">String</span> packageName <span class="pl-k" style="color:rgb(215,58,73)">=</span> mView<span class="pl-k" style="color:rgb(215,58,73)">.</span>getContext()<span class="pl-k" style="color:rgb(215,58,73)">.</span>getOpPackageName();
            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (context <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
                context <span class="pl-k" style="color:rgb(215,58,73)">=</span> mView<span class="pl-k" style="color:rgb(215,58,73)">.</span>getContext();
            }
            mWM <span class="pl-k" style="color:rgb(215,58,73)">=</span> (<span class="pl-smi" style="">WindowManager</span>)context<span class="pl-k" style="color:rgb(215,58,73)">.</span>getSystemService(<span class="pl-smi" style="">Context</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>WINDOW_SERVICE</span>);
            <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> We can resolve the Gravity here by using the Locale for getting</span>
            <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> the layout direction</span>
            <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-smi" style="">Configuration</span> config <span class="pl-k" style="color:rgb(215,58,73)">=</span> mView<span class="pl-k" style="color:rgb(215,58,73)">.</span>getContext()<span class="pl-k" style="color:rgb(215,58,73)">.</span>getResources()<span class="pl-k" style="color:rgb(215,58,73)">.</span>getConfiguration();
            <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">int</span> gravity <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">Gravity</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>getAbsoluteGravity(mGravity, config<span class="pl-k" style="color:rgb(215,58,73)">.</span>getLayoutDirection());
            mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>gravity <span class="pl-k" style="color:rgb(215,58,73)">=</span> gravity;
            <span class="pl-k" style="color:rgb(215,58,73)">if</span> ((gravity <span class="pl-k" style="color:rgb(215,58,73)">&amp;</span> <span class="pl-smi" style="">Gravity</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>HORIZONTAL_GRAVITY_MASK</span>) <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-smi" style="">Gravity</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>FILL_HORIZONTAL</span>) {
                mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>horizontalWeight <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">1.0f</span>;
            }
            <span class="pl-k" style="color:rgb(215,58,73)">if</span> ((gravity <span class="pl-k" style="color:rgb(215,58,73)">&amp;</span> <span class="pl-smi" style="">Gravity</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>VERTICAL_GRAVITY_MASK</span>) <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-smi" style="">Gravity</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>FILL_VERTICAL</span>) {
                mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>verticalWeight <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">1.0f</span>;
            }
            mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>x <span class="pl-k" style="color:rgb(215,58,73)">=</span> mX;
            mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>y <span class="pl-k" style="color:rgb(215,58,73)">=</span> mY;
            mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>verticalMargin <span class="pl-k" style="color:rgb(215,58,73)">=</span> mVerticalMargin;
            mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>horizontalMargin <span class="pl-k" style="color:rgb(215,58,73)">=</span> mHorizontalMargin;
            mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>packageName <span class="pl-k" style="color:rgb(215,58,73)">=</span> packageName;
            mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>hideTimeoutMilliseconds <span class="pl-k" style="color:rgb(215,58,73)">=</span> mDuration <span class="pl-k" style="color:rgb(215,58,73)">==</span>
                <span class="pl-smi" style="">Toast</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>LENGTH_LONG</span> <span class="pl-k" style="color:rgb(215,58,73)">?</span> <span class="pl-c1" style="color:rgb(0,92,197)">LONG_DURATION_TIMEOUT</span> <span class="pl-k" style="color:rgb(215,58,73)">:</span> <span class="pl-c1" style="color:rgb(0,92,197)">SHORT_DURATION_TIMEOUT</span>;
            mParams<span class="pl-k" style="color:rgb(215,58,73)">.</span>token <span class="pl-k" style="color:rgb(215,58,73)">=</span> windowToken;
            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (mView<span class="pl-k" style="color:rgb(215,58,73)">.</span>getParent() <span class="pl-k" style="color:rgb(215,58,73)">!=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
                <span class="pl-k" style="color:rgb(215,58,73)">if</span> (localLOGV) <span class="pl-smi" style="">Log</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>v(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>REMOVE! <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> mView <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> in <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-c1" style="color:rgb(0,92,197)">this</span>);
                mWM<span class="pl-k" style="color:rgb(215,58,73)">.</span>removeView(mView);
            }
            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (localLOGV) <span class="pl-smi" style="">Log</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>v(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>ADD! <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> mView <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> in <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-c1" style="color:rgb(0,92,197)">this</span>);
            mWM<span class="pl-k" style="color:rgb(215,58,73)">.</span>addView(mView, mParams);
            trySendAccessibilityEvent();
        }
    }

    private void trySendAccessibilityEvent() {
        <span class="pl-smi" style="">AccessibilityManager</span> accessibilityManager <span class="pl-k" style="color:rgb(215,58,73)">=</span>
                <span class="pl-smi" style="">AccessibilityManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>getInstance(mView<span class="pl-k" style="color:rgb(215,58,73)">.</span>getContext());
        <span class="pl-en" style="color:rgb(111,66,193)">if</span> (!<span class="pl-v" style="color:rgb(227,98,9)">accessibilityManager</span>.<span class="pl-v" style="color:rgb(227,98,9)">isEnabled</span>()) {
            <span class="pl-k" style="color:rgb(215,58,73)">return</span>;
        }
        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> treat toasts as notifications since they are used to</span>
        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> announce a transient piece of information to the user</span>
        <span class="pl-smi" style="">AccessibilityEvent</span> event <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">AccessibilityEvent</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>obtain(
                <span class="pl-smi" style="">AccessibilityEvent</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>TYPE_NOTIFICATION_STATE_CHANGED</span>);
        event.<span class="pl-en" style="color:rgb(111,66,193)">setClassName</span>(<span class="pl-v" style="color:rgb(227,98,9)">getClass</span>().<span class="pl-en" style="color:rgb(111,66,193)">getName</span>());
        event.<span class="pl-en" style="color:rgb(111,66,193)">setPackageName</span>(<span class="pl-v" style="color:rgb(227,98,9)">mView</span>.<span class="pl-v" style="color:rgb(227,98,9)">getContext</span>().<span class="pl-en" style="color:rgb(111,66,193)">getPackageName</span>());
        mView.<span class="pl-en" style="color:rgb(111,66,193)">dispatchPopulateAccessibilityEvent</span>(<span class="pl-v" style="color:rgb(227,98,9)">event</span>);
        accessibilityManager.<span class="pl-en" style="color:rgb(111,66,193)">sendAccessibilityEvent</span>(<span class="pl-v" style="color:rgb(227,98,9)">event</span>);
    }        

    public void handleHide() {
        <span class="pl-en" style="color:rgb(111,66,193)">if</span> (<span class="pl-v" style="color:rgb(227,98,9)">localLOGV</span>) Log.<span class="pl-en" style="color:rgb(111,66,193)">v</span>(<span class="pl-smi" style="">TAG</span>, "<span class="pl-smi" style="">HANDLE</span> <span class="pl-smi" style="">HIDE</span>: " + <span class="pl-v" style="color:rgb(227,98,9)">this</span> + " <span class="pl-v" style="color:rgb(227,98,9)">mView</span>=" + <span class="pl-v" style="color:rgb(227,98,9)">mView</span>);
        <span class="pl-en" style="color:rgb(111,66,193)">if</span> (<span class="pl-v" style="color:rgb(227,98,9)">mView</span> != <span class="pl-v" style="color:rgb(227,98,9)">null</span>) {
            <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> note: checking parent() just to make sure the view has</span>
            <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> been added...  i have seen cases where we get here when</span>
            <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> the view isn't yet added, so let's try not to crash.</span>
            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (mView<span class="pl-k" style="color:rgb(215,58,73)">.</span>getParent() <span class="pl-k" style="color:rgb(215,58,73)">!=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
                <span class="pl-k" style="color:rgb(215,58,73)">if</span> (localLOGV) <span class="pl-smi" style="">Log</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>v(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>REMOVE! <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> mView <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> in <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-c1" style="color:rgb(0,92,197)">this</span>);
                mWM<span class="pl-k" style="color:rgb(215,58,73)">.</span>removeViewImmediate(mView);
            }

            mView <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>;
        }
    }
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 在TN类的实现内部，实现了show和hide方法。然后通过Handler进行发送消息来实现。最终是通过handleShow和handleHide来完成Toast的显示和取消。通过上面源码可以看到，本质上又是通过WindowManager来进行管理和显示的。</p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-inotificationmanager怎么创建的" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#inotificationmanager%E6%80%8E%E4%B9%88%E5%88%9B%E5%BB%BA%E7%9A%84" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>INotificationManager怎么创建的？</h6> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 在这里面通过getService方法获取INotificationManager对象。</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">private</span> <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-smi" style="">INotificationManager</span> sService;

<span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">private</span> <span class="pl-smi" style="">INotificationManager</span> getService() {
    <span class="pl-k" style="color:rgb(215,58,73)">if</span> (sService <span class="pl-k" style="color:rgb(215,58,73)">!=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
        <span class="pl-k" style="color:rgb(215,58,73)">return</span> sService;
    }
    sService <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">INotificationManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">Stub</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>asInterface(<span class="pl-smi" style="">ServiceManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>getService(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>notification<span class="pl-pds" style="">"</span></span>));
    <span class="pl-k" style="color:rgb(215,58,73)">return</span> sService;
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 在这段代码里面，我们看到asInterface这个方法接口，我们就可以根据经验判断这个肯定是INotificationManager是一个AIDL文件。而通过：</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-smi" style="">ServiceManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>getService(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>notification<span class="pl-pds" style="">"</span></span>)</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 获取的肯定是一个实现该AIDL的Binder对象。</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">public</span> <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-smi" style="">IBinder</span> getService(<span class="pl-smi" style="">String</span> name) {
    <span class="pl-k" style="color:rgb(215,58,73)">try</span> {
        <span class="pl-smi" style="">IBinder</span> service <span class="pl-k" style="color:rgb(215,58,73)">=</span> sCache<span class="pl-k" style="color:rgb(215,58,73)">.</span>get(name);
        <span class="pl-k" style="color:rgb(215,58,73)">if</span> (service <span class="pl-k" style="color:rgb(215,58,73)">!=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
            <span class="pl-k" style="color:rgb(215,58,73)">return</span> service;
        } <span class="pl-k" style="color:rgb(215,58,73)">else</span> {
            <span class="pl-k" style="color:rgb(215,58,73)">return</span> getIServiceManager()<span class="pl-k" style="color:rgb(215,58,73)">.</span>getService(name);
        }
    } <span class="pl-k" style="color:rgb(215,58,73)">catch</span> (<span class="pl-smi" style="">RemoteException</span> e) {
        <span class="pl-smi" style="">Log</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>e(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>error in getService<span class="pl-pds" style="">"</span></span>, e);
    }
    <span class="pl-k" style="color:rgb(215,58,73)">return</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>;
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 不由得让我们联想到NotificationManager通知管理。我们粗略的查看下NotificationManager的源码可以发现这样一段代码：</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">private</span> <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-smi" style="">INotificationManager</span> sService;

<span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">/*</span>* @hide <span class="pl-c" style="">*/</span></span>
<span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">public</span> <span class="pl-smi" style="">INotificationManager</span> getService()
{
    <span class="pl-k" style="color:rgb(215,58,73)">if</span> (sService <span class="pl-k" style="color:rgb(215,58,73)">!=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
        <span class="pl-k" style="color:rgb(215,58,73)">return</span> sService;
    }
    <span class="pl-smi" style="">IBinder</span> b <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">ServiceManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>getService(<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>notification<span class="pl-pds" style="">"</span></span>);
    sService <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">INotificationManager</span><span class="pl-k" style="color:rgb(215,58,73)">.</span><span class="pl-smi" style="">Stub</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>asInterface(b);
    <span class="pl-k" style="color:rgb(215,58,73)">return</span> sService;
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 是不是惊奇的发现，这两段代码是惊人的相似。确实，这也可以印证，<span style="font-weight:600">Toast和Notification在系统中都是由INotificationManager进行管理完成。</span></p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-inotificationmanager是什么" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#inotificationmanager%E6%98%AF%E4%BB%80%E4%B9%88" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>INotificationManager是什么？</h6> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> INotificationManager是一个AIDL文件，那么它定义了哪些接口呢？</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">interface</span> <span class="pl-en" style="color:rgb(111,66,193)">INotificationManager</span>
{
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">cancelAllNotifications</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">userId</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">enqueueToast</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-smi" style="">ITransientNotification</span> <span class="pl-v" style="color:rgb(227,98,9)">callback</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">duration</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">cancelToast</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-smi" style="">ITransientNotification</span> <span class="pl-v" style="color:rgb(227,98,9)">callback</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">enqueueNotificationWithTag</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">opPkg</span>, <span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">tag</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">id</span>,
            <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">Notification</span> <span class="pl-v" style="color:rgb(227,98,9)">notification</span>, <span class="pl-v" style="color:rgb(227,98,9)">inout</span> <span class="pl-k" style="color:rgb(215,58,73)">int</span>[] <span class="pl-v" style="color:rgb(227,98,9)">idReceived</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">userId</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">cancelNotificationWithTag</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">tag</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">id</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">userId</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setNotificationsEnabledForPackage</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">uid</span>, <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-v" style="color:rgb(227,98,9)">enabled</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-en" style="color:rgb(111,66,193)">areNotificationsEnabledForPackage</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">uid</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setPackagePriority</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">uid</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">priority</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-en" style="color:rgb(111,66,193)">getPackagePriority</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">uid</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setPackagePeekable</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">uid</span>, <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-v" style="color:rgb(227,98,9)">peekable</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-en" style="color:rgb(111,66,193)">getPackagePeekable</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">uid</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setPackageVisibilityOverride</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">uid</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">visibility</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-en" style="color:rgb(111,66,193)">getPackageVisibilityOverride</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">uid</span>);

    <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> TODO: Remove this when callers have been migrated to the equivalent</span>
    <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> INotificationListener method.</span>
    <span class="pl-k" style="color:rgb(215,58,73)">StatusBarNotification</span>[] <span class="pl-en" style="color:rgb(111,66,193)">getActiveNotifications</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">callingPkg</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">StatusBarNotification</span>[] <span class="pl-en" style="color:rgb(111,66,193)">getHistoricalNotifications</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">callingPkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">count</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">registerListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">listener</span>, <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">ComponentName</span> <span class="pl-v" style="color:rgb(227,98,9)">component</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">userid</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">unregisterListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">listener</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">userid</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">cancelNotificationFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>, <span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">tag</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">id</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">cancelNotificationsFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>, <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-k" style="color:rgb(215,58,73)">String</span>[] <span class="pl-v" style="color:rgb(227,98,9)">keys</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setNotificationsShownFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>, <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-k" style="color:rgb(215,58,73)">String</span>[] <span class="pl-v" style="color:rgb(227,98,9)">keys</span>);

    <span class="pl-smi" style="">ParceledListSlice</span> <span class="pl-en" style="color:rgb(111,66,193)">getActiveNotificationsFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>, <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-k" style="color:rgb(215,58,73)">String</span>[] <span class="pl-v" style="color:rgb(227,98,9)">keys</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">trim</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">requestHintsFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">hints</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-en" style="color:rgb(111,66,193)">getHintsFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">requestInterruptionFilterFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">interruptionFilter</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-en" style="color:rgb(111,66,193)">getInterruptionFilterFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setOnNotificationPostedTrimFromListener</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">INotificationListener</span> <span class="pl-v" style="color:rgb(227,98,9)">token</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">trim</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setInterruptionFilter</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">interruptionFilter</span>);

    <span class="pl-smi" style="">ComponentName</span> <span class="pl-en" style="color:rgb(111,66,193)">getEffectsSuppressor</span>();
    <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-en" style="color:rgb(111,66,193)">matchesCallFilter</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">Bundle</span> <span class="pl-v" style="color:rgb(227,98,9)">extras</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-en" style="color:rgb(111,66,193)">isSystemConditionProviderEnabled</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">path</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-en" style="color:rgb(111,66,193)">getZenMode</span>();
    <span class="pl-smi" style="">ZenModeConfig</span> <span class="pl-en" style="color:rgb(111,66,193)">getZenModeConfig</span>();
    <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-en" style="color:rgb(111,66,193)">setZenModeConfig</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">ZenModeConfig</span> <span class="pl-v" style="color:rgb(227,98,9)">config</span>, <span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">reason</span>);
    oneway <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setZenMode</span>(<span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">mode</span>, <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">Uri</span> <span class="pl-v" style="color:rgb(227,98,9)">conditionId</span>, <span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">reason</span>);
    oneway <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">notifyConditions</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">IConditionProvider</span> <span class="pl-v" style="color:rgb(227,98,9)">provider</span>, <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-k" style="color:rgb(215,58,73)">Condition</span>[] <span class="pl-v" style="color:rgb(227,98,9)">conditions</span>);
    oneway <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">requestZenModeConditions</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">IConditionListener</span> <span class="pl-v" style="color:rgb(227,98,9)">callback</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">relevance</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-en" style="color:rgb(111,66,193)">isNotificationPolicyAccessGranted</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>);
    <span class="pl-smi" style="">NotificationManager</span>.<span class="pl-smi" style="">Policy</span> <span class="pl-en" style="color:rgb(111,66,193)">getNotificationPolicy</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setNotificationPolicy</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-smi" style="">NotificationManager</span>.<span class="pl-smi" style="">Policy</span> <span class="pl-v" style="color:rgb(227,98,9)">policy</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">String</span>[] <span class="pl-en" style="color:rgb(111,66,193)">getPackagesRequestingNotificationPolicyAccess</span>();
    <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-en" style="color:rgb(111,66,193)">isNotificationPolicyAccessGrantedForPackage</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">setNotificationPolicyAccessGranted</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> <span class="pl-v" style="color:rgb(227,98,9)">granted</span>);

    <span class="pl-k" style="color:rgb(215,58,73)">byte</span>[] <span class="pl-en" style="color:rgb(111,66,193)">getBackupPayload</span>(<span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">user</span>);
    <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">applyRestore</span>(<span class="pl-v" style="color:rgb(227,98,9)">in</span> <span class="pl-k" style="color:rgb(215,58,73)">byte</span>[] <span class="pl-v" style="color:rgb(227,98,9)">payload</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">user</span>);

    <span class="pl-smi" style="">ParceledListSlice</span> <span class="pl-en" style="color:rgb(111,66,193)">getAppActiveNotifications</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">callingPkg</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">userId</span>);
}</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 在上面我们看到了enqueueToast、cancelToast两个方法，这两个方法就是对应我们show里面的方法。那么这两个方法是在哪里实现的呢？</p> 
<h6 style="margin-top:24px; margin-bottom:16px; font-size:0.875em; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-inotificationmanager的实现" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#inotificationmanager%E7%9A%84%E5%AE%9E%E7%8E%B0" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>INotificationManager的实现</h6> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 通过查看源码，我们发现INotificationManager中的接口是在NotificationManagerService中进行实现的。</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">private</span> <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-smi" style="">IBinder</span> mService <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-smi" style="">INotificationManager</span>.<span class="pl-smi" style="">Stub</span>() {
<span class="pl-c1" style="color:rgb(0,92,197)">1062</span>        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> Toasts</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1063</span>        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> ============================================================================</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1064</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1065</span>        <span class="pl-k" style="color:rgb(215,58,73)">@Override</span>
1066        public <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">enqueueToast</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-smi" style="">ITransientNotification</span> <span class="pl-v" style="color:rgb(227,98,9)">callback</span>, <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-v" style="color:rgb(227,98,9)">duration</span>)
1067        {
<span class="pl-c1" style="color:rgb(0,92,197)">1068</span>            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (<span class="pl-c1" style="color:rgb(0,92,197)">DBG</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1069</span>                <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>i(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>enqueueToast pkg=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> pkg <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> callback=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> callback
<span class="pl-c1" style="color:rgb(0,92,197)">1070</span>                        <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> duration=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> duration);
<span class="pl-c1" style="color:rgb(0,92,197)">1071</span>            }
<span class="pl-c1" style="color:rgb(0,92,197)">1072</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1073</span>            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (pkg <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span> <span class="pl-k" style="color:rgb(215,58,73)">||</span> callback <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1074</span>                <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>e(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>Not doing toast. pkg=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> pkg <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> callback=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> callback);
<span class="pl-c1" style="color:rgb(0,92,197)">1075</span>                <span class="pl-k" style="color:rgb(215,58,73)">return</span> ;
<span class="pl-c1" style="color:rgb(0,92,197)">1076</span>            }
<span class="pl-c1" style="color:rgb(0,92,197)">1077</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1078</span>            <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">boolean</span> isSystemToast <span class="pl-k" style="color:rgb(215,58,73)">=</span> isCallerSystem() <span class="pl-k" style="color:rgb(215,58,73)">||</span> (<span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>android<span class="pl-pds" style="">"</span></span><span class="pl-k" style="color:rgb(215,58,73)">.</span>equals(pkg));
<span class="pl-c1" style="color:rgb(0,92,197)">1079</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1080</span>            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (<span class="pl-c1" style="color:rgb(0,92,197)">ENABLE_BLOCKED_TOASTS</span> <span class="pl-k" style="color:rgb(215,58,73)">&amp;&amp;</span> <span class="pl-k" style="color:rgb(215,58,73)">!</span>noteNotificationOp(pkg, <span class="pl-smi" style="">Binder</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>getCallingUid())) {
<span class="pl-c1" style="color:rgb(0,92,197)">1081</span>                <span class="pl-k" style="color:rgb(215,58,73)">if</span> (<span class="pl-k" style="color:rgb(215,58,73)">!</span>isSystemToast) {
<span class="pl-c1" style="color:rgb(0,92,197)">1082</span>                    <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>e(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>Suppressing toast from package <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> pkg <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> by user request.<span class="pl-pds" style="">"</span></span>);
<span class="pl-c1" style="color:rgb(0,92,197)">1083</span>                    <span class="pl-k" style="color:rgb(215,58,73)">return</span>;
<span class="pl-c1" style="color:rgb(0,92,197)">1084</span>                }
<span class="pl-c1" style="color:rgb(0,92,197)">1085</span>            }
<span class="pl-c1" style="color:rgb(0,92,197)">1086</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1087</span>            <span class="pl-k" style="color:rgb(215,58,73)">synchronized</span> (mToastQueue) {
<span class="pl-c1" style="color:rgb(0,92,197)">1088</span>                <span class="pl-k" style="color:rgb(215,58,73)">int</span> callingPid <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">Binder</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>getCallingPid();
<span class="pl-c1" style="color:rgb(0,92,197)">1089</span>                <span class="pl-k" style="color:rgb(215,58,73)">long</span> callingId <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">Binder</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>clearCallingIdentity();
<span class="pl-c1" style="color:rgb(0,92,197)">1090</span>                <span class="pl-k" style="color:rgb(215,58,73)">try</span> {
<span class="pl-c1" style="color:rgb(0,92,197)">1091</span>                    <span class="pl-smi" style="">ToastRecord</span> record;
<span class="pl-c1" style="color:rgb(0,92,197)">1092</span>                    <span class="pl-k" style="color:rgb(215,58,73)">int</span> index <span class="pl-k" style="color:rgb(215,58,73)">=</span> indexOfToastLocked(pkg, callback);
<span class="pl-c1" style="color:rgb(0,92,197)">1093</span>                    <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> If it's already in the queue, we update it in place, we don't</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1094</span>                    <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> move it to the end of the queue.</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1095</span>                    <span class="pl-k" style="color:rgb(215,58,73)">if</span> (index <span class="pl-k" style="color:rgb(215,58,73)">&gt;=</span> <span class="pl-c1" style="color:rgb(0,92,197)">0</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1096</span>                        record <span class="pl-k" style="color:rgb(215,58,73)">=</span> mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>get(index);
<span class="pl-c1" style="color:rgb(0,92,197)">1097</span>                        record<span class="pl-k" style="color:rgb(215,58,73)">.</span>update(duration);
<span class="pl-c1" style="color:rgb(0,92,197)">1098</span>                    } <span class="pl-k" style="color:rgb(215,58,73)">else</span> {
<span class="pl-c1" style="color:rgb(0,92,197)">1099</span>                        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> Limit the number of toasts that any given package except the android</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1100</span>                        <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> package can enqueue.  Prevents DOS attacks and deals with leaks.</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1101</span>                        <span class="pl-k" style="color:rgb(215,58,73)">if</span> (<span class="pl-k" style="color:rgb(215,58,73)">!</span>isSystemToast) {
<span class="pl-c1" style="color:rgb(0,92,197)">1102</span>                            <span class="pl-k" style="color:rgb(215,58,73)">int</span> count <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">0</span>;
<span class="pl-c1" style="color:rgb(0,92,197)">1103</span>                            <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-smi" style="">N</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>size();
<span class="pl-c1" style="color:rgb(0,92,197)">1104</span>                            <span class="pl-k" style="color:rgb(215,58,73)">for</span> (<span class="pl-k" style="color:rgb(215,58,73)">int</span> i<span class="pl-k" style="color:rgb(215,58,73)">=</span><span class="pl-c1" style="color:rgb(0,92,197)">0</span>; i<span class="pl-k" style="color:rgb(215,58,73)">&lt;</span><span class="pl-smi" style="">N</span>; i<span class="pl-k" style="color:rgb(215,58,73)">++</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1105</span>                                 <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-smi" style="">ToastRecord</span> r <span class="pl-k" style="color:rgb(215,58,73)">=</span> mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>get(i);
<span class="pl-c1" style="color:rgb(0,92,197)">1106</span>                                 <span class="pl-k" style="color:rgb(215,58,73)">if</span> (r<span class="pl-k" style="color:rgb(215,58,73)">.</span>pkg<span class="pl-k" style="color:rgb(215,58,73)">.</span>equals(pkg)) {
<span class="pl-c1" style="color:rgb(0,92,197)">1107</span>                                     count<span class="pl-k" style="color:rgb(215,58,73)">++</span>;
<span class="pl-c1" style="color:rgb(0,92,197)">1108</span>                                     <span class="pl-k" style="color:rgb(215,58,73)">if</span> (count <span class="pl-k" style="color:rgb(215,58,73)">&gt;=</span> <span class="pl-c1" style="color:rgb(0,92,197)">MAX_PACKAGE_NOTIFICATIONS</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1109</span>                                         <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>e(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>Package has already posted <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> count
<span class="pl-c1" style="color:rgb(0,92,197)">1110</span>                                                <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> toasts. Not showing more. Package=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> pkg);
<span class="pl-c1" style="color:rgb(0,92,197)">1111</span>                                         <span class="pl-k" style="color:rgb(215,58,73)">return</span>;
<span class="pl-c1" style="color:rgb(0,92,197)">1112</span>                                     }
<span class="pl-c1" style="color:rgb(0,92,197)">1113</span>                                 }
<span class="pl-c1" style="color:rgb(0,92,197)">1114</span>                            }
<span class="pl-c1" style="color:rgb(0,92,197)">1115</span>                        }
<span class="pl-c1" style="color:rgb(0,92,197)">1116</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1117</span>                        record <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-smi" style="">ToastRecord</span>(callingPid, pkg, callback, duration);
<span class="pl-c1" style="color:rgb(0,92,197)">1118</span>                        mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>add(record);
<span class="pl-c1" style="color:rgb(0,92,197)">1119</span>                        index <span class="pl-k" style="color:rgb(215,58,73)">=</span> mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>size() <span class="pl-k" style="color:rgb(215,58,73)">-</span> <span class="pl-c1" style="color:rgb(0,92,197)">1</span>;
<span class="pl-c1" style="color:rgb(0,92,197)">1120</span>                        keepProcessAliveLocked(callingPid);
<span class="pl-c1" style="color:rgb(0,92,197)">1121</span>                    }
<span class="pl-c1" style="color:rgb(0,92,197)">1122</span>                    <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> If it's at index 0, it's the current toast.  It doesn't matter if it's</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1123</span>                    <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> new or just been updated.  Call back and tell it to show itself.</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1124</span>                    <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> If the callback fails, this will remove it from the list, so don't</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1125</span>                    <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> assume that it's valid after this.</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1126</span>                    <span class="pl-k" style="color:rgb(215,58,73)">if</span> (index <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-c1" style="color:rgb(0,92,197)">0</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1127</span>                        showNextToastLocked();
<span class="pl-c1" style="color:rgb(0,92,197)">1128</span>                    }
<span class="pl-c1" style="color:rgb(0,92,197)">1129</span>                } <span class="pl-k" style="color:rgb(215,58,73)">finally</span> {
<span class="pl-c1" style="color:rgb(0,92,197)">1130</span>                    <span class="pl-smi" style="">Binder</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>restoreCallingIdentity(callingId);
<span class="pl-c1" style="color:rgb(0,92,197)">1131</span>                }
<span class="pl-c1" style="color:rgb(0,92,197)">1132</span>            }
<span class="pl-c1" style="color:rgb(0,92,197)">1133</span>        }
<span class="pl-c1" style="color:rgb(0,92,197)">1134</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1135</span>        <span class="pl-k" style="color:rgb(215,58,73)">@Override</span>
1136        public <span class="pl-k" style="color:rgb(215,58,73)">void</span> <span class="pl-en" style="color:rgb(111,66,193)">cancelToast</span>(<span class="pl-smi" style="">String</span> <span class="pl-v" style="color:rgb(227,98,9)">pkg</span>, <span class="pl-smi" style="">ITransientNotification</span> <span class="pl-v" style="color:rgb(227,98,9)">callback</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1137</span>            <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>i(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>cancelToast pkg=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> pkg <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> callback=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> callback);
<span class="pl-c1" style="color:rgb(0,92,197)">1138</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1139</span>            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (pkg <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span> <span class="pl-k" style="color:rgb(215,58,73)">||</span> callback <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1140</span>                <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>e(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>Not cancelling notification. pkg=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> pkg <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> callback=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> callback);
<span class="pl-c1" style="color:rgb(0,92,197)">1141</span>                <span class="pl-k" style="color:rgb(215,58,73)">return</span> ;
<span class="pl-c1" style="color:rgb(0,92,197)">1142</span>            }
<span class="pl-c1" style="color:rgb(0,92,197)">1143</span>
<span class="pl-c1" style="color:rgb(0,92,197)">1144</span>            <span class="pl-k" style="color:rgb(215,58,73)">synchronized</span> (mToastQueue) {
<span class="pl-c1" style="color:rgb(0,92,197)">1145</span>                <span class="pl-k" style="color:rgb(215,58,73)">long</span> callingId <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">Binder</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>clearCallingIdentity();
<span class="pl-c1" style="color:rgb(0,92,197)">1146</span>                <span class="pl-k" style="color:rgb(215,58,73)">try</span> {
<span class="pl-c1" style="color:rgb(0,92,197)">1147</span>                    <span class="pl-k" style="color:rgb(215,58,73)">int</span> index <span class="pl-k" style="color:rgb(215,58,73)">=</span> indexOfToastLocked(pkg, callback);
<span class="pl-c1" style="color:rgb(0,92,197)">1148</span>                    <span class="pl-k" style="color:rgb(215,58,73)">if</span> (index <span class="pl-k" style="color:rgb(215,58,73)">&gt;=</span> <span class="pl-c1" style="color:rgb(0,92,197)">0</span>) {
<span class="pl-c1" style="color:rgb(0,92,197)">1149</span>                        cancelToastLocked(index);
<span class="pl-c1" style="color:rgb(0,92,197)">1150</span>                    } <span class="pl-k" style="color:rgb(215,58,73)">else</span> {
<span class="pl-c1" style="color:rgb(0,92,197)">1151</span>                        <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>w(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>Toast already cancelled. pkg=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> pkg
<span class="pl-c1" style="color:rgb(0,92,197)">1152</span>                                <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> callback=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> callback);
<span class="pl-c1" style="color:rgb(0,92,197)">1153</span>                    }
<span class="pl-c1" style="color:rgb(0,92,197)">1154</span>                } <span class="pl-k" style="color:rgb(215,58,73)">finally</span> {
<span class="pl-c1" style="color:rgb(0,92,197)">1155</span>                    <span class="pl-smi" style="">Binder</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>restoreCallingIdentity(callingId);
<span class="pl-c1" style="color:rgb(0,92,197)">1156</span>                }
<span class="pl-c1" style="color:rgb(0,92,197)">1157</span>            }
<span class="pl-c1" style="color:rgb(0,92,197)">1158</span>        }</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 在Toast的显示过程中，我们可以发现最终调用的showNextToastLocked方法进行显示。</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'>    <span class="pl-k" style="color:rgb(215,58,73)">void</span> showNextToastLocked() {
        <span class="pl-smi" style="">ToastRecord</span> record <span class="pl-k" style="color:rgb(215,58,73)">=</span> mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>get(<span class="pl-c1" style="color:rgb(0,92,197)">0</span>);
        <span class="pl-k" style="color:rgb(215,58,73)">while</span> (record <span class="pl-k" style="color:rgb(215,58,73)">!=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>) {
            <span class="pl-k" style="color:rgb(215,58,73)">if</span> (<span class="pl-c1" style="color:rgb(0,92,197)">DBG</span>) <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>d(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>Show pkg=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> record<span class="pl-k" style="color:rgb(215,58,73)">.</span>pkg <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> callback=<span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> record<span class="pl-k" style="color:rgb(215,58,73)">.</span>callback);
            <span class="pl-k" style="color:rgb(215,58,73)">try</span> {
                record<span class="pl-k" style="color:rgb(215,58,73)">.</span>callback<span class="pl-k" style="color:rgb(215,58,73)">.</span>show();
                scheduleTimeoutLocked(record);
                <span class="pl-k" style="color:rgb(215,58,73)">return</span>;
            } <span class="pl-k" style="color:rgb(215,58,73)">catch</span> (<span class="pl-smi" style="">RemoteException</span> e) {
               <span class="pl-smi" style="">Slog</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>w(<span class="pl-c1" style="color:rgb(0,92,197)">TAG</span>, <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span>Object died trying to show notification <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> record<span class="pl-k" style="color:rgb(215,58,73)">.</span>callback
                        <span class="pl-k" style="color:rgb(215,58,73)">+</span> <span class="pl-s" style="color:rgb(3,47,98)"><span class="pl-pds" style="">"</span> in package <span class="pl-pds" style="">"</span></span> <span class="pl-k" style="color:rgb(215,58,73)">+</span> record<span class="pl-k" style="color:rgb(215,58,73)">.</span>pkg);
                <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> remove it from the list and let the process die</span>
                <span class="pl-k" style="color:rgb(215,58,73)">int</span> index <span class="pl-k" style="color:rgb(215,58,73)">=</span> mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>indexOf(record);
                <span class="pl-k" style="color:rgb(215,58,73)">if</span> (index <span class="pl-k" style="color:rgb(215,58,73)">&gt;=</span> <span class="pl-c1" style="color:rgb(0,92,197)">0</span>) {
                    mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>remove(index);
                }
                keepProcessAliveLocked(record<span class="pl-k" style="color:rgb(215,58,73)">.</span>pid);
                <span class="pl-k" style="color:rgb(215,58,73)">if</span> (mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>size() <span class="pl-k" style="color:rgb(215,58,73)">&gt;</span> <span class="pl-c1" style="color:rgb(0,92,197)">0</span>) {
                    record <span class="pl-k" style="color:rgb(215,58,73)">=</span> mToastQueue<span class="pl-k" style="color:rgb(215,58,73)">.</span>get(<span class="pl-c1" style="color:rgb(0,92,197)">0</span>);
                } <span class="pl-k" style="color:rgb(215,58,73)">else</span> {
                   record <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">null</span>;
               }
           }
       }
   }
   
<span class="pl-k" style="color:rgb(215,58,73)">private</span> <span class="pl-k" style="color:rgb(215,58,73)">void</span> scheduleTimeoutLocked(<span class="pl-smi" style="">ToastRecord</span> r)
   {
       mHandler<span class="pl-k" style="color:rgb(215,58,73)">.</span>removeCallbacksAndMessages(r);
       <span class="pl-smi" style="">Message</span> m <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-smi" style="">Message</span><span class="pl-k" style="color:rgb(215,58,73)">.</span>obtain(mHandler, <span class="pl-c1" style="color:rgb(0,92,197)">MESSAGE_TIMEOUT</span>, r);
       <span class="pl-k" style="color:rgb(215,58,73)">long</span> delay <span class="pl-k" style="color:rgb(215,58,73)">=</span> r<span class="pl-k" style="color:rgb(215,58,73)">.</span>duration <span class="pl-k" style="color:rgb(215,58,73)">==</span> <span class="pl-smi" style="">Toast</span><span class="pl-c1" style="color:rgb(0,92,197)"><span class="pl-k" style="color:rgb(215,58,73)">.</span>LENGTH_LONG</span> <span class="pl-k" style="color:rgb(215,58,73)">?</span> <span class="pl-c1" style="color:rgb(0,92,197)">LONG_DELAY</span> <span class="pl-k" style="color:rgb(215,58,73)">:</span> <span class="pl-c1" style="color:rgb(0,92,197)">SHORT_DELAY</span>;
        mHandler<span class="pl-k" style="color:rgb(215,58,73)">.</span>sendMessageDelayed(m, delay);
    }</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 其中有一段代码：</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'>record<span class="pl-k" style="color:rgb(215,58,73)">.</span>callback<span class="pl-k" style="color:rgb(215,58,73)">.</span>show();</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 这个就是TN中的show方法。所以这样整个显示的过程就打通了。</p> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 通过NotificationManager的源码我们可以得到以下信息： 1、Toast的显示时间长短</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'>    <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-c1" style="color:rgb(0,92,197)">LONG_DELAY</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">3500</span>; <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> 3.5 seconds</span>
    <span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-c1" style="color:rgb(0,92,197)">SHORT_DELAY</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">2000</span>; <span class="pl-c" style="color:rgb(106,115,125)"><span class="pl-c" style="">//</span> 2 seconds</span></pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 2、Toast内部管理是通过List集合的形式进行管理。</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">ArrayList&lt;<span class="pl-smi" style="color:rgb(36,41,46)">ToastRecord</span>&gt;</span> mToastQueue <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-k" style="color:rgb(215,58,73)">new</span> <span class="pl-k" style="color:rgb(215,58,73)">ArrayList&lt;<span class="pl-smi" style="color:rgb(36,41,46)">ToastRecord</span>&gt;</span>();</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 3、Toast在一个包中，最多可在Toast队列中添加50个。</p> 
<div class="highlight highlight-source-java" style="margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 
 <pre style='font-family:SFMono-Regular,Consolas,"Liberation Mono",Menlo,Courier,monospace; font-size:13.6px; margin-top:0px; margin-bottom:0px; line-height:1.45; word-wrap:normal; padding:16px; overflow:auto; background-color:rgb(246,248,250); word-break:normal'><span class="pl-k" style="color:rgb(215,58,73)">static</span> <span class="pl-k" style="color:rgb(215,58,73)">final</span> <span class="pl-k" style="color:rgb(215,58,73)">int</span> <span class="pl-c1" style="color:rgb(0,92,197)">MAX_PACKAGE_NOTIFICATIONS</span> <span class="pl-k" style="color:rgb(215,58,73)">=</span> <span class="pl-c1" style="color:rgb(0,92,197)">50</span>;</pre> 
</div> 
<p style="margin-top:0px; margin-bottom:16px; color:rgb(36,41,46); font-size:16px"> 4、Toast内部显示消息管理通过Handler进行实现。</p> 
<h5 style="margin-top:24px; margin-bottom:16px; font-size:16px; line-height:1.25; color:rgb(36,41,46)"> <a target="_blank" id="user-content-总结" class="anchor" href="https://github.com/dengshiwei/work-summary/blob/master/work-blog/Android%E8%A7%86%E5%9B%BE%E5%9F%BA%E7%A1%80/Toast%E5%9F%BA%E7%A1%80%E4%B8%8E%E5%8E%9F%E7%90%86%E5%88%86%E6%9E%90.md#%E6%80%BB%E7%BB%93" style="background-color:transparent; color:rgb(3,102,214); text-decoration:none; float:left; padding-right:4px; margin-left:-20px; line-height:1" rel="noopener noreferrer"></a>总结</h5> 
<p style="margin-top:0px; color:rgb(36,41,46); font-size:16px; margin-bottom:0px!important"> Toast在创建的时候都会创建TN对象。该对象实现跨进程的通信协议show、hide方法。最后通过INotificationManager进行统一的管理。最后通过TN实现的show方法进行展示。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7c6f68fc55d9a948454bfc04e04df86c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C&#43;&#43;11新特性——结构体内直接赋初始值</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/5a0d2b089b74fc2168be3c09a4c8b5d5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MySQL数据库替换为SQLServer</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>