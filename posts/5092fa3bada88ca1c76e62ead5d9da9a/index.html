<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>OpenCasCade入门tutorial - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="OpenCasCade入门tutorial" />
<meta property="og:description" content="Tutorial简述gp_XXXStandard_XXXGeom_XXXGC_MakeXXXTopoDS_XXXBRepBuilderAPI_XXXBRepPrimAPI_XXXBRepFilletAPI_XXXTopExp_ExplorerTopAbs_ShapeEnumBRepAlgoAPI_XXXBRep_Tool与 Standard_TransientTopTools_XXXBRepOffsetAPI_XXXTutorial源代码 OCC接触两年有余了，以前使用频率不高，好多东西一知半解，现在是需要用到它的时候了。
Tutorial简述 Tutorial用一个绘制Bottle的例子描述了OCC建模的基本步骤。这里涉及了一些概念和类的用法，不细心看做笔记是很容易忘掉的。
gp_XXX gp_Pnt 是最简单的“点”；此外对应的有还有许多这样的简单结构,这些类从其类名就可以知道它可能有哪些参数，没错，这些类包含了点、线、面、轴以及各种曲面等，其中的参数都是构建这些几何结构必须的参数，我们可以称gp_Pnt这一类的类为基本几何类。 —————————————————————————————— - gp_Ax2 - gp_Ax2d - gp_Ax3 - gp_Ax3d - gp_Ax22 - gp_Ax22d - gp_Circ - gp_Circ2d - gp_Cone - gp_Cylinder - gp_Dir - gp_Dir2d - gp_Elips - gp_Elips2d - gp_EulerSequence - gp_GTrsf - gp_GTrsf2d - gp_Hypr - gp_Hypr2d - gp_Lin - gp_Lin2d - gp_Mat - gp_Mat2d - gp_Parab - gp_Parab2d - gp_Pln - gp_Pnt2d - gp_Quaternion - gp_QuaternionNLerp - gp_QuaternionSLerp - gp_Sphere - gp_Torus - gp_Trsf - gp_Trsf2d - gp_TrsfForm - gp_TrsfNLerp - gp_Vec - gp_Vec2d - gp_VectorWithNullMagnitude - gp_XY - gp_XYZ" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5092fa3bada88ca1c76e62ead5d9da9a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-12T19:21:16+08:00" />
<meta property="article:modified_time" content="2018-07-12T19:21:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">OpenCasCade入门tutorial</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <div class="toc"> 
  <ul><li> 
    <ul><li> 
      <ul><li><a href="#tutorial%E7%AE%80%E8%BF%B0" rel="nofollow">Tutorial简述</a></li><li><a href="#gpxxx" rel="nofollow">gp_XXX</a></li><li><a href="#standardxxx" rel="nofollow">Standard_XXX</a></li><li><a href="#geomxxx" rel="nofollow">Geom_XXX</a></li><li><a href="#gcmakexxx" rel="nofollow">GC_MakeXXX</a></li><li><a href="#topodsxxx" rel="nofollow">TopoDS_XXX</a></li><li><a href="#brepbuilderapixxx" rel="nofollow">BRepBuilderAPI_XXX</a></li><li><a href="#brepprimapixxx" rel="nofollow">BRepPrimAPI_XXX</a></li><li><a href="#brepfilletapixxx" rel="nofollow">BRepFilletAPI_XXX</a></li><li><a href="#topexpexplorer" rel="nofollow">TopExp_Explorer</a></li><li><a href="#topabsshapeenum" rel="nofollow">TopAbs_ShapeEnum</a></li><li><a href="#brepalgoapixxx" rel="nofollow">BRepAlgoAPI_XXX</a></li><li><a href="#breptool%E4%B8%8E-standardtransient" rel="nofollow">BRep_Tool与 Standard_Transient</a></li><li><a href="#toptoolsxxx" rel="nofollow">TopTools_XXX</a></li><li><a href="#brepoffsetapixxx" rel="nofollow">BRepOffsetAPI_XXX</a></li><li><a href="#tutorial%E6%BA%90%E4%BB%A3%E7%A0%81" rel="nofollow">Tutorial源代码</a></li></ul> </li></ul> </li></ul> 
 </div> 
</div> 
<p></p> 
<blockquote> 
 <p>OCC接触两年有余了，以前使用频率不高，好多东西一知半解，现在是需要用到它的时候了。</p> 
</blockquote> 
<h4 id="tutorial简述">Tutorial简述</h4> 
<blockquote> 
 <p>Tutorial用一个绘制Bottle的例子描述了OCC建模的基本步骤。这里涉及了一些概念和类的用法，不细心看做笔记是很容易忘掉的。</p> 
</blockquote> 
<h4 id="gpxxx">gp_XXX</h4> 
<blockquote> 
 <p>gp_Pnt 是最简单的“点”；此外对应的有还有许多这样的简单结构,这些类从其类名就可以知道它可能有哪些参数，没错，这些类包含了点、线、面、轴以及各种曲面等，其中的参数都是构建这些几何结构必须的参数，我们可以称gp_Pnt这一类的类为<strong>基本几何类</strong>。 <br> —————————————————————————————— <br> - gp_Ax2 <br> - gp_Ax2d <br> - gp_Ax3 <br> - gp_Ax3d <br> - gp_Ax22 <br> - gp_Ax22d <br> - gp_Circ <br> - gp_Circ2d <br> - gp_Cone <br> - gp_Cylinder <br> - gp_Dir <br> - gp_Dir2d <br> - gp_Elips <br> - gp_Elips2d <br> - gp_EulerSequence <br> - gp_GTrsf <br> - gp_GTrsf2d <br> - gp_Hypr <br> - gp_Hypr2d <br> - gp_Lin <br> - gp_Lin2d <br> - gp_Mat <br> - gp_Mat2d <br> - gp_Parab <br> - gp_Parab2d <br> - gp_Pln <br> - gp_Pnt2d <br> - gp_Quaternion <br> - gp_QuaternionNLerp <br> - gp_QuaternionSLerp <br> - gp_Sphere <br> - gp_Torus <br> - gp_Trsf <br> - gp_Trsf2d <br> - gp_TrsfForm <br> - gp_TrsfNLerp <br> - gp_Vec <br> - gp_Vec2d <br> - gp_VectorWithNullMagnitude <br> - gp_XY <br> - gp_XYZ</p> 
</blockquote> 
<h4 id="standardxxx">Standard_XXX</h4> 
<blockquote> 
 <p>Standard_XXX类型的类是OCC的类型定义、宏定义的数据结构，与我们常用的C++没有区别的，我们可以称其为<strong>OCC定义数值类型</strong>。</p> 
</blockquote> 
<pre class="prettyprint"><code class=" hljs cpp"><span class="hljs-preprocessor">#define Standard_False false</span>
<span class="hljs-preprocessor">#define Standard_True  true</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">int</span>           Standard_Integer;
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">double</span>        Standard_Real;
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">bool</span>          Standard_Boolean;
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">float</span>         Standard_ShortReal;
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">char</span>          Standard_Character;
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> Standard_Byte;
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">void</span>*         Standard_Address;
<span class="hljs-keyword">typedef</span> size_t        Standard_Size;
<span class="hljs-keyword">typedef</span> <span class="hljs-built_in">std</span>::time_t   Standard_Time;

<span class="hljs-comment">// Unicode primitives, char16_t, char32_t</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">char</span>          Standard_Utf8Char;     <span class="hljs-comment">//!&lt; signed   UTF-8 char</span>
<span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> Standard_Utf8UChar;    <span class="hljs-comment">//!&lt; unsigned UTF-8 char</span></code></pre> 
<h4 id="geomxxx">Geom_XXX</h4> 
<blockquote> 
 <p>Geom定义了几何数据结构，但也仅此而已，并不包含什么算法，可以说它是由gp_XXX构建而成的数据结构，比gp_XXX高级一些。我们可以称其为<strong>构建几何类</strong>。 <br> ——————————————————————————————</p> 
 <p>Geom_Axis1Placement <br> Geom_Axis2Placement <br> Geom_AxisPlacement <br> Geom_BezierCurve <br> Geom_BezierSurface <br> Geom_BoundedCurve <br> Geom_BoundedSurface <br> Geom_BSplineCurve <br> Geom_BSplineSurface <br> Geom_CartesianPoint <br> Geom_Circle <br> Geom_Conic <br> ……</p> 
</blockquote> 
<h4 id="gcmakexxx">GC_MakeXXX</h4> 
<blockquote> 
 <p>GC_MakeXXX由简单的几何数据结构构建复杂的、常见的、带参数的几何结构Geom_XXX，它主要包含的就是构建算法，我们可以称其为<strong>几何形状构建包</strong>，构建的结果是指向Geom_XXX的指针。 <br> —————————————————————————————— <br> GC_MakeArcOfCircle <br> GC_MakeArcOfEllipse <br> GC_MakeArcOfHyperbola <br> GC_MakeArcOfParabola <br> GC_MakeCircle <br> GC_MakeConicalSurface <br> GC_MakeCylindricalSurface <br> GC_MakeEllipse <br> GC_MakeHyperbola. <br> GC_MakeLine <br> GC_MakeMirror <br> GC_MakePlane <br> GC_MakeRotation <br> GC_MakeScale <br> GC_MakeSegment <br> GC_MakeTranslation <br> GC_MakeTrimmedCone <br> GC_MakeTrimmedCylinder <br> GC_Root</p> 
</blockquote> 
<pre class="prettyprint"><code class=" hljs fix"><span class="hljs-attribute">Handle(Geom_TrimmedCurve) aArcOfCircle </span>=<span class="hljs-string"> GC_MakeArcOfCircle(aPnt2,aPnt3,aPnt4);</span></code></pre> 
<h4 id="topodsxxx">TopoDS_XXX</h4> 
<blockquote> 
 <p>TopoDS_XXX比Geom_XXX再高一级，是多个Geom_XXX的一种组合。每一个TopoDS_XXX类都继承至TopoDS_Shape。我们可以称这一层为<strong>几何拓扑结构</strong>。包含了拓扑点、线、面、体等简单的、复杂的几何拓扑结构。注意：这层也只是数据结构，并不包含算法。 <br> —————————————————————————————— <br> TopoDS_AlertWithShape <br> TopoDS_Builder <br> TopoDS_Compound <br> TopoDS_CompSolid <br> TopoDS_Edge <br> TopoDS_Face <br> TopoDS_FrozenShape <br> TopoDS_HShape <br> TopoDS_Iterator <br> TopoDS_ListIteratorOfListOfShape <br> TopoDS_ListOfShape <br> TopoDS_LockedShape <br> TopoDS_Shape <br> TopoDS_Shell <br> TopoDS_Solid <br> TopoDS_TCompound <br> TopoDS_TCompSolid <br> TopoDS_TEdge <br> TopoDS_TFace <br> TopoDS_TShape <br> TopoDS_TShell <br> TopoDS_TSolid <br> TopoDS_TVertex <br> TopoDS_TWire <br> TopoDS_UnCompatibleShapes <br> TopoDS_Vertex <br> TopoDS_Wire</p> 
</blockquote> 
<h4 id="brepbuilderapixxx">BRepBuilderAPI_XXX</h4> 
<blockquote> 
 <p>前边说了TopoDS_XXX只是数据结构，那么如何由Geom_XXX构建TopoDS_XXX呢，这就是BRepBuilderAPI_XXX的工作了。我们可以称这一层为<strong>拓扑结构构建包</strong>。它的返回值直接就是TopoDS_XXX。</p> 
</blockquote> 
<p>此外这一部分有好多需要注意的事项:</p> 
<blockquote> 
 <ul><li>通过矩阵变换获取拓扑结构</li><li>通过向下转型(TopoDS::XXX)获取拓扑结构</li><li>通过TopoDS的组合获取TopoDS结构</li></ul> 
</blockquote> 
<p><strong>也就是说：这一步骤相当于使用一个CAD、SolidWorks等的造型软件。熟悉造型的功能，想必更熟悉这部分要完成的工作。</strong></p> 
<blockquote> 
 <p>—————————————————————————————— <br> BRepBuilderAPI_BndBoxTreeSelector <br> BRepBuilderAPI_CellFilter <br> BRepBuilderAPI_Collect <br> BRepBuilderAPI_Command <br> BRepBuilderAPI_Copy <br> BRepBuilderAPI_EdgeError <br> BRepBuilderAPI_FaceError <br> BRepBuilderAPI_FastSewing <br> BRepBuilderAPI_FindPlane <br> BRepBuilderAPI_GTransform <br> BRepBuilderAPI_MakeEdge <br> BRepBuilderAPI_MakeEdge2d <br> BRepBuilderAPI_MakeFace <br> BRepBuilderAPI_MakePolygon <br> BRepBuilderAPI_MakeShape <br> BRepBuilderAPI_MakeShell <br> BRepBuilderAPI_MakeSolid <br> BRepBuilderAPI_MakeVertex <br> BRepBuilderAPI_MakeWire <br> BRepBuilderAPI_ModifyShape <br> BRepBuilderAPI_NurbsConvert <br> BRepBuilderAPI_PipeError <br> BRepBuilderAPI_Sewing <br> BRepBuilderAPI_ShapeModification <br> BRepBuilderAPI_ShellError <br> BRepBuilderAPI_Transform <br> BRepBuilderAPI_TransitionMode <br> BRepBuilderAPI_VertexInspector <br> BRepBuilderAPI_WireError</p> 
</blockquote> 
<pre class="prettyprint"><code class=" hljs fix"><span class="hljs-attribute">TopoDS_Edge aEdge1 </span>=<span class="hljs-string"> BRepBuilderAPI_MakeEdge(aSegment1); 
TopoDS_Edge aEdge2 = BRepBuilderAPI_MakeEdge(aArcOfCircle); 
TopoDS_Edge aEdge3 = BRepBuilderAPI_MakeEdge(aSegment2);
</span></code></pre> 
<h4 id="brepprimapixxx">BRepPrimAPI_XXX</h4> 
<blockquote> 
 <p>这一层包的功能是把之前的拓扑结构建立成实体，它们构建的结果当然也是拓扑结果的TopoDS_XXX。我们可以称这一层为<strong>实体构建包</strong>，拓扑构建满足以下的规律：</p> 
</blockquote> 
<table><thead><tr><th align="left">形状</th><th>生成形状</th></tr></thead><tbody><tr><td align="left">顶点(vertex)</td><td>边(edge)</td></tr><tr><td align="left">边(edge)</td><td>面(face)</td></tr><tr><td align="left">线(wire)</td><td>壳(shell)</td></tr><tr><td align="left">面(face)</td><td>体(solid)</td></tr><tr><td align="left">壳(shell)</td><td>组合体(compound of solids)</td></tr></tbody></table> 
<blockquote> 
 <p>—————————————————————————————— <br> BRepPrimAPI_MakeBox <br> BRepPrimAPI_MakeCone <br> BRepPrimAPI_MakeCylinder <br> BRepPrimAPI_MakeHalfSpace <br> BRepPrimAPI_MakeOneAxis <br> BRepPrimAPI_MakePrism <br> BRepPrimAPI_MakeRevol <br> BRepPrimAPI_MakeRevolution <br> BRepPrimAPI_MakeSphere <br> BRepPrimAPI_MakeSweep <br> BRepPrimAPI_MakeTorus <br> BRepPrimAPI_MakeWedge</p> 
</blockquote> 
<h4 id="brepfilletapixxx">BRepFilletAPI_XXX</h4> 
<blockquote> 
 <p><strong>倒角包</strong>：计算倒角。 <br> —————————————————————————————— <br> BRepFilletAPI_LocalOperation <br> BRepFilletAPI_MakeChamfer <br> BRepFilletAPI_MakeFillet <br> BRepFilletAPI_MakeFillet2d</p> 
</blockquote> 
<h4 id="topexpexplorer">TopExp_Explorer</h4> 
<blockquote> 
 <p>这个类比较特殊，专门用于TopoDS_XXX的解析的，就是将已知实体(拓扑结构)解析为边组合、面组合等等。我们可以称其为<strong>拓扑解析包</strong>。</p> 
</blockquote> 
<pre class="prettyprint"><code class=" hljs mizar"><span class="hljs-keyword">for</span>(TopExp_Explorer aFaceExplorer(myBody, TopAbs_FACE) ; aFaceExplorer.More() ; aFaceExplorer.Next())
{ 
    TopoDS_Face aFace = TopoDS<span class="hljs-comment">::Face(aFaceExplorer.Current()); </span>
}
</code></pre> 
<h4 id="topabsshapeenum">TopAbs_ShapeEnum</h4> 
<blockquote> 
 <p>这也是一个特殊的结构，类似一个拓扑结构的数组，具有.More().Next().Current()三个重要的方法，我们可以称其为<strong>拓扑解析结果集</strong>。</p> 
</blockquote> 
<h4 id="brepalgoapixxx">BRepAlgoAPI_XXX</h4> 
<blockquote> 
 <p>这个是核心算法包，专门用于Shape的交common(Boolean intersection)、差cut(Boolean subtraction)、和fuse(Boolean union)的计算。底层采用的是布尔操作。我们可以称其为<strong>几何算法包</strong>。 <br> —————————————————————————————— <br> BRepAlgoAPI_Algo <br> BRepAlgoAPI_BooleanOperation <br> BRepAlgoAPI_BuilderAlgo <br> BRepAlgoAPI_Check <br> BRepAlgoAPI_Common <br> BRepAlgoAPI_Cut <br> BRepAlgoAPI_Defeaturing <br> BRepAlgoAPI_Fuse <br> BRepAlgoAPI_Section <br> BRepAlgoAPI_Splitter</p> 
</blockquote> 
<h4 id="breptool与-standardtransient">BRep_Tool与 Standard_Transient</h4> 
<blockquote> 
 <p>这个BRep_Tool类主要有三个方法，用于从TopoDS_XXX向Geom_XXX转换。 <br> TopoDS_Face -&gt; Geom_Surface <br> TopoDS_Edge -&gt; Geom_Curve <br> TopoDS_Vertex -&gt; Geom_Point <br> 而Standard_Transient类主要有两个用途。 <br> DynamicType 函数用来获取 Handle(Geom_Surface)的真实类型，因为Geom_Surface有可能是任何一种面。 <br> IsKind 用来判断该类型是否是某个类的子类。</p> 
</blockquote> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-keyword">Handle</span>(Geom_Surface) aSurface <span class="hljs-subst">=</span> BRep_Tool<span class="hljs-tag">::Surface</span>(aFace);</code></pre> 
<pre class="prettyprint"><code class=" hljs lasso"><span class="hljs-keyword">if</span>(aSurface<span class="hljs-subst">-&gt;</span>DynamicType() <span class="hljs-subst">==</span> STANDARD_TYPE(Geom_Plane))
{ 
    <span class="hljs-keyword">Handle</span>(Geom_Plane) aPlane <span class="hljs-subst">=</span> <span class="hljs-keyword">Handle</span>(Geom_Plane)<span class="hljs-tag">::DownCast</span>(aSurface);
    <span class="hljs-comment">//</span>
}
</code></pre> 
<h4 id="toptoolsxxx">TopTools_XXX</h4> 
<blockquote> 
 <p>组。List，Array，Sequence等。 <br> TopTools_Array1OfListOfShape <br> TopTools_Array1OfShape <br> TopTools_Array2OfShape <br> TopTools_DataMapIteratorOfDataMapOfIntegerListOfShape <br> TopTools_DataMapIteratorOfDataMapOfIntegerShape <br> ……</p> 
</blockquote> 
<h4 id="brepoffsetapixxx">BRepOffsetAPI_XXX</h4> 
<blockquote> 
 <p>非常有用的包，通俗点讲它的功能：如果你的线框模型可以生成实体，模型，那么它可以……里边是一个复杂而漫长的过程……我可以称他<strong>形体生成包</strong></p> 
</blockquote> 
<pre class="prettyprint"><code class=" hljs avrasm">BRepOffsetAPI_ThruSections aTool(Standard_True)<span class="hljs-comment">; </span>
aTool<span class="hljs-preprocessor">.AddWire</span>(threadingWire1)<span class="hljs-comment">; </span>
aTool<span class="hljs-preprocessor">.AddWire</span>(threadingWire2)<span class="hljs-comment">; </span>
aTool<span class="hljs-preprocessor">.CheckCompatibility</span>(Standard_False)<span class="hljs-comment">; </span>
TopoDS_Shape myThreading = aTool<span class="hljs-preprocessor">.Shape</span>()<span class="hljs-comment">;</span>
</code></pre> 
<h4 id="tutorial源代码">Tutorial源代码</h4> 
<pre class="prettyprint"><code class=" hljs lasso">TopoDS_Shape MakeBottle(const Standard_Real myWidth, const Standard_Real myHeight, const Standard_Real myThickness) 
{ 
    <span class="hljs-comment">// Profile : Define Support Points </span>
    gp_Pnt aPnt2(<span class="hljs-attribute">-myWidth</span> <span class="hljs-subst">/</span> <span class="hljs-number">2.</span>, <span class="hljs-attribute">-myThickness</span> <span class="hljs-subst">/</span> <span class="hljs-number">4.</span>, <span class="hljs-number">0</span>); 
    gp_Pnt aPnt3(<span class="hljs-number">0</span>, <span class="hljs-attribute">-myThickness</span> <span class="hljs-subst">/</span> <span class="hljs-number">2.</span>, <span class="hljs-number">0</span>); 
    gp_Pnt aPnt4(myWidth <span class="hljs-subst">/</span> <span class="hljs-number">2.</span>, <span class="hljs-attribute">-myThickness</span> <span class="hljs-subst">/</span> <span class="hljs-number">4.</span>, <span class="hljs-number">0</span>); 
    gp_Pnt aPnt5(myWidth <span class="hljs-subst">/</span> <span class="hljs-number">2.</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
    <span class="hljs-comment">// Profile : Define the Geometry </span>
    <span class="hljs-keyword">Handle</span>(Geom_TrimmedCurve) aSegment1 <span class="hljs-subst">=</span> GC_MakeSegment(aPnt1, aPnt2); 
    <span class="hljs-keyword">Handle</span>(Geom_TrimmedCurve) aSegment2 <span class="hljs-subst">=</span> GC_MakeSegment(aPnt4, aPnt5);
    <span class="hljs-comment">// Profile : Define the Topology </span>
    TopoDS_Edge anEdge1 <span class="hljs-subst">=</span> BRepBuilderAPI_MakeEdge(aSegment1); 
    TopoDS_Edge anEdge3 <span class="hljs-subst">=</span> BRepBuilderAPI_MakeEdge(aSegment2); 
    TopoDS_Wire aWire <span class="hljs-subst">=</span> BRepBuilderAPI_MakeWire(anEdge1, anEdge2, anEdge3);
    <span class="hljs-comment">// Complete Profile </span>
    gp_Ax1 xAxis <span class="hljs-subst">=</span> gp<span class="hljs-tag">::OX</span>(); 
    gp_Trsf aTrsf;
    aTrsf<span class="hljs-built_in">.</span>SetMirror(xAxis); 
    BRepBuilderAPI_Transform aBRepTrsf(aWire, aTrsf); 
    TopoDS_Wire aMirroredWire <span class="hljs-subst">=</span> TopoDS<span class="hljs-tag">::Wire</span>(aMirroredShape);
    BRepBuilderAPI_MakeWire mkWire; 
    mkWire<span class="hljs-built_in">.</span>Add(aMirroredWire); 
    TopoDS_Wire myWireProfile <span class="hljs-subst">=</span> mkWire<span class="hljs-built_in">.</span>Wire();
    <span class="hljs-comment">// Body : Prism the Profile </span>
    TopoDS_Face myFaceProfile <span class="hljs-subst">=</span> BRepBuilderAPI_MakeFace(myWireProfile); 
    gp_Vec aPrismVec(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, myHeight); 
    TopoDS_Shape myBody <span class="hljs-subst">=</span> BRepPrimAPI_MakePrism(myFaceProfile, aPrismVec);
    <span class="hljs-comment">// Body : Apply Fillets </span>
    BRepFilletAPI_MakeFillet mkFillet(myBody); 
    TopExp_Explorer anEdgeExplorer(myBody, TopAbs_EDGE); 
    <span class="hljs-keyword">while</span>(anEdgeExplorer<span class="hljs-built_in">.</span>More())
    { 
        TopoDS_Edge anEdge <span class="hljs-subst">=</span> TopoDS<span class="hljs-tag">::Edge</span>(anEdgeExplorer<span class="hljs-built_in">.</span>Current()); <span class="hljs-comment">//Add edge to fillet algorithm </span>
        mkFillet<span class="hljs-built_in">.</span>Add(myThickness <span class="hljs-subst">/</span> <span class="hljs-number">12.</span>, anEdge); 
        anEdgeExplorer<span class="hljs-built_in">.</span>Next(); 
    }
    myBody <span class="hljs-subst">=</span> mkFillet<span class="hljs-built_in">.</span>Shape();
    <span class="hljs-comment">// Body : Add the Neck </span>
    gp_Pnt neckLocation(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, myHeight); 
    gp_Dir neckAxis <span class="hljs-subst">=</span> gp<span class="hljs-tag">::DZ</span>(); 
    gp_Ax2 neckAx2(neckLocation, neckAxis);
    Standard_Real myNeckRadius <span class="hljs-subst">=</span> myThickness <span class="hljs-subst">/</span> <span class="hljs-number">4.</span>; 
    Standard_Real myNeckHeight <span class="hljs-subst">=</span> myHeight <span class="hljs-subst">/</span> <span class="hljs-number">10.</span>;
    BRepPrimAPI_MakeCylinder MKCylinder(neckAx2, myNeckRadius, myNeckHeight); 
    TopoDS_Shape myNeck <span class="hljs-subst">=</span> MKCylinder<span class="hljs-built_in">.</span>Shape();
    myBody <span class="hljs-subst">=</span> BRepAlgoAPI_Fuse(myBody, myNeck);
    <span class="hljs-comment">// Body : Create a Hollowed Solid </span>
    TopoDS_Face faceToRemove; 
    Standard_Real zMax <span class="hljs-subst">=</span> <span class="hljs-subst">-</span><span class="hljs-number">1</span>;
    for(TopExp_Explorer aFaceExplorer(myBody, TopAbs_FACE); aFaceExplorer<span class="hljs-built_in">.</span>More(); aFaceExplorer<span class="hljs-built_in">.</span>Next())
    { 
        TopoDS_Face aFace <span class="hljs-subst">=</span> TopoDS<span class="hljs-tag">::Face</span>(aFaceExplorer<span class="hljs-built_in">.</span>Current()); <span class="hljs-comment">// Check if &lt;aFace&gt; is the top face of the bottle’s neck </span>
        <span class="hljs-keyword">Handle</span>(Geom_Surface) aSurface <span class="hljs-subst">=</span> BRep_Tool<span class="hljs-tag">::Surface</span>(aFace); 
        <span class="hljs-keyword">if</span>(aSurface<span class="hljs-subst">-&gt;</span>DynamicType() <span class="hljs-subst">==</span> STANDARD_TYPE(Geom_Plane))
        { 
            <span class="hljs-keyword">Handle</span>(Geom_Plane) aPlane <span class="hljs-subst">=</span> <span class="hljs-keyword">Handle</span>(Geom_Plane)<span class="hljs-tag">::DownCast</span>(aSurface); 
            gp_Pnt aPnt <span class="hljs-subst">=</span> aPlane<span class="hljs-subst">-&gt;</span>Location(); 
            Standard_Real aZ <span class="hljs-subst">=</span> aPnt<span class="hljs-built_in">.</span>Z(); 
            <span class="hljs-keyword">if</span>(aZ <span class="hljs-subst">&gt;</span> zMax)
            { 
                zMax <span class="hljs-subst">=</span> aZ; 
                faceToRemove <span class="hljs-subst">=</span> aFace; 
            }
        }
    }
    TopTools_ListOfShape facesToRemove; 
    facesToRemove<span class="hljs-built_in">.</span>Append(faceToRemove); 
    BRepOffsetAPI_MakeThickSolid BodyMaker; 
    BodyMaker<span class="hljs-built_in">.</span>MakeThickSolidByJoin(myBody, facesToRemove, <span class="hljs-attribute">-myThickness</span> <span class="hljs-subst">/</span> <span class="hljs-number">50</span>, <span class="hljs-number">1.e-3</span>); 
    myBody <span class="hljs-subst">=</span> BodyMaker<span class="hljs-built_in">.</span>Shape(); 
    <span class="hljs-comment">// Threading : Create Surfaces </span>
    <span class="hljs-keyword">Handle</span>(Geom_CylindricalSurface) aCyl1 <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> Geom_CylindricalSurface(neckAx2, myNeckRadius <span class="hljs-subst">*</span> <span class="hljs-number">0.99</span>); 
    <span class="hljs-keyword">Handle</span>(Geom_CylindricalSurface) aCyl2 <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> Geom_CylindricalSurface(neckAx2, myNeckRadius <span class="hljs-subst">*</span> <span class="hljs-number">1.05</span>);
    <span class="hljs-comment">// Threading : Define 2D Curves </span>
    gp_Pnt2d aPnt(<span class="hljs-number">2.</span> <span class="hljs-subst">*</span> M_PI, myNeckHeight <span class="hljs-subst">/</span> <span class="hljs-number">2.</span>); 
    gp_Dir2d aDir(<span class="hljs-number">2.</span> <span class="hljs-subst">*</span> M_PI, myNeckHeight <span class="hljs-subst">/</span> <span class="hljs-number">4.</span>); 
    gp_Ax2d anAx2d(aPnt, aDir);
    Standard_Real aMajor <span class="hljs-subst">=</span> <span class="hljs-number">2.</span> <span class="hljs-subst">*</span> M_PI; 
    Standard_Real aMinor <span class="hljs-subst">=</span> myNeckHeight <span class="hljs-subst">/</span> <span class="hljs-number">10</span>;
    <span class="hljs-keyword">Handle</span>(Geom2d_Ellipse) anEllipse1 <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> Geom2d_Ellipse(anAx2d, aMajor, aMinor); 
    <span class="hljs-keyword">Handle</span>(Geom2d_Ellipse) anEllipse2 <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> Geom2d_Ellipse(anAx2d, aMajor, aMinor <span class="hljs-subst">/</span> <span class="hljs-number">4</span>); 
    <span class="hljs-keyword">Handle</span>(Geom2d_TrimmedCurve) anArc1 <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> Geom2d_TrimmedCurve(anEllipse1, <span class="hljs-number">0</span>, M_PI); 
    <span class="hljs-keyword">Handle</span>(Geom2d_TrimmedCurve) anArc2 <span class="hljs-subst">=</span> <span class="hljs-literal">new</span> Geom2d_TrimmedCurve(anEllipse2, <span class="hljs-number">0</span>, M_PI); 
    gp_Pnt2d anEllipsePnt1 <span class="hljs-subst">=</span> anEllipse1<span class="hljs-subst">-&gt;</span>Value(<span class="hljs-number">0</span>); 
    gp_Pnt2d anEllipsePnt2 <span class="hljs-subst">=</span> anEllipse1<span class="hljs-subst">-&gt;</span>Value(M_PI);
    <span class="hljs-keyword">Handle</span>(Geom2d_TrimmedCurve) aSegment <span class="hljs-subst">=</span> GCE2d_MakeSegment(anEllipsePnt1, anEllipsePnt2); 
    <span class="hljs-comment">// Threading : Build Edges and Wires </span>
    TopoDS_Edge anEdge1OnSurf1 <span class="hljs-subst">=</span> BRepBuilderAPI_MakeEdge(anArc1, aCyl1); 
    TopoDS_Edge anEdge2OnSurf1 <span class="hljs-subst">=</span> BRepBuilderAPI_MakeEdge(aSegment, aCyl1); 
    TopoDS_Edge anEdge1OnSurf2 <span class="hljs-subst">=</span> BRepBuilderAPI_MakeEdge(anArc2, aCyl2); 
    TopoDS_Edge anEdge2OnSurf2 <span class="hljs-subst">=</span> BRepBuilderAPI_MakeEdge(aSegment, aCyl2); 
    TopoDS_Wire threadingWire1 <span class="hljs-subst">=</span> BRepBuilderAPI_MakeWire(anEdge1OnSurf1, anEdge2OnSurf1); 
    TopoDS_Wire threadingWire2 <span class="hljs-subst">=</span> BRepBuilderAPI_MakeWire(anEdge1OnSurf2, anEdge2OnSurf2); 
    BRepLib<span class="hljs-tag">::BuildCurves3d</span>(threadingWire1); 
    BRepLib<span class="hljs-tag">::BuildCurves3d</span>(threadingWire2);
    <span class="hljs-comment">// Create Threading </span>
    BRepOffsetAPI_ThruSections aTool(Standard_True); 
    aTool<span class="hljs-built_in">.</span>AddWire(threadingWire1); 
    aTool<span class="hljs-built_in">.</span>AddWire(threadingWire2); 
    aTool<span class="hljs-built_in">.</span>CheckCompatibility(Standard_False);
    TopoDS_Shape myThreading <span class="hljs-subst">=</span> aTool<span class="hljs-built_in">.</span>Shape();
    <span class="hljs-comment">// Building the Resulting Compound </span>
    TopoDS_Compound aRes; 
    BRep_Builder aBuilder; 
    aBuilder<span class="hljs-built_in">.</span>MakeCompound (aRes); 
    aBuilder<span class="hljs-built_in">.</span>Add (aRes, myBody); 
    aBuilder<span class="hljs-built_in">.</span>Add (aRes, myThreading);
    <span class="hljs-keyword">return</span> aRes;
}
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a2efc0cedbf4a3d0a88c935c3cfaba86/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">NodeMCU之快速试用(一)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/3aa23ed58a41ed4f43a081eea6dc6f20/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">让DevC&#43;&#43;支持ISOC&#43;&#43;11标准</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>