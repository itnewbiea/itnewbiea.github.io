<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>纯前端导出Excel并修改样式 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="纯前端导出Excel并修改样式" />
<meta property="og:description" content="之前写过一篇前端导出：Vue实现导出功能（无后端配合） ，但是当时没考虑到样式的问题，后来要求导出的Excel单元格的样式也需要调整，尤其是宽度，第一想到的就是xlsx-style这个包，之前也没用过，这次用一下试着调一下宽度等样式，刚安装上就嘎嘎报错~~~，下面就介绍一下该库是使用，踩坑解决...
首先安装： npm i file-saver -S npm i xlsx -S npm i xlsx-style -S 然后引入 import * as XLSX from &#39;xlsx&#39; import FileSaver from &#39;file-saver&#39; import XLSXS from &#39;xlsx-style&#39; 如果仅仅是为了导出，不修改样式，也就是不引入 xlsx-style 这个库 是没有问题的，但是引入了 xlsx-style之后，直接报错，项目直接跑不起来，首先报错如下： 1. Module not found: Error: Can&#39;t resolve &#39;./cptable&#39; 解决： 只需在vue.config.js中添加如下 configureWebpack: { // 解决 Module not found: Error: Can&#39;t resolve &#39;./cptable&#39; externals: { &#39;./cptable&#39;: &#39;var cptable&#39; } } 接着还有错，
2. Module not found: Error: Can&#39;t resolve &#39;fs&#39; 解决： 接着在vue." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/24ee3b52e3b75a6d6389c68899ec4ba9/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-09-27T17:54:36+08:00" />
<meta property="article:modified_time" content="2023-09-27T17:54:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">纯前端导出Excel并修改样式</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>之前写过一篇前端导出：<a class="link-info" href="https://blog.csdn.net/m0_51431448/article/details/125831159?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167333312316800180652226%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&amp;request_id=167333312316800180652226&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_ecpm_v1~rank_v31_ecpm-1-125831159-null-null.blog_rank_default&amp;utm_term=%E5%89%8D%E7%AB%AF%E5%AF%BC%E5%87%BA&amp;spm=1018.2226.3001.4450" title="Vue实现导出功能（无后端配合）">Vue实现导出功能（无后端配合）</a> ，但是当时没考虑到样式的问题，后来要求导出的Excel单元格的样式也需要调整，尤其是宽度，第一想到的就是xlsx-style这个包，之前也没用过，这次用一下试着调一下宽度等样式，刚安装上就嘎嘎报错~~~，下面就介绍一下该库是使用，踩坑解决...</p> 
</blockquote> 
<p>首先安装： </p> 
<pre><code class="language-javascript">npm i file-saver -S
npm i xlsx -S
npm i xlsx-style -S</code></pre> 
<p>然后引入 </p> 
<pre><code class="language-javascript">import * as XLSX from 'xlsx'
import FileSaver from 'file-saver'
import XLSXS from 'xlsx-style'</code></pre> 
<p>如果仅仅是为了导出，不修改样式，也就是不引入 xlsx-style 这个库 是没有问题的，但是引入了 xlsx-style之后，直接报错，项目直接跑不起来，首先报错如下： </p> 
<p><strong>1. Module not found: Error: Can't resolve './cptable' </strong></p> 
<p>解决： </p> 
<p>只需在vue.config.js中添加如下 </p> 
<pre><code class="language-javascript">configureWebpack: {
  // 解决 Module not found: Error: Can't resolve './cptable' 
  externals: {
    './cptable': 'var cptable'
  }
}</code></pre> 
<p>接着还有错，</p> 
<p><strong>2. Module not found: Error: Can't resolve 'fs' </strong></p> 
<p>解决： </p> 
<p>接着在vue.config.js中添加 </p> 
<pre><code class="language-javascript">configureWebpack: {
  // 解决 Module not found: Error: Can't resolve './cptable'
  externals: {
    './cptable': 'var cptable'
  },
  // 解决 Module not found: Error: Can't resolve 'fs' 
  resolve: {
    fallback: {
      fs: false
    }
  }
}</code></pre> 
<p>再重新跑一下，哎呦呵，跑起来了，但是给出了个警告 </p> 
<p><img alt="" height="218" src="https://images2.imgbox.com/09/3b/YP9AApU3_o.png" width="940"></p> 
<p>它让我们安装一下 crypto-browserify 这个东东，再配置一下， 应该就可以避免了吧，唉，我这里暂时没管它， 毕竟项目跑起来了，项目和人有一个能跑的就可以啦，哈哈哈哈哈哈哈哈哈哈哈...有时间再看下吧。。</p> 
<p>当我们跑起来之后，然后使用的时候，就得使用xlsx-style中的write方法了，但是使用的时候浏览器控制台还是报错了，如下：</p> 
<p><img alt="" height="309" src="https://images2.imgbox.com/cf/8d/RYd1RFhz_o.png" width="499"></p> 
<p>这个时候就得去修改源码了，位置在 node_modules/xlsx-style/xlsx.js中1339行的位置处： </p> 
<pre><code class="language-javascript">if(typeof jszip === 'undefined') jszip = require('./js'+'zip').JSZip;
修改为：
if(typeof jszip === 'undefined') jszip = require('./jszip.js');</code></pre> 
<p>但是我们这样只是修改我们自己的本地，下次再装依赖的时候还得重新去改，不可能每次都去这改，显然是行不通的，这时候我们就可以在package.json中scripts中添加一个脚本，有个 <strong>postinstall  </strong>钩子，在我们执行完npm install后会执行postinstall对应的脚本，所以我们可以在这里做处理。</p> 
<p>首先我们在项目根目录下新建 lib/xlsx-style/xlsx.js，然后将node_modules/xlsx-style/xlsx.js拷贝过来一份，我们修改 lib/xlsx-style/xlsx.js 中的代码，将1339行修改掉，然后在scripts中添加postinstall</p> 
<pre><code class="language-javascript">"scripts": {
  "serve": "vue-cli-service serve",
  "build": "vue-cli-service build",
  "lint": "vue-cli-service lint",
  "postinstall": "node install-xlsx-style-xlsx.js"
},</code></pre> 
<p>然后在根目录下新建 install-xlsx-style-xlsx.js </p> 
<pre><code class="language-javascript">
const path = require('path')
const fs = require('fs')

const xlsxStyleModulesPath = path.join(__dirname, 'node_modules/xlsx-style/xlsx.js')
const xlsxStyleLibPath = path.join(__dirname, 'lib/xlsx-style/xlsx.js')

fs.writeFileSync(xlsxStyleModulesPath, fs.readFileSync(xlsxStyleLibPath))</code></pre> 
<p>这样就可以了，之后再安装依赖的时候就会自动替换掉node_modules/xlsx-style/xlsx.js。</p> 
<table border="1" cellpadding="1" cellspacing="1" style="width:500px;"><tbody><tr><td><strong>key</strong></td><td><strong>简介</strong></td></tr><tr><td>v</td><td>原始值（有关更多信息，请参见“数据类型”部分）</td></tr><tr><td>w</td><td>格式化文本</td></tr><tr><td>t</td><td>单元格类型：b布尔值，n数字，e错误，s字符串，d日期</td></tr><tr><td>f</td><td>单元格公式</td></tr><tr><td>r</td><td>富文本编码</td></tr><tr><td>h</td><td>富文本格式的HTML呈现</td></tr><tr><td>c</td><td>与单元格相关的评论</td></tr><tr><td>z</td><td>与单元格关联的数字格式字符串</td></tr><tr><td>l</td><td>单元超链接对象（Target含链接，tooltip工具提示）</td></tr><tr><td>s</td><td>单元格的样式/主题</td></tr></tbody></table> 
<p></p> 
<p>接下来就是方法的封装：</p> 
<p>闲话不多说了，直接上代码： </p> 
<p><strong>1.  这个是我们只需要把要打印的表格dom和下载的文件名称（name.xlsx）传入即可</strong></p> 
<p>但是这个只能打印当前的数据 </p> 
<pre><code class="language-javascript">
import * as XLSX from 'xlsx'
import FileSaver from 'file-saver'
import XLSXS from 'xlsx-style'
 
export default function(dom, fileName) {
  let tableDom = dom.cloneNode(true)
  let elTableFixedRight = tableDom.querySelector(".el-table__fixed-right")
  let elTableFixed = tableDom.querySelector(".el-table__fixed")
  if(elTableFixedRight) tableDom.removeChild(elTableFixedRight);
  if(elTableFixed) tableDom.removeChild(elTableFixed);
  let wb = XLSX.utils.table_to_book(tableDom, { raw: true, sheet: '运行日志表' })
  setExcelStyle(wb['Sheets']['运行日志表']) // 设置样式
  let wbout = XLSXS.write(wb, {  // 使用 xlsx-style 中的write方法
    bookType: 'xlsx',
    bookSST: false,
    type: 'binary'
  })
  try {
    FileSaver.saveAs( new Blob([s2ab(wbout)], { type: "application/octet-stream" }), fileName);
  } catch(e) {
    console.error(e, wbout, '-----&gt;&gt;&gt;')
  }
}

// 设置导出Excel样式 这里主要是关注单元格宽度
function setExcelStyle(data) {
  let borderAll = {
    //单元格外侧框线
    top: {
      style: "thin",
    },
    bottom: {
      style: "thin",
    },
    left: {
      style: "thin",
    },
    right: {
      style: "thin",
    },
  }
  data['!cols'] = []
  for(let key in data) {
    if(data[key].constructor === Object) {
      data[key].s = {
        // border: borderAll,  // 边框
        alignment: {
          horizontal: "center", //水平居中对齐
          vertical: "center", // 垂直居中
        },
        font: {
          sz: 11,
        },
        bold: true,
        numFmt: 0
      }
      data["!cols"].push({ wpx: 160 }); // 单元格宽度
    }
  }
}


function s2ab(s) {
  var buf = new ArrayBuffer(s.length)
  var view = new Uint8Array(buf)
  for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) &amp; 0xff
  return buf
}

/**
 * 根据dom导出多个Sheet页
 * 按需使用
 */
export class ExcelMultipleSheet {
  #book
  constructor() {
    this.#book = XLSX.utils.book_new()
  }

  append(dom, sheetname) {
    let sheet = XLSX.utils.table_to_sheet(dom)
    XLSX.utils.book_append_sheet(this.#book, sheet, sheetname)
    this.#editStyle(this.#book['Sheets'][sheetname])
  }

  download(filename = 'WFT.xlsx') {
    let wbout = XLSXS.write(this.#book, {
      bookType: 'xlsx',
      bookSST: false,
      type: 'binary'
    })
    try {
      FileSaver.saveAs(new Blob([this.#s2ab(wbout)], { type: "application/octet-stream" }), filename);
    } catch(e) {
      console.error(e, wbout, '-----&gt;&gt;&gt;')
    }
  }

  #editStyle(data) {
    data["!cols"] = []
    for(let key in data) {
      if(data.hasOwnProperty(key)) {
        if(data[key].constructor === Object) {
          data[key].s = {
            alignment: { horizontal: "center", vertical: "center" },
            font: { sz: 11, },
            bold: true,
            numFmt: 0
          }
          data["!cols"].push({ wpx: 160 }); // 单元格宽度
        }
      }
    }
  }

  #s2ab(s) {
    var buf = new ArrayBuffer(s.length)
    var view = new Uint8Array(buf)
    for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) &amp; 0xff
    return buf
  }
}</code></pre> 
<p><strong>2. 这个是我们可以自定义导出数据（</strong>一般表格会分页展示数据，如果按照上面的方式 只会导出当前页的，如果想导出所有数据 就使用该方法<strong>）传入数据list和一个导出的文件名</strong></p> 
<p>我们要遍历传入的list，所以里面的字段还需要根据自己的去修改一下 </p> 
<pre><code class="language-javascript">// 导出Excel
export function exportExcel(tableList, fileName) {
  let tableData = [['故障报警', '设备名称', '故障内容', '系统', '状态', '开始时间', '结束时间']]
  tableList.forEach(item =&gt; {
    tableData.push([ item.alarm, item.equipname, item.point, item.system, item.status, item.starttime, item.endtime ])
  })
  let ws = XLSX.utils.aoa_to_sheet(tableData)
  setExcelStyle(ws) // 设置样式
  let wb = XLSX.utils.book_new()
  XLSX.utils.book_append_sheet(wb, ws)
  let wbout = XLSXS.write(wb, {
    bookType: 'xlsx',
    bookSST: false,
    type: 'binary'
  })
  try {
    FileSaver.saveAs( new Blob([s2ab(wbout)], { type: "application/octet-stream" }), fileName);
  } catch(e) {
    console.error(e, wbout, '-----&gt;&gt;&gt;')
  }
}

// 设置导出Excel样式 这里主要是关注单元格宽度
function setExcelStyle(data) {
  let borderAll = {
    //单元格外侧框线
    top: {
      style: "thin",
    },
    bottom: {
      style: "thin",
    },
    left: {
      style: "thin",
    },
    right: {
      style: "thin",
    },
  }
  data['!cols'] = []
  for(let key in data) {
    if(data[key].constructor === Object) {
      data[key].s = {
        // border: borderAll,  // 边框
        alignment: {
          horizontal: "center", //水平居中对齐
          vertical: "center", // 垂直居中
        },
        font: {
          sz: 11,
        },
        bold: true,
        numFmt: 0
      }
      data["!cols"].push({ wpx: 180 }); // 单元格宽度
    }
  }
}


function s2ab(s) {
  var buf = new ArrayBuffer(s.length)
  var view = new Uint8Array(buf)
  for (var i = 0; i != s.length; ++i) view[i] = s.charCodeAt(i) &amp; 0xff
  return buf
}</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/240331ef437387210a3c498ec6409a11/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">R语言常用函数整理（包括基本对象处理、字符处理、数学、统计函数）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/24b4412f1eebefd65e5bfa96b83f4316/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue input输入框限制输入负号、数字、以及两位小数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>