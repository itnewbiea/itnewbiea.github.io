<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Python自动化Excel】Python与pandas字符串操作 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Python自动化Excel】Python与pandas字符串操作" />
<meta property="og:description" content="Python之所以能够成为流行的数据分析语言，有一部分原因在于其简洁易用的字符串处理能力。
Python的字符串对象封装了很多开箱即用的内置方法，处理单个字符串时十分方便；对于Excel、csv等表格文件中整列的批量字符串操作，pandas库也提供了简洁高效的处理函数，几乎与内置字符串函数一一对应。也就是说：
单个字符串处理，用Python内置的字符串方法；
表格整列的字符串处理，用pandas库中的字符串函数；
本文就以常用的数据处理需求，来对比使用以上两种方式的异同，从而加深对 Python 和 pandas 字符串操作的理解。（本文所有数据都是为了演示用的假数据，切勿当真！）
)
一、替换（去除空格） 场景：在问卷收集的姓名字段中，不少填写者会误输入空格，造成数据匹配不一致的问题。
Python names = &#39;刘 备、关 羽、 张 飞、赵 云、马 超、黄 忠&#39; names = names.replace(&#39; &#39;,&#39;&#39;) print(names) output
刘备、关羽、张飞、赵云、马超、黄忠 pandas df[&#39;姓名&#39;] = df[&#39;姓名&#39;].str.replace(&#39; &#39;,&#39;&#39;) output
pandas替换空格
二、分列 场景：在问卷收集数据的时候，多选题的数据往往是带有分隔符的。在分类汇总前往往需要按分隔符进行分列。
问卷中多选数据导出
Python hobbyStr = &#34;足球┋排球┋羽毛球┋篮球&#34; hobbyList = hobbyStr.split(&#39;┋&#39;) output
[&#39;足球&#39;, &#39;排球&#39;, &#39;羽毛球&#39;, &#39;篮球&#39;] pandas # 利用split进行分列，expand = True 返回dataframe；expand=False返回Series hobbyDf = df[&#39;爱好&#39;].str.split(&#39;|&#39;, expand=True) # 将hobbyDf 与 df安装索引合并 df2 = pd.merge(df, hobbyDf, how=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/69813c8cfe1e56e5d82a69dc280fb584/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-31T15:41:32+08:00" />
<meta property="article:modified_time" content="2022-03-31T15:41:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Python自动化Excel】Python与pandas字符串操作</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Python之所以能够成为流行的数据分析语言，有一部分原因在于其简洁易用的字符串处理能力。</p> 
<p>Python的字符串对象封装了很多开箱即用的内置方法，处理单个字符串时十分方便；对于Excel、csv等表格文件中整列的批量字符串操作，pandas库也提供了简洁高效的处理函数，几乎与内置字符串函数一一对应。也就是说：</p> 
<ul><li> <p>单个字符串处理，用Python内置的字符串方法；</p> </li><li> <p>表格整列的字符串处理，用pandas库中的字符串函数；</p> </li></ul> 
<p>本文就以常用的数据处理需求，来对比使用以上两种方式的异同，从而加深对 <code>Python</code> 和 <code>pandas</code> 字符串操作的理解。（本文所有数据都是为了演示用的假数据，切勿当真！）</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/98/b2/K00AJw6H_o.png"></p> 
<p>)</p> 
<h3>一、替换（去除空格）</h3> 
<p>场景：在问卷收集的姓名字段中，不少填写者会误输入空格，造成数据匹配不一致的问题。</p> 
<h4>Python</h4> 
<pre>names = '刘    备、关  羽、   张 飞、赵   云、马 超、黄 忠'
names = names.replace(' ','')
print(names)</pre> 
<p>output</p> 
<pre>刘备、关羽、张飞、赵云、马超、黄忠</pre> 
<h4>pandas</h4> 
<pre>df['姓名'] = df['姓名'].str.replace(' ','')</pre> 
<p>output</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/47/45/MtMNCJnZ_o.png"></p> 
<p>pandas替换空格</p> 
<h3>二、分列</h3> 
<p>场景：在问卷收集数据的时候，多选题的数据往往是带有分隔符的。在分类汇总前往往需要按分隔符进行分列。</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/e0/84/1Ci4jXiz_o.png"></p> 
<p>问卷中多选数据导出</p> 
<h4>Python</h4> 
<pre>hobbyStr = "足球┋排球┋羽毛球┋篮球"
hobbyList = hobbyStr.split('┋')</pre> 
<p>output</p> 
<pre>['足球', '排球', '羽毛球', '篮球']</pre> 
<h4>pandas</h4> 
<pre># 利用split进行分列，expand = True 返回dataframe；expand=False返回Series
hobbyDf = df['爱好'].str.split('|', expand=True)
# 将hobbyDf 与 df安装索引合并
df2 = pd.merge(df, hobbyDf, how="left", left_index=True, right_index=True)</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/af/83/at52uNpr_o.png"></p> 
<p>分列、合并、导出Excel后效果</p> 
<h3>三、切片：截取数据</h3> 
<p>字符串是由一个个字符组成的序列，在Python中可以直接对字符串进行切片操作，来进行截取数据。</p> 
<p>如“XX市四季家园二区22幢203室”，可以看作是下图中16个字符值组成的序列。而切片的语法是：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/49/00/imIYfARr_o.png"></p> 
<p>Python切片原理</p> 
<h4>Python</h4> 
<pre>addressStr = "XX市四季家园二区22幢203室"
print(f"城市：{addressStr[:3]}")
print(f"小区：{addressStr[3:9]}")</pre> 
<p>output</p> 
<pre>城市：XX市
小区：四季家园二区</pre> 
<h4>pandas</h4> 
<ul><li> <p>提取城市名称，由于城市名称的字数相同，可以直接切片截取前三个。</p> </li></ul> 
<pre>df["城市"] = df["地址"].str[:3]</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f1/7d/NTbFrE7e_o.png"></p> 
<p>提取城市</p> 
<ul><li> <p>提取小区名，稍有点复杂。因为小区名称长度是不一样长的。可以利用字符串处理的天花板： <code>正则表达式</code> 。详细处理方法，见下文 <code>五、正则表达式</code> 示例1。</p> </li></ul> 
<h3>四、补齐数据</h3> 
<p>有时候，我们在电脑中按文件名排序的时候，你可能会遇到下面的情况：</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/f6/33/9F4gpjT7_o.png"></p> 
<p>数值排序和字符排序</p> 
<p>在不同系统中，我们希望是按数值排序，但偏偏系统却是按字符排序的，如某些车载播放器中。比较好的解决方法就是在前面添加0，补齐数据位数。数据量大的时候，手动修改很麻烦，Python字符串处理的 <code>zfill()</code> 函数就可以解决这个问题。</p> 
<h4>Python</h4> 
<pre>myStr = "1章节"
print(myStr.zfill(4))  # 整个字符串补齐到4位</pre> 
<p>output</p> 
<pre>01章节</pre> 
<h4>pandas</h4> 
<pre>df["新文件名"] = "第"+df["文件名"].str[1:].str.zfill(8)</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/5a/33/7mTeNUVX_o.png"></p> 
<p>image-20220330005403437</p> 
<p>配合 <code>os.rename()</code> 便可以批量重命名。关键代码如下</p> 
<pre>df.apply(lambda x: os.rename( path + x["文件名"], path + x["新文件名"]), axis=1)</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/6e/9c/8F7jfztZ_o.gif"></p> 
<p>批量重命名演示</p> 
<h3>五、正则表达式</h3> 
<p>遇到复杂的字符串处理需求时，Python有优势就可以体现出来了。因为python和pandas有一个超强的字符串处理武器：正则表达式。正则表达式可以匹配字符串的格式特点，如电子邮箱的地址格式、网址的地址格式、电话号码格式等。如何写好正则表达式，这是一门精深的学问，本文介绍几个正则表达式的常用案例，浅尝辄止。</p> 
<p>注：Python默认不支持正则表达式语法，而pandas直接支持正则表达式语法，这里重点介绍pandas处理表格数据。</p> 
<h4>1.提取长度不一样的小区名</h4> 
<p>思路：</p> 
<ul><li> <p>提取上面小区名，可以归纳一下地址中小区名的格式特点： <code>苏州市之后，幢号数字之前的中文字符</code> 。</p> </li><li> <p><code>Series</code> 的 <code>str.extract()</code> ，可用正则从字符数据中抽取匹配的数据；</p> </li></ul> 
<pre>## 匹配中文字符的正则表达式： [\u4e00-\u9fa5]
pattern = r'苏州市([\u4e00-\u9fa5]+)[0-9]+幢'
df["小区"] = df["地址"].str.extract(pattern, expand=False)</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/3b/0b/VUIEsnZB_o.png"></p> 
<p>提取小区名</p> 
<h4>2.提取几幢几室</h4> 
<p>思路：几幢几室，格式都是 <code>数字+幢</code> 和 <code>数字+室</code></p> 
<ul><li> <p>数字可以用 <code>[0-9]</code> 或 <code>\d</code> 来匹配；</p> </li><li> <p><code>+</code> 表示1个或多个。</p> </li></ul> 
<pre>pattern = r'([0-9]+)幢'
df["幢号"] = df["地址"].str.extract(pattern, expand=False)

pattern = r'(\d+)室'
df["室号"] = df["地址"].str.extract(pattern, expand=False)</pre> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/4e/b9/wjsVhfva_o.png"></p> 
<p>提取幢号室号</p> 
<h3>六、apply函数</h3> 
<p>apply 函数：可以对 <code>DateFrame</code> 进行逐行或逐列进行处理。</p> 
<h4>1.增加一列，将幢号按照奇偶数分类</h4> 
<p>将幢号为奇数的为A区，偶数的为B区</p> 
<pre># 定义处理的函数，共apply函数调用，传入的参数为一个Series对象
def my_func(series):
    if (series["幢号"]) % 2 != 0:
        return "A区"
    else:
        return "B区"

df["幢号分类"] = df.apply(my_func, axis=1)</pre> 
<p>上述代码中apply函数，有两个参数</p> 
<ul><li> <p>第一个参数：处理逻辑的函数名。主要传入名称，这里为 <code>my_func</code> ；</p> </li><li> <p>第二个参数： <code>axis = 1</code> ，表示按列处理。即传入的是每一行的 <code>Series</code> 。</p> </li></ul> 
<p>output</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/48/8a/GjHH2ayF_o.png"></p> 
<p>apply映射分类</p> 
<h4>2.增加一列，字典映射</h4> 
<pre>def my_func2(series):
    # 映射字典，key为小区名，value为小区称号
    my_dict = {
    '吉祥如意家园': '最佳好运小区', 
    '科技村': '最佳科创小区',
     '四季家园': '最佳风光小区', 
     '万象更新家园': '最佳风采小区',
    }
    # 每一行小区名称，切片截取至倒数第2个，即-2
    nameKey = series['小区'][:-2]
    return my_dict[nameKey]

df["小区称号"] = df.apply(my_func2, axis=1)</pre> 
<p>output</p> 
<p class="img-center"><img alt="" src="https://images2.imgbox.com/bb/d3/Jsjlvz0P_o.png"></p> 
<p>apply匹配映射</p> 
<h3>结语</h3> 
<p>本文演示的字符串操作： <code>替换</code> 、 <code>分列</code> 、 <code>切片截取</code> 、 <code>补齐数据</code> 、 <code>正则表达式</code> 、 <code>apply()函数</code> 常见于数据分析的数据清洗环节， <code>替换</code> 、 <code>分列</code> 、 <code>切片截取</code> 在Excel中也很容易实现， <code>正则表达式</code> 可以说是Python处理复杂字符串问题的一大利器， <code>apply()函数</code> 可以实现 <code>自定义函数</code> 处理表格型的数据，十分灵活、威力巨大。由于篇幅有限， <code>正则表达式</code> 、 <code>apply()函数</code> 本文就点到为止，今后值得整理更多相关案例。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/736e4b04970e997a76f0574a6d5b2428/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Matplotlib 散点图 绘制详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/2b0a4f79399ffe59ee5f485665b35c7a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ResourceNotFound：gazebo_ros</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>