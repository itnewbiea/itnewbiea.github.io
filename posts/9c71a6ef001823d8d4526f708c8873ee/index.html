<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java：博客系统，实现加盐加密，分页，草稿箱，定时发布 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java：博客系统，实现加盐加密，分页，草稿箱，定时发布" />
<meta property="og:description" content="文章目录 1. 项目概述2. 准备工作2.1 数据库表格代码2.2 前端代码2.3 配置文件 3. 准备项目结构3.1 拷贝前端模板3.2 定义实体类3.3 定义mapper接口和 xml 文件3.4 创建其他包 4. 统一数据返回4.1 Result 类4.2 统一数据格式 5. 注册5.1 逻辑5.2 验证数据规范性5.3 实现注册5.4 前端代码完善 6. 登录6.1 前端代码6.2 后端代码 7. 拦截器7.1 逻辑7.2 拦截规则7.3 拦截器所作用的范围 8. 博客编辑页8.1 逻辑8.2 触发登录验证8.3 发布文章8.4 保存至草稿箱8.5 退出账号 9. 个人主页9.1 获取用户信息栏9.2 获取个人主页所有文章9.3 删除文章 10. 博客详情页10.1 获取 URL 中的参数10.2 左侧作者信息10.3 右侧文章详情 11. 修改文章页11.1 加载文章内容11.2 将文章保存为草稿11.3 修改后发表 12. 博客主页12.1 分页12.2 前端12.3 后端12.4 实现剩下四个按钮 13. 密码加盐加密13.1 加盐加密13.2 验证13.3 更新 14." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9c71a6ef001823d8d4526f708c8873ee/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-23T13:37:46+08:00" />
<meta property="article:modified_time" content="2023-02-23T13:37:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java：博客系统，实现加盐加密，分页，草稿箱，定时发布</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__1" rel="nofollow">1. 项目概述</a></li><li><a href="#2__28" rel="nofollow">2. 准备工作</a></li><li><ul><li><a href="#21__29" rel="nofollow">2.1 数据库表格代码</a></li><li><a href="#22__76" rel="nofollow">2.2 前端代码</a></li><li><a href="#23__80" rel="nofollow">2.3 配置文件</a></li></ul> 
  </li><li><a href="#3__107" rel="nofollow">3. 准备项目结构</a></li><li><ul><li><a href="#31__110" rel="nofollow">3.1 拷贝前端模板</a></li><li><a href="#32__114" rel="nofollow">3.2 定义实体类</a></li><li><a href="#33_mapper_xml__148" rel="nofollow">3.3 定义mapper接口和 xml 文件</a></li><li><a href="#34__185" rel="nofollow">3.4 创建其他包</a></li></ul> 
  </li><li><a href="#4__190" rel="nofollow">4. 统一数据返回</a></li><li><ul><li><a href="#41_Result__194" rel="nofollow">4.1 Result 类</a></li><li><a href="#42__231" rel="nofollow">4.2 统一数据格式</a></li></ul> 
  </li><li><a href="#5__279" rel="nofollow">5. 注册</a></li><li><ul><li><a href="#51__281" rel="nofollow">5.1 逻辑</a></li><li><a href="#52__290" rel="nofollow">5.2 验证数据规范性</a></li><li><a href="#53__328" rel="nofollow">5.3 实现注册</a></li><li><a href="#54__376" rel="nofollow">5.4 前端代码完善</a></li></ul> 
  </li><li><a href="#6__400" rel="nofollow">6. 登录</a></li><li><ul><li><a href="#61__403" rel="nofollow">6.1 前端代码</a></li><li><a href="#62__440" rel="nofollow">6.2 后端代码</a></li></ul> 
  </li><li><a href="#7__482" rel="nofollow">7. 拦截器</a></li><li><ul><li><a href="#71__489" rel="nofollow">7.1 逻辑</a></li><li><a href="#72__496" rel="nofollow">7.2 拦截规则</a></li><li><a href="#73__516" rel="nofollow">7.3 拦截器所作用的范围</a></li></ul> 
  </li><li><a href="#8__550" rel="nofollow">8. 博客编辑页</a></li><li><ul><li><a href="#81__551" rel="nofollow">8.1 逻辑</a></li><li><a href="#82__560" rel="nofollow">8.2 触发登录验证</a></li><li><a href="#83__621" rel="nofollow">8.3 发布文章</a></li><li><a href="#84__685" rel="nofollow">8.4 保存至草稿箱</a></li><li><a href="#85__744" rel="nofollow">8.5 退出账号</a></li></ul> 
  </li><li><a href="#9__790" rel="nofollow">9. 个人主页</a></li><li><ul><li><a href="#91__793" rel="nofollow">9.1 获取用户信息栏</a></li><li><a href="#92__852" rel="nofollow">9.2 获取个人主页所有文章</a></li><li><a href="#93__929" rel="nofollow">9.3 删除文章</a></li></ul> 
  </li><li><a href="#10__984" rel="nofollow">10. 博客详情页</a></li><li><ul><li><a href="#101__URL__992" rel="nofollow">10.1 获取 URL 中的参数</a></li><li><a href="#102__1016" rel="nofollow">10.2 左侧作者信息</a></li><li><a href="#103__1076" rel="nofollow">10.3 右侧文章详情</a></li></ul> 
  </li><li><a href="#11__1138" rel="nofollow">11. 修改文章页</a></li><li><ul><li><a href="#111__1149" rel="nofollow">11.1 加载文章内容</a></li><li><a href="#112__1211" rel="nofollow">11.2 将文章保存为草稿</a></li><li><a href="#113__1288" rel="nofollow">11.3 修改后发表</a></li></ul> 
  </li><li><a href="#12__1351" rel="nofollow">12. 博客主页</a></li><li><ul><li><a href="#121__1355" rel="nofollow">12.1 分页</a></li><li><a href="#122__1360" rel="nofollow">12.2 前端</a></li><li><a href="#123__1426" rel="nofollow">12.3 后端</a></li><li><a href="#124__1451" rel="nofollow">12.4 实现剩下四个按钮</a></li></ul> 
  </li><li><a href="#13__1553" rel="nofollow">13. 密码加盐加密</a></li><li><ul><li><a href="#131__1572" rel="nofollow">13.1 加盐加密</a></li><li><a href="#132__1602" rel="nofollow">13.2 验证</a></li><li><a href="#133__1624" rel="nofollow">13.3 更新</a></li></ul> 
  </li><li><a href="#14_Session__1647" rel="nofollow">14. Session 持久化</a></li><li><a href="#15__1704" rel="nofollow">15. 实现定时发布功能</a></li><li><ul><li><a href="#151__1706" rel="nofollow">15.1 逻辑</a></li><li><a href="#152__1715" rel="nofollow">15.2 建表</a></li><li><a href="#153__1752" rel="nofollow">15.3 后端实现</a></li><li><ul><li><a href="#1531__1753" rel="nofollow">15.3.1 时间戳问题</a></li><li><a href="#1532__1769" rel="nofollow">15.3.2 构造方法与小根堆</a></li><li><a href="#1533__1793" rel="nofollow">15.3.3 启动线程</a></li><li><a href="#1534__1848" rel="nofollow">15.3.4 运行过程中添加定时发布的文章</a></li><li><a href="#1535__1879" rel="nofollow">15.3.5 前端部分</a></li></ul> 
  </li></ul> 
  </li><li><a href="#16__1974" rel="nofollow">16. 全代码</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__1"></a>1. 项目概述</h2> 
<p>博客系统，可以说是非常经典的项目了。该博客系统是基于 SSM 框架所实现的，除了博客的游览，发布等功能，还实现了：分页查询，MySQL中用户密码的密文存储（使用MD5加密搭配加盐实现），草稿箱，定时发布等功能</p> 
<p>本博客系统主要的页面有登录页，注册页，个人博客页，主页，博客详情页，博客编辑页，博客修改页。这些页面的具体工作，根据生活经验和页面名字也都能得知。</p> 
<p>以下是各个页面的展示效果</p> 
<p>登录页<br> <img src="https://images2.imgbox.com/95/63/vdEKqWkB_o.png" alt="在这里插入图片描述">注册页（比登录页少了个注册）<br> <img src="https://images2.imgbox.com/5b/4e/zwTPNOWR_o.png" alt="在这里插入图片描述">个人博客页<br> <img src="https://images2.imgbox.com/36/27/89RJGP7P_o.png" alt="在这里插入图片描述"></p> 
<p>主页<br> <img src="https://images2.imgbox.com/c0/97/LDcrHpZf_o.png" alt="在这里插入图片描述"></p> 
<p>博客编辑页<br> <img src="https://images2.imgbox.com/5b/2c/ZWL0037z_o.png" alt="在这里插入图片描述"></p> 
<p>文章详情页<br> <img src="https://images2.imgbox.com/c7/64/dK0HcJA4_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2__28"></a>2. 准备工作</h2> 
<h3><a id="21__29"></a>2.1 数据库表格代码</h3> 
<p>首先在自己的电脑上创建数据库，定义表格，可以直接复制粘贴以下代码：<br> 创建了两个表格，用户表和文章表</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 创建数据库</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> <span class="token keyword">if</span> <span class="token keyword">exists</span> blog_system<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> blog_system <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARACTER</span> <span class="token keyword">SET</span> utf8mb4<span class="token punctuation">;</span>

<span class="token comment">-- 使用数据数据</span>
<span class="token keyword">use</span> blog_system<span class="token punctuation">;</span>

<span class="token comment">-- 创建表[用户表]</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span>  userinfo<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> userinfo<span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    username <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    password <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">64</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    photo <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">''</span><span class="token punctuation">,</span>
    createtime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    updatetime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>state<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span>
<span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token keyword">charset</span> <span class="token string">'utf8mb4'</span><span class="token punctuation">;</span>

<span class="token comment">-- 创建文章表</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token keyword">exists</span>  articleinfo<span class="token punctuation">;</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> articleinfo<span class="token punctuation">(</span>
    id <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span><span class="token punctuation">,</span>
    title <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    content <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    createtime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    updatetime <span class="token keyword">datetime</span> <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    uid <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span><span class="token punctuation">,</span>
    rcount <span class="token keyword">int</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">default</span> <span class="token number">1</span><span class="token punctuation">,</span>
    <span class="token identifier"><span class="token punctuation">`</span>state<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span>
<span class="token punctuation">)</span><span class="token keyword">default</span> <span class="token keyword">charset</span> <span class="token string">'utf8mb4'</span><span class="token punctuation">;</span>

<span class="token comment">-- 添加一个用户信息</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token identifier"><span class="token punctuation">`</span>blog_system<span class="token punctuation">`</span></span><span class="token punctuation">.</span><span class="token identifier"><span class="token punctuation">`</span>userinfo<span class="token punctuation">`</span></span> <span class="token punctuation">(</span><span class="token identifier"><span class="token punctuation">`</span>id<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>username<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>password<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>photo<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>createtime<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>updatetime<span class="token punctuation">`</span></span><span class="token punctuation">,</span> <span class="token identifier"><span class="token punctuation">`</span>state<span class="token punctuation">`</span></span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> 
<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'boy'</span><span class="token punctuation">,</span> <span class="token string">'boy'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token string">'2021-12-06 17:10:48'</span><span class="token punctuation">,</span> <span class="token string">'2021-12-06 17:10:48'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">-- 文章添加测试数据</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> articleinfo<span class="token punctuation">(</span>title<span class="token punctuation">,</span>content<span class="token punctuation">,</span>uid<span class="token punctuation">)</span>
    <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'blog_system'</span><span class="token punctuation">,</span><span class="token string">'这个是正文'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
</code></pre> 
<h3><a id="22__76"></a>2.2 前端代码</h3> 
<p>前端代码直接使用模板：<br> <a href="https://gitee.com/enthusiastic-citizens6/project/tree/master/blogSystemSSM-show" rel="nofollow">前端模板</a></p> 
<h3><a id="23__80"></a>2.3 配置文件</h3> 
<p>Spring 项目的创建不再赘述，以下是Spring项目的配置文件</p> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
  	<span class="token comment"># 下面这行的 blog_system 是我数据库的名字，大家需要根据情况修改</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/blog_system<span class="token punctuation">?</span>characterEncoding=utf8
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root 
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver


<span class="token key atrule">mybatis</span><span class="token punctuation">:</span>
  <span class="token key atrule">mapper-locations</span><span class="token punctuation">:</span> classpath<span class="token punctuation">:</span>mapper/<span class="token important">**Mapper.xml</span> <span class="token comment"># 配置 MyBatis 中 xml 文件的格式</span>
  <span class="token key atrule">configuration</span><span class="token punctuation">:</span> <span class="token comment"># 配置打印 MyBatis 执行的 SQL</span>
    <span class="token key atrule">log-impl</span><span class="token punctuation">:</span> org.apache.ibatis.logging.stdout.StdOutImpl
<span class="token comment"># 配置打印 MyBatis 执行的 SQL</span>
<span class="token comment"># 配置日志打印信息</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">com</span><span class="token punctuation">:</span>
      <span class="token key atrule">example</span><span class="token punctuation">:</span>
        <span class="token key atrule">demo</span><span class="token punctuation">:</span> debug
</code></pre> 
<h2><a id="3__107"></a>3. 准备项目结构</h2> 
<p>创建完项目，指令了配置信息之后，我们可以先将项目的结构先构建出来</p> 
<h3><a id="31__110"></a>3.1 拷贝前端模板</h3> 
<p>将前端模板的代码拷贝一份到 <code>static</code> 文件中</p> 
<p><img src="https://images2.imgbox.com/1f/8e/r5cTGsqR_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32__114"></a>3.2 定义实体类</h3> 
<p>定义实体类，并且放在<code>model</code>包中。这里分别定义为<code>User</code>类和 <code>Article</code>类</p> 
<p>⭐<code>User</code> 类和 <code>Article</code>类分别「对应」数据库中的<code>userinfo</code>和<code>articleinfo</code>两张表的一条数据，并且表的字段名需要和实体类的属性名一样（如果不一样，那么需要使用<code>ResultMap</code>进行重映射，本项目不涉及）代码如下<br> <img src="https://images2.imgbox.com/38/e3/BAcv47NY_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span> <span class="token comment">// 减少代码冗余，内置 toString(), get(), set() 等常见方法</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>            <span class="token comment">// 用户 ID</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>　 <span class="token comment">// 用户名</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> password<span class="token punctuation">;</span>   <span class="token comment">// 用户密码</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> photo<span class="token punctuation">;</span>      <span class="token comment">// 头像 (可以用来拓展博客功能)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> createtime<span class="token punctuation">;</span> <span class="token comment">// 创建时间 (默认是当前时间)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> updatetime<span class="token punctuation">;</span> <span class="token comment">// 更新时间 (默认是当前时间)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span>         <span class="token comment">// 状态</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Article</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>             <span class="token comment">// 文章 ID</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>       <span class="token comment">// 标题</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>     <span class="token comment">// 正文</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> createtime<span class="token punctuation">;</span>  <span class="token comment">// 创建时间 (默认是当前时间)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> updatetime<span class="token punctuation">;</span>  <span class="token comment">// 更新时间 (默认是当前时间)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> uid<span class="token punctuation">;</span>            <span class="token comment">// 用户 ID</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> rcount<span class="token punctuation">;</span>         <span class="token comment">// 访问量 (阅读量)</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> state<span class="token punctuation">;</span>          <span class="token comment">// 状态</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="33_mapper_xml__148"></a>3.3 定义mapper接口和 xml 文件</h3> 
<p>创建 <code>mapper</code>目录，定义两个接口，来分别操作 MyBatis，并且注意加上<code>@Mapper</code>注解，这里不多说</p> 
<p><img src="https://images2.imgbox.com/60/86/aQ8BSH72_o.png" alt="在这里插入图片描述"></p> 
<p>🍓创建这两个接口对应的 xml 文件，这里要根据配置文件中约定的格式来；而对于我上面所配置的约定，需要在 resources 下创建 mapper 文件夹，然后 xml 文件以 xxMapper.xml 的格式来命名👇：</p> 
<p><img src="https://images2.imgbox.com/24/ab/3GLHRvhi_o.png" alt="在这里插入图片描述"><br> 接着在 xml 文件中加上固定的代码块，并在<code>namespace</code>中填写指定的接口路径</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.demo.mapper.xxx<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span> <span class="token comment">&lt;!-- 这里的namespace需要自己指定路径 --&gt;</span>
   
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>代码如下：<br> <code>ArticleMapper.xml</code></p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">mapper</span> <span class="token name">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mapper</span> <span class="token attr-name">namespace</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>com.example.blogsystemssm.mapper.ArticleMapper<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mapper</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p><code>UserMapper.xml</code></p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>xml version<span class="token operator">=</span><span class="token string">"1.0"</span> encoding<span class="token operator">=</span><span class="token string">"UTF-8"</span><span class="token operator">?</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">!</span><span class="token constant">DOCTYPE</span> mapper <span class="token constant">PUBLIC</span> <span class="token string">"-//mybatis.org//DTD Mapper 3.0//EN"</span> <span class="token string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>mapper namespace<span class="token operator">=</span><span class="token string">"com.example.blogsystemssm.mapper.UserMapper"</span><span class="token operator">&gt;</span>

<span class="token operator">&lt;</span><span class="token operator">/</span>mapper<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="34__185"></a>3.4 创建其他包</h3> 
<p>然后再分别创建controller, service, common 三个包，其中 common 表示公共的，这个包用来防放置一下大家都要可以用到的类，conroller 包中再创建<code>ArticleController</code>和<code>UserController</code>，service 包创建<code>ArticleService</code>和 <code>UserService</code>，并且加上相应的注解。</p> 
<p>此次，项目的大致结构就完成了，目录结果大致如下：<br> <img src="https://images2.imgbox.com/fd/b3/qubpLApX_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4__190"></a>4. 统一数据返回</h2> 
<p>在项目正式开始前，可以先利用 AOP 思想来处理所有返回给前端的数据。</p> 
<h3><a id="41_Result__194"></a>4.1 Result 类</h3> 
<p>⭐如果想要达成一个目的：返回给前端的数据必须要有三个属性，状态码<code>state</code>，其他信息<code>msg</code>，业务执行完后返回给前端的数据<code>data</code></p> 
<p>那么我们无法保证每个程序员都能够对业务执行完成之后的结果<code>data</code>经过一层包装，具备上述三个属性之后，再返回给前端。</p> 
<p>所以我们可以创建一个类<code>Result</code>，里面提供包装<code>data</code>的方法，大家看以下代码就懂了（结合注释理解）：</p> 
<pre><code class="prism language-java"><span class="token comment">/**
 * 返回结果一定要有三个值: state(状态码), msg(传递给前端的消息), data(业务执行数据)
 * 该方法专门用来包装返回结果(也就是data)，包装成 HashMap
 * 并且规定 state = 200 的时候，表示业务代码执行顺利
 *         state = -1  的时候，表示业务代码出现异常
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Result</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 业务执行成功</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">succeed</span><span class="token punctuation">(</span><span class="token class-name">Object</span> data<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
	<span class="token comment">// 业务出现有误</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">fail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"state"</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"msg"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>所以后端程序员可以将返回给前端的结果再经过 <code>Result.succeed()</code> 或者 <code>Result.fail()</code>进行包装，前端就可以获取更清晰的结果。</p> 
<p>当然，这里可以通过重载的方式来丰富 <code>succeed 和 fail</code> 中的参数</p> 
<h3><a id="42__231"></a>4.2 统一数据格式</h3> 
<p>虽然已经有了 <code>Result</code> 类，程序可以通过手动<code>Result.succeed(data)</code>或者<code>Result.fail(data)</code> 的方式向前端发送数据，但是为了保证没有漏网之鱼，可以添加一层保底 —— 统一数据格式</p> 
<p>它可以在真正将数据返回给前端之前再进行一次处理：如果返回给前端的数据已经经过<code>Result</code>处理了，这时候就不需要再包装一层；而如果数据没有经过<code>Result</code>处理，而是直接返回 -1 等等，那么这时候我们就要「补救」</p> 
<p>实现步骤：<br> Ⅰ. 创建一个类，该类使用<code>@ControllerAdvice</code> 注解修饰<br> Ⅱ. 该类需要实现<code>ResponseBodyAdvice</code>接口<br> Ⅲ. 重写<code>supports</code> 和 <code>beforeBodyWrite</code>方法，并且 <code>supports</code>方法直接返回 <code>true</code></p> 
<p>以上是「统一数据格式」的规范，代码如下</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ControllerAdvice</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ResponseAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">ResponseBodyAdvice</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">supports</span><span class="token punctuation">(</span><span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">Class</span> converterType<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> selectedContentType<span class="token punctuation">,</span> <span class="token class-name">Class</span> selectedConverterType<span class="token punctuation">,</span> <span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>然后最后一层「保底」指的就是这个<code>beforeBodyWrite</code>方法了，而其中的参数<code>Object body</code>就是返回给前端的数据，在这个方法中，我们可以对这个数据进行处理。和前边所说的逻辑一样：如果数据已经被包装了，那就直接返回，如果还没，那就在这里进行包装。代码如下</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">beforeBodyWrite</span><span class="token punctuation">(</span><span class="token class-name">Object</span> body<span class="token punctuation">,</span> <span class="token class-name">MethodParameter</span> returnType<span class="token punctuation">,</span> <span class="token class-name">MediaType</span> selectedContentType<span class="token punctuation">,</span> <span class="token class-name">Class</span> selectedConverterType<span class="token punctuation">,</span> <span class="token class-name">ServerHttpRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">ServerHttpResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 如果已经经过 Result 包装了，那就是 HashMap 类型的，直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">HashMap</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> body<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果返回的数据是 字符串类型的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>body <span class="token keyword">instanceof</span> <span class="token class-name">String</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">ObjectMapper</span> objectMapper <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ObjectMapper</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> objectMapper<span class="token punctuation">.</span><span class="token function">writeValueAsString</span><span class="token punctuation">(</span><span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 每经过处理，那就通过此处 进行包装</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>但是大伙看到这可能会感觉有点奇怪，为什么上述代码要特殊处理 <code>body </code>是 <code>String</code>类型的情况？大家感兴趣可以看这篇博客：<br> <a href="https://blog.csdn.net/weixin_45176654/article/details/109689869?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167595105316800184110657%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=167595105316800184110657&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_34-1-109689869-null-null.142%5Ev73%5Epc_new_rank,201%5Ev4%5Eadd_ask,239%5Ev1%5Econtrol&amp;utm_term=%E8%BF%94%E5%9B%9E%E5%80%BC%E6%8A%A5cannot%20be%20cast%20to%20&amp;spm=1018.2226.3001.4449">ResponseBodyAdvice、String返回值报cannot be cast to java.lang.String的解决办法</a><br> 博客写的很好，介绍得很详细，我就不说什么了</p> 
<h2><a id="5__279"></a>5. 注册</h2> 
<p>接下来才是正文</p> 
<h3><a id="51__281"></a>5.1 逻辑</h3> 
<p>首先实现最简单的注册功能<br> <img src="https://images2.imgbox.com/7d/d0/PUcQmxVQ_o.png" alt="在这里插入图片描述"><br> 这里实现的注册功能有几点要求：<br> Ⅰ. 三项数据都不能为空，否则提示用户<br> Ⅱ. 密码和确认密码要相等，前端可以进行验证<br> Ⅲ. 用户名唯一，如果后端已经存在这个用户名，则注册失败<br> Ⅳ. 满足上述要求，则将用户名和密码存储到数据库中</p> 
<h3><a id="52__290"></a>5.2 验证数据规范性</h3> 
<p>首先先引入 jQuery</p> 
<pre><code class="prism language-js">    <span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"js/jquery.min.js"</span><span class="token operator">&gt;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>对于 Ⅰ 和 Ⅱ，我们都可以在前端实现，而对于上面的所有步骤，都需要点击「提交」之后触发，所以我们在提交按钮上可以加个 onclick<br> <img src="https://images2.imgbox.com/10/8b/vEkzc7ma_o.png" alt="在这里插入图片描述"><br> 通过点击这个提交，就可以触发<code>onclick</code>这个方法，然后编写 js 的代码：</p> 
<pre><code class="prism language-js">    <span class="token keyword">function</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> password <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> passwordagain <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#passwordagain"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"账号为空"</span><span class="token punctuation">)</span>
            username<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"密码为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            password<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>passwordagain<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"确认密码为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            passwordagain<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> passwordagain<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"两次输入的密码不一致"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            password<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="53__328"></a>5.3 实现注册</h3> 
<p>通过了上面 js 代码的判断之后，就都满足Ⅰ和 Ⅱ 两个要求了，所以就可以将用户名和密码通过 Ajax 发送给后端，并约定路由为<code>/user/registry</code><br> 由刚刚的 <code>onclick</code> 方法继续下面 js 代码</p> 
<pre><code class="prism language-js">        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/user/registry"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">username</span><span class="token operator">:</span>username<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">password</span><span class="token operator">:</span>password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 等待</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>然后就可以在<code>UserController</code>中编写代码<br> Ⅰ. 后端对接收到的<code>username</code> 和 <code>password</code>仍然需要进行非空校验</p> 
<p>Ⅱ. 检验用户名是否重复，这个很简单，只需要在数据库中查询 <code>username</code>，如果返回结果为空，说明没重复，将这个用户的用户名和密码存入数据库中；否则，约定后端返回状态码<code>state</code>为 -2的时候，表示用户名重复</p> 
<p>这里涉及到的 sql 语句没什么难度，讲快一些，其中 <code>StringUtils</code>是字符串工具类，它的静态方法<code>hasLength()</code>可以用来判断字符串是否有长度</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/registry"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">registry</span><span class="token punctuation">(</span><span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 非空检验, 如果两个任意一个为空，或者两个中任意一个没有内容</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">"账号密码为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 根据用户名查询指定用户</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 不为空，说明重复了，状态码返回 -2</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">"用户名重复"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 新增（注册）一个用户</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果受影响的行数为 1</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 受影响行数不为 1</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="54__376"></a>5.4 前端代码完善</h3> 
<p>刚刚是完成了后端逻辑，那么前端接收到响应之后，就要对数据的状态码进行处理，刚刚说到，<code>state = -2</code>说明账号被注册，<code>state = 200</code> 说明一切正常，注册成功，<code>state = -1</code> 表示注册过程中出现异常或者参数有误。</p> 
<p>⭐而注册成功后，就可以将页面跳转到登录页</p> 
<p>所以 Ajax 的回调函数代码如下</p> 
<pre><code class="prism language-java">            success<span class="token operator">:</span><span class="token function">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 状态码正常, 并且数据库受影响行数 为1</span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"注册成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span> <span class="token comment">// 跳转到登录页</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"该用户名已经被注册!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        username<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"注册参数有误, 请重新注册"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
</code></pre> 
<p>最简单的注册页面就完成了，但是还有点问题，在服务器中，密码是直接以明文的形式存储在 MySQL 中的，这就有一定的安全问题，我们可以对密码进行加密之后再进行存储，我们后面再提及</p> 
<h2><a id="6__400"></a>6. 登录</h2> 
<p>只需要用户将用户名和密码输入后，前端判断是否为空，如果不为空，那么将两个数据发送给后端，约定接口为<code>/user/login</code>，后端再根据用户名查询出这个用户，判断输入密码和真实密码是否一致，返回 1 表示一致，返回 0 表示登录失败。并且登录成功之后将页面跳转到「个人主页」</p> 
<h3><a id="61__403"></a>6.1 前端代码</h3> 
<p>首先让提交按钮能够触发 js 的方法，验证有效性之后，通过 Ajax 发送请求给后端，如果状态码正常并且 <code>data</code> 为1，表示登录成功，否则提示用户账号或者密码错误</p> 
<pre><code class="prism language-java"><span class="token generics"><span class="token punctuation">&lt;</span>script<span class="token punctuation">&gt;</span></span>
    function <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">var</span> username <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> password <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>username<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"用户名为空, 请重新输入"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            username<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>     
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"密码为空, 请重新输入"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            password<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            url<span class="token operator">:</span><span class="token string">"/user/login"</span><span class="token punctuation">,</span>
            type<span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>
            data<span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                <span class="token string">"username"</span><span class="token operator">:</span>username<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string">"password"</span><span class="token operator">:</span>password<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            success<span class="token operator">:</span><span class="token function">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span> <span class="token comment">// 跳转到个人主页</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"用户名或密码错误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    username<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
<span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="62__440"></a>6.2 后端代码</h3> 
<p>接收到数据之后，如果登录成功，那么为了后续的用户体验，还需要添加会话，因此这个方法中的参数还需要<code>HttpServletSession request</code>，通过<code>request.getSession()</code> 来获取会话，并且设置参数为 true，表示如果不存在会话，那就为当前用户创建一个会话。</p> 
<p>然后需要往会话中存储用户信息，可以设置 key 为一个固定值，key 对应的 value 就是用户信息。<br> 这个固定值可以放在一个<code>Constants</code>（常量）类中进行管理</p> 
<pre><code class="prism language-java"><span class="token comment">// 用来管理常量</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Constants</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 会话中 存储用户信息的 key 值</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">USER_SESSION_KEY</span> <span class="token operator">=</span> <span class="token string">"user_session_key"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>后端登录业务代码如下：</p> 
<pre><code class="prism language-java">    <span class="token comment">// 登录</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> username<span class="token punctuation">,</span> <span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 其中一个为空</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">boolean</span> isCorrect <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 数据有效 并且 密码正确</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> isCorrect<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 获取会话，如果不存在会话，那么创建一个会话</span>
            <span class="token class-name">HttpSession</span> httpSession <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 存储用户信息</span>
            httpSession<span class="token punctuation">.</span><span class="token function">setAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION_KEY</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h2><a id="7__482"></a>7. 拦截器</h2> 
<p>为了后续的用户体验，拦截器可以通过配置的方式来拦截某一类页面。</p> 
<p>Ⅰ. 如果用户没有登录，那么这些用户是没有无法访问「个人主页」，「编辑博客」这些页面的。<br> Ⅱ. 如果登录了，那么后续页面就不需要进行重复登录<br> Ⅲ. 拦截的规则很简单，就是在访问页面或者接口的时候，验证用户是否登录，可以判断是否存在会话，会话中是否存在用户信息来进行判断</p> 
<h3><a id="71__489"></a>7.1 逻辑</h3> 
<p>拦截器实现起来和统一数据格式一样，需要按照约定编写代码</p> 
<p>Ⅰ. 自己定义一个类, 需要实现 HandleInterceptor 接口, 然后重写 preHandle 方法，这个类用来定义拦截的规则<br> Ⅱ. 再定义一个类, 再实现 WebMvcConfigurer 接口, 重写里面的 addInterceptors 方法，这用来定义需要拦截什么，不需要拦截什么<br> Ⅲ. 将第一个类对象作为参数来增加拦截器, 需要使用 addInterceptor 方法, 再用 addPathPatterns 和 excludePathPatterns 来选择拦截对象。（两个类都需要由 Spring 进行管理）</p> 
<h3><a id="72__496"></a>7.2 拦截规则</h3> 
<p>这也就是第Ⅰ步的代码，定义这个类为 <code>LoginInterceptor</code> ，拦截规则就是根据有没有登录（会话）来判断是否放行</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LoginInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">HandlerInterceptor</span> <span class="token punctuation">{<!-- --></span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">preHandle</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">,</span> <span class="token class-name">Object</span> handler<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 这个方法用来定义拦截的规则</span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果不存在会话，或者会话中的信息不存在</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION_KEY</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// 不能访问</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 可以访问</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="73__516"></a>7.3 拦截器所作用的范围</h3> 
<p>然后是第 Ⅱ 和 Ⅲ 步，第 Ⅱ 步中的类这里定义为<code>InterceptorScope</code>（拦截器范围），重写<code>addInterceptors</code>方法之后，这个方法里有个参数<code>InterceptorRegistry registry</code>，然后通过<code>registry.addInterceptor(参数)</code>方法，并将<code>LoginInterceptor</code>作为参数就可以构建一个构造器了<br> ⭐再再再通过这个构造器的<code>addPathPatterns</code> 和 <code>excludePathPatterns</code>方法来添加和去除需要拦截器所需要过滤的页面或者接口</p> 
<p>可以直接拦截所有的页面和路由，然后再去除掉一部分我们不拦截的：<br> Ⅰ. 所有的静态页面都不需要拦截<br> Ⅱ. markdown文本编辑器不需要拦截<br> <img src="https://images2.imgbox.com/cf/6e/5042CruM_o.png" alt="在这里插入图片描述"><br> Ⅲ. 所有的 js 代码和 css 代码也不需要拦截<br> Ⅳ. 图片不需要拦截<br> Ⅴ. 前端向后端发送的注册和登录请求也不需要拦截</p> 
<p>综上，该部分代码暂时可以是：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">InterceptorScope</span> <span class="token keyword">implements</span> <span class="token class-name">WebMvcConfigurer</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">LoginInterceptor</span> loginInterceptor <span class="token punctuation">;</span>
    
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">addInterceptors</span><span class="token punctuation">(</span><span class="token class-name">InterceptorRegistry</span> registry<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        registry<span class="token punctuation">.</span><span class="token function">addInterceptor</span><span class="token punctuation">(</span>loginInterceptor<span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">addPathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**"</span><span class="token punctuation">)</span>               <span class="token comment">// 所有的一切 都拦截</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/**/*.html"</span><span class="token punctuation">)</span>    <span class="token comment">// 除了 ...</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/editor.md/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/js/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/css/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/img/**"</span><span class="token punctuation">)</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/login"</span><span class="token punctuation">)</span>  <span class="token comment">// 不拦截 登录 页面</span>
                <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/user/registry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 不拦截 注册 页面</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h2><a id="8__550"></a>8. 博客编辑页</h2> 
<h3><a id="81__551"></a>8.1 逻辑</h3> 
<p>登录之后会跳到个人主页，但是个人主页晚点说，先说简单的。<br> 博客编辑页，可以将写的文章存入草稿箱，也可以直接将将文章发布出去。<br> <img src="https://images2.imgbox.com/82/d3/RD9Xq7J0_o.png" alt="在这里插入图片描述">实现逻辑：</p> 
<p>Ⅰ. 由于刚刚拦截器一键放行了所有的静态页面，这里要写博客，一定要登录，所以这里可以往后端发送请求，在后端验证登录状态，如果没登录，前端就直接将页面跳转到登录页<br> Ⅱ. 前端检验数据有效性（标题不能为空，正文不能少于 100 个字符）<br> Ⅲ. 将标题和正文发送给后端，后端通过会话，将文章内容结合会话中的用户信息存入文章表中</p> 
<h3><a id="82__560"></a>8.2 触发登录验证</h3> 
<p>这实现起来很容易，约定一个接口<code>/islogged</code>，后端再获取会话，如果登录了，返回1，否则返回0</p> 
<p>由于这个项目需要频繁验证登录状态，所以可以将会话的获取包装一下：</p> 
<pre><code class="prism language-java"><span class="token comment">// 获取用户登录信息</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SessionUtil</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 获取登录用户</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">User</span> <span class="token function">getLoginUser</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION_KEY</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">)</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>前端用 Ajax 发送请求：</p> 
<pre><code class="prism language-js">        <span class="token comment">// 检查是否已经登录了</span>
        <span class="token keyword">function</span> <span class="token function">checkIsLogged</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/user/islogged"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">// 已经登录，就可以继续</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请您先登录账号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span> <span class="token comment">// 没有登录，进行跳转</span>
                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> 
        <span class="token function">checkIsLogged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>后端：</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 验证是否已经登录
     * 已登录返回 1
     * 未登录返回 0
     * @return
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/islogged"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">isLogged</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">HttpServletResponse</span> response<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            response<span class="token punctuation">.</span><span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token number">401</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="83__621"></a>8.3 发布文章</h3> 
<p>首先为这个标题加上一个 ID<br> <img src="https://images2.imgbox.com/0f/2f/plDT8ncN_o.png" alt="在这里插入图片描述"></p> 
<p>前端验证完数据合法性之后点击「发表文章」触发 js 的方法，然后约定接口<code>/article/submit</code>发送给后端，但是需要注意：<br> <img src="https://images2.imgbox.com/b0/e1/dzitl9w9_o.png" alt="在这里插入图片描述"></p> 
<p>本项目实现了草稿箱功能，其依赖于 userinfo 表中的 state 字段，视 state = 1 的时候，文章是发表状态，视 state = 2 的时候，视为是草稿箱状态。而表中的 state 字段默认是 1，所以直接插入即可</p> 
<p>插入后返回受影响的行数，如果是 1，说明一切正常，文章发表完成，前端将页面跳转到个人主页，前端代码：</p> 
<pre><code class="prism language-js">        <span class="token comment">// 提交</span>
        <span class="token keyword">function</span> <span class="token function">mysub</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> content <span class="token operator">=</span> editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> title<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"标题不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>content <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> content<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文章内容不能少于100字"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/article/submit"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"title"</span><span class="token operator">:</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"content"</span><span class="token operator">:</span>content
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 受影响的行数为 1</span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文章上传成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span> <span class="token comment">// 跳转</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"账号未登录或文章参数有误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>后端：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@RestController</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ArticleController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token class-name">ArticleService</span> articleService <span class="token punctuation">;</span>

    <span class="token comment">// 发表一篇文章</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/submit"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> articleService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="84__685"></a>8.4 保存至草稿箱</h3> 
<p>除了直接发表文章之外，也可以直接保存到草稿箱中，这里的逻辑和发表文章非常相似，只是插入的文章 state 设置为 2 即可。🍓约定接口为<code>/artilce/draft</code><br> <img src="https://images2.imgbox.com/13/c1/TCJpIWx3_o.png" alt="在这里插入图片描述"></p> 
<p>前端代码</p> 
<pre><code class="prism language-js">        <span class="token comment">// 保存为草稿项</span>
        <span class="token keyword">function</span> <span class="token function">saveAsDraft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> content <span class="token operator">=</span> editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> title<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"标题不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>content <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> content<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文章内容不能少于100字"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/article/draft"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"title"</span><span class="token operator">:</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"content"</span><span class="token operator">:</span>content
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"成功保存到草稿箱"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"账号未登录或者参数有误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>后端代码和刚刚的发表文章十分相似，如下是 xml 文件的的 sql 语句</p> 
<p><img src="https://images2.imgbox.com/9f/75/ctcdrWkd_o.png" alt="在这里插入图片描述"><br> 代码如下</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 实现: 将文章保存到草稿箱中
     * 相当于普通的插入文章, 但是 state = 2
     * 前端返回两个参数: title, content
     * @return 返回受影响的行数
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/draft"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">saveAsDraft</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> articleService<span class="token punctuation">.</span><span class="token function">submitToDraft</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="85__744"></a>8.5 退出账号</h3> 
<p>在博客编辑页中，如下，右上角中还有个退出功能<br> <img src="https://images2.imgbox.com/88/ef/I39O9bM9_o.png" alt="在这里插入图片描述"><br> 还是一样，为这个按钮添加一个 onclick<br> <img src="https://images2.imgbox.com/d3/e1/iJPjOPBJ_o.png" alt="在这里插入图片描述"><br> 这个实现也非常简单，向约定的接口<code>/user/logout</code>发送一个请求，然后后端将相关的会话删除掉，前端再跳转到登录页就可以了</p> 
<p>前端代码：</p> 
<pre><code class="prism language-js">        <span class="token keyword">function</span> <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"确定要退出账号吗?"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 来个确认按钮</span>
                jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/user/logout"</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>
                    <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 不需要数据</span>
                    <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"注销成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 这种情况就是被拦截器锁拦截了</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"用户未登录"</span><span class="token punctuation">)</span>
                            location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/login.html"</span><span class="token punctuation">;</span> <span class="token comment">// 进行跳转</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>后端代码也很简单</p> 
<pre><code class="prism language-java">    <span class="token comment">// 退出账号</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/logout"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">logout</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpSession</span> session <span class="token operator">=</span> request<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果存在会话  并且  会话中有信息</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>session <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> session<span class="token punctuation">.</span><span class="token function">getAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION_KEY</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 那就删除这个信息</span>
            session<span class="token punctuation">.</span><span class="token function">removeAttribute</span><span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span><span class="token constant">USER_SESSION_KEY</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 退出成功</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="9__790"></a>9. 个人主页</h2> 
<p><img src="https://images2.imgbox.com/ce/16/3nM42JWg_o.png" alt="在这里插入图片描述">这个页面就是展示用户登录后的个人主页，展示所有文章，包括草稿箱中的文章，并且左侧的个人信息栏，需要显示用户的姓名和文章数量（头像也可以进行更新），⭐但是这里的文章数量是不包括草稿箱里面的文章的</p> 
<h3><a id="91__793"></a>9.1 获取用户信息栏</h3> 
<p>这里需要将左侧信息渲染完整，向后端发送请求，约定路由为<code>/user/myinfo</code>，并且这个页面启动的时候就需要向前端发送请求<br> <img src="https://images2.imgbox.com/84/95/nmYVA6WL_o.png" alt="在这里插入图片描述">并且后端需要返回两个数据：① 用户文章总数（已发布文章数） ② 用户名（也可以是这个用户对象），后端要把两个数据进行打包返回给前端</p> 
<p>所以前端拿到数据后，就可以对 以上两项数据 进行渲染，代码如下</p> 
<pre><code class="prism language-js">        <span class="token comment">// 加载左侧用户信息</span>
        <span class="token keyword">function</span> <span class="token function">getMyInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/user/myinfo"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    	<span class="token comment">// 对这两个标签的内容进行填充</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 用户姓名</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#articleCount"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>articleCount<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 用户文章总数</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token comment">// 被拦截了</span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"用户未登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">getMyInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 页面在加载的时候就发送请求进行获取</span>

</code></pre> 
<p>后端代码如下</p> 
<p><img src="https://images2.imgbox.com/af/6e/actRvQZf_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 获取个人主页的 用户名 以及创作总数
     * @return
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/myinfo"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getMyInfo</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 用来包装结果</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 存放这个对象</span>

        <span class="token comment">// 获取文章总数</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getArticleCountByUid</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"articleCount"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="92__852"></a>9.2 获取个人主页所有文章</h3> 
<p>左侧是显示用户的个人信息，右侧是该登录用户的所有文章了（包括已发表文章和保存在草稿箱中的文章），并且对于每一个文章，用户都可以进行「查看详细」，「修改」和「删除」</p> 
<p>因此，我们就需要对这一段前端代码进行渲染</p> 
<ol><li>在①这个标签再加一个 <code>id="articleListDiv"</code>，然后再将这个用户的所有文章通过 For 循环，添加到这个标签之中，每一个文章就相当于一个<code>class=blog</code>的标签</li><li>像②的标题，日期，摘要，就要重新调整具体的值，将每一篇博客的相关属性拼接上去</li><li>④和⑤也是同理，在游览器渲染的时候，就把这三个标签给构造好，④是构造好链接，⑤是为了点击删除的时候，能触发 js 中的方法</li><li>而像③这种，就要判断当前文章的state 是否为 2，来决定添加与否</li></ol> 
<p><img src="https://images2.imgbox.com/0b/11/WGRpTJYr_o.png" alt="在这里插入图片描述"><br> 约定前端发送的路由为<code>/article/mylist</code>，并且后端必然是返回 List，然后前端遍历接收到的数据，没一个数据都重新组装成一个<code>class=blog</code>的 div 元素，并作为最外层Div（articleListDiv）的子元素。</p> 
<p>但是在个人主页中，显示的每一篇文章，都不能完全展示正文，而应该展示摘要，所以还需要对正文进行提取，此处我们对该正文的前100个字符作为摘要</p> 
<p>前端代码如下</p> 
<pre><code class="prism language-js">        <span class="token comment">// 获取文章的开头</span>
        <span class="token keyword">function</span> <span class="token function">getBeginning</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>content<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果文章字符串长度小于 100</span>
                <span class="token keyword">return</span> content<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> content<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">function</span> <span class="token function">getMyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 初始化个人主页的博客信息</span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/article/mylist"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 状态码正常 &amp;&amp; 后端有返回数据 &amp;&amp; 返回的数据至少有 一篇文章</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">var</span> html <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                        result<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;div class="blog"&gt;'</span><span class="token punctuation">;</span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;div class="title"&gt;'</span> <span class="token operator">+</span> article<span class="token punctuation">.</span>title <span class="token operator">+</span><span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;div class="date"&gt;'</span> <span class="token operator">+</span> article<span class="token punctuation">.</span>createtime <span class="token operator">+</span> <span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            <span class="token keyword">if</span> <span class="token punctuation">(</span>article<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果该文章是草稿, 那么特殊备注一下</span>
                                html <span class="token operator">+=</span> <span class="token string">'&lt;div style="font-weight:bold; color:red; text-align: center;";&gt;于草稿箱中&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            <span class="token punctuation">}</span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;div class="desc"&gt;'</span> <span class="token operator">+</span> <span class="token function">getBeginning</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span>content<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'  &lt;/div&gt;'</span><span class="token punctuation">;</span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;div style="margin-top: 50px; text-align: center;"&gt;'</span><span class="token punctuation">;</span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="blog_content.html?id='</span><span class="token operator">+</span> article<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">'"&gt;查看全文&lt;/a&gt;&amp;nbsp&amp;nbsp'</span><span class="token punctuation">;</span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="blog_modify.html?id='</span><span class="token operator">+</span> article<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">'"&gt;修改&lt;/a&gt;&amp;nbsp&amp;nbsp'</span><span class="token punctuation">;</span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;a href="javascript:del('</span><span class="token operator">+</span> article<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">')"&gt;删除&lt;/a&gt;'</span><span class="token punctuation">;</span>
                            html <span class="token operator">+=</span> <span class="token string">'&lt;/div&gt;'</span> <span class="token operator">+</span> <span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#articleListDiv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>html<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 全部加到 articleListDiv 中</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 没有发表过文章</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#articleListDiv"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">"&lt;h1&gt;暂无数据&lt;/h1&gt;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">getMyList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 进入这个页面就需要执行</span>
</code></pre> 
<p>这里后端代码比前端代码简单多了，如下</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 获取用户的所有文章
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/mylist"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">getMyList</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> articles <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getAllByUid</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> articles<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="93__929"></a>9.3 删除文章</h3> 
<p>上述页面测试效果如下👇，并且在这个页面中，每一篇文章都有三个标签，这里先实现删除功能。</p> 
<p><img src="https://images2.imgbox.com/24/66/gU0tG9P0_o.png" alt="在这里插入图片描述"></p> 
<p>这个实现也简单，约定接口为<code>/article/delete</code>，前端把这个 文章的 ID 发送给后端，然后后端进入数据库中进行删除，完事了之后前端再跳转到个人主页（相当于刷新）</p> 
<p>前端代码：</p> 
<pre><code class="prism language-java">		 <span class="token comment">// 通过点击删除按钮触发这个方法</span>
        function <span class="token function">del</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 删除文章</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">confirm</span><span class="token punctuation">(</span><span class="token string">"您确定要删除该文章吗"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    url<span class="token operator">:</span><span class="token string">"/article/delete"</span><span class="token punctuation">,</span>
                    type<span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                    data<span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                        <span class="token string">"articleId"</span><span class="token operator">:</span>articleId
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    success<span class="token operator">:</span><span class="token function">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 删除的文章数量为 1</span>
                            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"删除成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"参数异常, 删除失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>需要注意：由于是删除文章，所以会话用户的 ID 必须和待删除文章的 UID 一致，否则没有权限！</p> 
<pre><code class="prism language-java">    <span class="token comment">// 删除指定文章</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/delete"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">delete</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Integer</span> articleId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>articleId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> articleId <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 获取当前会话用户</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取这篇文章对象</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 两个都不为空，并且文章得是自己的, 才能删除</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> article <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> article<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> articleService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>个人主页基本上就差不多了，但是右上角还有一个退出按钮，这里的逻辑代码都和之前的一样，直接复制过来就好了</p> 
<h2><a id="10__984"></a>10. 博客详情页</h2> 
<p>个人主页还有两个按钮没有实现：「修改」和「查看全文」</p> 
<p>先实现「查看全文」，点开以后其实就是博客详情页<br> 如下是博客详情页的结构</p> 
<p><img src="https://images2.imgbox.com/cf/b4/hDOuBHat_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="101__URL__992"></a>10.1 获取 URL 中的参数</h3> 
<p>回顾一下博客详情页是怎么进行跳转的？如下，其实就是一个拼接了文章 ID 的链接，而现在既要对左侧信息栏进行渲染，也要渲染右边的文章，就有了一个必要条件——需要获取 URL 中的 ID 发送给后端<br> <img src="https://images2.imgbox.com/66/b6/lTtI6Tz6_o.png" alt="在这里插入图片描述">获取URL中指定的参数也不难，如下 js 代码，当我们传入一个 key 值，就可以获取这个 key 在 URL 中对应的 value 值</p> 
<pre><code class="prism language-js">            <span class="token comment">// 获取当前 url 中的某个参数</span>
            <span class="token keyword">function</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token parameter">key</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">var</span> params <span class="token operator">=</span> location<span class="token punctuation">.</span>search<span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果有查询字符串</span>
                    params <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>params<span class="token punctuation">.</span><span class="token function">indexOf</span><span class="token punctuation">(</span><span class="token string">"?"</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">var</span> ary <span class="token operator">=</span> params<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取 这个 url 中所有的键值对 数组</span>
                    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ary<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token keyword">var</span> key_value <span class="token operator">=</span> ary<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获得键值对, key_value[0] 是键, key_value[1] 是值</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>key_value<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果找到了我们想要的 键</span>
                            <span class="token keyword">return</span> key_value<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">return</span> <span class="token string">""</span><span class="token punctuation">;</span> 
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="102__1016"></a>10.2 左侧作者信息</h3> 
<p>有了上述方法之后，就可以定义一个全局变量<code>curId</code>来接收当前页面的 文章 ID</p> 
<pre><code class="prism language-java">       <span class="token keyword">var</span> curId <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将当前页面的文章 id 赋值给全局变量 curId</span>
</code></pre> 
<p>接着就是处理左侧的用户信息，但是这里不一样了，刚刚是个人主页，显示自己的信息很正常，但是现在是博客详情页，显示该文章的作者相关信息会更加合理。但是前端的方法是一样的，我们稍作修改就可以正常使用了👇，然后约定路由是<code>/user/userinfo</code></p> 
<p>（注意这个页面的用户名和文章数的 div 加上 id）</p> 
<pre><code class="prism language-java">    <span class="token comment">// 然后当前文章作者的 个人信息 以及 个人创作总量</span>
        function <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                url<span class="token operator">:</span><span class="token string">"/user/userinfo"</span><span class="token punctuation">,</span>
                type<span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string">"articleId"</span><span class="token operator">:</span>curId<span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// 发送该文章的 id</span>
                success<span class="token operator">:</span><span class="token function">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#username"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>user<span class="token punctuation">.</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 用户姓名</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#articleCount"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>articleCount<span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token comment">// 用户文章总数</span>
                    <span class="token punctuation">}</span> <span class="token comment">// 否则就是异常情况</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>后端就根据 文档 iD 获取用户对象，然后再获取用户对象返回给前端即可</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 获取用户的左侧用户信息，以及已发布的文章总量
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/userinfo"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">getUserInfo</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> articleId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 数值无效</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>articleId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> articleId <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 获取这个用户</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>article <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 在获取这个用户 对象</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"user"</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 再获取这个 用户 的所有已经发布的文章</span>
        <span class="token keyword">int</span> sum <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getArticleCountByUid</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        result<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"articleCount"</span><span class="token punctuation">,</span> sum<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="103__1076"></a>10.3 右侧文章详情</h3> 
<p>还是一样，在页面启动的时候就触发方法<code>getArticleDetail</code>，约定接口为<code>/article/detail</code>，后端返回一个 Article 对象，前端再依次对相应的标签进行操作：</p> 
<pre><code class="prism language-java">        <span class="token comment">//获取文章的详情页: 然后根据 url 中的参数向后端发送请求</span>
        function <span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                url<span class="token operator">:</span><span class="token string">"/article/detail"</span><span class="token punctuation">,</span>
                type<span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string">"articleId"</span><span class="token operator">:</span>curId<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">success</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 状态码正常, 并且后端返回的数据不为空</span>
                        <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#date"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">var</span> content <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#editorDiv"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">var</span> rcount <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#rcount"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        title<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        rcount<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>rcount<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        date<span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>createtime<span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 写入的是 markdown 格式的文章, 这里需要特殊处理一下</span>
                        editormd <span class="token operator">=</span> editormd<span class="token punctuation">.</span><span class="token function">markdownToHTML</span><span class="token punctuation">(</span><span class="token string">"editorDiv"</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>markdown <span class="token operator">:</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>content<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">getArticleDetail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用这个方法, 显示出博客全文</span>
</code></pre> 
<p>后端的任务除了将这个文章返回之外，还有由于访问了这个文章详情，所以同时需要对这个文章阅读量 +1<br> <img src="https://images2.imgbox.com/84/f3/KZY2ireK_o.png" alt="在这里插入图片描述"></p> 
<p>但是<br> 如果用户未登录，文章又是草稿箱状态，那么无权限访问<br> 如果当前文章是草稿箱状态 并且 这个文章又不是自己的文章，还是没有权限访问。代码如下</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/detail"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">detail</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Integer</span> articleId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>articleId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> articleId <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取这篇文章</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果没有这篇文章  或者  用户没登录并且文章是草稿箱状态  或者  文章是草稿箱状态并且文章不是自己的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>article <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> article<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token operator">||</span>
                <span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">getState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">2</span> <span class="token operator">&amp;&amp;</span> article<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 同时进行阅读量自增 1</span>
        articleService<span class="token punctuation">.</span><span class="token function">rcountIncrease</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 返回给前端的文章 阅读量也要更新</span>
        article<span class="token punctuation">.</span><span class="token function">setRcount</span><span class="token punctuation">(</span>article<span class="token punctuation">.</span><span class="token function">getRcount</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>到这里，博客详情页基本就完成了，但是还有点细节<br> 由于博客详情页是不需要登录状态也可以访问的，所以拦截器要为<code>/article/detail</code>和 <code>/user/userinfo</code>放行</p> 
<p><img src="https://images2.imgbox.com/18/d3/C1bXrRgv_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="11__1138"></a>11. 修改文章页</h2> 
<p>在个人主页中的每个文章的三个按钮，现在就只剩一个没完成了——修改</p> 
<p>修改博客的实现其实和 编辑博客 很相似，我们可以直接将 「文章编辑页」 拷贝一份，重命名为「文章修改页」，然后修改一部分代码就行</p> 
<p><img src="https://images2.imgbox.com/15/2b/GfzVq7x4_o.png" alt="在这里插入图片描述">如上，修改页面的网址也就包含了 文章 ID，所以这里还需要用到获取 URL 参数的 js 方法，同样是拷贝一份，然后使用全局变量接收当前页面的 文章 ID</p> 
<pre><code class="prism language-js">        <span class="token keyword">var</span> curId <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 将当前页面的文章 id 赋值给全局变量 curId</span>
</code></pre> 
<h3><a id="111__1149"></a>11.1 加载文章内容</h3> 
<p>由于是修改页面，所以进入这个页面的时候，就需要将这个文章的标题和内容载入该页面，定义这个方法为<code>showArticle()</code>，约定路由<code>/article/show</code>。并且这个页面也需要登录才可以使用，而拦截器也会拦截这个 <code>/artilce/show</code>这个请求来验证登录状态，所以下边这个方法就可以删掉</p> 
<pre><code class="prism language-js">        <span class="token function">checkIsLogged</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> （多余的）
</code></pre> 
<p>在 Markdown 编译器中载入正文的实现：这个 Markdown 提供了一个方法</p> 
<pre><code class="prism language-java">        <span class="token function">initEdit</span><span class="token punctuation">(</span><span class="token string">"# 在这里写下一篇博客"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 初始化编译器的值</span>
</code></pre> 
<p>将这个方法删掉，然后放到<code>showArtilce()</code>中，将<code>initEdit()</code>的参数替换成正文就可以实现<br> 前端代码如下</p> 
<pre><code class="prism language-js">        <span class="token comment">// 然后将这篇文章的标题和内容进入注入</span>
        <span class="token keyword">function</span> <span class="token function">showArticle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/article/show"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span><span class="token string-property property">"articleId"</span><span class="token operator">:</span>curId<span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>title<span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment">// 将标题重新输入</span>
                        <span class="token function">initEdit</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 将文章正文再输入到 markdown 编译器中        </span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
                        <span class="token comment">// 参数有误</span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"参数有误"</span><span class="token punctuation">)</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/blog_list.html"</span><span class="token punctuation">;</span> <span class="token comment">// 跳转到主页</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 这种情况就是被拦截器锁拦截了</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>error <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>status <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"用户未登录"</span><span class="token punctuation">)</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"/login.html"</span><span class="token punctuation">;</span> <span class="token comment">// 跳转到登录页</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">showArticle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>后端代码，和之前的代码很相似，要进入修改页，必须文章是自己的才可以</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/show"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Integer</span> articleId<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>articleId <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> articleId <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 获取会话用户</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取文章信息</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果文章查不到，或者用户没登录 或者 文章不是会话用户的文章</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>article <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> user <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> <span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> article<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">fail</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">succeed</span><span class="token punctuation">(</span>article<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="112__1211"></a>11.2 将文章保存为草稿</h3> 
<p>当点击 「保存为草稿」的按钮的时候，触发 js 中的方法，发送请求给后端，然后后端进行修改的文章有两种可能：<br> Ⅰ. 是本来就在草稿箱，现在继续写，写完再放草稿箱<br> Ⅱ. 另一种是这个文章已经发表了，但是由于某种原因，修改完后放入草稿箱</p> 
<p>但是两种情况本质都是一样的，state 统一设置为 2 即可</p> 
<p>这里可以约定接口为 <code>/article/draft</code>，但是细心的可以会发现这个路由前面已经使用过了，前面使用的时候是「将文章放置到草稿箱中」，并且传入的参数是<br> <img src="https://images2.imgbox.com/35/7e/acFsBzBJ_o.png" alt="在这里插入图片描述">但是在这里，我们业务是修改文章，所以参数中会多一个 <code>articleId</code>⭐所以我们可以根据 <code>articleId</code>是否为空，来区分两种业务，就可以将两个业务合并到一起</p> 
<p>前端代码：</p> 
<pre><code class="prism language-js">        <span class="token comment">// 保存为草稿项</span>
        <span class="token keyword">function</span> <span class="token function">saveAsDraft</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> content <span class="token operator">=</span> editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> title<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"标题不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>content <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> content<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文章内容不能少于100字"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/article/draft"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"title"</span><span class="token operator">:</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"content"</span><span class="token operator">:</span>content<span class="token punctuation">,</span>
                    <span class="token string-property property">"articleId"</span><span class="token operator">:</span>curId
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function">success</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"成功保存到草稿箱"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"账号未登录或者参数有误"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>在 xml 文件中更新文章的 sql 语句：<br> <img src="https://images2.imgbox.com/2d/60/WAyKpo1R_o.png" alt="在这里插入图片描述"><br> <code>ArticleContoller</code>的代码</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 实现: 将文章保存到草稿箱中
     * 相当于普通的插入文章, 但是 state = 2
     * 前端返回两个参数: title, content
     * @return 返回受影响的行数
     */</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/draft"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">saveAsDraft</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Integer</span> articleId<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 存在 articlaId 说明是 修改文章并存入草稿箱</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>articleId <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">// 获取这篇文章</span>
            <span class="token class-name">Article</span> article <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 不存在这篇文章, 或者 文章作者 不是 会话用户</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>article <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> article<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> articleService<span class="token punctuation">.</span><span class="token function">updateToDraft</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> articleId<span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 否则就是 新增文章到草稿箱中</span>
        <span class="token keyword">return</span> articleService<span class="token punctuation">.</span><span class="token function">submitToDraft</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="113__1288"></a>11.3 修改后发表</h3> 
<p>这个逻辑就很容易实现了，无非就是更新文章的发布状态为 1，约定路由为<code>/article/update</code></p> 
<pre><code class="prism language-js">        <span class="token comment">// 提交</span>
        <span class="token keyword">function</span> <span class="token function">mysub</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> content <span class="token operator">=</span> editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> title<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"标题不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                title<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   
            <span class="token punctuation">}</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>content <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> content<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文章正文字数需要超过100个字"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">// 发送请求给后端</span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/article/update"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"articleId"</span><span class="token operator">:</span>curId<span class="token punctuation">,</span>
                    <span class="token string-property property">"title"</span><span class="token operator">:</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token string-property property">"content"</span><span class="token operator">:</span>content
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span>  result<span class="token punctuation">.</span>data <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 后端返回的是受影响的行数</span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"修改成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 跳转到 "我的主页"</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"修改失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">error</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请先登录账号"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"login.html"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>这里的后端代码和前面也是很相似了：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/update"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">Integer</span> articleId<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">Article</span> article <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getById</span><span class="token punctuation">(</span>articleId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 文章不存在 或者 文章不是登录用户的</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>article <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> article<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> articleService<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> articleId<span class="token punctuation">,</span> title<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<h2><a id="12__1351"></a>12. 博客主页</h2> 
<p>首页这个页面用于就是展示所有用户的文章，如下并且有分页的按钮，也就是按照用户的页面展示该部分的文章，首先说以下这个分页：</p> 
<p><img src="https://images2.imgbox.com/e2/be/FqKSn55N_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="121__1355"></a>12.1 分页</h3> 
<p>这个功能需要两个关键属性——第几页<code>pageIndex</code>，以及一页最多显示最少篇文章<code>pageSize</code>，为了测试方便和简单考虑，🍓此处将 一页最大文章数设置为 2</p> 
<p>此外，<code>pageIndex</code>和 <code>pageSize</code> 这两个信息可以放在 URL 上，然后这个页面在加载的时候就可以根据 URL 上的这两个参数向后端发送请求，后端返回指定范围的文章交给前端渲染。并且如果 URL 上没有这两个信息，那么就默认是第一页</p> 
<h3><a id="122__1360"></a>12.2 前端</h3> 
<p>首先定义两个全局变量，<code>pageIndex</code> 和 <code>pageSize</code> ，然后定义一个方法<code>init</code>在页面加载的时候完成以下工作：<br> Ⅰ. 从 URL 上获取参数并为 <code>pageIndex</code> 和 <code>pageSize</code> 赋值（别忘了拷贝 获取URL中参数 的方法）<br> Ⅱ. 发送请求给后端，约定路由是<code>/article/all</code>，接收到数据后展示给用户</p> 
<p>接收到数据后，每一篇文章都是① <code>id="blogs</code>的 div 的子元素，并且按照②的格式来为组织每一个文章，将组织好的每一篇文章加到①这个大 div 中<br> <img src="https://images2.imgbox.com/4e/b3/VZcqHJuc_o.png" alt="在这里插入图片描述">并且这里是展示所有的文章，展示的部分仍要是摘要，取文章的前 100 个字符<br> js 代码如下</p> 
<pre><code class="prism language-js">        <span class="token keyword">var</span> pageIndex<span class="token punctuation">;</span>   <span class="token comment">// 当前页面的索引, 第几页</span>
        <span class="token keyword">var</span> pageSize<span class="token punctuation">;</span>    <span class="token comment">// 当前页面最多可以显示多少篇文章</span>

        <span class="token comment">// 每次进入这个页面都要加载当前页面的效果</span>
        <span class="token comment">// 获取当前页面的 pageIndex 和 pageSize , 传递给前端, 并渲染</span>
        <span class="token keyword">function</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">var</span> temp <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">"pageIndex"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> temp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// "第几页"为有效值</span>
                pageIndex <span class="token operator">=</span> temp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>                        <span class="token comment">// 如果没有页数, 那么默认为首页</span>
                pageIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 默认为第一页</span>
            <span class="token punctuation">}</span>


            temp <span class="token operator">=</span> <span class="token function">getURLParam</span><span class="token punctuation">(</span><span class="token string">"pageSize"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>temp <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> temp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// "最多显示多少片文章为有效值"</span>
                pageSize <span class="token operator">=</span> temp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>                        <span class="token comment">// 如果没有参数, 那么默认一页显示 2 篇文章</span>
                pageSize <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/article/all"</span><span class="token punctuation">,</span>         
                <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">"pageIndex"</span><span class="token operator">:</span>pageIndex<span class="token punctuation">,</span>
                    <span class="token string-property property">"pageSize"</span><span class="token operator">:</span>pageSize
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 返回的数据是有效值</span>
                        <span class="token comment">// 对 id 为 blogs 的标签进行拼接</span>
                        <span class="token keyword">var</span> finalResult <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> result<span class="token punctuation">.</span>data<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i <span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            <span class="token keyword">var</span> cur <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>  <span class="token comment">// 当前文章</span>
                            finalResult <span class="token operator">+=</span> <span class="token string">'&lt;div class="blog"&gt;'</span><span class="token punctuation">;</span>
                            finalResult <span class="token operator">+=</span> <span class="token string">'&lt;div class="title"&gt;'</span> <span class="token operator">+</span> cur<span class="token punctuation">.</span>title <span class="token operator">+</span><span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            finalResult <span class="token operator">+=</span> <span class="token string">'&lt;div class="date"&gt;'</span> <span class="token operator">+</span> cur<span class="token punctuation">.</span>createtime <span class="token operator">+</span><span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            finalResult <span class="token operator">+=</span> <span class="token string">'&lt;div style="margin-top: 10px; text-align: center;"&gt;访问量: '</span> <span class="token operator">+</span> cur<span class="token punctuation">.</span>rcount <span class="token operator">+</span> <span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            finalResult <span class="token operator">+=</span> <span class="token string">'&lt;div class="desc"&gt;'</span> <span class="token operator">+</span> <span class="token function">getBeginning</span><span class="token punctuation">(</span>cur<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
                            finalResult <span class="token operator">+=</span> <span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                            finalResult <span class="token operator">+=</span> <span class="token string">'&lt;a href="blog_content.html?id='</span><span class="token operator">+</span> cur<span class="token punctuation">.</span>id <span class="token operator">+</span> <span class="token string">'" class="detail"&gt;查看全文 &amp;gt;&amp;gt;&lt;/a&gt;'</span><span class="token punctuation">;</span>
                            finalResult <span class="token operator">+=</span> <span class="token string">'&lt;/div&gt;'</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                        <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#blogs"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>finalResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 后端返回空，说明参数有误</span>
                        <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"参数有误！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token comment">// 跳转至首页</span>
                        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html"</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="123__1426"></a>12.3 后端</h3> 
<p>而后端怎么显示所需要的部分？<br> 可以使用 <code>limit...offset...</code>语句，从…开始返回…条数据（offset 表示要跳过的数量），返回 <code>pageSize</code>条数据，这个很明显，不多说。而从哪里开始，这个是有规律的，假设 pageSize = 5，那么要显示第3页的数据，显然就是跳过前两页的文章数（2 * pageSize），接着显示 5 条数据</p> 
<p>⭐所以规律就是 <code>limit pageSize offset (pageIndex - 1) * pageSize</code></p> 
<p>但是在 MyBatis 中不能直接这么写，需要将计算结果传进入。并且还有个细节，只能显示已发表的文章（state = 1）</p> 
<p>ArticleMapper.xml 中：<br> <img src="https://images2.imgbox.com/c2/0e/sKhmw6rq_o.png" alt="在这里插入图片描述">后端代码：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/all"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Article</span><span class="token punctuation">&gt;</span></span> <span class="token function">getPage</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> pageIndex<span class="token punctuation">,</span> <span class="token class-name">Integer</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pageSize <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> pageIndex <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> pageIndex <span class="token operator">&lt;=</span> <span class="token number">0</span> <span class="token operator">||</span> pageSize <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 提交计算 offset</span>
        <span class="token keyword">int</span> offset <span class="token operator">=</span> <span class="token punctuation">(</span>pageIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span> pageSize<span class="token punctuation">;</span>
        <span class="token keyword">return</span> articleService<span class="token punctuation">.</span><span class="token function">getPage</span><span class="token punctuation">(</span>pageSize<span class="token punctuation">,</span> offset<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="124__1451"></a>12.4 实现剩下四个按钮</h3> 
<p>首先先为这四个按钮，添加能够触发 js 方法的功能<br> <img src="https://images2.imgbox.com/c6/76/ySSpGsbA_o.png" alt="在这里插入图片描述"><br> 这四个按钮实现起来也不难：</p> 
<p>⭐Ⅰ. 首页<br> 这个实现起来最简单，没啥好说的</p> 
<pre><code class="prism language-js">    <span class="token comment">// 首页</span>
    <span class="token keyword">function</span> <span class="token function">firstPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html?pageIndex=1&amp;pageSize="</span> <span class="token operator">+</span> pageSize<span class="token punctuation">;</span>  <span class="token comment">// 默认跳到第一页</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>⭐Ⅱ. 上一页<br> 这个也简单，特殊判断以下是不是第一页，如果是，那就刷新一下</p> 
<pre><code class="prism language-js">    <span class="token comment">// 上一页</span>
    <span class="token keyword">function</span> <span class="token function">pageUp</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pageIndex <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html?pageSize="</span> <span class="token operator">+</span> pageSize<span class="token punctuation">;</span> <span class="token comment">// 相当于刷新一次</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        pageIndex <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> 
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html?pageIndex="</span> <span class="token operator">+</span> pageIndex <span class="token operator">+</span> <span class="token string">"&amp;pageSize="</span> <span class="token operator">+</span> pageSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>⭐Ⅲ. 下一页<br> 实现这个功能就需要我们知道最后一页的页码是多少，向后端发送请求，然后后端直接将计算结果返回，前端使用一个全局变量<code>finalIndex</code>接收，并且也在页面加载的时候就构造好（约定路由<code>/article/final</code>）。所以直接放在上述的<code>init()</code>方法之后就可以了，在<code>init()</code>构造好页面的时候获取 <code>finalIndex</code></p> 
<pre><code class="prism language-java">        <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取最后一页的页码</span>
        function <span class="token function">getFinalIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                url<span class="token operator">:</span><span class="token string">"/article/final"</span><span class="token punctuation">,</span>
                type<span class="token operator">:</span><span class="token string">"GET"</span><span class="token punctuation">,</span>
                data<span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token string">"pageSize"</span><span class="token operator">:</span>pageSize
                <span class="token punctuation">}</span><span class="token punctuation">,</span>
                success<span class="token operator">:</span> <span class="token function">function</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    	<span class="token comment">// 赋值 最后一页的 页码</span>
                        finalIndex <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">;</span> 
                        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token function">getFinalIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>后端要计算这个值也非常简单，只需要统计一下所有已发表文章的个数，然后除以 <code>pageSize</code>，向上取整即可。</p> 
<p>🍓向上取整可以使用<code>Math.ceil(double)</code> ，但是不推荐，可以会有精度问题，存在潜在隐患，可以结合数学思想，使用<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         ( 
        
       
         a 
        
       
         − 
        
       
         1 
        
       
         ) 
        
       
         / 
        
       
         b 
        
       
         + 
        
       
         1 
        
       
      
        (a - 1)/b + 1 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mopen">(</span><span class="mord mathnormal">a</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">−</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 1em; vertical-align: -0.25em;"></span><span class="mord">1</span><span class="mclose">)</span><span class="mord">/</span><span class="mord mathnormal">b</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.6444em;"></span><span class="mord">1</span></span></span></span></span>（分母是 b，不是 b + 1）</p> 
<p>代码如下</p> 
<pre><code class="prism language-java">    <span class="token comment">// 获取最后一页的页码</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/final"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">getFinalPage</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> pageSize<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pageSize <span class="token operator">==</span> <span class="token keyword">null</span> <span class="token operator">||</span> pageSize <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token class-name">Integer</span> total <span class="token operator">=</span> articleService<span class="token punctuation">.</span><span class="token function">getCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取文章总个数</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> <span class="token punctuation">(</span>total <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> pageSize <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>有了最后一页的页码后，这就好实现了，特殊判断现在是不是最后一页</p> 
<pre><code class="prism language-js">    <span class="token keyword">function</span> <span class="token function">pageDown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pageIndex <span class="token operator">==</span> finalIndex<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 如果已经是最后一页了</span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"已经是最后一页了"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        pageIndex <span class="token operator">=</span> <span class="token function">parseInt</span><span class="token punctuation">(</span>pageIndex<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// 下一页</span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html?pageIndex="</span> <span class="token operator">+</span> pageIndex <span class="token operator">+</span> <span class="token string">"&amp;pageSize="</span> <span class="token operator">+</span> pageSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>⭐Ⅳ. 末页<br> 直接跳最后一页</p> 
<pre><code class="prism language-js">    <span class="token comment">// 最后一页</span>
    <span class="token keyword">function</span> <span class="token function">lastPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"blog_list.html?pageIndex="</span> <span class="token operator">+</span> finalIndex <span class="token operator">+</span> <span class="token string">"&amp;pageSize="</span> <span class="token operator">+</span> pageSize<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>并且博客主页，以及申请获取最后一页的请求都是非登录状态下也能完成的，所以拦截器需要为这两个接口放行：</p> 
<pre><code class="prism language-java">            <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/article/all"</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">excludePathPatterns</span><span class="token punctuation">(</span><span class="token string">"/article/final"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="13__1553"></a>13. 密码加盐加密</h2> 
<p>用户注册的时候，将用户名和密码存入数据库的时候是采用明文存储的，这就伴随着安全隐患，后果不必多说</p> 
<p>使用传统的 MD5 加密，虽然加密之后是<strong>不可逆的</strong>，但是还有个缺陷，一个字符串固定会被转化成一个 <strong>32 位</strong>的字符串，也就存在暴力破解的可能</p> 
<p>但是不可否定的是，MD5是一个不错的工具，我们可以使用加盐算法搭配 MD5 进行加密，具体点，生成一个随机不重复的盐值（salt）和真正的密码进行拼接，再对这个结果使用 MD5 加密，然后将这个值存入数据库中，即便数据库被盗也会因为盐值的干扰从而保护密码</p> 
<p>⭐用代码表示比较好理解： <code>MD5(salt + password)</code>（为了方便陈述，<font color="red">记这个结果为 P</font>，它是长度32位的字符串）</p> 
<p>但是上述方法还有点问题，如果只是将<code>MD5(salt + password)</code>存入数据库的话，用户登录的时候，我们无法验证密码是否正确，因为加密后不可逆，盐值也无法获取。所以 P 还不能是最终的密码，我们需要知道盐值才能验证登录，⭐所以我们可以：「以内部某种约定好的格式」来将盐值和 P 进行拼接，来作为 最终存入数据库中的结果。</p> 
<p>例如：为了方便描述，我们称 最终存入数据库中的密码为：Final<br> 假设我们生成的盐值也是 32 位的，⭐那么可以约定：Final = 盐值 + P，也就是前面 32 位是盐值，后面 32 位是 P</p> 
<p>这样做的好处就是可以验证用户登录：可以按照这个规则获取到 盐值，然后将 盐值和「待验证的密码」进行拼接后 MD5 加密（也就是<code>MD5(salt + toProvePassword)</code>），然后拿着这个结果和 Final 的后 32 位（即 P）进行比较即可。（同样的字符串，MD5加密后的结果完全一致，所以通过同样的盐值加密后的结果如果一样，也就验证通过了）</p> 
<p>🍓但是如果别人知道了规律，也就可以获取盐值，可这样密码破解的成本也是很大的<br> 假设坏人获得了盐值，知道了规则，需要从 <code>MD5(salt + password)</code>中来获取密码，就需要根据这个盐值来单独生成一个彩虹表进行破解，并且只能破解一个密码，下一个密码又要重新生成彩虹表，而彩虹表的生成是一个费时又费力的事，有多费力，可以参考<a href="https://blog.csdn.net/dingxie1963/article/details/101259690?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167617873716800188533461%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167617873716800188533461&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-3-101259690-null-null.142%5Ev73%5Epc_new_rank,201%5Ev4%5Eadd_ask,239%5Ev1%5Econtrol&amp;utm_term=%E5%BD%A9%E8%99%B9%E8%A1%A8%20%E7%94%9F%E6%88%90&amp;spm=1018.2226.3001.4187">这篇博客</a></p> 
<h3><a id="131__1572"></a>13.1 加盐加密</h3> 
<p>有了思路，实现就可以拿捏了<br> 首先，盐值的获取可以用过<code> String salt = UUID.randomUUID().toString();</code>来随机获取一个盐值字符串，如下<br> <img src="https://images2.imgbox.com/87/4f/1SomWCFK_o.png" alt="在这里插入图片描述">但是这个盐值有一点特征，就是 <code>'-'</code> 这个 字符，所以可以「去掉这个特征」，通过<code>replace("-", "")</code>。<br> 这样就可以得到一个刚好长度是 32 的没有规律的盐值，然后<code>salt + md5(salt + password)</code>作为最终密码存入数据库（长度 64）。</p> 
<p>MD5 加密的使用方法如下<br> <img src="https://images2.imgbox.com/c4/37/JkqAHuZD_o.png" alt="在这里插入图片描述"><br> 代码如下</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Security</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">// 对数据的加密</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">String</span> <span class="token function">encrypt</span><span class="token punctuation">(</span><span class="token class-name">String</span> password<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 数据无效</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 得到盐值的字符串, 并且将其 格式 进行消除, 最终 salt.length = 32</span>
        <span class="token class-name">String</span> salt <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// salt + password 进行加密后 就可以得到 「临时的最终密码」</span>
        <span class="token comment">// 但是为了验证, 我们需要知道盐值, 于是将盐值 和 上者 按照某种规则进行拼接,</span>
        <span class="token class-name">String</span> finalPassword <span class="token operator">=</span> salt <span class="token operator">+</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5DigestAsHex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>salt <span class="token operator">+</span> password<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> finalPassword<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="132__1602"></a>13.2 验证</h3> 
<p>用户将密码传入，我们获取该用户密码对应的密文，然后通过自定义的规则（此处是前32位是盐值）获取密文中的盐值，然后按同样的加密规则将「salt + 待验证密码」进行 md5 加密，判断和密文中后 32 位是否一致即可验证，代码如下</p> 
<pre><code class="prism language-java">    <span class="token comment">/**
     * 验证 密码 是否正确
     * @param toProvePassword 等待验证的密码
     * @param finalPassword 数据库中的密码（密文）
     * @return
     */</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">boolean</span> <span class="token function">prove</span><span class="token punctuation">(</span><span class="token class-name">String</span> toProvePassword<span class="token punctuation">,</span> <span class="token class-name">String</span> finalPassword<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>toProvePassword<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token class-name">StringUtils</span><span class="token punctuation">.</span><span class="token function">hasLength</span><span class="token punctuation">(</span>finalPassword<span class="token punctuation">)</span>
                <span class="token operator">||</span> finalPassword<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">64</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 获取盐值</span>
        <span class="token class-name">String</span> salt <span class="token operator">=</span> finalPassword<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 按照同样的规律</span>
        toProvePassword <span class="token operator">=</span> salt <span class="token operator">+</span> <span class="token class-name">DigestUtils</span><span class="token punctuation">.</span><span class="token function">md5DigestAsHex</span><span class="token punctuation">(</span><span class="token punctuation">(</span>salt <span class="token operator">+</span> toProvePassword<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> toProvePassword<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>finalPassword<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 返回是否一致</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="133__1624"></a>13.3 更新</h3> 
<p>然后把注册的逻辑和登录的逻辑更新一下：</p> 
<p>注册逻辑更新：</p> 
<pre><code class="prism language-java">        <span class="token comment">// 新增（注册）一个用户</span>
        <span class="token class-name">String</span> finalPassword <span class="token operator">=</span> <span class="token class-name">Security</span><span class="token punctuation">.</span><span class="token function">encrypt</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">int</span> result <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>username<span class="token punctuation">,</span> finalPassword<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>登录逻辑更新：</p> 
<pre><code class="prism language-java">        <span class="token comment">// 获取该用户在数据库中的信息</span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> userService<span class="token punctuation">.</span><span class="token function">selectByUsername</span><span class="token punctuation">(</span>username<span class="token punctuation">)</span><span class="token punctuation">;</span>  
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 获取数据库中的密文</span>
        <span class="token class-name">String</span> finalPassword <span class="token operator">=</span> user<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">boolean</span> isCorrect <span class="token operator">=</span> <span class="token class-name">Security</span><span class="token punctuation">.</span><span class="token function">prove</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span> finalPassword<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// password 是用户输入的密码</span>
</code></pre> 
<h2><a id="14_Session__1647"></a>14. Session 持久化</h2> 
<p>目前会话是存储在内存中，重启服务器或者服务器断电之后会话就无了，为了提高用户的体验，可以将 Session 进行持久化存储，存于 MySQL 也行，但是不如存在 Redis 中。</p> 
<p>注意：这里涉及到了云服务上 Redis 的安装以及远程连接的问题，需要自行配置 Redis 以及开放端口。</p> 
<p>会话是一个很常用的功能，所以在 SpringBoot 项目中，只要正确导入依赖和配置 Redis 了，其他代码基本没变，只需要加一个小改动，在存 Session 的时候，就会自动持久化到 Redis 中</p> 
<p>首先这个玩意是肯定要导入的<br> <img src="https://images2.imgbox.com/30/3b/tyVEbDKV_o.png" alt="在这里插入图片描述"><br> 然后有两个依赖不能少（主要是看第二个依赖有没有少）：</p> 
<pre><code class="prism language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.session<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-session-data-redis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>最后就是配置 远程连接云服务器上的 Redis 相关信息，代码如下，🍓并且是 yml 格式的配置文件</p> 
<pre><code class="prism language-yml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">datasource</span><span class="token punctuation">:</span>
    <span class="token key atrule">url</span><span class="token punctuation">:</span> jdbc<span class="token punctuation">:</span>mysql<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>3306/name<span class="token punctuation">?</span>characterEncoding=utf8
    <span class="token key atrule">username</span><span class="token punctuation">:</span> root
    <span class="token key atrule">password</span><span class="token punctuation">:</span> <span class="token number">123456</span>
    <span class="token key atrule">driver-class-name</span><span class="token punctuation">:</span> com.mysql.cj.jdbc.Driver

  <span class="token comment"># 配置 Redis 填写自己相关的信息 --</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>
    <span class="token key atrule">host</span><span class="token punctuation">:</span> IP
    <span class="token key atrule">post</span><span class="token punctuation">:</span> 端口
    <span class="token key atrule">password</span><span class="token punctuation">:</span> 密码
  <span class="token key atrule">session</span><span class="token punctuation">:</span>
    <span class="token key atrule">store-type</span><span class="token punctuation">:</span> redis
    <span class="token key atrule">redis</span><span class="token punctuation">:</span>
      <span class="token key atrule">flush-mode</span><span class="token punctuation">:</span> on_save
      <span class="token key atrule">namespace</span><span class="token punctuation">:</span> spring<span class="token punctuation">:</span>session

<span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">servlet</span><span class="token punctuation">:</span>
    <span class="token key atrule">session</span><span class="token punctuation">:</span>
      <span class="token key atrule">timeout</span><span class="token punctuation">:</span> <span class="token number">1800</span>
  <span class="token comment"># 配置 Redis --</span>
</code></pre> 
<p>由于是将用户数据存入到 Redis，涉及到了对象的网络传输，所以需要对象需要实现序列化接口</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">User</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// java.io 包中的序列化接口</span>
</code></pre> 
<p>至此就完成了 Session 持久化，如下，在登录一次后，重启服务器，还是存在相关的会话：<br> <img src="https://images2.imgbox.com/94/99/VS5WIikc_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="15__1704"></a>15. 实现定时发布功能</h2> 
<p>这个功能实现起来比较复杂</p> 
<h3><a id="151__1706"></a>15.1 逻辑</h3> 
<p>在项目启动的同时启动一个线程，这个线程专门负责扫描是否存在可以发布的文章</p> 
<p>Ⅰ. 创建一个存储定时文章的数据库表格，并且预期：该表中的文章理论上应该都是还没有发布的，并且发布后的文章，就需要从这个表中删除。但是为了数据安全性和效率着想，使用伪删除的方式：其中定义一个字段<code>isdel</code>，0 表示没删除，1 表示已经删除<br> Ⅱ. 这个线程在一开始，就扫描这个表格中所有还没有发布的文章（id = 0），并且存入堆中（这个步骤只有在项目启动的时候执行一次）<br> Ⅲ. 堆是一个小根堆，按照文章的发布时间的 [ 时间戳 ] 进行排序<br> Ⅳ. 每隔一段时间，就对这个堆进行扫描，如果堆顶元素的时间戳比当前时间戳要大，那就还不需要发布；如果堆顶元素的时间戳比当前时间戳小，那就发布该文章，然后将定时任务表中的文章删除（伪删除）<br> Ⅴ. 后端提供一个接口，来为服务器运行过程中提供添加定时任务的服务<br> Ⅵ. 而后续服务器运行过程中所加入的定时任务，不仅要写入到定时任务表中，还要再加入到内存中的堆即可</p> 
<h3><a id="152__1715"></a>15.2 建表</h3> 
<pre><code class="prism language-java">drop table <span class="token keyword">if</span> exists scheduledtasks<span class="token punctuation">;</span>
create table <span class="token function">scheduledtasks</span><span class="token punctuation">(</span>
    id <span class="token keyword">int</span> primary key auto_increment<span class="token punctuation">,</span>
    title <span class="token function">varchar</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> not <span class="token keyword">null</span><span class="token punctuation">,</span>
    content text not <span class="token keyword">null</span><span class="token punctuation">,</span>
    publishtime datetime <span class="token keyword">default</span> <span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    uid <span class="token keyword">int</span> not <span class="token keyword">null</span><span class="token punctuation">,</span>
    isdel <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">0</span> 
<span class="token punctuation">)</span><span class="token keyword">default</span> charset 'utf8mb4'<span class="token punctuation">;</span>
</code></pre> 
<p>有了这个表，还需要再创建一个相应的 Java 实体类</p> 
<pre><code class="prism language-java"><span class="token comment">// 定时文章 实体类</span>
<span class="token annotation punctuation">@Data</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ScheduledTask</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> id<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> title<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> content<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> uid<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> publishtime<span class="token punctuation">;</span>  <span class="token comment">// 文章定时发表时间</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> isdel<span class="token punctuation">;</span>           <span class="token comment">// 表示是否被删除，属性名和数据库字段名保持一致</span>

    <span class="token keyword">public</span> <span class="token class-name">ScheduledTask</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token class-name">ScheduledTask</span><span class="token punctuation">(</span><span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token keyword">int</span> uid<span class="token punctuation">,</span> <span class="token class-name">String</span> publishtime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>title <span class="token operator">=</span> title<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>content <span class="token operator">=</span> content<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>uid <span class="token operator">=</span> uid<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>publishtime <span class="token operator">=</span> publishtime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="153__1752"></a>15.3 后端实现</h3> 
<h4><a id="1531__1753"></a>15.3.1 时间戳问题</h4> 
<p>首先约定一个发布时间的格式：yyyy-MM-dd HH:mm:ss</p> 
<p>然后需要将这个格式的数据转化成时间戳，在 Java 中的实现方式如下（参考博客<a href="https://blog.csdn.net/qq_44712984/article/details/124450120?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167592840116782429781356%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=167592840116782429781356&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_ecpm_v1~pc_rank_34-2-124450120-null-null.142%5Ev73%5Epc_new_rank,201%5Ev4%5Eadd_ask,239%5Ev1%5Econtrol&amp;utm_term=Java%E6%97%A5%E6%9C%9F%E5%92%8C%E6%97%B6%E9%97%B4%E6%88%B3%E3%80%81&amp;spm=1018.2226.3001.4187">Java 日期和时间戳互转</a>）</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Tool</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Long</span> <span class="token function">dateToStamp</span><span class="token punctuation">(</span><span class="token class-name">String</span> s<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ParseException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> res<span class="token punctuation">;</span>
        <span class="token class-name">SimpleDateFormat</span> simpleDateFormat <span class="token operator">=</span>   <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span>  <span class="token string">"yyyy-MM-dd HH:mm:ss"</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> simpleDateFormat<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> ts <span class="token operator">=</span> date<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> ts<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="1532__1769"></a>15.3.2 构造方法与小根堆</h4> 
<p>刚刚在实现逻辑说到在项目启动的时候启动一个线程，那这个时机可以是：一个类的构造方法中</p> 
<p>创建一个类<code>ScheduledTaskController</code>，这个类负责定时发布文章的业务。并且加上<code>@RestController</code> 注解，让 Spring 启动的时候也加载这个类，然后在构造方法中启动线程即可。</p> 
<p>在这个线程中，需要对 [ 到达指定时间点 ] 的文章进行发布 和 [ 伪删除 ] 定时文章，所以在构造方法中需要 <code>articleService</code> 和 <code>scheduledTaskService</code> 这两个对象，但是由于注入时机的问题，这两个对象需要使用构造方法注入，不建议使用属性注入</p> 
<p>小根堆按照时间戳进行构造，构造方法前部分代码如下：</p> 
<pre><code class="prism language-java">    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">public</span> <span class="token class-name">ScheduledTaskController</span><span class="token punctuation">(</span><span class="token class-name">ScheduledTaskService</span> scheduledTaskService<span class="token punctuation">,</span> <span class="token class-name">ArticleService</span> articleService<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 注入</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>scheduledTaskService <span class="token operator">=</span> scheduledTaskService<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>articleService <span class="token operator">=</span> articleService<span class="token punctuation">;</span> 
        <span class="token comment">// 创建一个 小根堆</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>heap <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PriorityQueue</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">ScheduledTask</span> x<span class="token punctuation">,</span> <span class="token class-name">ScheduledTask</span> y<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>  
                <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token keyword">int</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token class-name">Tool</span><span class="token punctuation">.</span><span class="token function">dateToStamp</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span><span class="token function">getPublishtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token class-name">Tool</span><span class="token punctuation">.</span><span class="token function">dateToStamp</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span><span class="token function">getPublishtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">ParseException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="1533__1793"></a>15.3.3 启动线程</h4> 
<p>线程启动后，先将所有还没发布的文章载入到内存中（这个行为只会执行一次），然后开始进入死循环，每一次循环都要判断是否有可以发布的任务，然后睡眠一段时间（这里设定为 30 s一轮）</p> 
<p>⭐还需要注意，这个线程会持续判断定时任务的发布，所以会持续扫描堆的状态，并且可能将堆中的元素弹出。而实现逻辑处说到：还需要为前端提供一个接口提供后续的定时文章发布服务，要往 定时任务表 中以及 堆中添加元素，也就是可能存在两个线程同时操作 heap，这就涉及到了线程安全问题，所以需要在合适的地方加锁，锁对象在常量池中创建一个 Object 对象就行</p> 
<p>紧接上述代码，后续启动线程的代码如下：</p> 
<pre><code class="prism language-java">
        <span class="token comment">// 启动一个线程</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@SneakyThrows</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// 初始化 小根堆</span>
                <span class="token comment">// 读取出所有的 未发表文章，并载入</span>
                <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">ScheduledTask</span><span class="token punctuation">&gt;</span></span> scheduledTasks <span class="token operator">=</span> scheduledTaskService<span class="token punctuation">.</span><span class="token function">getAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">ScheduledTask</span> task <span class="token operator">:</span> scheduledTasks<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    heap<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>

                <span class="token comment">// 然后开始循环判断是否有符合条件的</span>
                <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">// 获取当前时间戳</span>
                    <span class="token keyword">long</span> curMills <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>heap<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                        <span class="token class-name">ScheduledTask</span> task <span class="token punctuation">;</span>
                        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>scheduledLock<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                            task <span class="token operator">=</span> heap<span class="token punctuation">.</span><span class="token function">peek</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>

                        <span class="token comment">// 获取堆顶任务的 时间戳</span>
                        <span class="token keyword">long</span> taskMills <span class="token operator">=</span> <span class="token class-name">Tool</span><span class="token punctuation">.</span><span class="token function">dateToStamp</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getPublishtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token keyword">if</span> <span class="token punctuation">(</span>curMills <span class="token operator">&lt;</span> taskMills<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 还早，不能发</span>
                            <span class="token keyword">break</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// 可以发</span>
                            <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>scheduledLock<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                                heap<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 弹出这个任务</span>
                            <span class="token punctuation">}</span>
                            <span class="token comment">// 将这个文章发表出去，然后使用伪删除的方式 删除 定时任务表 中的记录</span>
                            articleService<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getUid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getTitle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> task<span class="token punctuation">.</span><span class="token function">getContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"成功发布文章"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token comment">// 伪删除</span>
                            scheduledTaskService<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span>task<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"伪删除成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>

                    <span class="token comment">// 睡眠 30 秒</span>
                    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">30000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"进入睡眠"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h4><a id="1534__1848"></a>15.3.4 运行过程中添加定时发布的文章</h4> 
<p>约定一个路由<code>/schedule/add</code> ，前端需要发送指定格式的时间日期 yyyy-MM-dd HH:mm:ss，然后构造成一个 <code>ScheduledTask</code> 对象，加入数据库中，加入内存堆中。</p> 
<p>这里还有个细节：在时间到了之后发布的文章，需要在 定时文章表 中进行伪删除，而伪删除需要知道文章的 id。因此这里加入到内存堆中之前，就需要为 <code>ScheduledTask</code> 对象提前设定好 id。</p> 
<p>这里可以在插入到定时任务表的时候设置自增主键的获取，可以实现在插入表中之后，这个对象的 ID 就会被自动赋值。xml 文件中的插入代码以及 Controller 代码如下</p> 
<p><img src="https://images2.imgbox.com/37/2c/LRZQEbfT_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-java">    <span class="token comment">// 往数据库中添加定时任务，然后再往内存中的堆添加元素</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/add"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Integer</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token class-name">HttpServletRequest</span> request<span class="token punctuation">,</span> <span class="token class-name">String</span> title<span class="token punctuation">,</span> <span class="token class-name">String</span> content<span class="token punctuation">,</span> <span class="token class-name">String</span> publishTime<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">User</span> user <span class="token operator">=</span> <span class="token class-name">SessionUtil</span><span class="token punctuation">.</span><span class="token function">getLoginUser</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>user <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// 构造一个定时任务</span>
        <span class="token class-name">ScheduledTask</span> task <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ScheduledTask</span><span class="token punctuation">(</span>title<span class="token punctuation">,</span> content<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> publishTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 先存入数据库中, 同时会设置 自增主键</span>
        scheduledTaskService<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 然后再存入堆中</span>
        <span class="token keyword">synchronized</span> <span class="token punctuation">(</span><span class="token class-name">Constants</span><span class="token punctuation">.</span>scheduledLock<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>heap<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>task<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"成功添加一个任务"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="1535__1879"></a>15.3.5 前端部分</h4> 
<p>然后后端代码就完成了，然后是前端代码<br> <img src="https://images2.imgbox.com/43/c5/loKxHkoN_o.png" alt="在这里插入图片描述"><br> 当点击这个按钮的时候，触发 schedule 方法， 然后通过以下方法触发一个弹窗，然后让用户输入时间</p> 
<pre><code class="prism language-js">    <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"请输入日期"</span><span class="token punctuation">,</span> <span class="token string">"请按指定格式填写日期 yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>并且要验证一下是不是指定格式的日期，可以通过正则表达式判断</p> 
<pre><code class="prism language-js">        <span class="token comment">// 验证一下格式是否正确</span>
        <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^((\d{2}(([02468][048])|([13579][26]))[\-\/\s]?((((0?[13578])|(1[02]))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(3[01])))|(((0?[469])|(11))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(30)))|(0?2[\-\/\s]?((0?[1-9])|([1-2][0-9])))))|(\d{2}(([02468][1235679])|([13579][01345789]))[\-\/\s]?((((0?[13578])|(1[02]))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(3[01])))|(((0?[469])|(11))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(30)))|(0?2[\-\/\s]?((0?[1-9])|(1[0-9])|(2[0-8]))))))(\s((([0-1][0-9])|(2?[0-3]))\:([0-5]?[0-9])((\s)|(\:([0-5]?[0-9])))))?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
        <span class="token comment">// 验证是否是指定格式的日期</span>
        <span class="token keyword">var</span> flg <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 日志不复合规范</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flg <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"日期格式有误，请重新填写"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p>有了这个格式的日期之后，就可以将这个时间作为参数构造出 Date 对象，并且可以通过这个对象的 <code>getTime()</code>获取时间戳，也可以通过 <code>toLocaleString()</code> 来获取 yyyy/MM/dd HH:mm:ss 的日期。这个格式的日期再通过字符串替换，将 / 替换成 - 就行了</p> 
<p>这里可以要求用户的文章至少在当前时间 + 5 分钟后发表，详细见前端代码，如下：</p> 
<pre><code class="prism language-js">  <span class="token comment">// 定时发布功能</span>
    <span class="token keyword">function</span> <span class="token function">schedule</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// 验证数据的有效性</span>
        <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">jQuery</span><span class="token punctuation">(</span><span class="token string">"#title"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> content <span class="token operator">=</span> editor<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> title<span class="token punctuation">.</span>length <span class="token operator">&lt;=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"标题不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>content <span class="token operator">==</span> <span class="token string">""</span> <span class="token operator">||</span> content<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"文章内容不能少于100字"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        <span class="token comment">// 开始定时发布的流程</span>
        <span class="token keyword">var</span> date <span class="token operator">=</span> <span class="token function">prompt</span><span class="token punctuation">(</span><span class="token string">"请输入您的名字"</span><span class="token punctuation">,</span> <span class="token string">"请按指定格式填写日期 yyyy-MM-dd HH:mm:ss"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 验证一下格式是否正确</span>
        <span class="token keyword">var</span> reg <span class="token operator">=</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^((\d{2}(([02468][048])|([13579][26]))[\-\/\s]?((((0?[13578])|(1[02]))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(3[01])))|(((0?[469])|(11))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(30)))|(0?2[\-\/\s]?((0?[1-9])|([1-2][0-9])))))|(\d{2}(([02468][1235679])|([13579][01345789]))[\-\/\s]?((((0?[13578])|(1[02]))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(3[01])))|(((0?[469])|(11))[\-\/\s]?((0?[1-9])|([1-2][0-9])|(30)))|(0?2[\-\/\s]?((0?[1-9])|(1[0-9])|(2[0-8]))))))(\s((([0-1][0-9])|(2?[0-3]))\:([0-5]?[0-9])((\s)|(\:([0-5]?[0-9])))))?$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">;</span>
        <span class="token comment">// 验证是否是指定格式的日期</span>
        <span class="token keyword">var</span> flg <span class="token operator">=</span> reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 日志不复合规范</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>flg <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"日期格式有误，请重新填写"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">var</span> curTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 加上 4 分钟，后的 dateTime </span>
        curTime<span class="token punctuation">.</span><span class="token function">setMinutes</span><span class="token punctuation">(</span>curTime<span class="token punctuation">.</span><span class="token function">getMinutes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
        <span class="token comment">// 发布时间 的 DateTime</span>
        <span class="token keyword">var</span> publishTime <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 该 else 语句用于测试, 提交成功，那么展示一下时间</span>
        <span class="token comment">// 具体的 目标 发送日期+时间</span>
        <span class="token keyword">var</span> tar <span class="token operator">=</span> publishTime<span class="token punctuation">.</span><span class="token function">toLocaleString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tar <span class="token operator">=</span> tar<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 替换成指定格式</span>
        tar <span class="token operator">=</span> tar<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> <span class="token string">"-"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>tar<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 获取两个时间段的时间戳</span>
        <span class="token keyword">var</span> curMills <span class="token operator">=</span> curTime<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> publishMills <span class="token operator">=</span> publishTime<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span> <span class="token punctuation">(</span>curMills <span class="token operator">&gt;=</span> publishMills<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"发布时间至少在 5 分钟后发布"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        
        
        <span class="token comment">// 否则成功发布</span>
        jQuery<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">url</span><span class="token operator">:</span><span class="token string">"/schedule/add"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">"POST"</span><span class="token punctuation">,</span>
            <span class="token literal-property property">data</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">"title"</span><span class="token operator">:</span>title<span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token string-property property">"content"</span><span class="token operator">:</span>content<span class="token punctuation">,</span>
                <span class="token string-property property">"publishTime"</span><span class="token operator">:</span>tar
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token function-variable function">success</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">result</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>state <span class="token operator">==</span> <span class="token number">200</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> result<span class="token punctuation">.</span>data <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"定时发布成功"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    location<span class="token punctuation">.</span>href <span class="token operator">=</span> <span class="token string">"myblog_list.html"</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
</code></pre> 
<p>这个定时发布功能就完成了，这里采用的是使用 堆 来进行维护。但是实际上堆这部分代码可以使用 Java 内置的定时器 Timer 来完成，思路是类似的，代码量会少点。想学习 Timer 的使用，可以看看这篇文章<a href="https://blog.csdn.net/mfmfmfo/article/details/126499966?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522167647128016800188590494%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&amp;request_id=167647128016800188590494&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-2-126499966-null-null.142%5Ev73%5Epc_new_rank,201%5Ev4%5Eadd_ask,239%5Ev1%5Econtrol&amp;utm_term=java%E5%AE%9A%E6%97%B6%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8%28timer%29&amp;spm=1018.2226.3001.4187">Timer</a></p> 
<h2><a id="16__1974"></a>16. 全代码</h2> 
<p><a href="https://gitee.com/enthusiastic-citizens6/project/tree/master/blogSystemSSM-show/src" rel="nofollow">完结</a></p> 
<p>以上代码是当前博客对应的代码，代码不作改变，而后续我会拓展其他功能，例如头像上传，验证码等功能，会同步更新于<a href="https://gitee.com/enthusiastic-citizens6/project/tree/master/blogSystem" rel="nofollow">此链接</a>，有时间的话会同步博客。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0cff36ed44efc3a194c179da714e21f2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">centos配置开机自启动jar包</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/de5550eaba9563f9dae77422655d9652/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">uniapp 、 微信小程序 text 字母 数字不换行</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>