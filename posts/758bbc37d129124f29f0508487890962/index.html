<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>K8S安全风险及防护建议 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="K8S安全风险及防护建议" />
<meta property="og:description" content="Kubernetes（K8S）是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务，方便进行声明式配置和自动化。一个Kubernetes集群通常包含跨多台计算机运行的控制平面和多个工作节点（node），控制平面用于管理集群中的node，node用于运行工作负载。
Kubernetes架构图
自从2014年首次发布以来，Kubernetes受到了越来越多的关注和广泛的应用。目前，它已成为云原生应用程序开发和部署的标准之一，被许多大型企业和组织广泛采用，如谷歌、微软、亚马逊、IBM、阿里巴巴、腾讯等。根据CNCF的调查显示，截至2021年11月，全球有超过90%的企业和组织正在使用Kubernetes进行容器编排和管理。
一、针对Kubernetes的攻击愈演愈烈 近年来，针对K8S的攻击事件逐渐增加，成为了安全领域的一个重要话题。根据一些安全厂商和研究机构的报告，K8S的攻击事件占比情况如下：
Trend Micro发布的《2021年1-6月全球云安全报告》显示，2021年上半年，云容器和Kubernetes攻击的比例达到了43%。攻击者的目的是获取敏感信息、窃取凭据、传播恶意软件等。
Aqua Security发布的《2020年云原生安全报告》中指出，针对Kubernetes的攻击事件在2020年增长了26%。其中，最常见的攻击包括未经身份验证的访问、挖矿、拒绝服务、数据泄露等。
CNCF（Cloud Native Computing Foundation）发布的《2021年技术调查报告》中指出，65%的受访者认为容器和Kubernetes面临的安全风险是他们使用云原生技术时最大的担忧之一。另外，55%的受访者认为Kubernetes容易受到攻击。
综合来看，K8S的攻击案例验证了未来的主流攻击趋势，那就是‍集权设施将会成为未来攻击者的主要攻击对象。集权安全值得企业安全负责人们重点关注。
二、常见的Kubernetes威胁来源 在针对K8S的攻击日益激烈的情况下，攻击来源也表现出了多样化，根据调研目前它正面临着来自供应链、恶意攻击者、内部成员的攻击以及黑客组织等的威胁。
1、供应链风险
供应链包含构成最终产品的任何元素，从组件到用于管理集群的第三方服务或软件，这些风险有很多来源，而且通常很难解决。
在 2019 年，Harbor作为一个Kubernetes基础架构下的开源仓库，其曾遭受到了供应链攻击。攻击者通过Harbor的供应链漏洞，注入恶意Docker镜像，这些镜像被部署在Kubernetes集群中，最终导致Kubernetes集群的安全受到威胁。
2、恶意攻击者
恶意攻击者可以利用Kubernetes架构组件中的漏洞和错误配置，例如控制平面、工作节点或容器化应用程序。
2018年，黑客入侵了Tesla公司的Kubernetes集群，并利用集群中的计算资源进行加密货币挖掘。这次攻击的原因是由于Tesla在使用Kubernetes时未采取适当的安全措施。
3、内部威胁
内部威胁可以是管理员、用户，甚至是云服务提供商。对组织的Kubernetes基础设施具有特殊访问权限的内部人员可能会滥用这些特权。
2019年，加拿大的电商平台Shopify遭受了内部员工的K8S攻击。该员工修改了K8S配置文件，使得攻击者能够在Shopify的K8S集群中创建新的管理用户，并窃取用户数据。
三、Kubernetes攻击面 K8S作为一种开源的容器编排平台，已经成为了云原生应用开发和部署的重要基础设施之一。但同时，K8S也因其高度复杂的架构和众多组件，成为了攻击者攻击的目标之一。那么，攻击者采用何种方式攻击K8S？
以下是微软官方在2021年给出的K8S威胁矩阵图，详细地呈现了攻击者在每个阶段使用的技术，从左到右通过执行每个阶段的攻击方式也呈现了成果扩大的过程。
随着攻击技术的发展，每个攻击阶段的攻击技术也更加丰富。接下来对K8S攻击过程中的一些重要攻击阶段进行详细介绍。
初始访问（Initial Access）
初始访问是指攻击者在进入系统前获得的第一步访问权限。在Kubernetes中，攻击者可以通过多种方式进行初始访问。其中，一种常见的方式是通过针对公网暴露的Kubernetes API Server进行攻击。
另外攻击者还常用容器内漏洞入侵、kubeconfig file泄露、etcd未授权访问、恶意镜像等方式，进行前期的信息收集工作，以获得初始权限。
命令执行（Execution）
在Kubernetes中，命令执行通常是指攻击者通过各种手段在容器或节点上执行任意命令。比如攻击者可通过容器中运行的SSH服务执行命令，如果攻击者通过暴力破解或者其他方法获得了容器的有效凭证，他们就可以通过SSH获得对容器的远程访问。
另外，如果容器自身存在漏洞，那么攻击者也会通过漏洞执行命令。命令执行方式多种多样，常见的执行命令的攻击还有创建后门Pod、利用API Server执行命令、通过Sidecar注入执行命令、通过curl执行容器命令等。
权限维持（Persistence）
在Kubernetes中，攻击者利用权限维持来获取对系统的长期控制。例如，攻击者可以通过向容器镜像中添加恶意代码来创建一个具有相同标签的deployment或ReplicaSet。这样，当新的Pod创建时，它将自动更新为攻击者的容器镜像。攻击者可以在该容器中添加后门或其他恶意代码，以确保他们在以后的访问中能够维持其权限。
针对权限维持的其它利用方式包括挂载主机路径、K8s cronjob、Shadow API Server等，这些攻击方式常常被攻击者使用。
权限提升（Privilege Escalation）
Kubernetes中的权限提升攻击是指攻击者通过各种手段提升其在集群中的权限。一旦攻击者成功地提升了其权限，就可以对整个集群进行更多的攻击，比如访问其他资源、执行恶意代码等。例如，攻击者可以创建一个特权容器，该容器可以访问宿主机上的资源，并在该容器内执行命令，从而使其获得更高的权限。
另外，挂载根目录逃逸、容器内访问Docker.sock逃逸、docker漏洞逃逸、篡改ServiceAccount等方式也被经常使用。
横向移动（Lateral Movement）
横向移动是指攻击者利用已经获得的某个系统或账户的权限，在整个网络中移动并寻找其他系统或账户，以便进一步扩大攻击面和获取更高的权限。在Kubernetes中，攻击者可以利用各种漏洞和配置错误来获取对一个或多个节点的访问权限，然后通过控制这些节点来进行横向移动。
例如，攻击者可以通过利用kubelet的漏洞或未经授权的凭据访问节点，并在这些节点上启动恶意容器或修改已有容器的配置。一旦攻击者获得了节点的访问权限，他们可以扫描网络并寻找其他容器或节点，以便进一步扩大攻击范围。其它的横向攻击方式有通过容器逃逸进行横向、Cluster内网渗透、窃取凭证攻击云服务等。
总的来说，攻击者可以通过利用K8S集群内各组件的漏洞或者未经适当保护的访问权限来进一步深入攻击，这可能会导致敏感数据泄露、服务中断、系统崩溃等严重后果。
四、ITDR保护K8S集群 针对K8S的攻击日益激烈，如何避免K8S不被攻击值得大家思考，保护K8S中的敏感数据意义重大。为了保护您的K8S集群，可采用中安网星的ITDR平台进行全方位的保护。
ITDR（身份威胁检测与响应）平台是中安网星推出的针对身份威胁检测与响应高级威胁分析平台。主要围绕Identity及Infrastructure为核心进行防护，涵盖主流身份基础设施及集权设施，围绕从攻击的事前加固、事中监测，事后阻断出发，产品的设计思路覆盖攻击者活动的全生命周期。
事前，利用ITDR内置引擎对K8S集群中的不合理配置项、K8S相关的历史漏洞进行主动发现，在遭受恶意攻击之前，提前加固K8S集群，不给攻击者以可乘之机。
事中，通过融合图计算、身份欺骗等技术，对K8S进行全方位的监测，及时发现针对K8S的漏洞利用、身份窃取等风险，在遭受攻击的第一时间及时发现攻击者，对攻击行为进行阻断。结合威胁狩猎思想，将身份蜜罐技术应用于ITDR平台中，为反制攻击者提供保证。
事后，对攻击事件进行取证调查，禁用不合理的用户，清理危险的凭据，根据基线事件对K8S进行加固。
All in one：中安网星ITDR平台能力持续演进与突破" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/758bbc37d129124f29f0508487890962/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-17T15:06:29+08:00" />
<meta property="article:modified_time" content="2023-07-17T15:06:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">K8S安全风险及防护建议</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Kubernetes（K8S）是一个可移植、可扩展的开源平台，用于管理容器化的工作负载和服务，方便进行声明式配置和自动化。一个Kubernetes集群通常包含跨多台计算机运行的控制平面和多个工作节点（node），控制平面用于管理集群中的node，node用于运行工作负载。</p> 
<p></p> 
<p class="img-center"><img alt="" height="337" src="https://images2.imgbox.com/93/97/233dCj05_o.png" width="720"></p> 
<p style="text-align:center;">Kubernetes架构图</p> 
<p></p> 
<p>自从2014年首次发布以来，Kubernetes受到了越来越多的关注和广泛的应用。目前，它已成为云原生应用程序开发和部署的标准之一，被许多大型企业和组织广泛采用，如谷歌、微软、亚马逊、IBM、阿里巴巴、腾讯等。根据CNCF的调查显示，截至2021年11月，全球有超过90%的企业和组织正在使用Kubernetes进行容器编排和管理。</p> 
<h3><strong>一、针对Kubernetes的攻击愈演愈烈</strong></h3> 
<p>近年来，针对K8S的攻击事件逐渐增加，成为了安全领域的一个重要话题。根据一些安全厂商和研究机构的报告，K8S的攻击事件占比情况如下：</p> 
<p>Trend Micro发布的《2021年1-6月全球云安全报告》显示，2021年上半年，云容器和Kubernetes攻击的比例达到了43%。攻击者的目的是获取敏感信息、窃取凭据、传播恶意软件等。</p> 
<p>Aqua Security发布的《2020年云原生安全报告》中指出，针对Kubernetes的攻击事件在2020年增长了26%。其中，最常见的攻击包括未经身份验证的访问、挖矿、拒绝服务、数据泄露等。</p> 
<p>CNCF（Cloud Native Computing Foundation）发布的《2021年技术调查报告》中指出，65%的受访者认为容器和Kubernetes面临的安全风险是他们使用云原生技术时最大的担忧之一。另外，55%的受访者认为Kubernetes容易受到攻击。</p> 
<p>综合来看，K8S的攻击案例验证了未来的主流攻击趋势，那就是‍集权设施将会成为未来攻击者的主要攻击对象。集权安全值得企业安全负责人们重点关注。</p> 
<h3><strong>二、常见的Kubernetes威胁来源</strong></h3> 
<p>在针对K8S的攻击日益激烈的情况下，攻击来源也表现出了多样化，根据调研目前它正面临着来自供应链、恶意攻击者、内部成员的攻击以及黑客组织等的威胁。</p> 
<p></p> 
<p class="img-center"><img alt="" height="360" src="https://images2.imgbox.com/51/dd/hQwhWNDQ_o.png" width="640"></p> 
<p><strong>1、供应链风险</strong></p> 
<p>供应链包含构成最终产品的任何元素，从组件到用于管理集群的第三方服务或软件，这些风险有很多来源，而且通常很难解决。</p> 
<p>在 2019 年，Harbor作为一个Kubernetes基础架构下的开源仓库，其曾遭受到了供应链攻击。攻击者通过Harbor的供应链漏洞，注入恶意Docker镜像，这些镜像被部署在Kubernetes集群中，最终导致Kubernetes集群的安全受到威胁。</p> 
<p><strong>2、恶意攻击者</strong></p> 
<p>恶意攻击者可以利用Kubernetes架构组件中的漏洞和错误配置，例如控制平面、工作节点或容器化应用程序。</p> 
<p>2018年，黑客入侵了Tesla公司的Kubernetes集群，并利用集群中的计算资源进行加密货币挖掘。这次攻击的原因是由于Tesla在使用Kubernetes时未采取适当的安全措施。</p> 
<p><strong>3、内部威胁</strong></p> 
<p>内部威胁可以是管理员、用户，甚至是云服务提供商。对组织的Kubernetes基础设施具有特殊访问权限的内部人员可能会滥用这些特权。</p> 
<p>2019年，加拿大的电商平台Shopify遭受了内部员工的K8S攻击。该员工修改了K8S配置文件，使得攻击者能够在Shopify的K8S集群中创建新的管理用户，并窃取用户数据。</p> 
<h3><strong>三、Kubernetes攻击面</strong></h3> 
<p>K8S作为一种开源的容器编排平台，已经成为了云原生应用开发和部署的重要基础设施之一。但同时，K8S也因其高度复杂的架构和众多组件，成为了攻击者攻击的目标之一。那么，攻击者采用何种方式攻击K8S？</p> 
<p>以下是微软官方在2021年给出的K8S威胁矩阵图，详细地呈现了攻击者在每个阶段使用的技术，从左到右通过执行每个阶段的攻击方式也呈现了成果扩大的过程。</p> 
<p></p> 
<p class="img-center"><img alt="" height="434" src="https://images2.imgbox.com/58/dd/Vo2uc1qD_o.png" width="720"></p> 
<p>随着攻击技术的发展，每个攻击阶段的攻击技术也更加丰富。接下来对K8S攻击过程中的一些重要攻击阶段进行详细介绍。</p> 
<p><strong>初始访问（Initial Access）</strong><br><br> 初始访问是指攻击者在进入系统前获得的第一步访问权限。在Kubernetes中，攻击者可以通过多种方式进行初始访问。其中，一种常见的方式是通过针对公网暴露的Kubernetes API Server进行攻击。<br><br> 另外攻击者还常用容器内漏洞入侵、kubeconfig file泄露、etcd未授权访问、恶意镜像等方式，进行前期的信息收集工作，以获得初始权限。</p> 
<p><strong>命令执行（Execution）</strong></p> 
<p>在Kubernetes中，命令执行通常是指攻击者通过各种手段在容器或节点上执行任意命令。比如攻击者可通过容器中运行的SSH服务执行命令，如果攻击者通过暴力破解或者其他方法获得了容器的有效凭证，他们就可以通过SSH获得对容器的远程访问。</p> 
<p>另外，如果容器自身存在漏洞，那么攻击者也会通过漏洞执行命令。命令执行方式多种多样，常见的执行命令的攻击还有创建后门Pod、利用API Server执行命令、通过Sidecar注入执行命令、通过curl执行容器命令等。</p> 
<p></p> 
<p class="img-center"><img alt="" height="441" src="https://images2.imgbox.com/b1/35/SUlMb4Rh_o.png" width="681"></p> 
<p><strong>权限维持（Persistence）</strong></p> 
<p>在Kubernetes中，攻击者利用权限维持来获取对系统的长期控制。例如，攻击者可以通过向容器镜像中添加恶意代码来创建一个具有相同标签的deployment或ReplicaSet。这样，当新的Pod创建时，它将自动更新为攻击者的容器镜像。攻击者可以在该容器中添加后门或其他恶意代码，以确保他们在以后的访问中能够维持其权限。</p> 
<p>针对权限维持的其它利用方式包括挂载主机路径、K8s cronjob、Shadow API Server等，这些攻击方式常常被攻击者使用。</p> 
<p></p> 
<p class="img-center"><img alt="" height="441" src="https://images2.imgbox.com/f8/9f/IAgrbe1W_o.png" width="681"></p> 
<p><strong>权限提升（Privilege Escalation）</strong></p> 
<p>Kubernetes中的权限提升攻击是指攻击者通过各种手段提升其在集群中的权限。一旦攻击者成功地提升了其权限，就可以对整个集群进行更多的攻击，比如访问其他资源、执行恶意代码等。例如，攻击者可以创建一个特权容器，该容器可以访问宿主机上的资源，并在该容器内执行命令，从而使其获得更高的权限。</p> 
<p>另外，挂载根目录逃逸、容器内访问Docker.sock逃逸、docker漏洞逃逸、篡改ServiceAccount等方式也被经常使用。</p> 
<p></p> 
<p class="img-center"><img alt="" height="747" src="https://images2.imgbox.com/c8/e5/6GIECBcX_o.png" width="842"></p> 
<p><strong>横向移动（Lateral Movement）</strong></p> 
<p>横向移动是指攻击者利用已经获得的某个系统或账户的权限，在整个网络中移动并寻找其他系统或账户，以便进一步扩大攻击面和获取更高的权限。在Kubernetes中，攻击者可以利用各种漏洞和配置错误来获取对一个或多个节点的访问权限，然后通过控制这些节点来进行横向移动。</p> 
<p>例如，攻击者可以通过利用kubelet的漏洞或未经授权的凭据访问节点，并在这些节点上启动恶意容器或修改已有容器的配置。一旦攻击者获得了节点的访问权限，他们可以扫描网络并寻找其他容器或节点，以便进一步扩大攻击范围。其它的横向攻击方式有通过容器逃逸进行横向、Cluster内网渗透、窃取凭证攻击云服务等。</p> 
<p></p> 
<p class="img-center"><img alt="" height="656" src="https://images2.imgbox.com/a0/f9/jo19Igad_o.png" width="1080"></p> 
<p>总的来说，攻击者可以通过利用K8S集群内各组件的漏洞或者未经适当保护的访问权限来进一步深入攻击，这可能会导致敏感数据泄露、服务中断、系统崩溃等严重后果。</p> 
<h3><strong>四、ITDR保护K8S集群</strong></h3> 
<p>针对K8S的攻击日益激烈，如何避免K8S不被攻击值得大家思考，保护K8S中的敏感数据意义重大。为了保护您的K8S集群，可采用中安网星的ITDR平台进行全方位的保护。</p> 
<p><strong>ITDR（身份威胁检测与响应）平台是中安网星推出的针对身份威胁检测与响应高级威胁分析平台。</strong>主要围绕Identity及Infrastructure为核心进行防护，涵盖主流身份基础设施及集权设施，围绕从攻击的事前加固、事中监测，事后阻断出发，产品的设计思路覆盖攻击者活动的全生命周期。</p> 
<p></p> 
<p class="img-center"><img alt="" height="405" src="https://images2.imgbox.com/10/35/HryjREpl_o.png" width="720"></p> 
<p>事前，利用ITDR内置引擎对K8S集群中的不合理配置项、K8S相关的历史漏洞进行主动发现，在遭受恶意攻击之前，提前加固K8S集群，不给攻击者以可乘之机。</p> 
<p>事中，通过融合图计算、身份欺骗等技术，对K8S进行全方位的监测，及时发现针对K8S的漏洞利用、身份窃取等风险，在遭受攻击的第一时间及时发现攻击者，对攻击行为进行阻断。结合威胁狩猎思想，将身份蜜罐技术应用于ITDR平台中，为反制攻击者提供保证。</p> 
<p></p> 
<p class="img-center"><img alt="" height="681" src="https://images2.imgbox.com/9e/da/3E15TJcb_o.png" width="961"></p> 
<p>事后，对攻击事件进行取证调查，禁用不合理的用户，清理危险的凭据，根据基线事件对K8S进行加固。</p> 
<p></p> 
<p class="img-center"><img alt="" height="497" src="https://images2.imgbox.com/29/5e/JvBHH6M8_o.png" width="1080"></p> 
<p style="text-align:center;">All in one：中安网星ITDR平台能力持续演进与突破</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f3d8d65478707f18fdc05c1b38e2d240/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">CentOS7系统MBR、GRUB2、内核启动流程报错问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/19b55fcce6eb345d7e889f8144a50ef7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Windows安装jdk并配置环境变量</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>