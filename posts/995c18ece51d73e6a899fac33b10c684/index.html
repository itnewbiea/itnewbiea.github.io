<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Mongodb在docker容器中的集群部署 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Mongodb在docker容器中的集群部署" />
<meta property="og:description" content="1.拉取镜像 docker pull mongo 2.创建网络 docker network create mongo-rs 3创建容器 docker run --rm --network mongo-rs --name mongo1 -d -v /data/mongo1/db:/data/db -p 27021:27017 mongo:latest --replSet &#34;rs0&#34; docker run --rm --network mongo-rs --name mongo2 -d -v /data/mongo2/db:/data/db -p 27022:27017 mongo:latest --replSet &#34;rs0&#34; docker run --rm --network mongo-rs --name mongo3 -d -v /data/mongo3/db:/data/db -p 27023:27017 mongo:latest --replSet &#34;rs0&#34; docker run --rm --network mongo-rs --name mongo4 -d -v /data/mongo4/db:/data/db -p 27024:27017 mongo:latest --replSet &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/995c18ece51d73e6a899fac33b10c684/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-03T14:51:45+08:00" />
<meta property="article:modified_time" content="2023-06-03T14:51:45+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Mongodb在docker容器中的集群部署</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2>1.拉取镜像</h2> 
<pre><code class="language-Lua">docker pull mongo</code></pre> 
<h2>2.创建网络</h2> 
<pre><code class="language-java">docker network create mongo-rs</code></pre> 
<h2>3创建容器</h2> 
<pre><code class="language-java">docker run --rm --network mongo-rs  --name mongo1 -d -v /data/mongo1/db:/data/db -p 27021:27017 mongo:latest --replSet "rs0" 
docker run --rm --network mongo-rs  --name mongo2 -d -v /data/mongo2/db:/data/db -p 27022:27017 mongo:latest --replSet "rs0"
docker run --rm --network mongo-rs  --name mongo3 -d -v /data/mongo3/db:/data/db -p 27023:27017 mongo:latest --replSet "rs0"
docker run --rm --network mongo-rs  --name mongo4 -d -v /data/mongo4/db:/data/db -p 27024:27017 mongo:latest --replSet "rs0"
docker run --rm --network mongo-rs  --name mongo5 -d -v /data/mongo5/db:/data/db -p 27025:27017 mongo:latest --replSet "rs0"
docker run --rm --network mongo-rs  --name mongo6 -d -v /data/mongo6/db:/data/db -p 27026:27017 mongo:latest --replSet "rs0"</code></pre> 
<p><span style="color:#fe2c24;"><strong>说明： </strong></span></p> 
<blockquote> 
 <ul><li>-v 参数：将 docker 容器内部 /data/db 目录挂载在宿主机 /data/mongo4/db 目录，防止容器重启时，数据丢失</li><li>--network: 将 docker 容器划入 mongo-rs 网桥；</li><li>--replSet: 命名副本集名称为 rs0；</li></ul> 
</blockquote> 
<h2>4.进入 mongo1 客户端</h2> 
<pre><code class="language-java">//进入客户端
docker exec -it mongo1 mongosh
//启动一个副本集(即采用 mongo1 作为主节点)
rs.initiate()
//新增副本节点
rs.add('mongo2:27017')
rs.add('mongo3:27017')
rs.add('mongo4:27017')
rs.add('mongo5:27017')
rs.add('mongo6:27017')
</code></pre> 
<p><strong><span style="color:#fe2c24;">注意：</span></strong></p> 
<blockquote> 
 <p>新版的使用：docker exec -it mongo1 <span style="color:#fe2c24;">mongosh </span>--port 27021：.进入 mongo1 客户端。</p> 
 <p>旧版的使用：docker exec -it mongo1 <span style="color:#fe2c24;">mongo </span>--port 27021：.进入 mongo1 客户端。</p> 
</blockquote> 
<p><span style="color:#fe2c24;"><strong>这个时候集群已经创建好啦！！！！</strong></span></p> 
<h2>5.验证集群运作</h2> 
<p>在主节点 mongo1 添加一条数据：</p> 
<pre><code class="language-java">replSet1:PRIMARY&gt; db.car.insert({"name":"奥迪"})
WriteResult({ "nInserted" : 1 })</code></pre> 
<p>在从节点 mongo2 mongo3 查看数据是否同步：</p> 
<pre><code class="language-java">replSet1:SECONDARY&gt; rs.secondaryOk() // 先允许读取操作在从节点执行
replSet1:SECONDARY&gt; db.car.find()
{ "_id" : ObjectId("605ca97350221c02825ceaa7"), "name" : "奥迪" }</code></pre> 
<h2><strong><span style="color:#fe2c24;">6.部署完成后常用</span></strong><span style="color:#fe2c24;">维护</span></h2> 
<pre><code class="language-java">//1.进入 mongo1 客户端：
docker exec -it mongo1 mongosh
//2.在 mongo shell 中执行以下命令 
rs.initiate() //启动一个副本集(即采用 mongo1 作为主节点)
rs.conf() //查看每个节点中 host、arbiterOnly、hidden、priority、 votes、slaveDelay等属性
rs.add('mongo2:27021') //新增节点
rs.remove('mongo2:27021') //删除节点
rs.status() //查看副本集状态</code></pre> 
<h2>替换副本集节点</h2> 
<pre><code class="language-java">cfg = rs.conf()
cfg.members[0].host = "mongo1:27021"
rs.reconfig(cfg)</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/983af2a73a1db2fb7beaa4e629498a7c/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">浏览器多线程到事件循环机制</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/39fc328c8dee58f82254311eccca4ca3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python采集数据保存csv, 文件内容乱码了怎么解决?</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>