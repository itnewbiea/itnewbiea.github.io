<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>《数据同步-NIFI系列》NiFi同步中文表、中文字段名 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="《数据同步-NIFI系列》NiFi同步中文表、中文字段名" />
<meta property="og:description" content="NiFi同步中文表、中文字段名 一 目的 假设Oracle数据库中有一个中文表，其字段名为纯中文。我们希望将表数据同步到MySQL数据库中，在MySQL数据库中创建同等类型的英文表名称和英文字段名称。那么在中文字段向英文字段同步过程中会出现异常导致不能直接同步。
二 表介绍 源表
CREATE TABLE ZXY.中文表_ZXY (	姓名 VARCHAR(20) null, 性别 VARCHAR(20) null, 年龄 VARCHAR(20) null ) ; insert into &#34;中文表_ZXY&#34; values(&#39;小A&#39;,&#39;男&#39;,&#39;8&#39;); insert into &#34;中文表_ZXY&#34; values(&#39;小B&#39;,&#39;女&#39;,&#39;9&#39;); 目标表
create table zxy.c_zxy (	name varchar(20) null, sex varchar(20) null, age varchar(20) null ) ; 二 Nifi全量同步中文表-普通流程 最常见的全量同步，通过ExecuteSQL组件truncate目标表，使用ExecuteSQLRecord组件查询源表数据( AvroRecordSetWriter写数据)，最后通过PutDataBaseRecord将数据存到目标表中( AvroReader读数据)。但是最后报错&#34;due to None of the fields in the record map to the columns defined by the c_zxy table&#34;,中文表和英文表之间找不到映射关系，那么应该调整流程，使其具有映射关系。
三 Nifi全量同步中文表-自定义流程 整体流程使用七个组件,第一步通过ExecutSQL组件truncate目标表，第二步使用ExecuteSQLRecord组件查询源表数据( AvroRecordSetWriter写数据),第三步使用ConvertAvroToJSON组件将Avro数据转成JSON类型数据，第四步使用SplitJson将整个JSON切分成一条一条的JSON数据，第五步使用EvaluateJsonPath解析中文表的字段并将其映射为英文名，第六步使用ReplaceText获取上一步的参数并写成SQL语句insert into zxy." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1ee2613891ef1164b04306131efe378d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-11T16:04:11+08:00" />
<meta property="article:modified_time" content="2023-03-11T16:04:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">《数据同步-NIFI系列》NiFi同步中文表、中文字段名</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-kimbie-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="font_faceNiFifont_0"></a><font face="黑体">NiFi同步中文表、中文字段名</font></h2> 
<h2><a id="font_face_font_2"></a><font face="黑体">一 目的</font></h2> 
<p><font face="黑体">  假设Oracle数据库中有一个中文表，其字段名为纯中文。我们希望将表数据同步到MySQL数据库中，在MySQL数据库中创建同等类型的英文表名称和英文字段名称。那么在中文字段向英文字段同步过程中会出现异常导致不能直接同步。</font></p> 
<h2><a id="font_face_font_6"></a><font face="黑体">二 表介绍</font></h2> 
<p><font face="黑体"><strong>源表</strong></font></p> 
<pre><code class="prism language-sql"><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> ZXY<span class="token punctuation">.</span>中文表_ZXY
<span class="token punctuation">(</span>	
    姓名 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 
    性别 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span>  
    年龄 <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span> <span class="token punctuation">;</span>

<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token string">"中文表_ZXY"</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'小A'</span><span class="token punctuation">,</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token string">"中文表_ZXY"</span> <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token string">'小B'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">,</span><span class="token string">'9'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p><font face="黑体"><strong>目标表</strong></font></p> 
<pre><code class="prism language-sql"><span class="token keyword">create</span> <span class="token keyword">table</span> zxy<span class="token punctuation">.</span>c_zxy
<span class="token punctuation">(</span>	
    name <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 
    sex <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">null</span><span class="token punctuation">,</span> 
    age <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span> <span class="token boolean">null</span>
<span class="token punctuation">)</span> <span class="token punctuation">;</span>
</code></pre> 
<h2><a id="font_face_Nififont_33"></a><font face="黑体">二 Nifi全量同步中文表-普通流程</font></h2> 
<p><font face="黑体">  最常见的全量同步，通过ExecuteSQL组件truncate目标表，使用ExecuteSQLRecord组件查询源表数据( AvroRecordSetWriter写数据)，最后通过PutDataBaseRecord将数据存到目标表中( AvroReader读数据)。但是最后报错<code>"due to None of the fields in the record map to the columns defined by the c_zxy table"</code>,中文表和英文表之间找不到映射关系，那么应该调整流程，使其具有映射关系。</font></p> 
<p><img src="https://images2.imgbox.com/b2/1c/OenPYZhR_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="font_face_Nififont_40"></a><font face="黑体">三 Nifi全量同步中文表-自定义流程</font></h2> 
<p><font face="黑体">  整体流程使用七个组件,第一步通过ExecutSQL组件truncate目标表，第二步使用ExecuteSQLRecord组件查询源表数据( AvroRecordSetWriter写数据),第三步使用ConvertAvroToJSON组件将Avro数据转成JSON类型数据，第四步使用SplitJson将整个JSON切分成一条一条的JSON数据，第五步使用EvaluateJsonPath解析中文表的字段并将其映射为英文名，第六步使用ReplaceText获取上一步的参数并写成SQL语句<code>insert into zxy.c_zxy(name,sex,age) values('${name}','${sex}','${age}')</code>，第七步使用PutSQL组件直接执行上一步传来的SQL语句。</font></p> 
<p><img src="https://images2.imgbox.com/91/57/N7HUPXW7_o.png" alt="在这里插入图片描述"></p> 
<p><font face="黑体"><strong>目标表成功同步到数据</strong></font></p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> zxy<span class="token punctuation">.</span>c_zxy<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token operator">|</span> name <span class="token operator">|</span> sex  <span class="token operator">|</span> age  <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token operator">|</span> 小A  <span class="token operator">|</span> 男   <span class="token operator">|</span> <span class="token number">8</span>    <span class="token operator">|</span>
<span class="token operator">|</span> 小B  <span class="token operator">|</span> 女   <span class="token operator">|</span> <span class="token number">9</span>    <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">------+------+------+</span>
<span class="token number">2</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>
</code></pre> 
<h2><a id="font_face_font_62"></a><font face="黑体">四 自定义流程介绍</font></h2> 
<h3><a id="font_face41_ExecutSQLfont_64"></a><font face="黑体">4.1 ExecutSQL</font></h3> 
<p><font face="黑体">  ExecuteSQL组件，<code>Database Connection Pooling Service</code>配置数据库，<code>SQL select query</code>配置SQL实现清空目标表数据。其余配置项根据实际场景调整。</font></p> 
<p><img src="https://images2.imgbox.com/ee/31/oJTdyESD_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="font_face42_ExecuteSQLRecordfont_71"></a><font face="黑体">4.2 ExecuteSQLRecord</font></h3> 
<p><font face="黑体">  ExecuteSQLRecord组件，<code>Database Connection Pooling Service</code>配置数据库，<code>SQL select query</code>配置SQL实现查询源表数据，<code>Record Writer</code>配置AvroRecordWriter。其余配置项根据实际场景调整。</font></p> 
<p><img src="https://images2.imgbox.com/5b/54/ieubjMHa_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="font_face43_ConvertAvroToJSONfont_78"></a><font face="黑体">4.3 ConvertAvroToJSON</font></h3> 
<p><font face="黑体">  ConvertAvroToJSON未调整配置，其余配置项根据实际场景调整。</font></p> 
<p><img src="https://images2.imgbox.com/07/5e/aHTJXRlA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="font_face44_SplitJsonfont_85"></a><font face="黑体">4.4 SplitJson</font></h3> 
<p><font face="黑体">  SplitJson组件，未调整配置。其余配置项根据实际场景调整。</font></p> 
<p><img src="https://images2.imgbox.com/ed/28/ldhygUH4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="font_face45_EvaluateJsonPathfont_92"></a><font face="黑体">4.5 EvaluateJsonPath</font></h3> 
<p><font face="黑体">  EvaluateJsonPath组件，<code>Destination</code>配置为flowfile-attribute，便于将我们的添加的配置项分发。通过<code>$</code>获取数据，将其映射为英文名。其余配置项根据实际场景调整。</font></p> 
<p><img src="https://images2.imgbox.com/e8/89/WaO4ikES_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="font_face46_ReplaceTextfont_99"></a><font face="黑体">4.6 ReplaceText</font></h3> 
<p><font face="黑体">  ReplaceText组件，<code>Replacement Value</code>配置为<code>insert into zxy.c_zxy(name,sex,age) values('${name}','${sex}','${age}')</code>，通过<code>$</code>获取上一步中分发的数据，并组成SQL语句。其余配置项根据实际场景调整。</font></p> 
<p><img src="https://images2.imgbox.com/44/11/3x22sRtv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="font_face47_PutSQLfont_106"></a><font face="黑体">4.7 PutSQL</font></h3> 
<p><font face="黑体">  PutSQL组件，接收上一步的SQL语句，并放到数据库中执行。其余配置项根据实际场景调整。</font></p> 
<p><img src="https://images2.imgbox.com/df/51/2sR74jgy_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="font_face_font_113"></a><font face="黑体">五 数据源配置介绍</font></h2> 
<h3><a id="font_face51_font_115"></a><font face="黑体">5.1 源数据库</font></h3> 
<p><font face="黑体">  DBCPConnectionPool组件，<code>Database Connection URL</code>配置<code>jdbc:oracle:thin:@IP:PORT:服务名</code>，<code>Database Driver Class Name</code>配置<code>oracle.jdbc.driver.OracleDriver</code>，<code>Database Driver Location</code>为在安装Nifi服务的服务器上的路径,<code>Database User</code>配置数据库连接用户名，<code>Password</code>配置数据库连接密码。其余配置项根据实际场景调整。</font></p> 
<p><a href="https://download.csdn.net/download/m0_51197424/83161163">Oracle驱动OJDBC</a></p> 
<p><img src="https://images2.imgbox.com/6f/0a/7tnn80yA_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="font_face52_font_126"></a><font face="黑体">5.2 目标数据库</font></h3> 
<p><font face="黑体">  DBCPConnectionPool组件，<code>Database Connection URL</code>配置<code>jdbc:mysql://IP:PORT/zxy?characterEncoding=UTF-8&amp;useSSL=false&amp;allowPublicKeyRetrieval=true</code>，<code>Database Driver Class Name</code>配置<code>com.mysql.jdbc.Driver</code>，<code>Database Driver Location</code>为在安装Nifi服务的服务器上的路径,<code>Database User</code>配置数据库连接用户名，<code>Password</code>配置数据库连接密码。其余配置项根据实际场景调整。</font></p> 
<p><a href="https://download.csdn.net/download/m0_51197424/18589358">MySQL驱动JDBC</a></p> 
<p><img src="https://images2.imgbox.com/02/a3/gCS2SpEw_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="font_face_httpsdownloadcsdnnetdownloadm0_5119742486724434font_135"></a><font face="黑体"><a href="https://download.csdn.net/download/m0_51197424/86724434">五 中文表同步模板</a></font></h2>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8e385c2d34e6a27ce72d96d6973562de/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">(Anaconda) 解决Pycharm导入opencv(cv2库)不提示函数</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/68be3d75d15edcf009ad1906a3c27b7a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">关于电脑双屏后，微信截屏会黑屏，且截屏范围不全的问题解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>