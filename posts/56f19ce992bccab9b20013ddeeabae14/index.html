<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【STM32F103】GPIO_Remap1_CAN1与GPIO_Remap2_CAN1区别 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【STM32F103】GPIO_Remap1_CAN1与GPIO_Remap2_CAN1区别" />
<meta property="og:description" content="1.问题描述 最近在画一个小板子，引脚有点多，使用的芯片是STM32F103VET6,100脚的封装。在选择脚的的时候，没有仔细看
Default和Remap这两栏，就直接把PD0和PD1当作了CAN的收发脚。结果码代码的时候发现这玩意居然需要重映射（如下图），
欲哭无泪，只好硬着头皮学习一波了.
参考了一波原子PWM引脚重映射的程序，我以为是这样的就完事了。
第一步： RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOD|RCC_APB2Periph_AFIO, ENABLE);//使能PORTD时钟，使能引脚复用时钟 第二步：	RCC_APB1PeriphClockCmd(RCC_APB1Periph_CAN1, ENABLE);//使能CAN1时钟	第三步： GPIO_PinRemapConfig(GPIO_Remap1_CAN1, ENABLE); //定时器1部分重映射:CH1-&gt;PE9 CH1N-&gt;PE8 当我好奇的在Keil里跳转到GPIO_Remap1_CAN1这个参数时，我开始懵了，奇怪的东西出现了，这里有GPIO_Remap1_CAN1和GPIO_Remap2_CAN1，让我在这两个中选一个！难道我要抓阄？
2.解决问题 冷静一波，开始解决问题，首先还是做做功课，说一说stm32的引脚重映射功能。虽然别人讲的比我好，但我还是要自己写，哈哈哈。
2.1 端口复用和重映射
端口复用好比我有一把瑞士军刀，我拿出啥他就是啥功能。类似的，stm32的一个IO除了做普通IO口，一般会有多个功能，普通功能就是输出高低电平，读取输入高低电平之类，串口，CAN，IIC等属于高级功能，也就是端口可以复用的功能。
重映射，从本质上来讲，相当于一个水池连接了很多根管道，本来我默认从某一管道接水喝，但是某一天，这根管道坏了或者被占用了，我只好从另外一根管道接水，但是注意水还是原来的水。回到32上来。一个外设的引脚除了具有默认的端口外，还可以通过设置重映射寄存器的方式，把这个外设的引脚映射到其它的端口。意思是假设本来我串口默认脚是PA9，PA10，我可以通过重映射，把串口的脚变成PD10，PD11（只做举例）
2.2 寄存器(AFIO_MAPR）
通过查看《STM32中文参考手册》8.4.2，我们知道复用重映射由AFIO_MAPR寄存器配置，而CAN引脚的重映射，由该寄存器的14位和13位配置，如下图所示，回到我的问题，我需要把CAN重映射到PD0和PD1引脚，需要配置该寄存器的第14位和13位为1，该寄存器是32位的，也就是0000 0000 0000 0000 0110 0000 0000 0000，即0x6000。
然而，库函数里面给的是0x001D4000和0x001D6000.
而0X1D6000=0000 0000 0001 1101 0110 0000 0000 0000 ，第13位14位是11,使用PD0，PD1
而0x1D4000=0000 0000 0001 1101 0100 0000 0000 0000， 第13位14位是01,使用PB8，PB9
#define GPIO_Remap1_CAN1 ((uint32_t)0x001D4000) /*!&lt; CAN1 Alternate Function mapping */ #define GPIO_Remap2_CAN1 ((uint32_t)0x001D6000) /*!&lt; CAN1 Alternate Function mapping */ 至此，谜团解开，不过其他位也被配置了，有兴趣的同学可以自己去深究~" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/56f19ce992bccab9b20013ddeeabae14/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-11T17:56:22+08:00" />
<meta property="article:modified_time" content="2020-07-11T17:56:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【STM32F103】GPIO_Remap1_CAN1与GPIO_Remap2_CAN1区别</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>1.问题描述</h4> 
<p>      最近在画一个小板子，引脚有点多，使用的芯片是STM32F103VET6,100脚的封装。在选择脚的的时候，没有仔细看</p> 
<p>Default和Remap这两栏，就直接把PD0和PD1当作了CAN的收发脚。结果码代码的时候发现这玩意居然需要重映射（如下图），</p> 
<p>欲哭无泪，只好硬着头皮学习一波了.</p> 
<p><img alt="" height="496" src="https://images2.imgbox.com/7d/14/2gOF3u4z_o.png" width="800"></p> 
<p>   参考了一波原子PWM引脚重映射的程序，我以为是这样的就完事了。</p> 
<pre><code class="language-cpp">第一步：
RCC_APB2PeriphClockCmd(RCC_APB2Periph_GPIOD|RCC_APB2Periph_AFIO, ENABLE);//使能PORTD时钟，使能引脚复用时钟
第二步：	                   											 
RCC_APB1PeriphClockCmd(RCC_APB1Periph_CAN1, ENABLE);//使能CAN1时钟	
第三步：   
GPIO_PinRemapConfig(GPIO_Remap1_CAN1, ENABLE); //定时器1部分重映射:CH1-&gt;PE9  CH1N-&gt;PE8</code></pre> 
<p>当我好奇的在Keil里跳转到<span style="color:#f33b45;"><strong>GPIO_Remap1_CAN1</strong></span>这个参数时，我开始懵了，奇怪的东西出现了，这里有<span style="color:#f33b45;"><strong>GPIO_Remap1_CAN1和GPIO_Remap2_CAN1</strong></span>，让我在这两个中选一个！难道我要抓阄？</p> 
<p><img alt="" height="542" src="https://images2.imgbox.com/a2/e8/ZPWzDOiB_o.png" width="1009"></p> 
<h4>2.解决问题 </h4> 
<p>冷静一波，开始解决问题，首先还是做做功课，说一说stm32的引脚重映射功能。虽然别人讲的比我好，但我还是要自己写，哈哈哈。</p> 
<p>2.1 端口复用和重映射</p> 
<p><strong>端口复用</strong>好比我有一把瑞士军刀，我拿出啥他就是啥功能。类似的，stm32的一个IO除了做普通IO口，一般会有多个功能，普通功能就是输出高低电平，读取输入高低电平之类，串口，CAN，IIC等属于高级功能，也就是端口可以复用的功能。</p> 
<p><strong>重映射</strong>，从本质上来讲，相当于一个水池连接了很多根管道，本来我默认从某一管道接水喝，但是某一天，这根管道坏了或者被占用了，我只好从另外一根管道接水，但是注意水还是原来的水。回到32上来。一个外设的引脚除了具有默认的端口外，还可以通过设置重映射寄存器的方式，把这个外设的引脚映射到其它的端口。意思是假设本来我串口默认脚是PA9，PA10，我可以通过重映射，把串口的脚变成PD10，PD11（只做举例）</p> 
<p>2.2 寄存器<span style="color:#000000;"><strong>(AFIO_MAPR）</strong></span></p> 
<p><span style="color:#000000;">通过查看《STM32中文参考手册》8.4.2，我们知道</span><span style="color:#000000;"><strong>复用重映射由AFIO_MAPR寄存器</strong>配置，而CAN引脚的重映射，由该寄存器的14位和13位配置，如下图所示，回到我的问题，我需要把CAN重映射到PD</span>0和PD1引脚，需要配置该寄存器的第14位和13位为1，该寄存器是32位的，也就是0000 0000 0000 0000 0110 0000 0000 0000，即<span style="color:#f33b45;">0x6000。</span></p> 
<p><img alt="" height="190" src="https://images2.imgbox.com/a0/76/klQerejc_o.png" width="795"></p> 
<p>然而，库函数里面给的是<span style="color:#f33b45;">0x001D4000</span>和<span style="color:#f33b45;">0x001D6000</span>.</p> 
<p>而0X1D6000=0000 0000 0001 1101 0<span style="color:#f33b45;">11</span>0 0000 0000 0000 ，第13位14位是11,<strong>使用PD0，PD1</strong></p> 
<p>而0x1D4000=0000 0000 0001 1101 0<span style="color:#f33b45;">10</span>0 0000 0000 0000， 第13位14位是01,<strong>使用PB8，PB9</strong></p> 
<pre><code class="language-cpp">#define GPIO_Remap1_CAN1            ((uint32_t)0x001D4000)  /*!&lt; CAN1 Alternate Function mapping */
#define GPIO_Remap2_CAN1            ((uint32_t)0x001D6000)  /*!&lt; CAN1 Alternate Function mapping */</code></pre> 
<p> 至此，谜团解开，不过其他位也被配置了，有兴趣的同学可以自己去深究~</p> 
<h4> </h4>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7fa079f2feb219dfee867f07e3a52599/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android屏幕刷新——源码分析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c7dac6cfb07f81471eeafa16bfa4c357/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">jol使用</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>