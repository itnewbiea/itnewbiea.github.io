<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>钢筋点根环境部署 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="钢筋点根环境部署" />
<meta property="og:description" content="系统环境：Ubuntu 16.04 LTS
1 标题系统环境 1.1 apt-get镜像源更换 sudo vim /etc/apt/sources.list 用以下内容更换，这个是阿里云的源，当然也可更换其他源，这里仅做参考（注意：不同系统的镜像源地址不同，需要谨慎操作，这个对应的是Ubuntu 16.04 LTS）：
# deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted deb-src http://archive.ubuntu.com/ubuntu xenial main restricted #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe #Added by software-properties deb http://mirrors.aliyun.com/ubuntu/ xenial universe deb http://mirrors." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/2a872ed76fb6d7aa3c4370466fea60a5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-05-02T11:07:16+08:00" />
<meta property="article:modified_time" content="2020-05-02T11:07:16+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">钢筋点根环境部署</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>系统环境：Ubuntu 16.04 LTS</p> 
<h2><a id="1__1"></a>1 标题系统环境</h2> 
<h3><a id="11_aptget_2"></a>1.1 apt-get镜像源更换</h3> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> vim /etc/apt/sources.list
</code></pre> 
<p>用以下内容更换，这个是阿里云的源，当然也可更换其他源，这里仅做参考（注意：<strong>不同系统的镜像源地址不同，需要谨慎操作，这个对应的是Ubuntu 16.04 LTS</strong>）：</p> 
<pre><code class="prism language-bash"><span class="token comment"># deb cdrom:[Ubuntu 16.04 LTS _Xenial Xerus_ - Release amd64 (20160420.1)]/ xenial main restricted</span>
deb-src http://archive.ubuntu.com/ubuntu xenial main restricted <span class="token comment">#Added by software-properties</span>
deb http://mirrors.aliyun.com/ubuntu/ xenial main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial main restricted multiverse universe <span class="token comment">#Added by software-properties</span>
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-updates main restricted multiverse universe <span class="token comment">#Added by software-properties</span>
deb http://mirrors.aliyun.com/ubuntu/ xenial universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates universe
deb http://mirrors.aliyun.com/ubuntu/ xenial multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-updates multiverse
deb http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-backports main restricted universe multiverse <span class="token comment">#Added by software-properties</span>
deb http://archive.canonical.com/ubuntu xenial partner
deb-src http://archive.canonical.com/ubuntu xenial partner
deb http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted
deb-src http://mirrors.aliyun.com/ubuntu/ xenial-security main restricted multiverse universe <span class="token comment">#Added by software-properties</span>
deb http://mirrors.aliyun.com/ubuntu/ xenial-security universe
deb http://mirrors.aliyun.com/ubuntu/ xenial-security multiverse
</code></pre> 
<p>修改完毕后，更新：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> update
</code></pre> 
<h2><a id="2__34"></a>2 显卡驱动配置</h2> 
<p>范例配置：cuda-9.0 + cudnn 7.4.15<br> 需要的可以自己搜寻其他版本配置。</p> 
<h3><a id="21__37"></a>2.1 显卡驱动安装</h3> 
<p>查看显卡型号：</p> 
<pre><code class="prism language-bash">lspci <span class="token operator">|</span> <span class="token function">grep</span> -i nvidia
</code></pre> 
<p>下载相应的显卡驱动，linux下后缀为".run"<br> 显卡驱动下载地址：<a href="https://www.nvidia.cn/Download/index.aspx?lang=cn" rel="nofollow">https://www.nvidia.cn/Download/index.aspx?lang=cn</a><br> 打开终端alt+f4,先删除旧的驱动：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> purge nvidia*
</code></pre> 
<p>禁用自带的nouveau nvidia驱动（<strong>很重要！</strong>）<br> 更改文件：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> gedit /etc/modprobe.d/blacklist.conf
</code></pre> 
<p>在文件最后加入：</p> 
<pre><code class="prism language-bash">blacklist nouveau
options nouveau modeset<span class="token operator">=</span>0
</code></pre> 
<p>更新内核：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> update-initramfs -u
</code></pre> 
<p>修改后重新启动系统<code>sudo reboot</code>，用以确认nouveau是否被干掉，使用命令：</p> 
<pre><code class="prism language-bash">lsmod <span class="token operator">|</span> <span class="token function">grep</span> nouveau		<span class="token comment">#无输出则表示禁用成功。</span>
<span class="token function">sudo</span> <span class="token function">service</span> lightdm stop	<span class="token comment">#停用图形驱动程序，进入命令行模式</span>
<span class="token function">sudo</span> <span class="token function">chmod</span> +x Nvidia.***.run
<span class="token function">sudo</span> ./Nvidia.**.run 	<span class="token comment">#全部选是</span>
<span class="token function">sudo</span> <span class="token function">service</span> lightdm restart  	<span class="token comment">#重启图形界面</span>
nvidia-smi 	<span class="token comment">#出现显卡驱动则表示安装成功</span>
</code></pre> 
<h3><a id="22_cuda90_72"></a>2.2 cuda-9.0</h3> 
<p>cuda下载地址 ：<a href="https://developer.nvidia.com/cuda-toolkit-archive" rel="nofollow">https://developer.nvidia.com/cuda-toolkit-archive</a><br> 安装依赖：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> freeglut3-dev build-essential libx11-dev libxmu-dev libxi-dev libgl1-mesa-glx libglu1-mesa libglu1-mesa-dev
</code></pre> 
<p>安装cuda：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> sh cuda*.run
</code></pre> 
<p>其中，可以ctrl+c完成协议阅读，显卡驱动选择no，其他选择yes和默认安装路径即可。<br> 添加环境变量：</p> 
<pre><code class="prism language-bash">vim ~/.bashrc
</code></pre> 
<p>加入：</p> 
<pre><code class="prism language-bash"><span class="token function">export</span> PATH<span class="token operator">=</span>/usr/local/cuda-9.0/bin<span class="token variable">${PATH:+:${PATH}</span><span class="token punctuation">}</span>
<span class="token function">export</span> LD_LIBRARY_PATH<span class="token operator">=</span>/usr/local/cuda-9.0/lib64\ <span class="token variable">${LD_LIBRARY_PATH:+:${LD_LIBRARY_PATH}</span><span class="token punctuation">}</span>
</code></pre> 
<p>更新源：</p> 
<pre><code class="prism language-bash"><span class="token function">source</span> ~/.bashrc
</code></pre> 
<p>验证：</p> 
<pre><code class="prism language-bash"><span class="token function">cd</span> /usr/local/cuda-9.0/samples/1_Utilities/deviceQuery
<span class="token function">make</span>
<span class="token function">sudo</span> ./deviceQuery
</code></pre> 
<p>若返回对应GPU信息则表示cuda安装成功。</p> 
<h3><a id="23_cudnn_7415_108"></a>2.3 cudnn 7.4.15</h3> 
<p>cudnn下载地址：<a href="https://developer.nvidia.com/rdp/cudnn-archive" rel="nofollow">https://developer.nvidia.com/rdp/cudnn-archive</a><br> 将下载的cudnn解压至当前目录：</p> 
<pre><code class="prism language-bash"><span class="token function">tar</span> zxvf cudnn-9.0-linux-x64-v7.1.tgz
<span class="token function">sudo</span> <span class="token function">cp</span> cuda/include/cudnn.h /usr/local/cuda/include/ 
<span class="token function">sudo</span> <span class="token function">cp</span> cuda/lib64/libcudnn* /usr/local/cuda/lib64/ 
<span class="token function">cd</span> /usr/local/cuda/lib64/
<span class="token function">sudo</span> <span class="token function">rm</span> -rf libcudnn.so.7 libcudnn.so		<span class="token comment">#删除原有动态文件</span>
<span class="token function">sudo</span> <span class="token function">ln</span> -s libcudnn.so.7.1.4 libcudnn.so.7  
<span class="token function">sudo</span> <span class="token function">ln</span> -s libcudnn.so.7 libcudnn.so  
<span class="token function">sudo</span> ldconfig
nvcc -V
</code></pre> 
<p>若出现cuda版本信息表示操作成功。</p> 
<h2><a id="3_python_123"></a>3 python运行环境</h2> 
<p>本次环境部署python版本需要3.6版本。<br> python3.6安装可参考：</p> 
<blockquote> 
 <p>https://www.hanyibo.com/python/Ubuntu-install-Python3-6.html</p> 
</blockquote> 
<h3><a id="31_pip_128"></a>3.1 pip换源</h3> 
<p>pip换国内镜像源，解决国外源下载太慢。</p> 
<pre><code class="prism language-bash"><span class="token function">mkdir</span> ~/.pip
vim ~/.pip/pip.conf
</code></pre> 
<p>添加下面的内容：</p> 
<pre><code class="prism language-bash"><span class="token punctuation">[</span>global<span class="token punctuation">]</span>
index-url <span class="token operator">=</span> https://pypi.tuna.tsinghua.edu.cn/simple
trusted-host <span class="token operator">=</span> pypi.tuna.tsinghua.edu.cn
</code></pre> 
<p>保存并退出。</p> 
<h3><a id="32_python_143"></a>3.2 python所需环境依赖</h3> 
<p>主要依赖如下，如果运行期间有其他需要，请自行安装。</p> 
<ul><li>torch == 1.1.0</li><li>torchvision == 0.3.0</li><li>numpy</li><li>flask</li><li>base64</li><li>opencv-python == 3.4.6</li><li>mmcv == 0.2.14</li><li>sklearn</li><li>scikit-image</li><li>matplotlib</li></ul> 
<h3><a id="33__155"></a>3.3 相关文件替换</h3> 
<p>下载mmdetection库用编译使用。</p> 
<pre><code class="prism language-bash"><span class="token function">git</span> clone https://github.com/xinyu-ch/mmdetection.git
<span class="token function">cd</span> mmdetection
python setup.py develop
</code></pre> 
<p>拷贝mmdet/ops/nms/soft_nms_cpu.cpython-36m-x86_64-linux-gnu.so 文件到RebarCountDeploy对应文件夹下。</p> 
<p>更改mmcv底层文件：</p> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> vim /usr/local/lib/python3.6/site-packages/mmcv/visualization/image.py
</code></pre> 
<p>替换：</p> 
<pre><code class="prism language-bash">    <span class="token keyword">if</span> show:
        imshow<span class="token punctuation">(</span>img, win_name, wait_time<span class="token punctuation">)</span>
    <span class="token keyword">if</span> out_file is not None:
        imwrite<span class="token punctuation">(</span>img, out_file<span class="token punctuation">)</span>
</code></pre> 
<p>为：</p> 
<pre><code class="prism language-bash">	<span class="token keyword">return</span> bboxes
</code></pre> 
<h3><a id="34_ip_182"></a>3.4 ip地址更改</h3> 
<p>更改run_pytorch_server.py中底端ip地址和端口。<br> 后台运行模型：</p> 
<pre><code class="prism language-bash"><span class="token function">nohup</span> python run_pytorch_server.py <span class="token operator">&amp;</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1a63ea734936b52cad99183b5f4277cb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">System.Diagnostics.Process.Start(&#34;‪C:\\Windows\\System32\\osk.exe&#34;);提示找不到文件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a990cb6554340c585c6b493a535f97ec/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python3基础篇（十）——异常处理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>