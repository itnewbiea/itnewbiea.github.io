<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>按键修改阈值功能、报警功能、空气质量功能实现（STM32） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="按键修改阈值功能、报警功能、空气质量功能实现（STM32）" />
<meta property="og:description" content="按键修改阈值功能 要使用按键，首先要定义按键。通过查阅资料，可知按键的引脚如图所示：按键1（S1）通过KEY0与PA0连接，按键2（S2）通过KEY1与PE2连接，按键3（S3）通过KEY2与PE3连接，按键4（S4）通过KEY3与PE4连接。
key.c 这段代码主要是对四个按键进行了初始化配置，使其能够进行读取输入操作。
#include &#34;key.h&#34; void Key_Init() { GPIO_InitTypeDef GPIO_InitStructure; /*四个按键*/ /* GPIOA 引脚的时钟使能 */ RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);	/* 配置PA0引脚为输出模式 s1*/ GPIO_InitStructure.GPIO_Pin = GPIO_Pin_0;	//配置的引脚 GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;	//输入模式 GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;	//推挽模式 GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;	//速度为100MHz GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;	//上下拉电阻：无上下拉电阻 GPIO_Init(GPIOA, &amp;GPIO_InitStructure); /* 配置PE2引脚为输出模式 s2*/ GPIO_InitStructure.GPIO_Pin = GPIO_Pin_2;	//配置的引脚 GPIO_InitStructure.GPIO_Mode = GPIO_Mode_IN;	//输入模式 GPIO_InitStructure.GPIO_OType = GPIO_OType_PP;	//推挽模式 GPIO_InitStructure.GPIO_Speed = GPIO_Speed_100MHz;	//速度为100MHz GPIO_InitStructure.GPIO_PuPd = GPIO_PuPd_NOPULL;	//上下拉电阻：无上下拉电阻 GPIO_Init(GPIOE, &amp;GPIO_InitStructure); /* 配置PE3引脚为输出模式 s3*/ GPIO_InitStructure." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f25520cfb561fc94874e83dd0f9b3de7/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-06T17:23:46+08:00" />
<meta property="article:modified_time" content="2023-03-06T17:23:46+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">按键修改阈值功能、报警功能、空气质量功能实现（STM32）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h3>按键修改阈值功能</h3> 
<p>        要使用按键，首先要定义按键。通过查阅资料，可知按键的引脚如图所示：按键1（S1）通过KEY0与PA0连接，按键2（S2）通过KEY1与PE2连接，按键3（S3）通过KEY2与PE3连接，按键4（S4）通过KEY3与PE4连接。</p> 
<p class="img-center"><img alt="按键引脚" height="378" src="https://images2.imgbox.com/12/40/lqWLfOK1_o.png" width="918"></p> 
<h4>        key.c</h4> 
<p>        这段代码主要是对四个按键进行了初始化配置，使其能够进行读取输入操作。</p> 
<pre><code class="language-cpp">#include "key.h"

void Key_Init()
{
	GPIO_InitTypeDef  GPIO_InitStructure;

	/*四个按键*/
	/* GPIOA 引脚的时钟使能  */
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOA, ENABLE);	
	
	/* 配置PA0引脚为输出模式 s1*/
	GPIO_InitStructure.GPIO_Pin 	= GPIO_Pin_0;			//配置的引脚
	GPIO_InitStructure.GPIO_Mode 	= GPIO_Mode_IN;		    //输入模式
	GPIO_InitStructure.GPIO_OType 	= GPIO_OType_PP;		//推挽模式
	GPIO_InitStructure.GPIO_Speed 	= GPIO_Speed_100MHz;	//速度为100MHz
	GPIO_InitStructure.GPIO_PuPd 	= GPIO_PuPd_NOPULL;		//上下拉电阻：无上下拉电阻
	GPIO_Init(GPIOA, &amp;GPIO_InitStructure);
	
	/* 配置PE2引脚为输出模式 s2*/
	GPIO_InitStructure.GPIO_Pin 	= GPIO_Pin_2;			//配置的引脚
	GPIO_InitStructure.GPIO_Mode 	= GPIO_Mode_IN;		    //输入模式
	GPIO_InitStructure.GPIO_OType 	= GPIO_OType_PP;		//推挽模式
	GPIO_InitStructure.GPIO_Speed 	= GPIO_Speed_100MHz;	//速度为100MHz
	GPIO_InitStructure.GPIO_PuPd 	= GPIO_PuPd_NOPULL;		//上下拉电阻：无上下拉电阻
	GPIO_Init(GPIOE, &amp;GPIO_InitStructure);
	
	/* 配置PE3引脚为输出模式 s3*/
	GPIO_InitStructure.GPIO_Pin 	= GPIO_Pin_3;			//配置的引脚
	GPIO_InitStructure.GPIO_Mode 	= GPIO_Mode_IN;		    //输入模式
	GPIO_InitStructure.GPIO_OType 	= GPIO_OType_PP;		//推挽模式
	GPIO_InitStructure.GPIO_Speed 	= GPIO_Speed_100MHz;	//速度为100MHz
	GPIO_InitStructure.GPIO_PuPd 	= GPIO_PuPd_NOPULL;		//上下拉电阻：无上下拉电阻
	GPIO_Init(GPIOE, &amp;GPIO_InitStructure);
	
	/* 配置PE4引脚为输出模式 s4*/
	GPIO_InitStructure.GPIO_Pin 	= GPIO_Pin_4;			//配置的引脚
	GPIO_InitStructure.GPIO_Mode 	= GPIO_Mode_IN;		    //输入模式
	GPIO_InitStructure.GPIO_OType 	= GPIO_OType_PP;		//推挽模式
	GPIO_InitStructure.GPIO_Speed 	= GPIO_Speed_100MHz;	//速度为100MHz
	GPIO_InitStructure.GPIO_PuPd 	= GPIO_PuPd_NOPULL;		//上下拉电阻：无上下拉电阻
	GPIO_Init(GPIOE, &amp;GPIO_InitStructure);

}
</code></pre> 
<h4>        key.h</h4> 
<pre><code class="language-cpp">#ifndef _KEY_H
#define _KEY_H

//C文件中需要的其他的头文件
#include &lt;stm32f4xx.h&gt;
#include "sys.h"
#include "delay.h"
#include "math.h"
#include "adc.h"

//C文件中定义的函数的声明
void Key_Init(void);

#endif
</code></pre> 
<h3>阈值更改函数</h3> 
<p>        这段代码定义了两个函数。这两个函数用于更改阈值和选择需要调整哪个阈值。</p> 
<p>        Yuzhi_change() 函数的作用是根据按键输入更改传入的指针变量 yuzhi 所指向的阈值，函数内部通过判断按键的状态进行阈值的加减操作，最大值为 99，最小值为 1。如果按键 s1 被按下，则阈值加一，D1 灯亮；如果按键 s2 被按下，则阈值减一，D2 灯亮。</p> 
<p>        Yuzhi_kind_change() 函数的作用是根据按键输入选择需要调整哪个阈值。函数内部使用一个  switch 语句判断当前需要调整的阈值类型，调用 Yuzhi_change() 函数更改阈值。如果按键s3 被按下，则更改当前需要调整的阈值类型，并且再次调用 Yuzhi_change() 函数更改阈值。此函数的传入参数包括 kind、wendu_yu、yanwu_yu 和 CO_yu，其中 kind 为当前需要调整的阈值类型，取值为 1、2、3，分别对应温度、烟雾、CO 浓度阈值。</p> 
<pre><code class="language-cpp">//阈值更改函数
void Yuzhi_change(u8 *yuzhi)
{
	if( PAin(0)== 0 )//s1按下
	{
		if( *yuzhi&lt;99 )
		{
			PFout(9) = 0;//D1亮
			(*yuzhi)++;
		}
		
	}
	else
		PFout(9) = 1;//D1灭
	
	if( PEin(2)== 0 )//s2按下
	{
		if( *yuzhi&gt;1 )
		{
			PFout(10) = 0;//D2亮
			(*yuzhi)--;
		}
		
	}
	else
		PFout(10) = 1;//D2灭
	
}

u8 kind = 1;

//更改需要调整哪个阈值
void Yuzhi_kind_change(u8 *kind, u8 *wendu_yu, u8 *yanwu_yu, u8 *CO_yu)
{
	switch(*kind)
	{
		case 1:Yuzhi_change(&amp;*wendu_yu);break;
		case 2:Yuzhi_change(&amp;*yanwu_yu);break;
		case 3:Yuzhi_change(&amp;*CO_yu);break;
		default :break;
	}
	
	/*按键3实现下调*/
	if( PEin(3)== 0 )
	{
		PEout(13) = 0;
		if( *kind&lt;3 )
			(*kind)++;
		else if( *kind == 3 )
			*kind = 1;
		
		switch(*kind)
		{
			case 1:Yuzhi_change(&amp;*wendu_yu);break;
			case 2:Yuzhi_change(&amp;*yanwu_yu);break;
			case 3:Yuzhi_change(&amp;*CO_yu);break;
			default :break;
		}
		
	}
	else
		PEout(13) = 1;
	
}
</code></pre> 
<h3>空气质量判断和报警系统</h3> 
<p>        这段代码实现了一个空气质量判断和报警系统。</p> 
<p>        首先，在空气质量判断的部分，根据一定的判断条件，将空气质量分为三个等级。如果 CO_ppm，Smog_ppm 和 buf[2]（也就是温度）都小于 25，那么空气质量等级为 1，即为优；如果 CO_ppm，Smog_ppm 和 buf[2] 中任意一个大于 35，那么空气质量等级为 3，即为差；否则，空气质量等级为 2，即为良。</p> 
<p>        接着，在报警系统的部分，如果 CO_ppm，Smog_ppm 或 buf[2] 的值大于等于相应的阈值（CO_yu，Smog_yu或Temperature_yu），就会触发报警，此时 PFout(8) 输出高电平，蜂鸣器响起来；否则，PFout(8) 输出低电平，蜂鸣器不响。</p> 
<p>        整个代码的功能就是对空气质量进行判断，并在需要时触发报警。</p> 
<pre><code class="language-cpp">/*空气质量判断*/
if( CO_ppm&lt;25 &amp;&amp; Smog_ppm&lt;25 &amp;&amp; buf[2]&lt;25 )
    quality  = 1;
else if( CO_ppm&gt;35 || Smog_ppm&gt;35 || buf[2]&gt;35 )
	quality = 3;
else quality = 2;
		
/*报警系统*/
if( (CO_ppm &gt;= CO_yu) || (Smog_ppm &gt;= Smog_yu ) || (buf[2]&gt;=Temperature_yu) )
	PFout(8) = 1;//蜂鸣器叫		
else
	PFout(8) = 0;</code></pre> 
<h3>LED灯定义</h3> 
<p>        这段代码实现了一个 LED 的初始化。</p> 
<pre><code class="language-cpp">#include "led.h"


void led_init(void)
{
	GPIO_InitTypeDef GPIO_InitStructure;
	
	//1、初始化led对应的引脚 PF9 PF10 PE13 PE14的时钟
	RCC_AHB1PeriphClockCmd(RCC_AHB1Periph_GPIOE|RCC_AHB1Periph_GPIOF, ENABLE);
	
	//2、通过结构体初始化led引脚
	/* 配置PF9 PF10引脚为输出模式 */
	GPIO_InitStructure.GPIO_Pin 	= GPIO_Pin_9 | GPIO_Pin_10;			//配置的引脚
	GPIO_InitStructure.GPIO_Mode 	= GPIO_Mode_OUT;		//输出模式
	GPIO_InitStructure.GPIO_OType 	= GPIO_OType_PP;		//推挽模式
	GPIO_InitStructure.GPIO_Speed 	= GPIO_Speed_100MHz;	//速度为100MHz
	GPIO_InitStructure.GPIO_PuPd 	= GPIO_PuPd_NOPULL;		//上下拉电阻：无上下拉电阻
	GPIO_Init(GPIOF, &amp;GPIO_InitStructure);

	/* 配置PE13 PE14引脚为输出模式 */
	GPIO_InitStructure.GPIO_Pin 	= GPIO_Pin_13 | GPIO_Pin_14;			//配置的引脚
	GPIO_Init(GPIOE, &amp;GPIO_InitStructure);
	
	PFout(9) = 1;
	PFout(10) = 1;
	PEout(13) = 1;
	PEout(14) = 1;
}

</code></pre> 
<h3>按键4控制OLED显示空气质量和现在可以更改哪一个阈值</h3> 
<p>        这段代码定义了一个名为s4的函数，它有七个参数：kind、str_shidu、str_temp、str_smog、str_co、str_temp_yu、str_smog_yu、str_co_yu 和 quality。其中，kind表示显示什么类型的数据，如温度、烟雾浓度和CO浓度；str_shidu、str_temp、str_smog 和 str_co分别表示湿度、温度、烟雾浓度和 CO 浓度的数据值；str_temp_yu、str_smog_yu 和 str_co_yu 表示温度、烟雾浓度和CO浓度的阈值；quality表示空气质量的评级。</p> 
<p>        函数的主体部分是一个 if 语句，当 PEin(4) 等于0时（即按下按钮 4），执行 if 语句中的代码，否则执行 else 语句中的代码。if 语句中的代码主要是对 OLED 屏幕进行显示，根据 quality 参数的值，显示空气质量的评级（优、良或差），同时根据 kind 参数的值，显示相应的数据类型（温度、烟雾浓度或CO浓度）以及它们的数据值和阈值。</p> 
<p>        if语句的最后，通过 PEout(14) = 1；将指示灯 d4 熄灭，等待下一次按下按钮执行函数。</p> 
<pre><code class="language-cpp">void s4(int kind, char *str_shidu, char *str_temp, char *str_smog, char *str_co, char *str_temp_yu, char *str_smog_yu, char *str_co_yu, u8 quality)
{
	if( PEin(4)== 0 )
	{
		PEout(14) = 0;
		OLED_Clear();
		OLED_ShowChinese3(0,0,6,16);//空
		OLED_ShowChinese3(18,0,7,16);//气
		OLED_ShowChinese3(36,0,8,16);//质
		OLED_ShowChinese3(54,0,9,16);//量
		switch(quality)
		{
			case 1:
				OLED_ShowChinese3(72,0,10,16);//优
				OLED_Refresh();
				break;
			case 2:
				OLED_ShowChinese3(72,0,11,16);//良
				OLED_Refresh();
				break;
			case 3:
				OLED_ShowChinese3(72,0,12,16);//差
				OLED_Refresh();
				break;
			default :break;
		}
		
		OLED_ShowChinese3(0,16,0,16);//现
		OLED_ShowChinese3(18,16,1,16);//在
		OLED_ShowChinese3(36,16,2,16);//可
		OLED_ShowChinese3(54,16,3,16);//以
		OLED_ShowChinese3(72,16,4,16);//调
		OLED_ShowChinese3(90,16,5,16);//整
		
		switch(kind)
		{
			case 1:
				OLED_ShowChinese2(0,32,0,16);//温
				OLED_ShowChinese2(18,32,2,16);//度
				OLED_ShowChinese2(36,32,6,16);//阈
				OLED_ShowChinese2(54,32,7,16);//值
				OLED_Refresh();
				break;
			case 2:
				OLED_ShowString(0,32,"CH4",16);
				OLED_ShowChinese2(36,32,6,16);//阈
				OLED_ShowChinese2(54,32,7,16);//值
				OLED_Refresh();
				break;
			case 3:
				OLED_ShowString(0,32,"CO",16);
				OLED_ShowChinese2(36,32,6,16);//阈
				OLED_ShowChinese2(54,32,7,16);//值
				OLED_Refresh();
				break;
			default :break;
		}
		OLED_Refresh();
		
		
		delay_ms(1500);
		
		/********OLED部分*********/
		OLED_Clear();
		OLED_ShowChinese2(0,0,1,16);//湿
		OLED_ShowChinese2(18,0,2,16);//度
		OLED_ShowChar(36,0,':',16);//:
		OLED_ShowString(48,0,&amp;*str_shidu,16);
		OLED_ShowChinese2(87,0,6,16);//阈
		OLED_ShowChinese2(105,0,7,16);//值
		
		OLED_ShowChinese2(0,16,0,16);//温
		OLED_ShowChinese2(18,16,2,16);//度
		OLED_ShowChar(36,16,58,16);//26号‘:’，ASC2为58
		OLED_ShowString(48,16,&amp;*str_temp,16);
		OLED_ShowString(96,16,&amp;*str_temp_yu,16);
		
		OLED_ShowString(0,32,"CH4:",16);
		OLED_ShowString(32,32,&amp;*str_smog,16);
		OLED_ShowString(96,32,&amp;*str_smog_yu,16);
		
		OLED_ShowString(0,48,"CO: ",16);
		OLED_ShowString(32,48,&amp;*str_co,16);
		OLED_ShowString(96,48,&amp;*str_co_yu,16);
		
		OLED_Refresh();
		PEout(14) = 1;
	}
	else
		PEout(14) = 1;
}</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0782b03c87e6135998e476aa7330639d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">22款常用微信小程序UI框架推荐！</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c088903e0e01452cb463196a5a21d726/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">《PyTorch深度学习实践9》——卷积神经网络-高级篇（Advanced-Convolution Neural Network）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>