<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Apache Jackrabbit漏洞浅析 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Apache Jackrabbit漏洞浅析" />
<meta property="og:description" content="Apache Jackrabbit是一个Java开源内容存储库，1.0.0 &lt;= 版本 &lt; 2.20.11、2.21.0 &lt;= 版本 &lt; 2.21.18存在RMI功能导致的远程代码执行漏洞。
补丁分析 对比补丁前后两个版本（https://github.com/apache/jackrabbit/compare/jackrabbit-2.20.10...jackrabbit-2.20.11），基本只是删掉了CB库。
从官方文档（https://jackrabbit.apache.org/archive/wiki/JCR/RemoteAccess_115513494.html）可以知道存在RMI-over-HTTP的默认监听路径为/rmi。
在jackrabbit-standalone-components/src/main/resources/WEB-INF/web.xml中找到/rmi对应类：
&lt;servlet-mapping&gt; &lt;servlet-name&gt;RMI&lt;/servlet-name&gt; &lt;url-pattern&gt;/rmi&lt;/url-pattern&gt; &lt;/servlet-mapping&gt; &lt;servlet&gt; &lt;servlet-name&gt;RMI&lt;/servlet-name&gt; &lt;servlet-class&gt;org.apache.jackrabbit.servlet.remote.RemoteBindingServlet&lt;/servlet-class&gt; &lt;/servlet&gt; 参考官方示例用URLRemoteRepository(&#34;http://localhost:8080/rmi&#34;);把Stub接下来，接口里的方法并不多，最接近Object的自然是Credentials。
Credentials是一个继承Serializable的空接口，我们看到4个实现之一的SimpleCredentials：
其中attributes属性是一个HashMap，有Object相关的setter/getter，要素齐全对接RMI反序列化CB的PriorityQueue就行，不需要知道用户密码。
newInstance0:-1, NativeConstructorAccessorImpl (sun.reflect) newInstance:62, NativeConstructorAccessorImpl (sun.reflect) newInstance:45, DelegatingConstructorAccessorImpl (sun.reflect) newInstance:423, Constructor (java.lang.reflect) newInstance:442, Class (java.lang) getTransletInstance:455, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax) newTransformer:486, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax) getOutputProperties:507, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax) invoke0:-1, NativeMethodAccessorImpl (sun.reflect) invoke:62, NativeMethodAccessorImpl (sun.reflect) invoke:43, DelegatingMethodAccessorImpl (sun.reflect) invoke:498, Method (java.lang.reflect) invokeMethod:2128, PropertyUtilsBean (org.apache.commons.beanutils) getSimpleProperty:1279, PropertyUtilsBean (org.apache.commons.beanutils) getNestedProperty:809, PropertyUtilsBean (org." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f7e3a28026b60d174891cd72bfa5f765/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-28T11:31:18+08:00" />
<meta property="article:modified_time" content="2023-12-28T11:31:18+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Apache Jackrabbit漏洞浅析</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>Apache Jackrabbit是一个Java开源内容存储库，1.0.0 &lt;= 版本 &lt; 2.20.11、2.21.0 &lt;= 版本 &lt; 2.21.18存在RMI功能导致的远程代码执行漏洞。</p> 
<h3>补丁分析</h3> 
<p>对比补丁前后两个版本（https://github.com/apache/jackrabbit/compare/jackrabbit-2.20.10...jackrabbit-2.20.11），基本只是删掉了CB库。</p> 
<p>从官方文档（https://jackrabbit.apache.org/archive/wiki/JCR/RemoteAccess_115513494.html）可以知道存在RMI-over-HTTP的默认监听路径为<code>/rmi</code>。</p> 
<p>在<span style="color:#be191c;"><code><span style="background-color:#cccccc;">jackrabbit-standalone-components/src/main/resources/WEB-INF/web.xml</span></code></span>中找到<span style="color:#be191c;"><code><span style="background-color:#cccccc;">/rmi</span></code></span>对应类：</p> 
<pre><code class="hljs">&lt;servlet-mapping&gt;
    &lt;servlet-name&gt;RMI&lt;/servlet-name&gt;
    &lt;url-pattern&gt;/rmi&lt;/url-pattern&gt;
&lt;/servlet-mapping&gt;

&lt;servlet&gt;
  &lt;servlet-name&gt;RMI&lt;/servlet-name&gt;
  &lt;servlet-class&gt;org.apache.jackrabbit.servlet.remote.RemoteBindingServlet&lt;/servlet-class&gt;
&lt;/servlet&gt;</code></pre> 
<p><img alt="" height="608" src="https://images2.imgbox.com/c7/8e/dGwf03Xe_o.png" width="1080"></p> 
<p>参考官方示例用<span style="color:#be191c;"><code><span style="background-color:#cccccc;">URLRemoteRepository("http://localhost:8080/rmi");</span></code></span>把Stub接下来，接口里的方法并不多，最接近Object的自然是<span style="color:#be191c;"><code><span style="background-color:#cccccc;">Credentials</span></code></span>。</p> 
<p><img alt="" height="608" src="https://images2.imgbox.com/8c/ce/vjkFYU8Y_o.png" width="1080"></p> 
<p><span style="color:#be191c;"><code><span style="background-color:#cccccc;">Credentials</span></code></span>是一个继承<span style="color:#be191c;"><code><span style="background-color:#cccccc;">Serializable</span></code></span>的空接口，我们看到4个实现之一的<span style="color:#be191c;"><code><span style="background-color:#cccccc;">SimpleCredentials</span></code></span>：</p> 
<p><img alt="" height="608" src="https://images2.imgbox.com/99/c3/OvTdcfKJ_o.png" width="1080"></p> 
<p>其中<span style="color:#be191c;"><code><span style="background-color:#cccccc;">attributes</span></code></span>属性是一个HashMap，有Object相关的setter/getter，要素齐全对接RMI反序列化CB的PriorityQueue就行，不需要知道用户密码。</p> 
<p><img alt="" height="608" src="https://images2.imgbox.com/63/f0/yne2wuOW_o.png" width="1080"></p> 
<pre><code class="hljs">newInstance0:-1, NativeConstructorAccessorImpl (sun.reflect)
newInstance:62, NativeConstructorAccessorImpl (sun.reflect)
newInstance:45, DelegatingConstructorAccessorImpl (sun.reflect)
newInstance:423, Constructor (java.lang.reflect)
newInstance:442, Class (java.lang)
getTransletInstance:455, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)
newTransformer:486, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)
getOutputProperties:507, TemplatesImpl (com.sun.org.apache.xalan.internal.xsltc.trax)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
invokeMethod:2128, PropertyUtilsBean (org.apache.commons.beanutils)
getSimpleProperty:1279, PropertyUtilsBean (org.apache.commons.beanutils)
getNestedProperty:809, PropertyUtilsBean (org.apache.commons.beanutils)
getProperty:885, PropertyUtilsBean (org.apache.commons.beanutils)
getProperty:464, PropertyUtils (org.apache.commons.beanutils)
compare:163, BeanComparator (org.apache.commons.beanutils)
siftDownUsingComparator:722, PriorityQueue (java.util)
siftDown:688, PriorityQueue (java.util)
heapify:737, PriorityQueue (java.util)
readObject:797, PriorityQueue (java.util)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
invokeReadObject:1170, ObjectStreamClass (java.io)
readSerialData:2178, ObjectInputStream (java.io)
readOrdinaryObject:2069, ObjectInputStream (java.io)
readObject0:1573, ObjectInputStream (java.io)
readObject:431, ObjectInputStream (java.io)
readObject:1409, HashMap (java.util)
invoke0:-1, NativeMethodAccessorImpl (sun.reflect)
invoke:62, NativeMethodAccessorImpl (sun.reflect)
invoke:43, DelegatingMethodAccessorImpl (sun.reflect)
invoke:498, Method (java.lang.reflect)
invokeReadObject:1170, ObjectStreamClass (java.io)
readSerialData:2178, ObjectInputStream (java.io)
readOrdinaryObject:2069, ObjectInputStream (java.io)
readObject0:1573, ObjectInputStream (java.io)
defaultReadFields:2287, ObjectInputStream (java.io)
readSerialData:2211, ObjectInputStream (java.io)
readOrdinaryObject:2069, ObjectInputStream (java.io)
readObject0:1573, ObjectInputStream (java.io)
readObject:431, ObjectInputStream (java.io)
unmarshalValue:322, UnicastRef (sun.rmi.server)
unmarshalParametersUnchecked:628, UnicastServerRef (sun.rmi.server)
unmarshalParameters:616, UnicastServerRef (sun.rmi.server)
dispatch:338, UnicastServerRef (sun.rmi.server)
run:200, Transport$1 (sun.rmi.transport)
run:197, Transport$1 (sun.rmi.transport)
doPrivileged:-1, AccessController (java.security)
serviceCall:196, Transport (sun.rmi.transport)
handleMessages:573, TCPTransport (sun.rmi.transport.tcp)
run0:834, TCPTransport$ConnectionHandler (sun.rmi.transport.tcp)
lambda$run$0:688, TCPTransport$ConnectionHandler (sun.rmi.transport.tcp)
run:-1, 679859895 (sun.rmi.transport.tcp.TCPTransport$ConnectionHandler$$Lambda$14)
doPrivileged:-1, AccessController (java.security)
run:687, TCPTransport$ConnectionHandler (sun.rmi.transport.tcp)
runWorker:1149, ThreadPoolExecutor (java.util.concurrent)
run:624, ThreadPoolExecutor$Worker (java.util.concurrent)
run:748, Thread (java.lang)</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/03770eb70870bbf068982e616ff7632e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">停用多路径设备 mpatha</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/abb55dcfe9c9d899395e3f5a59a8a3c6/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java8中list转map方法总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>