<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>面试官：说说你对责任链模式的理解？应用场景？ - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="面试官：说说你对责任链模式的理解？应用场景？" />
<meta property="og:description" content="一、是什么 责任链模式（Chain of Responsibility Pattern）就是某个请求需要多个对象进行处理，从而避免请求的发送者和接收之间的耦合关系
将这些对象连成一条链子，并沿着这条链子传递该请求，直到有对象处理它为止
职责链上的处理者负责处理请求，客户只需要将请求发送到职责链上即可，无须关心请求的处理细节和请求的传递
常见的流程如下：
发送者知道链中的第一个接受者，它向这个接受者发出请求
每一个接受者都对请求进行分析，要么处理它，要么往下传递
每一个接受者知道的其他对象只有一个，即它的下家对象
如果没有任何接受者处理请求，那么请求将从链上离开，不同的实现对此有不同的反应
二、使用 假设我们负责一个售卖手机的网站，需求的定义是：需经过分别缴纳500元定金和200元定金的两轮预订，才能到正式购买阶段
公司对于交了定金的用户有一定的优惠政策，规则如下：
缴纳500元定金的用户可以收到100元优惠券
纳200元定金的用户可以收到50元优惠券
而没有缴纳定金的用户进入普通购买模式，没有优惠券，而且在库存不足的情况下，不一定能保证买得到
下面开始设计几个字段，解释它们的含义：
orderType：表示订单类型，值为1表示500元定金用户，值为2表示200元定金用户，值为3表示普通用户。
pay：表示用户是否支付定金，值为布尔值true和false，就算用户下了500元定金的订单，但是如果没有支付定金，那也会降级为普通用户购买模式。
stock：表示当前用户普通购买的手机库存数量，已经支付过定金的用户不受限制。
代码实现如下：
const order = function (orderType, pay, stock) { if (orderType === 1) { if (pay === true) { console.log(&#39;500元定金预购，得到100元优惠券&#39;) } else { if (stock &gt; 0) { console.log(&#39;普通用户购买，无优惠券&#39;) } else { console.log(&#39;手机库存不足&#39;) } } else if (orderType === 2) { if (pay === true) { console.log(&#39;200元定金预购，得到50元优惠券&#39;) } else { if (stock &gt; 0) { console." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/2413442e4d2933526115a53be8d4d5a4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-11-15T08:31:00+08:00" />
<meta property="article:modified_time" content="2021-11-15T08:31:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">面试官：说说你对责任链模式的理解？应用场景？</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="js_content"> 
 <p style="text-align:left;"><img src="https://images2.imgbox.com/1c/9c/nyPyZiJ1_o.png" alt="8f43458eaaa8d37ab3648676287fc9e4.png"></p> 
 <h3>一、是什么</h3> 
 <p>责任链模式（Chain of Responsibility Pattern）就是某个请求需要多个对象进行处理，从而避免请求的发送者和接收之间的耦合关系</p> 
 <p>将这些对象连成一条链子，并沿着这条链子传递该请求，直到有对象处理它为止</p> 
 <p>职责链上的处理者负责处理请求，客户只需要将请求发送到职责链上即可，无须关心请求的处理细节和请求的传递</p> 
 <p>常见的流程如下：</p> 
 <ul><li><p>发送者知道链中的第一个接受者，它向这个接受者发出请求</p></li><li><p>每一个接受者都对请求进行分析，要么处理它，要么往下传递</p></li><li><p>每一个接受者知道的其他对象只有一个，即它的下家对象</p></li><li><p>如果没有任何接受者处理请求，那么请求将从链上离开，不同的实现对此有不同的反应</p></li></ul> 
 <h3>二、使用</h3> 
 <p>假设我们负责一个售卖手机的网站，需求的定义是：需经过分别缴纳500元定金和200元定金的两轮预订，才能到正式购买阶段</p> 
 <p>公司对于交了定金的用户有一定的优惠政策，规则如下：</p> 
 <ul><li><p>缴纳500元定金的用户可以收到100元优惠券</p></li><li><p>纳200元定金的用户可以收到50元优惠券</p></li><li><p>而没有缴纳定金的用户进入普通购买模式，没有优惠券，而且在库存不足的情况下，不一定能保证买得到</p></li></ul> 
 <p>下面开始设计几个字段，解释它们的含义：</p> 
 <ul><li><p>orderType：表示订单类型，值为1表示500元定金用户，值为2表示200元定金用户，值为3表示普通用户。</p></li><li><p>pay：表示用户是否支付定金，值为布尔值true和false，就算用户下了500元定金的订单，但是如果没有支付定金，那也会降级为普通用户购买模式。</p></li><li><p>stock：表示当前用户普通购买的手机库存数量，已经支付过定金的用户不受限制。</p></li></ul> 
 <p>代码实现如下：</p> 
 <pre class="has"><code class="language-go">const order = function (orderType, pay, stock) {
  if (orderType === 1) {
    if (pay === true) {
      console.log('500元定金预购，得到100元优惠券')
    } else {
      if (stock &gt; 0) {
        console.log('普通用户购买，无优惠券')
      } else {
        console.log('手机库存不足')
      }
    } else if (orderType === 2) {
      if (pay === true) {
        console.log('200元定金预购，得到50元优惠券')
      } else {
        if (stock &gt; 0) {
          console.log('普通用户购买，无优惠券')
        } else {
          console.log('手机库存不足')
        }
      }
    } else if (orderType === 3) {
      if (stock &gt; 0) {
          console.log('普通用户购买，无优惠券')
        } else {
          console.log('手机库存不足')
      } 
  }
}

order(1, true, 500)  // 输出：500元定金预购，得到100元优惠券'</code></pre> 
 <p>可以看到上述代码大量实用化<code>if...else</code>，难以阅读，维护起来也很困难</p> 
 <p>如果进行优化，则可以把500元订单、200元订单以及普通购买拆分成三个函数，如下：</p> 
 <pre class="has"><code class="language-go">function order500 (orderType, pay, stock) {
  if (orderType === 1 &amp;&amp; pay === true) {
    console.log('500元定金预购，得到100元优惠券')
  } else {
    order200(orderType, pay, stock)
  }
}

function order200 (orderType, pay, stock) {
  if (orderType === 2 &amp;&amp; pay === true) {
    console.log('200元定金预购，得到50元优惠券')
  } else {
    order200(orderType, pay, stock)
  }
}

function orderNormal (orderType, pay, stock) {
  if (stock &gt; 0) {
    console.log('普通用户购买，无优惠券')
  } else {
    console.log('手机库存不足')
  }
}

// 测试
order500(1, true, 500)  // 500元定金预购，得到100元优惠券
order500(1, false, 500)  // 普通用户购买，无优惠券
order500(2, true, 500)  // 200元定金预购，得到50元优惠券
order500(3, false, 500)  // 普通用户购买，无优惠券
order500(3, false, 0)   // 手机库存不足</code></pre> 
 <p>上述过程中，请求在链条中传递的顺序很僵硬，传递请求的代码跟业务代码耦合在一起，如果有一天要增加300元定金的预订，那么就要切断之前的链条，修改订单500函数的代码，重新在500和200之间加一根新的链条，这违反了开放-封闭原则</p> 
 <p>因此需要灵活更改责任链节点，如果不能处理的时候，则返回一个标识继续往后传递，如下：</p> 
 <pre class="has"><code class="language-go">function order500 (orderType, pay, stock) {
  if (orderType === 1 &amp;&amp; pay === true) {
    console.log('500元定金预购，得到100元优惠券')
  } else {
    return 'nextSuccessor'
  }
}

function order200 (orderType, pay, stock) {
  if (orderType === 2 &amp;&amp; pay === true) {
    console.log('200元定金预购，得到50元优惠券')
  } else {
    return 'nextSuccessor'
  }
}

function orderNormal (orderType, pay, stock) {
  if (stock &gt; 0) {
    console.log('普通用户购买，无优惠券')
  } else {
    console.log('手机库存不足')
  }
}</code></pre> 
 <p>下面再创建一个链类，将订单优惠函数传入链类中，如下：</p> 
 <pre class="has"><code class="language-go">class Chain {
  construct (fn) {
    this.fn = fn
    this.successor = null
  }

  setNextSuccessor (successor) {
    return this.successor = successor
  }

  passRequest () {
    const res = this.fn.apply(this, arguments)

    if (res === 'nextSuccessor') {
      return this.successor &amp;&amp; this.successor.passRequest.apply(this.successor, arguments)
    }
    return res
  }
}

// 包装三个订单函数
const chainOrder500 = new Chain(order500)
const chainOrder200 = new Chain(order200)
const chainOrderNormal = new Chain(orderNormal)

// 指定节点在职责链中的位置
chainOrder500.setNextSuccessor(chainOrder200)
chainOrder200.setNextSuccessor(chainOrderNormal)

// 最后把请求传递给第一个节点
chainOrder500.passRequest(1, true, 500)   // 500元定金预购，得到100元优惠券
chainOrder500.passRequest(2, true, 500)   // 200元定金预购，得到50元优惠券
chainOrder500.passRequest(3, true, 500)   // 普通用户购买，无优惠券
chainOrder500.passRequest(1, false, 0)    // 手机库存不足</code></pre> 
 <h3>三、应用场景</h3> 
 <p>责任链模式比较适合比如一个任务需要多个对象才能完成处理的情况或者代码存在许多<code>if-else</code>判断的情况，例如OA事件审批、分配开发任务等</p> 
 <p>在<code>JavaScript</code>中，无论是作用链、原型链，还是DOM节点中的事件冒泡，我们都能从中找到职责链的影子</p> 
 <p>使用了职责链模式之后，链中的节点对象可以灵活地拆分重组，增加、删除和修改节点在链中的位置都是很容易的事</p> 
 <h3>参考文献</h3> 
 <ul><li><p>https://www.runoob.com/design-pattern/chain-of-responsibility-pattern.html</p></li><li><p>https://juejin.cn/post/6993948920929845279</p></li><li><p>https://juejin.cn/post/6844903855348514829</p></li></ul> 
 <p style="text-align:center;">--The End--</p> 
 <p style="text-align:center;">系列正在更新：12/14</p> 
 <p style="text-align:center;">点击下方卡片解锁更多</p> 
 <p style="text-align:center;"><img src="https://images2.imgbox.com/62/9d/QVOe8Hps_o.png" alt="1d955c3423339388494a59ae9fc7b6b5.png"></p> 
 <p style="text-align:center;">创作不易，星标、点赞、在看 三连支持</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/17e563f27ab08c236816d64b995df021/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MissingServletRequestParameterException: Required request parameter ‘id‘ for method parameter type I</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1ed62f1fc5b166f7423dca3c173cc0b0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">解决Xshell连不上virtualBox虚拟机</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>