<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>[2009国家集训队]小Z的袜子--莫队算法 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="[2009国家集训队]小Z的袜子--莫队算法" />
<meta property="og:description" content="Description 作为一个生活散漫的人，小Z每天早上都要耗费很久从一堆五颜六色的袜子中找出一双来穿。终于有一天，小Z再也无法忍受这恼人的找袜子过程，于是他决定听天由命…… 具体来说，小Z把这N只袜子从1到N编号，然后从编号L到R(L 尽管小Z并不在意两只袜子是不是完整的一双，甚至不在意两只袜子是否一左一右，他却很在意袜子的颜色，毕竟穿两只不同色的袜子会很尴尬。 你的任务便是告诉小Z，他有多大的概率抽到两只颜色相同的袜子。当然，小Z希望这个概率尽量高，所以他可能会询问多个(L,R)以方便自己选择。
Input 输入文件第一行包含两个正整数N和M。N为袜子的数量，M为小Z所提的询问的数量。接下来一行包含N个正整数Ci，其中Ci表示第i只袜子的颜色，相同的颜色用相同的数字表示。再接下来M行，每行两个正整数L，R表示一个询问。
Output 包含M行，对于每个询问在一行中输出分数A/B表示从该询问的区间[L,R]中随机抽出两只袜子颜色相同的概率。若该概率为0则输出0/1，否则输出的A/B必须为最简分数。（详见样例）
Sample Input 6 4 1 2 3 3 3 2 2 6 1 3 3 5 1 6 Sample Output 2/5 0/1 1/1 4/15 【样例解释】 询问1：共C(5,2)=10种可能，其中抽出两个2有1种可能，抽出两个3有3种可能，概率为(1&#43;3)/10=4/10=2/5。 询问2：共C(3,2)=3种可能，无法抽到颜色相同的袜子，概率为0/3=0/1。 询问3：共C(3,2)=3种可能，均为抽出两个3，概率为3/3=1/1。 注：上述C(a, b)表示组合数，组合数C(a, b)等价于在a个不同的物品中选取b个的选取方案数。 【数据规模和约定】 30%的数据中 N,M ≤ 5000； 60%的数据中 N,M ≤ 25000； 100%的数据中 N,M ≤ 50000，1 ≤ L &lt; R ≤ N，Ci ≤ N。 思路:先建曼哈顿最小生成树，然后DFS，注意回溯部分。 #include &lt;iostream&gt; #include &lt;cstdio&gt; #include &lt;cstring&gt; #include &lt;cmath&gt; #include &lt;algorithm&gt; using namespace std; #define maxn 400005 #define LL long long int LL Ans1[maxn],Ans2[maxn]; int Cnt[maxn],key[maxn],S[maxn],T[maxn],nxt[maxn],vis[maxn],vv[maxn],first[maxn]; int lowbit(int x) { return x &amp; (-x); } struct Point { int x,y,id; bool operator &lt; (const Point p)const { return x !" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/69d21d3a4682bfcbfdb60d6c507d6ed6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2014-09-05T22:02:24+08:00" />
<meta property="article:modified_time" content="2014-09-05T22:02:24+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">[2009国家集训队]小Z的袜子--莫队算法</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <span style="font-family:arial,verdana,helvetica,sans-serif; font-size:14px"></span> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Description</h3> 
<div class="content" style="font-family:'Times New Roman'; height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; font-size:14px; text-align:left"> 
 <p style="font-family:arial,verdana,helvetica,sans-serif"><span style="font-family:宋体; font-size:12pt">作为一个生活散漫的人，小<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">Z</span>每天早上都要耗费很久从一堆五颜六色的袜子中找出一双来穿。终于有一天，小<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">Z</span>再也无法忍受这恼人的找袜子过程，于是他决定听天由命<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">……<br style="font-family:arial,verdana,helvetica,sans-serif"> </span>具体来说，小<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">Z</span>把这<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">N</span>只袜子从<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">1</span>到<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">N</span>编号，然后从编号<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">L</span>到<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">R(L </span>尽管小<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">Z</span>并不在意两只袜子是不是完整的一双，甚至不在意两只袜子是否一左一右，他却很在意袜子的颜色，毕竟穿两只不同色的袜子会很尴尬。<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif"><br style="font-family:arial,verdana,helvetica,sans-serif"> </span>你的任务便是告诉小<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">Z</span>，他有多大的概率抽到两只颜色相同的袜子。当然，小<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">Z</span>希望这个概率尽量高，所以他可能会询问多个<span lang="EN-US" style="font-family:arial,verdana,helvetica,sans-serif">(L,R)</span>以方便自己选择。</span></p> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Input</h3> 
<div class="content" style="font-family:'Times New Roman'; height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; font-size:14px; text-align:left"> 
 <p style="font-family:arial,verdana,helvetica,sans-serif"><span style="font-family:arial,verdana,helvetica,sans-serif; font-size:14px">输入文件第一行包含两个正整数N和M。N为袜子的数量，M为小Z所提的询问的数量。接下来一行包含N个正整数Ci，其中Ci表示第i只袜子的颜色，相同的颜色用相同的数字表示。再接下来M行，每行两个正整数L，R表示一个询问。</span></p> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Output</h3> 
<div class="content" style="font-family:'Times New Roman'; height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; font-size:14px; text-align:left"> 
 <p style="font-family:arial,verdana,helvetica,sans-serif"><span style="font-family:arial,verdana,helvetica,sans-serif; font-size:14px">包含M行，对于每个询问在一行中输出分数A/B表示从该询问的区间[L,R]中随机抽出两只袜子颜色相同的概率。若该概率为0则输出0/1，否则输出的A/B必须为最简分数。（详见样例）</span></p> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Sample Input</h3> 
<div class="content" style="font-family:'Times New Roman'; height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; font-size:14px; text-align:left"> 
 <span class="sampledata" style="font-family:monospace; white-space:pre; background-color:rgb(141,184,255); font-size:18px">6 4<br style="font-family:arial,verdana,helvetica,sans-serif"> 1 2 3 3 3 2<br style="font-family:arial,verdana,helvetica,sans-serif"> 2 6<br style="font-family:arial,verdana,helvetica,sans-serif"> 1 3<br style="font-family:arial,verdana,helvetica,sans-serif"> 3 5<br style="font-family:arial,verdana,helvetica,sans-serif"> 1 6<br style="font-family:arial,verdana,helvetica,sans-serif"> </span> 
</div> 
<h3 style="font-family:arial,verdana,helvetica,sans-serif; color:blue">Sample Output</h3> 
<div class="content" style="font-family:'Times New Roman'; height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; font-size:14px; text-align:left"> 
 <span class="sampledata" style="font-family:monospace; white-space:pre; background-color:rgb(141,184,255); font-size:18px">2/5<br style="font-family:arial,verdana,helvetica,sans-serif"> 0/1<br style="font-family:arial,verdana,helvetica,sans-serif"> 1/1<br style="font-family:arial,verdana,helvetica,sans-serif"> 4/15<br style="font-family:arial,verdana,helvetica,sans-serif"> 【样例解释】<br style="font-family:arial,verdana,helvetica,sans-serif"> 询问1：共C(5,2)=10种可能，其中抽出两个2有1种可能，抽出两个3有3种可能，概率为(1+3)/10=4/10=2/5。<br style="font-family:arial,verdana,helvetica,sans-serif"> 询问2：共C(3,2)=3种可能，无法抽到颜色相同的袜子，概率为0/3=0/1。<br style="font-family:arial,verdana,helvetica,sans-serif"> 询问3：共C(3,2)=3种可能，均为抽出两个3，概率为3/3=1/1。<br style="font-family:arial,verdana,helvetica,sans-serif"> 注：上述C(a, b)表示组合数，组合数C(a, b)等价于在a个不同的物品中选取b个的选取方案数。<br style="font-family:arial,verdana,helvetica,sans-serif"> 【数据规模和约定】<br style="font-family:arial,verdana,helvetica,sans-serif"> 30%的数据中 N,M ≤ 5000；<br style="font-family:arial,verdana,helvetica,sans-serif"> 60%的数据中 N,M ≤ 25000；<br style="font-family:arial,verdana,helvetica,sans-serif"> 100%的数据中 N,M ≤ 50000，1 ≤ L &lt; R ≤ N，Ci ≤ N。<br style="font-family:arial,verdana,helvetica,sans-serif"> </span> 
</div> 
<div class="content" style="height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; text-align:left"> 
 <span style="font-family:monospace; font-size:18px"><span style="white-space:pre"><br> </span></span> 
</div> 
<div class="content" style="height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; text-align:left"> 
 <span style="font-family:monospace; font-size:18px"><span style="white-space:pre">思路:先建曼哈顿最小生成树，然后DFS，注意回溯部分。</span></span> 
</div> 
<div class="content" style="height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; text-align:left"> 
 <span style="font-family:monospace; font-size:18px"><span style="white-space:pre"></span></span> 
 <pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;cstdio&gt;
#include &lt;cstring&gt;
#include &lt;cmath&gt;
#include &lt;algorithm&gt;
using namespace std;
#define maxn 400005
#define LL long long int
LL Ans1[maxn],Ans2[maxn];
int Cnt[maxn],key[maxn],S[maxn],T[maxn],nxt[maxn],vis[maxn],vv[maxn],first[maxn];
int lowbit(int x)
{
	return x &amp; (-x);
}
struct Point
{
	int x,y,id;
	bool operator &lt; (const Point p)const
	{
		return x != p.x ? x&lt;p.x:y&lt;p.y;
	}
}p[maxn];
struct BIT
{
	int min_val,pos;
	void init()
	{
		min_val = (1&lt;&lt;30);
		pos = -1;
	}
}bit[maxn];
struct Edge
{
	int u,v,d;
	bool operator &lt; (const Edge e)const
	{
		return d &lt; e.d;
	}
}e[maxn&lt;&lt;2];
int tot,cnt,father[maxn];
int find(int x)
{
	if(father[x] == x)	return x;
	return father[x] = find(father[x]);
}
int dist(int i,int j)
{
	return abs(p[i].x - p[j].x) + abs(p[i].y - p[j].y);
}

void addedge(int u,int v,int d)
{
	e[tot].u = u;
	e[tot].v = v;
	e[tot++].d = d;
}

void AddEdge(int u,int v)
{
	vv[cnt] = v;	nxt[cnt] = first[u];	first[u] = cnt++;
	vv[cnt] = u;	nxt[cnt] = first[v];	first[v] = cnt++;
}
void update(int x,int val,int pos)
{
	for(int i = x;i &gt;= 1;i -= lowbit(i))
	{
		if(val &lt; bit[i].min_val)
			bit[i].min_val = val,bit[i].pos = pos;
	}
}

int ask(int x,int m)
{
	int min_val = (1&lt;&lt;30),pos = -1;
	for(int i = x;i &lt;= m;i += lowbit(i))
	{
		if(bit[i].min_val &lt; min_val)
			min_val = bit[i].min_val,pos = bit[i].pos;
	}
	return pos;
}

void dfs(int u,int fa)
{
	for(int i = first[u];i != -1;i = nxt[i])
	{
		int v = vv[i];
		int l1 = S[u],r1 = T[u];
		int l2 = S[v],r2 = T[v];
		if(vis[v])	continue;
		vis[v] = 1;
		LL fenzi = Ans1[u];
		if(l1 &gt; l2)
		{
			for(int j = l2;j &lt; l1;j++)
			{
				Cnt[key[j]]++;
				if(Cnt[key[j]] &gt;= 2)	fenzi += Cnt[key[j]]-1;
			}
		}
		else if(l1 &lt; l2)
		{
			for(int j = l1;j &lt; l2;j++)
			{
				Cnt[key[j]]--;
				if(Cnt[key[j]] &gt;= 1)	fenzi -= Cnt[key[j]];
			}
		}
		if(r1 &gt; r2)
		{
			for(int j = r2+1;j &lt;= r1;j++)
			{
				Cnt[key[j]]--;
				if(Cnt[key[j]] &gt;= 1)	fenzi -= Cnt[key[j]];
			}
		}
		else if(r1 &lt; r2)
		{
			for(int j = r1+1;j &lt;= r2;j++)
			{
				Cnt[key[j]]++;
				if(Cnt[key[j]] &gt;= 2)	fenzi += Cnt[key[j]]-1;
			}
		}
		Ans1[v] = fenzi;	Ans2[v] = ((LL)(r2-l2+1))*(r2-l2)/2;
		dfs(v,u);
		if(l1 &gt; l2)
		{
			for(int j = l2;j &lt; l1;j++)
				Cnt[key[j]]--;
		}
		else if(l1 &lt; l2)
		{
			for(int j = l1;j &lt; l2;j++)
			{
				Cnt[key[j]]++;
			}
		}
		if(r1 &gt; r2)
		{
			for(int j = r2+1;j &lt;= r1;j++)
			{
				Cnt[key[j]]++;
			}
		}
		else if(r1 &lt; r2)
		{
			for(int j = r1+1;j &lt;= r2;j++)
			{
				Cnt[key[j]]--;
			}
		}
	}
}
int a[maxn],b[maxn];
void Manhattan_minmum_spanning_tree(int n,Point *p)
{	
	for(int dir = 0;dir &lt; 4;dir++)
	{
		if(dir == 1 || dir == 3)
		{
			for(int i = 0;i &lt; n;i++)
				swap(p[i].x,p[i].y);
		}
		else if(dir == 2)
		{
			for(int i = 0;i &lt; n;i++)
				p[i].x = -p[i].x;
		}
	
		sort(p,p+n);
		for(int i = 0;i &lt; n;i++)
		{
			a[i] = b[i] = p[i].y - p[i].x;
		}
		sort(b,b+n);
		int m = unique(b,b+n)-b;
		for(int i = 1;i &lt;= m;i++)
			bit[i].init();
		for(int i = n-1;i &gt;= 0;i--)
		{
			int pos = lower_bound(b,b+m,a[i])-b+1;
			int ans = ask(pos,m);
			if(ans != -1)
			{
				//AddEdge(p[i].id,p[ans].id);
				addedge(p[i].id,p[ans].id,dist(i,ans));
			}
			update(pos,p[i].x+p[i].y,i);
		}
	}
	sort(e,e+tot);
	for(int i = 0;i &lt; n;i++)
		father[i] = i;
	for(int i = 0;i &lt; tot;i++)
	{
		int u = e[i].u,v = e[i].v;
		int fa = find(u),fb = find(v);
		if(fa != fb)
		{
			father[fa] = fb;
			AddEdge(u,v);
		}
	}
	int l = S[0],r = T[0];
	LL fenzi = 0,fenmu = 0;
	for(int i = l;i &lt;= r;i++)
	{
		Cnt[key[i]]++;
		if(Cnt[key[i]]&gt;=2)	fenzi += Cnt[key[i]]-1;
	}
	fenmu = ((LL)(r-l+1))*(r-l)/2;
	Ans1[0] = fenzi,Ans2[0] = fenmu;
	vis[0] = 1;
	dfs(0,-1);
}

LL gcd(LL a,LL b)
{
	if(!b)	return a;
	return gcd(b,a%b);
}
int main()
{
	//freopen("in.txt","r",stdin);
	int n,m;
	while(scanf("%d%d",&amp;n,&amp;m)==2 &amp;&amp; n)
	{
		memset(Cnt,0,sizeof(Cnt));
		memset(first,-1,sizeof(first));
		memset(vis,0,sizeof(vis));
		for(int i = 0;i &lt; n;i++)	scanf("%d",&amp;key[i]);
		tot = cnt = 0;
		for(int i = 0;i &lt; m;i++)
		{
			scanf("%d%d",&amp;p[i].x,&amp;p[i].y);
			p[i].id = i;
			p[i].x--;	p[i].y--;
			S[i] = p[i].x;
			T[i] = p[i].y;
		}
		Manhattan_minmum_spanning_tree(m,p);
		for(int i = 0;i &lt; m;i++)
		{
			if(Ans1[i] == 0)
			{
				printf("0/1\n");
			}
			else 
			{
				LL c = gcd(Ans1[i],Ans2[i]);
				Ans1[i] /= c;	Ans2[i] /= c;
				printf("%lld",Ans1[i]);
				cout &lt;&lt; "/";
				printf("%lld\n",Ans2[i]);
			}
		}
	}
	return 0;
}</code></pre> 
 <br> 
 <br> 
</div> 
<div class="content" style="height:auto; background-color:rgb(228,240,248); margin-top:0px; margin-right:0px; margin-bottom:0px; margin-left:0px; padding-top:0px; padding-right:20px; padding-bottom:0px; padding-left:20px; text-align:left"> 
 <span style="font-family:monospace; font-size:18px"><span style="white-space:pre"><br> </span></span> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d0fde699c2b1204c495cdd9fbc3c5375/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">dirent</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0320c7decb738092f1c623630dd976af/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">printf函数实现原理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>