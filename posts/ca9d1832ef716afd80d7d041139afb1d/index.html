<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Hadoop集成对象存储和HDFS磁盘文件存储 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Hadoop集成对象存储和HDFS磁盘文件存储" />
<meta property="og:description" content="1.环境配置 1.1 版本说明 组件版本是否必须其他事项Hadoop3.3.0&#43;是hadoop3.3.0之后原生支持国内主要对象存储Hive3.1.3否实测没有Hive也可以使用sparksql，使用hive更好的管理HDFS数据spark3.3.1是hive和spark整合后，语法为HSQL，自定义函数按照hive使用即可cos未知是 说明：由于部分生产日志过大，且需要对近期数据进行分析，HDFS文件存储成本较高，因此定于将近期热数据存储与hdfs，冷数据存储在更便宜的对象存储之上。
1.2 相关组件官网 Hadoop官网：https://hadoop.apache.org/docs/r3.3.4/hadoop-cos/cloud-storage/index.html
腾讯对象存储cos使用官网：https://cloud.tencent.com/document/product/436/6884
spark官网：https://spark.apache.org/docs/3.3.1/
1.3 cos与hadoop集成特征 支持 Hadoop MapReduce 和 Spark 将数据写入 COS 并直接从 COS 中读取。
实现了Hadoop文件系统的接口，提供了与HDFS相同的伪层次目录结构。
支持大文件分段上传。单个文件最大支持19TB
高性能和高可用性。Hadoop-COS 与 HDFS 的性能差异不超过 30%。
1.4 使用限制 对象存储不是文件系统，它有一些限制：
对象存储是一种键值存储，它天然不支持分层目录。通常，使用对象键中的目录分隔符来模拟分层目录，例如“/hadoop/data/words.dat”。
COS 对象存储目前不支持对象的追加操作。这意味着您不能将内容附加到现有对象（文件）的末尾。
删除和重命名操作都是非原子的，这意味着操作会被中断，操作结果可能会处于不一致的状态。
对象存储有不同的授权模型：
目录权限报告为 777。
文件权限报告为 666。
文件所有者被报告为本地当前用户。
文件组也被报告为本地当前用户。
支持大文件（最大40TB）分段上传，但分段数量限制为10000。
每次列出的文件数量限制为 1000 个。
2.Hadoop与HDFS集成 详见本博客《最全Hadoop实际生产集群高可用搭建》
3.Hadoop与yarn集成 3.1 概念 Bucket：COS 中存储数据的容器，名称由用户自定义的 BucketName 和用户 AppID 组成。
Appid：用户维度的唯一资源标识符。
SecretId：用于验证用户身份的 ID
SecretKey：用于验证用户身份的密钥
Region：桶所在的区域。
CosN：Hadoop-COS 使用cosn作为其 URI 方案，因此 CosN 通常用来指代 Hadoop-COS。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/ca9d1832ef716afd80d7d041139afb1d/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-23T09:17:48+08:00" />
<meta property="article:modified_time" content="2023-12-23T09:17:48+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Hadoop集成对象存储和HDFS磁盘文件存储</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1_1"></a>1.环境配置</h2> 
<h3><a id="11__2"></a>1.1 版本说明</h3> 
<table><thead><tr><th>组件</th><th>版本</th><th>是否必须</th><th>其他事项</th></tr></thead><tbody><tr><td>Hadoop</td><td>3.3.0+</td><td>是</td><td>hadoop3.3.0之后原生支持国内主要对象存储</td></tr><tr><td>Hive</td><td>3.1.3</td><td>否</td><td>实测没有Hive也可以使用sparksql，使用hive更好的管理HDFS数据</td></tr><tr><td>spark</td><td>3.3.1</td><td>是</td><td>hive和spark整合后，语法为HSQL，自定义函数按照hive使用即可</td></tr><tr><td>cos</td><td>未知</td><td>是</td><td></td></tr></tbody></table> 
<blockquote> 
 <p>说明：由于部分生产日志过大，且需要对近期数据进行分析，HDFS文件存储成本较高，因此定于将近期热数据存储与hdfs，冷数据存储在更便宜的对象存储之上。</p> 
</blockquote> 
<h3><a id="12__11"></a>1.2 相关组件官网</h3> 
<p>Hadoop官网：<a href="https://hadoop.apache.org/docs/r3.3.4/hadoop-cos/cloud-storage/index.html" rel="nofollow">https://hadoop.apache.org/docs/r3.3.4/hadoop-cos/cloud-storage/index.html</a><br> 腾讯对象存储cos使用官网：<a href="https://cloud.tencent.com/document/product/436/6884" rel="nofollow">https://cloud.tencent.com/document/product/436/6884</a><br> spark官网：<a href="https://spark.apache.org/docs/3.3.1/" rel="nofollow">https://spark.apache.org/docs/3.3.1/</a></p> 
<h3><a id="13_coshadoop_15"></a>1.3 cos与hadoop集成特征</h3> 
<ul><li> <p>支持 Hadoop MapReduce 和 Spark 将数据写入 COS 并直接从 COS 中读取。</p> </li><li> <p>实现了Hadoop文件系统的接口，提供了与HDFS相同的伪层次目录结构。</p> </li><li> <p>支持大文件分段上传。单个文件最大支持19TB</p> </li><li> <p>高性能和高可用性。Hadoop-COS 与 HDFS 的性能差异不超过 30%。</p> </li></ul> 
<h3><a id="14__23"></a>1.4 使用限制</h3> 
<p>对象存储不是文件系统，它有一些限制：</p> 
<ol><li> <p>对象存储是一种键值存储，它天然不支持分层目录。通常，使用对象键中的目录分隔符来模拟分层目录，例如“/hadoop/data/words.dat”。</p> </li><li> <p>COS 对象存储目前不支持对象的追加操作。这意味着您不能将内容附加到现有对象（文件）的末尾。</p> </li><li> <p>删除和重命名操作都是非原子的，这意味着操作会被中断，操作结果可能会处于不一致的状态。</p> </li><li> <p>对象存储有不同的授权模型：</p> </li></ol> 
<ul><li> <p>目录权限报告为 777。</p> </li><li> <p>文件权限报告为 666。</p> </li><li> <p>文件所有者被报告为本地当前用户。</p> </li><li> <p>文件组也被报告为本地当前用户。</p> </li></ul> 
<ol start="5"><li> <p>支持大文件（最大40TB）分段上传，但分段数量限制为10000。</p> </li><li> <p>每次列出的文件数量限制为 1000 个。</p> </li></ol> 
<h2><a id="2HadoopHDFS_45"></a>2.Hadoop与HDFS集成</h2> 
<p>详见本博客《<a href="https://blog.csdn.net/Brother_ning/article/details/135135550">最全Hadoop实际生产集群高可用搭建</a>》</p> 
<h2><a id="3Hadoopyarn_47"></a>3.Hadoop与yarn集成</h2> 
<h3><a id="31__48"></a>3.1 概念</h3> 
<ul><li> <p>Bucket：COS 中存储数据的容器，名称由用户自定义的 BucketName 和用户 AppID 组成。</p> </li><li> <p>Appid：用户维度的唯一资源标识符。</p> </li><li> <p>SecretId：用于验证用户身份的 ID</p> </li><li> <p>SecretKey：用于验证用户身份的密钥</p> </li><li> <p>Region：桶所在的区域。</p> </li><li> <p>CosN：Hadoop-COS 使用cosn作为其 URI 方案，因此 CosN 通常用来指代 Hadoop-COS。</p> </li></ul> 
<h3><a id="32__60"></a>3.2 依赖关系</h3> 
<ul><li>cos_api（5.4.10 或更高版本）</li><li>cos-java-sdk（推荐2.0.6版本）</li><li>joda-time（推荐2.9.9版本）</li><li>httpClient（推荐4.5.1或更高版本）</li><li>Jackson：jackson-core、jackson-databind、jackson-annotations（2.9.8 或更高版本）</li><li>bcprov-jdk15on（推荐1.59版本）</li></ul> 
<h3><a id="33__67"></a>3.3 属性配置</h3> 
<p>如果您计划使用 COS 作为 Hadoop 或其他大数据系统的默认文件系统，则需要在 core-site.xml 中将fs.defaultFS配置为 Hadoop-COS 的 URI。Hadoop-COS 使用cosn作为其 URI 方案，并使用存储桶作为其 URI 主机。同时，您需要显式设置fs.cosn.userinfo.region来指示您的存储桶所在的区域。</p> 
<blockquote> 
 <p>对于 Hadoop-COS，fs.defaultFS是一个选项。如果您只是暂时使用 COS 作为 Hadoop 的数据源，则无需设置该属性，只需在使用时指定完整的 URI 即可。例如：hadoop fs -ls cosn://testBucket-125236746/testDir/test.txt。</p> 
</blockquote> 
<blockquote> 
 <p>fs.cosn.userinfo.region是 Hadoop-COS 的必需属性。原因是 Hadoop-COS 必须知道使用存储桶的区域，才能准确构造 URL 来访问它。</p> 
</blockquote> 
<blockquote> 
 <p>COS支持多区域存储，不同区域默认有不同的访问域。建议根据自己的业务场景选择就近的存储区域，以提高对象上传下载速度。</p> 
</blockquote> 
<h4><a id="331_coresitexml_75"></a>3.3.1 配置core-site.xml</h4> 
<blockquote> 
 <p>hadoop官网的配置名称有些问题，建议参考腾讯的官网来配置</p> 
</blockquote> 
<pre><code class="prism language-xml"> <span class="token comment">&lt;!-- URI 和区域属性 --&gt;</span>
    <span class="token comment">&lt;!-- 此配置适用于将cos位置默认的存储位置
        &lt;property&gt;
        &lt;name&gt;fs.defaultFS&lt;/name&gt;
        &lt;value&gt;cosn://&lt;bucket-appid&gt;&lt;/value&gt;
        &lt;description&gt;
            Optional: If you don't want to use CosN as the default file system, you don't need to configure it.
        &lt;/description&gt;
    &lt;/property&gt; --&gt;</span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.bucket.region<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>ap-xxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>The region where the bucket is located<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>



<span class="token comment">&lt;!--用户身份验证属性--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.credentials.provider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.fs.auth.SimpleCredentialProvider<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.userinfo.secretId<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>xxxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Tencent Cloud Secret Id <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.userinfo.secretKey<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>xxxx<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Tencent Cloud Secret Key<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

<span class="token comment">&lt;!--Integration Properties--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.impl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.fs.CosFileSystem<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>The implementation class of the CosN Filesystem<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.AbstractFileSystem.cosn.impl<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop.fs.CosN<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>The implementation class of the CosN AbstractFileSystem.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!--Other Runtime Properties--&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.tmp.dir<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>/tmp/hadoop_cos<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>Temporary files would be placed here.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.buffer.size<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>33554432<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>The total size of the buffer pool.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.block.size<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>8388608<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>
        Block size to use cosn filesysten, which is the part size for MultipartUpload. Considering the COS supports up to 10000 blocks, user should estimate the maximum size of a single file. For example, 8MB part size can allow  writing a 78GB single file.
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.maxRetries<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>
      The maximum number of retries for reading or writing files to COS, before throwing a failure to the application.
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>fs.cosn.retry.interval.seconds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>The number of seconds to sleep between each COS retry.<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>

</code></pre> 
<h4><a id="332__162"></a>3.3.2 属性配置介绍</h4> 
<table><thead><tr><th>特性</th><th>描述</th><th>默认值</th><th>必需的</th></tr></thead><tbody><tr><td>fs.defaultFS</td><td>配置Hadoop使用的默认文件系统。</td><td>没有任何</td><td>不</td></tr><tr><td>fs.cosn.credentials.provider</td><td>此选项允许用户指定如何获取凭据。如果未指定，凭证提供程序的默认顺序为：1. org.apache.hadoop.fs.auth.SimpleCredentialsProvider2.org.apache.hadoop.fs.auth.EnvironmentVariableCredentialsProvider。</td><td>没有任何</td><td>不</td></tr><tr><td>fs.cosn.userinfo.secretId/secretKey</td><td>您账户的API密钥信息</td><td>没有任何</td><td>是的</td></tr><tr><td>fs.cosn.bucket.region</td><td>桶所在区域。</td><td>没有任何</td><td>是的</td></tr><tr><td>fs.cosn.impl</td><td>CosN 文件系统的实现类。</td><td>没有任何</td><td>是的</td></tr><tr><td>fs.AbstractFileSystem.cosn.impl</td><td>CosN AbstractFileSystem 的实现类。</td><td>没有任何</td><td>是的</td></tr><tr><td>fs.cosn.tmp.dir</td><td>程序运行过程中，cosn生成的临时文件会存放在这里。</td><td>/tmp/hadoop_cos</td><td>不</td></tr><tr><td>fs.cosn.缓冲区大小</td><td>缓冲池的总大小。要求大于或等于块大小。</td><td>33554432</td><td>不</td></tr><tr><td>fs.cosn.块大小</td><td>文件块的大小。考虑到每个文件最多可以分为10000个上传的限制，必须根据使用的单个文件的最大大小来设置该选项。例如，8MB 的部分大小可以允许写入 78GB 的​​单个文件。</td><td>8388608</td><td>不</td></tr><tr><td>fs.cosn.upload_thread_pool</td><td>文件流式传输到 COS 时并发上传的线程数。</td><td>CPU核心数*3</td><td>不</td></tr><tr><td>fs.cosn.read.ahead.block.size</td><td>每个预读块的大小。</td><td>524288 (512KB)</td><td>不</td></tr><tr><td>fs.cosn.read.ahead.queue.size</td><td>预读队列的长度。</td><td>10</td><td>不</td></tr><tr><td>fs.cosn.maxRetries</td><td>在向应用程序抛出故障之前，向 COS 读取或写入文件的最大重试次数。</td><td>3</td><td>不</td></tr><tr><td>fs.cosn.重试.间隔.秒</td><td>每次重试之间休眠的秒数</td><td>3</td><td>不</td></tr></tbody></table> 
<h3><a id="333_coresitexml_181"></a>3.3.3 更新其他位置的core-site.xml</h3> 
<blockquote> 
 <p>hive和spark的core-site.xml文件并分发</p> 
</blockquote> 
<h3><a id="34__184"></a>3.4 依赖包配置</h3> 
<h4><a id="341__HadoopCOS__185"></a>3.4.1 获取 Hadoop-COS 分发包及其依赖</h4> 
<p>下载地址：<a href="https://github.com/tencentyun/hadoop-cos/releases">Hadoop-COS release</a></p> 
<h4><a id="342_hadoopcos_187"></a>3.4.2 安装hadoop-cos</h4> 
<ol><li>将hadoop-cos-{hadoop.version}-x.x.x.jar和cos_api-bundle-5.x.x.jar 拷贝到 $HADOOP_HOME/share/hadoop/tools/lib下。</li></ol> 
<blockquote> 
 <p>NOTE: 根据hadoop的具体版本选择对应的jar包，若release中没有提供匹配版本的jar包，可自行通过修改pom文件中hadoop版本号，重新编译生成。</p> 
</blockquote> 
<ol start="2"><li>修改 hadoop_env.sh 在 $HADOOP_HOME/etc/hadoop目录下，进入 hadoop_env.sh，增加如下内容，将 cosn 相关 jar 包加入 Hadoop 环境变量：</li></ol> 
<pre><code class="prism language-bash"><span class="token keyword">for</span> <span class="token for-or-select variable">f</span> <span class="token keyword">in</span> <span class="token variable">$HADOOP_HOME</span>/share/hadoop/tools/lib/*.jar<span class="token punctuation">;</span> <span class="token keyword">do</span>
  <span class="token keyword">if</span> <span class="token punctuation">[</span> <span class="token string">"<span class="token variable">$HADOOP_CLASSPATH</span>"</span> <span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token keyword">then</span>
    <span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CLASSPATH</span><span class="token operator">=</span><span class="token variable">$HADOOP_CLASSPATH</span><span class="token builtin class-name">:</span><span class="token variable">$f</span>
  <span class="token keyword">else</span>
    <span class="token builtin class-name">export</span> <span class="token assign-left variable">HADOOP_CLASSPATH</span><span class="token operator">=</span><span class="token variable">$f</span>
  <span class="token keyword">fi</span>
<span class="token keyword">done</span>
</code></pre> 
<ol start="3"><li>将hadoop-cos-{hadoop.version}-x.x.x.jar和cos_api-bundle-5.x.x.jar 拷贝到 $HIVE_HOME/lib下</li></ol> 
<h2><a id="4_202"></a>4.测试使用</h2> 
<h3><a id="41_hadoop_204"></a>4.1 hadoop测试</h3> 
<pre><code class="prism language-bash">hadoop fs <span class="token parameter variable">-ls</span> <span class="token parameter variable">-R</span> cosn://examplebucket-1250000000000/<span class="token operator">&lt;</span>路径<span class="token operator">&gt;</span>
hadoop fs <span class="token parameter variable">-ls</span> <span class="token parameter variable">-R</span> /<span class="token operator">&lt;</span>路径<span class="token operator">&gt;</span><span class="token punctuation">(</span>配置了fs.defaultFS选项为 cosn:// 后<span class="token punctuation">)</span>

<span class="token comment">#例如：</span>
hadoop fs <span class="token parameter variable">-ls</span> <span class="token parameter variable">-R</span> cosn://hdfs-test-1252681929/
-rw-rw-rw-   <span class="token number">1</span> root root       <span class="token number">1087</span> <span class="token number">2018</span>-06-11 07:49 cosn://hdfs-test-1252681929/LICENSE
drwxrwxrwx   - root root          <span class="token number">0</span> <span class="token number">1970</span>-01-01 00:00 cosn://hdfs-test-1252681929/hdfs
drwxrwxrwx   - root root          <span class="token number">0</span> <span class="token number">1970</span>-01-01 00:00 cosn://hdfs-test-1252681929/hdfs/2018
-rw-rw-rw-   <span class="token number">1</span> root root       <span class="token number">1087</span> <span class="token number">2018</span>-06-12 03:26 cosn://hdfs-test-1252681929/hdfs/2018/LICENSE
-rw-rw-rw-   <span class="token number">1</span> root root       <span class="token number">2386</span> <span class="token number">2018</span>-06-12 03:26 cosn://hdfs-test-1252681929/hdfs/2018/ReadMe
drwxrwxrwx   - root root          <span class="token number">0</span> <span class="token number">1970</span>-01-01 00:00 cosn://hdfs-test-1252681929/hdfs/test
-rw-rw-rw-   <span class="token number">1</span> root root       <span class="token number">1087</span> <span class="token number">2018</span>-06-11 07:32 cosn://hdfs-test-1252681929/hdfs/test/LICENSE
-rw-rw-rw-   <span class="token number">1</span> root root       <span class="token number">2386</span> <span class="token number">2018</span>-06-11 07:29 cosn://hdfs-test-1252681929/hdfs/test/ReadMe

</code></pre> 
<h3><a id="42_hivespark_221"></a>4.2 hive及spark测试</h3> 
<p>hive测试</p> 
<pre><code class="prism language-sql"><span class="token comment">-- 测试数据分区插入对象存储</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token identifier"><span class="token punctuation">`</span>student1<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
id <span class="token keyword">int</span><span class="token punctuation">,</span> name string
  <span class="token punctuation">)</span>
PARTITIONED <span class="token keyword">BY</span> <span class="token punctuation">(</span>
  <span class="token identifier"><span class="token punctuation">`</span>part_day<span class="token punctuation">`</span></span> string<span class="token punctuation">)</span>
<span class="token keyword">ROW</span> FORMAT SERDE
  <span class="token string">'org.apache.hadoop.hive.ql.io.orc.OrcSerde'</span>
STORED <span class="token keyword">AS</span> INPUTFORMAT
  <span class="token string">'org.apache.hadoop.hive.ql.io.orc.OrcInputFormat'</span>
    OUTPUTFORMAT
  <span class="token string">'org.apache.hadoop.hive.ql.io.orc.OrcOutputFormat'</span>
LOCATION
  <span class="token string">'cosn://hdfs-test-1252681929/test/student1'</span><span class="token punctuation">;</span>

<span class="token keyword">set</span> spark<span class="token punctuation">.</span>yarn<span class="token punctuation">.</span>queue<span class="token operator">=</span>xxxx<span class="token punctuation">;</span>
<span class="token keyword">insert</span> <span class="token keyword">into</span> <span class="token keyword">table</span> student1 <span class="token keyword">values</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">'abc'</span><span class="token punctuation">,</span><span class="token string">'20231217'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>spark类似</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7397806aa8d00934f06c1c5ece383267/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">最全HSQL命令大全(Hive命令)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/59c94bc0622e426d8db5f9eaf5c76a2e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">最全Hadoop实际生产集群高可用搭建</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>