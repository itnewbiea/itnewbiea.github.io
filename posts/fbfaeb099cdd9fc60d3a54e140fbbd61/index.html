<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>群晖Docker部署HomeAssistant容器结合内网穿透远程控制家中智能设备 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="群晖Docker部署HomeAssistant容器结合内网穿透远程控制家中智能设备" />
<meta property="og:description" content="目录
一、下载HomeAssistant镜像
二、内网穿透HomeAssistant，实现异地控制智能家居
三、使用固定域名访问HomeAssistant
前些天发现了一个巨牛的人工智能学习网站，通俗易懂，风趣幽默，忍不住分享一下给大家。 点击跳转到网站
HomeAssistant是一个可以控制苹果、小米、MQTT等设备的智能家居平台。本文首先介绍如何使用群晖NAS的Docker套件来安装HomeAssistant平台，安装成功后，如何结合cpolar内网穿透工具实现公网访问。
基本条件：
有正版群晖或黑群辉，可以装docker。 一、下载HomeAssistant镜像 打开群晖 容器 管理 套件（较旧系统版本对应的套件为群辉Docker）
注册表 中搜 home-assistant ，右击下图中的 homeassistant/home-assistant 项目下载镜像。
FileStation进入 /docker文件夹 新建Homeassistant文件夹
等待下载完毕：
双击此映像并打开
输入随便什么名称，勾选自启动功能，下一步
存储空间设置: 选择/dokcer/homeassistant 这个刚才新建的路径
在 路径 中填入 /home，给读写权限
环境中添加 variable = TZ 和 value = Asia/Shanghai
网络 选择 host
检查上述修改事项，完成
可见 容器启动成功
此时，自行查找群晖局域网地址，后边加上:8123就是homeassistant局域网地址
http://X.X.X.X:8123
此处我建议使用群晖助手 查找群晖ip：
本地浏览器 输入 http://192.168.50.31:8123/，进入homeassistant初始化流程：
注册账户——选择家庭地区
成功进入，现在我们就能尽情安装插件，绑定智能家居设备啦！
二、内网穿透HomeAssistant，实现异地控制智能家居 想要在户外访问本地Docker容器部署的项目，就需要内网穿透软件，这里我们使用的是免费不限流量的cpolar，如何在群晖NAS安装cpolar请参考：
如何在群晖系统中安装cpolar（群晖7.X版） – cpolar 极点云
安装完毕后，打开cpolar套件，点击右下角 ：9200的局域网地址：
​ 登录进去后,点击左侧仪表盘的隧道管理——创建隧道，我们来创建一条用于映射HomeAssistant的局域网地址到公网的隧道。
隧道名称：可自定义协议：http本地地址：X.X.X.X:8123域名类型：随机域名（cpolar免费版）地区：选择China（cpolar免费版选择China，付费版可选择china vip） 点击创建" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/fbfaeb099cdd9fc60d3a54e140fbbd61/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T22:07:00+08:00" />
<meta property="article:modified_time" content="2024-01-05T22:07:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">群晖Docker部署HomeAssistant容器结合内网穿透远程控制家中智能设备</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p id="main-toc"><strong>目录</strong></p> 
<p id="%E4%B8%80%E3%80%81%E4%B8%8B%E8%BD%BDHomeAssistant%E9%95%9C%E5%83%8F-toc" style="margin-left:40px;"><a href="#%E4%B8%80%E3%80%81%E4%B8%8B%E8%BD%BDHomeAssistant%E9%95%9C%E5%83%8F" rel="nofollow">一、下载HomeAssistant镜像</a></p> 
<p id="%E4%BA%8C%E3%80%81%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8FHomeAssistant%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%BC%82%E5%9C%B0%E6%8E%A7%E5%88%B6%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85-toc" style="margin-left:40px;"><a href="#%E4%BA%8C%E3%80%81%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8FHomeAssistant%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%BC%82%E5%9C%B0%E6%8E%A7%E5%88%B6%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85" rel="nofollow">二、内网穿透HomeAssistant，实现异地控制智能家居</a></p> 
<p id="%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%E5%9B%BA%E5%AE%9A%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AEHomeAssistant-toc" style="margin-left:40px;"><a href="#%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%E5%9B%BA%E5%AE%9A%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AEHomeAssistant" rel="nofollow">三、使用固定域名访问HomeAssistant</a></p> 
<hr id="hr-toc"> 
<p></p> 
<blockquote> 
 <p>前些天发现了一个巨牛的人工智能学习网站，通俗易懂，风趣幽默，忍不住分享一下给大家。 <a href="https://www.captainbed.cn/wxz" rel="nofollow" title="点击跳转到网站">点击跳转到网站</a></p> 
</blockquote> 
<p><strong>HomeAssistant</strong>是一个可以控制<strong>苹果</strong>、<strong>小米</strong>、MQTT等设备的智能家居平台。本文首先介绍如何使用<strong>群晖NAS</strong>的<strong>Docker</strong>套件来安装<strong>HomeAssistant平台</strong>，安装成功后，如何结合cpolar内网穿透工具实现<strong>公网访问。</strong></p> 
<p></p> 
<p class="img-center"><img alt="image-20231101144124179" height="458" src="https://images2.imgbox.com/1a/99/6NThPXGE_o.png" width="1130"></p> 
<p><strong>基本条件：</strong></p> 
<ul><li>有正版群晖或<a href="https://www.cpolar.com/blog/how-to-use-virtual-machines-and-internal-network-penetration-by-students-in-school-for-free-prostitution-and-black-groupware" rel="nofollow" title="黑群辉">黑群辉</a>，可以装docker。</li></ul> 
<h3 id="%E4%B8%80%E3%80%81%E4%B8%8B%E8%BD%BDHomeAssistant%E9%95%9C%E5%83%8F">一、下载HomeAssistant镜像</h3> 
<p>打开群晖 <strong>容器</strong> <strong>管理</strong> 套件（较旧系统版本对应的套件为<strong>群辉Docker</strong>）</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101145017685" height="889" src="https://images2.imgbox.com/0c/06/ygtIwnpE_o.png" width="1200"></p> 
<p><strong>注册表</strong> 中搜 <code>home-assistant</code> ，右击下图中的 <code>homeassistant/home-assistant</code> 项目下载镜像。</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031104919684" height="830" src="https://images2.imgbox.com/7a/09/yRrxtCf6_o.png" width="1200"></p> 
<p><strong>FileStation</strong>进入 /docker文件夹 新建Homeassistant文件夹</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031110256470" height="830" src="https://images2.imgbox.com/59/d8/BeaXRC93_o.png" width="1200"></p> 
<p>等待下载完毕：</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031104811171" height="830" src="https://images2.imgbox.com/fc/1c/arkX4hu7_o.png" width="1200"></p> 
<p>双击此映像并打开</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031104830761" height="830" src="https://images2.imgbox.com/1d/a4/PMizrmNY_o.png" width="1200"></p> 
<p>输入随便什么名称，<strong>勾选自启动功能</strong>，下一步</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031114842291" height="830" src="https://images2.imgbox.com/26/97/uDEMTepP_o.png" width="1200"></p> 
<p>存储空间设置: 选择<strong>/dokcer/homeassistant</strong> 这个刚才新建的路径</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031114920101" height="830" src="https://images2.imgbox.com/f3/5a/jAHqFOiN_o.png" width="1200"></p> 
<p>在 <strong>路径</strong> 中填入 <strong>/home</strong>，给读写权限</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031115038593" height="830" src="https://images2.imgbox.com/b6/f8/ESzCBDlB_o.png" width="1200"></p> 
<p>环境中添加 variable = TZ 和 value = Asia/Shanghai</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031115016583" height="830" src="https://images2.imgbox.com/aa/c8/GWAN7LtE_o.png" width="1200"></p> 
<p>网络 选择 host</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031112250869" height="830" src="https://images2.imgbox.com/2e/33/yhZK3NQx_o.png" width="1200"></p> 
<p>检查上述修改事项，完成</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031115134771" height="830" src="https://images2.imgbox.com/c0/bd/nJoTHrWD_o.png" width="1200"></p> 
<p>可见 容器启动成功</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031115207104" height="830" src="https://images2.imgbox.com/85/79/tU3sjLGF_o.png" width="1200"></p> 
<p>此时，自行查找群晖局域网地址，后边加上<code>:8123</code>就是homeassistant局域网地址</p> 
<p>http://X.X.X.X:8123</p> 
<p>此处我建议使用<strong>群晖助手</strong> 查找群晖ip：</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031115714326" height="758" src="https://images2.imgbox.com/57/ab/CVEhN3U2_o.png" width="754"></p> 
<p>本地浏览器 输入 http://192.168.50.31:8123/，进入homeassistant初始化流程：</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031115549734" height="921" src="https://images2.imgbox.com/70/27/vTsA1Q0P_o.png" width="1200"></p> 
<p>注册账户——选择家庭地区</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031132612751" height="830" src="https://images2.imgbox.com/2e/44/6ASfSp4G_o.png" width="1200"></p> 
<p>成功进入，现在我们就能尽情安装插件，绑定智能家居设备啦！</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031132628581" height="830" src="https://images2.imgbox.com/26/06/P2dXX3XC_o.png" width="1200"></p> 
<h3 id="%E4%BA%8C%E3%80%81%E5%86%85%E7%BD%91%E7%A9%BF%E9%80%8FHomeAssistant%EF%BC%8C%E5%AE%9E%E7%8E%B0%E5%BC%82%E5%9C%B0%E6%8E%A7%E5%88%B6%E6%99%BA%E8%83%BD%E5%AE%B6%E5%B1%85">二、内网穿透HomeAssistant，实现异地控制智能家居</h3> 
<p>想要在户外访问本地Docker容器部署的项目，就需要内网穿透软件，这里我们使用的是免费不限流量的cpolar，如何在群晖NAS安装cpolar请参考：</p> 
<p><a href="https://www.cpolar.com/blog/how-to-install-cpolar-on-a-synology-system-cfah-version-7-x" rel="nofollow" title="如何在群晖系统中安装cpolar（群晖7.X版） – cpolar 极点云">如何在群晖系统中安装cpolar（群晖7.X版） – cpolar 极点云</a></p> 
<p>安装完毕后，打开cpolar套件，点击右下角 <strong>：9200</strong>的局域网地址：</p> 
<p></p> 
<p class="img-center"><img alt="image-20231031144207592" height="889" src="https://images2.imgbox.com/fc/97/wXw8muiU_o.png" width="1200"></p> 
<p></p> 
<p class="img-center"><img alt="image-20231101112900691" height="962" src="https://images2.imgbox.com/a7/c6/ZbKEP2Nq_o.png" width="1200"></p> 
<p>​ 登录进去后,点击左侧仪表盘的隧道管理——创建隧道，我们来创建一条用于映射HomeAssistant的局域网地址到公网的隧道。</p> 
<ul><li>隧道名称：可自定义</li><li>协议：http</li><li>本地地址：X.X.X.X:8123</li><li>域名类型：随机域名（cpolar免费版）</li><li>地区：选择China（cpolar免费版选择China，付费版可选择china vip）</li></ul> 
<p>点击<code>创建</code></p> 
<p><strong>填写如下：</strong></p> 
<p></p> 
<p class="img-center"><img alt="image-20231101112926619" height="889" src="https://images2.imgbox.com/7e/34/S5Kn3JRv_o.png" width="1200"></p> 
<p>下一步我们 点击 在线隧道列表，复制这个公网链接到浏览器：</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101112956177" height="889" src="https://images2.imgbox.com/a8/84/phZVM5xS_o.png" width="1200"></p> 
<p>出现400报错，bad request 意思是 “错误的请求”；</p> 
<p>此时不要慌，这是因为homeassistant中未针对反向代理进行设置，所以我们需要在配置文件中简单修改一下。</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101114519651" height="446" src="https://images2.imgbox.com/9f/b6/9rQorkUA_o.png" width="835"></p> 
<p>点 配置</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101115218411" height="968" src="https://images2.imgbox.com/1d/80/FDCUXAeX_o.png" width="1200"></p> 
<p>系统</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101115236829" height="889" src="https://images2.imgbox.com/ad/5a/RNsG8y9t_o.png" width="1200"></p> 
<p>日志</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101115246203" height="889" src="https://images2.imgbox.com/1e/15/yoECr5eP_o.png" width="1200"></p> 
<p>此处可以查看外部访问的错误日志</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101115306339" height="889" src="https://images2.imgbox.com/54/df/xz2JmYOv_o.png" width="1200"></p> 
<p>在NAS中编辑文件，需要安装 文本编辑器 套件</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101114622582" height="889" src="https://images2.imgbox.com/99/eb/fGfHDxtk_o.png" width="1200"></p> 
<p>在/docker/中找到 configuration.yaml 配置文件，右键使用编辑器打开</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101114704123" height="889" src="https://images2.imgbox.com/27/30/bRE6i2mJ_o.png" width="1200"></p> 
<p>在最后 粘贴如下一段代码：</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101114835219" height="889" src="https://images2.imgbox.com/c5/b1/QU7GzdPT_o.png" width="1200"></p> 
<p>下面ip地址就是我们上面查看日志提示的那个ip地址，此处需要自行修改</p> 
<pre><code>http:
  use_x_forwarded_for: true
  trusted_proxies:
    - 192.168.50.31
</code></pre> 
<p>Bash</p> 
<p>Copy</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101115840620" height="889" src="https://images2.imgbox.com/0a/30/Fxjqlva5_o.png" width="1200"></p> 
<p>保存修改</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101115853349" height="889" src="https://images2.imgbox.com/93/d6/Wgq5vSEx_o.png" width="1200"></p> 
<p>重启容器</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101115939793" height="889" src="https://images2.imgbox.com/cf/29/Ew4SUP8s_o.png" width="1200"></p> 
<p>刷新 公网访问的网页，输入用户名密码进入：</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101120027303" height="979" src="https://images2.imgbox.com/57/a4/teUYnOMr_o.png" width="1176"></p> 
<p></p> 
<p class="img-center"><img alt="image-20231101142719941" height="1008" src="https://images2.imgbox.com/e5/fc/CcMmb9QT_o.png" width="1176"></p> 
<p>要注意的是，以上步骤使用的是随机临时端口地址，所生成的公网地址为随机临时地址，该公网地址24小时内会随机变化。我们接下来为其配置固定的端口地址，该地址不会变化，设置后将无需每天重复修改地址。</p> 
<h3 id="%E4%B8%89%E3%80%81%E4%BD%BF%E7%94%A8%E5%9B%BA%E5%AE%9A%E5%9F%9F%E5%90%8D%E8%AE%BF%E9%97%AEHomeAssistant">三、使用固定域名访问HomeAssistant</h3> 
<p>登录<a href="https://www.cpolar.com/" rel="nofollow" title="cpolar官网">cpolar官网</a>，点击左侧的预留，找到保留的tcp地址，我们来为HomeAssistant保留一个固定二级子域名。</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101143001822" height="898" src="https://images2.imgbox.com/d5/4f/0y0krcpX_o.png" width="1176"></p> 
<p>保留成功后复制保留的二级子域名地址</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101143226198" height="615" src="https://images2.imgbox.com/6c/57/mZrZvwdy_o.png" width="1200"></p> 
<p>修改隧道信息，将保留成功的二级子域名配置到隧道中</p> 
<ul><li><code>域名类型</code>：选择二级子域名</li><li><code>Sub Domain</code>：填写保留成功的二级子域名</li><li>地区选择 官网后台保留的地区（保持一致）</li></ul> 
<p>点击<code>更新</code></p> 
<p>​ 更新完成后,打开在线隧道列表,此时可以看到公网地址已经发生变化,地址名称也变成了保留过的二级子域名名称,将其复制下来</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101143258017" height="490" src="https://images2.imgbox.com/6b/1f/toBfFfWi_o.png" width="1200"></p> 
<p>复制粘贴，即可使用固定的公网ip登录。</p> 
<p></p> 
<p class="img-center"><img alt="image-20231101143327271" height="557" src="https://images2.imgbox.com/02/30/GDGpZxEV_o.png" width="1196"></p> 
<p>HomeAssistant如何添加HACS插件并实现公网控制米家，HomeKit等智能家居，<strong>详情请看：<a href="https://www.cpolar.com/blog/homeassistant-adds-hacs-plugins-and-enables-public-network-control-of-smart-homes-such-as-mijia-and-homekit" rel="nofollow" title="HomeAssistant添加HACS插件并实现公网控制米家，HomeKit等智能家居 – cpolar 极点云">HomeAssistant添加HACS插件并实现公网控制米家，HomeKit等智能家居 – cpolar 极点云</a></strong></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/7c463961f690c7c8e52d2871e58b3095/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">krpano官网文档翻译-------krpano动作/脚本参考【krpano Actions / Scripting Reference】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/04c8b6e37f86a787744752be3eb610ad/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">算法基础之合并果子</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>