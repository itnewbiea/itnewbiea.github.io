<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>VS2019 PCL12.0 Eigen::internal::aligned_free bug - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="VS2019 PCL12.0 Eigen::internal::aligned_free bug" />
<meta property="og:description" content="问题描述：
随便跑了一段程序
PointCloud&lt;PointNormal&gt;::Ptr subsampleAndCalculateNormals(const PointCloud&lt;PointXYZ&gt;::Ptr&amp; cloud) { PointCloud&lt;PointXYZ&gt;::Ptr cloud_subsampled(new PointCloud&lt;PointXYZ&gt;()); VoxelGrid&lt;PointXYZ&gt; subsampling_filter; subsampling_filter.setInputCloud(cloud); subsampling_filter.setLeafSize(subsampling_leaf_size); subsampling_filter.filter(*cloud_subsampled); PointCloud&lt;Normal&gt;::Ptr cloud_subsampled_normals(new PointCloud&lt;Normal&gt;()); NormalEstimation&lt;PointXYZ, Normal&gt; normal_estimation_filter; normal_estimation_filter.setInputCloud(cloud_subsampled); search::KdTree&lt;PointXYZ&gt;::Ptr search_tree(new search::KdTree&lt;PointXYZ&gt;); normal_estimation_filter.setSearchMethod(search_tree); normal_estimation_filter.setRadiusSearch(normal_estimation_search_radius); normal_estimation_filter.compute(*cloud_subsampled_normals); PointCloud&lt;PointNormal&gt;::Ptr cloud_subsampled_with_normals( new PointCloud&lt;PointNormal&gt;()); concatenateFields( *cloud_subsampled, *cloud_subsampled_normals, *cloud_subsampled_with_normals); PCL_INFO(&#34;Cloud dimensions before / after subsampling: %zu / %zu\n&#34;, static_cast&lt;std::size_t&gt;(cloud-&gt;size()), static_cast&lt;std::size_t&gt;(cloud_subsampled-&gt;size())); return cloud_subsampled_with_normals; } 这个函数运行之后报错，报错信息定位到
D:\Program Files\PCL 1.12.0\3rdParty\Eigen\eigen3\Eigen\src\Core\util\Memory.h
Memory.h中的Eigen::internal::aligned_free上，看起来是一个释放指针或者什么的函数，不管怎么运行程序，或者重装PCL库、VS2019都解决不了这个bug。
/** \internal Frees memory allocated with aligned_malloc. */ EIGEN_DEVICE_FUNC inline void aligned_free(void *ptr) { #if (EIGEN_DEFAULT_ALIGN_BYTES==0) || EIGEN_MALLOC_ALREADY_ALIGNED std::free(ptr); #else handmade_aligned_free(ptr); #endif } 后来我去PCL库的GitHub仓库去搜，有好多人也遇到这个bug。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/84a630f5ab3c9894f670ebac3796eabe/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-17T14:32:23+08:00" />
<meta property="article:modified_time" content="2022-06-17T14:32:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">VS2019 PCL12.0 Eigen::internal::aligned_free bug</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>问题描述：</p> 
<p>随便跑了一段程序</p> 
<pre><code class="language-cpp">PointCloud&lt;PointNormal&gt;::Ptr subsampleAndCalculateNormals(const PointCloud&lt;PointXYZ&gt;::Ptr&amp; cloud)
{
    PointCloud&lt;PointXYZ&gt;::Ptr cloud_subsampled(new PointCloud&lt;PointXYZ&gt;());
    VoxelGrid&lt;PointXYZ&gt; subsampling_filter;
    subsampling_filter.setInputCloud(cloud);
    subsampling_filter.setLeafSize(subsampling_leaf_size);
    subsampling_filter.filter(*cloud_subsampled);

    PointCloud&lt;Normal&gt;::Ptr cloud_subsampled_normals(new PointCloud&lt;Normal&gt;());
    NormalEstimation&lt;PointXYZ, Normal&gt; normal_estimation_filter;
    normal_estimation_filter.setInputCloud(cloud_subsampled);
    search::KdTree&lt;PointXYZ&gt;::Ptr search_tree(new search::KdTree&lt;PointXYZ&gt;);
    normal_estimation_filter.setSearchMethod(search_tree);
    normal_estimation_filter.setRadiusSearch(normal_estimation_search_radius);
    normal_estimation_filter.compute(*cloud_subsampled_normals);

    PointCloud&lt;PointNormal&gt;::Ptr cloud_subsampled_with_normals(
        new PointCloud&lt;PointNormal&gt;());
    concatenateFields(
        *cloud_subsampled, *cloud_subsampled_normals, *cloud_subsampled_with_normals);

    PCL_INFO("Cloud dimensions before / after subsampling: %zu / %zu\n",
        static_cast&lt;std::size_t&gt;(cloud-&gt;size()),
        static_cast&lt;std::size_t&gt;(cloud_subsampled-&gt;size()));
    return cloud_subsampled_with_normals;
}</code></pre> 
<p>这个函数运行之后报错，报错信息定位到</p> 
<p>D:\Program Files\PCL 1.12.0\3rdParty\Eigen\eigen3\Eigen\src\Core\util\Memory.h</p> 
<p>Memory.h中的Eigen::internal::aligned_free上，看起来是一个释放指针或者什么的函数，不管怎么运行程序，或者重装PCL库、VS2019都解决不了这个bug。</p> 
<pre><code class="language-cpp">/** \internal Frees memory allocated with aligned_malloc. */
EIGEN_DEVICE_FUNC inline void aligned_free(void *ptr)
{
  #if (EIGEN_DEFAULT_ALIGN_BYTES==0) || EIGEN_MALLOC_ALREADY_ALIGNED
    std::free(ptr);
  #else
    handmade_aligned_free(ptr);
  #endif
}</code></pre> 
<p>后来我去PCL库的GitHub仓库去搜，有好多人也遇到这个bug。</p> 
<p>下面记录这个bug在win10+VS的解决方案：在VS自己的项目的属性页，将启用增强指令集改为图中所示即可。</p> 
<p><img alt="" height="1100" src="https://images2.imgbox.com/6a/96/bFCCAprZ_o.png" width="1200"></p> 
<blockquote> 
 <p> 参考资料：</p> 
 <p><a href="https://github.com/PointCloudLibrary/pcl/issues/4859" title="Eigen::internal::aligned_free bug · Issue #4859 · PointCloudLibrary/pcl (github.com)">Eigen::internal::aligned_free bug · Issue #4859 · PointCloudLibrary/pcl (github.com)</a></p> 
 <p><a href="https://stackoverflow.com/questions/20169064/does-archavx-enable-avx2" rel="nofollow" title="c++ - Does /arch:AVX enable AVX2? - Stack Overflow">c++ - Does /arch:AVX enable AVX2? - Stack Overflow</a></p> 
</blockquote>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dcde7f0ecc6c0071e8fd948f6277841d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python tcping（ping命令)</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ef03b84454f1234a64b7d39bbe67d2c3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">leetCode轮转数组</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>