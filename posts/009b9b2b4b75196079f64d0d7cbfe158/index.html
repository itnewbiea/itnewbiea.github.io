<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spark持久化详解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spark持久化详解" />
<meta property="og:description" content="Spark持久化 1 血缘，缓存，rdd机制 rdd算子本身记录的是元数据，比如某个数据在某个区。他自己不存储数据本身。
（只存储分区和计算方法的数据）
所以 血缘关系（运算流程）或者RDD可以重用 但是数据不可重用
这意味着每次调用都需要 重新运算。
这也是为什么 缓存或者持久化可以提升运行10倍运行速度的原因
因为之前数据虽然在内存里计算，但是并没有存储下来。持久化和缓存才是记录了数据。
rdd1=map(sss) rdd2=rdd1.reducebykey rdd1实际没有保存数据，只记录了血缘。所以当rdd2调用rdd1时。rdd1得重头计算一次。
2 RDD中cache，persist，checkpoint的区别 cache 数据会被缓存到内存来复用
血缘关系中添加新依赖
作业执行完毕时，数据会丢失
persist 保存在内存或磁盘
因为有磁盘IO,所以性能低，但是数据安全
作业执行完毕，数据会丢失
checkpoint 数据可以长时间保存到磁盘中
涉及磁盘IO，读取慢但安全。
独立作业
与cache配合使用，比如checkpoint后再cache一下，这样后续调用可以从cache里取
会切断血缘信息，重新建立新的血缘
checkpoint相当于改变数据源
3 Tips 触发方式：并不是立即缓存，当有action被触发时才调用。
object StorageLevel { //不缓存 val NONE = new StorageLevel(false, false, false, false) //只在硬盘缓存 val DISK_ONLY = new StorageLevel(true, false, false, false) //在硬盘缓存两份 val DISK_ONLY_2 = new StorageLevel(true, false, false, false, 2) //只在内存缓存 val MEMORY_ONLY = new StorageLevel(false, true, false, true) //在内存缓存两份 val MEMORY_ONLY_2 = new StorageLevel(false, true, false, true, 2) //在内存序列化缓存 val MEMORY_ONLY_SER = new StorageLevel(false, true, false, false) //在内存序列化缓存两份 val MEMORY_ONLY_SER_2 = new StorageLevel(false, true, false, false, 2) //同时在内存和硬盘缓存 val MEMORY_AND_DISK = new StorageLevel(true, true, false, true) //同时在内存和硬盘缓存两份（推荐） val MEMORY_AND_DISK_2 = new StorageLevel(true, true, false, true, 2) //同时在内存和硬盘序列化缓存 val MEMORY_AND_DISK_SER = new StorageLevel(true, true, false, false) //同时在内存和硬盘序列化缓存两份 val MEMORY_AND_DISK_SER_2 = new StorageLevel(true, true, false, false, 2) //对外内存 val OFF_HEAP = new StorageLevel(false, false, true, false) ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/009b9b2b4b75196079f64d0d7cbfe158/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-21T16:50:58+08:00" />
<meta property="article:modified_time" content="2022-11-21T16:50:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spark持久化详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="Spark_0"></a>Spark持久化</h2> 
<h3><a id="1_rdd_2"></a>1 血缘，缓存，rdd机制</h3> 
<p>rdd算子本身记录的是元数据，比如某个数据在某个区。他自己不存储数据本身。</p> 
<p>（只存储分区和计算方法的数据）</p> 
<p>所以 <strong>血缘关系（运算流程）或者RDD可以重用 <code>但是数据不可重用</code></strong></p> 
<p>这意味着每次调用都需要 <strong>重新运算</strong>。</p> 
<p>这也是为什么 <strong>缓存或者持久化可以提升运行10倍运行速度的原因</strong></p> 
<p>因为之前数据虽然在内存里计算，但是并没有存储下来。持久化和缓存才是记录了数据。</p> 
<pre><code class="prism language-scala">rdd1<span class="token operator">=</span>map<span class="token punctuation">(</span>sss<span class="token punctuation">)</span>
rdd2<span class="token operator">=</span>rdd1<span class="token punctuation">.</span>reducebykey
</code></pre> 
<p>rdd1实际没有保存数据，只记录了血缘。所以当rdd2调用rdd1时。rdd1得重头计算一次。</p> 
<h3><a id="2_RDDcachepersistcheckpoint_23"></a>2 RDD中cache，persist，checkpoint的区别</h3> 
<h4><a id="cache_25"></a>cache</h4> 
<blockquote> 
 <p>数据会被缓存到内存来复用</p> 
 <p>血缘关系中添加新依赖</p> 
 <p>作业执行完毕时，数据会丢失</p> 
</blockquote> 
<h4><a id="persist_33"></a>persist</h4> 
<blockquote> 
 <p>保存在内存或磁盘</p> 
 <p>因为有磁盘IO,所以性能低，但是数据安全</p> 
 <p>作业执行完毕，数据会丢失</p> 
</blockquote> 
<h4><a id="checkpoint_41"></a>checkpoint</h4> 
<blockquote> 
 <p>数据可以长时间保存到磁盘中</p> 
 <p>涉及磁盘IO，读取慢但安全。</p> 
 <p>独立作业</p> 
 <p>与cache配合使用，比如checkpoint后再cache一下，这样后续调用可以从cache里取</p> 
 <p>会切断血缘信息，重新建立新的血缘</p> 
 <p>checkpoint相当于改变数据源</p> 
</blockquote> 
<h3><a id="3_Tips_57"></a>3 Tips</h3> 
<p>触发方式：并不是立即缓存，当有action被触发时才调用。</p> 
<pre><code class="prism language-scala"><span class="token keyword">object</span> StorageLevel <span class="token punctuation">{<!-- --></span>
  <span class="token comment">//不缓存</span>
  <span class="token keyword">val</span> NONE <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token comment">//只在硬盘缓存</span>
  <span class="token keyword">val</span> DISK_ONLY <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token comment">//在硬盘缓存两份</span>
  <span class="token keyword">val</span> DISK_ONLY_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token comment">//只在内存缓存</span>
  <span class="token keyword">val</span> MEMORY_ONLY <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token comment">//在内存缓存两份</span>
  <span class="token keyword">val</span> MEMORY_ONLY_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token comment">//在内存序列化缓存</span>
  <span class="token keyword">val</span> MEMORY_ONLY_SER <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token comment">//在内存序列化缓存两份</span>
  <span class="token keyword">val</span> MEMORY_ONLY_SER_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token comment">//同时在内存和硬盘缓存</span>
  <span class="token keyword">val</span> MEMORY_AND_DISK <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
  <span class="token comment">//同时在内存和硬盘缓存两份（推荐）</span>
  <span class="token keyword">val</span> MEMORY_AND_DISK_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token comment">//同时在内存和硬盘序列化缓存</span>
  <span class="token keyword">val</span> MEMORY_AND_DISK_SER <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token comment">//同时在内存和硬盘序列化缓存两份</span>
  <span class="token keyword">val</span> MEMORY_AND_DISK_SER_2 <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token comment">//对外内存</span>
  <span class="token keyword">val</span> OFF_HEAP <span class="token operator">=</span> <span class="token keyword">new</span> StorageLevel<span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>上面所有的存储级别，下面时构造器</p> 
<pre><code class="prism language-scala"><span class="token keyword">class</span> StorageLevel <span class="token keyword">private</span><span class="token punctuation">(</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> _useDisk<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> _useMemory<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> _useOffHeap<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> _deserialized<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span>
    <span class="token keyword">private</span> <span class="token keyword">var</span> _replication<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">extends</span> Externalizable <span class="token punctuation">{<!-- --></span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
  <span class="token keyword">def</span> useDisk<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> _useDisk
  <span class="token keyword">def</span> useMemory<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> _useMemory
  <span class="token keyword">def</span> useOffHeap<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> _useOffHeap
  <span class="token keyword">def</span> deserialized<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> _deserialized
  <span class="token keyword">def</span> replication<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> _replication
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>offheap就是jvm的堆内存以外的内存。操作系统管理的内存，降低GC压力。</p> 
<p>deserialized时反序列化，按java的方式加载数据。</p> 
<p>副本数是在多少个节点上备份。</p> 
<p><strong>cache方法其实也是调用persist</strong>，只不过参数是memort_only</p> 
<p>persist默认参数是disk_only</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1df7311498a5dd99caf46ea23ea875d8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mediapipe的Unity实现</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/97f029d099cfd47c1d286e9372dd4392/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">python 实现对于任意字符串中的大小写字母及数字个数的计算</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>