<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MybatisPlus—利用IService实现业务接口练习 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MybatisPlus—利用IService实现业务接口练习" />
<meta property="og:description" content="练习：实现以下接口
代码目录
实体
Po实体
vo实体
DTO实体
Controller层代码
Service接口
Service接口实现类
Mapper层
实体 Po实体 package com.itheima.mp.domain.po; import com.baomidou.mybatisplus.annotation.IdType; import com.baomidou.mybatisplus.annotation.TableField; import com.baomidou.mybatisplus.annotation.TableId; import com.baomidou.mybatisplus.annotation.TableName; import lombok.Data; import java.time.LocalDateTime; @Data @TableName(&#34;tb_user&#34;) public class User { @TableId(type= IdType.AUTO) private Long id; /** * 用户名 */ @TableField(&#34;`username`&#34;) private String username; /** * 密码 */ private String password; /** * 注册手机号 */ private String phone; /** * 详细信息 */ private String info; /** * 使用状态（1正常 2冻结） */ private Integer status; /** * 账户余额 */ private Integer balance; /** * 创建时间 */ private LocalDateTime createTime; /** * 更新时间 */ private LocalDateTime updateTime; } vo实体 package com." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/49443bf54fb808aefc89abc0e3b195d4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-04T16:02:12+08:00" />
<meta property="article:modified_time" content="2024-01-04T16:02:12+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MybatisPlus—利用IService实现业务接口练习</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>练习：</strong>实现以下接口</p> 
<p><img alt="" height="249" src="https://images2.imgbox.com/a5/38/6RXrOwyC_o.png" width="1079"></p> 
<p id="main-toc"><strong>代码目录</strong></p> 
<p id="%E5%AE%9E%E4%BD%93-toc" style="margin-left:0px;"><a href="#%E5%AE%9E%E4%BD%93" rel="nofollow">实体</a><br><a href="#%E5%AE%9E%E4%BD%93" rel="nofollow">        </a><a href="#Po%E5%AE%9E%E4%BD%93" rel="nofollow">Po实体</a><br><a href="#vo%E5%AE%9E%E4%BD%93" rel="nofollow">        </a><a href="#vo%E5%AE%9E%E4%BD%93" rel="nofollow">vo实体</a><br><a href="#DTO%E5%AE%9E%E4%BD%93" rel="nofollow">        </a><a href="#DTO%E5%AE%9E%E4%BD%93" rel="nofollow">DTO实体</a></p> 
<p id="Controller%E5%B1%82%E4%BB%A3%E7%A0%81-toc" style="margin-left:0px;"><a href="#Controller%E5%B1%82%E4%BB%A3%E7%A0%81" rel="nofollow">Controller层代码</a></p> 
<p id="Service%E6%8E%A5%E5%8F%A3-toc" style="margin-left:0px;"><a href="#Service%E6%8E%A5%E5%8F%A3" rel="nofollow">Service接口</a></p> 
<p id="Service%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BB-toc" style="margin-left:0px;"><a href="#Service%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BB" rel="nofollow">Service接口实现类</a></p> 
<p id="Mapper%E5%B1%82-toc" style="margin-left:0px;"><a href="#Mapper%E5%B1%82" rel="nofollow">Mapper层</a></p> 
<hr> 
<h2 id="%E5%AE%9E%E4%BD%93">实体</h2> 
<h3 id="Po%E5%AE%9E%E4%BD%93">Po实体</h3> 
<pre><code class="language-java">package com.itheima.mp.domain.po;

import com.baomidou.mybatisplus.annotation.IdType;
import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.annotation.TableId;
import com.baomidou.mybatisplus.annotation.TableName;
import lombok.Data;

import java.time.LocalDateTime;

@Data
@TableName("tb_user")
public class User {

    @TableId(type= IdType.AUTO)
    private Long id;

    /**
     * 用户名
     */
    @TableField("`username`")
    private String username;

    /**
     * 密码
     */
    private String password;

    /**
     * 注册手机号
     */
    private String phone;

    /**
     * 详细信息
     */
    private String info;

    /**
     * 使用状态（1正常 2冻结）
     */
    private Integer status;

    /**
     * 账户余额
     */
    private Integer balance;

    /**
     * 创建时间
     */
    private LocalDateTime createTime;

    /**
     * 更新时间
     */
    private LocalDateTime updateTime;
}
</code></pre> 
<h3 id="vo%E5%AE%9E%E4%BD%93">vo实体</h3> 
<pre><code class="language-java">package com.itheima.mp.domain.vo;

import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

@Data
@ApiModel(description = "用户VO实体")
public class UserVO {

    @ApiModelProperty("用户id")
    private Long id;

    @ApiModelProperty("用户名")
    private String username;

    @ApiModelProperty("详细信息")
    private String info;

    @ApiModelProperty("使用状态（1正常 2冻结）")
    private Integer status;

    @ApiModelProperty("账户余额")
    private Integer balance;
}
</code></pre> 
<h3 id="DTO%E5%AE%9E%E4%BD%93">DTO实体</h3> 
<pre><code class="language-java">package com.itheima.mp.domain.dto;

import com.baomidou.mybatisplus.annotation.TableField;
import com.baomidou.mybatisplus.extension.handlers.JacksonTypeHandler;
import io.swagger.annotations.ApiModel;
import io.swagger.annotations.ApiModelProperty;
import lombok.Data;

@Data
@ApiModel(description = "用户表单实体")
public class UserFormDTO {

    @ApiModelProperty("id")
    private Long id;

    @ApiModelProperty("用户名")
    private String username;

    @ApiModelProperty("密码")
    private String password;

    @ApiModelProperty("注册手机号")
    private String phone;

    @ApiModelProperty("详细信息，JSON风格")
    private String info;

    @ApiModelProperty("账户余额")
    private Integer balance;
}
</code></pre> 
<hr> 
<h2></h2> 
<h2 id="Controller%E5%B1%82%E4%BB%A3%E7%A0%81"><strong>Controller层代码</strong></h2> 
<pre><code class="language-java">package com.itheima.mp.controller;
import cn.hutool.core.bean.BeanUtil;
import com.itheima.mp.domain.dto.UserFormDTO;
import com.itheima.mp.domain.vo.UserVO;
import com.itheima.mp.domain.po.User;
import com.itheima.mp.service.UserService;
import io.swagger.annotations.Api;
import io.swagger.annotations.ApiOperation;
import io.swagger.annotations.ApiParam;
import lombok.RequiredArgsConstructor;
import org.springframework.web.bind.annotation.*;
import java.util.List;

@Api(tags = "用户管理接口")
@RequestMapping("/users")
@RestController
@RequiredArgsConstructor
public class UserController {

    private final UserService userService;

    @ApiOperation("新增用户接口")
    @PostMapping
    public void saveUser(@RequestBody UserFormDTO userDTO) {
        //1. save接收的是User对象，因此要把DTO拷贝到PO
        User user = BeanUtil.copyProperties(userDTO, User.class);
        //2. 新增
        userService.save(user);
    }

    @ApiOperation("删除用户接口")
    @DeleteMapping("{id}")
    public void deleteUser(@ApiParam("用户id") @PathVariable("id") Long id) {
        userService.removeById(id);
    }

    @ApiOperation("根据id查询用户接口")
    @GetMapping("{id}")
    public UserVO queryUserById(@ApiParam("用户id") @PathVariable("id") Long id) {
        //1. 查询用户PO
        User user = userService.getById(id);
        //2. 把PO拷贝到VO
        return BeanUtil.copyProperties(user, UserVO.class);
    }

    @ApiOperation("根据id批量查询")
    @GetMapping
    public List&lt;UserVO&gt; queryUserById(@ApiParam("用户id集合") @RequestParam("ids") List&lt;Long&gt; ids) {
        //1. 查询用户PO
        List&lt;User&gt; users = userService.listByIds(ids);
        //2. 把PO拷贝到VO
        return BeanUtil.copyToList(users, UserVO.class);
    }

    @ApiOperation("扣减用户余额接口")
    @PutMapping("/{id}/deduction/{money}")
    public void deductionMoneyById(
            @ApiParam("用户id") @PathVariable("id") Long id,
            @ApiParam("扣减的金额") @PathVariable("money") Integer money) {
        userService.deductBalance(id,money);
    }


}
</code></pre> 
<hr> 
<p></p> 
<h2 id="Service%E6%8E%A5%E5%8F%A3"><strong>Service接口</strong></h2> 
<pre><code class="language-java">package com.itheima.mp.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.itheima.mp.domain.po.User;
import org.springframework.stereotype.Service;

public interface UserService extends IService&lt;User&gt; {
    void deductBalance(Long id, Integer money);
}
</code></pre> 
<hr> 
<p></p> 
<h2 id="Service%E6%8E%A5%E5%8F%A3%E5%AE%9E%E7%8E%B0%E7%B1%BB"><strong>Service接口实现类</strong></h2> 
<pre><code class="language-java">package com.itheima.mp.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.itheima.mp.domain.po.User;
import com.itheima.mp.mapper.UserMapper;
import com.itheima.mp.service.UserService;
import org.springframework.stereotype.Service;

@Service
public class UserServiceImpl extends ServiceImpl&lt;UserMapper, User&gt; implements UserService {

    @Override
    public void deductBalance(Long id, Integer money) {
        //1. 查询用户
        User user = getById(id);
        //2. 校验用户状态
        if (user == null || user.getStatus() == 2) {
            throw new RuntimeException("用户状态异常！");
        }
        //3. 校验余额是否充足
        if (user.getBalance() &lt;= money) {
            throw new RuntimeException("用户余额不足！");
        }
        //4. 扣减余额
        baseMapper.deductBalance(id, money);
    }
}
</code></pre> 
<hr> 
<p></p> 
<h2 id="Mapper%E5%B1%82"><strong>Mapper层</strong></h2> 
<pre><code class="language-java">package com.itheima.mp.mapper;

import com.baomidou.mybatisplus.core.conditions.query.LambdaQueryWrapper;
import com.baomidou.mybatisplus.core.mapper.BaseMapper;
import com.itheima.mp.domain.po.User;
import org.apache.ibatis.annotations.Mapper;
import org.apache.ibatis.annotations.Param;
import org.apache.ibatis.annotations.Update;

@Mapper
//&lt;&gt;中放置你需要CRUD的实体类型
public interface UserMapper extends BaseMapper&lt;User&gt; {

    @Update("UPDATE tb_user SET balance = balance - #{money} WHERE id = #{id}")
    void deductBalance(@Param("id") Long id, @Param("money") Integer money);

}
</code></pre> 
<hr> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f15ee4e8b550f14d5baae72ebeebaf1f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux第3步_安装Ubuntu操作系统</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e6cffeddfff127a1588cfcab446e93da/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">CSS免费在线字体格式转换器 CSS @font-face 生成器</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>