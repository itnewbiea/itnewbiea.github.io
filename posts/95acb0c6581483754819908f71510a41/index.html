<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>链路聚合 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="链路聚合" />
<meta property="og:description" content="文章目录 一.链路聚合介绍二 .工作模式bond 网络利用 nmcli 命令管理 bond Team : 一.链路聚合介绍 以太网链路聚合简称链路聚合，它通过将多条以太网物理链路捆绑在一起成为一条逻辑链路，从而实现增加链路带宽的目的。同时，这些捆绑在一起的链路通过相互间的动态备份，可以有效的提高链路的可靠性。
链路聚合的功能：
1.增加了带宽–将多个链路的容量组合到一个逻辑链路中。2.自动故障转移/故障修复–将来自故障链路的通信转移到聚合中的工作链路。3.负载均衡–传入和外发通信都是根据用户选择的负载均衡策略（如源和目标）
链路聚合指将多个物理端口汇聚在一起，形成一个逻辑端口，以实现出/入流量吞吐量在各成员端口的负荷分担，交换机根据用户配置的端口负荷分担策略决定网络封包从哪个成员端口发送到对端的交换机。
在linux中，链路聚合有bind和team两种方式。
bind
要实现分担访问压力需要至少两块网卡，一个用来备用，当主网卡损坏时，备用网卡开始工作，也就是选择active-backup模式。
使用cat /proc/net/bonding/bond0 查看接口状态信息 ifconfig eth0 down 模拟工作的网卡损坏
二 .工作模式 1.roundrobin平衡轮询模式
两块网卡轮流接收数据包。由于两块网卡都是正常工作，它能提供两倍的带宽，在这种情况下，出现一块网卡失效，仅仅会是服务器出口带宽下降，不会影响网络使用。
2.activebackup主动备份模式
只有主网卡eth0工作，eth1作为备份网卡是不工作的，只有当一个网络接口失效时，为了不会出现网络中断，系统会按照配置指定的网卡顺序启动工作，保证机器仍能对外服务，起到了失效保护的功能。
3.broadcast广播容错模式
所有数据包都通过接口广播。
bond 网络 Red Hat Enterprise Linux 允许管理员使用 bonding 内核模块和称为通道绑定接口的特殊网络接口将多个网络接口绑定到一个通道。根据选择的绑定模式 , 通道绑定使两个或更多个网络接口作为一个网络接口 , 从而增加带宽和 / 提供冗余性
bond最少添加2块网卡。
选择 Linux 以太网绑定模式
模式 0 ( 平衡轮循(轮叫机制) ) - 轮循策略 , 所有接口都使用采用轮循方式，在所有 Slave 中传输封包 ; 任何 Slave 都可以接收
模式 1 ( 主动备份 ) - 容错。一次只能使用一个 Slave 接口, 但是如果该接口出现故障 , 另一个 Slave 将 接替它" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/95acb0c6581483754819908f71510a41/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-05-16T18:45:13+08:00" />
<meta property="article:modified_time" content="2019-05-16T18:45:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">链路聚合</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">一.链路聚合介绍</a></li><li><a href="#__15" rel="nofollow">二 .工作模式</a></li><li><ul><li><a href="#bond__23" rel="nofollow">bond 网络</a></li><li><ul><li><a href="#_nmcli__bond_37" rel="nofollow">利用 nmcli 命令管理 bond</a></li></ul> 
   </li><li><a href="#Team___74" rel="nofollow">Team :</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>一.链路聚合介绍</h2> 
<p>以太网链路聚合简称链路聚合，它通过将多条以太网物理链路捆绑在一起成为一条逻辑链路，从而实现增加链路带宽的目的。同时，这些捆绑在一起的链路通过相互间的动态备份，可以有效的提高链路的可靠性。<br> <strong>链路聚合的功能：</strong></p> 
<ul><li>1.增加了带宽–将多个链路的容量组合到一个逻辑链路中。</li><li>2.自动故障转移/故障修复–将来自故障链路的通信转移到聚合中的工作链路。</li><li>3.负载均衡–传入和外发通信都是根据用户选择的负载均衡策略（如源和目标）<br> 链路聚合指将多个物理端口汇聚在一起，形成一个逻辑端口，以实现出/入流量吞吐量在各成员端口的负荷分担，交换机根据用户配置的端口负荷分担策略决定网络封包从哪个成员端口发送到对端的交换机。<br> 在linux中，链路聚合有<strong>bind</strong>和<strong>team</strong>两种方式。<br> <strong>bind</strong><br> 要实现分担访问压力需要至少两块网卡，一个用来备用，当主网卡损坏时，备用网卡开始工作，也就是选择active-backup模式。<br> 使用cat /proc/net/bonding/bond0 查看接口状态信息</li></ul> 
<p>ifconfig eth0 down 模拟工作的网卡损坏</p> 
<h2><a id="__15"></a>二 .工作模式</h2> 
<p>1.roundrobin平衡轮询模式<br> 两块网卡轮流接收数据包。由于两块网卡都是正常工作，它能提供两倍的带宽，在这种情况下，出现一块网卡失效，仅仅会是服务器出口带宽下降，不会影响网络使用。<br> 2.activebackup主动备份模式<br> 只有主网卡eth0工作，eth1作为备份网卡是不工作的，只有当一个网络接口失效时，为了不会出现网络中断，系统会按照配置指定的网卡顺序启动工作，保证机器仍能对外服务，起到了失效保护的功能。<br> 3.broadcast广播容错模式<br> 所有数据包都通过接口广播。</p> 
<h3><a id="bond__23"></a>bond 网络</h3> 
<p>Red Hat Enterprise Linux 允许管理员使用 bonding 内核模块和称为通道绑定接口的特殊网络接口将多个网络接口绑定到一个通道。根据选择的绑定模式 , 通道绑定使两个或更多个网络接口作为一个网络接口 , 从而增加带宽和 / 提供冗余性</p> 
<p>bond最少添加2块网卡。</p> 
<p>选择 Linux 以太网绑定模式</p> 
<p>模式 0 ( 平衡轮循(轮叫机制) ) - 轮循策略 , 所有接口都使用采用轮循方式，在所有 Slave 中传输封包 ; 任何 Slave 都可以接收<br> 模式 1 ( 主动备份 ) - 容错。一次只能使用一个 Slave 接口, 但是如果该接口出现故障 , 另一个 Slave 将 接替它<br> 模式3 ( 广播 ) - 容错。所有封包都通过所有 Slave 接口广播</p> 
<p>链路聚合作用：主动备份模式 一次只能只能使用一个接口，如果接口故障，另一个会接替它</p> 
<h4><a id="_nmcli__bond_37"></a>利用 nmcli 命令管理 bond</h4> 
<p>双网卡的网络配置</p> 
<pre><code>watch -n 1 cat /proc/net/bonding/bond0       ##监控网络bond0
ping 172.25.254.61
nmcli connection add type bond con-name bond0 ifname bond0 mode active-backup ip4 172.25.254.140/24
添加一个bond，工作方式为主备，还可以设置轮循，balance-rr。名称为bond0。
</code></pre> 
<p><img src="https://images2.imgbox.com/38/7d/QqiF7GbC_o.png" alt="在这里插入图片描述"></p> 
<p>这是因为没有网卡,所以连接不上</p> 
<pre><code> nmcli connection add con-name eth0 ifname eth0 type bond-slave master bond0
将eth0网卡添加到这个bond中。
  nmcli connection add con-name eth1 ifname eth1 type bond-slave master bond0
将eth1网卡添加到这个bond中。 
</code></pre> 
<p><img src="https://images2.imgbox.com/06/76/g3SBbijV_o.png" alt="在这里插入图片描述"><br> 可以连接了</p> 
<pre><code>ifconfig eth0 down
 取消一个网卡eth0。 模拟网卡损坏 
</code></pre> 
<p><img src="https://images2.imgbox.com/6c/5a/zz0fXpE1_o.png" alt="在这里插入图片描述"></p> 
<p>使eth1关闭,eth0开启<br> <img src="https://images2.imgbox.com/9d/8e/FOU2x3F0_o.png" alt="在这里插入图片描述"><br> 即使中途更换网卡,也不会影响网络的连接。</p> 
<p>Team 网络</p> 
<pre><code>Team也是链路聚合的一种方式
最多支持 8块网卡
和 bond0 功能类似，不需要手动加载相应内核模块有更强的拓展性
与bond都是更改完永久生效的
</code></pre> 
<h3><a id="Team___74"></a>Team :</h3> 
<ul><li>broadcast 广播容错</li><li>roundrobin 平衡轮询</li><li>activebackup 主备</li><li>loadbalance 负载均衡</li></ul> 
<p>通过 nmcli 设定 team，以主备方式设定<br> <img src="https://images2.imgbox.com/36/97/NnkCx1g0_o.png" alt="在这里插入图片描述"></p> 
<pre><code>watch -n 1 teamdctl team0 stat      监控team状态
同时 ping 172.25.254.61
</code></pre> 
<p><img src="https://images2.imgbox.com/57/65/dXSQsoMM_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/ee/12/CaMDbkup_o.png" alt="在这里插入图片描述"></p> 
<p>nmcli connection add type team con-name team0 ifname team0 config ‘{“runner”: {“name”:“loadbalance”}}’<br> 建立一个team，模式为activebackup。<br> <font color="red">注意： 最后 '{“runner”:{“name”:“activebackup”}'的写法，单双引号的区别</font></p> 
<pre><code>nmcli connection add type team-slave ifname eth0 con-name eth0 master team0
</code></pre> 
<p>在team中添加网卡eth0连接。</p> 
<pre><code>teamdctl state team0  查看team0的状态
nmcli connection add type team-slave ifname eth1 con-name eth1 master team0 
</code></pre> 
<p><img src="https://images2.imgbox.com/7d/03/K26NHTkM_o.png" alt="在这里插入图片描述"></p> 
<pre><code>ifconfig eth0 down 将eth0暂时关闭
</code></pre> 
<p>网络连接没有受到任何影响</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/81d62814e24e2b80d03fa28c0fe772c7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">DDNS动态域名解析</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8ff26e73c20ad6ecb124b6f45bacda0a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Rtidyverse包安装报错/lib64/libstdc&#43;&#43;.so.6: version `CXXABI_1.3.9&#39;</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>