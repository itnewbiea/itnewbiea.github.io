<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Nginx基础 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Nginx基础" />
<meta property="og:description" content="Nginx基础 前言一、Nginx应用场景二、使用docker安装Nginx1.搜索Niginx镜像2.拉取Nginx镜像3.创建容器，设置端口映射、目录映射4.使用docker启动 二、静态网站部署1.静态网站的部署2.配置虚拟主机2.1端口绑定2.2域名绑定 三、反向代理和负载均衡1.反向代理配置反向代理 2.负载均衡配置负载均衡 前言 Nginx是一款高性能的http服务器/反向代理服务器及电子邮件代理服务器。由俄罗斯的程序设计师伊⼽尔·⻄索夫（Igor Sysoev）所开发，官方测试nginx能够支撑5万并发链接，并且cpu、内存等资源消耗却非常低，运行非常稳定
一、Nginx应用场景 http服务器。Nginx是一个http服务，可以独立提供http服务。可以做网页静态服务器虚拟主机。可以实现在一台服务器虚拟出多个网站。例如个人网站使用的虚拟主机反向代理，负载均衡。当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群，可以使用nginx做反向代理。并且多台服务器可以平均分担负载，不会因为某台服务器负载高宕机而某台服务器闲置的情况 二、使用docker安装Nginx 1.搜索Niginx镜像 docker search nginx 2.拉取Nginx镜像 docker pull nginx 3.创建容器，设置端口映射、目录映射 mkdir ~/nginx	#创建nginx的目录，用于存储nginx数据信息 cd ~/nginx mkdir conf vim nginx.conf nginx.conf 内容
user nginx; worker_processes 1; error_log /var/log/nginx/error.log warn; pid /var/run/nginx.pid; events { worker_connections 1024; } http { include /etc/nginx/mime.types; default_type application/octet-stream; log_format main &#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39; &#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39; &#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;; access_log /var/log/nginx/access.log main; sendfile on; #tcp_nopush on; keepalive_timeout 65; #gzip on; include /etc/nginx/conf." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9d590812f81d3e88deb4a3c0699da23a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-16T19:47:54+08:00" />
<meta property="article:modified_time" content="2022-03-16T19:47:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Nginx基础</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Nginx基础</h4> 
 <ul><li><a href="#_5" rel="nofollow">前言</a></li><li><a href="#Nginx_8" rel="nofollow">一、Nginx应用场景</a></li><li><a href="#dockerNginx_12" rel="nofollow">二、使用docker安装Nginx</a></li><li><ul><li><a href="#1Niginx_13" rel="nofollow">1.搜索Niginx镜像</a></li><li><a href="#2Nginx_20" rel="nofollow">2.拉取Nginx镜像</a></li><li><a href="#3_24" rel="nofollow">3.创建容器，设置端口映射、目录映射</a></li><li><a href="#4docker_71" rel="nofollow">4.使用docker启动</a></li></ul> 
  </li><li><a href="#_83" rel="nofollow">二、静态网站部署</a></li><li><ul><li><a href="#1_84" rel="nofollow">1.静态网站的部署</a></li><li><a href="#2_86" rel="nofollow">2.配置虚拟主机</a></li><li><ul><li><a href="#21_88" rel="nofollow">2.1端口绑定</a></li><li><a href="#22_126" rel="nofollow">2.2域名绑定</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_162" rel="nofollow">三、反向代理和负载均衡</a></li><li><ul><li><a href="#1_163" rel="nofollow">1.反向代理</a></li><li><ul><li><a href="#_172" rel="nofollow">配置反向代理</a></li></ul> 
   </li><li><a href="#2_186" rel="nofollow">2.负载均衡</a></li><li><ul><li><a href="#_191" rel="nofollow">配置负载均衡</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_5"></a>前言</h2> 
<p>Nginx是一款高性能的http服务器/反向代理服务器及电子邮件代理服务器。由俄罗斯的程序设计师伊⼽尔·⻄索夫（Igor Sysoev）所开发，官方测试nginx能够支撑5万并发链接，并且cpu、内存等资源消耗却非常低，运行非常稳定</p> 
<h2><a id="Nginx_8"></a>一、Nginx应用场景</h2> 
<ol><li>http服务器。Nginx是一个http服务，可以独立提供http服务。可以做网页静态服务器</li><li>虚拟主机。可以实现在一台服务器虚拟出多个网站。例如个人网站使用的虚拟主机</li><li>反向代理，负载均衡。当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群，可以使用nginx做反向代理。并且多台服务器可以平均分担负载，不会因为某台服务器负载高宕机而某台服务器闲置的情况</li></ol> 
<h2><a id="dockerNginx_12"></a>二、使用docker安装Nginx</h2> 
<h3><a id="1Niginx_13"></a>1.搜索Niginx镜像</h3> 
<pre><code>docker search nginx
</code></pre> 
<h3><a id="2Nginx_20"></a>2.拉取Nginx镜像</h3> 
<pre><code>docker pull nginx
</code></pre> 
<h3><a id="3_24"></a>3.创建容器，设置端口映射、目录映射</h3> 
<pre><code>mkdir ~/nginx	#创建nginx的目录，用于存储nginx数据信息
cd ~/nginx 
mkdir conf 
vim nginx.conf
</code></pre> 
<p>nginx.conf 内容</p> 
<pre><code class="prism language-conf">user nginx;
worker_processes 1;
error_log /var/log/nginx/error.log warn;
pid /var/run/nginx.pid;
events {
 worker_connections 1024;
}
http {
 include /etc/nginx/mime.types;
 default_type application/octet-stream;
 log_format main '$remote_addr - $remote_user [$time_local] "$request" '
 '$status $body_bytes_sent "$http_referer" '
 '"$http_user_agent" "$http_x_forwarded_for"';
 access_log /var/log/nginx/access.log main;
 sendfile on;
 #tcp_nopush on;
 keepalive_timeout 65;
 #gzip on;
 include /etc/nginx/conf.d/*.conf;
}
</code></pre> 
<pre><code>vim ~/nginx/conf.d/80.conf
</code></pre> 
<pre><code>server {
 	listen 80; # 监听的端⼝
 	server_name localhost; # 域名或ip
 	location / { # 访问路径配置
 		root /usr/share/nginx/html;# 根⽬录
 		index index.html index.htm; # 默认⾸⻚
 	}
	error_page 500 502 503 504 /50x.html; # 错误⻚⾯
 	location = /50x.html {
 	root html;
 }
}
</code></pre> 
<h3><a id="4docker_71"></a>4.使用docker启动</h3> 
<pre><code>docker run -id --name=c_nginx -p 80:80 -p 81:81 -p 82:82 \
-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf \
-v $PWD/conf.d:/etc/nginx/conf.d \
-v $PWD/logs:/var/log/nginx \
-v $PWD/html:/usr/share/nginx/html nginx
</code></pre> 
<p>参数说明：</p> 
<ul><li>-p 80:80 将容器的80端口映射到宿主机的80端口</li><li>-v $PWD/conf/nginx.conf:/etc/nginx/nginx.conf 将主机当前目录下的conf/nginx.conf挂载到容器/etc/nginx/nginx.conf中（配置目录）</li><li>-v $PWD/logs:/var/log/nginx 将主机当前⽬录下的 logs ⽬录挂载到容器的/var/log/nginx（⽇志⽬录）</li></ul> 
<h2><a id="_83"></a>二、静态网站部署</h2> 
<h3><a id="1_84"></a>1.静态网站的部署</h3> 
<p>在~/nginx/html目录下新建index.html，即可在浏览器访问</p> 
<h3><a id="2_86"></a>2.配置虚拟主机</h3> 
<p>虚拟主机，也叫”网站空间“，就是把一台运行在互联网上的物理服务器划分成多个”虚拟“服务器。虚拟主机技术极大的促进了网络技术的应用和普及。同时虚拟主机的租用服务也称了网络时代的一种新型经济形式。</p> 
<h4><a id="21_88"></a>2.1端口绑定</h4> 
<ol><li>新建目录</li></ol> 
<pre><code>mkdir index
mkdir regist
</code></pre> 
<p>向这两个目录添加index.html<br> 2. 添加Nginx的配置文件</p> 
<pre><code>server {
	 listen 81; # 监听的端⼝
	 server_name localhost; # 域名或ip
	 location / { # 访问路径配置
		 root /usr/share/nginx/index;# 根⽬录
		 index index.html index.htm; # 默认⾸⻚
 	}
 	error_page 500 502 503 504 /50x.html; # 错误⻚⾯
 	location = /50x.html {
		root html;
	}
 }
 server {
	 listen 82; # 监听的端⼝
	 server_name localhost; # 域名或ip
	 location / { # 访问路径配置
		 root /usr/share/nginx/regist;# 根⽬录
		 index regist.html; # 默认⾸⻚
	 }
	 error_page 500 502 503 504 /50x.html; # 错误⻚⾯
	 location = /50x.html {
		 root html;
	 }
 }

</code></pre> 
<ol start="3"><li>访问测试<br> http:ip:81 首页<br> http:ip:82 注册页面</li></ol> 
<h4><a id="22_126"></a>2.2域名绑定</h4> 
<p>域名：是由一串用点分隔的名字组成的Internet上某一台计算机或计算机组的名称，用于在数据传输时对计算机的定位标识</p> 
<ol><li>域名与IP绑定<br> ⼀个域名对应⼀个 ip 地址，⼀个 ip 地址可以被多个域名绑定。<br> 本地测试可以修改 hosts ⽂件（C:\Windows\System32\drivers\etc）<br> 可以配置域名和 ip 的映射关系，如果 hosts ⽂件中配置了域名和 ip 的对应关系，不需要⾛dns 服务<br> 器。<br> 虚拟机ip www.dmlll.com<br> 虚拟机ip regist.dmlll.com</li><li>做好域名指向后，创建nginx配置⽂件 domain.conf</li></ol> 
<pre><code>server {
	 listen 80;
	 server_name www.dmlll.com;
	 location / {
		 root /usr/share/nginx/cart;
		 index cart.html;
	 }
 }
 server {
	 listen 80;
	 server_name regist.dmlll.com;
	 location / {
		 root /usr/share/nginx/search;
		 index search.html;
	 }
 }
</code></pre> 
<ol start="3"><li>创建目录及访问文件</li></ol> 
<pre><code>mkdir ~/nginx/cart
mkdir ~/nginx/search
</code></pre> 
<ol start="4"><li>使用域名访问<br> www.dmlll.com<br> regist.dmlll.com</li></ol> 
<h2><a id="_162"></a>三、反向代理和负载均衡</h2> 
<h3><a id="1_163"></a>1.反向代理</h3> 
<p>反向代理（Reverse Proxy）⽅式是指以代理服务器来接受internet上的连接请求，然后将请求转发给内<br> 部⽹络上的服务器，并将从服务器上得到的结果返回给internet上请求连接的客户端，此时代理服务器<br> 对外就表现为⼀个反向代理服务器。</p> 
<p>正向代理如图：<br> <img src="https://images2.imgbox.com/64/42/wPg3V9Nc_o.png" alt="在这里插入图片描述"><br> 反向代理如图：<br> <img src="https://images2.imgbox.com/57/f8/QTMRBzxO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_172"></a>配置反向代理</h4> 
<ol><li>拉取tomcat</li></ol> 
<pre><code>docker search tomcat
docker pull tomcat
</code></pre> 
<ol start="2"><li>创建容器，设置端口映射、目录映射</li></ol> 
<pre><code>mkdir ~/tomcat
cd ~/tomcat
docker run -id --name=c_tomcat -p 8080:8080 -v $PWD:/usr/local/tomcat/webapps tomcat
</code></pre> 
<ol start="3"><li>访问<br> 虚拟机ip:8080</li></ol> 
<h3><a id="2_186"></a>2.负载均衡</h3> 
<p>负载均衡 建⽴在现有⽹络结构之上，它提供了⼀种廉价有效透明的⽅法扩展⽹络设备和服务器的带宽、<br> 增加吞吐量、加强⽹络数据处理能⼒、提⾼⽹络的灵活性和可⽤性。<br> 负载均衡，英⽂名称为Load Balance，其意思就是分摊到多个操作单元上进⾏执⾏，例如Web服务器、<br> FTP服务器、企业关键应⽤服务器和其它关键任务服务器等，从⽽共同完成⼯作任务。</p> 
<h4><a id="_191"></a>配置负载均衡</h4> 
<ol><li>创建多个tomcat</li></ol> 
<pre><code>cp ~/tomcat ~/tomcat1
cp ~/tomcat ~/tomcat2
cd tomcat1
docker run -id --name=c_tomcat1 -p 8081:8080 -v $PWD:/usr/local/tomcat/webapps tomcat
docker run -id --name=c_tomcat2 -p 8082:8080 -v $PWD:/usr/local/tomcat/webapps tomcat
</code></pre> 
<ol start="2"><li>配置负载均衡<br> 添加Nginx配置文件 lb.conf</li></ol> 
<pre><code> upstream tomcat-dm {
	 server ip:8080;
	 server ip:8081;
	 server ip:8082;
 }
 server {
	 listen 80; # 监听的端⼝
	 server_name www.dm.com; # 域名或ip
	 location / { # 访问路径配置
		 # root index;# 根⽬录
		 proxy_pass http://tomcat-dm;
		 index index.html index.htm; # 默认⾸⻚
	 }
	 error_page 500 502 503 504 /50x.html; # 错误⻚⾯
	 location = /50x.html {
		 root html;
	 }
 }
</code></pre> 
<ol start="3"><li>配置hosts<br> ip www.dm.com<br> 地址栏输⼊http:// www.dm.com / 刷新观察每个⽹⻚的标题，看是否不同。<br> 经过测试，三台服务器出现的概率各为33.3333333%，交替显示。<br> 如果其中⼀台服务器性能⽐较好，想让其承担更多的压⼒，可以设置权重。</li></ol> 
<pre><code>upstream tomcat-travel {
	 server 192.168.177.129:8080;
	 server 192.168.177.129:8081 weight=2;
	 server 192.168.177.129:8082;
 }
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/4fdfc1503814181474332bc9dcce987a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SpringBoot详解（1）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cbac295f07f23fec184711f1077ea85d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Linux 图形栈一览：基于 DRM 和 Wayland</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>