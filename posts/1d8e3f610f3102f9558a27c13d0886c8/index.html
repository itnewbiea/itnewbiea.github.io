<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android P/Q中PackageManagerService添加接口方法 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android P/Q中PackageManagerService添加接口方法" />
<meta property="og:description" content="低版本android系统PackageManagerService添加方法的文章：
为Android中PackageManagerService添加方法_散落一地的蓝的博客-CSDN博客
谷歌对于所有的类和API，分为开方和非开放两种，而开放的类和API，可以通过“Javadoc标签”与源码同步生成“程序的开发文档”；当我们修改或者添加一个新的API时，我们有两种方案可以避免出现上述错误.
其一是将该接口加上 非公开的标签：/*{@hide}/；
再者可以在修改后执行：make update-api(公开)，将修改内容与API的doc文件更新到一致。
对于android P和android Q，除像低版本那样修改aidl以及java等文件的代码外，还需要将添加的接口方法在下面的文件中进行声明：
android P：
aosp/prebuilts/sdk/api/28.txt
diff --git a/sdk/api/28.txt b/sdk/api/28.txt index 26e4298..e3afc34 100644 --- a/sdk/api/28.txt &#43;&#43;&#43; b/sdk/api/28.txt @@ -11192,6 &#43;11192,7 @@ package android.content.pm { method public abstract android.content.pm.PackageInfo getPackageInfo(java.lang.String, int) throws android.content.pm.PackageManager.NameNotFoundException; method public abstract android.content.pm.PackageInfo getPackageInfo(android.content.pm.VersionedPackage, int) throws android.content.pm.PackageManager.NameNotFoundException; method public abstract android.content.pm.PackageInstaller getPackageInstaller(); &#43; method public abstract int setName(java.lang.String); method public abstract int getPackageUid(java.lang.String, int) throws android.content.pm.PackageManager.NameNotFoundException; method public abstract java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1d8e3f610f3102f9558a27c13d0886c8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-15T18:07:51+08:00" />
<meta property="article:modified_time" content="2022-07-15T18:07:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android P/Q中PackageManagerService添加接口方法</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>低版本android系统PackageManagerService添加方法的文章：</p> 
<p><a href="https://blog.csdn.net/zqz19891031/article/details/43306045" title="为Android中PackageManagerService添加方法_散落一地的蓝的博客-CSDN博客">为Android中PackageManagerService添加方法_散落一地的蓝的博客-CSDN博客</a></p> 
<p>谷歌对于所有的类和API，分为开方和非开放两种，而开放的类和API，可以通过“Javadoc标签”与源码同步生成“程序的开发文档”；当我们修改或者添加一个新的API时，我们有两种方案可以避免出现上述错误.</p> 
<p>其一是将该接口加上 非公开的标签：/*{@hide}/；</p> 
<p>再者可以在修改后执行：make update-api(公开)，将修改内容与API的doc文件更新到一致。</p> 
<p></p> 
<p>对于android P和android Q，除像低版本那样修改aidl以及java等文件的代码外，还需要将添加的接口方法在下面的文件中进行声明：</p> 
<p>android P：</p> 
<p>aosp/prebuilts/sdk/api/28.txt</p> 
<pre><code class="language-diff">diff --git a/sdk/api/28.txt b/sdk/api/28.txt
index 26e4298..e3afc34 100644
--- a/sdk/api/28.txt
+++ b/sdk/api/28.txt
@@ -11192,6 +11192,7 @@ package android.content.pm {
     method public abstract android.content.pm.PackageInfo getPackageInfo(java.lang.String, int) throws android.content.pm.PackageManager.NameNotFoundException;
     method public abstract android.content.pm.PackageInfo getPackageInfo(android.content.pm.VersionedPackage, int) throws android.content.pm.PackageManager.NameNotFoundException;
     method public abstract android.content.pm.PackageInstaller getPackageInstaller();
+    method public abstract int setName(java.lang.String);
     method public abstract int getPackageUid(java.lang.String, int) throws android.content.pm.PackageManager.NameNotFoundException;
     method public abstract java.lang.String[] getPackagesForUid(int);
     method public abstract java.util.List&lt;android.content.pm.PackageInfo&gt; getPackagesHoldingPermissions(java.lang.String[], int);</code></pre> 
<p>aosp/frameworks/base/api/current.txt</p> 
<pre><code class="language-diff">diff --git a/base/api/current.txt b/base/api/current.txt
index e2289cc..32b4828 100644
--- a/base/api/current.txt
+++ b/base/api/current.txt
@@ -11252,6 +11252,7 @@ package android.content.pm {
     method public abstract android.content.pm.ResolveInfo resolveActivity(android.content.Intent, int);
     method public abstract android.content.pm.ProviderInfo resolveContentProvider(java.lang.String, int);
     method public abstract android.content.pm.ResolveInfo resolveService(android.content.Intent, int);
+    method public abstract int setName(java.lang.String);
     method public abstract void setApplicationCategoryHint(java.lang.String, int);
     method public abstract void setApplicationEnabledSetting(java.lang.String, int, int);
     method public abstract void setComponentEnabledSetting(android.content.ComponentName, int, int);</code></pre> 
<p>aosp/frameworks/base/test-mock/api/android-test-mock-current.txt</p> 
<pre><code class="language-diff">diff --git a/base/test-mock/api/android-test-mock-current.txt b/base/test-mock/api/android-test-mock-current.txt
index f3b253c..3d056ea 100644
--- a/base/test-mock/api/android-test-mock-current.txt
+++ b/base/test-mock/api/android-test-mock-current.txt
@@ -279,6 +279,7 @@ package android.test.mock {
     method public android.content.pm.ProviderInfo resolveContentProvider(java.lang.String, int);
     method public android.content.pm.ResolveInfo resolveService(android.content.Intent, int);
     method public android.content.pm.ResolveInfo resolveServiceAsUser(android.content.Intent, int, int);
+    method public int setName(java.lang.String);
     method public void setApplicationCategoryHint(java.lang.String, int);
     method public void setApplicationEnabledSetting(java.lang.String, int, int);
     method public void setComponentEnabledSetting(android.content.ComponentName, int, int);</code></pre> 
<p>current.txt和android-test-mock-current.txt在修改完prebuilts下的代码后make update-api的时候好像可以自动生成。</p> 
<p></p> 
<p>android Q：</p> 
<p>aosp/prebuilts/sdk/29/public/api/android.txt</p> 
<pre><code class="language-diff">diff --git a/sdk/29/public/api/android.txt b/sdk/29/public/api/android.txt
index cd78602..178f87b 100644
--- a/sdk/29/public/api/android.txt
+++ b/sdk/29/public/api/android.txt
@@ -11648,6 +11648,7 @@ package android.content.pm {
     method @Nullable public abstract android.content.pm.ResolveInfo resolveActivity(@NonNull android.content.Intent, int);
     method @Nullable public abstract android.content.pm.ProviderInfo resolveContentProvider(@NonNull String, int);
     method @Nullable public abstract android.content.pm.ResolveInfo resolveService(@NonNull android.content.Intent, int);
+    method public abstract int setName(String);
     method public abstract void setApplicationCategoryHint(@NonNull String, int);
     method @RequiresPermission(value=android.Manifest.permission.CHANGE_COMPONENT_ENABLED_STATE, conditional=true) public abstract void setApplicationEnabledSetting(@NonNull String, int, int);
     method @RequiresPermission(value=android.Manifest.permission.CHANGE_COMPONENT_ENABLED_STATE, conditional=true) public abstract void setComponentEnabledSetting(@NonNull android.content.ComponentName, int, int);</code></pre> 
<p>aosp/frameworks/base/api/current.txt</p> 
<pre><code class="language-diff">diff --git a/base/api/current.txt b/base/api/current.txt
index ba17486..e3b65fb 100644
--- a/base/api/current.txt
+++ b/base/api/current.txt
@@ -11651,6 +11651,7 @@ package android.content.pm {
     method @Nullable public abstract android.content.pm.ResolveInfo resolveActivity(@NonNull android.content.Intent, int);
     method @Nullable public abstract android.content.pm.ProviderInfo resolveContentProvider(@NonNull String, int);
     method @Nullable public abstract android.content.pm.ResolveInfo resolveService(@NonNull android.content.Intent, int);
+    method public abstract int setName(String);
     method public abstract void setApplicationCategoryHint(@NonNull String, int);
     method @RequiresPermission(value=android.Manifest.permission.CHANGE_COMPONENT_ENABLED_STATE, conditional=true) public abstract void setApplicationEnabledSetting(@NonNull String, int, int);
     method @RequiresPermission(value=android.Manifest.permission.CHANGE_COMPONENT_ENABLED_STATE, conditional=true) public abstract void setComponentEnabledSetting(@NonNull android.content.ComponentName, int, int);</code></pre> 
<p>另外需要注意的是，高版本中继承抽象类PackageManager的除了MockPackageManager.java和ApplicationPackageManager.java之外还有其他几个类，都找出来把抽象方法实现下就可以了。</p> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bb2683d5397c4cef1a993bda7d95bd83/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">postman实现压力测试</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1c03b9fbbfab94d69ef65b30a92aadae/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">图片和数据懒加载</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>