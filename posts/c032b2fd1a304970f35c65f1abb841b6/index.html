<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【高并发】高并发环境下优化Tomcat性能 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【高并发】高并发环境下优化Tomcat性能" />
<meta property="og:description" content="【摘要】 并发环境下优化Tomcat性能可以提升很大的系统性能，不信你试试？
写在前面 Tomcat作为最常用的Java Web服务器，随着并发量越来越高，Tomcat的性能会急剧下降，那有没有什么方法来优化Tomcat在高并发环境下的性能呢？ Tomcat运行模式 Tomcat的运行模式有3种。
1.bio模式
默认的模式,性能非常低下,没有经过任何优化处理和支持。
2.nio模式
利用java的异步io护理技术,noblocking IO技术。要想运行在该模式下，则直接修改server.xml里的Connector节点,修改protocol为如下配置。
protocol=&#34;org.apache.coyote.http11.Http11NioProtocol&#34; 重启Tomcat后，就可以生效。
3.apr模式
安装起来最困难,但是从操作系统级别来解决异步的IO问题,大幅度的提高性能。此种模式下，必须要安装apr和native，直接启动就支持apr。如nio修改模式，修改protocol为org.apache.coyote.http11.Http11AprProtocol，如下所示。
protocol=&#34;org.apache.coyote.http11.Http11AprProtocol&#34; Tomcat并发优化 安装APR [root@binghe ~]# yum -y install apr apr-devel openssl-devel[root@binghe ~]# tar zxvf tomcat-native.tar.gz[root@binghe ~]# cd tomcat-native-1.1.24-src/jni/native[root@binghe native]# ./configure --with-apr=/usr/bin/apr-1-config --with-ssl=/usr/include/openssl/[root@binghe native]# make &amp;&amp; make install 安装完成之后 会出现如下提示信息
Libraries have been installed in: /usr/local/apr/lib 安装成功后还需要对tomcat设置环境变量，方法是在catalina.sh文件中增加1行：
在这段代码下面添加：
============# OS specific support. $var _must_ be set to either true or false.cygwin=false darwin=false ==============CATALINA_OPTS=”-Djava.library.path=/usr/local/apr/lib” 修改server.xml的配置，如下所示。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c032b2fd1a304970f35c65f1abb841b6/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-30T17:18:30+08:00" />
<meta property="article:modified_time" content="2023-01-30T17:18:30+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【高并发】高并发环境下优化Tomcat性能</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="text-align:null;">【摘要】 并发环境下优化Tomcat性能可以提升很大的系统性能，不信你试试？</p> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">写在前面</span></h3> 
 <hr> 
 <blockquote class="kdocs-blockquote" style="text-align:left;">
   Tomcat作为最常用的Java Web服务器，随着并发量越来越高，Tomcat的性能会急剧下降，那有没有什么方法来优化Tomcat在高并发环境下的性能呢？ 
 </blockquote> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Tomcat运行模式</span></h3> 
 <hr> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">Tomcat的运行模式有3种。</span></p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">1.bio模式</span></p> 
 <p style="text-align:null;">默认的模式,性能非常低下,没有经过任何优化处理和支持。</p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">2.nio模式</span></p> 
 <p style="text-align:null;">利用java的异步io护理技术,noblocking IO技术。要想运行在该模式下，则直接修改server.xml里的Connector节点,修改protocol为如下配置。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">protocol="org.apache.coyote.http11.Http11NioProtocol"</code></pre> 
 <p style="text-align:null;">重启Tomcat后，就可以生效。</p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">3.apr模式</span></p> 
 <p style="text-align:null;">安装起来最困难,但是从操作系统级别来解决异步的IO问题,大幅度的提高性能。此种模式下，必须要安装apr和native，直接启动就支持apr。如nio修改模式，修改protocol为org.apache.coyote.http11.Http11AprProtocol，如下所示。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">protocol="org.apache.coyote.http11.Http11AprProtocol"</code></pre> 
 <h3 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Tomcat并发优化</span></h3> 
 <hr> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">安装APR</span></h4> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">[root@binghe ~]# yum -y install apr apr-devel openssl-devel[root@binghe ~]# tar zxvf tomcat-native.tar.gz[root@binghe ~]# cd tomcat-native-1.1.24-src/jni/native[root@binghe native]# ./configure --with-apr=/usr/bin/apr-1-config --with-ssl=/usr/include/openssl/[root@binghe native]# make &amp;&amp; make install</code></pre> 
 <p style="text-align:null;">安装完成之后 会出现如下提示信息</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">Libraries have been installed in:
/usr/local/apr/lib</code></pre> 
 <p style="text-align:null;">安装成功后还需要对tomcat设置环境变量，方法是在catalina.sh文件中增加1行：</p> 
 <p style="text-align:null;">在这段代码下面添加：</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">============# OS specific support.  $var _must_ be set to either true or false.cygwin=false
darwin=false
==============CATALINA_OPTS=”-Djava.library.path=/usr/local/apr/lib”</code></pre> 
 <p style="text-align:null;">修改server.xml的配置，如下所示。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">protocol=”org.apache.coyote.http11.Http11AprProtocol”</code></pre> 
 <p style="text-align:null;">启动tomcat之后，查看日志，如下所示。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">more TOMCAT_HOME/logs/catalina.out
2020-04-17 22:34:56 org.apache.catalina.core.AprLifecycleListener init
INFO: Loaded APR based Apache Tomcat Native library 1.1.31 using APR version 1.3.9.
2020-04-17 22:34:56 org.apache.catalina.core.AprLifecycleListener init
INFO: APR capabilities: IPv6 [true], sendfile [true], accept filters [false], random [true].
2020-04-17 22:34:56 org.apache.catalina.core.AprLifecycleListener initializeSSL
INFO: OpenSSL successfully initialized (OpenSSL 1.0.1e 11 Feb 2013)2020-04-17 22:34:58 AM org.apache.coyote.AbstractProtocol init
INFO: Initializing ProtocolHandler [“http-apr-8080”]2020-04-17 22:34:58 AM org.apache.coyote.AbstractProtocol init
INFO: Initializing ProtocolHandler [“ajp-apr-8009”]2020-04-17 22:34:58 AM org.apache.catalina.startup.Catalina load
INFO: Initialization processed in1125 ms</code></pre> 
 <h4 style="text-align:left;"><span class="kdocs-bold" style="font-weight:bold;">Tomcat优化</span></h4> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">1.JVM 调优</span></p> 
 <p style="text-align:null;">在TOMCAT_HOME/bin/catalina.sh 增加如下语句，具体数值视情况而定。</p> 
 <p style="text-align:null;">添加到上面CATALINA_OPTS的后面即可，如下所示。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">JAVA_OPTS=-Xms512m -Xmx1024m -XX:PermSize=512M -XX:MaxNewSize=1024m -XX:MaxPermSize=1024m</code></pre> 
 <p style="text-align:null;">参数详解</p> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:null;"><p>-Xms：JVM初始化堆内存大小。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:null;"><p>-Xmx：JVM堆的最大内存。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:null;"><p>-Xss：线程栈大小。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:null;"><p>-XX:PermSize：JVM非堆区初始内存分配大小。</p></li></ul> 
 <ul><li style="margin-left:1.4em;list-style-type:disc;text-indent:0;text-align:null;"><p>-XX:MaxPermSize：JVM非堆区最大内存。</p></li></ul> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">建议和注意事项:</span></p> 
 <p style="text-align:null;">-Xms和-Xmx选项设置为相同堆内存分配，以避免在每次GC 后调整堆的大小，堆内存建议占内存的60%~80%；非堆内存是不可回收内存，大小视项目而定;线程栈大小推荐256k。</p> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">32G内存配置如下：</span></p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">JAVA_OPTS=-Xms20480m -Xmx20480m -Xss1024K -XX:PermSize=512m -XX:MaxPermSize=2048m</code></pre> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">2.关闭DNS反向查询</span></p> 
 <p style="text-align:null;">在&lt;Connector port=”8080″ 中加入如下参数。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">enableLookups=”false”</code></pre> 
 <p style="text-align:null;"><span class="kdocs-bold" style="font-weight:bold;">3.优化tomcat参数</span></p> 
 <p style="text-align:null;">在server.xml文件中进行如下配置。</p> 
 <pre class="kdocs-plaintext"><code class="language-plaintext">&lt;Connector port=”8080″
protocol=”org.apache.coyote.http11.Http11AprProtocol”
connectionTimeout=”20000″ //链接超时时长
redirectPort=”8443″
maxThreads=”500″//设定处理客户请求的线程的最大数目，决定了服务器可以同时响应客户请求的数,默认200
minSpareThreads=”20″//初始化线程数，最小空闲线程数，默认为10
acceptCount=”1000″ //当所有可以使用的处理请求的线程数都被使用时，可以被放到处理队列中请求数，请求数超过这个数的请求将不予处理，默认100
enableLookups=”false”
URIEncoding=”UTF-8″ /&gt;</code></pre> 
 <p style=""></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/2723672e993855706894ac69bdbe9989/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LINQ表达式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/580cb02334ec1eb9c7fd1447abc8c71a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">MyBatis中使用Mapper代理</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>