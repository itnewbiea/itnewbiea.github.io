<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>待办事项列表项目 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="待办事项列表项目" />
<meta property="og:description" content="Pyqt5相关文章:
快速掌握Pyqt5的三种主窗口
快速掌握Pyqt5的2种弹簧
快速掌握Pyqt5的5种布局
快速弄懂Pyqt5的5种项目视图（Item View）
快速弄懂Pyqt5的4种项目部件（Item Widget）
快速掌握Pyqt5的6种按钮
快速掌握Pyqt5的10种容器（Containers）
快速掌握Pyqt5的20种输入控件（Input Widgets）
快速掌握Pyqt5的9种显示控件
详细学习Pyqt5中的5种布局方式
详细学习Pyqt5中的6种按钮
详细学习Pyqt5中的2种弹簧
详细学习Pyqt5的5种项目视图（Item View）
详细学习Pyqt5的4种项目部件（Item Widget）
详细学习Pyqt5的20种输入控件（Input Widgets）
详细学习Pyqt5的9种显示控件
详细学习Pyqt5的10种容器（Containers）
详细学习PyQt5与数据库交互
详细学习PyQt5中的多线程
快速学习PyQt5的动画和图形效果
快速学习PyQt5的高级自定义控件
快速学会绘制Pyqt5中的所有图（上）
快速学会绘制Pyqt5中的所有图（下）
待续。。。
项目软件最终效果图： 第一部分：项目概述 本项目的目标是创建一个简单而直观的待办事项列表应用程序。这个应用程序可以帮助用户有效地管理他们的日常任务，提供以下关键功能：
添加任务：允许用户输入并添加新任务到待办事项列表中。删除任务：提供选项以从列表中删除不再需要的任务。编辑任务：让用户能够修改现有任务的描述。搜索和过滤：使用户能够通过关键词搜索任务，便于快速找到特定任务。进度跟踪：通过进度条展示任务完成的总体进度，帮助用户了解他们完成任务的情况。 应用程序的用户界面（UI）设计注重简洁性和易用性，以确保用户能够轻松地进行日常任务管理。界面包括：
任务输入框：用于输入新任务的文本区域。控制按钮：包括添加、删除和编辑任务的操作按钮。任务显示区：展示任务列表，每个任务项包含一个复选框和任务描述。搜索框：允许用户输入关键词以过滤任务列表。进度指示器：动态显示完成的任务占总任务的百分比。 第二部分：环境搭建 准备PyQt5图形库
打开命令提示符或终端，并运行以下命令：pip install PyQt5 这个命令会从Python包索引(PyPI)下载并安装PyQt5及其依赖项。 第三部分：基础知识讲解 1. QApplication 对象 每个PyQt5应用程序的核心是QApplication对象。这个对象负责管理GUI应用程序的控制流和主要设置。在任何PyQt5程序中，QApplication对象是必须的。
app = QApplication([]) 这段代码创建了一个QApplication实例，它是我们待办事项列表应用程序的起点。
2. QMainWindow 和 QWidget QMainWindow 是主窗口类，为应用程序提供了一个带有菜单栏、工具栏、状态栏和中心部件的框架。在我们的项目中，TodoList类继承自QMainWindow。
class TodoList(QMainWindow): def __init__(self): super().__init__() self.setWindowTitle(&#34;待办事项列表&#34;) self.setGeometry(300, 300, 600, 500) self.setWindowIcon(QIcon(&#39;icon.png&#39;)) QWidget 是所有用户界面对象的基类。在这里，我们创建了一个QWidget作为中心部件，并在其上布置其他控件。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/48431ff590f0ff69f56ec59ce1403e1c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-17T23:30:28+08:00" />
<meta property="article:modified_time" content="2023-12-17T23:30:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">待办事项列表项目</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><a href="https://blog.csdn.net/weixin_49520696/category_12485448.html"><strong>Pyqt5相关文章:</strong></a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134588834?spm=1001.2014.3001.5501">快速掌握Pyqt5的三种主窗口</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134618145">快速掌握Pyqt5的2种弹簧</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134618080">快速掌握Pyqt5的5种布局</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134626083?spm=1001.2014.3001.5501">快速弄懂Pyqt5的5种项目视图（Item View）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134626083?spm=1001.2014.3001.5501">快速弄懂Pyqt5的4种项目部件（Item Widget）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134588816?spm=1001.2014.3001.5501">快速掌握Pyqt5的6种按钮</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134642535?spm=1001.2014.3001.5501">快速掌握Pyqt5的10种容器（Containers）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134642702?spm=1001.2014.3001.5501">快速掌握Pyqt5的20种输入控件（Input Widgets）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134664286?spm=1001.2014.3001.5501">快速掌握Pyqt5的9种显示控件</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134665185">详细学习Pyqt5中的5种布局方式</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134701542?spm=1001.2014.3001.5502">详细学习Pyqt5中的6种按钮</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134701652?spm=1001.2014.3001.5502">详细学习Pyqt5中的2种弹簧</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134709486?spm=1001.2014.3001.5501">详细学习Pyqt5的5种项目视图（Item View）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134709507?spm=1001.2014.3001.5502">详细学习Pyqt5的4种项目部件（Item Widget）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134757034?spm=1001.2014.3001.5501">详细学习Pyqt5的20种输入控件（Input Widgets）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134772447?spm=1001.2014.3001.5501">详细学习Pyqt5的9种显示控件</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134772485?spm=1001.2014.3001.5502">详细学习Pyqt5的10种容器（Containers）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134745797?spm=1001.2014.3001.5502">详细学习PyQt5与数据库交互</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134757087?spm=1001.2014.3001.5501">详细学习PyQt5中的多线程</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134796686?spm=1001.2014.3001.5501">快速学习PyQt5的动画和图形效果</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134796731?spm=1001.2014.3001.5501">快速学习PyQt5的高级自定义控件</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134887162?spm=1001.2014.3001.5501">快速学会绘制Pyqt5中的所有图（上）</a><br> <a href="https://blog.csdn.net/weixin_49520696/article/details/134889482?spm=1001.2014.3001.5501">快速学会绘制Pyqt5中的所有图（下）</a><br> <a href="https://blog.csdn.net/weixin_49520696/category_12485448.html">待续。。。</a></p> 
<h3><a id="_25"></a>项目软件最终效果图：</h3> 
<p><img src="https://images2.imgbox.com/eb/f4/A9yWY1b7_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="_27"></a>第一部分：项目概述</h3> 
<p>本项目的目标是创建一个简单而直观的待办事项列表应用程序。这个应用程序可以帮助用户有效地管理他们的日常任务，提供以下关键功能：</p> 
<ol><li><strong>添加任务</strong>：允许用户输入并添加新任务到待办事项列表中。</li><li><strong>删除任务</strong>：提供选项以从列表中删除不再需要的任务。</li><li><strong>编辑任务</strong>：让用户能够修改现有任务的描述。</li><li><strong>搜索和过滤</strong>：使用户能够通过关键词搜索任务，便于快速找到特定任务。</li><li><strong>进度跟踪</strong>：通过进度条展示任务完成的总体进度，帮助用户了解他们完成任务的情况。</li></ol> 
<p>应用程序的用户界面（UI）设计注重简洁性和易用性，以确保用户能够轻松地进行日常任务管理。界面包括：</p> 
<ol><li><strong>任务输入框</strong>：用于输入新任务的文本区域。</li><li><strong>控制按钮</strong>：包括添加、删除和编辑任务的操作按钮。</li><li><strong>任务显示区</strong>：展示任务列表，每个任务项包含一个复选框和任务描述。</li><li><strong>搜索框</strong>：允许用户输入关键词以过滤任务列表。</li><li><strong>进度指示器</strong>：动态显示完成的任务占总任务的百分比。</li></ol> 
<h3><a id="_45"></a>第二部分：环境搭建</h3> 
<p>准备PyQt5图形库</p> 
<ul><li>打开命令提示符或终端，并运行以下命令：<pre><code class="prism language-bash">pip <span class="token function">install</span> PyQt5
</code></pre> </li><li>这个命令会从Python包索引(PyPI)下载并安装PyQt5及其依赖项。</li></ul> 
<h3><a id="_53"></a>第三部分：基础知识讲解</h3> 
<h5><a id="1_QApplication__55"></a>1. <code>QApplication</code> 对象</h5> 
<p>每个PyQt5应用程序的核心是<code>QApplication</code>对象。这个对象负责管理GUI应用程序的控制流和主要设置。在任何PyQt5程序中，<code>QApplication</code>对象是必须的。</p> 
<pre><code class="prism language-python">app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> 
<p>这段代码创建了一个<code>QApplication</code>实例，它是我们待办事项列表应用程序的起点。</p> 
<h5><a id="2_QMainWindow__QWidget_64"></a>2. <code>QMainWindow</code> 和 <code>QWidget</code></h5> 
<p><code>QMainWindow</code> 是主窗口类，为应用程序提供了一个带有菜单栏、工具栏、状态栏和中心部件的框架。在我们的项目中，<code>TodoList</code>类继承自<code>QMainWindow</code>。</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">TodoList</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"待办事项列表"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowIcon<span class="token punctuation">(</span>QIcon<span class="token punctuation">(</span><span class="token string">'icon.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p><code>QWidget</code> 是所有用户界面对象的基类。在这里，我们创建了一个<code>QWidget</code>作为中心部件，并在其上布置其他控件。</p> 
<pre><code class="prism language-python">central_widget <span class="token operator">=</span> QWidget<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>setCentralWidget<span class="token punctuation">(</span>central_widget<span class="token punctuation">)</span>
layout <span class="token operator">=</span> QVBoxLayout<span class="token punctuation">(</span>central_widget<span class="token punctuation">)</span>
</code></pre> 
<h5><a id="3__84"></a>3. 布局管理</h5> 
<p>布局管理器，如<code>QHBoxLayout</code>和<code>QVBoxLayout</code>，是用来在窗口中组织控件的工具。在我们的项目中，我们使用了<code>QVBoxLayout</code>来垂直排列控件，并使用了<code>QHBoxLayout</code>来水平排列按钮。</p> 
<pre><code class="prism language-python">layout <span class="token operator">=</span> QVBoxLayout<span class="token punctuation">(</span>central_widget<span class="token punctuation">)</span>
buttons_layout <span class="token operator">=</span> QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="4__92"></a>4. 控件和事件处理</h5> 
<p>在PyQt5中，控件是用户与应用程序交互的元素。我们的项目使用了多种控件，例如<code>QLineEdit</code>来输入任务，<code>QPushButton</code>来添加、删除和编辑任务。</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>task_input <span class="token operator">=</span> QLineEdit<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
add_button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"添加任务"</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
delete_button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"删除任务"</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
</code></pre> 
<p>这些按钮通过点击事件触发相应的函数，如<code>add_task</code>、<code>delete_task</code>。</p> 
<h5><a id="5___MovingTextProgressBar_103"></a>5. 自定义控件 - <code>MovingTextProgressBar</code></h5> 
<p>在PyQt5中，我们还可以自定义控件。在此项目中，我们定义了<code>MovingTextProgressBar</code>，这是<code>QProgressBar</code>的一个子类，用来显示任务的完成进度。</p> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">MovingTextProgressBar</span><span class="token punctuation">(</span>QProgressBar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
    
    <span class="token keyword">def</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># Custom painting code here</span>
</code></pre> 
<p>这个自定义进度条在进度变化时显示百分比，并根据进度动态调整文本位置。</p> 
<h5><a id="6__117"></a>6. 数据存储和加载</h5> 
<p>最后，我们的项目还涉及到数据的保存和加载。使用Python的<code>json</code>模块，我们可以将任务列表保存到一个文件，并在应用程序启动时加载这些任务。</p> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">save_tasks</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token comment"># 代码来保存任务</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'tasks.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>

<span class="token keyword">def</span> <span class="token function">load_tasks</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">try</span><span class="token punctuation">:</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'tasks.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            <span class="token comment"># 代码来加载任务</span>
    <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading tasks: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="_138"></a>第四部分：逐步构建项目</h3> 
<h4><a id="1___init___139"></a>1. 构建静态窗口方法（初始化<code>__init__</code>）详解</h4> 
<h5><a id="_140"></a>类定义和初始化</h5> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">TodoList</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>TodoList</code> 类继承自 PyQt5 的 <code>QMainWindow</code> 类，提供了一个主窗口框架。</li><li><code>__init__</code> 方法是类的构造函数，用于初始化这个窗口。</li><li><code>super().__init__()</code> 调用基类的构造函数，是创建窗口的基本步骤。</li></ul> 
<h5><a id="_150"></a>设置窗口属性</h5> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"待办事项列表"</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>setWindowIcon<span class="token punctuation">(</span>QIcon<span class="token punctuation">(</span><span class="token string">'icon.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>setWindowTitle</code> 设置窗口的标题。</li><li><code>setGeometry</code> 设置窗口的位置和大小。这里窗口被放置在屏幕的 (300, 300) 位置，大小为 600x500 像素。</li><li><code>setWindowIcon</code> 设置窗口的图标。图标文件应该是名为 ‘icon.png’ 的图像文件。</li></ul> 
<h5><a id="_160"></a>创建中心小部件和布局</h5> 
<pre><code class="prism language-python">central_widget <span class="token operator">=</span> QWidget<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>setCentralWidget<span class="token punctuation">(</span>central_widget<span class="token punctuation">)</span>
layout <span class="token operator">=</span> QVBoxLayout<span class="token punctuation">(</span>central_widget<span class="token punctuation">)</span>
</code></pre> 
<ul><li>创建了一个<code>QWidget</code>作为窗口的中心小部件。</li><li><code>setCentralWidget</code> 将这个小部件设置为主窗口的中心区域。</li><li><code>QVBoxLayout</code> 创建了一个垂直布局，用于在中心小部件中垂直排列其他控件。</li></ul> 
<h5><a id="_170"></a>添加任务输入框</h5> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>task_input <span class="token operator">=</span> QLineEdit<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>task_input<span class="token punctuation">.</span>setMinimumHeight<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>task_input<span class="token punctuation">.</span>returnPressed<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>add_task<span class="token punctuation">)</span>
layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_input<span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>QLineEdit</code> 创建了一个文本输入框，用于输入任务。</li><li><code>setMinimumHeight</code> 设置了输入框的最小高度。</li><li><code>returnPressed.connect</code> 将输入框中的回车键事件连接到 <code>add_task</code> 方法；<code>QLineEdit</code> 控件有一个名为 <code>returnPressed</code> 的信号，当用户在该控件中按下回车键时，会触发去调用括号内的方法。</li><li><code>addWidget</code> 将输入框添加到布局中。</li></ul> 
<h5><a id="_182"></a>添加控制按钮</h5> 
<pre><code class="prism language-python">buttons_layout <span class="token operator">=</span> QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
add_button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"添加任务"</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
add_button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>add_task<span class="token punctuation">)</span>
buttons_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>add_button<span class="token punctuation">)</span>

delete_button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"删除任务"</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
delete_button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>delete_task<span class="token punctuation">)</span>
buttons_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>delete_button<span class="token punctuation">)</span>

edit_button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"编辑任务"</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
edit_button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>edit_task<span class="token punctuation">)</span>
buttons_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>edit_button<span class="token punctuation">)</span>

layout<span class="token punctuation">.</span>addLayout<span class="token punctuation">(</span>buttons_layout<span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>QHBoxLayout</code> 创建了一个水平布局。</li><li><code>QPushButton</code> 创建了添加、删除和编辑任务的按钮。</li><li><code>clicked.connect</code> 将按钮点击事件连接到相应的方法。</li><li><code>addWidget</code> 将按钮添加到水平布局中。</li><li><code>addLayout</code> 将水平布局添加到主垂直布局中。</li></ul> 
<h5><a id="_205"></a>添加任务列表、搜索框和进度条</h5> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>task_list <span class="token operator">=</span> QListWidget<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">)</span>

self<span class="token punctuation">.</span>search_input <span class="token operator">=</span> QLineEdit<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>search_input<span class="token punctuation">.</span>setPlaceholderText<span class="token punctuation">(</span><span class="token string">"搜索任务..."</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>search_input<span class="token punctuation">.</span>textChanged<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>search_tasks<span class="token punctuation">)</span>
layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>search_input<span class="token punctuation">)</span>

self<span class="token punctuation">.</span>process_label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>process_label<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"任务进度："</span><span class="token punctuation">)</span>
layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>process_label<span class="token punctuation">)</span>

self<span class="token punctuation">.</span>progress_bar <span class="token operator">=</span> MovingTextProgressBar<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>progress_bar<span class="token punctuation">.</span>setMaximum<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>progress_bar<span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>QListWidget</code> 创建了一个任务列表。</li><li><code>QLineEdit</code> 用作搜索框。</li><li><code>QLabel</code> 显示了进度条的标签。</li><li><code>MovingTextProgressBar</code> 是一个自定义的进度条类，用来展示任务完成进度。</li></ul> 
<h5><a id="_228"></a>加载任务和应用样式表</h5> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>load_tasks<span class="token punctuation">(</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>update_progress<span class="token punctuation">(</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>apply_stylesheet<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>load_tasks</code> 加载保存的任务。</li><li><code>update_progress</code> 更新进度条的状态。</li><li><code>apply_stylesheet</code> 应用自定义样式来美化界面。</li></ul> 
<h4><a id="2_MovingTextProgressBar_239"></a>2. 自定义控件（自定义进度条<code>MovingTextProgressBar</code>）详解</h4> 
<p>这段代码定义了一个自定义的进度条控件 <code>MovingTextProgressBar</code>，它继承自PyQt5的 <code>QProgressBar</code>。这个自定义控件重写了进度条的绘制方法，使得进度条中可以显示带有百分比的文本。让我们逐步分析这段代码：</p> 
<h5><a id="_242"></a>类定义和初始化</h5> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">MovingTextProgressBar</span><span class="token punctuation">(</span>QProgressBar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>MovingTextProgressBar</code> 类继承自 <code>QProgressBar</code>，使用 <code>QProgressBar</code> 的所有功能并添加新的特性。</li><li><code>__init__</code> 方法是构造函数，用于初始化这个控件。<code>parent</code> 参数允许这个控件被嵌入到其他QWidget中。</li></ul> 
<h4><a id="_251"></a>绘制进度条</h4> 
<pre><code class="prism language-python"><span class="token keyword">def</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
    painter <span class="token operator">=</span> QPainter<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
    <span class="token comment"># ... 绘制代码 ...</span>
</code></pre> 
<ul><li><code>paintEvent</code> 方法是Qt中用于绘制控件的事件处理器。</li><li><code>QPainter</code> 对象用于所有绘图操作。</li></ul> 
<h5><a id="_260"></a>绘制背景</h5> 
<pre><code class="prism language-python">rect <span class="token operator">=</span> self<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span>
painter<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>self<span class="token punctuation">.</span>palette<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>color<span class="token punctuation">(</span>QPalette<span class="token punctuation">.</span>Window<span class="token punctuation">)</span><span class="token punctuation">)</span>
painter<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
</code></pre> 
<ul><li><code>self.rect()</code> 获取控件的矩形区域。</li><li><code>setBrush</code> 设置画笔的填充颜色，这里使用窗口的默认背景色。</li><li><code>drawRect</code> 绘制进度条的背景矩形。</li></ul> 
<h5><a id="_270"></a>计算并绘制进度</h5> 
<pre><code class="prism language-python">progress_rect <span class="token operator">=</span> QRect<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
progress_rect<span class="token punctuation">.</span>setWidth<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>width<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
painter<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>self<span class="token punctuation">.</span>palette<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>color<span class="token punctuation">(</span>QPalette<span class="token punctuation">.</span>Highlight<span class="token punctuation">)</span><span class="token punctuation">)</span>
painter<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span>progress_rect<span class="token punctuation">)</span>
</code></pre> 
<ul><li>计算进度条的宽度，基于进度条的当前值和最大值。</li><li>设置画笔为高亮颜色（通常用于进度条的填充颜色）。</li><li>绘制表示进度的矩形。</li></ul> 
<h5><a id="_281"></a>绘制文本</h5> 
<pre><code class="prism language-python">painter<span class="token punctuation">.</span>setPen<span class="token punctuation">(</span>self<span class="token punctuation">.</span>palette<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>color<span class="token punctuation">(</span>QPalette<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span>
text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span>
text_rect <span class="token operator">=</span> QRect<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
text_width <span class="token operator">=</span> painter<span class="token punctuation">.</span>fontMetrics<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
<span class="token comment"># ... 文本位置计算和绘制 ...</span>
</code></pre> 
<ul><li>设置画笔颜色用于绘制文本。</li><li>创建要显示的文本，显示当前进度的百分比。</li><li><code>fontMetrics().width(text)</code> 用于计算文本的宽度，以便于定位。</li></ul> 
<h5><a id="_293"></a>计算文本位置并绘制</h5> 
<pre><code class="prism language-python"><span class="token keyword">if</span> self<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
    text_position <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> progress_rect<span class="token punctuation">.</span>width<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> text_width <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    text_position <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>width<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> text_width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
text_rect<span class="token punctuation">.</span>setLeft<span class="token punctuation">(</span>text_position<span class="token punctuation">)</span>
painter<span class="token punctuation">.</span>drawText<span class="token punctuation">(</span>text_rect<span class="token punctuation">,</span> Qt<span class="token punctuation">.</span>AlignLeft <span class="token operator">|</span> Qt<span class="token punctuation">.</span>AlignVCenter<span class="token punctuation">,</span> text<span class="token punctuation">)</span>
</code></pre> 
<ul><li>根据进度条的填充情况计算文本的位置。</li><li>如果有进度（值大于0），则确保文本位于进度条填充的右侧。</li><li>如果没有进度，则将文本居中。</li><li><code>drawText</code> 实际绘制文本。</li></ul> 
<h4><a id="_307"></a>总结</h4> 
<p><code>MovingTextProgressBar</code> 类通过重写 <code>paintEvent</code> 方法自定义了进度条的绘制方式。这种自定义控件使得进度条不仅能够显示进度的可视化表示，还能在进度条内部显示具体的进度百分比，增强了用户界面的信息展示能力。这个自定义控件可以被重复使用在任何需要显示带文本的进度条的场景中。</p> 
<h4><a id="3_add_task__312"></a>3. <code>添加任务（add_task）</code> 方法详解</h4> 
<h5><a id="_314"></a>获取任务文本</h5> 
<p>首先，我们从<code>QLineEdit</code>（<code>self.task_input</code>）获取用户输入的文本。这是用户希望添加到任务列表中的任务描述。</p> 
<pre><code class="prism language-python">task_text <span class="token operator">=</span> self<span class="token punctuation">.</span>task_input<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> task_text<span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>这段代码检查是否有文本输入。如果<code>task_text</code>不为空，那么接下来的代码就会执行，将这个新任务添加到任务列表中。</p> 
<h5><a id="_325"></a>创建列表项</h5> 
<p>接下来，我们创建一个<code>QListWidgetItem</code>，这将是任务列表中的一个新项。</p> 
<pre><code class="prism language-python">item <span class="token operator">=</span> QListWidgetItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
item<span class="token punctuation">.</span>setSizeHint<span class="token punctuation">(</span>QSize<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里，<code>setSizeHint(QSize(0, 40))</code>是为了确保列表项有足够的空间来展示任务，其中40是列表项的高度。</p> 
<h5><a id="_335"></a>设计任务小部件</h5> 
<p>现在，我们创建一个小部件来展示任务的文本和一个复选框。这个小部件将被放置在任务列表项中。</p> 
<pre><code class="prism language-python">task_widget <span class="token operator">=</span> QWidget<span class="token punctuation">(</span><span class="token punctuation">)</span>
task_layout <span class="token operator">=</span> QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
task_layout<span class="token punctuation">.</span>setContentsMargins<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>我们使用<code>QHBoxLayout</code>（水平布局）来放置复选框和任务标签。<code>setContentsMargins</code>方法用于设置布局边距。</p> 
<h5><a id="_346"></a>添加复选框和标签</h5> 
<p>我们接着添加一个<code>QCheckBox</code>和一个<code>QLabel</code>到布局中。复选框用于标记任务是否完成，而标签显示任务的文本。</p> 
<pre><code class="prism language-python">chkBox <span class="token operator">=</span> QCheckBox<span class="token punctuation">(</span><span class="token punctuation">)</span>
chkBox<span class="token punctuation">.</span>stateChanged<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>update_progress<span class="token punctuation">)</span>

task_label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>task_text<span class="token punctuation">)</span>
task_label<span class="token punctuation">.</span>setMargin<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>

task_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>chkBox<span class="token punctuation">)</span>
task_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>task_label<span class="token punctuation">)</span>
</code></pre> 
<p><code>stateChanged</code>信号连接到<code>update_progress</code>方法，这样当复选框的状态改变时，进度条会更新。</p> 
<h5><a id="_362"></a>设置任务小部件的布局并添加到列表</h5> 
<p>最后，我们将这个布局应用到<code>task_widget</code>，然后将这个小部件设置为<code>item</code>的小部件。</p> 
<pre><code class="prism language-python">task_layout<span class="token punctuation">.</span>addStretch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
task_widget<span class="token punctuation">.</span>setLayout<span class="token punctuation">(</span>task_layout<span class="token punctuation">)</span>

self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>addItem<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>setItemWidget<span class="token punctuation">(</span>item<span class="token punctuation">,</span> task_widget<span class="token punctuation">)</span>
</code></pre> 
<p><code>addStretch(1)</code>确保复选框和标签靠左排列，余下的空间被拉伸填充。</p> 
<h5><a id="_375"></a>清除输入字段并更新进度</h5> 
<p>任务添加到列表后，输入框被清空，准备接受下一个任务的输入。同时，我们调用<code>update_progress</code>方法来更新进度条。</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>task_input<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
self<span class="token punctuation">.</span>update_progress<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h5><a id="_383"></a>总结</h5> 
<p><code>add_task</code>方法的核心是创建一个新的列表项，将用户输入的任务文本放入一个包含复选框和标签的小部件中，并将这个小部件添加到任务列表中。这个方法体现了PyQt5在处理用户界面和事件方面的灵活性和强大功能。通过这种方式，我们的待办事项列表应用程序能够动态地响应用户的输入，提供一个直观且互动的用户体验。</p> 
<h4><a id="4_delete_task__387"></a>4. <code>删除任务（delete_task）</code> 方法详解</h4> 
<h5><a id="_389"></a>循环遍历所选任务</h5> 
<p><code>delete_task</code>方法首先遍历所有被用户选中的任务项。在PyQt5中，可以通过<code>selectedItems()</code>方法获取到<code>QListWidget</code>中所有被用户选中的项。</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> item <span class="token keyword">in</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>selectedItems<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>这段代码遍历任务列表中的每个被选中的项（<code>item</code>）。</p> 
<h5><a id="_399"></a>删除选中的任务</h5> 
<p>接下来，使用<code>takeItem</code>方法从列表中移除这些选中的项。<code>takeItem</code>需要一个索引参数，我们通过<code>row(item)</code>方法获取这个索引。</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>takeItem<span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>row<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里，<code>row(item)</code>返回被选中项的索引，然后<code>takeItem</code>根据这个索引删除相应的项。</p> 
<h5><a id="_408"></a>更新进度条</h5> 
<p>删除任务后，进度条需要更新以反映当前任务的完成状态。</p> 
<pre><code class="prism language-python">self<span class="token punctuation">.</span>update_progress<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p>调用<code>update_progress</code>方法来重新计算并更新进度条。</p> 
<h4><a id="edit_task__417"></a><code>编辑任务（edit_task）</code> 方法详解</h4> 
<h5><a id="_419"></a>检查是否有任务被选中</h5> 
<p>在编辑任务前，首先检查是否有任务被选中。如果至少有一个任务被选中，我们将取第一个选中的任务进行编辑。</p> 
<pre><code class="prism language-python">selected_items <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>selectedItems<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> selected_items<span class="token punctuation">:</span>
    item <span class="token operator">=</span> selected_items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre> 
<p>这段代码确定是否有任务被选中，并将第一个选中的任务项赋值给<code>item</code>变量。</p> 
<h5><a id="_431"></a>弹出对话框以编辑任务</h5> 
<p>使用<code>QInputDialog.getText</code>方法弹出一个对话框，允许用户编辑选中任务的文本。这个方法返回用户输入的新文本（<code>new_text</code>）和一个布尔值（<code>ok</code>），表示用户是否点击了对话框的确认按钮。</p> 
<pre><code class="prism language-python">new_text<span class="token punctuation">,</span> ok <span class="token operator">=</span> QInputDialog<span class="token punctuation">.</span>getText<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"编辑任务"</span><span class="token punctuation">,</span> <span class="token string">"任务描述:"</span><span class="token punctuation">,</span> QLineEdit<span class="token punctuation">.</span>Normal<span class="token punctuation">,</span> item<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里的<code>item.text()</code>是当前任务的文本，用作对话框中的初始值。</p> 
<h5><a id="_440"></a>更新任务文本</h5> 
<p>如果用户点击了确认并输入了新文本，则更新任务的文本。</p> 
<pre><code class="prism language-python"><span class="token keyword">if</span> ok <span class="token keyword">and</span> new_text<span class="token punctuation">:</span>
    item<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>new_text<span class="token punctuation">)</span>
</code></pre> 
<p><code>setText</code>方法用于更新列表项的文本为用户输入的新文本。</p> 
<h5><a id="_450"></a>总结</h5> 
<p><code>delete_task</code>方法通过遍历并移除选中的任务项来实现删除功能，而<code>edit_task</code>方法则通过弹出对话框并更新任务文本来实现编辑功能。这两个方法展示了如何在PyQt5应用程序中处理用户交互，如选择、删除和编辑列表项。通过这些方法，我们的待办事项列表应用变得更加灵活和用户友好，使用户能够轻松地管理他们的任务。</p> 
<h4><a id="5_load_tasks__455"></a>5. <code>load_tasks</code> 方法详解</h4> 
<h5><a id="_457"></a>尝试读取任务数据</h5> 
<p><code>load_tasks</code>方法首先尝试打开一个名为<code>tasks.json</code>的文件，该文件包含以前保存的任务数据。</p> 
<pre><code class="prism language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'tasks.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
        tasks <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading tasks: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre> 
<p>这里使用<code>json.load(file)</code>将文件中的JSON数据转换成Python对象。如果文件不存在或者文件格式不正确，会抛出异常，并打印错误信息。</p> 
<h5><a id="_471"></a>遍历任务并添加到列表</h5> 
<p>接下来，遍历从文件中加载的每个任务，并将它们添加到任务列表中。</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> task <span class="token keyword">in</span> tasks<span class="token punctuation">:</span>
    item <span class="token operator">=</span> QListWidgetItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>addItem<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

    task_widget <span class="token operator">=</span> QWidget<span class="token punctuation">(</span><span class="token punctuation">)</span>
    task_layout <span class="token operator">=</span> QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
    task_layout<span class="token punctuation">.</span>setContentsMargins<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>

    chkBox <span class="token operator">=</span> QCheckBox<span class="token punctuation">(</span><span class="token punctuation">)</span>
    chkBox<span class="token punctuation">.</span>setChecked<span class="token punctuation">(</span>task<span class="token punctuation">[</span><span class="token string">'completed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    chkBox<span class="token punctuation">.</span>stateChanged<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>update_progress<span class="token punctuation">)</span>

    task_label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>task<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    task_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>chkBox<span class="token punctuation">)</span>
    task_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>task_label<span class="token punctuation">)</span>
    task_layout<span class="token punctuation">.</span>addStretch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

    task_widget<span class="token punctuation">.</span>setLayout<span class="token punctuation">(</span>task_layout<span class="token punctuation">)</span>

    item<span class="token punctuation">.</span>setSizeHint<span class="token punctuation">(</span>task_widget<span class="token punctuation">.</span>sizeHint<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>setItemWidget<span class="token punctuation">(</span>item<span class="token punctuation">,</span> task_widget<span class="token punctuation">)</span>
</code></pre> 
<p>在这个循环中，每个任务被创建为一个<code>QListWidgetItem</code>，其中包含一个复选框（表示任务是否完成）和一个标签（显示任务文本）。这样做可以确保应用程序在启动时加载用户之前的任务。</p> 
<h4><a id="6_save_tasks__500"></a>6. <code>save_tasks</code> 方法详解</h4> 
<h5><a id="_502"></a>准备保存的任务数据</h5> 
<p>在<code>save_tasks</code>方法中，首先创建一个空列表<code>tasks</code>，用于存放将要保存到文件的任务数据。</p> 
<pre><code class="prism language-python">tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre> 
<h5><a id="_509"></a>遍历任务列表并收集数据</h5> 
<p>接着，遍历任务列表中的每一项，收集任务的文本和完成状态。</p> 
<pre><code class="prism language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    item <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>item<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    widget <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>itemWidget<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
    <span class="token keyword">if</span> widget<span class="token punctuation">:</span>
        label <span class="token operator">=</span> widget<span class="token punctuation">.</span>findChild<span class="token punctuation">(</span>QLabel<span class="token punctuation">)</span>
        checkbox <span class="token operator">=</span> widget<span class="token punctuation">.</span>findChild<span class="token punctuation">(</span>QCheckBox<span class="token punctuation">)</span>
        tasks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'text'</span><span class="token punctuation">:</span> label<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'completed'</span><span class="token punctuation">:</span> checkbox<span class="token punctuation">.</span>isChecked<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> 
<p>这里使用<code>findChild</code>方法来找到每个任务项中的<code>QLabel</code>和<code>QCheckBox</code>，并获取它们的文本和勾选状态。</p> 
<h5><a id="_524"></a>将任务数据保存到文件</h5> 
<p>最后，使用<code>json.dump</code>将任务数据以JSON格式保存到<code>tasks.json</code>文件中。</p> 
<pre><code class="prism language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'tasks.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>
</code></pre> 
<p>这样，当用户关闭应用程序时，他们的任务数据被保存，并且可以在下次打开应用时重新加载。</p> 
<h5><a id="_534"></a>总结</h5> 
<p><code>load_tasks</code>和<code>save_tasks</code>方法是待办事项列表应用程序的关键部分，它们确保了任务数据的持久化。通过这些方法，用户的任务列表在应用程序关闭和重新打开之间保持一致，从而提供了更好的用户体验和数据的持久性。</p> 
<h3><a id="_541"></a>总结</h3> 
<p>本文详细介绍了如何使用Python和PyQt5创建一个功能完备的待办事项列表应用程序。从项目概述到环境搭建，再到基础概念的讲解和实际构建过程，文章全面覆盖了应用程序开发的各个方面。通过复现这个项目，可以学习到以下知识：PyQt5的基本使用、事件处理和信号槽机制、自定义控件的创建、数据保存。</p> 
<h3><a id="_546"></a>附录（全部代码）</h3> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtWidgets <span class="token keyword">import</span> QLabel<span class="token punctuation">,</span>QHBoxLayout<span class="token punctuation">,</span>QApplication<span class="token punctuation">,</span> QMainWindow<span class="token punctuation">,</span> QListWidget<span class="token punctuation">,</span> QListWidgetItem<span class="token punctuation">,</span> QLineEdit<span class="token punctuation">,</span> QPushButton<span class="token punctuation">,</span> QVBoxLayout<span class="token punctuation">,</span> QWidget<span class="token punctuation">,</span> QCheckBox<span class="token punctuation">,</span> QProgressBar<span class="token punctuation">,</span> QInputDialog<span class="token punctuation">,</span> QComboBox
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtCore <span class="token keyword">import</span> QSize<span class="token punctuation">,</span>QRect<span class="token punctuation">,</span> Qt
<span class="token keyword">from</span> PyQt5<span class="token punctuation">.</span>QtGui <span class="token keyword">import</span> QIcon<span class="token punctuation">,</span>QPainter<span class="token punctuation">,</span> QColor<span class="token punctuation">,</span> QPalette
 

<span class="token keyword">class</span> <span class="token class-name">MovingTextProgressBar</span><span class="token punctuation">(</span>QProgressBar<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> parent<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span>parent<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">paintEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        painter <span class="token operator">=</span> QPainter<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        <span class="token comment"># Draw the progress bar's background</span>
        rect <span class="token operator">=</span> self<span class="token punctuation">.</span>rect<span class="token punctuation">(</span><span class="token punctuation">)</span>
        painter<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>self<span class="token punctuation">.</span>palette<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>color<span class="token punctuation">(</span>QPalette<span class="token punctuation">.</span>Window<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Use 'Window' role for background</span>
        painter<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>

        <span class="token comment"># Calculate the width of the progress bar</span>
        progress_rect <span class="token operator">=</span> QRect<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
        progress_rect<span class="token punctuation">.</span>setWidth<span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>width<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span> self<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> self<span class="token punctuation">.</span>maximum<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        painter<span class="token punctuation">.</span>setBrush<span class="token punctuation">(</span>self<span class="token punctuation">.</span>palette<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>color<span class="token punctuation">(</span>QPalette<span class="token punctuation">.</span>Highlight<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Use 'Highlight' role for progress</span>
        painter<span class="token punctuation">.</span>drawRect<span class="token punctuation">(</span>progress_rect<span class="token punctuation">)</span>

        <span class="token comment"># Set the text color</span>
        painter<span class="token punctuation">.</span>setPen<span class="token punctuation">(</span>self<span class="token punctuation">.</span>palette<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>color<span class="token punctuation">(</span>QPalette<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># Use 'Text' role for text color</span>

        <span class="token comment"># Calculate the text position</span>
        text <span class="token operator">=</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>self<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span>
        text_rect <span class="token operator">=</span> QRect<span class="token punctuation">(</span>rect<span class="token punctuation">)</span>
        text_width <span class="token operator">=</span> painter<span class="token punctuation">.</span>fontMetrics<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>width<span class="token punctuation">(</span>text<span class="token punctuation">)</span>
        <span class="token comment"># Draw the text</span>
        <span class="token keyword">if</span> self<span class="token punctuation">.</span>value<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">:</span>
            <span class="token comment"># If there is progress, ensure the text is on the right side of the filled area</span>
            text_position <span class="token operator">=</span> <span class="token builtin">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> progress_rect<span class="token punctuation">.</span>width<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> text_width <span class="token operator">-</span> <span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># Use max to avoid negative position</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            <span class="token comment"># If there is no progress, center the text</span>
            text_position <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>rect<span class="token punctuation">.</span>width<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> text_width<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># Cast to int to ensure correct argument type</span>

        text_rect<span class="token punctuation">.</span>setLeft<span class="token punctuation">(</span>text_position<span class="token punctuation">)</span>
        painter<span class="token punctuation">.</span>drawText<span class="token punctuation">(</span>text_rect<span class="token punctuation">,</span> Qt<span class="token punctuation">.</span>AlignLeft <span class="token operator">|</span> Qt<span class="token punctuation">.</span>AlignVCenter<span class="token punctuation">,</span> text<span class="token punctuation">)</span>







<span class="token keyword">class</span> <span class="token class-name">TodoList</span><span class="token punctuation">(</span>QMainWindow<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__init__<span class="token punctuation">(</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>setWindowTitle<span class="token punctuation">(</span><span class="token string">"待办事项列表"</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setGeometry<span class="token punctuation">(</span><span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">300</span><span class="token punctuation">,</span> <span class="token number">600</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setWindowIcon<span class="token punctuation">(</span>QIcon<span class="token punctuation">(</span><span class="token string">'icon.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 设置窗口图标，确保 'icon.png' 在您的文件夹中  </span>

        central_widget <span class="token operator">=</span> QWidget<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>setCentralWidget<span class="token punctuation">(</span>central_widget<span class="token punctuation">)</span>
        layout <span class="token operator">=</span> QVBoxLayout<span class="token punctuation">(</span>central_widget<span class="token punctuation">)</span>
        layout<span class="token punctuation">.</span>setSpacing<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span>
        layout<span class="token punctuation">.</span>setAlignment<span class="token punctuation">(</span>Qt<span class="token punctuation">.</span>AlignTop<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>task_input <span class="token operator">=</span> QLineEdit<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>task_input<span class="token punctuation">.</span>setMinimumHeight<span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>task_input<span class="token punctuation">.</span>returnPressed<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>add_task<span class="token punctuation">)</span>  <span class="token comment"># 连接信号</span>

        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_input<span class="token punctuation">)</span>

        <span class="token comment"># Create a horizontal layout for the buttons</span>
        buttons_layout <span class="token operator">=</span> QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>

        <span class="token comment"># Add Task Button</span>
        add_button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"添加任务"</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
        add_button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>add_task<span class="token punctuation">)</span>
        buttons_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>add_button<span class="token punctuation">)</span>

        <span class="token comment"># Delete Task Button</span>
        delete_button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"删除任务"</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
        delete_button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>delete_task<span class="token punctuation">)</span>
        buttons_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>delete_button<span class="token punctuation">)</span>

        <span class="token comment"># Edit Task Button</span>
        edit_button <span class="token operator">=</span> QPushButton<span class="token punctuation">(</span><span class="token string">"编辑任务"</span><span class="token punctuation">,</span> self<span class="token punctuation">)</span>
        edit_button<span class="token punctuation">.</span>clicked<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>edit_task<span class="token punctuation">)</span>
        buttons_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>edit_button<span class="token punctuation">)</span>

        <span class="token comment"># Add the horizontal layout to the main vertical layout</span>
        layout<span class="token punctuation">.</span>addLayout<span class="token punctuation">(</span>buttons_layout<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>task_list <span class="token operator">=</span> QListWidget<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">)</span>



        self<span class="token punctuation">.</span>search_input <span class="token operator">=</span> QLineEdit<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>search_input<span class="token punctuation">.</span>setPlaceholderText<span class="token punctuation">(</span><span class="token string">"搜索任务..."</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>search_input<span class="token punctuation">.</span>textChanged<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>search_tasks<span class="token punctuation">)</span>
        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>search_input<span class="token punctuation">)</span>



        self<span class="token punctuation">.</span>process_label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>process_label<span class="token punctuation">.</span>setText<span class="token punctuation">(</span><span class="token string">"任务进度："</span><span class="token punctuation">)</span>
        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>process_label<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>progress_bar <span class="token operator">=</span> MovingTextProgressBar<span class="token punctuation">(</span>self<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>progress_bar<span class="token punctuation">.</span>setMaximum<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span>
        layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>progress_bar<span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>load_tasks<span class="token punctuation">(</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_progress<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># Update the progress bar</span>


        self<span class="token punctuation">.</span>apply_stylesheet<span class="token punctuation">(</span><span class="token punctuation">)</span>







    <span class="token keyword">def</span> <span class="token function">apply_stylesheet</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>setStyleSheet<span class="token punctuation">(</span><span class="token triple-quoted-string string">"""  
            QListWidget, QLineEdit, QProgressBar, QComboBox {                font-size: 14px;                border: 1px solid #c0c0c0;                border-radius: 5px;                padding: 5px;            }            QPushButton {                background-color: #5cacee;                border-radius: 5px;                color: white;                padding: 6px;                margin: 5px 0;            }            QPushButton:hover {                background-color: #1e90ff;            }        """</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">add_task</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        task_text <span class="token operator">=</span> self<span class="token punctuation">.</span>task_input<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> task_text<span class="token punctuation">:</span>
            <span class="token comment"># 创建一个新的QListWidgetItem并设置其大小提示</span>
            item <span class="token operator">=</span> QListWidgetItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
            item<span class="token punctuation">.</span>setSizeHint<span class="token punctuation">(</span>QSize<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">40</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 根据需要调整高度</span>

            <span class="token comment"># 创建包含复选框和标签的小部件</span>
            task_widget <span class="token operator">=</span> QWidget<span class="token punctuation">(</span><span class="token punctuation">)</span>
            task_layout <span class="token operator">=</span> QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
            task_layout<span class="token punctuation">.</span>setContentsMargins<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># 适当设置边距</span>

            <span class="token comment"># 创建复选框并连接状态变化信号</span>
            chkBox <span class="token operator">=</span> QCheckBox<span class="token punctuation">(</span><span class="token punctuation">)</span>
            chkBox<span class="token punctuation">.</span>stateChanged<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>update_progress<span class="token punctuation">)</span>

            <span class="token comment"># 创建标签显示文本</span>
            task_label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>task_text<span class="token punctuation">)</span>
            task_label<span class="token punctuation">.</span>setMargin<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 如果文本靠得太近，可以添加一些边距</span>

            <span class="token comment"># 将复选框和标签添加到布局</span>
            task_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>chkBox<span class="token punctuation">)</span>
            task_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>task_label<span class="token punctuation">)</span>
            task_layout<span class="token punctuation">.</span>addStretch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>  <span class="token comment"># 添加拉伸因子使得控件靠左排列</span>

            <span class="token comment"># 设置任务小部件的布局</span>
            task_widget<span class="token punctuation">.</span>setLayout<span class="token punctuation">(</span>task_layout<span class="token punctuation">)</span>

            <span class="token comment"># 将任务小部件设置为列表项的小部件</span>
            self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>addItem<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>setItemWidget<span class="token punctuation">(</span>item<span class="token punctuation">,</span> task_widget<span class="token punctuation">)</span>

            <span class="token comment"># 清除输入字段并更新进度</span>
            self<span class="token punctuation">.</span>task_input<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
            self<span class="token punctuation">.</span>update_progress<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">delete_task</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> item <span class="token keyword">in</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>selectedItems<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>takeItem<span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>row<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>update_progress<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">update_progress</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        total_tasks <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span>
        completed_tasks <span class="token operator">=</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>total_tasks<span class="token punctuation">)</span> <span class="token keyword">if</span>
                              self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>itemWidget<span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>item<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>findChild<span class="token punctuation">(</span>QCheckBox<span class="token punctuation">)</span><span class="token punctuation">.</span>isChecked<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># Protect against division by zero if there are no tasks</span>
        progress <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token punctuation">(</span>completed_tasks <span class="token operator">/</span> total_tasks<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">if</span> total_tasks <span class="token operator">&gt;</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token number">0</span>
        self<span class="token punctuation">.</span>progress_bar<span class="token punctuation">.</span>setValue<span class="token punctuation">(</span>progress<span class="token punctuation">)</span>
        self<span class="token punctuation">.</span>progress_bar<span class="token punctuation">.</span>setFormat<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>progress<span class="token punctuation">:</span><span class="token format-spec">.2f</span><span class="token punctuation">}</span></span><span class="token string">%"</span></span> <span class="token keyword">if</span> progress <span class="token operator">&gt;=</span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">"0.00%"</span><span class="token punctuation">)</span>

        self<span class="token punctuation">.</span>save_tasks<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">edit_task</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        selected_items <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>selectedItems<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">if</span> selected_items<span class="token punctuation">:</span>
            item <span class="token operator">=</span> selected_items<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
            new_text<span class="token punctuation">,</span> ok <span class="token operator">=</span> QInputDialog<span class="token punctuation">.</span>getText<span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token string">"编辑任务"</span><span class="token punctuation">,</span> <span class="token string">"任务描述:"</span><span class="token punctuation">,</span> QLineEdit<span class="token punctuation">.</span>Normal<span class="token punctuation">,</span> item<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">if</span> ok <span class="token keyword">and</span> new_text<span class="token punctuation">:</span>
                item<span class="token punctuation">.</span>setText<span class="token punctuation">(</span>new_text<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">closeEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            item <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>item<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            widget <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>itemWidget<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token keyword">if</span> widget<span class="token punctuation">:</span>
                checkbox <span class="token operator">=</span> widget<span class="token punctuation">.</span>findChild<span class="token punctuation">(</span>QCheckBox<span class="token punctuation">)</span>
                tasks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'text'</span><span class="token punctuation">:</span> item<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'completed'</span><span class="token punctuation">:</span> checkbox<span class="token punctuation">.</span>isChecked<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'tasks.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>
        event<span class="token punctuation">.</span>accept<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">load_tasks</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'tasks.json'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
                tasks <span class="token operator">=</span> json<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">file</span><span class="token punctuation">)</span>
            <span class="token keyword">for</span> task <span class="token keyword">in</span> tasks<span class="token punctuation">:</span>

                item <span class="token operator">=</span> QListWidgetItem<span class="token punctuation">(</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>addItem<span class="token punctuation">(</span>item<span class="token punctuation">)</span>

                task_widget <span class="token operator">=</span> QWidget<span class="token punctuation">(</span><span class="token punctuation">)</span>
                task_layout <span class="token operator">=</span> QHBoxLayout<span class="token punctuation">(</span><span class="token punctuation">)</span>
                task_layout<span class="token punctuation">.</span>setContentsMargins<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>

                chkBox <span class="token operator">=</span> QCheckBox<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token comment"># First, disconnect any existing connections to avoid duplicate signals</span>
                <span class="token keyword">try</span><span class="token punctuation">:</span>
                    chkBox<span class="token punctuation">.</span>stateChanged<span class="token punctuation">.</span>disconnect<span class="token punctuation">(</span><span class="token punctuation">)</span>
                <span class="token keyword">except</span> TypeError<span class="token punctuation">:</span>
                    <span class="token comment"># If there is no connection, a TypeError is thrown, which is fine</span>
                    <span class="token keyword">pass</span>
                <span class="token comment"># Then, set the checked state</span>
                chkBox<span class="token punctuation">.</span>setChecked<span class="token punctuation">(</span>task<span class="token punctuation">[</span><span class="token string">'completed'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                <span class="token comment"># Now, connect the signal to the slot</span>
                chkBox<span class="token punctuation">.</span>stateChanged<span class="token punctuation">.</span>connect<span class="token punctuation">(</span>self<span class="token punctuation">.</span>update_progress<span class="token punctuation">)</span>

                task_label <span class="token operator">=</span> QLabel<span class="token punctuation">(</span>task<span class="token punctuation">[</span><span class="token string">'text'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                task_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>chkBox<span class="token punctuation">)</span>
                task_layout<span class="token punctuation">.</span>addWidget<span class="token punctuation">(</span>task_label<span class="token punctuation">)</span>
                task_layout<span class="token punctuation">.</span>addStretch<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>

                task_widget<span class="token punctuation">.</span>setLayout<span class="token punctuation">(</span>task_layout<span class="token punctuation">)</span>

                item<span class="token punctuation">.</span>setSizeHint<span class="token punctuation">(</span>task_widget<span class="token punctuation">.</span>sizeHint<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>setItemWidget<span class="token punctuation">(</span>item<span class="token punctuation">,</span> task_widget<span class="token punctuation">)</span>

            <span class="token comment"># After all tasks have been loaded, update the progress bar</span>
                self<span class="token punctuation">.</span>update_progress<span class="token punctuation">(</span><span class="token punctuation">)</span>



        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"Error loading tasks: </span><span class="token interpolation"><span class="token punctuation">{<!-- --></span>e<span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>

            <span class="token comment"># 新增 sort_tasks 方法</span>




    <span class="token keyword">def</span> <span class="token function">search_tasks</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> keyword<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            item <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>item<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            widget <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>itemWidget<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token keyword">if</span> widget<span class="token punctuation">:</span>
                label <span class="token operator">=</span> widget<span class="token punctuation">.</span>findChild<span class="token punctuation">(</span>QLabel<span class="token punctuation">)</span>
                <span class="token comment"># 确保我们找到了标签并且比较其文本</span>
                <span class="token keyword">if</span> label <span class="token keyword">and</span> keyword<span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">in</span> label<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>lower<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    item<span class="token punctuation">.</span>setHidden<span class="token punctuation">(</span><span class="token boolean">False</span><span class="token punctuation">)</span>
                <span class="token keyword">else</span><span class="token punctuation">:</span>
                    item<span class="token punctuation">.</span>setHidden<span class="token punctuation">(</span><span class="token boolean">True</span><span class="token punctuation">)</span>

    <span class="token comment"># 程序结束时调用</span>
    <span class="token keyword">def</span> <span class="token function">closeEvent</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>save_tasks<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token builtin">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>closeEvent<span class="token punctuation">(</span>event<span class="token punctuation">)</span>

    <span class="token comment"># 新增保存和加载任务的方法</span>
    <span class="token keyword">def</span> <span class="token function">save_tasks</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        tasks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            item <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>item<span class="token punctuation">(</span>i<span class="token punctuation">)</span>
            widget <span class="token operator">=</span> self<span class="token punctuation">.</span>task_list<span class="token punctuation">.</span>itemWidget<span class="token punctuation">(</span>item<span class="token punctuation">)</span>
            <span class="token keyword">if</span> widget<span class="token punctuation">:</span>
                label <span class="token operator">=</span> widget<span class="token punctuation">.</span>findChild<span class="token punctuation">(</span>QLabel<span class="token punctuation">)</span>
                checkbox <span class="token operator">=</span> widget<span class="token punctuation">.</span>findChild<span class="token punctuation">(</span>QCheckBox<span class="token punctuation">)</span>
                task_text <span class="token operator">=</span> label<span class="token punctuation">.</span>text<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> label <span class="token keyword">else</span> <span class="token string">""</span>
                task_completed <span class="token operator">=</span> checkbox<span class="token punctuation">.</span>isChecked<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">if</span> checkbox <span class="token keyword">else</span> <span class="token boolean">False</span>
                tasks<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'text'</span><span class="token punctuation">:</span> task_text<span class="token punctuation">,</span> <span class="token string">'completed'</span><span class="token punctuation">:</span> task_completed<span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'tasks.json'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token builtin">file</span><span class="token punctuation">:</span>
            json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>tasks<span class="token punctuation">,</span> <span class="token builtin">file</span><span class="token punctuation">)</span>


app <span class="token operator">=</span> QApplication<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
window <span class="token operator">=</span> TodoList<span class="token punctuation">(</span><span class="token punctuation">)</span>
window<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span>exec_<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c0ce2b479d052c9bc9418477237b2f62/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Hive建表语句</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/25297ffab9070b79eea22a5cc49f37b8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vmware 17 提示 You do not have permission to enter a license key……的解决办法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>