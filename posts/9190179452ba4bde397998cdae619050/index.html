<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>GFS分布式文件系统 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="GFS分布式文件系统" />
<meta property="og:description" content="目录 一、GFS概述1、GlusterFS的概念2、GlusterFS特点3、GlusterFS术语4、GlusterFS的工作流程5、GFS卷类型6、三大基本卷的特点①、分布式卷②、条带卷③、复制卷 二、相关维护命令1、查看GlusterFS卷2、查看所有卷的信息3、查看所有卷的状态4、停止一个卷5、删除一个卷6．设置卷的访问控制 三、GFS部署1、部署节点集群2、部署gluster客户端3、测试 Gluster 文件系统①、查看分布式文件分布②、查看条带卷文件分布③、查看复制卷文件分布④、查看分布式条带卷分布⑤、查看分布式复制卷分布 4、破坏性测试①、分布式卷数据（可查看，但缺少node2的demo5.log）②、条带卷（不可查看，不具备冗余）③、复制卷（可查看 ，有冗余）④、分布式条带卷（不可查看，不具备冗余）⑤、分布式复制卷（可查看 ，有冗余） 四、gluster命令总结 一、GFS概述 1、GlusterFS的概念 GlusterFS：分布式文件系统
开源的分布式文件系统
组成：
存储服务器
客户端
NFS/Samba 存储网关
无元数据服务器
数据分散存储可避免出现单点故障 补充：
FS（文件系统）的作用:从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进行保护和检索的系统。
具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的存取
文件系统组成：
1)文件系统接口
2)对对像管理的软件集合
3)对象及属性
2、GlusterFS特点 【1】扩展性和高性能【2】高可用性【3】全局统一命名空间【4】弹性卷管理【5】基于标准协议 3、GlusterFS术语 Brick（块存储）：由主机提供的用于物理存储的专用分区，是GlusterFS中的基本存储单元，同时也是可信存储池中服务器上对外提供的存储目录。Volume（逻辑卷）：一个逻辑卷是一组 Brick 的集合。卷是数据存储的逻辑设备，类似于 LVM 中的逻辑卷。大部分 Gluster 管理操作是在卷上进行的。FUSE：用户空间的文件系统（类别EXT4），”这是一个伪文件系统“，用户端的交换模块VFS（虚拟端口）：内核态的虚拟文件系统，用户是提交请求给VFS 然后VFS交给FUSH，再交给GFS客户端，最后由客户端交给远端的存储
Glusterd（服务）：是运行再存储节点的进程（客户端运行的是gluster client）GFS使用过程中整个GFS之间的交换由Gluster client 和glusterd完成 4、GlusterFS的工作流程 1、外来一个请求，例：用户端申请创建一个文件，客户端或应用程序通过GFS的挂载点访问数据2、linux系统内容通过VFSAPI收到请求并处理3、VFS将数据递交给FUSE内核文件系统，fuse文件系统则是将数据通过/dev/fuse设备文件递交给了GlusterFS client端4、GlusterFS client端收到数据后，会根据配置文件的配置对数据进行处理5、再通过网络，将数据发送给远端的ClusterFS server，并将数据写入到服务器储存设备上6、server再将数据转交给VFS伪文件系统，再由VFS进行转存处理，最后交给EXT3 5、GFS卷类型 分布式卷条带卷复制卷分布式条带卷分布式复制卷条带复制卷分布式条带数据卷 6、三大基本卷的特点 ①、分布式卷 文件分布在不同的服务器，不具备冗余性更容易和廉价地扩展卷的大小单点故障会造成数据丢失依赖底层的数据保护 ②、条带卷 数据被分割成更小块分布到块服务器群中的不同条带区分布减少了负载且更小的文件加速了存取的速度没有数据冗余 ③、复制卷 卷中所有的服务器均保存一个完整的副本卷的副本数量可由客户创建的时候决定至少由两个块服务器或更多服务器具备冗余性 二、相关维护命令 1、查看GlusterFS卷 gluster volume list 2、查看所有卷的信息 gluster volume info 3、查看所有卷的状态 gluster volume status 4、停止一个卷 gluster volume stop dis-stripe 5、删除一个卷 注意：删除卷时，需要先停止卷，且信任池中不能有主机处于宕机状态，否则删除不成功 gluster volume delete dis-stripe 6．设置卷的访问控制 仅拒绝" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9190179452ba4bde397998cdae619050/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-07-18T17:02:06+08:00" />
<meta property="article:modified_time" content="2021-07-18T17:02:06+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">GFS分布式文件系统</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#GFS_1" rel="nofollow">一、GFS概述</a></li><li><ul><li><a href="#1GlusterFS_2" rel="nofollow">1、GlusterFS的概念</a></li><li><a href="#2GlusterFS_20" rel="nofollow">2、GlusterFS特点</a></li><li><a href="#3GlusterFS_26" rel="nofollow">3、GlusterFS术语</a></li><li><a href="#4GlusterFS_32" rel="nofollow">4、GlusterFS的工作流程</a></li><li><a href="#5GFS_40" rel="nofollow">5、GFS卷类型</a></li><li><a href="#6_48" rel="nofollow">6、三大基本卷的特点</a></li><li><ul><li><a href="#_49" rel="nofollow">①、分布式卷</a></li><li><a href="#_54" rel="nofollow">②、条带卷</a></li><li><a href="#_58" rel="nofollow">③、复制卷</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_63" rel="nofollow">二、相关维护命令</a></li><li><ul><li><a href="#1GlusterFS_64" rel="nofollow">1、查看GlusterFS卷</a></li><li><a href="#2_68" rel="nofollow">2、查看所有卷的信息</a></li><li><a href="#3_72" rel="nofollow">3、查看所有卷的状态</a></li><li><a href="#4_76" rel="nofollow">4、停止一个卷</a></li><li><a href="#5_80" rel="nofollow">5、删除一个卷</a></li><li><a href="#6_85" rel="nofollow">6．设置卷的访问控制</a></li></ul> 
  </li><li><a href="#GFS_94" rel="nofollow">三、GFS部署</a></li><li><ul><li><a href="#1_105" rel="nofollow">1、部署节点集群</a></li><li><a href="#2gluster_204" rel="nofollow">2、部署gluster客户端</a></li><li><a href="#3_Gluster__241" rel="nofollow">3、测试 Gluster 文件系统</a></li><li><ul><li><a href="#_283" rel="nofollow">①、查看分布式文件分布</a></li><li><a href="#_295" rel="nofollow">②、查看条带卷文件分布</a></li><li><a href="#_307" rel="nofollow">③、查看复制卷文件分布</a></li><li><a href="#_319" rel="nofollow">④、查看分布式条带卷分布</a></li><li><a href="#_341" rel="nofollow">⑤、查看分布式复制卷分布</a></li></ul> 
   </li><li><a href="#4_363" rel="nofollow">4、破坏性测试</a></li><li><ul><li><a href="#node2demo5log_365" rel="nofollow">①、分布式卷数据（可查看，但缺少node2的demo5.log）</a></li><li><a href="#_367" rel="nofollow">②、条带卷（不可查看，不具备冗余）</a></li><li><a href="#__369" rel="nofollow">③、复制卷（可查看 ，有冗余）</a></li><li><a href="#_371" rel="nofollow">④、分布式条带卷（不可查看，不具备冗余）</a></li><li><a href="#__373" rel="nofollow">⑤、分布式复制卷（可查看 ，有冗余）</a></li></ul> 
  </li></ul> 
  </li><li><a href="#gluster_375" rel="nofollow">四、gluster命令</a></li><li><a href="#_390" rel="nofollow">总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="GFS_1"></a>一、GFS概述</h2> 
<h3><a id="1GlusterFS_2"></a>1、GlusterFS的概念</h3> 
<ul><li> <p>GlusterFS：分布式文件系统<br> 开源的分布式文件系统</p> </li><li> <p>组成：<br> 存储服务器<br> 客户端<br> NFS/Samba 存储网关</p> </li><li> <p>无元数据服务器</p> 
  <ul><li>数据分散存储</li><li>可避免出现单点故障</li></ul> </li><li> <p><strong>补充：</strong><br> FS（文件系统）的作用:从系统角度来看，文件系统是对文件存储设备的空间进行组织和分配，负责文件存储并对存入的文件进行保护和检索的系统。<br> 具体地说，它负责为用户建立文件，存入、读出、修改、转储文件，控制文件的存取<br> 文件系统组成：<br> 1)文件系统接口<br> 2)对对像管理的软件集合<br> 3)对象及属性</p> </li></ul> 
<h3><a id="2GlusterFS_20"></a>2、GlusterFS特点</h3> 
<ul><li>【1】扩展性和高性能</li><li>【2】高可用性</li><li>【3】全局统一命名空间</li><li>【4】弹性卷管理</li><li>【5】基于标准协议</li></ul> 
<h3><a id="3GlusterFS_26"></a>3、GlusterFS术语</h3> 
<ul><li>Brick（块存储）：由主机提供的用于物理存储的专用分区，是GlusterFS中的基本存储单元，同时也是可信存储池中服务器上对外提供的存储目录。</li><li>Volume（逻辑卷）：一个逻辑卷是一组 Brick 的集合。卷是数据存储的逻辑设备，类似于 LVM 中的逻辑卷。大部分 Gluster 管理操作是在卷上进行的。</li><li>FUSE：用户空间的文件系统（类别EXT4），”这是一个伪文件系统“，用户端的交换模块</li><li>VFS（虚拟端口）：内核态的虚拟文件系统，用户是提交请求给VFS 然后VFS交给FUSH，再交给GFS客户端，最后由客户端交给远端的存储<br> Glusterd（服务）：是运行再存储节点的进程（客户端运行的是gluster client）GFS使用过程中整个GFS之间的交换由Gluster client 和glusterd完成</li></ul> 
<h3><a id="4GlusterFS_32"></a>4、GlusterFS的工作流程</h3> 
<p><img src="https://images2.imgbox.com/ee/e6/0DCKyRMV_o.png" alt="在这里插入图片描述"></p> 
<ul><li>1、外来一个请求，例：用户端申请创建一个文件，客户端或应用程序通过GFS的挂载点访问数据</li><li>2、linux系统内容通过VFSAPI收到请求并处理</li><li>3、VFS将数据递交给FUSE内核文件系统，fuse文件系统则是将数据通过/dev/fuse设备文件递交给了GlusterFS client端</li><li>4、GlusterFS client端收到数据后，会根据配置文件的配置对数据进行处理</li><li>5、再通过网络，将数据发送给远端的ClusterFS server，并将数据写入到服务器储存设备上</li><li>6、server再将数据转交给VFS伪文件系统，再由VFS进行转存处理，最后交给EXT3</li></ul> 
<h3><a id="5GFS_40"></a>5、GFS卷类型</h3> 
<ul><li>分布式卷</li><li>条带卷</li><li>复制卷</li><li>分布式条带卷</li><li>分布式复制卷</li><li>条带复制卷</li><li>分布式条带数据卷</li></ul> 
<h3><a id="6_48"></a>6、三大基本卷的特点</h3> 
<h4><a id="_49"></a>①、分布式卷</h4> 
<ul><li>文件分布在不同的服务器，不具备冗余性</li><li>更容易和廉价地扩展卷的大小</li><li>单点故障会造成数据丢失</li><li>依赖底层的数据保护</li></ul> 
<h4><a id="_54"></a>②、条带卷</h4> 
<ul><li>数据被分割成更小块分布到块服务器群中的不同条带区</li><li>分布减少了负载且更小的文件加速了存取的速度</li><li>没有数据冗余</li></ul> 
<h4><a id="_58"></a>③、复制卷</h4> 
<ul><li>卷中所有的服务器均保存一个完整的副本</li><li>卷的副本数量可由客户创建的时候决定</li><li>至少由两个块服务器或更多服务器</li><li>具备冗余性</li></ul> 
<h2><a id="_63"></a>二、相关维护命令</h2> 
<h3><a id="1GlusterFS_64"></a>1、查看GlusterFS卷</h3> 
<pre><code class="prism language-javascript">gluster volume list 
</code></pre> 
<h3><a id="2_68"></a>2、查看所有卷的信息</h3> 
<pre><code class="prism language-javascript">gluster volume info
</code></pre> 
<h3><a id="3_72"></a>3、查看所有卷的状态</h3> 
<pre><code class="prism language-javascript">gluster volume status
</code></pre> 
<h3><a id="4_76"></a>4、停止一个卷</h3> 
<pre><code class="prism language-javascript">gluster volume stop dis<span class="token operator">-</span>stripe
</code></pre> 
<h3><a id="5_80"></a>5、删除一个卷</h3> 
<ul><li>注意：删除卷时，需要先停止卷，且信任池中不能有主机处于宕机状态，否则删除不成功</li></ul> 
<pre><code class="prism language-javascript">gluster volume <span class="token keyword">delete</span> dis<span class="token operator">-</span>stripe
</code></pre> 
<h3><a id="6_85"></a>6．设置卷的访问控制</h3> 
<p>仅拒绝</p> 
<pre><code class="prism language-javascript">gluster volume <span class="token keyword">set</span> dis<span class="token operator">-</span>rep auth<span class="token punctuation">.</span>allow <span class="token number">192.168</span><span class="token number">.10</span><span class="token number">.100</span>
</code></pre> 
<p>仅拒绝</p> 
<pre><code class="prism language-javascript">gluster volume <span class="token keyword">set</span> dis<span class="token operator">-</span>rep auth<span class="token punctuation">.</span>allow <span class="token number">192.168</span><span class="token number">.10</span><span class="token punctuation">.</span><span class="token operator">*</span>	  #设置<span class="token number">192.168</span><span class="token number">.163</span><span class="token number">.0</span>网段的所有<span class="token constant">IP</span>地址都能访问dis<span class="token operator">-</span>rep卷（分布式复制卷）
</code></pre> 
<h2><a id="GFS_94"></a>三、GFS部署</h2> 
<p>集群环境准备</p> 
<table><thead><tr><th>节点名称</th><th>ip地址</th><th>磁盘</th><th>挂载点</th></tr></thead><tbody><tr><td>Node1节点</td><td>192.168.10.15</td><td>/dev/sdb1<br>/dev/sdc1<br>/dev/sdd1<br>/dev/sde1</td><td>/data/sdb1<br>/data/sdc1<br>/data/sdd1<br>/data/sde1</td></tr><tr><td>Node2节点</td><td>192.168.10.16</td><td>/dev/sdb1<br>/dev/sdc1<br>/dev/sdd1<br>/dev/sde1</td><td>/data/sdb1<br>/data/sdc1<br>/data/sdd1<br>/data/sde1</td></tr><tr><td>Node3节点</td><td>192.168.10.17</td><td>/dev/sdb1<br>/dev/sdc1<br>/dev/sdd1<br>/dev/sde1</td><td>/data/sdb1<br>/data/sdc1<br>/data/sdd1<br>/data/sde1</td></tr><tr><td>Node4节点</td><td>192.168.10.18</td><td>/dev/sdb1<br>/dev/sdc1<br>/dev/sdd1<br>/dev/sde1</td><td>/data/sdb1<br>/data/sdc1<br>/data/sdd1<br>/data/sde1</td></tr><tr><td>客户端</td><td>192.168.10.19</td><td></td><td></td></tr></tbody></table> 
<p>== 所有节点更改名称，方便识别==<br> == 关防火墙（所有节点和客户端）==</p> 
<h3><a id="1_105"></a>1、部署节点集群</h3> 
<pre><code class="prism language-javascript">#关闭防火墙
systemctl stop firewalld
setenforce <span class="token number">0</span>

#磁盘分区，并进行挂载
vim <span class="token operator">/</span>opt<span class="token operator">/</span>fdisk<span class="token punctuation">.</span>sh
#<span class="token operator">!</span><span class="token operator">/</span>bin<span class="token operator">/</span>bash
<span class="token constant">NEWDEV</span><span class="token operator">=</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">ls /dev/sd* | grep -o 'sd[b-z]' | uniq</span><span class="token template-punctuation string">`</span></span>
<span class="token keyword">for</span> <span class="token constant">VAR</span> <span class="token keyword">in</span> $<span class="token constant">NEWDEV</span>
<span class="token keyword">do</span>
   echo <span class="token operator">-</span>e <span class="token string">"n\np\n\n\n\nw\n"</span> <span class="token operator">|</span> fdisk <span class="token operator">/</span>dev<span class="token operator">/</span>$<span class="token constant">VAR</span> <span class="token operator">&amp;</span><span class="token operator">&gt;</span> <span class="token operator">/</span>dev<span class="token operator">/</span><span class="token keyword">null</span>
   mkfs<span class="token punctuation">.</span>xfs <span class="token operator">/</span>dev<span class="token operator">/</span>$<span class="token punctuation">{<!-- --></span><span class="token constant">VAR</span><span class="token punctuation">}</span><span class="token string">"1"</span> <span class="token operator">&amp;</span><span class="token operator">&gt;</span> <span class="token operator">/</span>dev<span class="token operator">/</span><span class="token keyword">null</span>
   mkdir <span class="token operator">-</span>p <span class="token operator">/</span>data<span class="token operator">/</span>$<span class="token punctuation">{<!-- --></span><span class="token constant">VAR</span><span class="token punctuation">}</span><span class="token string">"1"</span> <span class="token operator">&amp;</span><span class="token operator">&gt;</span> <span class="token operator">/</span>dev<span class="token operator">/</span><span class="token keyword">null</span>
   echo <span class="token string">"/dev/${VAR}"</span><span class="token number">1</span><span class="token string">" /data/${VAR}"</span><span class="token number">1</span><span class="token string">" xfs defaults 0 0"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>fstab
done
mount <span class="token operator">-</span>a <span class="token operator">&amp;</span><span class="token operator">&gt;</span> <span class="token operator">/</span>dev<span class="token operator">/</span><span class="token keyword">null</span>

cd <span class="token operator">/</span>opt
chmod <span class="token operator">+</span>x fdisk<span class="token punctuation">.</span>sh
<span class="token punctuation">.</span><span class="token operator">/</span>fdisk<span class="token punctuation">.</span>sh

#配置各个节点的<span class="token operator">/</span>etc<span class="token operator">/</span>hosts文件（所有节点操作）
echo <span class="token string">"192.168.10.15 node1"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
echo <span class="token string">"192.168.10.16 node2"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
echo <span class="token string">"192.168.10.17 node3"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
echo <span class="token string">"192.168.10.18 node4"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts

#安装、启动<span class="token constant">GFS</span>（所有节点操作）
unzip gfsrepo<span class="token punctuation">.</span>zip
cd <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>
mv <span class="token operator">*</span> repos<span class="token punctuation">.</span>bak<span class="token operator">/</span>
vim glfs<span class="token punctuation">.</span>repo
<span class="token punctuation">[</span>glfs<span class="token punctuation">]</span>
name<span class="token operator">=</span>glfs
baseurl<span class="token operator">=</span>file<span class="token operator">:</span><span class="token operator">/</span><span class="token comment">//opt/gfsrepo</span>
gpgcheck<span class="token operator">=</span><span class="token number">0</span>
enabled<span class="token operator">=</span><span class="token number">1</span>

yum clean all <span class="token operator">&amp;&amp;</span> yum makecache

yum <span class="token operator">-</span>y install glusterfs glusterfs<span class="token operator">-</span>server glusterfs<span class="token operator">-</span>fuse glusterfs<span class="token operator">-</span>rdma

systemctl start glusterd<span class="token punctuation">.</span>service
systemctl enable glusterd<span class="token punctuation">.</span>service
systemctl status glusterd<span class="token punctuation">.</span>service

#添加<span class="token constant">DNS</span>，进行时间同步
echo <span class="token string">"nameserver 114.114.114.114"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>resolv<span class="token punctuation">.</span>conf
ntpdate ntp1<span class="token punctuation">.</span>aliyun<span class="token punctuation">.</span>com

#添加节点到存储信任池中（在任意一个node中操作）
gluster peer probe node1
gluster peer probe node2
gluster peer probe node3
gluster peer probe node4

#在每个node节点上查看群集状态
gluster peer status

<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span>根据以下规划创建卷<span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span>
卷名称 				卷类型				Brick
dis<span class="token operator">-</span>volume			分布式卷			<span class="token function">node1</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdb1<span class="token punctuation">)</span><span class="token function">、node2</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdb1<span class="token punctuation">)</span>
stripe<span class="token operator">-</span>volume		条带卷			<span class="token function">node1</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdc1<span class="token punctuation">)</span><span class="token function">、node2</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdc1<span class="token punctuation">)</span>
rep<span class="token operator">-</span>volume			复制卷			<span class="token function">node3</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdb1<span class="token punctuation">)</span><span class="token function">、node4</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdb1<span class="token punctuation">)</span>
dis<span class="token operator">-</span>stripe			分布式条带卷		<span class="token function">node1</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdd1<span class="token punctuation">)</span><span class="token function">、node2</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdd1<span class="token punctuation">)</span><span class="token function">、node3</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdd1<span class="token punctuation">)</span><span class="token function">、node4</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sdd1<span class="token punctuation">)</span>
dis<span class="token operator">-</span>rep				分布式复制卷		<span class="token function">node1</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sde1<span class="token punctuation">)</span><span class="token function">、node2</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sde1<span class="token punctuation">)</span><span class="token function">、node3</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sde1<span class="token punctuation">)</span><span class="token function">、node4</span><span class="token punctuation">(</span><span class="token operator">/</span>data<span class="token operator">/</span>sde1<span class="token punctuation">)</span>

#创建分布式卷，没有指定类型，默认创建的是分布式卷
gluster volume create dis<span class="token operator">-</span>volume node1<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdb1 node2<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdb1 force
gluster volume list
gluster volume start dis<span class="token operator">-</span>volume
gluster volume info dis<span class="token operator">-</span>volume

#指定类型为 stripe，数值为 <span class="token number">2</span>，且后面跟了 <span class="token number">2</span> 个 Brick Server，所以创建的是条带卷
gluster volume create stripe<span class="token operator">-</span>volume stripe <span class="token number">2</span> node1<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdc1 node2<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdc1 force
gluster volume start stripe<span class="token operator">-</span>volume
gluster volume info stripe<span class="token operator">-</span>volume

#指定类型为 replica，数值为 <span class="token number">2</span>，且后面跟了 <span class="token number">2</span> 个 Brick Server，所以创建的是复制卷
gluster volume create rep<span class="token operator">-</span>volume replica <span class="token number">2</span> node3<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdb1 node4<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdb1 force
gluster volume start rep<span class="token operator">-</span>volume
gluster volume info rep<span class="token operator">-</span>volume

#创建分布式条带卷
gluster volume create dis<span class="token operator">-</span>stripe stripe <span class="token number">2</span> node1<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdd1 node2<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdd1 node3<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdd1 node4<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sdd1 force
gluster volume start dis<span class="token operator">-</span>stripe
gluster volume info dis<span class="token operator">-</span>stripe

#创建分布式复制卷
gluster volume create dis<span class="token operator">-</span>rep replica <span class="token number">2</span> node1<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sde1 node2<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sde1 node3<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sde1 node4<span class="token operator">:</span><span class="token operator">/</span>data<span class="token operator">/</span>sde1 force
gluster volume start dis<span class="token operator">-</span>rep
gluster volume info dis<span class="token operator">-</span>rep 
</code></pre> 
<p><img src="https://images2.imgbox.com/08/f5/uSVTfgt1_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/43/ee/vEkZsQ9u_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/1c/61/KRUaTgHo_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/c3/c2/kdbtEpON_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="2gluster_204"></a>2、部署gluster客户端</h3> 
<pre><code class="prism language-javascript">cd <span class="token operator">/</span>opt
unzip gfsrepo<span class="token punctuation">.</span>zip 

cd <span class="token operator">/</span>etc<span class="token operator">/</span>yum<span class="token punctuation">.</span>repos<span class="token punctuation">.</span>d<span class="token operator">/</span>
mv <span class="token operator">*</span> repos<span class="token punctuation">.</span>bak<span class="token operator">/</span>

vim glfs<span class="token punctuation">.</span>repo
<span class="token punctuation">[</span>glfs<span class="token punctuation">]</span>
name<span class="token operator">=</span>glfs
baseurl<span class="token operator">=</span>file<span class="token operator">:</span><span class="token operator">/</span><span class="token comment">//opt/gfsrepo</span>
gpgcheck<span class="token operator">=</span><span class="token number">0</span>
enabled<span class="token operator">=</span><span class="token number">1</span>

yum clean all <span class="token operator">&amp;&amp;</span> yum makecache

yum <span class="token operator">-</span>y install glusterfs glusterfs<span class="token operator">-</span>fuse

mkdir <span class="token operator">-</span>p <span class="token operator">/</span>test<span class="token operator">/</span><span class="token punctuation">{<!-- --></span>dis<span class="token punctuation">,</span>stripe<span class="token punctuation">,</span>rep<span class="token punctuation">,</span>dis_stripe<span class="token punctuation">,</span>dis_rep<span class="token punctuation">}</span>

echo <span class="token string">"192.168.10.15 node1"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
echo <span class="token string">"192.168.10.16 node2"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
echo <span class="token string">"192.168.10.17 node3"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
echo <span class="token string">"192.168.10.18 node4"</span> <span class="token operator">&gt;&gt;</span> <span class="token operator">/</span>etc<span class="token operator">/</span>hosts

mount<span class="token punctuation">.</span>glusterfs node1<span class="token operator">:</span>dis<span class="token operator">-</span>volume <span class="token operator">/</span>test<span class="token operator">/</span>dis
mount<span class="token punctuation">.</span>glusterfs node1<span class="token operator">:</span>stripe<span class="token operator">-</span>volume <span class="token operator">/</span>test<span class="token operator">/</span>stripe
mount<span class="token punctuation">.</span>glusterfs node1<span class="token operator">:</span>rep<span class="token operator">-</span>volume <span class="token operator">/</span>test<span class="token operator">/</span>rep
mount<span class="token punctuation">.</span>glusterfs node1<span class="token operator">:</span>dis<span class="token operator">-</span>stripe <span class="token operator">/</span>test<span class="token operator">/</span>dis_stripe
mount<span class="token punctuation">.</span>glusterfs node1<span class="token operator">:</span>dis<span class="token operator">-</span>rep <span class="token operator">/</span>test<span class="token operator">/</span>dis_rep

df <span class="token operator">-</span>h
</code></pre> 
<p><img src="https://images2.imgbox.com/44/c1/ucOUmOOZ_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/31/1d/gtPrnJJ8_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/59/24/kbtEKjG4_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="3_Gluster__241"></a>3、测试 Gluster 文件系统</h3> 
<pre><code class="prism language-javascript">#客户端写入数据
cd <span class="token operator">/</span>opt
dd <span class="token keyword">if</span><span class="token operator">=</span><span class="token operator">/</span>dev<span class="token operator">/</span>zero <span class="token keyword">of</span><span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>demo1<span class="token punctuation">.</span>log bs<span class="token operator">=</span><span class="token number">1</span>M count<span class="token operator">=</span><span class="token number">40</span>
dd <span class="token keyword">if</span><span class="token operator">=</span><span class="token operator">/</span>dev<span class="token operator">/</span>zero <span class="token keyword">of</span><span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>demo2<span class="token punctuation">.</span>log bs<span class="token operator">=</span><span class="token number">1</span>M count<span class="token operator">=</span><span class="token number">40</span>
dd <span class="token keyword">if</span><span class="token operator">=</span><span class="token operator">/</span>dev<span class="token operator">/</span>zero <span class="token keyword">of</span><span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>demo3<span class="token punctuation">.</span>log bs<span class="token operator">=</span><span class="token number">1</span>M count<span class="token operator">=</span><span class="token number">40</span>
dd <span class="token keyword">if</span><span class="token operator">=</span><span class="token operator">/</span>dev<span class="token operator">/</span>zero <span class="token keyword">of</span><span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>demo4<span class="token punctuation">.</span>log bs<span class="token operator">=</span><span class="token number">1</span>M count<span class="token operator">=</span><span class="token number">40</span>
dd <span class="token keyword">if</span><span class="token operator">=</span><span class="token operator">/</span>dev<span class="token operator">/</span>zero <span class="token keyword">of</span><span class="token operator">=</span><span class="token operator">/</span>opt<span class="token operator">/</span>demo5<span class="token punctuation">.</span>log bs<span class="token operator">=</span><span class="token number">1</span>M count<span class="token operator">=</span><span class="token number">40</span>

ls <span class="token operator">-</span>lh <span class="token operator">/</span>opt

cp demo<span class="token operator">*</span> <span class="token operator">/</span>test<span class="token operator">/</span>dis
cp demo<span class="token operator">*</span> <span class="token operator">/</span>test<span class="token operator">/</span>stripe<span class="token operator">/</span>
cp demo<span class="token operator">*</span> <span class="token operator">/</span>test<span class="token operator">/</span>rep<span class="token operator">/</span>
cp demo<span class="token operator">*</span> <span class="token operator">/</span>test<span class="token operator">/</span>dis_stripe<span class="token operator">/</span>
cp demo<span class="token operator">*</span> <span class="token operator">/</span>test<span class="token operator">/</span>dis_rep<span class="token operator">/</span>

#查看文件分布
<span class="token number">1</span>、查看分布式文件分布
node1：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdb1
node2：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdb1
<span class="token number">2</span>、查看条带卷文件分布
node1：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdc1
node2：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdc1
<span class="token number">3</span>、查看复制卷文件分布
node3：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdb1
node4：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdb1
<span class="token number">4</span>、查看分布式条带卷分布
node1：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdd1
node2：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdd1
node3：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdd1
node4：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdd1
<span class="token number">5</span>、查看分布式复制卷分布
node1：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sde1
node2：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sde1
node3：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sde1
node4：ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sde1
</code></pre> 
<p><img src="https://images2.imgbox.com/06/78/gP3BtIMX_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/76/08/EaLRQKvN_o.png" alt="在这里插入图片描述"></p> 
<ul><li>查看卷对应的磁盘分区中的文件数据，验证结果</li></ul> 
<h4><a id="_283"></a>①、查看分布式文件分布</h4> 
<p><strong>node1:/dev/sdb1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdb1
</code></pre> 
<p><img src="https://images2.imgbox.com/8c/a2/fKdaBNCG_o.png" alt="在这里插入图片描述"><br> <strong>node2:/dev/sdb1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdb1
</code></pre> 
<p><img src="https://images2.imgbox.com/4d/3e/PFfUIOE2_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>现象：分布式只会将demo文件分开存储（5个文件不在同一磁盘分区上），不会将数据分片和备份</strong></li></ul> 
<h4><a id="_295"></a>②、查看条带卷文件分布</h4> 
<p><strong>node1:/dev/sdc1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdc1
</code></pre> 
<p><img src="https://images2.imgbox.com/c9/5c/8YVLIeq1_o.png" alt="在这里插入图片描述"><br> <strong>node2:/dev/sdc1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdc1
</code></pre> 
<p><img src="https://images2.imgbox.com/6e/7c/EQEEeoDU_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>现象：条带卷会将每个demo文件中的数据分片存储（两个分区各有20M的文件），没有备份</strong></li></ul> 
<h4><a id="_307"></a>③、查看复制卷文件分布</h4> 
<p><strong>node3:/dev/sdb1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdb1
</code></pre> 
<p><img src="https://images2.imgbox.com/f2/fd/o1nau1WN_o.png" alt="在这里插入图片描述"><br> <strong>node4:/dev/sdb1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdb1
</code></pre> 
<p><img src="https://images2.imgbox.com/70/41/t6VQUeNY_o.png" alt="在这里插入图片描述"><br> <strong>- 现象：复制卷会将每个文件放入卷中的磁盘分区中（两分区的文件一样）</strong></p> 
<h4><a id="_319"></a>④、查看分布式条带卷分布</h4> 
<p><strong>node1:/dev/sdd1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdd1
</code></pre> 
<p><img src="https://images2.imgbox.com/79/d9/vJoKHxc6_o.png" alt="在这里插入图片描述"><br> <strong>node2:/dev/sdd1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdd1
</code></pre> 
<p><img src="https://images2.imgbox.com/ab/8e/WXFTQv6a_o.png" alt="在这里插入图片描述"><br> <strong>node3:/dev/sdd1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdd1
</code></pre> 
<p><img src="https://images2.imgbox.com/b4/c8/qEZelJUz_o.png" alt="在这里插入图片描述"><br> <strong>node4:/dev/sdd1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sdd1
</code></pre> 
<p><img src="https://images2.imgbox.com/23/c1/qTt2XJeW_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>现象：分布式条带卷中，带有分布式和条带卷的特点，即将数据分片，又将文件分开存储，没有备份</strong></li></ul> 
<h4><a id="_341"></a>⑤、查看分布式复制卷分布</h4> 
<p><strong>node1:/dev/sde1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sde1
</code></pre> 
<p><img src="https://images2.imgbox.com/53/eb/06TEfY1F_o.png" alt="在这里插入图片描述"><br> <strong>node2:/dev/sde1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sde1
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/27/VyMJNZx9_o.png" alt="在这里插入图片描述"><br> <strong>node3:/dev/sde1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sde1
</code></pre> 
<p><img src="https://images2.imgbox.com/f9/8e/x0lb58ef_o.png" alt="在这里插入图片描述"><br> <strong>node4:/dev/sde1</strong></p> 
<pre><code class="prism language-javascript">ll <span class="token operator">-</span>h <span class="token operator">/</span>data<span class="token operator">/</span>sde1
</code></pre> 
<p><img src="https://images2.imgbox.com/e0/f2/Mr9Ovm1x_o.png" alt="在这里插入图片描述"></p> 
<ul><li><strong>现象：分布式复制卷中，带有分布式和复制卷的特点，即将文件分开存储，又复制一遍文件（备份）</strong></li></ul> 
<h3><a id="4_363"></a>4、破坏性测试</h3> 
<ul><li>node2和node4的服务器进行挂机来模拟故障，然后在客户端上查看其他服务器的文件是否正常</li></ul> 
<h4><a id="node2demo5log_365"></a>①、分布式卷数据（可查看，但缺少node2的demo5.log）</h4> 
<p><img src="https://images2.imgbox.com/30/ca/XnpwTwTO_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_367"></a>②、条带卷（不可查看，不具备冗余）</h4> 
<p><img src="https://images2.imgbox.com/16/7e/9NCig2mB_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="__369"></a>③、复制卷（可查看 ，有冗余）</h4> 
<p><img src="https://images2.imgbox.com/cb/60/IUyH8rq8_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_371"></a>④、分布式条带卷（不可查看，不具备冗余）</h4> 
<p><img src="https://images2.imgbox.com/a2/41/Gy4FIsD1_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="__373"></a>⑤、分布式复制卷（可查看 ，有冗余）</h4> 
<p><img src="https://images2.imgbox.com/b6/ff/26SPKhuT_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="gluster_375"></a>四、gluster命令</h2> 
<pre><code class="prism language-javascript">gluster <span class="token punctuation">[</span>参数<span class="token punctuation">]</span>
</code></pre> 
<table><thead><tr><th>常用参数</th><th>说明</th></tr></thead><tbody><tr><td>peer probe 节点</td><td>添加节点</td></tr><tr><td>peer detach 节点</td><td>删除节点</td></tr><tr><td>peer status 节点</td><td>节点状态</td></tr><tr><td>volume start 卷名</td><td>启动卷</td></tr><tr><td>volume stop 卷名</td><td>停止卷</td></tr><tr><td>volume delete 卷名</td><td>删除卷</td></tr><tr><td>volume list</td><td>列出卷</td></tr><tr><td>volume info</td><td>查看卷信息</td></tr><tr><td>volume status</td><td>查看卷状态</td></tr></tbody></table> 
<h2><a id="_390"></a>总结</h2> 
<p>分布式卷：属于文件级的RAID0，不具备容错能力，如果有一块磁盘损坏，数据就丢失<br> 条带卷：类似RAID0，文件将被分成数据块并以轮询方式分布到Brick server上<br> 复制卷：将文件同步到多个Brick上，属于文件RAID1,数据分数在多个Brick中<br> 分布式条带卷：Brick server 数量是条带数兼具分布式卷和条带卷的特定<br> 分布式复制卷：Brick server数量是镜像数，兼具分布式卷和复制卷的特点<br> 条带复制卷:类似RAID10，同时具有条带卷和复制卷的特点<br> 分布式条带复制卷：三种基本卷的集合</p> 
<p>在企业中数据的安全性是非常重要的，不具备冗余的卷是不会被企业所接受，所以使用频率较高的就是冗余性好的几种，例如本章讲的复制卷、分布式复制卷，还有没讲的条带复制卷和分布式条带复制卷了。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a5f1cc099654803d246c6b42de630547/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java复习回顾排序方法，异常的处理方式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/104e44290de33971700c53c36866c4a5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Paddlehub使用说明（一）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>