<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java培训SpringBoot 实现 Office 各种格式在线预览 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java培训SpringBoot 实现 Office 各种格式在线预览" />
<meta property="og:description" content="1.项目特性
支持word excel ppt，pdf等办公文档支持txt,java,php,py,md,js,css等所有纯文本支持zip,rar,jar,tar,gzip等压缩包支持jpg，jpeg，png，gif等图片预览（翻转，缩放，镜像）支持mp3，mp4，flv等多媒体文件预览使用spring boot开发，预览服务搭建部署非常简便rest接口提供服务，跨平台特性(java,php,python,go,php，....)都支持，应用接入简单方便支持普通http/https文件下载url、http/https文件下载流url、ftp下载url等多种预览源提供zip，tar.gz发行包，提供一键启动脚本和丰富的配置项，方便部署使用提供Docker镜像发行包，方便在容器环境部署抽象预览服务接口，方便二次开发，非常方便添加其他类型文件预览支持最最重要Apache协议开源，代码pull下来想干嘛就干嘛 2.部署过程
部署方式，可以直接下载二进制步骤，也可以通过docker直接拉取，还可以通过源码编绎进行，下面分别说明
前提条件：Jdk需要先安装设置好，kkFileWiew是Java开发的，Jdk必需。
tar -xvf jdk-8u191-linux-x64.tar.gz -C /usr/local
cat &gt;&gt; /etc/profile &lt;&lt; EOF
export JAVA_HOME=/usr/local/jdk1.8.0_191/
export PATH=\$JAVA_HOME/bin:\$PATH
export CLASSPATH=.:\$JAVA_HOME/lib/dt.jar:\$JAVA_HOME/lib/tools.jar
EOF
source /etc/profile
[root@localhost testuser]# java -version
java version &#34;1.8.0_191&#34;
Java(TM) SE Runtime Environment (build 1.8.0_191-b12)
Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)
2.1 二进制下载部署文件进行部署
1.从码云发行版本下载最新版发行包，这里只以linux为例，一般服务器都是linux的，如果用windows也可，看官网说明进行。
2.解压kkFileView-x.x.x文件（Windows用.zip包，Linux/MacOS用.tar.gz包），如：
tar xvf kkFileView-4.0.0.tar.gz -C /opt/
3.运行startup脚本（Windows下以管理员身份运行startup.bat，Linux以root用户运行startup.sh）
cd /opt/kkFileView-4.0.0/bin
注：linux下kkFileWiew需要LibreOffice的支持，因此startup.sh会判断系统是否已安装LibreOffice,如果没有安装，将自动下载安装，因此需要有互联网环境的支持，如果是内网的机器，可以考虑在一台有互联网环境下的机器上搭建一个http代理服务器，然后通过export命令设置通过代理下载，如在192.168.56.1上搭建了一个http代理（设置了账号和密码），可以通过如下命令执行，然后再执行startup.sh
export http_proxy=http://admin:admin123@192.168.56.1:1080
export https_proxy=http://admin:admin123@192.168.56.1:1080
export no_proxy=&#39;127.0.0.1&#39;
运行startup.sh" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f70a00e31f02ac6731abca757121ce4e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-06-02T11:33:05+08:00" />
<meta property="article:modified_time" content="2022-06-02T11:33:05+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java培训SpringBoot 实现 Office 各种格式在线预览</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>1.项目特性</strong></p> 
<ul><li>支持word excel ppt，pdf等办公文档</li><li>支持txt,java,php,py,md,js,css等所有纯文本</li><li>支持zip,rar,jar,tar,gzip等压缩包</li><li>支持jpg，jpeg，png，gif等图片预览（翻转，缩放，镜像）</li><li>支持mp3，mp4，flv等多媒体文件预览</li><li>使用spring boot开发，预览服务搭建部署非常简便</li><li>rest接口提供服务，跨平台特性(java,php,python,go,php，....)都支持，应用接入简单方便</li><li>支持普通http/https文件下载url、http/https文件下载流url、ftp下载url等多种预览源</li><li>提供zip，tar.gz发行包，提供一键启动脚本和丰富的配置项，方便部署使用</li><li>提供Docker镜像发行包，方便在容器环境部署</li><li>抽象预览服务接口，方便二次开发，非常方便添加其他类型文件预览支持</li><li>最最重要Apache协议开源，代码pull下来想干嘛就干嘛</li></ul> 
<p><strong>2.部署过程</strong></p> 
<p>部署方式，可以直接下载二进制步骤，也可以通过docker直接拉取，还可以通过源码编绎进行，下面分别说明</p> 
<p>前提条件：Jdk需要先安装设置好，kkFileWiew是Java开发的，Jdk必需。</p> 
<p>tar -xvf jdk-8u191-linux-x64.tar.gz -C /usr/local</p> 
<p>cat &gt;&gt; /etc/profile &lt;&lt; EOF</p> 
<p>export JAVA_HOME=/usr/local/jdk1.8.0_191/</p> 
<p>export PATH=\$JAVA_HOME/bin:\$PATH</p> 
<p>export CLASSPATH=.:\$JAVA_HOME/lib/dt.jar:\$JAVA_HOME/lib/tools.jar</p> 
<p>EOF</p> 
<p>source /etc/profile</p> 
<p>[root@localhost testuser]# java -version</p> 
<p>java version "1.8.0_191"</p> 
<p>Java(TM) SE Runtime Environment (build 1.8.0_191-b12)</p> 
<p>Java HotSpot(TM) 64-Bit Server VM (build 25.191-b12, mixed mode)</p> 
<p><strong>2.1 二进制下载部署文件进行部署</strong></p> 
<p>1.从码云发行版本下载最新版发行包，这里只以linux为例，一般服务器都是linux的，如果用windows也可，看官网说明进行。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/10/20/3Sb2dtDU_o.png"></p> 
<p> </p> 
<p>2.解压kkFileView-x.x.x文件（Windows用.zip包，Linux/MacOS用.tar.gz包），如：</p> 
<p>tar xvf kkFileView-4.0.0.tar.gz -C /opt/</p> 
<p>3.运行startup脚本（Windows下以管理员身份运行startup.bat，Linux以root用户运行startup.sh）</p> 
<p>cd /opt/kkFileView-4.0.0/bin</p> 
<p>注：linux下kkFileWiew需要LibreOffice的支持，因此startup.sh会判断系统是否已安装LibreOffice,如果没有安装，将自动下载安装，因此需要有互联网环境的支持，如果是内网的机器，可以考虑在一台有互联网环境下的机器上搭建一个http代理服务器，然后通过export命令设置通过代理下载，如在192.168.56.1上搭建了一个http代理（设置了账号和密码），可以通过如下命令执行，然后再执行startup.sh</p> 
<p>export http_proxy=http://admin:admin123@192.168.56.1:1080</p> 
<p>export https_proxy=http://admin:admin123@192.168.56.1:1080</p> 
<p>export no_proxy='127.0.0.1'</p> 
<p>运行startup.sh</p> 
<p>[root@localhost bin]# ./startup.sh</p> 
<p>Using KKFILEVIEW_BIN_FOLDER /opt/kkFileView-4.0.0/bin</p> 
<p>Installing OpenOffice</p> 
<p>Loaded plugins: fastestmirror</p> 
<p>Determining fastest mirrors</p> 
<p>........略</p> 
<p>Complete!</p> 
<p>Loaded plugins: fastestmirror</p> 
<p>No such command: installlocalho. Please use /usr/bin/yum --help</p> 
<p>install finshed...</p> 
<p>Starting kkFileView...</p> 
<p>Please execute ./showlog.sh to check log for more information</p> 
<p>You can get help in our official homesite: https://kkFileView.keking.cn</p> 
<p>If this project is helpful to you, please star it on https://gitee.com/kekingcn/file-online-preview/stargazers</p> 
<p>4.按步骤3的提示执行./showlog.sh查看启动日志，报错,需要解决office.home的问题：</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/6e/b5/vvP0GlW6_o.png"></p> 
<p> </p> 
<p>./startup.sh报错，不是一键部署吗？官网直接说.startup.sh难道有坑？查看startup.sh中，定定了几个目录/opt/libpreoffice*，根据官网说的，4.0版本后依赖libpreoffice,继续看/opt目录下，没看到libpreoffice目录存在，说明libpreoffice未安装成功_<a class="link-info" href="http://www.atguigu.com" rel="nofollow" title="java培训">java培训</a>。</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/9f/78/K9Kid8Xp_o.png"></p> 
<p> </p> 
<p>/opt目录下，没看到libpreoffice目录存在，说明libpreoffice未安装成功，如下：</p> 
<p>[root@localhost opt]# ls -hl /opt/</p> 
<p>total 0</p> 
<p>drwxr-xr-x. 5 root root 42 Aug 20 13:05 kkFileView-4.0.0</p> 
<p>继续看，发现没有安装的情况是要执行install.sh的</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/25/e6/tTkHyahx_o.png"></p> 
<p> </p> 
<p>install.sh如下</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/7d/57/y5jQy8zR_o.png"></p> 
<p> </p> 
<p>看着像是会执行安装的，cd /tmp/LibreOffice_7.1.4.2_Linux_x86-64_rpm/RPMS查看，也确实是下载了很多包</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/6a/de/YVcKc2nn_o.png"></p> 
<p> </p> 
<p>手工再执行一次安装看看</p> 
<p>cd /tmp/LibreOffice_7.1.4.2_Linux_x86-64_rpm/RPMS</p> 
<p>yum localinstall *.rpm -y</p> 
<p>执行成功后再重启.startup.sh，发现能正常启动了。</p> 
<p>[root@localhost RPMS]# cd /opt/kkFileView-4.0.0/bin/</p> 
<p>[root@localhost bin]# ./startup.sh</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/18/ad/lzesNEMa_o.png"></p> 
<p> </p> 
<p>5.浏览器访问本机8012端口，如：http://192.168.56.101:8012</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/52/71/LPOVTGO5_o.png"></p> 
<p> </p> 
<p>6.使用</p> 
<p>使用较简单：从步骤4中可以看出，通过传递一个经过base64位的外部文件url地址给kkFileView程序即可如：</p> 
<p>http://192.168.56.101:8012/onlinePreview?url=aHR0cDovLzE5Mi4xNjguNTYuMTAxOjgwMTIvZGVtby9hcHBsaWNhdGlvbi5wcm9wZXJ0aWVz</p> 
<p><strong>2.2 docker方式部署</strong></p> 
<p>##拉取镜像</p> 
<p>docker pull keking/kkfileview:v4.0.0 ##官网拉取</p> 
<p>docker pull 192.168.56.1:6000/keking/kkfileview:v4.0.0 ##通过私库拉取（有的话）</p> 
<p>##运行（第一次）</p> 
<p>docker run -itd -p 8012:8012 192.168.56.1:6000/keking/kkfileview:v4.0.0 ##有私库的情况下。</p> 
<p>或</p> 
<p>docker run -itd -p 8012:8012 keking/kkfileview:v4.0.0</p> 
<p>##查看</p> 
<p>docker ps -a</p> 
<p>docker exec -it 1be9d7d654dc /bin/bash</p> 
<p>##停止与启动，</p> 
<p>docker stop 容器id</p> 
<p>docker start 容器id</p> 
<p><strong>2.3 通过源代码编绎部署</strong></p> 
<p>1.下载代码，以4.0.0版本为例</p> 
<p>git clone https://gitee.com/kekingcn/file-online-preview.git</p> 
<p>##切换到v4.0.0版本</p> 
<p>git checkout -b v4.0.0 origin/v4.0.0</p> 
<p>2.编绎</p> 
<p>mvn clean package -Dmaven.test.skip=true</p> 
<p>3.编绎成功后，在file-online-preview\server\target目录下找到对应的二进制文件</p> 
<p>4.再走一遍2.1步骤中的二进制部署方式即可。</p> 
<p><strong>3.部分配置说明</strong></p> 
<p>通过修改application.properties来修改配置，需要重启程序如：</p> 
<p><strong>3.1 server.context-path</strong></p> 
<p>默认的访问路径为/onlinePreview，通过server.context-path进行修改，</p> 
<p><strong>4.预览乱码字体问题</strong></p> 
<p>大部分Linux系统上并没有预装中文字体或字体不全，需要把常用字体拷贝到Linux服务器上，具体操作如下：</p> 
<p>下载如下字体包http://kkfileview.keking.cn/fonts.zip文件解压完整拷贝到Linux下的 /usr/share/fonts目录。然后依次执行mkfontscale 、mkfontdir 、fc-cache使字体生效,可能需要重启kkFileView程序</p> 
<p>unzip -o -d /usr/share/fonts/ fonts.zip</p> 
<p>##解压多了一层，需要移动一下到上一层的fonts下面，然后再删除zhFonts文件夹</p> 
<p>mv /usr/share/fonts/zhFonts/* /usr/share/fonts/</p> 
<p>cd /usr/share/fonts/</p> 
<p>mkfontscale</p> 
<p>mkfontdir</p> 
<p>fc-cache</p> 
<p>如果报mkfontscale命令不存在执行</p> 
<p>yum install mkfontscale -y</p> 
<p>解决乱码前：</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ff/eb/GELXCPwJ_o.png"></p> 
<p> </p> 
<p>解决乱码后：</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/22/ab/sEps8od8_o.png"></p> 
<p> </p> 
<p><strong>5.预览展示</strong></p> 
<p>1.properties</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/25/d0/9lZnL0lT_o.png"></p> 
<p> </p> 
<p>2.pdf</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/0c/a2/he0boz6d_o.png"></p> 
<p> </p> 
<p>3.word</p> 
<p>word也是通过转换成pdf再浏览的</p> 
<p></p> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/21/32/3S7x3MDK_o.png"></p> 
<p> </p> 
<p><strong>6.其他说明</strong></p> 
<p><strong>6.1使用openoffice进行转换</strong></p> 
<p>有时发现liboffice并没有传说官网中说的那么稳定与好，可能是我没用好，我自己转换试验是觉得openoffice更稳定，转换大于10M的word也顺利，反而用官网推荐的liboffice转换，常常崩并把office进程给搞没了，所以我这边一般是使用openoffice进行转换。</p> 
<p>修改application.properties中的配置</p> 
<p>#openoffice home路径</p> 
<p>#office.home = C:\\Program Files (x86)\\OpenOffice 4</p> 
<p>#office.home = ${KK_OFFICE_HOME:default}</p> 
<p>office.home = /opt/openoffice4</p> 
<p>然后进行kkfileView的重启，kkfileView启动时发现/opt/openoffice4目录有安装了openoffice4会以openoffice4进行启动。</p> 
<p><strong>6.2 libXext.so.6: cannot open shared object file: No such file or directory</strong></p> 
<p>#/opt/openoffice4/program/soffice.bin: error while loading shared libraries: libXext.so.6: cannot open shared object file: No such file or directory</p> 
<p>#先执行：</p> 
<p>yum install -y libXext.x86_64</p> 
<p>##然后</p> 
<p>cp -a /usr/lib64/libXext.so.6 /opt/openoffice4/program/</p> 
<p><span style="color:#d7d8d9;">文章来源于Java知音</span></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b05a071daa5b8227cecb0614ed124c58/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">gin 多结构体嵌套 效验范例</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/63a5cd11f23e4e39a184dff8ef13d7c5/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">idea下载插件的两种方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>