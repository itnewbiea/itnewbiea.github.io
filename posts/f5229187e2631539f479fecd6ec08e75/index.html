<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android实现直播的博文和流程（全过程，超详细/附源码） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android实现直播的博文和流程（全过程，超详细/附源码）" />
<meta property="og:description" content="为方便大家阅读，源码先行奉上
github源码链接 https://github.com/Recycle1/Live-video-demo
csdn源码链接 https://download.csdn.net/download/weixin_52263647/85070250
需要注意的一点是！！！：上述的代码需要更改IP地址为你自己的IP地址，博主在做完这个demo后禁用了1935端口号，因此无法直接使用博主的云服务器，同时如果是阿里云服务器，一定要记得在安全组中放行相应的端口号，否则无法正常推流。
最近要做一个有把视频从手机端推流，在另一端拉流功能的app，所以就学习了一下直播功能，这两个功能比较类似，找到了一些收藏点赞比较多的文章，按着他们的记录一步一步的做了下来，但是文章大多都是几年前写的，可能也是我懂的比较少，捣鼓了好几天，按着他们做的照着做，还是出现了各种各样的问题，所以我汇总了一些博文的内容，终于是实现了。
首先准备工作，不光需要有Android stdio，还需要有自己的服务器，这里我租用了阿里云的云服务器（linux系统），之后的文章中，从Android端的编写到服务器端的配置都会有所介绍。最后测试实现的结果，可以先在电脑上下载一个VLC
具体的一些流程是：
在android端调用yaesa库进行摄像头采集、编码，随后向srs服务器rtmp推流在服务器端部署srs流媒体服务器在android端调用vitamio实现取流播放 一 Android端搭建 android实现的功能一个是采集摄像头的内容，然后将视频内容推流到服务器端，另一个是从服务器端拉流到手机播放视频。
以下是我认为比较好的博文
Android直播实现（一）Android端推流、播放
首先需要调用yaesa，链接如下
https://github.com/begeekmyfriend/yasea
将yaesa项目clone下来，对我们有用的就是其中library这部分，我们将这个文件夹作为library导入到自己的android项目中，导入的过程就是在顶部的功能那里，依次点击
File --&gt;new–&gt;import Module
出现上面的画面，我们从里面找到刚才下载的yeasa中的library文件夹，放入里面，导入成功
然后需要在我们自己的项目，也就是app这个目录下导入library这个依赖，具体的方法可以等之后在那些引用外部依赖的代码标红时（出错），看android stdio给的推荐解决方案，点击（import dependence）即导入依赖，也可以直接通过File–&gt;Project Structure-&gt;Dependencies，点击加号添加依赖
然后对于拉流操作，我们需要使用vitamio是实现功能，所以我们同样需要引入vitomio，这里就到了一个大坑！！！
我按着第一篇博文的方法，从他给出的demo
https://github.com/SiKang123/LiveTest
或者从各种博文都推荐的vitomio地址https://github.com/yixia/VitamioBundle 将vitomio导入到android端（和上面的操作一样）
但是，本以为大功告成了，结果vitomio在测试时一直出现问题，找不到vinit.so文件，我查了各种文章，都找不到解决的办法，最后我看到一个博主出现的虽然不是这个问题，但是vitomio也是运行不了，于是他换了一个vitomio的下载地址，没有用上面的链接，成功解决了自己的问题，我试了一下，也是把我的问题解决了
引用vitamio框架提示libffmpeg.so、libstlport_shared.so无法找到的错误
他引用的vitomio项目地址是这个
https://github.com/yixia/VitamioBundleStudio
上面这个是可以用的，但是也需要做一些修改，首先把vitomio文件夹根据我们上面讲到的方法放入自己的项目中，随后更改vitomio文件下的build.gradle文件
改为这样
随后更改vitomio文件夹下的MediaPlayer.java文件
其实这个我也不知道问题出在哪里，后面运行的时候发现这里报错，LIB_ROOT这个变量的值有问题，所以这里我索性去掉了if语句，运行发现没有问题
这样，外部引用库就导入完成了，文件结构长这个样子
之后根据第一篇博文给的链接
https://github.com/SiKang123/LiveTest
把他的xml文件activity文件我们按着他写的写在我们自己的文件里
这样，android端就配置完成了，之后，我们开始配置服务器端
二 服务器端搭建 在服务器搭建这里，不是很了解的也没关系，现在搭建服务器有很多工具，操作起来不是很难，也不需要写很多命令，这里，我是用我租用的阿里云服务器（Linux系统）配置srs流媒体服务器
准备工作
需要有自己的服务器，工具类，我用的是宝塔面板，关于宝塔面板如何安装，使用，以及站点搭建，可以看我之前写的这篇文章
阿里云服务器宝塔面板的安装
一些比较方便的工具还有xshell，xftp这两个软件，一个是写命令的，一个是把自己电脑的文件传到服务器里的，xshell的功能宝塔面板里也有，但是xshell功能更加全面，xftp建议下载一个，因为这个传文件确实很方便
在宝塔面板这里，通过软件商店，我下载了nginx服务器，mysql，phpmyadmin等，这些是一些比较基础的配置（很方便，只要找到相应软件，点击安装，即可完成服务器基本配置工作）
具体内容
关于配置srs的大致思路，可以看这篇文章
linux部署安装SRS流媒体服务器教程
上面这篇博文通过crt进行安装，我们用
宝塔面板&#43;xftp（&#43;xshell）
就很方便，首先下载srs
https://github.com/ossrs/srs
最好是下载releases版本的，在上面的网页往下划，找到这里，选一个你相中的，
点进去以后，下载这个比较好
在自己电脑里解压就可以然后通过xftp传到服务器的root文件夹里面
1.在宝塔终端或在xshell输入命令行
2.进入trunk文件夹下，之后的操作都在此文件夹下进行
输入以下内容编译文件
./configure &amp;&amp; make 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f5229187e2631539f479fecd6ec08e75/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-04T23:21:29+08:00" />
<meta property="article:modified_time" content="2023-05-04T23:21:29+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android实现直播的博文和流程（全过程，超详细/附源码）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <blockquote> 
 <p>为方便大家阅读，源码先行奉上<br> <strong>github源码链接</strong> <a href="https://github.com/Recycle1/Live-video-demo">https://github.com/Recycle1/Live-video-demo</a><br> <strong>csdn源码链接</strong> <a href="https://download.csdn.net/download/weixin_52263647/85070250">https://download.csdn.net/download/weixin_52263647/85070250</a></p> 
</blockquote> 
<blockquote> 
 <p><strong>需要注意的一点是！！！</strong>：上述的代码需要更改IP地址为你自己的IP地址，博主在做完这个demo后禁用了1935端口号，因此无法直接使用博主的云服务器，同时如果是阿里云服务器，一定要记得在安全组中放行相应的端口号，否则无法正常推流。</p> 
</blockquote> 
<p>最近要做一个有把视频从手机端推流，在另一端拉流功能的app，所以就学习了一下直播功能，这两个功能比较类似，找到了一些收藏点赞比较多的文章，按着他们的记录一步一步的做了下来，但是文章大多都是几年前写的，可能也是我懂的比较少，捣鼓了好几天，按着他们做的照着做，还是出现了各种各样的问题，所以我汇总了一些博文的内容，终于是实现了。</p> 
<p>首先准备工作，不光需要有Android stdio，还需要有自己的服务器，这里我租用了阿里云的云服务器（linux系统），之后的文章中，从Android端的编写到服务器端的配置都会有所介绍。最后测试实现的结果，可以先在电脑上下载一个VLC</p> 
<p>具体的一些流程是：</p> 
<ol><li>在android端调用yaesa库进行摄像头采集、编码，随后向srs服务器rtmp推流</li><li>在服务器端部署srs流媒体服务器</li><li>在android端调用vitamio实现取流播放</li></ol> 
<h3><a id="_Android_16"></a>一 Android端搭建</h3> 
<p>android实现的功能一个是采集摄像头的内容，然后将视频内容推流到服务器端，另一个是从服务器端拉流到手机播放视频。</p> 
<p><em>以下是我认为比较好的博文</em><br> <a href="http://t.csdn.cn/oWxXc" rel="nofollow">Android直播实现（一）Android端推流、播放</a></p> 
<p>首先需要调用yaesa，链接如下<br> <a href="https://github.com/begeekmyfriend/yasea">https://github.com/begeekmyfriend/yasea</a></p> 
<p>将yaesa项目clone下来，对我们有用的就是其中library这部分，我们将这个文件夹作为library导入到自己的android项目中，导入的过程就是在顶部的功能那里，依次点击<br> File --&gt;new–&gt;import Module<br> <img src="https://images2.imgbox.com/ca/21/fDY286vb_o.png" alt="请添加图片描述"><br> 出现上面的画面，我们从里面找到刚才下载的yeasa中的library文件夹，放入里面，导入成功</p> 
<p>然后需要在我们自己的项目，也就是app这个目录下导入library这个依赖，具体的方法可以等之后在那些引用外部依赖的代码标红时（出错），看android stdio给的推荐解决方案，点击（import dependence）即导入依赖，也可以直接通过File–&gt;Project Structure-&gt;Dependencies，点击加号添加依赖</p> 
<p><img src="https://images2.imgbox.com/37/1a/Q70vppin_o.png" alt="在这里插入图片描述"><br> 然后对于拉流操作，我们需要使用vitamio是实现功能，所以我们同样需要引入vitomio，这里就到了一个大坑！！！<br> 我按着第一篇博文的方法，从他给出的demo<br> <a href="https://github.com/SiKang123/LiveTest">https://github.com/SiKang123/LiveTest</a><br> 或者从各种博文都推荐的vitomio地址<a href="https://github.com/yixia/VitamioBundle"><s>https://github.com/yixia/VitamioBundle</s> </a><br> 将vitomio导入到android端（和上面的操作一样）<br> 但是，本以为大功告成了，结果vitomio在测试时一直出现问题，找不到vinit.so文件，我查了各种文章，都找不到解决的办法，最后我看到一个博主出现的虽然不是这个问题，但是vitomio也是运行不了，于是他换了一个vitomio的下载地址，没有用上面的链接，成功解决了自己的问题，我试了一下，也是把我的问题解决了<br> <a href="http://t.csdn.cn/YyuP1" rel="nofollow">引用vitamio框架提示libffmpeg.so、libstlport_shared.so无法找到的错误</a><br> 他引用的vitomio项目地址是这个<br> <a href="https://github.com/yixia/VitamioBundleStudio">https://github.com/yixia/VitamioBundleStudio</a><br> 上面这个是可以用的，但是也需要做一些修改，首先把vitomio文件夹根据我们上面讲到的方法放入自己的项目中，随后更改vitomio文件下的build.gradle文件<br> <img src="https://images2.imgbox.com/b0/e5/FtkzagPj_o.png" alt="在这里插入图片描述"><br> 改为这样<br> <img src="https://images2.imgbox.com/e2/44/dnhymqBS_o.png" alt="在这里插入图片描述"><br> 随后更改vitomio文件夹下的MediaPlayer.java文件<br> <img src="https://images2.imgbox.com/25/18/o0JcNdmt_o.png" alt="在这里插入图片描述"><br> 其实这个我也不知道问题出在哪里，后面运行的时候发现这里报错，LIB_ROOT这个变量的值有问题，所以这里我索性去掉了if语句，运行发现没有问题<br> <img src="https://images2.imgbox.com/0d/69/OHVQrfXi_o.png" alt="请添加图片描述"><br> 这样，外部引用库就导入完成了，文件结构长这个样子<img src="https://images2.imgbox.com/78/e5/8vAiTE2E_o.png" alt="请添加图片描述"><br> 之后根据第一篇博文给的链接<br> <a href="https://github.com/SiKang123/LiveTest">https://github.com/SiKang123/LiveTest</a><br> 把他的xml文件activity文件我们按着他写的写在我们自己的文件里<br> <img src="https://images2.imgbox.com/5c/93/o9gjq34L_o.png" alt="在这里插入图片描述"><br> 这样，android端就配置完成了，之后，我们开始配置服务器端</p> 
<h3><a id="__56"></a>二 服务器端搭建</h3> 
<p>在服务器搭建这里，不是很了解的也没关系，现在搭建服务器有很多工具，操作起来不是很难，也不需要写很多命令，这里，我是用我租用的阿里云服务器（Linux系统）配置srs流媒体服务器</p> 
<p><strong>准备工作</strong></p> 
<p>需要有自己的服务器，工具类，我用的是宝塔面板，关于宝塔面板如何安装，使用，以及站点搭建，可以看我之前写的这篇文章<br> <a href="http://t.csdn.cn/C7BPZ" rel="nofollow">阿里云服务器宝塔面板的安装</a><br> 一些比较方便的工具还有xshell，xftp这两个软件，一个是写命令的，一个是把自己电脑的文件传到服务器里的，xshell的功能宝塔面板里也有，但是xshell功能更加全面，xftp建议下载一个，因为这个传文件确实很方便</p> 
<p>在宝塔面板这里，通过软件商店，我下载了nginx服务器，mysql，phpmyadmin等，这些是一些比较基础的配置（很方便，只要找到相应软件，点击安装，即可完成服务器基本配置工作）</p> 
<p><strong>具体内容</strong></p> 
<p>关于配置srs的大致思路，可以看这篇文章<br> <a href="https://www.cnblogs.com/innershare/p/11045363.html" rel="nofollow">linux部署安装SRS流媒体服务器教程</a></p> 
<p>上面这篇博文通过crt进行安装，我们用<br> 宝塔面板+xftp（+xshell）<br> 就很方便，首先下载srs<br> <a href="https://github.com/ossrs/srs">https://github.com/ossrs/srs</a><br> 最好是下载releases版本的，在上面的网页往下划，找到这里，选一个你相中的，<br> <img src="https://images2.imgbox.com/0c/45/uxF7p7MW_o.png" alt="请添加图片描述"><br> 点进去以后，下载这个比较好<br> <img src="https://images2.imgbox.com/3a/f0/laCjNtmk_o.png" alt="在这里插入图片描述"><br> 在自己电脑里解压就可以然后通过xftp传到服务器的root文件夹里面<br> <img src="https://images2.imgbox.com/45/62/pc93jBzg_o.png" alt="在这里插入图片描述"></p> 
<p>1.在宝塔终端或在xshell输入命令行<br> <img src="https://images2.imgbox.com/74/a0/m69WBgV0_o.png" alt="请添加图片描述"><br> 2.进入trunk文件夹下，之后的操作都在此文件夹下进行<br> 输入以下内容编译文件</p> 
<pre><code class="prism language-xml">./configure &amp;&amp; make
</code></pre> 
<p>3.启动srs</p> 
<pre><code class="prism language-xml">./objs/srs -c conf/srs.conf 
</code></pre> 
<p>查看是否启动成功</p> 
<pre><code class="prism language-xml">ps -ef | grep srs
</code></pre> 
<p>编译过程可能会面临权限问题，可能某个文件因为权限打不开，可以通过宝塔面板，打开文件，鼠标悬浮文件夹，就可以找到权限选项，设置权限，也可以通过代码来完成<br> <a href="http://t.csdn.cn/pUyrR" rel="nofollow">在Linux系统中如何修改文件夹读写权限</a></p> 
<p>4.之后我们需要下载ffmpeg，srs内部也有ffmpeg，在trunk目录下的3rdparty文件夹<br> <img src="https://images2.imgbox.com/af/29/tjie91SA_o.png" alt="请添加图片描述"><br> 但是我试了试，怎么都有问题，所以我自己又下了一个（在官网<a href="http://ffmpeg.org/" rel="nofollow">ffmpeg</a>）当然，我们下载到哪里？也是放在这个3rdparty文件夹里面，上面这个图片里ffmpeg文件夹就是我自己下载的ffmpeg</p> 
<p>5.要想用ffmpeg，首先要有yasm，如果没有yasm，需要先安装，以下是下载yasm的网站<br> <a href="http://www.tortall.net/projects/yasm/releases" rel="nofollow">http://www.tortall.net/projects/yasm/releases</a></p> 
<p>6.下载合适版本的yasm（注意要下载以.tar.gz结尾的压缩包），解压后放在这个3rdparty文件夹下<br> 然后在终端逐行输入</p> 
<pre><code class="prism language-xml">cd yasm-1.3.0
</code></pre> 
<pre><code class="prism language-xml">./configure
</code></pre> 
<pre><code class="prism language-xml">make &amp;&amp; make install
</code></pre> 
<p>7.安装完成后，开始安装ffmpeg<br> 进入ffmpeg文件夹（cd ffmpeg）<br> 上面发的那篇博文说需要先获取root权限，直接输入:su 在输入密码即可取得root权限，这样可以，但是我是通过宝塔面板把文件夹权限放开的</p> 
<p>然后输入</p> 
<pre><code class="prism language-xml">./configure
</code></pre> 
<pre><code class="prism language-xml">make &amp;&amp; make install
</code></pre> 
<p>这样，我们的服务器部分就配置完成了<br> 可以通过下面两行来了解配置的信息</p> 
<pre><code class="prism language-xml">//了解参数
cat -n conf/srs.conf
</code></pre> 
<pre><code class="prism language-xml">//了解运行状态
./etc/init.d/srs status
</code></pre> 
<p>（b站里也有教学的视频，这里我挑了一个讲的比较详细的，分享给大家<a href="https://www.bilibili.com/video/BV1764y1y7Zb?p=1&amp;share_medium=android&amp;share_plat=android&amp;share_session_id=80c0b867-a4fc-4cf5-8a81-460b744a1367&amp;share_source=QQ&amp;share_tag=s_i&amp;timestamp=1648904100&amp;unique_k=Xu7d9la" rel="nofollow">srs配置教学</a>，srs官网里也有配置的相关流程介绍，也很详细<a href="http://www.ossrs.net/srs.release/releases/" rel="nofollow">srs官网</a>）</p> 
<h3><a id="__152"></a>三 运行测试</h3> 
<p>关于运行测试，分为推流和拉流<br> 首先我们进行推流，我看了这篇博文<br> <a href="http://www.tnro.cn/index/info?id=37" rel="nofollow">推流效果</a><br> 同样里面也给出了官方的方案<br> <a href="https://github.com/ossrs/srs/wiki/v1_CN_SampleRTMP">推流与拉流</a><br> 我们使用官方的方案，测试的视频存在srs的一个文件夹里面，内容是阿凡达</p> 
<pre><code class="prism language-xml">for((;;)); do \
        ./3rdparty/ffmpeg/ffmpeg -re -i ./doc/source.200kbps.768x320.flv \
        -vcodec copy -acodec copy \
        -f flv -y rtmp://192.168.1.170/live/livestream; \
        sleep 1; \
    done
</code></pre> 
<p>需要注意的几点：</p> 
<ol><li>ffmpeg是我们下载的，所以我这里的路径是3rdparty路径下的</li><li>ip地址需要换成我们服务器的ip地址</li><li>在trunk文件夹下执行</li></ol> 
<p>进行完上面的操作，就可以看到视频开始推流了<br> <img src="https://images2.imgbox.com/68/aa/FN2uvggh_o.png" alt="请添加图片描述"><br> 我们想要观看视频需要取流，可以通过在线播放器，但是现在的浏览器很多不支持flash，所以可能不成功，所以可以在电脑上下载一个<a href="https://www.videolan.org/vlc/#download" rel="nofollow">VLC</a>，通过VLC取流播放，在<br> 媒体–&gt;流–&gt;网络<br> 输入播放的地址，就是刚才我们推流时的地址<br> <img src="https://images2.imgbox.com/7c/39/d0ATw2wr_o.png" alt="在这里插入图片描述"><br> 点击串流旁的三角，点击播放，等一会，看到阿凡达的话，那恭喜你，成功了！！！<img src="https://images2.imgbox.com/ba/99/gSJ2JofC_o.png" alt="请添加图片描述"><br> 在android端测试也可以，也是把地址换成我们服务器的ip地址就可以</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e67dc3408830b729cec13e7b970bd6a2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">数据结构——链表</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e8152c32ae55ed021f571aeb34eeddc3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">脚本运行出现错误: syntax error near unexpected token `(‘</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>