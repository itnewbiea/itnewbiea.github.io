<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Linux-磁盘挂载 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Linux-磁盘挂载" />
<meta property="og:description" content="1 说明 避免一头雾水，请先看完说明，再看最下面的挂载教程
1.1 挂载流程 START–&gt;查看要挂载的是哪块硬盘–&gt;将硬盘分区–&gt;格式化分区–&gt;设置开机自启（即永久挂载）–&gt;执行挂载命令–&gt;END
1.2 查看当前挂载的磁盘，磁盘剩余的空间 $ df -h 查看某个文件夹/文件大小可以用这个命令du -sh /usr
1.3 查看分区情况 $ fdisk -l 当前系统一共存在三块磁盘：sda，sdb，sdc；其中sda已经有两个分区sda1和sda2。也可以使用lsblk命令查看具体的磁盘分区情况
2 挂载磁盘正文 我们以挂载未分区的vdb到/data目录为例子
2.1 查看分区情况 $ fdisk -l
Disk /dev/vdb: 200 GiB, 214748364800 bytes, 419430400 sectors Units: sectors of 1 * 512 = 512 bytes Sector size (logical/physical): 512 bytes / 512 bytes I/O size (minimum/optimal): 512 bytes / 512 bytes 2.2 设置分区 $ fdisk /dev/vdb
Changes will remain in memory only, until you decide to write them." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cf52165a9e3e164e3489fd85d24bcc83/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-28T15:10:23+08:00" />
<meta property="article:modified_time" content="2023-03-28T15:10:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Linux-磁盘挂载</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="1__0"></a>1 说明</h2> 
<p>避免一头雾水，请先看完说明，再看最下面的挂载教程</p> 
<h3><a id="11__2"></a>1.1 挂载流程</h3> 
<p>START–&gt;查看要挂载的是哪块硬盘–&gt;将硬盘分区–&gt;格式化分区–&gt;设置开机自启（即永久挂载）–&gt;执行挂载命令–&gt;END</p> 
<h3><a id="12__4"></a>1.2 查看当前挂载的磁盘，磁盘剩余的空间</h3> 
<pre><code class="prism language-bash">$ <span class="token function">df</span> -h
</code></pre> 
<p><img src="https://images2.imgbox.com/5b/c4/BOdSN4d9_o.png" alt="在这里插入图片描述"><br> 查看某个文件夹/文件大小可以用这个命令<code>du -sh /usr</code></p> 
<h3><a id="13__11"></a>1.3 查看分区情况</h3> 
<pre><code class="prism language-bash">$ <span class="token function">fdisk</span> -l
</code></pre> 
<p><img src="https://images2.imgbox.com/d6/0d/H6FtYjcG_o.png" alt="在这里插入图片描述"><br> 当前系统一共存在三块磁盘：sda，sdb，sdc；其中sda已经有两个分区sda1和sda2。也可以使用<code>lsblk</code>命令查看具体的磁盘分区情况<br> <img src="https://images2.imgbox.com/61/13/EeizZh4T_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="2__19"></a>2 挂载磁盘正文</h2> 
<p>我们以挂载未分区的vdb到/data目录为例子</p> 
<h3><a id="21__21"></a>2.1 查看分区情况</h3> 
<p><code>$ fdisk -l</code><br></p> 
<pre><code>Disk /dev/vdb: 200 GiB, 214748364800 bytes, 419430400 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
</code></pre> 
<h3><a id="22__30"></a>2.2 设置分区</h3> 
<p><code>$ fdisk /dev/vdb</code><br></p> 
<pre><code>Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.
</code></pre> 
<h3><a id="23_m_37"></a>2.3 输入m查看帮助（可跳过）</h3> 
<p><code>Command (m for help): m </code><br></p> 
<pre><code>Help:
  DOS (MBR)
   a   toggle a bootable flag
   b   edit nested BSD disklabel
   c   toggle the dos compatibility flag

  Generic
   d   delete a partition
   F   list free unpartitioned space
   l   list known partition types
   n   add a new partition
   p   print the partition table
   t   change a partition type
   v   verify the partition table
   i   print information about a partition

  Misc
   m   print this menu
   u   change display/entry units
   x   extra functionality (experts only)

  Script
   I   load disk layout from sfdisk script file
   O   dump disk layout to sfdisk script file

  Save &amp; Exit
   w   write table to disk and exit
   q   quit without saving changes

  Create a new label
   g   create a new empty GPT partition table
   G   create a new empty SGI (IRIX) partition table
   o   create a new empty DOS partition table
   s   create a new empty Sun partition table
</code></pre> 
<h3><a id="24_gGPT_75"></a>2.4 输入g创建一个空的GPT分区表</h3> 
<p><code>Command (m for help): g</code><br></p> 
<pre><code>Created a new GPT disklabel (GUID: 3B765FDC-74EB-E34E-ADF3-34A6F616C8B6).
The old dos signature will be removed by a write command.
</code></pre> 
<h3><a id="25_pGTP_81"></a>2.5 输入p查看磁盘已被转成GTP分区格式</h3> 
<p><code>Command (m for help): p</code><br></p> 
<pre><code>Disk /dev/sda: 500 GiB, 536870912000 bytes, 1048576000 sectors
Disk model: QEMU HARDDISK   
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 046CA995-F20A-184D-BA13-D7C144240C87
</code></pre> 
<h3><a id="26_n__1128_92"></a>2.6 输入n 创建分区 默认磁盘序号是1-128</h3> 
<p><code>Command (m for help): n</code><br></p> 
<h3><a id="27__94"></a>2.7 回车下一步，选择磁盘序号为默认</h3> 
<p><code>Partition number (1-128, default 1): 1</code><br></p> 
<h3><a id="28__96"></a>2.8 回车下一步，默认第一扇区为默认大小</h3> 
<p><code>First sector (2048-1048575966, default 2048): </code><br></p> 
<h3><a id="29__98"></a>2.9 回车下一步，默认最后一个扇区为默认大小</h3> 
<p><code>Last sector, +/-sectors or +/-size{K,M,G,T,P} (2048-1048575966, default 1048575966): </code><br></p> 
<pre><code>Created a new partition 1 of type 'Linux filesystem' and of size 500 GiB.
Partition #1 contains a ext4 signature.
</code></pre> 
<h3><a id="210_yes_104"></a>2.10 输入yes，删除签名（可能不会出现这步，未出现可忽略）</h3> 
<p><code>Do you want to remove the signature? [Y]es/[N]o: yes</code><br></p> 
<pre><code>The signature will be removed by a write command.
</code></pre> 
<h3><a id="211_w__109"></a>2.11 输入w 保存设置</h3> 
<p><code>Command (m for help): w</code><br></p> 
<pre><code>The partition table has been altered.
Calling ioctl() to re-read partition table.
Syncing disks.
</code></pre> 
<h3><a id="212__116"></a>2.12 查看分区情况</h3> 
<p><code>$ fdisk -l</code><br></p> 
<pre><code>Disk /dev/vdb: 200 GiB, 214748364800 bytes, 419430400 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: gpt
Disk identifier: 1A0C9D01-9A82-402F-B078-73CA4431DFB9

#     Start       End   Sectors  Size Type
1   2048 419430366 419428319  200G Linux filesystem
</code></pre> 
<h3><a id="213__vdb1_ext4_130"></a>2.13 格式化 vdb1 为ext4类型</h3> 
<p><code>$ mkfs.ext4 /dev/vdb1</code><br></p> 
<pre><code>mke2fs 1.42.13 (17-May-2015)
Creating filesystem with 52428539 4k blocks and 13107200 inodes
Filesystem UUID: a7cf4158-cc23-49bf-81eb-d19882299d67
Superblock backups stored on blocks: 
	32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, 
	4096000, 7962624, 11239424, 20480000, 23887872

Allocating group tables: done                            
Writing inode tables: done                            
Creating journal (32768 blocks): done
Writing superblocks and filesystem accounting information: done
</code></pre> 
<h3><a id="214__146"></a>2.14 设置开机启用</h3> 
<h4><a id="2141_uuid_147"></a>2.14.1 查询分区uuid</h4> 
<p><code>$ ls -l /dev/disk/by-uuid/</code><br></p> 
<pre><code>total 0
lrwxrwxrwx 1 root root 10 Dec 14 14:10 5bb40f03-8000-4453-9218-a3cd77897ca0 -&gt; ../../vda1
lrwxrwxrwx 1 root root 10 Dec 14 14:43 a7cf4158-cc23-49bf-81eb-d19882299d67 -&gt; ../../vdb1
</code></pre> 
<h4><a id="2142__155"></a>2.14.2 设置</h4> 
<p><code>$ vi /etc/fstab</code><br></p> 
<pre><code>UUID=a7cf4158-cc23-49bf-81eb-d19882299d67 /data                   ext4    defaults        0 0
</code></pre> 
<p>上面是将vdb1挂载到/data目录，如果无此目录，请新建此目录</p> 
<h3><a id="215__162"></a>2.15 挂载分区</h3> 
<p><code>$ mount -a</code><br></p> 
<h3><a id="216__164"></a>2.16 检查分区挂载情况</h3> 
<p><code>$ df -h</code><br></p> 
<h2><a id="3__167"></a>3 挂载磁盘，不报错，却没挂载上</h2> 
<h3><a id="31__168"></a>3.1 背景</h3> 
<p>今天服务器磁盘缩减，卸载磁盘，挂载新磁盘。mount -a不报错，却没有成功挂载上</p> 
<h3><a id="32__170"></a>3.2 查看系统日志</h3> 
<pre><code class="prism language-bash">journalctl -S <span class="token string">"2023-03-28 15:00:00"</span>
</code></pre> 
<p>原来是systemd还记录着vdb1挂载到/data，需要重载一些配置</p> 
<pre><code class="prism language-bash"><span class="token comment"># 重载配置</span>
systemctl daemon-reload
<span class="token comment"># 挂载</span>
<span class="token function">mount</span> -a
<span class="token comment"># 查看是否挂载好了</span>
<span class="token function">df</span> -h
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c7bd9a25e51dd2652f8422e1bef5e46f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[MySQL]如何选择合适的分布式主键方案</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/68b103c97e82201c244497c31b983dbd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">OpenApi接口的一次调用经历(附代码)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>