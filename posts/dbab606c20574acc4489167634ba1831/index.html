<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>RT -Thread Studio开发环境下使用W5500做TCP客户端 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="RT -Thread Studio开发环境下使用W5500做TCP客户端" />
<meta property="og:description" content="首先是具备W5500芯片的驱动，参考上一篇文章 RT -Thread Studio开发环境下驱动W5500网络芯片 https://blog.csdn.net/qq_25186745/article/details/112647919
在这篇文章的基础上来继续写TCP客户端的程序
在applications文件下新建my_tcp.c文件
粘贴以下代码
#include &lt;rtthread.h&gt;
#include &lt;sys/socket.h&gt; /* 使用BSD socket，需要包含socket.h头文件 */
#include &lt;netdb.h&gt;
#include &lt;string.h&gt;
#include &lt;finsh.h&gt;
#define BUFSZ 1024
static const char send_data[] = &#34;This is TCP Client from RT-Thread.&#34;; /* 发送用到的数据 */
void tcpclient(int argc, char **argv)
{
int ret;
char *recv_data;
struct hostent *host;
int sock, bytes_received;
struct sockaddr_in server_addr;
const char *url;
int port;
if (argc &lt; 3)
{
rt_kprintf(&#34;Usage: tcpclient URL PORT\n&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/dbab606c20574acc4489167634ba1831/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-01-15T11:24:32+08:00" />
<meta property="article:modified_time" content="2021-01-15T11:24:32+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">RT -Thread Studio开发环境下使用W5500做TCP客户端</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>首先是具备W5500芯片的驱动，参考上一篇文章</h4> 
<h4>RT -Thread Studio开发环境下驱动W5500网络芯片</h4> 
<p><a href="https://blog.csdn.net/qq_25186745/article/details/112647919">https://blog.csdn.net/qq_25186745/article/details/112647919</a></p> 
<p>在这篇文章的基础上来继续写TCP客户端的程序</p> 
<p>在applications文件下新建my_tcp.c文件</p> 
<p>粘贴以下代码</p> 
<p>#include &lt;rtthread.h&gt;<br> #include &lt;sys/socket.h&gt; /* 使用BSD socket，需要包含socket.h头文件 */<br> #include &lt;netdb.h&gt;<br> #include &lt;string.h&gt;<br> #include &lt;finsh.h&gt;<br> #define BUFSZ   1024<br> static const char send_data[] = "This is TCP Client from RT-Thread."; /* 发送用到的数据 */<br> void tcpclient(int argc, char **argv)<br> {<!-- --><br>     int ret;<br>     char *recv_data;<br>     struct hostent *host;<br>     int sock, bytes_received;<br>     struct sockaddr_in server_addr;<br>     const char *url;<br>     int port;<br>     if (argc &lt; 3)<br>     {<!-- --><br>         rt_kprintf("Usage: tcpclient URL PORT\n");<br>         rt_kprintf("Like: tcpclient 192.168.12.44 5000\n");<br>         return ;<br>     }<br>     url = argv[1];<br>     port = strtoul(argv[2], 0, 10);<br>     /* 通过函数入口参数url获得host地址（如果是域名，会做域名解析） */<br>     host = gethostbyname(url);<br>     /* 分配用于存放接收数据的缓冲 */<br>     recv_data = rt_malloc(BUFSZ);<br>     if (recv_data == RT_NULL)<br>     {<!-- --><br>         rt_kprintf("No memory\n");<br>         return;<br>     }<br>     /* 创建一个socket，类型是SOCKET_STREAM，TCP类型 */<br>     if ((sock = socket(AF_INET, SOCK_STREAM, 0)) == -1)<br>     {<!-- --><br>         /* 创建socket失败 */<br>         rt_kprintf("Socket error\n");<br>         /* 释放接收缓冲 */<br>         rt_free(recv_data);<br>         return;<br>     }<br>     /* 初始化预连接的服务端地址 */<br>     server_addr.sin_family = AF_INET;<br>     server_addr.sin_port = htons(port);<br>     server_addr.sin_addr = *((struct in_addr *)host-&gt;h_addr);<br>     rt_memset(&amp;(server_addr.sin_zero), 0, sizeof(server_addr.sin_zero));<br>     /* 连接到服务端 */<br>     if (connect(sock, (struct sockaddr *)&amp;server_addr, sizeof(struct sockaddr)) == -1)<br>     {<!-- --><br>         /* 连接失败 */<br>         rt_kprintf("Connect fail!\n");<br>         closesocket(sock);<br>         /*释放接收缓冲 */<br>         rt_free(recv_data);<br>         return;<br>     }<br>     while (1)<br>     {<!-- --><br>         /* 从sock连接中接收最大BUFSZ - 1字节数据 */<br>         bytes_received = recv(sock, recv_data, BUFSZ - 1, 0);<br>         if (bytes_received &lt; 0)<br>         {<!-- --><br>             /* 接收失败，关闭这个连接 */<br>             closesocket(sock);<br>             rt_kprintf("\nreceived error,close the socket.\r\n");<br>             /* 释放接收缓冲 */<br>             rt_free(recv_data);<br>             break;<br>         }<br>         else if (bytes_received == 0)<br>         {<!-- --><br>             /* 默认 recv 为阻塞模式，此时收到0认为连接出错，关闭这个连接 */<br>             closesocket(sock);<br>             rt_kprintf("\nreceived error,close the socket.\r\n");<br>             /* 释放接收缓冲 */<br>             rt_free(recv_data);<br>             break;<br>         }<br>         /* 有接收到数据，把末端清零 */<br>         recv_data[bytes_received] = '\0';<br>         if (strncmp(recv_data, "q", 1) == 0 || strncmp(recv_data, "Q", 1) == 0)<br>         {<!-- --><br>             /* 如果是首字母是q或Q，关闭这个连接 */<br>             closesocket(sock);<br>             rt_kprintf("\n got a 'q' or 'Q',close the socket.\r\n");<br>             /* 释放接收缓冲 */<br>             rt_free(recv_data);<br>             break;<br>         }<br>         else<br>         {<!-- --><br>             /* 在控制终端显示收到的数据 */<br>             rt_kprintf("\nReceived data = %s ", recv_data);<br>         }<br>         /* 发送数据到sock连接 */<br>         ret = send(sock, send_data, strlen(send_data), 0);<br>         if (ret &lt; 0)<br>         {<!-- --><br>             /* 接收失败，关闭这个连接 */<br>             closesocket(sock);<br>             rt_kprintf("\nsend error,close the socket.\r\n");<br>             rt_free(recv_data);<br>             break;<br>         }<br>         else if (ret == 0)<br>         {<!-- --><br>             /* 打印send函数返回值为0的警告信息 */<br>             rt_kprintf("\n Send warning,send function return 0.\r\n");<br>         }<br>     }<br>     return;<br> }<br> MSH_CMD_EXPORT(tcpclient, a tcp client sample);</p> 
<p>此代码是RT -Thread官方TCP客户端例程，参考地址</p> 
<p><a href="https://www.rt-thread.org/document/api/group__tcpclient__sample.html" rel="nofollow">https://www.rt-thread.org/document/api/group__tcpclient__sample.html</a></p> 
<p>我也是直接复制过来的</p> 
<p>然后在电脑上建立一个TCP服务器，电脑需要和W5500的网络在同一个局域网内</p> 
<p>我的电脑IP地址是192.168.1.80服务器端口号是8000</p> 
<p><img alt="" height="625" src="https://images2.imgbox.com/5e/4a/SXS66w4h_o.png" width="833"></p> 
<p><img alt="" height="928" src="https://images2.imgbox.com/42/1a/6IKXNfdU_o.png" width="1080"></p> 
<p>my_tcp.c文件添加完后编译下载</p> 
<p><img alt="" height="340" src="https://images2.imgbox.com/53/58/WyLi70g3_o.png" width="539"></p> 
<p>在出现W5500 netdev link status becomes link up后输入tcpclient 192.168.1.80 8000去连接服务器</p> 
<p><img alt="" height="408" src="https://images2.imgbox.com/33/ec/Cr83M81Z_o.png" width="426"></p> 
<p>服务器端显示有客户端连接上了，然后双向收发数据都可以了。</p> 
<p><img alt="" height="934" src="https://images2.imgbox.com/cf/3e/kLgk4a5E_o.png" width="849"></p> 
<p>使用RT -Thread Studio开发环境相当简单，甚至都不用看数据手册。</p> 
<p>W5500做TCP就这么简单。</p> 
<p> </p> 
<p> </p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e05d78270d34149735a6b5b7b82e4e87/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">连接笔记本_笔记本电脑怎么连接投影仪的方法？【图文教程】</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b0c212bd83d2330597d2c09a7a036eb1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Latex常用数学符号总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>