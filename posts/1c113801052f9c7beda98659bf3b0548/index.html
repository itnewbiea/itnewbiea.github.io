<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>搜索组件之a-range-picker - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="搜索组件之a-range-picker" />
<meta property="og:description" content="组件：
&lt;template&gt; &lt;div class=&#34;searchComponent&#34;&gt; &lt;a-form :model=&#34;form&#34; ref=&#34;formRef&#34; layout=&#34;inline&#34; :label-col=&#34;labelCol&#34; :wrapper-col=&#34;wrapperCol&#34; &gt; &lt;a-row :gutter=&#34;12&#34; style=&#34;width: 100%&#34;&gt; &lt;a-col v-for=&#34;(item, index) in searchitemList&#34; :key=&#34;index&#34; :xs=&#34;xs ? xs : 12&#34; :sm=&#34;sm ? sm : 12&#34; :md=&#34;md ? md : 12&#34; :lg=&#34;lg ? lg : 12&#34; :xl=&#34;xl ? xl : item.type == &#39;rangeDate&#39; ? 10 : 8&#34; :xxl=&#34;xxl ? xxl : item.type == &#39;rangeDate&#39; ? 8 : 6&#34; &gt; &lt;a-form-item :rules=&#34; item.rules ? [ ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1c113801052f9c7beda98659bf3b0548/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-28T11:20:02+08:00" />
<meta property="article:modified_time" content="2023-06-28T11:20:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">搜索组件之a-range-picker</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><img alt="" height="485" src="https://images2.imgbox.com/aa/90/3A5coS4w_o.png" width="1200"></p> 
<p> 组件：</p> 
<pre><code class="language-javascript">&lt;template&gt;
  &lt;div class="searchComponent"&gt;
    &lt;a-form
      :model="form"
      ref="formRef"
      layout="inline"
      :label-col="labelCol"
      :wrapper-col="wrapperCol"
    &gt;
      &lt;a-row :gutter="12" style="width: 100%"&gt;
        &lt;a-col
          v-for="(item, index) in searchitemList"
          :key="index"
          :xs="xs ? xs : 12"
          :sm="sm ? sm : 12"
          :md="md ? md : 12"
          :lg="lg ? lg : 12"
          :xl="xl ? xl : item.type == 'rangeDate' ? 10 : 8"
          :xxl="xxl ? xxl : item.type == 'rangeDate' ? 8 : 6"
        &gt;
          &lt;a-form-item
            :rules="
              item.rules
                ? [
                    ...item.rules,
                    {
                      validator: item.checkName
                        ? checkName
                        : item.type == 'rangeDate'
                        ? checkRangeDate
                        : checkNo,
                    },
                  ]
                : []
            "
            :name="item.queryName"
          &gt;
            &lt;template #label&gt;
              &lt;span&gt;{<!-- -->{ item.label }}&lt;/span&gt;
            &lt;/template&gt;
            &lt;a-input
              v-if="item.type == 'input'"
              v-model:value="form[item.queryName]"
              :placeholder="item.placeholder"
            &gt;&lt;/a-input&gt;
            &lt;Select
              ref="selectRequest"
              v-if="item.type == 'scrollSelect'"
              :watchParams="item.watchParams"
              :isRequiredParams="item.isRequiredParams"
              :params="item.requestParams ? item.requestParams : {}"
              :objectName="`${item.queryName}`"
              :isAffect="item.isAffect"
              :value="item.val"
              :allowClear="item.requestAllowClear"
              :popupScroll="item.scrollFunc"
              @selectedValue="(value) =&gt; selectedValue(value, item.isAffect)"
            /&gt;
            &lt;a-select
              @change="(val) =&gt; changeSelect(`${item.queryName}`, val)"
              v-if="item.type == 'select'"
              :allowClear="item.allowClear"
              v-model:value="form[item.queryName]"
              :placeholder="item.placeholder"
            &gt;
              &lt;a-select-option
                v-for="selectItem in item.selectList"
                :key="selectItem.value"
                :value="selectItem.value"
                &gt;{<!-- -->{ selectItem.name }}&lt;/a-select-option
              &gt;
            &lt;/a-select&gt;
            &lt;a-range-picker
              v-model:value="form[item.queryName]"
              v-if="item.type == 'rangeDate'"
              :picker="item.picker"
              show-time="false"
              :format="item.format"
          valueFormat="YYYY-MM-DDTHH:mm:ssZ"
            &gt;&lt;/a-range-picker&gt;
          &lt;/a-form-item&gt;
        &lt;/a-col&gt;
        &lt;a-col :md="12" :lg="12" :xl="6" :xxl="4"&gt;
          &lt;a-button @click="onSubmit" type="primary"&gt;查询&lt;/a-button&gt;
          &lt;a-button style="margin-left: 8px" @click="resetEvent"&gt;重置&lt;/a-button&gt;
        &lt;/a-col&gt;
      &lt;/a-row&gt;
    &lt;/a-form&gt;
  &lt;/div&gt;
&lt;/template&gt;
&lt;script setup lang="ts"&gt;
import { reactive, ref, watch, getCurrentInstance, nextTick } from "vue";
import zhCN from "ant-design-vue/es/locale/zh_CN";
import Select from "@/components/Select/index.vue";
import moment from "moment";
import type { Dayjs } from 'dayjs';
type RangeValue = [Dayjs, Dayjs];
import { message } from "ant-design-vue";
const emit = defineEmits();
const props = defineProps({
  xs: { type: Number },
  sm: { type: Number },
  md: { type: Number },
  lg: { type: Number },
  xl: { type: Number },
  xxl: { type: Number },
  labelCol: { type: Object, default: { span: 7 } },
  wrapperCol: { type: Object, default: { span: 17 } },
  searchitem: {
    type: Array,
    default: () =&gt; {
      return [
        {
          type: "", // 搜索条件类型 input，select，rangeDate,scrollSelect
          label: "", // 搜索条件名称
          val: null, // 值
          rules: [], // 校验规则
          selectList: [], // 下拉框选项
          placeholder: "", // 占位符提示
          queryName: "", // 字段名称
          allowClear: null, // 下拉框是否允许删除选项
          scrollFunc: () =&gt; {}, // 'scrollSelect'时，请求接口
          requestAllowClear: false, // 'scrollSelect'时，是否允许清除
          watchParams: true, // 'scrollSelect'时，是否请求的监听参数
          requestParams: {}, // 'scrollSelect'时，请求接口参数
          isAffect: true, // 'scrollSelect'时，选值时是否影响其他scrollSelect的选择
        },
      ];
    },
  },
  // 查询方法
  submitFunc: {
    type: Function,
    default: null,
  },
  // 被影响的选择器的事件
  selectFormFunc: {
    type: Function,
    default: () =&gt; {},
  },
  // 被控制/被影响的其他请求下拉框
  controlSelect: {
    type: Function,
    default: () =&gt; {},
  },
});
// 搜索表单数组
const searchitemList = ref([]);
// 表单的ref
const formRef = ref();
// 表单
let form = reactive({});
// 查询
function onSubmit() {
  formRef.value
    .validate()
    .then((res) =&gt; {
      props.submitFunc(form);
    })
    .catch((err) =&gt; {
      // message.warn('请检查搜索内容')
    });
}
// 请求下拉框的ref
const selectRequest = ref(null);
// 重置
function resetEvent() {
  formRef.value.resetFields();
  // 请求下拉中的值清空
  if (selectRequest.value &amp;&amp; selectRequest.value.length &gt; 0) {
    selectRequest.value.forEach((item) =&gt; {
      item.delSelectedData();
    });
  }
}
// select组件调用的方法（params子组件中传递的值，isAffect是否影响其他请求下拉框）
function selectedValue(params, isAffect) {
  form[params.key] = params.value;
  if (isAffect) {
    // 请求下拉框选中数据改变其他请求下拉框
    props.controlSelect(form);
    if (selectRequest.value[1]) {
      selectRequest.value[1].delSelectedData();
    }
  }
}
// select中的值改变，1.表单赋值，2.如果有被影响的数据，调用父组件中传递的方法
function changeSelect(params, value) {
  form[params] = value;
  props.selectFormFunc(form[params], form);
}
// 日期校验
async function checkRangeDate(_rule, val) {
  const startDate = new Date(val[0]).valueOf();
  const endDate = new Date(val[1]).valueOf();
  const day = 365 * 24 * 3600 * 1000; // 31536000000
  if (endDate - startDate &gt; day) {
    return Promise.reject("选择日期不能超过365天");
  } else {
    return Promise.resolve();
  }
}
// 不校验
async function checkNo() {
  return Promise.resolve();
}
function resetRangeDate() {
  formRef.value.clearValidate("time");
}
const currentInstance = getCurrentInstance();
defineExpose({
  onSubmit,
  resetRangeDate,
});
watch(
  () =&gt; props.searchitem,
  (newVal, oldVal) =&gt; {
    if (newVal) {
      searchitemList.value = newVal;
      searchitemList.value.forEach((item) =&gt; {
        form[item.queryName] = item.val;
      });
    }
  },
  { deep: true, immediate: true }
);
&lt;/script&gt;
&lt;style lang="less" scoped&gt;
.searchComponent {
  background-color: #fff;
  padding: 24px 24px 40px;
  // margin-bottom: 20px;
}
.ant-form-item {
  margin-bottom: 24px;
}
.labelSelect {
  width: auto !important;
  :deep(.ant-select-selection) {
    border: none !important;
    box-shadow: none !important;
  }
  :deep(.ant-select-selection:hover) {
    border: none !important;
    box-shadow: none !important;
  }
}
.switchBtn {
  display: flex;
  cursor: pointer;
  .anticon {
    margin-top: 4px;
    color: #1890ff;
  }
}
&lt;/style&gt;
</code></pre> 
<p>页面使用：</p> 
<pre><code class="language-javascript">  &lt;SearchItem
          :searchitem="searchitem"
          :submitFunc="submitFunc"
        &gt;&lt;/SearchItem&gt;</code></pre> 
<pre><code class="language-javascript">const searchitem = [
    {
        type: "input",
        label: "API ID",
        val: "",
        placeholder: "API ID",
        queryName: "ApiTemplateId",
    },
    {
        type: "input",
        label: "API版本Id",
        val: "",
        placeholder: "API版本Id",
        queryName: "ApiTemplateVersionId",
    },
    {
        type: "select",
        label: "记录类型",
        val: 1,
        allowClear: true,
        placeholder: "",
        queryName: "IsSuccess",
        selectList: [
          { value: 1, name: "成功" },
          { value: 0, name: "失败" },
        ],
      },
      {
        type: "rangeDate",
        label: "创建时间",
        format:"YYYY-MM-DD HH:mm:ss",
        val: "",
        placeholder: "创建时间",
        queryName: "time",
    },
    
];</code></pre> 
<pre><code class="language-javascript">function submitFunc(form) {
    searchParam.value = {
      Start_CreationTime:form.time[0]?moment(form.time[0]).format("YYYY-MM-DD HH:mm:ss"):'',
      End_CreationTime:form.time[1]?moment(form.time[1]).format("YYYY-MM-DD HH:mm:ss"):'',
    ApiTemplateId : form.ApiTemplateId,
    ApiTemplateVersionId : form.ApiTemplateVersionId,
     IsSuccess : form.IsSuccess === 0?false:true
  };
  if(form.IsSuccess==0){
    columns.value.splice(3, 0, {
         title: "异常信息",
         dataIndex: "errorMessage",
         ellipsis: true,
         show:false
     });
     apidividerbutton1.value=napidividerbutton
      apioperatingButton1.value=napioperatingButton
  }
  else{
     apidividerbutton1.value=apidividerbutton
      apioperatingButton1.value=apioperatingButton
        const hasError = columns.value.some(item =&gt; item.dataIndex === 'errorMessage');
    if(hasError){
const newArr = columns.value.filter(item =&gt; item.dataIndex !== 'errorMessage');
columns.value=newArr
    }
  }
    getData();
}</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a7034e60adf7d7544b8856fd40c1245b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">python离线安装软件包，常用pip安装软件源网址</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ed9110a306aaf88e8c5f99620778b635/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Selenium爬虫报错</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>