<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android 屏幕适配 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android 屏幕适配" />
<meta property="og:description" content="基本概念 相关术语 px：像素；dpi：即densityDpi，每英寸中的像素数；density：屏幕密度，density = dpi / 160；scaledDensity：字体的缩放因子，正常情况下和density相等，可以通过调节系统字体大小改变该值。 android中的dp在渲染前会将dp转为px，公式如下：
p x = d e n s i t y ∗ d p px = density * dp px=density∗dp
限定符匹配 匹配规则：当前dpi &gt; 更高的dpi &gt; 更低的dpi
以图片为例，图片资源的文件夹分为mdpi、hdpi、xhdpi xxhdpi xxxhdpi等。
假设当前设备密度为xhdpi，文件夹为上述5种，则查找顺序为：xhdpi &gt; xxhdpi &gt; xxxhdpi &gt; hdpi &gt; mdpi 。
XML布局适配 动态加载布局 给res目录中的子目录加上“-限定符”，可以给不同设备提供不同的资源以及布局。
指定屏幕大小：-sw&#43;指定大小
例如限定480到1080屏幕，1080以上屏幕：layout-sw480dp，layout-sw1080dp
sw，Smallest-width，最小宽度限定符。
指定屏幕方向：-land、-port
创建自适应布局 思路：尽量不要把view宽高边距等写死，而是设置权重或百分比让其自适应。
缺点：绘图时为实现自适应需要反复测量计算布局的属性，增加开销。
方法：
使用LinearLayout时，通过设置layout_weight让各个视图自适应大小。
推荐使用 ConstraintLayout 构建自适应界面。
ConstraintLayout 百分比布局 设置水平和竖直方向百分比偏移，左上角为（0,0），右下角为（1,1）。
&lt;TextView ... app:layout_constraintHorizontal_bias=&#34;0.2&#34; app:layout_constraintVertical_bias=&#34;0.3&#34; /&gt; 设置宽高比 高固定，将宽设为高的两倍：将layout_width设为0，设置layout_constraintDimensionRatiov属性。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/4b209d5e40922fe2bc39086c6b18ea06/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-16T10:55:19+08:00" />
<meta property="article:modified_time" content="2023-01-16T10:55:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android 屏幕适配</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>基本概念</h2> 
<h3><a id="_2"></a>相关术语</h3> 
<ul><li>px：像素；</li><li>dpi：即densityDpi，每英寸中的像素数；</li><li>density：屏幕密度，density = dpi / 160；</li><li>scaledDensity：字体的缩放因子，正常情况下和density相等，可以通过调节系统字体大小改变该值。</li></ul> 
<p>android中的dp在渲染前会将dp转为px，公式如下：<br> <span class="katex--display"><span class="katex-display"><span class="katex"><span class="katex-mathml"> 
      
       
        
        
          p 
         
        
          x 
         
        
          = 
         
        
          d 
         
        
          e 
         
        
          n 
         
        
          s 
         
        
          i 
         
        
          t 
         
        
          y 
         
        
          ∗ 
         
        
          d 
         
        
          p 
         
        
       
         px = density * dp 
        
       
     </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.625em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">p</span><span class="mord mathnormal">x</span><span class="mspace" style="margin-right: 0.2778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right: 0.2778em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">s</span><span class="mord mathnormal">i</span><span class="mord mathnormal">t</span><span class="mord mathnormal" style="margin-right: 0.0359em;">y</span><span class="mspace" style="margin-right: 0.2222em;"></span><span class="mbin">∗</span><span class="mspace" style="margin-right: 0.2222em;"></span></span><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord mathnormal">d</span><span class="mord mathnormal">p</span></span></span></span></span></span></p> 
<h3><a id="_14"></a>限定符匹配</h3> 
<p>匹配规则：当前dpi &gt; 更高的dpi &gt; 更低的dpi</p> 
<p>以图片为例，图片资源的文件夹分为mdpi、hdpi、xhdpi xxhdpi xxxhdpi等。</p> 
<p>假设当前设备密度为xhdpi，文件夹为上述5种，则查找顺序为：xhdpi &gt; xxhdpi &gt; xxxhdpi &gt; hdpi &gt; mdpi 。</p> 
<h2><a id="XML_22"></a>XML布局适配</h2> 
<h3><a id="_24"></a>动态加载布局</h3> 
<p>给res目录中的子目录加上“-限定符”，可以给不同设备提供不同的资源以及布局。</p> 
<p>指定屏幕大小：-sw+指定大小</p> 
<p>例如限定480到1080屏幕，1080以上屏幕：layout-sw480dp，layout-sw1080dp</p> 
<p>sw，Smallest-width，最小宽度限定符。</p> 
<p>指定屏幕方向：-land、-port</p> 
<h3><a id="_40"></a>创建自适应布局</h3> 
<p><strong>思路</strong>：尽量不要把view宽高边距等写死，而是设置权重或百分比让其自适应。</p> 
<p><strong>缺点</strong>：绘图时为实现自适应需要反复测量计算布局的属性，增加开销。</p> 
<p><strong>方法</strong>：</p> 
<ol><li> <p>使用LinearLayout时，通过设置<code>layout_weight</code>让各个视图自适应大小。</p> </li><li> <p>推荐<a href="https://developer.android.google.cn/training/constraint-layout?hl=zh-cn#alignment" rel="nofollow">使用 ConstraintLayout 构建自适应界面</a>。</p> </li></ol> 
<h4><a id="ConstraintLayout_52"></a>ConstraintLayout</h4> 
<h5><a id="_54"></a>百分比布局</h5> 
<p>设置水平和竖直方向百分比偏移，左上角为（0,0），右下角为（1,1）。</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
    <span class="token attr-name">...</span>
	<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintHorizontal_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.2<span class="token punctuation">"</span></span>
	<span class="token attr-name"><span class="token namespace">app:</span>layout_constraintVertical_bias</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0.3<span class="token punctuation">"</span></span>  <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/1f/63/Wb68Cpw9_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_67"></a>设置宽高比</h5> 
<p>高固定，将宽设为高的两倍：将<code>layout_width</code>设为0，设置<code>layout_constraintDimensionRatiov</code>属性。</p> 
<p>“2:1” <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         → 
        
       
      
        \rightarrow 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.3669em;"></span><span class="mrel">→</span></span></span></span></span> w:h = 2:1</p> 
<p>“w,2:1” <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         → 
        
       
      
        \rightarrow 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.3669em;"></span><span class="mrel">→</span></span></span></span></span> w:h = 2:1</p> 
<p>“h,2:1” <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         → 
        
       
      
        \rightarrow 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.3669em;"></span><span class="mrel">→</span></span></span></span></span> h:w = 2:1</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>TextView</span>
	<span class="token attr-name"><span class="token namespace">android:</span>layout_width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0dp<span class="token punctuation">"</span></span>
    <span class="token attr-name">...</span>
	<span class="token attr-name">layout_constraintDimensionRatiov</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2:1<span class="token punctuation">"</span></span>  <span class="token punctuation">/&gt;</span></span>
</code></pre> 
<p><img src="https://images2.imgbox.com/79/7a/7g3APh5i_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_86"></a>添加引导线</h5> 
<p>请点击工具栏中的 <strong>Guidelines</strong><img src="https://images2.imgbox.com/7b/00/LIsGh0hY_o.png" alt="img">，添加一条用户看不见的引导线。<br> <img src="https://images2.imgbox.com/bb/01/C4npZFuM_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="_92"></a>网格布局</h5> 
<p>使用链控制线性组，实现网格布局</p> 
<table><thead><tr><th>样式</th><th>功能</th></tr></thead><tbody><tr><td>spread</td><td>默认值<br>均匀分布</td></tr><tr><td>spread inside</td><td>首尾固定在两端，中间均匀分布</td></tr><tr><td>weighted</td><td>权重</td></tr><tr><td>packed</td><td>紧挨在一起</td></tr></tbody></table> 
<p>官方示图如下：</p> 
<p><img src="https://images2.imgbox.com/31/54/ITI74ZvP_o.png" alt="img"></p> 
<h5><a id="_107"></a>对其不同尺寸的文字</h5> 
<p>TextView 自带边距，当同一段文字中，文字尺寸不同时，边距也不同。</p> 
<p>如下图，若直接让两个View的底部对齐，会发现文字不在同一水平线上。</p> 
<p><img src="https://images2.imgbox.com/f5/24/aojQ10RX_o.png" alt="在这里插入图片描述"><br> 事实上，TextView中存在文本基线，右键点击要添加约束的文本视图，选择 <strong>Show Baseline</strong>，随后直接将该文本基线并拖到另一TextView的基线上。</p> 
<p><img src="https://images2.imgbox.com/81/54/sv6xsWnV_o.gif" alt="在这里插入图片描述"></p> 
<h2><a id="_117"></a>图片适配</h2> 
<h3><a id="ScaleType_119"></a>ScaleType属性</h3> 
<ol><li>以<code>FIT_</code>开头的，都会对图片进行缩放；</li><li>以<code>CENTER_</code>开头的，图片的中心点会与<code>ImageView</code>的中心点重叠；</li></ol> 
<table><thead><tr><th>scaleType</th><th>缩放</th><th>展示位置</th><th>缺点</th></tr></thead><tbody><tr><td>FIT_CENTER（默认）<br>FIT_START<br>FIT_END</td><td>等比缩放</td><td>居中<br>居左上<br>居右下</td><td>控件留白</td></tr><tr><td>FIT_XY</td><td>非等比拉伸</td><td>填满控件</td><td>拉伸变形</td></tr><tr><td>CENTER</td><td>不缩放</td><td>居中</td><td>控件留白/图片显示不全</td></tr><tr><td>CENTER_INSIDE</td><td>等比缩小，不可放大</td><td>居中</td><td>控件留白</td></tr><tr><td>CENTER_CROP</td><td>等比缩放</td><td>居中填满控件</td><td>图片显示不全</td></tr></tbody></table> 
<h3><a id="9_134"></a>.9图</h3> 
<p>文件的后缀名是.9.png</p> 
<p>左侧、上侧黑色横线：可拉伸区域</p> 
<p>右侧、下侧黑色横线：内容区域</p> 
<p><img src="https://images2.imgbox.com/2f/c9/bTTYaZIv_o.jpg" alt="在这里插入图片描述"></p> 
<h2><a id="_147"></a>刘海屏适配</h2> 
<p>刘海区域位于状态栏中，若要全屏显示，则需适配。</p> 
<h3><a id="_151"></a>参考</h3> 
<p><a href="https://developer.android.google.cn/guide/topics/display-cutout?hl=zh-cn" rel="nofollow">Android官网：支持刘海屏</a></p> 
<p><a href="https://dev.mi.com/console/doc/detail?pId=1341" rel="nofollow">小米：刘海屏、水滴屏、挖孔屏 Android P/Q 适配</a></p> 
<p><a href="https://dev.vivo.com.cn/documentCenter/doc/103" rel="nofollow">vivo：全面屏应用适配指南</a></p> 
<h2><a id="_159"></a>整体放缩</h2> 
<h3><a id="_161"></a>思路</h3> 
<p>重设屏幕属性：density、densityDpi、scaledDensity</p> 
<h3><a id="_165"></a>核心代码</h3> 
<p>假设以宽为基准进行适配，设计图尺寸1920x1080，代码如下：</p> 
<pre><code class="prism language-kotlin"><span class="token comment">//获取设备原始值</span>
<span class="token keyword">val</span> appDm <span class="token operator">=</span> application<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>displayMetrics
<span class="token keyword">val</span> appSD <span class="token operator">=</span> appDm<span class="token punctuation">.</span>scaledDensity
<span class="token comment">//增加对系统配置的监听，用于监听系统字体的改变</span>
application<span class="token punctuation">.</span><span class="token function">registerComponentCallbacks</span><span class="token punctuation">(</span><span class="token keyword">object</span> <span class="token operator">:</span> ComponentCallbacks <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onConfigurationChanged</span><span class="token punctuation">(</span>newConfig<span class="token operator">:</span> Configuration<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>newConfig<span class="token operator">!=</span><span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> newConfig<span class="token punctuation">.</span>fontScale<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            appSD <span class="token operator">=</span> application<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>displayMetrics<span class="token punctuation">.</span>scaledDensity
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">override</span> <span class="token keyword">fun</span> <span class="token function">onLowMemory</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">//计算目标值</span>
<span class="token keyword">val</span> targetDensity <span class="token operator">=</span> appDm<span class="token punctuation">.</span>widthPixels <span class="token operator">/</span> <span class="token number">1080</span><span class="token punctuation">;</span>	<span class="token comment">//此以宽为基准，高同理。</span>
<span class="token keyword">val</span> targetDensityDpi <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span> <span class="token punctuation">(</span>targetDensity <span class="token operator">*</span> <span class="token number">160</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">val</span> targetScaledDensity <span class="token operator">=</span> appSD <span class="token operator">*</span> <span class="token punctuation">(</span>targetDensity <span class="token operator">/</span> appDm<span class="token punctuation">.</span>density<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//改变设备值</span>
<span class="token keyword">val</span> dm <span class="token operator">=</span> activity<span class="token punctuation">.</span>resources<span class="token punctuation">.</span>displayMetrics
dm<span class="token punctuation">.</span>density <span class="token operator">=</span> targetDensity<span class="token punctuation">;</span>
dm<span class="token punctuation">.</span>densityDpi <span class="token operator">=</span> targetDensityDpi<span class="token punctuation">;</span>
dm<span class="token punctuation">.</span>scaledDensity <span class="token operator">=</span> targetScaledDensity<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_197"></a>参考</h3> 
<p><a href="https://developer.android.google.cn/guide/practices/screens_support?hl=zh-cn" rel="nofollow">Android官网：屏幕兼容性概览</a></p> 
<p><a href="https://mp.weixin.qq.com/s/d9QCoBP6kV9VSWvVldVVwA" rel="nofollow">今日头条：一种极低成本的Android屏幕适配方式</a><br> dDensity;</p> 
<pre><code>
## 参考

[Android官网：屏幕兼容性概览](https://developer.android.google.cn/guide/practices/screens_support?hl=zh-cn)

[今日头条：一种极低成本的Android屏幕适配方式](https://mp.weixin.qq.com/s/d9QCoBP6kV9VSWvVldVVwA)
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/79ca8f78c909b2feb21dd60b68b76ccd/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">输出mysql数据库中文数据出现乱码解决方法</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/cb6a87b35bc4e5115b2925e2e2fecf43/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">锂离子电池热失控预警资料整理（三）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>