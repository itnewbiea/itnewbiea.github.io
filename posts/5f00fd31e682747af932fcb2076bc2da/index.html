<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Spark环境搭建教程 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Spark环境搭建教程" />
<meta property="og:description" content="Spark环境搭建教程 前言Spark环境搭建-Local-本地模式准备工作原理操作-开箱即用测试 Spark环境搭建-Standalone-独立集群原理操作测试 Spark环境搭建-Standalone-HA原理操作测试 Spark环境搭建-Spark-On-Yarn原理准备工作0.关闭之前的Spark-Standalone集群1.配置Yarn历史服务器并关闭资源检查2.配置Spark的历史服务器和Yarn的整合3.配置依赖的Spark 的jar包4.启动服务 两种模式client-了解cluster模式-开发使用 操作client模式cluster模式 补充:spark-shell和spark-submit Spark程序开发-重点准备工作代码实现-WordCount代码实现-On-YarnWordCount图解 扩展:练习题 蒙特卡罗算法求PI思路代码实现 前言 Spark 是一种基于内存的快速、通用、可扩展的大数据分析计算引擎。
本项目学习内容：
Spark基础概念Spark不同运行模式环境搭建：local、Standalone、Standalone HA、Spark on YARNIDEA搭建Spark开发环境，实现CountWord示例demo 本项目属于《Spark系列》。详细示例代码和图片展示，点下面github链接：
[《Spark环境搭建》]
https://github.com/xiaoguangbiao-github/bigdata_spark_env.git
[《Spark内核原理及RDD》]
*https://github.com/xiaoguangbiao-github/bigdata_spark_core.git
[《SparkStreaming &amp; SparkSql》]
https://github.com/xiaoguangbiao-github/bigdata_sparkstreaming_sparksql.git
[《StructuredStreaming &amp; Spark综合案例》]
https://github.com/xiaoguangbiao-github/bigdata_structuredstreaming_sparkdemo.git
[《Spark3.0新特性 &amp; Spark多语言开发》]
https://github.com/xiaoguangbiao-github/bigdata_spark3_languagedevelop.git
Spark环境搭建-Local-本地模式 准备工作 1.JDK
2.ScalaSDK只需要在Windows安装即可
3.Spark安装包
http://spark.apache.org/downloads.html
我这里使用：spark-3.0.1-bin-hadoop2.7.tgz
原理 [外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-gwYuztzb-1648349412133)(img/1609551528270.png)]
操作-开箱即用 1.上传解压安装包
tar -zxvf spark-3.0.1-bin-hadoop2.7.tgz
2.修改权限
chown -R root /export/server/spark-3.0.1-bin-hadoop2.7
chgrp -R root /export/server/spark-3.0.1-bin-hadoop2.7
3.创建软连接（或改名）
ln -s /export/server/spark-3.0.1-bin-hadoop2.7 /export/server/spark
4.查看安装目录
测试 1.启动spark交互式窗口
/export/server/spark/bin/spark-shell" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5f00fd31e682747af932fcb2076bc2da/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-07-18T15:19:25+08:00" />
<meta property="article:modified_time" content="2022-07-18T15:19:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Spark环境搭建教程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>Spark环境搭建教程</h4> 
 <ul><li><a href="#_4" rel="nofollow">前言</a></li><li><a href="#SparkLocal_32" rel="nofollow">Spark环境搭建-Local-本地模式</a></li><li><ul><li><a href="#_34" rel="nofollow">准备工作</a></li><li><a href="#_44" rel="nofollow">原理</a></li><li><a href="#_48" rel="nofollow">操作-开箱即用</a></li><li><a href="#_68" rel="nofollow">测试</a></li></ul> 
  </li><li><a href="#SparkStandalone_105" rel="nofollow">Spark环境搭建-Standalone-独立集群</a></li><li><ul><li><a href="#_107" rel="nofollow">原理</a></li><li><a href="#_111" rel="nofollow">操作</a></li><li><a href="#_197" rel="nofollow">测试</a></li></ul> 
  </li><li><a href="#SparkStandaloneHA_310" rel="nofollow">Spark环境搭建-Standalone-HA</a></li><li><ul><li><a href="#_312" rel="nofollow">原理</a></li><li><a href="#_316" rel="nofollow">操作</a></li><li><a href="#_350" rel="nofollow">测试</a></li></ul> 
  </li><li><a href="#SparkSparkOnYarn_423" rel="nofollow">Spark环境搭建-Spark-On-Yarn</a></li><li><ul><li><a href="#_425" rel="nofollow">原理</a></li><li><a href="#_439" rel="nofollow">准备工作</a></li><li><ul><li><a href="#0SparkStandalone_441" rel="nofollow">0.关闭之前的Spark-Standalone集群</a></li><li><a href="#1Yarn_445" rel="nofollow">1.配置Yarn历史服务器并关闭资源检查</a></li><li><a href="#2SparkYarn_514" rel="nofollow">2.配置Spark的历史服务器和Yarn的整合</a></li><li><a href="#3Spark_jar_602" rel="nofollow">3.配置依赖的Spark 的jar包</a></li><li><a href="#4_634" rel="nofollow">4.启动服务</a></li></ul> 
   </li><li><a href="#_666" rel="nofollow">两种模式</a></li><li><ul><li><a href="#client_668" rel="nofollow">client-了解</a></li><li><a href="#cluster_672" rel="nofollow">cluster模式-开发使用</a></li></ul> 
   </li><li><a href="#_676" rel="nofollow">操作</a></li><li><ul><li><a href="#client_688" rel="nofollow">client模式</a></li><li><a href="#cluster_715" rel="nofollow">cluster模式</a></li></ul> 
   </li><li><a href="#sparkshellsparksubmit_748" rel="nofollow">补充:spark-shell和spark-submit</a></li></ul> 
  </li><li><a href="#Spark_940" rel="nofollow">Spark程序开发-重点</a></li><li><ul><li><a href="#_942" rel="nofollow">准备工作</a></li><li><a href="#WordCount_1171" rel="nofollow">代码实现-WordCount</a></li><li><a href="#OnYarn_1224" rel="nofollow">代码实现-On-Yarn</a></li><li><a href="#WordCount_1330" rel="nofollow">WordCount图解</a></li></ul> 
  </li><li><a href="#_PI_1338" rel="nofollow">扩展:练习题 蒙特卡罗算法求PI</a></li><li><ul><li><a href="#_1340" rel="nofollow">思路</a></li><li><a href="#_1346" rel="nofollow">代码实现</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<h2><a id="_4"></a>前言</h2> 
<p>  Spark 是一种基于内存的快速、通用、可扩展的大数据分析计算引擎。</p> 
<p>  本项目学习内容：</p> 
<ul><li>Spark基础概念</li><li>Spark不同运行模式环境搭建：local、Standalone、Standalone HA、Spark on YARN</li><li>IDEA搭建Spark开发环境，实现CountWord示例demo</li></ul> 
<p>  <strong>本项目属于《Spark系列》。详细示例代码和图片展示，点下面github链接</strong>：</p> 
<ul><li> <p>[《Spark环境搭建》]<br> https://github.com/xiaoguangbiao-github/bigdata_spark_env.git</p> </li><li> <p>[《Spark内核原理及RDD》]<br> *https://github.com/xiaoguangbiao-github/bigdata_spark_core.git</p> </li><li> <p>[《SparkStreaming &amp; SparkSql》]<br> https://github.com/xiaoguangbiao-github/bigdata_sparkstreaming_sparksql.git</p> </li><li> <p>[《StructuredStreaming &amp; Spark综合案例》]<br> https://github.com/xiaoguangbiao-github/bigdata_structuredstreaming_sparkdemo.git</p> </li><li> <p>[《Spark3.0新特性 &amp; Spark多语言开发》]<br> https://github.com/xiaoguangbiao-github/bigdata_spark3_languagedevelop.git</p> </li></ul> 
<hr> 
<h2><a id="SparkLocal_32"></a>Spark环境搭建-Local-本地模式</h2> 
<h3><a id="_34"></a>准备工作</h3> 
<p>1.JDK</p> 
<p>2.ScalaSDK只需要在Windows安装即可</p> 
<p>3.Spark安装包<br> http://spark.apache.org/downloads.html<br> 我这里使用：spark-3.0.1-bin-hadoop2.7.tgz</p> 
<h3><a id="_44"></a>原理</h3> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-gwYuztzb-1648349412133)(img/1609551528270.png)]</p> 
<h3><a id="_48"></a>操作-开箱即用</h3> 
<p>1.上传解压安装包</p> 
<p>tar -zxvf spark-3.0.1-bin-hadoop2.7.tgz</p> 
<p>2.修改权限</p> 
<p>chown -R root /export/server/spark-3.0.1-bin-hadoop2.7</p> 
<p>chgrp -R root /export/server/spark-3.0.1-bin-hadoop2.7</p> 
<p>3.创建软连接（或改名）</p> 
<p>ln -s /export/server/spark-3.0.1-bin-hadoop2.7 /export/server/spark</p> 
<p>4.查看安装目录</p> 
<h3><a id="_68"></a>测试</h3> 
<p>1.启动spark交互式窗口</p> 
<p>/export/server/spark/bin/spark-shell</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-vFrPqpYj-1648349412134)(img/1609551940572.png)]</p> 
<p>2.打开http://ip:4040</p> 
<p>3.准备文件</p> 
<p>vim /root/words.txt</p> 
<pre><code>hello me you her
hello me you
hello me
hello
</code></pre> 
<p>4.spark交互式窗口中执行WordCount</p> 
<pre><code class="prism language-Java">val textFile = sc.textFile("file:///root/words.txt")
val counts = textFile.flatMap(_.split(" ")).map((_,1)).reduceByKey(_ + _)
counts.collect
</code></pre> 
<h2><a id="SparkStandalone_105"></a>Spark环境搭建-Standalone-独立集群</h2> 
<h3><a id="_107"></a>原理</h3> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-fX3JpBY7-1648349412138)(img/1609553123267.png)]</p> 
<h3><a id="_111"></a>操作</h3> 
<p>1.环境准备</p> 
<p>node1:master</p> 
<p>ndoe2:worker/slave</p> 
<p>node3:worker/slave</p> 
<p><a href="https://github.com/xiaoguangbiao-github/bigdata_hadoop_env/blob/main/README.md">《先安装hadoop集群》</a></p> 
<p>2.配置slaves/workers</p> 
<p>进入配置目录</p> 
<p>cd /export/server/spark/conf</p> 
<p>修改配置文件名称</p> 
<p>mv slaves.template slaves</p> 
<p>vim slaves</p> 
<p>内容如下：</p> 
<pre><code>node2
node3
</code></pre> 
<p>3.配置master</p> 
<p>进入配置目录</p> 
<p>cd /export/server/spark/conf</p> 
<p>修改配置文件名称</p> 
<p>mv spark-env.sh.template spark-env.sh</p> 
<p>修改配置文件</p> 
<p>vim spark-env.sh</p> 
<p>增加如下内容：</p> 
<pre><code>## 设置JAVA安装目录
JAVA_HOME=/export/server/jdk

## HADOOP软件配置文件目录，读取HDFS上文件和运行Spark在YARN集群时需要,先提前配上
HADOOP_CONF_DIR=/export/server/hadoop/etc/hadoop
YARN_CONF_DIR=/export/server/hadoop/etc/hadoop

## 指定spark老大Master的IP和提交任务的通信端口
SPARK_MASTER_HOST=node1
SPARK_MASTER_PORT=7077

SPARK_MASTER_WEBUI_PORT=8080

SPARK_WORKER_CORES=1
SPARK_WORKER_MEMORY=1g
</code></pre> 
<p>4.分发</p> 
<p>将配置好的将 Spark 安装包分发给集群中其它机器，命令如下：</p> 
<p>cd /export/server/</p> 
<p>scp -r spark-3.0.1-bin-hadoop2.7 root@node2:$PWD</p> 
<p>scp -r spark-3.0.1-bin-hadoop2.7 root@node3:$PWD</p> 
<p>创建软连接</p> 
<p>ln -s /export/server/spark-3.0.1-bin-hadoop2.7 /export/server/spark</p> 
<h3><a id="_197"></a>测试</h3> 
<p>1.集群启动和停止</p> 
<p>在主节点上启动spark集群</p> 
<p>/export/server/spark/sbin/start-all.sh</p> 
<p>在主节点上停止spark集群</p> 
<p>/export/server/spark/sbin/stop-all.sh</p> 
<p>在主节点上单独启动和停止Master：</p> 
<p>start-master.sh</p> 
<p>stop-master.sh</p> 
<p>在从节点上单独启动和停止Worker(Worker指的是slaves配置文件中的主机名)</p> 
<p>start-slaves.sh</p> 
<p>stop-slaves.sh</p> 
<p>2.jps查看进程</p> 
<p>node1:master</p> 
<p>node2/node3:worker</p> 
<p>3.http://node1:8080/</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-gqqxMdN3-1648349412139)(img/1609553906442.png)]</p> 
<p>4.启动spark-shell</p> 
<p>/export/server/spark/bin/spark-shell --master spark://node1:7077</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-fhOWpfiZ-1648349412140)(img/1609554065732.png)]</p> 
<p>5.提交WordCount任务</p> 
<p>注意:上传文件到hdfs方便worker读取</p> 
<p>上传文件到hdfs</p> 
<p>hadoop fs -put /root/words.txt /wordcount/input/words.txt</p> 
<p>目录如果不存在可以创建</p> 
<p>hadoop fs -mkdir -p /wordcount/input</p> 
<p>结束后可以删除测试文件夹</p> 
<p>hadoop fs -rm -r /wordcount</p> 
<pre><code class="prism language-Java">val textFile = sc.textFile("hdfs://node1:8020/wordcount/input/words.txt")
val counts = textFile.flatMap(_.split(" ")).map((_,1)).reduceByKey(_ + _)
counts.collect
counts.saveAsTextFile("hdfs://node1:8020/wordcount/output47")
</code></pre> 
<p>6.查看结果</p> 
<p>http://node1:50070/explorer.html#/wordcount/output47</p> 
<p>7.查看spark任务web-ui</p> 
<p>http://node1:4040/jobs/</p> 
<p>总结:</p> 
<p>spark: 4040 任务运行web-ui界面端口</p> 
<p>spark: 8080 spark集群web-ui界面端口</p> 
<p>spark: 7077 spark提交任务时的通信端口</p> 
<p>hadoop: 50070集群web-ui界面端口</p> 
<p>hadoop:8020/9000(老版本) 文件上传下载通信端口</p> 
<p>8.停止集群</p> 
<p>/export/server/spark/sbin/stop-all.sh</p> 
<h2><a id="SparkStandaloneHA_310"></a>Spark环境搭建-Standalone-HA</h2> 
<h3><a id="_312"></a>原理</h3> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-lcNZBjww-1648349412140)(img/1609555149171.png)]</p> 
<h3><a id="_316"></a>操作</h3> 
<p>1.启动zk</p> 
<p>2.修改配置</p> 
<p>vim /export/server/spark/conf/spark-env.sh</p> 
<p>注释</p> 
<pre><code>#SPARK_MASTER_HOST=node1
</code></pre> 
<p>增加</p> 
<pre><code>SPARK_DAEMON_JAVA_OPTS="-Dspark.deploy.recoveryMode=ZOOKEEPER -Dspark.deploy.zookeeper.url=node1:2181,node2:2181,node3:2181 -Dspark.deploy.zookeeper.dir=/spark-ha"
</code></pre> 
<p>3.分发配置</p> 
<p>cd /export/server/spark/conf</p> 
<p>scp -r spark-env.sh root@node2:$PWD</p> 
<p>scp -r spark-env.sh root@node3:$PWD</p> 
<h3><a id="_350"></a>测试</h3> 
<p>0.启动zk服务</p> 
<p>zkServer.sh status</p> 
<p>zkServer.sh stop</p> 
<p>zkServer.sh start</p> 
<p>1.node1上启动Spark集群执行</p> 
<p>/export/server/spark/sbin/start-all.sh</p> 
<p>2.在node2上再单独只起个master:</p> 
<p>/export/server/spark/sbin/start-master.sh</p> 
<p>3.查看WebUI</p> 
<p>http://node1:8080/</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-FjJC4YA3-1648349412141)(img/1609555501043.png)]</p> 
<p>http://node2:8080/</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-jLjtPA5o-1648349412141)(img/1609555527846.png)]</p> 
<p>4.模拟node1宕机</p> 
<p>jps</p> 
<p>kill -9 进程id</p> 
<p>5.再次查看web-ui</p> 
<p>http://node1:8080/</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-HT7LEVkw-1648349412141)(img/1609555613242.png)]</p> 
<p>http://node2:8080/</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-JXFJ7DkR-1648349412142)(img/1609555644807.png)]</p> 
<p>6.测试WordCount</p> 
<p>/export/server/spark/bin/spark-shell --master spark://node1:7077,node2:7077</p> 
<p>运行</p> 
<pre><code class="prism language-Java">val textFile = sc.textFile("hdfs://node1:8020/wordcount/input/words.txt")
val counts = textFile.flatMap(_.split(" ")).map((_,1)).reduceByKey(_ + _)
counts.collect
counts.saveAsTextFile("hdfs://node1:8020/wordcount/output47_2")
</code></pre> 
<h2><a id="SparkSparkOnYarn_423"></a>Spark环境搭建-Spark-On-Yarn</h2> 
<h3><a id="_425"></a>原理</h3> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Equ2AtXc-1648349412142)(img/1609556988870.png)]</p> 
<p>注意:</p> 
<p>在实际开发中, 大数据任务都有统一的资源管理和任务调度工具来进行管理! —Yarn使用的最多!</p> 
<p>因为它成熟稳定, 支持多种调度策略:FIFO/Capcity/Fair</p> 
<p>可以使用Yarn调度管理MR/Hive/Spark/Flink</p> 
<h3><a id="_439"></a>准备工作</h3> 
<h4><a id="0SparkStandalone_441"></a>0.关闭之前的Spark-Standalone集群</h4> 
<p>/export/server/spark/sbin/stop-all.sh</p> 
<h4><a id="1Yarn_445"></a>1.配置Yarn历史服务器并关闭资源检查</h4> 
<p>vim /export/server/hadoop/etc/hadoop/yarn-site.xml</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 配置yarn主节点的位置 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.resourcemanager.hostname<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>node1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.aux-services<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>mapreduce_shuffle<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 设置yarn集群的内存分配方案 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.resource.memory-mb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>20480<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.scheduler.minimum-allocation-mb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>2048<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.vmem-pmem-ratio<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>2.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 开启日志聚合功能 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log-aggregation-enable<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 设置聚合日志在hdfs上的保存时间 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log-aggregation.retain-seconds<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>604800<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 设置yarn历史服务器地址 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.log.server.url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>http://node1:19888/jobhistory/logs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 关闭yarn内存检查 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.pmem-check-enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>property</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>yarn.nodemanager.vmem-check-enabled<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>value</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>value</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>property</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>注意:如果之前没有配置,现在配置了需要分发并重启yarn</p> 
<p>cd /export/server/hadoop/etc/hadoop</p> 
<p>scp -r yarn-site.xml root@node2:$PWD</p> 
<p>scp -r yarn-site.xml root@node3:$PWD</p> 
<p>/export/server/hadoop/sbin/stop-yarn.sh</p> 
<p>/export/server/hadoop/sbin/start-yarn.sh</p> 
<h4><a id="2SparkYarn_514"></a>2.配置Spark的历史服务器和Yarn的整合</h4> 
<ul><li>修改spark-defaults.conf</li></ul> 
<p>进入配置目录</p> 
<p>cd /export/server/spark/conf</p> 
<p>修改配置文件名称</p> 
<p>mv spark-defaults.conf.template spark-defaults.conf</p> 
<p>vim spark-defaults.conf</p> 
<p>添加内容：</p> 
<pre><code class="prism language-xml">spark.eventLog.enabled                  true
spark.eventLog.dir                      hdfs://node1:8020/sparklog/
spark.eventLog.compress                 true
spark.yarn.historyServer.address        node1:18080
</code></pre> 
<ul><li>修改spark-env.sh</li></ul> 
<p>修改配置文件</p> 
<p>vim /export/server/spark/conf/spark-env.sh</p> 
<p>增加如下内容：</p> 
<pre><code class="prism language-xml">## 配置spark历史日志存储地址
SPARK_HISTORY_OPTS="-Dspark.history.fs.logDirectory=hdfs://node1:8020/sparklog/ -Dspark.history.fs.cleaner.enabled=true"
</code></pre> 
<p>注意:sparklog需要手动创建</p> 
<p>hadoop fs -mkdir -p /sparklog</p> 
<ul><li>修改日志级别</li></ul> 
<p>进入目录</p> 
<p>cd /export/server/spark/conf</p> 
<p>修改日志属性配置文件名称</p> 
<p>mv log4j.properties.template log4j.properties</p> 
<p>改变日志级别</p> 
<p>vim log4j.properties</p> 
<p>修改内容如下：</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-9Nb653k0-1648349412143)(img/1609557920445.png)]</p> 
<ul><li> <p>分发-可选,如果只在node1上提交spark任务到yarn,那么不需要分发</p> <p>cd /export/server/spark/conf</p> <p>scp -r spark-env.sh root@node2:$PWD</p> <p>scp -r spark-env.sh root@node3:$PWD</p> <p>scp -r spark-defaults.conf root@node2:$PWD</p> <p>scp -r spark-defaults.conf root@node3:$PWD</p> <p>scp -r log4j.properties root@node2:$PWD</p> <p>scp -r log4j.properties root@node3:$PWD</p> </li></ul> 
<h4><a id="3Spark_jar_602"></a>3.配置依赖的Spark 的jar包</h4> 
<p>1.在HDFS上创建存储spark相关jar包的目录</p> 
<p>hadoop fs -mkdir -p /spark/jars/</p> 
<p>2.上传$SPARK_HOME/jars所有jar包到HDFS</p> 
<p>hadoop fs -put /export/server/spark/jars/* /spark/jars/</p> 
<p>3.在node1上修改spark-defaults.conf</p> 
<p>vim /export/server/spark/conf/spark-defaults.conf</p> 
<p>添加内容</p> 
<p>spark.yarn.jars hdfs://node1:8020/spark/jars/*</p> 
<p>分发同步-可选</p> 
<p>cd /export/server/spark/conf</p> 
<p>scp -r spark-defaults.conf root@node2:$PWD</p> 
<p>scp -r spark-defaults.conf root@node3:$PWD</p> 
<h4><a id="4_634"></a>4.启动服务</h4> 
<p>- 启动HDFS和YARN服务，在node1执行命令</p> 
<p>start-dfs.sh</p> 
<p>start-yarn.sh</p> 
<p>或</p> 
<p>start-all.sh</p> 
<p>-启动MRHistoryServer服务，在node1执行命令</p> 
<p>mr-jobhistory-daemon.sh start historyserver</p> 
<p>- 启动Spark HistoryServer服务，，在node1执行命令</p> 
<p>/export/server/spark/sbin/start-history-server.sh</p> 
<p>- MRHistoryServer服务WEB UI页面：</p> 
<p>http://node1:19888</p> 
<p>- Spark HistoryServer服务WEB UI页面：</p> 
<p>http://node1:18080/</p> 
<h3><a id="_666"></a>两种模式</h3> 
<h4><a id="client_668"></a>client-了解</h4> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-Umtreyhr-1648349412143)(img/1609558928933.png)]</p> 
<h4><a id="cluster_672"></a>cluster模式-开发使用</h4> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-pWkcqMX1-1648349412143)(img/1609559145839.png)]</p> 
<h3><a id="_676"></a>操作</h3> 
<p>1.需要Yarn集群</p> 
<p>2.历史服务器</p> 
<p>3.提交任务的的客户端工具-spark-submit命令</p> 
<p>4.待提交的spark任务/程序的字节码–可以使用示例程序</p> 
<h4><a id="client_688"></a>client模式</h4> 
<pre><code class="prism language-shell"><span class="token assign-left variable">SPARK_HOME</span><span class="token operator">=</span>/export/server/spark
<span class="token variable">${SPARK_HOME}</span>/bin/spark-submit <span class="token punctuation">\</span>
--master <span class="token function">yarn</span>  <span class="token punctuation">\</span>
--deploy-mode client <span class="token punctuation">\</span>
--driver-memory 512m <span class="token punctuation">\</span>
--driver-cores <span class="token number">1</span> <span class="token punctuation">\</span>
--executor-memory 512m <span class="token punctuation">\</span>
--num-executors <span class="token number">2</span> <span class="token punctuation">\</span>
--executor-cores <span class="token number">1</span> <span class="token punctuation">\</span>
--class org.apache.spark.examples.SparkPi <span class="token punctuation">\</span>
<span class="token variable">${SPARK_HOME}</span>/examples/jars/spark-examples_2.12-3.0.1.jar <span class="token punctuation">\</span>
<span class="token number">10</span>
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-9Hu4T6Wn-1648349412144)(img/1609559716814.png)]</p> 
<p>查看web界面</p> 
<p>http://node1:8088/cluster</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-PpiBOYkT-1648349412144)(img/1609559733251.png)]</p> 
<h4><a id="cluster_715"></a>cluster模式</h4> 
<pre><code class="prism language-shell"><span class="token assign-left variable">SPARK_HOME</span><span class="token operator">=</span>/export/server/spark
<span class="token variable">${SPARK_HOME}</span>/bin/spark-submit <span class="token punctuation">\</span>
--master <span class="token function">yarn</span> <span class="token punctuation">\</span>
--deploy-mode cluster <span class="token punctuation">\</span>
--driver-memory 512m <span class="token punctuation">\</span>
--executor-memory 512m <span class="token punctuation">\</span>
--num-executors <span class="token number">1</span> <span class="token punctuation">\</span>
--class org.apache.spark.examples.SparkPi <span class="token punctuation">\</span>
<span class="token variable">${SPARK_HOME}</span>/examples/jars/spark-examples_2.12-3.0.1.jar <span class="token punctuation">\</span>
<span class="token number">10</span>
</code></pre> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-8ie2LjLT-1648349412144)(img/1609559916055.png)]</p> 
<p>查看web界面</p> 
<p>http://node1:8088/cluster</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-AAyCyRMh-1648349412145)(img/1609559855972.png)]</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-tU231kzR-1648349412145)(img/1609559996420.png)]</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-KxlLnUIp-1648349412146)(img/1609560007156.png)]</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-AmkEyJqv-1648349412146)(img/1609560033520.png)]</p> 
<h3><a id="sparkshellsparksubmit_748"></a>补充:spark-shell和spark-submit</h3> 
<ul><li>两个命令的区别</li></ul> 
<p>spark-shell:spark应用交互式窗口,启动后可以直接编写spark代码,即时运行,一般在学习测试时使用</p> 
<p>spark-submit:用来将spark任务/程序的jar包提交到spark集群(一般都是提交到Yarn集群)</p> 
<ul><li>可以携带哪些参数 
  <ul><li>–master: 默认是local[*] ,或者指定 --master local[2], --master spark://node1:7077,–master yarn</li><li>其他参数</li></ul> </li></ul> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment"># ./spark-shell --help</span>
Usage: ./bin/spark-shell <span class="token punctuation">[</span>options<span class="token punctuation">]</span>

Scala REPL options:
  -I <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>                   preload <span class="token operator">&lt;</span>file<span class="token operator">&gt;</span>, enforcing line-by-line interpretation

Options:
  --master MASTER_URL         spark://host:port, mesos://host:port, yarn,
                              k8s://https://host:port, or <span class="token builtin class-name">local</span> <span class="token punctuation">(</span>Default: local<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token punctuation">)</span>.
  --deploy-mode DEPLOY_MODE   Whether to launch the driver program locally <span class="token punctuation">(</span><span class="token string">"client"</span><span class="token punctuation">)</span> or
                              on one of the worker machines inside the cluster <span class="token punctuation">(</span><span class="token string">"cluster"</span><span class="token punctuation">)</span>
                              <span class="token punctuation">(</span>Default: client<span class="token punctuation">)</span>.
  --class CLASS_NAME          Your application's main class <span class="token punctuation">(</span>for Java / Scala apps<span class="token punctuation">)</span>.
  --name NAME                 A name of your application.
  --jars JARS                 Comma-separated list of jars to include on the driver
                              and executor classpaths.
  --packages                  Comma-separated list of maven coordinates of jars to include
                              on the driver and executor classpaths. Will search the <span class="token builtin class-name">local</span>
                              maven repo, <span class="token keyword">then</span> maven central and any additional remote
                              repositories given by --repositories. The <span class="token function">format</span> <span class="token keyword">for</span> the
                              coordinates should be groupId:artifactId:version.
  --exclude-packages          Comma-separated list of groupId:artifactId, to exclude <span class="token keyword">while</span>
                              resolving the dependencies provided <span class="token keyword">in</span> --packages to avoid
                              dependency conflicts.
  --repositories              Comma-separated list of additional remote repositories to
                              search <span class="token keyword">for</span> the maven coordinates given with --packages.
  --py-files PY_FILES         Comma-separated list of .zip, .egg, or .py files to place
                              on the PYTHONPATH <span class="token keyword">for</span> Python apps.
  --files FILES               Comma-separated list of files to be placed <span class="token keyword">in</span> the working
                              directory of each executor. File paths of these files
                              <span class="token keyword">in</span> executors can be accessed via SparkFiles.get<span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>.

  --conf, -c <span class="token assign-left variable">PROP</span><span class="token operator">=</span>VALUE       Arbitrary Spark configuration property.
  --properties-file FILE      Path to a <span class="token function">file</span> from <span class="token function">which</span> to load extra properties. If not
                              specified, this will <span class="token function">look</span> <span class="token keyword">for</span> conf/spark-defaults.conf.

  --driver-memory MEM         Memory <span class="token keyword">for</span> driver <span class="token punctuation">(</span>e.g. 1000M, 2G<span class="token punctuation">)</span> <span class="token punctuation">(</span>Default: 1024M<span class="token punctuation">)</span>.
  --driver-java-options       Extra Java options to pass to the driver.
  --driver-library-path       Extra library path entries to pass to the driver.
  --driver-class-path         Extra class path entries to pass to the driver. Note that
                              jars added with --jars are automatically included <span class="token keyword">in</span> the
                              classpath.

  --executor-memory MEM       Memory per executor <span class="token punctuation">(</span>e.g. 1000M, 2G<span class="token punctuation">)</span> <span class="token punctuation">(</span>Default: 1G<span class="token punctuation">)</span>.

  --proxy-user NAME           User to impersonate when submitting the application.
                              This argument does not work with --principal / --keytab.

  --help, -h                  Show this <span class="token builtin class-name">help</span> message and exit.
  --verbose, -v               Print additional debug output.
  --version,                  Print the version of current Spark.

 Cluster deploy mode only:
  --driver-cores NUM          Number of cores used by the driver, only <span class="token keyword">in</span> cluster mode
                              <span class="token punctuation">(</span>Default: <span class="token number">1</span><span class="token punctuation">)</span>.

 Spark standalone or Mesos with cluster deploy mode only:
  --supervise                 If given, restarts the driver on failure.

 Spark standalone, Mesos or K8s with cluster deploy mode only:
  --kill SUBMISSION_ID        If given, kills the driver specified.
  --status SUBMISSION_ID      If given, requests the status of the driver specified.

 Spark standalone, Mesos and Kubernetes only:
  --total-executor-cores NUM  Total cores <span class="token keyword">for</span> all executors.

 Spark standalone, YARN and Kubernetes only:
  --executor-cores NUM        Number of cores used by each executor. <span class="token punctuation">(</span>Default: <span class="token number">1</span> <span class="token keyword">in</span>
                              YARN and K8S modes, or all available cores on the worker
                              <span class="token keyword">in</span> standalone mode<span class="token punctuation">)</span>.

 Spark on YARN and Kubernetes only:
  --num-executors NUM         Number of executors to launch <span class="token punctuation">(</span>Default: <span class="token number">2</span><span class="token punctuation">)</span>.
                              If dynamic allocation is enabled, the initial number of
                              executors will be at least NUM.
  --principal PRINCIPAL       Principal to be used to login to KDC.
  --keytab KEYTAB             The full path to the <span class="token function">file</span> that contains the keytab <span class="token keyword">for</span> the
                              principal specified above.

 Spark on YARN only:
  --queue QUEUE_NAME          The YARN queue to submit to <span class="token punctuation">(</span>Default: <span class="token string">"default"</span><span class="token punctuation">)</span>.
  --archives ARCHIVES         Comma separated list of archives to be extracted into the
                              working directory of each executor.
</code></pre> 
<pre><code class="prism language-shell"><span class="token punctuation">[</span>root@node1 bin<span class="token punctuation">]</span><span class="token comment"># ./spark-submit --help</span>
Usage: spark-submit <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>app jar <span class="token operator">|</span> python <span class="token function">file</span> <span class="token operator">|</span> R file<span class="token operator">&gt;</span> <span class="token punctuation">[</span>app arguments<span class="token punctuation">]</span>
Usage: spark-submit --kill <span class="token punctuation">[</span>submission ID<span class="token punctuation">]</span> --master <span class="token punctuation">[</span>spark://<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
Usage: spark-submit --status <span class="token punctuation">[</span>submission ID<span class="token punctuation">]</span> --master <span class="token punctuation">[</span>spark://<span class="token punctuation">..</span>.<span class="token punctuation">]</span>
Usage: spark-submit run-example <span class="token punctuation">[</span>options<span class="token punctuation">]</span> example-class <span class="token punctuation">[</span>example args<span class="token punctuation">]</span>

Options:
  --master MASTER_URL         spark://host:port, mesos://host:port, yarn,
                              k8s://https://host:port, or <span class="token builtin class-name">local</span> <span class="token punctuation">(</span>Default: local<span class="token punctuation">[</span>*<span class="token punctuation">]</span><span class="token punctuation">)</span>.
  --deploy-mode DEPLOY_MODE   Whether to launch the driver program locally <span class="token punctuation">(</span><span class="token string">"client"</span><span class="token punctuation">)</span> or
                              on one of the worker machines inside the cluster <span class="token punctuation">(</span><span class="token string">"cluster"</span><span class="token punctuation">)</span>
                              <span class="token punctuation">(</span>Default: client<span class="token punctuation">)</span>.
  --class CLASS_NAME          Your application's main class <span class="token punctuation">(</span>for Java / Scala apps<span class="token punctuation">)</span>.
  --name NAME                 A name of your application.
  --jars JARS                 Comma-separated list of jars to include on the driver
                              and executor classpaths.
  --packages                  Comma-separated list of maven coordinates of jars to include
                              on the driver and executor classpaths. Will search the <span class="token builtin class-name">local</span>
                              maven repo, <span class="token keyword">then</span> maven central and any additional remote
                              repositories given by --repositories. The <span class="token function">format</span> <span class="token keyword">for</span> the
                              coordinates should be groupId:artifactId:version.
  --exclude-packages          Comma-separated list of groupId:artifactId, to exclude <span class="token keyword">while</span>
                              resolving the dependencies provided <span class="token keyword">in</span> --packages to avoid
                              dependency conflicts.
  --repositories              Comma-separated list of additional remote repositories to
                              search <span class="token keyword">for</span> the maven coordinates given with --packages.
  --py-files PY_FILES         Comma-separated list of .zip, .egg, or .py files to place
                              on the PYTHONPATH <span class="token keyword">for</span> Python apps.
  --files FILES               Comma-separated list of files to be placed <span class="token keyword">in</span> the working
                              directory of each executor. File paths of these files
                              <span class="token keyword">in</span> executors can be accessed via SparkFiles.get<span class="token punctuation">(</span>fileName<span class="token punctuation">)</span>.

  --conf, -c <span class="token assign-left variable">PROP</span><span class="token operator">=</span>VALUE       Arbitrary Spark configuration property.
  --properties-file FILE      Path to a <span class="token function">file</span> from <span class="token function">which</span> to load extra properties. If not
                              specified, this will <span class="token function">look</span> <span class="token keyword">for</span> conf/spark-defaults.conf.

  --driver-memory MEM         Memory <span class="token keyword">for</span> driver <span class="token punctuation">(</span>e.g. 1000M, 2G<span class="token punctuation">)</span> <span class="token punctuation">(</span>Default: 1024M<span class="token punctuation">)</span>.
  --driver-java-options       Extra Java options to pass to the driver.
  --driver-library-path       Extra library path entries to pass to the driver.
  --driver-class-path         Extra class path entries to pass to the driver. Note that
                              jars added with --jars are automatically included <span class="token keyword">in</span> the
                              classpath.

  --executor-memory MEM       Memory per executor <span class="token punctuation">(</span>e.g. 1000M, 2G<span class="token punctuation">)</span> <span class="token punctuation">(</span>Default: 1G<span class="token punctuation">)</span>.

  --proxy-user NAME           User to impersonate when submitting the application.
                              This argument does not work with --principal / --keytab.

  --help, -h                  Show this <span class="token builtin class-name">help</span> message and exit.
  --verbose, -v               Print additional debug output.
  --version,                  Print the version of current Spark.

 Cluster deploy mode only:
  --driver-cores NUM          Number of cores used by the driver, only <span class="token keyword">in</span> cluster mode
                              <span class="token punctuation">(</span>Default: <span class="token number">1</span><span class="token punctuation">)</span>.

 Spark standalone or Mesos with cluster deploy mode only:
  --supervise                 If given, restarts the driver on failure.

 Spark standalone, Mesos or K8s with cluster deploy mode only:
  --kill SUBMISSION_ID        If given, kills the driver specified.
  --status SUBMISSION_ID      If given, requests the status of the driver specified.

 Spark standalone, Mesos and Kubernetes only:
  --total-executor-cores NUM  Total cores <span class="token keyword">for</span> all executors.

 Spark standalone, YARN and Kubernetes only:
  --executor-cores NUM        Number of cores used by each executor. <span class="token punctuation">(</span>Default: <span class="token number">1</span> <span class="token keyword">in</span>
                              YARN and K8S modes, or all available cores on the worker
                              <span class="token keyword">in</span> standalone mode<span class="token punctuation">)</span>.

 Spark on YARN and Kubernetes only:
  --num-executors NUM         Number of executors to launch <span class="token punctuation">(</span>Default: <span class="token number">2</span><span class="token punctuation">)</span>.
                              If dynamic allocation is enabled, the initial number of
                              executors will be at least NUM.
  --principal PRINCIPAL       Principal to be used to login to KDC.
  --keytab KEYTAB             The full path to the <span class="token function">file</span> that contains the keytab <span class="token keyword">for</span> the
                              principal specified above.

 Spark on YARN only:
  --queue QUEUE_NAME          The YARN queue to submit to <span class="token punctuation">(</span>Default: <span class="token string">"default"</span><span class="token punctuation">)</span>.
  --archives ARCHIVES         Comma separated list of archives to be extracted into the
                              working directory of each executor.
</code></pre> 
<h2><a id="Spark_940"></a>Spark程序开发-重点</h2> 
<h3><a id="_942"></a>准备工作</h3> 
<p>1.创建工程</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-InzSEtai-1648349412146)(img/1609570887897.png)]</p> 
<p>2.pom依赖</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.xiaoguangbiao<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>bigdata_spark_env<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.0-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repositories</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>aliyun<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>http://maven.aliyun.com/nexus/content/groups/public/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>apache<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.apache.org/content/repositories/snapshots/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>repository</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>id</span><span class="token punctuation">&gt;</span></span>cloudera<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>id</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>url</span><span class="token punctuation">&gt;</span></span>https://repository.cloudera.com/artifactory/cloudera-repos/<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>url</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repository</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>repositories</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.source</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>maven.compiler.target</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.version</span><span class="token punctuation">&gt;</span></span>2.12.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spark.version</span><span class="token punctuation">&gt;</span></span>3.0.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spark.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hadoop.version</span><span class="token punctuation">&gt;</span></span>2.7.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>hadoop.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--依赖Scala语言--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.scala-lang<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-library<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${scala.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--SparkCore依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-core_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- spark-streaming--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-streaming_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--spark-streaming+Kafka依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-streaming-kafka-0-10_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--SparkSQL依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-sql_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--SparkSQL+ Hive依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-hive_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-hive-thriftserver_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!--StructuredStreaming+Kafka依赖--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-sql-kafka-0-10_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token comment">&lt;!-- SparkMlLib机器学习模块,里面有ALS推荐算法--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-mllib_2.12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.7.5<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.hankcs<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hanlp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>portable-1.7.7<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>mysql<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>mysql-connector-java<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>5.1.38<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>redis.clients<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jedis<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.9.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.alibaba<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>fastjson<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.2.47<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.projectlombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>lombok<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>1.18.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sourceDirectory</span><span class="token punctuation">&gt;</span></span>src/main/scala<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sourceDirectory</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 指定编译java的插件 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.5.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token comment">&lt;!-- 指定编译scala的插件 --&gt;</span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.alchim31.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>testCompile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>args</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">&gt;</span></span>-dependencyfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">&gt;</span></span>${project.build.directory}/.scala_dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>args</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-surefire-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.18.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>useFile</span><span class="token punctuation">&gt;</span></span>false<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>useFile</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>disableXmlReport</span><span class="token punctuation">&gt;</span></span>true<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>disableXmlReport</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>includes</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*Test.*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>include</span><span class="token punctuation">&gt;</span></span>**/*Suite.*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>include</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>includes</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifact</span><span class="token punctuation">&gt;</span></span>*:*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifact</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.SF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.DSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.RSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transformers</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transformer</span>
                                        <span class="token attr-name">implementation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>org.apache.maven.plugins.shade.resource.ManifestResourceTransformer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transformer</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transformers</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>3.准备源码目录</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-BGJzzqsl-1648349412147)(img/1609571144078.png)]</p> 
<h3><a id="WordCount_1171"></a>代码实现-WordCount</h3> 
<pre><code class="prism language-java"><span class="token keyword">package</span> <span class="token namespace">cn<span class="token punctuation">.</span>xiaoguangbiao<span class="token punctuation">.</span>hello</span>

<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span></span>RDD
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span></span><span class="token punctuation">{<!-- --></span><span class="token class-name">SparkConf</span><span class="token punctuation">,</span> <span class="token class-name">SparkContext</span><span class="token punctuation">}</span>

<span class="token comment">/**
 * Author xiaoguangbiao
 * Desc 演示Spark入门案例-WordCount
 */</span>
object <span class="token class-name">WordCount</span> <span class="token punctuation">{<!-- --></span>
  def <span class="token function">main</span><span class="token punctuation">(</span>args<span class="token operator">:</span> <span class="token class-name">Array</span><span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token class-name">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//TODO 1.env/准备sc/SparkContext/Spark上下文执行环境</span>
    val conf<span class="token operator">:</span> <span class="token class-name">SparkConf</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparkConf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setAppName</span><span class="token punctuation">(</span><span class="token string">"wc"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setMaster</span><span class="token punctuation">(</span><span class="token string">"local[*]"</span><span class="token punctuation">)</span>
    val sc<span class="token operator">:</span> <span class="token class-name">SparkContext</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SparkContext</span><span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span><span class="token function">setLogLevel</span><span class="token punctuation">(</span><span class="token string">"WARN"</span><span class="token punctuation">)</span>

    <span class="token comment">//TODO 2.source/读取数据</span>
    <span class="token comment">//RDD:A Resilient Distributed Dataset (RDD):弹性分布式数据集,简单理解为分布式集合!使用起来和普通集合一样简单!</span>
    <span class="token comment">//RDD[就是一行行的数据]</span>
    val lines<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span><span class="token function">textFile</span><span class="token punctuation">(</span><span class="token string">"data/input/words.txt"</span><span class="token punctuation">)</span>

    <span class="token comment">//TODO 3.transformation/数据操作/转换</span>
    <span class="token comment">//切割:RDD[一个个的单词]</span>
    val words<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token class-name">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> lines<span class="token punctuation">.</span><span class="token function">flatMap</span><span class="token punctuation">(</span>_<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//记为1:RDD[(单词, 1)]</span>
    val wordAndOnes<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> words<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">//分组聚合:groupBy + mapValues(_.map(_._2).reduce(_+_)) ===&gt;在Spark里面分组+聚合一步搞定:reduceByKey</span>
    val result<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordAndOnes<span class="token punctuation">.</span><span class="token function">reduceByKey</span><span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span>

    <span class="token comment">//TODO 4.sink/输出</span>
    <span class="token comment">//直接输出</span>
    result<span class="token punctuation">.</span><span class="token function">foreach</span><span class="token punctuation">(</span>println<span class="token punctuation">)</span>
    <span class="token comment">//收集为本地集合再输出</span>
    <span class="token function">println</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>toBuffer<span class="token punctuation">)</span>
    <span class="token comment">//输出到指定path(可以是文件/夹)</span>
    result<span class="token punctuation">.</span><span class="token function">repartition</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">saveAsTextFile</span><span class="token punctuation">(</span><span class="token string">"data/output/result"</span><span class="token punctuation">)</span>
    result<span class="token punctuation">.</span><span class="token function">repartition</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">saveAsTextFile</span><span class="token punctuation">(</span><span class="token string">"data/output/result2"</span><span class="token punctuation">)</span>

    <span class="token comment">//为了便于查看Web-UI可以让程序睡一会</span>
    <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1000</span> <span class="token operator">*</span> <span class="token number">60</span><span class="token punctuation">)</span>

    <span class="token comment">//TODO 5.关闭资源</span>
    sc<span class="token punctuation">.</span><span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="OnYarn_1224"></a>代码实现-On-Yarn</h3> 
<pre><code class="prism language-Java">package cn.xiaoguangbiao.hello

import org.apache.spark.rdd.RDD
import org.apache.spark.{SparkConf, SparkContext}

/**
 * Author xiaoguangbiao
 * Desc 演示Spark入门案例-WordCount-修改代码使适合在Yarn集群上运行
 */
object WordCount {
  def main(args: Array[String]): Unit = {
    if(args.length &lt; 2){
      println("请指定input和output")
      System.exit(1)//非0表示非正常退出程序
    }
    //TODO 1.env/准备sc/SparkContext/Spark上下文执行环境
    val conf: SparkConf = new SparkConf().setAppName("wc")//.setMaster("local[*]")
    val sc: SparkContext = new SparkContext(conf)
    sc.setLogLevel("WARN")

    //TODO 2.source/读取数据
    //RDD:A Resilient Distributed Dataset (RDD):弹性分布式数据集,简单理解为分布式集合!使用起来和普通集合一样简单!
    //RDD[就是一行行的数据]
    val lines: RDD[String] = sc.textFile(args(0))//注意提交任务时需要指定input参数

    //TODO 3.transformation/数据操作/转换
    //切割:RDD[一个个的单词]
    val words: RDD[String] = lines.flatMap(_.split(" "))
    //记为1:RDD[(单词, 1)]
    val wordAndOnes: RDD[(String, Int)] = words.map((_,1))
    //分组聚合:groupBy + mapValues(_.map(_._2).reduce(_+_)) ===&gt;在Spark里面分组+聚合一步搞定:reduceByKey
    val result: RDD[(String, Int)] = wordAndOnes.reduceByKey(_+_)

    //TODO 4.sink/输出
    //直接输出
    //result.foreach(println)
    //收集为本地集合再输出
    //println(result.collect().toBuffer)
    //输出到指定path(可以是文件/夹)
    //如果涉及到HDFS权限问题不能写入,需要执行:
    //hadoop fs -chmod -R 777  /
    //并添加如下代码
    System.setProperty("HADOOP_USER_NAME", "root")
    result.repartition(1).saveAsTextFile(args(1))//注意提交任务时需要指定output参数

    //为了便于查看Web-UI可以让程序睡一会
    //Thread.sleep(1000 * 60)

    //TODO 5.关闭资源
    sc.stop()
  }
}

</code></pre> 
<p>1.打包</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-8HcXRjvh-1648349412147)(img/1609574002301.png)]</p> 
<p>2.修改别名</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-7koEtWaJ-1648349412147)(img/1609574144462.png)]</p> 
<p>3.上传到linux</p> 
<p>4.提交任务</p> 
<pre><code class="prism language-shell"><span class="token assign-left variable">SPARK_HOME</span><span class="token operator">=</span>/export/server/spark
<span class="token variable">${SPARK_HOME}</span>/bin/spark-submit <span class="token punctuation">\</span>
--master <span class="token function">yarn</span> <span class="token punctuation">\</span>
--deploy-mode cluster <span class="token punctuation">\</span>
--driver-memory 512m <span class="token punctuation">\</span>
--executor-memory 512m <span class="token punctuation">\</span>
--num-executors <span class="token number">1</span> <span class="token punctuation">\</span>
--class cn.xiaoguangbiao.hello.WordCount <span class="token punctuation">\</span>
/root/wc.jar <span class="token punctuation">\</span>
hdfs://node1:8020/wordcount/input/words.txt <span class="token punctuation">\</span>
hdfs://node1:8020/wordcount/output47_3
</code></pre> 
<p>5.查看任务</p> 
<p>http://node1:8088/cluster</p> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-tynoojJ1-1648349412148)(img/1609574459201.png)]</p> 
<p>6.查看结果</p> 
<p>http://node1:50070/explorer.html#/wordcount/output47_3</p> 
<h3><a id="WordCount_1330"></a>WordCount图解</h3> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-xC7U2K0D-1648349412148)(img/1609575069348.png)]</p> 
<h2><a id="_PI_1338"></a>扩展:练习题 蒙特卡罗算法求PI</h2> 
<h3><a id="_1340"></a>思路</h3> 
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-mMHPU8bJ-1648349412148)(img/1609575765598.png)]</p> 
<h3><a id="_1346"></a>代码实现</h3> 
<pre><code class="prism language-Java">package cn.xiaoguangbiao.temp;

import java.util.Random;

/**
 * Author xiaoguangbiao
 * Desc 使用蒙特卡罗算法求PI
 */
public class Interview_4 {
    public static void main(String[] args) {
        Random random = new Random();
        int sum = 1000000000;//总共撒的点的数量
        int count = 0;//落在扇形区域的点的数量
        double  x = 0;
        double  y = 0;
        for (int i = 0; i &lt; sum ;i++){
            x = random.nextDouble();//随机产生一个[0.0~1.0)之间的随机数
            y = random.nextDouble();//随机产生一个[0.0~1.0)之间的随机数
            if(x*x + y*y &lt; 1){ //落在扇形区域
                count++;
            }
        }
        double  Pi = 4.0 * count / sum;
        System.out.println("计算出的Pi的值为:"+Pi);
    }
}

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d24892a1961a8f39fffa822c3b76ddf5/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue使用wangEditor编辑器上传图片</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/fb10aa0f50a60499e0e332a44118c12a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JS-浅谈JS闭包问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>