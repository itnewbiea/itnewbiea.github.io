<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>C&#43;&#43; 命令模式 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="C&#43;&#43; 命令模式" />
<meta property="og:description" content="什么是命令模式？ 将请求转换为一个包含与请求相关的所有信息的独立对象。从而使你可以用不同的请求方法进行参数化，并且能够对请求进行排队、记录请求日志以及撤销请求操作。命令模式属于行为设计模式 如何理解命令模式 命令模式很像我们订外卖（淘宝），用户下单，订单中包裹了商户的信息及订餐数量，外卖平台作为接收者将订单再通知到商户，商户执行操作。
命令模式的步骤 源自ChatGpt的总结 定义一个 Command 抽象类，它声明了一个抽象的 execute() 方法，该方法用于执行命令。创建一个实现了 Command 抽象类的实体类，该类实现了 execute() 方法，用于执行具体的命令。创建一个 Invoker 类，该类持有 Command 类的一个实例，并调用实例的 execute() 方法来实现命令的调用。创建客户端，在客户端中创建一个具体的 Command 对象，并设置它的接收者。创建 Invoker 对象，并将创建的 Command 对象设置到 Invoker 对象中。调用 Invoker 对象的 execute() 方法来执行命令。 代码描述 我们这里用户头像为例子
首先需要接口类 /*通用命令*/ class Command { public: virtual ~Command() {} virtual void Execute() const = 0; }; /*通用处理人*/ class Receiver { public: virtual void DoFuncA(const int a) = 0; virtual void DoFuncB(const int b) = 0; }; 创建具体命令 /*实例化一个厨师类的处理人*/ class CookReceiver : public Receiver { public: explicit CookReceiver(const std::string&amp; cook_name) : cook_name_(cook_name) {} void DoFuncA(const int a) { std::cout &lt;&lt; &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/024fe070eb27c07ec45a04e02c62a263/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-04T22:22:35+08:00" />
<meta property="article:modified_time" content="2023-02-04T22:22:35+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">C&#43;&#43; 命令模式</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="_1"></a>什么是命令模式？</h4> 
<ul><li>将请求转换为一个包含与请求相关的所有信息的独立对象。从而使你可以用不同的请求方法进行参数化，并且能够对请求进行排队、记录请求日志以及撤销请求操作。</li><li>命令模式属于行为设计模式</li></ul> 
<h5><a id="_5"></a>如何理解命令模式</h5> 
<p>命令模式很像我们订外卖（淘宝），用户下单，订单中包裹了商户的信息及订餐数量，外卖平台作为接收者将订单再通知到商户，商户执行操作。</p> 
<h5><a id="_8"></a>命令模式的步骤</h5> 
<p><font color="red">源自ChatGpt的总结 </font></p> 
<ol><li>定义一个 Command 抽象类，它声明了一个抽象的 execute() 方法，该方法用于执行命令。</li><li>创建一个实现了 Command 抽象类的实体类，该类实现了 execute() 方法，用于执行具体的命令。</li><li>创建一个 Invoker 类，该类持有 Command 类的一个实例，并调用实例的 execute() 方法来实现命令的调用。</li><li>创建客户端，在客户端中创建一个具体的 Command 对象，并设置它的接收者。</li><li>创建 Invoker 对象，并将创建的 Command 对象设置到 Invoker 对象中。</li><li>调用 Invoker 对象的 execute() 方法来执行命令。</li></ol> 
<h5><a id="_17"></a>代码描述</h5> 
<p>我们这里用户头像为例子</p> 
<ul><li>首先需要接口类</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/*通用命令*/</span>
<span class="token keyword">class</span> <span class="token class-name">Command</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token operator">~</span><span class="token function">Command</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*通用处理人*/</span>
<span class="token keyword">class</span> <span class="token class-name">Receiver</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DoFuncA</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span>     <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">virtual</span> <span class="token keyword">void</span> <span class="token function">DoFuncB</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>创建具体命令</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/*实例化一个厨师类的处理人*/</span>
<span class="token keyword">class</span> <span class="token class-name">CookReceiver</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Receiver</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">CookReceiver</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> cook_name<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">cook_name_</span><span class="token punctuation">(</span>cook_name<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">DoFuncA</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> a<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> 
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-&gt;cook "</span> <span class="token operator">&lt;&lt;</span> cook_name_ <span class="token operator">&lt;&lt;</span> <span class="token string">" Receiver: Working sum= "</span> <span class="token operator">&lt;&lt;</span> a <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> 
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">DoFuncB</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">int</span> b<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-&gt;cook "</span> <span class="token operator">&lt;&lt;</span> cook_name_ <span class="token operator">&lt;&lt;</span> <span class="token string">"  Receiver: Working food weight="</span> <span class="token operator">&lt;&lt;</span> b <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>string cook_name_<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*实例化一条简单命令*/</span>
<span class="token keyword">class</span> <span class="token class-name">MilkCommand</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Command</span></span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	<span class="token keyword">int</span> sum_<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">MilkCommand</span><span class="token punctuation">(</span><span class="token keyword">int</span> sum<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">sum_</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span> <span class="token punctuation">{<!-- --></span> std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-&gt;The customer need milk= "</span> <span class="token operator">&lt;&lt;</span> <span class="token keyword">this</span><span class="token operator">-&gt;</span>sum_ <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">/*实例化一条复杂的命令*/</span>
<span class="token keyword">class</span> <span class="token class-name">SteakCommand</span> <span class="token operator">:</span> <span class="token base-clause"><span class="token keyword">public</span> <span class="token class-name">Command</span></span> <span class="token punctuation">{<!-- --></span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token keyword">explicit</span> <span class="token function">SteakCommand</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Receiver<span class="token operator">&gt;</span> receiver_cook<span class="token punctuation">,</span> <span class="token keyword">int</span> sum<span class="token punctuation">,</span> <span class="token keyword">int</span> weight<span class="token punctuation">)</span>
		<span class="token operator">:</span> <span class="token function">sum_</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">weight_</span><span class="token punctuation">(</span>weight<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">receiver_cook_</span><span class="token punctuation">(</span>receiver_cook<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	<span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">const</span> <span class="token keyword">override</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"-&gt;The customer ordered a steak"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>receiver_cook_<span class="token operator">-&gt;</span><span class="token function">DoFuncA</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>sum_<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token operator">-&gt;</span>receiver_cook_<span class="token operator">-&gt;</span><span class="token function">DoFuncB</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">-&gt;</span>weight_<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

<span class="token keyword">private</span><span class="token operator">:</span>
	std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Receiver<span class="token operator">&gt;</span> receiver_cook_<span class="token punctuation">;</span>
	<span class="token keyword">int</span>                       sum_    <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
	<span class="token keyword">int</span>                       weight_ <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>通过中心来分配执行命令</li></ul> 
<pre><code class="prism language-cpp"><span class="token comment">/*饭店前台*/</span>
<span class="token keyword">class</span> <span class="token class-name">Invoker</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">private</span><span class="token operator">:</span>
	vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Command<span class="token operator">&gt;&gt;</span> command_list_<span class="token punctuation">;</span>

<span class="token keyword">public</span><span class="token operator">:</span>
	<span class="token operator">~</span><span class="token function">Invoker</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> command_list_<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">InsertFontCommand</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Command<span class="token operator">&gt;</span> command<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> command_list_<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>command_list_<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> command<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">PushBackCommand</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span>shared_ptr<span class="token operator">&lt;</span>Command<span class="token operator">&gt;</span> command<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> command_list_<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>command<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
	<span class="token keyword">void</span> <span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The customer order start execute!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">auto</span><span class="token operator">&amp;</span> item_command <span class="token operator">:</span> command_list_<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			item_command<span class="token operator">-&gt;</span><span class="token function">Execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		std<span class="token double-colon punctuation">::</span>cout <span class="token operator">&lt;&lt;</span> <span class="token string">"The customer order finished!"</span> <span class="token operator">&lt;&lt;</span> std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<ul><li>创建用户命令并执行</li></ul> 
<pre><code class="prism language-cpp"><span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">//饭店前台</span>
	<span class="token keyword">auto</span> invoker            <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>Invoker<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//创建厨师小明</span>
	<span class="token keyword">auto</span> receiver_cook_user <span class="token operator">=</span> std<span class="token double-colon punctuation">::</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>CookReceiver<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token string">"xiao ming"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//订购牛排并指定小明厨师制作</span>
	invoker<span class="token operator">-&gt;</span><span class="token function">PushBackCommand</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>SteakCommand<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span>receiver_cook_user<span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//订购牛奶</span>
	invoker<span class="token operator">-&gt;</span><span class="token function">InsertFontCommand</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">make_shared</span><span class="token generic class-name"><span class="token operator">&lt;</span>MilkCommand<span class="token operator">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//执行订单</span>
	invoker<span class="token operator">-&gt;</span><span class="token function">ExecuteCommand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<ul><li>输出结果如下<br> <img src="https://images2.imgbox.com/a2/3b/LoZfbpuh_o.png" alt="在这里插入图片描述"></li></ul> 
<h5><a id="_123"></a>命令模式的思考</h5> 
<p>优点:</p> 
<ul><li>单一职责，实现了触发和执行的解耦操作；</li><li>复合开闭原则，无需修改原有代码，就可增加新的命令</li><li>可以把多个操作组合成一个复杂的命令，从而实现复杂的逻辑</li><li>排队中的操作命令可以排序或撤销</li><li>维护日志方便，更好的回溯操作</li></ul> 
<p>缺点：</p> 
<ul><li>简单的逻辑套用命令模式，由于中间传递调用者的加入会变得复杂</li><li>如果命令过多，很容易出现类数量膨胀的情况</li></ul> 
<p>总结：</p> 
<ul><li>如果遇到复杂的问题，尤其是客户端这种，命令模式是一种很好的解耦UI和逻辑的设计方式</li></ul> 
<h5><a id="_138"></a>命令模式与其他模式的比较</h5> 
<ul><li>命令在发送者和请求者之间建立单向连接</li></ul>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/92ab5af9c442c2dd6f797f1f123716fe/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">纯JS前端分页组件</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0ef715054060b32497b1102a33ca2e45/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ubuntu 16.04 谷歌浏览器google-chrome-stable : Depends: libu2f-udev but it is not installable</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>