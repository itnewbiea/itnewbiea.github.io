<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>6 网关和配置服务器 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="6 网关和配置服务器" />
<meta property="og:description" content="文章目录 网关模式Spring Cloud网关Spring Cloud网关微服务其他项目的变更运行和测试小结 运行状况Spring Boot Actuator在微服务中包含Actuator 服务发现和负载均衡ConsulSpring Cloud ConsulSpring Cloud负载均衡器网关中的服务发现和负载均衡使用服务发现和负载均衡 环境配置使用Consul进行配置Spring Cloud Consul Config实现集中式配置集中配置实践 小结 前面的文章： 1、 1 一个测试驱动的Spring Boot应用程序开发 2、 2 使用React构造前端应用 3、 3 试驱动的Spring Boot应用程序开发数据层示例 4、 4 向微服务架构转变 5、 5 转向事件驱动的架构 后续文章：
7、7 集中式日志和分布式跟踪
8、8 容器化微服务
示例代码
通过消息代理可实现事件驱动架构的开发，使用RabbitMQ能够解决消费端处理事件的松耦合，实现消费端的负载均衡，便于扩展系统，提供弹性解决方案，但前端和微服务之间的负载均衡问题还没有解决。
网关模式 网关模式可以解决一些问题：
React应用程序需要指向多个后端微服务来与API进行交互。这是不正确的，因为前端应该将后端视为具有多个API的单独服务器，之后，不会公开架构，从而更灵活，便于进行变更。如果引入了后端服务的多个实例，前端就不知道如何平衡它们之间的负载。万一某个实例不可用，也不知道如何将请求重定向到另外的实例。尽管从技术角度看，可以在Web客户端中实现负载均衡和弹性模式，但也应该放在后端逻辑中，只实现一次，对任何客户端都有效，保持前端逻辑尽可能简单。当前情况下，如果向系统添加用户身份验证，就需要验证每个后端服务中的安全凭证。将这个放在后端的边缘，在那里验证API调用，然后将简单的请求传递给其他微服务，会更合理。只要保证其余的后端微服务无法从外部访问，就不必担心安全问题。 这些问题可通过网关微服务来解决。网关模式可集中HTTP访问，负责将请求代理到其他服务。网关会根据配置的规则来决定将请求路由到何处，另外，路由服务可以过滤器来修改请求和响应通过时的状态。如图所示：
-发送尝试
-获取用户别名
-获取排行榜
8000 -发送尝试
-获取用户别名
8080 -获取排行榜
8081 Gateway 过滤器 路由 浏览器 Multiplication Gamification 尝试
（主题交换） Gamification
队列 有时会将网关称为边缘服务，因为其他系统必须通过网关来访问后端，且网关将外部流量路由到相应的内部微服务，网关的引入通常会限制对其他后端服务的访问。
Spring Cloud网关 Spring Cloud是Spring系列中的一组独立项目，提供技术来快速构建分布式系统（如微服务等）所需的通用模式。这些模式称为云模式，即使在服务器中部署微服务，也适用。它利用 Spring Boot 的开发便利性简化了分布式系统的开发，比如服务发现、服务网关、服务路由、链路追踪等。Spring Cloud不重复造轮子，而是将市面上开发得比较好的模块集成进去，进行封装，从而减少了各模块的开发成本。换句话说：Spring Cloud 提供了构建分布式系统所需的“全家桶”。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/8085d68ab542aae1769092e43cebc7d3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-05T10:30:09+08:00" />
<meta property="article:modified_time" content="2024-01-05T10:30:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">6 网关和配置服务器</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_15" rel="nofollow">网关模式</a></li><li><ul><li><a href="#Spring_Cloud_41" rel="nofollow">Spring Cloud网关</a></li><li><a href="#Spring_Cloud_95" rel="nofollow">Spring Cloud网关微服务</a></li><li><a href="#_189" rel="nofollow">其他项目的变更</a></li><li><a href="#_246" rel="nofollow">运行和测试</a></li><li><a href="#_270" rel="nofollow">小结</a></li></ul> 
  </li><li><a href="#_281" rel="nofollow">运行状况</a></li><li><ul><li><a href="#Spring_Boot_Actuator_306" rel="nofollow">Spring Boot Actuator</a></li><li><a href="#Actuator_354" rel="nofollow">在微服务中包含Actuator</a></li></ul> 
  </li><li><a href="#_404" rel="nofollow">服务发现和负载均衡</a></li><li><ul><li><a href="#Consul_499" rel="nofollow">Consul</a></li><li><a href="#Spring_Cloud_Consul_546" rel="nofollow">Spring Cloud Consul</a></li><li><a href="#Spring_Cloud_703" rel="nofollow">Spring Cloud负载均衡器</a></li><li><a href="#_775" rel="nofollow">网关中的服务发现和负载均衡</a></li><li><a href="#_839" rel="nofollow">使用服务发现和负载均衡</a></li></ul> 
  </li><li><a href="#_943" rel="nofollow">环境配置</a></li><li><ul><li><a href="#Consul_991" rel="nofollow">使用Consul进行配置</a></li><li><a href="#Spring_Cloud_Consul_Config_999" rel="nofollow">Spring Cloud Consul Config</a></li><li><a href="#_1023" rel="nofollow">实现集中式配置</a></li><li><a href="#_1089" rel="nofollow">集中配置实践</a></li></ul> 
  </li><li><a href="#_1150" rel="nofollow">小结</a></li></ul> 
</div> 
<br> 前面的文章： 
<br> 1、 
<a href="https://blog.csdn.net/ZhangCurie/article/details/134475842">1 一个测试驱动的Spring Boot应用程序开发</a> 
<br> 2、 
<a href="https://blog.csdn.net/ZhangCurie/article/details/134553385">2 使用React构造前端应用</a> 
<br> 3、 
<a href="https://blog.csdn.net/ZhangCurie/article/details/134576807">3 试驱动的Spring Boot应用程序开发数据层示例</a> 
<br> 4、 
<a href="https://blog.csdn.net/ZhangCurie/article/details/134614535">4 向微服务架构转变</a> 
<br> 5、 
<a href="https://blog.csdn.net/ZhangCurie/article/details/134752757">5 转向事件驱动的架构</a> 
<p></p> 
<p>后续文章：<br> 7、<a href="https://blog.csdn.net/ZhangCurie/article/details/135171902">7 集中式日志和分布式跟踪</a><br> 8、<a href="https://blog.csdn.net/ZhangCurie/article/details/135236343">8 容器化微服务</a></p> 
<p><a href="https://download.csdn.net/download/ZhangCurie/88704732">示例代码</a></p> 
<p>通过消息代理可实现事件驱动架构的开发，使用RabbitMQ能够解决消费端处理事件的松耦合，实现消费端的负载均衡，便于扩展系统，提供弹性解决方案，但前端和微服务之间的负载均衡问题还没有解决。</p> 
<h2><a id="_15"></a>网关模式</h2> 
<p>网关模式可以解决一些问题：</p> 
<ul><li>React应用程序需要指向多个后端微服务来与API进行交互。这是不正确的，因为前端应该将后端视为具有多个API的单独服务器，之后，不会公开架构，从而更灵活，便于进行变更。</li><li>如果引入了后端服务的多个实例，前端就不知道如何平衡它们之间的负载。万一某个实例不可用，也不知道如何将请求重定向到另外的实例。尽管从技术角度看，可以在Web客户端中实现负载均衡和弹性模式，但也应该放在后端逻辑中，只实现一次，对任何客户端都有效，保持前端逻辑尽可能简单。</li><li>当前情况下，如果向系统添加用户身份验证，就需要验证每个后端服务中的安全凭证。将这个放在后端的边缘，在那里验证API调用，然后将简单的请求传递给其他微服务，会更合理。只要保证其余的后端微服务无法从外部访问，就不必担心安全问题。</li></ul> 
<p>这些问题可通过网关微服务来解决。网关模式可集中HTTP访问，负责将请求代理到其他服务。网关会根据配置的规则来决定将请求路由到何处，另外，路由服务可以过滤器来修改请求和响应通过时的状态。如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-iSmpYOxBTPHxb2fQ" width="249.59999084472656" xmlns="http://www.w3.org/2000/svg" height="1143.61083984375" viewbox="0 0 249.59999084472656 1143.61083984375" class="mermaid-svg"> 
  <style>#mermaid-svg-iSmpYOxBTPHxb2fQ {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-iSmpYOxBTPHxb2fQ .error-icon{fill:#552222;}#mermaid-svg-iSmpYOxBTPHxb2fQ .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-iSmpYOxBTPHxb2fQ .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-iSmpYOxBTPHxb2fQ .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-iSmpYOxBTPHxb2fQ .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-iSmpYOxBTPHxb2fQ .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-iSmpYOxBTPHxb2fQ .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-iSmpYOxBTPHxb2fQ .marker{fill:#333333;stroke:#333333;}#mermaid-svg-iSmpYOxBTPHxb2fQ .marker.cross{stroke:#333333;}#mermaid-svg-iSmpYOxBTPHxb2fQ svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-iSmpYOxBTPHxb2fQ .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-iSmpYOxBTPHxb2fQ .cluster-label text{fill:#333;}#mermaid-svg-iSmpYOxBTPHxb2fQ .cluster-label span{color:#333;}#mermaid-svg-iSmpYOxBTPHxb2fQ .label text,#mermaid-svg-iSmpYOxBTPHxb2fQ span{fill:#333;color:#333;}#mermaid-svg-iSmpYOxBTPHxb2fQ .node rect,#mermaid-svg-iSmpYOxBTPHxb2fQ .node circle,#mermaid-svg-iSmpYOxBTPHxb2fQ .node ellipse,#mermaid-svg-iSmpYOxBTPHxb2fQ .node polygon,#mermaid-svg-iSmpYOxBTPHxb2fQ .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-iSmpYOxBTPHxb2fQ .node .label{text-align:center;}#mermaid-svg-iSmpYOxBTPHxb2fQ .node.clickable{cursor:pointer;}#mermaid-svg-iSmpYOxBTPHxb2fQ .arrowheadPath{fill:#333333;}#mermaid-svg-iSmpYOxBTPHxb2fQ .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-iSmpYOxBTPHxb2fQ .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-iSmpYOxBTPHxb2fQ .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-iSmpYOxBTPHxb2fQ .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-iSmpYOxBTPHxb2fQ .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-iSmpYOxBTPHxb2fQ .cluster text{fill:#333;}#mermaid-svg-iSmpYOxBTPHxb2fQ .cluster span{color:#333;}#mermaid-svg-iSmpYOxBTPHxb2fQ div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-iSmpYOxBTPHxb2fQ :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <path d="M86.33332824707031,741.5000000000001L86.24999491373698,749.9166666666666C86.16666158040364,758.3333333333334,85.99999491373698,775.1666666666666,85.91666158040364,792.0833333333334C85.83332824707031,809,85.83332824707031,826,85.83332824707031,838.6666666666666C85.83332824707031,851.3333333333334,85.83332824707031,859.6666666666666,85.83332824707031,868C85.83332824707031,876.3333333333334,85.83332824707031,884.6666666666666,85.83332824707031,888.8333333333334L85.83332824707031,893" id="L-a-q-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-a LE-q" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M85.83332824707031,574L85.83332824707031,578.1666666666666C85.83332824707031,582.3333333333334,85.83332824707031,590.6666666666666,85.83332824707031,599C85.83332824707031,607.3333333333334,85.83332824707031,615.6666666666666,85.83332824707031,624C85.83332824707031,632.3333333333334,85.83332824707031,640.6666666666666,85.91666158040364,649.0833333333334C85.99999491373698,657.5,86.16666158040364,666,86.24999491373698,670.25L86.33332824707031,674.5" id="L-m-a-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m LE-a" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M85.83332824707031,994.6108245849609L85.83332824707031,998.7774912516276C85.83332824707031,1002.9441579182943,85.83332824707031,1011.2774912516276,85.83332824707031,1019.6108245849609C85.83332824707031,1027.9441579182942,85.83332824707031,1036.2774912516277,85.83332824707031,1044.610824584961C85.83332824707031,1052.9441579182942,85.83332824707031,1061.2774912516277,90.99968943054422,1069.610824584961C96.16605061401815,1077.9441579182942,106.49877298096597,1086.2774912516277,111.66513416443989,1090.4441579182942L116.8314953479138,1094.610824584961" id="L-q-game-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-q LE-game" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M142.24999237060547,49L142.24999237060547,61.833333333333336C142.24999237060547,74.66666666666667,142.24999237060547,100.33333333333333,142.24999237060547,126C142.24999237060547,151.66666666666666,142.24999237060547,177.33333333333334,142.24999237060547,190.16666666666666L142.24999237060547,203" id="L-u-g-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-u LE-g" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M107.71615554347183,405L104.06901766073825,415.6666666666667C100.42187977800465,426.3333333333333,93.12760401253747,447.6666666666667,89.4804661298039,469C85.83332824707031,490.3333333333333,85.83332824707031,511.6666666666667,85.83332824707031,522.3333333333334L85.83332824707031,533" id="L-g-m-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-m" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M176.78382919773912,405L180.4309670804727,415.6666666666667C184.0781049632063,426.3333333333333,191.37238072867345,447.6666666666667,195.01951861140705,472.4166666666667C198.66665649414062,497.1666666666667,198.66665649414062,525.3333333333334,198.66665649414062,547C198.66665649414062,568.6666666666666,198.66665649414062,583.8333333333334,198.66665649414062,595.5833333333334C198.66665649414062,607.3333333333334,198.66665649414062,615.6666666666666,198.66665649414062,624C198.66665649414062,632.3333333333334,198.66665649414062,640.6666666666666,198.66665649414062,654.5833333333334C198.66665649414062,668.5,198.66665649414062,688,198.66665649414062,711.8333333333334C198.66665649414062,735.6666666666666,198.66665649414062,763.8333333333334,198.66665649414062,786.4166666666666C198.66665649414062,809,198.66665649414062,826,198.66665649414062,838.6666666666666C198.66665649414062,851.3333333333334,198.66665649414062,859.6666666666666,198.66665649414062,876.4675687154134C198.66665649414062,893.2684707641602,198.66665649414062,918.5369415283203,198.66665649414062,943.8054122924805C198.66665649414062,969.0738830566406,198.66665649414062,994.3423538208008,198.66665649414062,1011.1432558695475C198.66665649414062,1027.9441579182942,198.66665649414062,1036.2774912516277,198.66665649414062,1044.610824584961C198.66665649414062,1052.9441579182942,198.66665649414062,1061.2774912516277,193.5002953106667,1069.610824584961C188.3339341271928,1077.9441579182942,178.00121176024496,1086.2774912516277,172.83485057677103,1090.4441579182942L167.66848939329714,1094.610824584961" id="L-g-game-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-game" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(142.24999237060547, 126)"> 
      <g class="label" transform="translate(-50.93333435058594, -52)"> 
       <foreignobject width="101.86666870117188" height="104"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名<br>-获取排行榜<br>8000</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(85.83332824707031, 469)"> 
      <g class="label" transform="translate(-50.93333435058594, -39)"> 
       <foreignobject width="101.86666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名<br>8080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(198.66665649414062, 792)"> 
      <g class="label" transform="translate(-42.93333435058594, -26)"> 
       <foreignobject width="85.86666870117188" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜<br>8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="root" transform="translate(78.24999237060547, 195)"> 
      <g class="clusters"> 
       <g class="cluster default" id="g"> 
        <rect style="" rx="0" ry="0" x="8" y="8" width="113" height="202"></rect> 
        <g class="cluster-label" transform="translate(33.258331298828125, 13)"> 
         <foreignobject width="62.48333740234375" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">Gateway</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="edgePaths"></g> 
      <g class="edgeLabels"></g> 
      <g class="nodes"> 
       <g class="node default default" id="flowchart-f-4692" transform="translate(64.5, 63.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-20.5" width="63" height="41"></rect> 
        <g class="label" style="" transform="translate(-24, -13)"> 
         <foreignobject width="48" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">过滤器</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-r-4693" transform="translate(64.5, 154.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-23.5" y="-20.5" width="47" height="41"></rect> 
        <g class="label" style="" transform="translate(-16, -13)"> 
         <foreignobject width="32" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">路由</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-u-4691" transform="translate(142.24999237060547, 28.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-20.5" width="63" height="41"></rect> 
      <g class="label" style="" transform="translate(-24, -13)"> 
       <foreignobject width="48" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">浏览器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m-4694" transform="translate(85.83332824707031, 553.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-20.5" width="113.5" height="41"></rect> 
      <g class="label" style="" transform="translate(-49.25, -13)"> 
       <foreignobject width="98.5" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Multiplication</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-game-4695" transform="translate(142.24999237060547, 1115.110824584961)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-20.5" width="107.11666870117188" height="41"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -13)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-a-4696" transform="translate(85.83332824707031, 707.5)"> 
      <polygon points="-22.333333333333332,0 99.83333333333333,0 133.33333333333334,-67 11.166666666666666,-67" class="label-container" transform="translate(-55.5,33.5)" style=""></polygon> 
      <g class="label" style="" transform="translate(-48, -26)"> 
       <foreignobject width="96" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">尝试<br>（主题交换）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-q-4697" transform="translate(85.83332824707031, 943.8054122924805)"> 
      <path style="" d="M 0,11.536942747428709 a 53.55833435058594,11.536942747428709 0,0,0 107.11666870117188 0 a 53.55833435058594,11.536942747428709 0,0,0 -107.11666870117188 0 l 0,78.53694274742871 a 53.55833435058594,11.536942747428709 0,0,0 107.11666870117188 0 l 0,-78.53694274742871" transform="translate(-53.55833435058594,-50.805414121143066)"></path> 
      <g class="label" style="" transform="translate(-46.05833435058594, -26)"> 
       <foreignobject width="92.11666870117188" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification<br>队列</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>有时会将网关称为边缘服务，因为其他系统必须通过网关来访问后端，且网关将外部流量路由到相应的内部微服务，网关的引入通常会限制对其他后端服务的访问。</p> 
<h3><a id="Spring_Cloud_41"></a>Spring Cloud网关</h3> 
<p>Spring Cloud是Spring系列中的一组独立项目，提供技术来快速构建分布式系统（如微服务等）所需的通用模式。这些模式称为云模式，即使在服务器中部署微服务，也适用。它利用 Spring Boot 的开发便利性简化了分布式系统的开发，比如服务发现、服务网关、服务路由、链路追踪等。Spring Cloud不重复造轮子，而是将市面上开发得比较好的模块集成进去，进行封装，从而减少了各模块的开发成本。换句话说：Spring Cloud 提供了构建分布式系统所需的“全家桶”。<br> 网关模式是Spring Cloud提供的一个工具，Spring长期使用Spring Cloud Netflix支持集成，它由Netflix开发人员作为开源软件发行并维护了许多年了，Netflix支持网关模式的组件是Zuul，与Spring集成通过Spring Cloud Netflix Zuul模块实现。<br> 这里不使用Spring Cloud Netflix，原因是Spring将不再使用Netflix工具集成，而是用其他工具替代，甚至是自己实现，可能是Netflix将某些项目置于维护模式，如Hystrix（断路）和Ribbon（负载均衡），不再主动开发，这还会影响Netflix堆栈中的其他工具，如服务发现工具Eureka依靠Ribbon进行负载均衡。<br> 这里将需求一种新的方案实现网关模式，Spring Cloud网关，不依赖于任何外部工具。<br> Spring Cloud网关项目定义了一些核心概念（如图所示）：</p> 
<ul><li>谓词（Predicate）：要匹配的条件，以确定将请求路由到何处。Spring Cloud网关提供了一系列基于请求路径、请求头、时间、远程主机等的条件构造器，甚至可以组合为表达式，适用于路由，也称路由谓词。</li><li>路由（Route）：如果请求与指定的谓词匹配，路由就是请求将代理到的URI。一个Route模块由一个 ID，一个目标 URI，一组断言和一组过滤器定义。如果断言为真，则路由匹配，目标URI会被访问。</li><li>过滤器（Filter）：可选处理，可以连接到路由（路由过滤器）或全局应用于所有请求（全局过滤器）。过滤器允许修改请求（传入过滤器）和响应（传出过滤器）。Spring Cloud网关中由很多内置的过滤器，如，可以在请求中添加或删除头，限制来自给定主机的请求数量，或在被代理服务的响应返回给请求者之前对其进行转换等。</li></ul> 
<div class="mermaid"> 
 <svg id="mermaid-svg-1MePIhC2AxQWDkQG" width="375.80413818359375" xmlns="http://www.w3.org/2000/svg" height="601" viewbox="0 0 375.80413818359375 601" class="mermaid-svg"> 
  <style>#mermaid-svg-1MePIhC2AxQWDkQG {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-1MePIhC2AxQWDkQG .error-icon{fill:#552222;}#mermaid-svg-1MePIhC2AxQWDkQG .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-1MePIhC2AxQWDkQG .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-1MePIhC2AxQWDkQG .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-1MePIhC2AxQWDkQG .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-1MePIhC2AxQWDkQG .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-1MePIhC2AxQWDkQG .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-1MePIhC2AxQWDkQG .marker{fill:#333333;stroke:#333333;}#mermaid-svg-1MePIhC2AxQWDkQG .marker.cross{stroke:#333333;}#mermaid-svg-1MePIhC2AxQWDkQG svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-1MePIhC2AxQWDkQG .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-1MePIhC2AxQWDkQG .cluster-label text{fill:#333;}#mermaid-svg-1MePIhC2AxQWDkQG .cluster-label span{color:#333;}#mermaid-svg-1MePIhC2AxQWDkQG .label text,#mermaid-svg-1MePIhC2AxQWDkQG span{fill:#333;color:#333;}#mermaid-svg-1MePIhC2AxQWDkQG .node rect,#mermaid-svg-1MePIhC2AxQWDkQG .node circle,#mermaid-svg-1MePIhC2AxQWDkQG .node ellipse,#mermaid-svg-1MePIhC2AxQWDkQG .node polygon,#mermaid-svg-1MePIhC2AxQWDkQG .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-1MePIhC2AxQWDkQG .node .label{text-align:center;}#mermaid-svg-1MePIhC2AxQWDkQG .node.clickable{cursor:pointer;}#mermaid-svg-1MePIhC2AxQWDkQG .arrowheadPath{fill:#333333;}#mermaid-svg-1MePIhC2AxQWDkQG .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-1MePIhC2AxQWDkQG .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-1MePIhC2AxQWDkQG .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-1MePIhC2AxQWDkQG .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-1MePIhC2AxQWDkQG .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-1MePIhC2AxQWDkQG .cluster text{fill:#333;}#mermaid-svg-1MePIhC2AxQWDkQG .cluster span{color:#333;}#mermaid-svg-1MePIhC2AxQWDkQG div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-1MePIhC2AxQWDkQG :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"> 
     <g class="cluster default" id="g"> 
      <rect style="" rx="0" ry="0" x="131.56666564941406" y="8" width="236.23749542236328" height="494"></rect> 
      <g class="cluster-label" transform="translate(233.6854133605957, 13)"> 
       <foreignobject width="32" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">网关</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="edgePaths"> 
     <path d="M188.61704339514245,243L186.66628590830555,247.16666666666666C184.71552842146866,251.33333333333334,180.81401344779488,259.6666666666667,165.4722838235068,271.53171786880097C150.13055419921875,283.3967690709353,123.3486099243164,298.79353814187056,109.95763778686523,306.4919226773382L96.56666564941406,314.19030721280586" id="L-b1-a1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b1 LE-a1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M255.51666259765625,93.63401589729912L248.64027404785156,98.86167991441594C241.76388549804688,104.08934393153275,228.0111083984375,114.54467196576638,201.51944224039713,128.4310324619755C175.02777608235678,142.31739295818457,135.7972208658854,159.63478591636917,116.18194325764973,168.29348239546144L96.56666564941406,176.95217887455374" id="L-b2-a2-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b2 LE-a2" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M216.8909934517387,243L217.47374403448927,247.16666666666666C218.05649461723988,251.33333333333334,219.22199578274103,259.6666666666667,219.8047463654916,272.3333333333333C220.3874969482422,285,220.3874969482422,302,220.3874969482422,310.5L220.3874969482422,319" id="L-b1-c1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b1 LE-c1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M220.3874969482422,360L220.3874969482422,368.5C220.3874969482422,377,220.3874969482422,394,224.36872391473682,406.6666666666667C228.3499508812314,419.3333333333333,236.3124048142206,427.6666666666667,240.29363178071523,431.8333333333333L244.27485874720983,436" id="L-c1-d1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c1 LE-d1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M305.7226085825863,100L307.52786733078483,104.16666666666667C309.3331260789833,108.33333333333333,312.94364357538035,116.66666666666667,314.7489023235789,132.75C316.55416107177734,148.83333333333334,316.55416107177734,172.66666666666666,316.55416107177734,196.5C316.55416107177734,220.33333333333334,316.55416107177734,244.16666666666666,316.55416107177734,268C316.55416107177734,291.8333333333333,316.55416107177734,315.6666666666667,316.55416107177734,339.5C316.55416107177734,363.3333333333333,316.55416107177734,387.1666666666667,311.72891696468815,403.25C306.9036728575989,419.3333333333333,297.2531846434205,427.6666666666667,292.42794053633133,431.8333333333333L287.60269642924214,436" id="L-b2-d1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b2 LE-d1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M233.69821108304538,477L227.56725898155798,481.1666666666667C221.43630688007065,485.3333333333333,209.17440267709586,493.6666666666667,203.0434505756085,502C196.9124984741211,510.3333333333333,196.9124984741211,518.6666666666666,196.9124984741211,527C196.9124984741211,535.3333333333334,196.9124984741211,543.6666666666666,196.9124984741211,547.8333333333334L196.9124984741211,552" id="L-d1-f1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-d1 LE-f1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M287.60269642924214,477L292.42794053633133,481.1666666666667C297.2531846434205,485.3333333333333,306.9036728575989,493.6666666666667,311.72891696468815,502C316.55416107177734,510.3333333333333,316.55416107177734,518.6666666666666,316.55416107177734,527C316.55416107177734,535.3333333333334,316.55416107177734,543.6666666666666,316.55416107177734,547.8333333333334L316.55416107177734,552" id="L-d1-f2-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-d1 LE-f2" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-b1-4734" transform="translate(210.3874969482422, 196.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-35.69166564941406" y="-46.5" width="71.38333129882812" height="93"></rect> 
      <g class="label" style="" transform="translate(-28.191665649414062, -39)"> 
       <foreignobject width="56.383331298828125" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">路由1：<br>-谓词A<br>-谓词B</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b2-4735" transform="translate(291.2083282470703, 66.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-35.69166564941406" y="-33.5" width="71.38333129882812" height="67"></rect> 
      <g class="label" style="" transform="translate(-28.191665649414062, -26)"> 
       <foreignobject width="56.383331298828125" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">路由2：<br>-谓词C</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c1-4736" transform="translate(220.3874969482422, 339.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-51.94999694824219" y="-20.5" width="103.89999389648438" height="41"></rect> 
      <g class="label" style="" transform="translate(-44.44999694824219, -13)"> 
       <foreignobject width="88.89999389648438" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">路由过滤器X</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-d1-4737" transform="translate(263.8624954223633, 456.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-20.5" width="95" height="41"></rect> 
      <g class="label" style="" transform="translate(-40, -13)"> 
       <foreignobject width="80" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">全局过滤器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-a1-4732" transform="translate(52.541664123535156, 339.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-44.025001525878906" y="-46.5" width="88.05000305175781" height="93"></rect> 
      <g class="label" style="" transform="translate(-36.525001525878906, -39)"> 
       <foreignobject width="73.05000305175781" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">HTTP<br>请求/响应<br>（匹配B）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-a2-4733" transform="translate(52.28333282470703, 196.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-44.28333282470703" y="-46.5" width="88.56666564941406" height="93"></rect> 
      <g class="label" style="" transform="translate(-36.78333282470703, -39)"> 
       <foreignobject width="73.56666564941406" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">HTTP<br>请求/响应<br>（匹配C）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-f1-4738" transform="translate(196.9124984741211, 572.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-27.691665649414062" y="-20.5" width="55.383331298828125" height="41"></rect> 
      <g class="label" style="" transform="translate(-20.191665649414062, -13)"> 
       <foreignobject width="40.383331298828125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务1</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-f2-4739" transform="translate(316.55416107177734, 572.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-27.691665649414062" y="-20.5" width="55.383331298828125" height="41"></rect> 
      <g class="label" style="" transform="translate(-20.191665649414062, -13)"> 
       <foreignobject width="40.383331298828125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务2</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>要使用Spring Cloud网关，需要定义相关的配置，主要是谓词、路由和过滤器，可以在属性文件或yaml文件中配置。示例如下：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> old<span class="token punctuation">-</span>path
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//oldhost/path<span class="token punctuation">-</span>old
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Before=2023<span class="token punctuation">-</span>12<span class="token punctuation">-</span>10T09<span class="token punctuation">:</span>10<span class="token punctuation">:</span>57.013+08<span class="token punctuation">:</span><span class="token number">00</span>
            <span class="token punctuation">-</span> Path=/path<span class="token punctuation">-</span>special/<span class="token important">**</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> new<span class="token punctuation">-</span>path
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//newhost/path<span class="token punctuation">-</span>new
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/path<span class="token punctuation">-</span>special/<span class="token important">**</span>
            <span class="token punctuation">-</span> After=2023<span class="token punctuation">-</span>12<span class="token punctuation">-</span>10T09<span class="token punctuation">:</span>10<span class="token punctuation">:</span>57.013+08<span class="token punctuation">:</span><span class="token number">00</span>
          <span class="token key atrule">filters</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> AddResponseHeader=X<span class="token punctuation">-</span>New<span class="token punctuation">-</span>Conditions<span class="token punctuation">-</span>Apply<span class="token punctuation">,</span> 2023<span class="token punctuation">-</span>Dec
</code></pre> 
<p>这里定义了两个共享路径路由谓词，该谓词会捕获任何访问/path-special/开头的请求，每个路由的附加条件分别由Before和After谓词定义，决定了在何处代理请求。</p> 
<ul><li>如果请求发生在2023-12-10T09:10:57.013+08:00之前，代理到http://oldhost/path-old/。</li><li>如果请求发生在2023-12-10T09:10:57.013+08:00之后，代理到http://newhost/path-new/。而且，额外的过滤器将添加响应头：X-New-Conditions-Apply，值为2023-Dec</li></ul> 
<p>这里的oldhost和newhost不需要从外部访问，仅对后端的网关和其他内部服务可见。<br> 内置的谓词和过滤器可以满足网关的各种需求，非常方便，在示例中将主要使用路径路由谓词，将外部请求代理到相应的微服务。</p> 
<h3><a id="Spring_Cloud_95"></a>Spring Cloud网关微服务</h3> 
<p>Spring Boot为Spring Cloud Gateway提供了启动器（spring-boot-starter-*），将此启动器依赖添加到Spring Boot应用程序中，即可获得可用的Gateway微服务。实际上，Gateway项目是建立在Spring Boot之上的，只能在Spring Boot应用程序中使用。这里，自动配置类GatewayAutoConfiguration位于Spring Boot Gateway中，而不是Spring Boot的autoconfigure包中，它读取配置信息并构建路由、过滤器、谓词等。<br> 在IDEA中创建新的微服务gateway，添加Gateway依赖项，如图所示：<br> <img src="https://images2.imgbox.com/f9/81/xZBESsZE_o.png" alt="gateway依赖"><br> 打开项目的maven配置文件pom.xml，如下所示：</p> 
<pre><code class="prism language-xml"><span class="token prolog">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>project</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">"</span></span>
         <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>modelVersion</span><span class="token punctuation">&gt;</span></span>4.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>modelVersion</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>parent</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-parent<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>relativePath</span><span class="token punctuation">/&gt;</span></span> <span class="token comment">&lt;!-- lookup parent from repository --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>parent</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>cn.zhangjuli<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>0.0.1-SNAPSHOT<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>name</span><span class="token punctuation">&gt;</span></span>gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>name</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>description</span><span class="token punctuation">&gt;</span></span>gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>description</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>java.version</span><span class="token punctuation">&gt;</span></span>21<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>java.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>2023.0.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spring-cloud.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-gateway<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>test<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>下面将application.properties改名为application.yml，添加配置信息，如下所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> multiplication
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8080/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/challenges/<span class="token important">**</span><span class="token punctuation">,</span>/attempts<span class="token punctuation">,</span>/attempts/<span class="token important">**</span><span class="token punctuation">,</span>/users/<span class="token important">**</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> gamification
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> http<span class="token punctuation">:</span>//localhost<span class="token punctuation">:</span>8081/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/leaders
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
        <span class="token key atrule">cors-configurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token string">"http://localhost:3000"</span>
            <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">"*"</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">"GET"</span>
              <span class="token punctuation">-</span> <span class="token string">"POST"</span>
              <span class="token punctuation">-</span> <span class="token string">"OPTIONS"</span>
</code></pre> 
<p>这里配置的路由将使网关按如下方式运行：</p> 
<ul><li>对http://localhost:8000/attempts的任何请求将被代理到http://localhost:8080/的微服务Multiplication的attempts，其他情况类似，如challenges、users等。</li><li>对http://localhost:8080/leaders的任何请求将转换为对Gamification微服务的请求，http://localhost:8081/leaders。</li></ul> 
<p>也可用编写一个更简单的配置，不需要路由到每个微服务的显式端点列表，可用使用网关的另一个功能来完成此操作，该功能允许捕获路径段。如果获得了诸如http://localhost:8000/multiplication/attempts的API调用，就可用将Multiplication提取出来，然后，映射到相应的主机和端口，这种情况，当微服务只包含一个API域时才有效。其他情况下，都会将内部架构公开给客户端。示例中，当客户端发出http://localhost:8000/multiplication/users请求时，应该使用一个http://localhost:8000/users代替，以便隐藏Multiplication微服务中包含User域的事实，提高安全性。</p> 
<h3><a id="_189"></a>其他项目的变更</h3> 
<p>引入gateway微服务后，可将用于外部请求的所有配置保留在同一服务内，这意味着不需要向Multiplication和Gamification微服务中添加CORS配置。可在网关中保留该配置，因为其他两个服务位于新的代理服务之后。因此，可以从现有项目Multiplication和Gamification的文件夹configuration中删除WebConfiguration类。<br> 删除了CORS配置类后，还需要修改React应用程序使其指向两个微服务的相同主机/端口。还可以根据偏好来重构GameApiClient和ChallengesApiClient类，单个微服务调用所有端点或每个API上下文（挑战、用户等）调用一个服务，不再需要两个不同的服务器URL，因为前端现在将后端视为具有多个API的单个主机。例如：</p> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">GameApiClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token constant">SERVER_URL</span> <span class="token operator">=</span> <span class="token string">'http://localhost:8000'</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token constant">GET_LEADERBOARD</span> <span class="token operator">=</span> <span class="token string">'/leaders'</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token function">leaderBoard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>GameApiClient<span class="token punctuation">.</span><span class="token constant">SERVER_URL</span> <span class="token operator">+</span> GameApiClient<span class="token punctuation">.</span><span class="token constant">GET_LEADERBOARD</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> GameApiClient<span class="token punctuation">;</span>
</code></pre> 
<pre><code class="prism language-javascript"><span class="token keyword">class</span> <span class="token class-name">ChallengesApiClient</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">static</span> <span class="token constant">SERVER_URL</span> <span class="token operator">=</span> <span class="token string">'http://localhost:8000'</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token constant">GET_CHALLENGE</span> <span class="token operator">=</span> <span class="token string">'/challenges/random'</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token constant">POST_RESULT</span> <span class="token operator">=</span> <span class="token string">'/attempts'</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token constant">GET_ATTEMPTS_BY_ALIAS</span> <span class="token operator">=</span> <span class="token string">'/attempts?alias='</span><span class="token punctuation">;</span>
    <span class="token keyword">static</span> <span class="token constant">GET_USERS_BY_IDS</span> <span class="token operator">=</span> <span class="token string">'/users'</span><span class="token punctuation">;</span>

    <span class="token keyword">static</span> <span class="token function">challenge</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>ChallengesApiClient<span class="token punctuation">.</span><span class="token constant">SERVER_URL</span> <span class="token operator">+</span> ChallengesApiClient<span class="token punctuation">.</span><span class="token constant">GET_CHALLENGE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token function">sendGuess</span><span class="token punctuation">(</span>user<span class="token operator">:</span> string<span class="token punctuation">,</span>
                     <span class="token literal-property property">a</span><span class="token operator">:</span> number<span class="token punctuation">,</span>
                     <span class="token literal-property property">b</span><span class="token operator">:</span> number<span class="token punctuation">,</span>
                     <span class="token literal-property property">guess</span><span class="token operator">:</span> number<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>ChallengesApiClient<span class="token punctuation">.</span><span class="token constant">SERVER_URL</span> <span class="token operator">+</span> ChallengesApiClient<span class="token punctuation">.</span><span class="token constant">POST_RESULT</span><span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> <span class="token string">'POST'</span><span class="token punctuation">,</span>
            <span class="token literal-property property">headers</span><span class="token operator">:</span> <span class="token punctuation">{<!-- --></span>
                <span class="token string-property property">'Content-Type'</span><span class="token operator">:</span> <span class="token string">'application/json'</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">body</span><span class="token operator">:</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">userAlias</span><span class="token operator">:</span> user<span class="token punctuation">,</span>
                <span class="token literal-property property">factorA</span><span class="token operator">:</span> a<span class="token punctuation">,</span>
                <span class="token literal-property property">factorB</span><span class="token operator">:</span> b<span class="token punctuation">,</span>
                <span class="token literal-property property">guess</span><span class="token operator">:</span> guess
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token function">getAttempts</span><span class="token punctuation">(</span>userAlias<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Get attempts for '</span> <span class="token operator">+</span> userAlias<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>ChallengesApiClient<span class="token punctuation">.</span><span class="token constant">SERVER_URL</span> <span class="token operator">+</span> ChallengesApiClient<span class="token punctuation">.</span><span class="token constant">GET_ATTEMPTS_BY_ALIAS</span> <span class="token operator">+</span> userAlias<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">static</span> <span class="token function">getUsers</span><span class="token punctuation">(</span>userIds<span class="token operator">:</span> number<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> Promise<span class="token operator">&lt;</span>Response<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span>ChallengesApiClient<span class="token punctuation">.</span><span class="token constant">SERVER_URL</span> <span class="token operator">+</span>
            ChallengesApiClient<span class="token punctuation">.</span><span class="token constant">GET_USERS_BY_IDS</span> <span class="token operator">+</span>
            <span class="token string">'/'</span> <span class="token operator">+</span> userIds<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> ChallengesApiClient<span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_246"></a>运行和测试</h3> 
<p>要执行整个系统，需要启动各个微服务，运行各个Spring Boot应用程序：</p> 
<ul><li>运行RabbitMQ服务器。</li><li>启动Multiplication微服务。</li><li>启动Gamification微服务。</li><li>启动Gateway微服务。</li><li>启动前端React应用程序。</li></ul> 
<p>这里不需要按照顺序启动这些微服务，在启动过程中，系统可能不稳定，但最终会准备就绪。<br> 当访问前端时，不会注意到任何改变，排行榜已经加载，可以正常发送尝试。验证请求是否被代理，可以查看浏览器开发人员工具中的网络选项卡，选择一个后端请求，以http://localhost:8000开头；也可以向网关中添加跟踪日志配置，就可以看到正在执行的操作了，在application.yml中进行配置，例如：</p> 
<pre><code class="prism language-yaml"><span class="token comment"># 配置路由跟踪日志</span>
<span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">org.springframework.cloud.gateway.handler.predicate</span><span class="token punctuation">:</span> trace
</code></pre> 
<p>重新启动网关，就会看到每个请求的日志，如下所示：</p> 
<pre><code class="prism language-java"><span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">14</span><span class="token constant">T12</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">12.333</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">TRACE</span> <span class="token number">50552</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ctor<span class="token operator">-</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>g<span class="token punctuation">.</span>h<span class="token punctuation">.</span>p<span class="token punctuation">.</span></span>PathRoutePredicateFactory</span>    <span class="token operator">:</span> <span class="token class-name">Pattern</span> <span class="token string">"[/challenges/**, /attempts, /attempts/**, /users/**]"</span> does not match against value <span class="token string">"/leaders"</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">14</span><span class="token constant">T12</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">12.334</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">TRACE</span> <span class="token number">50552</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ctor<span class="token operator">-</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>g<span class="token punctuation">.</span>h<span class="token punctuation">.</span>p<span class="token punctuation">.</span></span>PathRoutePredicateFactory</span>    <span class="token operator">:</span> <span class="token class-name">Pattern</span> <span class="token string">"/leaders"</span> matches against value <span class="token string">"/leaders"</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">14</span><span class="token constant">T12</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">12.445</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">TRACE</span> <span class="token number">50552</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ctor<span class="token operator">-</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>g<span class="token punctuation">.</span>h<span class="token punctuation">.</span>p<span class="token punctuation">.</span></span>PathRoutePredicateFactory</span>    <span class="token operator">:</span> <span class="token class-name">Pattern</span> <span class="token string">"[/challenges/**, /attempts, /attempts/**, /users/**]"</span> does not match against value <span class="token string">"/leaders"</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">14</span><span class="token constant">T12</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">12.446</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">TRACE</span> <span class="token number">50552</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ctor<span class="token operator">-</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>g<span class="token punctuation">.</span>h<span class="token punctuation">.</span>p<span class="token punctuation">.</span></span>PathRoutePredicateFactory</span>    <span class="token operator">:</span> <span class="token class-name">Pattern</span> <span class="token string">"/leaders"</span> matches against value <span class="token string">"/leaders"</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">14</span><span class="token constant">T12</span><span class="token operator">:</span><span class="token number">07</span><span class="token operator">:</span><span class="token number">12.448</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">TRACE</span> <span class="token number">50552</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ctor<span class="token operator">-</span>http<span class="token operator">-</span>nio<span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>g<span class="token punctuation">.</span>h<span class="token punctuation">.</span>p<span class="token punctuation">.</span></span>PathRoutePredicateFactory</span>    <span class="token operator">:</span> <span class="token class-name">Pattern</span> <span class="token string">"/users/**"</span> matches against value <span class="token string">"/users/1,3"</span>
</code></pre> 
<h3><a id="_270"></a>小结</h3> 
<p>通过网关微服务，获得了一些优势：</p> 
<ul><li>前端不了解后端的结构。</li><li>外部请求的通用配置保留在同一位置。示例中的CORS设置，也可能是其他关注点，如用户身份验证、指标等。</li></ul> 
<p>下面将引入负载均衡，以便可以在每个服务的所有实例之间分配流量，增加系统的可扩展性和冗余性，这需要一些先决条件：</p> 
<ul><li>网关需要知道给定服务的可用实例。前面给出了一个只有一个实例的配置，如果有多个实例呢？不应该在路由配置中包含硬编码列表，因为实例是动态的，应该透明地更新实例。</li><li>需要实现后端组件的健康度。只有这样，才能知道实例何时未准备好处理流量，并切换到其他任何运行正常的实例上。</li></ul> 
<p>满足第一个条件，需要引入服务发现模式，并使用一个公共注册表，不同的分布式组件可以访问该列表以了解可用服务。<br> 对第二个条件，可使用Spring Boot Actuator将微服务公开，并指示是否正常，以便其他组件知道，这也是服务发现需要的。</p> 
<h2><a id="_281"></a>运行状况</h2> 
<p>在生产环境中运行的系统永远无法避免出错，可能由于代码错误导致内存不足，网络连接可能失败，微服务实例可能崩溃等。要想构建一个弹性系统，就需要引入冗余机制（同一微服务存在多个副本）来防范这些错误，以将影响降到最低。<br> 如何知道微服务无法工作呢？如果要公开一个接口（如REST API或RabbitMQ），可使用探针与样本进行交互，看看是否作出反应。但是，使用探针时应该小心，因为想涵盖所有可能使微服务不健康（不正常）的情况。与其通过泄露逻辑来确定服务是否正常工作，不如提供一个标准的、简单的探测接口来告诉调用者服务是否正常。由服务逻辑来决定何时转换到不支持状态，具体取决于服务使用的接口的可用性、服务自身的可用性以及错误的严重性。如果该服务无法提供响应，则调用者认为它不正常。如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-feOeNaE2VFLHiJRb" width="806.9666748046875" xmlns="http://www.w3.org/2000/svg" height="429.25" viewbox="0 0 806.9666748046875 429.25" class="mermaid-svg"> 
  <style>#mermaid-svg-feOeNaE2VFLHiJRb {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-feOeNaE2VFLHiJRb .error-icon{fill:#552222;}#mermaid-svg-feOeNaE2VFLHiJRb .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-feOeNaE2VFLHiJRb .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-feOeNaE2VFLHiJRb .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-feOeNaE2VFLHiJRb .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-feOeNaE2VFLHiJRb .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-feOeNaE2VFLHiJRb .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-feOeNaE2VFLHiJRb .marker{fill:#333333;stroke:#333333;}#mermaid-svg-feOeNaE2VFLHiJRb .marker.cross{stroke:#333333;}#mermaid-svg-feOeNaE2VFLHiJRb svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-feOeNaE2VFLHiJRb .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-feOeNaE2VFLHiJRb .cluster-label text{fill:#333;}#mermaid-svg-feOeNaE2VFLHiJRb .cluster-label span{color:#333;}#mermaid-svg-feOeNaE2VFLHiJRb .label text,#mermaid-svg-feOeNaE2VFLHiJRb span{fill:#333;color:#333;}#mermaid-svg-feOeNaE2VFLHiJRb .node rect,#mermaid-svg-feOeNaE2VFLHiJRb .node circle,#mermaid-svg-feOeNaE2VFLHiJRb .node ellipse,#mermaid-svg-feOeNaE2VFLHiJRb .node polygon,#mermaid-svg-feOeNaE2VFLHiJRb .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-feOeNaE2VFLHiJRb .node .label{text-align:center;}#mermaid-svg-feOeNaE2VFLHiJRb .node.clickable{cursor:pointer;}#mermaid-svg-feOeNaE2VFLHiJRb .arrowheadPath{fill:#333333;}#mermaid-svg-feOeNaE2VFLHiJRb .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-feOeNaE2VFLHiJRb .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-feOeNaE2VFLHiJRb .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-feOeNaE2VFLHiJRb .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-feOeNaE2VFLHiJRb .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-feOeNaE2VFLHiJRb .cluster text{fill:#333;}#mermaid-svg-feOeNaE2VFLHiJRb .cluster span{color:#333;}#mermaid-svg-feOeNaE2VFLHiJRb div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-feOeNaE2VFLHiJRb :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <path d="M289.3833312988281,221.40871369294607L273.21666463216144,229.25726141078837C257.0499979654948,237.10580912863074,224.71666463216147,252.80290456431536,192.38333129882812,253.92930569561653C160.04999796549478,255.05570682691769,127.71666463216145,241.61141365383534,111.5499979654948,234.88926706729418L95.38333129882812,228.167120480753" id="L-v-a1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-v LE-a1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M78.47104519063777,176.5L97.4564262086695,152.75C116.44180722670121,129,154.41256926276466,81.5,193.48128361412975,57.75C232.54999796549478,34,272.71666463216144,34,309.681941986084,34C346.64721934000653,34,380.4111073811849,34,419.59166208902997,34C458.772216796875,34,503.3694381713867,34,539.1680488586426,34C574.9666595458984,34,601.9666595458984,34,619.6333262125651,34C637.2999928792318,34,645.6333262125651,34,653.9666595458984,34C662.2999928792318,34,670.6333262125651,34,685.2643174979681,56.083333333333336C699.8953087833712,78.16666666666667,720.8239580208441,122.33333333333333,731.2882826395803,144.41666666666666L741.7526072583167,166.5" id="L-a1-p-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-a1 LE-p" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M93.67982421739065,176.5L110.13040873096357,163.375C126.58099324453649,150.25,159.4821622716823,124,192.34829986617578,126.16666666666667C225.21443746066925,128.33333333333334,258.04554362251037,158.91666666666666,274.46109670343094,174.20833333333334L290.8766497843515,189.5" id="L-a1-v-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-a1 LE-v" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M331.3820316510105,189.5L345.18085894623596,174.20833333333334C358.9796862414614,158.91666666666666,386.57734083191235,128.33333333333334,415.39283453949133,116.49302139197681C444.2083282470703,104.65270945062029,474.24166107177734,111.55541890124057,489.25832748413086,115.00677362655072L504.2749938964844,118.45812835186086" id="L-v-a2-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-v LE-a2" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M591.6583251953125,128.5L597.8763809204102,128.5C604.0944366455078,128.5,616.5305480957031,128.5,626.9152704874674,128.5C637.2999928792318,128.5,645.6333262125651,128.5,653.9666595458984,128.5C662.2999928792318,128.5,670.6333262125651,128.5,682.6489957282346,134.83333333333334C694.6646652439041,141.16666666666666,710.3626709419099,153.83333333333334,718.2116737909128,160.16666666666666L726.0606766399155,166.5" id="L-a2-p-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-a2 LE-p" style="fill:none;"></path> 
     <path d="M504.2749938964844,140.09305507346144L489.25832748413086,144.0775458945512C474.24166107177734,148.06203671564097,444.2083282470703,156.03101835782047,416.22638448079425,165.9034839045803C388.24444071451825,175.77594945134013,362.31388600667316,187.55189890268025,349.34860865275067,193.43987362835028L336.3833312988281,199.32784835402038" id="L-a2-v-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-a2 LE-v" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M336.3833312988281,210L349.34860865275067,210C362.31388600667316,210,388.24444071451825,210,416.22638448079425,213.98449082108974C444.2083282470703,217.96898164217953,474.24166107177734,225.93796328435906,489.25832748413086,229.9224541054488L504.2749938964844,233.90694492653856" id="L-v-b1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-v LE-b1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M591.6583251953125,245.5L597.8763809204102,245.5C604.0944366455078,245.5,616.5305480957031,245.5,626.9152704874674,245.5C637.2999928792318,245.5,645.6333262125651,245.5,653.9666595458984,245.5C662.2999928792318,245.5,670.6333262125651,245.5,682.6489957282346,239.16666666666666C694.6646652439041,232.83333333333334,710.3626709419099,220.16666666666666,718.2116737909128,213.83333333333334L726.0606766399155,207.5" id="L-b1-p-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b1 LE-p" style="fill:none;"></path> 
     <path d="M504.2749938964844,253.01099342787643L489.25832748413086,255.59249452323036C474.24166107177734,258.1739956185843,444.2083282470703,263.33699780929214,416.22638448079425,258.43053104700044C388.24444071451825,253.52406428470874,362.31388600667316,238.54812856941749,349.34860865275067,231.06016071177189L336.3833312988281,223.57219285412626" id="L-b1-v-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b1 LE-v" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M324.5653516337506,230.5L339.50029226518603,256.7083333333333C354.4352328966215,282.9166666666667,384.3051141594924,335.3333333333333,414.25672120328136,361.5416666666667C444.2083282470703,387.75,474.24166107177734,387.75,489.25832748413086,387.75L504.2749938964844,387.75" id="L-v-b2-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-v LE-b2" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M574.3754186699861,354.25L583.4739588159715,342.7083333333333C592.5724989619569,331.1666666666667,610.7695792539276,308.0833333333333,624.0347860665797,296.5416666666667C637.2999928792318,285,645.6333262125651,285,653.9666595458984,285C662.2999928792318,285,670.6333262125651,285,684.3556901581433,272.0833333333333C698.0780541037216,259.1666666666667,717.1894486615447,233.33333333333334,726.7451459404562,220.41666666666666L736.3008432193678,207.5" id="L-b2-p-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b2 LE-p" style="fill:none;"></path> 
     <path d="M94.83281713001242,243.5L111.09123615814838,256.125C127.34965518628432,268.75,159.86649324255623,294,196.2082456040255,306.625C232.54999796549478,319.25,272.71666463216144,319.25,309.681941986084,319.25C346.64721934000653,319.25,380.4111073811849,319.25,419.59166208902997,319.25C458.772216796875,319.25,503.3694381713867,319.25,539.1680488586426,319.25C574.9666595458984,319.25,601.9666595458984,319.25,619.6333262125651,319.25C637.2999928792318,319.25,645.6333262125651,319.25,653.9666595458984,319.25C662.2999928792318,319.25,670.6333262125651,319.25,679.6509661152414,321.5416666666667C688.6686060179178,323.8333333333333,698.3705524899374,328.4166666666667,703.2215257259471,330.7083333333333L708.0724989619569,333" id="L-a1-d-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-a1 LE-d" style="fill:none;"></path> 
     <path d="M560.5875897784566,162L571.9841014063636,192.25C583.3806130342706,222.5,606.1736362900846,283,621.7368145846582,313.25C637.2999928792318,343.5,645.6333262125651,343.5,653.9666595458984,343.5C662.2999928792318,343.5,670.6333262125651,343.5,678.9666595458984,344.07471264367814C687.2999928792318,344.6494252873563,695.6333262125651,345.7988505747126,699.7999928792318,346.37356321839076L703.9666595458984,346.94827586206895" id="L-a2-d-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-a2 LE-d" style="fill:none;"></path> 
     <path d="M570.9624222577628,279L580.6297951391188,293.0833333333333C590.2971680204747,307.1666666666667,609.6319137831865,335.3333333333333,623.4659533312091,349.4166666666667C637.2999928792318,363.5,645.6333262125651,363.5,653.9666595458984,363.5C662.2999928792318,363.5,670.6333262125651,363.5,678.9666595458984,362.92528735632186C687.2999928792318,362.3505747126437,695.6333262125651,361.2011494252874,699.7999928792318,360.62643678160924L703.9666595458984,360.05172413793105" id="L-b1-d-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b1 LE-d" style="fill:none;"></path> 
     <path d="M591.6583251953125,387.75L597.8763809204102,387.75C604.0944366455078,387.75,616.5305480957031,387.75,626.9152704874674,387.75C637.2999928792318,387.75,645.6333262125651,387.75,653.9666595458984,387.75C662.2999928792318,387.75,670.6333262125651,387.75,679.6509661152414,385.4583333333333C688.6686060179178,383.1666666666667,698.3705524899374,378.5833333333333,703.2215257259471,376.2916666666667L708.0724989619569,374" id="L-b2-d-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b2 LE-d" style="fill:none;"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(192.38333129882812, 268.5)"> 
      <g class="label" transform="translate(-27.041664123535156, -13)"> 
       <foreignobject width="54.08332824707031" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">/health</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(547.9666595458984, 34)"> 
      <g class="label" transform="translate(-56, -26)"> 
       <foreignobject width="112" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">无法到达代理<br>（如网络问题）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(192.38333129882812, 97.75)"> 
      <g class="label" transform="translate(-72, -13)"> 
       <foreignobject width="144" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">错误（服务不可用）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(414.1749954223633, 97.75)"> 
      <g class="label" transform="translate(-27.041664123535156, -13)"> 
       <foreignobject width="54.08332824707031" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">/health</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(414.1749954223633, 164)"> 
      <g class="label" transform="translate(-52.791664123535156, -13)"> 
       <foreignobject width="105.58332824707031" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">OK（healthy）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(414.1749954223633, 210)"> 
      <g class="label" transform="translate(-27.041664123535156, -13)"> 
       <foreignobject width="54.08332824707031" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">/health</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(414.1749954223633, 268.5)"> 
      <g class="label" transform="translate(-52.791664123535156, -13)"> 
       <foreignobject width="105.58332824707031" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">OK（healthy）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(414.1749954223633, 387.75)"> 
      <g class="label" transform="translate(-48, -26)"> 
       <foreignobject width="96" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">/health<br>（请求超时）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-a1-4787" transform="translate(51.69166564941406, 210)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-43.69166564941406" y="-33.5" width="87.38333129882812" height="67"></rect> 
      <g class="label" style="" transform="translate(-36.19166564941406, -26)"> 
       <foreignobject width="72.38333129882812" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">微服务A<br>（实例1）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-a2-4788" transform="translate(547.9666595458984, 128.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-43.69166564941406" y="-33.5" width="87.38333129882812" height="67"></rect> 
      <g class="label" style="" transform="translate(-36.19166564941406, -26)"> 
       <foreignobject width="72.38333129882812" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">微服务A<br>（实例2）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b1-4789" transform="translate(547.9666595458984, 245.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-43.69166564941406" y="-33.5" width="87.38333129882812" height="67"></rect> 
      <g class="label" style="" transform="translate(-36.19166564941406, -26)"> 
       <foreignobject width="72.38333129882812" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">微服务B<br>（实例1）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b2-4790" transform="translate(547.9666595458984, 387.75)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-43.69166564941406" y="-33.5" width="87.38333129882812" height="67"></rect> 
      <g class="label" style="" transform="translate(-36.19166564941406, -26)"> 
       <foreignobject width="72.38333129882812" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">微服务B<br>（实例2）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-p-4791" transform="translate(751.4666595458984, 187)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-39.5" y="-20.5" width="79" height="41"></rect> 
      <g class="label" style="" transform="translate(-32, -13)"> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">消息代理</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-d-4792" transform="translate(751.4666595458984, 353.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-20.5" width="95" height="41"></rect> 
      <g class="label" style="" transform="translate(-40, -13)"> 
       <foreignobject width="80" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">数据库引擎</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-v-4793" transform="translate(312.8833312988281, 210)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-23.5" y="-20.5" width="47" height="41"></rect> 
      <g class="label" style="" transform="translate(-16, -13)"> 
       <foreignobject width="32" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">访问</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>许多工具和框架都需要这种简单的接口约定来确定服务的运行状况，例如，负载均衡器可暂时停止将流量转移到不响应运行状况探测或响应为未就绪状态的实例，如果实例不正常，则服务发现工具可能将其从注册表中删除，如果服务在配置时间段内运行不正常，则Kubernetes等容器平台可决定重新启动服务。</p> 
<h3><a id="Spring_Boot_Actuator_306"></a>Spring Boot Actuator</h3> 
<p>Spring Boot提供了一种开箱即用的解决方案，Spring Boot Actuator，来报告微服务的运行状况，这不是Actuator的唯一功能，它还可以公开其他端点，以访问有关应用程序的不同数据，如配置的记录器、HTTP跟踪、审核事件等，甚至可以打开一个管理端点，来关闭应用程序。<br> Actuator端点可以独立启用或禁用，不仅可以通过Web接口使用，还可以通过Java管理扩展（Java Management Extensions，JMX）使用。这里重点介绍用作REST API端点的Web接口，默认配置仅公开两个端点：info和health。info旨在提供应用程序的常规信息，health使用运行状况指示器来输出应用程序的状态，有多个内置的运行状况指示器，可以影响应用程序的总体运行状况。这些指示器有许多是针对某些工具的，只有在应用程序中使用这些工具时，才可用，使用Spring Boot可使用自动配置进行控制。<br> Spring Boot Actuator工件中包含RabbitHealthIndicator类，使用RabbitTemplate对象，可以访问RabbitMQ服务器，与RabbitMQ服务器进行交互，进行运行状况检查。RabbitHealthIndicator 类代码如下：</p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitHealthIndicator</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractHealthIndicator</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">RabbitHealthIndicator</span><span class="token punctuation">(</span><span class="token class-name">RabbitTemplate</span> rabbitTemplate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token string">"Rabbit health check failed"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Assert</span><span class="token punctuation">.</span><span class="token function">notNull</span><span class="token punctuation">(</span>rabbitTemplate<span class="token punctuation">,</span> <span class="token string">"RabbitTemplate must not be null"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>rabbitTemplate <span class="token operator">=</span> rabbitTemplate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">doHealthCheck</span><span class="token punctuation">(</span><span class="token class-name">Health<span class="token punctuation">.</span>Builder</span> builder<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        builder<span class="token punctuation">.</span><span class="token function">up</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">withDetail</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> <span class="token function">getVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span>rabbitTemplate<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">(</span>channel<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> channel<span class="token punctuation">.</span><span class="token function">getConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getServerProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"version"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果使用RabbitMQ，会在上下文中自动插入该指示器。这有助于改善整体运行状况。包含在工件spring-boot-actuator-autoconfigure中的RabbitHealthContributorAutoConfiguration类负责解决这个问题。这个配置取决于是否存在RabbitTemplate Bean，如果存在则意味着正在使用RabbitMQ模块，这会创建一个HealthContributor Bean，由整体运行状况自动配置进行检测和汇总。RabbitHealthContributorAutoConfiguration类代码如下：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@AutoConfiguration</span><span class="token punctuation">(</span>
    after <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token class-name">RabbitAutoConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span>
<span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnClass</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnBean</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token class-name">RabbitTemplate</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@ConditionalOnEnabledHealthIndicator</span><span class="token punctuation">(</span><span class="token string">"rabbit"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RabbitHealthContributorAutoConfiguration</span> <span class="token keyword">extends</span> <span class="token class-name">CompositeHealthContributorConfiguration</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">RabbitHealthIndicator</span><span class="token punctuation">,</span> <span class="token class-name">RabbitTemplate</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token class-name">RabbitHealthContributorAutoConfiguration</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token class-name">RabbitHealthIndicator</span><span class="token operator">::</span><span class="token keyword">new</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@ConditionalOnMissingBean</span><span class="token punctuation">(</span>
        name <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">"rabbitHealthIndicator"</span><span class="token punctuation">,</span> <span class="token string">"rabbitHealthContributor"</span><span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">HealthContributor</span> <span class="token function">rabbitHealthContributor</span><span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">RabbitTemplate</span><span class="token punctuation">&gt;</span></span> rabbitTemplates<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token class-name">HealthContributor</span><span class="token punctuation">)</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createContributor</span><span class="token punctuation">(</span>rabbitTemplates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>那么，Actuator到底这么用呢？</p> 
<h3><a id="Actuator_354"></a>在微服务中包含Actuator</h3> 
<p>在pom.xml文件中添加依赖项spring-boot-starter-actuator，就可以获得Actuator功能，代码如下：</p> 
<pre><code class="prism language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-actuator<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>需要将该依赖添加到Multiplication、Gamification和Gateway微服务中。默认配置在/actuator上下文中公开health和info端点，这就够了，而且如果需要，可通过属性进行调整。重启应用程序就可以使用该功能了，可通过浏览器或命令行，验证服务器的运行状况。</p> 
<blockquote> 
 <p>注意：不是通过网关公开/health端点，因为这不是要对外公开的功能，只是系统内部功能。</p> 
</blockquote> 
<p>测试Gamification的Actuator，可在命令行运行如下命令，结果如下：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> http :8081/actuator/health
HTTP/1.1 <span class="token number">200</span>
Connection: keep-alive
Content-Type: application/vnd.spring-boot.actuator.v3+json
Date: Fri, <span class="token number">15</span> Dec <span class="token number">2023</span> 01:21:22 GMT
Keep-Alive: <span class="token assign-left variable">timeout</span><span class="token operator">=</span><span class="token number">60</span>
Transfer-Encoding: chunked

<span class="token punctuation">{<!-- --></span>
    <span class="token string">"status"</span><span class="token builtin class-name">:</span> <span class="token string">"UP"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果系统正常运行，将获得UP值和HTTP状态码200。如果停止RabbitMQ服务器，再尝试相同的请求，由于Actuator包含了一个检查了RabbitMQ服务器的运行状况指示器，该指示器会失败，就导致聚合的运行状况切换为DOWN。在RabbitMQ服务器停止的情况下发出请求，结果确实是这样的，结果如下：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> http :8081/actuator/health
HTTP/1.1 <span class="token number">503</span>
Connection: close
Content-Type: application/vnd.spring-boot.actuator.v3+json
Date: Fri, <span class="token number">15</span> Dec <span class="token number">2023</span> 01:22:21 GMT
Transfer-Encoding: chunked

<span class="token punctuation">{<!-- --></span>
    <span class="token string">"status"</span><span class="token builtin class-name">:</span> <span class="token string">"DOWN"</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>这时返回的HTTP状态码是503，即服务不可用。调用者不需要解析响应主体，只需要检查HTTP响应状态码是否为200即可确定该应用程序是否正常。还可以在控制台日志中看到RabbitHealthIndicator未能成功，例如：</p> 
<pre><code class="prism language-java"><span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">15</span><span class="token constant">T09</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">18.897</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">15900</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>ntContainer#<span class="token number">0</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>a<span class="token punctuation">.</span>r<span class="token punctuation">.</span>c<span class="token punctuation">.</span></span>CachingConnectionFactory</span>       <span class="token operator">:</span> <span class="token class-name">Attempting</span> <span class="token keyword">to</span> <span class="token namespace">connect</span> <span class="token keyword">to</span><span class="token operator">:</span> <span class="token punctuation">[</span>localhost<span class="token operator">:</span><span class="token number">5672</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">15</span><span class="token constant">T09</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">21.506</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">15900</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>a<span class="token punctuation">.</span>r<span class="token punctuation">.</span>c<span class="token punctuation">.</span></span>CachingConnectionFactory</span>       <span class="token operator">:</span> <span class="token class-name">Attempting</span> <span class="token keyword">to</span> <span class="token namespace">connect</span> <span class="token keyword">to</span><span class="token operator">:</span> <span class="token punctuation">[</span>localhost<span class="token operator">:</span><span class="token number">5672</span><span class="token punctuation">]</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">15</span><span class="token constant">T09</span><span class="token operator">:</span><span class="token number">22</span><span class="token operator">:</span><span class="token number">21.510</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">WARN</span> <span class="token number">15900</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>nio<span class="token operator">-</span><span class="token number">8081</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>b<span class="token punctuation">.</span>a<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span></span>RabbitHealthIndicator</span>       <span class="token operator">:</span> <span class="token class-name">Rabbit</span> health check failed

<span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span></span>AmqpIOException</span><span class="token operator">:</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>IOException</span>
	at <span class="token class-name"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>support<span class="token punctuation">.</span></span>RabbitExceptionTranslator</span><span class="token punctuation">.</span><span class="token function">convertRabbitAccessException</span><span class="token punctuation">(</span><span class="token class-name">RabbitExceptionTranslator</span><span class="token punctuation">.</span>java<span class="token operator">:</span><span class="token number">70</span><span class="token punctuation">)</span> <span class="token operator">~</span><span class="token punctuation">[</span>spring<span class="token operator">-</span>rabbit<span class="token operator">-</span><span class="token number">3.1</span><span class="token number">.0</span><span class="token punctuation">.</span>jar<span class="token operator">:</span><span class="token number">3.1</span><span class="token number">.0</span><span class="token punctuation">]</span>
	at 
	<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> omitted
</code></pre> 
<p>如果重启RabbitMQ服务器，并再次检查运行状况，就会切换到UP状态。这就是健壮系统需要的行为：微服务有问题时，应该标记，让其他微服务知道；而且，应尝试从错误中恢复并在可能的情况下再次切换到再次状态。</p> 
<h2><a id="_404"></a>服务发现和负载均衡</h2> 
<p>已经能知道服务是否可用了，就可以在系统中集成服务发现和负载均衡了。<br> 服务发现包含两个主要概念：</p> 
<ul><li>服务注册表：位于中心位置，列出了可用服务、服务所在的地址以及其他一些元数据（如名称）。服务实例将自身服务信息注册到注册中心。这部分服务信息包括服务所在主机IP和提供服务的Port，以及暴露服务自身状态以及访问协议等信息。可能包含不同服务的条目，有可能包含同一服务的多个实例。后一种情况下，访问注册表的客户端可以通过查询服务别名来获得可用实例的列表。</li><li>注册服务者：负责注册服务者完成注册服务实例的逻辑。可以是观察微服务状态的外部运行过程，也可以作为库嵌入服务本身。</li></ul> 
<p>服务发现就是服务实例请求注册中心获取所依赖服务信息。服务实例通过注册中心，获取到注册到其中的服务实例的信息，通过这些信息去请求它们提供的服务。</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-Sg3lD81gEu8wi5Nt" width="605.2000122070312" xmlns="http://www.w3.org/2000/svg" height="276" viewbox="0 0 605.2000122070312 276" class="mermaid-svg"> 
  <style>#mermaid-svg-Sg3lD81gEu8wi5Nt {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-Sg3lD81gEu8wi5Nt .error-icon{fill:#552222;}#mermaid-svg-Sg3lD81gEu8wi5Nt .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-Sg3lD81gEu8wi5Nt .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-Sg3lD81gEu8wi5Nt .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-Sg3lD81gEu8wi5Nt .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-Sg3lD81gEu8wi5Nt .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-Sg3lD81gEu8wi5Nt .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-Sg3lD81gEu8wi5Nt .marker{fill:#333333;stroke:#333333;}#mermaid-svg-Sg3lD81gEu8wi5Nt .marker.cross{stroke:#333333;}#mermaid-svg-Sg3lD81gEu8wi5Nt svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-Sg3lD81gEu8wi5Nt .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-Sg3lD81gEu8wi5Nt .cluster-label text{fill:#333;}#mermaid-svg-Sg3lD81gEu8wi5Nt .cluster-label span{color:#333;}#mermaid-svg-Sg3lD81gEu8wi5Nt .label text,#mermaid-svg-Sg3lD81gEu8wi5Nt span{fill:#333;color:#333;}#mermaid-svg-Sg3lD81gEu8wi5Nt .node rect,#mermaid-svg-Sg3lD81gEu8wi5Nt .node circle,#mermaid-svg-Sg3lD81gEu8wi5Nt .node ellipse,#mermaid-svg-Sg3lD81gEu8wi5Nt .node polygon,#mermaid-svg-Sg3lD81gEu8wi5Nt .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-Sg3lD81gEu8wi5Nt .node .label{text-align:center;}#mermaid-svg-Sg3lD81gEu8wi5Nt .node.clickable{cursor:pointer;}#mermaid-svg-Sg3lD81gEu8wi5Nt .arrowheadPath{fill:#333333;}#mermaid-svg-Sg3lD81gEu8wi5Nt .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-Sg3lD81gEu8wi5Nt .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-Sg3lD81gEu8wi5Nt .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-Sg3lD81gEu8wi5Nt .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-Sg3lD81gEu8wi5Nt .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-Sg3lD81gEu8wi5Nt .cluster text{fill:#333;}#mermaid-svg-Sg3lD81gEu8wi5Nt .cluster span{color:#333;}#mermaid-svg-Sg3lD81gEu8wi5Nt div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-Sg3lD81gEu8wi5Nt :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"> 
     <g class="cluster default" id="l"> 
      <rect style="" rx="0" ry="0" x="61.383331298828125" y="177" width="467.9833297729492" height="91"></rect> 
      <g class="cluster-label" transform="translate(154.21667098999023, 182)"> 
       <foreignobject width="282.316650390625" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务列表：<br>-multiplication-&gt;host1:8080,host2:9080<br>-gamification-&gt;host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="edgePaths"> 
     <path d="M101.38333129882812,101L101.38333129882812,107.33333333333333C101.38333129882812,113.66666666666667,101.38333129882812,126.33333333333333,101.38333129882812,139C101.38333129882812,151.66666666666666,101.38333129882812,164.33333333333334,127.92777506510417,176.50789936923124C154.47221883138022,188.68246540512908,207.56110636393228,200.3649308102582,234.10555013020834,206.20616351282274L260.6499938964844,212.0473962153873" id="L-m1-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m1 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M308.1499938964844,101L308.1499938964844,107.33333333333333C308.1499938964844,113.66666666666667,308.1499938964844,126.33333333333333,308.1499938964844,139C308.1499938964844,151.66666666666666,308.1499938964844,164.33333333333334,308.1499938964844,174.83333333333334C308.1499938964844,185.33333333333334,308.1499938964844,193.66666666666666,308.1499938964844,197.83333333333334L308.1499938964844,202" id="L-m2-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m2 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M509.36666107177734,101L509.36666107177734,107.33333333333333C509.36666107177734,113.66666666666667,509.36666107177734,126.33333333333333,509.36666107177734,139C509.36666107177734,151.66666666666666,509.36666107177734,164.33333333333334,483.74721654256183,176.45984842662395C458.1277720133464,188.58636351991458,406.88888295491535,200.17272703982917,381.2694384256999,205.96590879978646L355.6499938964844,211.75909055974378" id="L-g1-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g1 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(101.38333129882812, 139)"> 
      <g class="label" transform="translate(-93.38333129882812, -13)"> 
       <foreignobject width="186.76666259765625" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">multiplication=host1:8080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(308.1499938964844, 139)"> 
      <g class="label" transform="translate(-93.38333129882812, -13)"> 
       <foreignobject width="186.76666259765625" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">multiplication=host2:9080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(509.36666107177734, 139)"> 
      <g class="label" transform="translate(-87.83333587646484, -13)"> 
       <foreignobject width="175.6666717529297" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">gamification=host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-r-4830" transform="translate(308.1499938964844, 222.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-20.5" width="95" height="41"></rect> 
      <g class="label" style="" transform="translate(-40, -13)"> 
       <foreignobject width="80" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册表</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m1-4831" transform="translate(101.38333129882812, 54.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-46.5" width="113.5" height="93"></rect> 
      <g class="label" style="" transform="translate(-49.25, -39)"> 
       <foreignobject width="98.5" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Multiplication<br>host1:8080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m2-4832" transform="translate(308.1499938964844, 54.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-46.5" width="113.5" height="93"></rect> 
      <g class="label" style="" transform="translate(-49.25, -39)"> 
       <foreignobject width="98.5" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Multiplication<br>host2:9080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g1-4833" transform="translate(509.36666107177734, 54.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-46.5" width="107.11666870117188" height="93"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -39)"> 
       <foreignobject width="92.11666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Gamification<br>host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>从图中可以看到，有三个服务注册。host1在端口8080上部署了一个Multiplication实例，在端口8081上部署了一个Gamification实例，host2在端口9080上部署了一个Multiplication实例，这些实例都知道它们所在的位置，然后，这些注册者将相应的URI发送到服务注册中心，服务注册中心客户端可以使用其名称简单地请求服务的位置，接着，服务注册中心返回实例及其位置的列表。<br> 负载均衡模式与服务发现紧密相关，如果多个服务在注册时使用相同的名称，则意味着有多个副本可用。想要平衡它们之间的流量，就可以增加系统的容量并通过增加的冗余使其在出现错误时更具弹性。<br> 其他服务可从注册表中查询给定服务的名称，检索列表，然后确定要调用的实例，这称为客户端发现，表示客户端知道服务注册表并自行执行负载均衡。这里的客户端，指的是想要对另一个服务执行HTTP调用的应用程序、微服务、浏览器等。如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-AWf5bCYsofHFhEZ8" width="816.0416259765625" xmlns="http://www.w3.org/2000/svg" height="469" viewbox="0 0 816.0416259765625 469" class="mermaid-svg"> 
  <style>#mermaid-svg-AWf5bCYsofHFhEZ8 {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-AWf5bCYsofHFhEZ8 .error-icon{fill:#552222;}#mermaid-svg-AWf5bCYsofHFhEZ8 .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-AWf5bCYsofHFhEZ8 .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-AWf5bCYsofHFhEZ8 .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-AWf5bCYsofHFhEZ8 .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-AWf5bCYsofHFhEZ8 .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-AWf5bCYsofHFhEZ8 .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-AWf5bCYsofHFhEZ8 .marker{fill:#333333;stroke:#333333;}#mermaid-svg-AWf5bCYsofHFhEZ8 .marker.cross{stroke:#333333;}#mermaid-svg-AWf5bCYsofHFhEZ8 svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-AWf5bCYsofHFhEZ8 .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-AWf5bCYsofHFhEZ8 .cluster-label text{fill:#333;}#mermaid-svg-AWf5bCYsofHFhEZ8 .cluster-label span{color:#333;}#mermaid-svg-AWf5bCYsofHFhEZ8 .label text,#mermaid-svg-AWf5bCYsofHFhEZ8 span{fill:#333;color:#333;}#mermaid-svg-AWf5bCYsofHFhEZ8 .node rect,#mermaid-svg-AWf5bCYsofHFhEZ8 .node circle,#mermaid-svg-AWf5bCYsofHFhEZ8 .node ellipse,#mermaid-svg-AWf5bCYsofHFhEZ8 .node polygon,#mermaid-svg-AWf5bCYsofHFhEZ8 .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-AWf5bCYsofHFhEZ8 .node .label{text-align:center;}#mermaid-svg-AWf5bCYsofHFhEZ8 .node.clickable{cursor:pointer;}#mermaid-svg-AWf5bCYsofHFhEZ8 .arrowheadPath{fill:#333333;}#mermaid-svg-AWf5bCYsofHFhEZ8 .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-AWf5bCYsofHFhEZ8 .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-AWf5bCYsofHFhEZ8 .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-AWf5bCYsofHFhEZ8 .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-AWf5bCYsofHFhEZ8 .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-AWf5bCYsofHFhEZ8 .cluster text{fill:#333;}#mermaid-svg-AWf5bCYsofHFhEZ8 .cluster span{color:#333;}#mermaid-svg-AWf5bCYsofHFhEZ8 div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-AWf5bCYsofHFhEZ8 :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"> 
     <g class="cluster default" id="c"> 
      <rect style="" rx="0" ry="0" x="44.133331298828125" y="8" width="763.25" height="91"></rect> 
      <g class="cluster-label" transform="translate(401.7583312988281, 13)"> 
       <foreignobject width="48" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">客户端<br>报告</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="l"> 
      <rect style="" rx="0" ry="0" x="44.133331298828125" y="370" width="759.25" height="91"></rect> 
      <g class="cluster-label" transform="translate(282.6000061035156, 375)"> 
       <foreignobject width="282.316650390625" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务列表：<br>-multiplication-&gt;host1:8080,host2:9080<br>-gamification-&gt;host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="edgePaths"> 
     <path d="M101.38333129882812,268L101.38333129882812,276.5C101.38333129882812,285,101.38333129882812,302,101.38333129882812,319C101.38333129882812,336,101.38333129882812,353,161.46388626098633,368.2004336973757C221.54444122314453,383.4008673947513,341.70555114746094,396.80173478950263,401.78610610961914,403.50216848687836L461.86666107177734,410.202602184254" id="L-m1-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m1 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M308.1499938964844,268L308.1499938964844,276.5C308.1499938964844,285,308.1499938964844,302,308.1499938964844,319C308.1499938964844,336,308.1499938964844,353,333.7694384256999,367.29318175995724C359.38888295491535,381.5863635199146,410.6277720133464,393.17272703982917,436.24721654256183,398.9659087997864L461.86666107177734,404.75909055974375" id="L-m2-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m2 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M509.36666107177734,268L509.36666107177734,276.5C509.36666107177734,285,509.36666107177734,302,509.36666107177734,319C509.36666107177734,336,509.36666107177734,353,509.36666107177734,365.6666666666667C509.36666107177734,378.3333333333333,509.36666107177734,386.6666666666667,509.36666107177734,390.8333333333333L509.36666107177734,395" id="L-g1-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g1 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M155.26666259765625,72.74594009447759L146.2861073811849,77.12161674539799C137.30555216471353,81.4972933963184,119.34444173177083,90.24864669815919,110.36388651529948,100.95765668241295C101.38333129882812,111.66666666666667,101.38333129882812,124.33333333333333,101.38333129882812,137C101.38333129882812,149.66666666666666,101.38333129882812,162.33333333333334,101.38333129882812,168.66666666666666L101.38333129882812,175" id="L-c2-m1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c2 LE-m1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M234.26666259765625,69.3510953895264L246.58055114746094,74.29257949127201C258.8944396972656,79.23406359301761,283.522216796875,89.1170317965088,295.8361053466797,100.39184923158773C308.1499938964844,111.66666666666667,308.1499938964844,124.33333333333333,308.1499938964844,137C308.1499938964844,149.66666666666666,308.1499938964844,162.33333333333334,308.1499938964844,168.66666666666666L308.1499938964844,175" id="L-c2-m2-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c2 LE-m2" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M677.189923967634,74L672.8374361310687,78.16666666666667C668.4849482945034,82.33333333333333,659.7799726213728,90.66666666666667,655.4274847848075,101.16666666666667C651.0749969482422,111.66666666666667,651.0749969482422,124.33333333333333,651.0749969482422,144.75C651.0749969482422,165.16666666666666,651.0749969482422,193.33333333333334,651.0749969482422,223.66666666666666C651.0749969482422,254,651.0749969482422,286.5,651.0749969482422,311.25C651.0749969482422,336,651.0749969482422,353,651.0749969482422,361.5L651.0749969482422,370" id="L-c1-l-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c1 LE-l" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M766.1333312988281,370L766.1333312988281,361.5C766.1333312988281,353,766.1333312988281,336,766.1333312988281,311.25C766.1333312988281,286.5,766.1333312988281,254,766.1333312988281,223.66666666666666C766.1333312988281,193.33333333333334,766.1333312988281,165.16666666666666,766.1333312988281,144.75C766.1333312988281,124.33333333333333,766.1333312988281,111.66666666666667,759.949341630761,101.16666666666667C753.7653519626939,90.66666666666667,741.3973726265598,82.33333333333333,735.2133829584926,78.16666666666667L729.0293932904254,74" id="L-l-c1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-l LE-c1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(101.38333129882812, 319)"> 
      <g class="label" transform="translate(-93.38333129882812, -26)"> 
       <foreignobject width="186.76666259765625" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">1<br>multiplication=host1:8080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(308.1499938964844, 319)"> 
      <g class="label" transform="translate(-93.38333129882812, -26)"> 
       <foreignobject width="186.76666259765625" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">1<br>multiplication=host2:9080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(509.36666107177734, 319)"> 
      <g class="label" transform="translate(-87.83333587646484, -26)"> 
       <foreignobject width="175.6666717529297" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">1<br>gamification=host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(101.38333129882812, 137)"> 
      <g class="label" transform="translate(-4.1916656494140625, -13)"> 
       <foreignobject width="8.383331298828125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">3</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(308.1499938964844, 137)"> 
      <g class="label" transform="translate(-4.1916656494140625, -13)"> 
       <foreignobject width="8.383331298828125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">3</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(651.0749969482422, 221.5)"> 
      <g class="label" transform="translate(-53.150001525878906, -26)"> 
       <foreignobject width="106.30000305175781" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">2<br>multiplication?</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(766.1333312988281, 221.5)"> 
      <g class="label" transform="translate(-41.90833282470703, -39)"> 
       <foreignobject width="83.81666564941406" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">2<br>host1:8080,<br>host2:9080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-c1-4862" transform="translate(698.6041641235352, 53.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-39.5" y="-20.5" width="79" height="41"></rect> 
      <g class="label" style="" transform="translate(-32, -13)"> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务发现</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c2-4863" transform="translate(194.76666259765625, 53.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-39.5" y="-20.5" width="79" height="41"></rect> 
      <g class="label" style="" transform="translate(-32, -13)"> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">负载均衡</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-r-4861" transform="translate(509.36666107177734, 415.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-20.5" width="95" height="41"></rect> 
      <g class="label" style="" transform="translate(-40, -13)"> 
       <foreignobject width="80" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册表</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m1-4868" transform="translate(101.38333129882812, 221.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-46.5" width="113.5" height="93"></rect> 
      <g class="label" style="" transform="translate(-49.25, -39)"> 
       <foreignobject width="98.5" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Multiplication<br>host1:8080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m2-4869" transform="translate(308.1499938964844, 221.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-46.5" width="113.5" height="93"></rect> 
      <g class="label" style="" transform="translate(-49.25, -39)"> 
       <foreignobject width="98.5" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Multiplication<br>host2:9080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g1-4870" transform="translate(509.36666107177734, 221.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-46.5" width="107.11666870117188" height="93"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -39)"> 
       <foreignobject width="92.11666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Gamification<br>host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>另一方面，服务器端发现通过提供一个预先已知的唯一地址，来从客户端抽象所有这些逻辑，调用者可在该地址中找到给定的服务。当发出请求时，负载均衡器会拦截请求，然后将请求代理到其中一个副本。如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-ugUisTTxryJ5cSrV" width="816.0416259765625" xmlns="http://www.w3.org/2000/svg" height="469" viewbox="0 0 816.0416259765625 469" class="mermaid-svg"> 
  <style>#mermaid-svg-ugUisTTxryJ5cSrV {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-ugUisTTxryJ5cSrV .error-icon{fill:#552222;}#mermaid-svg-ugUisTTxryJ5cSrV .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-ugUisTTxryJ5cSrV .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-ugUisTTxryJ5cSrV .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-ugUisTTxryJ5cSrV .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-ugUisTTxryJ5cSrV .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-ugUisTTxryJ5cSrV .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-ugUisTTxryJ5cSrV .marker{fill:#333333;stroke:#333333;}#mermaid-svg-ugUisTTxryJ5cSrV .marker.cross{stroke:#333333;}#mermaid-svg-ugUisTTxryJ5cSrV svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-ugUisTTxryJ5cSrV .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-ugUisTTxryJ5cSrV .cluster-label text{fill:#333;}#mermaid-svg-ugUisTTxryJ5cSrV .cluster-label span{color:#333;}#mermaid-svg-ugUisTTxryJ5cSrV .label text,#mermaid-svg-ugUisTTxryJ5cSrV span{fill:#333;color:#333;}#mermaid-svg-ugUisTTxryJ5cSrV .node rect,#mermaid-svg-ugUisTTxryJ5cSrV .node circle,#mermaid-svg-ugUisTTxryJ5cSrV .node ellipse,#mermaid-svg-ugUisTTxryJ5cSrV .node polygon,#mermaid-svg-ugUisTTxryJ5cSrV .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-ugUisTTxryJ5cSrV .node .label{text-align:center;}#mermaid-svg-ugUisTTxryJ5cSrV .node.clickable{cursor:pointer;}#mermaid-svg-ugUisTTxryJ5cSrV .arrowheadPath{fill:#333333;}#mermaid-svg-ugUisTTxryJ5cSrV .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-ugUisTTxryJ5cSrV .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-ugUisTTxryJ5cSrV .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-ugUisTTxryJ5cSrV .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-ugUisTTxryJ5cSrV .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-ugUisTTxryJ5cSrV .cluster text{fill:#333;}#mermaid-svg-ugUisTTxryJ5cSrV .cluster span{color:#333;}#mermaid-svg-ugUisTTxryJ5cSrV div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-ugUisTTxryJ5cSrV :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"> 
     <g class="cluster default" id="c"> 
      <rect style="" rx="0" ry="0" x="44.133331298828125" y="8" width="763.25" height="91"></rect> 
      <g class="cluster-label" transform="translate(401.7583312988281, 13)"> 
       <foreignobject width="48" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">客户端<br>报告</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="l"> 
      <rect style="" rx="0" ry="0" x="44.133331298828125" y="370" width="759.25" height="91"></rect> 
      <g class="cluster-label" transform="translate(282.6000061035156, 375)"> 
       <foreignobject width="282.316650390625" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务列表：<br>-multiplication-&gt;host1:8080,host2:9080<br>-gamification-&gt;host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="edgePaths"> 
     <path d="M101.38333129882812,268L101.38333129882812,276.5C101.38333129882812,285,101.38333129882812,302,101.38333129882812,319C101.38333129882812,336,101.38333129882812,353,161.46388626098633,368.2004336973757C221.54444122314453,383.4008673947513,341.70555114746094,396.80173478950263,401.78610610961914,403.50216848687836L461.86666107177734,410.202602184254" id="L-m1-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m1 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M308.1499938964844,268L308.1499938964844,276.5C308.1499938964844,285,308.1499938964844,302,308.1499938964844,319C308.1499938964844,336,308.1499938964844,353,333.7694384256999,367.29318175995724C359.38888295491535,381.5863635199146,410.6277720133464,393.17272703982917,436.24721654256183,398.9659087997864L461.86666107177734,404.75909055974375" id="L-m2-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m2 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M509.36666107177734,268L509.36666107177734,276.5C509.36666107177734,285,509.36666107177734,302,509.36666107177734,319C509.36666107177734,336,509.36666107177734,353,509.36666107177734,365.6666666666667C509.36666107177734,378.3333333333333,509.36666107177734,386.6666666666667,509.36666107177734,390.8333333333333L509.36666107177734,395" id="L-g1-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g1 LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M155.26666259765625,72.74594009447759L146.2861073811849,77.12161674539799C137.30555216471353,81.4972933963184,119.34444173177083,90.24864669815919,110.36388651529948,100.95765668241295C101.38333129882812,111.66666666666667,101.38333129882812,124.33333333333333,101.38333129882812,137C101.38333129882812,149.66666666666666,101.38333129882812,162.33333333333334,101.38333129882812,168.66666666666666L101.38333129882812,175" id="L-c2-m1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c2 LE-m1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M234.26666259765625,69.3510953895264L246.58055114746094,74.29257949127201C258.8944396972656,79.23406359301761,283.522216796875,89.1170317965088,295.8361053466797,100.39184923158773C308.1499938964844,111.66666666666667,308.1499938964844,124.33333333333333,308.1499938964844,137C308.1499938964844,149.66666666666666,308.1499938964844,162.33333333333334,308.1499938964844,168.66666666666666L308.1499938964844,175" id="L-c2-m2-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c2 LE-m2" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M677.189923967634,74L672.8374361310687,78.16666666666667C668.4849482945034,82.33333333333333,659.7799726213728,90.66666666666667,655.4274847848075,101.16666666666667C651.0749969482422,111.66666666666667,651.0749969482422,124.33333333333333,651.0749969482422,144.75C651.0749969482422,165.16666666666666,651.0749969482422,193.33333333333334,651.0749969482422,223.66666666666666C651.0749969482422,254,651.0749969482422,286.5,651.0749969482422,311.25C651.0749969482422,336,651.0749969482422,353,651.0749969482422,361.5L651.0749969482422,370" id="L-c1-l-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c1 LE-l" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M766.1333312988281,370L766.1333312988281,361.5C766.1333312988281,353,766.1333312988281,336,766.1333312988281,311.25C766.1333312988281,286.5,766.1333312988281,254,766.1333312988281,223.66666666666666C766.1333312988281,193.33333333333334,766.1333312988281,165.16666666666666,766.1333312988281,144.75C766.1333312988281,124.33333333333333,766.1333312988281,111.66666666666667,759.949341630761,101.16666666666667C753.7653519626939,90.66666666666667,741.3973726265598,82.33333333333333,735.2133829584926,78.16666666666667L729.0293932904254,74" id="L-l-c1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-l LE-c1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(101.38333129882812, 319)"> 
      <g class="label" transform="translate(-93.38333129882812, -26)"> 
       <foreignobject width="186.76666259765625" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">1<br>multiplication=host1:8080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(308.1499938964844, 319)"> 
      <g class="label" transform="translate(-93.38333129882812, -26)"> 
       <foreignobject width="186.76666259765625" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">1<br>multiplication=host2:9080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(509.36666107177734, 319)"> 
      <g class="label" transform="translate(-87.83333587646484, -26)"> 
       <foreignobject width="175.6666717529297" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">1<br>gamification=host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(101.38333129882812, 137)"> 
      <g class="label" transform="translate(-4.1916656494140625, -13)"> 
       <foreignobject width="8.383331298828125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">3</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(651.0749969482422, 221.5)"> 
      <g class="label" transform="translate(-53.150001525878906, -26)"> 
       <foreignobject width="106.30000305175781" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">2<br>multiplication?</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(766.1333312988281, 221.5)"> 
      <g class="label" transform="translate(-41.90833282470703, -39)"> 
       <foreignobject width="83.81666564941406" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">2<br>host1:8080,<br>host2:9080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-c1-4904" transform="translate(698.6041641235352, 53.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-39.5" y="-20.5" width="79" height="41"></rect> 
      <g class="label" style="" transform="translate(-32, -13)"> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务发现</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c2-4905" transform="translate(194.76666259765625, 53.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-39.5" y="-20.5" width="79" height="41"></rect> 
      <g class="label" style="" transform="translate(-32, -13)"> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">负载均衡</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-r-4903" transform="translate(509.36666107177734, 415.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-20.5" width="95" height="41"></rect> 
      <g class="label" style="" transform="translate(-40, -13)"> 
       <foreignobject width="80" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册表</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m1-4910" transform="translate(101.38333129882812, 221.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-46.5" width="113.5" height="93"></rect> 
      <g class="label" style="" transform="translate(-49.25, -39)"> 
       <foreignobject width="98.5" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Multiplication<br>host1:8080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m2-4911" transform="translate(308.1499938964844, 221.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-46.5" width="113.5" height="93"></rect> 
      <g class="label" style="" transform="translate(-49.25, -39)"> 
       <foreignobject width="98.5" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Multiplication<br>host2:9080</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g1-4912" transform="translate(509.36666107177734, 221.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-46.5" width="107.11666870117188" height="93"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -39)"> 
       <foreignobject width="92.11666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册者<br>Gamification<br>host1:8081</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>通常，在微服务架构中，会看到两种方法结合在一起使用，或者仅使用服务器端发现。当API客户端位于系统之外时，客户端发现机制无法正常工作，因为不应该要求外部客户端与服务注册表进行交互并自行进行负载均衡。一般由网关承担此职责，因此，API网关将连接的服务注册表，并包含一个负载均衡器，用于在实例之间分配负载。<br> 对后端内部的其他任何服务到服务通信，可将它们全部都连接到注册表进行客户端发现，也可以使用负载均衡器将每个服务集群抽象为唯一地址。后者是诸如Kubernetes的一些平台中选择的技术，该平台中，每个服务都被分配一个唯一的地址，而不管有多少副本，也不管它们位于哪个节点。<br> 微服务没有相互调用，就可用简单实现客户端发现。Spring Boot具有连接到服务注册表并实现负载均衡的集成。<br> 到后端的任何非内部HTTP通信都将使用服务器端发现方法，这意味着网关不仅会路由流量，还会负载均衡。如图所示。</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-9xO1i3xVum4cDV3a" width="738.6583251953125" xmlns="http://www.w3.org/2000/svg" height="1291" viewbox="0 0 738.6583251953125 1291" class="mermaid-svg"> 
  <style>#mermaid-svg-9xO1i3xVum4cDV3a {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-9xO1i3xVum4cDV3a .error-icon{fill:#552222;}#mermaid-svg-9xO1i3xVum4cDV3a .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-9xO1i3xVum4cDV3a .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-9xO1i3xVum4cDV3a .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-9xO1i3xVum4cDV3a .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-9xO1i3xVum4cDV3a .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-9xO1i3xVum4cDV3a .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-9xO1i3xVum4cDV3a .marker{fill:#333333;stroke:#333333;}#mermaid-svg-9xO1i3xVum4cDV3a .marker.cross{stroke:#333333;}#mermaid-svg-9xO1i3xVum4cDV3a svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-9xO1i3xVum4cDV3a .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-9xO1i3xVum4cDV3a .cluster-label text{fill:#333;}#mermaid-svg-9xO1i3xVum4cDV3a .cluster-label span{color:#333;}#mermaid-svg-9xO1i3xVum4cDV3a .label text,#mermaid-svg-9xO1i3xVum4cDV3a span{fill:#333;color:#333;}#mermaid-svg-9xO1i3xVum4cDV3a .node rect,#mermaid-svg-9xO1i3xVum4cDV3a .node circle,#mermaid-svg-9xO1i3xVum4cDV3a .node ellipse,#mermaid-svg-9xO1i3xVum4cDV3a .node polygon,#mermaid-svg-9xO1i3xVum4cDV3a .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-9xO1i3xVum4cDV3a .node .label{text-align:center;}#mermaid-svg-9xO1i3xVum4cDV3a .node.clickable{cursor:pointer;}#mermaid-svg-9xO1i3xVum4cDV3a .arrowheadPath{fill:#333333;}#mermaid-svg-9xO1i3xVum4cDV3a .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-9xO1i3xVum4cDV3a .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-9xO1i3xVum4cDV3a .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-9xO1i3xVum4cDV3a .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-9xO1i3xVum4cDV3a .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-9xO1i3xVum4cDV3a .cluster text{fill:#333;}#mermaid-svg-9xO1i3xVum4cDV3a .cluster span{color:#333;}#mermaid-svg-9xO1i3xVum4cDV3a div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-9xO1i3xVum4cDV3a :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"> 
     <g class="cluster default" id="g"> 
      <rect style="" rx="0" ry="0" x="69.46666717529297" y="953" width="439.924991607666" height="91"></rect> 
      <g class="cluster-label" transform="translate(243.37082862854004, 958)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="m"> 
      <rect style="" rx="0" ry="0" x="214.8541603088379" y="448" width="515.8041687011719" height="169"></rect> 
      <g class="cluster-label" transform="translate(423.5062446594238, 453)"> 
       <foreignobject width="98.5" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Multiplication</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="c"> 
      <rect style="" rx="0" ry="0" x="8" y="177" width="529.0500183105469" height="169"></rect> 
      <g class="cluster-label" transform="translate(256.52500915527344, 182)"> 
       <foreignobject width="32" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">网关</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="edgePaths"> 
     <path d="M286.9833297729492,734.5L286.8999964396159,742.9166666666666C286.81666310628253,751.3333333333334,286.6499964396159,768.1666666666666,286.56666310628253,785.0833333333334C286.4833297729492,802,286.4833297729492,819,286.4833297729492,827.5L286.4833297729492,836" id="L-t-q-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-t LE-q" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M88.44999694824219,309.1347324460634L81.70833079020183,315.2789437050529C74.96666463216145,321.4231549640423,61.48333231608073,333.71157748202114,54.74166615804037,348.3557887410106C48,363,48,380,48,397C48,414,48,431,48,453.5833333333333C48,476.1666666666667,48,504.3333333333333,48,532.5C48,560.6666666666666,48,588.8333333333334,48,607.0833333333334C48,625.3333333333334,48,633.6666666666666,48,647.5833333333334C48,661.5,48,681,48,704.8333333333334C48,728.6666666666666,48,756.8333333333334,48,785C48,813.1666666666666,48,841.3333333333334,48,865.1666666666666C48,889,48,908.5,48,922.4166666666666C48,936.3333333333334,48,944.6666666666666,48,956.4166666666666C48,968.1666666666666,48,983.3333333333334,48,998.5C48,1013.6666666666666,48,1028.8333333333333,48,1044.9166666666667C48,1061,48,1078,83.93402671813965,1102.2811486158237C119.8680534362793,1126.5622972316476,191.7361068725586,1158.124594463295,227.67013359069824,1173.9057430791186L263.6041603088379,1189.6868916949422" id="L-c1-l-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-c1 LE-l" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M140.71666717529297,49L140.71666717529297,59.666666666666664C140.71666717529297,70.33333333333333,140.71666717529297,91.66666666666667,140.71666717529297,113C140.71666717529297,134.33333333333334,140.71666717529297,155.66666666666666,140.71666717529297,166.33333333333334L140.71666717529297,177" id="L-b-c-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b LE-c" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M320.1041603088379,346L320.1041603088379,354.5C320.1041603088379,363,320.1041603088379,380,320.1041603088379,397C320.1041603088379,414,320.1041603088379,431,320.1041603088379,439.5L320.1041603088379,448" id="L-c-m-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c LE-m" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M130.71666717529297,346L130.71666717529297,354.5C130.71666717529297,363,130.71666717529297,380,130.71666717529297,397C130.71666717529297,414,130.71666717529297,431,130.71666717529297,453.5833333333333C130.71666717529297,476.1666666666667,130.71666717529297,504.3333333333333,130.71666717529297,532.5C130.71666717529297,560.6666666666666,130.71666717529297,588.8333333333334,130.71666717529297,607.0833333333334C130.71666717529297,625.3333333333334,130.71666717529297,633.6666666666666,130.71666717529297,647.5833333333334C130.71666717529297,661.5,130.71666717529297,681,130.71666717529297,704.8333333333334C130.71666717529297,728.6666666666666,130.71666717529297,756.8333333333334,130.71666717529297,785C130.71666717529297,813.1666666666666,130.71666717529297,841.3333333333334,130.71666717529297,865.1666666666666C130.71666717529297,889,130.71666717529297,908.5,130.71666717529297,922.4166666666666C130.71666717529297,936.3333333333334,130.71666717529297,944.6666666666666,130.71666717529297,948.8333333333334L130.71666717529297,953" id="L-c-g-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c LE-g" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M290.3333320617676,617L289.69166501363117,621.1666666666666C289.0499979654948,625.3333333333334,287.766663869222,633.6666666666666,287.20833015441895,642.0833333333334C286.6499964396159,650.5,286.81666310628253,659,286.8999964396159,663.25L286.9833297729492,667.5" id="L-m-t-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m LE-t" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M286.4833297729492,903L286.4833297729492,907.1666666666666C286.4833297729492,911.3333333333334,286.4833297729492,919.6666666666666,286.4833297729492,928C286.4833297729492,936.3333333333334,286.4833297729492,944.6666666666666,286.4833297729492,948.8333333333334L286.4833297729492,953" id="L-q-g-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-q LE-g" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M194.8541603088379,346L194.8541603088379,354.5C194.8541603088379,363,194.8541603088379,380,194.8541603088379,397C194.8541603088379,414,194.8541603088379,431,194.8541603088379,453.5833333333333C194.8541603088379,476.1666666666667,194.8541603088379,504.3333333333333,194.8541603088379,532.5C194.8541603088379,560.6666666666666,194.8541603088379,588.8333333333334,228.9312432607015,607.0833333333334C263.0083262125651,625.3333333333334,331.1624921162923,633.6666666666666,365.23957506815594,647.5833333333334C399.31665802001953,661.5,399.31665802001953,681,399.31665802001953,704.8333333333334C399.31665802001953,728.6666666666666,399.31665802001953,756.8333333333334,399.31665802001953,785C399.31665802001953,813.1666666666666,399.31665802001953,841.3333333333334,399.31665802001953,865.1666666666666C399.31665802001953,889,399.31665802001953,908.5,399.31665802001953,922.4166666666666C399.31665802001953,936.3333333333334,399.31665802001953,944.6666666666666,381.69790840148926,954.0656291291652C364.079158782959,963.4645915916639,328.84165954589844,973.9291831833278,311.22290992736816,979.1614789791597L293.6041603088379,984.3937747749917" id="L-c-g1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-c LE-g1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M246.1041603088379,1019L246.1041603088379,1023.1666666666666C246.1041603088379,1027.3333333333333,246.1041603088379,1035.6666666666667,246.1041603088379,1048.3333333333333C246.1041603088379,1061,246.1041603088379,1078,251.3677586351977,1095C256.6313569615575,1112,267.1585536142772,1129,272.42215194063704,1137.5L277.6857502669969,1146" id="L-g1-l-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-g1 LE-l" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M367.6041603088379,550.4757040919386L396.9020767211914,561.5630867432822C426.1999931335449,572.6504693946257,484.79582595825195,594.8252346973128,514.0937423706055,610.0792840153231C543.391658782959,625.3333333333334,543.391658782959,633.6666666666666,543.391658782959,647.5833333333334C543.391658782959,661.5,543.391658782959,681,543.391658782959,704.8333333333334C543.391658782959,728.6666666666666,543.391658782959,756.8333333333334,543.391658782959,785C543.391658782959,813.1666666666666,543.391658782959,841.3333333333334,543.391658782959,865.1666666666666C543.391658782959,889,543.391658782959,908.5,543.391658782959,922.4166666666666C543.391658782959,936.3333333333334,543.391658782959,944.6666666666666,543.391658782959,956.4166666666666C543.391658782959,968.1666666666666,543.391658782959,983.3333333333334,543.391658782959,998.5C543.391658782959,1013.6666666666666,543.391658782959,1028.8333333333333,543.391658782959,1044.9166666666667C543.391658782959,1061,543.391658782959,1078,515.5937423706055,1101.3770129719612C487.79582595825195,1124.7540259439222,432.1999931335449,1154.5080518878444,404.4020767211914,1169.3850648598057L376.6041603088379,1184.2620778317666" id="L-m1-l-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m1 LE-l" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M643.391658782959,592L643.391658782959,596.1666666666666C643.391658782959,600.3333333333334,643.391658782959,608.6666666666666,643.391658782959,617C643.391658782959,625.3333333333334,643.391658782959,633.6666666666666,643.391658782959,647.5833333333334C643.391658782959,661.5,643.391658782959,681,643.391658782959,704.8333333333334C643.391658782959,728.6666666666666,643.391658782959,756.8333333333334,643.391658782959,785C643.391658782959,813.1666666666666,643.391658782959,841.3333333333334,643.391658782959,865.1666666666666C643.391658782959,889,643.391658782959,908.5,643.391658782959,922.4166666666666C643.391658782959,936.3333333333334,643.391658782959,944.6666666666666,643.391658782959,956.4166666666666C643.391658782959,968.1666666666666,643.391658782959,983.3333333333334,643.391658782959,998.5C643.391658782959,1013.6666666666666,643.391658782959,1028.8333333333333,643.391658782959,1044.9166666666667C643.391658782959,1061,643.391658782959,1078,598.9270757039388,1102.9358897359846C554.4624926249186,1127.871779471969,465.53332646687824,1160.743558943938,421.0687433878581,1177.1794486799224L376.6041603088379,1193.615338415907" id="L-m2-l-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m2 LE-l" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M464.75901525824736,592L463.656122512366,596.1666666666666C462.55322976648455,600.3333333333334,460.3474442747218,608.6666666666666,459.2445515288404,617C458.141658782959,625.3333333333334,458.141658782959,633.6666666666666,458.141658782959,647.5833333333334C458.141658782959,661.5,458.141658782959,681,458.141658782959,704.8333333333334C458.141658782959,728.6666666666666,458.141658782959,756.8333333333334,458.141658782959,785C458.141658782959,813.1666666666666,458.141658782959,841.3333333333334,458.141658782959,865.1666666666666C458.141658782959,889,458.141658782959,908.5,458.141658782959,922.4166666666666C458.141658782959,936.3333333333334,458.141658782959,944.6666666666666,458.141658782959,948.8333333333334L458.141658782959,953" id="L-m3-g-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m3 LE-g" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(48, 785)"> 
      <g class="label" transform="translate(-32, -13)"> 
       <foreignobject width="64" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">查找服务</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(140.71666717529297, 113)"> 
      <g class="label" transform="translate(-50.93333435058594, -39)"> 
       <foreignobject width="101.86666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名<br>-获取排行榜</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(320.1041603088379, 397)"> 
      <g class="label" transform="translate(-50.93333435058594, -26)"> 
       <foreignobject width="101.86666870117188" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(130.71666717529297, 700.5)"> 
      <g class="label" transform="translate(-42.93333435058594, -13)"> 
       <foreignobject width="85.86666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(246.1041603088379, 1095)"> 
      <g class="label" transform="translate(-48, -26)"> 
       <foreignobject width="96" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">注册表自身<br>（每个实例）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(543.391658782959, 869.5)"> 
      <g class="label" transform="translate(-48, -26)"> 
       <foreignobject width="96" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">注册表自身<br>（每个实例）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(643.391658782959, 869.5)"> 
      <g class="label" transform="translate(-32, -26)"> 
       <foreignobject width="64" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">查找服务<br>实例</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(458.141658782959, 785)"> 
      <g class="label" transform="translate(-34.974998474121094, -26)"> 
       <foreignobject width="69.94999694824219" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">HTTP请求<br>（假设）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-g1-4964" transform="translate(246.1041603088379, 998.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-20.5" width="95" height="41"></rect> 
      <g class="label" style="" transform="translate(-40, -13)"> 
       <foreignobject width="80" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">注册服务者</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m1-4961" transform="translate(320.1041603088379, 532.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-20.5" width="95" height="41"></rect> 
      <g class="label" style="" transform="translate(-40, -13)"> 
       <foreignobject width="80" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">注册服务者</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m2-4962" transform="translate(643.391658782959, 532.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-59.5" width="104.53334045410156" height="119"></rect> 
      <g class="label" style="" transform="translate(-44.76667022705078, -52)"> 
       <foreignobject width="89.53334045410156" height="104"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务发现<br>客户端<br>Spring Cloud<br>Consul发现</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m3-4963" transform="translate(480.5083236694336, 532.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-55.5" y="-59.5" width="111" height="119"></rect> 
      <g class="label" style="" transform="translate(-48, -52)"> 
       <foreignobject width="96" height="104"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">负载均衡器<br>Spring Cloud<br>负载均衡器<br>（如有必要）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c1-4956" transform="translate(140.71666717529297, 261.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-59.5" width="104.53334045410156" height="119"></rect> 
      <g class="label" style="" transform="translate(-44.76667022705078, -52)"> 
       <foreignobject width="89.53334045410156" height="104"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务发现<br>客户端<br>Spring Cloud<br>Consul发现</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c2-4957" transform="translate(295.25000762939453, 261.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-46.5" width="104.53334045410156" height="93"></rect> 
      <g class="label" style="" transform="translate(-44.76667022705078, -39)"> 
       <foreignobject width="89.53334045410156" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">负载均衡器<br>Spring Cloud<br>负载均衡器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-c3-4958" transform="translate(449.7833480834961, 261.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-46.5" width="104.53334045410156" height="93"></rect> 
      <g class="label" style="" transform="translate(-44.76667022705078, -39)"> 
       <foreignobject width="89.53334045410156" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">路由器<br>Spring Cloud<br>网关</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="root" transform="translate(256.1041603088379, 1138)"> 
      <g class="clusters"> 
       <g class="cluster default" id="l"> 
        <rect style="" rx="0" ry="0" x="8" y="8" width="113" height="137"></rect> 
        <g class="cluster-label" transform="translate(24.5, 13)"> 
         <foreignobject width="80" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">服务注册表</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="edgePaths"></g> 
      <g class="edgeLabels"></g> 
      <g class="nodes"> 
       <g class="node default default" id="flowchart-r-4955" transform="translate(64.5, 76.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-33.5" width="63" height="67"></rect> 
        <g class="label" style="" transform="translate(-24, -26)"> 
         <foreignobject width="48" height="52"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">注册表<br>Consul</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b-4954" transform="translate(140.71666717529297, 28.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-20.5" width="63" height="41"></rect> 
      <g class="label" style="" transform="translate(-24, -13)"> 
       <foreignobject width="48" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">浏览器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-t-4971" transform="translate(286.4833297729492, 700.5)"> 
      <polygon points="-22.333333333333332,0 99.83333333333333,0 133.33333333333334,-67 11.166666666666666,-67" class="label-container" transform="translate(-55.5,33.5)" style=""></polygon> 
      <g class="label" style="" transform="translate(-48, -26)"> 
       <foreignobject width="96" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">尝试<br>（主题交换）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-q-4972" transform="translate(286.4833297729492, 869.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-33.5" width="107.11666870117188" height="67"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -26)"> 
       <foreignobject width="92.11666870117188" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification<br>队列</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h3><a id="Consul_499"></a>Consul</h3> 
<p>Consul、Eureka、Zookeeper等工具实现了服务发现模式，还有一些完整的平台将这种模式作为其功能。在Spring生态系统中，Netflix的Eureka长期以来一直是最受欢迎的选择，但是由于Netflix的原因，不再是好的选择。这里将所有Consul，该工具可以提供服务发现和其他功能，并通过Spring Cloud进行集成，方便使用。<br> 首先安装Consul，这里使用Docker下的Consul，来进行单节点部署。命令如下：</p> 
<pre><code class="prism language-bash"><span class="token function">docker</span> run <span class="token parameter variable">-id</span> <span class="token parameter variable">--name</span><span class="token operator">=</span>consul <span class="token parameter variable">-p</span> <span class="token number">8300</span>:8300 <span class="token parameter variable">-p</span> <span class="token number">8301</span>:8301 <span class="token parameter variable">-p</span> <span class="token number">8302</span>:8302 <span class="token parameter variable">-p</span> <span class="token number">8500</span>:8500 <span class="token parameter variable">-p</span> <span class="token number">8600</span>:8600 consul agent <span class="token parameter variable">-server</span> <span class="token parameter variable">-ui</span> <span class="token parameter variable">-node</span><span class="token operator">=</span>n1 -bootstrap-expect<span class="token operator">=</span><span class="token number">1</span> <span class="token parameter variable">-client</span><span class="token operator">=</span><span class="token number">0.0</span>.0.0
</code></pre> 
<p>这里暴露了几个端口，它们的作用如下：</p> 
<ul><li>8300 TCP协议，用于Consul集群中各个节点相互连结通信的端口</li><li>8301 TCP或者UDP协议，用于Consul节点之间相互使用Gossip协议健康检查等交互</li><li>8302 TCP或者UDP协议，用于单个或多个数据中心之间的服务器节点的信息同步</li><li>8500 HTTP协议，用于API接口或者我们上述的网页管理界面访问</li><li>8600 TCP或者UDP协议，作为DNS服务器，用于通过节点名查询节点信息</li></ul> 
<p>在Spring Cloud模块集成Consul服务发现时，需要配置8500端口。除此之外，还有几个参数：</p> 
<ul><li>agent 表示启动一个Agent进程</li><li>server 表示该节点类型为Server节点（下面会讲解集群中的节点类型）</li><li>ui 开启网页可视化管理界面</li><li>node 指定该节点名称，注意每个节点的名称必须唯一不能重复！上面指定了第一台服务器节点的名称为n1，那么别的节点就得用其它名称</li><li>bootstrap-expect 最少集群的Server节点数量，少于这个值则集群失效，这个选项必须指定，由于这里是单机部署，因此设定为1即可</li><li>advertise 这里要指定本节点外网地址，用于在集群时告诉其它节点自己的地址，如果是在自己电脑上或者是内网搭建单节点/集群则不需要带上这个参数</li><li>client 指定可以外部连接的地址，0.0.0.0表示外网全部可以连接</li></ul> 
<p>安装后，打开控制台日志，可以看到如下信息：</p> 
<pre><code class="prism language-bash"><span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36 <span class="token operator">==</span><span class="token operator">&gt;</span> Starting Consul agent<span class="token punctuation">..</span>.
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36            Version: <span class="token string">'1.11.1'</span>
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36            Node ID: <span class="token string">'ecf41197-fa98-7cc6-a2c3-295ad75c7efd'</span>
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36          Node name: <span class="token string">'n1'</span>
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36         Datacenter: <span class="token string">'dc1'</span> <span class="token punctuation">(</span>Segment: <span class="token string">'&lt;all&gt;'</span><span class="token punctuation">)</span>
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36             Server: <span class="token boolean">true</span> <span class="token punctuation">(</span>Bootstrap: <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36        Client Addr: <span class="token punctuation">[</span><span class="token number">0.0</span>.0.0<span class="token punctuation">]</span> <span class="token punctuation">(</span>HTTP: <span class="token number">8500</span>, HTTPS: -1, gRPC: -1, DNS: <span class="token number">8600</span><span class="token punctuation">)</span>
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36       Cluster Addr: <span class="token number">172.17</span>.0.4 <span class="token punctuation">(</span>LAN: <span class="token number">8301</span>, WAN: <span class="token number">8302</span><span class="token punctuation">)</span>
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36            Encrypt: Gossip: false, TLS-Outgoing: false, TLS-Incoming: false, Auto-Encrypt-TLS: <span class="token boolean">false</span>
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36 
<span class="token number">2023</span>-12-15 <span class="token number">11</span>:57:36 <span class="token operator">==</span><span class="token operator">&gt;</span> Log data will now stream <span class="token keyword">in</span> as it occurs:
<span class="token punctuation">..</span>.
</code></pre> 
<p>日志显示一些有关服务器的信息和启动操作，这里采用本地代理，实际的生产设置是由多个数据中心的集群组成。这些数据中心可运行一个或多个代理，其中每个服务器中只有一个代理可以充当服务器代理。代理之间使用协议进行通信以同步信息并通过共识选举领导者，这些设置确保高可用性。如果数据中心无法访问，代理会知道并选举出新的领导者。<br> Consul在端口8500上运行HTTP服务，提供RESTful API，用于服务注册和发现以及其他功能，还提供一个用户界面，通过http://localhost:8500来访问，如下图所示：<br> <img src="https://images2.imgbox.com/a9/88/kpBLGr0e_o.png" alt="Consul UI">Service部分显示已注册服务列表，因为还没有进行任何操作，唯一可用的服务是Consul服务器。其他选项卡可显示可用的节点、键/值、Intention、ACL等功能。<br> 还可用通过REST API来访问可用服务列表，例如HTTPie就可以请求可用服务列表，会输出一个空的响应体，如下所示：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> http <span class="token parameter variable">-b</span> :8500/v1/agent/services
<span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
</code></pre> 
<p>通过Service API，可列出服务，查询服务信息，了解服务是否正常运行，对服务进行注册和注销。这里不会直接使用这些API，因为Spring Cloud Consul模块会自动完成这些操作。<br> Consul包括用于验证所有服务状态的功能：运行状况检查功能。它提供了多种可用于确定运行状况的选项：HTTP、TCP、脚本等。这里，计划让Consul通过HTTP接口（具体地说是/actuator/health端点）联系微服务。运行状况检查位置是在服务注册时配置的，Consul会定期触发一次（也可以自定义）。如果服务无法响应或状态为非正常（2XX除外），则Consul会将其标记为不正常。</p> 
<h3><a id="Spring_Cloud_Consul_546"></a>Spring Cloud Consul</h3> 
<p>不需要使用Consul API来注册服务、定义运行状况检查或访问注册表来查找服务地址，这些功能由Spring Cloud Consul提供，因此，在Spring Boot应用程序中包含对应的启动器，并进行一些配置即可。<br> 首先，在Gateway项目中添加Spring Cloud Consul 发现依赖项，如下所示：</p> 
<pre><code class="prism language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>接着，对另外两个微服务Multiplication和Gamification依次添加Spring Cloud和spring-cloud-starter-consul-discovery依赖项，如下所示：</p> 
<pre><code class="prism language-xml">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- ... --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- ... --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spring-cloud.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>type</span><span class="token punctuation">&gt;</span></span>pom<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>type</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>import<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencyManagement</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>Consul自带的Spring Boot默认自动配置符合现在的情况：服务器位于http://localhost:8500。如果要查看这些默认设置，可以查看ConsulProperties的源代码，如下所示：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@ConfigurationProperties</span><span class="token punctuation">(</span><span class="token constant">PREFIX</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Validated</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConsulProperties</span> <span class="token punctuation">{<!-- --></span>

	<span class="token comment">/**
	 * Prefix for configuration properties.
	 */</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">String</span> <span class="token constant">PREFIX</span> <span class="token operator">=</span> <span class="token string">"spring.cloud.consul"</span><span class="token punctuation">;</span>

	<span class="token comment">/** Consul agent hostname. Defaults to 'localhost'. */</span>
	<span class="token annotation punctuation">@NotNull</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> host <span class="token operator">=</span> <span class="token string">"localhost"</span><span class="token punctuation">;</span>

	<span class="token comment">/**
	 * Consul agent scheme (HTTP/HTTPS). If there is no scheme in address - client will
	 * use HTTP.
	 */</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> scheme<span class="token punctuation">;</span>

	<span class="token comment">/** Consul agent port. Defaults to '8500'. */</span>
	<span class="token annotation punctuation">@NotNull</span>
	<span class="token keyword">private</span> <span class="token keyword">int</span> port <span class="token operator">=</span> <span class="token number">8500</span><span class="token punctuation">;</span>

	<span class="token comment">/** Is spring cloud consul enabled. */</span>
	<span class="token keyword">private</span> <span class="token keyword">boolean</span> enabled <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

	<span class="token comment">/** Configuration for TLS. */</span>
	<span class="token keyword">private</span> <span class="token class-name">TLSConfig</span> tls<span class="token punctuation">;</span>

	<span class="token comment">/** Custom path if consul is under non-root. */</span>
	<span class="token keyword">private</span> <span class="token class-name">String</span> path<span class="token punctuation">;</span>
	
  <span class="token comment">//...</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果需要改变，使用前缀spring.cloud.consul的相关属性即可。<br> 现在，需要在应用程序中添加一个新的配置：spring.application.name，以指定应用程序的名称。将这个属性添加到所有微服务的配置中，如下所示：</p> 
<pre><code class="prism language-properties">spring.application.name=multiplication
</code></pre> 
<p>在Multiplication中设置为multiplication，Gamification中设置为gamification，Gateway中设置为gateway。<br> 启动微服务Multiplication和Gamification，来看看它们如何通过运行状况检查进行注册的。注意，要启动RabbitMQ和Consul服务器。查看Gamification运行日志，可以找到如下行：</p> 
<pre><code class="prism language-java"><span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">21</span><span class="token constant">T17</span><span class="token operator">:</span><span class="token number">42</span><span class="token operator">:</span><span class="token number">38.706</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">5012</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>gamification<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>c<span class="token punctuation">.</span>s<span class="token punctuation">.</span></span>ConsulServiceRegistry</span>          <span class="token operator">:</span> <span class="token class-name">Registering</span> service <span class="token keyword">with</span> <span class="token namespace">consul</span><span class="token operator">:</span> <span class="token class-name">NewService</span><span class="token punctuation">{<!-- --></span>id<span class="token operator">=</span>'gamification<span class="token operator">-</span><span class="token number">8081</span>'<span class="token punctuation">,</span> name<span class="token operator">=</span>'gamification'<span class="token punctuation">,</span> tags<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> address<span class="token operator">=</span>'host<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>internal'<span class="token punctuation">,</span> meta<span class="token operator">=</span><span class="token punctuation">{<!-- --></span>secure<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8081</span><span class="token punctuation">,</span> enableTagOverride<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> check<span class="token operator">=</span><span class="token class-name">Check</span><span class="token punctuation">{<!-- --></span>script<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> dockerContainerID<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> interval<span class="token operator">=</span><span class="token char">'10s'</span><span class="token punctuation">,</span> ttl<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> http<span class="token operator">=</span>'http<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>host<span class="token punctuation">.</span>docker<span class="token punctuation">.</span>internal<span class="token operator">:</span><span class="token number">8081</span><span class="token operator">/</span>actuator<span class="token operator">/</span>health'<span class="token punctuation">,</span> method<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> header<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span><span class="token punctuation">,</span> tcp<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> deregisterCriticalServiceAfter<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> tlsSkipVerify<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">,</span> status<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> grpc<span class="token operator">=</span><span class="token char">'null'</span><span class="token punctuation">,</span> grpcUseTLS<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">}</span><span class="token punctuation">,</span> checks<span class="token operator">=</span><span class="token keyword">null</span><span class="token punctuation">}</span>
</code></pre> 
<p>这行提示表明了应用程序启动时通过Spring Cloud Consul进行了服务注册。可以看到请求的内容：由服务名和端口组成的id、可以对多个实例进行分组的服务名称、本地地址，以及通过HTTP对Spring Boot Actuator公开的服务运行状况端点地址进行配置的状态检查，时间间隔为10秒。<br> 在Consul服务器端，可以看到如下输出：</p> 
<pre><code class="prism language-bash"><span class="token number">2023</span>-12-21 <span class="token number">17</span>:41:24 <span class="token number">2023</span>-12-21T09:41:24.834Z <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>  agent: Synced service: <span class="token assign-left variable">service</span><span class="token operator">=</span>multiplication
<span class="token number">2023</span>-12-21 <span class="token number">17</span>:41:32 <span class="token number">2023</span>-12-21T09:41:32.373Z <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>  agent: Synced check: <span class="token assign-left variable">check</span><span class="token operator">=</span>service:multiplication
<span class="token number">2023</span>-12-21 <span class="token number">17</span>:42:38 <span class="token number">2023</span>-12-21T09:42:38.725Z <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>  agent: Synced service: <span class="token assign-left variable">service</span><span class="token operator">=</span>gamification-8081
<span class="token number">2023</span>-12-21 <span class="token number">17</span>:42:40 <span class="token number">2023</span>-12-21T09:42:40.883Z <span class="token punctuation">[</span>INFO<span class="token punctuation">]</span>  agent: Synced check: <span class="token assign-left variable">check</span><span class="token operator">=</span>service:gamification-8081
</code></pre> 
<p>使用Consul浏览器界面访问，结果如下图所示：<br> <img src="https://images2.imgbox.com/4e/af/C8hoZ0kW_o.png" alt="UI"><br> 在Services列表中，单击gamification，显示其详细信息，可以看到该服务的运行状况，如图所示：<br> <img src="https://images2.imgbox.com/55/87/wA1nfv7o_o.png" alt="gamification"><br> 单击服务的各种检查项，可以看到更详细的检查结果，例如点击“All service checks passing”，如图所示：<br> <img src="https://images2.imgbox.com/db/44/dPMrPyjF_o.png" alt="check"><br> 还可以启动第二个服务实例，以查看注册表如何对其进行处理，命令行如下所示：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> ./mvnw spring-boot:run -D<span class="token string">"spring-boot.run.arguments"</span><span class="token operator">=</span><span class="token string">"--server.port=9080"</span> 
</code></pre> 
<p>在Consul注册表中，仍然只有一个multiplication服务，但显示有2个实例，如图所示：<br> <img src="https://images2.imgbox.com/f3/95/3xQMhlry_o.png" alt="2"><br> 当点击multiplication服务时，导航到Instances选项卡，就可以看到有2个实例了，如图所示：<br> <img src="https://images2.imgbox.com/6d/07/0dBnVwAQ_o.png" alt="Instances"><br> 每个实例都有对应的运行状况检查。<br> 从Consul获取服务列表的API请求检索这些服务，响应如下所示：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> http <span class="token parameter variable">-b</span> :8500/v1/agent/services
<span class="token punctuation">{<!-- --></span>
    <span class="token string">"gamification-8081"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Address"</span><span class="token builtin class-name">:</span> <span class="token string">"host.docker.internal"</span>,
        <span class="token string">"Datacenter"</span><span class="token builtin class-name">:</span> <span class="token string">"dc1"</span>,
        <span class="token string">"EnableTagOverride"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"ID"</span><span class="token builtin class-name">:</span> <span class="token string">"gamification-8081"</span>,
        <span class="token string">"Meta"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"secure"</span><span class="token builtin class-name">:</span> <span class="token string">"false"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Port"</span><span class="token builtin class-name">:</span> <span class="token number">8081</span>,
        <span class="token string">"Service"</span><span class="token builtin class-name">:</span> <span class="token string">"gamification"</span>,
        <span class="token string">"Tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"Weights"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Passing"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
            <span class="token string">"Warning"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">"multiplication"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Address"</span><span class="token builtin class-name">:</span> <span class="token string">"host.docker.internal"</span>,
        <span class="token string">"Datacenter"</span><span class="token builtin class-name">:</span> <span class="token string">"dc1"</span>,
        <span class="token string">"EnableTagOverride"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"ID"</span><span class="token builtin class-name">:</span> <span class="token string">"multiplication"</span>,
        <span class="token string">"Meta"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"secure"</span><span class="token builtin class-name">:</span> <span class="token string">"false"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Port"</span><span class="token builtin class-name">:</span> <span class="token number">8080</span>,
        <span class="token string">"Service"</span><span class="token builtin class-name">:</span> <span class="token string">"multiplication"</span>,
        <span class="token string">"Tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"Weights"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Passing"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
            <span class="token string">"Warning"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>,
    <span class="token string">"multiplication-9080"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
        <span class="token string">"Address"</span><span class="token builtin class-name">:</span> <span class="token string">"host.docker.internal"</span>,
        <span class="token string">"Datacenter"</span><span class="token builtin class-name">:</span> <span class="token string">"dc1"</span>,
        <span class="token string">"EnableTagOverride"</span><span class="token builtin class-name">:</span> false,
        <span class="token string">"ID"</span><span class="token builtin class-name">:</span> <span class="token string">"multiplication-9080"</span>,
        <span class="token string">"Meta"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"secure"</span><span class="token builtin class-name">:</span> <span class="token string">"false"</span>
        <span class="token punctuation">}</span>,
        <span class="token string">"Port"</span><span class="token builtin class-name">:</span> <span class="token number">9080</span>,
        <span class="token string">"Service"</span><span class="token builtin class-name">:</span> <span class="token string">"multiplication"</span>,
        <span class="token string">"Tags"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>,
        <span class="token string">"Weights"</span><span class="token builtin class-name">:</span> <span class="token punctuation">{<!-- --></span>
            <span class="token string">"Passing"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>,
            <span class="token string">"Warning"</span><span class="token builtin class-name">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>如果没有Spring抽象，会如何使用Consul服务呢？首先，所有服务只有知道HTTP主机和端口才能找到注册表；然后，如果要与Gamification API进行交互，要所有Consul的Service API来获取可用的实例列表，遵循客户端发现方法，会使用负载均衡从列表中选择一个正常的实例；然后，客户端服务知道了地址和请求的端口后，便可用执行请求。过程很繁琐，Spring Cloud Consul已经自动完成了，大大简化了操作。<br> 网关是系统中调用其他服务的服务，已经使用Consul实现了服务发现，那么，如何实现负载均衡呢？</p> 
<h3><a id="Spring_Cloud_703"></a>Spring Cloud负载均衡器</h3> 
<p>这里，实现一种客户端发现方法，其中后端服务查询注册表并确定如果有多个可用实例的话，应该调用哪个实例。Spring Cloud负载均衡器是Spring Cloud Commons的组件，与Consul和Eureka集成在一起，提供简单的负载均衡器实现，默认情况下，会自动配置能够迭代遍历所有实例的循环负载均衡器。<br> Netflix的Ribbon曾经是实现负载均衡器的首选，因为其处于维护模式，所以放弃该选项，选择Spring的负载均衡器实现。Spring Cloud负载均衡器包含在Spring Cloud Consul启动器依赖中。<br> 要在两个应用程序之间进行负载均衡的调用，可在创建RestTemplate对象时只使用@LoadBalanced注解，然后，在执行对该服务的请求时，将服务名称用作URL中的主机名，Spring Cloud Consul和负载均衡器将完成其余工作，查询注册表并按顺序选择一个实例。下面的代码表明了如何在客户端Multiplication微服务中集成服务发现和负载均衡：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestConfiguration</span> <span class="token punctuation">{<!-- --></span>
	<span class="token annotation punctuation">@LoadBalanced</span>
	<span class="token annotation punctuation">@Bean</span>
	<span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@Service</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GamificationServiceClient</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token class-name">GamificationServiceClient</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">RestTemplate</span> restTemplate<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>restTemplate <span class="token operator">=</span> restTemplate<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">sendAttempt</span><span class="token punctuation">(</span><span class="token keyword">final</span> <span class="token class-name">ChallengeAttempt</span> attempt<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token class-name">ChallengeSolvedDTO</span> dto <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChallengeSolvedDTO</span><span class="token punctuation">(</span>attempt<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				attempt<span class="token punctuation">.</span><span class="token function">isCorrect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attempt<span class="token punctuation">.</span><span class="token function">getFactorA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				attempt<span class="token punctuation">.</span><span class="token function">getFactorB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> attempt<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				attempt<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAlias</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token class-name">ResponseEntity</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> r <span class="token operator">=</span> restTemplate<span class="token punctuation">.</span><span class="token function">postForEntity</span><span class="token punctuation">(</span>
				<span class="token string">"http://gamification/attempts"</span><span class="token punctuation">,</span> dto<span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"Gamification service response: {}"</span><span class="token punctuation">,</span> r<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> r<span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">is2xxSuccessful</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"There was a problem sending the attempt."</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>因为已经去除了微服务之间的HTTP调用，这种方法就不适用了，但是，如果想要了解服务间HTTP交互情况，还是不错的。使用服务发现和负载均衡，可以减少失败的风险，因为这增加了至少有一个实例用于处理同步请求的机会。<br> 这里，计划在网关中集成服务发现和负载均衡，如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-7kAcNgWr1FMKJmmN" width="507.433349609375" xmlns="http://www.w3.org/2000/svg" height="1304.5042724609375" viewbox="0 0 507.433349609375 1304.5042724609375" class="mermaid-svg"> 
  <style>#mermaid-svg-7kAcNgWr1FMKJmmN {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-7kAcNgWr1FMKJmmN .error-icon{fill:#552222;}#mermaid-svg-7kAcNgWr1FMKJmmN .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-7kAcNgWr1FMKJmmN .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-7kAcNgWr1FMKJmmN .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-7kAcNgWr1FMKJmmN .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-7kAcNgWr1FMKJmmN .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-7kAcNgWr1FMKJmmN .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-7kAcNgWr1FMKJmmN .marker{fill:#333333;stroke:#333333;}#mermaid-svg-7kAcNgWr1FMKJmmN .marker.cross{stroke:#333333;}#mermaid-svg-7kAcNgWr1FMKJmmN svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-7kAcNgWr1FMKJmmN .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-7kAcNgWr1FMKJmmN .cluster-label text{fill:#333;}#mermaid-svg-7kAcNgWr1FMKJmmN .cluster-label span{color:#333;}#mermaid-svg-7kAcNgWr1FMKJmmN .label text,#mermaid-svg-7kAcNgWr1FMKJmmN span{fill:#333;color:#333;}#mermaid-svg-7kAcNgWr1FMKJmmN .node rect,#mermaid-svg-7kAcNgWr1FMKJmmN .node circle,#mermaid-svg-7kAcNgWr1FMKJmmN .node ellipse,#mermaid-svg-7kAcNgWr1FMKJmmN .node polygon,#mermaid-svg-7kAcNgWr1FMKJmmN .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-7kAcNgWr1FMKJmmN .node .label{text-align:center;}#mermaid-svg-7kAcNgWr1FMKJmmN .node.clickable{cursor:pointer;}#mermaid-svg-7kAcNgWr1FMKJmmN .arrowheadPath{fill:#333333;}#mermaid-svg-7kAcNgWr1FMKJmmN .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-7kAcNgWr1FMKJmmN .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-7kAcNgWr1FMKJmmN .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-7kAcNgWr1FMKJmmN .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-7kAcNgWr1FMKJmmN .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-7kAcNgWr1FMKJmmN .cluster text{fill:#333;}#mermaid-svg-7kAcNgWr1FMKJmmN .cluster span{color:#333;}#mermaid-svg-7kAcNgWr1FMKJmmN div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-7kAcNgWr1FMKJmmN :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"> 
     <g class="cluster default" id="ga"> 
      <rect style="" rx="0" ry="0" x="82.71666717529297" y="934.5043182373047" width="280.3666763305664" height="143"></rect> 
      <g class="cluster-label" transform="translate(176.84167098999023, 939.5043182373047)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="r"> 
      <rect style="" rx="0" ry="0" x="8" y="1179.5043182373047" width="211.98333740234375" height="117"></rect> 
      <g class="cluster-label" transform="translate(73.99166870117188, 1184.5043182373047)"> 
       <foreignobject width="80" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册表</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="cluster default" id="g"> 
      <rect style="" rx="0" ry="0" x="8" y="177" width="491.43335342407227" height="169"></rect> 
      <g class="cluster-label" transform="translate(237.71667671203613, 182)"> 
       <foreignobject width="32" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">网关</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="edgePaths"> 
     <path d="M73.63165748189893,321L71.56804790158243,325.1666666666667C69.50443832126595,329.3333333333333,65.37721916063298,337.6666666666667,63.31360958031649,350.3333333333333C61.25,363,61.25,380,61.25,410.5833333333333C61.25,441.1666666666667,61.25,485.3333333333333,61.25,525.1666666666666C61.25,565,61.25,600.5,61.25,625.8333333333334C61.25,651.1666666666666,61.25,666.3333333333334,61.25,685.8333333333334C61.25,705.3333333333334,61.25,729.1666666666666,61.25,756.2920265197754C61.25,783.4173863728842,61.25,813.8347727457682,61.25,839.918825785319C61.25,866.0028788248698,61.25,887.7535985310873,61.25,902.7956250508627C61.25,917.8376515706381,61.25,926.1709849039713,61.25,942.2543182373047C61.25,958.3376515706381,61.25,982.1709849039713,61.25,1006.0043182373047C61.25,1029.837651570638,61.25,1053.6709849039714,61.25,1074.087651570638C61.25,1094.5043182373047,61.25,1111.5043182373047,61.25,1128.5043182373047C61.25,1145.5043182373047,61.25,1162.5043182373047,64.23076939379048,1175.1709849039714C67.21153878758096,1187.837651570638,73.17307757516193,1196.1709849039714,76.15384696895241,1200.337651570638L79.13461636274289,1204.5043182373047" id="L-g1-r1-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-g1 LE-r1" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M309.950008392334,702.5000000000001L309.86667505900067,710.9166666666666C309.7833417256673,719.3333333333334,309.61667505900067,736.1666666666666,309.5333417256673,753.0833333333334C309.450008392334,770,309.450008392334,787,309.450008392334,795.5L309.450008392334,804" id="L-at1-q-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-at1 LE-q" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M103.10000228881836,49L103.10000228881836,59.666666666666664C103.10000228881836,70.33333333333333,103.10000228881836,91.66666666666667,103.10000228881836,113C103.10000228881836,134.33333333333334,103.10000228881836,155.66666666666666,103.10000228881836,166.33333333333334L103.10000228881836,177" id="L-b-g-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b LE-g" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M309.450008392334,346L309.450008392334,354.5C309.450008392334,363,309.450008392334,380,309.450008392334,397C309.450008392334,414,309.450008392334,431,309.450008392334,439.5L309.450008392334,448" id="L-g-m-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-m" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M146.35000228881836,346L146.35000228881836,354.5C146.35000228881836,363,146.35000228881836,380,146.35000228881836,410.5833333333333C146.35000228881836,441.1666666666667,146.35000228881836,485.3333333333333,146.35000228881836,525.1666666666666C146.35000228881836,565,146.35000228881836,600.5,146.35000228881836,625.8333333333334C146.35000228881836,651.1666666666666,146.35000228881836,666.3333333333334,146.35000228881836,685.8333333333334C146.35000228881836,705.3333333333334,146.35000228881836,729.1666666666666,146.35000228881836,756.2920265197754C146.35000228881836,783.4173863728842,146.35000228881836,813.8347727457682,146.35000228881836,839.918825785319C146.35000228881836,866.0028788248698,146.35000228881836,887.7535985310873,146.35000228881836,898.6289583841959L146.35000228881836,909.5043182373047" id="L-g-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M309.450008392334,611L309.450008392334,615.1666666666666C309.450008392334,619.3333333333334,309.450008392334,627.6666666666666,309.450008392334,636C309.450008392334,644.3333333333334,309.450008392334,652.6666666666666,309.450008392334,656.8333333333334L309.450008392334,661" id="L-m-at1-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m LE-at1" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M309.450008392334,884.5043182373047L309.450008392334,909.5043182373047" id="L-q-ga-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-q LE-ga" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M199.98333740234375,1052.5043182373047L199.98333740234375,1056.6709849039714C199.98333740234375,1060.837651570638,199.98333740234375,1069.1709849039714,199.98333740234375,1081.837651570638C199.98333740234375,1094.5043182373047,199.98333740234375,1111.5043182373047,199.98333740234375,1128.5043182373047C199.98333740234375,1145.5043182373047,199.98333740234375,1162.5043182373047,199.98333740234375,1171.0043182373047L199.98333740234375,1179.5043182373047" id="L-ga1-r-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-ga1 LE-r" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(61.25, 753)"> 
      <g class="label" transform="translate(-32, -26)"> 
       <foreignobject width="64" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">查找服务<br>实例</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(103.10000228881836, 113)"> 
      <g class="label" transform="translate(-50.93333435058594, -39)"> 
       <foreignobject width="101.86666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名<br>-获取排行榜</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(309.450008392334, 397)"> 
      <g class="label" transform="translate(-50.93333435058594, -26)"> 
       <foreignobject width="101.86666870117188" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(146.35000228881836, 681.5)"> 
      <g class="label" transform="translate(-42.93333435058594, -13)"> 
       <foreignobject width="85.86666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(199.98333740234375, 1128.5043182373047)"> 
      <g class="label" transform="translate(-48, -26)"> 
       <foreignobject width="96" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">注册表自身<br>（每个实例）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-ga1-5021" transform="translate(199.98333740234375, 1006.0043182373047)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-46.5" width="104.53334045410156" height="93"></rect> 
      <g class="label" style="" transform="translate(-44.76667022705078, -39)"> 
       <foreignobject width="89.53334045410156" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">注册服务者<br>Spring Cloud<br>Consul发现</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="root" transform="translate(224.6833381652832, 440)"> 
      <g class="clusters"> 
       <g class="cluster default" id="m"> 
        <rect style="" rx="0" ry="0" x="8" y="8" width="154.53334045410156" height="163"></rect> 
        <g class="cluster-label" transform="translate(36.01667022705078, 13)"> 
         <foreignobject width="98.5" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">Multiplication</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="edgePaths"></g> 
      <g class="edgeLabels"></g> 
      <g class="nodes"> 
       <g class="node default default" id="flowchart-m1-5020" transform="translate(85.26667022705078, 89.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-46.5" width="104.53334045410156" height="93"></rect> 
        <g class="label" style="" transform="translate(-44.76667022705078, -39)"> 
         <foreignobject width="89.53334045410156" height="78"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">注册服务者<br>Spring Cloud<br>Consul发现</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-r1-5017" transform="translate(103.10000228881836, 1238.0043182373047)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-33.5" width="63" height="67"></rect> 
      <g class="label" style="" transform="translate(-24, -26)"> 
       <foreignobject width="48" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">注册表<br>Consul</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g1-5012" transform="translate(103.10000228881836, 261.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-59.5" width="104.53334045410156" height="119"></rect> 
      <g class="label" style="" transform="translate(-44.76667022705078, -52)"> 
       <foreignobject width="89.53334045410156" height="104"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务发现<br>客户端<br>Spring Cloud<br>Consul发现</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g2-5013" transform="translate(257.6333427429199, 261.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-46.5" width="104.53334045410156" height="93"></rect> 
      <g class="label" style="" transform="translate(-44.76667022705078, -39)"> 
       <foreignobject width="89.53334045410156" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">负载均衡器<br>Spring Cloud<br>负载均衡器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g3-5014" transform="translate(412.1666831970215, 261.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-52.26667022705078" y="-46.5" width="104.53334045410156" height="93"></rect> 
      <g class="label" style="" transform="translate(-44.76667022705078, -39)"> 
       <foreignobject width="89.53334045410156" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">路由器<br>Spring Cloud<br>网关</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b-5011" transform="translate(103.10000228881836, 28.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-20.5" width="63" height="41"></rect> 
      <g class="label" style="" transform="translate(-24, -13)"> 
       <foreignobject width="48" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">浏览器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-at1-5027" transform="translate(309.450008392334, 681.5)"> 
      <polygon points="-13.666666666666666,0 136.16666666666666,0 156.66666666666666,-41 6.833333333333333,-41" class="label-container" transform="translate(-71.5,20.5)" style=""></polygon> 
      <g class="label" style="" transform="translate(-64, -13)"> 
       <foreignobject width="128" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">尝试（主题交换）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-q-5028" transform="translate(309.450008392334, 844.2521591186523)"> 
      <path style="" d="M 0,13.168107619380502 a 69.55833435058594,13.168107619380502 0,0,0 139.11666870117188 0 a 69.55833435058594,13.168107619380502 0,0,0 -139.11666870117188 0 l 0,54.1681076193805 a 69.55833435058594,13.168107619380502 0,0,0 139.11666870117188 0 l 0,-54.1681076193805" transform="translate(-69.55833435058594,-40.25216142907075)"></path> 
      <g class="label" style="" transform="translate(-62.05833435058594, -13)"> 
       <foreignobject width="124.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification队列</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<h3><a id="_775"></a>网关中的服务发现和负载均衡</h3> 
<p>在应用程序中包含Spring Cloud Consul启动器后，它们会联系注册表用于发布信息，但是，仍然可以显式地使用地址/端口来代理请求的网关。<br> 首先在Gateway项目依赖中添加Spring Cloud Consul发现启动器，如下所示：</p> 
<pre><code class="prism language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-discovery<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>下面，就想要添加配置信息，可以分成三组：</p> 
<ul><li>全局设置：为应用程序命名，确保使用Spring Cloud负载均衡器实现，另外，要添加一个配置参数，来指示服务发现客户端仅检索运行正常的服务。</li><li>路由配置：不使用显式的主机和端口，而是使用URL模式切换到服务名称，该模式可实现负载均衡。</li><li>弹性：为了防止网关无法将请求代理到服务的情况，可设置尝试次数等。</li></ul> 
<p>关于网关的配置如下所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8000</span>

<span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">discovery</span><span class="token punctuation">:</span>
        <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
        <span class="token comment"># 获取通过健康检查的服务</span>
        <span class="token key atrule">query-passing</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
    <span class="token key atrule">gateway</span><span class="token punctuation">:</span>
      <span class="token key atrule">routes</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> multiplication
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//multiplication/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/challenges/<span class="token important">**</span><span class="token punctuation">,</span>/attempts<span class="token punctuation">,</span>/attempts/<span class="token important">**</span><span class="token punctuation">,</span>/users/<span class="token important">**</span>
        <span class="token punctuation">-</span> <span class="token key atrule">id</span><span class="token punctuation">:</span> gamification
          <span class="token key atrule">uri</span><span class="token punctuation">:</span> lb<span class="token punctuation">:</span>//gamification/
          <span class="token key atrule">predicates</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> Path=/leaders
      <span class="token key atrule">globalcors</span><span class="token punctuation">:</span>
        <span class="token key atrule">cors-configurations</span><span class="token punctuation">:</span>
          <span class="token key atrule">'[/**]'</span><span class="token punctuation">:</span>
            <span class="token key atrule">allowedOrigins</span><span class="token punctuation">:</span> <span class="token string">"http://localhost:3000"</span>
            <span class="token key atrule">allowedHeaders</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">"*"</span>
            <span class="token key atrule">allowedMethods</span><span class="token punctuation">:</span>
              <span class="token punctuation">-</span> <span class="token string">"GET"</span>
              <span class="token punctuation">-</span> <span class="token string">"POST"</span>
              <span class="token punctuation">-</span> <span class="token string">"OPTIONS"</span>
      <span class="token key atrule">default-filters</span><span class="token punctuation">:</span> 
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Retry
          <span class="token key atrule">args</span><span class="token punctuation">:</span>
            <span class="token key atrule">retries</span><span class="token punctuation">:</span> <span class="token number">3</span>
            <span class="token key atrule">methods</span><span class="token punctuation">:</span> GET<span class="token punctuation">,</span> POST
  <span class="token key atrule">application</span><span class="token punctuation">:</span>
    <span class="token key atrule">name</span><span class="token punctuation">:</span> gateway
</code></pre> 
<p>将query-passing设置为true，Spring将只检索那些通过运行状况检查的服务，因为只想将请求代理到正常的实例。在服务不经常轮询更新服务列表的情况下，false才可能有意义，这种情况下，需要获取整个列表，而且有处理不正常实例的机制。<br> 最大的改变是关于URL的修改，现在使用诸如 <code>lb://multiplication/</code> 的URL，由于添加了Consul客户端，应用程序可以使用Service API将服务名称解析为可用实例，lb告诉Spring应该使用负载均衡。<br> 这里还添加了适用于所有请求的网关过滤器：RetryGatewayFilter，它位于 default-filters 节点下。该过滤器拦截错误响应，透明地重试该请求，与负载均衡器结合使用，意味着该请求将被代理到下一个实例，可以方便地获取不错的弹性（重试）。这里配置重试3次，可以覆盖大多数失败情况，如果所有重试都失败，网关会向客户端返回错误响应（服务不可用）。<br> 那么，为什么要使用重试呢？Consul的工作方式是每10秒轮询一次（默认值，看更改），当服务还没准备好处理时，注册表不会知道，可能的情况是，Consul成功地检查到了实例，然后该实例立即停止运行，注册表会保持该实例正常运行状况几秒钟，直到下一次轮询，可以使用重试来处理这种情况。更新注册表后，网关将不会在服务列表中获取不正常的实例，就不需要重试。</p> 
<blockquote> 
 <p>注意，减少两次检查的间隔时间可以减少错误数量，但会增加网络流量。</p> 
</blockquote> 
<p>应用新配置后，Gateway微服务会连接到Consul，以查找其他微服务的可用实例及网络位置，然后，基于Spring Cloud负载均衡器中包含的简单循环算法来均衡负载。<br> 现在的配置，所有外部HTTP通信通过localhost:8000使用网关微服务，实际生产环境中，通常使用端口80的HTTP访问，并使用DNS地址指向服务器所在的IP，但是，公共访问将只有一个入口，这成为系统的关键，必须尽可能提高可用性，如果宕机，系统就会宕机。<br> 为了降低风险，可引入DNS负载均衡（指向多个IP地址的主机名）向网关添加冗余。但是，当其中一台主机没有响应时，它依靠客户端（如浏览器）来管理IP地址列表并处理故障转移。可将其视为网关顶部的一个额外层，以增加客户端发现、负载均衡和容错能力。这不是典型做法。<br> Amazon、Microsoft、Google等云提供商使用路由和负载均衡来保证托管服务的高可用性，这也是确保网关始终保持运行状态的替代方法，另外，Kubernetes允许在网关上创建负载均衡器，也可以在该层添加冗余。</p> 
<h3><a id="_839"></a>使用服务发现和负载均衡</h3> 
<p>下面就来看看服务发现和负载均衡。<br> 在运行之前，在Multiplication微服务的UserController和Gamification微服务的LeaderBoardController中添加一行日志输出，便于在日志中查看与API的交互情况。如下所示：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/users"</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">UserRepository</span> userRepository<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">"/{idList}"</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">User</span><span class="token punctuation">&gt;</span></span> <span class="token function">getUsersByIdList</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span> <span class="token keyword">final</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Long</span><span class="token punctuation">&gt;</span></span> idList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"解析用户别名：{}"</span><span class="token punctuation">,</span> idList<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> userRepository<span class="token punctuation">.</span><span class="token function">findAllByIdIn</span><span class="token punctuation">(</span>idList<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Slf4j</span>
<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">"/leaders"</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@RequiredArgsConstructor</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LeaderBoardController</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">final</span> <span class="token class-name">LeaderBoardService</span> leaderBoardService<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span>
    <span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">LeaderBoardPosition</span><span class="token punctuation">&gt;</span></span> <span class="token function">getLeaderBoard</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        log<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">"查询排行榜"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> leaderBoardService<span class="token punctuation">.</span><span class="token function">getCurrentLeaderBoard</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>启动整个系统，包括RabbitMQ、Consul代理、Multiplication微服务、Gamification微服务、Gateway微服务、前端React等。另外给Multiplication和Gamification添加一个额外的实例，命令行如下：</p> 
<pre><code class="prism language-bash">multiplication<span class="token operator">&gt;</span> ./mvnw spring-boot:run -D<span class="token string">"spring-boot.run.arguments"</span><span class="token operator">=</span><span class="token string">"--server.port=9080"</span>
<span class="token punctuation">..</span>.
gamification<span class="token operator">&gt;</span> ./mvnw spring-boot:run -D<span class="token string">"spring-boot.run.arguments"</span><span class="token operator">=</span><span class="token string">"--server.port=9081"</span>
<span class="token punctuation">..</span>.
</code></pre> 
<p>启动后，可以在Consul的界面中查看服务信息，如下图所示：<br> <img src="https://images2.imgbox.com/7d/9f/MjrnBl2v_o.png" alt="services"><br> 验证网关的负载均衡器是否正常很简单：检查两个Gamification服务实例的日志，通过前面添加的日志输出信息，可以方便地查看到排行榜更新的交替请求。如下所示：</p> 
<pre><code class="prism language-java"><span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span><span class="token constant">T11</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">30.131</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">55672</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>multiplication<span class="token punctuation">]</span> <span class="token punctuation">[</span>nio<span class="token operator">-</span><span class="token number">8080</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">7</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>z<span class="token punctuation">.</span>m<span class="token punctuation">.</span>challenge<span class="token punctuation">.</span></span>ChallengeServiceImpl</span>     <span class="token operator">:</span> attempt<span class="token operator">:</span> <span class="token class-name">ChallengeAttempt</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">154</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token class-name">User</span><span class="token punctuation">(</span>id<span class="token operator">=</span><span class="token number">3</span><span class="token punctuation">,</span> alias<span class="token operator">=</span>noise<span class="token punctuation">)</span><span class="token punctuation">,</span> factorA<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> factorB<span class="token operator">=</span><span class="token number">60</span><span class="token punctuation">,</span> resultAttempt<span class="token operator">=</span><span class="token number">3000</span><span class="token punctuation">,</span> correct<span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">22</span><span class="token constant">T11</span><span class="token operator">:</span><span class="token number">37</span><span class="token operator">:</span><span class="token number">33.494</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span>  <span class="token constant">INFO</span> <span class="token number">55672</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>multiplication<span class="token punctuation">]</span> <span class="token punctuation">[</span>nio<span class="token operator">-</span><span class="token number">8080</span><span class="token operator">-</span>exec<span class="token operator">-</span><span class="token number">8</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">c<span class="token punctuation">.</span>z<span class="token punctuation">.</span>multiplication<span class="token punctuation">.</span>user<span class="token punctuation">.</span></span>UserController</span>   <span class="token operator">:</span> 解析用户别名：<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
</code></pre> 
<p>大家可以多尝试一下，以观察在各个实例上的输出。<br> 现在，系统得到了扩展，一切按预期进行。与RabbitMQ负载均衡类似，HTTP流量在所有实例之间均衡分配，将系统的容量增加了一倍。<br> 实际上，可以启动任意数量的实例，并且负载将透明地分布在所有微服务中，通过网关，使API客户端不了解内部服务，很容易实现这些关注点，如用户身份验证或监视等。<br> 还应该检查是否实现了其他非功能性需求：弹性、高可用性和容错性。<br> 意外总会发生，模拟一下服务不可用的情况。现在模拟服务突然终止的情况，人为停止某个实例，查看是否能够正常。<br> 手动终止Gamification实例2（9081端口），持续发送请求，发现所有的请求都转发到8080端口的实例上了，如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-XtQURK2u3OIduUjX" width="664.566650390625" xmlns="http://www.w3.org/2000/svg" height="913.5043334960938" viewbox="0 0 664.566650390625 913.5043334960938" class="mermaid-svg"> 
  <style>#mermaid-svg-XtQURK2u3OIduUjX {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-XtQURK2u3OIduUjX .error-icon{fill:#552222;}#mermaid-svg-XtQURK2u3OIduUjX .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-XtQURK2u3OIduUjX .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-XtQURK2u3OIduUjX .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-XtQURK2u3OIduUjX .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-XtQURK2u3OIduUjX .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-XtQURK2u3OIduUjX .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-XtQURK2u3OIduUjX .marker{fill:#333333;stroke:#333333;}#mermaid-svg-XtQURK2u3OIduUjX .marker.cross{stroke:#333333;}#mermaid-svg-XtQURK2u3OIduUjX svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-XtQURK2u3OIduUjX .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-XtQURK2u3OIduUjX .cluster-label text{fill:#333;}#mermaid-svg-XtQURK2u3OIduUjX .cluster-label span{color:#333;}#mermaid-svg-XtQURK2u3OIduUjX .label text,#mermaid-svg-XtQURK2u3OIduUjX span{fill:#333;color:#333;}#mermaid-svg-XtQURK2u3OIduUjX .node rect,#mermaid-svg-XtQURK2u3OIduUjX .node circle,#mermaid-svg-XtQURK2u3OIduUjX .node ellipse,#mermaid-svg-XtQURK2u3OIduUjX .node polygon,#mermaid-svg-XtQURK2u3OIduUjX .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-XtQURK2u3OIduUjX .node .label{text-align:center;}#mermaid-svg-XtQURK2u3OIduUjX .node.clickable{cursor:pointer;}#mermaid-svg-XtQURK2u3OIduUjX .arrowheadPath{fill:#333333;}#mermaid-svg-XtQURK2u3OIduUjX .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-XtQURK2u3OIduUjX .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-XtQURK2u3OIduUjX .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-XtQURK2u3OIduUjX .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-XtQURK2u3OIduUjX .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-XtQURK2u3OIduUjX .cluster text{fill:#333;}#mermaid-svg-XtQURK2u3OIduUjX .cluster span{color:#333;}#mermaid-svg-XtQURK2u3OIduUjX div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-XtQURK2u3OIduUjX :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <path d="M396.8166732788086,49L396.8166732788086,59.666666666666664C396.8166732788086,70.33333333333333,396.8166732788086,91.66666666666667,396.8166732788086,113C396.8166732788086,134.33333333333334,396.8166732788086,155.66666666666666,396.8166732788086,166.33333333333334L396.8166732788086,177" id="L-b-g-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b LE-g" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M373.3166732788086,202.55439674008747L321.82778294881183,213.6286639500729C270.3388926188151,224.70293116005828,167.36111195882162,246.85146558002916,115.87222162882487,269.8423994566812C64.38333129882812,292.8333333333333,64.38333129882812,316.6666666666667,64.38333129882812,338.3333333333333C64.38333129882812,360,64.38333129882812,379.5,64.38333129882812,399.9166666666667C64.38333129882812,420.3333333333333,64.38333129882812,441.6666666666667,64.38333129882812,465.1666666666667C64.38333129882812,488.6666666666667,64.38333129882812,514.3333333333334,64.38333129882812,536.7920265197754C64.38333129882812,559.2507197062174,64.38333129882812,578.5014394124349,64.38333129882812,588.1267992655436L64.38333129882812,597.7521591186523" id="L-g-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M313.51534137097036,814.5043182373047L312.59959045521947,818.6709849039713C311.6838395394685,822.8376515706381,309.8523377079667,831.1709849039713,331.02130994691953,840.7381614299899C352.1902821858724,850.3053379560087,396.35972849527997,861.1063576747125,418.4444516499837,866.5068675340644L440.5291748046875,871.9073773934164" id="L-ga-ga1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-ga LE-ga1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M518.9615945501641,864.5043182373047L524.0173029637598,860.3376515706381C529.0730113773556,856.1709849039713,539.1844282045469,847.8376515706381,514.6206908173614,837.8437890091018C490.0569534301758,827.8499264475654,430.8180618286133,816.1955346578261,401.19861602783203,810.3683387629566L371.5791702270508,804.5411428680869" id="L-ga1-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-ga1 LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M373.3166732788086,207.66024140579597L349.6708386739095,217.88353450482998C326.02500406901044,228.106827603864,278.7333348592122,248.553413801932,255.08750025431314,267.27670690096596C231.44166564941406,286,231.44166564941406,303,231.44166564941406,311.5L231.44166564941406,320" id="L-g-m-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-m" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M399.04825821456376,218L399.9735495293891,226.5C400.89884084421436,235,402.74942347386497,252,403.6747147886903,272.4166666666667C404.6000061035156,292.8333333333333,404.6000061035156,316.6666666666667,404.6000061035156,338.3333333333333C404.6000061035156,360,404.6000061035156,379.5,404.6000061035156,399.9166666666667C404.6000061035156,420.3333333333333,404.6000061035156,441.6666666666667,404.6000061035156,465.1666666666667C404.6000061035156,488.6666666666667,404.6000061035156,514.3333333333334,404.6000061035156,542.3753598531088C404.6000061035156,570.4173863728842,404.6000061035156,600.8347727457682,404.6000061035156,631.2521591186523C404.6000061035156,661.6695454915365,404.6000061035156,692.0869318644205,394.30737747512495,715.7956250508627C384.01474884673434,739.5043182373047,363.429491589953,756.5043182373047,353.1368629615624,765.0043182373047L342.8442343331717,773.5043182373047" id="L-g-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M420.3166732788086,210.06105124802767L438.6944516499837,219.88420937335638C457.0722300211589,229.7073674986851,493.8277867635091,249.35368374934254,512.2055651346842,271.09350854133794C530.5833435058594,292.8333333333333,530.5833435058594,316.6666666666667,530.5833435058594,338.3333333333333C530.5833435058594,360,530.5833435058594,379.5,530.5833435058594,399.9166666666667C530.5833435058594,420.3333333333333,530.5833435058594,441.6666666666667,530.5833435058594,465.1666666666667C530.5833435058594,488.6666666666667,530.5833435058594,514.3333333333334,530.5833435058594,542.3753598531088C530.5833435058594,570.4173863728842,530.5833435058594,600.8347727457682,530.5833435058594,631.2521591186523C530.5833435058594,661.6695454915365,530.5833435058594,692.0869318644205,504.0826479593913,716.209707561011C477.58195241292316,740.3324832576014,424.580561319987,758.1606482778983,398.07986577351886,767.0747307880466L371.5791702270508,775.988813298195" id="L-g-ga-1" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M420.3166732788086,205.62663715867492L450.8597297668457,216.18886429889577C481.4027862548828,226.75109143911664,542.488899230957,247.87554571955832,573.0319557189941,270.3544395264458C603.5750122070312,292.8333333333333,603.5750122070312,316.6666666666667,603.5750122070312,338.3333333333333C603.5750122070312,360,603.5750122070312,379.5,603.5750122070312,399.9166666666667C603.5750122070312,420.3333333333333,603.5750122070312,441.6666666666667,603.5750122070312,465.1666666666667C603.5750122070312,488.6666666666667,603.5750122070312,514.3333333333334,603.5750122070312,542.3753598531088C603.5750122070312,570.4173863728842,603.5750122070312,600.8347727457682,603.5750122070312,631.2521591186523C603.5750122070312,661.6695454915365,603.5750122070312,692.0869318644205,603.5750122070312,719.2122917175293C603.5750122070312,746.3376515706381,603.5750122070312,770.1709849039713,603.5750122070312,789.6709849039713C603.5750122070312,809.1709849039713,603.5750122070312,824.3376515706381,593.5486840887385,836.0876515706381C583.5223559704456,847.8376515706381,563.4696997338599,856.1709849039713,553.4433716155671,860.3376515706381L543.4170434972742,864.5043182373047" id="L-g-ga1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-ga1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M231.44166564941406,361L231.44166564941406,367.3333333333333C231.44166564941406,373.6666666666667,231.44166564941406,386.3333333333333,231.5249989827474,400C231.60833231608072,413.6666666666667,231.7749989827474,428.3333333333334,231.85833231608072,435.66666666666674L231.94166564941403,443.0000000000001" id="L-m-at1-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m LE-at1" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M231.94166564941406,484L231.85833231608072,493.3333333333333C231.7749989827474,502.6666666666667,231.60833231608072,521.3333333333334,231.5249989827474,539.1666666666666C231.44166564941406,557,231.44166564941406,574,231.44166564941406,582.5L231.44166564941406,591" id="L-at1-q-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-at1 LE-q" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M231.44166564941406,671.5043182373047L231.44166564941406,680.0043182373047C231.44166564941406,688.5043182373047,231.44166564941406,705.5043182373047,241.7342942778047,722.5043182373047C252.02692290619538,739.5043182373047,272.6121801629767,756.5043182373047,282.9048087913673,765.0043182373047L293.197437419758,773.5043182373047" id="L-q-ga-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-q LE-ga" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M64.38333129882812,664.7521591186523L64.38333129882812,674.3775189717611C64.38333129882812,684.0028788248698,64.38333129882812,703.2535985310873,97.72985967000325,722.2792904940288C131.07638804117838,741.3049824569703,197.76944478352866,760.1056466766358,231.11597315470377,769.5059787864687L264.4625015258789,778.9063108963014" id="L-r-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-r LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(396.8166732788086, 113)"> 
      <g class="label" transform="translate(-50.93333435058594, -39)"> 
       <foreignobject width="101.86666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名<br>-获取排行榜</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(64.38333129882812, 399)"> 
      <g class="label" transform="translate(-48, -13)"> 
       <foreignobject width="96" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">查找服务实例</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(231.44166564941406, 269)"> 
      <g class="label" transform="translate(-50.93333435058594, -26)"> 
       <foreignobject width="101.86666870117188" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(404.6000061035156, 463)"> 
      <g class="label" transform="translate(-52.991668701171875, -13)"> 
       <foreignobject width="105.98333740234375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜(1)</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(530.5833435058594, 463)"> 
      <g class="label" transform="translate(-52.991668701171875, -26)"> 
       <foreignobject width="105.98333740234375" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜(2)<br>(Retry)</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(603.5750122070312, 540)"> 
      <g class="label" transform="translate(-52.991668701171875, -26)"> 
       <foreignobject width="105.98333740234375" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜(2)<br>X</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(64.38333129882812, 722.5043182373047)"> 
      <g class="label" transform="translate(-56.383331298828125, -26)"> 
       <foreignobject width="112.76666259765625" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">运行状况检查<br>（每隔10秒钟）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-b-5065" transform="translate(396.8166732788086, 28.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-20.5" width="63" height="41"></rect> 
      <g class="label" style="" transform="translate(-24, -13)"> 
       <foreignobject width="48" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">浏览器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g-5067" transform="translate(396.8166732788086, 197.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-23.5" y="-20.5" width="47" height="41"></rect> 
      <g class="label" style="" transform="translate(-16, -13)"> 
       <foreignobject width="32" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">网关</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-r-5069" transform="translate(64.38333129882812, 631.2521591186523)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-33.5" width="95" height="67"></rect> 
      <g class="label" style="" transform="translate(-40, -26)"> 
       <foreignobject width="80" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册表<br>（Consul）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-ga1-5070" transform="translate(494.08750915527344, 885.0043182373047)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-20.5" width="107.11666870117188" height="41"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -13)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-ga-5071" transform="translate(318.02083587646484, 794.0043182373047)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-20.5" width="107.11666870117188" height="41"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -13)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m-5075" transform="translate(231.44166564941406, 340.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-20.5" width="113.5" height="41"></rect> 
      <g class="label" style="" transform="translate(-49.25, -13)"> 
       <foreignobject width="98.5" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Multiplication</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-at1-5082" transform="translate(231.44166564941406, 463)"> 
      <polygon points="-13.666666666666666,0 136.16666666666666,0 156.66666666666666,-41 6.833333333333333,-41" class="label-container" transform="translate(-71.5,20.5)" style=""></polygon> 
      <g class="label" style="" transform="translate(-64, -13)"> 
       <foreignobject width="128" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">尝试（主题交换）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-q-5083" transform="translate(231.44166564941406, 631.2521591186523)"> 
      <path style="" d="M 0,13.168107619380502 a 69.55833435058594,13.168107619380502 0,0,0 139.11666870117188 0 a 69.55833435058594,13.168107619380502 0,0,0 -139.11666870117188 0 l 0,54.1681076193805 a 69.55833435058594,13.168107619380502 0,0,0 139.11666870117188 0 l 0,-54.1681076193805" transform="translate(-69.55833435058594,-40.25216142907075)"></path> 
      <g class="label" style="" transform="translate(-62.05833435058594, -13)"> 
       <foreignobject width="124.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification队列</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>可以暂时关闭网关中的重试过滤器配置，来了解它们是如何协作的，注释调Gateway配置中的重试过滤器配置，重新启动，不使用重试模式时如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-al8hjOvPe0d6Ptsr" width="538.5833740234375" xmlns="http://www.w3.org/2000/svg" height="902.5043334960938" viewbox="0 0 538.5833740234375 902.5043334960938" class="mermaid-svg"> 
  <style>#mermaid-svg-al8hjOvPe0d6Ptsr {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-al8hjOvPe0d6Ptsr .error-icon{fill:#552222;}#mermaid-svg-al8hjOvPe0d6Ptsr .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-al8hjOvPe0d6Ptsr .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-al8hjOvPe0d6Ptsr .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-al8hjOvPe0d6Ptsr .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-al8hjOvPe0d6Ptsr .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-al8hjOvPe0d6Ptsr .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-al8hjOvPe0d6Ptsr .marker{fill:#333333;stroke:#333333;}#mermaid-svg-al8hjOvPe0d6Ptsr .marker.cross{stroke:#333333;}#mermaid-svg-al8hjOvPe0d6Ptsr svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-al8hjOvPe0d6Ptsr .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-al8hjOvPe0d6Ptsr .cluster-label text{fill:#333;}#mermaid-svg-al8hjOvPe0d6Ptsr .cluster-label span{color:#333;}#mermaid-svg-al8hjOvPe0d6Ptsr .label text,#mermaid-svg-al8hjOvPe0d6Ptsr span{fill:#333;color:#333;}#mermaid-svg-al8hjOvPe0d6Ptsr .node rect,#mermaid-svg-al8hjOvPe0d6Ptsr .node circle,#mermaid-svg-al8hjOvPe0d6Ptsr .node ellipse,#mermaid-svg-al8hjOvPe0d6Ptsr .node polygon,#mermaid-svg-al8hjOvPe0d6Ptsr .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-al8hjOvPe0d6Ptsr .node .label{text-align:center;}#mermaid-svg-al8hjOvPe0d6Ptsr .node.clickable{cursor:pointer;}#mermaid-svg-al8hjOvPe0d6Ptsr .arrowheadPath{fill:#333333;}#mermaid-svg-al8hjOvPe0d6Ptsr .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-al8hjOvPe0d6Ptsr .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-al8hjOvPe0d6Ptsr .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-al8hjOvPe0d6Ptsr .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-al8hjOvPe0d6Ptsr .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-al8hjOvPe0d6Ptsr .cluster text{fill:#333;}#mermaid-svg-al8hjOvPe0d6Ptsr .cluster span{color:#333;}#mermaid-svg-al8hjOvPe0d6Ptsr div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-al8hjOvPe0d6Ptsr :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <path d="M310.2375030517578,49L310.2375030517578,59.666666666666664C310.2375030517578,70.33333333333333,310.2375030517578,91.66666666666667,310.2375030517578,113C310.2375030517578,134.33333333333334,310.2375030517578,155.66666666666666,310.2375030517578,166.33333333333334L310.2375030517578,177" id="L-b-g-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b LE-g" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M286.7375030517578,204.3343359318245L249.67847442626953,215.1119466098538C212.61944580078125,225.889557287883,138.5013885498047,247.4447786439415,101.4423599243164,270.13905598863744C64.38333129882812,292.8333333333333,64.38333129882812,316.6666666666667,64.38333129882812,338.3333333333333C64.38333129882812,360,64.38333129882812,379.5,64.38333129882812,399C64.38333129882812,418.5,64.38333129882812,438,64.38333129882812,459.6666666666667C64.38333129882812,481.3333333333333,64.38333129882812,505.1666666666667,64.38333129882812,526.708693186442C64.38333129882812,548.2507197062174,64.38333129882812,567.5014394124349,64.38333129882812,577.1267992655436L64.38333129882812,586.7521591186523" id="L-g-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M226.93617114391955,803.5043182373047L226.02042022816863,807.6709849039713C225.1046693124177,811.8376515706381,223.27316748091587,820.1709849039713,233.94352826967346,828.6209590087669C244.613889058431,837.0709331135623,267.78611246744794,845.6375479898201,279.37222417195636,849.9208554279489L290.95833587646484,854.2041628660778" id="L-ga-ga1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-ga LE-ga1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M380.0180914742606,853.5043182373047L387.2338275001162,849.3376515706381C394.4495635259719,845.1709849039713,408.8810355776832,836.8376515706381,393.04468699863975,827.2044437729727C377.2083384195964,817.5712359753073,331.10416920979816,806.6381537133101,308.0520846048991,801.1716125823114L285,795.7050714513127" id="L-ga1-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-ga1 LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M287.6456895308061,218L278.27835221724075,226.5C268.91101490367544,235,250.17634027654472,252,240.8090029629794,269C231.44166564941406,286,231.44166564941406,303,231.44166564941406,311.5L231.44166564941406,320" id="L-g-m-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-m" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M333.7375030517578,215.30633138862777L345.5479202270508,224.2552761571898C357.35833740234375,233.20422092575186,380.9791717529297,251.1021104628759,392.78958892822266,271.9677218981046C404.6000061035156,292.8333333333333,404.6000061035156,316.6666666666667,404.6000061035156,338.3333333333333C404.6000061035156,360,404.6000061035156,379.5,404.6000061035156,399C404.6000061035156,418.5,404.6000061035156,438,404.6000061035156,459.6666666666667C404.6000061035156,481.3333333333333,404.6000061035156,505.1666666666667,404.6000061035156,532.2920265197754C404.6000061035156,559.4173863728842,404.6000061035156,589.8347727457682,404.6000061035156,620.2521591186523C404.6000061035156,650.6695454915365,404.6000061035156,681.0869318644205,384.01474884673434,704.7956250508627C363.429491589953,728.5043182373047,322.2589770763904,745.5043182373047,301.67371981960906,754.0043182373047L281.0884625628278,762.5043182373047" id="L-g-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M333.7375030517578,207.54008434567504L357.7131983439128,217.78340362139588C381.6888936360677,228.02672289711668,429.6402842203776,248.51336144855836,453.61597951253253,270.6733473909458C477.5916748046875,292.8333333333333,477.5916748046875,316.6666666666667,477.5916748046875,338.3333333333333C477.5916748046875,360,477.5916748046875,379.5,477.5916748046875,399C477.5916748046875,418.5,477.5916748046875,438,477.5916748046875,459.6666666666667C477.5916748046875,481.3333333333333,477.5916748046875,505.1666666666667,477.5916748046875,532.2920265197754C477.5916748046875,559.4173863728842,477.5916748046875,589.8347727457682,477.5916748046875,620.2521591186523C477.5916748046875,650.6695454915365,477.5916748046875,681.0869318644205,477.5916748046875,708.2122917175293C477.5916748046875,735.3376515706381,477.5916748046875,759.1709849039713,477.5916748046875,778.6709849039713C477.5916748046875,798.1709849039713,477.5916748046875,813.3376515706381,464.3388964335124,825.4522747416258C451.0861180623372,837.5668979126136,424.580561319987,846.6294775879227,411.32778294881183,851.1607674255771L398.0750045776367,855.6920572632315" id="L-g-ga1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-ga1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M231.44166564941406,361L231.44166564941406,367.3333333333333C231.44166564941406,373.6666666666667,231.44166564941406,386.3333333333333,231.5249989827474,399.0833333333333C231.60833231608072,411.8333333333333,231.7749989827474,424.6666666666667,231.85833231608072,431.0833333333333L231.9416656494141,437.50000000000006" id="L-m-at1-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m LE-at1" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M231.94166564941403,478.49999999999994L231.8583323160807,486.9166666666666C231.7749989827474,495.3333333333333,231.60833231608072,512.1666666666666,231.5249989827474,529.0833333333334C231.44166564941406,546,231.44166564941406,563,231.44166564941406,571.5L231.44166564941406,580" id="L-at1-q-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-at1 LE-q" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M231.44166564941406,660.5043182373047L231.44166564941406,669.0043182373047C231.44166564941406,677.5043182373047,231.44166564941406,694.5043182373047,231.44166564941406,711.5043182373047C231.44166564941406,728.5043182373047,231.44166564941406,745.5043182373047,231.44166564941406,754.0043182373047L231.44166564941406,762.5043182373047" id="L-q-ga-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-q LE-ga" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M64.38333129882812,653.7521591186523L64.38333129882812,663.3775189717611C64.38333129882812,673.0028788248698,64.38333129882812,692.2535985310873,84.24341300484184,710.3789583841959C104.10349471085556,728.5043182373047,143.82365812288296,745.5043182373047,163.68373982889668,754.0043182373047L183.5438215349104,762.5043182373047" id="L-r-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-r LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(310.2375030517578, 113)"> 
      <g class="label" transform="translate(-50.93333435058594, -39)"> 
       <foreignobject width="101.86666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名<br>-获取排行榜</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(64.38333129882812, 399)"> 
      <g class="label" transform="translate(-48, -13)"> 
       <foreignobject width="96" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">查找服务实例</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(231.44166564941406, 269)"> 
      <g class="label" transform="translate(-50.93333435058594, -26)"> 
       <foreignobject width="101.86666870117188" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(404.6000061035156, 457.5)"> 
      <g class="label" transform="translate(-52.991668701171875, -13)"> 
       <foreignobject width="105.98333740234375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜(1)</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(477.5916748046875, 529)"> 
      <g class="label" transform="translate(-52.991668701171875, -26)"> 
       <foreignobject width="105.98333740234375" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜(2)<br>X</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(64.38333129882812, 711.5043182373047)"> 
      <g class="label" transform="translate(-56.383331298828125, -26)"> 
       <foreignobject width="112.76666259765625" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">运行状况检查<br>（每隔10秒钟）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-b-5117" transform="translate(310.2375030517578, 28.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-20.5" width="63" height="41"></rect> 
      <g class="label" style="" transform="translate(-24, -13)"> 
       <foreignobject width="48" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">浏览器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g-5119" transform="translate(310.2375030517578, 197.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-23.5" y="-20.5" width="47" height="41"></rect> 
      <g class="label" style="" transform="translate(-16, -13)"> 
       <foreignobject width="32" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">网关</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-r-5121" transform="translate(64.38333129882812, 620.2521591186523)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-33.5" width="95" height="67"></rect> 
      <g class="label" style="" transform="translate(-40, -26)"> 
       <foreignobject width="80" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">服务注册表<br>（Consul）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-ga1-5122" transform="translate(344.5166702270508, 874.0043182373047)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-20.5" width="107.11666870117188" height="41"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -13)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-ga-5123" transform="translate(231.44166564941406, 783.0043182373047)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-20.5" width="107.11666870117188" height="41"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -13)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m-5127" transform="translate(231.44166564941406, 340.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-20.5" width="113.5" height="41"></rect> 
      <g class="label" style="" transform="translate(-49.25, -13)"> 
       <foreignobject width="98.5" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Multiplication</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-at1-5132" transform="translate(231.44166564941406, 457.5)"> 
      <polygon points="-13.666666666666666,0 136.16666666666666,0 156.66666666666666,-41 6.833333333333333,-41" class="label-container" transform="translate(-71.5,20.5)" style=""></polygon> 
      <g class="label" style="" transform="translate(-64, -13)"> 
       <foreignobject width="128" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">尝试（主题交换）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-q-5133" transform="translate(231.44166564941406, 620.2521591186523)"> 
      <path style="" d="M 0,13.168107619380502 a 69.55833435058594,13.168107619380502 0,0,0 139.11666870117188 0 a 69.55833435058594,13.168107619380502 0,0,0 -139.11666870117188 0 l 0,54.1681076193805 a 69.55833435058594,13.168107619380502 0,0,0 139.11666870117188 0 l 0,-54.1681076193805" transform="translate(-69.55833435058594,-40.25216142907075)"></path> 
      <g class="label" style="" transform="translate(-62.05833435058594, -13)"> 
       <foreignobject width="124.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification队列</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>模拟前面的测试，整个系统在停止一个实例的时候，仍然能够运行。在Consul界面下，导航到Service实例下，可以看到列出来的所有可用实例，如图所示：<br> <img src="https://images2.imgbox.com/e6/f7/cDmslJcp_o.png" alt="service实例"><br> 现在，在微服务中实现了可扩展性，通过服务发现注册表的负载均衡器实现了适当的容错性，注册表了解系统中不同组件的运行状况。</p> 
<h2><a id="_943"></a>环境配置</h2> 
<p>Spring Boot的优点之一是能够通过配置文件自定义配置，配置文件可以根据需要启用一组配置属性。例如，本地测试期间，可配置使用本地RabbitMQ服务器；生产环境中，可切换到实际的RabbitMQ服务器。<br> 要引入新的rabbitprod配置文件，可以创建一个名为application-rabbitprod.properties文件。Spring Boot使用application-{profile}的命名约定（对应properties和yaml格式），从而可以在单独的文件中定义配置文件。<br> 定义了单独的配置文件，启动应用程序时，要确保启用此配置文件，这需要设置spring.profiles.active属性。可使用maven命令为微服务Multiplication启用指定的配置文件：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> ./mvnw spring-boot:run -D<span class="token string">"spring-boot.run.arguments"</span><span class="token operator">=</span><span class="token string">"--spring.profiles.active=rabbitprod"</span>
</code></pre> 
<p>可以想象，所有微服务在每种环境中都可能具有许多通用的配置，不仅RabbitMQ的连接详细信息可能是相同的，而且可以添加额外的值，例如exchange名称（amqp.exchange.attempts）。可以将值保存在每个微服务、每种环境和每个工具的单独文件中，例如：</p> 
<ul><li>application-rabbitprod.properties</li><li>application-databaseprod.properties</li><li>application-rabbitstaging.properties</li><li>application-databasestaging.properties</li></ul> 
<p>然后，在需要的时候进行复制，方便重用这些值。但是，保留许多副本带来大量的维护工作，如果需要更改公共配置中的某个值，必须替换每个项目中的相应文件。<br> 更好的方法是将配置放在系统中的通用位置，使应用程序在启动之前对其内容进行同步，然后对每种环境进行集中配置，这样只相应调整一次值。如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-HgVSIIKmwKN130aW" width="1118.5333251953125" xmlns="http://www.w3.org/2000/svg" height="487" viewbox="0 0 1118.5333251953125 487" class="mermaid-svg"> 
  <style>#mermaid-svg-HgVSIIKmwKN130aW {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-HgVSIIKmwKN130aW .error-icon{fill:#552222;}#mermaid-svg-HgVSIIKmwKN130aW .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-HgVSIIKmwKN130aW .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-HgVSIIKmwKN130aW .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-HgVSIIKmwKN130aW .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-HgVSIIKmwKN130aW .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-HgVSIIKmwKN130aW .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-HgVSIIKmwKN130aW .marker{fill:#333333;stroke:#333333;}#mermaid-svg-HgVSIIKmwKN130aW .marker.cross{stroke:#333333;}#mermaid-svg-HgVSIIKmwKN130aW svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-HgVSIIKmwKN130aW .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-HgVSIIKmwKN130aW .cluster-label text{fill:#333;}#mermaid-svg-HgVSIIKmwKN130aW .cluster-label span{color:#333;}#mermaid-svg-HgVSIIKmwKN130aW .label text,#mermaid-svg-HgVSIIKmwKN130aW span{fill:#333;color:#333;}#mermaid-svg-HgVSIIKmwKN130aW .node rect,#mermaid-svg-HgVSIIKmwKN130aW .node circle,#mermaid-svg-HgVSIIKmwKN130aW .node ellipse,#mermaid-svg-HgVSIIKmwKN130aW .node polygon,#mermaid-svg-HgVSIIKmwKN130aW .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-HgVSIIKmwKN130aW .node .label{text-align:center;}#mermaid-svg-HgVSIIKmwKN130aW .node.clickable{cursor:pointer;}#mermaid-svg-HgVSIIKmwKN130aW .arrowheadPath{fill:#333333;}#mermaid-svg-HgVSIIKmwKN130aW .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-HgVSIIKmwKN130aW .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-HgVSIIKmwKN130aW .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-HgVSIIKmwKN130aW .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-HgVSIIKmwKN130aW .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-HgVSIIKmwKN130aW .cluster text{fill:#333;}#mermaid-svg-HgVSIIKmwKN130aW .cluster span{color:#333;}#mermaid-svg-HgVSIIKmwKN130aW div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-HgVSIIKmwKN130aW :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"></g> 
    <g class="edgeLabels"></g> 
    <g class="nodes"> 
     <g class="root" transform="translate(0.5, 0)"> 
      <g class="clusters"> 
       <g class="cluster default" id="生产环境"> 
        <rect style="" rx="0" ry="0" x="8" y="8" width="526.2666625976562" height="471"></rect> 
        <g class="cluster-label" transform="translate(239.13333129882812, 13)"> 
         <foreignobject width="64" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">生产环境</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="cluster default" id="m"> 
        <rect style="" rx="0" ry="0" x="28" y="33" width="233.13333129882812" height="143"></rect> 
        <g class="cluster-label" transform="translate(95.31666564941406, 38)"> 
         <foreignobject width="98.5" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">Multiplication</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="cluster default" id="g"> 
        <rect style="" rx="0" ry="0" x="281.1333312988281" y="33" width="233.13333129882812" height="143"></rect> 
        <g class="cluster-label" transform="translate(351.64166259765625, 38)"> 
         <foreignobject width="92.11666870117188" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">Gamification</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="edgePaths"> 
       <path d="M144.56666564941406,151L144.56666564941406,155.16666666666666C144.56666564941406,159.33333333333334,144.56666564941406,167.66666666666666,144.56666564941406,178.16666666666666C144.56666564941406,188.66666666666666,144.56666564941406,201.33333333333334,151.97777684529623,215.8058117641688C159.38888804117838,230.27829019500427,174.21111043294272,246.55658039000855,181.62222162882486,254.69572548751069L189.03333282470703,262.8348705850128" id="L-m1-p-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m1 LE-p" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
       <path d="M397.6999969482422,151L397.6999969482422,155.16666666666666C397.6999969482422,159.33333333333334,397.6999969482422,167.66666666666666,397.6999969482422,178.16666666666666C397.6999969482422,188.66666666666666,397.6999969482422,201.33333333333334,390.28888575236004,215.8058117641688C382.87777455647785,230.27829019500427,368.05555216471356,246.55658039000855,360.64444096883136,254.69572548751069L353.2333297729492,262.8348705850128" id="L-g1-p-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g1 LE-p" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
      </g> 
      <g class="edgeLabels"> 
       <g class="edgeLabel" transform="translate(144.56666564941406, 214)"> 
        <g class="label" transform="translate(-56.491668701171875, -13)"> 
         <foreignobject width="112.98333740234375" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="edgeLabel">Get config:prod</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="edgeLabel" transform="translate(397.6999969482422, 214)"> 
        <g class="label" transform="translate(-56.491668701171875, -13)"> 
         <foreignobject width="112.98333740234375" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="edgeLabel">Get config:prod</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="nodes"> 
       <g class="root" transform="translate(181.53333282470703, 244)"> 
        <g class="clusters"> 
         <g class="cluster default" id="p"> 
          <rect style="" rx="0" ry="0" x="8" y="8" width="164.1999969482422" height="202"></rect> 
          <g class="cluster-label" transform="translate(50.099998474121094, 13)"> 
           <foreignobject width="80" height="26"> 
            <div style="display: inline-block; white-space: nowrap;"> 
             <span class="nodeLabel">配置服务器</span> 
            </div> 
           </foreignobject> 
          </g> 
         </g> 
        </g> 
        <g class="edgePaths"></g> 
        <g class="edgeLabels"></g> 
        <g class="nodes"> 
         <g class="node default default" id="flowchart-p1-5168" transform="translate(90.0999984741211, 63.5)"> 
          <rect class="basic label-container" style="" rx="0" ry="0" x="-57.099998474121094" y="-20.5" width="114.19999694824219" height="41"></rect> 
          <g class="label" style="" transform="translate(-49.599998474121094, -13)"> 
           <foreignobject width="99.19999694824219" height="26"> 
            <div style="display: inline-block; white-space: nowrap;"> 
             <span class="nodeLabel">staging config</span> 
            </div> 
           </foreignobject> 
          </g> 
         </g> 
         <g class="node default default" id="flowchart-p2-5169" transform="translate(90.0999984741211, 154.5)"> 
          <rect class="basic label-container" style="" rx="0" ry="0" x="-48.10832977294922" y="-20.5" width="96.21665954589844" height="41"></rect> 
          <g class="label" style="" transform="translate(-40.60832977294922, -13)"> 
           <foreignobject width="81.21665954589844" height="26"> 
            <div style="display: inline-block; white-space: nowrap;"> 
             <span class="nodeLabel">prod config</span> 
            </div> 
           </foreignobject> 
          </g> 
         </g> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-m1-5170" transform="translate(144.56666564941406, 104.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-81.56666564941406" y="-46.5" width="163.13333129882812" height="93"></rect> 
        <g class="label" style="" transform="translate(-74.06666564941406, -39)"> 
         <foreignobject width="148.13333129882812" height="78"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">配置服务器<br>客户端<br>enabled profile:prod</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-g1-5171" transform="translate(397.6999969482422, 104.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-81.56666564941406" y="-46.5" width="163.13333129882812" height="93"></rect> 
        <g class="label" style="" transform="translate(-74.06666564941406, -39)"> 
         <foreignobject width="148.13333129882812" height="78"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">配置服务器<br>客户端<br>enabled profile:prod</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
     </g> 
     <g class="root" transform="translate(576.7666625976562, 0)"> 
      <g class="clusters"> 
       <g class="cluster default" id="分段环境"> 
        <rect style="" rx="0" ry="0" x="8" y="8" width="526.2666625976562" height="471"></rect> 
        <g class="cluster-label" transform="translate(239.13333129882812, 13)"> 
         <foreignobject width="64" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">分段环境</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="cluster default" id="mm"> 
        <rect style="" rx="0" ry="0" x="28" y="33" width="233.13333129882812" height="143"></rect> 
        <g class="cluster-label" transform="translate(95.31666564941406, 38)"> 
         <foreignobject width="98.5" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">Multiplication</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="cluster default" id="gg"> 
        <rect style="" rx="0" ry="0" x="281.1333312988281" y="33" width="233.13333129882812" height="143"></rect> 
        <g class="cluster-label" transform="translate(351.64166259765625, 38)"> 
         <foreignobject width="92.11666870117188" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">Gamification</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="edgePaths"> 
       <path d="M144.56666564941406,151L144.56666564941406,155.16666666666666C144.56666564941406,159.33333333333334,144.56666564941406,167.66666666666666,144.56666564941406,178.16666666666666C144.56666564941406,188.66666666666666,144.56666564941406,201.33333333333334,151.97777684529623,215.8058117641688C159.38888804117838,230.27829019500427,174.21111043294272,246.55658039000855,181.62222162882486,254.69572548751069L189.03333282470703,262.8348705850128" id="L-mm1-pp-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-mm1 LE-pp" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
       <path d="M397.6999969482422,151L397.6999969482422,155.16666666666666C397.6999969482422,159.33333333333334,397.6999969482422,167.66666666666666,397.6999969482422,178.16666666666666C397.6999969482422,188.66666666666666,397.6999969482422,201.33333333333334,390.28888575236004,215.8058117641688C382.87777455647785,230.27829019500427,368.05555216471356,246.55658039000855,360.64444096883136,254.69572548751069L353.2333297729492,262.8348705850128" id="L-gg1-pp-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-gg1 LE-pp" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
      </g> 
      <g class="edgeLabels"> 
       <g class="edgeLabel" transform="translate(144.56666564941406, 214)"> 
        <g class="label" transform="translate(-56.491668701171875, -13)"> 
         <foreignobject width="112.98333740234375" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="edgeLabel">Get config:prod</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="edgeLabel" transform="translate(397.6999969482422, 214)"> 
        <g class="label" transform="translate(-56.491668701171875, -13)"> 
         <foreignobject width="112.98333740234375" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="edgeLabel">Get config:prod</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="nodes"> 
       <g class="root" transform="translate(181.53333282470703, 244)"> 
        <g class="clusters"> 
         <g class="cluster default" id="pp"> 
          <rect style="" rx="0" ry="0" x="8" y="8" width="164.1999969482422" height="202"></rect> 
          <g class="cluster-label" transform="translate(50.099998474121094, 13)"> 
           <foreignobject width="80" height="26"> 
            <div style="display: inline-block; white-space: nowrap;"> 
             <span class="nodeLabel">配置服务器</span> 
            </div> 
           </foreignobject> 
          </g> 
         </g> 
        </g> 
        <g class="edgePaths"></g> 
        <g class="edgeLabels"></g> 
        <g class="nodes"> 
         <g class="node default default" id="flowchart-pp1-5160" transform="translate(90.0999984741211, 63.5)"> 
          <rect class="basic label-container" style="" rx="0" ry="0" x="-57.099998474121094" y="-20.5" width="114.19999694824219" height="41"></rect> 
          <g class="label" style="" transform="translate(-49.599998474121094, -13)"> 
           <foreignobject width="99.19999694824219" height="26"> 
            <div style="display: inline-block; white-space: nowrap;"> 
             <span class="nodeLabel">staging config</span> 
            </div> 
           </foreignobject> 
          </g> 
         </g> 
         <g class="node default default" id="flowchart-pp2-5161" transform="translate(90.0999984741211, 154.5)"> 
          <rect class="basic label-container" style="" rx="0" ry="0" x="-48.10832977294922" y="-20.5" width="96.21665954589844" height="41"></rect> 
          <g class="label" style="" transform="translate(-40.60832977294922, -13)"> 
           <foreignobject width="81.21665954589844" height="26"> 
            <div style="display: inline-block; white-space: nowrap;"> 
             <span class="nodeLabel">prod config</span> 
            </div> 
           </foreignobject> 
          </g> 
         </g> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-mm1-5162" transform="translate(144.56666564941406, 104.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-81.56666564941406" y="-46.5" width="163.13333129882812" height="93"></rect> 
        <g class="label" style="" transform="translate(-74.06666564941406, -39)"> 
         <foreignobject width="148.13333129882812" height="78"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">配置服务器<br>客户端<br>enabled profile:prod</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-gg1-5163" transform="translate(397.6999969482422, 104.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-81.56666564941406" y="-46.5" width="163.13333129882812" height="93"></rect> 
        <g class="label" style="" transform="translate(-74.06666564941406, -39)"> 
         <foreignobject width="148.13333129882812" height="78"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">配置服务器<br>客户端<br>enabled profile:prod</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>在寻找Spring的配置服务器模式下，解决方案是使用Spring Cloud Config Server，它可以保留一组配置文件，这些配置文件分布在文件夹中并通过REST API公开。在客户端，使用此依赖的项目根据其活动配置文件来访问配置服务器并请求相应的配置资源。缺点是，需要创建另外一个微服务以充当配置服务器并公开集中式文件。<br> 替代方案是使用Consul KV，这是Consul软件包中包含的功能，Spring Cloud进行集成以实现集中式配置服务器。可以通过这种方法重用组件，结合Consul的服务发现、运行状况检查和集中式配置来简化系统。</p> 
<h3><a id="Consul_991"></a>使用Consul进行配置</h3> 
<p>Consul KV是随Consul安装的键/值存储，可通过REST API和用户界面访问。将Consul设置为集群时，还可以从复制中受益，这样，由于服务无法获得其配置而导致数据丢失或停机的风险较小。<br> 在Consul用户界面中，导航到Key/Value选项卡，如图所示：<br> <img src="https://images2.imgbox.com/8a/5d/sGRO1mY0_o.png" alt="key/value"><br> 单击Create，就可以创建新的键/值对，如图所示：<br> <img src="https://images2.imgbox.com/48/e2/5u7eW9jf_o.png" alt="create"><br> 可使用切换按钮在代码和普通编辑器之间切换。代码编辑器支持几种符号的语法分色，包括json、hcl和yaml等。<br> Consul KV REST API允许通过HTTP调用创建键/值对和文件夹，并使用键名进行检索，和服务发现一样，不需要使用REST API进行交互，Spring Cloud Consul Config进行了抽象，方便使用。</p> 
<h3><a id="Spring_Cloud_Consul_Config_999"></a>Spring Cloud Consul Config</h3> 
<p>使用Consul KV实现集中式配置需要Spring Cloud Consul Config支持，要向项目中添加spring-cloud-starter-consul-config依赖，它包括自动配置类，这些类将在应用程序早期阶段尝试查找Consul代理并读取相应的KV值，之所以使用此阶段，是希望Spring Boot在其余的初始化过程中应用集中式配置值（如，连接到RabbitMQ）。<br> Spring Cloud Consul Config希望每个配置文件都映射到KV存储中的给定键，其值是一组Spring Boot配置值，格式为YAML或纯格式（.properties）。<br> 可以配置一些值，以帮助应用程序在服务器中找到相应的键，下面是最相关的设置：</p> 
<ul><li>前缀：Consul KV中存储所有配置文件的根文件夹，默认为config。</li><li>格式：指定值采用YAML还是properties语法。</li><li>默认上下文：所有应用程序用作公用属性的文件夹名称。</li><li>配置文件分隔符：键可以组合多个配置文件。这种情况下，可指定要用作分隔符的字符（例如，用逗号分隔的prod,extra-logging）。</li><li>数据键：保存属性或YAML内容的键名。</li></ul> 
<p>对于每个应用程序，必须将与配置服务器相关的所有配置值都放在一个单独的文件中，文件名为bootstrap.yml或bootstrap.properties。如图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-6P5RKKoJI8PiIMNY" width="736.5833129882812" xmlns="http://www.w3.org/2000/svg" height="502" viewbox="0 0 736.5833129882812 502" class="mermaid-svg"> 
  <style>#mermaid-svg-6P5RKKoJI8PiIMNY {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-6P5RKKoJI8PiIMNY .error-icon{fill:#552222;}#mermaid-svg-6P5RKKoJI8PiIMNY .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-6P5RKKoJI8PiIMNY .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-6P5RKKoJI8PiIMNY .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-6P5RKKoJI8PiIMNY .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-6P5RKKoJI8PiIMNY .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-6P5RKKoJI8PiIMNY .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-6P5RKKoJI8PiIMNY .marker{fill:#333333;stroke:#333333;}#mermaid-svg-6P5RKKoJI8PiIMNY .marker.cross{stroke:#333333;}#mermaid-svg-6P5RKKoJI8PiIMNY svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-6P5RKKoJI8PiIMNY .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-6P5RKKoJI8PiIMNY .cluster-label text{fill:#333;}#mermaid-svg-6P5RKKoJI8PiIMNY .cluster-label span{color:#333;}#mermaid-svg-6P5RKKoJI8PiIMNY .label text,#mermaid-svg-6P5RKKoJI8PiIMNY span{fill:#333;color:#333;}#mermaid-svg-6P5RKKoJI8PiIMNY .node rect,#mermaid-svg-6P5RKKoJI8PiIMNY .node circle,#mermaid-svg-6P5RKKoJI8PiIMNY .node ellipse,#mermaid-svg-6P5RKKoJI8PiIMNY .node polygon,#mermaid-svg-6P5RKKoJI8PiIMNY .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-6P5RKKoJI8PiIMNY .node .label{text-align:center;}#mermaid-svg-6P5RKKoJI8PiIMNY .node.clickable{cursor:pointer;}#mermaid-svg-6P5RKKoJI8PiIMNY .arrowheadPath{fill:#333333;}#mermaid-svg-6P5RKKoJI8PiIMNY .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-6P5RKKoJI8PiIMNY .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-6P5RKKoJI8PiIMNY .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-6P5RKKoJI8PiIMNY .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-6P5RKKoJI8PiIMNY .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-6P5RKKoJI8PiIMNY .cluster text{fill:#333;}#mermaid-svg-6P5RKKoJI8PiIMNY .cluster span{color:#333;}#mermaid-svg-6P5RKKoJI8PiIMNY div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-6P5RKKoJI8PiIMNY :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"> 
     <g class="cluster default" id="m"> 
      <rect style="" rx="0" ry="0" x="50.48332977294922" y="8" width="599.875" height="117"></rect> 
      <g class="cluster-label" transform="translate(301.1708297729492, 13)"> 
       <foreignobject width="98.5" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Multiplication</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="edgePaths"> 
     <path d="M305.2999954223633,78.02689440704825L273.03888448079425,85.85574533920688C240.77777353922525,93.68459627136549,176.25555165608725,109.34229813568275,143.99444071451822,125.67114906784138C111.73332977294922,142,111.73332977294922,159,111.73332977294922,186.16666666666666C111.73332977294922,213.33333333333334,111.73332977294922,250.66666666666666,111.73332977294922,269.3333333333333L111.73332977294922,288" id="L-m1-b-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m1 LE-b" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M352.7999954223633,100L352.7999954223633,104.16666666666667C352.7999954223633,108.33333333333333,352.7999954223633,116.66666666666667,352.7999954223633,129.33333333333334C352.7999954223633,142,352.7999954223633,159,352.7999954223633,192.66666666666666C352.7999954223633,226.33333333333334,352.7999954223633,276.6666666666667,352.7999954223633,301.8333333333333L352.7999954223633,327" id="L-m1-b1-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m1 LE-b1" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M400.2999954223633,77.34143442717374L435.10138448079425,85.28452868931144C469.9027735392253,93.22762295144916,539.5055516560873,109.11381147572457,574.3069407145182,125.55690573786228C609.1083297729492,142,609.1083297729492,159,609.1083297729492,176C609.1083297729492,193,609.1083297729492,210,609.1083297729492,218.5L609.1083297729492,227" id="L-m1-p-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-m1 LE-p" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(111.73332977294922, 176)"> 
      <g class="label" transform="translate(-4.1916656494140625, -13)"> 
       <foreignobject width="8.383331298828125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">1</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(352.7999954223633, 176)"> 
      <g class="label" transform="translate(-4.1916656494140625, -13)"> 
       <foreignobject width="8.383331298828125" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">2</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(609.1083297729492, 176)"> 
      <g class="label" transform="translate(-64, -26)"> 
       <foreignobject width="128" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">2<br>从服务器检索配置</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="node default default" id="flowchart-m1-5193" transform="translate(352.7999954223633, 66.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-47.5" y="-33.5" width="95" height="67"></rect> 
      <g class="label" style="" transform="translate(-40, -26)"> 
       <foreignobject width="80" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">配置服务器<br>客户端</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="root" transform="translate(482.6333312988281, 219)"> 
      <g class="clusters"> 
       <g class="cluster default" id="p"> 
        <rect style="" rx="0" ry="0" x="8" y="8" width="237.9499969482422" height="267"></rect> 
        <g class="cluster-label" transform="translate(86.9749984741211, 13)"> 
         <foreignobject width="80" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">配置服务器</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="edgePaths"></g> 
      <g class="edgeLabels"></g> 
      <g class="nodes"> 
       <g class="node default default" id="flowchart-p1-5192" transform="translate(126.9749984741211, 141.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-93.9749984741211" y="-98.5" width="187.9499969482422" height="197"></rect> 
        <g class="label" style="" transform="translate(-86.4749984741211, -91)"> 
         <foreignobject width="172.9499969482422" height="182"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">config/<br> defaults/<br> application.yml<br> key1:<br> subkey: value<br> defaults,multiplication/<br> application.yml</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b-5195" transform="translate(111.73332977294922, 360.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-103.73332977294922" y="-72.5" width="207.46665954589844" height="145"></rect> 
      <g class="label" style="" transform="translate(-96.23332977294922, -65)"> 
       <foreignobject width="192.46665954589844" height="130"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">bootstrap.properties<br>prefix = config<br>default-context = defaults<br>data-key = application.yml<br>format = yaml</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b1-5197" transform="translate(352.7999954223633, 360.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-87.33333587646484" y="-33.5" width="174.6666717529297" height="67"></rect> 
      <g class="label" style="" transform="translate(-79.83333587646484, -26)"> 
       <foreignobject width="159.6666717529297" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">application.properties<br>...</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<p>注意，连接到配置服务器的应用程序配置（bootstrap）和将本地属性（application）与那些从配置服务器下载的属性合并所产生的应用程序配置之间存在差异。第一种配置是元配置，无法从服务器下载，必须将这些值复制到项目中相应的引导程序配置文件中。下面通过实例来看看它们是如何工作的。</p> 
<h3><a id="_1023"></a>实现集中式配置</h3> 
<p>首先，需要在微服务项目中添加启动器：spring-cloud-starter-consul-config。代码如下：</p> 
<pre><code class="prism language-xml">        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.cloud<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-cloud-starter-consul-config<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>这样，应用程序会尝试在引导阶段连接到Consul，并使用KV自动配置中提供的默认值从KV存储中获取配置文件属性。这里会改变某些设置，以便了解其中的原理。<br> 在Multiplication和Gamification项目在，使用的是properties格式，为保持一致，在同一文件夹中创建一个单独的文件bootstrap.properties，这两个项目中使用相同的设置，代码如下：</p> 
<pre><code class="prism language-properties">spring.cloud.consul.config.prefix=config
spring.cloud.consul.config.format=yaml
spring.cloud.consul.config.default-context=defaults
spring.cloud.consul.config.data-key=application.yml
</code></pre> 
<p>这里，选择yaml作为远程配置的格式，本地文件为.properties格式，这没问题，Spring Cloud Consul Config可合并远程application.yml键中包含的值和不同格式本地存储的值。<br> 在Gateway项目中，创建等效的bootstrap.yml文件，使用yaml进行配置，如下所示：</p> 
<pre><code class="prism language-yaml"><span class="token key atrule">spring</span><span class="token punctuation">:</span>
  <span class="token key atrule">cloud</span><span class="token punctuation">:</span>
    <span class="token key atrule">consul</span><span class="token punctuation">:</span>
      <span class="token key atrule">config</span><span class="token punctuation">:</span>
        <span class="token key atrule">prefix</span><span class="token punctuation">:</span> config
        <span class="token key atrule">format</span><span class="token punctuation">:</span> yaml
        <span class="token key atrule">default-context</span><span class="token punctuation">:</span> defaults
        <span class="token key atrule">data-key</span><span class="token punctuation">:</span> application.yml
</code></pre> 
<p>使用这些设置，目的是将所有配置存储在Consul KV中名为config的根文件夹中。在内部有一个defaults文件夹，其中可能包含名为application.yml的键，其配置适用于所有微服务。可为每个应用程序或要使用的应用程序和配置文件组合设置额外的文件夹，且每个文件夹都可能包含application.yml键已经应添加或覆盖的属性。为避免在配置服务器中混淆格式，应统一使用yaml格式。现在，将bootstrap文件添加到Multiplication、Gamification和Gateway项目中，以便它们可以连接到配置服务器并查找外部化的配置（如果有），而且添加了Spring Cloud Consul Config启动器依赖。<br> 下面，可创建如下所示的层次结构作为Consul KV中的文件夹和键，例如：</p> 
<pre><code class="prism language-java"><span class="token operator">+</span><span class="token operator">-</span> config
<span class="token operator">|</span> <span class="token operator">+</span><span class="token operator">-</span> defaults
<span class="token operator">|</span>    \<span class="token operator">-</span> application<span class="token punctuation">.</span>yml
<span class="token operator">|</span> <span class="token operator">+</span><span class="token operator">-</span> defaults<span class="token punctuation">,</span>production
<span class="token operator">|</span>    \<span class="token operator">-</span> application<span class="token punctuation">.</span>yml
<span class="token operator">|</span> <span class="token operator">+</span><span class="token operator">-</span> defaults<span class="token punctuation">,</span>rabbitmq<span class="token operator">-</span>production
<span class="token operator">|</span>    \<span class="token operator">-</span> application<span class="token punctuation">.</span>yml
<span class="token operator">|</span> <span class="token operator">+</span><span class="token operator">-</span> defaults<span class="token punctuation">,</span>database<span class="token operator">-</span>production
<span class="token operator">|</span>    \<span class="token operator">-</span> application<span class="token punctuation">.</span>yml
<span class="token operator">|</span> <span class="token operator">+</span><span class="token operator">-</span> multiplication<span class="token punctuation">,</span>production
<span class="token operator">|</span>    \<span class="token operator">-</span> application<span class="token punctuation">.</span>yml
<span class="token operator">|</span> <span class="token operator">+</span><span class="token operator">-</span> gamification<span class="token punctuation">,</span>production
<span class="token operator">|</span>    \<span class="token operator">-</span> application<span class="token punctuation">.</span>yml
</code></pre> 
<p>在Consul界面中，进入Key/Value选项卡，单击Create，如图所示：<br> <img src="https://images2.imgbox.com/a9/80/V8Wpladb_o.png" alt="create"><br> 然后，输入config/以创建与设置中的名称相同的根文件夹，如图所示：<br> <img src="https://images2.imgbox.com/7a/82/JfIEGvFr_o.png" alt="config"><br> 单击新创建的项目，导航到config文件夹，如图所示：<br> <img src="https://images2.imgbox.com/9d/60/BhxX8GX5_o.png" alt="导航"><br> <img src="https://images2.imgbox.com/d3/1b/cdhVEIkq_o.png" alt="config"><br> 在config文件夹下创建defaults文件夹，如图所示：<br> <img src="https://images2.imgbox.com/ad/41/g4l6Hjyf_o.png" alt="defaults"><br> 导航到config/defaults文件夹，内容为空，在此文件夹下创建一个名为application.yml的键，默认情况下，将要应用于所有应用程序的值放在这里。<br> <img src="https://images2.imgbox.com/31/ac/l6dqO9BD_o.png" alt="application.yml"><br> 那么，如果运行Multiplication应用程序时使用的活动配置文件列表等于production、rabbitmq-production、database-production，处理顺序如下（按优先级从低到高排列）：</p> 
<ol><li>基线值是访问配置服务器的项目的本地application.properties中包含的值，这里是Multiplication。</li><li>然后，Spring Boot合并和覆盖defaults文件夹内application.yml键中包含的远程值，因为它适用于所有服务。</li><li>接着是合并所有活动配置文件的默认值。活动配置文件指所有与defaults,{profile}模式匹配的文件：defaults,production、defaults,rabbitmq-production、defaults,database-production。注意，如果指定了多个配置文件，则优先处理最后一个配置文件的值。</li><li>最后，会按模式{application},{profile}为相应的应用程序名称和活动配置文件查找更具体的设置。这里，multiplication,production键匹配该模式，将合并其配置值。优先顺序与之前相同，优先处理枚举中的最后一个配置文件。</li></ol> 
<p>结构化配置值的方法如下：</p> 
<ul><li>当要为所有环境的全部应用程序添加全局配置时，使用defaults。</li><li>使用defaults,{profile}，其配置文件名称代表{tool}-{environment}对，为每种环境设置给定工具的通用值，如rabbitmq-production。</li><li>使用配置文件名称为{environment}的{application},{profile}为给定环境中的应用程序设置特定设置，如multiplication,production。</li></ul> 
<h3><a id="_1089"></a>集中配置实践</h3> 
<p>前面已经在项目中添加了启动器依赖：spring-cloud-starter-consul-config，而且配置了bootstrap属性文件（Spring Cloud Consul 4.1.0不需要了，这些配置可以放在application属性文件中），用于覆盖某些Consul Config默认配置。要启动Multiplication，需要在application.properties中添加下列配置：</p> 
<pre><code class="prism language-properties">spring.config.import=optional:consul:
spring.cloud.consul.config.prefix=config
spring.cloud.consul.config.format=yaml
spring.cloud.consul.config.default-context=defaults
spring.cloud.consul.config.data-key=application.yml
</code></pre> 
<p>在Consul KV中创建配置：config/defaults/application.yml，值为：</p> 
<pre><code class="prism language-yml"><span class="token key atrule">logging</span><span class="token punctuation">:</span>
  <span class="token key atrule">level</span><span class="token punctuation">:</span>
    <span class="token key atrule">org.springframework.core.env</span><span class="token punctuation">:</span> DEBUG
    <span class="token key atrule">org.springframework.amqp.rabbit.core.RabbitAdmin</span><span class="token punctuation">:</span> DEBUG
</code></pre> 
<p>重启Multiplication应用程序，可以在日志中看到对应的配置在起作用：</p> 
<pre><code class="prism language-java"><span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">23</span><span class="token constant">T15</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">47.110</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">DEBUG</span> <span class="token number">39172</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>multiplication<span class="token punctuation">]</span> <span class="token punctuation">[</span>           main<span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>c<span class="token punctuation">.</span>e<span class="token punctuation">.</span></span>PropertySourcesPropertyResolver</span>  <span class="token operator">:</span> <span class="token class-name">Found</span> key 'spring<span class="token punctuation">.</span>application<span class="token punctuation">.</span>name' in <span class="token class-name">PropertySource</span> 'environmentProperties' <span class="token keyword">with</span> <span class="token namespace">value</span> of type <span class="token class-name">String</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">23</span><span class="token constant">T15</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">47.481</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">DEBUG</span> <span class="token number">39172</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>multiplication<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.234</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>RabbitAdmin</span>         <span class="token operator">:</span> <span class="token class-name">Initializing</span> declarations
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">23</span><span class="token constant">T15</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">47.494</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">DEBUG</span> <span class="token number">39172</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>multiplication<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.234</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>RabbitAdmin</span>         <span class="token operator">:</span> declaring <span class="token class-name">Exchange</span> 'attempts<span class="token punctuation">.</span>topic'
<span class="token number">2023</span><span class="token operator">-</span><span class="token number">12</span><span class="token operator">-</span><span class="token number">23</span><span class="token constant">T15</span><span class="token operator">:</span><span class="token number">17</span><span class="token operator">:</span><span class="token number">47.497</span><span class="token operator">+</span><span class="token number">08</span><span class="token operator">:</span><span class="token number">00</span> <span class="token constant">DEBUG</span> <span class="token number">39172</span> <span class="token operator">--</span><span class="token operator">-</span> <span class="token punctuation">[</span>multiplication<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token number">192.168</span><span class="token number">.1</span><span class="token number">.234</span><span class="token punctuation">]</span> <span class="token class-name"><span class="token namespace">o<span class="token punctuation">.</span>s<span class="token punctuation">.</span>amqp<span class="token punctuation">.</span>rabbit<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>RabbitAdmin</span>         <span class="token operator">:</span> <span class="token class-name">Declarations</span> finished
<span class="token number">2</span>
</code></pre> 
<p>配置config/multiplication/application.yml，设置值为：</p> 
<pre><code class="prism language-yml"><span class="token key atrule">server</span><span class="token punctuation">:</span>
  <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">10080</span>
</code></pre> 
<p>重启Multiplication应用程序，可以发现其服务器端口已变为10080了，配置发生作用了。可以使用下列命令使应用程序启用某些配置文件：</p> 
<pre><code class="prism language-bash"><span class="token operator">&gt;</span> mvn spring-boot:run -D<span class="token string">"spring-boot.run.arguments"</span><span class="token operator">=</span><span class="token string">"--spring.profiles.active=production,rabbitmq-production"</span>
</code></pre> 
<p>现在，完成了集中式配置，使用Consul KV功能，如下图所示：</p> 
<div class="mermaid"> 
 <svg id="mermaid-svg-ldnTqPArs5FMdFyx" width="612.300048828125" xmlns="http://www.w3.org/2000/svg" height="1050" viewbox="0 0 612.300048828125 1050" class="mermaid-svg"> 
  <style>#mermaid-svg-ldnTqPArs5FMdFyx {font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;fill:#333;}#mermaid-svg-ldnTqPArs5FMdFyx .error-icon{fill:#552222;}#mermaid-svg-ldnTqPArs5FMdFyx .error-text{fill:#552222;stroke:#552222;}#mermaid-svg-ldnTqPArs5FMdFyx .edge-thickness-normal{stroke-width:2px;}#mermaid-svg-ldnTqPArs5FMdFyx .edge-thickness-thick{stroke-width:3.5px;}#mermaid-svg-ldnTqPArs5FMdFyx .edge-pattern-solid{stroke-dasharray:0;}#mermaid-svg-ldnTqPArs5FMdFyx .edge-pattern-dashed{stroke-dasharray:3;}#mermaid-svg-ldnTqPArs5FMdFyx .edge-pattern-dotted{stroke-dasharray:2;}#mermaid-svg-ldnTqPArs5FMdFyx .marker{fill:#333333;stroke:#333333;}#mermaid-svg-ldnTqPArs5FMdFyx .marker.cross{stroke:#333333;}#mermaid-svg-ldnTqPArs5FMdFyx svg{font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:16px;}#mermaid-svg-ldnTqPArs5FMdFyx .label{font-family:"trebuchet ms",verdana,arial,sans-serif;color:#333;}#mermaid-svg-ldnTqPArs5FMdFyx .cluster-label text{fill:#333;}#mermaid-svg-ldnTqPArs5FMdFyx .cluster-label span{color:#333;}#mermaid-svg-ldnTqPArs5FMdFyx .label text,#mermaid-svg-ldnTqPArs5FMdFyx span{fill:#333;color:#333;}#mermaid-svg-ldnTqPArs5FMdFyx .node rect,#mermaid-svg-ldnTqPArs5FMdFyx .node circle,#mermaid-svg-ldnTqPArs5FMdFyx .node ellipse,#mermaid-svg-ldnTqPArs5FMdFyx .node polygon,#mermaid-svg-ldnTqPArs5FMdFyx .node path{fill:#ECECFF;stroke:#9370DB;stroke-width:1px;}#mermaid-svg-ldnTqPArs5FMdFyx .node .label{text-align:center;}#mermaid-svg-ldnTqPArs5FMdFyx .node.clickable{cursor:pointer;}#mermaid-svg-ldnTqPArs5FMdFyx .arrowheadPath{fill:#333333;}#mermaid-svg-ldnTqPArs5FMdFyx .edgePath .path{stroke:#333333;stroke-width:2.0px;}#mermaid-svg-ldnTqPArs5FMdFyx .flowchart-link{stroke:#333333;fill:none;}#mermaid-svg-ldnTqPArs5FMdFyx .edgeLabel{background-color:#e8e8e8;text-align:center;}#mermaid-svg-ldnTqPArs5FMdFyx .edgeLabel rect{opacity:0.5;background-color:#e8e8e8;fill:#e8e8e8;}#mermaid-svg-ldnTqPArs5FMdFyx .cluster rect{fill:#ffffde;stroke:#aaaa33;stroke-width:1px;}#mermaid-svg-ldnTqPArs5FMdFyx .cluster text{fill:#333;}#mermaid-svg-ldnTqPArs5FMdFyx .cluster span{color:#333;}#mermaid-svg-ldnTqPArs5FMdFyx div.mermaidTooltip{position:absolute;text-align:center;max-width:200px;padding:2px;font-family:"trebuchet ms",verdana,arial,sans-serif;font-size:12px;background:hsl(80, 100%, 96.2745098039%);border:1px solid #aaaa33;border-radius:2px;pointer-events:none;z-index:100;}#mermaid-svg-ldnTqPArs5FMdFyx :root{--mermaid-font-family:"trebuchet ms",verdana,arial,sans-serif;}</style> 
  <g transform="translate(0, 0)"> 
   <marker id="flowchart-pointEnd" class="marker flowchart" viewbox="0 0 10 10" refx="9" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 0 L 10 5 L 0 10 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-pointStart" class="marker flowchart" viewbox="0 0 10 10" refx="0" refy="5" markerunits="userSpaceOnUse" markerwidth="12" markerheight="12" orient="auto"> 
    <path d="M 0 5 L 10 10 L 10 0 z" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-circleEnd" class="marker flowchart" viewbox="0 0 10 10" refx="11" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-circleStart" class="marker flowchart" viewbox="0 0 10 10" refx="-1" refy="5" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <circle cx="5" cy="5" r="5" class="arrowMarkerPath" style="stroke-width: 1px; stroke-dasharray: 1px, 0px;"></circle> 
   </marker> 
   <marker id="flowchart-crossEnd" class="marker cross flowchart" viewbox="0 0 11 11" refx="12" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <marker id="flowchart-crossStart" class="marker cross flowchart" viewbox="0 0 11 11" refx="-1" refy="5.2" markerunits="userSpaceOnUse" markerwidth="11" markerheight="11" orient="auto"> 
    <path d="M 1,1 l 9,9 M 10,1 l -9,9" class="arrowMarkerPath" style="stroke-width: 2px; stroke-dasharray: 1px, 0px;"></path> 
   </marker> 
   <g class="root"> 
    <g class="clusters"></g> 
    <g class="edgePaths"> 
     <path d="M334.4375114440918,49L334.4375114440918,59.666666666666664C334.4375114440918,70.33333333333333,334.4375114440918,91.66666666666667,334.4375114440918,113C334.4375114440918,134.33333333333334,334.4375114440918,155.66666666666666,334.4375114440918,166.33333333333334L334.4375114440918,177" id="L-b-g-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-b LE-g" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M234.15000915527344,951L234.15000915527344,955.1666666666666C234.15000915527344,959.3333333333334,234.15000915527344,967.6666666666666,277.98889923095703,978.1337816937463C321.8277893066406,988.600896720826,409.5055694580078,1001.2017934416521,453.3444595336914,1007.502241802065L497.183349609375,1013.802690162478" id="L-ga-ga1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-ga LE-ga1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M559.7526729709499,1001L561.5841748024517,996.8333333333334C563.4156766339536,992.6666666666666,567.0786802969573,984.3333333333334,521.7379587194422,973.789990338128C476.39723714192706,963.2466473429225,382.05279032389325,950.493294685845,334.8805669148763,944.1166183573063L287.7083435058594,937.7399420287674" id="L-ga1-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-ga1 LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M310.9375114440918,214.25433091514276L298.1395943959554,223.37860909595233C285.34167734781903,232.50288727676184,259.7458432515462,250.75144363838092,246.94792620340982,268.37572181919046C234.15000915527344,286,234.15000915527344,303,234.15000915527344,311.5L234.15000915527344,320" id="L-g-m-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-m" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M310.9375114440918,203.64472680639614L269.2798709869385,214.53727233866346C227.62223052978516,225.42981787093075,144.30694961547852,247.2149089354654,102.6493091583252,270.02412113439937C60.991668701171875,292.8333333333333,60.991668701171875,316.6666666666667,60.991668701171875,338.3333333333333C60.991668701171875,360,60.991668701171875,379.5,60.991668701171875,399C60.991668701171875,418.5,60.991668701171875,438,60.991668701171875,459.6666666666667C60.991668701171875,481.3333333333333,60.991668701171875,505.1666666666667,60.991668701171875,544.5833333333334C60.991668701171875,584,60.991668701171875,639,60.991668701171875,694C60.991668701171875,749,60.991668701171875,804,81.57692595795318,840C102.1621832147345,876,143.3326977282971,893,163.9179549850784,901.5L184.5032122418597,910" id="L-g-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M357.9375114440918,205.26799624554968L390.07154019673663,215.8899968712914C422.20556894938153,226.51199749703312,486.4736264546712,247.7559987485166,518.607655207316,270.29466604092494C550.7416839599609,292.8333333333333,550.7416839599609,316.6666666666667,550.7416839599609,338.3333333333333C550.7416839599609,360,550.7416839599609,379.5,550.7416839599609,399C550.7416839599609,418.5,550.7416839599609,438,550.7416839599609,459.6666666666667C550.7416839599609,481.3333333333333,550.7416839599609,505.1666666666667,550.7416839599609,544.5833333333334C550.7416839599609,584,550.7416839599609,639,550.7416839599609,694C550.7416839599609,749,550.7416839599609,804,550.7416839599609,843.4166666666666C550.7416839599609,882.8333333333334,550.7416839599609,906.6666666666666,550.7416839599609,926.1666666666666C550.7416839599609,945.6666666666666,550.7416839599609,960.8333333333334,550.7416839599609,972.5833333333334C550.7416839599609,984.3333333333334,550.7416839599609,992.6666666666666,550.7416839599609,996.8333333333334L550.7416839599609,1001" id="L-g-ga1-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-ga1" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M234.15000915527344,361L234.15000915527344,367.3333333333333C234.15000915527344,373.6666666666667,234.15000915527344,386.3333333333333,234.23334248860678,399.0833333333333C234.3166758219401,411.8333333333333,234.48334248860678,424.6666666666667,234.5666758219401,431.0833333333333L234.65000915527347,437.50000000000006" id="L-m-at1-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-m LE-at1" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M234.6500091552734,478.49999999999994L234.56667582194007,486.9166666666666C234.48334248860678,495.3333333333333,234.3166758219401,512.1666666666666,234.23334248860678,541.3746401468912C234.15000915527344,570.5826136271158,234.15000915527344,612.1652272542318,234.15000915527344,632.9565340677897L234.15000915527344,653.7478408813477" id="L-at1-q-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-at1 LE-q" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M234.15000915527344,734.2521591186523L234.15000915527344,755.0434659322103C234.15000915527344,775.8347727457682,234.15000915527344,817.4173863728842,234.15000915527344,846.708693186442C234.15000915527344,876,234.15000915527344,893,234.15000915527344,901.5L234.15000915527344,910" id="L-q-ga-0" class=" edge-thickness-normal edge-pattern-dotted flowchart-link LS-q LE-ga" style="fill:none;stroke-width:2px;stroke-dasharray:3;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M357.9375114440918,214.25433091514276L370.7354284922282,223.37860909595233C383.53334554036456,232.50288727676184,409.1291796366374,250.75144363838092,421.92709668477374,271.79238848585715C434.72501373291016,292.8333333333333,434.72501373291016,316.6666666666667,434.72501373291016,338.3333333333333C434.72501373291016,360,434.72501373291016,379.5,434.72501373291016,399C434.72501373291016,418.5,434.72501373291016,438,434.72501373291016,459.6666666666667C434.72501373291016,481.3333333333333,434.72501373291016,505.1666666666667,434.72501373291016,525.5833333333334C434.72501373291016,546,434.72501373291016,563,434.72501373291016,571.5L434.72501373291016,580" id="L-g-r-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-g LE-r" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
     <path d="M434.72501373291016,808L434.72501373291016,816.5C434.72501373291016,825,434.72501373291016,842,410.22223536173504,859.2346310036397C385.7194569905599,876.4692620072797,336.71390024820965,893.9385240145593,312.2111218770345,902.673155018199L287.7083435058594,911.4077860218389" id="L-r-ga-0" class=" edge-thickness-normal edge-pattern-solid flowchart-link LS-r LE-ga" style="fill:none;" marker-end="url(#flowchart-pointEnd)"></path> 
    </g> 
    <g class="edgeLabels"> 
     <g class="edgeLabel" transform="translate(334.4375114440918, 113)"> 
      <g class="label" transform="translate(-50.93333435058594, -39)"> 
       <foreignobject width="101.86666870117188" height="78"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名<br>-获取排行榜</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(234.15000915527344, 269)"> 
      <g class="label" transform="translate(-50.93333435058594, -26)"> 
       <foreignobject width="101.86666870117188" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-发送尝试<br>-获取用户别名</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(60.991668701171875, 457.5)"> 
      <g class="label" transform="translate(-52.991668701171875, -13)"> 
       <foreignobject width="105.98333740234375" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜(1)</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(550.7416839599609, 529)"> 
      <g class="label" transform="translate(-52.991668701171875, -26)"> 
       <foreignobject width="105.98333740234375" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">-获取排行榜(2)<br>X</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel"> 
      <g class="label" transform="translate(0, 0)"> 
       <foreignobject width="0" height="0"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel"></span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(434.72501373291016, 399)"> 
      <g class="label" transform="translate(-48, -13)"> 
       <foreignobject width="96" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">查找服务实例</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="edgeLabel" transform="translate(434.72501373291016, 859)"> 
      <g class="label" transform="translate(-56.383331298828125, -26)"> 
       <foreignobject width="112.76666259765625" height="52"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="edgeLabel">运行状况检查<br>（每隔10秒钟）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
    <g class="nodes"> 
     <g class="root" transform="translate(346.2083435058594, 572)"> 
      <g class="clusters"> 
       <g class="cluster default" id="r"> 
        <rect style="" rx="0" ry="0" x="8" y="8" width="162.03334045410156" height="228"></rect> 
        <g class="cluster-label" transform="translate(29.166671752929688, 13)"> 
         <foreignobject width="119.69999694824219" height="104"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">服务注册表<br>配置服务器<br>Consul Discovery<br>&amp; Consul KV</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
      <g class="edgePaths"></g> 
      <g class="edgeLabels"></g> 
      <g class="nodes"> 
       <g class="node default default" id="flowchart-r1-5230" transform="translate(89.01667022705078, 63.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-51.10832977294922" y="-20.5" width="102.21665954589844" height="41"></rect> 
        <g class="label" style="" transform="translate(-43.60832977294922, -13)"> 
         <foreignobject width="87.21665954589844" height="26"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">Srv. Registry</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
       <g class="node default default" id="flowchart-r2-5231" transform="translate(89.01667022705078, 167.5)"> 
        <rect class="basic label-container" style="" rx="0" ry="0" x="-56.01667022705078" y="-33.5" width="112.03334045410156" height="67"></rect> 
        <g class="label" style="" transform="translate(-48.51667022705078, -26)"> 
         <foreignobject width="97.03334045410156" height="52"> 
          <div style="display: inline-block; white-space: nowrap;"> 
           <span class="nodeLabel">Centralized<br>Configuration</span> 
          </div> 
         </foreignobject> 
        </g> 
       </g> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-b-5227" transform="translate(334.4375114440918, 28.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-31.5" y="-20.5" width="63" height="41"></rect> 
      <g class="label" style="" transform="translate(-24, -13)"> 
       <foreignobject width="48" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">浏览器</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-g-5229" transform="translate(334.4375114440918, 197.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-23.5" y="-20.5" width="47" height="41"></rect> 
      <g class="label" style="" transform="translate(-16, -13)"> 
       <foreignobject width="32" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">网关</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-ga1-5234" transform="translate(550.7416839599609, 1021.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-20.5" width="107.11666870117188" height="41"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -13)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-ga-5235" transform="translate(234.15000915527344, 930.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-53.55833435058594" y="-20.5" width="107.11666870117188" height="41"></rect> 
      <g class="label" style="" transform="translate(-46.05833435058594, -13)"> 
       <foreignobject width="92.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-m-5239" transform="translate(234.15000915527344, 340.5)"> 
      <rect class="basic label-container" style="" rx="0" ry="0" x="-56.75" y="-20.5" width="113.5" height="41"></rect> 
      <g class="label" style="" transform="translate(-49.25, -13)"> 
       <foreignobject width="98.5" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Multiplication</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-at1-5244" transform="translate(234.15000915527344, 457.5)"> 
      <polygon points="-13.666666666666666,0 136.16666666666666,0 156.66666666666666,-41 6.833333333333333,-41" class="label-container" transform="translate(-71.5,20.5)" style=""></polygon> 
      <g class="label" style="" transform="translate(-64, -13)"> 
       <foreignobject width="128" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">尝试（主题交换）</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
     <g class="node default default" id="flowchart-q-5245" transform="translate(234.15000915527344, 694)"> 
      <path style="" d="M 0,13.168107619380502 a 69.55833435058594,13.168107619380502 0,0,0 139.11666870117188 0 a 69.55833435058594,13.168107619380502 0,0,0 -139.11666870117188 0 l 0,54.1681076193805 a 69.55833435058594,13.168107619380502 0,0,0 139.11666870117188 0 l 0,-54.1681076193805" transform="translate(-69.55833435058594,-40.25216142907075)"></path> 
      <g class="label" style="" transform="translate(-62.05833435058594, -13)"> 
       <foreignobject width="124.11666870117188" height="26"> 
        <div style="display: inline-block; white-space: nowrap;"> 
         <span class="nodeLabel">Gamification队列</span> 
        </div> 
       </foreignobject> 
      </g> 
     </g> 
    </g> 
   </g> 
  </g> 
 </svg> 
</div> 
<blockquote> 
 <p>请注意，应用程序在启动时与配置服务器存在依赖关系，为避免单点故障，可将Consul配置为生产环境中高度可用。</p> 
</blockquote> 
<h2><a id="_1150"></a>小结</h2> 
<p>为了使系统具有可扩展性和弹性，使用Spring Cloud Consul集成，Spring Boot的自动配置能快速建立与Consul的连接，能够提供服务发现和集中式配置功能，方便动态集成，易于实现。而且，从前面的示例可以看出，不需要编写代码，即可获得开箱即用的功能，当然，如果需要更高级的功能，需要深入学习。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d87b5a3a7914e74ee4bf3232796e2e22/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">LiveGBS流媒体平台GB/T28181常见问题-国标编号是什么设备编号和通道国标编号标记唯一的摄像头|视频|镜头通道</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/27773082fce0c2938decb800286655c3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Weblogic安全漫谈（四）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>