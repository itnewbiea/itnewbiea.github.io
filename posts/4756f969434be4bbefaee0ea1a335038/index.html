<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>认证授权：OAuth2简介及四种授权模型详解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="认证授权：OAuth2简介及四种授权模型详解" />
<meta property="og:description" content="文章目录 @[toc]简介一、OAuth2 授权总体流程1.认证流程2.四种角色：3.四种授权模式 二、授权码模式（Authorization Code Grant）1.Client Side2.Server Side3.Check Access Token 三、隐式授权模式（Implicit Grant）Client SideCheck Access Token 四、密码模式（Resource Owner Password Credentials Grant）Client SideCheck Access Token 五、客户端模式（Client Credentials Grant）1.Server Side2. Check Access Token 六、授权模式的选型其他 简介 如今很多互联网应用中，OAuth2 是一个非常重要的认证协议，很多场景下都会用到它，Spring Security 对 OAuth2 协议提供了相应的支持。开发者非常方便的使用 OAuth2 协议
OAuth 是一个开放标准，该标准允许用户让第三方应用访问该用户在某一网站上存储的私密资源 （如头像、照片、视频等），并且在这个过程中无须将用户名和密码提供给第三方应用。通过令牌 （token） 可以实现这一功能。每一个令牌授权一个特定的网站在特定的时间段内允许可访问特定的资源。OAuth 让用户可以授权第三方网站灵活访问它们存储在另外一些资源服务器上的特定信息，而非所有的内容。对于用户而言，我们在互联网应用中最常见的 OAuth 应用就是各种第三方登录，例如 QQ授权登录、微信授权登录、微博授权登录、GitHub 授权登录等。
例如用户想登录 Ruby China ，传统方式是使用用户名和密码但是这样并不安全，因为网站会存储你的用户名密码，这样可能会导致密码泄露。这种授权方式安全隐患很大如果使用 OAuth 协议就能很好地解决这一问题。
oAuth2协议解决了多个网站登录问题，账号密码不安全的问题，比如一些小众的网站就可以不用注册登录，使用 oAuth2，也就是通过第三方向要访问的网站发送请求获取Token，第三方网站每次请求写到Token就可以访问到内容。
注意：OAuth2 是 OAuth 协议的下一个版本，但不兼容 OAth 1.0 ，OAth2 关注客户端开发者的简易性，同时为 Web 应用、桌面应用、移动设备、 IOT 设备提供专门的认证流程。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/4756f969434be4bbefaee0ea1a335038/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-27T18:03:15+08:00" />
<meta property="article:modified_time" content="2023-06-27T18:03:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">认证授权：OAuth2简介及四种授权模型详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h3><a id="toc_0"></a> 
 <div class="toc"> 
  <h3>文章目录</h3> 
  <ul><li><ul><li><a href="#toc_0" rel="nofollow">@[toc]</a></li><li><a href="#_5" rel="nofollow">简介</a></li><li><a href="#_25" rel="nofollow"></a></li><li><a href="#OAuth2__27" rel="nofollow">一、OAuth2 授权总体流程</a></li><li><ul><li><a href="#1_35" rel="nofollow">1.认证流程</a></li><li><a href="#2_65" rel="nofollow">2.四种角色：</a></li><li><a href="#3_82" rel="nofollow">3.四种授权模式</a></li></ul> 
    </li><li><a href="#Authorization_Code_Grant_95" rel="nofollow">二、授权码模式（Authorization Code Grant）</a></li><li><ul><li><a href="#1Client_Side_118" rel="nofollow">1.Client Side</a></li><li><a href="#2Server_Side_130" rel="nofollow">2.Server Side</a></li><li><a href="#3Check_Access_Token_138" rel="nofollow">3.Check Access Token</a></li></ul> 
    </li><li><a href="#Implicit_Grant_150" rel="nofollow">三、隐式授权模式（Implicit Grant）</a></li><li><ul><li><a href="#Client_Side_163" rel="nofollow">Client Side</a></li><li><a href="#Check_Access_Token_172" rel="nofollow">Check Access Token</a></li></ul> 
    </li><li><a href="#Resource_Owner_Password_Credentials_Grant_180" rel="nofollow">四、密码模式（Resource Owner Password Credentials Grant）</a></li><li><ul><li><a href="#Client_Side_193" rel="nofollow">Client Side</a></li><li><a href="#Check_Access_Token_202" rel="nofollow">Check Access Token</a></li></ul> 
    </li><li><a href="#Client_Credentials_Grant_210" rel="nofollow">五、客户端模式（Client Credentials Grant）</a></li><li><ul><li><a href="#1Server_Side_221" rel="nofollow">1.Server Side</a></li><li><a href="#2_Check_Access_Token_229" rel="nofollow">2. Check Access Token</a></li></ul> 
    </li><li><a href="#_239" rel="nofollow">六、授权模式的选型</a></li><li><a href="#_253" rel="nofollow">其他</a></li></ul> 
  </li></ul> 
 </div></h3> 
<h3><a id="_5"></a>简介</h3> 
<p>如今很多互联网应用中，OAuth2 是一个非常重要的认证协议，很多场景下都会用到它，Spring Security 对 OAuth2 协议提供了相应的支持。开发者非常方便的使用 OAuth2 协议</p> 
<p>OAuth 是一个开放标准，该标准允许用户让第三方应用访问该用户在某一网站上存储的私密资源 （如头像、照片、视频等），并且在这个过程中无须将用户名和密码提供给第三方应用。通过令牌 （token） 可以实现这一功能。每一个令牌授权一个特定的网站在特定的时间段内允许可访问特定的资源。OAuth 让用户可以授权第三方网站灵活访问它们存储在另外一些资源服务器上的特定信息，而非所有的内容。对于用户而言，我们在互联网应用中最常见的 OAuth 应用就是各种第三方登录，例如 QQ授权登录、微信授权登录、微博授权登录、GitHub 授权登录等。</p> 
<p>例如用户想登录 Ruby China ，传统方式是使用用户名和密码但是这样并不安全，因为网站会存储你的用户名密码，这样可能会导致密码泄露。这种授权方式安全隐患很大如果使用 OAuth 协议就能很好地解决这一问题。</p> 
<p>oAuth2协议解决了多个网站登录问题，账号密码不安全的问题，比如一些小众的网站就可以不用注册登录，使用 oAuth2，也就是通过第三方向要访问的网站发送请求获取Token，第三方网站每次请求写到Token就可以访问到内容。</p> 
<p><img src="https://images2.imgbox.com/4d/c6/nvEeWgRq_o.png" alt="472c41a595f137154dc248ff0382b383.png"></p> 
<p>注意：OAuth2 是 OAuth 协议的下一个版本，但不兼容 OAth 1.0 ，OAth2 关注客户端开发者的简易性，同时为 Web 应用、桌面应用、移动设备、 IOT 设备提供专门的认证流程。</p> 
<p><img src="https://images2.imgbox.com/d8/52/h9QgIL7m_o.png" alt="img"></p> 
<p><strong>oAuth2就是对用户的信息进步的保护</strong>**，如很多喜欢将所有密码设置为同样的，就可能会泄露，但是通过已经注册过的网站用户信息，来进行授权给第三方网站信息进行登录则免去了注册，oAuth主要做的就是****认证保护用户隐私安全**</p> 
<h3><a id="_25"></a></h3> 
<h3><a id="OAuth2__27"></a>一、OAuth2 授权总体流程</h3> 
<p>角色梳理 ：第三方应用 &lt;--------&gt; 存储用户私密信息应用 ----------&gt; 授权服务器 ------&gt; 资源服务器</p> 
<p>整体流程如下</p> 
<p><img src="https://images2.imgbox.com/77/25/8B81CzT2_o.png" alt="img"></p> 
<h4><a id="1_35"></a>1.认证流程</h4> 
<p>官网流程 :</p> 
<ul><li> <p>(A) 用户打开客户端以后，客户端要求用户给予授权。</p> </li><li> <p>(B) 用户同意给予客户端授权。</p> </li><li> <p>© 客户端使用上一步获得的授权，向认证服务器申请令牌。</p> </li><li> <p>(D) 认证服务器对用户端进行认证以后，确认无误，同意发放令牌。</p> </li><li> <p>(E) 客户端使用令牌，向资源服务器申请资源。</p> </li><li> <p>(F) 资源服务器确认令牌无误,同意向客户端开放资源。</p> </li></ul> 
<p>例子流程:</p> 
<ul><li>1.用户打开第三方网站如 (京东),用户点击了微信授权登录，此时 就会跳转到 微信的授权页面。</li><li>2.用户点击授权给京东后，进行授权认证，授权成功会进行回调到京东回调页面。</li><li>3.授权页面会发起请求向授权服务器索要授权令牌。</li><li>4.授权服务器将授权令牌进行返回,用户此时可以在第三方网站（京东）向 微信服务器携带令牌获取部分用户信息 。</li><li>5.用户此时可以在第三方网站（京东）向 微信服务器携带令牌获取部分用户信息 。</li><li>6.资源服务器将资源返回给第三方网站</li></ul> 
<h4><a id="2_65"></a>2.四种角色：</h4> 
<p>从上图中我们可以看出六个步骤之中，B是关键，即用户怎么才能给于客户端授权。同时会发现 OAuth2 中包含四种不同角色：</p> 
<ul><li> <p>Client ：第三方应用。</p> </li><li> <p>Resource Owner：资源所有者。</p> </li><li> <p>Authorizetion Server ：授权服务器。</p> </li><li> <p>Resource Server ：资源服务器。</p> </li></ul> 
<p>授权服务器和资源服务器可以放一起，但是在如今的互联网和分布的推动下，都是分别存储。</p> 
<h4><a id="3_82"></a>3.四种授权模式</h4> 
<p>OAuth2 协议一种支持四种不同的授权模式：</p> 
<ul><li>授权码模式：常见的第三方平台登录功能基本都是使用这种模式。（安全性高）</li><li>简化模式：简化模式是不需要第三方服务端（客户端）参与，直接在浏览器中向授权服务器申请令牌（token），如果网站是纯静态页面，则可以采用这种方式。</li><li>密码模式：密码模式是用户把用户名/密码直接告诉客户端，客户端使用在这些信息项授权服务器申请令牌（token）。这需要用户对客户端高度信任，例如客户端应用和服务器提供商就是同一家公司。</li><li>客户端模式：客户端模式是指客户端使用自己的名义而不是用户的名义向授权服务器提供申请授权。严格来说，客户端模式并不能算作 OAuth 协议解决问题的一种解决方案，但是对于开发者而言，在一些为移动端提供的授权服务器上使用这种模式还是非常方便的。</li></ul> 
<p>用的最多的就是 最多的就是授权码模式，无论那种授权模式，其授权流程都是相似的，只不过在个别步骤上有差异而已。如上图所示。</p> 
<h3><a id="Authorization_Code_Grant_95"></a>二、授权码模式（Authorization Code Grant）</h3> 
<p>授权码模式是OAuth2目前最安全最复杂的授权流程，先放一张图，稍做解释</p> 
<p><img src="https://images2.imgbox.com/42/18/xl53Y6YN_o.png" alt="img"></p> 
<p>如上图，我们可以看到此流程可大致分为三大部分</p> 
<ul><li>Client Side：用户+客户端与授权服务器的交互</li><li>Server Side：客户端与授权服务器之间的交互</li><li>Check Access Token：客户端与资源服务器之间的交互 + 资源服务器与授权服务器之间的交互</li></ul> 
<p>整体上来说，可以<strong>用一句话概括授权码模式授权流程</strong>，<strong>客户端换取授权码，客户端使用授权码换token，客户端使用token访问资源</strong></p> 
<p>接下来对这三部分进行一些说明 ：</p> 
<blockquote> 
 <p>前提条件：</p> 
 <ul><li>第三方客户端需要提前与资源拥有方（同时也是授权所有方）协商客户端id（client_id），客户端密钥（client_secret）</li><li>文中暂时未将scope、state等依赖具体框架的内容写进来，这里可以参考Spring Security OAuth2的实现</li></ul> 
</blockquote> 
<h4><a id="1Client_Side_118"></a>1.Client Side</h4> 
<p><strong>客户端换取授权码</strong>，这个客户端可以是浏览器，</p> 
<blockquote> 
 <p>1.客户端将<code>client_id + 授权模式标识(grant_type) + 回调地址(redirect_uri)</code>拼成url访问授权服务器<code>授权端点</code></p> 
 <p>2.授权服务器返回登录界面，要求<code>用户登录</code>（此时用户提交的密码等直接发到授权服务器，进行校验）</p> 
 <p>3.授权服务器返回授权审批界面，<code>用户授权</code>完成</p> 
 <p>4.授权服务器<code>返回授权码到回调地址</code></p> 
</blockquote> 
<h4><a id="2Server_Side_130"></a>2.Server Side</h4> 
<p><strong>客户端使用授权码换token</strong></p> 
<blockquote> 
 <ol><li>客户端接收到授权码，并使用<code>授权码 + client_id + client_secret</code>访问授权服务器颁发token端点</li><li>授权服务器校验通过，颁发token返回给客户端</li><li>客户端保存token到存储器（推荐cookie）</li></ol> 
</blockquote> 
<h4><a id="3Check_Access_Token_138"></a>3.Check Access Token</h4> 
<p><strong>客户端使用token访问资源</strong></p> 
<blockquote> 
 <ol><li>客户端在请求头中添加token，访问资源服务器</li><li>资源服务器收到请求，先调用校验token的方法（可以是远程调用授权服务器校验端点，也可以直接访问授权存储器手动校对）</li><li>资源服务器校验成功，返回资源</li></ol> 
</blockquote> 
<blockquote> 
 <p>这里的说明省去了一些参数，如scope(请求token的作用域)、state(用于保证请求不被CSRF)、redirect_uri(授权服务器回调uri)，先理解概念，实现的时候再去要求</p> 
</blockquote> 
<h3><a id="Implicit_Grant_150"></a>三、隐式授权模式（Implicit Grant）</h3> 
<p><img src="https://images2.imgbox.com/b1/46/mUXmHKeQ_o.png" alt="img"></p> 
<p>隐式授权模式大致可分为两部分：</p> 
<ul><li>Client Side：用户+客户端与授权服务器的交互</li><li>Check Access Token：客户端与资源服务器之间的交互 + 资源服务器与授权服务器之间的交互</li></ul> 
<p><strong>用一句话概括隐式授权模式授权流程</strong></p> 
<p><strong>客户端让用户登录授权服务器换token，客户端使用token访问资源</strong></p> 
<h4><a id="Client_Side_163"></a>Client Side</h4> 
<p><strong>客户端让用户登录授权服务器换token</strong></p> 
<blockquote> 
 <ol><li>客户端（浏览器或单页应用）将<code>client_id + 授权模式标识(grant_type)+ 回调地址(redirect_uri)</code>拼成url访问授权服务器<code>授权端点</code></li><li>授权服务器跳转用户登录界面，用户登录</li><li>用户授权</li><li>授权服务器<code>访问回调地址</code>返回token给客户端</li></ol> 
</blockquote> 
<h4><a id="Check_Access_Token_172"></a>Check Access Token</h4> 
<p><strong>客户端使用token访问资源</strong></p> 
<blockquote> 
 <ol><li>客户端在请求头中添加token，访问资源服务器</li><li>资源服务器收到请求，先调用校验token的方法（可以是远程调用授权服务器校验端点，也可以直接访问授权存储器手动校对）</li><li>资源服务器校验成功，返回资源</li></ol> 
</blockquote> 
<h3><a id="Resource_Owner_Password_Credentials_Grant_180"></a>四、密码模式（Resource Owner Password Credentials Grant）</h3> 
<p><img src="https://images2.imgbox.com/50/41/PBxwj5Wq_o.png" alt="img"></p> 
<p>密码模式大体上也分为两部分：</p> 
<ul><li>Client Side: 用户与客户端交互，客户端与授权服务器交互</li><li>Check Access Token:客户端与资源服务器之间的交互 + 资源服务器与授权服务器之间的交互</li></ul> 
<p><strong>一句话概括用户名密码模式流程</strong>：</p> 
<p><strong>用户在客户端提交账号密码换token，客户端使用token访问资源</strong></p> 
<h4><a id="Client_Side_193"></a>Client Side</h4> 
<p><strong>用户在客户端提交账号密码换token</strong></p> 
<blockquote> 
 <ol><li>客户端要求用户登录</li><li>用户输入密码，客户端将表单中添加客户端的client_id + client_secret发送给授权服务器<code>颁发token端点</code></li><li>授权服务器校验用户名、用户密码、client_id、client_secret，均通过返回token到客户端</li><li>客户端保存token</li></ol> 
</blockquote> 
<h4><a id="Check_Access_Token_202"></a>Check Access Token</h4> 
<p><strong>客户端使用token访问资源</strong></p> 
<blockquote> 
 <ol><li>客户端在请求头中添加token，访问资源服务器</li><li>资源服务器收到请求，先调用校验token的方法（可以是远程调用授权服务器校验端点，也可以直接访问授权存储器手动校对）</li><li>资源服务器校验成功，返回资源</li></ol> 
</blockquote> 
<h3><a id="Client_Credentials_Grant_210"></a>五、客户端模式（Client Credentials Grant）</h3> 
<p><img src="https://images2.imgbox.com/a2/9c/qUBrwqHs_o.png" alt="img"></p> 
<p>客户端模式大体上分为两部分：</p> 
<ul><li>Server Side: 客户端与授权服务器之间的交互</li><li>Check Access Token: 客户端与资源服务器，资源服务器与授权服务器之间的交互</li></ul> 
<p><strong>一句话概括客户端模式授权流程</strong>：<strong>客户端使用自己的标识换token，客户端使用token访问资源</strong></p> 
<h4><a id="1Server_Side_221"></a>1.Server Side</h4> 
<p><strong>客户端使用自己的标识换token</strong></p> 
<blockquote> 
 <ol><li>客户端使用client_id + client_secret + 授权模式标识访问授权服务器的<code>颁发token端点</code></li><li>授权服务器校验通过返回token给客户端</li><li>客户端保存token</li></ol> 
</blockquote> 
<h4><a id="2_Check_Access_Token_229"></a>2. Check Access Token</h4> 
<p><strong>客户端使用token访问资源</strong></p> 
<blockquote> 
 <ol><li>客户端在请求头中添加token，访问资源服务器</li><li>资源服务器收到请求，先调用校验token的方法（可以是远程调用授权服务器校验端点，也可以直接访问授权存储器手动校对）</li><li>资源服务器校验成功，返回资源</li></ol> 
</blockquote> 
<h3><a id="_239"></a>六、授权模式的选型</h3> 
<p>考虑到授权场景的多样性，可以参考以下两种选型方式</p> 
<ul><li>按授权需要的多端情况</li></ul> 
<p><img src="https://images2.imgbox.com/07/74/qfGviTvN_o.png" alt="img"></p> 
<ul><li>按客户端类型与所有者</li></ul> 
<p><img src="https://images2.imgbox.com/c9/da/aRqMOXPX_o.png" alt="img"></p> 
<h3><a id="_253"></a>其他</h3> 
<p>参考：https://blog.csdn.net/weixin_52834606/article/details/126995138</p> 
<p>https://www.cnblogs.com/hellxz/p/oauth2_process.html</p> 
<p>https://tools.ietf.org/html/rfc6749</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d592a8d34fe516bb016b655536af3104/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">SQL死锁</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/78a20fe2af1c0db7a44b0a26514256a1/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">《深入浅出SSD：固态存储核心技术、原理与实战》----学习记录(一)</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>