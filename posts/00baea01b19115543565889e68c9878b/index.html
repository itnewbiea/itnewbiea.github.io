<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【Matlab】海底声学模拟（Bellhop）以及滤波器的设计 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【Matlab】海底声学模拟（Bellhop）以及滤波器的设计" />
<meta property="og:description" content="一、设计要求 某单波束测深仪最大测量水深为300米，请根据《水声学原理》和《数字信号处理》相关知识，仿真设计该单波束测深仪的数字信号处理系统（包括模拟滤波器参数、采样频率、量化精度等工作参数；FIR/IIR滤波器设计，并对数字信号进行：匹配滤波；底检测；底跟踪和声呐图绘制等处理）。
（PS：需要全部代码文件文件请点击这里，需要Bellhop使用说明书请点击这里。）
二、采样数据模拟生成 1.理想条件下声呐采样波形生成
1.1假设出的理想条件：
（1）基于射线声学理论
（2）几何衰减按球面波传播衰减规律衰减，不考虑吸收衰减
（3）仅考虑水底的反射
（4）考虑在高斯白噪声背景下
（5）整个空间声速分布均匀
1.2在假设信号发射的时刻为零时刻的前提下，输入的参数说明
表1 输入参数说明
C=1500
声速
单位：m/s
f0=15e3
信号频率
单位：Hz
fs=f0*10
采样率，最高频率的5倍
单位：Hz
Tao=5/f0
信号脉宽
单位：s
Sample_time=0.1
采样时长
单位：s
SNR=60
信噪比
单位：dB
H=10
水深
单位：m
H1=5
发射换能器水深
单位：m
H2=5
接收换能器水深
单位：m
D=1
接收与发射换能器水平距离
单位：m
Re_coef_bottom
水底反射系数
单位：无
1.3生成发射信号并模拟反射环境
data_generation.m
function receive_signal = data_generation(c,fs,f0,Tao,Sample_time,SNR,H,H1,H2,D,Re_coef_bottom) %**********************************通信声呐水听器数据生成函数************************************ %几点假设： %（1）基于射线声学理论 %（2）几何衰减按球面波传播衰减规律衰减，不考虑吸收衰减 %（3）仅考虑水底的反射 %（4）考虑在高斯白噪声背景下 %（5）整个空间声速分布均匀 %***************************************输入参数说明****************************************** % c 声速 Unit：m/s % fs 采样率 Unit：Hz % f0 信号频率 Unit：Hz % Tao 信号脉宽 Unit：s % Sample_time 采样时长 Unit：s 假设信号发射的时刻为零时刻 % SNR 信噪比 Unit：dB % H 水深 Unit：m % H1 发射换能器水深 Unit：m % H2 接收换能器水深 Unit：m % D 接收与发射换能器水平距离 Unit：m % Re_coef_bottom 水底反射系数 存在半波损失 Ts = 1/fs; %采样时间间隔 sample_num = fix(Sample_time*fs); %采样总点数 nTs = (0:sample_num-1)/fs; %离散的采样时刻 sample_num1 = fix(Tao*fs); %信号的采样点数 nTs1 = (0:sample_num1-1)/fs; %信号的离散的采样时刻 receive_signal = zeros(size(nTs)); %用于存储水听器接收的信号 d0 = sqrt((H1-H2)^2&#43;D^2); %两个换能器的直线距离 S0 = 1/d0; %直达波的声压幅值 Noise_var = 10^(-SNR/20)*S0; %白噪声的方差 %% 计算到达回波信号 real_time = d0/c; %信号的实际到达时刻 signal_start_time = fix(real_time*fs)&#43;1; %信号第一个采样点的时刻 phase = (signal_start_time*Ts-real_time)/Ts*2*pi; %得到信号的第一个采样点的相位 receive_signal(signal_start_time:(signal_start_time&#43;sample_num1-1)) = S0*sin(2*pi*f0*nTs1&#43;phase); %模拟采样 receive_signal = receive_signal &#43; Noise_var*randn(size(nTs)); %加入噪声 M=power(D/(2*H-H1-H2),2); d1=sqrt(M&#43;1)*(H-H1); d2=sqrt(M&#43;1)*(H-H2); dib= d1&#43;d2 %反射波总路程 Sib=1/dib*Re_coef_bottom; %反射波的声压幅值 real_time = dib/c; %信号的实际到达时刻 signal_start_time = fix(real_time*fs)&#43;1; %信号第一个采样点的时刻 phase = (signal_start_time*Ts-real_time)/Ts*2*pi; %得到信号的第一个采样点的相位 receive_signal(signal_start_time:(signal_start_time&#43;sample_num1-1)) =." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/00baea01b19115543565889e68c9878b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-12-18T00:39:54+08:00" />
<meta property="article:modified_time" content="2022-12-18T00:39:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【Matlab】海底声学模拟（Bellhop）以及滤波器的设计</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2 style="margin-left:.0001pt;text-align:justify;"></h2> 
<h2 style="margin-left:.0001pt;text-align:justify;"><strong>一、设计要求</strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">  某单波束测深仪最大测量水深为300米，请根据《水声学原理》和《数字信号处理》相关知识，仿真设计该单波束测深仪的数字信号处理系统（包括模拟滤波器参数、采样频率、量化精度等工作参数；FIR/IIR滤波器设计，并对数字信号进行：匹配滤波；底检测；底跟踪和声呐图绘制等处理）。</p> 
<blockquote> 
 <p style="margin-left:.0001pt;text-align:justify;">（PS：需要全部代码文件文件请<a class="link-info" href="https://download.csdn.net/download/m0_49684834/87294765?spm=1001.2014.3001.5503" title="点击这里">点击这里</a>，需要Bellhop使用说明书请<a class="link-info" href="https://download.csdn.net/download/m0_49684834/87294724?spm=1001.2014.3001.5503" title="点击这里">点击这里</a>。）</p> 
</blockquote> 
<h2 style="margin-left:.0001pt;text-align:justify;">二、采样数据模拟生成</h2> 
<p style="margin-left:.0001pt;text-align:center;"><strong><strong>1</strong></strong><strong><strong>.</strong></strong><strong><strong>理想条件下声呐采样波形生成</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>1.1</strong></strong><strong><strong>假设出的理想条件：</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:left;">（1）基于射线声学理论</p> 
<p style="margin-left:.0001pt;text-align:left;">（2）几何衰减按球面波传播衰减规律衰减，不考虑吸收衰减</p> 
<p style="margin-left:.0001pt;text-align:left;">（3）仅考虑水底的反射</p> 
<p style="margin-left:.0001pt;text-align:left;">（4）考虑在高斯白噪声背景下</p> 
<p style="margin-left:.0001pt;text-align:left;">（5）整个空间声速分布均匀</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>1</strong></strong><strong><strong>.2</strong></strong><strong><strong>在假设信号发射的时刻为零时刻的前提下，输入的参数说明</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:center;"><strong><strong>表</strong></strong><strong><strong>1 </strong></strong><strong><strong>输入参数说明</strong></strong></p> 
<table border="1" cellspacing="0"><tbody><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>C=1500</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>声速</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：m</strong></strong><strong><strong>/</strong></strong><strong><strong>s</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>f</strong></strong><strong><strong>0=15</strong></strong><strong><strong>e</strong></strong><strong><strong>3</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>信号频率</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：Hz</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>fs</strong></strong><strong><strong>=</strong></strong><strong><strong>f</strong></strong><strong><strong>0*10</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>采样率，最高频率的</strong></strong><strong><strong>5</strong></strong><strong><strong>倍</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：Hz</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>Tao</strong></strong><strong><strong>=5/</strong></strong><strong><strong>f</strong></strong><strong><strong>0</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>信号脉宽</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：s</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>Sample_time</strong></strong><strong><strong>=0.1</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>采样时长</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：s</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>SNR</strong></strong><strong><strong>=60</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>信噪比</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：dB</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>H</strong></strong><strong><strong>=10</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>水深</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：m</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>H</strong></strong><strong><strong>1=5</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>发射换能器水深</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：m</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>H</strong></strong><strong><strong>2=5</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>接收换能器水深</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：m</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>D</strong></strong><strong><strong>=1</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>接收与发射换能器水平距离</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：m</strong></strong></p> </td></tr><tr><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>R</strong></strong><strong><strong>e_coef_bottom</strong></strong></p> </td><td style="vertical-align:top;width:138.25pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>水底反射系数</strong></strong></p> </td><td style="vertical-align:top;width:138.3pt;"> <p style="margin-left:.0001pt;text-align:left;"><strong><strong>单位：无</strong></strong></p> </td></tr></tbody></table> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>1.3生成发射信号并模拟反射环境</strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong>data_generation.m</strong></p> 
<pre><code>function receive_signal = data_generation(c,fs,f0,Tao,Sample_time,SNR,H,H1,H2,D,Re_coef_bottom)
%**********************************通信声呐水听器数据生成函数************************************
%几点假设：
%（1）基于射线声学理论
%（2）几何衰减按球面波传播衰减规律衰减，不考虑吸收衰减
%（3）仅考虑水底的反射
%（4）考虑在高斯白噪声背景下
%（5）整个空间声速分布均匀
%***************************************输入参数说明******************************************
% c                  声速             Unit：m/s
% fs                 采样率           Unit：Hz
% f0                 信号频率         Unit：Hz
% Tao                信号脉宽         Unit：s
% Sample_time        采样时长         Unit：s      假设信号发射的时刻为零时刻
% SNR                信噪比           Unit：dB
% H                  水深                    Unit：m
% H1                 发射换能器水深           Unit：m
% H2                 接收换能器水深           Unit：m
% D                  接收与发射换能器水平距离  Unit：m
% Re_coef_bottom     水底反射系数  存在半波损失
Ts = 1/fs;      %采样时间间隔
sample_num = fix(Sample_time*fs);       %采样总点数
nTs = (0:sample_num-1)/fs;              %离散的采样时刻
sample_num1 = fix(Tao*fs);              %信号的采样点数
nTs1 = (0:sample_num1-1)/fs;            %信号的离散的采样时刻
receive_signal = zeros(size(nTs));      %用于存储水听器接收的信号
d0 = sqrt((H1-H2)^2+D^2);     %两个换能器的直线距离
S0 = 1/d0;                    %直达波的声压幅值
Noise_var = 10^(-SNR/20)*S0;  %白噪声的方差
%% 计算到达回波信号
real_time = d0/c;                                     %信号的实际到达时刻
signal_start_time = fix(real_time*fs)+1;              %信号第一个采样点的时刻
phase = (signal_start_time*Ts-real_time)/Ts*2*pi;     %得到信号的第一个采样点的相位 
receive_signal(signal_start_time:(signal_start_time+sample_num1-1)) = S0*sin(2*pi*f0*nTs1+phase); %模拟采样
receive_signal = receive_signal + Noise_var*randn(size(nTs));     %加入噪声
M=power(D/(2*H-H1-H2),2);
d1=sqrt(M+1)*(H-H1);
d2=sqrt(M+1)*(H-H2);
dib=  d1+d2  %反射波总路程
Sib=1/dib*Re_coef_bottom;   %反射波的声压幅值
real_time = dib/c;                                                   %信号的实际到达时刻
signal_start_time = fix(real_time*fs)+1;                             %信号第一个采样点的时刻
phase = (signal_start_time*Ts-real_time)/Ts*2*pi;                    %得到信号的第一个采样点的相位 
receive_signal(signal_start_time:(signal_start_time+sample_num1-1)) =...
receive_signal(signal_start_time:(signal_start_time+sample_num1-1)) + Sib*sin(2*pi*f0*nTs1 + phase); %模拟采样                  
receive_signal = receive_signal/S0;    %将直达波的幅值归一化
</code></pre> 
<p style="margin-left:.0001pt;text-align:justify;">调用上述函数，主运行函数（test.m）</p> 
<pre><code>close all;
clear all;
clc;
c = 1500;            %声速             Unit：m/s
f0 = 15e3;           %信号频率         Unit：Hz
fs = f0*10;          %采样率 最高频率的5倍   Unit：Hz
Tao = 5/f0;         %信号脉宽         Unit：s
Sample_time = 0.1;   %采样时长         Unit：s      假设信号发射的时刻为零时刻
SNR = 40;            %信噪比           Unit：dB
H = 10;       %水深                    Unit：m
H1 = 5;       %发射换能器水深           Unit：m
H2 = 5;       %接收换能器水深           Unit：m
D = 1;       %接收与发射换能器水平距离  Unit：m
Re_coef_bottom = 1;   %水底反射系数  
%%
sample_num = fix(Sample_time*fs);       %采样总点数
nTs = (0:sample_num-1)/fs;              %离散的采样时刻
%生成水听器接收数据
receive_signal0 =data_generation(c,fs,f0,Tao,Sample_time,SNR,H,H1,H2,D,Re_coef_bottom);
figure;
plot(nTs,receive_signal0);
xlabel('时间s');
ylabel('幅度');
string = ['水听器接收的仿真数据,信噪比SNR=',num2str(SNR),'dB'];
title(string);
</code></pre> 
<p>运行后得到图像：</p> 
<p><img alt="" height="341" src="https://images2.imgbox.com/ef/ac/4oeyr2ij_o.png" width="423"></p> 
<p>  得到理想情况下的仿真数据。</p> 
<p style="margin-left:.0001pt;text-align:center;"><strong><strong>2.Bellhop射线模型与参数设计</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>2</strong></strong><strong><strong>.1B</strong></strong><strong><strong>ellhop模型的介绍：</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;">  BELLHOP 模型是通过高斯波束跟踪方法(Porter 和 Bueker，1987 年)，计算 水平非均匀环境中的声场。高斯波束跟踪方法对于高频水平变化问题特别有吸 引力，这是简正波、波数积分和抛物线模型不可替代的。高斯束射线跟踪法的基 本思想是将高斯强度分布与每条声线联系起来，该声线为高斯声束的中心声线, 这些声线能较平滑的过渡到声影区，也能较平滑的穿过焦散线，所提供的结果与 全波动模型的结果更为一致。</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>2</strong></strong><strong><strong>.2B</strong></strong><strong><strong>ellhop模型的使用：</strong></strong></p> 
<h4 style="margin-left:.0001pt;text-align:justify;">（1）确定env文件。</h4> 
<p>  具体操作请参考Bellhop使用说明书。</p> 
<h4>（2）设计程序</h4> 
<p>  设计程序实现任意信号输入，实现接收信号的Bellhop模型模拟。</p> 
<p>  bharr2ir.m</p> 
<pre><code>function ir_vec=bharr2ir(delay, amp, sampling_rate)

valid_delay_index=find(delay&gt;0);
if isempty(valid_delay_index)
    disp('[bharr2ir]Error: Zero path simulated by BELLHOP.');
    return;
end
delay_vec=delay(valid_delay_index);
amp_vec=amp(valid_delay_index);

%单位冲激响应进行采样
delay_min=min(delay_vec);
delay_max=max(delay_vec);

cir_length=round(delay_max*sampling_rate);
ir_vec=zeros(cir_length, 1);

%find individual ray paths
for icn=1: length(delay_vec)
    %calculate the arrival index
    %init_delay gives some zeros priror to the first path
    arr_id=round(delay_vec(icn)*sampling_rate);
    
    %generate impulse response. Note that sometime, multiple returns can be
    %generate for the same delay in BELLHOP. 
    ir_vec(arr_id)=ir_vec(arr_id)+amp_vec(icn);
end
</code></pre> 
<p> ambientnoise_psd.m</p> 
<pre><code>function [npsd_db]=ambientnoise_psd(windspeed, fc)
%考虑海洋湍流和风力

%Turbulance noise湍流噪声
ANturb_dB=17-30*log10(fc/1000);

%Ambient noise in dB (wind driven noise)
ANwind_dB=50+7.5*sqrt(windspeed)+20*log10(fc/1000)-40*log10(fc/1000+0.4);

%Thermo noise in dB (wind driven noise)热噪声
ANthermo_dB=-15+20*log10(fc/1000);

%Total noise PSD
npsd_db=10*log10(10^(ANturb_dB/10)+10^(ANwind_dB/10)+10^(ANthermo_dB/10));
</code></pre> 
<p>signal_mf.m</p> 
<pre><code>function est_ir_vec=signal_mf(rx_signal, tx_source, cir_length)

ttl_samples=length(tx_source);

%generate matched-filter from the source signal
txsig_flip=conj(tx_source(end:-1:1));

%matched-filtering
%division by ttl_samples is necessary for normalization
est_ir_vec=conv(txsig_flip, rx_signal)/ttl_samples;</code></pre> 
<p> uw_isi.m</p> 
<pre><code>function [y, adj_ir_vec]=uw_isi(ir_vec, sl_db, tx_source, nv_db)
%与单位冲激响应函数卷积并加入噪声
%发送信号与信道冲激响应进行卷积
tx_sig=conv(tx_source, ir_vec);

%接收信号信噪比
SNR=sl_db-nv_db;

%信道输出
y=awgn(tx_sig,SNR);
adj_ir_vec=ir_vec;
</code></pre> 
<p> Bellohop.m</p> 
<pre><code>function[rx_signal,Ts]=Bellohop()%rx_signal信号序列 fs采样频率
clear; close all; clc; 

%采样率
sampling_rate=2000e3;

%发射机中心频率
%该值和计算噪声有关
fc=200e3;
windspeed=5;

radio=sampling_rate/fc  %采样率与中心频率的比值
%发射机参数
sl_db=200;  %发射机声源级
bw=8e3;     %带宽

%通过Actup的arr文件获取所需的幅值和时延（单位冲激响应）
%BELLHOP run ID
env_id='env';
%read BELLHOP arr file:
[ amp1, delay1, SrcAngle, RcvrAngle, NumTopBnc, NumBotBnc, narrmat, Pos ] ...
    = read_arrivals_asc( [env_id '.arr'] ) ;
[m,n]=size(amp1);
amp=amp1(m,:);
delay=delay1(m,:);

%Step 1: 创建任意波形（这里以正弦波为例）
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
F_Serial_Signal=[zeros(1,1),ones(1,1),zeros(1,10)];  %待发送串行数据
Signal_L=length(F_Serial_Signal);                    %发送数据长度
communication_rate=40e3;                       %通信速率 
Communication_radio= sampling_rate/communication_rate; %采样倍数
signal=repmat(F_Serial_Signal,Communication_radio,1);
signal2=reshape(signal,1,Signal_L*Communication_radio);      %调整后的数据
signal_length=length(signal2);                 %数据长度
t=0:1/sampling_rate:(signal_length-1)/sampling_rate;      %时间
modulation_signal=cos(2*pi()*fc*t); %载波信号
          


tx_source=signal2.*modulation_signal;          %发送

%Step 2:加入噪声和多径影响
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
Narrmx=10; %limit ourselves to use the first Narrmax paths

%对单位冲激响应进行采样
ir_vec=bharr2ir(delay, amp, sampling_rate);
%strongest tap in dB
maxamp_db=20*log10(max(abs(amp)))+sl_db;%声源级（dB）加由于信道衰减的能量（dB），表示接收到的信号的能量

%噪声级
[npsd_db]=ambientnoise_psd(windspeed, fc);%npsd_db是噪声的能量谱密度（单位频带内的能量）转换成dB，
nv_db=npsd_db+10*log10(bw);%相当于能量谱密度乘以带宽，即该频带内的噪声的能量
% maxamp_db和nv_db的差值应该为信噪比
disp(['Strongest tap strength=' num2str(maxamp_db,'%.1f') ' dB; Noise variance=' num2str(nv_db,'%.1f') 'dB']);

%考虑多径和噪声影响后的接收信号响应
[rx_signal, adj_ir_vec]=uw_isi(ir_vec, maxamp_db, tx_source, nv_db);

Ts=1/sampling_rate;

t2=0:Ts:(length(rx_signal)-1)*Ts;

figure(1)
subplot(2,1,1)
plot(t,tx_source)
title('发送信号')
xlabel('时间/s')
ylabel('幅值(V)')
set(gca, 'Fontsize', 16);

subplot(2,1,2)
plot(t2,rx_signal)

title('接收到的信号')
xlabel('时间/s')
ylabel('幅值(V)')
set(gca, 'Fontsize', 16);
end
</code></pre> 
<p>效果实现如下：</p> 
<p class="img-center"><img alt="" height="420" src="https://images2.imgbox.com/e5/fe/6e8r7uHW_o.jpg" width="560"></p> 
<h3>2.3绘制冲激响应图</h3> 
<p> plotting.m</p> 
<pre><code>clear
clc
filename = 'env.arr';
Minimum_range=100  %（接收水听器的水平方向上接收范围最小值，m）----R 
Maximum_range=1000 %（接收水听器的水平方向上接收范围最大值，m）---RB 

[ amp1, delay, SrcAngle, RcvrAngle, NumTopBnc, NumBotBnc, narrmat, Pos ]... 
 = read_arrivals_asc(  filename );
%%单位冲激响应
[m,n]=size(amp1);
amp = abs(amp1); %取模  
x = delay(m,:); %获取第50个接收机的时延和幅值
y = amp(m,:);
figure(1)
stem(x,y)
grid on
xlabel('相对时延/s')
ylabel('幅度')
title('单位冲激响应')

%%归一化冲激响应
Amp_Delay = [x;y];
Amp_Delay(:,all(Amp_Delay==0,1))=[]; %去掉0值
Amp_Delay=sortrows(Amp_Delay',1);  %按照时延从小到大排序
normDelay = Amp_Delay(:,1)-Amp_Delay(1,1);%归一化时延
normAmp = Amp_Delay(:,2)/Amp_Delay(1,2);%归一化幅度
figure(2)
stem(normDelay,normAmp,'^')
grid on
xlabel('相对时延/s')
ylabel('归一化幅度')
title('归一化冲激响应')

figure(3)
mum=1:m;
ReRange = Minimum_range+(Maximum_range-Minimum_range)/m*mum;
for i=1:min(narrmat)
plot(delay(:,i),ReRange,'o')
hold on
end
hold off
grid on
colorbar
xlabel('时延(sec)')
ylabel('Range(m)')
title(filename)
</code></pre> 
<p>生成结果如下：</p> 
<p><img alt="" height="266" src="https://images2.imgbox.com/83/9b/eAOUSRAa_o.png" width="274"><img alt="" height="265" src="https://images2.imgbox.com/fe/cb/wcRA8IEA_o.png" width="277"></p> 
<p><img alt="" height="245" src="https://images2.imgbox.com/e7/99/3AeYERlp_o.png" width="296"></p> 
<h2><strong><strong>三.滤波器设计方案</strong></strong></h2> 
<p style="margin-left:.0001pt;text-align:justify;">对于本次问题采样IIR滤波器：</p> 
<p style="margin-left:.0001pt;text-align:justify;">切比雪夫Ⅱ型滤波器，种类为带通滤波器</p> 
<p style="margin-left:.0001pt;text-align:justify;">Fstop1=180KHz</p> 
<p style="margin-left:.0001pt;text-align:justify;">Fpass1=190KHz</p> 
<p style="margin-left:.0001pt;text-align:justify;">Fpass2=210KHz</p> 
<p style="margin-left:.0001pt;text-align:justify;">Fstop2=220KHz</p> 
<p style="margin-left:.0001pt;text-align:justify;">Astop1=90</p> 
<p style="margin-left:.0001pt;text-align:justify;">Apass=1</p> 
<p style="margin-left:.0001pt;text-align:justify;">Astop2=90</p> 
<p style="margin-left:.0001pt;text-align:justify;">阶：22阶</p> 
<p style="margin-left:.0001pt;text-align:justify;">节：11</p> 
<p style="margin-left:.0001pt;text-align:justify;">稳定滤波幅值响应</p> 
<p style="margin-left:.0001pt;text-align:justify;">FS：采样频率为2000KHz</p> 
<p style="margin-left:.0001pt;text-align:justify;"><strong><strong>滤波器的幅值响应图像：</strong></strong></p> 
<p style="margin-left:.0001pt;text-align:justify;"><img alt="" height="172" src="https://images2.imgbox.com/af/d6/g2rkHuGt_o.png" width="554"></p> 
<p> 滤波器设计代码如下：</p> 
<pre><code>function Hd = filter_2nd
%FILTER_2ND 返回离散时间滤波器对象。
% MATLAB Code
% Generated by MATLAB(R) 9.11 and DSP System Toolbox 9.13.
% Generated on: 14-Dec-2022 16:14:37
% Chebyshev Type II Bandpass filter designed using FDESIGN.BANDPASS.
% All frequency values are in kHz.
Fs = 2000;  % Sampling Frequency
Fstop1 = 180;         % First Stopband Frequency
Fpass1 = 190;         % First Passband Frequency
Fpass2 = 210;         % Second Passband Frequency
Fstop2 = 220;         % Second Stopband Frequency
Astop1 = 90;          % First Stopband Attenuation (dB)
Apass  = 1;           % Passband Ripple (dB)
Astop2 = 90;          % Second Stopband Attenuation (dB)
match  = 'stopband';  % Band to match exactly
% Construct an FDESIGN object and call its CHEBY2 method.
h  = fdesign.bandpass(Fstop1, Fpass1, Fpass2, Fstop2, Astop1, Apass, ...
                      Astop2, Fs);
Hd = design(h, 'cheby2', 'MatchExactly', match);

% [EOF]</code></pre> 
<p style="margin-left:.0001pt;text-align:center;"></p> 
<p> 滤波后结果如图：</p> 
<p class="img-center"><img alt="" height="420" src="https://images2.imgbox.com/53/8a/4VSbBkFe_o.jpg" width="560"></p> 
<p></p> 
<p> 学习不易，转载请联系博主。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1c8b3e19ced89bd7448dfd1e9334978d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">MySQL or条件命中</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/899031bdbfd2081201c8157d95fdbee8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C&#43;&#43; 多态之虚继承</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>