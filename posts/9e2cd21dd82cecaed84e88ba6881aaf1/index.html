<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>csv文件、ini文件处理、序列化和反序列化、json - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="csv文件、ini文件处理、序列化和反序列化、json" />
<meta property="og:description" content="1.CSV文件 逗号分割值Comma-Separeted-Values
CSV是一个被行分隔符、列分隔符划分成行和列的文本文件。CSV不指定字符编码。
行分隔符为\r\n,最后一行可以没有换行符。
列分隔符为逗号或制表符
每一行都称为一条记录record
字段可以使用双引号括起来，也可以不使用，如果字段中出现了双引号、逗号、换行符必须使用双引号括起来，如果字段的值是双引号，使用两个双引号表示一个转义。
表头可选，和字段列对齐就行了。
1.1 手动生成CSV文件 from pathlib import Path import csv p1 = Path(&#39;c:/my.csv&#39;) # csv文件 csv_body = &#34;&#34;&#34;\ id,name,age,comment 1,tom,20,&#34;i am 20&#34; 2,jerry,18,&#34;(&#34;&#34;123&#34;&#34;)&#34; 3,ben,28,&#34;这是 一 段 中文 &#34; &#34;&#34;&#34; # with p1.open(&#39;w&#43;&#39;) as f: # f.write(csv_body) with p1.open() as f: body = csv.reader(f) for line in body: print(line) # csv存在的问题就是无法确定字段的数据类型 1.2CSV模块 reader(csvfile, dialect=‘excel’, **fmtparams)
返回reader对象，是一个迭代器。
默认使用excel方言，如下：
dilimiter列分隔符，逗号
lineterninator行分隔符\r\n
quotechar字段的引用符号，缺省为&#34;双引号
双引号的处理：
doublequote双引号的处理，默认为True，如果碰到数据中有双引号，而quotechar也是双引号，True则使用两个双引号表示，False表示使用转义字符作为双引号的前缀。
escapechar一个转义字符，默认为None
write = csv." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/9e2cd21dd82cecaed84e88ba6881aaf1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-06-04T19:31:38+08:00" />
<meta property="article:modified_time" content="2019-06-04T19:31:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">csv文件、ini文件处理、序列化和反序列化、json</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-github-gist">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="1CSV_0"></a>1.CSV文件</h4> 
<p>逗号分割值Comma-Separeted-Values<br> CSV是一个被行分隔符、列分隔符划分成行和列的文本文件。CSV不指定字符编码。<br> 行分隔符为\r\n,最后一行可以没有换行符。<br> 列分隔符为逗号或制表符<br> 每一行都称为一条记录record<br> 字段可以使用双引号括起来，也可以不使用，如果字段中出现了双引号、逗号、换行符必须使用双引号括起来，如果字段的值是双引号，使用两个双引号表示一个转义。<br> 表头可选，和字段列对齐就行了。</p> 
<h5><a id="11_CSV_8"></a>1.1 手动生成CSV文件</h5> 
<pre><code class="prism language-python"><span class="token keyword">from</span> pathlib <span class="token keyword">import</span> Path
<span class="token keyword">import</span> csv

p1 <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'c:/my.csv'</span><span class="token punctuation">)</span>
<span class="token comment"># csv文件</span>
csv_body <span class="token operator">=</span> <span class="token triple-quoted-string string">"""\
id,name,age,comment
1,tom,20,"i am 20"
2,jerry,18,"(""123"")"
3,ben,28,"这是
一  段
中文
"
"""</span>

<span class="token comment"># with p1.open('w+') as f:</span>
<span class="token comment">#     f.write(csv_body)</span>
<span class="token keyword">with</span> p1<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    body <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> body<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>

<span class="token comment"># csv存在的问题就是无法确定字段的数据类型</span>
</code></pre> 
<h5><a id="12CSV_35"></a>1.2CSV模块</h5> 
<p>reader(csvfile, dialect=‘excel’, **fmtparams)<br> <mark>返回reader对象，是一个迭代器</mark>。<br> 默认使用excel方言，如下：</p> 
<ul><li> <p>dilimiter列分隔符，逗号</p> </li><li> <p>lineterninator行分隔符\r\n</p> </li><li> <p>quotechar字段的引用符号，缺省为"双引号</p> </li><li> <p>双引号的处理：</p> </li><li> <p>doublequote双引号的处理，默认为True，如果碰到数据中有双引号，而quotechar也是双引号，True则使用两个双引号表示，False表示使用转义字符作为双引号的前缀。</p> </li><li> <p>escapechar一个转义字符，默认为None</p> </li><li> <p>write = csv.writer(f, doublequote=False, escapechar=’@’)遇到双引号则必须提供转义自字符<br> quoting指定双引号的规则：</p> </li><li> <p>QUOTE_ALL所有字段</p> </li><li> <p>QUOTE_MINIMAL特殊字符字段，Excel方言使用该规则</p> </li><li> <p>QUOTE_NONNUMERIC非数字字段</p> </li><li> <p>QUOTE_NONE都不使用引号</p> </li></ul> 
<p>writer(csvfile, dialect=‘excel’, **fmtparams)返回DictWriter的实例、主要方法有writerow、writerows<br> writerow(iterable)</p> 
<pre><code class="prism language-python">p <span class="token operator">=</span> Path<span class="token punctuation">(</span><span class="token string">'c:/my.csv'</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    reader <span class="token operator">=</span> csv<span class="token punctuation">.</span>reader<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">next</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>reader<span class="token punctuation">)</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> reader<span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>line<span class="token punctuation">)</span>


rows <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">'curry'</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token string">'my name is curry'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">'klay'</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token string">'my name is kaly'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token string">'durant'</span><span class="token punctuation">,</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token string">'my name is durant'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">,</span> <span class="token number">28</span><span class="token punctuation">,</span> <span class="token string">'my name is green'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token string">'justin'</span><span class="token punctuation">,</span> <span class="token number">22</span><span class="token punctuation">,</span> <span class="token string">'just\t"in'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">"abcdefghi"</span><span class="token punctuation">,</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">]</span>
row <span class="token operator">=</span> rows<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">str</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    writer <span class="token operator">=</span> csv<span class="token punctuation">.</span>writer<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerow<span class="token punctuation">(</span>row<span class="token punctuation">)</span>
    writer<span class="token punctuation">.</span>writerows<span class="token punctuation">(</span>rows<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="2ini_83"></a>2.ini文件处理</h4> 
<p>[DEFAULT]<br> a = test</p> 
<p>[mysql]<br> default-character-set = utf8</p> 
<p>[mysqld]<br> test1 = 200<br> datadir = /dbserver/data<br> port = 33060<br> character-set-server = utf8<br> sql_mode = NO_ENGINE_SUBSTRITUTION,STRICT_TRANS_TABLES<br> c = True</p> 
<p>[test]<br> test1 = 100</p> 
<p>中括号里面的部分称为section，译为节、区、段。<br> 每一个section内，都是key=value形成的键值对，key称为option选项。</p> 
<p><mark>注意这里的DEFAULT是缺省secstion的名字，必须大写。</mark></p> 
<h5><a id="21_configparser_105"></a>2.1 configparser</h5> 
<p>  configparser模块的ConfigParser类就是用来操作。可以将section当做key，section存储着键值对组成的字典，可以把ini配置文件当做一个嵌套的字典，默认使用的是有序字典。<br> read(filenames, encoding=None)<br> 读取ini文件，可以是单个文件，也可以是文件列表，可以指定文件编码。<br> <mark>sections()返回section列表，缺省section不包括在内。</mark><br> has_section(section_name)判断section是否存在。<br> add_section(section_name_增加一个section<br> options(section)返回section的所有option，<mark>会追加缺省section的option</mark><br> has_option(section, option), 判断section里面是否有option<br> get(section, option, *, raw=False, vars=None[, fallback])<br> 从指定的section的选项上取值，如果找到返回，如果没找到就去找default段有没有。<br> getint(section, option, *, raw=False, vars=None[, fallback]) # 返回指定类型的数据<br> getfloat(section, option, *, raw=False, vars=None[, fallback])<br> getboolean(section, option, *, raw=False, vars=None[, fallback])</p> 
<p>items(raw=False, vars=None) # 返回所有section名字及对象<br> items(section, raw=False, vars=None) <mark># 返回指定的section的键值对组成的二元组</mark><br> set(section, option, value)<br> <mark>section存在的情况下，写入opton=value，要求option、value必须是字符串</mark><br> remove_section(section)<br> 移除section及其所有的option<br> remove(section, option) # 移除指定section下的option<br> write(fileobject, space_around_delimiters=True)<br> 将当前config的所有内容写入fileobject中，一般open函数使用w模式</p> 
<pre><code class="prism language-python"><span class="token comment"># ini文件</span>
<span class="token keyword">import</span> configparser


cfg <span class="token operator">=</span> configparser<span class="token punctuation">.</span>ConfigParser<span class="token punctuation">(</span><span class="token punctuation">)</span>
read_ok <span class="token operator">=</span> cfg<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'c:/mysql.ini'</span><span class="token punctuation">,</span> <span class="token string">'c:/t.ini'</span><span class="token punctuation">,</span> <span class="token string">'c:/list.ini'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>read_ok<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>sections<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> cfg<span class="token punctuation">.</span>default_section<span class="token punctuation">)</span>  <span class="token comment"># 注意缺省的section不在sections()列表中</span>
<span class="token comment"># print(cfg._sections)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'~'</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> cfg<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">,</span> k<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'~'</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> cfg<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token string">'mysqld'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># 指定section</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'~'</span> <span class="token operator">*</span> <span class="token number">30</span><span class="token punctuation">)</span>

x <span class="token operator">=</span> cfg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'mysqld'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>  <span class="token comment"># 无法确定字段的类型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>

x <span class="token operator">=</span> cfg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'mysql'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>

x <span class="token operator">=</span> cfg<span class="token punctuation">.</span>getint<span class="token punctuation">(</span><span class="token string">'mysqld'</span><span class="token punctuation">,</span> <span class="token string">'port'</span><span class="token punctuation">)</span>  <span class="token comment"># 强制类型转换，整型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>

x <span class="token operator">=</span> cfg<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'mysqld'</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">,</span> fallback<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>  <span class="token comment"># mysqld中没有key'b'，使用fallback，100对应的类型就是int，'100'，对应的就是字符串</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>

x <span class="token operator">=</span> cfg<span class="token punctuation">.</span>getboolean<span class="token punctuation">(</span><span class="token string">'mysqld'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> fallback<span class="token operator">=</span><span class="token string">'abc'</span><span class="token punctuation">)</span>  <span class="token comment"># 布尔型</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>

cfg<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'mysqld'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">,</span> <span class="token string">'True'</span><span class="token punctuation">)</span>  <span class="token comment"># value值必须是字符串</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'c:/mysql.ini'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    cfg<span class="token punctuation">.</span>write<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'~'</span> <span class="token operator">*</span> <span class="token number">40</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>cfg<span class="token punctuation">[</span><span class="token string">'mysqld'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>cfg<span class="token punctuation">[</span><span class="token string">'mysqld'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> cfg<span class="token punctuation">.</span>has_section<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cfg<span class="token punctuation">.</span>remove_section<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">)</span>

cfg<span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'test1'</span><span class="token punctuation">:</span> <span class="token number">100</span><span class="token punctuation">}</span>  <span class="token comment"># 下面的方法设置section和option都可以</span>
cfg<span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'test2'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'123'</span>  <span class="token comment"># 此处必须是字符串，否则会报错</span>

<span class="token keyword">if</span> cfg<span class="token punctuation">.</span>has_option<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'test2'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    cfg<span class="token punctuation">.</span>remove_option<span class="token punctuation">(</span><span class="token string">'test'</span><span class="token punctuation">,</span> <span class="token string">'test2'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test'</span> <span class="token keyword">in</span> cfg<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'test1'</span> <span class="token keyword">in</span> cfg<span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>

<span class="token comment"># cfg['xyz']['abc'] = 'tests'  # 会报错，因为section'xyz'不存在</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'c:/mysql.ini'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    cfg<span class="token punctuation">.</span>write<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
</code></pre> 
<h4><a id="3__194"></a>3. 序列化和反序列化</h4> 
<h5><a id="31_195"></a>3.1为什么要序列化？</h5> 
<p>内存中的字典、列表、集合以及各种对象，如何保存到一个文件中？<br> 如果自己定义的类的实例，如何保存到一个文件中？<br> 如何从文件中读取数据，并让他们在内存中再次恢复成自己对应的类的实例？<br> 这就需要设计一套协议，按照某种规则，把内存中数据保存到文件中，文件是一个字节序列，所以必须把数据转换成字节序列，输出到文件，这就是序列化。反之，从文件的字节序列恢复到内存并且还是原来的类型，就是反序列化。</p> 
<h5><a id="32__200"></a>3.2 序列化与反序列化定义</h5> 
<p>serialization序列化：将内存中对象存储下来，把它变成一个一个字节。-&gt;转化成二进制<br> deserialization反序列化：将文件的一个一个字节恢复成内存中对象。<br> 序列化保存到文件就是持久化<br> 可以将数据序列化后持久化，或者网络传输；也可以将从文件中或者网络接收到的字节序列反序列化</p> 
<h5><a id="33_pickle_206"></a>3.3 pickle库</h5> 
<p><img src="https://images2.imgbox.com/01/78/ENmzPdAy_o.png" alt="序列化与反序列化"></p> 
<pre><code class="prism language-python"><span class="token comment"># pickle库</span>
<span class="token keyword">import</span> pickle

a <span class="token operator">=</span> <span class="token number">97</span>
a1 <span class="token operator">=</span> <span class="token number">99</span>
b <span class="token operator">=</span> <span class="token string">'c'</span>
c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">48</span><span class="token punctuation">,</span> <span class="token string">'abc'</span><span class="token punctuation">]</span>
d <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'aaaaaaaaa'</span><span class="token punctuation">:</span> <span class="token string">'ddd'</span><span class="token punctuation">,</span> <span class="token string">'bbbbbbbbbbbb'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">}</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'c:/ser'</span><span class="token punctuation">,</span> <span class="token string">'wb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>a<span class="token punctuation">,</span> f<span class="token punctuation">)</span>  <span class="token comment"># dump将a序列化</span>
    pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>a1<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
    pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>b<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
    pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>c<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
    pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>d<span class="token punctuation">,</span> f<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'c:/ser'</span><span class="token punctuation">,</span> <span class="token string">'rb+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        x <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>  <span class="token comment"># load反序列化</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token builtin">isinstance</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token builtin">list</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 列表c跟列表x不是同一个列表了</span>
<span class="token triple-quoted-string string">"""&lt;class 'int'&gt; 97
&lt;class 'int'&gt; 99
&lt;class 'str'&gt; c
&lt;class 'list'&gt; [48, 'abc']
43921480 44030536
&lt;class 'dict'&gt; {'aaaaaaaaa': 'ddd', 'bbbbbbbbbbbb': 1}
"""</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">:</span>
    B <span class="token operator">=</span> <span class="token string">'abc'</span>

    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        self<span class="token punctuation">.</span>aaaa <span class="token operator">=</span> <span class="token string">'abc'</span>

    <span class="token keyword">def</span> <span class="token function">bbbbbbbbbbbbbb</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'++++++++++++++++++++'</span><span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">show</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'abcdefg'</span><span class="token punctuation">)</span>


a <span class="token operator">=</span> A<span class="token punctuation">(</span><span class="token punctuation">)</span>
a<span class="token punctuation">.</span>bbbbbbbbbbbbbb<span class="token punctuation">(</span><span class="token punctuation">)</span>

s <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'c:/ser1'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>s<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'c:/ser1'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    x <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span>
    x<span class="token punctuation">.</span>bbbbbbbbbbbbbb<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'c:/ser1'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    x <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span>f<span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
    x<span class="token punctuation">.</span>bbbbbbbbbbbbbb<span class="token punctuation">(</span><span class="token punctuation">)</span>
    x<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<p>  上例中，只序列化了类A，aaaa和abc，类中的定义的方法没有序列化，因为他们都是不变的，反序列化的时候，找到类就可以恢复对象了，之所以还序列化了aaaa和abc，是因为它们是实例对象的，每一个实例对象都是不一样的，所以这些数据需要序列化。</p> 
<h5><a id="34__280"></a>3.4 序列化应用</h5> 
<p>  一般来说，本地序列化的情况，应用较少，大多数场景都是应用在网络传输中。将数据序列化后通过网络传输到远程节点，远程服务器上的服务将接收到数据反序列化后，就可以使用了。但是，注意一点，远程接收端，反序列化时必须有对应的数据类型，否则就会报错。尤其是自定义的类，必须远程得有一致的定义。<br>   现在，大多数项目，都不是单机的，也不是单服务的，需要多个程序之间配合，需要通过网络将数据传送到其他节点上去，这就需要大量的序列化和反序列化过程。<br>   但是问题是 ，python程序之间还可以都是用pickle解决序列化、反序列化，如果是跨平台、跨语言、跨协议pickle就不太合适了，就需要公共的协议。例如像XML、Json、ProtocolBuffer等。</p> 
<h4><a id="4_Json_285"></a>4. Json</h4> 
<p>  JSON(JavaScript Object Notation,JS对象标记)是一种轻量级的数据交换格式。它基于ECMAScript(w3c组织制定的JS规范)的一个子集，采用完全独立于编程语言的文本格式来存储和表示数据。</p> 
<h5><a id="41_json_288"></a>4.1 json的数据类型</h5> 
<h6><a id="411__289"></a>4.1.1 值</h6> 
<p>双引号引起来的字符串、数值、true和false、null、对象、数组，这些都是值。<br> <img src="https://images2.imgbox.com/5b/97/y8FttOn4_o.png" alt="值"></p> 
<h6><a id="4111__292"></a>4.1.1.1 字符串</h6> 
<p>双引号引起来的任意字符的组合，可以有转义字符。</p> 
<h6><a id="4112__295"></a>4.1.1.2 数值</h6> 
<p>有正负、有整数、浮点数</p> 
<h6><a id="4113__python_298"></a>4.1.1.3 对象 ——&gt;对应python中的字典</h6> 
<p>无序的键值对的集合<br> 格式： {key1: value1, key2: value2…keyn: valuen}<br> <mark>key必须一个字符串，需要双引号包围这个字符串</mark><br> value可以是任意合法值<br> <img src="https://images2.imgbox.com/49/ac/RJpGvjIf_o.png" alt="对象"></p> 
<h6><a id="4114___python_304"></a>4.1.1.4 数组 ——&gt; 对应python中的列表</h6> 
<p>有序值的集合<br> 格式： [value1, value2, … valuen]<br> <img src="https://images2.imgbox.com/8f/a8/ixFvVFYw_o.png" alt="数组"></p> 
<h5><a id="42_json_308"></a>4.2 json模块</h5> 
<p>Python支持少量的内建数据类型到json类型的转换。<br> <img src="https://images2.imgbox.com/34/01/Aj4eCfTk_o.png" alt="python">常用方法：<br> <img src="https://images2.imgbox.com/28/20/rUeED6b3_o.png" alt="常用方法"></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">from</span> configparser <span class="token keyword">import</span> ConfigParser

cfg <span class="token operator">=</span> ConfigParser<span class="token punctuation">(</span><span class="token punctuation">)</span>

read_ok <span class="token operator">=</span> cfg<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token string">'c:/mysql.ini'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>read_ok<span class="token punctuation">)</span>

d <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>

<span class="token keyword">for</span> section <span class="token keyword">in</span> cfg<span class="token punctuation">.</span>sections<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>section<span class="token punctuation">,</span> cfg<span class="token punctuation">.</span>items<span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">)</span>
    d<span class="token punctuation">[</span>section<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>cfg<span class="token punctuation">.</span>items<span class="token punctuation">(</span>section<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>

<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'c:/mysql.json'</span><span class="token punctuation">,</span> <span class="token string">'w+'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    json<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>d<span class="token punctuation">,</span> f<span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json

d <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> <span class="token string">'curry'</span><span class="token punctuation">,</span> <span class="token string">'age'</span><span class="token punctuation">:</span> <span class="token number">31</span><span class="token punctuation">,</span> <span class="token string">'intrest'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'music'</span><span class="token punctuation">,</span> <span class="token string">'movie'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'class'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'python'</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
j <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># {"name": "curry", "age": 31, "intrest": ["music", "movie"], "class": ["python"]} &lt;class 'str'&gt;</span>

d1 <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>j<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span>
<span class="token comment"># {'name': 'curry', 'age': 31, 'intrest': ['music', 'movie'], 'class': ['python']}</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 31161584 32006288 注意两个不在是同一个对象了</span>
</code></pre> 
<p>  一般json编码的数据很少落地，数据都是通过网络传输。传输的时候，要考虑压缩它。本质上来说他就是个文本，就是字符串。</p> 
<h4><a id="43_MessagePack_349"></a>4.3 MessagePack</h4> 
<p>  MessagePack是一个基于二进制高效的对象序列化类库，可用于跨语言通信。它可以像JSON那样，在许多种语言之间交换结构对象。但是它比JSON更快速也更轻巧。支持python、Ruby、Java、C/C++等众多语言，兼容json和pickle。<br> <mark>安装： $ pip install msgpack # terminal窗口中安装</mark></p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> json
<span class="token keyword">import</span> pickle
<span class="token keyword">import</span> msgpack

d <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'a'</span><span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">:</span> <span class="token string">'abc'</span><span class="token punctuation">,</span> <span class="token string">'c'</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'1'</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'d'</span><span class="token punctuation">:</span> <span class="token punctuation">{<!-- --></span><span class="token string">'e'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'f'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
x <span class="token operator">=</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>  <span class="token comment"># set不可序列化</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> x<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">,</span> y<span class="token punctuation">)</span>  <span class="token comment"># 长度为62</span>

p <span class="token operator">=</span> pickle<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">,</span> p<span class="token punctuation">)</span>  <span class="token comment"># 长度为111</span>

d1 <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d1<span class="token punctuation">)</span><span class="token punctuation">)</span>

data <span class="token operator">=</span> msgpack<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>d<span class="token punctuation">)</span>  <span class="token comment"># 二进制</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>  <span class="token comment"># 最省内存，长度为33</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/98d9101dc086d680b59e2488bc57f3aa/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">java.lang.IllegalArgumentException: object is not an instance of declaring class</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/622c21495955729d46b13569e50a5058/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Win10 蓝牙已配对但无法连接的问题</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>