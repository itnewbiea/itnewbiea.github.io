<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>跨期套利 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="跨期套利" />
<meta property="og:description" content="跨期套利组合构建 与跨品种套利不同，跨期套利是对同一市场，同一品种，不同到期月份的合约之间进行套利，这其中涉及到非主力合约的问题。非主力合约成交量比较小，有的甚至低到几十数百手，很容易被几手交易量将价格拉至异常。这种异常实际较难捕捉，只会放大回测结果。我们以沪镍为例，其主力合约主要在1，5，9月交割，其余月份成交量很低。而1月交割合约活跃期为7月至12月，5月交割合约活跃期11月到来年4月，所以在构建1月交割合约和5月交割合约的套利组合时，我们选择11、12月作为套利策略实施的时间进行测试，12月底若有持仓强行平仓。这个时间内，1月交割合约为主力合约，5月交割合约为次主力合约。
镍跨期套利 在套利时，我们需要计算均衡价差，一般来说有两种算法：
模拟交割法：通过模拟交割过程各项费用，来计算套利过程中的各项成本，从而得出均衡价差。优点：容易计算，价差变化下；缺点：实际中价差很少恢复到这一水平 历史滞后均值法：通过历史的价差，选择时间窗口长度，得到均衡价差。优点：容易计算，价差动态；缺点：不能保证样本外价差恢复到这一水平 我们以选定套利组合的开盘价差为对象，使用历史滞后均值法，取N日价差均值为中线，中线加上N日价差M倍均值为上轨，中线减去N日价差M倍均值为下轨来构造布林带通道，当价差突破上轨，做空价差。我们选择1，5，9这三个月份交割合约，滚动的进行测试，其中1-5合约测试的时间为11月和12月，5-9合约测试的时间为3月和4月，9-1合约测试的时间为7月和8月，所以全年有半年时间不进行操作。
相关参数及设定 成交价设置为当日开盘价。这里，考虑到次主力合约成交量可能较少，我们设置为3个滑点。 开仓信号为价差超过上轨或者突破下轨，信号触发当天即按所设定的成交价进行成交。平仓信号达到中线附近或者，所设定的套利期现结束强行平仓。 手续费设为6元一手 回测时间为2015年5月至2017年4月 暂不考虑止损。 universe = ‘NIM0’ # 策略期货合约 start = ‘2015-05-18’ # 回测开始时间 end = ‘2017-04-31’ # 回测结束时间 capital_base = 1000000 # 初试可用资金 refresh_rate = 1 # 调仓周期 freq = ‘d’ # 调仓频率：m-&gt; 分钟；d-&gt; 日 margin_rate = 0.09 commission = {‘NI’: (6, ‘perShare’)} slippage = Slippage(3, ‘perShare’) months = [‘07’, ‘08’, ‘11’, ‘12’, ‘03’, ‘04’]
mid, up, low = [], [], [] def initialize(futures_account): # 初始化虚拟期货账户，一般用于设置计数器，回测辅助变量等。 futures_account." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6ec85ce2f9cc569bb9320ba091a29b14/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-23T21:55:08+08:00" />
<meta property="article:modified_time" content="2018-08-23T21:55:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">跨期套利</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <ol><li>跨期套利组合构建</li></ol> 
<hr> 
<p>与跨品种套利不同，跨期套利是对同一市场，同一品种，不同到期月份的合约之间进行套利，这其中涉及到非主力合约的问题。非主力合约成交量比较小，有的甚至低到几十数百手，很容易被几手交易量将价格拉至异常。这种异常实际较难捕捉，只会放大回测结果。我们以沪镍为例，其主力合约主要在1，5，9月交割，其余月份成交量很低。而1月交割合约活跃期为7月至12月，5月交割合约活跃期11月到来年4月，所以在构建1月交割合约和5月交割合约的套利组合时，我们选择11、12月作为套利策略实施的时间进行测试，12月底若有持仓强行平仓。这个时间内，1月交割合约为主力合约，5月交割合约为次主力合约。</p> 
<ol><li>镍跨期套利</li></ol> 
<hr> 
<p>在套利时，我们需要计算均衡价差，一般来说有两种算法：</p> 
<p>模拟交割法：通过模拟交割过程各项费用，来计算套利过程中的各项成本，从而得出均衡价差。优点：容易计算，价差变化下；缺点：实际中价差很少恢复到这一水平 <br> 历史滞后均值法：通过历史的价差，选择时间窗口长度，得到均衡价差。优点：容易计算，价差动态；缺点：不能保证样本外价差恢复到这一水平 <br> 我们以选定套利组合的开盘价差为对象，使用历史滞后均值法，取N日价差均值为中线，中线加上N日价差M倍均值为上轨，中线减去N日价差M倍均值为下轨来构造布林带通道，当价差突破上轨，做空价差。我们选择1，5，9这三个月份交割合约，滚动的进行测试，其中1-5合约测试的时间为11月和12月，5-9合约测试的时间为3月和4月，9-1合约测试的时间为7月和8月，所以全年有半年时间不进行操作。</p> 
<ol><li>相关参数及设定 <br> 成交价设置为当日开盘价。这里，考虑到次主力合约成交量可能较少，我们设置为3个滑点。 <br> 开仓信号为价差超过上轨或者突破下轨，信号触发当天即按所设定的成交价进行成交。平仓信号达到中线附近或者，所设定的套利期现结束强行平仓。 <br> 手续费设为6元一手 <br> 回测时间为2015年5月至2017年4月 <br> 暂不考虑止损。 <br> universe = ‘NIM0’ # 策略期货合约 <br> start = ‘2015-05-18’ # 回测开始时间 <br> end = ‘2017-04-31’ # 回测结束时间 <br> capital_base = 1000000 # 初试可用资金 <br> refresh_rate = 1 # 调仓周期 <br> freq = ‘d’ # 调仓频率：m-&gt; 分钟；d-&gt; 日 <br> margin_rate = 0.09 <br> commission = {‘NI’: (6, ‘perShare’)} <br> slippage = Slippage(3, ‘perShare’)</li></ol> 
<p>months = [‘07’, ‘08’, ‘11’, ‘12’, ‘03’, ‘04’]</p> 
<p>mid, up, low = [], [], [] <br> def initialize(futures_account): # 初始化虚拟期货账户，一般用于设置计数器，回测辅助变量等。 <br> futures_account.mean = deque([], maxlen=10) <br> futures_account.std = deque([], maxlen=10)</p> 
<pre><code>futures_account.M0 = ''
futures_account.M1 = ''
</code></pre> 
<p>def handle_data(futures_account): # 回测调仓逻辑，每个调仓周期运行一次，可在此函数内实现信号生产，生成调仓指令。 <br> if futures_account.current_date[5:7] in [‘11’, ‘12’]: <br> M0 = universe[:2] + str(int(futures_account.current_date[2:4])+1) + ‘01’ <br> M1 = universe[:2] + str(int(M0[2:4])+(int(M0[4:])+4)/12)+’0’+str((int(M0[4:])+4)%12) <br> elif futures_account.current_date[5:7] in [‘07’, ‘08’]: <br> M0 = universe[:2] + str(int(futures_account.current_date[2:4])) + ‘09’ <br> M1 = universe[:2] + str(int(M0[2:4])+(int(M0[4:])+4)/12)+’0’+str((int(M0[4:])+4)%12) <br> elif futures_account.current_date[5:7] in [‘03’, ‘04’]: <br> M0 = universe[:2] + str(int(futures_account.current_date[2:4])) + ‘05’ <br> M1 = universe[:2] + str(int(M0[2:4])+(int(M0[4:])+4)/12)+’0’+str((int(M0[4:])+4)%12)</p> 
<pre><code>long_position = futures_account.position.get(futures_account.M0, dict()).get('long_position', 0)
short_position = futures_account.position.get(futures_account.M1, dict()).get('short_position', 0)

if futures_account.current_date[5:7] not in months:
    if long_position != 0:
        order(futures_account.M0, -20, 'close')
        order(futures_account.M1, 20, 'close')
    return


M0_open_price = get_symbol_history(symbol=M0, field='openPrice', time_range=11)[M0]['openPrice']
M1_open_price = get_symbol_history(symbol=M1, field='openPrice', time_range=11)[M1]['openPrice']

diff = np.array(M0_open_price - M1_open_price, dtype=float)
futures_account.mean.append(ta.MA(diff, 10)[-1])
futures_account.std.append(ta.STDDEV(diff, 10)[-1])


if diff[-1] &lt; futures_account.mean[-1] - 1 * futures_account.std[-1] and long_position == 0:
    order(M1, -20, 'open')
    order(M0, 20, 'open')
if diff[-1] &gt; futures_account.mean[-1] - 0.2 * futures_account.std[-1]  and long_position != 0:
    order(M1, 20, 'close')
    order(M0, -20, 'close')

futures_account.M0 = M0
futures_account.M1 = M1
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e1070478e19bbb4c049755a8b557708f/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">上下行波动率因子</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8d3cc7b375a710dc7fbc123a7c4176cd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【SlickGrid】------- SlickGrid改变高度的示例代码</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>