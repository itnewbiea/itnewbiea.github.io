<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SpringBoot开发实用篇2---与数据层技术有关的替换和整合 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SpringBoot开发实用篇2---与数据层技术有关的替换和整合" />
<meta property="og:description" content="四、数据层解决方案 1.SQL 现有数据层解决方案技术选型：Druid&#43;MyBatis-plus&#43;MySQL
数据源：DruidDataSource
持久化技术：MyBatis-plus/MyBatis
数据库：MySql
内置数据源：
SpringBoot提供了3种内嵌的数据源对象供开发者选择：
HikariCP：默认内置数据源对象；
Tomcat提供DataSource：HikariCP不可用的情况下，且在web环境中，将使用tomcat服务器配置的数据源对象；
Commons DBCP：Hikari不可用，tomcat数据源也不可用，将使用dbcp数据源。
使用方式：先使用默认配置，再使用个性化配置。
通用配置无法设置具体的数据源配置信息，仅提供基本的连接相关配置，如需配置，在下一级配置中设置具体设定。
JdbcTemplate：Spring提供的默认的持久化技术（几乎没人用）
操作数据库的模板技术。
pom.xml：
&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-jdbc&lt;/artifactId&gt; &lt;/dependency&gt; @Autowired private JdbcTemplate jdbcTemplate; @Test void testJdbcTemplate(){ String sql=&#34;select * from tbl_book&#34;; RowMapper&lt;Book&gt; rm=new RowMapper&lt;Book&gt;() { @Override public Book mapRow(ResultSet rs, int rowNum) throws SQLException { Book temp=new Book(); //查出来的放到结果集中，从结果集中得到，在set到对象中 temp.setId(rs.getInt(&#34;id&#34;)); temp.setName(rs.getString(&#34;name&#34;)); temp.setType(rs.getString(&#34;type&#34;)); temp.setDescription(rs.getString(&#34;description&#34;)); return temp; } }; List&lt;Book&gt; list = jdbcTemplate.query(sql, rm); System.out.println(list); } @Test void testJdbcTemplateSave(){ String sql=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/77fc3364d0b12158444c1671368ee1f8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-05-23T16:20:56+08:00" />
<meta property="article:modified_time" content="2023-05-23T16:20:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SpringBoot开发实用篇2---与数据层技术有关的替换和整合</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>四、数据层解决方案</h2> 
<h4><a id="1SQL_1"></a>1.SQL</h4> 
<p>现有数据层解决方案技术选型：Druid+MyBatis-plus+MySQL<br> 数据源：DruidDataSource<br> 持久化技术：MyBatis-plus/MyBatis<br> 数据库：MySql<br> <strong>内置数据源：</strong><br> SpringBoot提供了3种内嵌的数据源对象供开发者选择：<br> HikariCP：默认内置数据源对象；<br> Tomcat提供DataSource：HikariCP不可用的情况下，且在web环境中，将使用tomcat服务器配置的数据源对象；<br> Commons DBCP：Hikari不可用，tomcat数据源也不可用，将使用dbcp数据源。<br> <img src="https://images2.imgbox.com/e9/69/7PQ1t2Ik_o.png" alt="在这里插入图片描述"><br> 使用方式：先使用默认配置，再使用个性化配置。<br> 通用配置无法设置具体的数据源配置信息，仅提供基本的连接相关配置，如需配置，在下一级配置中设置具体设定。<br> <img src="https://images2.imgbox.com/9f/1b/j4h6pVfD_o.png" alt="在这里插入图片描述"><br> <strong>JdbcTemplate：Spring提供的默认的持久化技术（几乎没人用）</strong><br> 操作数据库的模板技术。<br> pom.xml：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-jdbc<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">JdbcTemplate</span> jdbcTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testJdbcTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">"select * from tbl_book"</span><span class="token punctuation">;</span>
        <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> rm<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">RowMapper</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Book</span> <span class="token function">mapRow</span><span class="token punctuation">(</span><span class="token class-name">ResultSet</span> rs<span class="token punctuation">,</span> <span class="token keyword">int</span> rowNum<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">SQLException</span> <span class="token punctuation">{<!-- --></span>
                <span class="token class-name">Book</span> temp<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//查出来的放到结果集中，从结果集中得到，在set到对象中</span>
                temp<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getInt</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                temp<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                temp<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"type"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                temp<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span><span class="token function">getString</span><span class="token punctuation">(</span><span class="token string">"description"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> temp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> jdbcTemplate<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span>sql<span class="token punctuation">,</span> rm<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testJdbcTemplateSave</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">String</span> sql<span class="token operator">=</span><span class="token string">"insert into tbl_book values(null,'springboot','springboot','springboot')"</span><span class="token punctuation">;</span>
        jdbcTemplate<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span>sql<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p><strong>H2数据库：</strong><br> SpringBoot提供了3种内嵌数据库供开发者选择，提高开发测试效率：<br> H2<br> HSQL<br> Derby<br> 伴随着内存启动而启动的数据库，比较小巧。<br> pom.xml中：</p> 
<pre><code class="prism language-xml"><span class="token comment">&lt;!--演示H2数据库--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>com.h2database<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>h2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-jpa<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>配置文件中：<br> <img src="https://images2.imgbox.com/5a/95/EBWiLmgb_o.png" alt="在这里插入图片描述"><br> 开启服务后，在浏览器中就可以访问：<br> <img src="https://images2.imgbox.com/c8/f8/IHEdR3Ej_o.png" alt="在这里插入图片描述"><br> 可以和持久层框架Mybatis-plus、JdbcTemplate搭配使用。</p> 
<h4><a id="2NoSQL_81"></a>2.NoSQL</h4> 
<h4><a id="1Redis_82"></a>（1）Redis</h4> 
<p>市面上常见的NoSQL解决方案：<br> Redis<br> MongoDB<br> ES<br> 上述技术通常在Linux系统中安装部署。<br> 在Windows安装，方便整合（整合都是一样的）。<br> <strong>Redis</strong>是一款key-value存储结构的内存级NoSQL数据库：<br> 支持多种数据存储格式<br> 支持持久化<br> 支持集群<br> <strong>Redis</strong>的安装与启动（Windows版）<br> Windows解压安装或一键式安装<br> 服务端启动命令</p> 
<pre><code class="prism language-bash">redis-server.exe redis.windows.conf
</code></pre> 
<p>客户端启动命令</p> 
<pre><code class="prism language-bash">redis-cli.exe
</code></pre> 
<p>具体操作：先打开服务器，再用客户端去连接。<br> <img src="https://images2.imgbox.com/7a/a0/ugyZCG0J_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/69/66/aSndCShL_o.png" alt="在这里插入图片描述"><br> <strong>SpringBoot整合Redis:</strong><br> 导入redis对应的starter，在创建工程的时候勾选。</p> 
<p>配置Redis（采用默认配置）<br> <img src="https://images2.imgbox.com/c3/d8/4wPa2h21_o.png" alt="在这里插入图片描述"><br> 提供操作Redis接口对象RedisTemplate：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot16RedisApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Resource</span>
    <span class="token keyword">private</span> <span class="token class-name">RedisTemplate</span> redisTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ValueOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ops<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">,</span><span class="token number">41</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ValueOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> age <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"age"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">hset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HashOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        ops<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span><span class="token string">"a"</span><span class="token punctuation">,</span><span class="token string">"aa"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">hget</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HashOperations</span> ops <span class="token operator">=</span> redisTemplate<span class="token punctuation">.</span><span class="token function">opsForHash</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> val <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"info"</span><span class="token punctuation">,</span> <span class="token string">"a"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>客户端：RedisTemplate以对象作为key和value，内部对数据进行序列化。<br> StringRedisTemplate以字符串作为key和value，与Redis客户端操作等效。</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StringRedisTemplateTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">StringRedisTemplate</span> stringRedisTemplate<span class="token punctuation">;</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">ValueOperations</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> ops <span class="token operator">=</span> stringRedisTemplate<span class="token punctuation">.</span><span class="token function">opsForValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> name <span class="token operator">=</span> ops<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"name"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>客户端使用jedis，加坐标，改配置文件。<br> <img src="https://images2.imgbox.com/cb/ea/gW5uXgUP_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/69/f2/OViRjcfP_o.png" alt="在这里插入图片描述"><br> lettcus和jedis的区别：<br> jedis连接Redis服务器是直连模式，当多线程模式下使用jedis会存在线程安全问题，解决方案可以通过配置连接池使每个连接专用，这样整体性能就会大受影响。<br> lettcus基于Netty框架进行与Redis服务器连接，底层设计中采用StatefulRedisConnection。StatefulRedisConnection自身是线程安全的，可以保障并发访问安全问题，所以一个连接可以被多线程复用。当然lettcus也支持多连接实例一起工作。</p> 
<h5><a id="2MongoDB_169"></a>（2）MongoDB</h5> 
<p>需求：既能存储结构化数据，又高性能。数据有着很高的修改需求<br> MongoDB是一个开源、高性能、无模式的文档型数据库。NoSQL数据库产品的一种，是最像关系型数据库的非关系型数据库。<br> 启动mongoDB服务：<br> <img src="https://images2.imgbox.com/a1/2d/Wp42oITn_o.png" alt="在这里插入图片描述"><br> 在客户端连接MongoDB服务：</p> 
<pre><code class="prism language-bash">mongo --host<span class="token operator">=</span><span class="token number">127.0</span>.0.1 --port<span class="token operator">=</span><span class="token number">27017</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/8b/28/TkYD4ySf_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/84/49/XFjXYbmQ_o.png" alt="在这里插入图片描述"><br> 或者使用可视化客户端：<br> <img src="https://images2.imgbox.com/02/73/aqp8Lvff_o.png" alt="在这里插入图片描述"><br> 基础CRUD操作：<br> <img src="https://images2.imgbox.com/f4/43/oDeqFd1b_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/82/9d/uTa3KwMA_o.png" alt="在这里插入图片描述"><br> <strong>SpringBoot整合MongoDB:</strong><br> 1.导入Mongodb对应的starter：</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.springframework.boot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spring-boot-starter-data-mongodb<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>2.配置mongodb访问uri：<br> <img src="https://images2.imgbox.com/35/e3/qaoclS6w_o.png" alt="在这里插入图片描述"><br> 3.提供操作Mongodb接口对象MongoTemplate</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@SpringBootTest</span>
<span class="token keyword">class</span> <span class="token class-name">Springboot17MongdbApplicationTests</span> <span class="token punctuation">{<!-- --></span>
    <span class="token annotation punctuation">@Autowired</span>
    <span class="token keyword">private</span> <span class="token class-name">MongoTemplate</span> mongoTemplate<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">contextLoads</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">Book</span> book<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Book</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setId</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setName</span><span class="token punctuation">(</span><span class="token string">"springboot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setType</span><span class="token punctuation">(</span><span class="token string">"springboot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        book<span class="token punctuation">.</span><span class="token function">setDescription</span><span class="token punctuation">(</span><span class="token string">"springboot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        mongoTemplate<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/**
     * 类型转换的问题  把数据库中不是int的删了
     */</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> all <span class="token operator">=</span> mongoTemplate<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>all<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

</code></pre> 
<h5><a id="3ES__Elasticsearch_228"></a>（3）ES Elasticsearch</h5> 
<p><strong>相关概念：</strong><br> Elasticsearch是一个分布式全文搜索引擎。（分布式：架构可以做成分布式的）<br> 要想做全文搜索：<br> 1.通过所提供的数据进行分词，将关联数据保存起来。就有了一个一个的id对应一个一个的简要数据。<br> 2.分词查出来先匹配一个一个的id，id再得到数据。（实际上查询的时候，是将输入这个id的数据展示出来）。<br> 这种方式大幅度的提高了查询速度。<br> 传统的索引：根据id查数据。<br> ES的索引（<strong>倒排索引</strong>）：根据关键字（数据）查id，再根据id查数据。<br> 一条：<strong>关键字—&gt;1—&gt;数据</strong> 对应的是一个文档，每一条都需要提前建立起来。当使用关键字后，就能找到对应的数据了。</p> 
<p><strong>基础操作：</strong><br> 打开ES服务：双击这个批处理文件：<br> <img src="https://images2.imgbox.com/9c/11/AgoPTyrW_o.png" alt="在这里插入图片描述"><br> 启动后，可以在浏览器直接创建。<br> 创建/查询/删除索引：<br> PUT：http://localhost:9200/books<br> GET：http://localhost:9200/books<br> DELETE：http://localhost:9200/books</p> 
<p><img src="https://images2.imgbox.com/19/a0/DQhxA16u_o.png" alt="在这里插入图片描述"><br> 目前创建的这个索引是不支持分词的。要支持分词添加IK插件。再重启服务。<br> <img src="https://images2.imgbox.com/6e/64/BHgP0s6b_o.png" alt="在这里插入图片描述"><br> <strong>创建一个有分词功能的索引：</strong><br> <img src="https://images2.imgbox.com/cb/a5/dbPXwaZD_o.png" alt="在这里插入图片描述"><br> <strong>查看这个索引：</strong><br> <img src="https://images2.imgbox.com/97/d3/8kLD6sMX_o.png" alt="在这里插入图片描述"><br> <strong>ES文档操作：</strong><br> 添加一条文档，相当于给数据库中添加一条数据，不需要指定表结构。文档结构是无模式的。</p> 
<p>使用_doc添加一个文档信息，id是自动生成的。<br> <img src="https://images2.imgbox.com/59/70/5YmDPfnG_o.png" alt="在这里插入图片描述"><br> 使用_create添加文档信息，后面需要加id号。<br> <img src="https://images2.imgbox.com/3f/ab/Hx4bbNN8_o.png" alt="在这里插入图片描述"><br> _doc后也可以加id号。<br> <img src="https://images2.imgbox.com/97/03/9SlHL3iU_o.png" alt="在这里插入图片描述">查询文档：查询id为1的文档<br> <img src="https://images2.imgbox.com/cc/c3/HAczOSxq_o.png" alt="在这里插入图片描述"><br> 查询所有文档：<br> <img src="https://images2.imgbox.com/ba/56/Hurw6Pbk_o.png" alt="在这里插入图片描述"><br> 使用条件查询：<br> <img src="https://images2.imgbox.com/03/d4/mhndEL9Z_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/a5/11/ZFhYcHLB_o.png" alt="在这里插入图片描述"><br> 删除文档：<br> 删除一个已经存在的：<br> <img src="https://images2.imgbox.com/cf/ef/vf7lPp9i_o.png" alt="在这里插入图片描述"><br> 删除一个不存在的：<br> <img src="https://images2.imgbox.com/75/b2/eEruCxJJ_o.png" alt="在这里插入图片描述"><br> 修改一个文档：<br> <img src="https://images2.imgbox.com/48/55/dZQXvEns_o.png" alt="在这里插入图片描述"><br> 查询一下刚才修改的文档，发现只有name，是全覆盖。<br> <img src="https://images2.imgbox.com/78/f4/9EqBkHc7_o.png" alt="在这里插入图片描述"><br> 如果不想全部修改，只想修改某一条属性信息：使用文档属性进行修改的。就不会覆盖其他的属性。<br> <img src="https://images2.imgbox.com/f7/c4/uLRUDYzv_o.png" alt="在这里插入图片描述"><br> 再次查询一下，只有修改的变了。<br> <img src="https://images2.imgbox.com/06/8e/hIwJkRMt_o.png" alt="在这里插入图片描述"><br> <strong>ElasticSearch（ES）总结：</strong><br> 创建文档：有三种方式。</p> 
<pre><code class="prism language-bash">POST  http://localhost:9200/books/_doc  <span class="token comment">#使用系统生成id</span>
POST  http://localhost:9200/books/_create/1  <span class="token comment">#使用指定id</span>
POST  http://localhost:9200/books/_doc/1  <span class="token comment">#使用指定id,不存在创建,存在更新（版本递增）</span>
</code></pre> 
<p>查询文档：</p> 
<pre><code class="prism language-bash">GET  http://localhost:9200/books/_doc/1  <span class="token comment">#查询单个文档</span>
GET  http://localhost:9200/books/_search  <span class="token comment">#查询全部文档</span>
</code></pre> 
<p>条件查询：</p> 
<pre><code class="prism language-bash">GET http://localhost:9200/books/_search?q<span class="token operator">=</span>name:springboot
</code></pre> 
<p>删除文档：</p> 
<pre><code class="prism language-bash">DELETE http://localhost:9200/books/_doc/1
</code></pre> 
<p>修改文档（全量修改）</p> 
<pre><code class="prism language-bash">PUT  http://localhost:9200/books/_doc/1
</code></pre> 
<p>修改文档（部分修改）:对文档中的某个属性，不是对整个文档进行操作（其余都是对一整个文档进行操作的）。</p> 
<pre><code class="prism language-bash">POST  http://localhost:9200/books/_update/1
</code></pre> 
<p><strong>SpringBoot整合ES客户端：</strong><br> 直接整合高级别的客户端：<br> 先导入starter</p> 
<pre><code class="prism language-xml"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.elasticsearch.client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>elasticsearch-rest-high-level-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>再写配置文件：配置文件不用写，采用的是硬编码的方式。<br> 在SpringBoot里创建ES客户端：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testCreateIndex</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
         <span class="token comment">//创建客户端</span>
        <span class="token class-name">HttpHost</span> host<span class="token operator">=</span><span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestClientBuilder</span> builder<span class="token operator">=</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用客户端发送了一个请求，创建了一个名称为books的索引</span>
        <span class="token class-name">CreateIndexRequest</span> request<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭客户端</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>在SpringBoot中创建索引：</p> 
<pre><code class="prism language-java"><span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testCreateIndexByIk</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建客户端</span>
        <span class="token class-name">HttpHost</span> host<span class="token operator">=</span><span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestClientBuilder</span> builder<span class="token operator">=</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//使用客户端发送了一个请求，创建了一个名称为books的索引</span>
        <span class="token class-name">CreateIndexRequest</span> request<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">CreateIndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json<span class="token operator">=</span><span class="token string">"{\n"</span> <span class="token operator">+</span>
                <span class="token string">"    \"mappings\":{\n"</span> <span class="token operator">+</span>
                <span class="token string">"        \"properties\":{\n"</span> <span class="token operator">+</span>
                <span class="token string">"            \"id\":{\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"type\":\"keyword\"\n"</span> <span class="token operator">+</span>
                <span class="token string">"            },\n"</span> <span class="token operator">+</span>
                <span class="token string">"            \"name\":{\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"type\":\"text\",\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"analyzer\":\"ik_max_word\",\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"copy_to\":\"all\"\n"</span> <span class="token operator">+</span>
                <span class="token string">"            },\n"</span> <span class="token operator">+</span>
                <span class="token string">"            \"type\":{\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"type\":\"keyword\"\n"</span> <span class="token operator">+</span>
                <span class="token string">"            },\n"</span> <span class="token operator">+</span>
                <span class="token string">"            \"description\":{\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"type\":\"text\",\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"analyzer\":\"ik_max_word\",\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"copy_to\":\"all\"\n"</span> <span class="token operator">+</span>
                <span class="token string">"            },\n"</span> <span class="token operator">+</span>
                <span class="token string">"            \"all\":{\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"type\":\"text\",\n"</span> <span class="token operator">+</span>
                <span class="token string">"                \"analyzer\":\"ik_max_word\"\n"</span> <span class="token operator">+</span>
                <span class="token string">"            }\n"</span> <span class="token operator">+</span>
                <span class="token string">"        }\n"</span> <span class="token operator">+</span>
                <span class="token string">"    }\n"</span> <span class="token operator">+</span>
                <span class="token string">"}"</span><span class="token punctuation">;</span>
        <span class="token comment">//设置请求中的参数</span>
        request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span> <span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">indices</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭客户端</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>添加单个文档：</p> 
<pre><code class="prism language-java"><span class="token comment">//添加文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testCreateDoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建客户端</span>
        <span class="token class-name">HttpHost</span> host<span class="token operator">=</span><span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestClientBuilder</span> builder<span class="token operator">=</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token class-name">Book</span> book <span class="token operator">=</span> bookDao<span class="token punctuation">.</span><span class="token function">selectById</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">IndexRequest</span> request<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json<span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token punctuation">.</span><span class="token function">index</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span><span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//关闭客户端</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre> 
<p>添加多个文档：</p> 
<pre><code class="prism language-java"><span class="token comment">//添加全部文档</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testCreateDocAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建客户端</span>
        <span class="token class-name">HttpHost</span> host<span class="token operator">=</span><span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestClientBuilder</span> builder<span class="token operator">=</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//把所有东西都查出来，造一个批处理请求的容器</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Book</span><span class="token punctuation">&gt;</span></span> bookList <span class="token operator">=</span> bookDao<span class="token punctuation">.</span><span class="token function">selectList</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">BulkRequest</span> bulk<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">BulkRequest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Book</span> book <span class="token operator">:</span> bookList<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">IndexRequest</span> request<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">IndexRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>book<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> json<span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">toJSONString</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
            request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>json<span class="token punctuation">,</span><span class="token class-name">XContentType</span><span class="token punctuation">.</span>JSON<span class="token punctuation">)</span><span class="token punctuation">;</span>
            bulk<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        client<span class="token punctuation">.</span><span class="token function">bulk</span><span class="token punctuation">(</span>bulk<span class="token punctuation">,</span><span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//关闭客户端</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>查询文档：</p> 
<pre><code class="prism language-java"><span class="token comment">//按id查询</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testGet</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建客户端</span>
        <span class="token class-name">HttpHost</span> host<span class="token operator">=</span><span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestClientBuilder</span> builder<span class="token operator">=</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">GetRequest</span> request<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">GetRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">GetResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> json <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>json<span class="token punctuation">)</span><span class="token punctuation">;</span>


        <span class="token comment">//关闭客户端</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token comment">//按条件查询</span>
    <span class="token annotation punctuation">@Test</span>
    <span class="token keyword">void</span> <span class="token function">testSearch</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">IOException</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//创建客户端</span>
        <span class="token class-name">HttpHost</span> host<span class="token operator">=</span><span class="token class-name">HttpHost</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token string">"http://localhost:9200"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">RestClientBuilder</span> builder<span class="token operator">=</span><span class="token class-name">RestClient</span><span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>host<span class="token punctuation">)</span><span class="token punctuation">;</span>
        client<span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestHighLevelClient</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//查books索引</span>
        <span class="token class-name">SearchRequest</span> request<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SearchRequest</span><span class="token punctuation">(</span><span class="token string">"books"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//设置条件  如果还有条件继续往里排就行</span>
        <span class="token class-name">SearchSourceBuilder</span> builder1<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">SearchSourceBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        builder1<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token class-name">QueryBuilders</span><span class="token punctuation">.</span><span class="token function">termQuery</span><span class="token punctuation">(</span><span class="token string">"all"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        request<span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span>builder1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">SearchResponse</span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">search</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">RequestOptions</span><span class="token punctuation">.</span>DEFAULT<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//查询到的结果如何显示出来</span>
        <span class="token class-name">SearchHits</span> hits <span class="token operator">=</span> response<span class="token punctuation">.</span><span class="token function">getHits</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">SearchHit</span> hit <span class="token operator">:</span> hits<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">String</span> source <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">getSourceAsString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//            System.out.println(source);</span>
            <span class="token class-name">Book</span> book <span class="token operator">=</span> JSON<span class="token punctuation">.</span><span class="token function">parseObject</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> <span class="token class-name">Book</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>book<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">//关闭客户端</span>
        client<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/887851c4f7799ff0cb4c13dff8485c1d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">kkfileview在线预览文件实现 Windows Linux</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/c6ab12aac6680ee3b26f37a2529d5077/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【WEB逆向】关于tiktok参数msToken，X-Bogus，_signature生成</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>