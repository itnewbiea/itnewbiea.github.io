<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>SQL学习 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="SQL学习" />
<meta property="og:description" content="【参考文献】
本·福达：《SQL必知必会》，第5版，刘晓霞、 钟鸣译，北京：人民邮电出版社，2020年
基本概念 DBMS：database management system（数据库管理系统）
提取信息 SELECT 多条 SQL 语句必须以分号（ ； ）分隔。 SQL 语句不区分大小写，因此 SELECT 与 select 是相同的 SQL 语句可以写成长长的一行，也可以分写在多行。 SELECT * FROM Products; 星号（*）通配符可以做到检索所有的列。 SQL应用案例：提取北宋政区 在CHGIS的数据中，需要提取北宋（960-1127）时期的政区。画分析草图，可以知道，如果按照Begin Year 和 End Year ( 用a b c d e f表示)作为筛选标准，一共有6种可能的情况，其中4种情况的年代符合北宋的时间区间。
b1&lt;960 and 960 &lt;b2 &lt; 1127
c1&lt;960 and 1127&lt;c2
960&lt;d1&lt;1127 and 960&lt;d2&lt;1127
960&lt;e1&lt;1127 and 1127&lt;e2
不符合的是：
a1&lt;a2&lt;960 （北宋前的政区）
1127&lt;f1&lt;f2 （北宋后的政区）
根据以上的分析，写如下SQL语句。
SELECT * FROM v6_time_pref_utf_wgs84 WHERE: (&#34;BEG_YR&#34; &lt;=960) AND (960 &lt;= &#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d2ced481d9a19479652d62fc8a1640d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-15T22:50:31+08:00" />
<meta property="article:modified_time" content="2023-12-15T22:50:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">SQL学习</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>【参考文献】</p> 
<blockquote> 
 <p>本·福达：《SQL必知必会》，第5版，刘晓霞、 钟鸣译，北京：人民邮电出版社，2020年</p> 
</blockquote> 
<p></p> 
<h3>基本概念</h3> 
<p></p> 
<p>DBMS：database management system（数据库管理系统）</p> 
<p></p> 
<h3>提取信息</h3> 
<h4>SELECT</h4> 
<p></p> 
<div> 
 <span style="color:#000000;">多条 </span> 
 <span style="color:#000000;">SQL </span> 
 <span style="color:#000000;">语句必须以分号（</span> 
 <span style="color:#000000;">；</span> 
 <span style="color:#000000;">）分隔。</span> 
</div> 
<div></div> 
<div> 
 <span style="color:#000000;">SQL </span> 
 <span style="color:#000000;">语句不区分大小写，因此 </span> 
 <span style="color:#000000;">SELECT </span> 
 <span style="color:#000000;">与 </span> 
 <span style="color:#000000;">select </span> 
 <span style="color:#000000;">是相同的</span> 
</div> 
<div></div> 
<div> 
 <div> 
  <span style="color:#000000;">SQL </span> 
  <span style="color:#000000;">语句可以写成长长的一行，也可以分写在多行。</span> 
 </div> 
 <div> 
  <div></div> 
  <div> 
   <span style="color:#000000;">SELECT * FROM Products; </span>星号（*）通配符可以做到检索所有的列。 
  </div> 
 </div> 
 <div></div> 
 <div></div> 
 <div></div> 
 <h4>SQL应用案例：提取北宋政区</h4> 
 <p>在CHGIS的数据中，需要提取北宋（960-1127）时期的政区。画分析草图，可以知道，如果按照Begin Year 和 End Year ( 用a b c d e f表示)作为筛选标准，一共有6种可能的情况，其中4种情况的年代符合北宋的时间区间。</p> 
 <p>b1&lt;960  and   960 &lt;b2 &lt; 1127</p> 
 <p>c1&lt;960 and 1127&lt;c2</p> 
 <p>960&lt;d1&lt;1127 and 960&lt;d2&lt;1127</p> 
 <p>960&lt;e1&lt;1127 and  1127&lt;e2</p> 
 <p></p> 
 <p></p> 
 <p>不符合的是：</p> 
 <p>a1&lt;a2&lt;960 （北宋前的政区）</p> 
 <p>1127&lt;f1&lt;f2    （北宋后的政区）</p> 
 <p></p> 
 <p>根据以上的分析，写如下SQL语句。</p> 
 <pre><code class="language-sql">SELECT * FROM v6_time_pref_utf_wgs84 WHERE:
("BEG_YR" &lt;=960) AND (960 &lt;= "END_YR" &lt;=1127)</code></pre> 
 <p>但是，该句语法错误。原因在于，(960 &lt;= "END_YR" &lt;=1127) 这个得分开写，用AND连接，否则机器识别不了。更正后如下：</p> 
 <pre><code class="language-sql">("BEG_YR" &lt;=960) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=1127);
("BEG_YR" &lt;=960) AND (1127 &lt;= "END_YR" );
 (960 &lt;= "BEG_YR" AND "BEG_YR" &lt;=1127) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=1127 );
 (960 &lt;= "BEG_YR" AND "BEG_YR" &lt;=1127) AND ( "END_YR" &gt;= 1127 );
</code></pre> 
 <p></p> 
 <p>于是，运行这个语句。</p> 
 <p><img alt="" height="829" src="https://images2.imgbox.com/e4/ba/RDxv32T8_o.png" width="1010"></p> 
 <p>在Arcgis图层的查询构建器中运行，成功验证了表达式。运行后效果如下：</p> 
 <p><img alt="" height="1125" src="https://images2.imgbox.com/fa/ad/8NvLlMYy_o.png" width="1200"></p> 
 <p>不过，这个政区显然不全。所以，需要回顾，考虑一下问题出在哪里。</p> 
 <p>可能的原因是CHGIS的数据本来就不全，有遗漏。</p> 
 <p></p> 
 <p></p> 
 <h3>逻辑结构</h3> 
 <h4>AND 和OR</h4> 
 <p></p> 
 <p>如下代码所示：</p> 
 <pre><code class="language-sql">((("BEG_YR" &lt;=960) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=1127)) OR (("BEG_YR" &lt;=960) AND (1127 &lt;= "END_YR" )) OR 
( (960 &lt;= "BEG_YR" AND "BEG_YR" &lt;=1127) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=1127 )) OR 
( (960 &lt;= "BEG_YR" AND "BEG_YR" &lt;=1127) AND ( "END_YR" &gt;= 1127 ))) AND "NAME_CH" LIKE '%军'
</code></pre> 
 <p>用多重括号，将筛选条件并列在一起。</p> 
 <p>然后，可以加上AND语句，构建新的筛选条件。</p> 
 <p></p> 
 <p>如图所示，这是带以“军”为名称的宋代行政区。</p> 
 <p><img alt="" height="1125" src="https://images2.imgbox.com/de/1d/ASgmcPVV_o.png" width="1200"></p> 
 <p>用同样的这段代码，获得所有的宋代“军”级行政位置点。</p> 
 <pre><code class="language-sql">((("BEG_YR" &lt;=960) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=1127)) OR (("BEG_YR" &lt;=960) AND (1127 &lt;= "END_YR" )) OR 
( (960 &lt;= "BEG_YR" AND "BEG_YR" &lt;=1127) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=1127 )) OR 
( (960 &lt;= "BEG_YR" AND "BEG_YR" &lt;=1127) AND ( "END_YR" &gt;= 1127 ))) AND "NAME_CH" LIKE '%军'
</code></pre> 
 <p>效果如下图所示</p> 
 <p><img alt="" height="1125" src="https://images2.imgbox.com/48/27/be92M87H_o.png" width="1200"></p> 
 <p>但是，下面遇到的问题是，存在同名现象，或者某些字条信息，虽然时间不同，但是名字相同。需要将同名的只保留一个。如何操作？</p> 
 <p><img alt="" height="455" src="https://images2.imgbox.com/25/94/Uxsh3JhW_o.png" width="1200"></p> 
 <p></p> 
 <h4 style="background-color:transparent;">SQL应用：提取唐代政区</h4> 
 <p>如下代码：</p> 
 <pre><code class="language-Delphi">((("BEG_YR" &lt;=618) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=907)) OR (("BEG_YR" &lt;=618) AND (907 &lt;= "END_YR" )) OR 
( (618 &lt;= "BEG_YR" AND "BEG_YR" &lt;=907) AND (618 &lt;= "END_YR" AND "END_YR" &lt;=907 )) OR 
( (618 &lt;= "BEG_YR" AND "BEG_YR" &lt;=907) AND ( "END_YR" &gt;= 907 ))) AND "NAME_CH" LIKE '%州'</code></pre> 
 <p>SQL应用：提取西汉政区</p> 
 <pre><code class="language-sql">((("BEG_YR" &lt;=-202) AND (-202 &lt;= "END_YR" AND "END_YR" &lt;=8)) OR (("BEG_YR" &lt;=-202) AND (8 &lt;= "END_YR" )) OR 
( (-202 &lt;= "BEG_YR" AND "BEG_YR" &lt;=8) AND (-202 &lt;= "END_YR" AND "END_YR" &lt;=8 )) OR 
( (-202 &lt;= "BEG_YR" AND "BEG_YR" &lt;=8) AND ( "END_YR" &gt;= 8 ))) AND "NAME_CH" LIKE '%县'</code></pre> 
 <p></p> 
 <h3><span style="color:#000000;">属性表去重</span></h3> 
 <p>问题：</p> 
 <p>Arcgis软件的一个屬性表名称为“唐朝县”，属性表中有多个字段，其中一个字段为"NAME_CH"，该字段下面有一些同名的数据，这些同名的数据，只需要保留一个，请问如何操作？如何写SQL语言？</p> 
 <p></p> 
 <h4><span style="color:#000000;">DISTINCT</span></h4> 
 <div> 
  <span style="color:#000000;">DISTINCT </span> 
  <span style="color:#000000;">关键字，顾名思义，它指示数据库只返回不同 的值</span> 
 </div> 
 <p>下面想将SQL语句进一步优化：</p> 
 <pre><code class="language-sql">SELECT DISTINCT "NAME_CH"  FROM v6_time_pref_utf_wgs84 WHERE:
("BEG_YR" &lt;=960) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=1127);
("BEG_YR" &lt;=960) AND (1127 &lt;= "END_YR" );
 (960 &lt;= "BEG_YR" AND "BEG_YR" &lt;=1127) AND (960 &lt;= "END_YR" AND "END_YR" &lt;=1127 );
 (960 &lt;= "BEG_YR" AND "BEG_YR" &lt;=1127) AND ( "END_YR" &gt;= 1127 );</code></pre> 
 <p>但是，遗憾的是该表达式是有错误的。</p> 
 <p><img alt="" height="881" src="https://images2.imgbox.com/bb/0d/NepRAS3e_o.png" width="1071"></p> 
 <p></p> 
 <p>错误的原因，可能是Arcgis查询构建器的界面中，已经有了该语句：</p> 
 <pre><code class="language-sql">SELECT * FROM v6_time_pref_utf_wgs84 WHERE:</code></pre> 
 <p>所以，就不能再使用另外的SELECT语句。</p> 
 <pre><code class="language-sql">SELECT DISTINCT "NAME_CH"  FROM v6_time_pref_utf_wgs84 WHERE:</code></pre> 
 <p></p> 
 <h4>查询构建器</h4> 
 <p>针对这个情况，只需要在“图层属性”界面中，输入SQL语言，点击“确定”后，出现“查询构建器”，这个时候，SQL第一句就变为输入的句子了。</p> 
 <p><img alt="" height="806" src="https://images2.imgbox.com/5d/12/NHdErtNn_o.png" width="1079"></p> 
 <p></p> 
 <p>但是，在操作的时候，发现语句是有问题的，无法执行。</p> 
 <p></p> 
 <p>现在，将问题明确一下：</p> 
 <p>Arcgis屬性表中，有多个字段，其中一个字段为"NAME_CH"，该字段下面有一些同名的数据，这些同名的数据，只需要保留一个，请问如何操作？如何写SQL语言？</p> 
 <p></p> 
 <p>实际上，最简单的是这样子的：</p> 
 <p><img alt="" height="872" src="https://images2.imgbox.com/86/9c/apOStIps_o.png" width="1107"></p> 
 <p>选中该字段，然后点击“获取唯一值”。</p> 
 <p><img alt="" height="801" src="https://images2.imgbox.com/ce/63/OrPxJn0A_o.png" width="956"></p> 
 <p>然后输入常规的SQL语言，这个时候再点击“确定”，这个时候，就能把众多在“NAME_CH”字段同名数据，只保留一个。</p> 
 <p></p> 
 <p></p> 
 <p>但是这个又失败了。</p> 
 <pre><code class="language-sql">SELECT DISTINCT 'NAME_CH'  FROM 唐朝县 WHERE:
 "NAME_CH" LIKE '县'</code></pre> 
 <p></p> 
 <h4>Python安装包 arcpy</h4> 
 <p>Arcgis软件的一个屬性表名称为“唐朝县”，属性表中有多个字段，其中一个字段为"NAME_CH"，该字段下面有一些同名的数据，这些同名的数据，只需要保留一个，请问如何操作？如何在Arcgis中写python语言？</p> 
 <p>于是，可以尝试用Python的办法。</p> 
 <pre><code class="language-python">import arcpy  
  
# 设置你的工作空间（即，你的数据所在的位置）  
arcpy.env.workspace = "E:\DH\Map\【历史】政区\唐朝时期 政区\唐朝县.shp"  
  
# 输入和输出表  
input_table = "E:\DH\Map\【历史】政区\唐朝时期 政区\唐朝县.shp"  
output_table = "唐朝县_cleaned.shp"  
  
# 定义一个函数来检查重复的行并删除  
def remove_duplicates(input_table, output_table):  
    # 创建一个查询，选择NAME_CH字段的所有唯一值  
    query = "NAME_CH IN (SELECT DISTINCT NAME_CH FROM 唐朝县)"  
      
    # 使用查询创建新的输出表  
    arcpy.CopyRows_management(input_table, output_table, where_clause=query)  
      
# 调用函数进行清理  
remove_duplicates(input_table, output_table)
</code></pre> 
 <p>以上是人工智能生成的代码。</p> 
 <p>精简后如下：</p> 
 <pre><code class="language-python">import arcpy    
arcpy.env.workspace = "E:\DH\Map\【历史】政区\唐朝时期 政区\唐朝县.shp"  
input_table = "E:\DH\Map\【历史】政区\唐朝时期 政区\唐朝县.shp"  
output_table = "唐朝县_cleaned.shp"  
def remove_duplicates(input_table, output_table):  
    query = "NAME_CH IN (SELECT DISTINCT NAME_CH FROM 唐朝县)"  
    arcpy.CopyRows_management(input_table, output_table, where_clause=query)  
remove_duplicates(input_table, output_table)
</code></pre> 
 <p>但是，运行后，并没有成功。</p> 
 <p><img alt="" height="707" src="https://images2.imgbox.com/5e/e8/dvV21zgz_o.png" width="1152"></p> 
 <p></p> 
 <p>运行之后，出现效果如上。于是又询问文心一言，修正后的代码如下：</p> 
 <pre><code class="language-python">import arcpy    
arcpy.env.workspace = "E:\DH\Map\【历史】政区\唐朝时期 政区\唐朝县.shp"  
input_table = "E:\DH\Map\【历史】政区\唐朝时期 政区\唐朝县.shp"  
output_table = "唐朝县_cleaned.shp"  
def remove_duplicates(input_table, output_table):  
    query = "NAME_CH IN (SELECT DISTINCT NAME_CH FROM 唐朝县)"  
    arcpy.CopyRows_management(input_table, output_table,query)  
remove_duplicates(input_table, output_table)
</code></pre> 
 <p>然后，得到了新的表格。但是，里面的数据并没有变化。</p> 
 <p><img alt="" height="1062" src="https://images2.imgbox.com/4e/d5/8Cki58m6_o.png" width="1200"></p> 
 <p>那么如何进一步优化呢？显然，需要想一些更好的方法。</p> 
 <p><br>  </p> 
 <p>【心得】</p> 
</div> 
<p></p> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d82cedb076ce1d26bb853b23ea21d924/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">ebay刷题记录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/dc5f7ba07e7fa8589943bb9623a01f79/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">SaaS行业分析</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>