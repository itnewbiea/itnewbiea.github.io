<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>JNI快速入门手册 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="JNI快速入门手册" />
<meta property="og:description" content="快速入门 1. 设置环境变量 windows下配置以下环境变量，以及JAVA的环境变量（不在此列出） PATH C:\MinGW\bin; LIBRARY_PATH C:\MinGW\lib C_INCLUDEDE_PATH C:\MinGW\include CPLUS_INCLUDE_PATH C:\MinGW\include\c&#43;&#43;\3.4.2;C:\MinGW\include\c&#43;&#43;\3.4.2\mingw32;C:\MinGW\include\c&#43;&#43;\3.4.2\backward;C:\MinGW\include Linux下配置以下环境变量，要么配置到/etc/profile 里要么配置到用户目录的.bash_profile里 export JAVA_HOME=/usr/lib/jvm/java-6-openjdk-amd64 export PATH=$JAVA_HOME/bin:$PATH export CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar export LD_LIBRARY_PATH=`pwd`:$LD_LIBRARY_PATH 2. 编写Test.java class Test{ { System.loadLibrary(&#34;test&#34;); } public native void display(); public native double sum(double x, double y); public static void main(String[] args){ Test a = new Test(); System.out.println(a.sum(3,5)); a.display(); } } 3. 由Test.java自动生成Test.h $javah Test 注意不用在Test后跟上.java，否则会出错。 有可能报错：
error: cannot access Test class file for Test not found javadoc: error - Class Test not found." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/60226d13d41ec15c3ebba190b0a34827/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2015-03-29T22:45:10+08:00" />
<meta property="article:modified_time" content="2015-03-29T22:45:10+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">JNI快速入门手册</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="快速入门">快速入门</h2> 
<h3 id="1-设置环境变量">1. 设置环境变量</h3> 
<ul><li>windows下配置以下环境变量，以及JAVA的环境变量（不在此列出）</li></ul> 
<pre class="prettyprint"><code class="language-shell hljs tex">PATH                C:<span class="hljs-command">\MinGW</span><span class="hljs-command">\bin</span>; 
LIBRARY_PATH        C:<span class="hljs-command">\MinGW</span><span class="hljs-command">\lib</span> 
C_INCLUDEDE_PATH    C:<span class="hljs-command">\MinGW</span><span class="hljs-command">\include</span> 
CPLUS_INCLUDE_PATH  C:<span class="hljs-command">\MinGW</span><span class="hljs-command">\include</span><span class="hljs-command">\c</span>++\3.4.2;C:<span class="hljs-command">\MinGW</span><span class="hljs-command">\include</span><span class="hljs-command">\c</span>++\3.4.2<span class="hljs-command">\mingw</span>32;C:<span class="hljs-command">\MinGW</span><span class="hljs-command">\include</span><span class="hljs-command">\c</span>++\3.4.2<span class="hljs-command">\backward</span>;C:<span class="hljs-command">\MinGW</span><span class="hljs-command">\include</span></code></pre> 
<ul><li>Linux下配置以下环境变量，要么配置到/etc/profile 里要么配置到用户目录的.bash_profile里</li></ul> 
<pre class="prettyprint"><code class="language-shell hljs bash"><span class="hljs-keyword">export</span> JAVA_HOME=/usr/lib/jvm/java-<span class="hljs-number">6</span>-openjdk-amd64
<span class="hljs-keyword">export</span> PATH=<span class="hljs-variable">$JAVA_HOME</span>/bin:<span class="hljs-variable">$PATH</span>
<span class="hljs-keyword">export</span> CLASSPATH=.:<span class="hljs-variable">$JAVA_HOME</span>/lib/dt.jar:<span class="hljs-variable">$JAVA_HOME</span>/lib/tools.jar
<span class="hljs-keyword">export</span> LD_LIBRARY_PATH=`<span class="hljs-built_in">pwd</span>`:<span class="hljs-variable">$LD_LIBRARY_PATH</span></code></pre> 
<h3 id="2-编写testjava">2. 编写Test.java</h3> 
<pre class="prettyprint"><code class="language-java hljs ">class Test{
    {
        System.loadLibrary(<span class="hljs-string">"test"</span>);
    }
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">void</span> <span class="hljs-title">display</span>();
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-keyword">double</span> <span class="hljs-title">sum</span>(<span class="hljs-keyword">double</span> x, <span class="hljs-keyword">double</span> y);
    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span>(String[] args){
        Test a = <span class="hljs-keyword">new</span> Test();
        System.out.println(a.sum(<span class="hljs-number">3</span>,<span class="hljs-number">5</span>));
        a.display();
    }
}</code></pre> 
<h3 id="3-由testjava自动生成testh">3. 由Test.java自动生成Test.h</h3> 
<pre class="prettyprint"><code class="language-shell hljs bash"><span class="hljs-variable">$javah</span> Test </code></pre> 
<p>注意不用在<code>Test</code>后跟上<code>.java</code>，否则会出错。 <br> 有可能报错：</p> 
<pre class="prettyprint"><code class="language-shell hljs vbnet"><span class="hljs-keyword">error</span>: cannot access Test
<span class="hljs-keyword">class</span> file <span class="hljs-keyword">for</span> Test <span class="hljs-keyword">not</span> found
javadoc: <span class="hljs-keyword">error</span> - <span class="hljs-keyword">Class</span> Test <span class="hljs-keyword">not</span> found.
<span class="hljs-keyword">Error</span>: No classes were specified <span class="hljs-keyword">on</span> the command line.  <span class="hljs-keyword">Try</span> -help.</code></pre> 
<p>此时需要先运行第6步，生成Test.class后才能用javah生成Test.h</p> 
<h3 id="4-编写testc">4. 编写test.c</h3> 
<pre class="prettyprint"><code class="language-c hljs "><span class="hljs-preprocessor">#include "Test.h"</span>
<span class="hljs-preprocessor">#include "stdio.h"</span>

<span class="hljs-comment">/*
 * Class:     Test
 * Method:    display
 * Signature: ()V
 */</span>
JNIEXPORT <span class="hljs-keyword">void</span> JNICALL Java_Test_display
  (JNIEnv *env, jobject obj)
{
    <span class="hljs-built_in">printf</span>(<span class="hljs-string">"hello world!\n"</span>);
}

<span class="hljs-comment">/*
 * Class:     Test
 * Method:    sum
 * Signature: (DD)D
 */</span>
JNIEXPORT jdouble JNICALL Java_Test_sum
  (JNIEnv * env, jobject obj, jdouble a, jdouble b)
{
    <span class="hljs-keyword">return</span> a+b;
}</code></pre> 
<h3 id="5-编译成链接库">5. 编译成链接库</h3> 
<ul><li>windows:</li></ul> 
<pre class="prettyprint"><code class="language-shell hljs lasso"><span class="hljs-subst">&gt;</span>gcc <span class="hljs-attribute">-I</span><span class="hljs-string">"%JAVA_HOME%\include"</span> <span class="hljs-attribute">-I</span><span class="hljs-string">"%JAVA_HOME%\include\win32"</span> <span class="hljs-attribute">-shared</span> <span class="hljs-attribute">-Wl</span>,<span class="hljs-attribute">-kill</span><span class="hljs-attribute">-at</span> <span class="hljs-attribute">-s</span> <span class="hljs-attribute">-o</span> test<span class="hljs-built_in">.</span>dll test<span class="hljs-built_in">.</span>c</code></pre> 
<ul><li>linux:</li></ul> 
<pre class="prettyprint"><code class="language-shell hljs lasso"><span class="hljs-variable">$gcc</span> <span class="hljs-attribute">-I</span><span class="hljs-variable">$JAVA_HOME</span>/include <span class="hljs-attribute">-I</span><span class="hljs-variable">$JAVA_HOME</span>/include/linux <span class="hljs-attribute">-fPIC</span> <span class="hljs-attribute">-shared</span> <span class="hljs-attribute">-o</span> libTest<span class="hljs-built_in">.</span>so test<span class="hljs-built_in">.</span>c</code></pre> 
<p>linux下可编写Makefile如下,可以实现C和C++的混编</p> 
<pre class="prettyprint"><code class=" hljs ruby"><span class="hljs-constant">CC</span> = gcc
<span class="hljs-constant">CXXFLAGS</span> = -<span class="hljs-constant">I</span><span class="hljs-variable">$(</span><span class="hljs-constant">JAVA_HOME</span>)/<span class="hljs-keyword">include</span> -<span class="hljs-constant">I</span><span class="hljs-variable">$(</span><span class="hljs-constant">JAVA_HOME</span>)/<span class="hljs-keyword">include</span>/linux -fPIC -shared -lstdc++
<span class="hljs-constant">LIBJNI_SO</span> = libTest.so
<span class="hljs-constant">SRC_FILE</span> = <span class="hljs-variable">$(</span>wildcard *.c *.cpp)

<span class="hljs-variable">$(</span><span class="hljs-constant">LIBJNI_SO</span>) <span class="hljs-symbol">:</span> <span class="hljs-variable">$(</span><span class="hljs-constant">SRC_FILE</span>)
        <span class="hljs-variable">$(</span><span class="hljs-constant">CC</span>) <span class="hljs-variable">$(</span><span class="hljs-constant">CXXFLAGS</span>) -o <span class="hljs-variable">$@</span> <span class="hljs-variable">$^</span>

<span class="hljs-symbol">clean:</span>
        rm *.so</code></pre> 
<h3 id="6-编译java">6. 编译java</h3> 
<pre class="prettyprint"><code class="language-shell hljs bash"><span class="hljs-variable">$javac</span> Test.java</code></pre> 
<h3 id="7-运行">7. 运行</h3> 
<pre class="prettyprint"><code class="language-shell hljs bash"><span class="hljs-variable">$java</span> Test</code></pre> 
<h3 id="8-注意点">8. 注意点</h3> 
<p>如果系统是64位的，java也是64位的，需要装64位的gcc。 <br> <a href="http://sourceforge.net/projects/mingw-w64/" rel="nofollow">http://sourceforge.net/projects/mingw-w64/</a> <br> 装完要重新配置环境变量</p> 
<h2 id="jni讲解">JNI讲解</h2> 
<h3 id="0-简介">0. 简介</h3> 
<p><code>JNIEnv *env</code>代表的是当前的JNI环境，各种函数都要从这里调用。所有Java的本地函数对应的JNI函数，第一个参数都是<code>JNIEnv *env</code>，第二个参数是当前对象或者类。</p> 
<h3 id="1-c和c区别">1. C和C++区别</h3> 
<p>两者调用<code>env</code>的各种函数名都一样，但是C里的仅是个函数指针，比C++里多传一个参数就是<code>env</code>自己。 <br> 比如：</p> 
<ul><li>C里：</li></ul> 
<pre class="prettyprint"><code class="language-c hljs ">jclass (JNICALL *FindClass)(JNIEnv *env, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *name);`</code></pre> 
<ul><li>对应C++里：</li></ul> 
<pre class="prettyprint"><code class="language-c++ hljs scala">j<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">FindClass</span><span class="hljs-params">(const char *name)</span>;`</span></code></pre> 
<p>调用的时候：</p> 
<ul><li>C里：</li></ul> 
<pre class="prettyprint"><code class="language-c hljs ">JNIEnv *env;
(*env)-&gt;FindClass(env, <span class="hljs-string">"Result"</span>);</code></pre> 
<ul><li>C++里：</li></ul> 
<pre class="prettyprint"><code class="language-c++ hljs haskell"> <span class="hljs-type">JNIEnv</span> *env;
 env-&gt;<span class="hljs-type">FindClass</span>(<span class="hljs-string">"Result"</span>);</code></pre> 
<p>其他函数类似。</p> 
<h3 id="2-函数名对应">2. 函数名对应：</h3> 
<p>Java里函数对应的JNI函数名为<em><code>Java_包名_类名_函数名_参数区分</code></em>，最后面的参数区分只有在多个函数有相同函数名时才会出现。</p> 
<h3 id="3-数据类型对应">3. 数据类型对应：</h3> 
<h4 id="1-简单数据类型">1) 简单数据类型</h4> 
<table><thead><tr><th>Java</th><th>JNI</th><th>C</th></tr></thead><tbody><tr><td>int</td><td>jint</td><td>int</td></tr><tr><td>double</td><td>jdouble</td><td>double</td></tr><tr><td>float</td><td>jfloat</td><td>float</td></tr><tr><td>boolean</td><td>jboolean</td><td>unsigned char 有两个常量:<code>JNI_TRUE</code>和<code>JNI_FALSE</code>分别对应1和0</td></tr><tr><td>String</td><td>jstring</td><td>char*</td></tr></tbody></table> 
<p>除了几个基本类型外，所有的类类型在JNI里对应的都是<code>jobject</code>类型。</p> 
<h4 id="2-string类型">2) String类型</h4> 
<p><code>jstring</code>要转化成<code>char*</code>需要调用<code>GetStringUTFChars</code> <br> 如:</p> 
<pre class="prettyprint"><code class="language-c++ hljs rust">jstring js;
<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span>* <span class="hljs-keyword">str</span> = env-&gt;GetStringUTFChars(js, <span class="hljs-number">0</span>);</code></pre> 
<p>记得在使用完以后，调用<code>ReleaseStringUTFChars</code>来释放内存</p> 
<pre class="prettyprint"><code class="language-c++ hljs rust">env-&gt;ReleaseStringUTFChars(js, <span class="hljs-keyword">str</span>);</code></pre> 
<p><code>char*</code>要转化成<code>jstring</code>需要调用<code>NewStringUTF</code>函数：</p> 
<pre class="prettyprint"><code class="language-c++ hljs fix"><span class="hljs-attribute">js </span>=<span class="hljs-string"> env-&gt;NewStringUTF(str);</span></code></pre> 
<h4 id="3-类类型">3) 类类型</h4> 
<p>类类型的对象一般都会变成<code>jobject</code> <br> 比如： <br> 成员函数第二个参数都是<code>jobject</code>，代表当前函数所在的对象：</p> 
<pre class="prettyprint"><code class="language-c hljs ">JNIEXPORT jfloat JNICALL Java_Test_sum___3F(JNIEnv *env, jobject obj, jfloatArray arr)</code></pre> 
<p>除非是静态函数，第二个参数是jclass:</p> 
<pre class="prettyprint"><code class="language-c hljs ">JNIEXPORT jobject JNICALL Java_Test_getDate(JNIEnv *env, jclass cls)</code></pre> 
<h5 id="i-获取一个类类型">I. 获取一个类类型</h5> 
<p>可以通过<code>FindClass</code>或者<code>GetObjectClass</code>来获取，前者需要传进去一个字符串， 注明包名和类名，后者需要传一个jobject：</p> 
<pre class="prettyprint"><code class=" hljs scala">j<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">dateClass</span> = <span class="hljs-title">env</span>-&gt;<span class="hljs-title">FindClass</span><span class="hljs-params">(<span class="hljs-string">"java/util/Date"</span>)</span>;</span>
j<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">obj</span>;</span>
j<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">curClass</span> = <span class="hljs-title">env</span>-&gt;<span class="hljs-title">GetObjectClass</span><span class="hljs-params">(obj)</span>;</span></code></pre> 
<h5 id="ii-获取对象的成员变量">II. 获取对象的成员变量</h5> 
<p>有如下方式：</p> 
<pre class="prettyprint"><code class=" hljs mel">jfieldID aFid = <span class="hljs-keyword">env</span>-&gt;GetFieldID(curClass, <span class="hljs-string">"a"</span>, <span class="hljs-string">"I"</span>);
<span class="hljs-keyword">int</span> num = (<span class="hljs-keyword">int</span>)<span class="hljs-keyword">env</span>-&gt;GetIntField(obj, aFid);</code></pre> 
<p><code>GetFieldID</code>第一个参数是<code>jclass</code>类型，第二个是变量名，第三个是变量类型的对应符，有以下几种：</p> 
<table><thead><tr><th>Java类型</th><th>符号</th></tr></thead><tbody><tr><td>boolean</td><td>Z</td></tr><tr><td>byte</td><td>B</td></tr><tr><td>char</td><td>C</td></tr><tr><td>short</td><td>S</td></tr><tr><td>int</td><td>I</td></tr><tr><td>long</td><td>L</td></tr><tr><td>float</td><td>F</td></tr><tr><td>double</td><td>D</td></tr><tr><td>void</td><td>V</td></tr><tr><td>objects对象</td><td>Lfully-qualified-class-name; 注意此处要有分号</td></tr><tr><td>Arrays数组</td><td>[array-type</td></tr><tr><td>methods方法</td><td>(argument-types)return-type</td></tr></tbody></table> 
<p><code>GetIntField</code>第一个参数是<code>jobject</code>，即需要处理的对象，第二个是<code>jfieldID</code>。返回<code>int</code> <br> 同样有<code>GetDoubleField</code>、<code>GetObjectField</code>。</p> 
<h5 id="iii-改变成员变量">III. 改变成员变量</h5> 
<p>有如下方式：</p> 
<pre class="prettyprint"><code class="language-c++ hljs haskell"><span class="hljs-title">env</span>-&gt;<span class="hljs-type">SetIntField</span>(obj, aFid, <span class="hljs-number">30</span>);</code></pre> 
<p>同样有<code>SetDoubleField</code>、<code>SetObjectField</code>。</p> 
<h5 id="iv-调用对象的成员方法">IV. 调用对象的成员方法</h5> 
<p>有如下方式：</p> 
<pre class="prettyprint"><code class="language-c hljs ">jmethodID getYearID = env-&gt;GetMethodID(dateClass, <span class="hljs-string">"getYear"</span>, <span class="hljs-string">"()I"</span>);
jint year = env-&gt;CallIntMethod(date, getYearID);</code></pre> 
<p><code>GetMethodID</code>第一个参数是<code>jclass</code>类型，第二个是函数名，第三个是参数类型及返回值，参数类型写在括号里，返回值写在括号后，比如说如果函数参数类型有<code>(int a, float b, String c, double d)</code>，返回值是<code>void</code>，则 <br> 写成<code>"(IFLjava/lang/String;D)V"</code>，注意<code>objects</code>对象对应的地方那个分号。 <br> <code>CallIntMethod</code>第一个参数是<code>jobject</code>，第二个是<code>jmethodID</code>，后面可以跟对应参数。</p> 
<h5 id="v-新建一个对象">V. 新建一个对象</h5> 
<p>需要如下调用：</p> 
<pre class="prettyprint"><code class="language-c++ hljs scala">jint sum = <span class="hljs-number">0</span>;
jstring arg = env-&gt;NewStringUTF(<span class="hljs-string">"all"</span>);
j<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">resultClass</span> = <span class="hljs-title">env</span>-&gt;<span class="hljs-title">FindClass</span><span class="hljs-params">(<span class="hljs-string">"Result"</span>)</span>;</span>
jmethodID resID = env-&gt;GetMethodID(resultClass, <span class="hljs-string">"&lt;init&gt;"</span>, <span class="hljs-string">"(ILjava/lang/String;)V"</span>);
j<span class="hljs-class"><span class="hljs-keyword">object</span> <span class="hljs-title">res</span> = <span class="hljs-title">env</span>-&gt;<span class="hljs-title">NewObject</span><span class="hljs-params">(resultClass, resID, sum ,arg)</span>;</span></code></pre> 
<p><code>NewObject</code>第一个参数是<code>jclass</code>，第二个是<code>jmethodID</code>，后面跟对应参数。</p> 
<h5 id="vi-调用类的静态方法">VI. 调用类的静态方法</h5> 
<p>需要如下调用：</p> 
<pre class="prettyprint"><code class="language-c++ hljs haskell"><span class="hljs-title">jmethodID</span> printMid = env-&gt;<span class="hljs-type">GetStaticMethodID</span>(curClass, <span class="hljs-string">"print"</span>, <span class="hljs-string">"()V"</span>);
<span class="hljs-title">env</span>-&gt;<span class="hljs-type">CallStaticVoidMethod</span>(curClass, printMid);</code></pre> 
<h4 id="4-数组类型">4) 数组类型：</h4> 
<table><thead><tr><th>Java</th><th>JNI</th><th>C</th></tr></thead><tbody><tr><td>int[]</td><td>jintArray</td><td>jint*</td></tr><tr><td>double[]</td><td>jdoubleArray</td><td>jdouble*</td></tr><tr><td>float[]</td><td>jfloatArray</td><td>jfloat*</td></tr><tr><td>String[]</td><td>jobjectArray</td><td>String等其他类类型的数组以及二维数组都对应jobjectArray</td></tr></tbody></table> 
<h5 id="i-普通类型数组">I. 普通类型数组</h5> 
<p>数组长度通过<code>GetArrayLength</code>获取，内容需要通过<code>GetXXXArrayElements</code>获取 <br> 如下：</p> 
<pre class="prettyprint"><code class="language-c++ hljs d">jintArray arr;
jsize len = env-&gt;GetArrayLength(arr);
jint *<span class="hljs-keyword">body</span> = env-&gt;GetIntArrayElements(arr, <span class="hljs-number">0</span>);
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; len ; ++i)
{
    printf(<span class="hljs-string">"%d\n"</span>, <span class="hljs-keyword">body</span>[i]);
    <span class="hljs-keyword">body</span>[i] = i;
}</code></pre> 
<p>记得在使用完后调用<code>ReleaseXXXArrayElements</code>来写回数据并释放内存</p> 
<pre class="prettyprint"><code class="language-c++ hljs haskell"><span class="hljs-title">env</span>-&gt;<span class="hljs-type">ReleaseIntArrayElements</span>(arr, body, <span class="hljs-number">0</span>);</code></pre> 
<p>同理有<code>GetDoubleArrayElements</code>、<code>ReleaseDoubleArrayElements</code>。</p> 
<h5 id="ii-创建一个jintarray">II. 创建一个<code>jintArray</code></h5> 
<p>可以通过<code>NewIntArray</code>来创建，参数传递创建的长度</p> 
<pre class="prettyprint"><code class="language-c++ hljs fix"><span class="hljs-attribute">jintArray newArray </span>=<span class="hljs-string"> env-&gt;NewIntArray(len);</span></code></pre> 
<p>设置内容：</p> 
<pre class="prettyprint"><code class="language-c++ hljs vbscript">jint tmp[<span class="hljs-built_in">len</span>];
env-&gt;SetIntArrayRegion(newArray, <span class="hljs-number">0</span>, <span class="hljs-built_in">len</span>, tmp);</code></pre> 
<h5 id="iii-类类型数组">III. 类类型数组</h5> 
<p>对应<code>jobjectArray</code>，通过<code>GetArrayLength</code>获取数组长度，通过<code>GetObjectArrayElement</code>来获取数组某个元素。如下：</p> 
<pre class="prettyprint"><code class="language-c++ hljs matlab">jobjectArray result;
jsize len = env-&gt;GetArrayLength(result);
<span class="hljs-keyword">for</span>(int <span class="hljs-built_in">i</span> = <span class="hljs-number">0</span> ; <span class="hljs-built_in">i</span> &lt; len ; ++<span class="hljs-built_in">i</span>)
<span class="hljs-cell">{
    jobject obj = env-&gt;GetObjectArrayElement(result, i);
}</span></code></pre> 
<p>有<code>SetObjectArrayElement</code>来对数组进行修改。</p> 
<h5 id="iv-二维数组">IV. 二维数组</h5> 
<p>对应<code>jobjectArray</code>，获取方式和类类型数组相同，只不过获取到的每个元素可以强转成jarray，如下：</p> 
<pre class="prettyprint"><code class="language-c++ hljs mel">jobjectArray arr;
jsize len = <span class="hljs-keyword">env</span>-&gt;GetArrayLength(arr);
<span class="hljs-keyword">int</span> sum = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span> ; i &lt; len ; ++i)
{
    jarray body = (jarray)<span class="hljs-keyword">env</span>-&gt;GetObjectArrayElement(arr, i);
    jsize len2 = <span class="hljs-keyword">env</span>-&gt;GetArrayLength(body);
    jint <span class="hljs-variable">*body2</span> = <span class="hljs-keyword">env</span>-&gt;GetIntArrayElements((jintArray)body, <span class="hljs-number">0</span>);
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span> ; j &lt; len2 ; ++j)
    {
        sum += body2[j];
    }
    <span class="hljs-keyword">env</span>-&gt;ReleaseIntArrayElements((jintArray)body, body2, <span class="hljs-number">0</span>);
}</code></pre> 
<h2 id="示例代码下载">示例代码下载</h2> 
<p>下载地址：<a href="http://download.csdn.net/detail/a578559967/8545449">http://download.csdn.net/detail/a578559967/8545449</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/451728e15b24d53bf80bb318c9f71ff2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">//查找，最后一次出现x</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/24ba296f26ed28f4e95fa2809b349a85/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">ztree 修改数据  默认勾选节点  数据回显</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>