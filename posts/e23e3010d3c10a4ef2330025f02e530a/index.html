<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>STM32G0x0系列 入门试验代码整理 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="STM32G0x0系列 入门试验代码整理" />
<meta property="og:description" content="试验目录 1.配置寄存器的方式点亮一盏灯2.寄存器实现灯闪烁3.HAL库实现跑马灯4.按键控制LED灯5.代码编写，通过寄存器发送字符6.代码编写，通过寄存器发送字符串7.代码编写，通过寄存器设置接收字符8.代码编写，通过寄存器设置接收字符串(自己理解出现问题)9.串口编写，通过HAL库进行字符串发送10.重写printf11.重写scanf12.通过串口控制灯的亮灭13.驱动LED屏14.显示图片15.显示中文字符16.显示英文字符17.按键中断试验18.串口中断试验19.显示器时钟试验20.串口接收中断21.利用Systick实现每隔一秒打印一次“hello world”22.自己设计一款软件定时器(注意数据类型为uint32_t)23.通过软件定时器设置灯闪烁1s24.利用定时器实现1秒打印1个“HELLO WORLD”26.调节灯的亮度27.使用PWM方波调节占空比实现功能28.通过调节PWM占空比实现呼吸灯效果29.高低电平交替控制蜂鸣器30.使用PWM信号控制31.单通道单次转换：采集光照传感器的值32.多通道单次转换（在ADC_Settings中开启扫描模式）33.DMA_ADC单通道采集试验34.DMA_ADC多通道采集试验 1.配置寄存器的方式点亮一盏灯 RCC-&gt;IOPENR |=1&lt;&lt;1; //开启GPIOB的时钟 GPIOB-&gt;MODER &amp;=~(0x03&lt;&lt;4); //将MODER2置为00 GPIOB-&gt;MODER |=1&lt;&lt;4; //将MODER2置为01；开启输出模式 GPIOB-&gt;OTYPER &amp;=~(1&lt;&lt;2); //推挽输出模式 GPIOB-&gt;ODR&amp;=~(1&lt;&lt;2); //设置GPIOB2输出低电平 2.寄存器实现灯闪烁 void Delay(){//自定义函数计数 for(int i =0;i&lt;50;i&#43;&#43;){ for(int j=0;j&lt;60000;j&#43;&#43;){ } } } void SetValue(){ //灭函数 GPIOB-&gt;ODR |=1&lt;&lt;2; } void ResetValue(){//亮函数 GPIOB-&gt;ODR &amp;=~(1&lt;&lt;2); } //main函数 RCC-&gt;IOPENR |=1&lt;&lt;1; //开启GPIOB的时钟 GPIOB-&gt;MODER &amp;=~(0x03&lt;&lt;4);//将MODER2置为00 GPIOB-&gt;MODER |=1&lt;&lt;4;//将MODER2置为01；开启输出模式 GPIOB-&gt;OTYPER &amp;=~(1&lt;&lt;2);//推挽输出模式 GPIOB-&gt;ODR&amp;=~(1&lt;&lt;2);//设置GPIOB2输出低电平 Delay(); /* USER CODE END Init */ /* Configure the system clock */ SystemClock_Config(); /* USER CODE BEGIN SysInit */ /* USER CODE END SysInit */ /* Initialize all configured peripherals */ /* USER CODE BEGIN 2 */ /* USER CODE END 2 */ /* Infinite loop */ /* USER CODE BEGIN WHILE */ while (1) { SetValue(); Delay(); ResetValue(); Delay(); /* USER CODE END WHILE */ /* USER CODE BEGIN 3 */ } 3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e23e3010d3c10a4ef2330025f02e530a/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-05T11:30:56+08:00" />
<meta property="article:modified_time" content="2023-06-05T11:30:56+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">STM32G0x0系列 入门试验代码整理</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>试验目录</h4> 
 <ul><li><ul><li><ul><li><ul><li><ul><li><a href="#1_2" rel="nofollow">1.配置寄存器的方式点亮一盏灯</a></li><li><a href="#2_12" rel="nofollow">2.寄存器实现灯闪烁</a></li><li><a href="#3HAL_62" rel="nofollow">3.HAL库实现跑马灯</a></li><li><a href="#4LED_81" rel="nofollow">4.按键控制LED灯</a></li><li><a href="#5_98" rel="nofollow">5.代码编写，通过寄存器发送字符</a></li><li><a href="#6_117" rel="nofollow">6.代码编写，通过寄存器发送字符串</a></li><li><a href="#7_134" rel="nofollow">7.代码编写，通过寄存器设置接收字符</a></li><li><a href="#8_153" rel="nofollow">8.代码编写，通过寄存器设置接收字符串(自己理解出现问题)</a></li><li><a href="#9HAL_184" rel="nofollow">9.串口编写，通过HAL库进行字符串发送</a></li><li><a href="#10printf_195" rel="nofollow">10.重写printf</a></li><li><a href="#11scanf_206" rel="nofollow">11.重写scanf</a></li><li><a href="#12_218" rel="nofollow">12.通过串口控制灯的亮灭</a></li><li><a href="#13LED_233" rel="nofollow">13.驱动LED屏</a></li><li><a href="#14_246" rel="nofollow">14.显示图片</a></li><li><a href="#15_259" rel="nofollow">15.显示中文字符</a></li><li><a href="#16_273" rel="nofollow">16.显示英文字符</a></li><li><a href="#17_287" rel="nofollow">17.按键中断试验</a></li><li><a href="#18_313" rel="nofollow">18.串口中断试验</a></li><li><a href="#19_334" rel="nofollow">19.显示器时钟试验</a></li><li><a href="#20_396" rel="nofollow">20.串口接收中断</a></li><li><a href="#21Systickhello_world_413" rel="nofollow">21.利用Systick实现每隔一秒打印一次“hello world”</a></li><li><a href="#22uint32_t_441" rel="nofollow">22.自己设计一款软件定时器(注意数据类型为uint32_t)</a></li><li><a href="#231s_482" rel="nofollow">23.通过软件定时器设置灯闪烁1s</a></li><li><a href="#2411HELLO_WORLD_495" rel="nofollow">24.利用定时器实现1秒打印1个“HELLO WORLD”</a></li><li><a href="#26_526" rel="nofollow">26.调节灯的亮度</a></li><li><a href="#27PWM_535" rel="nofollow">27.使用PWM方波调节占空比实现功能</a></li><li><a href="#28PWM_547" rel="nofollow">28.通过调节PWM占空比实现呼吸灯效果</a></li><li><a href="#29_573" rel="nofollow">29.高低电平交替控制蜂鸣器</a></li><li><a href="#30PWM_584" rel="nofollow">30.使用PWM信号控制</a></li><li><a href="#31_598" rel="nofollow">31.单通道单次转换：采集光照传感器的值</a></li><li><a href="#32ADC_Settings_615" rel="nofollow">32.多通道单次转换（在ADC_Settings中开启扫描模式）</a></li><li><a href="#33DMA_ADC_636" rel="nofollow">33.DMA_ADC单通道采集试验</a></li><li><a href="#34DMA_ADC_652" rel="nofollow">34.DMA_ADC多通道采集试验</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h6><a id="1_2"></a>1.配置寄存器的方式点亮一盏灯</h6> 
<pre><code class="prism language-c">	RCC<span class="token operator">-&gt;</span>IOPENR <span class="token operator">|=</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//开启GPIOB的时钟</span>
	GPIOB<span class="token operator">-&gt;</span>MODER <span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//将MODER2置为00</span>
	GPIOB<span class="token operator">-&gt;</span>MODER <span class="token operator">|=</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">;</span> <span class="token comment">//将MODER2置为01；开启输出模式</span>
	GPIOB<span class="token operator">-&gt;</span>OTYPER <span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//推挽输出模式</span>
	GPIOB<span class="token operator">-&gt;</span>ODR<span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//设置GPIOB2输出低电平</span>
</code></pre> 
<h6><a id="2_12"></a>2.寄存器实现灯闪烁</h6> 
<pre><code class="prism language-c"><span class="token keyword">void</span> <span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//自定义函数计数</span>
	<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">50</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">int</span> j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>j<span class="token operator">&lt;</span><span class="token number">60000</span><span class="token punctuation">;</span>j<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//灭函数</span>
GPIOB<span class="token operator">-&gt;</span>ODR <span class="token operator">|=</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">void</span> <span class="token function">ResetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span><span class="token comment">//亮函数</span>
GPIOB<span class="token operator">-&gt;</span>ODR <span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//main函数</span>
	RCC<span class="token operator">-&gt;</span>IOPENR <span class="token operator">|=</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//开启GPIOB的时钟</span>
	GPIOB<span class="token operator">-&gt;</span>MODER <span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//将MODER2置为00</span>
	GPIOB<span class="token operator">-&gt;</span>MODER <span class="token operator">|=</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">4</span><span class="token punctuation">;</span><span class="token comment">//将MODER2置为01；开启输出模式</span>
	GPIOB<span class="token operator">-&gt;</span>OTYPER <span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//推挽输出模式</span>
	GPIOB<span class="token operator">-&gt;</span>ODR<span class="token operator">&amp;=</span><span class="token operator">~</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置GPIOB2输出低电平</span>
	<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* USER CODE END Init */</span>

  <span class="token comment">/* Configure the system clock */</span>
  <span class="token function">SystemClock_Config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">/* USER CODE BEGIN SysInit */</span>

  <span class="token comment">/* USER CODE END SysInit */</span>

  <span class="token comment">/* Initialize all configured peripherals */</span>
  <span class="token comment">/* USER CODE BEGIN 2 */</span>

  <span class="token comment">/* USER CODE END 2 */</span>

  <span class="token comment">/* Infinite loop */</span>
  <span class="token comment">/* USER CODE BEGIN WHILE */</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
		<span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">ResetValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">Delay</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">/* USER CODE END WHILE */</span>
    <span class="token comment">/* USER CODE BEGIN 3 */</span>
  <span class="token punctuation">}</span>
</code></pre> 
<h6><a id="3HAL_62"></a>3.HAL库实现跑马灯</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.将PB0和PB1和PB2配置为输出模式</span>
<span class="token comment">//2.设置输出电平为高电平，让灯关闭</span>
<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>BLUE_GPIO_Port<span class="token punctuation">,</span>BLUE_Pin<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启蓝灯</span>
		<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GREE_GPIO_Port<span class="token punctuation">,</span>GREE_Pin<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭绿灯</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>YELLO_GPIO_Port<span class="token punctuation">,</span>YELLO_Pin<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭黄灯</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>BLUE_GPIO_Port<span class="token punctuation">,</span>BLUE_Pin<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启蓝灯</span>
		<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GREE_GPIO_Port<span class="token punctuation">,</span>GREE_Pin<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭绿灯</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>YELLO_GPIO_Port<span class="token punctuation">,</span>YELLO_Pin<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭黄灯</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>BLUE_GPIO_Port<span class="token punctuation">,</span>BLUE_Pin<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启蓝灯</span>
		<span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>GREE_GPIO_Port<span class="token punctuation">,</span>GREE_Pin<span class="token punctuation">,</span>GPIO_PIN_SET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭绿灯</span>
    <span class="token function">HAL_GPIO_WritePin</span><span class="token punctuation">(</span>YELLO_GPIO_Port<span class="token punctuation">,</span>YELLO_Pin<span class="token punctuation">,</span>GPIO_PIN_RESET<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//关闭黄灯</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h6><a id="4LED_81"></a>4.按键控制LED灯</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.配置PA8为输入状态</span>
<span class="token comment">//2.将灯的引脚配置为高电平输出</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span>GPIO_PIN_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment">//读取管脚PA8的状态</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//消抖</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GPIO_ReadPin</span><span class="token punctuation">(</span>GPIOA<span class="token punctuation">,</span>GPIO_PIN_8<span class="token punctuation">)</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>BLUE_GPIO_Port<span class="token punctuation">,</span>BLUE_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//反转灯的状态</span>
		<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>YELLO_GPIO_Port<span class="token punctuation">,</span>YELLO_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//反转灯的状态</span>
		<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>GREE_GPIO_Port<span class="token punctuation">,</span>GREE_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//反转灯的状态</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="5_98"></a>5.代码编写，通过寄存器发送字符</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启USART1串口</span>
<span class="token comment">//2.设置异步通信模式</span>
<span class="token comment">//3.配置波特率，字长，校验位，停止位</span>
<span class="token keyword">void</span> <span class="token function">SendChar</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> ch<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART1<span class="token operator">-&gt;</span>ISR<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//重点，0的时候不发，1的时候发送</span>
	USART1<span class="token operator">-&gt;</span>TDR<span class="token operator">=</span>ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token function">SendChar</span><span class="token punctuation">(</span><span class="token char">'A'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//主函数调用</span>
		<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="6_117"></a>6.代码编写，通过寄存器发送字符串</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启USART1串口</span>
<span class="token comment">//2.设置异步通信模式</span>
<span class="token comment">//3.配置波特率，字长，校验位，停止位</span>
<span class="token keyword">void</span> <span class="token function">SendString</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span> buf<span class="token punctuation">)</span><span class="token comment">//定义指针类型</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token comment">//这里</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">SendChar</span><span class="token punctuation">(</span><span class="token operator">*</span>buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
		buf<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
		<span class="token function">SendChar</span><span class="token punctuation">(</span><span class="token char">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="7_134"></a>7.代码编写，通过寄存器设置接收字符</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启USART1串口</span>
<span class="token comment">//2.设置异步通信模式</span>
<span class="token comment">//3.配置波特率，字长，校验位，停止位</span>
<span class="token class-name">uint8_t</span> <span class="token function">RecvChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART1<span class="token operator">-&gt;</span>ISR<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//寄存器第5位</span>
	<span class="token keyword">return</span> USART1<span class="token operator">-&gt;</span>RDR<span class="token punctuation">;</span><span class="token comment">//字符在前</span>
<span class="token punctuation">}</span>

  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>
		<span class="token class-name">uint8_t</span> ch<span class="token operator">=</span><span class="token function">RecvChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//接收字符</span>
		<span class="token function">SendChar</span><span class="token punctuation">(</span>ch<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre> 
<h6><a id="8_153"></a>8.代码编写，通过寄存器设置接收字符串(自己理解出现问题)</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启USART1串口</span>
<span class="token comment">//2.设置异步通信模式</span>
<span class="token comment">//3.配置波特率，字长，校验位，停止位</span>
<span class="token class-name">uint8_t</span> <span class="token function">RecvChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART1<span class="token operator">-&gt;</span>ISR<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//寄存器第5位</span>
	<span class="token keyword">return</span> USART1<span class="token operator">-&gt;</span>RDR<span class="token punctuation">;</span><span class="token comment">//字符在前</span>
<span class="token punctuation">}</span>

<span class="token comment">//字符串结束函数</span>
<span class="token keyword">void</span> <span class="token function">RecvString</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>buf<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token class-name">uint8_t</span> ch<span class="token punctuation">;</span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	  ch<span class="token operator">=</span><span class="token function">RecvChar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>ch <span class="token operator">==</span> <span class="token char">' '</span><span class="token operator">||</span> ch <span class="token operator">==</span><span class="token char">'\n'</span> <span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token operator">*</span>buf<span class="token operator">=</span><span class="token char">'\0'</span><span class="token punctuation">;</span>   <span class="token comment">//</span>
			<span class="token keyword">break</span><span class="token punctuation">;</span> 		<span class="token comment">//</span>
		<span class="token punctuation">}</span><span class="token keyword">else</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token operator">*</span>buf<span class="token operator">=</span>ch<span class="token punctuation">;</span>
			buf<span class="token operator">++</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="9HAL_184"></a>9.串口编写，通过HAL库进行字符串发送</h6> 
<pre><code class="prism language-C">//1.开启USART1串口
//2.设置异步通信模式
//3.配置波特率，字长，校验位，停止位
HAL_UART_Receive(&amp;huart1,buf,sizeof(buf),1000);//将字符放到RDR
HAL_UART_Transmit(&amp;huart1,buf,strlen((char*)buf),1000);//将将字符放到TDR
memset(buf,0,sizeof(buf));//这里得清除
</code></pre> 
<h6><a id="10printf_195"></a>10.重写printf</h6> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token keyword">int</span> ch<span class="token punctuation">,</span>FILE<span class="token operator">*</span>S<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART1<span class="token operator">-&gt;</span>ISR<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	USART1<span class="token operator">-&gt;</span>TDR<span class="token operator">=</span>ch<span class="token punctuation">;</span>
	<span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="11scanf_206"></a>11.重写scanf</h6> 
<pre><code class="prism language-c"><span class="token keyword">int</span> <span class="token function">fgetc</span><span class="token punctuation">(</span>FILE<span class="token operator">*</span>S<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">uint8_t</span> ch<span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART1<span class="token operator">-&gt;</span>ISR <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ch<span class="token operator">=</span>USART1<span class="token operator">-&gt;</span>RDR<span class="token punctuation">;</span>
    <span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="12_218"></a>12.通过串口控制灯的亮灭</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启USART1串口</span>
<span class="token comment">//2.设置异步通信模式</span>
<span class="token comment">//3.配置波特率，字长，校验位，停止位</span>
<span class="token comment">//4.设置对应灯的引脚，配置为输出模式并设置为高电平</span>
<span class="token function">HAL_UART_Receive</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span>buf<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//接收串口的数据</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strncmp</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span>buf<span class="token punctuation">,</span><span class="token string">"B_ON"</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token comment">//比较字符串的字符</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>BLUE_GPIO_Port<span class="token punctuation">,</span>BLUE_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//反转灯的状态</span>
<span class="token punctuation">}</span>
<span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清空</span>
</code></pre> 
<h6><a id="13LED_233"></a>13.驱动LED屏</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.根据厂家给定的手册配置引脚接口</span>
<span class="token comment">//2.将PB6，PB5,PB4,PB3和PA15配置为输出模式</span>
<span class="token comment">//3.按照驱动代码中的引脚分别为引脚命名</span>
<span class="token comment">//4.LCD的GPIO输出速度设置为very high</span>
<span class="token comment">//5.添加.c和.h到文件目录下</span>
<span class="token comment">//6.包含头文件</span>
<span class="token function">Lcd_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化显示器</span>
<span class="token function">Lcd_Clear</span><span class="token punctuation">(</span><span class="token number">0x07FF</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置背景色</span>
</code></pre> 
<h6><a id="14_246"></a>14.显示图片</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.根据厂家给定的手册配置引脚接口</span>
<span class="token comment">//2.将PB6，PB5,PB4,PB3和PA15配置为输出模式</span>
<span class="token comment">//3.按照驱动代码中的引脚分别为引脚命名</span>
<span class="token comment">//4.LCD的GPIO输出速度设置为very high</span>
<span class="token comment">//5.添加.c和.h到文件目录下</span>
<span class="token comment">//6.包含头文件</span>
<span class="token function">Lcd_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化显示器</span>
<span class="token function">showimage</span><span class="token punctuation">(</span>gImage_test<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示图片</span>
</code></pre> 
<h6><a id="15_259"></a>15.显示中文字符</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.根据厂家给定的手册配置引脚接口</span>
<span class="token comment">//2.将PB6，PB5,PB4,PB3和PA15配置为输出模式</span>
<span class="token comment">//3.按照驱动代码中的引脚分别为引脚命名</span>
<span class="token comment">//4.LCD的GPIO输出速度设置为very high</span>
<span class="token comment">//5.添加.c和.h到文件目录下</span>
<span class="token comment">//6.包含头文件</span>
<span class="token function">Lcd_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化显示器</span>
<span class="token function">showimage</span><span class="token punctuation">(</span>gImage_test<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示图片</span>
<span class="token function">Gui_DrawFont_1616</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>WHITE<span class="token punctuation">,</span>RED<span class="token punctuation">,</span>CharBuf<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//只能显示中文字符</span>
</code></pre> 
<h6><a id="16_273"></a>16.显示英文字符</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.根据厂家给定的手册配置引脚接口</span>
<span class="token comment">//2.将PB6，PB5,PB4,PB3和PA15配置为输出模式</span>
<span class="token comment">//3.按照驱动代码中的引脚分别为引脚命名</span>
<span class="token comment">//4.LCD的GPIO输出速度设置为very high</span>
<span class="token comment">//5.添加.c和.h到文件目录下</span>
<span class="token comment">//6.包含头文件</span>
<span class="token function">Lcd_Init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//初始化显示器</span>
<span class="token function">showimage</span><span class="token punctuation">(</span>gImage_test<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//显示图片</span>
<span class="token function">Gui_DrawFont_GBK16</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">20</span><span class="token punctuation">,</span>WHITE<span class="token punctuation">,</span>RED<span class="token punctuation">,</span><span class="token string">"HELLO WORLD"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//只能显示英文字符</span>
</code></pre> 
<h6><a id="17_287"></a>17.按键中断试验</h6> 
<p>单片机正常执行LED灯闪烁程序，当检测到按键按下时通过串口输出“Key Interrupt！”</p> 
<pre><code class="prism language-c"><span class="token comment">//1.将对应灯管脚配置为输出模式</span>
<span class="token comment">//2.将按键对应管脚配置为输出模式</span>
<span class="token comment">//3.开USART1使能，并配置为异步通信模式</span>
<span class="token comment">//4.使能管脚中断</span>
<span class="token comment">//5.设置按键管脚的中断为外部中断且为上升沿触发</span>
<span class="token comment">//重写按键上升沿中断函数</span>
<span class="token keyword">void</span> <span class="token function">HAL_GPIO_EXTI_Rising_Callback</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO_Pin <span class="token operator">==</span> GPIO_PIN_8<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"Key Interrupt！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//反转灯的状态</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>BLUE_GPIO_Port<span class="token punctuation">,</span>BLUE_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="18_313"></a>18.串口中断试验</h6> 
<p>串口输出“hellowolrd”，当发送完成后触发中断，打印“Transmit Completed！”</p> 
<pre><code class="prism language-c"><span class="token comment">//1.开启串口，并设置为异步通信模式</span>
<span class="token comment">//2.配置波特率，字长，校验位，停止位</span>
<span class="token comment">//3.开启串口中断使能</span>

<span class="token function">HAL_UART_Transmit_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token string">"hello world"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token string">"hello world"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//以中断模式发送hello world</span>

<span class="token comment">//重写发送中断函数</span>
<span class="token keyword">void</span> <span class="token function">HAL_UART_TxCpltCallback</span><span class="token punctuation">(</span>UART_HandleTypeDef <span class="token operator">*</span>huart<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>huart<span class="token operator">==</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">HAL_UART_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token string">"Transmit Completed!"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token string">"Transmit Completed!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="19_334"></a>19.显示器时钟试验</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.根据厂家给定的手册配置引脚接口</span>
<span class="token comment">//2.将PB6，PB5,PB4,PB3和PA15配置为输出模式</span>
<span class="token comment">//3.按照驱动代码中的引脚分别为引脚命名</span>
<span class="token comment">//4.LCD的GPIO输出速度设置为very high</span>
<span class="token comment">//5.因为功能设置中牵扯到了按键重计时</span>
<span class="token comment">//6.以中断开启按键</span>
<span class="token comment">//7.设置按键中断使能</span>
<span class="token comment">//8.添加.c和.h到文件目录下</span>
<span class="token comment">//9.包含头文件</span>
<span class="token keyword">void</span> <span class="token function">Mytime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">uint8_t</span> timebuf<span class="token punctuation">[</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"00:00:00"</span><span class="token punctuation">;</span>
<span class="token class-name">uint32_t</span> hour<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>min<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>

<span class="token keyword">void</span> <span class="token function">Mytime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	timebuf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">':'</span><span class="token punctuation">;</span>timebuf<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token char">':'</span><span class="token punctuation">;</span>
	sec<span class="token operator">++</span><span class="token punctuation">;</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"sec %c"</span><span class="token punctuation">,</span>sec<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>sec<span class="token operator">&lt;</span><span class="token number">60</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
	   timebuf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">=</span>sec<span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
	   timebuf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span>sec<span class="token operator">/</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
	   sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		 timebuf<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token operator">=</span>sec<span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
	   timebuf<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span><span class="token operator">=</span>sec<span class="token operator">/</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
		
		 min<span class="token operator">++</span><span class="token punctuation">;</span>
	   <span class="token keyword">if</span><span class="token punctuation">(</span>min<span class="token operator">&lt;</span><span class="token number">60</span><span class="token punctuation">)</span>
	   <span class="token punctuation">{<!-- --></span>
		     timebuf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>min<span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
		     timebuf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>min<span class="token operator">/</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
	   <span class="token punctuation">}</span>
	   <span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
		    min<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
			  timebuf<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token operator">=</span>min<span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
			  timebuf<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token operator">=</span>min<span class="token operator">/</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
		    hour<span class="token operator">++</span><span class="token punctuation">;</span>
	     <span class="token keyword">if</span><span class="token punctuation">(</span>hour<span class="token operator">&lt;</span><span class="token number">24</span><span class="token punctuation">)</span>
	       <span class="token punctuation">{<!-- --></span>
        	timebuf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>hour<span class="token operator">%</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
	        timebuf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>hour<span class="token operator">/</span><span class="token number">10</span><span class="token operator">+</span><span class="token number">48</span><span class="token punctuation">;</span>
	       <span class="token punctuation">}</span>
	        <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
	<span class="token function">Gui_DrawFont_GBK16</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span>WHITE<span class="token punctuation">,</span>RED<span class="token punctuation">,</span>timebuf<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//重写上升中断使能，当按键按下时，触发上升沿中断</span>
<span class="token keyword">void</span> <span class="token function">HAL_GPIO_EXTI_Rising_Callback</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>GPIO_Pin <span class="token operator">==</span> GPIO_PIN_8<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        hour<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>min<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>sec<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token comment">//将其重置为0</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="20_396"></a>20.串口接收中断</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启串口，并设置为异步通信模式</span>
<span class="token comment">//2.配置波特率，字长，校验位，停止位</span>
<span class="token comment">//3.开启串口中断使能</span>
<span class="token function">HAL_UART_Receive_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span>Recbuf<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//以中断模式接收4个字符</span>

<span class="token keyword">void</span> <span class="token function">HAL_UART_RxCpltCallback</span><span class="token punctuation">(</span>UART_HandleTypeDef <span class="token operator">*</span>huart<span class="token punctuation">)</span><span class="token comment">//重写中断函数</span>
<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>huart<span class="token operator">==</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
					<span class="token function">HAL_UART_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token string">"Uart Recive 4 character！"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token string">"Uart Recive 4 character！"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>			
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="21Systickhello_world_413"></a>21.利用Systick实现每隔一秒打印一次“hello world”</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启USART1串口</span>
<span class="token comment">//2.设置串口中断使能</span>
<span class="token keyword">extern</span> <span class="token keyword">int</span> flag<span class="token punctuation">;</span>
<span class="token comment">//systick中断服务</span>
<span class="token keyword">void</span> <span class="token function">SysTick_Handler</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
  <span class="token comment">/* USER CODE BEGIN SysTick_IRQn 0 */</span>
	flag<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token comment">/* USER CODE END SysTick_IRQn 0 */</span>
  <span class="token function">HAL_IncTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">/* USER CODE BEGIN SysTick_IRQn 1 */</span>

  <span class="token comment">/* USER CODE END SysTick_IRQn 1 */</span>
<span class="token punctuation">}</span>

<span class="token comment">//main</span>
  <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">{<!-- --></span>	
		<span class="token keyword">if</span><span class="token punctuation">(</span>flag <span class="token operator">==</span> <span class="token number">1000</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token function">HAL_UART_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token string">"hello world!"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token string">"hello world!"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			flag<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="22uint32_t_441"></a>22.自己设计一款软件定时器(注意数据类型为uint32_t)</h6> 
<pre><code class="prism language-c"><span class="token comment">//主程序文件</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"softtime.h"</span></span>
<span class="token keyword">void</span> <span class="token function">SetTime</span><span class="token punctuation">(</span>MyClock <span class="token operator">*</span>temp<span class="token punctuation">,</span><span class="token class-name">uint32_t</span> delayms<span class="token punctuation">)</span><span class="token comment">//1.此处是uint32_t</span>
<span class="token punctuation">{<!-- --></span>
    temp<span class="token operator">-&gt;</span>start<span class="token operator">=</span><span class="token function">HAL_GetTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取当前时间</span>
    temp<span class="token operator">-&gt;</span>delay<span class="token operator">=</span>delayms<span class="token punctuation">;</span><span class="token comment">//存储用户时间</span>
<span class="token punctuation">}</span>

<span class="token class-name">uint32_t</span> <span class="token function">CompareTime</span><span class="token punctuation">(</span>MyClock <span class="token operator">*</span>temp<span class="token punctuation">)</span><span class="token comment">//1.此处是uint32_t</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//比较用户时间</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">HAL_GetTick</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span>temp<span class="token operator">-&gt;</span>start<span class="token operator">&gt;=</span>temp<span class="token operator">-&gt;</span>delay<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<pre><code class="prism language-c"><span class="token comment">//头文件</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">__SOFTTIME__H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">__SOFTTIME__H__</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"stm32g0xx_hal.h"</span></span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token class-name">timer</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token class-name">uint32_t</span> start<span class="token punctuation">;</span>
    <span class="token class-name">uint32_t</span> delay<span class="token punctuation">;</span>
<span class="token punctuation">}</span>MyClock<span class="token punctuation">;</span>
<span class="token comment">//设置定时时间</span>
<span class="token keyword">void</span> <span class="token function">SetTime</span><span class="token punctuation">(</span>MyClock <span class="token operator">*</span>temp<span class="token punctuation">,</span><span class="token class-name">uint32_t</span> delayms<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//比较定时时间</span>
<span class="token class-name">uint32_t</span> <span class="token function">CompareTime</span><span class="token punctuation">(</span>MyClock <span class="token operator">*</span>temp<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>
</code></pre> 
<h6><a id="231s_482"></a>23.通过软件定时器设置灯闪烁1s</h6> 
<pre><code class="prism language-c">MyClock c1<span class="token punctuation">;</span><span class="token comment">//先实例化定时器</span>
<span class="token function">SetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c1<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置定时间隔</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">CompareTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c1<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>BLUE_GPIO_Port<span class="token punctuation">,</span>BLUE_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//让灯反转</span>
			<span class="token function">SetTime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>c1<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="2411HELLO_WORLD_495"></a>24.利用定时器实现1秒打印1个“HELLO WORLD”</h6> 
<ul><li>必须中断使能，定时器使用的就是中断技术</li><li>鬼知道是TIM14啊</li><li>时钟树配置出现<strong>RCC</strong>，使用<strong>RCC</strong>可以选择晶体陶瓷振荡器</li></ul> 
<pre><code class="prism language-c"><span class="token comment">//鬼知道是TIM14啊</span>

<span class="token comment">//1.开启USART1使能</span>
<span class="token comment">//2.配置为异步通信模式</span>
<span class="token comment">//3.开启RCC</span>
<span class="token comment">//4.设置为HSE选择晶体陶瓷谐振器</span>
<span class="token comment">//5.调节AHB总线时钟主频为64MHZ</span>
<span class="token comment">//6.设置TIM14时钟，开启活动</span>
<span class="token comment">//7.配置计数设置，设置预分频计数（6400），计数模式（up），自动重装值（10000）</span>
<span class="token comment">//8.使能TIM14中断</span>

<span class="token comment">//中断的方式启动定时器</span>
<span class="token function">HAL_TIM_Base_Start_IT</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim14<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//定时器溢出中断回调函数</span>
<span class="token keyword">void</span> <span class="token function">HAL_TIM_PeriodElapsedCallback</span><span class="token punctuation">(</span>TIM_HandleTypeDef <span class="token operator">*</span>htim<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>htim <span class="token operator">==</span> <span class="token operator">&amp;</span>htim14<span class="token punctuation">)</span><span class="token comment">//判断定时器是不是tim14触发的</span>
	<span class="token punctuation">{<!-- --></span>
	 <span class="token function">HAL_UART_Transmit</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>huart1<span class="token punctuation">,</span><span class="token string">"HELLO WORLD"</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token string">"HELLO WORLD"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="26_526"></a>26.调节灯的亮度</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.将对应灯的引脚配置为输出模式</span>
<span class="token comment">//2.电平为高电平</span>
<span class="token function">HAL_GPIO_TogglePin</span><span class="token punctuation">(</span>BLUE_GPIO_Port<span class="token punctuation">,</span>BLUE_Pin<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//翻转灯</span>
<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//通过延时调节</span>
</code></pre> 
<h6><a id="27PWM_535"></a>27.使用PWM方波调节占空比实现功能</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启RCC,设置为HSE选择晶体陶瓷谐振器</span>
<span class="token comment">//2.调节AHB总线时钟主频为64MHZ</span>
<span class="token comment">//3.开启对应的灯的时间模块</span>
<span class="token comment">//4.设置对应灯的通道（选择了3）</span>
<span class="token comment">//5.计时设置，预分频值为（64-1），计数模式（up），计数周期（1000）</span>
<span class="token comment">//6.PWM产生的通道3 设置Pulse为500（脉冲，高电平持续时间）</span>
<span class="token function">HAL_TIM_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim3<span class="token punctuation">,</span>TIM_CHANNEL_3<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启TIM定时器</span>
</code></pre> 
<h6><a id="28PWM_547"></a>28.通过调节PWM占空比实现呼吸灯效果</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启RCC,设置为HSE选择晶体陶瓷谐振器</span>
<span class="token comment">//2.调节AHB总线时钟主频为64MHZ</span>
<span class="token comment">//3.开启对应的灯的时间模块</span>
<span class="token comment">//4.设置对应灯的通道（选择了3）</span>
<span class="token comment">//5.计时设置，预分频值为（64-1），计数模式（up），计数周期（1000）</span>
<span class="token comment">//6.PWM产生的通道3 设置Pulse为500（脉冲，高电平持续时间）</span>

<span class="token comment">//ccr决定了占空比，ccr从大到小是灯亮，ccr从小到大是灯灭</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">--</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        TIM3<span class="token operator">-&gt;</span>CRR3<span class="token operator">=</span>i<span class="token punctuation">;</span>
        <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1ms减1</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span><span class="token number">1000</span><span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
         TIM3<span class="token operator">-&gt;</span>CRR3<span class="token operator">=</span>i<span class="token punctuation">;</span>
         <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//1ms加1  </span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="29_573"></a>29.高低电平交替控制蜂鸣器</h6> 
<pre><code class="prism language-C">//1.设置PB7为输出电平模式
while(1)
{
    HAL_GPIO_TogglePin(GPIOB,GPIO_PIN_7);//基极接口电平反复反转
    HAL_Delay(1);
}
</code></pre> 
<h6><a id="30PWM_584"></a>30.使用PWM信号控制</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.设置PB7为TIM17_CH1N</span>
<span class="token comment">//2.开启RCC</span>
<span class="token comment">//3.设置为HSE选择晶体陶瓷谐振器</span>
<span class="token comment">//4.调节AHB总线时钟主频为64MHZ</span>
<span class="token comment">//5.计时设置通道TIM17_CH1N</span>
<span class="token comment">//6.计时设置，预分频值为（64-1），计数模式（up），计数周期（1000）</span>
<span class="token comment">//7.PWM产生通道设置，pluse为500</span>

<span class="token function">HAL_TIMEx_PWMN_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>htim17<span class="token punctuation">,</span>TIM_CHANNEL_1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启计时器</span>
</code></pre> 
<h6><a id="31_598"></a>31.单通道单次转换：采集光照传感器的值</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.开启PA4的ADC输入通道</span>
<span class="token comment">//2.配置串口，设置为异步通信模式</span>
<span class="token comment">//3.设置串口的比特率（115200），字长（8），校验位（无），停止位（1）</span>
<span class="token class-name">uint32_t</span> value<span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">HAL_ADC_Start</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hadc1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//开启ADC转换</span>
    <span class="token function">HAL_ADC_PollForConversion</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hadc<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//等待转换结果</span>
    value<span class="token operator">=</span><span class="token function">HAL_ADC_GetValue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hadc1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//获取转换结果</span>
    <span class="token function">HAL_ADC_Stop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hadc1<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//停止转换</span>
    <span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="32ADC_Settings_615"></a>32.多通道单次转换（在ADC_Settings中开启扫描模式）</h6> 
<pre><code class="prism language-C">//1.配置ADC1_IN1和ADC1_IN4
//2.因为是多通道得再ADC_Settings开启扫描模式
//3.sequencer set to not fully configurable
//4.forward
uint32_t value1;
uint32_t value2;
while(1)
{
    HAL_ADC_Start(&amp;hadc1);//开启ADC转换
 	while(!(ADC1-&gt;ISR&amp;(1&lt;&lt;2)));//当EOC为1
    value1=HAL_ADC_GetValue(&amp;hadc1);//获取转换结果
    while(!(ADC1-&gt;ISR&amp;(1&lt;&lt;3)));//当EOS为1
    value2=HAL_ADC_GetValue(&amp;hadc1);//获取转换结果
    HAL_ADC_Stop(&amp;hadc1);//停止转换
    HAL_Delay(1000);
}
</code></pre> 
<h6><a id="33DMA_ADC_636"></a>33.DMA_ADC单通道采集试验</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.使能串口</span>
<span class="token comment">//2.PA4配置为ADC1_IN4</span>
<span class="token comment">//3.添加DMA搬运通道</span>
<span class="token comment">//4.使能DMA1通道中断</span>
<span class="token comment">//5.代码编写</span>
<span class="token class-name">uint16_t</span> buf<span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
<span class="token function">HAL_ADC_Start_DMA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hadc1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>buf<span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">HAL_Delay</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="34DMA_ADC_652"></a>34.DMA_ADC多通道采集试验</h6> 
<pre><code class="prism language-c"><span class="token comment">//1.使能串口</span>
<span class="token comment">//2.PA1引脚配置为ADC1_IN1,PA4引脚配置为ADC1_IN4</span>
<span class="token comment">//3.PA8配置为中断</span>
<span class="token comment">//4.ADC多通道采集得打开扫描模式</span>
<span class="token comment">//5.使能PA8中断</span>
<span class="token comment">//6.代码编写</span>

<span class="token class-name">uint16_t</span> buf<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//重写按键上升沿中断</span>
<span class="token keyword">void</span> <span class="token function">HAL_GPIO_EXTI_Rising_Callback</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> GPIO_Pin<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>GPIO_Pin <span class="token operator">==</span> GPIO_PIN_8<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">HAL_ADC_Start_DMA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hadc1<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span><span class="token operator">*</span><span class="token punctuation">)</span>buf<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//重写接收数据中断</span>
<span class="token keyword">void</span> <span class="token function">HAL_ADC_ConvCpltCallback</span><span class="token punctuation">(</span>ADC_HandleTypeDef <span class="token operator">*</span>hadc<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">if</span><span class="token punctuation">(</span>hadc <span class="token operator">==</span> <span class="token operator">&amp;</span>hadc1<span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token function">HAL_ADC_Stop_DMA</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>hadc1<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"key =%d light=%d"</span><span class="token punctuation">,</span>buf<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>buf<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">memset</span><span class="token punctuation">(</span>buf<span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>buf<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//重写printf</span>
<span class="token keyword">int</span> <span class="token function">fputc</span><span class="token punctuation">(</span><span class="token keyword">int</span> ch<span class="token punctuation">,</span>FILE <span class="token operator">*</span>S<span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>USART1<span class="token operator">-&gt;</span>ISR<span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token operator">&lt;&lt;</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	USART1<span class="token operator">-&gt;</span>TDR<span class="token operator">=</span>ch<span class="token punctuation">;</span>
	<span class="token keyword">return</span> ch<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b64eff9b87ae152357506816ef54d75a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">设计模式之不一样的责任链模式</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/b516be95861cd344f3065c3e06615256/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">DMA基本介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>