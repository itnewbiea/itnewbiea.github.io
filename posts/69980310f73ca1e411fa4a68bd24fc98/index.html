<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>数据结构：树基础 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="数据结构：树基础" />
<meta property="og:description" content="目录 第一章 树1.1、树的定义1.2、树的术语 第二章 二叉树2.1、二叉树的定义2.2、二叉树的术语2.3、二叉树的性质 第三章 二叉查找树3.1、BST的定义3.2、BST的结构3.3、BST的添加3.4、BST的获取3.4.1、获取指定值3.4.2、获取最小键3.4.3、获取最大键3.4.4、获取树深度 3.5、BST的删除3.5.1、删除最小结点3.5.2、删除最大结点3.5.3、删除指定结点 3.6、BST的遍历3.6.1、前序遍历3.6.2、中序遍历3.6.3、后序遍历3.6.4、层序遍历 3.7、BST的问题 第四章 红黑树4.1、2-3-4树的定义4.2、2-3-4树的插入4.3、2-3-4树转RBT4.4、RBT的定义4.5、RBT的性质4.6、RBT的结构4.7、RBT的操作4.7.1、左旋操作4.7.2、右旋操作4.7.3、变色操作 4.8、RBT的添加4.8.1、添加操作4.8.2、如何修正4.8.3、修正操作4.8.4、添加测试 4.9、RBT的获取4.9.1、获取指定结点4.9.2、获取最小结点4.9.3、获取最大结点4.9.4、获取前驱结点4.9.5、获取后继结点 4.10、RBT的删除4.10.1、删除操作4.10.2、如何修正4.10.3、修正操作4.10.4、删除测试 第五章 AVL树5.1、AVL树的定义5.2、AVL树的性质5.3、AVL树的结构5.4、AVL树的操作5.4.1、左旋操作（RR）5.4.2、右旋操作（LL）5.4.3、左右双旋（LR）5.4.4、右左双旋（RL） 5.5、AVL树的添加5.5.1、添加操作5.5.2、如何修正5.5.3、修正操作5.5.4、添加测试 5.6、AVL树的获取5.6.1、获取指定结点5.6.2、获取最小结点5.6.3、获取最大结点5.6.4、获取前驱结点5.6.5、获取后继结点 5.7、AVL树的删除5.7.1、删除操作5.7.2、如何删除5.7.3、修正操作5.7.4、删除测试 项目地址：https://gitee.com/caochenlei/data-structures
第一章 树 1.1、树的定义 树（Tree）是一种数据结构，他是由n(n&gt;=1)个有限结点组成一个具有层次关系的集合。
把他叫做“树”是因为他看起来像一棵倒挂的树，也就是说他是根朝上，而叶朝下的。
他具有以下的特点：
每个结点有零个或多个子结点；没有父结点的结点称为根结点；每一个非根结点有且只有一个父结点；除了根结点外，每个子结点可以分为多个不相交的子树。 1.2、树的术语 度数（Degree）： 每个结点所拥有子树的个数。结点B的度数为2，结点C的度数为1，结点D的度数为3，结点K、L、F、G、M、I、J等的度数为0。
层数（Level）： 树的层数。假设树根A为第一层，结点B、C、D等所在层数为第二层，然后依次向下累加。
高度（Height）： 树的最大层数。 上图树的高度为4。
终端结点（Terminal Nodes）： 度数为零的结点就是树叶（叶子结点）也叫做终端结点。结点K、L、F、G、M、I、J等都是终端结点。
非终端结点（Nonterminal Nodes）： 终端结点以外的所有结点都是非终端结点。结点A、B、C、D、E、H等都是非终端结点。
祖先结点（Ancestor Nodes）： 祖先结点是指从树根到该结点路径上所包含的结点。结点B就是结点K的祖先结点之一。
子孙结点（Descendent Nodes）： 子孙结点是指该结点往下追溯子树中的任意一个结点。结点K、L就是结点B的子孙结点。
父亲结点（Parent Nodes）： 每个结点所指向的上一层结点就是父结点。结点B的父结点就是A结点。
儿子结点（Children Nodes）： 每个结点所指向的下一层结点就是子结点。结点B、C、D都是结点A的子结点。
兄弟结点（Siblings Nodes）： 有共同父结点的结点为兄弟结点。结点B、C、D的父结点都是A结点，因此，他们三个结点就是兄弟结点。
叔叔结点（Uncle Nodes）： 父亲结点的兄弟结点就是叔叔结点。结点K的叔叔结点就是结点F。
同代结点（Generation Nodes）： 在同一棵树中具有相同层数的结点。结点E、F的层数相同，因此，他们两个结点就是同代结点。
森林（Forest）： 0个或多个不相交的树组成。对森林加上一个根，森林即成为树。删去根，树即成为森林。
第二章 二叉树 2.1、二叉树的定义 二叉树（Binary Tree）就是度不超过2的树，也就是每个结点最多有两个子结点。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/69980310f73ca1e411fa4a68bd24fc98/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-03-22T15:01:55+08:00" />
<meta property="article:modified_time" content="2021-03-22T15:01:55+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">数据结构：树基础</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#__6" rel="nofollow">第一章 树</a></li><li><ul><li><a href="#11_8" rel="nofollow">1.1、树的定义</a></li><li><a href="#12_23" rel="nofollow">1.2、树的术语</a></li></ul> 
  </li><li><a href="#__53" rel="nofollow">第二章 二叉树</a></li><li><ul><li><a href="#21_55" rel="nofollow">2.1、二叉树的定义</a></li><li><a href="#22_61" rel="nofollow">2.2、二叉树的术语</a></li><li><a href="#23_71" rel="nofollow">2.3、二叉树的性质</a></li></ul> 
  </li><li><a href="#__82" rel="nofollow">第三章 二叉查找树</a></li><li><ul><li><a href="#31BST_84" rel="nofollow">3.1、BST的定义</a></li><li><a href="#32BST_105" rel="nofollow">3.2、BST的结构</a></li><li><a href="#33BST_143" rel="nofollow">3.3、BST的添加</a></li><li><a href="#34BST_179" rel="nofollow">3.4、BST的获取</a></li><li><ul><li><a href="#341_181" rel="nofollow">3.4.1、获取指定值</a></li><li><a href="#342_215" rel="nofollow">3.4.2、获取最小键</a></li><li><a href="#343_234" rel="nofollow">3.4.3、获取最大键</a></li><li><a href="#344_253" rel="nofollow">3.4.4、获取树深度</a></li></ul> 
   </li><li><a href="#35BST_291" rel="nofollow">3.5、BST的删除</a></li><li><ul><li><a href="#351_293" rel="nofollow">3.5.1、删除最小结点</a></li><li><a href="#352_314" rel="nofollow">3.5.2、删除最大结点</a></li><li><a href="#353_335" rel="nofollow">3.5.3、删除指定结点</a></li></ul> 
   </li><li><a href="#36BST_392" rel="nofollow">3.6、BST的遍历</a></li><li><ul><li><a href="#361_394" rel="nofollow">3.6.1、前序遍历</a></li><li><a href="#362_432" rel="nofollow">3.6.2、中序遍历</a></li><li><a href="#363_471" rel="nofollow">3.6.3、后序遍历</a></li><li><a href="#364_510" rel="nofollow">3.6.4、层序遍历</a></li></ul> 
   </li><li><a href="#37BST_543" rel="nofollow">3.7、BST的问题</a></li></ul> 
  </li><li><a href="#__551" rel="nofollow">第四章 红黑树</a></li><li><ul><li><a href="#41234_553" rel="nofollow">4.1、2-3-4树的定义</a></li><li><a href="#42234_570" rel="nofollow">4.2、2-3-4树的插入</a></li><li><a href="#43234RBT_660" rel="nofollow">4.3、2-3-4树转RBT</a></li><li><a href="#44RBT_678" rel="nofollow">4.4、RBT的定义</a></li><li><a href="#45RBT_700" rel="nofollow">4.5、RBT的性质</a></li><li><a href="#46RBT_710" rel="nofollow">4.6、RBT的结构</a></li><li><a href="#47RBT_785" rel="nofollow">4.7、RBT的操作</a></li><li><ul><li><a href="#471_787" rel="nofollow">4.7.1、左旋操作</a></li><li><a href="#472_825" rel="nofollow">4.7.2、右旋操作</a></li><li><a href="#473_863" rel="nofollow">4.7.3、变色操作</a></li></ul> 
   </li><li><a href="#48RBT_868" rel="nofollow">4.8、RBT的添加</a></li><li><ul><li><a href="#481_870" rel="nofollow">4.8.1、添加操作</a></li><li><a href="#482_912" rel="nofollow">4.8.2、如何修正</a></li><li><a href="#483_1020" rel="nofollow">4.8.3、修正操作</a></li><li><a href="#484_1069" rel="nofollow">4.8.4、添加测试</a></li></ul> 
   </li><li><a href="#49RBT_1129" rel="nofollow">4.9、RBT的获取</a></li><li><ul><li><a href="#491_1131" rel="nofollow">4.9.1、获取指定结点</a></li><li><a href="#492_1150" rel="nofollow">4.9.2、获取最小结点</a></li><li><a href="#493_1163" rel="nofollow">4.9.3、获取最大结点</a></li><li><a href="#494_1176" rel="nofollow">4.9.4、获取前驱结点</a></li><li><a href="#495_1210" rel="nofollow">4.9.5、获取后继结点</a></li></ul> 
   </li><li><a href="#410RBT_1244" rel="nofollow">4.10、RBT的删除</a></li><li><ul><li><a href="#4101_1246" rel="nofollow">4.10.1、删除操作</a></li><li><a href="#4102_1339" rel="nofollow">4.10.2、如何修正</a></li><li><a href="#4103_1540" rel="nofollow">4.10.3、修正操作</a></li><li><a href="#4104_1626" rel="nofollow">4.10.4、删除测试</a></li></ul> 
  </li></ul> 
  </li><li><a href="#_AVL_1662" rel="nofollow">第五章 AVL树</a></li><li><ul><li><a href="#51AVL_1664" rel="nofollow">5.1、AVL树的定义</a></li><li><a href="#52AVL_1672" rel="nofollow">5.2、AVL树的性质</a></li><li><a href="#53AVL_1679" rel="nofollow">5.3、AVL树的结构</a></li><li><a href="#54AVL_1762" rel="nofollow">5.4、AVL树的操作</a></li><li><ul><li><a href="#541RR_1764" rel="nofollow">5.4.1、左旋操作（RR）</a></li><li><a href="#542LL_1815" rel="nofollow">5.4.2、右旋操作（LL）</a></li><li><a href="#543LR_1866" rel="nofollow">5.4.3、左右双旋（LR）</a></li><li><a href="#544RL_1880" rel="nofollow">5.4.4、右左双旋（RL）</a></li></ul> 
   </li><li><a href="#55AVL_1894" rel="nofollow">5.5、AVL树的添加</a></li><li><ul><li><a href="#551_1896" rel="nofollow">5.5.1、添加操作</a></li><li><a href="#552_1936" rel="nofollow">5.5.2、如何修正</a></li><li><a href="#553_1940" rel="nofollow">5.5.3、修正操作</a></li><li><a href="#554_1985" rel="nofollow">5.5.4、添加测试</a></li></ul> 
   </li><li><a href="#56AVL_2045" rel="nofollow">5.6、AVL树的获取</a></li><li><ul><li><a href="#561_2047" rel="nofollow">5.6.1、获取指定结点</a></li><li><a href="#562_2066" rel="nofollow">5.6.2、获取最小结点</a></li><li><a href="#563_2079" rel="nofollow">5.6.3、获取最大结点</a></li><li><a href="#564_2092" rel="nofollow">5.6.4、获取前驱结点</a></li><li><a href="#565_2126" rel="nofollow">5.6.5、获取后继结点</a></li></ul> 
   </li><li><a href="#57AVL_2160" rel="nofollow">5.7、AVL树的删除</a></li><li><ul><li><a href="#571_2162" rel="nofollow">5.7.1、删除操作</a></li><li><a href="#572_2227" rel="nofollow">5.7.2、如何删除</a></li><li><a href="#573_2231" rel="nofollow">5.7.3、修正操作</a></li><li><a href="#574_2248" rel="nofollow">5.7.4、删除测试</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<hr> 
<blockquote> 
 <p>项目地址：https://gitee.com/caochenlei/data-structures</p> 
</blockquote> 
<h2><a id="__6"></a>第一章 树</h2> 
<h3><a id="11_8"></a>1.1、树的定义</h3> 
<p>树（Tree）是一种数据结构，他是由n(n&gt;=1)个有限结点组成一个具有层次关系的集合。</p> 
<p>把他叫做“树”是因为他看起来像一棵倒挂的树，也就是说他是根朝上，而叶朝下的。</p> 
<p><img src="https://images2.imgbox.com/ee/d1/bN33xt64_o.png" alt=""></p> 
<p>他具有以下的特点：</p> 
<ul><li>每个结点有零个或多个子结点；</li><li>没有父结点的结点称为根结点；</li><li>每一个非根结点有且只有一个父结点；</li><li>除了根结点外，每个子结点可以分为多个不相交的子树。</li></ul> 
<h3><a id="12_23"></a>1.2、树的术语</h3> 
<p><img src="https://images2.imgbox.com/36/94/DHcYX7lf_o.png" alt=""></p> 
<p><strong>度数（Degree）：</strong> 每个结点所拥有子树的个数。结点B的度数为2，结点C的度数为1，结点D的度数为3，结点K、L、F、G、M、I、J等的度数为0。</p> 
<p><strong>层数（Level）：</strong> 树的层数。假设树根A为第一层，结点B、C、D等所在层数为第二层，然后依次向下累加。</p> 
<p><strong>高度（Height）：</strong> 树的最大层数。 上图树的高度为4。</p> 
<p><strong>终端结点（Terminal Nodes）：</strong> 度数为零的结点就是树叶（叶子结点）也叫做终端结点。结点K、L、F、G、M、I、J等都是终端结点。</p> 
<p><strong>非终端结点（Nonterminal Nodes）：</strong> 终端结点以外的所有结点都是非终端结点。结点A、B、C、D、E、H等都是非终端结点。</p> 
<p><strong>祖先结点（Ancestor Nodes）：</strong> 祖先结点是指从树根到该结点路径上所包含的结点。结点B就是结点K的祖先结点之一。</p> 
<p><strong>子孙结点（Descendent Nodes）：</strong> 子孙结点是指该结点往下追溯子树中的任意一个结点。结点K、L就是结点B的子孙结点。</p> 
<p><strong>父亲结点（Parent Nodes）：</strong> 每个结点所指向的上一层结点就是父结点。结点B的父结点就是A结点。</p> 
<p><strong>儿子结点（Children Nodes）：</strong> 每个结点所指向的下一层结点就是子结点。结点B、C、D都是结点A的子结点。</p> 
<p><strong>兄弟结点（Siblings Nodes）：</strong> 有共同父结点的结点为兄弟结点。结点B、C、D的父结点都是A结点，因此，他们三个结点就是兄弟结点。</p> 
<p><strong>叔叔结点（Uncle Nodes）：</strong> 父亲结点的兄弟结点就是叔叔结点。结点K的叔叔结点就是结点F。</p> 
<p><strong>同代结点（Generation Nodes）：</strong> 在同一棵树中具有相同层数的结点。结点E、F的层数相同，因此，他们两个结点就是同代结点。</p> 
<p><strong>森林（Forest）：</strong> 0个或多个不相交的树组成。对森林加上一个根，森林即成为树。删去根，树即成为森林。</p> 
<h2><a id="__53"></a>第二章 二叉树</h2> 
<h3><a id="21_55"></a>2.1、二叉树的定义</h3> 
<p>二叉树（Binary Tree）就是度不超过2的树，也就是每个结点最多有两个子结点。</p> 
<p><img src="https://images2.imgbox.com/5b/ce/GpjU7iPp_o.png" alt=""></p> 
<h3><a id="22_61"></a>2.2、二叉树的术语</h3> 
<p><strong>满二叉树（Full Binary Tree）：</strong> 除最后一层无任何子结点外，其余每一层上的所有结点都有两个子结点的二叉树，就是满二叉树，满二叉树外观上是一个三角形。深度为h的满二叉树必有2<sup>h</sup>-1个结点，第i层上有2<sup>i-1</sup>结点，具有n个结点的满二叉树的深度为 log<sub>2</sub><sup>(n+1)</sup>。</p> 
<p><img src="https://images2.imgbox.com/89/e6/DOovjCMW_o.png" alt=""></p> 
<p><strong>完全二叉树（Complete Binary Tree）：</strong> 如果该二叉树的所有叶子结点都在最后一层或者倒数第二层，而且最后一层的叶子结点在左边连续，倒数第二层的叶子结点在右边连续，我们称为完全二叉树。一棵满二叉树必定是一棵完全二叉树，而完全二叉树未必是满二叉树。</p> 
<p><img src="https://images2.imgbox.com/61/b6/NWei8Vxk_o.png" alt=""></p> 
<h3><a id="23_71"></a>2.3、二叉树的性质</h3> 
<ul><li>在任意一棵二叉树中，深度为h的二叉树中至多含有2<sup>h</sup>-1个结点，其中h≥1。</li><li>在任意一棵二叉树中，第i层上至多有2<sup>i-1</sup>个结点，其中i≥1。</li><li>在任意一棵二叉树中，有n<sub>0</sub>个叶子结点，有n<sub>2</sub>个度为2的结点，则必有n<sub>0</sub>=n<sub>2</sub>+1。</li><li>在任意一棵二叉树中，包含n个结点的二叉树的高度至少为log<sub>2</sub><sup>(n+1)</sup>。</li><li>若采用连续储存（数组）的方式存放二叉树，则结点与下标之间的关系： 
  <ul><li>若某个结点的下标为 i ，则这个结点的父结点的下标为 i / 2。</li><li>若某个结点的下标为 i ，且结点的度为2，则这个结点的左子结点的下标为 2 * i + 1。</li><li>若某个结点的下标为 i ，且结点的度为2，则这个结点的右子结点的下标为 2 * i + 2。</li></ul> </li></ul> 
<h2><a id="__82"></a>第三章 二叉查找树</h2> 
<h3><a id="31BST_84"></a>3.1、BST的定义</h3> 
<p>二叉查找树（Binary Search Tree）又称二叉搜索树，还称二叉排序树（Binary Sort Tree），简称BST。</p> 
<p><img src="https://images2.imgbox.com/1c/38/eXtpIHTN_o.png" alt=""></p> 
<p>二叉查找树所特有的术语：</p> 
<ul><li><strong>前驱结点：</strong> 小于当前结点的最大值，例如上图的结点5的前驱结点就是结点4。</li><li><strong>后继结点：</strong> 大于当前结点的最小值，例如上图的结点5的后继结点就是结点6。</li></ul> 
<p>二叉查找树具有以下性质：</p> 
<p>（1）若左子树不空，则左子树上所有结点的值均小于或等于他的根结点的值；</p> 
<p>（2）若右子树不空，则右子树上所有结点的值均大于他的根结点的值；</p> 
<p>（3）左、右子树也分别为二叉排序树；</p> 
<p>二叉查找树在线演示网站：https://www.cs.usfca.edu/~galles/visualization/BST.html</p> 
<h3><a id="32BST_105"></a>3.2、BST的结构</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">BinarySearchTree</span><span class="token operator">&lt;</span>Key <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token generics function"><span class="token punctuation">&lt;</span>Key<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> Value<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">private</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{<!-- --></span>    <span class="token comment">//结点类</span>
        <span class="token keyword">public</span> Key key<span class="token punctuation">;</span>     <span class="token comment">//存储键</span>
        <span class="token keyword">public</span> Value value<span class="token punctuation">;</span> <span class="token comment">//存储值</span>
        <span class="token keyword">public</span> Node left<span class="token punctuation">;</span>   <span class="token comment">//指向左子结点</span>
        <span class="token keyword">public</span> Node right<span class="token punctuation">;</span>  <span class="token comment">//指向右子结点</span>

        <span class="token keyword">public</span> <span class="token function">Node</span><span class="token punctuation">(</span>Key key<span class="token punctuation">,</span> Value value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">"Node{"</span> <span class="token operator">+</span> <span class="token string">"key="</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">", value="</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">"}"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> Node root<span class="token punctuation">;</span>      <span class="token comment">//根结点</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> N<span class="token punctuation">;</span>          <span class="token comment">//结点数</span>

    <span class="token comment">//获取当前树的结点数</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> N<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//判断当前树是否为空</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> N <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//以下方法请写在这里</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="33BST_143"></a>3.3、BST的添加</h3> 
<ul><li>如果当前树中没有任何一个结点，则直接把新结点当做根结点使用。</li><li>如果当前树不为空，则从根结点开始： 
  <ul><li>如果新结点的key小于当前结点的key，则继续找当前结点的左子结点；</li><li>如果新结点的key大于当前结点的key，则继续找当前结点的右子结点；</li><li>如果新结点的key等于当前结点的key，则树中已经存在这样的结点，替换该结点的value值即可。</li></ul> </li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//向当前树中添加结点</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span>Key key<span class="token punctuation">,</span> Value value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    root <span class="token operator">=</span> <span class="token function">put</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//向指定树中添加结点</span>
<span class="token keyword">private</span> Node <span class="token function">put</span><span class="token punctuation">(</span>Node x<span class="token punctuation">,</span> Key key<span class="token punctuation">,</span> Value value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果x子树为空，直接返回新结点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        N<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//如果x子树不空，根据情况来插入</span>
    <span class="token keyword">int</span> cmp <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        x<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">put</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        x<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">put</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        x<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="34BST_179"></a>3.4、BST的获取</h3> 
<h4><a id="341_181"></a>3.4.1、获取指定值</h4> 
<ul><li>如果当前树中没有任何一个结点，则直接返回null。</li><li>如果当前树不为空，则从根结点开始： 
  <ul><li>如果要查询的key小于当前结点的key，则继续找当前结点的左子结点；</li><li>如果要查询的key大于当前结点的key，则继续找当前结点的右子结点；</li><li>如果要查询的key等于当前结点的key，则树中返回当前结点的value。</li></ul> </li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//在当前树中根据Key获取Value</span>
<span class="token keyword">public</span> Value <span class="token function">get</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//在指定树中根据Key获取Value</span>
<span class="token keyword">private</span> Value <span class="token function">get</span><span class="token punctuation">(</span>Node x<span class="token punctuation">,</span> Key key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果x子树为空，直接返回null</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//如果x子树不空，根据情况返回</span>
    <span class="token keyword">int</span> cmp <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token function">get</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> x<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="342_215"></a>3.4.2、获取最小键</h4> 
<p>从根结点开始，递归向左不停查找，直到最后一个结点的左结点指向null结束。</p> 
<pre><code class="prism language-java"><span class="token comment">//在当前树中获取最小的Key</span>
<span class="token keyword">public</span> Key <span class="token function">min</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//在指定树中获取最小的结点</span>
<span class="token keyword">private</span> Node <span class="token function">min</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">min</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="343_234"></a>3.4.3、获取最大键</h4> 
<p>从根结点开始，递归向右不停查找，直到最后一个结点的右结点指向null结束。</p> 
<pre><code class="prism language-java"><span class="token comment">//在当前树中获取最大的Key</span>
<span class="token keyword">public</span> Key <span class="token function">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">max</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//在指定树中获取最大的结点</span>
<span class="token keyword">private</span> Node <span class="token function">max</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> x<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">max</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="344_253"></a>3.4.4、获取树深度</h4> 
<ul><li>如果根结点为空，则最大深度为0。</li><li>如果根结点不空，计算左子树的最大深度，计算右子树的最大深度，当前树的最大深度=左子树的最大深度和右子树的最大深度中的较大者+1。</li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//获取当前树最大深度</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">maxDepth</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> <span class="token function">maxDepth</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//获取指定树最大深度</span>
<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">maxDepth</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// x结点的最大深度</span>
    <span class="token keyword">int</span> max <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//左子树的最大深度</span>
    <span class="token keyword">int</span> maxL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//右子树的最大深度</span>
    <span class="token keyword">int</span> maxR <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//计算x结点左子树的最大深度</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        maxL <span class="token operator">=</span> <span class="token function">maxDepth</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//计算x结点右子树的最大深度</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        maxR <span class="token operator">=</span> <span class="token function">maxDepth</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//比较左子树和右子树最大深度</span>
    max <span class="token operator">=</span> maxL <span class="token operator">&gt;</span> maxR <span class="token operator">?</span> maxL <span class="token operator">+</span> <span class="token number">1</span> <span class="token operator">:</span> maxR <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> max<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="35BST_291"></a>3.5、BST的删除</h3> 
<h4><a id="351_293"></a>3.5.1、删除最小结点</h4> 
<p><img src="https://images2.imgbox.com/7d/a2/uHlvy23Z_o.png" alt=""></p> 
<pre><code class="prism language-java"><span class="token comment">//删除当前树中最小的结点</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteMin</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    root <span class="token operator">=</span> <span class="token function">deleteMin</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//删除指定树中最小的结点</span>
<span class="token keyword">private</span> Node <span class="token function">deleteMin</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        N<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> x<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    x<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">deleteMin</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="352_314"></a>3.5.2、删除最大结点</h4> 
<p><img src="https://images2.imgbox.com/b8/99/95WBFJwH_o.png" alt=""></p> 
<pre><code class="prism language-java"><span class="token comment">//删除当前树中最大的结点</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">deleteMax</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    root <span class="token operator">=</span> <span class="token function">deleteMax</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//删除指定树中最大的结点</span>
<span class="token keyword">private</span> Node <span class="token function">deleteMax</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        N<span class="token operator">--</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> x<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    x<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">deleteMin</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="353_335"></a>3.5.3、删除指定结点</h4> 
<ul><li>如果当前树中没有任何一个结点，则不进行任何处理。</li><li>如果当前树并不为空，我们要是想要删除指定结点，首先需要递归找到这个结点，然后对删除的结点分为两种情况探讨： 
  <ul><li>删除的结点的度为0或者1： 
    <ul><li>判断该结点的左结点指向是否为空，如果为空，让其父结点指向该结点的右结点，核心代码：<code>if (x.left == null) { N--; return x.right; }</code></li><li>判断该结点的右结点指向是否为空，如果为空，让其父结点指向该结点的左结点，核心代码：<code>if (x.right == null) { N--; return x.left; }</code></li></ul> </li><li>删除的结点的度为2： 
    <ul><li>将要删除的结点先缓存起来，以备用。</li><li>获取该结点右子树中最小的一个结点。</li><li>删除该结点右子树中最小的一个结点。</li><li>让最小结点的left指向缓存结点的左子树。</li><li>让最小结点的right指向缓存结点的右子树。</li></ul> </li></ul> </li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//删除当前树中指定Key对应的结点</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">delete</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    root <span class="token operator">=</span> <span class="token function">delete</span><span class="token punctuation">(</span>root<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//删除指定树中指定Key对应的结点</span>
<span class="token keyword">private</span> Node <span class="token function">delete</span><span class="token punctuation">(</span>Node x<span class="token punctuation">,</span> Key key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//如果x子树为空，直接返回null</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//如果x子树不空，根据情况删除</span>
    <span class="token keyword">int</span> cmp <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        x<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token function">delete</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        x<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">delete</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">,</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//删除左叶子结点或有一个孩子的情况</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            N<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> x<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//删除右叶子结点或有一个孩子的情况</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            N<span class="token operator">--</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> x<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//删除非叶子结点</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            Node t <span class="token operator">=</span> x<span class="token punctuation">;</span>
            x <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
            x<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">deleteMin</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
            x<span class="token punctuation">.</span>left <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> x<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="36BST_392"></a>3.6、BST的遍历</h3> 
<h4><a id="361_394"></a>3.6.1、前序遍历</h4> 
<p><img src="https://images2.imgbox.com/9e/c0/mzV4FT1B_o.png" alt=""></p> 
<p><strong>核心：</strong> 先访问根结点，再访问左子树，最后访问右子树。</p> 
<ul><li>从根结点开始，首先访问根结点，再访问左子树，最后访问右子树，访问顺序：<code>EBG</code></li><li>从B 结点开始，首先访问B 结点，再访问左子树，最后访问右子树，访问顺序：<code>E BAD G</code></li><li>从G 结点开始，首先访问G 结点，再访问左子树，最后访问右子树，访问顺序：<code>E BAD GFH</code></li><li>从D 结点开始，首先访问D 结点，再访问左子树，最后访问右子树，访问顺序：<code>E BADC GFH</code></li><li>最终访问次序为：<code>E, B, A, D, C, G, F, H</code></li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//前序遍历当前树</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">preErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">preErgodic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//前序遍历指定树</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">preErgodic</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//输出根结点</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历左子树</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">preErgodic</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//遍历右子树</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">preErgodic</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="362_432"></a>3.6.2、中序遍历</h4> 
<p><img src="https://images2.imgbox.com/a0/f6/ESQ1CX6h_o.png" alt=""></p> 
<p><strong>核心：</strong> 先访问左子树，再访问根结点，最后访问右子树。</p> 
<ul><li> <p>从根结点开始，首先访问左子树，再访问根结点，最后访问右子树，访问顺序：<code>BEG</code></p> </li><li> <p>从B 结点开始，首先访问左子树，再访问B 结点，最后访问右子树，访问顺序：<code>ABD E G</code></p> </li><li> <p>从G 结点开始，首先访问左子树，再访问G 结点，最后访问右子树，访问顺序：<code>ABD E FGH</code></p> </li><li> <p>从D 结点开始，首先访问左子树，再访问D 结点，不用输出右子树，访问顺序：<code>ABCD E FGH</code></p> </li><li> <p>最终访问次序为：<code>A, B, C, D, E, F, G, H</code></p> </li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//中序遍历当前树</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">midErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">midErgodic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//中序遍历指定树</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">midErgodic</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//遍历左子树</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">midErgodic</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//输出根结点</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//遍历右子树</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">midErgodic</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="363_471"></a>3.6.3、后序遍历</h4> 
<p><img src="https://images2.imgbox.com/cd/75/8Brla58D_o.png" alt=""></p> 
<p><strong>核心：</strong> 先访问左子树，再访问右子树，最后访问根结点。</p> 
<ul><li> <p>从根结点开始，首先先访问左子树，再访问右子树，最后访问根结点，访问顺序：<code>BGE</code></p> </li><li> <p>从B 结点开始，首先先访问左子树，再访问右子树，最后访问B 结点，访问顺序：<code>ADB G E</code></p> </li><li> <p>从G 结点开始，首先先访问左子树，再访问右子树，最后访问G 结点，访问顺序：<code>ADB FHG E</code></p> </li><li> <p>从D 结点开始，首先先访问左子树，再访问右子树，最后访问D 结点，访问顺序：<code>ACDB FHG E</code></p> </li><li> <p>最终访问次序为：<code>A, C, D, B, F, H, G, E</code></p> </li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//后序遍历当前树</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">postErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">postErgodic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//后序遍历指定树</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">postErgodic</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//遍历左子树</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">postErgodic</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//遍历右子树</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token function">postErgodic</span><span class="token punctuation">(</span>x<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//输出根结点</span>
    System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="364_510"></a>3.6.4、层序遍历</h4> 
<p><img src="https://images2.imgbox.com/30/f4/5NPU97Pk_o.png" alt=""></p> 
<pre><code class="prism language-java"><span class="token comment">//层序遍历当前树</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">layerErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">layerErgodic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//层序遍历指定树</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">layerErgodic</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//创建一个队列</span>
    Queue<span class="token generics function"><span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span> nodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//加入指定结点</span>
    nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//循环弹出遍历</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>nodes<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//从队列中弹出一个结点，输出当前结点的信息</span>
        Node n <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断当前结点还有没有左子结点，如果有，则放入到nodes中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断当前结点还有没有右子结点，如果有，则放入到nodes中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="37BST_543"></a>3.7、BST的问题</h3> 
<p>BST存在的问题是，树在插入的时候会导致倾斜，不同的插入顺序会导致树的高度不一样，而树的高度直接影响了树的查找效率。最坏的情况所有的结点都在一条斜线上，这样树的高度为N。基于BST存在的问题，自平衡查找二叉树（Balanced BST）产生了。平衡树的插入和删除的时候，会通过旋转操作将高度保持在LogN。</p> 
<p><img src="https://images2.imgbox.com/4a/db/XO7Rra7p_o.png" alt=""></p> 
<p>平衡查找二叉树最具有代表的两种树结构分别是：红黑树和AVL树，这两种树的平衡机制不一样。</p> 
<h2><a id="__551"></a>第四章 红黑树</h2> 
<h3><a id="41234_553"></a>4.1、2-3-4树的定义</h3> 
<p>在学习红黑树（又叫红黑二叉查找树）之前，我们首先需要学习2-3-4树，因为红黑树是由2-3-4树演变过来的，所以，我们不仅要学习所以，还要学习因为。</p> 
<p>2-3-4树是四阶的B树（Balance Tree），他属于一种多路查找树，他的结构有以下限制：</p> 
<ul><li>所有叶子结点都拥有相同的深度。</li><li>结点只能是 2-结点、3-结点、4-结点之一。 
  <ul><li>2-结点：包含 1 个元素的结点，有 2 个子结点；</li><li>3-结点：包含 2 个元素的结点，有 3 个子结点；</li><li>4-结点：包含 3 个元素的结点，有 4 个子结点；</li></ul> </li><li>元素始终保持排序顺序，整体上保持二叉查找树的性质，即父结点大于左子结点，小于右子结点； 而且结点有多个元素时，每个元素必须大于他左边的和他的左子树中元素。</li></ul> 
<p>下图是一个典型的2-3-4树：</p> 
<p><img src="https://images2.imgbox.com/71/94/xj3S4UGc_o.png" alt=""></p> 
<h3><a id="42234_570"></a>4.2、2-3-4树的插入</h3> 
<p>我们要依次插入：<code>2、3、4、5、6、7、8、9、10、11、12、1</code></p> 
<p>我们先插入2，如下图：</p> 
<p><img src="https://images2.imgbox.com/20/30/e1nmjmez_o.png" alt=""></p> 
<p>然后再插入3，这时候就已经有了两个结点，所以直接往2后边按顺序排就行了，如下图：</p> 
<p><img src="https://images2.imgbox.com/c0/4e/rZN21UPf_o.png" alt=""></p> 
<p>然后再插入4，这时候就已经有了三个结点，所以直接往3后边按顺序排就行了，如下图：</p> 
<p><img src="https://images2.imgbox.com/f6/05/wcUfzByV_o.png" alt=""></p> 
<p>然后再插入5，这时候就已经有了四个结点，2-3-4树最多能存储3个键，此时不符合2-3-4树结构，如下图：</p> 
<p><img src="https://images2.imgbox.com/6b/bc/WdtKniFG_o.png" alt=""></p> 
<p>我们需要把最中间的那个结点3往上提，提上来之后，再分别指向左右子树，此时右子树又可以放结点了，如下图：</p> 
<p><img src="https://images2.imgbox.com/16/4f/CQ24TSSQ_o.png" alt=""></p> 
<p>然后再插入6，这时候就已经有了三个结点，所以直接往5后边按顺序排就行了，如下图：</p> 
<p><img src="https://images2.imgbox.com/87/ad/rwTbglDF_o.png" alt=""></p> 
<p>然后再插入7，这时候就已经有了四个结点，2-3-4树最多能存储3个键，此时不符合2-3-4树结构，如下图：</p> 
<p><img src="https://images2.imgbox.com/3b/11/PCNHAxmF_o.png" alt=""></p> 
<p>我们需要把最中间的那个结点5往上提，提上来之后，再分别指向左右子树，此时右子树又可以放结点了，如下图：</p> 
<p><img src="https://images2.imgbox.com/7b/9e/OIbBWObz_o.png" alt=""></p> 
<p>但是我们需要把刚才提出来的5与第一次提出来的3进行合并，合并之后就已经有了3、5这两个元素，可以合并，如下图：</p> 
<p><img src="https://images2.imgbox.com/f6/db/M8GIxtCK_o.png" alt=""></p> 
<p>然后再插入8，这时候就已经有了三个结点，所以直接往7后边按顺序排就行了，如下图：</p> 
<p><img src="https://images2.imgbox.com/41/a8/5s97xtxi_o.png" alt=""></p> 
<p>然后再插入9，这时候就已经有了四个结点，2-3-4树最多能存储3个键，此时不符合2-3-4树结构，如下图：</p> 
<p><img src="https://images2.imgbox.com/b2/ad/zBj8gWV0_o.png" alt=""></p> 
<p>我们需要把最中间的那个结点7往上提，提上来之后，再分别指向左右子树，此时右子树又可以放结点了，如下图：</p> 
<p><img src="https://images2.imgbox.com/8c/00/8CoEvfTc_o.png" alt=""></p> 
<p>但是我们需要把刚才提出来的7与第一次提出来的3和第二次提出来的5进行合并，合并之后就已经有了3、5、7这三个元素，可以合并，如下图：</p> 
<p><img src="https://images2.imgbox.com/76/a7/pwTQMOZ3_o.png" alt=""></p> 
<p>然后再插入10，这时候就已经有了三个结点，所以直接往9后边按顺序排就行了，如下图：</p> 
<p><img src="https://images2.imgbox.com/0f/f4/phjBovkU_o.png" alt=""></p> 
<p>然后再插入11，这时候就已经有了四个结点，2-3-4树最多能存储3个键，此时不符合2-3-4树结构，如下图：</p> 
<p><img src="https://images2.imgbox.com/46/82/GFl9D7VO_o.png" alt=""></p> 
<p>我们需要把最中间的那个结点9往上提，提上来之后，再分别指向左右子树，此时右子树又可以放结点了，如下图：</p> 
<p><img src="https://images2.imgbox.com/00/b8/kx99JAff_o.png" alt=""></p> 
<p>但是我们需要把刚才提出来的9与第一次提出来的3和第二次提出来的5和第三次提出来的7进行合并，合并之后就已经有了3、5、7、9这四个元素，2-3-4树最多能存储3个键，此时不符合2-3-4树结构，不可以合并，如下图：</p> 
<p><img src="https://images2.imgbox.com/03/b9/8MKhMbpB_o.png" alt=""></p> 
<p>我们需要把最中间的那个结点5往上提，提上来之后，再分别指向左右子树，此时右子树又可以放结点了，如下图：</p> 
<p><img src="https://images2.imgbox.com/74/f2/42FV7uza_o.png" alt=""></p> 
<p>然后再插入12，这时候就已经有了三个结点，所以直接往11后边按顺序排就行了，如下图：</p> 
<p><img src="https://images2.imgbox.com/b3/0f/gwjsbLTr_o.png" alt=""></p> 
<p>然后再插入1，这时候就已经有了2个结点，所以直接往2前边按顺序排就行了，如下图：</p> 
<p><img src="https://images2.imgbox.com/bd/4b/xL2zLq5b_o.png" alt=""></p> 
<p>最终我们将得到这棵2-3-4树，如下图：</p> 
<p><img src="https://images2.imgbox.com/8d/d0/h0vviL5M_o.png" alt=""></p> 
<p>在构建2-3-4树的过程中，我们不难发现，这棵树是从底往上生长的，一旦遇到键放不进去，我们就需要将最中间的那个结点往上提，提完以后再看能不能合并，就这样，一步一步，将这个2-3-4树构建完成。2-3-4树的查询操作像普通的二叉查找树一样，非常简单，但由于其结点元素数不确定，在一些编程语言中实现起来并不方便，所以一般使用红黑树来代替。</p> 
<h3><a id="43234RBT_660"></a>4.3、2-3-4树转RBT</h3> 
<p><img src="https://images2.imgbox.com/54/52/VxkWWCF4_o.png" alt=""></p> 
<p>以上是2-3-4树中各种结点与红黑树中各种结点的对比关系图，这样定义完全是为了，将2-3-4树中不确定的结点全部转换为2结点，以此统一树中的结点。</p> 
<p>观察上图会发现，2-3-4树中的3结点对应红黑树中两种不同的结构，由此我们可知道，一棵2-3-4树可以转化为多棵红黑树，而一棵红黑树只能转化一棵2-3-4树。</p> 
<p><img src="https://images2.imgbox.com/46/9b/5a97Gh3s_o.png" alt=""></p> 
<p>将上图2-3-4树转化为红黑树，第一种情况（3结点 -&gt; 左倾）：</p> 
<p><img src="https://images2.imgbox.com/b3/e4/7GcUFYlp_o.png" alt=""></p> 
<p>将上图2-3-4树转化为红黑树，第二种情况（3结点 -&gt; 右倾）：</p> 
<p><img src="https://images2.imgbox.com/c8/ac/VnGFTENe_o.png" alt=""></p> 
<h3><a id="44RBT_678"></a>4.4、RBT的定义</h3> 
<p>红黑树（Red Black Tree） 是一种自平衡二叉查找树，又叫红黑二叉查找树。红黑树是在1972年由Rudolf Bayer发明的，当时被称为平衡二叉B树（Symmetric Binary B-trees）。后来，在1978年被Leo J. Guibas和Robert Sedgewick修改为如今的“红黑树”。</p> 
<p>红黑树是一种AVL树（平衡二叉树）的变体，都是在进行插入和删除操作时通过特定操作保持二叉查找树的平衡，他的左右子树高度差有可能大于1，所以红黑树不是严格意义上的AVL树（平衡二叉树），但对之进行平衡的代价较低，并且其平均统计性能要强于AVL树（平衡二叉树） 。他虽然是复杂的，但他的最坏情况运行时间也是非常良好的，并且在实践中是高效的。他可以在O(logn)时间内做查找，插入和删除，这里的n是树中元素的数目。</p> 
<p>由于每一棵红黑树都是一颗BST树（二叉查找树），除了结点信息、添加和删除操作有些特殊外，其余操作几乎不用修改，可以直接使用。</p> 
<p>下图是一棵红黑树，每个叶子结点所指向的<code>NULL LEAF</code>结点不可以忽略。</p> 
<p><img src="https://images2.imgbox.com/8a/3e/KkTUACSf_o.png" alt=""></p> 
<p>但是直接显示会让我们感觉很乱，所以画图的时候会忽略<code>NULL LEAF</code>结点，但是心中不可忽略。</p> 
<p><img src="https://images2.imgbox.com/53/53/3Ks6vhJR_o.png" alt=""></p> 
<p>看到了上边的这一棵红黑树，好像和咱们之前用2-3-4树转化的不太一样，所以在这里一定要清楚，由于红黑树实现的方式不一样，所造成的结果也有可能不是唯一的，如何判断红黑树是否正确，请根据红黑树的性质进行判断，符合性质的都是正确的。</p> 
<p>在这里再推荐一个红黑树演示的网站：https://www.cs.usfca.edu/~galles/visualization/RedBlack.html</p> 
<p>为了大家方便测试，我们接下来代码实现的效果将会和上述网站演示的效果一样。</p> 
<h3><a id="45RBT_700"></a>4.5、RBT的性质</h3> 
<p>红黑树是一种结点带有颜色属性的二叉查找树，但他在二叉查找树之外，还有以下5大性质：</p> 
<ul><li>根是黑色。</li><li>结点是红色或黑色。</li><li>所有叶子结点都是黑色。（不要忘了还有<code>NULL LEAF</code>结点）</li><li>每个红色结点必须有两个黑色的子结点。（从每个叶子到根的所有路径上不能有两个连续的红色结点）</li><li>从任一结点到其每个叶子的所有简单路径都包含相同数目的黑色结点。（任一结点开始的路径上黑色结点数平衡）</li></ul> 
<h3><a id="46RBT_710"></a>4.6、RBT的结构</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedBlackTree</span><span class="token operator">&lt;</span>Key <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token generics function"><span class="token punctuation">&lt;</span>Key<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> Value<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{<!-- --></span>                         <span class="token comment">//结点类</span>
        <span class="token keyword">public</span> Key key<span class="token punctuation">;</span>                         <span class="token comment">//存储键</span>
        <span class="token keyword">public</span> Value value<span class="token punctuation">;</span>                     <span class="token comment">//存储值</span>
        <span class="token keyword">public</span> Node parent<span class="token punctuation">;</span>                     <span class="token comment">//指向父亲结点</span>
        <span class="token keyword">public</span> Node left<span class="token punctuation">;</span>                       <span class="token comment">//指向左子结点</span>
        <span class="token keyword">public</span> Node right<span class="token punctuation">;</span>                      <span class="token comment">//指向右子结点</span>
        <span class="token keyword">public</span> <span class="token keyword">boolean</span> color<span class="token punctuation">;</span>                   <span class="token comment">//指向结点颜色</span>

        <span class="token keyword">public</span> <span class="token function">Node</span><span class="token punctuation">(</span>Key key<span class="token punctuation">,</span> Value value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">"Node{"</span> <span class="token operator">+</span> <span class="token string">"key="</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">", value="</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">", color="</span> <span class="token operator">+</span> color <span class="token operator">+</span> <span class="token string">"}"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> Node root<span class="token punctuation">;</span>                          <span class="token comment">//根结点</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>                           <span class="token comment">//结点数</span>

    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> RED <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>   <span class="token comment">//红色结点</span>
    <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> BLACK <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>  <span class="token comment">//黑色结点</span>

    <span class="token comment">//获取当前树的根结点</span>
    <span class="token keyword">public</span> Node <span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> root<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前树的结点数</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//判断当前树是否为空</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前结点的父亲结点</span>
    <span class="token keyword">private</span> Node <span class="token function">parentOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> node <span class="token operator">!=</span> null <span class="token operator">?</span> node<span class="token punctuation">.</span>parent <span class="token operator">:</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前结点的左子结点</span>
    <span class="token keyword">private</span> Node <span class="token function">leftOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> node <span class="token operator">!=</span> null <span class="token operator">?</span> node<span class="token punctuation">.</span>left <span class="token operator">:</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前结点的右子结点</span>
    <span class="token keyword">private</span> Node <span class="token function">rightOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> node <span class="token operator">!=</span> null <span class="token operator">?</span> node<span class="token punctuation">.</span>right <span class="token operator">:</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前结点颜色</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">colorOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> node <span class="token operator">!=</span> null <span class="token operator">?</span> node<span class="token punctuation">.</span>color <span class="token operator">:</span> BLACK<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//设置当前结点颜色</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">setColor</span><span class="token punctuation">(</span>Node node<span class="token punctuation">,</span> <span class="token keyword">boolean</span> color<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            node<span class="token punctuation">.</span>color <span class="token operator">=</span> color<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//接下来的方法请写在这里...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="47RBT_785"></a>4.7、RBT的操作</h3> 
<h4><a id="471_787"></a>4.7.1、左旋操作</h4> 
<p><img src="https://images2.imgbox.com/32/69/MICJFOs0_o.png" alt=""></p> 
<p><strong>核心描述：</strong></p> 
<ul><li>获取当前结点h</li><li>获取当前结点h的右子结点x</li><li>让h的右子结点指向x的左子结点</li><li>让x的左子结点指向h结点</li></ul> 
<p><strong>动画演示：</strong></p> 
<p><img src="https://images2.imgbox.com/bd/14/UYu4KIFD_o.gif" alt=""></p> 
<p><strong>代码实现：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">//左旋操作</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateLeft</span><span class="token punctuation">(</span>Node h<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                    <span class="token comment">//判断当前结点h是否为null</span>
        Node x <span class="token operator">=</span> h<span class="token punctuation">.</span>right<span class="token punctuation">;</span>               <span class="token comment">//获取当前结点h的右子结点x</span>
        h<span class="token punctuation">.</span>right <span class="token operator">=</span> x<span class="token punctuation">.</span>left<span class="token punctuation">;</span>               <span class="token comment">//让h的右子结点指向x的左子结点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span>             <span class="token comment">//判断x的左子结点是否为null</span>
            x<span class="token punctuation">.</span>left<span class="token punctuation">.</span>parent <span class="token operator">=</span> h<span class="token punctuation">;</span>          <span class="token comment">//让x的左子结点的父结点指向h</span>
        x<span class="token punctuation">.</span>parent <span class="token operator">=</span> h<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>            <span class="token comment">//让x的父结点指向h的父结点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>parent <span class="token operator">==</span> null<span class="token punctuation">)</span>           <span class="token comment">//判断h的父结点是否为null</span>
            root <span class="token operator">=</span> x<span class="token punctuation">;</span>                   <span class="token comment">//如果是，说明是根结点</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">==</span> h<span class="token punctuation">)</span>    <span class="token comment">//判断当前h子树是否为父结点的左子树</span>
            h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> x<span class="token punctuation">;</span>          <span class="token comment">//如果是，则修正他为新的x子树</span>
        <span class="token keyword">else</span>                            <span class="token comment">//判断当前h子树是否为父结点的右子树</span>
            h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> x<span class="token punctuation">;</span>         <span class="token comment">//如果是，则修正他为新的x子树</span>
        x<span class="token punctuation">.</span>left <span class="token operator">=</span> h<span class="token punctuation">;</span>                     <span class="token comment">//让x的左子结点指向h结点</span>
        h<span class="token punctuation">.</span>parent <span class="token operator">=</span> x<span class="token punctuation">;</span>                   <span class="token comment">//让h结点的父结点指向x结点</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="472_825"></a>4.7.2、右旋操作</h4> 
<p><img src="https://images2.imgbox.com/df/6f/6GjU37Ho_o.png" alt=""></p> 
<p><strong>核心描述：</strong></p> 
<ul><li>获取当前结点h</li><li>获取当前结点h的左子结点x</li><li>让h的左子结点指向x的右子结点</li><li>让x的右子结点指向h结点</li></ul> 
<p><strong>动画演示：</strong></p> 
<p><img src="https://images2.imgbox.com/a9/ae/lD51mrPg_o.gif" alt=""></p> 
<p><strong>代码实现：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">//右旋操作</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateRight</span><span class="token punctuation">(</span>Node h<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                    <span class="token comment">//判断当前结点h是否为null</span>
        Node x <span class="token operator">=</span> h<span class="token punctuation">.</span>left<span class="token punctuation">;</span>                <span class="token comment">//获取当前结点h的左子结点x</span>
        h<span class="token punctuation">.</span>left <span class="token operator">=</span> x<span class="token punctuation">.</span>right<span class="token punctuation">;</span>               <span class="token comment">//让h的左子结点指向x的右子结点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span>            <span class="token comment">//判断x的右子结点是否为null</span>
            x<span class="token punctuation">.</span>right<span class="token punctuation">.</span>parent <span class="token operator">=</span> h<span class="token punctuation">;</span>         <span class="token comment">//让x的右子结点的父结点指向h</span>
        x<span class="token punctuation">.</span>parent <span class="token operator">=</span> h<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>            <span class="token comment">//让x的父结点指向h的父结点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>parent <span class="token operator">==</span> null<span class="token punctuation">)</span>           <span class="token comment">//判断h的父结点是否为null</span>
            root <span class="token operator">=</span> x<span class="token punctuation">;</span>                   <span class="token comment">//如果是，说明是根结点</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">==</span> h<span class="token punctuation">)</span>   <span class="token comment">//判断当前h子树是否为父结点的右子树</span>
            h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> x<span class="token punctuation">;</span>         <span class="token comment">//如果是，则修正他为新的x子树</span>
        <span class="token keyword">else</span>                            <span class="token comment">//判断当前h子树是否为父结点的左子树</span>
            h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> x<span class="token punctuation">;</span>          <span class="token comment">//如果是，则修正他为新的x子树</span>
        x<span class="token punctuation">.</span>right <span class="token operator">=</span> h<span class="token punctuation">;</span>                    <span class="token comment">//让x的右子结点指向h结点</span>
        h<span class="token punctuation">.</span>parent <span class="token operator">=</span> x<span class="token punctuation">;</span>                   <span class="token comment">//让h结点的父结点指向x结点</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="473_863"></a>4.7.3、变色操作</h4> 
<ul><li>红色变为黑色。</li><li>黑色变为红色。</li></ul> 
<h3><a id="48RBT_868"></a>4.8、RBT的添加</h3> 
<h4><a id="481_870"></a>4.8.1、添加操作</h4> 
<pre><code class="prism language-java"><span class="token comment">//添加操作</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span>Key key<span class="token punctuation">,</span> Value value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取根结点</span>
    Node t <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token comment">//判断根结点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        root<span class="token punctuation">.</span>color <span class="token operator">=</span> BLACK<span class="token punctuation">;</span>
        size<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//找指定位置</span>
    Node parent<span class="token punctuation">;</span>
    <span class="token keyword">int</span> cmp<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
        parent <span class="token operator">=</span> t<span class="token punctuation">;</span>
        cmp <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            t <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            t <span class="token operator">=</span> t<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            t<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//添加新结点</span>
    Node e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span>parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        parent<span class="token punctuation">.</span>left <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        parent<span class="token punctuation">.</span>right <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token comment">//添加后修正</span>
    <span class="token function">fixAfterPut</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//添加后加一</span>
    size<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h4><a id="482_912"></a>4.8.2、如何修正</h4> 
<ul><li><mark>1、新增一个结点，现在有1结点，不用合并</mark></li></ul> 
<p><img src="https://images2.imgbox.com/8f/30/10VWlCLn_o.png" alt=""></p> 
<ul><li><mark>2、新增一个结点，与2结点合并，直接合并</mark></li></ul> 
<p><img src="https://images2.imgbox.com/e7/2c/JQHBhVP0_o.png" alt=""></p> 
<ul><li><mark>3、新增一个结点，与3结点合并，直接合并</mark></li></ul> 
<p><img src="https://images2.imgbox.com/94/e8/M11Vzcdi_o.png" alt=""></p> 
<p><strong>当插入0.5后，需要调整，我们怎么调整呢？此时2-3-4树由3-结点变为4-结点，对比<code>4.3章</code>对比表。</strong></p> 
<p>修正思路：设0.5结点为x，让其父结点1变为黑色，让其爷爷结点2变为红色，然后按爷爷结点右旋。</p> 
<pre><code class="prism language-java"><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">rotateRight</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>但是什么时候我需要调整呢？也就是插入0.5以后的这种结构我如何判断呢？</p> 
<p>判断思路：x结点的父结点是爷爷结点的左子结点，并且其叔叔结点是黑色，现在爷爷结点的右结点为null，null就是黑色。但是这种判断最终通过的是插入0.5后、插入1.5后的这两种结构都能通过，这就是这段代码的巧妙之处，这里姑且先这样，继续往下看。</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<p><strong>当插入1.5后，需要调整，我们怎么调整呢？此时2-3-4树由3-结点变为4-结点，对比<code>4.3章</code>对比表。</strong></p> 
<p>修正思路：设1.5结点为x，此时，我们只需要按照其父结点1左旋，左旋后就变成插入0.5那种结构了，然后<strong>再按照插入0.5那种结构进行修正</strong> 。</p> 
<pre><code class="prism language-java">x <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">rotateLeft</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>但是什么时候我需要调整呢？也就是插入1.5以后的这种结构我如何判断呢？</p> 
<p>判断思路：x结点的父结点是爷爷结点的左子结点，并且其叔叔结点是黑色，现在爷爷结点的右结点为null，null就是黑色，并且还是其父结点的右子结点。这样一来，对于插入1.5后这种结构可以单独处理，处理完以后，又变成了上边那个插入0.5后的结构了，因此，上边插入0.5后的判断能判断出两种也不用怕了，因为这里会单独进行处理。把插入0.5后的那种结构变成了一种默认执行状态，为什么要这么设计呢？最主要的原因就是插入1.5后的结构需要转变为插入0.5后的结构。</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<hr> 
<p><strong>至于剩下的两种插入2.5、插入4这两种情况，这里其实不用讨论了，原因很简单，这两种情况和上边那两种情况是对称的，把左变成右，把右变成左就行了。</strong></p> 
<ul><li><mark>4、新增一个结点，与4结点合并，此时分裂</mark></li></ul> 
<p><img src="https://images2.imgbox.com/fd/af/f671imvx_o.png" alt=""></p> 
<p><strong>当插入1后，需要调整，我们怎么调整呢？此时不用对比<code>4.3章</code>对比表。</strong></p> 
<p>修正思路：由于一个红结点下必是两个黑结点，因此设1结点为x，让其父结点2、叔叔结点4变为黑色，让其爷爷结点3变为红色即可。</p> 
<pre><code class="prism language-java"><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span>uncle<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>但是什么时候我需要调整呢？也就是插入1以后的这种结构我如何判断呢？</p> 
<p>判断思路：x结点的父结点是爷爷结点的左子结点，并且其叔叔结点是红色。但是这种判断最终通过的是插入1后、插入2.5后的这两种结构都能通过，这就是这段代码的巧妙之处，这里姑且先这样，继续往下看。</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span> <span class="token operator">==</span> RED<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<p><strong>当插入2.5后，需要调整，我们怎么调整呢？此时不用对比<code>4.3章</code>对比表。</strong></p> 
<p>修正思路：由于一个红结点下必是两个黑结点，因此设2.5结点为x，让其父结点2、叔叔结点4变为黑色，让其爷爷结点3变为红色即可。</p> 
<pre><code class="prism language-java"><span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span>uncle<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>但是什么时候我需要调整呢？也就是插入2.5以后的这种结构我如何判断呢？</p> 
<p>判断思路：x结点的父结点是爷爷结点的左子结点，并且其叔叔结点是红色。此时判断不判断是其父结点的右子结点都无所谓，因为不用调整结构，只需变色。</p> 
<p>所以插入1和插入2.5这两种情况的判定是一样的，因为不涉及旋转操作，只涉及变色，而且都需要变色，所以不用区别的很清楚。</p> 
<pre><code class="prism language-java"><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span> <span class="token operator">==</span> RED<span class="token punctuation">)</span>
</code></pre> 
<hr> 
<p><strong>至于剩下的两种插入3.5、插入5这两种情况，这里其实不用讨论了，原因很简单，这两种情况和上边那两种情况是对称的，把左变成右，把右变成左就行了。</strong></p> 
<h4><a id="483_1020"></a>4.8.3、修正操作</h4> 
<pre><code class="prism language-java"><span class="token comment">//修正操作</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fixAfterPut</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    x<span class="token punctuation">.</span>color <span class="token operator">=</span> RED<span class="token punctuation">;</span><span class="token comment">//每次添加必须是红结点</span>

    <span class="token comment">//因为root没有父结点，所以不能让x上移循环到root</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> x <span class="token operator">!=</span> root <span class="token operator">&amp;&amp;</span> x<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>color <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Node grandpa <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            Node uncle <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span> <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//这个是判断的：4、新增一个结点，与4结点合并，此时分裂</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>uncle<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                x <span class="token operator">=</span> grandpa<span class="token punctuation">;</span><span class="token comment">//因为x结点、x的父结点、x的爷爷结点都修正过了，该让x的爷爷结点往上继续修正了</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//这里是判断的：3、新增一个结点，与3结点合并，直接合并</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    x <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">rotateLeft</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">rotateRight</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            Node uncle <span class="token operator">=</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>uncle<span class="token punctuation">)</span> <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//这个是判断的：4、新增一个结点，与4结点合并，此时分裂</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>uncle<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                x <span class="token operator">=</span> grandpa<span class="token punctuation">;</span><span class="token comment">//因为x结点、x的父结点、x的爷爷结点都修正过了，该让x的爷爷结点往上继续修正了</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//这里是判断的：3、新增一个结点，与3结点合并，直接合并</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    x <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">rotateRight</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">rotateLeft</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    root<span class="token punctuation">.</span>color <span class="token operator">=</span> BLACK<span class="token punctuation">;</span><span class="token comment">//根结点必须是黑结点</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="484_1069"></a>4.8.4、添加测试</h4> 
<p>添加层序遍历代码：</p> 
<pre><code class="prism language-java"><span class="token comment">//层序遍历当前树</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">layerErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">layerErgodic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//层序遍历指定树</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">layerErgodic</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//创建一个队列</span>
    Queue<span class="token generics function"><span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span> nodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//加入指定结点</span>
    nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//循环弹出遍历</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>nodes<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//从队列中弹出一个结点，输出当前结点的信息</span>
        Node n <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断当前结点还有没有左子结点，如果有，则放入到nodes中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断当前结点还有没有右子结点，如果有，则放入到nodes中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>创建红黑树的测试：<code>RedBlackTreeTest</code></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedBlackTreeTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        RedBlackTree<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token punctuation">&gt;</span></span> rbt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedBlackTree</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">layerErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最终测试效果对比：</p> 
<p><img src="https://images2.imgbox.com/24/be/Gs7sdztw_o.png" alt=""></p> 
<h3><a id="49RBT_1129"></a>4.9、RBT的获取</h3> 
<h4><a id="491_1131"></a>4.9.1、获取指定结点</h4> 
<pre><code class="prism language-java"><span class="token comment">//获取树指定结点</span>
<span class="token keyword">public</span> Node <span class="token function">getNode</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node p <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> cmp <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> null<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="492_1150"></a>4.9.2、获取最小结点</h4> 
<pre><code class="prism language-java"><span class="token comment">//获取树最小结点</span>
<span class="token keyword">public</span> Node <span class="token function">getMinNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node p <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="493_1163"></a>4.9.3、获取最大结点</h4> 
<pre><code class="prism language-java"><span class="token comment">//获取树最大结点</span>
<span class="token keyword">public</span> Node <span class="token function">getMaxNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node p <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="494_1176"></a>4.9.4、获取前驱结点</h4> 
<p><img src="https://images2.imgbox.com/e1/30/9JQPKvuy_o.png" alt=""></p> 
<p><strong>前驱结点：</strong> 小于当前结点的最大值，在一棵树中，判断前驱结点分为三种情况。</p> 
<ul><li>第一种情况：要查询的结点为null，此时直接返回null。</li><li>第二种情况：要查询的结点不为null，并且左子树不为null，在其左子树中找到最大的那个结点即可。如上图所示：结点4的前驱结点是结点3。</li><li>第三中情况：要查询的结点不为null，并且左子树为null，我们就需要循环向上查询其父结点，直到当前结点是父结点的右子结点为止。如上图所示：结点5的前驱结点是结点4，操作顺序：首先结点5是结点6的左子结点，结点6是结点8的左子结点，结点8是结点4的右子结点，此时停止，结点4就是前驱结点。</li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//获取指定结点的前驱结点</span>
<span class="token keyword">public</span> Node <span class="token function">predecessor</span><span class="token punctuation">(</span>Node t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token comment">//第一种情况</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//第二种情况</span>
        Node p <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//第三种情况</span>
        Node p <span class="token operator">=</span> t<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        Node ch <span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> p<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            ch <span class="token operator">=</span> p<span class="token punctuation">;</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="495_1210"></a>4.9.5、获取后继结点</h4> 
<p><img src="https://images2.imgbox.com/76/e8/GsbUoTuK_o.png" alt=""></p> 
<p><strong>后继结点：</strong> 大于当前结点的最小值，在一棵树中，判断后继结点分为三种情况。</p> 
<ul><li>第一种情况：要查询的结点为null，此时直接返回null。</li><li>第二种情况：要查询的结点不为null，并且右子树不为null，在其右子树中找到最小的那个结点即可。如上图所示：结点4的后继结点是结点5。</li><li>第三中情况：要查询的结点不为null，并且右子树为null，我们就需要循环向上查询其父结点，直到当前结点是父结点的左子结点为止。如上图所示：结点3的后继结点是结点4，操作顺序：首先结点3是结点2的右子结点，结点2是结点4的左子结点，此时停止，结点4就是后继结点。</li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//获取指定结点的后继结点</span>
<span class="token keyword">public</span> Node <span class="token function">successor</span><span class="token punctuation">(</span>Node t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token comment">//第一种情况</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//第二种情况</span>
        Node p <span class="token operator">=</span> t<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//第三种情况</span>
        Node p <span class="token operator">=</span> t<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        Node ch <span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> p<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            ch <span class="token operator">=</span> p<span class="token punctuation">;</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="410RBT_1244"></a>4.10、RBT的删除</h3> 
<h4><a id="4101_1246"></a>4.10.1、删除操作</h4> 
<p>关于红黑树的删除操作，这时候你不能使用BST的那种递归删除，因为我们当前的红黑树的结点有父结点指向，这点比较麻烦，具体删除规则一共分为4种：</p> 
<ul><li>1、要删除的结点是叶子结点，此时直接删除即可。（叶子结点可黑可红，由于RBT是黑色平衡，如果删除的是黑色结点，我们要先调整，然后再删除）</li><li>2、要删除的结点是树根结点，此时直接删除即可。（树根结点永远黑色，删除完了就完了，树就空了，还保持啥平衡）</li><li>3、要删除的结点有1个孩子，可能有左孩子，可能有右孩子，只需让左 / 右孩子指向 <strong>要删除结点</strong> 的父亲结点即可。</li><li>4、要删除的结点有2个孩子，肯定有左孩子，肯定有右孩子，只需让该结点的前驱或后继结点的值覆盖 <strong>要删除结点</strong> 的值，然后删除前驱或后继结点即可。</li></ul> 
<p>我们探讨了红黑树删除的4种情况，关于第3种、第4种情况比较特殊，由于第4种情况的前驱或者后继结点要么是叶子结点、要么就是第3种的有1个孩子的情况。</p> 
<p>如下图所示：4的前驱结点是3.5、6的后继结点是6.5，此时的问题就变成了第1种的删除规则了；5的前驱结点是4、5的后继结点是6，这两种情况都有1个孩子，此时的问题就变成了第3种的删除规则了。</p> 
<p><img src="https://images2.imgbox.com/00/63/KUxj2JEt_o.png" alt=""></p> 
<p>因此，我们在进行删除操作的时候，首先从第4种规则开始判断，第4种规则虽然要删除前驱或者后继结点，但是因为和第3种情况和第1种情况重复，所以，删除的动作全部交给第3种情况和第1种情况来处理，又因为，第1、2种情况比较固定，所以，我们的处理顺序是：处理第4种、处理第3种、处理第2种、处理第1种。</p> 
<p>当然了，在第3种中，如果删除的时候也是黑结点，那么删除后也是需要修正的，以此来保持红黑树的平衡。</p> 
<blockquote> 
 <p>Q：第4种情况，我到底是用前驱结点的值来覆盖要删除结点的值，还是用后继结点的值来覆盖要删除结点的值？</p> 
 <p>A：两种都可以，选用的情况不同可能会造成最终的树结构不同，但是都正确。TreeMap的作者 <code>Josh Bloch</code> and <code>Doug Lea</code> 采用的是后继结点（successor），而<code>www.cs.usfca.edu</code>网站上的操作则是选用的前驱结点（predecessor），我们这里采用前驱结点，以方便验证树的结果。</p> 
</blockquote> 
<pre><code class="prism language-java"><span class="token comment">//删除操作</span>
<span class="token keyword">public</span> Value <span class="token function">delete</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node p <span class="token operator">=</span> <span class="token function">getNode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> null<span class="token punctuation">)</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    Value oldValue <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token function">deleteNode</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//真正删除</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">deleteNode</span><span class="token punctuation">(</span>Node p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    size<span class="token operator">--</span><span class="token punctuation">;</span>

    <span class="token comment">//4、要删除的结点有2个孩子，肯定有左孩子，肯定有右孩子</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//找到前驱结点，然后替换要删除结点的键值</span>
        Node s <span class="token operator">=</span> <span class="token function">predecessor</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>key <span class="token operator">=</span> s<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>value <span class="token operator">=</span> s<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token comment">//替换完成以后，指向前驱结点为删除做准备</span>
        p <span class="token operator">=</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//3、要删除的结点有1个孩子，可能有左孩子，可能有右孩子</span>
    Node replacement <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> null <span class="token operator">?</span> p<span class="token punctuation">.</span>left <span class="token operator">:</span> p<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>replacement <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//让左右子结点连接到p的父结点上</span>
        replacement<span class="token punctuation">.</span>parent <span class="token operator">=</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">==</span> null<span class="token punctuation">)</span>
            root <span class="token operator">=</span> replacement<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
            p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> replacement<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> replacement<span class="token punctuation">;</span>

        <span class="token comment">//释放当前p结点所有指向等待回收</span>
        p<span class="token punctuation">.</span>left <span class="token operator">=</span> p<span class="token punctuation">.</span>right <span class="token operator">=</span> p<span class="token punctuation">.</span>parent <span class="token operator">=</span> null<span class="token punctuation">;</span>

        <span class="token comment">//如果当前删除的是黑结点需修正</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>color <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
            <span class="token function">fixAfterDelete</span><span class="token punctuation">(</span>replacement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//2、要删除的结点是树根结点，此时直接删除即可。（树根结点永远黑色，删除完了就完了，还保持啥平衡）</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        root <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//1、要删除的结点是叶子结点，此时直接删除即可。（如果删除的是黑色结点，我们要先调整，然后再删除）</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//先调整</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>color <span class="token operator">==</span> BLACK<span class="token punctuation">)</span>
            <span class="token function">fixAfterDelete</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//再删除</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
                p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> null<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
                p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> null<span class="token punctuation">;</span>
            p<span class="token punctuation">.</span>parent <span class="token operator">=</span> null<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<blockquote> 
 <p>Q：为什么第1种情况是先调整再删除，而第3种情况是先删除再调整？</p> 
 <p>A：第1种情况删除的是叶子结点，你如果先删除的话，删除完了，你还有办法再调整吗？显然结点都没了，这是无法调整，那为什么第3种可以呢？因为第3种调整的是<code>replacement</code>被替换的那个结点。</p> 
</blockquote> 
<h4><a id="4102_1339"></a>4.10.2、如何修正</h4> 
<p>通过上一小节的删除操作，我们会发现删除规则的4种情况中，第2种删除后不用调整，排除他，第4种删除，虽然删除的是有2个孩子的结点，但是我们通过前驱或者后继结点的赋值，然后删除前驱或者后继结点，转化为删除只有1个孩子或者删除叶子结点的情况，因此，我们删除结点时，其实一直都在删除树的倒数第一层和倒数第二层中的结点。我们还会知道，如果你删除的是红色的叶子结点，那么将会直接删除，根本就不会进入到<code>fixAfterDelete(p);</code>修正的方法中。</p> 
<p>我们把目光放到上一小节的代码块41-42行，这里<code>fixAfterDelete(replacement);</code>中的<code>replacement</code>结点一定是红色的叶子结点，我为什么这么肯定，请你对比<code>4.3章</code>对比表，你就会发现<code>3-结点</code>转换为红黑树的结点以后，就是上黑下红，你看41行的判断条件<code>if (p.color == BLACK)</code>，这就说明了，当前要删除的结点是黑色，并且当前判断的就是有1个孩子（左/右）的情况，那么这个孩子结点必定是红色叶子结点，如下图：</p> 
<p><img src="https://images2.imgbox.com/11/51/DqGyeCLc_o.png" alt=""></p> 
<ul><li>当要删除的结点是1时，会让结点3的左子结点指向结点2，此时，树中少了一个黑结点，导致不平衡，为了保证平衡，需要把结点2变为黑色。</li><li>当要删除的结点是11时，会让结点9的右子结点指向结点10，此时，树中少了一个黑结点，导致不平衡，为了保证平衡，需要把结点10变为黑色。</li></ul> 
<p>因此，上一小节的代码块41-42行，就是为了修正这两种情况，他的实现代码非常简单：</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fixAfterDelete</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//那么在此之前要处理的必定是  x != root &amp;&amp; colorOf(x) == BLACK</span>

    <span class="token comment">//如果当前结点是红色，那么立即修改为黑色</span>
    <span class="token comment">//还有一种情况就是为了保证根结点root始终是黑色，因为replacement最后有可能成为根结点</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>好了，上一小节的代码块42行<code>fixAfterDelete(replacement);</code>处的修正就完成了。接下来，重点说上一小节的代码块52行<code>fixAfterDelete(p);</code>的修正。</p> 
<p>首先你一定要明确，上一小节的代码块52行<code>fixAfterDelete(p);</code>的修正，他只是修正删除的是黑色叶子结点的情况，其余情况在上边都已经完整的讨论过了。</p> 
<p><img src="https://images2.imgbox.com/61/65/8BErgYng_o.png" alt=""></p> 
<p>因为上边已经说了，我们现在实际上删除的一直都是红黑树中的倒数第一层和倒数第二层的结点，他映射到上图1的2-3-4树中是最后一层，也就是说，我们实际上也是在一直删除2-3-4树的倒数第一层，在倒数第一层无非就那几种情况：</p> 
<ul><li><code>2-结点</code>：4、5、6</li><li><code>3-结点</code>：1和2</li><li><code>4-结点</code>：10和11和12</li></ul> 
<p><code>3-结点</code>和<code>4-结点</code>是不是就不用考虑了，因为现在修正的是黑色叶子结点，对应到2-3-4树也就是<code>2-结点</code>，这其中，结点还分左右，我们只探讨当要删除的黑色结点是左结点的情况，那么当要删除的结点是右结点的情况也就出来了。</p> 
<pre><code class="prism language-java"><span class="token comment">//x是左孩子的情况</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> 
<p>请看图1的结点6和结点8对比到图3中，都是黑色的叶子结点，并且都是左结点，我们重点考虑如何删除他俩。</p> 
<p>我们的红黑树是在2-3-4树的基础上演变过来的，因此关于删除的操作，也应该符合2-3-4树的一些特性：除了叶子结点外，其余每层必须要满足相对应的结点数。</p> 
<ul><li><mark>1、删除结点6，得第一种结论：自己删不掉，找别人，别人管不了，那就一起少</mark></li></ul> 
<p>看下图1，当我们删除结点6的时候，这个时候就破坏了2-3-4树的平衡了，原因是7和9所在的<code>3-结点</code>要求必须有3个孩子，但是，你把6这个左孩子给删除掉了，他就少了一个孩子，因此就不平衡了。想要保持平衡，自己（也就结点6）他没有办法，他肯定找最亲近的父亲结点7帮忙，把父亲结点直接拉下水，那此时，父亲结点的位置也就空了，然后让结点6最近的兄弟结点8去帮父亲结点的忙，最终变为下图2。你观察，是不是发现此时还是不平衡的，原因是8和9所在的<code>3-结点</code>要求必须有3个孩子，但是，现在只有左孩子7和右孩子<code>10 11 12</code>这两个孩子，显然不平衡，这就是典型的自己删不掉，找别人，别人还管不了，这里的管不了最终出现问题的地方是在兄弟结点8上，因为兄弟结点8只有1个，借出去了，他就自身难保了。有人可能会问，你咋不找<code>10 11 12</code>，<code>10 11 12</code>属于远房兄弟，不亲近，根本就过不来，假设你把10要到父亲结点处，就打乱顺序了，此时就变成了<code>10 9</code>，所以不行，只能最近的兄弟结点8来帮老父亲结点7的忙；这里还要重申一点，当要删除的结点6是左孩子的时候，只能向右边找人，不能向左边找人。</p> 
<p><img src="https://images2.imgbox.com/29/3e/NSSYTRx3_o.png" alt=""></p> 
<p>经过上图的推论之后，我们再来对比一下下图的图1和图3，你会发现图1中结点6的和结点8是兄弟关系，而图3中结点6和结点9是兄弟关系，这显然存在一定的问题，对应不上了，这个时候，我们就需要对红黑树进行调整，调整到结点6和结点8是兄弟关系，而调整无外乎左旋、右旋和变色。</p> 
<p><img src="https://images2.imgbox.com/e0/92/yWp5EerQ_o.png" alt=""></p> 
<p>而6、7、8、9、11所在的结构明显是需要左旋的，那什么时候左旋呢？看下图1，显然是红黑树中结点6的兄弟结点9是红色的时候进行左旋，假设结点6为x，旋转完以后还需要进行变色，看下图2，旋转完以后，<code>6 7 8</code>组成了一个新的2-3-4树的<code>4-结点</code>，而<code>4-结点</code>对应红黑树结点应该是上红下黑，忘了的看<code>4.3章</code>对比表，而9是2-3-4树中的<code>2-结点</code>，对应到红黑树中是黑色，因此需要变色。经过调整后就找到了结点6的真正兄弟结点8，然后修改兄弟结点的指向就行了。</p> 
<pre><code class="prism language-java"><span class="token comment">//获取当前的兄弟结点</span>
Node brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//找到真正的兄弟结点</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span> <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/25/44/zPGg9xoR_o.png" alt=""></p> 
<p>那如何判断我的兄弟结点帮不了忙呢？不要忘了叶子结点还有左右指向的<code>NULL LEAF</code>结点，这两个结点也是黑色，只不过平时不画出来，那么代码就出来了。</p> 
<pre><code class="prism language-java"><span class="token comment">//这个兄弟结点帮不了</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK <span class="token operator">&amp;&amp;</span> <span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
<span class="token comment">//这个兄弟结点帮得了</span>
<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>

<span class="token punctuation">}</span>
</code></pre> 
<p>既然别人管不了你，你自己删除以后，那么这棵树中肯定就少了一个黑结点，为了保持平衡，你应该让你的兄弟也删除一个黑结点，也就是大家一起少，那这样还是会保持平衡，但是，你兄弟能删除吗？肯定不能真的删除，那只能假删除，怎么办？把兄弟结点变成红色，红色不影响树的平衡，所以一旦兄弟结点变成了红色，就意味着少了一个黑色结点。此时，以你的父结点为根的左右子树就已经平衡了，但是你的父结点之上还有其他结点，此时就需要循环向上依次平衡左右子树，直到当前结点为root的时候，就已经完成了调整。</p> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fixAfterDelete</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//那么在此之前要处理的必定是  x != root &amp;&amp; colorOf(x) == BLACK</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> root <span class="token operator">&amp;&amp;</span> <span class="token function">colorOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//x是左孩子的情况</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获取当前的兄弟结点</span>
            Node brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//找到真正的兄弟结点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span> <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//这个兄弟结点帮不了</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK <span class="token operator">&amp;&amp;</span> <span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                x <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//这个兄弟结点帮得了</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>

            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//x是右孩子的情况</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//如果当前结点是红色，那么立即修改为黑色</span>
    <span class="token comment">//还有一种情况就是为了保证根结点root始终是黑色，因为replacement最后有可能成为根结点</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ul><li><mark>2、删除结点8，得第二种结论：自己删不掉，找别人，别人管得了，别人来帮你</mark></li></ul> 
<p>我们通过上边的分析，已经解决了帮不了的问题，那剩下的就是帮得了的问题，所以也就不用判断了，在帮得了的问题中，又细分为两类：在2-3-4树中兄弟结点为<code>3-结点</code>和<code>4-结点</code>都能提供帮助，并且不破坏当前2-3-4树的平衡。</p> 
<p><img src="https://images2.imgbox.com/23/19/eVZKarxx_o.png" alt=""></p> 
<p>当删除结点8的时候，上图两种情况都可以继续保持平衡，删除完以后如下图：</p> 
<p><img src="https://images2.imgbox.com/47/60/MUaI5NfX_o.png" alt=""></p> 
<p>由此可见，如果兄弟结点是<code>3-结点</code>或者<code>4-结点</code>，那么他是可以在老父亲走后，去顶替老父亲的位置而不造成树的失衡。</p> 
<p>但是我们现在实际上操纵的是红黑树，<code>3-结点</code>对应的红黑树结点可能有两种情况，左倾、右倾，而<code>4-结点</code>则只有一种。</p> 
<p>对于<code>3-结点</code>来说，就有可能有两种情况：</p> 
<p><img src="https://images2.imgbox.com/ce/8b/fUhkVfQA_o.png" alt=""></p> 
<p>对于上图2来说，画圈的地方可以直接左旋，这样就能让结点9替代被删除的结点8，结点10替代老父亲结点，最终如下图：</p> 
<p><img src="https://images2.imgbox.com/55/40/vNq8NJ38_o.png" alt=""></p> 
<p>旋转完成以后，我们需要变色，这个变色是根据什么呢？是根据你删除后当前结点在所对应2-3-4树中的类型，如上图4，结点9和结点11都是<code>2-结点</code>，所以必然是黑色，而结点10替代了原来结点9也就是老父亲的位置，那他的颜色就应该是老父亲的颜色才对，因此最终代码：</p> 
<pre><code class="prism language-java"><span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> <span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<blockquote> 
 <p>ps：先变色，还是先旋转不影响最终结果。</p> 
</blockquote> 
<blockquote> 
 <p>ps：上图3中的结点8根本就没有删除掉，这是正常的，我们是先修正，然后再删除，<code>fixAfterDelete(p);</code>只负责修正。</p> 
</blockquote> 
<hr> 
<p>对于<code>3-结点</code>来说，就有可能有两种情况，已经分析完了下图2这种情况了。</p> 
<p><img src="https://images2.imgbox.com/5b/de/7nwgcHFG_o.png" alt=""></p> 
<p>接下来继续分析上图3这种情况，很明显，结点8的结点所对应的兄弟结点并不是结点10，因此，我们需要调整结构，此时需要右旋然后变色即可。</p> 
<p><img src="https://images2.imgbox.com/08/c3/Hi6J5qSA_o.png" alt=""></p> 
<pre><code class="prism language-java"><span class="token comment">//判断当前结构是不是需要调整，找到真正的兄弟结点</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">rotateRight</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
    brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>现在会发现，上图2就变成了右倾的情况了，此时再重新找人帮忙就没问题了。</p> 
<pre><code class="prism language-java"><span class="token comment">//判断当前结构是不是需要调整，找到真正的兄弟结点</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">rotateRight</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
    brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">//让老父亲去顶替被删除结点，让亲兄弟去顶替老父亲</span>
<span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> <span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>到此，<code>3-结点</code>的情况就分析完了，<code>4-结点</code>就不用分析了，因为<code>3-结点</code>已经包括了左右的情况了，直接复用上边的代码块中的代码就行了。</p> 
<h4><a id="4103_1540"></a>4.10.3、修正操作</h4> 
<pre><code class="prism language-java"><span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fixAfterDelete</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//那么在此之前要处理的必定是  x != root &amp;&amp; colorOf(x) == BLACK</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>x <span class="token operator">!=</span> root <span class="token operator">&amp;&amp;</span> <span class="token function">colorOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//x是左孩子的情况</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获取当前的兄弟结点</span>
            Node brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//找到真正的兄弟结点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span> <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//这个兄弟结点帮不了</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK <span class="token operator">&amp;&amp;</span> <span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                x <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//这个兄弟结点帮得了</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//判断当前结构是不是需要调整，找到真正的兄弟结点</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">rotateRight</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    brother <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//让老父亲去顶替被删除结点，让亲兄弟去顶替老父亲</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> <span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">rotateLeft</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//这种情况，调整一次即可，x=root代表跳出当前循环</span>
                x <span class="token operator">=</span> root<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//x是右孩子的情况</span>
        <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获取当前的兄弟结点</span>
            Node brother <span class="token operator">=</span> <span class="token function">leftOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//找到真正的兄弟结点</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span> <span class="token operator">==</span> RED<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">rotateRight</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                brother <span class="token operator">=</span> <span class="token function">leftOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token comment">//这个兄弟结点帮不了</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK <span class="token operator">&amp;&amp;</span> <span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                x <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//这个兄弟结点帮得了</span>
            <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
                <span class="token comment">//判断当前结构是不是需要调整，找到真正的兄弟结点</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">==</span> BLACK<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
                    <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> RED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">rotateLeft</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    brother <span class="token operator">=</span> <span class="token function">leftOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token comment">//让老父亲去顶替被删除结点，让亲兄弟去顶替老父亲</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span>brother<span class="token punctuation">,</span> <span class="token function">colorOf</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">setColor</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>brother<span class="token punctuation">)</span><span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token function">rotateRight</span><span class="token punctuation">(</span><span class="token function">parentOf</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">//这种情况，调整一次即可，x=root代表跳出当前循环</span>
                x <span class="token operator">=</span> root<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//如果当前结点是红色，那么立即修改为黑色</span>
    <span class="token comment">//还有一种情况就是为了保证根结点root始终是黑色，因为replacement最后有可能成为根结点</span>
    <span class="token function">setColor</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> BLACK<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="4104_1626"></a>4.10.4、删除测试</h4> 
<p>修改红黑树的测试：<code>RedBlackTreeTest</code></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RedBlackTreeTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        RedBlackTree<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token punctuation">&gt;</span></span> rbt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RedBlackTree</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        rbt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        rbt<span class="token punctuation">.</span><span class="token function">layerErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最终测试效果对比：</p> 
<p><img src="https://images2.imgbox.com/3c/06/bMPKTyUc_o.png" alt=""></p> 
<h2><a id="_AVL_1662"></a>第五章 AVL树</h2> 
<h3><a id="51AVL_1664"></a>5.1、AVL树的定义</h3> 
<p>在计算机科学中，AVL树是最先发明的自平衡二叉查找树。在AVL树中任何节点的两个子树的高度最大差别为1，所以它也被称为高度平衡树。增加和删除可能需要通过一次或多次树旋转来重新平衡这个树。AVL树得名于它的发明者G. M. Adelson-Velsky和E. M. Landis，他们在1962年的论文《An algorithm for the organization of information》中发表了它。</p> 
<p>在这里再推荐一个AVL树演示的网站：https://www.cs.usfca.edu/~galles/visualization/AVLtree.html</p> 
<p>为了大家方便测试，我们接下来代码实现的效果将会和上述网站演示的效果一样。</p> 
<h3><a id="52AVL_1672"></a>5.2、AVL树的性质</h3> 
<p>AVL树，本质上是带了平衡功能的二叉查找树（二叉排序树，二叉搜索树），具体特点是：</p> 
<ul><li>本身首先是一棵二叉查找树。</li><li>带有平衡条件：每个结点的左右子树的高度之差的绝对值（平衡因子）最多为1。</li></ul> 
<h3><a id="53AVL_1679"></a>5.3、AVL树的结构</h3> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdelsonVelskyLandisTree</span><span class="token operator">&lt;</span>Key <span class="token keyword">extends</span> <span class="token class-name">Comparable</span><span class="token generics function"><span class="token punctuation">&lt;</span>Key<span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> Value<span class="token operator">&gt;</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{<!-- --></span>                         <span class="token comment">//结点类</span>
        <span class="token keyword">public</span> Key key<span class="token punctuation">;</span>                         <span class="token comment">//存储键</span>
        <span class="token keyword">public</span> Value value<span class="token punctuation">;</span>                     <span class="token comment">//存储值</span>
        <span class="token keyword">public</span> Node parent<span class="token punctuation">;</span>                     <span class="token comment">//指向父亲结点</span>
        <span class="token keyword">public</span> Node left<span class="token punctuation">;</span>                       <span class="token comment">//指向左子结点</span>
        <span class="token keyword">public</span> Node right<span class="token punctuation">;</span>                      <span class="token comment">//指向右子结点</span>
        <span class="token keyword">public</span> <span class="token keyword">int</span> height<span class="token punctuation">;</span>                      <span class="token comment">//指向结点高度</span>

        <span class="token keyword">public</span> <span class="token function">Node</span><span class="token punctuation">(</span>Key key<span class="token punctuation">,</span> Value value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>height <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> String <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token string">"Node{"</span> <span class="token operator">+</span> <span class="token string">"key="</span> <span class="token operator">+</span> key <span class="token operator">+</span> <span class="token string">", value="</span> <span class="token operator">+</span> value <span class="token operator">+</span> <span class="token string">", height="</span> <span class="token operator">+</span> height <span class="token operator">+</span> <span class="token string">"}"</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">private</span> Node root<span class="token punctuation">;</span>                          <span class="token comment">//根结点</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> size<span class="token punctuation">;</span>                           <span class="token comment">//结点数</span>

    <span class="token comment">//获取当前树的根结点</span>
    <span class="token keyword">public</span> Node <span class="token function">getRoot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> root<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前树的结点数</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//判断当前树是否为空</span>
    <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> size <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前结点的父亲结点</span>
    <span class="token keyword">private</span> Node <span class="token function">parentOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> node <span class="token operator">!=</span> null <span class="token operator">?</span> node<span class="token punctuation">.</span>parent <span class="token operator">:</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前结点的左子结点</span>
    <span class="token keyword">private</span> Node <span class="token function">leftOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> node <span class="token operator">!=</span> null <span class="token operator">?</span> node<span class="token punctuation">.</span>left <span class="token operator">:</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前结点的右子结点</span>
    <span class="token keyword">private</span> Node <span class="token function">rightOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> node <span class="token operator">!=</span> null <span class="token operator">?</span> node<span class="token punctuation">.</span>right <span class="token operator">:</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取当前结点高度</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">heightOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> node <span class="token operator">!=</span> null <span class="token operator">?</span> node<span class="token punctuation">.</span>height <span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//获取最高的子结点</span>
    <span class="token keyword">private</span> Node <span class="token function">tallerOf</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        Node parent <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Node left <span class="token operator">=</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        Node right <span class="token operator">=</span> <span class="token function">rightOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">heightOf</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token function">heightOf</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> left<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">heightOf</span><span class="token punctuation">(</span>left<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token function">heightOf</span><span class="token punctuation">(</span>right<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> right<span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>left <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">?</span> left <span class="token operator">:</span> right<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//更新当前结点高度</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">updateHeight</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            node<span class="token punctuation">.</span>height <span class="token operator">=</span> Math<span class="token punctuation">.</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token function">heightOf</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">heightOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//接下来的方法请写在这里...</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="54AVL_1762"></a>5.4、AVL树的操作</h3> 
<h4><a id="541RR_1764"></a>5.4.1、左旋操作（RR）</h4> 
<p><img src="https://images2.imgbox.com/73/ec/aGiHBlXT_o.png" alt=""></p> 
<p><strong>失衡描述：</strong></p> 
<p>当向<code>node</code>结点下添加左右子结点时：</p> 
<ul><li><code>node</code>结点，左子树高度-右子树高度=1-1=0，平衡</li><li><code>parent</code>结点，左子树高度-右子树高度=1-2=-1，平衡</li><li><code>grandpa</code>结点，左子树高度-右子树高度=1-3=-2，失衡</li></ul> 
<p>由于在<code>grandpa</code>结点处失衡，因此需要按照<code>grandpa</code>结点进行左旋操作。</p> 
<p><strong>核心描述：</strong></p> 
<ul><li>获取当前结点h</li><li>获取当前结点h的右子结点x</li><li>让h的右子结点指向x的左子结点</li><li>让x的左子结点指向h结点</li><li>调整完成以后，只有h结点和x结点的高度有变化，需要更新高度</li></ul> 
<p><strong>动画演示：</strong></p> 
<p><img src="https://images2.imgbox.com/a7/cf/SPCnAtXI_o.gif" alt=""></p> 
<p><strong>代码实现：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">//左旋操作</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateLeft</span><span class="token punctuation">(</span>Node h<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                    <span class="token comment">//判断当前结点h是否为null</span>
        Node x <span class="token operator">=</span> h<span class="token punctuation">.</span>right<span class="token punctuation">;</span>               <span class="token comment">//获取当前结点h的右子结点x</span>
        h<span class="token punctuation">.</span>right <span class="token operator">=</span> x<span class="token punctuation">.</span>left<span class="token punctuation">;</span>               <span class="token comment">//让h的右子结点指向x的左子结点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span>             <span class="token comment">//判断x的左子结点是否为null</span>
            x<span class="token punctuation">.</span>left<span class="token punctuation">.</span>parent <span class="token operator">=</span> h<span class="token punctuation">;</span>          <span class="token comment">//让x的左子结点的父结点指向h</span>
        x<span class="token punctuation">.</span>parent <span class="token operator">=</span> h<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>            <span class="token comment">//让x的父结点指向h的父结点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>parent <span class="token operator">==</span> null<span class="token punctuation">)</span>           <span class="token comment">//判断h的父结点是否为null</span>
            root <span class="token operator">=</span> x<span class="token punctuation">;</span>                   <span class="token comment">//如果是，说明是根结点</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">==</span> h<span class="token punctuation">)</span>    <span class="token comment">//判断当前h子树是否为父结点的左子树</span>
            h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> x<span class="token punctuation">;</span>          <span class="token comment">//如果是，则修正他为新的x子树</span>
        <span class="token keyword">else</span>                            <span class="token comment">//判断当前h子树是否为父结点的右子树</span>
            h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> x<span class="token punctuation">;</span>         <span class="token comment">//如果是，则修正他为新的x子树</span>
        x<span class="token punctuation">.</span>left <span class="token operator">=</span> h<span class="token punctuation">;</span>                     <span class="token comment">//让x的左子结点指向h结点</span>
        h<span class="token punctuation">.</span>parent <span class="token operator">=</span> x<span class="token punctuation">;</span>                   <span class="token comment">//让h结点的父结点指向x结点</span>
        <span class="token function">updateHeight</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//更新h结点的高度</span>
        <span class="token function">updateHeight</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//更新x结点的高度</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="542LL_1815"></a>5.4.2、右旋操作（LL）</h4> 
<p><img src="https://images2.imgbox.com/89/c2/UCzLc8lk_o.png" alt=""></p> 
<p><strong>失衡描述：</strong></p> 
<p>当向<code>node</code>结点下添加左右子结点时：</p> 
<ul><li><code>node</code>结点，左子树高度-右子树高度=1-1=0，平衡</li><li><code>parent</code>结点，左子树高度-右子树高度=2-1=1，平衡</li><li><code>grandpa</code>结点，左子树高度-右子树高度=3-1=2，失衡</li></ul> 
<p>由于在<code>grandpa</code>结点处失衡，因此需要按照<code>grandpa</code>结点进行右旋操作。</p> 
<p><strong>核心描述：</strong></p> 
<ul><li>获取当前结点h</li><li>获取当前结点h的左子结点x</li><li>让h的左子结点指向x的右子结点</li><li>让x的右子结点指向h结点</li><li>调整完成以后，只有h结点和x结点的高度有变化，需要更新高度</li></ul> 
<p><strong>动画演示：</strong></p> 
<p><img src="https://images2.imgbox.com/22/33/CLPnz5k4_o.gif" alt=""></p> 
<p><strong>代码实现：</strong></p> 
<pre><code class="prism language-java"><span class="token comment">//右旋操作</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rotateRight</span><span class="token punctuation">(</span>Node h<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>h <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>                    <span class="token comment">//判断当前结点h是否为null</span>
        Node x <span class="token operator">=</span> h<span class="token punctuation">.</span>left<span class="token punctuation">;</span>                <span class="token comment">//获取当前结点h的左子结点x</span>
        h<span class="token punctuation">.</span>left <span class="token operator">=</span> x<span class="token punctuation">.</span>right<span class="token punctuation">;</span>               <span class="token comment">//让h的左子结点指向x的右子结点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span>            <span class="token comment">//判断x的右子结点是否为null</span>
            x<span class="token punctuation">.</span>right<span class="token punctuation">.</span>parent <span class="token operator">=</span> h<span class="token punctuation">;</span>         <span class="token comment">//让x的右子结点的父结点指向h</span>
        x<span class="token punctuation">.</span>parent <span class="token operator">=</span> h<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>            <span class="token comment">//让x的父结点指向h的父结点</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>parent <span class="token operator">==</span> null<span class="token punctuation">)</span>           <span class="token comment">//判断h的父结点是否为null</span>
            root <span class="token operator">=</span> x<span class="token punctuation">;</span>                   <span class="token comment">//如果是，说明是根结点</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">==</span> h<span class="token punctuation">)</span>   <span class="token comment">//判断当前h子树是否为父结点的右子树</span>
            h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> x<span class="token punctuation">;</span>         <span class="token comment">//如果是，则修正他为新的x子树</span>
        <span class="token keyword">else</span>                            <span class="token comment">//判断当前h子树是否为父结点的左子树</span>
            h<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> x<span class="token punctuation">;</span>          <span class="token comment">//如果是，则修正他为新的x子树</span>
        x<span class="token punctuation">.</span>right <span class="token operator">=</span> h<span class="token punctuation">;</span>                    <span class="token comment">//让x的右子结点指向h结点</span>
        h<span class="token punctuation">.</span>parent <span class="token operator">=</span> x<span class="token punctuation">;</span>                   <span class="token comment">//让h结点的父结点指向x结点</span>
        <span class="token function">updateHeight</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//更新h结点的高度</span>
        <span class="token function">updateHeight</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token comment">//更新x结点的高度</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="543LR_1866"></a>5.4.3、左右双旋（LR）</h4> 
<p><img src="https://images2.imgbox.com/b8/bc/WfRzfRNF_o.png" alt=""></p> 
<p><strong>失衡描述：</strong></p> 
<p>当向<code>node</code>结点下添加左右子结点时：</p> 
<ul><li><code>node</code>结点，左子树高度-右子树高度=1-1=0，平衡</li><li><code>parent</code>结点，左子树高度-右子树高度=1-2=-1，平衡</li><li><code>grandpa</code>结点，左子树高度-右子树高度=3-1=2，失衡</li></ul> 
<p>由于在<code>grandpa</code>结点处失衡，因此先按照<code>parent</code>结点进行左旋操作，然后再按照<code>grandpa</code>结点进行右旋操作。</p> 
<h4><a id="544RL_1880"></a>5.4.4、右左双旋（RL）</h4> 
<p><img src="https://images2.imgbox.com/22/71/cGeUiuDO_o.png" alt=""></p> 
<p><strong>失衡描述：</strong></p> 
<p>当向<code>node</code>结点下添加左右子结点时：</p> 
<ul><li><code>node</code>结点，左子树高度-右子树高度=1-1=0，平衡</li><li><code>parent</code>结点，左子树高度-右子树高度=2-1=1，平衡</li><li><code>grandpa</code>结点，左子树高度-右子树高度=1-3=-2，失衡</li></ul> 
<p>由于在<code>grandpa</code>结点处失衡，因此先按照<code>parent</code>结点进行右旋操作，然后再按照<code>grandpa</code>结点进行左旋操作。</p> 
<h3><a id="55AVL_1894"></a>5.5、AVL树的添加</h3> 
<h4><a id="551_1896"></a>5.5.1、添加操作</h4> 
<pre><code class="prism language-java"><span class="token comment">//添加操作</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">put</span><span class="token punctuation">(</span>Key key<span class="token punctuation">,</span> Value value<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//获取根结点</span>
    Node t <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token comment">//判断根结点</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        root <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        size<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//找指定位置</span>
    Node parent<span class="token punctuation">;</span>
    <span class="token keyword">int</span> cmp<span class="token punctuation">;</span>
    <span class="token keyword">do</span> <span class="token punctuation">{<!-- --></span>
        parent <span class="token operator">=</span> t<span class="token punctuation">;</span>
        cmp <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>t<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            t <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            t <span class="token operator">=</span> t<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            t<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">while</span> <span class="token punctuation">(</span>t <span class="token operator">!=</span> null<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//添加新结点</span>
    Node e <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Node</span><span class="token punctuation">(</span>key<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    e<span class="token punctuation">.</span>parent <span class="token operator">=</span> parent<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        parent<span class="token punctuation">.</span>left <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        parent<span class="token punctuation">.</span>right <span class="token operator">=</span> e<span class="token punctuation">;</span>
    <span class="token comment">//添加后修正</span>
    <span class="token function">fixAfterPut</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//添加后加一</span>
    size<span class="token operator">++</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="552_1936"></a>5.5.2、如何修正</h4> 
<p>添加后可能会导致所有祖先节点都失衡，只要让高度最低的失衡节点恢复平衡，整棵树就恢复平衡，仅需 O(1) 次调整即可。</p> 
<h4><a id="553_1940"></a>5.5.3、修正操作</h4> 
<pre><code class="prism language-java"><span class="token comment">//修正操作</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fixAfterPut</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>node <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBalance</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//平衡后更新结点高度</span>
            <span class="token function">updateHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//不平衡以后恢复平衡</span>
            <span class="token function">rebalance</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//整棵树恢复平衡退出</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//判断是否平衡</span>
<span class="token keyword">private</span> <span class="token keyword">boolean</span> <span class="token function">isBalance</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">return</span> Math<span class="token punctuation">.</span><span class="token function">abs</span><span class="token punctuation">(</span><span class="token function">heightOf</span><span class="token punctuation">(</span><span class="token function">leftOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token function">heightOf</span><span class="token punctuation">(</span><span class="token function">rightOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//平衡当前结点</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">rebalance</span><span class="token punctuation">(</span>Node grandpa<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node parent <span class="token operator">=</span> <span class="token function">tallerOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
    Node node <span class="token operator">=</span> <span class="token function">tallerOf</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// L</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token function">leftOf</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// LL</span>
            <span class="token function">rotateRight</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// LR</span>
            <span class="token function">rotateLeft</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">rotateRight</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// R</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>node <span class="token operator">==</span> <span class="token function">rightOf</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// RR</span>
            <span class="token function">rotateLeft</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span> <span class="token comment">// RL</span>
            <span class="token function">rotateRight</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">rotateLeft</span><span class="token punctuation">(</span>grandpa<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="554_1985"></a>5.5.4、添加测试</h4> 
<p>添加层序遍历代码：</p> 
<pre><code class="prism language-java"><span class="token comment">//层序遍历当前树</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">layerErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token function">layerErgodic</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//层序遍历指定树</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">layerErgodic</span><span class="token punctuation">(</span>Node x<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token comment">//创建一个队列</span>
    Queue<span class="token generics function"><span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span> nodes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">LinkedList</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//加入指定结点</span>
    nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//循环弹出遍历</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span>nodes<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//从队列中弹出一个结点，输出当前结点的信息</span>
        Node n <span class="token operator">=</span> nodes<span class="token punctuation">.</span><span class="token function">poll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        System<span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//判断当前结点还有没有左子结点，如果有，则放入到nodes中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>left<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//判断当前结点还有没有右子结点，如果有，则放入到nodes中</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>n<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            nodes<span class="token punctuation">.</span><span class="token function">offer</span><span class="token punctuation">(</span>n<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>创建AVL树的测试：<code>AdelsonVelskyLandisTreeTest</code></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdelsonVelskyLandisTreeTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        AdelsonVelskyLandisTree<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token punctuation">&gt;</span></span> avlt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AdelsonVelskyLandisTree</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">layerErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最终测试效果对比：</p> 
<p><img src="https://images2.imgbox.com/da/39/wDQepA9o_o.png" alt=""></p> 
<h3><a id="56AVL_2045"></a>5.6、AVL树的获取</h3> 
<h4><a id="561_2047"></a>5.6.1、获取指定结点</h4> 
<pre><code class="prism language-java"><span class="token comment">//获取树指定结点</span>
<span class="token keyword">public</span> Node <span class="token function">getNode</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node p <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span> cmp <span class="token operator">=</span> key<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>cmp <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> null<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="562_2066"></a>5.6.2、获取最小结点</h4> 
<pre><code class="prism language-java"><span class="token comment">//获取树最小结点</span>
<span class="token keyword">public</span> Node <span class="token function">getMinNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node p <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
    <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="563_2079"></a>5.6.3、获取最大结点</h4> 
<pre><code class="prism language-java"><span class="token comment">//获取树最大结点</span>
<span class="token keyword">public</span> Node <span class="token function">getMaxNode</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node p <span class="token operator">=</span> root<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null<span class="token punctuation">)</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
    <span class="token keyword">return</span> p<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="564_2092"></a>5.6.4、获取前驱结点</h4> 
<p><img src="https://images2.imgbox.com/2b/80/weS4P9HW_o.png" alt=""></p> 
<p><strong>前驱结点：</strong> 小于当前结点的最大值，在一棵树中，判断前驱结点分为三种情况。</p> 
<ul><li>第一种情况：要查询的结点为null，此时直接返回null。</li><li>第二种情况：要查询的结点不为null，并且左子树不为null，在其左子树中找到最大的那个结点即可。如上图所示：结点8的前驱结点是结点7。</li><li>第三中情况：要查询的结点不为null，并且左子树为null，我们就需要循环向上查询其父结点，直到当前结点是父结点的右子结点为止。如上图所示：结点9的前驱结点是结点8，操作顺序：首先结点9是结点10的左子结点，结点10是结点8的右子结点，此时停止，结点8就是前驱结点。</li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//获取指定结点的前驱结点</span>
<span class="token keyword">public</span> Node <span class="token function">predecessor</span><span class="token punctuation">(</span>Node t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token comment">//第一种情况</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//第二种情况</span>
        Node p <span class="token operator">=</span> t<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//第三种情况</span>
        Node p <span class="token operator">=</span> t<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        Node ch <span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> p<span class="token punctuation">.</span>left<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            ch <span class="token operator">=</span> p<span class="token punctuation">;</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="565_2126"></a>5.6.5、获取后继结点</h4> 
<p><img src="https://images2.imgbox.com/46/8f/r8MupWis_o.png" alt=""></p> 
<p><strong>后继结点：</strong> 大于当前结点的最小值，在一棵树中，判断后继结点分为三种情况。</p> 
<ul><li>第一种情况：要查询的结点为null，此时直接返回null。</li><li>第二种情况：要查询的结点不为null，并且右子树不为null，在其右子树中找到最小的那个结点即可。如上图所示：结点8的后继结点是结点9。</li><li>第三中情况：要查询的结点不为null，并且右子树为null，我们就需要循环向上查询其父结点，直到当前结点是父结点的左子结点为止。如上图所示：结点7的后继结点是结点8，操作顺序：首先结点7是结点6的右子结点，结点6是结点4的右子结点，结点4是结点8的左子结点，此时停止，结点8就是后继结点。</li></ul> 
<hr> 
<pre><code class="prism language-java"><span class="token comment">//获取指定结点的后继结点</span>
<span class="token keyword">public</span> Node <span class="token function">successor</span><span class="token punctuation">(</span>Node t<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>t <span class="token operator">==</span> null<span class="token punctuation">)</span><span class="token comment">//第一种情况</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>t<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//第二种情况</span>
        Node p <span class="token operator">=</span> t<span class="token punctuation">.</span>right<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> null<span class="token punctuation">)</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>left<span class="token punctuation">;</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span><span class="token comment">//第三种情况</span>
        Node p <span class="token operator">=</span> t<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        Node ch <span class="token operator">=</span> t<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>p <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> ch <span class="token operator">==</span> p<span class="token punctuation">.</span>right<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            ch <span class="token operator">=</span> p<span class="token punctuation">;</span>
            p <span class="token operator">=</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> p<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="57AVL_2160"></a>5.7、AVL树的删除</h3> 
<h4><a id="571_2162"></a>5.7.1、删除操作</h4> 
<pre><code class="prism language-java"><span class="token comment">//删除操作</span>
<span class="token keyword">public</span> Value <span class="token function">delete</span><span class="token punctuation">(</span>Key key<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    Node p <span class="token operator">=</span> <span class="token function">getNode</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> null<span class="token punctuation">)</span>
        <span class="token keyword">return</span> null<span class="token punctuation">;</span>
    Value oldValue <span class="token operator">=</span> p<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token function">deleteNode</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> oldValue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">//真正删除</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">deleteNode</span><span class="token punctuation">(</span>Node p<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    size<span class="token operator">--</span><span class="token punctuation">;</span>

    <span class="token comment">//4、要删除的结点有2个孩子，肯定有左孩子，肯定有右孩子</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> null <span class="token operator">&amp;&amp;</span> p<span class="token punctuation">.</span>right <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//找到前驱结点，然后替换要删除结点的键值</span>
        Node s <span class="token operator">=</span> <span class="token function">predecessor</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>key <span class="token operator">=</span> s<span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        p<span class="token punctuation">.</span>value <span class="token operator">=</span> s<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
        <span class="token comment">//替换完成以后，指向前驱结点为删除做准备</span>
        p <span class="token operator">=</span> s<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">//3、要删除的结点有1个孩子，可能有左孩子，可能有右孩子</span>
    Node replacement <span class="token operator">=</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>left <span class="token operator">!=</span> null <span class="token operator">?</span> p<span class="token punctuation">.</span>left <span class="token operator">:</span> p<span class="token punctuation">.</span>right<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>replacement <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//让左右子结点连接到p的父结点上</span>
        replacement<span class="token punctuation">.</span>parent <span class="token operator">=</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">==</span> null<span class="token punctuation">)</span>
            root <span class="token operator">=</span> replacement<span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
            p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> replacement<span class="token punctuation">;</span>
        <span class="token keyword">else</span>
            p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> replacement<span class="token punctuation">;</span>

        <span class="token comment">//释放当前p结点所有指向等待回收</span>
        p<span class="token punctuation">.</span>left <span class="token operator">=</span> p<span class="token punctuation">.</span>right <span class="token operator">=</span> p<span class="token punctuation">.</span>parent <span class="token operator">=</span> null<span class="token punctuation">;</span>

        <span class="token comment">//删除完成以后，我们需要进行平衡</span>
        <span class="token function">fixAfterDelete</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//2、要删除的结点是树根结点，此时直接删除即可</span>
    <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        root <span class="token operator">=</span> null<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//1、要删除的结点是叶子结点，此时直接删除即可</span>
    <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//先删除</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>p<span class="token punctuation">.</span>parent <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left<span class="token punctuation">)</span>
                p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>left <span class="token operator">=</span> null<span class="token punctuation">;</span>
            <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>p <span class="token operator">==</span> p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right<span class="token punctuation">)</span>
                p<span class="token punctuation">.</span>parent<span class="token punctuation">.</span>right <span class="token operator">=</span> null<span class="token punctuation">;</span>
            <span class="token comment">// p.parent = null;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">//再调整</span>
        <span class="token function">fixAfterDelete</span><span class="token punctuation">(</span>p<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="572_2227"></a>5.7.2、如何删除</h4> 
<p>删除后可能会导致父节点或祖先节点失衡（但只有1个节点会失衡），恢复平衡后，可能会导致更高层的祖先节点失衡，最多需要 O(logn) 次调整。</p> 
<h4><a id="573_2231"></a>5.7.3、修正操作</h4> 
<pre><code class="prism language-java"><span class="token comment">//修正操作</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">fixAfterDelete</span><span class="token punctuation">(</span>Node node<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>node <span class="token operator">=</span> <span class="token function">parentOf</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isBalance</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//平衡后更新结点高度</span>
            <span class="token function">updateHeight</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//不平衡以后恢复平衡</span>
            <span class="token function">rebalance</span><span class="token punctuation">(</span>node<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="574_2248"></a>5.7.4、删除测试</h4> 
<p>修改AVL树的测试：<code>AdelsonVelskyLandisTreeTest</code></p> 
<pre><code class="prism language-java"><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdelsonVelskyLandisTreeTest</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        AdelsonVelskyLandisTree<span class="token generics function"><span class="token punctuation">&lt;</span>Integer<span class="token punctuation">,</span> Integer<span class="token punctuation">&gt;</span></span> avlt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AdelsonVelskyLandisTree</span><span class="token operator">&lt;</span><span class="token operator">&gt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        avlt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">delete</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        avlt<span class="token punctuation">.</span><span class="token function">layerErgodic</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>最终测试效果对比：</p> 
<p><img src="https://images2.imgbox.com/b1/cc/Ujqr7hVm_o.png" alt=""></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/88c8a40a52193b7433d3e9f58d07d78a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">解决代理服务关闭后，无法联网的问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0b1bf99704f6ee9489a043c410e377d0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">使用KEPServerv6进行OPC_UA的服务器搭建</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>