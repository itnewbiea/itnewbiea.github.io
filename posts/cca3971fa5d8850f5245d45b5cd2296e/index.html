<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>1、opencv相机畸变矫正 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="1、opencv相机畸变矫正" />
<meta property="og:description" content="opencv相机畸变矫正 opencv相机畸变矫正1、畸变矫正保存加载 C&#43;&#43;2、畸变矫正保存加载 python2.1保存矩阵2.1直接使用保存的矩阵 3、效果 opencv相机畸变矫正 1、畸变矫正保存加载 C&#43;&#43; #include &lt;opencv2\imgproc\types_c.h&gt; #include&lt;opencv2/opencv.hpp&gt; #include&lt;iostream&gt; using namespace cv; using namespace std; Mat image, img_gray; int BOARDSIZE[2]{ 8,11 };//棋盘格每行每列角点个数 int main() { vector&lt;vector&lt;Point3f&gt;&gt; object_points;//保存棋盘格上角点的三维坐标 vector&lt;Point3f&gt; obj_world_pts;//三维世界坐标 vector&lt;vector&lt;Point2f&gt;&gt; images_points;//保存所有角点 vector&lt;Point2f&gt; img_corner_points;//保存每张图检测到的角点 vector&lt;String&gt; images_path;//创建容器存放读取图像路径 string image_path = &#34;./pic/chess118/*.png&#34;;//待处理图路径	F:/Works/C&#43;&#43;/openCV/opencv study/Revise/Revise/Project1/ //vector&lt;int&gt; point_counts; //每幅图像中的角点的数量 glob(image_path, images_path);//读取指定文件夹下图像 //转世界坐标系 for (int i = 0; i &lt; BOARDSIZE[1]; i&#43;&#43;) { for (int j = 0; j &lt; BOARDSIZE[0]; j&#43;&#43;) { obj_world_pts." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cca3971fa5d8850f5245d45b5cd2296e/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-04T15:45:17+08:00" />
<meta property="article:modified_time" content="2023-01-04T15:45:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">1、opencv相机畸变矫正</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>opencv相机畸变矫正</h4> 
 <ul><li><a href="#opencv_1" rel="nofollow">opencv相机畸变矫正</a></li><li><ul><li><a href="#1_C_2" rel="nofollow">1、畸变矫正保存加载 C++</a></li><li><a href="#2_python_116" rel="nofollow">2、畸变矫正保存加载 python</a></li><li><ul><li><a href="#21_117" rel="nofollow">2.1保存矩阵</a></li><li><a href="#21_214" rel="nofollow">2.1直接使用保存的矩阵</a></li></ul> 
   </li><li><a href="#3_255" rel="nofollow">3、效果</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="opencv_1"></a>opencv相机畸变矫正</h2> 
<h3><a id="1_C_2"></a>1、畸变矫正保存加载 C++</h3> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;opencv2\imgproc\types_c.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;opencv2/opencv.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span><span class="token string">&lt;iostream&gt;</span></span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> cv<span class="token punctuation">;</span>
<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

Mat image<span class="token punctuation">,</span> img_gray<span class="token punctuation">;</span>
<span class="token keyword">int</span> BOARDSIZE<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">{<!-- --></span> <span class="token number">8</span><span class="token punctuation">,</span><span class="token number">11</span> <span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token comment">//棋盘格每行每列角点个数</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>Point3f<span class="token operator">&gt;&gt;</span> object_points<span class="token punctuation">;</span><span class="token comment">//保存棋盘格上角点的三维坐标</span>
	vector<span class="token operator">&lt;</span>Point3f<span class="token operator">&gt;</span> obj_world_pts<span class="token punctuation">;</span><span class="token comment">//三维世界坐标</span>
	vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span>Point2f<span class="token operator">&gt;&gt;</span> images_points<span class="token punctuation">;</span><span class="token comment">//保存所有角点</span>
	vector<span class="token operator">&lt;</span>Point2f<span class="token operator">&gt;</span> img_corner_points<span class="token punctuation">;</span><span class="token comment">//保存每张图检测到的角点</span>
	vector<span class="token operator">&lt;</span>String<span class="token operator">&gt;</span> images_path<span class="token punctuation">;</span><span class="token comment">//创建容器存放读取图像路径</span>

	string image_path <span class="token operator">=</span> <span class="token string">"./pic/chess118/*.png"</span><span class="token punctuation">;</span><span class="token comment">//待处理图路径	F:/Works/C++/openCV/opencv study/Revise/Revise/Project1/</span>
	<span class="token comment">//vector&lt;int&gt; point_counts; //每幅图像中的角点的数量</span>

	<span class="token function">glob</span><span class="token punctuation">(</span>image_path<span class="token punctuation">,</span> images_path<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读取指定文件夹下图像</span>

	<span class="token comment">//转世界坐标系</span>
	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> BOARDSIZE<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> BOARDSIZE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span> j<span class="token operator">++</span><span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			obj_world_pts<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span><span class="token function">Point3f</span><span class="token punctuation">(</span>j<span class="token punctuation">,</span> i<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> images_path<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
	<span class="token punctuation">{<!-- --></span>
		image <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span>images_path<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">cvtColor</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> img_gray<span class="token punctuation">,</span> COLOR_BGR2GRAY<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">//检测角点</span>
		<span class="token keyword">bool</span> found_success <span class="token operator">=</span> <span class="token function">findChessboardCorners</span><span class="token punctuation">(</span>img_gray<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span>BOARDSIZE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> BOARDSIZE<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
			img_corner_points<span class="token punctuation">,</span>
			CALIB_CB_ADAPTIVE_THRESH <span class="token operator">|</span> CALIB_CB_FAST_CHECK <span class="token operator">|</span> CALIB_CB_NORMALIZE_IMAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token comment">//显示角点</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>found_success<span class="token punctuation">)</span>
		<span class="token punctuation">{<!-- --></span>
			<span class="token comment">//迭代终止条件</span>
			TermCriteria <span class="token function">criteria</span><span class="token punctuation">(</span>CV_TERMCRIT_EPS <span class="token operator">|</span> CV_TERMCRIT_ITER<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//进一步提取亚像素角点</span>
			<span class="token function">cornerSubPix</span><span class="token punctuation">(</span>img_gray<span class="token punctuation">,</span> img_corner_points<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
				<span class="token function">Size</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> criteria<span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token comment">//绘制角点</span>
			<span class="token function">drawChessboardCorners</span><span class="token punctuation">(</span>image<span class="token punctuation">,</span> <span class="token function">Size</span><span class="token punctuation">(</span>BOARDSIZE<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> BOARDSIZE<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> img_corner_points<span class="token punctuation">,</span>
				found_success<span class="token punctuation">)</span><span class="token punctuation">;</span>

			object_points<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>obj_world_pts<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//从世界坐标系到相机坐标系</span>
			images_points<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>img_corner_points<span class="token punctuation">)</span><span class="token punctuation">;</span>

		<span class="token punctuation">}</span>
		<span class="token comment">//char *output = "image";</span>
		<span class="token keyword">char</span> text<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"image"</span><span class="token punctuation">;</span>
		<span class="token keyword">char</span><span class="token operator">*</span> output <span class="token operator">=</span> text<span class="token punctuation">;</span>
		<span class="token function">imshow</span><span class="token punctuation">(</span>output<span class="token punctuation">,</span> image<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token punctuation">}</span>

	<span class="token comment">/*
	计算内参和畸变系数等
	*/</span>

	Mat cameraMatrix<span class="token punctuation">,</span> distCoeffs<span class="token punctuation">,</span> R<span class="token punctuation">,</span> T<span class="token punctuation">;</span><span class="token comment">//内参矩阵，畸变系数，旋转量，偏移量</span>
	<span class="token function">calibrateCamera</span><span class="token punctuation">(</span>object_points<span class="token punctuation">,</span> images_points<span class="token punctuation">,</span> img_gray<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
		cameraMatrix<span class="token punctuation">,</span> distCoeffs<span class="token punctuation">,</span> R<span class="token punctuation">,</span> T<span class="token punctuation">)</span><span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"cameraMatrix:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> cameraMatrix <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"*****************************"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"distCoeffs:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> distCoeffs <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"*****************************"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Rotation vector:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> R <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>

	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"*****************************"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> <span class="token string">"Translation vector:"</span> <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>
	cout <span class="token operator">&lt;&lt;</span> T <span class="token operator">&lt;&lt;</span> endl<span class="token punctuation">;</span>



	<span class="token comment">///*</span>
	<span class="token comment">//畸变图像校准</span>
	<span class="token comment">//*/</span>
	Mat src<span class="token punctuation">,</span> dst<span class="token punctuation">;</span>
	src <span class="token operator">=</span> <span class="token function">imread</span><span class="token punctuation">(</span><span class="token string">"./pic/chess118/100000.png"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//F:/Works/C++/openCV/opencv study/Revise/image/2.jpg</span>
	<span class="token function">undistort</span><span class="token punctuation">(</span>src<span class="token punctuation">,</span> dst<span class="token punctuation">,</span> cameraMatrix<span class="token punctuation">,</span> distCoeffs<span class="token punctuation">)</span><span class="token punctuation">;</span>

	<span class="token keyword">char</span> texts<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">"image_dst"</span><span class="token punctuation">;</span>
	<span class="token keyword">char</span><span class="token operator">*</span> dst_output <span class="token operator">=</span> texts<span class="token punctuation">;</span>
	<span class="token comment">//char *dst_output = "image_dst";</span>
	<span class="token function">imshow</span><span class="token punctuation">(</span>dst_output<span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">waitKey</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token function">imwrite</span><span class="token punctuation">(</span><span class="token string">"./pic/save/1.png"</span><span class="token punctuation">,</span> dst<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//保存</span>

	<span class="token function">destroyAllWindows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//销毁显示窗口</span>
	<span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"pause"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<h3><a id="2_python_116"></a>2、畸变矫正保存加载 python</h3> 
<h4><a id="21_117"></a>2.1保存矩阵</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> os
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io <span class="token keyword">as</span> scio
<span class="token comment"># 循环中断</span>
criteria <span class="token operator">=</span> <span class="token punctuation">(</span>cv<span class="token punctuation">.</span>TERM_CRITERIA_EPS <span class="token operator">+</span> cv<span class="token punctuation">.</span>TERM_CRITERIA_MAX_ITER<span class="token punctuation">,</span> <span class="token number">30</span><span class="token punctuation">,</span> <span class="token number">0.001</span><span class="token punctuation">)</span>

<span class="token comment"># 标定板交叉点的个数</span>
row <span class="token operator">=</span> <span class="token number">8</span>
column <span class="token operator">=</span> <span class="token number">11</span>
objp <span class="token operator">=</span> np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span>row <span class="token operator">*</span> column<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>float32<span class="token punctuation">)</span>
objp<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> np<span class="token punctuation">.</span>mgrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span>row<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">:</span>column<span class="token punctuation">]</span><span class="token punctuation">.</span>T<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
objp<span class="token operator">=</span>objp<span class="token operator">*</span><span class="token number">0.02</span>
objpoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 实际空间3D点</span>
imgpoints <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>  <span class="token comment"># 图像中2D点</span>

<span class="token comment"># 批量读取图片</span>
images <span class="token operator">=</span> glob<span class="token punctuation">.</span>glob<span class="token punctuation">(</span><span class="token string">'./pic/chess118/*.png'</span><span class="token punctuation">)</span>  <span class="token comment"># .jpg应该改为.png</span>
<span class="token comment"># images = glob.glob('./pic/chess68/*.jpg')  # .jpg应该改为.png</span>
i<span class="token operator">=</span><span class="token number">0</span>
<span class="token keyword">for</span> fname <span class="token keyword">in</span> images<span class="token punctuation">:</span>
    img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>
    gray <span class="token operator">=</span> cv<span class="token punctuation">.</span>cvtColor<span class="token punctuation">(</span>img<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>COLOR_BGR2GRAY<span class="token punctuation">)</span>

    <span class="token comment"># 找标定板角点</span>
    ret<span class="token punctuation">,</span> corners <span class="token operator">=</span> cv<span class="token punctuation">.</span>findChessboardCorners<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> <span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

    <span class="token keyword">if</span> ret <span class="token operator">==</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
        objpoints<span class="token punctuation">.</span>append<span class="token punctuation">(</span>objp<span class="token punctuation">)</span>

        corners2 <span class="token operator">=</span> cv<span class="token punctuation">.</span>cornerSubPix<span class="token punctuation">(</span>gray<span class="token punctuation">,</span> corners<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> criteria<span class="token punctuation">)</span>
        imgpoints<span class="token punctuation">.</span>append<span class="token punctuation">(</span>corners2<span class="token punctuation">)</span>

        cv<span class="token punctuation">.</span>drawChessboardCorners<span class="token punctuation">(</span>img<span class="token punctuation">,</span> <span class="token punctuation">(</span>row<span class="token punctuation">,</span> column<span class="token punctuation">)</span><span class="token punctuation">,</span> corners<span class="token punctuation">,</span> ret<span class="token punctuation">)</span>
        i <span class="token operator">+=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        <span class="token comment"># cv.imwrite('./pic/corners/conimg' + str(i) + '.jpg', img)</span>
        cv<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span><span class="token string">'img'</span><span class="token punctuation">,</span> img<span class="token punctuation">)</span>
        cv<span class="token punctuation">.</span>waitKey<span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span>
cv<span class="token punctuation">.</span>destroyAllWindows<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># 标定相机</span>
ret<span class="token punctuation">,</span> Matrix<span class="token punctuation">,</span> dist<span class="token punctuation">,</span> rvecs<span class="token punctuation">,</span> tvecs <span class="token operator">=</span> cv<span class="token punctuation">.</span>calibrateCamera<span class="token punctuation">(</span>objpoints<span class="token punctuation">,</span> imgpoints<span class="token punctuation">,</span> gray<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">)</span>

<span class="token comment">#对文件夹下的图片进行矫正并保存到save目录下</span>
datadir <span class="token operator">=</span> <span class="token string">"./pic/chess118/"</span>

path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>datadir<span class="token punctuation">)</span>
img_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> img_list<span class="token punctuation">:</span>
    img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    h<span class="token punctuation">,</span> w <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
    newMatrix<span class="token punctuation">,</span> roi <span class="token operator">=</span> cv<span class="token punctuation">.</span>getOptimalNewCameraMatrix<span class="token punctuation">(</span>Matrix<span class="token punctuation">,</span> dist<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 矫正图像</span>

    dst <span class="token operator">=</span> cv<span class="token punctuation">.</span>undistort<span class="token punctuation">(</span>img<span class="token punctuation">,</span> Matrix<span class="token punctuation">,</span> dist<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> newMatrix<span class="token punctuation">)</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> roi
    dst <span class="token operator">=</span> dst<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span>
    cv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'./pic/save/'</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>

<span class="token comment"># 计算重投影误差</span>
tot_error <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token builtin">len</span><span class="token punctuation">(</span>objpoints<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    imgpoints2<span class="token punctuation">,</span> _ <span class="token operator">=</span> cv<span class="token punctuation">.</span>projectPoints<span class="token punctuation">(</span>objpoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> rvecs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> tvecs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> Matrix<span class="token punctuation">,</span> dist<span class="token punctuation">)</span>
    error <span class="token operator">=</span> cv<span class="token punctuation">.</span>norm<span class="token punctuation">(</span>imgpoints<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> imgpoints2<span class="token punctuation">,</span> cv<span class="token punctuation">.</span>NORM_L2<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>imgpoints2<span class="token punctuation">)</span>
    tot_error <span class="token operator">+=</span> error

<span class="token comment">#保存矫正的内参和畸变参数，以供下次使用</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------------保存内参和畸变参数-------------------"</span><span class="token punctuation">)</span>
<span class="token comment">#读取矩阵</span>
dataFile1 <span class="token operator">=</span> <span class="token string">'./neican.mat'</span>
dataFile2<span class="token operator">=</span><span class="token string">'./jican.mat'</span>
scio<span class="token punctuation">.</span>savemat<span class="token punctuation">(</span>dataFile1<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'train'</span><span class="token punctuation">:</span>Matrix<span class="token punctuation">}</span><span class="token punctuation">)</span>
scio<span class="token punctuation">.</span>savemat<span class="token punctuation">(</span>dataFile2<span class="token punctuation">,</span> <span class="token punctuation">{<!-- --></span><span class="token string">'train'</span><span class="token punctuation">:</span>dist<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># #读取保存矩阵，矩阵的名字为train.mat</span>
<span class="token comment"># data = scio.loadmat(dataFile1)</span>
<span class="token comment"># data2 = scio.loadmat(dataFile2)</span>
<span class="token comment"># neican = data['train']</span>
<span class="token comment"># jican = data2['train']</span>
<span class="token comment"># print("内参:\n", neican)  # 内参数矩阵</span>
<span class="token comment"># print("畸参：\n",jican)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------保存完成----------------------------"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------------各个校准参数-------------------"</span><span class="token punctuation">)</span>
<span class="token comment"># 输出参数</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ret:\n'</span><span class="token punctuation">,</span> ret<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'mtx:\n'</span><span class="token punctuation">,</span> Matrix<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'dist:\n'</span><span class="token punctuation">,</span> dist<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'rvecs:\n'</span><span class="token punctuation">,</span> rvecs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'tvecs:\n'</span><span class="token punctuation">,</span> tvecs<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"total error: "</span><span class="token punctuation">,</span> tot_error <span class="token operator">/</span> <span class="token builtin">len</span><span class="token punctuation">(</span>objpoints<span class="token punctuation">)</span><span class="token punctuation">)</span>

</code></pre> 
<h4><a id="21_214"></a>2.1直接使用保存的矩阵</h4> 
<pre><code class="prism language-python"><span class="token keyword">import</span> cv2 <span class="token keyword">as</span> cv
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token keyword">import</span> glob
<span class="token keyword">import</span> os
<span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io <span class="token keyword">as</span> scio
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------------从文件加载内参和畸变参数-------------------"</span><span class="token punctuation">)</span>
<span class="token comment">#读取矩阵</span>
dataFile1 <span class="token operator">=</span> <span class="token string">'./neican.mat'</span>  
dataFile2<span class="token operator">=</span><span class="token string">'./jican.mat'</span>
data <span class="token operator">=</span> scio<span class="token punctuation">.</span>loadmat<span class="token punctuation">(</span>dataFile1<span class="token punctuation">)</span>
data2 <span class="token operator">=</span> scio<span class="token punctuation">.</span>loadmat<span class="token punctuation">(</span>dataFile2<span class="token punctuation">)</span>
Matrix <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">]</span>
dist <span class="token operator">=</span> data2<span class="token punctuation">[</span><span class="token string">'train'</span><span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"内参:\n"</span><span class="token punctuation">,</span> Matrix<span class="token punctuation">)</span>  <span class="token comment"># 内参数矩阵</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"畸参：\n"</span><span class="token punctuation">,</span>dist<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------加载完成----------------------------"</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------用内参和畸参对图片进行矫正----------------------------"</span><span class="token punctuation">)</span>

<span class="token comment">#对文件夹下的图片进行矫正并保存到save目录下</span>
datadir <span class="token operator">=</span> <span class="token string">"./pic/chess118/"</span>

path <span class="token operator">=</span> os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>datadir<span class="token punctuation">)</span>
img_list <span class="token operator">=</span> os<span class="token punctuation">.</span>listdir<span class="token punctuation">(</span>path<span class="token punctuation">)</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> img_list<span class="token punctuation">:</span>
    img <span class="token operator">=</span> cv<span class="token punctuation">.</span>imread<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>join<span class="token punctuation">(</span>path<span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    h<span class="token punctuation">,</span> w <span class="token operator">=</span> img<span class="token punctuation">.</span>shape<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>
    newMatrix<span class="token punctuation">,</span> roi <span class="token operator">=</span> cv<span class="token punctuation">.</span>getOptimalNewCameraMatrix<span class="token punctuation">(</span>Matrix<span class="token punctuation">,</span> dist<span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>w<span class="token punctuation">,</span> h<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 矫正图像</span>

    dst <span class="token operator">=</span> cv<span class="token punctuation">.</span>undistort<span class="token punctuation">(</span>img<span class="token punctuation">,</span> Matrix<span class="token punctuation">,</span> dist<span class="token punctuation">,</span> <span class="token boolean">None</span><span class="token punctuation">,</span> newMatrix<span class="token punctuation">)</span>
    x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> w<span class="token punctuation">,</span> h <span class="token operator">=</span> roi
    dst <span class="token operator">=</span> dst<span class="token punctuation">[</span>y<span class="token punctuation">:</span>y <span class="token operator">+</span> h<span class="token punctuation">,</span> x<span class="token punctuation">:</span>x <span class="token operator">+</span> w<span class="token punctuation">]</span>
    cv<span class="token punctuation">.</span>imwrite<span class="token punctuation">(</span><span class="token string">'./pic/save/'</span> <span class="token operator">+</span> i<span class="token punctuation">,</span> dst<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"------------矫正完成，矫正后的图片保存在save文件夹----------------------------"</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="3_255"></a>3、效果</h3> 
<p><img src="https://images2.imgbox.com/c1/62/mufuMHgo_o.jpg" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e83639a4325e19ca052bc6fe07dd2419/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">黑马Hive&#43;Spark离线数仓工业项目--项目总结</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/07b5224e81c79e8a5c50ecd47b7d860b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Pytorch调用GPU训练两种方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>