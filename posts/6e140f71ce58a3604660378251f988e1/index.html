<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>使用 docker-compose 部署 SpringBoot 项目 &amp; nginx 部署前端 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="使用 docker-compose 部署 SpringBoot 项目 &amp; nginx 部署前端" />
<meta property="og:description" content="安装 Docker 自动下载 curl -fsSL https://get.docker.com | bash -s docker --mirror Aliyun 检查是否安装成功
docker -v 配置镜像仓库 更换镜像加速器（推荐阿里云）
容器镜像服务 (aliyun.com)
扫码登录后找到镜像仓库
每个人都不同，复制自己的镜像仓库
复制好上面的地址后，编辑到 daemon.json 中
vi /etc/docker/daemon.json 按ESC ，使用 :wq 保存
启动 docker systemctl start docker 安装 docker-compose 安装命令行 curl -L https://github.com/docker/compose/releases/download/1.22.0/docker-compose-`uname -s`-`uname -m` -o /usr/local/bin/docker-compose 设置文件权限 chmod &#43;x /usr/local/bin/docker-compose 查看版本 docker-compose -v 编写 Dockerfile Dockerfile 可以将我们的项目打包好的 jar 包转换为镜像
这里我将 dockerfile 以及 docker-compose 放在了项目包中，这里位置可随意，最后要上传到服务器上的
文件内容 Dockerfile 的文件内容为
# 设置jdk版本 FROM java:8 # 设置我们的个人信息，大家根据需求随便写 MAINTAINER daqi &lt;daqi_email@163." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6e140f71ce58a3604660378251f988e1/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-31T14:49:17+08:00" />
<meta property="article:modified_time" content="2023-10-31T14:49:17+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">使用 docker-compose 部署 SpringBoot 项目 &amp; nginx 部署前端</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_Docker_0"></a>安装 Docker</h2> 
<h3><a id="_2"></a>自动下载</h3> 
<pre><code class="prism language-shell"><span class="token function">curl</span> <span class="token parameter variable">-fsSL</span> https://get.docker.com <span class="token operator">|</span> <span class="token function">bash</span> <span class="token parameter variable">-s</span> <span class="token function">docker</span> <span class="token parameter variable">--mirror</span> Aliyun
</code></pre> 
<p>检查是否安装成功</p> 
<pre><code class="prism language-shell"><span class="token function">docker</span> <span class="token parameter variable">-v</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/bc/9d/Mbk01Vsg_o.png" alt="image-20231031135739923"></p> 
<h3><a id="_16"></a>配置镜像仓库</h3> 
<p>更换镜像加速器（推荐阿里云）</p> 
<p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors" rel="nofollow">容器镜像服务 (aliyun.com)</a></p> 
<p>扫码登录后找到镜像仓库</p> 
<blockquote> 
 <p>每个人都不同，复制自己的镜像仓库</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/8b/7b/Zkg3TNX4_o.png" alt="image-20230618171351652"></p> 
<p>复制好上面的地址后，编辑到 daemon.json 中</p> 
<pre><code class="prism language-shell"><span class="token function">vi</span> /etc/docker/daemon.json
</code></pre> 
<p><img src="https://images2.imgbox.com/b9/94/KBAQIbOz_o.png" alt="image-20231031140340869"></p> 
<p>按<code>ESC</code> ，使用 <code>:wq</code> 保存</p> 
<h3><a id="_docker_38"></a>启动 docker</h3> 
<pre><code class="prism language-shell">systemctl start <span class="token function">docker</span>
</code></pre> 
<h2><a id="_dockercompose_44"></a>安装 docker-compose</h2> 
<h3><a id="_46"></a>安装命令行</h3> 
<pre><code class="prism language-shell"><span class="token function">curl</span> <span class="token parameter variable">-L</span> https://github.com/docker/compose/releases/download/1.22.0/docker-compose-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-s</span><span class="token variable">`</span></span>-<span class="token variable"><span class="token variable">`</span><span class="token function">uname</span> <span class="token parameter variable">-m</span><span class="token variable">`</span></span> <span class="token parameter variable">-o</span> /usr/local/bin/docker-compose
</code></pre> 
<h3><a id="_52"></a>设置文件权限</h3> 
<pre><code class="prism language-shell"><span class="token function">chmod</span> +x /usr/local/bin/docker-compose
</code></pre> 
<h3><a id="_58"></a>查看版本</h3> 
<pre><code class="prism language-shell"><span class="token function">docker-compose</span> <span class="token parameter variable">-v</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/a8/f4/h15gWiAC_o.png" alt="image-20231031140815313"></p> 
<h2><a id="_Dockerfile_66"></a>编写 Dockerfile</h2> 
<p>Dockerfile 可以将我们的项目打包好的 <code>jar</code> 包转换为镜像</p> 
<blockquote> 
 <p>这里我将 dockerfile 以及 docker-compose 放在了项目包中，这里位置可随意，最后要上传到服务器上的</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/72/6e/CGFArgPt_o.png" alt="image-20231031141103201"></p> 
<h3><a id="_74"></a>文件内容</h3> 
<p>Dockerfile 的文件内容为</p> 
<pre><code class="prism language-dockerfile"># 设置jdk版本
FROM java:8

# 设置我们的个人信息，大家根据需求随便写
MAINTAINER daqi &lt;daqi_email@163.com&gt;

# 这两行是设置我们容器内的时间以及 jvm 的时间(默认不是 GMT )
RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
RUN echo "Asia/Shanghai" &gt; /etc/timezone

# 前面的 【Esurvey-backend-1.1.jar】 是我们上传的 jar 包名称(在 target 目录中打包的 jar 包)，后面的【springboot.jar】是我们新命名的 jar 包
ADD Esurvey-backend-1.1.jar springboot.jar

# 镜像启动成为容器后，对外暴露的端口
EXPOSE 9996

# Image创建容器时的初始化内存，最大内存，及启动时使用的profile. -c为清除以前启动的数据
ENTRYPOINT ["java","-Xms1024m","-Xmx1024m","-jar","/springboot.jar","--spring.profiles.active=prod","-c"]
</code></pre> 
<p>说明：</p> 
<p>**FROM java:8：**这是一个 FROM 指令，指定基础镜像为 java:8，也就是包含 Java 8 环境的镜像</p> 
<p>**MAINTAINER daqi daqi_email@163.com：**这是一个 MAINTAINER 指令，指定镜像的作者和联系方式</p> 
<p>**RUN /bin/cp /usr/share/zoneinfo/Asia/Shanghai /etc/localtime：**这是一个 RUN 指令，执行一个命令，并将结果保存到镜像中。这个命令是将亚洲/上海时区文件复制到 /etc/localtime 文件中，设置容器内的时区为亚洲/上海</p> 
<p>**ADD Esurvey-backend-1.1.jar springboot.jar：**这是一个 ADD 指令，将本地或远程文件或目录复制到镜像中。这个命令是将 Esurvey-backend-1.1.jar 文件复制到镜像中，并重命名为springboot.jar。如果只需要复制本地文件或目录，建议使用 COPY 指令代替 ADD 指令</p> 
<p>**EXPOSE 9996：**这是一个 EXPOSE 指令，声明容器运行时监听的端口。这个指令不会实际开放端口，只是一种文档化的作用，需要在运行容器时使用 -p 或 -P 参数来映射端口。这个命令是声明容器监听9996端口</p> 
<p>**ENTRYPOINT [“java”,“-Xms1024m”,“-Xmx1024m”,“-jar”,“/springboot.jar”,“–spring.profiles.active=prod”,“-c”]：**这是一个 ENTRYPOINT 指令，定义容器启动时运行的可执行程序和参数。这个指令可以与 CMD 指令配合使用，CMD 指令中的参数会追加到 ENTRYPOINT 指令中。这个命令是定义容器启动时运行 java 程序，并设置内存、jar 包和 profile 等参数。</p> 
<h2><a id="_dockercompose__113"></a>编写 docker-compose 文件</h2> 
<h3><a id="_115"></a>介绍</h3> 
<p>Docker Compose 是一个用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 YAML 文件来配置应用程序需要的所有服务，然后使用一个命令就可以创建并启动所有服务。Docker Compose 可以帮助您简化容器的管理，实现服务的快速部署、扩展和升级</p> 
<p>Docker Compose 的主要作用有以下几点：</p> 
<ul><li>一次性创建和启动多个容器，实现应用程序的多服务协作</li><li>使用 YAML 文件来定义服务的配置，避免重复输入命令行参数</li><li>通过项目名来隔离不同的应用环境，避免容器、网络和卷之间的冲突</li><li>提供了一系列命令来管理容器的生命周期，如构建、启动、停止、重启、销毁等</li><li>支持使用变量和模板来参数化和复用配置文件</li></ul> 
<h3><a id="_127"></a>文件内容</h3> 
<blockquote> 
 <p>找一个地方创建文件 <code>docker-compose.yml</code></p> 
</blockquote> 
<pre><code class="prism language-yml"><span class="token comment"># 指定我们docker-compose的版本</span>
<span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"3"</span>

<span class="token comment"># 设置我们的服务</span>
<span class="token key atrule">services</span><span class="token punctuation">:</span>

  <span class="token comment"># 配置mysql服务</span>
  <span class="token key atrule">mysql</span><span class="token punctuation">:</span>

    <span class="token comment"># 这里指定 mysql 镜像文件，mysql 版本是 8.0.27，这里要使用 docker 命令拉取镜像</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>8.0.27

    <span class="token comment"># 配置容器名字</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> esurvey<span class="token punctuation">-</span>mysql

    <span class="token comment"># 通过我们的宿主机的 9995 端口映射到容器里的 3306 端口，因为容器内的网络与我们外界是不互通的，只有宿主机能够去访问我们的容器，这样我们就能通过宿主机的 9995 端口去访问容器的 mysql了</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9995:3306"</span>

    <span class="token comment"># 配置环境，主要是配置我们的mysql的登陆密码，mysql容器创建出来默认可以用不同的ip地址访问，所以这里不用进行配置</span>
    <span class="token key atrule">environment</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> MYSQL_ROOT_PASSWORD=mysql2023

    <span class="token comment"># 配置挂载的文件夹，在当前文件夹下面创建 mysql 文件夹，里面有 conf，logs，data，分别挂载到容器mysql 中的 conf.d，logs，mysql 中，这样当我们的容器如果没了，但是我们的数据还是在的</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./mysql/conf<span class="token punctuation">:</span>/etc/mysql/conf.d
      <span class="token punctuation">-</span> ./mysql/logs<span class="token punctuation">:</span>/logs
      <span class="token punctuation">-</span> ./mysql/data<span class="token punctuation">:</span>/var/lib/mysql

  <span class="token comment"># 配置 redis 服务</span>
  <span class="token key atrule">redis</span><span class="token punctuation">:</span>

    <span class="token comment"># 设置容器对应的镜像，同上</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> redis<span class="token punctuation">:</span>6.2.7

    <span class="token comment"># 设置容器名</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> esurvey<span class="token punctuation">-</span>redis

    <span class="token comment"># 设置命令，这里是用来设置我们的redis登陆密码的，root处是密码，自己根据需求填入即可</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span> redis<span class="token punctuation">-</span>server <span class="token punctuation">-</span><span class="token punctuation">-</span>requirepass redis2023

    <span class="token comment"># 同上，作为端口映射</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9994:6379"</span>

    <span class="token comment"># 同上，挂载文件夹</span>
    <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> ./redis<span class="token punctuation">:</span>/data

  <span class="token comment"># 配置springboot服务</span>
  <span class="token key atrule">springboot</span><span class="token punctuation">:</span>
    <span class="token comment"># 生成镜像，用.它会自动去当前目录下面去找一个Dockerfile的文件，然后根据里面的配置去生成一个镜像</span>
    <span class="token key atrule">build</span><span class="token punctuation">:</span> .

    <span class="token comment"># 指定我们生成的镜像的名字和版本号</span>
    <span class="token key atrule">image</span><span class="token punctuation">:</span> springboot<span class="token punctuation">:</span>v1.1

    <span class="token comment"># 指定容器名</span>
    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> Esurvey<span class="token punctuation">-</span>backend

    <span class="token comment"># 同上，做端口映射</span>
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token string">"9996:9996"</span>

    <span class="token comment"># 写清楚我们springboot依赖的服务，有 mysql 以及 redis，这里的名称是 service 名</span>
    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> mysql
      <span class="token punctuation">-</span> redis
</code></pre> 
<h2><a id="_applicationprodyml_202"></a>修改 application-prod.yml</h2> 
<p>项目中使用了 <code>spring.profiles.active</code> 控制项目环境，这里修改 <code>application-prod.yml</code> 生成环境上的一些连接配置</p> 
<ol><li>修改 mysql 的 url，改为服务器 ip:端口</li><li>同理 redis 的 host 也改为 ip，同时端口也要和上面 docker-compose.yml 配置的一样</li></ol> 
<blockquote> 
 <p>注：可以试一下 msyql:9995 以及 redis:9994 的访问方式，我没有访问成功，可能是 不在同一个 network 的原因，大家也可以试一下</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/93/ad/IGaOp5qB_o.png" alt="image-20231031142742762"></p> 
<h2><a id="_dockercompose__213"></a>使用 docker-compose 运行容器</h2> 
<p>使用 xhell 连接服务器（也可以使用其他的远程连接），将打包好的 jar 包，Dockerfile，docker-compose 放在文件夹中</p> 
<p>以我为例，我统一放在了 <code>/home/server/Esurvey/Esurvey-backend</code> 下，目录结构如下</p> 
<p><img src="https://images2.imgbox.com/bf/95/eeNxm4oH_o.png" alt="image-20231031143302680"></p> 
<p>redis 和 mysql 文件是在运行容器后产生的，是映射容器中的数据卷</p> 
<p>进入到当前的目录</p> 
<p><img src="https://images2.imgbox.com/d2/86/jzigbooC_o.png" alt="image-20231031143558846"></p> 
<p>运行</p> 
<pre><code class="prism language-shell"><span class="token function">docker-compose</span> up <span class="token parameter variable">-d</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/44/0e/XT2cvheT_o.png" alt="image-20231031143629359"></p> 
<p>这样后端 java 项目就运行成功了</p> 
<h2><a id="_Nginx__237"></a>前端项目 Nginx 部署</h2> 
<h3><a id="_239"></a>上传文件</h3> 
<p>同样，将打包好的文件上传到服务器</p> 
<p>以我为例，我传到了 <code>/home/server/Esurvey/Esurvey-app</code></p> 
<p><img src="https://images2.imgbox.com/04/26/6mH73bIK_o.png" alt="image-20231031143956291"></p> 
<blockquote> 
 <p>注意，将前端项目中的请求前缀去掉，我们是通过 nginx 反向代理访问的</p> 
</blockquote> 
<h3><a id="_Nginx_249"></a>安装 Nginx</h3> 
<blockquote> 
 <p>这里如何用命令行安装就不赘述了</p> 
</blockquote> 
<p>我使用宝塔安装 nginx，在软件商城中安装</p> 
<h3><a id="_255"></a>配置文件修改</h3> 
<p>文件中修改 <code>http</code> 下的内容</p> 
<blockquote> 
 <p>注意 server 的位置，在 http 中的，这里监听了 9998 端口，首页文件是 index.html，文件路径是上传路径</p> 
</blockquote> 
<p><code>location ^~ /api/</code> 是匹配 /api/ 路径然后代理成 http://127.0.0.1:9996/api/，这个地址是后端的地址</p> 
<pre><code class="prism language-yml">server <span class="token punctuation">{<!-- --></span>
  listen 9998;
  server_name xxxx.top;
  index index.html;
  root  /home/server/Esurvey/Esurvey<span class="token punctuation">-</span>app;
  
  location ^~ /api/ <span class="token punctuation">{<!-- --></span>
    proxy_pass http<span class="token punctuation">:</span>//127.0.0.1<span class="token punctuation">:</span>9996/api/;
    add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin' $http_origin;
    add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Credentials' 'true';
    add_header Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Methods 'GET<span class="token punctuation">,</span> POST<span class="token punctuation">,</span> OPTIONS';
    add_header Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Headers '<span class="token important">*';</span>
    	if ($request_method = 'OPTIONS') <span class="token punctuation">{<!-- --></span>
        add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Credentials' 'true';
        add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Origin' $http_origin;
        add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Methods' 'GET<span class="token punctuation">,</span> POST<span class="token punctuation">,</span> OPTIONS';
        add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Allow<span class="token punctuation">-</span>Headers' 'DNT<span class="token punctuation">,</span>User<span class="token punctuation">-</span>Agent<span class="token punctuation">,</span>X<span class="token punctuation">-</span>Requested<span class="token punctuation">-</span>With<span class="token punctuation">,</span>If<span class="token punctuation">-</span>Modified<span class="token punctuation">-</span>Since<span class="token punctuation">,</span>Cache<span class="token punctuation">-</span>Control<span class="token punctuation">,</span>Content<span class="token punctuation">-</span>Type<span class="token punctuation">,</span>Range';
        add_header 'Access<span class="token punctuation">-</span>Control<span class="token punctuation">-</span>Max<span class="token punctuation">-</span>Age' 1728000;
        add_header 'Content<span class="token punctuation">-</span>Type' 'text/plain; charset=utf<span class="token punctuation">-</span>8';
        add_header 'Content<span class="token punctuation">-</span>Length' 0;
        return 204;
    	<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>重载 nginx，配置就生效了，页面也就可以访问了</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/75d5ad5ce8a5957dbd6340f58d13552e/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">记一次提高依赖PCL的C&#43;&#43;代码编译速度的经历</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/56c1d96bc890d94411302486bc380e07/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">激光雷达点云基础-点云滤波算法与点云配准算法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>