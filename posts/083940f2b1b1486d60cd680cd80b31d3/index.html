<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>oracle计算数据环比sql,用分析函数计算环比、同比oracle - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="oracle计算数据环比sql,用分析函数计算环比、同比oracle" />
<meta property="og:description" content="1.普及一下概念
环比 = 2018年10月/2018年09月(同一时期内不同时间段的比较)
同比 = 2018年10月/2017年10月(不同时期内相同时间段的比较)
环比增长率 = (2018年10月-2018年09月)/2018年09月
同比增长率 = (2018年10月-2017年10月)/2017年10月
2.关键sql 解释
(1)分析函数
lead(params,m,n) 以params为目标向下m位取数，当取不到时默认为 n,
lag(params,m,n) 以params为目标向上m位取数，当取不到时默认为 n
over(order by...) 相当于 order by...
partition by ... 根据参数最为分割，将相同的先分割到一块
3.具体sql例子
//按月统计发票的总金额、总税额、总票数、月同比、月环比 、同比增长率、环比增长率
select a.sumquantity,
nvl(round(a.sumquantity /lag(a.sumquantity) over( order by a.yearmonth)*100, 2), &#39;0&#39;) ||&#39;%&#39; sumquantityHB,
nvl(round((a.sumquantity-a.lagAHB)/lag(a.sumquantity) over( order by a.yearmonth)*100, 2), &#39;0&#39;) ||&#39;%&#39; sumquantityHBG,//计算环比(按月) 关键代码lag()over(partition by 月份/年份 order by 排序条件)
nvl(round(a.sumquantity/lag(a.sumquantity) over(partition by to_char((to_date(a.yearmonth, &#39;yyyy/MM&#39;)), &#39;MM&#39;) order by a." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/083940f2b1b1486d60cd680cd80b31d3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-04-02T21:55:23+08:00" />
<meta property="article:modified_time" content="2021-04-02T21:55:23+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">oracle计算数据环比sql,用分析函数计算环比、同比oracle</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>1.普及一下概念</p> 
 <p>环比 = 2018年10月/2018年09月(同一时期内不同时间段的比较)</p> 
 <p>同比 = 2018年10月/2017年10月(不同时期内相同时间段的比较)</p> 
 <p>环比增长率 =  (2018年10月-2018年09月)/2018年09月</p> 
 <p>同比增长率 =  (2018年10月-2017年10月)/2017年10月</p> 
 <p>2.关键sql 解释</p> 
 <p>(1)分析函数</p> 
 <p>lead(params,m,n)  以params为目标向下m位取数，当取不到时默认为 n,</p> 
 <p>lag(params,m,n)  以params为目标向上m位取数，当取不到时默认为 n</p> 
 <p>over(order by...) 相当于 order by...</p> 
 <p>partition by ... 根据参数最为分割，将相同的先分割到一块</p> 
 <p>3.具体sql例子</p> 
 <p>//按月统计发票的总金额、总税额、总票数、月同比、月环比 、同比增长率、环比增长率</p> 
 <p>select  a.sumquantity,</p> 
 <p>nvl(round(a.sumquantity /lag(a.sumquantity) over( order by a.yearmonth)*100, 2), '0') ||'%' sumquantityHB,</p> 
 <p>nvl(round((a.sumquantity-a.lagAHB)/lag(a.sumquantity) over( order by a.yearmonth)*100, 2), '0') ||'%' sumquantityHBG,//计算环比(按月) 关键代码lag()over(partition by 月份/年份 order by 排序条件)</p> 
 <p>nvl(round(a.sumquantity/lag(a.sumquantity) over(partition  by to_char((to_date(a.yearmonth, 'yyyy/MM')), 'MM')  order by a.yearmonth)*100, 2), '0')||'%' sumquantityTB,</p> 
 <p>nvl(round((a.sumquantity-a.lagATB)/lag(a.sumquantity) over(partition  by to_char((to_date(a.yearmonth, 'yyyy/MM')), 'MM')  order by a.yearmonth)*100, 2), '0') ||'%' sumquantityTBG,</p> 
 <p>a.totalamount,</p> 
 <p>nvl(round(a.totalamount/lag(a.totalamount) over( order by a.yearmonth)*100, 2), '0')||'%' totalamountHB,</p> 
 <p>nvl(round((a.totalamount-a.lagBHB)/lag(a.totalamount) over( order by a.yearmonth)*100, 2), '0') || '%' totalamountHBG,</p> 
 <p>nvl(round(a.totalamount/lag(a.totalamount) over(partition  by to_char((to_date(a.yearmonth, 'yyyy/MM')), 'MM')  order by a.yearmonth)*100, 2), '0')||'%' totalamountTB,</p> 
 <p>nvl(round((a.totalamount-a.lagBTB)/lag(a.totalamount) over(partition  by to_char((to_date(a.yearmonth, 'yyyy/MM')), 'MM')  order by a.yearmonth)*100, 2), '0')||'%' totalamountTB,</p> 
 <p>a.taxamount ,</p> 
 <p>nvl(round(a.taxamount/lag(a.taxamount) over( order by a.yearmonth)*100, 2), '0')||'%' taxamountHB,</p> 
 <p>nvl(round((a.taxamount-a.lagCHB)/lag(a.taxamount) over( order by a.yearmonth)*100, 2), '0')||'%' taxamountHBG,</p> 
 <p>nvl(round(a.taxamount/lag(a.taxamount) over(partition  by to_char((to_date(a.yearmonth, 'yyyy/MM')), 'MM')  order by a.yearmonth)*100, 2), '0')||'%' taxamountTB,</p> 
 <p>nvl(round((a.taxamount-a.lagCTB)/lag(a.taxamount) over(partition by to_char((to_date(a.yearmonth,'yyyy/MM')),'MM') order bya.yearmonth)*100,2),'0')||'%' taxamountTBG</p> 
 <p>from</p> 
 <p>( select yearMonth, sumQuantity, lag(sumQuantity) over( order by yearmonth) lagAHB ,</p> 
 <p>lag(sumQuantity) over(partition  by to_char((to_date( yearmonth, 'yyyy/MM')), 'MM')  order by yearmonth) lagATB,</p> 
 <p>totalAmount, lag(totalAmount) over(order by yearmonth) lagBHB,</p> 
 <p>lag(totalAmount) over(partition  by to_char((to_date( yearmonth, 'yyyy/MM')), 'MM')  order by yearmonth) lagBTB,</p> 
 <p>taxAmount , lag(taxAmount) over(partition  by to_char((to_date( yearmonth, 'yyyy/MM')), 'MM')  order by yearmonth) lagCTB,</p> 
 <p>lag(taxAmount) over( order by yearmonth) lagCHB //计算环比(按月) 关键代码lag()over(partition by 月份/年份 order by 排序条件)</p> 
 <p>from</p> 
 <p>(select to_char(billing_date, 'yyyy/MM') yearMonth, count(1) sumQuantity , nvl(sum(total_amount) , 0.00) totalAmount, nvl(sum(total_tax) , 0.00) taxAmount</p> 
 <p>from input_original_account</p> 
 <p>where 1=1  group by to_char(billing_date, 'yyyy/MM'))//先按月份对要统计的数据进项分组</p> 
 <p>) a</p> 
 <p>where 1=1 and a.yearMonth='2018/09'</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/386ad075f2e435ab266354b145815abb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">matlab怎么改变程序字体大小,matlab怎么把程序字体变大</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4740229c6bf3c8bb15ac1974f50a1dfa/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">nodemcu使用mqtt连接onenet</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>