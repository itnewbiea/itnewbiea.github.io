<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>计算机视觉-SIFT特征提取及匹配 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="计算机视觉-SIFT特征提取及匹配" />
<meta property="og:description" content="文章目录 1、SIFT描述子介绍1.1 SIFT描述子定义1.2 SIFT特征1.3 SIFT检测过程1.4算法介绍 2、数据集准备3、图片的SIFT特征提取并展示特征点3.1 代码实现3.2 结果展示3.3 实验分析 4、特征匹配4.1代码实现4.2结果展示4.3实验结果 5、图像匹配5.1代码实现5.2结果展示5.3 实验结果 6、数据集匹配6.1代码实现6.2结果展示6.3实验结果 7、RANSAC算法去除误匹配7.1RANSAC算法原理7.2RANSAC算法步骤7.3RANSAC实现7.3.1景深丰富7.3.2景深单一 7.4 实验结果分析 8、实验问题及总结 1、SIFT描述子介绍 1.1 SIFT描述子定义 SIFT的全称是Scale Invariant Feature Transform，尺度不变特征变换，由加拿大教授David G.Lowe提出的。SIFT特征对旋转、尺度缩放、亮度变化等保持不变性，是一种非常稳定的局部特征。
1.2 SIFT特征 1、图像的局部特征，对旋转、尺度缩放、亮度变化保持不变，对视角变化、仿射变换、噪声也保持一定程度的稳定性。
2、独特性好，信息量丰富，适用于海量特征库进行快速、准确的匹配。
3、 多量性，即使是很少几个物体也可以产生大量的SIFT特征
4、高速性，经优化的SIFT匹配算法甚至可以达到实时性
5、 扩招性，可以很方便的与其他的特征向量进行联合。
1.3 SIFT检测过程 1.构造高斯差分空间图像。
2.寻找极大极小值点
3.精确定位极值点
4.选取特征点主方向
5. 构造特征点描述算子。
1.4算法介绍 1.尺度空间极值检测——即找特征点
对于二维图像I(x，y)，建立图像的DOG （difference of guassians，即高斯差分）金字塔，DOG尺度空间含义为：可以用一个尺度空间的高斯函数和图像的卷积来表示。
G为尺度可变的高斯函数，***I***为空间坐标，其中西伽马为尺度。
为确定特征点所在的位置，首先需要建立一个高斯金字塔。
得到高斯金字塔后，再通过两个相邻的高斯尺度空间做差，得到高斯差分DOC金字塔，整个过程的公式如下:
高斯差分金字塔建立后，特征点就是DOG尺度空间众多极值点，（个人认为对其进行求偏导数即可得到特征点的位置坐标），查找该极值点需要把每个点与邻域内的周围的26个点进行比较，这些点包括，在同一尺度上相邻的8个点，以及相邻尺度上相邻的18个点。
2.特征点的尺度方向的确定
得到了特征点的坐标是完全不够的，必须要增加方向尺度信息。
· 采用有限差分的方法，求出在以特征点为圆心，以3倍西伽马为半径的范围内的图像梯度的幅值和相位。
· 利用直方图统计方法，求助邻域内所有像素点的梯度方向以及幅值。特征点的主方向就是直方图的峰值所代表的方向，确定了主方向就可以使SIFT算法具备旋转不变性。
3.特征向量的生成
特征向量最终是通过求得的特征点的邻域梯度信息来计算的。
· 先把坐标轴位置旋转到特征点所在的主方向上
· 接着以特征点为圆心，选择特征点附近的16个点作为种子点，分别求出8个方向上的梯度大小
· 最后得到的128维向量即为所求的特征向量
4.特征点的匹配
通常采用最邻近的方法，即查找每一个特征点在另外一副图像中的最邻近，即最短的欧式距离。
欧式距离的含义就是：两点连线的距离长度" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/4db8dbc7901a7d547e7b8c1ef4a2a13c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-03-08T12:33:03+08:00" />
<meta property="article:modified_time" content="2020-03-08T12:33:03+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">计算机视觉-SIFT特征提取及匹配</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1SIFT_1" rel="nofollow">1、SIFT描述子介绍</a></li><li><ul><li><a href="#11_SIFT_2" rel="nofollow">1.1 SIFT描述子定义</a></li><li><a href="#12_SIFT_4" rel="nofollow">1.2 SIFT特征</a></li><li><a href="#13_SIFT_10" rel="nofollow">1.3 SIFT检测过程</a></li><li><a href="#14_17" rel="nofollow">1.4算法介绍</a></li></ul> 
  </li><li><a href="#2_45" rel="nofollow">2、数据集准备</a></li><li><a href="#3SIFT_48" rel="nofollow">3、图片的SIFT特征提取并展示特征点</a></li><li><ul><li><a href="#31__49" rel="nofollow">3.1 代码实现</a></li><li><a href="#32__87" rel="nofollow">3.2 结果展示</a></li><li><a href="#33__92" rel="nofollow">3.3 实验分析</a></li></ul> 
  </li><li><a href="#4_94" rel="nofollow">4、特征匹配</a></li><li><ul><li><a href="#41_95" rel="nofollow">4.1代码实现</a></li><li><a href="#42_137" rel="nofollow">4.2结果展示</a></li><li><a href="#43_148" rel="nofollow">4.3实验结果</a></li></ul> 
  </li><li><a href="#5_150" rel="nofollow">5、图像匹配</a></li><li><ul><li><a href="#51_156" rel="nofollow">5.1代码实现</a></li><li><a href="#52_216" rel="nofollow">5.2结果展示</a></li><li><a href="#53__223" rel="nofollow">5.3 实验结果</a></li></ul> 
  </li><li><a href="#6_226" rel="nofollow">6、数据集匹配</a></li><li><ul><li><a href="#61_227" rel="nofollow">6.1代码实现</a></li><li><a href="#62_298" rel="nofollow">6.2结果展示</a></li><li><a href="#63_300" rel="nofollow">6.3实验结果</a></li></ul> 
  </li><li><a href="#7RANSAC_302" rel="nofollow">7、RANSAC算法去除误匹配</a></li><li><ul><li><a href="#71RANSAC_303" rel="nofollow">7.1RANSAC算法原理</a></li><li><a href="#72RANSAC_307" rel="nofollow">7.2RANSAC算法步骤</a></li><li><a href="#73RANSAC_313" rel="nofollow">7.3RANSAC实现</a></li><li><ul><li><a href="#731_314" rel="nofollow">7.3.1景深丰富</a></li><li><a href="#732_322" rel="nofollow">7.3.2景深单一</a></li></ul> 
   </li><li><a href="#74__329" rel="nofollow">7.4 实验结果分析</a></li></ul> 
  </li><li><a href="#8_334" rel="nofollow">8、实验问题及总结</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1SIFT_1"></a>1、SIFT描述子介绍</h2> 
<h3><a id="11_SIFT_2"></a>1.1 SIFT描述子定义</h3> 
<p>SIFT的全称是Scale Invariant Feature Transform，尺度不变特征变换，由加拿大教授David G.Lowe提出的。SIFT特征<strong>对旋转、尺度缩放、亮度变化等保持不变性</strong>，是一种非常稳定的<strong>局部特征</strong>。</p> 
<h3><a id="12_SIFT_4"></a>1.2 SIFT特征</h3> 
<p>1、图像的局部特征，对旋转、尺度缩放、亮度变化保持不变，对视角变化、仿射变换、噪声也保持一定程度的稳定性。<br> 2、独特性好，信息量丰富，适用于海量特征库进行快速、准确的匹配。<br> 3、 多量性，即使是很少几个物体也可以产生大量的SIFT特征<br> 4、高速性，经优化的SIFT匹配算法甚至可以达到实时性<br> 5、 扩招性，可以很方便的与其他的特征向量进行联合。</p> 
<h3><a id="13_SIFT_10"></a>1.3 SIFT检测过程</h3> 
<p>1.构造高斯差分空间图像。<br> 2.寻找极大极小值点<br> 3.精确定位极值点<br> 4.选取特征点主方向<br> 5. 构造特征点描述算子。</p> 
<h3><a id="14_17"></a>1.4算法介绍</h3> 
<p><strong>1.尺度空间极值检测——即找特征点</strong></p> 
<p>对于二维图像<strong>I</strong>(x，y)，建立图像的DOG （difference of guassians，即高斯差分）金字塔，DOG尺度空间含义为：可以用一个尺度空间的高斯函数和图像的卷积来表示。<br> <img src="https://images2.imgbox.com/ee/36/jNPJpc8Y_o.png" alt="在这里插入图片描述"><br> G为尺度可变的高斯函数，***I***为空间坐标，其中西伽马为尺度。<br> 为确定特征点所在的位置，首先需要建立一个高斯金字塔。<br> 得到高斯金字塔后，再通过两个相邻的高斯尺度空间做差，得到高斯差分DOC金字塔，整个过程的公式如下:<br> <img src="https://images2.imgbox.com/9d/69/5VX1oYr0_o.png" alt="在这里插入图片描述"><br> 高斯差分金字塔建立后，特征点就是DOG尺度空间众多极值点，（个人认为对其进行求偏导数即可得到特征点的位置坐标），查找该极值点需要把每个点与邻域内的周围的26个点进行比较，这些点包括，在同一尺度上相邻的8个点，以及相邻尺度上相邻的18个点。<br> <strong>2.特征点的尺度方向的确定</strong><br> 得到了特征点的坐标是完全不够的，必须要增加方向尺度信息。<br> · 采用有限差分的方法，求出在以特征点为圆心，以3倍西伽马为半径的范围内的图像梯度的幅值和相位。<br> · 利用直方图统计方法，求助邻域内所有像素点的梯度方向以及幅值。特征点的主方向就是直方图的峰值所代表的方向，确定了主方向就可以使SIFT算法具备旋转不变性。<br> <strong>3.特征向量的生成</strong><br> 特征向量最终是通过求得的特征点的邻域梯度信息来计算的。<br> · 先把坐标轴位置旋转到特征点所在的主方向上<br> · 接着以特征点为圆心，选择特征点附近的16个点作为种子点，分别求出8个方向上的梯度大小<br> · 最后得到的128维向量即为所求的特征向量<br> <strong>4.特征点的匹配</strong><br> 通常采用最邻近的方法，即查找每一个特征点在另外一副图像中的最邻近，即最短的欧式距离。<br> 欧式距离的含义就是：两点连线的距离长度<br> 具体如下：<br> 对目标图像A中的某个特征点，求出该点与图像B中的所有特征点的特征向量的欧式距离；<br> · 将所求得的欧式距离值的大小进行排序；<br> · 找出最小的和次小(倒数第二小的)欧式距离值对于的目标图B中的特征点，并对这两个距离的比值进行计算；<br> · 假设该比值小于某个阈值，则这两个点为匹配点，否则不匹配。<br> （注：该阈值是一个经验阈值：是影响误匹配的主要原因，实验中一般选取的阈值大小是0.6左右）</p> 
<h2><a id="2_45"></a>2、数据集准备</h2> 
<p>由于疫情原因，拍摄了家里及周围的场景共15张作为本次实验的数据集<br> <img src="https://images2.imgbox.com/51/6e/mfLEN2s3_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3SIFT_48"></a>3、图片的SIFT特征提取并展示特征点</h2> 
<h3><a id="31__49"></a>3.1 代码实现</h3> 
<pre><code class="prism language-java"># <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span>
from PIL <span class="token keyword">import</span> Image
from pylab <span class="token keyword">import</span> <span class="token operator">*</span>
from PCV<span class="token punctuation">.</span>localdescriptors <span class="token keyword">import</span> sift
from PCV<span class="token punctuation">.</span>localdescriptors <span class="token keyword">import</span> harris

# 添加中文字体支持
from matplotlib<span class="token punctuation">.</span>font_manager <span class="token keyword">import</span> FontProperties
font <span class="token operator">=</span> <span class="token function">FontProperties</span><span class="token punctuation">(</span>fname<span class="token operator">=</span>r<span class="token string">"c:\windows\fonts\SimSun.ttc"</span><span class="token punctuation">,</span> size<span class="token operator">=</span><span class="token number">14</span><span class="token punctuation">)</span>

imname <span class="token operator">=</span> r<span class="token string">'C:\Users\13799\PycharmProjects\untitled1\pic\4.jpg'</span>
im <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>imname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sift<span class="token punctuation">.</span><span class="token function">process_image</span><span class="token punctuation">(</span>imname<span class="token punctuation">,</span> <span class="token string">'empire.sift'</span><span class="token punctuation">)</span>
l1<span class="token punctuation">,</span> d1 <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">read_features_from_file</span><span class="token punctuation">(</span><span class="token string">'empire.sift'</span><span class="token punctuation">)</span>

<span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">131</span><span class="token punctuation">)</span>
sift<span class="token punctuation">.</span><span class="token function">plot_features</span><span class="token punctuation">(</span>im<span class="token punctuation">,</span> l1<span class="token punctuation">,</span> circle<span class="token operator">=</span>False<span class="token punctuation">)</span>
<span class="token function">title</span><span class="token punctuation">(</span>u<span class="token string">'SIFT特征'</span><span class="token punctuation">,</span>fontproperties<span class="token operator">=</span>font<span class="token punctuation">)</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">132</span><span class="token punctuation">)</span>
sift<span class="token punctuation">.</span><span class="token function">plot_features</span><span class="token punctuation">(</span>im<span class="token punctuation">,</span> l1<span class="token punctuation">,</span> circle<span class="token operator">=</span>True<span class="token punctuation">)</span>
<span class="token function">title</span><span class="token punctuation">(</span>u<span class="token string">'用圆圈表示SIFT特征尺度'</span><span class="token punctuation">,</span>fontproperties<span class="token operator">=</span>font<span class="token punctuation">)</span>

# 检测harris角点
harrisim <span class="token operator">=</span> harris<span class="token punctuation">.</span><span class="token function">compute_harris_response</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span>

<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">133</span><span class="token punctuation">)</span>
filtered_coords <span class="token operator">=</span> harris<span class="token punctuation">.</span><span class="token function">get_harris_points</span><span class="token punctuation">(</span>harrisim<span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token function">imshow</span><span class="token punctuation">(</span>im<span class="token punctuation">)</span>
<span class="token function">plot</span><span class="token punctuation">(</span><span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token keyword">for</span> p in filtered_coords<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>p<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">for</span> p in filtered_coords<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'*'</span><span class="token punctuation">)</span>
<span class="token function">axis</span><span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
<span class="token function">title</span><span class="token punctuation">(</span>u<span class="token string">'Harris角点'</span><span class="token punctuation">,</span>fontproperties<span class="token operator">=</span>font<span class="token punctuation">)</span>

<span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="32__87"></a>3.2 结果展示</h3> 
<p><img src="https://images2.imgbox.com/f4/f1/5S6sRwCF_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/4b/66/OwPM5SkW_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/17/54/2oa1fuCD_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/be/bd/N3rJmXyu_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/66/6a/3g7V8AlT_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/67/80/svDyCrnj_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/e7/93/QkDWLMyk_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d2/54/qkK0nkxJ_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/e5/a4/FykaRbJf_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/25/40/3iHiUpOh_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/61/a7/4PO7n2ri_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/6f/75/gcwrDFcH_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/98/42/MkOnMxRo_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/80/b0/hedofeyy_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__92"></a>3.3 实验分析</h3> 
<p>通过多个场景的图片对比可以发现SIFT算法的特征点比Harris角点的特征点提取的更多，并且更加精准；它需要建立高斯图像金字塔和高斯差分金字塔之后再检测极值，而Harris角点只是对原图进行角点检测和变化，Harris特征点检测存在角点信息丢失与偏移的现象。在运行程序时，与Harris的效率相比，SIFT的效率有大的提升，程序的运行很快。</p> 
<h2><a id="4_94"></a>4、特征匹配</h2> 
<h3><a id="41_95"></a>4.1代码实现</h3> 
<pre><code class="prism language-java">from PIL <span class="token keyword">import</span> Image
from pylab <span class="token keyword">import</span> <span class="token operator">*</span>
<span class="token keyword">import</span> sys
from PCV<span class="token punctuation">.</span>localdescriptors <span class="token keyword">import</span> sift


<span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>argv<span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">3</span><span class="token operator">:</span>
  im1f<span class="token punctuation">,</span> im2f <span class="token operator">=</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> sys<span class="token punctuation">.</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
<span class="token keyword">else</span><span class="token operator">:</span>
#  im1f <span class="token operator">=</span> <span class="token string">'../data/sf_view1.jpg'</span>
#  im2f <span class="token operator">=</span> <span class="token string">'../data/sf_view2.jpg'</span>
  im1f <span class="token operator">=</span> r<span class="token string">'C:\Users\13799\PycharmProjects\untitled1\pic\1.jpg'</span>
  im2f <span class="token operator">=</span> r<span class="token string">'C:\Users\13799\PycharmProjects\untitled1\pic\2.jpg'</span>
#  im1f <span class="token operator">=</span> <span class="token string">'../data/climbing_1_small.jpg'</span>
#  im2f <span class="token operator">=</span> <span class="token string">'../data/climbing_2_small.jpg'</span>
im1 <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>im1f<span class="token punctuation">)</span><span class="token punctuation">)</span>
im2 <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>im2f<span class="token punctuation">)</span><span class="token punctuation">)</span>

sift<span class="token punctuation">.</span><span class="token function">process_image</span><span class="token punctuation">(</span>im1f<span class="token punctuation">,</span> <span class="token string">'out_sift_1.txt'</span><span class="token punctuation">)</span>
l1<span class="token punctuation">,</span> d1 <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">read_features_from_file</span><span class="token punctuation">(</span><span class="token string">'out_sift_1.txt'</span><span class="token punctuation">)</span>
<span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">121</span><span class="token punctuation">)</span>
sift<span class="token punctuation">.</span><span class="token function">plot_features</span><span class="token punctuation">(</span>im1<span class="token punctuation">,</span> l1<span class="token punctuation">,</span> circle<span class="token operator">=</span>False<span class="token punctuation">)</span>

sift<span class="token punctuation">.</span><span class="token function">process_image</span><span class="token punctuation">(</span>im2f<span class="token punctuation">,</span> <span class="token string">'out_sift_2.txt'</span><span class="token punctuation">)</span>
l2<span class="token punctuation">,</span> d2 <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">read_features_from_file</span><span class="token punctuation">(</span><span class="token string">'out_sift_2.txt'</span><span class="token punctuation">)</span>
<span class="token function">subplot</span><span class="token punctuation">(</span><span class="token number">122</span><span class="token punctuation">)</span>
sift<span class="token punctuation">.</span><span class="token function">plot_features</span><span class="token punctuation">(</span>im2<span class="token punctuation">,</span> l2<span class="token punctuation">,</span> circle<span class="token operator">=</span>False<span class="token punctuation">)</span>

#matches <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">match</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span>
matches <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">match_twosided</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span>
print <span class="token string">'{} matches'</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token function">len</span><span class="token punctuation">(</span>matches<span class="token punctuation">.</span><span class="token function">nonzero</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token function">gray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
sift<span class="token punctuation">.</span><span class="token function">plot_matches</span><span class="token punctuation">(</span>im1<span class="token punctuation">,</span> im2<span class="token punctuation">,</span> l1<span class="token punctuation">,</span> l2<span class="token punctuation">,</span> matches<span class="token punctuation">,</span> show_below<span class="token operator">=</span>True<span class="token punctuation">)</span>
<span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

</code></pre> 
<h3><a id="42_137"></a>4.2结果展示</h3> 
<p>匹配成功时：<br> SIFT检测两张图片兴趣点的结果图<br> <img src="https://images2.imgbox.com/cf/c8/Yq5nGOC1_o.png" alt="在这里插入图片描述"><br> 兴趣点匹配结果<br> <img src="https://images2.imgbox.com/c7/2f/l5u5HLGV_o.png" alt="在这里插入图片描述"><br> 当选取两张毫无关联的图片时：<br> 两张图片的兴趣点提取<br> <img src="https://images2.imgbox.com/5e/c9/6HeJW7Wm_o.png" alt="在这里插入图片描述"><br> 匹配结果：<br> <img src="https://images2.imgbox.com/53/1a/XhTJwCIr_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="43_148"></a>4.3实验结果</h3> 
<p>从匹配的结果看：SIFT算法匹配出的特征点很多很齐全，这是因为SIFT算法具有尺度和旋转不变性，即使两张图大小不一样、角度不一致也不会影响匹配结果。在进行匹配时，用关键点特征向量的欧式距离来作为两幅图像中关键点的相似性判定度量。取图像1中的某个关键点，并找出其与图像2中欧式距离最近的前两个关键点，在这两个关键点中，如果最近的距离除以次近的距离少于某个比例阈值，则接受这一对匹配点。两个不同场景则无法检测到相似点，说明了SIFT的准确性很高。</p> 
<h2><a id="5_150"></a>5、图像匹配</h2> 
<p>实验要求：<br> 输入：<br> 一张新图像<br> 输出：<br> 图像集中与其最匹配的三张图</p> 
<h3><a id="51_156"></a>5.1代码实现</h3> 
<pre><code class="prism language-java"># <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span>
from pylab <span class="token keyword">import</span> <span class="token operator">*</span>
from PIL <span class="token keyword">import</span> Image
from PCV<span class="token punctuation">.</span>localdescriptors <span class="token keyword">import</span> sift
from PCV<span class="token punctuation">.</span>tools <span class="token keyword">import</span> imtools
<span class="token string">""</span>" This is the example graph illustration of matching images from Figure <span class="token number">2</span><span class="token operator">-</span><span class="token number">10.</span>
To download the images<span class="token punctuation">,</span> see ch2_download_panoramio<span class="token punctuation">.</span>py<span class="token punctuation">.</span><span class="token string">""</span>"

download_path <span class="token operator">=</span><span class="token string">"C:/Users/13799/PycharmProjects/untitled1/pic/"</span>  # set <span class="token keyword">this</span> to the path where you downloaded the panoramio images
path <span class="token operator">=</span> <span class="token string">"C:/Users/13799/PycharmProjects/untitled1/pic/"</span>  # path to save thumbnails <span class="token punctuation">(</span>pydot needs the full system path<span class="token punctuation">)</span>

# list of downloaded filenames
imlist <span class="token operator">=</span> imtools<span class="token punctuation">.</span><span class="token function">get_imlist</span><span class="token punctuation">(</span>download_path<span class="token punctuation">)</span>
nbr_images <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>imlist<span class="token punctuation">)</span>

# extract features
featlist <span class="token operator">=</span> <span class="token punctuation">[</span>imname<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'sift'</span> <span class="token keyword">for</span> imname in imlist<span class="token punctuation">]</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> imname in <span class="token function">enumerate</span><span class="token punctuation">(</span>imlist<span class="token punctuation">)</span><span class="token operator">:</span>
    sift<span class="token punctuation">.</span><span class="token function">process_image</span><span class="token punctuation">(</span>imname<span class="token punctuation">,</span> featlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

print featlist
imname <span class="token operator">=</span> <span class="token string">'C:/Users/13799/PycharmProjects/untitled1/pic/16.jpg'</span>
im <span class="token operator">=</span> <span class="token function">array</span><span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>imname<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">convert</span><span class="token punctuation">(</span><span class="token string">'L'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
sift<span class="token punctuation">.</span><span class="token function">process_image</span><span class="token punctuation">(</span>imname<span class="token punctuation">,</span> <span class="token string">'empire.sift'</span><span class="token punctuation">)</span>
l1<span class="token punctuation">,</span> d1 <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">read_features_from_file</span><span class="token punctuation">(</span><span class="token string">'empire.sift'</span><span class="token punctuation">)</span>

matchscores <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nbr_images<span class="token punctuation">,</span> nbr_images<span class="token punctuation">)</span><span class="token punctuation">)</span>

arr<span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span>

<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span>nbr_images<span class="token punctuation">)</span><span class="token operator">:</span>
        print <span class="token string">'comparing 12'</span><span class="token punctuation">,</span> imlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
#        l1<span class="token punctuation">,</span> d1 <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">read_features_from_file</span><span class="token punctuation">(</span>featlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        l2<span class="token punctuation">,</span> d2 <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">read_features_from_file</span><span class="token punctuation">(</span>featlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        matches <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">match_twosided</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span>
        nbr_matches <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>matches <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        arr<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>nbr_matches<span class="token punctuation">)</span>
#        arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span>dict<span class="token punctuation">{<!-- --></span>nbr_matches<span class="token operator">:</span>imlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">}</span>
        print <span class="token string">'number of matches = '</span><span class="token punctuation">,</span> nbr_matches
#        matchscores<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> nbr_matches
arr2<span class="token operator">=</span>arr<span class="token punctuation">[</span><span class="token operator">:</span><span class="token punctuation">]</span>  #切片浅拷贝 arr2<span class="token operator">=</span>arr深拷贝
arr2<span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>reverse <span class="token operator">=</span> True<span class="token punctuation">)</span>
print arr
print arr2
i<span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">while</span> <span class="token punctuation">(</span>i<span class="token operator">&lt;</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">for</span> j in <span class="token function">range</span><span class="token punctuation">(</span>nbr_images<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token operator">==</span>arr2<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span>
            print imlist<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
            <span class="token function">figure</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token function">axis</span><span class="token punctuation">(</span><span class="token string">'off'</span><span class="token punctuation">)</span>
            img<span class="token operator">=</span><span class="token function">array</span><span class="token punctuation">(</span>Image<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>imlist<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">imshow</span><span class="token punctuation">(</span>img<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
    i<span class="token operator">=</span>i<span class="token operator">+</span><span class="token number">1</span>
    
   <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="52_216"></a>5.2结果展示</h3> 
<p>输入图片：<br> <img src="https://images2.imgbox.com/b1/37/PzSt9gLV_o.png" alt="在这里插入图片描述"><br> 输出：<br> <img src="https://images2.imgbox.com/f2/09/DuetiO5m_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/95/98/Jf6S9lmY_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="53__223"></a>5.3 实验结果</h3> 
<p>本题输入一张图像，然后输出三张匹配度最高的图片，需要将数据集中的全部图片与新图像都进行匹配，算出特征匹配值，并对求出的特征匹配值进行排序，选出值最高的三幅图像作为输出。实验发现sift特征匹配较为精准，输出的图像基本正确。SIFT特征的信息量大，适合在海量数据库中快速准确匹配，准确度也相当高。</p> 
<h2><a id="6_226"></a>6、数据集匹配</h2> 
<h3><a id="61_227"></a>6.1代码实现</h3> 
<pre><code class="prism language-java"># <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span> coding<span class="token operator">:</span> utf<span class="token operator">-</span><span class="token number">8</span> <span class="token operator">-</span><span class="token operator">*</span><span class="token operator">-</span>
from pylab <span class="token keyword">import</span> <span class="token operator">*</span>
from PIL <span class="token keyword">import</span> Image
from PCV<span class="token punctuation">.</span>localdescriptors <span class="token keyword">import</span> sift
from PCV<span class="token punctuation">.</span>tools <span class="token keyword">import</span> imtools
<span class="token keyword">import</span> pydot

<span class="token string">""</span>" This is the example graph illustration of matching images from Figure <span class="token number">2</span><span class="token operator">-</span><span class="token number">10.</span>
To download the images<span class="token punctuation">,</span> see ch2_download_panoramio<span class="token punctuation">.</span>py<span class="token punctuation">.</span><span class="token string">""</span>"

#download_path <span class="token operator">=</span> <span class="token string">"panoimages"</span>  # set <span class="token keyword">this</span> to the path where you downloaded the panoramio images
#path <span class="token operator">=</span> <span class="token string">"/FULLPATH/panoimages/"</span>  # path to save thumbnails <span class="token punctuation">(</span>pydot needs the full system path<span class="token punctuation">)</span>

download_path <span class="token operator">=</span> <span class="token string">"C:\Users\13799\PycharmProjects\untitled1\pic"</span>  # set <span class="token keyword">this</span> to the path where you downloaded the panoramio images
path <span class="token operator">=</span> <span class="token string">"C:\Users\13799\PycharmProjects\untitled1\pic"</span>  # path to save thumbnails <span class="token punctuation">(</span>pydot needs the full system path<span class="token punctuation">)</span>

# list of downloaded filenames
imlist <span class="token operator">=</span> imtools<span class="token punctuation">.</span><span class="token function">get_imlist</span><span class="token punctuation">(</span>download_path<span class="token punctuation">)</span>
nbr_images <span class="token operator">=</span> <span class="token function">len</span><span class="token punctuation">(</span>imlist<span class="token punctuation">)</span>

# extract features
featlist <span class="token operator">=</span> <span class="token punctuation">[</span>imname<span class="token punctuation">[</span><span class="token operator">:</span><span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">'sift'</span> <span class="token keyword">for</span> imname in imlist<span class="token punctuation">]</span>
<span class="token keyword">for</span> i<span class="token punctuation">,</span> imname in <span class="token function">enumerate</span><span class="token punctuation">(</span>imlist<span class="token punctuation">)</span><span class="token operator">:</span>
    sift<span class="token punctuation">.</span><span class="token function">process_image</span><span class="token punctuation">(</span>imname<span class="token punctuation">,</span> featlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>

matchscores <span class="token operator">=</span> <span class="token function">zeros</span><span class="token punctuation">(</span><span class="token punctuation">(</span>nbr_images<span class="token punctuation">,</span> nbr_images<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span>nbr_images<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">for</span> j in <span class="token function">range</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> nbr_images<span class="token punctuation">)</span><span class="token operator">:</span>  # only compute upper triangle
        print <span class="token string">'comparing '</span><span class="token punctuation">,</span> imlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> imlist<span class="token punctuation">[</span>j<span class="token punctuation">]</span>
        l1<span class="token punctuation">,</span> d1 <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">read_features_from_file</span><span class="token punctuation">(</span>featlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
        l2<span class="token punctuation">,</span> d2 <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">read_features_from_file</span><span class="token punctuation">(</span>featlist<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
        matches <span class="token operator">=</span> sift<span class="token punctuation">.</span><span class="token function">match_twosided</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> d2<span class="token punctuation">)</span>
        nbr_matches <span class="token operator">=</span> <span class="token function">sum</span><span class="token punctuation">(</span>matches <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
        print <span class="token string">'number of matches = '</span><span class="token punctuation">,</span> nbr_matches
        matchscores<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">=</span> nbr_matches
print <span class="token string">"The match scores is: \n"</span><span class="token punctuation">,</span> matchscores

# copy values
<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span>nbr_images<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">for</span> j in <span class="token function">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nbr_images<span class="token punctuation">)</span><span class="token operator">:</span>  # no need to copy diagonal
        matchscores<span class="token punctuation">[</span>j<span class="token punctuation">,</span> i<span class="token punctuation">]</span> <span class="token operator">=</span> matchscores<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span>

#可视化

threshold <span class="token operator">=</span> <span class="token number">2</span>  # min number of matches needed to create link

g <span class="token operator">=</span> pydot<span class="token punctuation">.</span><span class="token function">Dot</span><span class="token punctuation">(</span>graph_type<span class="token operator">=</span><span class="token string">'graph'</span><span class="token punctuation">)</span>  # don't want the <span class="token keyword">default</span> directed graph

<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span>nbr_images<span class="token punctuation">)</span><span class="token operator">:</span>
    <span class="token keyword">for</span> j in <span class="token function">range</span><span class="token punctuation">(</span>i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> nbr_images<span class="token punctuation">)</span><span class="token operator">:</span>
        <span class="token keyword">if</span> matchscores<span class="token punctuation">[</span>i<span class="token punctuation">,</span> j<span class="token punctuation">]</span> <span class="token operator">&gt;</span> threshold<span class="token operator">:</span>
            # first image in pair
            im <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>imlist<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span>
            im<span class="token punctuation">.</span><span class="token function">thumbnail</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            filename <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.png'</span>
            im<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  # need temporary files of the right size
            g<span class="token punctuation">.</span><span class="token function">add_node</span><span class="token punctuation">(</span>pydot<span class="token punctuation">.</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> fontcolor<span class="token operator">=</span><span class="token string">'transparent'</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token string">'rectangle'</span><span class="token punctuation">,</span> image<span class="token operator">=</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>

            # second image in pair
            im <span class="token operator">=</span> Image<span class="token punctuation">.</span><span class="token function">open</span><span class="token punctuation">(</span>imlist<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span>
            im<span class="token punctuation">.</span><span class="token function">thumbnail</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            filename <span class="token operator">=</span> path <span class="token operator">+</span> <span class="token function">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'.png'</span>
            im<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span>  # need temporary files of the right size
            g<span class="token punctuation">.</span><span class="token function">add_node</span><span class="token punctuation">(</span>pydot<span class="token punctuation">.</span><span class="token function">Node</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">,</span> fontcolor<span class="token operator">=</span><span class="token string">'transparent'</span><span class="token punctuation">,</span> shape<span class="token operator">=</span><span class="token string">'rectangle'</span><span class="token punctuation">,</span> image<span class="token operator">=</span>filename<span class="token punctuation">)</span><span class="token punctuation">)</span>

            g<span class="token punctuation">.</span><span class="token function">add_edge</span><span class="token punctuation">(</span>pydot<span class="token punctuation">.</span><span class="token function">Edge</span><span class="token punctuation">(</span><span class="token function">str</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">str</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
g<span class="token punctuation">.</span><span class="token function">write_png</span><span class="token punctuation">(</span><span class="token string">'11.jpg'</span><span class="token punctuation">)</span>
</code></pre> 
<h3><a id="62_298"></a>6.2结果展示</h3> 
<p><img src="https://images2.imgbox.com/10/96/R3YmhePv_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="63_300"></a>6.3实验结果</h3> 
<p>该图展示的是整个数据集的图片的关联，SIFT根据局部描述子找出了数据集中和它匹配的几张图，当匹配的特征点数量小于等于2时就不显示在该匹配图中。图片分别在不同场景和地点拍摄的，每栋建筑风格相似，整体环境相同，但是SIFT算法还是很精确地匹配出了结果。说明使用 SIFT特征描述对于部分物体遮蔽的侦测率相当高，能快速准确地计算出位置与方位。且因为SIFT所查找到的关键点不会因光照，仿射变换和噪音等因素而变化，如角点、边缘点、暗区的亮点及亮区的暗点等，很好地体现了它的独特性和多量性。</p> 
<h2><a id="7RANSAC_302"></a>7、RANSAC算法去除误匹配</h2> 
<h3><a id="71RANSAC_303"></a>7.1RANSAC算法原理</h3> 
<p>RANSAC为Random Sample Consensus的缩写，它是根据一组包含异常数据的样本数据集，计算出数据的数学模型参数，得到有效样本数据的算法。它于1981年由Fischler和Bolles最先提出 。该算法在计算机视觉中广泛应用。<br> RANSAC算法的基本假设是样本中包含正确数据(inliers，可以被模型描述的数据)，也包含异常数据(outliers，偏离正常范围很远、无法适应数学模型的数据)，即数据集中含有噪声。这些异常数据可能是由于错误的测量、错误的假设、错误的计算等产生的。同时RANSAC也假设，给定一组正确的数据，存在可以计算出符合这些数据的模型参数的方法。 因此，RANSAC通过反复选择数据中的一组随机子集来达成目标。</p> 
<h3><a id="72RANSAC_307"></a>7.2RANSAC算法步骤</h3> 
<ol><li>随机选择四对匹配特征</li><li>根据DLT计算单应矩阵 H (唯一解)</li><li>对所有匹配点，计算映射误差ε= ||pi’, H pi||</li><li>根据误差阈值，确定inliers（例如3-5像素）</li><li>针对最大inliers集合，重新计算单应矩阵 H</li></ol> 
<h3><a id="73RANSAC_313"></a>7.3RANSAC实现</h3> 
<h4><a id="731_314"></a>7.3.1景深丰富</h4> 
<p>原图如下：<br> <img src="https://images2.imgbox.com/4f/6a/juXpOW4R_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/e8/11/BKu51wQl_o.png" alt="在这里插入图片描述"><br> sift特征匹配结果：<br> <img src="https://images2.imgbox.com/a3/b6/ZD6gDq5w_o.png" alt="在这里插入图片描述"><br> RANSAC去除误匹配：<br> <img src="https://images2.imgbox.com/a7/2f/01xrtJYk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="732_322"></a>7.3.2景深单一</h4> 
<p>原图如下：<br> <img src="https://images2.imgbox.com/99/b5/XARhspFW_o.png" alt="在这里插入图片描述"><img src="https://images2.imgbox.com/10/86/RRs6ZAla_o.png" alt="在这里插入图片描述"><br> sift特征匹配结果：<br> <img src="https://images2.imgbox.com/85/1e/kK5B3RrY_o.png" alt="在这里插入图片描述"><br> RANSAC算法去除误匹配：<br> <img src="https://images2.imgbox.com/fa/ba/JZFFmWki_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="74__329"></a>7.4 实验结果分析</h3> 
<p>对于<strong>景深丰富的图</strong>来说：在整个建筑群中，特征点匹配数量多，中间部分的匹配点十分密集，很难看出区别。这边主要选择了右上部分和左下部分进行区分（如下图所示），明显可以得到右上和左下画圈部分不是匹配点，而经过RANSAC算法剔除后，可以删除这些误配。<br> <img src="https://images2.imgbox.com/c8/73/rs5l2MKq_o.png" alt="在这里插入图片描述"><br> 对于<strong>景深单一的图</strong>来说：如下图所示，景深单一的图的匹配点比较少，可以比较明显的看出对比。在下图中，中间部分的粉色线是一组误配点，在经过RANSAC后删除了该条匹配点，但是同时可以发现，上方的绿色线所指的是一条正确的匹配点，但是经过算法后他删除了该组匹配点。由此可以知道RANSAC在删除误配的同时也可能将正确的点也一起删除掉，这种误差不可避免，但总体来说，已经达到了非常理想的效果。<br> <img src="https://images2.imgbox.com/a3/42/vjYr3wx9_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="8_334"></a>8、实验问题及总结</h2> 
<p>1、本次实验用到的sift库在安装过程中需要注意：在修改Anaconda中PCV下sift的路径时要注意是要添加你所创建的项目里面的sift.exe，并且sift.exe在添加的时候要注意他后面有空格，不然会报错。<br> <img src="https://images2.imgbox.com/8f/41/3h6PHu9e_o.png" alt="在这里插入图片描述"><br> 2、在进行图像特征匹配的时候要注意图片大小要一致，建议照片尽量调小一点不然匹配过程中可能会出错。<br> 3、总的来说，SIFT特征具有尺度不变性，即使改变旋转角度，图像亮度或拍摄视角，仍然能够得到好的检测效果，检测出来的特征点更多更精准一点，这是相比Harris算法更优的地方。<br> 4、安装graphviz<br> 在安装graphviz的时候使用pip进行安装出错了，这边采用了navigator的下载源进行下载，步骤如下：<br> 4.1.在navigator中下载graphviz（这边需要注意的是原本anacoda是国外的下载源，速度可能会比较慢，因此我把它替换成了国内的镜像网站<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/" rel="nofollow">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</a>）<br> <img src="https://images2.imgbox.com/89/6f/Pg2eLjYc_o.png" alt="在这里插入图片描述"><br> 4.2.配置graphviz的环境变量<br> 4.3.pip install pydot<br> 5、本次代码里面使用了opencv，原本使用anaconda直接pip<br> <img src="https://images2.imgbox.com/96/69/n0fbbsMq_o.png" alt="在这里插入图片描述"><br> 但是后来查看了anconda的列表后发现没有这个包<br> 之后用了pip install opencv-contrib-python==3.4.0.12 -i https://pypi.tuna.tsinghua.edu.cn/simple some-package语句，成功下载了下来。<br> <img src="https://images2.imgbox.com/1c/54/4SJtUXdr_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/e9c15b22e9dbd50c9470722a0c050455/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">蓝桥杯题库 算法提高非vip部分（C&#43;&#43;、Java）代码实现（101-200）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a0fd0d7b20701b329a9805ee4759f3c2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【Python计算机视觉编程】第二章 SIFT特征提取与检索及RANSAC实例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>