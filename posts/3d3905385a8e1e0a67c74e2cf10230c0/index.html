<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>签名验签自助排查 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="签名验签自助排查" />
<meta property="og:description" content="签名验签自助排查 支付宝开放平台SDK封装了签名和验签过程，只需配置账号及密钥参数，强烈建议使用。 SDK下载地址 TIPS：文中代码部分以JAVA语言演示，其他语言请参考各自SDK。 使用开放平台SDK接入 如果使用了开放平台SDK，签名验签问题通常是因为密钥配置错误导致。 配置代码示例，问题描述中会以示例中的变量名为例： AlipayClient alipayClient = new DefaultAlipayClient(gateway,app_id,private_key,&#34;json&#34;,charset,alipay_public_key,sign_type); 签名问题 Q:SDK抛出异常：“com.alipay.api.AlipayApiException: RSA私钥格式不正确，请检查是否正确配置了PKCS8格式的私钥”。 A:代码中私钥(private_key)格式错误导致。1&gt;.检查格式是否正确。Java需使用PKCS8格式，其他语言使用PKCS1格式。 2&gt;.检查私钥是否一行。 Q:请求时，SDK抛出异常：“java.lang.NullPointerException: privateKey should not be NULL!”。 A:代码中私钥(private_key)参数未赋值导致。请把商户应用私钥赋值给该参数。 Q:请求时，SDK抛出异常：“java.security.NoSuchAlgorithmException: MD5 KeyFactory not available”。 A:代码中签名类型(sign_type)设置错误导致。开放平台接口需设置成RSA。 Q:请求时，支付宝返回报错信息：“{&#34;code&#34;:&#34;40003&#34;,&#34;msg&#34;:&#34;Insufficient Conditions&#34;,&#34;sub_code&#34;:&#34;isv.missing-signature-config&#34;,&#34;sub_msg&#34;:&#34;验签出错, 未配置对应签名算法的公钥或者证书&#34;}” A:开放平台未配置商户公钥导致。请登录开放平台，上传公钥。教程 Q:请求时，支付宝返回报错信息：“{&#34;code&#34;:&#34;40002&#34;,&#34;msg&#34;:&#34;Invalid Arguments&#34;,&#34;sub_code&#34;:&#34;isv.invalid-signature&#34;,&#34;sub_msg&#34;:&#34;无效签名&#34;}” A:签名校验失败。1&gt;.检查网关地址(gateway)是生产环境还是沙箱环境，必须使用与之匹配的应用id(app_id)与私钥(private_key) 2&gt;.检查编码类型(charset)是否正确。 3&gt;.检查私钥(private_key)与开放平台上传的应用公钥是否匹配。 4&gt;.检查签名类型(sign_type)值是否正确。如果未传入sign_type参数，默认为RSA类型。 验签问题 Q:SDK抛出异常：“java.lang.NullPointerException: alipayPublicKey should not be NULL!”。 A:代码中支付宝公钥(alipay_public_key)参数未赋值导致。请把支付宝公钥赋值给该参数。教程 Q:SDK抛出异常：“java.security.InvalidKeyException” A:代码中支付宝公钥(alipay_public_key)参数内容错误导致。请核对。 Q:SDK抛出异常：“com.alipay.api.AlipayApiException: sign check fail: check Sign and Data Fail!” A:支付宝返回内容验签失败。1&gt;.检查网关地址(gateway)是生产环境还是沙箱环境，必须使用与之匹配的应用id(app_id)与支付宝公钥(alipay_public_key) 2&gt;.检查编码类型(charset)是否正确。 3&gt;.检查代码中支付宝公钥(alipay_public_key)参数与开放平台上获取的支付宝公钥是否一致。 Q:SDK抛出异常：“Caused by: java.security.SignatureException: Signature length not correct: got 256 but was expecting 128” A:支付宝公钥(alipay_public_key)与签名类型(sign_type)不匹配。Sign_type设置为RSA2，alipay_public_key需使用对应的支付宝公钥，不能使用开放平台RSA类型下的支付宝公钥。 Q:SDK抛出异常：“Caused by: java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/3d3905385a8e1e0a67c74e2cf10230c0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-09-02T17:21:43+08:00" />
<meta property="article:modified_time" content="2017-09-02T17:21:43+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">签名验签自助排查</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="floor_title cc" style='word-break:break-all; word-wrap:break-word; zoom:1; margin-bottom:10px; margin-top:42px; color:rgb(51,51,51); font-family:PingFangSC,"helvetica neue","hiragino sans gb",arial,"microsoft yahei ui","microsoft yahei",simsun,sans-serif; background-color:rgb(250,250,250)'> 
 <h2 id="J_post_title" style="margin:0px; padding:0px; font-size:16px; display:inline; line-height:24px"> 签名验签自助排查 </h2> 
 <span class="floor_honor posts_icon" style="padding:2px 0px 0px 10px; display:inline-block; vertical-align:top"></span> 
</div> 
<div style='word-break:break-all; word-wrap:break-word; color:rgb(51,51,51); font-family:PingFangSC,"helvetica neue","hiragino sans gb",arial,"microsoft yahei ui","microsoft yahei",simsun,sans-serif; margin-top:10px; padding:10px; height:auto; background-color:rgb(244,244,245); font-size:14px'> 
 <span style=""><br> 支付宝开放平台SDK封装了签名和验签过程，只需配置账号及密钥参数，强烈建议使用。</span>  
 <br style=""> 
 <span style=""><a target="_blank" href="https://doc.open.alipay.com/docs/doc.htm?treeId=54&amp;articleId=103419&amp;docType=1" rel="nofollow noopener noreferrer" style="color:rgb(0,170,238)">SDK下载地址</a></span>  
 <br style=""> 
 <span style="color:rgb(109,65,44)"><span style="color:rgb(51,51,51)">TIPS：</span>文中代码部分以JAVA语言演示，其他语言请参考各自SDK。</span>  
 <br style=""> 
 <span style="color:rgb(109,65,44)"><br style=""> </span> 
 <span style="font-size:24px"><span style=""><span style="font-size:18px">使用开放平台SDK接入</span></span></span>  
 <br style=""> 
 <span style="">如果使用了开放平台SDK，签名验签问题通常是因为密钥配置错误导致。</span>  
 <br style=""> 
 <span style="">配置代码示例，问题描述中会以示例中的变量名为例：</span>  
 <br style=""> 
 <span style=""><br style=""> AlipayClient alipayClient = new DefaultAlipayClient(gateway,app_id,private_key,"json",charset,alipay_public_key,sign_type); <br style=""> </span> 
 <span style="font-size:24px"><span style="">签名问题</span></span>  
 <br style=""> 
 <span style="font-size:12px"><span style="font-family:微软雅黑"><span style="color:rgb(255,0,0)">Q:SDK抛出异常：“com.alipay.api.AlipayApiException: RSA私钥格式不正确，请检查是否正确配置了PKCS8格式的私钥”。</span> <br style=""> A:代码中私钥(private_key)格式错误导致。1&gt;.检查格式是否正确。Java需使用PKCS8格式，其他语言使用PKCS1格式。 <br style=""> 2&gt;.检查私钥是否一行。 <br style=""> <br style=""> <span style="color:rgb(255,0,0)">Q:请求时，SDK抛出异常：“java.lang.NullPointerException: privateKey should not be NULL!”。</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="color:rgb(26,26,26)">代码中私钥(private_key)参数未赋值导致。请把商户应用私钥赋值给该参数。</span> <br style=""> <br style=""> <span style="color:rgb(255,0,0)">Q:请求时，SDK抛出异常：“java.security.NoSuchAlgorithmException: MD5 KeyFactory not available”。</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="color:rgb(26,26,26)">代码中签名类型(sign_type)设置错误导致。开放平台接口需设置成RSA。</span> <br style=""> <br style=""> <span style="color:rgb(255,0,0)">Q:请求时，支付宝返回报错信息：“{"code":"40003","msg":"Insufficient Conditions","sub_code":"isv.missing-signature-config","sub_msg":"验签出错, 未配置对应签名算法的公钥或者证书"}”</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="color:rgb(26,26,26)">开放平台未配置商户公钥导致。请登录开放平台，上传公钥。</span><a target="_blank" href="https://doc.open.alipay.com/docs/doc.htm?treeId=291&amp;articleId=105972&amp;docType=1" rel="nofollow noopener noreferrer" style="color:rgb(0,170,238)">教程</a> <br style=""> <br style=""> <span style="color:rgb(255,0,0)">Q:请求时，支付宝返回报错信息：“{"code":"40002","msg":"Invalid Arguments","sub_code":"isv.invalid-signature","sub_msg":"无效签名"}”</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="">签名校验失败。</span><span style="">1&gt;.检查网关地址(gateway)是生产环境还是沙箱环境，必须使用与之匹配的应用id(app_id)与私钥(private_key)</span><br style=""> <span style="">2&gt;.检查编码类型(charset)是否正确。</span> <br style=""> <span style="">3&gt;.检查私钥(private_key)与开放平台上传的应用公钥是否匹配。</span> <br style=""> <span style="">4&gt;.检查签名类型(sign_type)值是否正确。如果未传入sign_type参数，默认为RSA类型。</span></span></span>  
 <br style=""> 
 <br style=""> 
 <span style="font-size:24px"><span style="">验签问题</span></span>  
 <br style=""> 
 <span style="font-size:12px"><span style="font-family:微软雅黑"><span style="color:rgb(255,0,0)">Q:SDK抛出异常：“java.lang.NullPointerException: alipayPublicKey should not be NULL!”。</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="color:rgb(26,26,26)">代码中支付宝公钥(alipay_public_key)参数未赋值导致。请把支付宝公钥赋值给该参数。</span><a target="_blank" href="https://doc.open.alipay.com/docs/doc.htm?&amp;treeId=291&amp;articleId=105972&amp;docType=1" rel="nofollow noopener noreferrer" style="color:rgb(0,170,238)">教程</a> <br style=""> <br style=""> <span style="color:rgb(255,0,0)">Q:SDK抛出异常：“java.security.InvalidKeyException”</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="color:rgb(26,26,26)">代码中支付宝公钥(alipay_public_key)参数内容错误导致。请核对。</span> <br style=""> <br style=""> <span style="color:rgb(255,0,0)">Q:SDK抛出异常：“com.alipay.api.AlipayApiException: sign check fail: check Sign and Data Fail!”</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="">支付宝返回内容验签失败。</span><span style="">1&gt;.检查网关地址(gateway)是生产环境还是沙箱环境，必须使用与之匹配的应用id(app_id)与支付宝公钥(alipay_public_key) </span><br style=""> <span style="">2&gt;.检查编码类型(charset)是否正确。</span> <br style=""> <span style="">3&gt;.检查代码中支付宝公钥(alipay_public_key)参数与开放平台上获取的支付宝公钥是否一致。</span> <br style=""> <br style=""> <span style="color:rgb(255,0,0)">Q:SDK抛出异常：“Caused by: java.security.SignatureException: Signature length not correct: got 256 but was expecting 128”</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="">支付宝公钥(alipay_public_key)与签名类型(sign_type)不匹配。Sign_type设置为RSA2，alipay_public_key需使用对应的支付宝公钥，不能使用开放平台RSA类型下的支付宝公钥。</span> <br style=""> <br style=""> <span style="color:rgb(255,0,0)">Q:SDK抛出异常：“Caused by: java.security.SignatureException: Signature length not correct: got 128 but was expecting 256”</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="">支付宝公钥(alipay_public_key)与签名类型(sign_type)不匹配。Sign_type设置了RSA，alipay_public_key需使用对应的支付宝公钥，不能使用开放平台RSA2类型下的支付宝公钥。</span> <br style=""> <br style=""> Q:AlipaySignature.rsaCheckV1()方法返回false</span> <br style=""> <span style="color:rgb(26,26,26)">A:</span><span style="color:rgb(26,26,26)">验签失败，方法同上。</span> <br style=""> <br style=""> <span style="">TIPS：</span><span style="color:rgb(109,65,44)">开放平台SDK提供了AlipaySignature.rsaCheckV1()与AlipaySignature.rsaCheckV2()两个版本。V1验签时会剔除sign_type参数，V2会保留sign_type参数。V2仅适用于生活号接口<br> 。</span></span> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/616ec435ee2358af0fd8afb5b6e5f195/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Apache日志记录组件Log4j出现反序列化漏洞 黑客可以执行任意代码 所有2.x版本均受影响...</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7eef1aab692d1524a198043677ba1bcb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">php 过狗一句话木马的编写</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>