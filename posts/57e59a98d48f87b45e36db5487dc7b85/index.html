<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>虚谷数据库定时任务的dbms_scheduler使用方法 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="虚谷数据库定时任务的dbms_scheduler使用方法" />
<meta property="og:description" content="虚谷数据库提供定时作业机制，用于定时、定期、自动的进行某些操作，可通过系统包 dbms_scheduler 进行定时作业创建、调度、查看、删除等。
DBMS_SCHEDULER 系统包封装了以下过程/函数：ENABLE、DISABLE、SET_JOB_ARGUMENT_VALUE、DROP_JOB、RUN_JOB。
DBMS_SCHEDULER.CREATE_JOB：创建作业DBMS_SCHEDULER.ENABLE：表示启用作业。DBMS_SCHEDULER.DISABLE：表示禁用作业。DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE：表示对 job 调用存储过程进行参数赋值DBMS_SCHEDULER.RUN_JOB：表示显式调用定时作业。DBMS_SCHEDULER.DROP_JOB：表示删除定时作业。 1、DBMS_SCHEDULER.CREATE_JOB使用方法 DBMS_SCHEDULER.CREATE_JOB (
job_name IN VARCHAR2,
job_type IN VARCHAR2, job_action IN VARCHAR2,
number_of_arguments IN PLS_INTEGER DEFAULT 0,
start_date IN TIMESTAMP DEFAULT NULL,
repeat_interval IN VARCHAR2 DEFAULT NULL,
end_date IN TIMESTAMP DEFAULT NULL,
job_class IN VARCHAR2 DEFAULT &#39;DEFAULT_JOB_CLASS&#39;,
enabled IN BOOLEAN DEFAULT FALSE,
auto_drop IN BOOLEAN DEFAULT TRUE,
comments IN VARCHAR2 DEFAULT NULL);
参数解释：
job_name：作业名称。job_type：作业类型，可指定为 stored_procedure、plsql_block或plsql_command；若为 stored_procedure 则 job_action 内容为数据库存储过程名称；若为 plsql_block 则 job_action 为可执行块语句；若为plsql_command则job_action可调用包中的存储过程或存储函数。job_action：作业动作，与 job_type 相关。number_of_arguments：作业中存储过程、存储函数或包的参数个数。start_date：作业开始时间。repeat_interval：作业重复间隔说明。end_date：作业结束时间。job_class：作业类型——该参数暂时无效，预留。enabled：作业是否已激活，若该参数置为true则表示该作业默认为启用状态，作业根据其计划自动运行，若该参数置为false则该作业为禁用状态，不会自动执行，需手动执行作业或将该作业启用后方可自动执行。auto_drop：作业执行完是否自动删除。若该参数置为true则在作业完成后将自动删除作业，反之不会删除该作业。comments：作业备注说明。 参数说明：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/57e59a98d48f87b45e36db5487dc7b85/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-11-15T09:52:38+08:00" />
<meta property="article:modified_time" content="2023-11-15T09:52:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">虚谷数据库定时任务的dbms_scheduler使用方法</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>虚谷数据库提供定时作业机制，用于定时、定期、自动的进行某些操作，可通过系统包 dbms_scheduler 进行定时作业创建、调度、查看、删除等。</p> 
<p>DBMS_SCHEDULER 系统包封装了以下过程/函数：ENABLE、DISABLE、SET_JOB_ARGUMENT_VALUE、DROP_JOB、RUN_JOB。</p> 
<ul><li>DBMS_SCHEDULER.CREATE_JOB：创建作业</li><li>DBMS_SCHEDULER.ENABLE：表示启用作业。</li><li>DBMS_SCHEDULER.DISABLE：表示禁用作业。</li><li>DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE：表示对 job 调用存储过程进行参数赋值</li><li>DBMS_SCHEDULER.RUN_JOB：表示显式调用定时作业。</li><li>DBMS_SCHEDULER.DROP_JOB：表示删除定时作业。</li></ul> 
<h2><strong> 1、DBMS_SCHEDULER.CREATE_JOB使用方法</strong></h2> 
<p>DBMS_SCHEDULER.CREATE_JOB (</p> 
<p>job_name IN VARCHAR2,</p> 
<p>job_type IN VARCHAR2, job_action IN VARCHAR2,</p> 
<p>number_of_arguments IN PLS_INTEGER DEFAULT 0,</p> 
<p>start_date IN TIMESTAMP DEFAULT NULL,</p> 
<p>repeat_interval IN VARCHAR2 DEFAULT NULL,</p> 
<p>end_date IN TIMESTAMP DEFAULT NULL,</p> 
<p>job_class IN VARCHAR2 DEFAULT 'DEFAULT_JOB_CLASS',</p> 
<p>enabled IN BOOLEAN DEFAULT FALSE,</p> 
<p>auto_drop IN BOOLEAN DEFAULT TRUE,</p> 
<p>comments IN VARCHAR2 DEFAULT NULL);</p> 
<p><strong>参数解释：</strong></p> 
<ul><li>job_name：作业名称。</li><li>job_type：作业类型，可指定为 stored_procedure、plsql_block或plsql_command；若为 stored_procedure 则 job_action 内容为数据库存储过程名称；若为 plsql_block 则 job_action 为可执行块语句；若为plsql_command则job_action可调用包中的存储过程或存储函数。</li><li>job_action：作业动作，与 job_type 相关。</li><li>number_of_arguments：作业中存储过程、存储函数或包的参数个数。</li><li>start_date：作业开始时间。</li><li>repeat_interval：作业重复间隔说明。</li><li>end_date：作业结束时间。</li><li>job_class：作业类型——该参数暂时无效，预留。</li><li>enabled：作业是否已激活，若该参数置为true则表示该作业默认为启用状态，作业根据其计划自动运行，若该参数置为false则该作业为禁用状态，不会自动执行，需手动执行作业或将该作业启用后方可自动执行。</li><li>auto_drop：作业执行完是否自动删除。若该参数置为true则在作业完成后将自动删除作业，反之不会删除该作业。</li><li>comments：作业备注说明。</li></ul> 
<p><strong>参数说明：</strong></p> 
<ul><li> <p>repeat_interval 结构为 REPEAT_INTERVAL=&gt;’Freq=Minutely;Interval=5’ Freq 关键字用于指定作业间隔的时间周期，可选参数包括：YEARLY(年)、MONTHLY(月)、WEEKLY(周)、DAILY(日)、HOURLY(小时)、MINUTELY(分)、SECONDLY(秒)。</p> </li><li> <p>Interval 关键字用于指定作业间隔频度，该值为一个整数，默认为 1，可指定范围为 1-999。</p> </li><li> <p>repeat_interval 参数除了以上两个限制条件外，还可指定：</p> 
  <ul><li>BYHOUR：指示定时作业在指定小时执行，可指定范围 0-23，若要指定多个时间参数使用逗号进行分割，如 BYHOUR=2,5,7。</li><li>BYDAY：指示在每周的第几天运行，可使用数字或英文缩写，如：MON|TUE|WED|THU|FRI|SAT|SUN 等。</li><li>BYMONTHDAY：指示在每月的第几天运行。</li><li>BYMONTH：指示在每年的月份，可使用数字或英文缩写，如：JAN|FEB|MAR|APR|MAY|JUN 等。</li></ul></li></ul> 
<p><strong>下面的样例是基于存储过程每隔三十秒执行一次的定时任务</strong></p> 
<p>EXEC dbms_scheduler.create_job(<br>   'job1',<br>   'stored_procedure',<br>   'JOB_PROC1',<br>   2,<br>   sysdate,<br>   'freq=secondly ; INTERVAL=30;',<br>   '2029-01-01 01:00:00',<br>   'default_class',<br>   TRUE,<br>   TRUE,<br>   '这是一个测试'); </p> 
<h2><strong>2、DBMS_SCHEDULER.ENABLE，DBMS_SCHEDULER.DISABLE 使用方法：</strong></h2> 
<p>DBMS_SCHEDULER.ENABLE ( name IN VARCHAR2); </p> 
<p>DBMS_SCHEDULER.DISABLE ( name IN VARCHAR2, force IN BOOLEAN DEFAULT FALSE);</p> 
<p><strong>参数解释：</strong></p> 
<ul><li>name：禁用或启用的作业名称。</li><li>force：如果设置为true则需先停止正在运行的作业实例，再禁用作业；如果设置为false则允许正在运行的作业执行完成，然后再禁用作业。</li></ul> 
<p><strong>如果在创建任务的时候参数enabled 选择了true,则不需要执行该命令，查看是否启动可取系统表验证该任务处于启用还是禁用。</strong></p> 
<p>SELECT<br>     t.db_name,<br>     j.schema_name,<br>     s.job_name,s.ENABLE<br> FROM<br>     dba_jobs s ,<br>     dba_databases t,<br>     dba_schemas j<br> WHERE<br>     s.db_id = t.db_id<br>     AND s.user_id = j.schema_id<br>     AND s.job_name = '作业名'<br>     AND t.db_name = '库名'<br>     AND j.schema_name = '模式名'；</p> 
<h2 style="background-color:transparent;"><strong>3、DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE 使用方法</strong></h2> 
<p>DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE ( job_name IN VARCHAR2,</p> 
<p>argument_position IN PLS_INTEGER,</p> 
<p>argument_value IN VARCHAR2);</p> 
<p>DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE ( job_name IN VARCHAR2,</p> 
<p>argument_name IN VARCHAR2,</p> 
<p>argument_value IN VARCHAR2);</p> 
<p><strong>参数解释：</strong></p> 
<ul><li>job_name：需要设置参数的作业名称。</li><li>argument_position：需要设置参数值的参数位置。</li><li>argument_name：需要设置参数值的参数名称。</li><li>argument_value：设置的参数值，该处根据参数值类型自动选择重载的存储过程。</li></ul> 
<p><strong>该任务是单个参数的情况：</strong></p> 
<p>exec DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE('job1'--作业名</p> 
<p>,'INPUT'--参数名</p> 
<p>,7000--参数值</p> 
<p>);</p> 
<p><strong>或者：</strong></p> 
<p>exec DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE('job1',</p> 
<p>1,--参数位置</p> 
<p>7000--参数值</p> 
<p>);</p> 
<p><strong>该任务是多个参数的情况：</strong></p> 
<p>exec DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE('job1'--作业名</p> 
<p>,'INPUT'--参数名</p> 
<p>,7000--参数值</p> 
<p>);<br>  exec DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE('job1',--作业名</p> 
<p>'dat',--参数名</p> 
<p>sysdate--参数值</p> 
<p>);</p> 
<p><strong>或者：</strong></p> 
<p>exec DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE('job1',--作业名</p> 
<p>1,--参数位置</p> 
<p>7000--参数值</p> 
<p>);</p> 
<p><br> exec DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE('job1',--作业名</p> 
<p>2,--参数位置</p> 
<p>sysdate--参数值</p> 
<p>);</p> 
<p>PS:如果参数值需要重新执行DBMS_SCHEDULER.SET_JOB_ARGUMENT_VALUE命令定义参数值，如果需要立刻启动任务则执行<strong>DBMS_SCHEDULER.RUN_JOB，否则它会在下一个周期生效。</strong></p> 
<h2><strong>4、DBMS_SCHEDULER.RUN_JOB使用方法 </strong></h2> 
<p>DBMS_SCHEDULER.RUN_JOB ( job_name IN VARCHAR2, use_current_session IN BOOLEAN DEFAULT TRUE);</p> 
<p><strong>参数解释：</strong></p> 
<ul><li>job_name：调用的作业名称。</li><li>use_current_session：参数选用true时表示使用当前会话执行该作业，若作业未执行完成则当前连接会话一直处于阻塞状态直至作业完成后方可执行其他SQL；若参数选用false则表示使用其他会话执行该作业，当前会话可继续执行其他SQL。</li></ul> 
<p> 样例：</p> 
<p>exec DBMS_SCHEDULER.RUN_JOB ( 'job_name');</p> 
<h2><strong>5、DBMS_SCHEDULER.DROP_JOB使用方法</strong></h2> 
<p>DBMS_SCHEDULER.DROP_JOB ( job_name IN VARCHAR2, force IN BOOLEAN DEFAULT FALSE);</p> 
<p><strong>参数解释：</strong></p> 
<ul><li>job_name：删除的作业名称。</li><li>force：如果设置为true则需先停止正在运行的作业实例，再删除作业；如果设置为false则允许正在运行的作业执行完成，然后再删除这些作业。</li></ul> 
<p>样例：</p> 
<p> exec DBMS_SCHEDULER.DROP_JOB ( 'job_name');</p> 
<h2><strong>6、系统表查询：</strong></h2> 
<p>SELECT<br>     t.db_name,<br>     j.schema_name,<br>     s.*<br> FROM<br>     dba_jobs s ,<br>     dba_databases t,<br>     dba_schemas j<br> WHERE<br>     s.db_id = t.db_id<br>     AND s.user_id = j.schema_id<br>     AND s.job_name = '作业名'<br>     AND t.db_name = '库名'<br>     AND j.schema_name = '模式名'； </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aefbebfcf4c204981955e9c89d158900/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">《红蓝攻防对抗实战》十三.内网穿透之利用HTTP协议进行隧道穿透</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/570b98f9107274b401f04f55ce39b474/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Excel·VBA合并工作簿</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>