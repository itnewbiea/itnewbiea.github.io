<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>c语言结构体成员赋值失败,objective-c - C语言在使用中遇到了一个结构体赋值失败的问题？... - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="c语言结构体成员赋值失败,objective-c - C语言在使用中遇到了一个结构体赋值失败的问题？..." />
<meta property="og:description" content="我有一个A类：
定义了一个结构体
typedef struct
{
int sockfd;
on_av_frame_cb av_frame_cb;
on_av_frame_cb rtp_cb;
on_error_cb error_cb;
uint8_t *p_buf;
uint8_t *v_buf;
uint8_t *a_buf;
int rtp_flag;
}udp_client_t;
然后我再B类中调用：
static udp_client_t client;
int jldv_create_client(int src_port,int port ,const char *dst_ip){
udp_client_t *udpClient = &amp;client;
assert(udpClient != NULL);
const char *c_ip = dst_ip;
memset(udpClient, 0, sizeof(udp_client_t));
int ret = create_client(src_port, port, c_ip, &amp;udpClient);
if (ret != 0) {
goto err_output;
}
udpClient-&gt;av_frame_cb = (on_av_frame_cb )onVideoFrame;
udpClient-&gt;error_cb = on_error;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/68d581cb9e617b1a3cca38c61cc5037c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-05-21T03:09:51+08:00" />
<meta property="article:modified_time" content="2021-05-21T03:09:51+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">c语言结构体成员赋值失败,objective-c - C语言在使用中遇到了一个结构体赋值失败的问题？...</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div style="font-size:16px;"> 
 <p>我有一个A类：</p> 
 <p>定义了一个结构体</p> 
 <p>typedef struct</p> 
 <p>{<!-- --></p> 
 <p>int sockfd;</p> 
 <p>on_av_frame_cb av_frame_cb;</p> 
 <p>on_av_frame_cb rtp_cb;</p> 
 <p>on_error_cb error_cb;</p> 
 <p>uint8_t *p_buf;</p> 
 <p>uint8_t *v_buf;</p> 
 <p>uint8_t *a_buf;</p> 
 <p>int rtp_flag;</p> 
 <p>}udp_client_t;</p> 
 <p>然后我再B类中调用：</p> 
 <p>static udp_client_t client;</p> 
 <p>int jldv_create_client(int src_port,int port ,const char *dst_ip){<!-- --></p> 
 <p>udp_client_t *udpClient = &amp;client;</p> 
 <p>assert(udpClient != NULL);</p> 
 <p>const char *c_ip = dst_ip;</p> 
 <p>memset(udpClient, 0, sizeof(udp_client_t));</p> 
 <p>int ret = create_client(src_port, port, c_ip, &amp;udpClient);</p> 
 <p>if (ret != 0) {<!-- --></p> 
 <p>goto err_output;</p> 
 <p>}</p> 
 <p>udpClient-&gt;av_frame_cb = (on_av_frame_cb )onVideoFrame;</p> 
 <p>udpClient-&gt;error_cb = on_error;</p> 
 <p>if (rtp_create(&amp;udpClient) &lt; 0) { ///问题所在之处</p> 
 <p>goto err_output;</p> 
 <p>}</p> 
 <p>printf("rtp_client:%d \n",udpClient-&gt;rtp_flag);</p> 
 <p>return 0;</p> 
 <p>err_output:</p> 
 <p>destroy_client(udpClient);</p> 
 <p>return -1;</p> 
 <p>}</p> 
 <p>在上述的问题所在之处中，我使用了C类的方法：</p> 
 <p>int rtp_create(udp_client_t **data)</p> 
 <p>{<!-- --></p> 
 <p>logi("%s", __func__);</p> 
 <p>udp_client_t *udpClient = *data;</p> 
 <p>if(udpClient)</p> 
 <p>{<!-- --></p> 
 <p>udpClient-&gt;rtp_flag = 1;</p> 
 <p>memset(&amp;rtp_cxt, 0, sizeof(rtp_context_t));</p> 
 <p>int ret = init_server();</p> 
 <p>if (ret &lt; 0)</p> 
 <p>{<!-- --></p> 
 <p>return -1;</p> 
 <p>}</p> 
 <p>rtp_cxt.nalu = alloc_nalu(MAX_FRAME_SIZE);//为结构体nalu_t及其成员buf分配空间。返回值为指向nalu_t存储空间的指针</p> 
 <p>if (!rtp_cxt.nalu)</p> 
 <p>{<!-- --></p> 
 <p>loge("alloc nalu failed");</p> 
 <p>return -2;</p> 
 <p>}</p> 
 <p>}</p> 
 <p>else</p> 
 <p>{<!-- --></p> 
 <p>loge("%s: data is null", __func__);</p> 
 <p>return -3;</p> 
 <p>}</p> 
 <p>printf("udpClient after==&gt;%d \n",udpClient-&gt;rtp_flag);</p> 
 <p>return 0;</p> 
 <p>}</p> 
 <p>然而打印的结果却是：</p> 
 <p>udpClient after==&gt;1</p> 
 <p>rtp_client:0</p> 
 <p>这是为什么？</p> 
 <p>是我使用的不对吗？求解各位大神。。</p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/dfe5d44509d82e6c8f3748c40581ade9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">2021-05-20 Matlab实现傅里叶变换</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/acab22a92860f2ad23da6937efe367ac/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Hive中orderBy，sortBy，distribute by，cluster by，group by</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>