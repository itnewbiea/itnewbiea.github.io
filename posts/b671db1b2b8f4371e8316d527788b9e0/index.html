<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android Studio aar包的使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android Studio aar包的使用" />
<meta property="og:description" content="Android Studio生成的aar可以包含所有的资源文件，包括res资源和class文件等，如果有so文件或者依赖的jar包也会打包进去。但是如果项目有依赖的aar则不会被打包进去（这点目前无法解决，除非拿到源码重新编译），AS当中只有library module才能编译生成aar包。
编译生成aar执行Build Project或者在右边的gradle栏中选中对应的library module然后执行对应的assemble命令即可。 编译完成以后会在对应的module下面的/build/outputs/aar/下面生成aar包： 如果你执行的是Build操作那可能生成的aar包只有debug包，如果你执行的是assemble操作，则对应目录下会生成debug和release包，其中release包也是可以配置混淆的（如果想要减少aar包的体积或者不想让别人看到源码）。
使用aar包时一般将对应的aar复制到app module下面的libs下面，然后在gradle里面android下面添加配置：
android{ ...... repositories { flatDir { //第一个libs是主项目的libs,其他module的libs路径需要用逗号隔开../module名/libs dirs &#39;libs&#39;, &#39;../base_lib/libs&#39; } } } 这里注意要的是如果项目中app所依赖的library module中也使用了aar包，那么在app的gradle中配置时需要将依赖library的libs目录也配置进去否则会编译出错。另外如果你要生成aar包的module也依赖其他的module或者aar, 则相关依赖的module或者aar也要添加到app module中进行依赖。
即app依赖A， A依赖B和C.aar，则使用A.aar时需同时将B（可以选择生成B.aar或者直接依赖）和C.aar添加到app的依赖，如果选择app直接依赖B，而B中也使用了aar，那么也要在app中配置B的aar目录。
还有一种方式是在Project 根目录下的 build.gradle 中的 repositories 中添加相应的引用如下：
allprojects { repositories { jcenter() flatDir { // 由于Library module中引用了 gif 库的 aar，在多 module 的情况下， // 其他的module编译会报错，所以需要在所有工程的repositories // 下把Library module中的libs目录添加到依赖关系中 dirs project(&#39;:AppLibrary&#39;).file(&#39;libs&#39;) } } } AS中目前无法将library中所使用的所有相关aar包一并打包进去，使用的时候需注意这一点。这篇文章(点击跳转)说可以解决一次性打包所有aar不过我没有试过。
然后在dependencies里配置：
dependencies { ...... implementation(name:&#39;base_lib-release&#39;, ext:&#39;aar&#39;) } AS3.0以前使用的compile，3.0以后都使用implementation关键字进行编译。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b671db1b2b8f4371e8316d527788b9e0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-24T10:20:13+08:00" />
<meta property="article:modified_time" content="2018-04-24T10:20:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android Studio aar包的使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><font color="black">Android Studio生成的aar可以包含所有的资源文件，包括res资源和class文件等，如果有so文件或者依赖的jar包也会打包进去。但是如果项目有依赖的aar则不会被打包进去（这点目前无法解决，除非拿到源码重新编译），AS当中只有library module才能编译生成aar包。</font></p> 
<p><font color="black">编译生成aar执行Build Project或者在右边的gradle栏中选中对应的library module然后执行对应的assemble命令即可。</font> <br> <img src="https://images2.imgbox.com/0f/bd/vqRqIgKV_o.jpg" width="70%"> <br> <font color="black">编译完成以后会在对应的module下面的/build/outputs/aar/下面生成aar包：</font> <br> <img src="https://images2.imgbox.com/3e/25/8pTzst6X_o.jpg" width="35%"> <br> <font color="black">如果你执行的是Build操作那可能生成的aar包只有debug包，如果你执行的是assemble操作，则对应目录下会生成debug和release包，其中release包也是可以配置混淆的（如果想要减少aar包的体积或者不想让别人看到源码）。</font></p> 
<p><font color="black">使用aar包时一般将对应的aar复制到app module下面的libs下面，然后在gradle里面android下面添加配置：</font></p> 
<pre class="prettyprint"><code class=" hljs ruby">android{
    ......
    repositories {
        flatDir {
            <span class="hljs-regexp">//</span>第一个libs是主项目的libs,其他<span class="hljs-class"><span class="hljs-keyword">module</span>的<span class="hljs-title">libs</span>路径需要用逗号隔开../<span class="hljs-title">module</span>名/<span class="hljs-title">libs</span></span>
            dirs <span class="hljs-string">'libs'</span>, <span class="hljs-string">'../base_lib/libs'</span>
        }
    }
}</code></pre> 
<p><font color="black">这里注意要的是如果项目中app所依赖的library module中也使用了aar包，那么在app的gradle中配置时需要将依赖library的libs目录也配置进去否则会编译出错。另外如果你要生成aar包的module也依赖其他的module或者aar, 则相关依赖的module或者aar也要添加到app module中进行依赖。</font></p> 
<p><font color="black">即app依赖A， A依赖B和C.aar，则使用A.aar时需同时将B（可以选择生成B.aar或者直接依赖）和C.aar添加到app的依赖，如果选择app直接依赖B，而B中也使用了aar，那么也要在app中配置B的aar目录。</font></p> 
<p><font color="black">还有一种方式是在Project 根目录下的 build.gradle 中的 repositories 中添加相应的引用如下：</font></p> 
<pre class="prettyprint"><code class=" hljs haskell"><span class="hljs-title">allprojects</span> {
    repositories {
        jcenter()

        flatDir {
            // 由于<span class="hljs-type">Library</span> <span class="hljs-module"><span class="hljs-keyword">module</span>中引用了 gif 库的 aar，在多 <span class="hljs-keyword">module</span> 的情况下，
            // 其他的<span class="hljs-keyword">module</span>编译会报错，所以需要在所有工程的repositories
            // 下把Library <span class="hljs-keyword">module</span>中的libs目录添加到依赖关系中
            dirs project<span class="hljs-container">(':<span class="hljs-type">AppLibrary</span>')</span>.file<span class="hljs-container">('<span class="hljs-title">libs'</span>)</span> 
        }
    }
}</span></code></pre> 
<p><font color="black">AS中目前无法将library中所使用的所有相关aar包一并打包进去，使用的时候需注意这一点。<a href="http://hugozhu.myalert.info/2014/11/05/52-assemble-aar-with-all-dependencies-with-gradle.html" rel="nofollow">这篇文章(点击跳转)</a>说可以解决一次性打包所有aar不过我没有试过。</font></p> 
<p><font color="black">然后在dependencies里配置：</font></p> 
<pre class="prettyprint"><code class=" hljs lasso">dependencies {
    <span class="hljs-attribute">...</span><span class="hljs-attribute">...</span>
    implementation(name:<span class="hljs-string">'base_lib-release'</span>, ext:<span class="hljs-string">'aar'</span>)
}</code></pre> 
<p><font color="black">AS3.0以前使用的compile，3.0以后都使用implementation关键字进行编译。</font></p> 
<p><font color="black">如果你使用的aar是release的并且混淆了，假如你有对应源码的话，在查看aar中的某个类源码时，点击进去然后在右上角可以选择添加源码路径：</font> <br> <img src="https://images2.imgbox.com/2d/9b/mmYREu1c_o.jpg" alt="这里写图片描述" title=""> <br> <font color="black">点击choose sources选择对应的源码路径，这样添加了以后就可以看到源码了并且debug时也能进到源码里面，但是使用aar包的方式在debug时只能由app中的断点进入而不能直接在aar包对应的源码中添加断点，这也是aar不方便的一个地方。</font></p> 
<p><font color="black">另外，当你想要更换对应的libs下面的aar包的时候，一般情况下直接copy新的aar包替换掉老的即可，但我在使用的过程中发现有时这样不会起作用，替换了aar包之后代码里引用的还是老的aar包的代码，比如我新加的方法一直找不到，这个时候可能需要一些特殊操作，我的尝试是在右边gradle栏点击cleanBuild Cache之后然后点击刷新的按钮：</font> <br> <img src="https://images2.imgbox.com/6a/77/Rrls9yRI_o.jpg" width="70%"> <br> <font color="black">如果还不行，就多点几次刷新按钮，如果还是不行就只能手动删除对应的缓存文件了，我的AS缓存配置是在D盘，对应的aar包缓存目录是在D:\Android.gradle\caches\transforms-1\files-1.1\base_lib-release.aar/下面：</font> <br> <img src="https://images2.imgbox.com/cb/e1/4Yga6wDP_o.jpg" alt="这里写图片描述" title=""> <br> <font color="black">可以看到对应的base_lib-release.aar目录下面有很多的缓存文件，这可能是不同项目引用同一个aar包的缓存，我们将该目录下的缓存都删掉，然后重新到项目中执行cleanBuild Cache和刷新操作，这样aar缓存应该会更新为最新的了，app中可以引用aar中的代码了。</font></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d47b2ecf3d4b4a5b462967f7ff3eea11/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Silicon Labs完成对Sigma Designs 公司Z-Wave事业单位的收购</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/71010b1f8519b61202d5dc0a4a5ef5f2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Servlet中通过request获取不到具体参数</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>