<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>图片上传与回显 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="图片上传与回显" />
<meta property="og:description" content="图片上传与回显 上传 前端页面就不展示了，就是普通的ajax请求，具体可以参照饿了吗-UI。
参数 ：MultipartFile file
if (file.isEmpty()){ return Result.error(&#34;请上传文件&#34;); } long currentTime = System.currentTimeMillis(); Date date = new Date(currentTime); //创建Date对象并传入毫秒值 SimpleDateFormat sdf = new SimpleDateFormat(&#34;yyyy-MM-dd&#34;); //自定义日期格式 String formattedDateTime = sdf.format(date); //截取后缀 String fileName = file.getOriginalFilename(); if (fileName == null) { return Result.error(&#34;不能为空&#34;); } int lastDotIndex = fileName.lastIndexOf(&#39;.&#39;); String fileExtension = fileName.substring(lastDotIndex); if (!(&#34;.jpg&#34;.equals(fileExtension)||&#34;.png&#34;.equals(fileExtension)||&#34;.pdf&#34;.equals(fileExtension))) return Result.error(&#34;图片格式不对&#34;); UUID uuid = UUID.randomUUID(); String string = uuid.toString().replaceAll(&#34;-&#34;,&#34;&#34;); //保存地址 String path = 物理地址&#43;formattedDateTime&#43;&#34;\\&#34;&#43;string&#43;fileExtension; //返回地址 String url = 域名或者ip地址&#43;formattedDateTime&#43;&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cc67c32d82a57a4d0994d0a028c9dd79/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-27T14:27:47+08:00" />
<meta property="article:modified_time" content="2023-12-27T14:27:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">图片上传与回显</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="_0"></a>图片上传与回显</h2> 
<h3><a id="_1"></a>上传</h3> 
<p>前端页面就不展示了，就是普通的ajax请求，具体可以参照饿了吗-UI。</p> 
<blockquote> 
 <p>参数 ：MultipartFile file</p> 
</blockquote> 
<pre><code class="prism language-java">  		<span class="token keyword">if</span> <span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"请上传文件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">long</span> currentTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Date</span> date <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span>currentTime<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//创建Date对象并传入毫秒值</span>
        <span class="token class-name">SimpleDateFormat</span> sdf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SimpleDateFormat</span><span class="token punctuation">(</span><span class="token string">"yyyy-MM-dd"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//自定义日期格式</span>
        <span class="token class-name">String</span> formattedDateTime <span class="token operator">=</span> sdf<span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>date<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//截取后缀</span>
        <span class="token class-name">String</span> fileName <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getOriginalFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>fileName <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"不能为空"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">int</span> lastDotIndex <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">lastIndexOf</span><span class="token punctuation">(</span><span class="token char">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> fileExtension <span class="token operator">=</span> fileName<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span>lastDotIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token string">".jpg"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileExtension<span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">".png"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileExtension<span class="token punctuation">)</span><span class="token operator">||</span><span class="token string">".pdf"</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>fileExtension<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"图片格式不对"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">UUID</span> uuid <span class="token operator">=</span> <span class="token constant">UUID</span><span class="token punctuation">.</span><span class="token function">randomUUID</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> string <span class="token operator">=</span> uuid<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">replaceAll</span><span class="token punctuation">(</span><span class="token string">"-"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">//保存地址</span>
        <span class="token class-name">String</span> path <span class="token operator">=</span> 物理地址<span class="token operator">+</span>formattedDateTime<span class="token operator">+</span><span class="token string">"\\"</span><span class="token operator">+</span>string<span class="token operator">+</span>fileExtension<span class="token punctuation">;</span>
       
        <span class="token comment">//返回地址</span>
        <span class="token class-name">String</span> url <span class="token operator">=</span> 域名或者ip地址<span class="token operator">+</span>formattedDateTime<span class="token operator">+</span><span class="token string">"/"</span><span class="token operator">+</span>string<span class="token operator">+</span>fileExtension<span class="token punctuation">;</span>

        <span class="token class-name">File</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">File</span> fileParent <span class="token operator">=</span> f<span class="token punctuation">.</span><span class="token function">getParentFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>fileParent<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//如果文件夹不存在则创建文件夹</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"文件夹不存在,新建目录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            fileParent<span class="token punctuation">.</span><span class="token function">mkdirs</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
            file<span class="token punctuation">.</span><span class="token function">transferTo</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"上传失败"</span><span class="token operator">+</span> e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">"上传失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token class-name">Result</span><span class="token punctuation">.</span><span class="token function">success</span><span class="token punctuation">(</span><span class="token string">"上传成功"</span><span class="token punctuation">,</span>url<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="_49"></a>回显</h3> 
<p>好了，问题来了。怎么将IP地址（127.0.0.1）映射到物理地址（C：某某某/某某某）呢？<br> 这就不得不提到NGINX这个东西了。PS：我被它折磨了好多天。<br> 如果启动了 nginx，然后中途修改配置文件，记得先关闭nginx再重新启动。<br> 在server加入</p> 
<pre><code class="prism language-xml"> server {
        listen       80;
        server_name  localhost;
		location ~ .*\.*(jpg|png|gif|jpeg)$ {
            root  物理地址;
        }}
</code></pre> 
<p>这上面的意思是拦截后缀为jpg、png、gif、jpeg的请求，将localhost换成物理地址。当然localhost也能换成IP地址或者域名使用，这就得看自己的需求了。例子：<code>localhost:80/img/test.jpg</code> 等同于 <code>物理地址/img/test.jpg</code>。<br> 前端使用<code>&lt;img url = " "/&gt;</code>就能访问到图片了。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/bee9f29884505e7f066600d2bbe7a866/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">代码编辑器,代码（JSON，js，Markdown，html，css，java，sql）格式化 fei-editor</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4c10f2dd85eee52cc50ab6472db04608/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">软件测试工程师：面试题与经验分享</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>