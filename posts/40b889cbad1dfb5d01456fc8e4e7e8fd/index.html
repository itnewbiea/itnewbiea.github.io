<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>详细的docker部署nacos - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="详细的docker部署nacos" />
<meta property="og:description" content="目录
一、mysql安装与基本操作
一、mysql安装
1、拉取mysql镜像
​
2、定义挂载目录
3、配置my.cnf（my.ini）
4、开启mysql容器
5、用navicat连接工具连接远程端口
6、nacos数据库配置，创建一个nacos数据库，运行一下语句
7、连接成功之后，要到docker容器中进行测试
二、nacos服务部署以及单个nacos服务搭建 1、拉取镜像
​
2、启动nacos
​
3、进行nacos数据持久化测试
​ 4、在控制台获得nacos配置
三、nacos集群搭建
1、先移除所有的容器
2、创建一个以自定义网路的mysql容器
3、创建集群中的服务
​
4、实现nginx反向代理（负载均衡）
4.1、方式一
​
4.2、方式二 一、mysql安装与基本操作
一、mysql安装
1、拉取mysql镜像
docker pull mysql:8.0.27
2、定义挂载目录
在/home/mysql目录下新建两个文件夹，一个叫data另一个叫conf
命令形式：
mkdir -p /home/mysql/{data,conf}
手动创建： 3、配置my.cnf（my.ini）
data—&gt;my.cnf:
[mysqld]
#Mysql服务的唯一编号 每个mysql服务Id需唯一
server-id=1
#服务端口号 默认3306
port=3306
#mysql安装根目录（default /usr）
#basedir=/usr/local/mysql
#mysql数据文件所在位置
datadir=/var/lib/mysql
#pid
pid-file=/var/run/mysqld/mysqld.pid
#设置socke文件所在目录
socket=/var/lib/mysql/mysql.sock
#设置临时目录
#tmpdir=/tmp
# 用户
user=mysql
# 允许访问的IP网段
bind-address=0.0.0.0
# 跳过密码登录" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/40b889cbad1dfb5d01456fc8e4e7e8fd/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-11T10:44:02+08:00" />
<meta property="article:modified_time" content="2023-08-11T10:44:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">详细的docker部署nacos</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>目录</p> 
<p>一、mysql安装与基本操作</p> 
<p>一、mysql安装</p> 
<p>1、拉取mysql镜像</p> 
<p>​</p> 
<p>2、定义挂载目录</p> 
<p>3、配置my.cnf（my.ini）</p> 
<p>4、开启mysql容器</p> 
<p>5、用navicat连接工具连接远程端口</p> 
<p>6、nacos数据库配置，创建一个nacos数据库，运行一下语句</p> 
<p>7、连接成功之后，要到docker容器中进行测试</p> 
<p>二、nacos服务部署以及单个nacos服务搭建 </p> 
<p>        1、拉取镜像</p> 
<p>​</p> 
<p>        2、启动nacos</p> 
<p>​</p> 
<p>        3、进行nacos数据持久化测试</p> 
<p>​        4、在控制台获得nacos配置</p> 
<p>三、nacos集群搭建</p> 
<p>            1、先移除所有的容器</p> 
<p>            2、创建一个以自定义网路的mysql容器</p> 
<p>            3、创建集群中的服务</p> 
<p>​</p> 
<p>            4、实现nginx反向代理（负载均衡）</p> 
<p>                        4.1、方式一</p> 
<p>​</p> 
<p>                        4.2、方式二 </p> 
<p>一、mysql安装与基本操作<br> 一、mysql安装<br> 1、拉取mysql镜像<br> docker pull mysql:8.0.27</p> 
<p><br> 2、定义挂载目录<br> 在/home/mysql目录下新建两个文件夹，一个叫data另一个叫conf</p> 
<p>命令形式：</p> 
<p>mkdir -p /home/mysql/{data,conf}</p> 
<p>手动创建： </p> 
<p>3、配置my.cnf（my.ini）<br> data—&gt;my.cnf:</p> 
<p>[mysqld]<br> #Mysql服务的唯一编号 每个mysql服务Id需唯一<br> server-id=1</p> 
<p>#服务端口号 默认3306<br> port=3306</p> 
<p>#mysql安装根目录（default /usr）<br> #basedir=/usr/local/mysql</p> 
<p>#mysql数据文件所在位置<br> datadir=/var/lib/mysql</p> 
<p>#pid<br> pid-file=/var/run/mysqld/mysqld.pid</p> 
<p>#设置socke文件所在目录<br> socket=/var/lib/mysql/mysql.sock</p> 
<p>#设置临时目录<br> #tmpdir=/tmp</p> 
<p># 用户<br> user=mysql</p> 
<p># 允许访问的IP网段<br> bind-address=0.0.0.0</p> 
<p># 跳过密码登录<br> #skip-grant-tables</p> 
<p>#主要用于MyISAM存储引擎,如果多台服务器连接一个数据库则建议注释下面内容<br> #skip-external-locking</p> 
<p>#只能用IP地址检查客户端的登录，不用主机名<br> #skip_name_resolve=1</p> 
<p>#事务隔离级别，默认为可重复读，mysql默认可重复读级别（此级别下可能参数很多间隙锁，影响性能）<br> #transaction_isolation=READ-COMMITTED</p> 
<p>#数据库默认字符集,主流字符集支持一些特殊表情符号（特殊表情符占用4个字节）<br> character-set-server=utf8mb4</p> 
<p>#数据库字符集对应一些排序等规则，注意要和character-set-server对应<br> collation-server=utf8mb4_general_ci</p> 
<p>#设置client连接mysql时的字符集,防止乱码<br> init_connect='SET NAMES utf8mb4'</p> 
<p>#是否对sql语句大小写敏感，1表示不敏感<br> lower_case_table_names=1</p> 
<p>#最大连接数<br> max_connections=400</p> 
<p>#最大错误连接数<br> max_connect_errors=1000</p> 
<p>#TIMESTAMP如果没有显示声明NOT NULL，允许NULL值<br> explicit_defaults_for_timestamp=true</p> 
<p>#SQL数据包发送的大小，如果有BLOB对象建议修改成1G<br> max_allowed_packet=128M</p> 
<p>#MySQL连接闲置超过一定时间后(单位：秒)将会被强行关闭<br> #MySQL默认的wait_timeout  值为8个小时, interactive_timeout参数需要同时配置才能生效<br> interactive_timeout=1800<br> wait_timeout=1800</p> 
<p>#内部内存临时表的最大值 ，设置成128M。<br> #比如大数据量的group by ,order by时可能用到临时表，<br> #超过了这个值将写入磁盘，系统IO压力增大<br> tmp_table_size=134217728<br> max_heap_table_size=134217728</p> 
<p>#禁用mysql的缓存查询结果集功能<br> #后期根据业务情况测试决定是否开启<br> #大部分情况下关闭下面两项<br> #query_cache_size = 0<br> #query_cache_type = 0<br>  <br> #数据库错误日志文件<br> #log-error=/var/log/mysqld.log</p> 
<p>#慢查询sql日志设置<br> #slow_query_log=1<br> #slow_query_log_file=/var/log/mysqld_slow.log</p> 
<p>#检查未使用到索引的sql<br> log_queries_not_using_indexes=1</p> 
<p>#针对log_queries_not_using_indexes开启后，记录慢sql的频次、每分钟记录的条数<br> log_throttle_queries_not_using_indexes=5</p> 
<p>#作为从库时生效,从库复制中如何有慢sql也将被记录<br> log_slow_slave_statements=1</p> 
<p>#慢查询执行的秒数，必须达到此值可被记录<br> long_query_time=8</p> 
<p>#检索的行数必须达到此值才可被记为慢查询<br> min_examined_row_limit=100</p> 
<p>#mysql binlog日志文件保存的过期时间，过期后自动删除<br> #expire_logs_days=5<br> binlog_expire_logs_seconds=604800</p> 
<p>4、开启mysql容器<br> docker run -itd -p 2333:3306  \</p> 
<p> --name mysql \<br>  -v /home/mysql/conf/my.cnf:/etc/my.cnf \<br>  -v /home/mysql/data:/var/lib/mysql  \<br>  --privileged=true \<br>  --restart=always  \<br>  -e MYSQL_ROOT_PASSWORD=root123 \<br>  -d mysql:8.0.27</p> 
<p>对于上述语句中命令解释：</p> 
<p>创建容器成功： </p> 
<p>5、用navicat连接工具连接远程端口</p> 
<p><br>  如果连接失败，报2003或者2059错误:自己博客中也写了</p> 
<p>mysql远程连接报2003和2059错误（Docker篇）_m0_53151031的博客-CSDN博客</p> 
<p>6、nacos数据库配置，创建一个nacos数据库，运行一下语句<br>  /*<br>  * Copyright 1999-2018 Alibaba Group Holding Ltd.<br>  *<br>  * Licensed under the Apache License, Version 2.0 (the "License");<br>  * you may not use this file except in compliance with the License.<br>  * You may obtain a copy of the License at<br>  *<br>  *      http://www.apache.org/licenses/LICENSE-2.0<br>  *<br>  * Unless required by applicable law or agreed to in writing, software<br>  * distributed under the License is distributed on an "AS IS" BASIS,<br>  * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.<br>  * See the License for the specific language governing permissions and<br>  * limitations under the License.<br>  */</p> 
<p>/******************************************/<br> /*   数据库全名 = nacos_config   */<br> /*   表名称 = config_info   */<br> /******************************************/<br> CREATE TABLE `config_info` (<br>   `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',<br>   `data_id` varchar(255) NOT NULL COMMENT 'data_id',<br>   `group_id` varchar(255) DEFAULT NULL,<br>   `content` longtext NOT NULL COMMENT 'content',<br>   `md5` varchar(32) DEFAULT NULL COMMENT 'md5',<br>   `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',<br>   `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',<br>   `src_user` text COMMENT 'source user',<br>   `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',<br>   `app_name` varchar(128) DEFAULT NULL,<br>   `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',<br>   `c_desc` varchar(256) DEFAULT NULL,<br>   `c_use` varchar(64) DEFAULT NULL,<br>   `effect` varchar(64) DEFAULT NULL,<br>   `type` varchar(64) DEFAULT NULL,<br>   `c_schema` text,<br>   PRIMARY KEY (`id`),<br>   UNIQUE KEY `uk_configinfo_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info';</p> 
<p>/******************************************/<br> /*   数据库全名 = nacos_config   */<br> /*   表名称 = config_info_aggr   */<br> /******************************************/<br> CREATE TABLE `config_info_aggr` (<br>   `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',<br>   `data_id` varchar(255) NOT NULL COMMENT 'data_id',<br>   `group_id` varchar(255) NOT NULL COMMENT 'group_id',<br>   `datum_id` varchar(255) NOT NULL COMMENT 'datum_id',<br>   `content` longtext NOT NULL COMMENT '内容',<br>   `gmt_modified` datetime NOT NULL COMMENT '修改时间',<br>   `app_name` varchar(128) DEFAULT NULL,<br>   `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',<br>   PRIMARY KEY (`id`),<br>   UNIQUE KEY `uk_configinfoaggr_datagrouptenantdatum` (`data_id`,`group_id`,`tenant_id`,`datum_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='增加租户字段';</p> 
<p><br> /******************************************/<br> /*   数据库全名 = nacos_config   */<br> /*   表名称 = config_info_beta   */<br> /******************************************/<br> CREATE TABLE `config_info_beta` (<br>   `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',<br>   `data_id` varchar(255) NOT NULL COMMENT 'data_id',<br>   `group_id` varchar(128) NOT NULL COMMENT 'group_id',<br>   `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',<br>   `content` longtext NOT NULL COMMENT 'content',<br>   `beta_ips` varchar(1024) DEFAULT NULL COMMENT 'betaIps',<br>   `md5` varchar(32) DEFAULT NULL COMMENT 'md5',<br>   `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',<br>   `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',<br>   `src_user` text COMMENT 'source user',<br>   `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',<br>   `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',<br>   PRIMARY KEY (`id`),<br>   UNIQUE KEY `uk_configinfobeta_datagrouptenant` (`data_id`,`group_id`,`tenant_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_beta';</p> 
<p>/******************************************/<br> /*   数据库全名 = nacos_config   */<br> /*   表名称 = config_info_tag   */<br> /******************************************/<br> CREATE TABLE `config_info_tag` (<br>   `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',<br>   `data_id` varchar(255) NOT NULL COMMENT 'data_id',<br>   `group_id` varchar(128) NOT NULL COMMENT 'group_id',<br>   `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',<br>   `tag_id` varchar(128) NOT NULL COMMENT 'tag_id',<br>   `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',<br>   `content` longtext NOT NULL COMMENT 'content',<br>   `md5` varchar(32) DEFAULT NULL COMMENT 'md5',<br>   `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',<br>   `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',<br>   `src_user` text COMMENT 'source user',<br>   `src_ip` varchar(50) DEFAULT NULL COMMENT 'source ip',<br>   PRIMARY KEY (`id`),<br>   UNIQUE KEY `uk_configinfotag_datagrouptenanttag` (`data_id`,`group_id`,`tenant_id`,`tag_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_info_tag';</p> 
<p>/******************************************/<br> /*   数据库全名 = nacos_config   */<br> /*   表名称 = config_tags_relation   */<br> /******************************************/<br> CREATE TABLE `config_tags_relation` (<br>   `id` bigint(20) NOT NULL COMMENT 'id',<br>   `tag_name` varchar(128) NOT NULL COMMENT 'tag_name',<br>   `tag_type` varchar(64) DEFAULT NULL COMMENT 'tag_type',<br>   `data_id` varchar(255) NOT NULL COMMENT 'data_id',<br>   `group_id` varchar(128) NOT NULL COMMENT 'group_id',<br>   `tenant_id` varchar(128) DEFAULT '' COMMENT 'tenant_id',<br>   `nid` bigint(20) NOT NULL AUTO_INCREMENT,<br>   PRIMARY KEY (`nid`),<br>   UNIQUE KEY `uk_configtagrelation_configidtag` (`id`,`tag_name`,`tag_type`),<br>   KEY `idx_tenant_id` (`tenant_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='config_tag_relation';</p> 
<p>/******************************************/<br> /*   数据库全名 = nacos_config   */<br> /*   表名称 = group_capacity   */<br> /******************************************/<br> CREATE TABLE `group_capacity` (<br>   `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',<br>   `group_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Group ID，空字符表示整个集群',<br>   `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',<br>   `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',<br>   `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',<br>   `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数，，0表示使用默认值',<br>   `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',<br>   `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',<br>   `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',<br>   `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',<br>   PRIMARY KEY (`id`),<br>   UNIQUE KEY `uk_group_id` (`group_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='集群、各Group容量信息表';</p> 
<p>/******************************************/<br> /*   数据库全名 = nacos_config   */<br> /*   表名称 = his_config_info   */<br> /******************************************/<br> CREATE TABLE `his_config_info` (<br>   `id` bigint(64) unsigned NOT NULL,<br>   `nid` bigint(20) unsigned NOT NULL AUTO_INCREMENT,<br>   `data_id` varchar(255) NOT NULL,<br>   `group_id` varchar(128) NOT NULL,<br>   `app_name` varchar(128) DEFAULT NULL COMMENT 'app_name',<br>   `content` longtext NOT NULL,<br>   `md5` varchar(32) DEFAULT NULL,<br>   `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,<br>   `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,<br>   `src_user` text,<br>   `src_ip` varchar(50) DEFAULT NULL,<br>   `op_type` char(10) DEFAULT NULL,<br>   `tenant_id` varchar(128) DEFAULT '' COMMENT '租户字段',<br>   PRIMARY KEY (`nid`),<br>   KEY `idx_gmt_create` (`gmt_create`),<br>   KEY `idx_gmt_modified` (`gmt_modified`),<br>   KEY `idx_did` (`data_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='多租户改造';</p> 
<p><br> /******************************************/<br> /*   数据库全名 = nacos_config   */<br> /*   表名称 = tenant_capacity   */<br> /******************************************/<br> CREATE TABLE `tenant_capacity` (<br>   `id` bigint(20) unsigned NOT NULL AUTO_INCREMENT COMMENT '主键ID',<br>   `tenant_id` varchar(128) NOT NULL DEFAULT '' COMMENT 'Tenant ID',<br>   `quota` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '配额，0表示使用默认值',<br>   `usage` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '使用量',<br>   `max_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个配置大小上限，单位为字节，0表示使用默认值',<br>   `max_aggr_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '聚合子配置最大个数',<br>   `max_aggr_size` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值',<br>   `max_history_count` int(10) unsigned NOT NULL DEFAULT '0' COMMENT '最大变更历史数量',<br>   `gmt_create` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',<br>   `gmt_modified` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '修改时间',<br>   PRIMARY KEY (`id`),<br>   UNIQUE KEY `uk_tenant_id` (`tenant_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='租户容量信息表';</p> 
<p><br> CREATE TABLE `tenant_info` (<br>   `id` bigint(20) NOT NULL AUTO_INCREMENT COMMENT 'id',<br>   `kp` varchar(128) NOT NULL COMMENT 'kp',<br>   `tenant_id` varchar(128) default '' COMMENT 'tenant_id',<br>   `tenant_name` varchar(128) default '' COMMENT 'tenant_name',<br>   `tenant_desc` varchar(256) DEFAULT NULL COMMENT 'tenant_desc',<br>   `create_source` varchar(32) DEFAULT NULL COMMENT 'create_source',<br>   `gmt_create` bigint(20) NOT NULL COMMENT '创建时间',<br>   `gmt_modified` bigint(20) NOT NULL COMMENT '修改时间',<br>   PRIMARY KEY (`id`),<br>   UNIQUE KEY `uk_tenant_info_kptenantid` (`kp`,`tenant_id`),<br>   KEY `idx_tenant_id` (`tenant_id`)<br> ) ENGINE=InnoDB DEFAULT CHARSET=utf8 COLLATE=utf8_bin COMMENT='tenant_info';</p> 
<p>CREATE TABLE `users` (<br>     `username` varchar(50) NOT NULL PRIMARY KEY,<br>     `password` varchar(500) NOT NULL,<br>     `enabled` boolean NOT NULL<br> );</p> 
<p>CREATE TABLE `roles` (<br>     `username` varchar(50) NOT NULL,<br>     `role` varchar(50) NOT NULL,<br>     UNIQUE INDEX `idx_user_role` (`username` ASC, `role` ASC) USING BTREE<br> );</p> 
<p>CREATE TABLE `permissions` (<br>     `role` varchar(50) NOT NULL,<br>     `resource` varchar(255) NOT NULL,<br>     `action` varchar(8) NOT NULL,<br>     UNIQUE INDEX `uk_role_permission` (`role`,`resource`,`action`) USING BTREE<br> );</p> 
<p>INSERT INTO users (username, password, enabled) VALUES ('nacos', '$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu', TRUE);</p> 
<p>INSERT INTO roles (username, role) VALUES ('nacos', 'ROLE_ADMIN');</p> 
<p>7、连接成功之后，要到docker容器中进行测试</p> 
<p><br> 二、nacos服务部署以及单个nacos服务搭建 <br>         1、拉取镜像<br> docker pull nacos/nacos-server</p> 
<p><br>         2、启动nacos<br> docker run -it \<br> -e PREFER_HOST_MODE=ip \<br> -e MODE=standalone \<br> -e SPRING_DATASOURCE_PLATFORM=mysql \ （要依赖的容器）<br> -e MYSQL_SERVICE_HOST=172.17.0.4 \ （当前mysql容器IP地址）<br> -e MYSQL_SERVICE_PORT=3306 \<br> -e MYSQL_SERVICE_DB_NAME=nacos \（要连接的数据库）<br> -e MYSQL_SERVICE_USER=root \<br> -e MYSQL_SERVICE_PASSWORD=password \（用root用户登录连接虚拟机时的密码）<br> -p 9901:8848 \<br> --name nacos \<br> --restart=always \<br> nacos/nacos-server</p> 
<p>注意：当打上以上命名时，有几个点需要注意，已用红色字体表明</p> 
<p>1、172.17.0.4 \ （当前mysql容器IP地址）：</p> 
<p>2、nacos \（要n连接的数据库）</p> 
<p>注意：以上命令没写正确，就会报错</p> 
<p><br>         3、进行nacos数据持久化测试</p> 
<p><br> 进行配置：（注意数据可随意化，只做测试） </p> 
<p>        4、在控制台获得nacos配置<br> curl -X GET "http://ip:8848/nacos/v1/cs/configs?dataId=xx.yml&amp;group=DEFAULT_GROUP"</p> 
<p>curl -X GET "http://172.17.0.3:8848/nacos/v1/cs/configs?dataId=test.yml&amp;group=DEFAULT_GROUP"（常用）</p> 
<p> 查看之后，数据库就会新增一条数据</p> 
<p>说明nacos服务搭建成功</p> 
<p>三、nacos集群搭建<br>             1、先移除所有的容器<br> docker ps -a</p> 
<p>            2、创建一个以自定义网路的mysql容器<br> 因为当mysql容器进行关闭后，再次打开时，mysql容器的端口号可能会进行改变</p> 
<p>docker run -itd -p 2333:3306 \<br> --name mysql \<br> --net mynet --ip 172.18.1.30 \（这是mysql的ip，下面会进行创建两个服务，必须在同一网段下）<br> -v /home/mysql/conf/my.cnf:/etc/my.cnf \<br> -v /home/mysql/data:/var/lib/mysql \<br> --privileged=true \<br> --restart=always \<br> -e MYSQL_ROOT_PASSWORD=root123 \<br> -d mysql:8.0.27<br>  </p> 
<p>            3、创建集群中的服务<br> nacos01：</p> 
<p>docker run -it（不要加d，方便查看是否报错加d是后台运行，） \<br> -e PREFER_HOST_MODE=ip \<br> -e MODE=cluster \<br> -e NACOS_SERVERS="172.18.1.42:8848 172.18.1.43:8848" \<br> -e SPRING_DATASOURCE_PLATFORM=mysql \<br> -e MYSQL_SERVICE_HOST=172.18.1.30 \<br> -e MYSQL_SERVICE_PORT=3306 \<br> -e MYSQL_SERVICE_DB_NAME=nacos \<br> -e MYSQL_SERVICE_USER=root \<br> -e MYSQL_SERVICE_PASSWORD=password \<br> -p 9901:8848 \<br> --name nacos01 \<br> --net mynet --ip 172.18.1.41 \<br> --restart=always \<br> nacos/nacos-server</p> 
<p> nacos02：</p> 
<p> docker run -it \<br> -e PREFER_HOST_MODE=ip \<br> -e MODE=cluster \<br> -e NACOS_SERVERS="172.18.1.41:8848 172.18.1.43:8848" \<br> -e SPRING_DATASOURCE_PLATFORM=mysql \<br> -e MYSQL_SERVICE_HOST=172.18.1.30 \<br> -e MYSQL_SERVICE_PORT=3306 \<br> -e MYSQL_SERVICE_DB_NAME=nacos \<br> -e MYSQL_SERVICE_USER=root \<br> -e MYSQL_SERVICE_PASSWORD=root123 \<br> -p 9902:8848 \<br> --name nacos02 \<br> --net mynet --ip 172.18.1.42 \<br> --restart=always \<br> nacos/nacos-server</p> 
<p>如果说报No DataSource set错误就查看以上解决方法 </p> 
<p><br> 可以查看到集群中有多少台服务器</p> 
<p>            4、实现nginx反向代理（负载均衡）<br> 为什么要实现反向代理？</p> 
<p>因为一个集群中两台服务之间没有联系，必须给这两台服务进行建立联系，才能登一个账号可以进行同步操作</p> 
<p>defalut.conf:</p> 
<p>upstream tomcatList {<!-- --><br>     server 172.18.0.2:8081 weight=1;<br>     server 172.18.0.3:8081 weight=2;<br> }</p> 
<p>upstream nacosList {<!-- --><br>     server 172.18.1.41:8848 weight=1;<br>     server 172.18.1.42:8848 weight=2;<br> }</p> 
<p>server {<!-- --><br>     listen  80;<br>     server_name  www.zking.com;</p> 
<p>    location / {<!-- --><br>         root   /etc/nginx/html/;<br>         index  index.html index.htm;<br>     }</p> 
<p>    error_page   500 502 503 504  /50x.html;</p> 
<p>    location = /50x.html {<!-- --><br>         root   /usr/share/nginx/html;<br>     }</p> 
<p>    location /nacos {<!-- --><br>         proxy_pass  http://nacosList;<br>     }</p> 
<p>    location ~^/api/ {<!-- --><br>         rewrite ^/api/(.*)$ /$1 break;<br>         proxy_pass  http://tomcatList;<br>         proxy_redirect default;<br>     }</p> 
<p>}</p> 
<p>                        4.1、方式一<br> docker run -itd \<br> --name nginx \<br> -v /home/nginx/conf.d:/etc/nginx/conf.d \<br> -v /home/nginx/html:/etc/nginx/html \<br> -v /home/nginx/log:/usr/log/nginx \<br> -p 8080:80 \<br> nginx</p> 
<p>必须要输入以下命名，才能进行到nacos登录页面</p> 
<p>docker network connect mynet nginx</p> 
<p><br>                         4.2、方式二 <br> docker run -itd \<br> --name nginx \<br> --net mynet \<br> -v /home/nginx/conf.d:/etc/nginx/conf.d \<br> -v /home/nginx/html:/etc/nginx/html \<br> -v /home/nginx/log:/usr/log/nginx \<br> -p 8080:80 \<br> nginx            <br> ————————————————<br> 版权声明：本文为CSDN博主「落日飞行」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br> 原文链接：https://blog.csdn.net/m0_53151031/article/details/123118920</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/f760688b3c18e22a27ca1f4c1793e393/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">无法在 macOS Ventura 上启动 Multipass</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/beaaaf13b3c82e741f189aefea4a9723/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">火爆全网，HttpRunner自动化测试框架-parameters参数化（超细整理）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>