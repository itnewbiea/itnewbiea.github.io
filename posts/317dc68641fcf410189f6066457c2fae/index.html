<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>sql中的主键和外键 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="sql中的主键和外键" />
<meta property="og:description" content="主键
主键的定义
主键：表中经常有一个列或多列的组合，其值能唯一地标识表中的每一行。这样的一列或多列称为表的主键，通过它可强制表的实体完整性。当创建或更改表时可通过定义 PRIMARY KEY 约束来创建主键。一个表只能有一个 PRIMARY KEY 约束，而且 PRIMARY KEY 约束中的列不能接受空值。由于 PRIMARY KEY 约束确保唯一数据，所以经常用来定义标识列。
作用:
1）保证实体的完整性;
2）加快数据库的操作速度
3）在表中添加新记录时，DBMS会自动检查新记录的主键值，不允许该值与其他记录的主键值重复。
4）DBMS自动按主键值的顺序显示表中的记录。如果没有定义主键，则按输入记录的顺序显示表中的记录。
联合主键
关系数据库实际上还允许通过多个字段唯一标识记录，即两个或更多的字段都设置为主键，这种主键被称为联合主键。
对于联合主键，允许一列有重复，只要不是所有主键列都重复即可。
主键的特性
主键的必要性
在有些数据库中，虽然主键不是必需的，但最好为每个表都设置一个主键，不管是单主键还是复合主键。它存在代表着表结构的完整性，表的记录必须得有唯一区分的字段，主键主要是用于其他表的外键关联，以及本记录的修改与删除。
主键的无意义性
由于主键的作用十分重要，如何选取主键会对业务开发产生重要影响。如果我们以学生的身份证号作为主键，似乎能唯一定位记录。然而，身份证号也是一种业务场景，如果身份证号升位了，或者需要变更，作为主键，不得不修改的时候，就会对业务产生严重影响。
选取主键的一个基本原则是：不使用任何业务相关的字段作为主键。
因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均不可用作主键。
主键的选择
自增整数类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键；
全局唯一GUID类型：使用一种全局唯一的字符串作为主键，类似8f55d96b-8acc-4636-8cb8-76bf8abc2f57。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键。
对于大部分应用来说，通常自增类型的主键就能满足需求
定义的自增性整数类型的主键一般使用是BIGINT NOT NULL AUTO_INCREMENT类型。
如果使用INT自增类型，那么当一张表的记录数超过2147483647（约21亿）时，会达到上限而出错。使用BIGINT自增类型则可以最多约922亿亿条记录。
外键
外键的定义
如果公共关键字在一个关系中是主关键字，那么这个公共关键字被称为另一个关系的外键。由此可见，外键表示了两个关系之间的相关联系。以另一个关系的外键作主关键字的表被称为主表，具有此外键的表被称为主表的从表。外键又称作外关键字。
由于一个班级可以有多个学生，在关系模型中，这两个表的关系可以称为“一对多”，即一个class的记录可以对应多个student表的记录。
为了表达这种一对多的关系，我们需要在student表中加入一列class_id，让它的值与class表的某条记录相对应。
这样，我们就可以根据class_id这个列直接定位出一个student表的记录应该对应到class的哪条记录。
在student表中，通过class_id的字段，可以把数据与另一张表关联起来，这种列称为外键。
外键并不是通过列名实现的，而是通过定义外键约束实现的：
//定义外键约束
ALTER TABLE student
ADD CONSTRAINT fk_class_id //外键约束的名称fk_class_id可以任意
FOREIGN KEY (class_id) //指定了class_id作为外键
REFERENCES class (id); //指定了这个外键将关联到class表的id列（即class表的主键）
1
2
3
4
5
class_id为学生表的外键。（此时student表中的class_id与class表中的id表示的含义相同）" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/317dc68641fcf410189f6066457c2fae/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-03-08T20:01:19+08:00" />
<meta property="article:modified_time" content="2022-03-08T20:01:19+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">sql中的主键和外键</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>主键<br> 主键的定义<br> 主键：表中经常有一个列或多列的组合，其值能唯一地标识表中的每一行。这样的一列或多列称为表的主键，通过它可强制表的实体完整性。当创建或更改表时可通过定义 PRIMARY KEY 约束来创建主键。一个表只能有一个 PRIMARY KEY 约束，而且 PRIMARY KEY 约束中的列不能接受空值。由于 PRIMARY KEY 约束确保唯一数据，所以经常用来定义标识列。</p> 
<p>作用:</p> 
<p>1）保证实体的完整性;</p> 
<p>2）加快数据库的操作速度</p> 
<p>3）在表中添加新记录时，DBMS会自动检查新记录的主键值，不允许该值与其他记录的主键值重复。</p> 
<p>4）DBMS自动按主键值的顺序显示表中的记录。如果没有定义主键，则按输入记录的顺序显示表中的记录。</p> 
<p>联合主键</p> 
<p>关系数据库实际上还允许通过多个字段唯一标识记录，即两个或更多的字段都设置为主键，这种主键被称为联合主键。</p> 
<p>对于联合主键，允许一列有重复，只要不是所有主键列都重复即可。</p> 
<p>主键的特性<br> 主键的必要性</p> 
<p>在有些数据库中，虽然主键不是必需的，但最好为每个表都设置一个主键，不管是单主键还是复合主键。它存在代表着表结构的完整性，表的记录必须得有唯一区分的字段，主键主要是用于其他表的外键关联，以及本记录的修改与删除。</p> 
<p>主键的无意义性</p> 
<p>由于主键的作用十分重要，如何选取主键会对业务开发产生重要影响。如果我们以学生的身份证号作为主键，似乎能唯一定位记录。然而，身份证号也是一种业务场景，如果身份证号升位了，或者需要变更，作为主键，不得不修改的时候，就会对业务产生严重影响。</p> 
<p>选取主键的一个基本原则是：不使用任何业务相关的字段作为主键。</p> 
<p>因此，身份证号、手机号、邮箱地址这些看上去可以唯一的字段，均不可用作主键。</p> 
<p>主键的选择<br> 自增整数类型：数据库会在插入数据时自动为每一条记录分配一个自增整数，这样我们就完全不用担心主键重复，也不用自己预先生成主键；<br> 全局唯一GUID类型：使用一种全局唯一的字符串作为主键，类似8f55d96b-8acc-4636-8cb8-76bf8abc2f57。GUID算法通过网卡MAC地址、时间戳和随机数保证任意计算机在任意时间生成的字符串都是不同的，大部分编程语言都内置了GUID算法，可以自己预算出主键。<br> 对于大部分应用来说，通常自增类型的主键就能满足需求</p> 
<p>定义的自增性整数类型的主键一般使用是BIGINT NOT NULL AUTO_INCREMENT类型。</p> 
<p>如果使用INT自增类型，那么当一张表的记录数超过2147483647（约21亿）时，会达到上限而出错。使用BIGINT自增类型则可以最多约922亿亿条记录。</p> 
<p>外键<br> 外键的定义<br> 如果公共关键字在一个关系中是主关键字，那么这个公共关键字被称为另一个关系的外键。由此可见，外键表示了两个关系之间的相关联系。以另一个关系的外键作主关键字的表被称为主表，具有此外键的表被称为主表的从表。外键又称作外关键字。</p> 
<p>由于一个班级可以有多个学生，在关系模型中，这两个表的关系可以称为“一对多”，即一个class的记录可以对应多个student表的记录。</p> 
<p>为了表达这种一对多的关系，我们需要在student表中加入一列class_id，让它的值与class表的某条记录相对应。</p> 
<p>这样，我们就可以根据class_id这个列直接定位出一个student表的记录应该对应到class的哪条记录。</p> 
<p>在student表中，通过class_id的字段，可以把数据与另一张表关联起来，这种列称为外键。</p> 
<p>外键并不是通过列名实现的，而是通过定义外键约束实现的：</p> 
<p>//定义外键约束<br> ALTER TABLE student<br> ADD CONSTRAINT fk_class_id  //外键约束的名称fk_class_id可以任意<br> FOREIGN KEY (class_id)     //指定了class_id作为外键<br> REFERENCES class (id);    //指定了这个外键将关联到class表的id列（即class表的主键）<br> 1<br> 2<br> 3<br> 4<br> 5<br> class_id为学生表的外键。（此时student表中的class_id与class表中的id表示的含义相同）</p> 
<p>此时外键表是student表，主键表是class表。</p> 
<p>要删除一个外键约束，也是通过ALTER TABLE实现的：</p> 
<p>ALTER TABLE student<br> DROP FOREIGN KEY fk_class_id;<br> 1<br> 2<br> 由于外键约束会降低数据库的性能，大部分互联网应用程序为了追求速度，并不设置外键约束，而是仅靠应用程序自身来保证逻辑的正确性。这种情况下，class_id仅仅是一个普通的列，只是它起到了外键的作用而已。</p> 
<p>选取设置 MySQL 外键的字段</p> 
<p>定义一个外键时，需要遵守下列规则：</p> 
<p>父表必须已经存在于数据库中，或者是当前正在创建的表。如果是后一种情况，则父表与子表是同一个表，这样的表称为自参照表，这种结构称为自参照完整性。<br> 必须为父表定义主键。<br> 主键不能包含空值，但允许在外键中出现空值。也就是说，只要外键的每个非空值出现在指定的主键中，这个外键的内容就是正确的。<br> 在父表的表名后面指定列名或列名的组合。这个列或列的组合必须是父表的主键或候选键。<br> 外键中列的数目必须和父表的主键中列的数目相同。<br> 外键中列的数据类型必须和父表主键中对应列的数据类型相同。<br> 外键的作用<br> **保持数据一致性，完整性。**主要目的是控制存储在外键表中的数据。 使两张表形成关联，外键只能引用外表中的列的值或使用空值</p> 
<p>外键约束<br> MySQL外键约束（FOREIGN KEY）用来在两个表的数据之间建立链接，它可以是一列或者多列。一个表可以有一个或多个外键。</p> 
<p>外键是表的一个字段，不是本表的主键，但对应另一个表的主键。定义外键后，不允许删除另一个表中具有关联关系的行。</p> 
<p>主表（父表）</p> 
<p>对于两个具有关联关系的表而言，相关联字段中主键所在的表就是主表。</p> 
<p>被引用的表叫主表（父表）。</p> 
<p>从表（子表）</p> 
<p>对于两个具有关联关系的表而言，相关联字段中外键所在的表就是从表。</p> 
<p>定义了外键的表叫从表（子表）。</p> 
<p>外键约束的作用：</p> 
<p>阻止执行</p> 
<p>从表插入新行，其外键值不是主表的主键值便阻止插入；<br> 从表修改外键值，新值不是主表的主键值便阻止修改；<br> 主表删除行，其主键值在从表里存在便阻止删除(要想删除，必须先删除从表的相关行)；<br> 主表修改主键值，旧值在从表里存在便阻止修改(要想修改，必须先删除从表的相关行)。<br> 级联执行</p> 
<p>主表删除行，连带从表的相关行一起删除；<br> 主表修改主键值，连带从表相关行的外键值一起修改。两种方法提供给用户选择。无论选取哪种方法，从表里都不会有多余行。从另一个角度理解，用拒绝同一事物在从表中的标志与主表不一致来实现与主表中的标志一致。<br> 两种实现方法，通过下面方式选择：</p> 
<p>界面：设级联更新、级联删除两个选择方框，选取则级联执行、不选取则阻止执行；<br> 命令：设E)kSCM)E、RESTRICT两个可选项，CASCADE为级联执行、RESTRICT为阻止执行。<br> CASCADE：级联删除</p> 
<p>在外键表的最后，加上on delete cascade 就是级联删除</p> 
<p>再删除主表数据时和主表关联的子表数据也会删除</p> 
<p>CREATE TABLE `student` (<br>   `id` bigint(64) NOT NULL AUTO_INCREMENT,<br>   `class_id` bigint(64) DEFAULT NULL,<br>   `name` varchar(32) COLLATE utf8_bin DEFAULT NULL,<br>   `age` int(32) DEFAULT NULL,<br>   `sex` varchar(32) COLLATE utf8_bin DEFAULT NULL,<br>   PRIMARY KEY (`id`),<br>   KEY `fk_class_id` (`class_id`),<br>   CONSTRAINT `fk_class_id` FOREIGN KEY (`class_id`) REFERENCES `class` (`id`)  <br>     on delete cascade,<br> ) <br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 所谓的级联删除，就是删除主键表的同时，外键表同时删除。</p> 
<p>以上面的例子将就是，假如班级表中的某个班级被删除了，那么在学生表中要想查询这个被删除的班级号所对应的班级信息就会报错，因为已经不存在这个班级了，所以，删除班级表（主键表）时必须删除其他与之关联的表，这里就说明了外键的作用，保持数据的一致性、完整性。当然反过来讲，你删除学生表中的记录，并不影响班级表中的数据，你查询班级号也能正确查询。所以删除外键表中的数据并不影响主键表。</p> 
<p>RESTRICT：约束/限制、NO ACTION(非活动，默认)</p> 
<p>当取值为No Action或者Restrict时，则当在主键表中删除对应记录时，首先检查该记录是否有对应外键，如果有则不允许删除。（即外键表约束主键表）</p> 
<p>SET NULL：级联置空</p> 
<p>在在外键表的最后，加上on delete set null就是级联置空</p> 
<p>再删除主表数据时，会把和主表关联的外键设置成NULL</p> 
<p>CREATE TABLE `student` (<br>   `id` bigint(64) NOT NULL AUTO_INCREMENT,<br>   `class_id` bigint(64) DEFAULT NULL,<br>   `name` varchar(32) COLLATE utf8_bin DEFAULT NULL,<br>   `age` int(32) DEFAULT NULL,<br>   `sex` varchar(32) COLLATE utf8_bin DEFAULT NULL,<br>   PRIMARY KEY (`id`),<br>   KEY `fk_class_id` (`class_id`),<br>   CONSTRAINT `fk_class_id` FOREIGN KEY (`class_id`) REFERENCES `class` (`id`)  <br>    on  delete  set null,<br> ) <br> 1<br> 2<br> 3<br> 4<br> 5<br> 6<br> 7<br> 8<br> 9<br> 10<br> 11<br> 当取值为Set Null时，则当在主键表中删除对应记录时，首先检查该记录是否有对应外键，如果有则设置子表中该外键值为null，（一样是外键表约束主键表，不过这就要求该外键允许取null）。</p> 
<p>NO ACTION和RESTRICT的区别：只有在及个别的情况下会导致区别，前者是在其他约束的动作之后执行，后者具有最高的优先权执行。</p> 
<p>注意</p> 
<p>删除表时，应该先删子表，后删父表，除非使用casecade constraints 解除关联。</p> 
<p>先删除父表时会报错：有一个被foreign keys关联的 key的字段在子表中</p> 
<p>&lt;e&gt;查询：drop table class</p> 
<p>错误代码： 3730<br> Cannot drop table 'class' referenced by a foreign key constraint 'fk_class_id' on table 'student'.<br> 1<br> 2<br> 3<br> 4<br> 如果一定要先删除父表</p> 
<p>使用casecade constraints解除关联就可以删掉父表</p> 
<p>drop table parent cascade constranints;<br> ————————————————<br> 版权声明：本文为CSDN博主「lrhaoya」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。<br> 原文链接：https://blog.csdn.net/qq_40393000/article/details/104997574</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6f47ddfae5d0680a99436e9643743bed/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Mybatis整合在SSM时log4j出现问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/619fbaeef7d11b4e21bf070d4b519c8e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Vue3警告：[Vue warn] Extraneous non-emits event listeners (changeParentProps) were passed to component</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>