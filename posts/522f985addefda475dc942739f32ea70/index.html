<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>qnap&#43;qBitorrent - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="qnap&#43;qBitorrent" />
<meta property="og:description" content="文章目录 目标A. 下载qBittorrentB. 安装qBittorrentC. 配置qBittorrenta. 修改用户名和密码b. 修改下载文件的默认保存地址c. 修改文件夹权限 D. 远程访问E. 添加SSLF. 修改打开文件数量限制[^2]常见问题 目标 为威联通NAS配置qBittorrent，使其可远程访问，可直接从NAS中删除通过其下载的文件，而不是必须从qBittorrent中删除。
A. 下载qBittorrent 从qnapclub下载qBittorrent，由于NAS为TS-453Dmini，故选择版本TS-NASX86_64。
B. 安装qBittorrent 进入威联通NAS网页端的AppCenter，右上角选择从手动安装，然后浏览选中下载的qpkg文件后点击安装，等待安装完成。1
C. 配置qBittorrent a. 修改用户名和密码 打开qBittorrent，初始用户名admin，密码adminadmin，然后登录。
tool菜单下的options...子菜单中的Web UI页中可修改用户名和密码。
b. 修改下载文件的默认保存地址 在options&gt;&gt;Downloads&gt;&gt;Saving Management&gt;&gt;Default Save Path中可修改默认保存地址，可设置为/share/Public/qbittorrent/Downloads/。
c. 修改文件夹权限 经测试上面操作完成后无法在NAS中直接删掉qBittorrent下载的文件，为实现可从NAS中直接删除其下载的文件，可在威联通NAS网页端中控制台&gt;&gt;权限&gt;&gt;共享文件夹&gt;&gt;高级权限中勾选启动高级文件夹权限并应用。尚未确定该方法是否有弊端。
D. 远程访问 上面安装的是套装，直接附带Web UI，可配置端口转发或启动UPnP即可远程访问。
E. 添加SSL 从阿里云网站上下载证书，类型选择其他。解压后得到两个后缀分别为pem和key的文件，上传到NAS。
Options&gt;&gt;Web UI&gt;&gt;勾选Use HTTPS instead of HTTP,Certificate填写后缀为pem的证书文件云端地址，Key填写后缀为key的证书文件的云端地址，然后保存。
F. 修改打开文件数量限制2 ssh登录qnap nas并进入/share/CACHEDEV1_DATA/.qpkg/qBittorrent/文件夹；执行命令创建limit.c文件 touch lilmit.c 使用 prlimit 函数来调整虽然网上有许多关于修改系统文件的教程，但是在这里我都不管用…… 后面是看到了 CARLO 的博文，采用他的方案。大致就是使用如下的代码来对运行中的进程进行动态调整，三个输入参数分别为待调整的进程 pid、文件打开数的 soft limit、文件打开数的 hard limit。因此基本操作就是在 qbittorrent-nox 进程运行后，再在威联通系统上运行一下此程序即可。要实现这一目的，首先要在威联通系统上对此 C 程序进行编译。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/522f985addefda475dc942739f32ea70/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-04-05T10:56:22+08:00" />
<meta property="article:modified_time" content="2023-04-05T10:56:22+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">qnap&#43;qBitorrent</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#_2" rel="nofollow">目标</a></li><li><a href="#A_qBittorrent_5" rel="nofollow">A. 下载qBittorrent</a></li><li><a href="#B_qBittorrent_8" rel="nofollow">B. 安装qBittorrent</a></li><li><a href="#C_qBittorrent_11" rel="nofollow">C. 配置qBittorrent</a></li><li><ul><li><a href="#a__12" rel="nofollow">a. 修改用户名和密码</a></li><li><a href="#b__17" rel="nofollow">b. 修改下载文件的默认保存地址</a></li><li><a href="#c__20" rel="nofollow">c. 修改文件夹权限</a></li></ul> 
  </li><li><a href="#D__23" rel="nofollow">D. 远程访问</a></li><li><a href="#E_SSL_25" rel="nofollow">E. 添加SSL</a></li><li><a href="#F_2_33" rel="nofollow">F. 修改打开文件数量限制[^2]</a></li><li><ul><li><a href="#_131" rel="nofollow">常见问题</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="_2"></a>目标</h2> 
<p>为威联通<code>NAS</code>配置<code>qBittorrent</code>，使其可远程访问，可直接从<code>NAS</code>中删除通过其下载的文件，而不是必须从<code>qBittorrent</code>中删除。</p> 
<h2><a id="A_qBittorrent_5"></a>A. 下载qBittorrent</h2> 
<p>从<a href="https://www.qnapclub.eu/en/qpkg/358" rel="nofollow">qnapclub</a>下载<code>qBittorrent</code>，由于<code>NAS</code>为<code>TS-453Dmini</code>，故选择版本<a href="https://www.qnapclub.eu/en/qpkg/model/download/479821/qBittorrent_4.4.2.0_x86_64.qpkg" rel="nofollow">TS-NASX86_64</a>。</p> 
<h2><a id="B_qBittorrent_8"></a>B. 安装qBittorrent</h2> 
<p>进入威联通NAS网页端的<code>AppCenter</code>，右上角选择从<code>手动安装</code>，然后<code>浏览</code>选中下载的<code>qpkg</code>文件后点击安装，等待安装完成。<sup class="footnote-ref"><a href="#fn1" rel="nofollow" id="fnref1">1</a></sup><br> <img src="https://images2.imgbox.com/83/b3/dg32ODQL_o.png" alt="AppCenter" width="800"></p> 
<h2><a id="C_qBittorrent_11"></a>C. 配置qBittorrent</h2> 
<h3><a id="a__12"></a>a. 修改用户名和密码</h3> 
<p>打开<code>qBittorrent</code>，初始用户名<code>admin</code>，密码<code>adminadmin</code>，然后登录。<br> <img src="https://images2.imgbox.com/b0/8b/H80IqXky_o.png" alt="在这里插入图片描述" width="500"><br> <code>tool</code>菜单下的<code>options...</code>子菜单中的<code>Web UI</code>页中可修改用户名和密码。<br> <img src="https://images2.imgbox.com/fa/09/8oqtI4QD_o.png" alt="changeuserpassword" width="900"></p> 
<h3><a id="b__17"></a>b. 修改下载文件的默认保存地址</h3> 
<p>在<code>options</code>&gt;&gt;<code>Downloads</code>&gt;&gt;<code>Saving Management</code>&gt;&gt;<code>Default Save Path</code>中可修改默认保存地址，可设置为<code>/share/Public/qbittorrent/Downloads/</code>。<br> <img src="https://images2.imgbox.com/af/dd/vD0daJ19_o.png" alt="changesavepath" width="900"></p> 
<h3><a id="c__20"></a>c. 修改文件夹权限</h3> 
<p>经测试上面操作完成后无法在NAS中直接删掉<code>qBittorrent</code>下载的文件，为实现可从NAS中直接删除其下载的文件，可在威联通NAS网页端中<code>控制台</code>&gt;&gt;<code>权限</code>&gt;&gt;<code>共享文件夹</code>&gt;&gt;<code>高级权限中</code>勾选<code>启动高级文件夹权限</code>并应用。<strong>尚未确定该方法是否有弊端</strong>。<br> <img src="https://images2.imgbox.com/52/f6/obpnlHTJ_o.png" alt="修改文件夹权限" width="950"></p> 
<h2><a id="D__23"></a>D. 远程访问</h2> 
<p>上面安装的是套装，直接附带<code>Web UI</code>，可配置<code>端口转发</code>或启动<code>UPnP</code>即可远程访问。</p> 
<h2><a id="E_SSL_25"></a>E. 添加SSL</h2> 
<ol><li> <p>从<a href="https://home.console.aliyun.com/home/dashboard/ProductAndService" rel="nofollow">阿里云网站</a>上下载证书，类型选择其他。解压后得到两个后缀分别为<code>pem</code>和<code>key</code>的文件，上传到<code>NAS</code>。<br> <img src="https://images2.imgbox.com/f5/b1/nRBdVp9N_o.png" alt="阿里云SSL" width="900"><br> <img src="https://images2.imgbox.com/88/5d/TClwhSk2_o.png" alt="证书下载" width="500"></p> </li><li> <p><code>Options</code>&gt;&gt;<code>Web UI</code>&gt;&gt;勾选<code>Use HTTPS instead of HTTP</code>,<code>Certificate</code>填写后缀为<code>pem</code>的证书文件云端地址，<code>Key</code>填写后缀为<code>key</code>的证书文件的云端地址，然后保存。<br> <img src="https://images2.imgbox.com/db/4e/L7cmAfKP_o.png" alt="qbittorrent-https" width="800"></p> </li></ol> 
<h2><a id="F_2_33"></a>F. 修改打开文件数量限制<sup class="footnote-ref"><a href="#fn2" rel="nofollow" id="fnref2">2</a></sup></h2> 
<ol><li><code>ssh</code>登录<code>qnap nas</code>并进入<code>/share/CACHEDEV1_DATA/.qpkg/qBittorrent/</code>文件夹；</li><li>执行命令创建<code>limit.c</code>文件</li></ol> 
<pre><code class="prism language-bash"><span class="token function">touch</span> lilmit.c
</code></pre> 
<blockquote> 
 <p>使用 prlimit 函数来调整虽然网上有许多关于修改系统文件的教程，但是在这里我都不管用…… 后面是看到了 CARLO 的博文，采用他的方案。大致就是使用如下的代码来对运行中的进程进行动态调整，三个输入参数分别为待调整的进程 pid、文件打开数的 soft limit、文件打开数的 hard limit。因此基本操作就是在 qbittorrent-nox 进程运行后，再在威联通系统上运行一下此程序即可。要实现这一目的，首先要在威联通系统上对此 C 程序进行编译。</p> 
</blockquote> 
<p>然后</p> 
<pre><code class="prism language-bash"><span class="token function">vim</span> limit.c
</code></pre> 
<p>在其中写入：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/resource.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token keyword">int</span> argc<span class="token punctuation">,</span> <span class="token keyword">char</span><span class="token operator">*</span><span class="token operator">*</span> argv<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
    <span class="token class-name">pid_t</span> pid<span class="token punctuation">;</span>
    <span class="token keyword">struct</span> <span class="token class-name">rlimit</span> new_limit<span class="token punctuation">;</span>
    <span class="token keyword">int</span> result<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>argc <span class="token operator">&lt;</span> <span class="token number">4</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    pid <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    new_limit<span class="token punctuation">.</span>rlim_cur <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    new_limit<span class="token punctuation">.</span>rlim_max <span class="token operator">=</span> <span class="token function">atoi</span><span class="token punctuation">(</span>argv<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    result <span class="token operator">=</span> <span class="token function">prlimit</span><span class="token punctuation">(</span>pid<span class="token punctuation">,</span> RLIMIT_NOFILE<span class="token punctuation">,</span> <span class="token operator">&amp;</span>new_limit<span class="token punctuation">,</span> <span class="token constant">NULL</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<ol start="3"><li><code>qnap nas</code>应用商店从<code>qnapclub</code>仓库安装包管理应用<code>Entware-std</code>，<strong>安装后是否需重启还未确定</strong></li><li><code>ssh</code>登录<code>qnap nas</code>并执行命令：</li></ol> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> /opt/bin/opkg update
<span class="token function">sudo</span> /opt/bin/opkg <span class="token function">install</span> gcc
</code></pre> 
<ol start="5"><li>添加<code>/opt/bin</code>到<code>PATH</code>中，不然后面<code>gcc</code>编译会报错：<code>gcc: error trying to exec 'as': execvp: No such file or directory</code>:</li></ol> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">vim</span> /root/.bashrc
</code></pre> 
<p>在文件的开头<code>PATH</code>相应位置添加<code>/opt/bin</code>，然后执行</p> 
<pre><code class="prism language-bash"><span class="token builtin class-name">source</span> /root/.bashrc
</code></pre> 
<ol start="6"><li>编译<code>limit.c</code>输出<code>limit</code>可执行文件，<strong>会提示两条警告信息，不用管它们</strong>：</li></ol> 
<pre><code class="prism language-bash">/opt/bin/gcc limit.c -o limit
</code></pre> 
<ol start="7"><li>修改<code>qBittorrent.sh</code></li></ol> 
<pre><code class="prism language-bash"><span class="token function">vim</span> qBittorrent.sh
</code></pre> 
<p>在脚本文件启动相关代码处，做出如下修改。可以看到原脚本中的 <code>$!</code> 就为运行的 <code>qbittorrent-nox</code> 的进程 <code>pid</code> 号。</p> 
<pre><code class="prism language-bash">./qbittorrent-nox --webui-port<span class="token operator">=</span><span class="token number">6363</span> <span class="token operator">&amp;</span>
<span class="token builtin class-name">echo</span> <span class="token variable">$!</span> <span class="token operator">&gt;</span> <span class="token variable">$PIDF</span>
./limit <span class="token variable">$!</span> <span class="token number">16384</span> <span class="token number">16384</span> <span class="token operator">&amp;</span>
</code></pre> 
<ol start="8"><li>重启<code>qBittorrent</code>;</li><li>执行命令查看当前<code>qBittorrent</code>打开文件数量限制：</li></ol> 
<pre><code class="prism language-bash"><span class="token function">cat</span> <span class="token string">"/proc/<span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> qbittorrent <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'NR==1{print $1}'</span><span class="token variable">)</span></span>/limits"</span>
</code></pre> 
<p>显示如下：</p> 
<pre><code>&lt;/proc/$(ps | grep qbittorrent | grep -v grep | awk 'NR==1{print $1}')/limits"
Limit                     Soft Limit           Hard Limit           Units
Max cpu time              unlimited            unlimited            seconds
Max file size             unlimited            unlimited            bytes
Max data size             unlimited            unlimited            bytes
Max stack size            8388608              unlimited            bytes
Max core file size        0                    unlimited            bytes
Max resident set          unlimited            unlimited            bytes
Max processes             31048                31048                processes
Max open files            16384                16384                files
Max locked memory         65536                65536                bytes
Max address space         unlimited            unlimited            bytes
Max file locks            unlimited            unlimited            locks
Max pending signals       31048                31048                signals
Max msgqueue size         819200               819200               bytes
Max nice priority         0                    0
Max realtime priority     0                    0
Max realtime timeout      unlimited            unlimited            us
</code></pre> 
<p>可看到<code>Max open files</code>已修改为<code>16384</code></p> 
<ol start="10"><li>查看当前<code>qBittorrent</code>打开文件数量：</li></ol> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> <span class="token function">ls</span> <span class="token string">"/proc/<span class="token variable"><span class="token variable">$(</span><span class="token function">ps</span> <span class="token operator">|</span> <span class="token function">grep</span> qbittorrent <span class="token operator">|</span> <span class="token function">grep</span> -v <span class="token function">grep</span> <span class="token operator">|</span> <span class="token function">awk</span> <span class="token string">'NR==1{print $1}'</span><span class="token variable">)</span></span>/fd"</span> <span class="token operator">|</span> <span class="token function">wc</span> -l
</code></pre> 
<p>完成。</p> 
<h3><a id="_131"></a>常见问题</h3> 
<ol><li>安装后默认密码无法登录，且配置文件<code>/share/CACHEDEV1_DATA/.qpkg/qBittorrent/.config/qBittorrent/qBittorrent.conf</code>中也没有<code>WebUI</code>用户名和密码相关信息：尝试更换浏览器，测试chrome不可以，edge可以；edge登录后可配置上面提到的<code>E. 添加SSL</code>，然后在<code>chrome</code>中可通过输入<code>https://xxxx:6363</code>来正常访问；还有一种情况是上次在<code>APP Center</code> 中将 <code>qBittorrent</code> 退出后但进程并没有停止，表现为<code>APP Center</code> 中显示已停止，但仍可打开网页端，这时需要到资源监视器中找到 <code>qBittorrent</code> 的进程号，然后 <code>ssh</code> 登入后执行<code>sudo kill -9 &lt;pid of qBittorrent&gt;</code> 杀掉进程后重新打开，此时应该就可以正常输密码访问。</li><li>在网页端设置中修改<code>Web UI</code>端口号是无效的，重启后仍会恢复默认的<code>6363</code>端口号。</li></ol> 
<hr class="footnotes-sep"> 
<section class="footnotes"> 
 <ol class="footnotes-list"><li id="fn1" class="footnote-item"><p><a href="https://post.smzdm.com/p/a5d2mwz8/" rel="nofollow">玩转下载神器qbittorrent：威联通NAS随心所欲实现异地挂载下载</a> <a href="#fnref1" rel="nofollow" class="footnote-backref">↩︎</a></p> </li><li id="fn2" class="footnote-item"><p><a href="https://jkboy.com/archives/5239.html" rel="nofollow">威联通 套件版 qBittorrent: Too many open files 或者 No file descriptors available 的解决方案</a> <a href="#fnref2" rel="nofollow" class="footnote-backref">↩︎</a></p> </li></ol> 
</section>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/608fdbd8d8dcd3556ff682ec87f35886/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android中将APK放入系统APK目录中,启动失败</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/336c883db1e231585b71b72aaccaf9a0/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">QNAP&#43;Transmission</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>