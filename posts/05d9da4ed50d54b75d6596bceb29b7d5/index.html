<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>接口测试 python requests库 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="接口测试 python requests库" />
<meta property="og:description" content="requests参数 params：在GET请求中，将参数添加到URL的查询字符串中。data：在POST请求中，将参数添加到请求体中。headers：设置HTTP请求的头部信息，如User-Agent、Content-Type等。cookies：设置请求的Cookies。auth：设置HTTP认证信息，如用户名和密码。timeout：设置请求超时时间。proxies：设置代理服务器。verify：是否验证服务器的SSL证书。allow_redirects：是否允许重定向。 发送GET请求 import requests &#39;&#39;&#39; 发送GET请求，解决响应乱码问题 &#39;&#39;&#39; response = requests.get(&#34;http://www.baidu.com/&#34;) print(&#34;原始的数据编码为：&#34;, response.encoding) print(&#34;设置前响应数据：&#34;, response.text) # 设置响应数据编码格式 # 响应数据乱码，设置编码 response.encoding = &#34;utf-8&#34; print(&#34;设置编码后数据编码为：&#34;, response.encoding) print(&#34;设置后响应数据：&#34;, response.text) 发送POST请求 提交form表单，参数为data
import requests login_url = &#34;http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login&#34; login_data = { &#34;username&#34;: &#34;13641111112&#34;, &#34;password&#34;: &#34;123456&#34;, &#34;verify_code&#34;: &#34;8888&#34; } response = requests.post(url=login_url, data=login_data) # 看响应 print(response.json()) 提交json数据，参数为json
import requests # 发送请求 login_url = &#34;http://ihrm-java.itheima.net/api/sys/login&#34; login_data = { &#34;mobile&#34;: &#34;13800000002&#34;, &#34;password&#34;: &#34;123456&#34; } response = requests.post(url=login_url, json=login_data) # 查看响应 print(response." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/05d9da4ed50d54b75d6596bceb29b7d5/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-07-31T13:02:08+08:00" />
<meta property="article:modified_time" content="2023-07-31T13:02:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">接口测试 python requests库</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h2></h2> 
<h2>requests参数</h2> 
<ol><li>params：在GET请求中，将参数添加到URL的查询字符串中。</li><li>data：在POST请求中，将参数添加到请求体中。</li><li>headers：设置HTTP请求的头部信息，如User-Agent、Content-Type等。</li><li>cookies：设置请求的Cookies。</li><li>auth：设置HTTP认证信息，如用户名和密码。</li><li>timeout：设置请求超时时间。</li><li>proxies：设置代理服务器。</li><li>verify：是否验证服务器的SSL证书。</li><li>allow_redirects：是否允许重定向。</li></ol> 
<h2>发送GET请求</h2> 
<pre><code class="language-python">import requests

'''
发送GET请求，解决响应乱码问题
'''
response = requests.get("http://www.baidu.com/")

print("原始的数据编码为：", response.encoding)
print("设置前响应数据：", response.text)
# 设置响应数据编码格式
# 响应数据乱码，设置编码
response.encoding = "utf-8"
print("设置编码后数据编码为：", response.encoding)
print("设置后响应数据：", response.text)</code></pre> 
<p><img alt="" height="185" src="https://images2.imgbox.com/a0/61/bwKphRPi_o.png" width="335"><img alt="" height="120" src="https://images2.imgbox.com/56/4d/e7WnGJta_o.png" width="331"></p> 
<h2>发送POST请求</h2> 
<p>提交form表单，<strong>参数为data</strong></p> 
<pre><code class="language-python">import requests
login_url = "http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login"
login_data = {
    "username": "13641111112",
    "password": "123456",
    "verify_code": "8888"
}
response = requests.post(url=login_url, data=login_data)
# 看响应
print(response.json())</code></pre> 
<p><img alt="" height="100" src="https://images2.imgbox.com/72/8e/5bljKjla_o.png" width="455"></p> 
<p>提交json数据，<strong>参数为json</strong></p> 
<pre><code class="language-python">import requests
# 发送请求
login_url = "http://ihrm-java.itheima.net/api/sys/login"
login_data = {
    "mobile": "13800000002",
    "password": "123456"
}
response = requests.post(url=login_url, json=login_data)
# 查看响应
print(response.json())</code></pre> 
<p><img alt="" height="96" src="https://images2.imgbox.com/7e/f8/9NtIpNhW_o.png" width="781"></p> 
<h2>传递URL参数</h2> 
<p>提交url参数数据，<strong>参数为params</strong></p> 
<pre><code class="language-python">import requests
# 方式一：直接定义在URL中
# response = requests.get("http://localhost/Home/Goods/search.html?q=iPhone")
# 方式二：传递字符串类型的参数
# response = requests.get("http://localhost/Home/Goods/search.html", params="q=iPhone")
# 方式三：传递字典类型的参数
response = requests.get("http://localhost/Home/Goods/search.html", params={"q": "iPhone"
})
# 获取响应结果
print("url=", response.url)</code></pre> 
<h2>响应内容解析</h2> 
<pre><code class="language-python">import requests

# 1). 访问百度首页的接口`http://www.baidu.com`，获取以下响应数据
response = requests.get("http://www.baidu.com")
# 2). 获取响应状态码
print("响应状态码：", response.status_code)
# 3). 获取请求URL
print("URL:", response.url)
# 4). 获取响应字符编码
print("编码格式为：", response.encoding)
# 5). 获取响应头数据
print("响应头信息：", response.headers)
print("Content-Type:", response.headers.get("Content-Type"))
# 6). 获取响应的cookie数据
print("cookies:", response.cookies)
print("提取指定的cookie：", response.cookies.get("BDORZ"))
# 7). 获取文本形式的响应内容
print("文本形式显示响应内容：", response.text)
# 8). 获取字节形式的响应内容
print("获取字节形式的响应内容：", response.content)
print("获取字节形式的响应内容：", response.content.decode("utf-8"))</code></pre> 
<p><img alt="" height="465" src="https://images2.imgbox.com/b3/23/gDHLD27P_o.png" width="486"></p> 
<h2>设置请求头</h2> 
<p><strong>参数为headers</strong></p> 
<pre><code class="language-python">import requests

login_url = "http://ihrm-java.itheima.net/api/sys/login"
login_header = {
    "Content-Type": "application/json"
}
login_data = {
    "mobile": "13800000002",
    "password": "123456"
}
# 发送请求
response = requests.post(url=login_url, json=login_data, headers=login_header)
# 查看响应
print(response.json())</code></pre> 
<h2>设置cookie</h2> 
<p>作用：跳过登录验证</p> 
<p><strong>参数为cookies</strong></p> 
<p>1.从登录状态中获取cookie</p> 
<p>2.在代码中设置</p> 
<p>3.请求时带上cookies参数</p> 
<pre><code class="language-python">import requests

# 获取验证码
response = requests.get("http://localhost/index.php?m=Home&amp;c=User&amp;a=verify")
print(response.cookies)
PHPSESSID = response.cookies.get("PHPSESSID")
print(PHPSESSID)
# 登录
login_url = "http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login"
login_data = {
    "username": "13641111112",
    "password": "123456",
    "verify_code": "8888"
}
cookies = {
    "PHPSESSID": PHPSESSID
}
response = requests.post(url=login_url, data=login_data, cookies=cookies)
response.encoding = "utf-8"
print(response.json())
response = requests.get("http://localhost/index.php/Home/Order/order_list.html",
                        cookies=cookies)
response.encoding = "utf-8"
print(response.text)</code></pre> 
<p style="background-color:transparent;"><img alt="" height="513" src="https://images2.imgbox.com/46/54/TL96GpYb_o.png" width="1200"></p> 
<h2 style="background-color:transparent;">设置session</h2> 
<p>作用：保持会话</p> 
<pre><code class="language-python">import requests
# 创建session对象
session = requests.Session()
# 获取验证码
response = session.get("http://localhost/index.php?m=Home&amp;c=User&amp;a=verify")
# 登录
login_url = "http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login"
login_data = {
    "username": "13641111112",
    "password": "123456",
    "verify_code": "8888"
}
response = session.post(url=login_url, data=login_data)
print(response.json())
# 我的订单页
response = session.get("http://localhost/index.php/Home/Order/order_list.html")
response.encoding = "utf-8"
print(response.text)</code></pre> 
<p><img alt="" height="796" src="https://images2.imgbox.com/ac/0b/Ih4dqmdY_o.png" width="1200"></p> 
<h2 style="background-color:transparent;">接口测试框架</h2> 
<pre><code class="language-python"># 导包
import requests
import unittest


# 创建测试类
class TPShopLogin(unittest.TestCase):

    def setUp(self):
        # 实例化session对象
        self.session = requests.Session()
        # 定义验证接口url地址
        self.url_verify = "http://localhost/index.php?m=Home&amp;c=User&amp;a=verify"
        # 定义登录接口url地址
        self.url_login = "http://localhost/index.php?m=Home&amp;c=User&amp;a=do_login"

    # teardown
    def tearDown(self):
        # 关闭session对象
        self.session.close()

    # 登录成功
    def test01_success(self):
        # 发送验证码请求并断言
        response = self.session.get(url=self.url_verify)
        self.assertEqual(200, response.status_code)
        self.assertIn("image", response.headers.get("Content-Type"))
        # 发登录请求并断言
        login_data = {
            "username": "13641111112",
            "password": "123456",
            "verify_code": "8888"
        }
        response = self.session.post(url=self.url_login, data=login_data)
        print(response.json())
        self.assertEqual(200, response.status_code)
        self.assertEqual(1, response.json().get("status"))
        self.assertIn("登陆成功", response.json().get("msg"))

    # 账号不存在
    def test02_user_is_not_exist(self):
        # 发送验证码请求并断言
        response = self.session.get(url=self.url_verify)
        self.assertEqual(200, response.status_code)
        self.assertIn("image", response.headers.get("Content-Type"))
        # 发登录请求并断言
        login_data = {
            "username": "13641111111",
            "password": "123456",
            "verify_code": "8888"
        }
        response = self.session.post(url=self.url_login, data=login_data)
        print(response.json())
        self.assertEqual(200, response.status_code)
        self.assertEqual(-1, response.json().get("status"))
        self.assertIn("账号不存在", response.json().get("msg"))

    # 密码错误
    def test03_password_error(self):
        # 发送验证码请求并断言
        response = self.session.get(url=self.url_verify)
        self.assertEqual(200, response.status_code)
        self.assertIn("image", response.headers.get("Content-Type"))
        # 发登录请求并断言
        login_data = {
            "username": "13641111112",
            "password": "error",
            "verify_code": "8888"
        }
        response = self.session.post(url=self.url_login, data=login_data)
        print(response.json())
        self.assertEqual(200, response.status_code)
        self.assertEqual(-2, response.json().get("status"))
        self.assertIn("密码错误", response.json().get("msg"))
</code></pre> 
<h2>接口测试</h2> 
<pre><code class="language-python">'''
成功登录后，记录登录信息
查询用户信息
'''
# 导包
import requests
import unittest


# 创建测试类
class TPShopLogin(unittest.TestCase):

    def setUp(self):
        # 实例化session对象
        self.session = requests.Session()
        # 定义接口url地址
        self.base_url = "http://ihrm-java.itheima.net/"

    # teardown
    def tearDown(self):
        # 关闭session对象
        self.session.close()

    # 登录成功并查询用户
    def test01_success(self):
        login_data = {
            "mobile": "13800000002",
            "password": "888itcast.CN764%..."
        }
        headers = {"Content-Type": "application/json"}
        response = self.session.post(url=self.base_url + '/api/sys/login', json=login_data, headers=headers)
        print(response.json())
        print(response.json().get("data"))
        self.assertEqual(200, response.status_code)
        data = response.json().get("data")
        header = {"Content-Type": "application/json", "Authorization": "Bearer " + data}
        response = self.session.post(url=self.base_url + '/api/sys/profile', headers=header)
        print(response.json())
</code></pre> 
<p><img alt="" height="173" src="https://images2.imgbox.com/89/95/Ro0ybi3q_o.png" width="1200"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/778bd1e649e5c954764612f5d9018993/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android 13-SystemUI 屏幕左上角或者左上交显示绿色亮点，去掉该亮点</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f43fdaeea959751ad46e3cf10d582a89/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">HTML快速入门/正则表达式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>