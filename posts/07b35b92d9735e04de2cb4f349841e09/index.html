<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>caffe 网络结构参数介绍及可视化 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="caffe 网络结构参数介绍及可视化" />
<meta property="og:description" content="caffe/examples/mnist/lenet_solver.prototxt # The train/test net protocol buffer definition net: &#34;examples/mnist/lenet_train_test.prototxt&#34; //用户训练／预测的网络描述文件（ProtoBuffer文本格式） # test_iter specifies how many forward passes the test should carry out. ／／预测阶段迭代次数。在mnist例程下，预测样本组（test batch）大小为100 # In the case of MNIST, we have test batch size 100 and 100 test iterations, # covering the full 10,000 testing images. //设置预测阶段迭代次数为100可以覆盖全部10000个测试样本 test_iter: 100 # Carry out testing every 500 training iterations. //训练时每迭代500次，进行一次预测 test_interval: 500 # The base learning rate, momentum and the weight decay of the network." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/07b35b92d9735e04de2cb4f349841e09/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-06-15T21:14:15+08:00" />
<meta property="article:modified_time" content="2017-06-15T21:14:15+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">caffe 网络结构参数介绍及可视化</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2 id="caffeexamplesmnistlenetsolverprototxt">caffe/examples/mnist/lenet_solver.prototxt</h2> 
<pre class="prettyprint"><code class=" hljs vala"><span class="hljs-preprocessor"># The train/test net protocol buffer definition</span>
net: <span class="hljs-string">"examples/mnist/lenet_train_test.prototxt"</span>
<span class="hljs-comment">//用户训练／预测的网络描述文件（ProtoBuffer文本格式）</span>
<span class="hljs-preprocessor"># test_iter specifies how many forward passes the test should carry out.</span>
／／预测阶段迭代次数。在mnist例程下，预测样本组（test batch）大小为<span class="hljs-number">100</span>
<span class="hljs-preprocessor"># In the case of MNIST, we have test batch size 100 and 100 test iterations,</span>
<span class="hljs-preprocessor"># covering the full 10,000 testing images.</span>
<span class="hljs-comment">//设置预测阶段迭代次数为100可以覆盖全部10000个测试样本</span>
test_iter: <span class="hljs-number">100</span>
<span class="hljs-preprocessor"># Carry out testing every 500 training iterations.</span>
<span class="hljs-comment">//训练时每迭代500次，进行一次预测</span>
test_interval: <span class="hljs-number">500</span>
<span class="hljs-preprocessor"># The base learning rate, momentum and the weight decay of the network.</span>
网络的基础学习速率、冲量和权衰量
base_lr: <span class="hljs-number">0.01</span>
momentum: <span class="hljs-number">0.9</span>
weight_decay: <span class="hljs-number">0.0005</span>
<span class="hljs-preprocessor"># The learning rate policy</span>
lr_policy: <span class="hljs-string">"inv"</span>
<span class="hljs-comment">//学习速率的衰减策略</span>
gamma: <span class="hljs-number">0.0001</span>
power: <span class="hljs-number">0.75</span>
<span class="hljs-preprocessor"># Display every 100 iterations</span>
<span class="hljs-comment">//每经过100次迭代，在屏幕上打印一次log</span>
display: <span class="hljs-number">100</span>
<span class="hljs-preprocessor"># The maximum number of iterations</span>
<span class="hljs-comment">//最大迭代次数</span>
max_iter: <span class="hljs-number">10000</span>
<span class="hljs-preprocessor"># snapshot intermediate results</span>
<span class="hljs-comment">//每500次打印一次快照</span>
snapshot: <span class="hljs-number">5000</span>
snapshot_prefix: <span class="hljs-string">"examples/mnist/lenet"</span>
<span class="hljs-preprocessor"># solver mode: CPU or GPU</span>
<span class="hljs-comment">//求解模式CPU或者GPU</span>
solver_mode: CPU
</code></pre> 
<h2 id="caffeexamplesmnistlenettraintestprototxt">caffe/examples/mnist/lenet_train_test.prototxt</h2> 
<pre class="prettyprint"><code class=" hljs lasso">name: <span class="hljs-string">"LeNet"</span> <span class="hljs-comment">//网络的名称</span>
layer {       <span class="hljs-comment">//定义一个层（Layer）</span>
  name: <span class="hljs-string">"mnist"</span> <span class="hljs-comment">//层名称</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"Data"</span>  <span class="hljs-comment">//层类型：数据层</span>
  top: <span class="hljs-string">"data"</span>  <span class="hljs-comment">//层输出 ：data和label</span>
  top: <span class="hljs-string">"label"</span>
  include {
    phase: TRAIN <span class="hljs-comment">//本层只在训练阶段有效</span>
  }
  transform_param {
    scale: <span class="hljs-number">0.00390625</span> <span class="hljs-comment">//数据变换使用的数据缩放因子</span>
  }
  data_param { <span class="hljs-comment">//数据层参数</span>
    source: <span class="hljs-string">"examples/mnist/mnist_train_lmdb"</span> <span class="hljs-comment">//lmdb数据源路径</span>
    batch_size: <span class="hljs-number">64</span> <span class="hljs-comment">//批次大小，一次读取64张图</span>
    backend: LMDB <span class="hljs-comment">//数据格式</span>
  }
}
layer { <span class="hljs-comment">//一个新的数据层，名字也叫mnist，输出blog也是data和label，但是这里定义的参数只在分类阶段有效</span>
  name: <span class="hljs-string">"mnist"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"Data"</span>
  top: <span class="hljs-string">"data"</span>
  top: <span class="hljs-string">"label"</span>
  include {
    phase: TEST
  }
  transform_param {
    scale: <span class="hljs-number">0.00390625</span>
  }
  data_param {
    source: <span class="hljs-string">"examples/mnist/mnist_test_lmdb"</span>
    batch_size: <span class="hljs-number">100</span>
    backend: LMDB
  }
}
layer { <span class="hljs-comment">//卷积层conv1，输入blog为data，输出blog为conv1</span>
  name: <span class="hljs-string">"conv1"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"Convolution"</span>
  bottom: <span class="hljs-string">"data"</span>
  top: <span class="hljs-string">"conv1"</span>
  param {
    lr_mult: <span class="hljs-number">1</span> <span class="hljs-comment">//权值学习速率倍乘因子，1表示与全局参数保持一致</span>
  }
  param {
    lr_mult: <span class="hljs-number">2</span> <span class="hljs-comment">//bias学习速率倍乘因子，是全局参数的2倍</span>
  }
  convolution_param { <span class="hljs-comment">//卷积计算参数</span>
    num_output: <span class="hljs-number">20</span> <span class="hljs-comment">//输出feature map数目为20</span>
    kernel_size: <span class="hljs-number">5</span> <span class="hljs-comment">//卷积核尺寸</span>
    stride: <span class="hljs-number">1</span> <span class="hljs-comment">//卷积步长</span>
    weight_filler { <span class="hljs-comment">//权值初始化策略</span>
      <span class="hljs-keyword">type</span>: <span class="hljs-string">"xavier"</span>
    }
    bias_filler { <span class="hljs-comment">//bias初始化策略</span>
      <span class="hljs-keyword">type</span>: <span class="hljs-string">"constant"</span>
    }
  }
}
layer { <span class="hljs-comment">//定义下采样层pool1，输入blob为conv1，输出blob为pool1</span>
  name: <span class="hljs-string">"pool1"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"Pooling"</span>
  bottom: <span class="hljs-string">"conv1"</span>
  top: <span class="hljs-string">"pool1"</span>
  pooling_param { <span class="hljs-comment">//下采样参数</span>
    pool: <span class="hljs-keyword">MAX</span> <span class="hljs-comment">//下采样方法</span>
    kernel_size: <span class="hljs-number">2</span> <span class="hljs-comment">//下采样窗口尺寸</span>
    stride: <span class="hljs-number">2</span> <span class="hljs-comment">//下采样窗口步长</span>
  }
}
layer {
  name: <span class="hljs-string">"conv2"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"Convolution"</span>
  bottom: <span class="hljs-string">"pool1"</span>
  top: <span class="hljs-string">"conv2"</span>
  param {
    lr_mult: <span class="hljs-number">1</span>
  }
  param {
    lr_mult: <span class="hljs-number">2</span>
  }
  convolution_param {
    num_output: <span class="hljs-number">50</span>
    kernel_size: <span class="hljs-number">5</span>
    stride: <span class="hljs-number">1</span>
    weight_filler {
      <span class="hljs-keyword">type</span>: <span class="hljs-string">"xavier"</span>
    }
    bias_filler {
      <span class="hljs-keyword">type</span>: <span class="hljs-string">"constant"</span>
    }
  }
}
layer {
  name: <span class="hljs-string">"pool2"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"Pooling"</span>
  bottom: <span class="hljs-string">"conv2"</span>
  top: <span class="hljs-string">"pool2"</span>
  pooling_param {
    pool: <span class="hljs-keyword">MAX</span>
    kernel_size: <span class="hljs-number">2</span>
    stride: <span class="hljs-number">2</span>
  }
}
layer { <span class="hljs-comment">//定义全连接层，输入blob为pool2，输出blog为ip1</span>
  name: <span class="hljs-string">"ip1"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"InnerProduct"</span>
  bottom: <span class="hljs-string">"pool2"</span>
  top: <span class="hljs-string">"ip1"</span>
  param {
    lr_mult: <span class="hljs-number">1</span>
  }
  param {
    lr_mult: <span class="hljs-number">2</span>
  }
  inner_product_param { <span class="hljs-comment">//全连接层参数</span>
    num_output: <span class="hljs-number">500</span>
    weight_filler {
      <span class="hljs-keyword">type</span>: <span class="hljs-string">"xavier"</span>
    }
    bias_filler {
      <span class="hljs-keyword">type</span>: <span class="hljs-string">"constant"</span>
    }
  }
}
layer { <span class="hljs-comment">//定义relu非线性层</span>
  name: <span class="hljs-string">"relu1"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"ReLU"</span>
  bottom: <span class="hljs-string">"ip1"</span>
  top: <span class="hljs-string">"ip1"</span>
}
layer {
  name: <span class="hljs-string">"ip2"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"InnerProduct"</span>
  bottom: <span class="hljs-string">"ip1"</span>
  top: <span class="hljs-string">"ip2"</span>
  param {
    lr_mult: <span class="hljs-number">1</span>
  }
  param {
    lr_mult: <span class="hljs-number">2</span>
  }
  inner_product_param {
    num_output: <span class="hljs-number">10</span>
    weight_filler {
      <span class="hljs-keyword">type</span>: <span class="hljs-string">"xavier"</span>
    }
    bias_filler {
      <span class="hljs-keyword">type</span>: <span class="hljs-string">"constant"</span>
    }
  }
}
layer { <span class="hljs-comment">//分类准确率层，只在test阶段有效，该层用于计算分类准确率</span>
  name: <span class="hljs-string">"accuracy"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"Accuracy"</span>
  bottom: <span class="hljs-string">"ip2"</span>
  bottom: <span class="hljs-string">"label"</span>
  top: <span class="hljs-string">"accuracy"</span>
  include {
    phase: TEST
  }
}
layer { <span class="hljs-comment">//损失层，损失函数为SoftmaxLoss，输入blob为ip2和label，输出blob为loss</span>
  name: <span class="hljs-string">"loss"</span>
  <span class="hljs-keyword">type</span>: <span class="hljs-string">"SoftmaxWithLoss"</span>
  bottom: <span class="hljs-string">"ip2"</span>
  bottom: <span class="hljs-string">"label"</span>
  top: <span class="hljs-string">"loss"</span>
}
</code></pre> 
<h2 id="lenettraintestprototxt-可视化">lenet_train_test.prototxt 可视化</h2> 
<p>可视化工具网页： <br> <a href="http://ethereon.github.io/netscope/#/editor" rel="nofollow noopener noreferrer" target="_blank">http://ethereon.github.io/netscope/#/editor</a> <br> 在左边输入prototxt文本，按下shift+Enter，右侧会输出网络可视化图像 <br> <img src="https://images2.imgbox.com/65/13/7SXlKnsO_o.png" alt="这里写图片描述" title=""></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/672e7ec34a1237c58d2bc9076c00bca1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android自定义view最小刷新时间为16ms问题</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d93cbfe65728992c175d410254e83670/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">线性代数学习感悟</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>