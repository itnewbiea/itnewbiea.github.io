<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>php 过狗一句话木马的编写 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="php 过狗一句话木马的编写" />
<meta property="og:description" content="我们都知道 这个是php一句话 &lt;?php assert($_POST[&#39;mima&#39;]); ?&gt;
可是服务器的安全狗会识别到，我们要经过一些处理，
让安全狗不能认出我们的代码是一句话木马。
好多小白只会用一句话，但是不知道原理，我先大概说一下一句话木马的原理
assert是一个php的函数
assert(这里写代码) 这个函数会执行括号里的代码，（eval 的一句话木马类似 区别不细说）
$_POST[&#39;mima&#39;];
这句的意思是 接收表单的name为 &#34;mima&#34;的数据
怎么接收？通过POST请求，例如我们post mima=1234，那么$_POST[&#39;mima&#39;]的值就是1234
如果我们语句构造成这个
assert($_POST[&#39;mima&#39;]);
然后再post mima = system(&#34;whoami&#34;) 等等神奇的代码呢？会不会执行？
我们看看效果，我用我的过狗一句话试试
我用的是火狐的 hackbar插件。
命令成功执行了，我们再试试其他的
phpinfo成功执行。
原理就讲到这里吧，接下来直播写过狗的一句话。
思路：让assert执行我们post的数据，但是要让狗看不明白我们的代码
我刚学php，只清楚一点点函数，但是过狗足够了。
我们用想到的方法，用几个简单的函数组合拼凑，然后脑洞大开，写出神奇的代码，写的自己看都要费劲，这样安全狗可能就不会认识了
我们可能会用到的函数：
base64_encode() 这是base64加密函数
base64_decode() 这个解密
str_replace(a,b,c) 把字符串c里面的a字符串用b代替
为了避免等下写的不过狗，我就用我的过狗来讲吧，太晚了就不再开脑洞了。
之前只是介绍过狗常用的简单函数，不一定用到哦
拿出我的Dreamweaver，写上最初的一句话
这肯定被认出。
为了方便先拆开写，把post的数据先赋值给变量 $aa
如果没有狗的话，效果跟一句话木马一样，可是狗肯定还是看得出，再改改。
狗不允许我们用assert执行我们post 过来的代码，但是我们用assert执行其他的代码。
我们把post过来的数据假装改成了其他的数据，这样就骗过狗狗了。
看**作
我们再加一个post的数据，接收的变量名叫什么都行，我这里叫xxx
然后再赋值给变量$bb
再创建一个变量$cc，它等于 字符串 $aa 连上字符串 $bb，
例如$aa =&#34;我是&#34; ，$bb = &#34;father&#34;，
那么$cc=$aa.$bb 之后，$cc 就是 “我是father”这个字符串。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/7eef1aab692d1524a198043677ba1bcb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2017-09-02T22:35:25+08:00" />
<meta property="article:modified_time" content="2017-09-02T22:35:25+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">php 过狗一句话木马的编写</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p> </p> 
<p><br><span style="color:#333333;">我们都知道 这个是php一句话  &lt;?php assert($_POST['mima']); ?&gt;</span><br><br><br><span style="color:#333333;">可是服务器的安全狗会识别到，我们要经过一些处理，</span></p> 
<p><br><span style="color:#333333;">让安全狗不能认出我们的代码是一句话木马。</span></p> 
<p><br><span style="color:#333333;">好多小白只会用一句话，但是不知道原理，我先大概说一下一句话木马的原理</span></p> 
<p><br><span style="color:#333333;">assert是一个php的函数</span></p> 
<p><br><span style="color:#333333;">assert(这里写代码) </span></p> 
<p><br><span style="color:#333333;">这个函数会执行括号里的代码，（eval 的一句话木马类似 区别不细说）</span></p> 
<p><br><span style="color:#333333;">$_POST['mima'];</span></p> 
<p><br><span style="color:#333333;">这句的意思是 接收表单的name为 "mima"的数据</span></p> 
<p><br><span style="color:#333333;">怎么接收？通过POST请求，例如我们post mima=1234，那么$_POST['mima']的值就是1234</span></p> 
<p><br><span style="color:#333333;">如果我们语句构造成这个</span></p> 
<p><br><span style="color:#333333;">assert($_POST['mima']);</span></p> 
<p><br><span style="color:#333333;">然后再post mima = system("whoami") 等等神奇的代码呢？会不会执行？</span></p> 
<p><br><span style="color:#333333;">我们看看效果，我用我的过狗一句话试试</span></p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p>我用的是火狐的 hackbar插件。<br><img alt="" class="BDE_Image" height="248" src="https://images2.imgbox.com/64/1a/1B76dwvN_o.jpg" width="560"><br><br> 命令成功执行了，我们再试试其他的<br><img alt="" class="BDE_Image" height="350" src="https://images2.imgbox.com/32/db/dQtag32r_o.jpg" width="560"><br><br> phpinfo成功执行。</p> 
<p> </p> 
<p> </p> 
<p><span style="color:#333333;">原理就讲到这里吧，接下来直播写过狗的一句话。</span><br><span style="color:#333333;">思路：让assert执行我们post的数据，但是要让狗看不明白我们的代码</span><br><span style="color:#333333;">我刚学php，只清楚一点点函数，但是过狗足够了。</span><br><span style="color:#333333;">我们用想到的方法，用几个简单的函数组合拼凑，然后脑洞大开，写出神奇的代码，写的自己看都要费劲，这样安全狗可能就不会认识了</span><br><span style="color:#333333;">我们可能会用到的函数：</span><br><span style="color:#333333;">base64_encode() 这是base64加密函数</span><br><span style="color:#333333;">base64_decode() 这个解密</span><br><span style="color:#333333;">str_replace(a,b,c) 把字符串c里面的a字符串用b代替</span></p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p><span style="color:#333333;">为了避免等下写的不过狗，我就用我的过狗来讲吧，太晚了就不再开脑洞了。</span><br><span style="color:#333333;">之前只是介绍过狗常用的简单函数，不一定用到哦</span><img alt="" class="BDE_Smiley" height="30" src="https://images2.imgbox.com/a3/d8/YH24sR5c_o.png" width="30"><br><span style="color:#333333;">拿出我的Dreamweaver，写上最初的一句话</span><img alt="" class="BDE_Image" height="311" src="https://images2.imgbox.com/2b/4f/PoLWgxKR_o.jpg" width="450"><br><br><span style="color:#333333;">这肯定被认出</span><img alt="" class="BDE_Smiley" height="30" src="https://images2.imgbox.com/f7/4e/2DlzxVHg_o.png" width="30"><span style="color:#333333;">。</span><br><span style="color:#333333;">为了方便先拆开写，把post的数据先赋值给变量 $aa</span><br><img alt="" class="BDE_Image" height="228" src="https://images2.imgbox.com/20/40/UO0d38oB_o.jpg" width="338"><br><br><span style="color:#333333;">如果没有狗的话，效果跟一句话木马一样，可是狗肯定还是看得出，再改改。</span><br><span style="color:#333333;">狗不允许我们用assert执行我们post 过来的代码，但是我们用assert执行其他的代码。</span><br><span style="color:#333333;">我们把post过来的数据假装改成了其他的数据，这样就骗过狗狗了。</span><br><br><span style="color:#333333;">看**作</span><br><img alt="" class="BDE_Image" height="293" src="https://images2.imgbox.com/67/f8/OEL2kP7b_o.jpg" width="425"><br><br><span style="color:#333333;">我们再加一个post的数据，接收的变量名叫什么都行，我这里叫xxx</span><br><span style="color:#333333;">然后再赋值给变量$bb</span><br><span style="color:#333333;">再创建一个变量$cc，它等于 字符串 $aa 连上字符串 $bb，</span><br><span style="color:#333333;">例如$aa ="我是" ，$bb = "father"，</span><br><span style="color:#333333;">那么$cc=$aa.$bb 之后，$cc 就是 “我是father”这个字符串。</span><br><span style="color:#333333;">$cc 里面有$aa 和$bb，我们只要不 给$bb 赋值（不post “xxx”），</span><br><span style="color:#333333;">这样$cc里的数据就是 $aa了，我们assert($cc)就可以达到目的。</span><br><span style="color:#333333;">不过万一就是想给 $bb赋值，就是想 post xxx = asdfasdfasfd 怎么办，</span><br><span style="color:#333333;">万一不够复杂狗看得出呢（刚刚好奇试了试，已经可以做到不被拦截了</span><img alt="" class="BDE_Smiley" height="30" src="https://images2.imgbox.com/c9/db/1CEtLHkl_o.png" width="30"><span style="color:#333333;">）</span><br><span style="color:#333333;">我们再加一点代码，毕竟开头说了三个函数，一个都不用太没面子了。</span><br><span style="color:#333333;">（安全狗的拦截机制和查杀机制不一样，有些马可以不被拦截，但是手动用安全狗扫描一下还是可能会被发现，所以再改改吧</span><img alt="" class="BDE_Smiley" height="30" src="https://images2.imgbox.com/9a/28/l5g5zHEy_o.png" width="30"><span style="color:#333333;">）</span><br><span style="color:#333333;">我们用str_replace 把$cc里面的$bb去掉 如图</span><br><img alt="" class="BDE_Image" height="355" src="https://images2.imgbox.com/56/bb/Zkg49SCy_o.jpg" width="445"><br><br><span style="color:#333333;">str_replace的第二个参数是 ‘ ’ 就类似删除的意思,</span><br><span style="color:#333333;">把改好的数据赋值给$dd</span><br><span style="color:#333333;">我们把assert 里的值改为刚刚的$dd，这样我们执行的 $dd 就是我们一开始的$aa,就不受$bb的影响了。我们看看效果</span></p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p> </p> 
<p><span style="color:#333333;"><img alt="" class="BDE_Image" height="206" src="https://images2.imgbox.com/fc/71/6w4eKmB4_o.jpg" width="560"><br><span style="color:#333333;">我的安全狗一直开着呢，已经绕过了，</span><br><span style="color:#333333;">mima = 要执行的命令，</span><br><span style="color:#333333;">xxx="这里写什么都可以，不影响命令的执行，也可以不写"，</span><br><span style="color:#333333;">我们什么都不提交试试看</span><br><img alt="" class="BDE_Image" height="425" src="https://images2.imgbox.com/9c/e1/x2x9yY7B_o.jpg" width="560"><br><br><span style="color:#333333;">报错了，因为我们代码有 $_POST['mima']; $_POST['xxx'];这两句，但是我们没有post，他接收不到数据，所以报错了，这样可不行，太明显了。</span><br><span style="color:#333333;">做过php开发的都知道，可以在$_POST前面加@ ， @ 是不显示错误的意思，普通的一句话也都在$_POST前面加 @ </span><br><span style="color:#333333;">修改后的代码</span><br><img alt="" class="BDE_Image" height="381" src="https://images2.imgbox.com/0a/5f/gGPY5hvK_o.jpg" width="505"><br><br><span style="color:#333333;">我在assert前面加了 @ 这样输错命令也不会报错。</span><br><span style="color:#333333;">我们用安全狗扫描一下是不是真的能过狗狗。</span><br><img alt="" class="BDE_Image" height="303" src="https://images2.imgbox.com/0c/e1/NhRcwyFZ_o.jpg" width="560"><br><br><span style="color:#333333;">木马可以执行，未拦截，而且手工查杀杀不出，我们用菜刀试试</span></span></p> 
<p> </p> 
<p> </p> 
<p><span style="color:#333333;"><span style="color:#333333;"><img alt="" class="BDE_Image" height="336" src="https://images2.imgbox.com/d7/4f/FHRVBj3e_o.jpg" width="560"><br><span style="color:#333333;">密码就是我们的变量 $aa 通过post传入的数据的 name名，我这里就是 mima，</span><br><img alt="" class="BDE_Image" height="250" src="https://images2.imgbox.com/02/37/WM5c0aBn_o.jpg" width="560"><br><br><span style="color:#333333;">菜刀成功连上。大家可以试试我的一句话是否能过狗，有什么问题回帖，我能答得上来的肯定会回答。</span><br><span style="color:#333333;">快四点了，我没猝死的话 呸呸呸，我没飞升的话，明天写个更简便更高大上更**的出来。 呀大佬别喷我</span><img alt="" class="BDE_Smiley" height="30" src="https://images2.imgbox.com/b3/e0/vkQKZ0tV_o.png" width="30"></span></span></p> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3d3905385a8e1e0a67c74e2cf10230c0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">签名验签自助排查</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/465602d4a60d868ed9a5cca92f29a10e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">PS将红底证件照改为白底</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>