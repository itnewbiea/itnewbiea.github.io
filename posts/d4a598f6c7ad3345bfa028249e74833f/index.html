<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CH573-07-ADC——RISC-V内核BLE MCU快速开发教程 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CH573-07-ADC——RISC-V内核BLE MCU快速开发教程" />
<meta property="og:description" content="1.简介 ch573提供一个 12 位逐次逼近型模拟数字转换器 ADC，提供多达 12 个通道，CH573 支持 10 个外部信号源和 2 个内部信号源，CH571 仅支持前 6 个外部信号源和 2 个内部信号源，支持的引脚为： PA4（AIN0）、PA5（AIN1）、PA12（AIN2）、PA13（AIN3）、PA14（AIN4）、PA15（AIN5）、PB6（AIN9）、PB0（AIN8）、PA8（AIN12）、PA9（AIN13）
2. 新建工程 复制并粘贴“CH573_01_led”工程，并重命名为“CH573_07_ADC”。
3. ADC初始化与采集 1) 精简代码 将与串口无关的LED相关程序删除，如下所示：
2) 串口1初始化 复制上一讲的UART1初始化程序，初始化串口1，仅使用PRINT完成串口字符串发送。
GPIOA_SetBits(GPIO_Pin_9); GPIOA_ModeCfg(GPIO_Pin_8, GPIO_ModeIN_PU); GPIOA_ModeCfg(GPIO_Pin_9, GPIO_ModeOut_PP_5mA); UART1_DefInit(); PRINT(&#34;OK\r\n\r\n&#34;); 3) ADC初始化（单通道） //ADC初始化 /* 单通道采样：选择ADC通道0做采样，对应 PA4引脚， 带数据校准功能 */ GPIOA_ModeCfg(GPIO_Pin_4, GPIO_ModeIN_Floating); ADC_ExtSingleChSampInit(SampleFreq_3_2, ADC_PGA_0);//3.2M 采样频率,无增益 RoughCalib_Value = ADC_DataCalib_Rough(); // 用于计算ADC内部偏差，记录到全局变量 RoughCalib_Value中 ADC_ChannelCfg(0); //设置ADC采样通道AIN0(PA4) 除了上述普通单通道方式，还支持中断单通道采样、DMA单通道采样、差分通道采样、TouchKey采样等，详细实现方法可以参考官方资料“\EVT\EXAM\ADC”下的工程文件。
4) ADC采样 首先定义ADC采样数据保存的缓冲区：
uint16_t adcBuff[40]; uint32_t adc_get=0; #define ADC_COUNT 20 //ADC连续采样次数 连续采样：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d4a598f6c7ad3345bfa028249e74833f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-10T15:08:42+08:00" />
<meta property="article:modified_time" content="2023-06-10T15:08:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CH573-07-ADC——RISC-V内核BLE MCU快速开发教程</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p><img src="https://images2.imgbox.com/43/9e/mTV8MIHs_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="1_1"></a>1.简介</h2> 
<p>  ch573提供一个 12 位逐次逼近型模拟数字转换器 ADC，提供多达 12 个通道，CH573 支持 10 个外部信号源和 2 个内部信号源，CH571 仅支持前 6 个外部信号源和 2 个内部信号源，支持的引脚为： PA4（AIN0）、PA5（AIN1）、PA12（AIN2）、PA13（AIN3）、PA14（AIN4）、PA15（AIN5）、PB6（AIN9）、PB0（AIN8）、PA8（AIN12）、PA9（AIN13）</p> 
<h3><a id="2%09_3"></a>2. 新建工程</h3> 
<p>  复制并粘贴“CH573_01_led”工程，并重命名为“CH573_07_ADC”。</p> 
<center> 
 <img src="https://images2.imgbox.com/86/f0/JFXLUvXK_o.png"> 
 <br> 
</center> 
<h2><a id="3%09ADC_12"></a>3. ADC初始化与采集</h2> 
<h3><a id="emsp_1%09_13"></a>  1) 精简代码</h3> 
<p>  将与串口无关的LED相关程序删除，如下所示：</p> 
<center> 
 <img src="https://images2.imgbox.com/d4/e4/LRNxbdB4_o.png"> 
 <br> 
</center> 
<h2><a id="emspemsp2%091_22"></a>  2) 串口1初始化</h2> 
<p>  复制上一讲的UART1初始化程序，初始化串口1，仅使用PRINT完成串口字符串发送。</p> 
<center> 
 <img src="https://images2.imgbox.com/99/31/VPmtSeNw_o.png"> 
 <br> 
</center> 
<pre><code class="prism language-c">    <span class="token function">GPIOA_SetBits</span><span class="token punctuation">(</span>GPIO_Pin_9<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GPIOA_ModeCfg</span><span class="token punctuation">(</span>GPIO_Pin_8<span class="token punctuation">,</span> GPIO_ModeIN_PU<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GPIOA_ModeCfg</span><span class="token punctuation">(</span>GPIO_Pin_9<span class="token punctuation">,</span> GPIO_ModeOut_PP_5mA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">UART1_DefInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"OK\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="emsp_3%09ADC_41"></a>  3) ADC初始化（单通道）</h3> 
<pre><code class="prism language-c"><span class="token comment">//ADC初始化</span>
    <span class="token comment">/* 单通道采样：选择ADC通道0做采样，对应 PA4引脚， 带数据校准功能 */</span>
    <span class="token function">GPIOA_ModeCfg</span><span class="token punctuation">(</span>GPIO_Pin_4<span class="token punctuation">,</span> GPIO_ModeIN_Floating<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ADC_ExtSingleChSampInit</span><span class="token punctuation">(</span>SampleFreq_3_2<span class="token punctuation">,</span> ADC_PGA_0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3.2M 采样频率,无增益</span>
    RoughCalib_Value <span class="token operator">=</span> <span class="token function">ADC_DataCalib_Rough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用于计算ADC内部偏差，记录到全局变量 RoughCalib_Value中</span>
    <span class="token function">ADC_ChannelCfg</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//设置ADC采样通道AIN0(PA4)</span>
</code></pre> 
<p>  除了上述普通单通道方式，还支持中断单通道采样、DMA单通道采样、差分通道采样、TouchKey采样等，详细实现方法可以参考官方资料“\EVT\EXAM\ADC”下的工程文件。</p> 
<h3><a id="emsp_4%09ADC_53"></a>  4) ADC采样</h3> 
<p>   首先定义ADC采样数据保存的缓冲区：</p> 
<pre><code class="prism language-c"><span class="token class-name">uint16_t</span> adcBuff<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">uint32_t</span> adc_get<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ADC_COUNT</span> <span class="token expression"><span class="token number">20</span>  </span><span class="token comment">//ADC连续采样次数</span></span>
</code></pre> 
<p>   连续采样：</p> 
<pre><code class="prism language-c"><span class="token comment">// 连续采样ADC_COUNT次</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ADC_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ADC_ExcutSingleConver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> RoughCalib_Value<span class="token punctuation">;</span>
        <span class="token comment">/*注意：由于ADC内部偏差的存在，当采样电压在所选增益范围极限附近的时候
                可能会出现数据溢出的现象,此处采用伪溢出判断*/</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">65535</span><span class="token punctuation">)</span>   adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<h3><a id="emsp_5%09_75"></a>  5) 软件滤波</h3> 
<p>   在上面完成了连续的ADC采样，将结果进行冒泡排序，然后去掉首尾，即去掉最大和最小值，最后再取平均值使数据更加准确。</p> 
<pre><code class="prism language-c"> <span class="token comment">//冒泡排序，去首尾，求平均</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ADC_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"%d \n"</span><span class="token punctuation">,</span> adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"\r\n\r\n"</span><span class="token punctuation">,</span> adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token class-name">uint32_t</span> mp_temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>mp_i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>mp_j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>mp_i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> mp_i <span class="token operator">&lt;</span> ADC_COUNT<span class="token punctuation">;</span> mp_i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>mp_j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> mp_j <span class="token operator">&lt;</span> ADC_COUNT<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>mp_i<span class="token punctuation">;</span> mp_j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>adcBuff<span class="token punctuation">[</span>mp_j<span class="token punctuation">]</span><span class="token operator">&gt;</span>adcBuff<span class="token punctuation">[</span>mp_j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                mp_temp<span class="token operator">=</span>adcBuff<span class="token punctuation">[</span>mp_j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                adcBuff<span class="token punctuation">[</span>mp_j<span class="token punctuation">]</span><span class="token operator">=</span>adcBuff<span class="token punctuation">[</span>mp_j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                adcBuff<span class="token punctuation">[</span>mp_j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>mp_temp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//排序后</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"adc get %d times:"</span><span class="token punctuation">,</span>ADC_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ADC_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"%d \n"</span><span class="token punctuation">,</span> adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">,</span> adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//去首尾求和</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ADC_COUNT<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        adc_get<span class="token operator">+=</span>adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//求平均</span>
    adc_get<span class="token operator">=</span>adc_get<span class="token operator">/</span><span class="token punctuation">(</span>ADC_COUNT<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"adc_get=%d\r\n"</span><span class="token punctuation">,</span>adc_get<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<h2><a id="4%09mainc_117"></a>4. main.c完整内容</h2> 
<pre><code class="prism language-c"><span class="token comment">/********************************** (C) COPYRIGHT *******************************
 * File Name          : Main.c
 * Author             : FUNIOT.XYZ
 * Version            : V1.0
 * Date               : 2020/08/06
 * Description        : 实验01-LED闪烁
 * Copyright          : WeChat official accounts "IOT趣制作"
 * SPDX-License-Identifier: Apache-2.0
 *******************************************************************************/</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"CH57x_common.h"</span></span>
<span class="token class-name">uint16_t</span> adcBuff<span class="token punctuation">[</span><span class="token number">40</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token class-name">uint32_t</span> adc_get<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ADC_COUNT</span> <span class="token expression"><span class="token number">20</span>  </span><span class="token comment">//ADC连续采样次数</span></span>
<span class="token comment">/*********************************************************************
 * @fn      main
 *
 * @brief   主函数
 *
 * @return  none
 */</span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">SetSysClock</span><span class="token punctuation">(</span>CLK_SOURCE_PLL_60MHz<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//串口1初始化</span>
    <span class="token function">GPIOA_SetBits</span><span class="token punctuation">(</span>GPIO_Pin_9<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GPIOA_ModeCfg</span><span class="token punctuation">(</span>GPIO_Pin_8<span class="token punctuation">,</span> GPIO_ModeIN_PU<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GPIOA_ModeCfg</span><span class="token punctuation">(</span>GPIO_Pin_9<span class="token punctuation">,</span> GPIO_ModeOut_PP_5mA<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">UART1_DefInit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"OK\r\n\r\n"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">signed</span> <span class="token keyword">short</span> RoughCalib_Value <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// ADC粗调偏差值</span>
    <span class="token class-name">uint16_t</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token comment">//ADC初始化</span>
    <span class="token comment">/* 单通道采样：选择ADC通道0做采样，对应 PA4引脚， 带数据校准功能 */</span>
    <span class="token function">GPIOA_ModeCfg</span><span class="token punctuation">(</span>GPIO_Pin_4<span class="token punctuation">,</span> GPIO_ModeIN_Floating<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">ADC_ExtSingleChSampInit</span><span class="token punctuation">(</span>SampleFreq_3_2<span class="token punctuation">,</span> ADC_PGA_0<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//3.2M 采样频率,无增益</span>
    RoughCalib_Value <span class="token operator">=</span> <span class="token function">ADC_DataCalib_Rough</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 用于计算ADC内部偏差，记录到全局变量 RoughCalib_Value中</span>
    <span class="token function">ADC_ChannelCfg</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//设置ADC采样通道AIN0(PA4)</span>
    <span class="token comment">// 连续采样ADC_COUNT次</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ADC_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">ADC_ExcutSingleConver</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> RoughCalib_Value<span class="token punctuation">;</span>
        <span class="token comment">/*注意：由于ADC内部偏差的存在，当采样电压在所选增益范围极限附近的时候
                可能会出现数据溢出的现象,此处采用伪溢出判断*/</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">==</span><span class="token number">65535</span><span class="token punctuation">)</span>   adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//冒泡排序，去首尾，求平均</span>
<span class="token comment">//    for(i = 0; i &lt; ADC_COUNT; i++)</span>
<span class="token comment">//    {<!-- --></span>
<span class="token comment">//        PRINT("%d \n", adcBuff[i]);</span>
<span class="token comment">//    }</span>
<span class="token comment">//    PRINT("\r\n\r\n", adcBuff[i]);</span>

    <span class="token class-name">uint32_t</span> mp_temp<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>mp_i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>mp_j<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>mp_i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> mp_i <span class="token operator">&lt;</span> ADC_COUNT<span class="token punctuation">;</span> mp_i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">for</span><span class="token punctuation">(</span>mp_j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> mp_j <span class="token operator">&lt;</span> ADC_COUNT<span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span>mp_i<span class="token punctuation">;</span> mp_j<span class="token operator">++</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>adcBuff<span class="token punctuation">[</span>mp_j<span class="token punctuation">]</span><span class="token operator">&gt;</span>adcBuff<span class="token punctuation">[</span>mp_j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                mp_temp<span class="token operator">=</span>adcBuff<span class="token punctuation">[</span>mp_j<span class="token punctuation">]</span><span class="token punctuation">;</span>
                adcBuff<span class="token punctuation">[</span>mp_j<span class="token punctuation">]</span><span class="token operator">=</span>adcBuff<span class="token punctuation">[</span>mp_j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
                adcBuff<span class="token punctuation">[</span>mp_j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>mp_temp<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//排序后</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"adc get %d times:"</span><span class="token punctuation">,</span>ADC_COUNT<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ADC_COUNT<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"%d \n"</span><span class="token punctuation">,</span> adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">,</span> adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//去首尾求和</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> ADC_COUNT<span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        adc_get<span class="token operator">+=</span>adcBuff<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//求平均</span>
    adc_get<span class="token operator">=</span>adc_get<span class="token operator">/</span><span class="token punctuation">(</span>ADC_COUNT<span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">PRINT</span><span class="token punctuation">(</span><span class="token string">"adc_get=%d\r\n"</span><span class="token punctuation">,</span>adc_get<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token function">DelayMs</span><span class="token punctuation">(</span><span class="token number">1500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h2><a id="5%09_211"></a>5. 编译烧录运行</h2> 
<p>    完成烧录后，按下复位运行程序，将PA4引脚使用杜邦线分别悬空、连接GND和连接3.3V，并依次按下复位键，完成ADC采集，可以看到ADC读取的具体数据，如下图：<br> <img src="https://images2.imgbox.com/88/75/vqlZLsHq_o.png" alt="在这里插入图片描述"></p> 
<hr> 
<font face="黑体" size="" color="black">     如果ADC采集正常，结果与最后截图所示相类似，即达到本实验的目的，如果异常，请检查源代码，如有疑问可关注公众号 “IOT趣制作”，将您遇到的问题描述出来，平台收到您的留言后会第一时间进行解决。</font>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/1643d16bd049846fdcaae079c10c8a02/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux：samba服务 （smbd）</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8886fc57896628f26a33b661dd406ab7/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">基于springboot&#43;vue技术的在线考试系统源码数据库</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>