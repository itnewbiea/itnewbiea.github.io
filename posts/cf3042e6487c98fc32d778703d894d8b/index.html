<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于Vue2.X对WangEditor 5富文本编辑器进行封装与使用，支持单个或多个图片点击、粘贴、拖拽上传，Vue3.X项目也可直接使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于Vue2.X对WangEditor 5富文本编辑器进行封装与使用，支持单个或多个图片点击、粘贴、拖拽上传，Vue3.X项目也可直接使用" />
<meta property="og:description" content="一直想要一个神奇多功能的富文本编辑器，经同事介绍这个 WangEditor 富文本编辑器，发现挺好用的。
传送门：wangEditor
于是用Vue2.X语法自行封装一下，这样在复用组件时，可以少写一些代码，直接组件引用即可。另外，Vue3.X项目也可直接使用，因为Vue3.X是兼容Vue2.X语法的。
注意：如果反复创建与销毁该组件，记得用上v-if
&lt;WangEditor ref=&#34;wangEditorRef&#34; v-if=&#34;isShowWangEditor&#34; :disabled=&#34;editorParams.isDisabled&#34; :editorParams=&#34;editorParams&#34;&gt; &lt;/WangEditor&gt; 导入依赖包，注意Vue2.X和Vue3.X项目导入的依赖包版本会有所不同
// 查看 @wangeditor/editor 版本列表 npm view @wangeditor/editor versions --json // 导入 @wangeditor/editor 依赖包 npm i --save @wangeditor/editor@5.1.15 // 查看 @wangeditor/editor-for-vue 版本列表 npm view @wangeditor/editor-for-vue versions --json // 导入 @wangeditor/editor-for-vue 依赖包 npm i --save @wangeditor/editor-for-vue@5.1.12 父组件：index.vue
&lt;template&gt; &lt;div style=&#34;padding: 100px&#34;&gt; &lt;WangEditor ref=&#34;wangEditorRef1&#34; :disabled=&#34;editorParams1.isDisabled&#34; :editorParams=&#34;editorParams1&#34;&gt; &lt;/WangEditor&gt; &lt;br/&gt; &lt;WangEditor ref=&#34;wangEditorRef2&#34; :disabled=&#34;editorParams2.isDisabled&#34; :editorParams=&#34;editorParams2&#34;&gt; &lt;/WangEditor&gt; &lt;br/&gt; &lt;p align=&#34;center&#34;&gt; &lt;el-button type=&#34;primary&#34; @click=&#34;handleSubmitClick&#34;&gt;完成&lt;/el-button&gt; &lt;/p&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; import WangEditor from &#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/cf3042e6487c98fc32d778703d894d8b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-24T23:35:57+08:00" />
<meta property="article:modified_time" content="2023-06-24T23:35:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于Vue2.X对WangEditor 5富文本编辑器进行封装与使用，支持单个或多个图片点击、粘贴、拖拽上传，Vue3.X项目也可直接使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>一直想要一个神奇多功能的富文本编辑器，经同事介绍这个 WangEditor 富文本编辑器，发现挺好用的。</p> 
<p></p> 
<p>传送门：<a href="https://www.wangeditor.com/" rel="nofollow" title="wangEditor">wangEditor</a></p> 
<p>于是用Vue2.X语法自行封装一下，这样在复用组件时，可以少写一些代码，直接组件引用即可。另外，Vue3.X项目也可直接使用，因为Vue3.X是兼容Vue2.X语法的。</p> 
<p><span style="color:#fe2c24;">注意：如果反复创建与销毁该组件，记得用上v-if</span></p> 
<pre><code class="language-javascript">&lt;WangEditor
  ref="wangEditorRef"
  v-if="isShowWangEditor"
  :disabled="editorParams.isDisabled"
  :editorParams="editorParams"&gt;
&lt;/WangEditor&gt;</code></pre> 
<p>导入依赖包，注意Vue2.X和Vue3.X项目导入的依赖包版本会有所不同</p> 
<pre><code class="language-javascript">// 查看 @wangeditor/editor 版本列表
npm view @wangeditor/editor versions --json

// 导入 @wangeditor/editor 依赖包
npm i --save @wangeditor/editor@5.1.15

// 查看 @wangeditor/editor-for-vue 版本列表
npm view @wangeditor/editor-for-vue versions --json

// 导入 @wangeditor/editor-for-vue 依赖包
npm i --save @wangeditor/editor-for-vue@5.1.12</code></pre> 
<p>父组件：index.vue</p> 
<pre><code class="language-javascript">&lt;template&gt;
  &lt;div style="padding: 100px"&gt;
    &lt;WangEditor
      ref="wangEditorRef1"
      :disabled="editorParams1.isDisabled"
      :editorParams="editorParams1"&gt;
    &lt;/WangEditor&gt;

    &lt;br/&gt;

    &lt;WangEditor
      ref="wangEditorRef2"
      :disabled="editorParams2.isDisabled"
      :editorParams="editorParams2"&gt;
    &lt;/WangEditor&gt;

    &lt;br/&gt;

    &lt;p align="center"&gt;
      &lt;el-button type="primary" @click="handleSubmitClick"&gt;完成&lt;/el-button&gt;
    &lt;/p&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import WangEditor from './components/wangEditor'

export default {
  components: {
    WangEditor
  },
  data: () =&gt; ({
    // editorParams1 必填非空的富文本参数
    editorParams1: {
      content: '', // 富文本内容
      placeholder: '请填写内容', // 富文本占位内容
      uploadImageUrl: 'http://IP:Port/api/uploadFileAction', // 富文本上传图片的地址
      height: '300px', // 富文本最小高度
      isDisabled: false // 富文本是否禁用
    },

    // editorParams2 必填非空的富文本参数
    editorParams2: {
      content: 'HelloWorld!', // 富文本内容
      placeholder: '请填写内容', // 富文本占位内容
      uploadImageUrl: 'http://IP:Port/api/uploadFileAction', // 富文本上传图片的地址
      height: '300px', // 富文本最小高度
      isDisabled: true // 富文本是否禁用
    }
  }),
  methods: {
    /**
     * 获取富文本内容
     */
    async handleSubmitClick () {
      let refs = await this.$refs

      let wangEditorRef1 = refs.wangEditorRef1
      if (wangEditorRef1 != null) {
        console.log(wangEditorRef1.getEditorHtml())
        console.log(wangEditorRef1.getEditorText())
      }

      let wangEditorRef2 = refs.wangEditorRef2
      if (wangEditorRef2 != null) {
        console.log(wangEditorRef2.getEditorHtml())
        console.log(wangEditorRef2.getEditorText())
      }
    }
  }
}
&lt;/script&gt;
</code></pre> 
<p>子组件：wangEditor.vue</p> 
<pre><code class="language-javascript">&lt;template&gt;
  &lt;div&gt;
    &lt;div class="w-e-for-vue"&gt;
      &lt;!-- 工具栏 --&gt;
      &lt;Toolbar
        class="w-e-for-vue-toolbar"
        :editor="editor"
        :defaultConfig="toolbarConfig"&gt;
      &lt;/Toolbar&gt;

      &lt;!-- 编辑器 --&gt;
      &lt;Editor
        class="w-e-for-vue-editor"
        :style="'height: ' + height"
        :disabled="isDisabled"
        :defaultConfig="editorConfig"
        v-model="content"
        @onChange="onChange"
        @onCreated="onCreated"&gt;
      &lt;/Editor&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
import { Editor, Toolbar } from '@wangeditor/editor-for-vue'

export default {
  name: 'wangEditor',
  components: { Editor, Toolbar },
  props: [
    'editorParams'
  ],
  data () {
    return {
      editor: null, // 富文本编辑器对象
      content: null, // 富文本内容
      placeholder: null, // 富文本占位内容
      uploadImageUrl: null, // 富文本上传图片的地址
      height: '300px', // 富文本最小高度
      isDisabled: false, // 富文本是否禁用

      // 工具栏配置
      toolbarConfig: {
        // toolbarKeys: [], // 显示指定的菜单项
        // excludeKeys: [], // 隐藏指定的菜单项
      },

      // 编辑器配置
      editorConfig: {
        placeholder: '请输入内容......',
        MENU_CONF: ['uploadImage']
      }
    }
  },
  watch: {
    /**
     * 深度监听富文本参数
     */
    'editorParams': {
      handler: function (newVal, oldVal) {
        if (newVal != null) {
          this.content = newVal.content
          this.editorConfig.placeholder = this.placeholder
          this.uploadImageUrl = newVal.uploadImageUrl
          this.setUploadImageConfig()
          this.height = newVal.height
          this.isDisabled = newVal.isDisabled
        }
      },
      immediate: true,
      deep: true
    }
  },
  methods: {
    /**
     * 实例化富文本编辑器
     * 文档链接：https://www.wangeditor.com/
     */
    onCreated (editor) {
      this.editor = Object.seal(editor)
      this.setIsDisabled()
    },

    /**
     * 监听富文本编辑器
     */
    onChange (editor) {
      // console.log('onChange =&gt;', editor.getHtml())
    },

    /**
     * this.editor.getConfig().spellcheck = false
     * 由于在配置中关闭拼写检查，值虽然设置成功，但是依然显示红色波浪线
     * 因此在富文本编辑器组件挂载完成后，操作 Dom 元素设置拼写检查 spellcheck 为假
     */
    async setSpellCheckFasle () {
      let doms = await document.getElementsByClassName('w-e-scroll')
      for (let vo of doms) {
        if (vo) {
          if (vo.children.length &gt; 0) {
            vo.children[0].setAttribute('spellcheck', 'false')
          }
        }
      }
    },

    /**
     * 设置富文本是否禁用
     */
    async setIsDisabled () {
      if (this.editor) {
        this.isDisabled ? (this.editor.disable()) : (this.editor.enable())
      }
    },

    /**
     * 上传图片配置
     */
    setUploadImageConfig () {
      this.editorConfig.placeholder = this.placeholder
      this.editorConfig.MENU_CONF['uploadImage'] = {
        fieldName: 'files', // 文件字段名， 默认值 'wangeditor-uploaded-image'
        maxFileSize: 1 * 1024 * 1024, // 单个文件的最大体积限制，默认为 2M，此次设置为 1M
        maxNumberOfFiles: 10, // 最多可上传几个文件，默认为 100
        allowedFileTypes: ['image/*'], // 选择文件时的类型限制，默认为 ['image/*'] ，若不想限制，则设置为 []
        meta: {// 自定义上传参数，例如传递验证的 token 等，参数会被添加到 formData 中，一起上传到服务端
          token: 'xxx',
          otherKey: 'yyy'
        },
        metaWithUrl: false, // 将 meta 拼接到 URL 参数中，默认 false
        headers: {// 设置 HTTP 请求头信息
          // ...
        },
        server: this.uploadImageUrl, // 上传图片接口地址
        withCredentials: false, // 跨域是否传递 cookie ，默认为 false
        timeout: 5 * 1000, // 超时时间，默认为 10 秒，此次设置为 5 秒

        // 上传之前触发
        onBeforeUpload (file) {
          return file
        },

        // 上传进度的回调函数
        onProgress (progress) {
          console.log('progress', progress)
        },

        // 单个文件上传成功之后
        onSuccess (file, res) {
          console.log(`${file.name} 上传成功`, res)
        },

        // 单个文件上传失败
        onFailed (file, res) {
          console.log(`${file.name} 上传失败`, res)
        },

        // 上传错误，或者触发 timeout 超时
        onError (file, err, res) {
          console.log(`${file.name} 上传出错`, err, res)
        }
      }
    },

    /**
     * 获取编辑器文本内容
     */
    getEditorText () {
      const editor = this.editor
      if (editor != null) {
        return editor.getText()
      }
    },

    /**
     * 获取编辑器Html内容
     */
    getEditorHtml () {
      const editor = this.editor
      if (editor != null) {
        return editor.getHtml()
      }
    }
  },
  created () {

  },
  mounted () {
    this.setSpellCheckFasle() // 设置拼写检查 spellcheck 为假
    document.activeElement.blur() // 取消富文本自动聚焦且禁止虚拟键盘弹出
  },
  /**
   * 销毁富文本编辑器
   */
  beforeDestroy () {
    const editor = this.editor
    if (editor != null) {
      editor.destroy()
    }
  }
}
&lt;/script&gt;

&lt;style src="@wangeditor/editor/dist/css/style.css"&gt;&lt;/style&gt;

&lt;style lang="less" scoped&gt;
  .w-e-full-screen-container {
    z-index: 99;
  }

  .w-e-for-vue {
    margin: 0;
    border: 1px solid #ccc;

    .w-e-for-vue-toolbar {
      border-bottom: 1px solid #ccc;
    }

    .w-e-for-vue-editor {
      height: auto;

      /deep/ .w-e-text-container {

        .w-e-text-placeholder {
          top: 6px;
          color: #666;
        }

        pre {

          code {
            text-shadow: unset;
          }
        }

        p {
          margin: 5px 0;
          font-size: 14px; // 设置编辑器的默认字体大小为14px
        }
      }
    }
  }
&lt;/style&gt;
</code></pre> 
<p>服务端 IndexController.java 的上传图片方法</p> 
<pre><code class="language-java">@Value("${system.upload-file-path}")
private String uploadFilePath;

@ResponseBody
@RequestMapping("uploadImageAction")
@CrossOrigin
public HashMap&lt;String, Object&gt; uploadImageAction(@RequestParam List&lt;MultipartFile&gt; files) {
    HashMap&lt;String, Object&gt; responseMap = new HashMap&lt;&gt;();
    String newsFilePath = uploadFilePath;
    try {
        List&lt;HashMap&lt;String, String&gt;&gt; newFileList = new ArrayList&lt;&gt;();
        for (MultipartFile file : files) {
            String uuidStr = UUID.randomUUID().toString();
            String uuid = uuidStr.substring(0, 8) + uuidStr.substring(9, 13) + uuidStr.substring(14, 18) + uuidStr.substring(19, 23) + uuidStr.substring(24);

            String OldFileName = file.getOriginalFilename();// 原文件名，如：hello.pdf
            int beginIndex = OldFileName.lastIndexOf(".");// 从后匹配"."
            String newFileName = uuid + OldFileName.substring(beginIndex);// 新文件名，如uuid.pdf
            String destFileName = newsFilePath + File.separator + newFileName;// 存储路径 + 新文件名

            // 复制文件到指定目录
            File destFile = new File(destFileName);
            destFile.getParentFile().mkdirs();
            file.transferTo(destFile);

            String url = "http://IP:Port/uploadFilePath/" + newFileName;
            HashMap&lt;String, String&gt; map = new HashMap&lt;&gt;();
            map.put("url", url);
            map.put("alt", "图片描述，非必须");
            map.put("href", "图片的链接，非必须");
            newFileList.add(map);
        }
        responseMap.put("data", newFileList);
        responseMap.put("errno", 0);// 上传成功：值是数字0，不能是字符串
    } catch (FileNotFoundException e) {
        e.printStackTrace();
        responseMap.put("errno", 1);// 上传失败：值不是数字0
        responseMap.put("message", "文件无法找到");
    } catch (IOException e) {
        e.printStackTrace();
        responseMap.put("errno", 1);// 上传失败：值不是数字0
        responseMap.put("message", "文件上传失败");// 上传失败：值不是数字0
    }

    return responseMap;
}</code></pre> 
<p>服务端 StaticResourceConfig.java 静态资源配置类</p> 
<pre><code class="language-java">import org.springframework.beans.factory.annotation.Value;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry;
import org.springframework.web.servlet.config.annotation.WebMvcConfigurationSupport;

@Configuration
public class StaticResourceConfig extends WebMvcConfigurationSupport {

    @Value("${system.upload-file-path}")
    private String uploadFilePath;

    public void addResourceHandlers(ResourceHandlerRegistry registry) {
        registry.addResourceHandler("/static/**").addResourceLocations("classpath:/static/");
        registry.addResourceHandler("/uploadFilePath/**").addResourceLocations("file:" + uploadFilePath);
    }
}</code></pre> 
<p>服务端 application.yml 配置文件</p> 
<pre><code class="language-XML">server:
  port: 8091

system:
  upload-file-path: "D:/uploadFilePath/"
</code></pre> 
<p>最终效果：</p> 
<p><img alt="" height="1040" src="https://images2.imgbox.com/8f/a5/6hrMTXzU_o.png" width="1200"></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9584ee8a3f131c22b1bce8a96feb9414/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">显卡检测工具：GPU-Z</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/20de647d45a6e100dc25d877cfd3555c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">springboot&#43;mysql核酸检测信息管理系统-计算机毕业设计源码19832</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>