<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Android-计算器的实现（界面布局，计算逻辑处理） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Android-计算器的实现（界面布局，计算逻辑处理）" />
<meta property="og:description" content="源码下载
闲来无事，用android做一个计算器玩玩，想着做一个私密空间，表面是计算器，按下原先设定的算式后可以跳转到私密界面，当想想有些费事，以后若还有闲散时间，再来实现。
我实现了更完善的计算器，功能更多，逻辑更完善，欢迎访问！点击这里 界面是这样的，采用了GridLayout布局，很容易实现。代码如下
&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt; &lt;GridLayout xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34; android:layout_width=&#34;wrap_content&#34; android:layout_height=&#34;wrap_content&#34; android:columnCount=&#34;4&#34; android:layout_gravity=&#34;center&#34; android:orientation=&#34;horizontal&#34;&gt; &lt;TextView android:id=&#34;@&#43;id/contentText&#34; android:textSize=&#34;16sp&#34; android:text=&#34;@string/defaultText&#34; android:layout_gravity=&#34;fill&#34; android:maxLines=&#34;1&#34; android:layout_marginTop=&#34;55sp&#34; android:paddingRight=&#34;15sp&#34; android:layout_columnSpan=&#34;4&#34; android:gravity=&#34;right&#34;/&gt; &lt;Button android:id=&#34;@&#43;id/bt1&#34; android:text=&#34;@string/bt1&#34; android:textSize=&#34;15sp&#34; android:layout_gravity=&#34;fill&#34; android:layout_marginTop=&#34;25sp&#34; android:layout_marginRight=&#34;5sp&#34; android:layout_marginBottom=&#34;5sp&#34; /&gt; &lt;Button android:id=&#34;@&#43;id/bt2&#34; android:text=&#34;@string/bt2&#34; android:textSize=&#34;15sp&#34; android:layout_gravity=&#34;fill&#34; android:layout_marginTop=&#34;25sp&#34; android:layout_marginBottom=&#34;5sp&#34; android:layout_marginRight=&#34;5sp&#34; android:layout_columnSpan=&#34;2&#34; /&gt; &lt;Button android:id=&#34;@&#43;id/bt18&#34; android:text=&#34;@string/bt18&#34; android:textSize=&#34;15sp&#34; android:layout_marginTop=&#34;25sp&#34; android:layout_marginBottom=&#34;5sp&#34; /&gt; &lt;Button android:id=&#34;@&#43;id/bt3&#34; android:text=&#34;@string/bt3&#34; android:textSize=&#34;15sp&#34; android:layout_marginRight=&#34;5sp&#34; android:layout_marginBottom=&#34;5sp&#34; /&gt; &lt;Button android:id=&#34;@&#43;id/bt4&#34; android:text=&#34;@string/bt4&#34; android:textSize=&#34;15sp&#34; android:layout_marginRight=&#34;5sp&#34; android:layout_marginBottom=&#34;5sp&#34; /&gt; &lt;Button android:id=&#34;@&#43;id/bt5&#34; android:text=&#34;@string/bt5&#34; android:textSize=&#34;15sp&#34; android:layout_marginRight=&#34;5sp&#34; android:layout_marginBottom=&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/041e47f2f4088b0aebae90c9f32b901c/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-04-10T19:06:13+08:00" />
<meta property="article:modified_time" content="2018-04-10T19:06:13+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Android-计算器的实现（界面布局，计算逻辑处理）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>    <a href="https://download.csdn.net/download/qq_37437983/10474209">源码下载</a></p> 
<p>    闲来无事，用android做一个计算器玩玩，想着做一个私密空间，表面是计算器，按下原先设定的算式后可以跳转到私密界面，当想想有些费事，以后若还有闲散时间，再来实现。</p> 
<h2><a href="https://blog.csdn.net/qq_37437983/article/details/94301096">我实现了更完善的计算器，功能更多，逻辑更完善，欢迎访问！点击这里</a></h2> 
<p><img alt="" class="has" src="https://images2.imgbox.com/db/be/KYpotpag_o.png"></p> 
<p>    界面是这样的，采用了GridLayout布局，很容易实现。代码如下</p> 
<pre class="has"><code class="language-html">&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;GridLayout xmlns:android="http://schemas.android.com/apk/res/android"
    android:layout_width="wrap_content"
    android:layout_height="wrap_content"
    android:columnCount="4"
    android:layout_gravity="center"
    android:orientation="horizontal"&gt;
    &lt;TextView
        android:id="@+id/contentText"
        android:textSize="16sp"
        android:text="@string/defaultText"
        android:layout_gravity="fill"
        android:maxLines="1"
        android:layout_marginTop="55sp"
        android:paddingRight="15sp"
        android:layout_columnSpan="4"
        android:gravity="right"/&gt;
    &lt;Button
        android:id="@+id/bt1"
        android:text="@string/bt1"
        android:textSize="15sp"
        android:layout_gravity="fill"
        android:layout_marginTop="25sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt2"
        android:text="@string/bt2"
        android:textSize="15sp"
        android:layout_gravity="fill"
        android:layout_marginTop="25sp"
        android:layout_marginBottom="5sp"
        android:layout_marginRight="5sp"
        android:layout_columnSpan="2"
        /&gt;
    &lt;Button
        android:id="@+id/bt18"
        android:text="@string/bt18"
        android:textSize="15sp"
        android:layout_marginTop="25sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt3"
        android:text="@string/bt3"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt4"
        android:text="@string/bt4"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt5"
        android:text="@string/bt5"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt6"
        android:text="@string/bt6"
        android:textSize="15sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt7"
        android:text="@string/bt7"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt8"
        android:text="@string/bt8"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt9"
        android:text="@string/bt9"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt10"
        android:text="@string/bt10"
        android:textSize="15sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt11"
        android:text="@string/bt11"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt12"
        android:text="@string/bt12"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt13"
        android:text="@string/bt13"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        android:layout_marginBottom="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt14"
        android:text="@string/bt17"
        android:textSize="15sp"
        android:layout_gravity="fill"
        android:layout_rowSpan="2"
        /&gt;
    &lt;Button
        android:id="@+id/bt15"
        android:text="@string/bt15"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt16"
        android:text="@string/bt16"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        /&gt;
    &lt;Button
        android:id="@+id/bt17"
        android:text="@string/bt14"
        android:textSize="15sp"
        android:layout_marginRight="5sp"
        /&gt;
&lt;/GridLayout&gt;
</code></pre> 
<p>对应的string.xml代码文件如下：</p> 
<pre class="has"><code class="language-html">&lt;resources&gt;
    &lt;string name="app_name"&gt;简易计算器&lt;/string&gt;
    &lt;string name="bt1"&gt;CE&lt;/string&gt;
    &lt;string name="bt2"&gt;Backspace&lt;/string&gt;
    &lt;string name="bt3"&gt;7&lt;/string&gt;
    &lt;string name="bt4"&gt;8&lt;/string&gt;
    &lt;string name="bt5"&gt;9&lt;/string&gt;
    &lt;string name="bt6"&gt;*&lt;/string&gt;
    &lt;string name="bt7"&gt;4&lt;/string&gt;
    &lt;string name="bt8"&gt;5&lt;/string&gt;
    &lt;string name="bt9"&gt;6&lt;/string&gt;
    &lt;string name="bt10"&gt;-&lt;/string&gt;
    &lt;string name="bt11"&gt;1&lt;/string&gt;
    &lt;string name="bt12"&gt;2&lt;/string&gt;
    &lt;string name="bt13"&gt;3&lt;/string&gt;
    &lt;string name="bt14"&gt;+&lt;/string&gt;
    &lt;string name="bt15"&gt;0&lt;/string&gt;
    &lt;string name="bt16"&gt;.&lt;/string&gt;
    &lt;string name="bt17"&gt;=&lt;/string&gt;
    &lt;string name="bt18"&gt;/&lt;/string&gt;
    &lt;string name="defaultText"&gt;输入算式进行计算&lt;/string&gt;
&lt;/resources&gt;
</code></pre> 
<p>    到这里，计算器的界面布局已经实现，下面就是最重要的逻辑处理了。逻辑处理分为两部分：算式输入的强制排错和算式的结果计算。算式输入的强制排错就是对算式输入的规范，比如不能连续输入++，**，23.23.23，之类的无效算式;算式的结果计算就是根据输入的算式（我将输入的算式保存在string对象里）计算出结果。代码如下：</p> 
<pre class="has"><code class="language-java">package com.example.ffy.other;

import android.app.Activity;
import android.os.Bundle;
import android.view.View;
import android.view.Window;
import android.widget.Button;
import android.widget.TextView;
import android.widget.Toast;

public class MainActivity extends Activity implements View.OnClickListener{

    private Button[] buttons = new Button[18];
    private int[] ids = new int[]{R.id.bt1,R.id.bt2,R.id.bt3,R.id.bt4,R.id.bt5,R.id.bt6,R.id.bt7,
            R.id.bt8,R.id.bt9,R.id.bt10,R.id.bt11,R.id.bt12,R.id.bt13,R.id.bt14,R.id.bt15,R.id.bt16,R.id.bt17,R.id.bt18
    };

    private TextView textView;
    private String expression = "";
    private boolean end = false;
    private int countOperate=2;
    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        requestWindowFeature(Window.FEATURE_NO_TITLE);
        setContentView(R.layout.calculator);
        for(int i=0;i&lt;ids.length;i++){
            buttons[i] = (Button)findViewById(ids[i]);
            buttons[i].setOnClickListener(this);
        }
        textView = (TextView)findViewById(R.id.contentText);
    }
    //点击事件，强制排错
    public void onClick(View view) {
        int id = view.getId();
        Button button = (Button)view.findViewById(id);
        String current = button.getText().toString();
        if(end){ //如果上一次算式已经结束，则先清零
            expression = "";
            end = false;
        }
        if(current.equals("CE")){ //如果为CE则清零
            expression = "";
            countOperate=0;
        }else if(current.equals("Backspace")){ //如果点击退格
            if(expression.length()&gt;1){ //算式长度大于1
                expression = expression.substring(0,expression.length()-1);//退一格
                int i = expression.length()-1;
                char tmp = expression.charAt(i); //获得最后一个字符
                char tmpFront = tmp;
                for(;i&gt;=0;i--){ //向前搜索最近的 +-*/和.，并退出
                    tmpFront = expression.charAt(i);
                    if(tmpFront=='.'||tmpFront=='+'||tmpFront=='-'||tmpFront=='*'||tmpFront=='/'){
                        break;
                    }
                }
            //    Toast.makeText(this, "tmp = "+tmp, Toast.LENGTH_SHORT).show();
                if(tmp&gt;='0'&amp;&amp;tmp&lt;='9'){ //最后一个字符为数字，则识别数赋值为0
                    countOperate=0;
                }else if(tmp==tmpFront&amp;&amp;tmpFront!='.') countOperate=2; //如果为+-*/，赋值为2
                else if(tmpFront=='.') countOperate=1; //如果前面有小数点赋值为1
            }else if(expression.length()==1){
                expression = "";
            }
        }else if(current.equals(".")){
            if(expression.equals("")||countOperate==2){
                expression+="0"+current;
                countOperate = 1;  //小数点按过之后赋值为1
            }
            if(countOperate==0){
                expression+=".";
                countOperate = 1;
            }
        }else if(current.equals("+")||current.equals("-")||current.equals("*")||current.equals("/")){
            if(countOperate==0){
                expression+=current;
                countOperate = 2;  //  +-*/按过之后赋值为2
            }
        }else if(current.equals("=")){ //按下=时，计算结果并显示
            double result = (double) Math.round(count()*100)/100;
            expression+="="+result+"(结果只保留两位小数)";
            end = true; //此次计算结束
        }
        else{//此处是当退格出现2+0时，用current的值替代0
            if(expression.length()&gt;=1){
                char tmp1 = expression.charAt(expression.length()-1);
                if(tmp1=='0'&amp;&amp;expression.length()==1){
                    expression = expression.substring(0,expression.length()-1);
                }
                else if(tmp1=='0'&amp;&amp;expression.length()&gt;1){
                    char tmp2 = expression.charAt(expression.length()-2);
                    if(tmp2=='+'||tmp2=='-'||tmp2=='*'||tmp2=='/'){
                        expression = expression.substring(0,expression.length()-1);
                    }
                }
            }
            expression+=current;
            if(countOperate==2||countOperate==1) countOperate=0;
        }
    //    Toast.makeText(this, "countOperate:"+countOperate, Toast.LENGTH_SHORT).show();
        textView.setText(expression); //显示出来
    }
    //计算逻辑，求expression表达式的值
    private double count(){
        double result=0;
        double tNum=1,lowNum=0.1,num=0;
        char tmp=0;
        int operate = 1; //识别+-*/，为+时为正数，为-时为负数，为×时为-2/2,为/时为3/-3;
        boolean point = false;
        for(int i=0;i&lt;expression.length();i++){ //遍历表达式
            tmp = expression.charAt(i);
            if(tmp=='.'){ //因为可能出现小数，此处进行判断是否有小数出现
                point = true;
                lowNum = 0.1;
            }else if(tmp=='+'||tmp=='-'){ 
                if(operate!=3&amp;&amp;operate!=-3){ //此处判断通用，适用于+-*
                    tNum *= num;
                }else{ //计算/
                    tNum /= num;
                }
            //    Toast.makeText(this, "tNum = "+tNum, Toast.LENGTH_SHORT).show();
                if(operate&lt;0){ //累加入最终的结果
                    result -= tNum;
                }else{
                    result += tNum;
                }
                operate = tmp=='+'?1:-1;
                num = 0;
                tNum = 1;
                point = false;
            }else if(tmp=='*'){
                if(operate!=3&amp;&amp;operate!=-3){
                    tNum *= num;
                }else{
                    tNum /= num;
                }
                operate = operate&lt;0?-2:2;
                point = false;
                num = 0;
            }else if(tmp=='/'){
                if(operate!=3&amp;&amp;operate!=-3){
                    tNum *= num;
                }else{
                    tNum /= num;
                }
                operate = operate&lt;0?-3:3;
                point = false;
                num = 0;
            }else{
                //读取expression中的每个数字，doube型
                if(!point){
                    num = num*10+tmp-'0';
                }else{
                    num += (tmp-'0')*lowNum;
                    lowNum*=0.1;
                }
            }
        }
        //循环遍历结束，计算最后一个运算符后面的数
        if(operate!=3&amp;&amp;operate!=-3){
            tNum *= num;
        }else{
            tNum /= num;
        }
    //    Toast.makeText(this, "tNum = "+tNum, Toast.LENGTH_SHORT).show();
        if(operate&lt;0){
            result -= tNum;
        }else{
            result += tNum;
        }
        //返回最后的结果
        return result;
    }
}
</code></pre> 
<p><a href="https://download.csdn.net/download/qq_37437983/10474209">源码下载</a></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b1d30253ac439351dae74148f022c042/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">VMware搭建CentOS，使用普通用户切换ROOt登入</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/49a353fb09133f49ef57199a7718ea2f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">C/C&#43;&#43;中scanf和cin的读取回车、空格等分隔符</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>