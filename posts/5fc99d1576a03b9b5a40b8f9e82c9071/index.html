<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>交叉编译opencv4移植到ARM - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="交叉编译opencv4移植到ARM" />
<meta property="og:description" content="文章目录 前言（逼逼叨）环境准备1.系统环境准备2.编译环境准备2.1下载交叉编译工具：gcc、runtime、sysroot2.2 下载后解压并**合并**2.3 设置环境变量 配置编译makemake install 移植打包opencv拷贝到armARM端操作opencv解压安装链接库文件 可能产生的问题libstdc&#43;&#43;.so.6 not found解决方法： 本文主要参考：https://blog.csdn.net/nila101/article/details/87367595 前言（逼逼叨） opencv在我虚拟机中轻松的就编译成功了，顺利的装上了。但是交叉编译真的搞死我了，难就难在CMake配置上，搞了3天，第三天终于琢磨出来了。期间找过无数篇帖子和博客，各种千奇百怪的办法都有，按照他们的奇葩方法我试了n次，不知道他们用这奇葩方法是怎么成功的？？？写这篇博客主要作为记录，顺便回馈给广大网友，没有广大道友的博客和帖子，我也无法突破！
现在已经是晚上11:47分了，写完这个博客又得直接睡觉了，没时间消遣了。
在arm机上运行opencv拍下我帅气照片的那一刻，我开心地笑了~
2月初，正是2019-nCov爆发的时候，请各位保重！
环境 宿主机：Ubuntu18.04 x86_64（虚拟机）目标机：nanoPi neo2ARM芯片架构:aarch64opencv版本：opencv 4.2.0交叉编译器：gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu
交叉编译工具链下载地址：https://releases.linaro.org/components/toolchain/binaries/6.3-2017.05/aarch64-linux-gnu/ 准备 1.系统环境准备 opencv中文文档：https://www.w3cschool.cn/opencv/opencv-123j28z4.html
使用终端运行以下命令
# 如果电脑上没有C/C&#43;&#43;编译环境，执行： sudo apt install build-essential # 使64位系统兼容32位的库： sudo apt install lib32ncurses5 lib32z1 # 安装相关工具 sudo apt install cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev # 安装cmake-gui sudo apt install cmake-qt-gui # 下载opencv mkdir nanopi_neo2 #建立一个目录 cd nanopi_neo2 git clone https://github.com/opencv/opencv.git opencv可以选择版本下载
opencv GitHub地址: https://github." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5fc99d1576a03b9b5a40b8f9e82c9071/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-07-20T18:23:57+08:00" />
<meta property="article:modified_time" content="2020-07-20T18:23:57+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">交叉编译opencv4移植到ARM</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><a href="#_2" rel="nofollow">前言（逼逼叨）</a></li><li><a href="#_7" rel="nofollow">环境</a></li><li><a href="#_14" rel="nofollow">准备</a></li><li><ul><li><a href="#1_15" rel="nofollow">1.系统环境准备</a></li><li><a href="#2_37" rel="nofollow">2.编译环境准备</a></li><li><ul><li><a href="#21gccruntimesysroot_38" rel="nofollow">2.1下载交叉编译工具：gcc、runtime、sysroot</a></li><li><a href="#22__40" rel="nofollow">2.2 下载后解压并**合并**</a></li><li><a href="#23__51" rel="nofollow">2.3 设置环境变量</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_63" rel="nofollow">配置</a></li><li><a href="#_100" rel="nofollow">编译</a></li><li><ul><li><a href="#make_101" rel="nofollow">make</a></li><li><a href="#make_install_111" rel="nofollow">make install</a></li></ul> 
   </li><li><a href="#_117" rel="nofollow">移植</a></li><li><ul><li><a href="#opencv_118" rel="nofollow">打包opencv</a></li><li><a href="#arm_125" rel="nofollow">拷贝到arm</a></li><li><a href="#ARM_130" rel="nofollow">ARM端操作</a></li><li><ul><li><a href="#opencv_131" rel="nofollow">opencv解压安装</a></li><li><a href="#_140" rel="nofollow">链接库文件</a></li></ul> 
   </li></ul> 
   </li><li><a href="#_153" rel="nofollow">可能产生的问题</a></li><li><ul><li><a href="#libstdcso6_not_found_154" rel="nofollow">libstdc++.so.6 not found</a></li><li><ul><li><a href="#_183" rel="nofollow">解决方法：</a></li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<br> 
<mark><em>本文主要参考：https://blog.csdn.net/nila101/article/details/87367595</em></mark> 
<p></p> 
<h3><a id="_2"></a>前言（逼逼叨）</h3> 
<p>opencv在我虚拟机中轻松的就编译成功了，顺利的装上了。但是交叉编译真的搞死我了，难就难在CMake配置上，搞了3天，第三天终于琢磨出来了。期间找过无数篇帖子和博客，各种千奇百怪的办法都有，按照他们的奇葩方法我试了n次，不知道他们用这奇葩方法是怎么成功的？？？写这篇博客主要作为记录，顺便回馈给广大网友，没有广大道友的博客和帖子，我也无法突破！<br> 现在已经是晚上11:47分了，写完这个博客又得直接睡觉了，没时间消遣了。<br> 在arm机上运行opencv拍下我帅气照片的那一刻，我开心地笑了~<br> 2月初，正是2019-nCov爆发的时候，请各位保重！</p> 
<h3><a id="_7"></a>环境</h3> 
<ul><li>宿主机：Ubuntu18.04 x86_64（虚拟机）</li><li>目标机：nanoPi neo2</li><li>ARM芯片架构:aarch64</li><li>opencv版本：opencv 4.2.0</li><li>交叉编译器：gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu<br> 交叉编译工具链下载地址：<mark>https://releases.linaro.org/components/toolchain/binaries/6.3-2017.05/aarch64-linux-gnu/</mark></li></ul> 
<h3><a id="_14"></a>准备</h3> 
<h4><a id="1_15"></a>1.系统环境准备</h4> 
<p><mark>opencv中文文档：https://www.w3cschool.cn/opencv/opencv-123j28z4.html</mark><br> 使用终端运行以下命令</p> 
<pre><code class="prism language-bash"><span class="token comment"># 如果电脑上没有C/C++编译环境，执行：</span>
<span class="token function">sudo</span> apt <span class="token function">install</span> build-essential
<span class="token comment"># 使64位系统兼容32位的库：</span>
<span class="token function">sudo</span> apt <span class="token function">install</span> lib32ncurses5 lib32z1
<span class="token comment"># 安装相关工具</span>
<span class="token function">sudo</span> apt <span class="token function">install</span> cmake <span class="token function">git</span> libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev
<span class="token comment"># 安装cmake-gui</span>
<span class="token function">sudo</span> apt <span class="token function">install</span> cmake-qt-gui
<span class="token comment"># 下载opencv</span>
<span class="token function">mkdir</span> nanopi_neo2 <span class="token comment">#建立一个目录</span>
<span class="token function">cd</span> nanopi_neo2
<span class="token function">git</span> clone https://github.com/opencv/opencv.git
</code></pre> 
<p>opencv可以选择版本下载</p> 
<pre><code>opencv GitHub地址:
https://github.com/opencv/opencv/releases
</code></pre> 
<h4><a id="2_37"></a>2.编译环境准备</h4> 
<h5><a id="21gccruntimesysroot_38"></a>2.1下载交叉编译工具：gcc、runtime、sysroot</h5> 
<p><img src="https://images2.imgbox.com/e8/bb/bbzktZg3_o.png" alt="交叉编译工具"></p> 
<h5><a id="22__40"></a>2.2 下载后解压并<strong>合并</strong></h5> 
<p>放在~/nanopi_neo2/gcc-linaro-6.3.1-2017.02-x86_64_aarch64-linux-gnu/目录下</p> 
<pre><code class="prism language-bash">xz -d gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu.tar.xz
xz -d runtime-gcc-linaro-6.3.1-2017.05-aarch64-linux-gnu.tar.xz
xz -d sysroot-glibc-linaro-2.23-2017.05-aarch64-linux-gnu.tar.xz
<span class="token function">tar</span> -xvf gcc-linaro-6.3.1-2017.05-x86_64_aarch64-linux-gnu.tar
<span class="token function">tar</span> -xvf runtime-gcc-linaro-6.3.1-2017.05-aarch64-linux-gnu.tar
<span class="token function">tar</span> -xvf sysroot-glibc-linaro-2.23-2017.05-aarch64-linux-gnu.tar
 最后将3个文件加内容合并
</code></pre> 
<h5><a id="23__51"></a>2.3 设置环境变量</h5> 
<pre><code class="prism language-bash"><span class="token function">sudo</span> vim /etc/profile
在文件末尾加上这句：
<span class="token function">export</span> PATH<span class="token operator">=</span><span class="token variable">$PATH</span>:/home/yourname/nanopi_neo2/gcc-linaro-6.3.1-2017.02-x86_64_aarch64-linux-gnu/bin
<span class="token comment"># 生效环境变量</span>
<span class="token function">source</span> /etc/profile
<span class="token comment"># 重启[可选]</span>
<span class="token function">sudo</span> <span class="token function">reboot</span> 
</code></pre> 
<h3><a id="_63"></a>配置</h3> 
<pre><code class="prism language-bash"><span class="token comment"># 进入opencv项目目录</span>
<span class="token function">cd</span> ~/nanopi_neo2/opencv/
<span class="token comment"># 创建2个文件夹</span>
<span class="token function">mkdir</span> -p build/install 
<span class="token comment"># 进入build目录</span>
<span class="token function">cd</span> build
<span class="token comment"># 运行cmake-gui进行编译配置</span>
cmake-gui
</code></pre> 
<p><img src="https://images2.imgbox.com/b8/da/ajjlTUBo_o.png" alt="cmake-gui"><br> ①:opencv选择源码顶层目录<br> ②:编译目录,存储编译时的中间文件,这里为我们刚才创建的build目录<br> ③:配置好2个目录之后就点击configure按钮<br> <img src="https://images2.imgbox.com/ea/3a/oxrW3qB9_o.png" alt="configure"><br> <strong>选择Specify toolchain file for cross-compiling(关键!关键!关键!)</strong><br> <mark>网上99%的教程都让我选specify options for corss-compiling,根本行不通!!!</mark><br> 点击Next<br> <img src="https://images2.imgbox.com/47/4c/TuFrVLEs_o.png" alt="select file"><br> <img src="https://images2.imgbox.com/2c/5e/jIevYPu2_o.png" alt="选择芯片架构文件"><br> 选择opencv/platforms/linux/aarch64-gnu.toolchain.cmake这个文件<br> <mark>aarch64是全志H5芯片的架构,请根据你自己的架构来选择</mark><br> 选择好之后点击Finish按钮<br> <img src="https://images2.imgbox.com/87/76/rdl8RLug_o.png" alt="在这里插入图片描述"><br> 勾选BUILD_JPEG、BUILD_PNG<br> <img src="https://images2.imgbox.com/1f/c8/mYi3GDtz_o.png" alt="配置"><br> CMAKE_BUILD_TYPE 输入Release</p> 
<p>CMAKE_INSTALL_PREFIX 选择你想要安装的目录，这里是源码下刚才创建的install目录<br> <img src="https://images2.imgbox.com/51/1e/FyuLjhHi_o.png" alt="配置"><br> 勾选Advanced<br> 在CMAKE_EXE_LINKER_FLAGS栏填入-pthread -ldl -lrt<br> <img src="https://images2.imgbox.com/e2/6c/1DYWcYtw_o.png" alt="配置"><br> 单击Configure，接着单击Generate<br> 关闭cmake-gui</p> 
<h3><a id="_100"></a>编译</h3> 
<h4><a id="make_101"></a>make</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 运行编译</span>
<span class="token comment"># 虚拟机内存不够大的话别太贪心搞 make -j8</span>
<span class="token function">make</span> -j4
</code></pre> 
<p>我的机子是16G内存的,也不敢贪心搞make -j8,因内存不足编译会报错,毕竟是虚拟机.<br> 机器开始疯狂的跑起来了!!!<br> <img src="https://images2.imgbox.com/de/37/ZETyDPWy_o.png" alt="编译完成"><br> 编译顺利完成,有图有真相!</p> 
<h4><a id="make_install_111"></a>make install</h4> 
<pre><code class="prism language-bash"><span class="token function">make</span> <span class="token function">install</span>
</code></pre> 
<p>很快就install好了<br> 在install文件夹内产生了opencv的文件</p> 
<h3><a id="_117"></a>移植</h3> 
<h4><a id="opencv_118"></a>打包opencv</h4> 
<p>将~/nanopi_neo2/build/install/目录下的文件都打包</p> 
<pre><code class="prism language-bash"><span class="token function">cd</span> ~/nanopi_neo2/build/install/
<span class="token function">tar</span> -czvf opencv4_2.tar.gz ./*
</code></pre> 
<p>产生的这个压缩包就是编译好的opencv了,保存好,省得下次再编!!</p> 
<h4><a id="arm_125"></a>拷贝到arm</h4> 
<pre><code class="prism language-bash"><span class="token comment"># 运行拷贝命令</span>
<span class="token function">scp</span> ./opencv4_2.tar.gz root@192.168.1.6:/usr/local/arm/opencv4_2/
</code></pre> 
<h4><a id="ARM_130"></a>ARM端操作</h4> 
<h5><a id="opencv_131"></a>opencv解压安装</h5> 
<pre><code class="prism language-bash"><span class="token comment"># 进入目录</span>
<span class="token function">cd</span> /usr/local/arm/opencv4_2/
<span class="token comment"># 解压</span>
<span class="token function">tar</span> -xzvf opencv4_2.tar.gz
<span class="token comment"># 删除压缩包</span>
<span class="token function">rm</span> opencv4_2.tar.gz
</code></pre> 
<h5><a id="_140"></a>链接库文件</h5> 
<pre><code class="prism language-bash"><span class="token function">cd</span> /etc/ld.so.conf.d
<span class="token comment"># 新建一个文件</span>
<span class="token function">touch</span> opencv.conf
<span class="token comment"># 编辑文件</span>
vim opencv.conf
<span class="token comment"># 添加如下内容：</span>
/usr/local/arm/opencv4_2/lib
<span class="token comment"># 运行 使之生效</span>
ldconfig
</code></pre> 
<p>至此，OpenCV的移植完成！！！</p> 
<h3><a id="_153"></a>可能产生的问题</h3> 
<h4><a id="libstdcso6_not_found_154"></a>libstdc++.so.6 not found</h4> 
<p>遇到如下错误</p> 
<pre><code class="prism language-bash">./cameraApp: /usr/lib/aarch64-linux-gnu/libstdc++.so.6: version `GLIBCXX_3.4.22' not found <span class="token punctuation">(</span>required by /usr/local/arm/opencv4_2/lib/libopencv_gapi.so.4.2<span class="token punctuation">)</span>
</code></pre> 
<p>意思是导入库所需要的 libstdc++.so.6 没有找到，然后，我执行 locate libstdc++.so.6 命令，发现这个库是存在的啊。<br> 上网查了一下发现原本是因为升级了 OpenCv 之后需要更高版本的库，而当前的版本过低，所以才出错。</p> 
<pre><code class="prism language-bash"><span class="token comment"># 执行这个命令看GLIBCXX版本</span>
strings /usr/lib/aarch64-linux-gnu/libstdc++.so.6 <span class="token operator">|</span> <span class="token function">grep</span> GLIBCXX
</code></pre> 
<p>果然，显示的版本低于3.4.22 。<br> 需要找一个更高版本的libstdc++.so.6: 使用locate命令来查查本地有没有：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 在Ubuntu虚拟机中执行此命令</span>
<span class="token function">locate</span> libstdc++.so.6
</code></pre> 
<p>在交叉编译工具链里面有一个 libstdc++.so.6.0.22<br> <mark>注意:芯片架构需要吻合(看路径)</mark></p> 
<pre><code class="prism language-bash"><span class="token comment"># 进目录</span>
<span class="token function">cd</span> ~/nanopi_neo2/gcc-linaro-6.3.1-2017.02-x86_64_aarch64-linux-gnu/aarch64-linux-gnu/lib64/
<span class="token comment"># 看版本</span>
strings libstdc++.so.6.0.22 <span class="token operator">|</span> <span class="token function">grep</span> GLIBCXX
</code></pre> 
<p><img src="https://images2.imgbox.com/cb/4d/dljLg1xQ_o.png" alt="在这里插入图片描述"><br> 查看它里面的GLIBCXX，发现正是我们需要的:3.4.22</p> 
<h5><a id="_183"></a>解决方法：</h5> 
<p>首先把libstdc++.so.6.0.20 复制到 nanopi的库/usr/lib/aarch64-linux-gnu/文件夹下，然后删除原来的软链接 libstdc++.so.6,建立新的指向libstdc++.so.6.0.20的软链接；</p> 
<pre><code class="prism language-bash"><span class="token comment"># Ubuntu端操作</span>
<span class="token function">scp</span> libstdc++.so.6.0.22 root@192.168.1.6:/usr/lib/aarch64-linux-gnu/
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment"># arm端操作</span>
<span class="token comment"># 查看软链接文件指向</span>
ll <span class="token operator">|</span><span class="token function">grep</span> libstdc++.so.6 -h
<span class="token comment"># 删除软链接文件</span>
<span class="token function">rm</span> libstdc++.so.6
</code></pre> 
<p>原来的libstdc++.so.6，如下:</p> 
<pre><code class="prism language-bash">rwxrwxrwx  1 yinheyi yinheyi       19 7月  27 23:12 libstdc++.so.6 -<span class="token operator">&gt;</span> libstdc++.so.6.0.21
</code></pre> 
<p>删除掉了原来的libstdc++.so.6，现在建立新的指向libstdc++.so.6.0.22的软链接：</p> 
<pre><code class="prism language-bash"><span class="token comment"># 重新软链接</span>
<span class="token function">ln</span> -s libstdc++.so.6.0.22 libstdc++.so.6
</code></pre> 
<p>再来看看现在的新的libstdc++.so.6,如下：</p> 
<pre><code class="prism language-bash">lrwxrwxrwx 1 root root       19 Feb  2 14:59 libstdc++.so.6 -<span class="token operator">&gt;</span> libstdc++.so.6.0.22*
</code></pre> 
<p>问题解决!</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d6c4c44a88cc43f9bdf800a1aacdf354/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【行人重识别】Unsupervised Salience Learning for Person Re-identification</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/35fbf272f870ba455d45a28a2965bb9f/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">geoserver图层样式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>