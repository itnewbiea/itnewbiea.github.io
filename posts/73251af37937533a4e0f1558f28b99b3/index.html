<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>【mars3d】聚合点更改样式 ， 自定义背景 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="【mars3d】聚合点更改样式 ， 自定义背景" />
<meta property="og:description" content="自定义聚合点的背景图片，图片上显示聚合的数目
问题：绘制出来的效果，经常只有数字，没有背景图，移动过去才有背景图。
1.通过 mars3d的方法 getTextImage （Util - Mars3D API文档http://mars3d.cn/api/Util.html?classFilter=util#.getTextImage）将文字转换成base64图片，但是会出现上面的问题；
在第二步说正确操作
item.graphicLayer = new mars3d.layer.BusineDataLayer({ data: jhData, dataColumn: &#34;data&#34;, // 数据接口中对应列表所在的取值字段名 lngColumn: &#34;JD&#34;, latColumn: &#34;WD&#34;, altColumn: &#34;z&#34;, symbol: { type: &#34;billboard&#34;, // 对应是 mars3d.graphic.BillboardEntity styleOptions: { image: item.src, horizontalOrigin: Cesium.HorizontalOrigin.CENTER, verticalOrigin: Cesium.VerticalOrigin.BOTTOM, scaleByDistance: new Cesium.NearFarScalar( 1000, 0.7, 5000000, 0.3 ), label: { // text: &#34;{BHMC}&#34;, font_size: 19, color: Cesium.Color.AZURE, outline: true, outlineColor: Cesium.Color.BLACK, outlineWidth: 2, horizontalOrigin: Cesium.HorizontalOrigin.LEFT, verticalOrigin: Cesium.VerticalOrigin.BOTTOM, pixelOffset: new Cesium." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/73251af37937533a4e0f1558f28b99b3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-02-20T14:48:42+08:00" />
<meta property="article:modified_time" content="2023-02-20T14:48:42+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">【mars3d】聚合点更改样式 ， 自定义背景</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>自定义聚合点的背景图片，图片上显示聚合的数目</p> 
<p>问题：绘制出来的效果，经常只有数字，没有背景图，移动过去才有背景图。</p> 
<p>1.通过 mars3d的方法 getTextImage （<a class="has-card" href="http://mars3d.cn/api/Util.html?classFilter=util#.getTextImage" rel="nofollow" title="Util - Mars3D API文档"><span class="link-card-box"><span class="link-title">Util - Mars3D API文档</span><span class="link-link"><img alt="" class="link-link-icon" src="https://images2.imgbox.com/f3/52/WQKn8W1e_o.png">http://mars3d.cn/api/Util.html?classFilter=util#.getTextImage</span></span></a>）将文字转换成base64图片，但是会出现上面的问题；</p> 
<p>在第二步说正确操作</p> 
<pre><code class="language-javascript">item.graphicLayer = new mars3d.layer.BusineDataLayer({
            data: jhData,
            dataColumn: "data", // 数据接口中对应列表所在的取值字段名
            lngColumn: "JD",
            latColumn: "WD",
            altColumn: "z",
            symbol: {
                type: "billboard", // 对应是 mars3d.graphic.BillboardEntity
                styleOptions: {
                    image: item.src,
                    horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                    scaleByDistance: new Cesium.NearFarScalar(
                        1000,
                        0.7,
                        5000000,
                        0.3
                    ),
                    label: {
                        // text: "{BHMC}",
                        font_size: 19,
                        color: Cesium.Color.AZURE,
                        outline: true,
                        outlineColor: Cesium.Color.BLACK,
                        outlineWidth: 2,
                        horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                        verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                        pixelOffset: new Cesium.Cartesian2(10, 0), // 偏移量
                        distanceDisplayCondition:
                            new Cesium.DistanceDisplayCondition(0.0, 80000),
                    },
                },
            },
            // 点的聚合配置
            clustering: {
                enabled: true,
                pixelRange: 50,
                clampToGround: true,
                style: {
                    image: obj.markerJh,
                    width: 38,
                    heihgt: 87,
                    horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                    verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                },
                getImage: (count) =&gt; {
                    // obj.markerJh
                    let html1 = `&lt;div&gt;${count}&lt;/div&gt;`;
                    let html = mars3d.Util.getTemplateHtml(count, {});
                    html = mars3d.Util.getTextImage(count, {
                        background: true,
                        backgroundColor: Cesium.Color.TRANSPARENT,
                    });
                    return html;
                },
            },
            attr: obj,
        });
        this.myMap.addLayer(item.graphicLayer);</code></pre> 
<p><br> 2.使用Canvas转图片 ，mars3d也有对应示例参考</p> 
<p>（示例地址：<a href="http://mars3d.cn/editor-vue.html?id=graphic%5Centity%5Cbillboard-canvas" rel="nofollow" title=" 功能示例(Vue版)  | Mars3D三维可视化平台 | 火星科技"> 功能示例(Vue版) | Mars3D三维可视化平台 | 火星科技</a>）</p> 
<p><br> 中有个文件  CanvasBillboard.js ，需要引入；</p> 
<p>之后 getImage 中使用该方法即可；</p> 
<pre><code class="language-javascript">getImage:function(count){
    const canvas = document.createElement("canvas")
    canvas.id = this.id
    canvas.width = this.style.width
    canvas.height = this.style.height
 
    const ctx = canvas.getContext("2d")
    ctx.clearRect(0, 0, canvas.width, canvas.height)
    // 绘制图片
    ctx.drawImage(this._pngImage, 0, 0)
 
    // 绘制文字
    ctx.fillStyle = "rgb(255, 255, 255)"
    ctx.font = "55px 楷体"
    ctx.textBaseline = "middle" 
    ctx.fillText(count, 160, canvas.height / 2) 
 
    // 将图片赋予给矢量对象进行显示，this.image是父类的属性
    // this.image = canvas
    return canvas.toDataURL("image/png")
}</code></pre> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/d8d821f5502deb97dbac5d35e32a294d/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">关于JS变量提升以及暂时性死域的理解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7329d7aea10dfa6e62e86f00afc59ecb/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【mars3d&#43;vue2】项目打包报错 error in ./node_modules/mars3d-cesium/Build/Cesium/index.js</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>