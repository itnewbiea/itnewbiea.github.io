<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>ARM1.2作业 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="ARM1.2作业" />
<meta property="og:description" content="实现数码管不同位显示不同的数字
spi.h
#ifndef __SPI_H__ #define __SPI_H__ #include &#34;stm32mp1xx_gpio.h&#34; #include &#34;stm32mp1xx_rcc.h&#34; //MOSI对应的引脚输入高低电平的信号PE14 #define MOSI_OUTPUT_H() do{GPIOE-&gt;ODR |= (0x1 &lt;&lt; 14);}while(0) #define MOSI_OUTPUT_L() do{GPIOE-&gt;ODR &amp;= (~(0x1 &lt;&lt; 14));}while(0) //对应595芯片的锁存引脚输出高低电平 PE11 #define NSS_OUTPUT_H() do{GPIOE-&gt;ODR |= (0x1 &lt;&lt;11);}while(0) #define NSS_OUTPUT_L() do{GPIOE-&gt;ODR &amp;= (~(0x1 &lt;&lt;11));}while(0) //时钟信号对应的引脚输出高低电平 PE12 #define SCK_OUTPUT_H() do{GPIOE-&gt;ODR |= (0x1 &lt;&lt;12);}while(0) #define SCK_OUTPUT_L() do{GPIOE-&gt;ODR &amp;= (~(0x1 &lt;&lt;12));}while(0) //SPI初始化函数，推挽输出，高速，禁止上拉和下拉 void SPI_init(void); //SPI发送数据的函数 void SPI_write(unsigned char dat); void delay_us1(unsigned int us); #endif spi.c
#include &#34;spi.h&#34; void delay_us1(unsigned int us) { int i,j; for(i = 0;i&lt;us;i&#43;&#43;) for(j = 0;j&lt;1;j&#43;&#43;); } void SPI_init(void) { RCC-&gt;MP_AHB4ENSETR |= (0x1 &lt;&lt; 4); //MOSI PE14 GPIOE-&gt;MODER &amp;= (~(0x3 &lt;&lt;28)); GPIOE-&gt;MODER |= (0x1 &lt;&lt;28); GPIOE-&gt;OTYPER &amp;= (~(0x1 &lt;&lt; 14)); GPIOE-&gt;OSPEEDR &amp;= (~(0X3 &lt;&lt; 28)); GPIOE-&gt;PUPDR &amp;= (~(0X3 &lt;&lt;28)); //MOSI PE13 GPIOE-&gt;MODER &amp;= (~(0x3 &lt;&lt;26)); GPIOE-&gt;OSPEEDR &amp;= (~(0x3 &lt;&lt; 26)); GPIOE-&gt;PUPDR &amp;= (~(0x3 &lt;&lt;26)); //MOSI PE12 GPIOE-&gt;MODER &amp;= (~(0x3 &lt;&lt;24)); GPIOE-&gt;MODER |= (0x1 &lt;&lt;24); GPIOE-&gt;OTYPER &amp;= (~(0x1 &lt;&lt; 12)); GPIOE-&gt;OSPEEDR &amp;= (~(0X3 &lt;&lt; 24)); GPIOE-&gt;PUPDR &amp;= (~(0X3 &lt;&lt;24)); //MOSI PE11 GPIOE-&gt;MODER &amp;= (~(0x3 &lt;&lt;22)); GPIOE-&gt;MODER |= (0x1 &lt;&lt;22); GPIOE-&gt;OTYPER &amp;= (~(0x1 &lt;&lt; 11)); GPIOE-&gt;OSPEEDR &amp;= (~(0X3 &lt;&lt; 22)); GPIOE-&gt;PUPDR &amp;= (~(0X3 &lt;&lt;22)); NSS_OUTPUT_L();//595芯片的锁存引脚拉低 SCK_OUTPUT_L();//SPI的时钟线拉低 } void SPI_write(unsigned char dat) { unsigned char i; for(i = 0;i&lt;8;i&#43;&#43;) { if(dat &amp; 0x01) { MOSI_OUTPUT_H();//MOSI线写高 } else { MOSI_OUTPUT_L();//MOSI线写低 } dat &gt;&gt;=1; //时钟线从低电平到高电平的变化时，MOSI数据线上的数据 //被写到595芯片的移位寄存器中 SCK_OUTPUT_L(); delay_us1(10); SCK_OUTPUT_H(); delay_us1(10); } } main." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6e1677d5ebe3920489d0a4dc73be96a8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2024-01-02T20:41:41+08:00" />
<meta property="article:modified_time" content="2024-01-02T20:41:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">ARM1.2作业</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>实现数码管不同位显示不同的数字</p> 
<p>spi.h</p> 
<pre><code class="hljs">#ifndef __SPI_H__
#define __SPI_H__
#include "stm32mp1xx_gpio.h"
#include "stm32mp1xx_rcc.h"

//MOSI对应的引脚输入高低电平的信号PE14
#define MOSI_OUTPUT_H()  do{GPIOE-&gt;ODR |= (0x1 &lt;&lt; 14);}while(0)
#define MOSI_OUTPUT_L()  do{GPIOE-&gt;ODR &amp;= (~(0x1 &lt;&lt; 14));}while(0)

//对应595芯片的锁存引脚输出高低电平   PE11
#define NSS_OUTPUT_H()   do{GPIOE-&gt;ODR |= (0x1 &lt;&lt;11);}while(0)
#define NSS_OUTPUT_L()   do{GPIOE-&gt;ODR &amp;= (~(0x1 &lt;&lt;11));}while(0)

//时钟信号对应的引脚输出高低电平  PE12
#define SCK_OUTPUT_H()  do{GPIOE-&gt;ODR |= (0x1 &lt;&lt;12);}while(0)
#define SCK_OUTPUT_L()  do{GPIOE-&gt;ODR &amp;= (~(0x1 &lt;&lt;12));}while(0)


//SPI初始化函数，推挽输出，高速，禁止上拉和下拉
void SPI_init(void);
//SPI发送数据的函数
void SPI_write(unsigned char dat);
void delay_us1(unsigned int us);
#endif</code></pre> 
<p>spi.c</p> 
<pre><code class="hljs">#include "spi.h"

void delay_us1(unsigned int us)
{
    int i,j;
    for(i = 0;i&lt;us;i++)
    for(j = 0;j&lt;1;j++);
}

void SPI_init(void)
{
    RCC-&gt;MP_AHB4ENSETR |= (0x1 &lt;&lt; 4);
    //MOSI   PE14
    GPIOE-&gt;MODER &amp;= (~(0x3 &lt;&lt;28));
    GPIOE-&gt;MODER |= (0x1 &lt;&lt;28);
    GPIOE-&gt;OTYPER &amp;= (~(0x1 &lt;&lt; 14));
    GPIOE-&gt;OSPEEDR &amp;= (~(0X3 &lt;&lt; 28));
    GPIOE-&gt;PUPDR &amp;= (~(0X3 &lt;&lt;28));
    //MOSI   PE13
    GPIOE-&gt;MODER &amp;= (~(0x3 &lt;&lt;26));
    GPIOE-&gt;OSPEEDR &amp;= (~(0x3 &lt;&lt; 26));
    GPIOE-&gt;PUPDR &amp;= (~(0x3 &lt;&lt;26));
    //MOSI   PE12
    GPIOE-&gt;MODER &amp;= (~(0x3 &lt;&lt;24));
    GPIOE-&gt;MODER |= (0x1 &lt;&lt;24);
    GPIOE-&gt;OTYPER &amp;= (~(0x1 &lt;&lt; 12));
    GPIOE-&gt;OSPEEDR &amp;= (~(0X3 &lt;&lt; 24));
    GPIOE-&gt;PUPDR &amp;= (~(0X3 &lt;&lt;24));
    //MOSI   PE11
    GPIOE-&gt;MODER &amp;= (~(0x3 &lt;&lt;22));
    GPIOE-&gt;MODER |= (0x1 &lt;&lt;22);
    GPIOE-&gt;OTYPER &amp;= (~(0x1 &lt;&lt; 11));
    GPIOE-&gt;OSPEEDR &amp;= (~(0X3 &lt;&lt; 22));
    GPIOE-&gt;PUPDR &amp;= (~(0X3 &lt;&lt;22));
    NSS_OUTPUT_L();//595芯片的锁存引脚拉低
    SCK_OUTPUT_L();//SPI的时钟线拉低
}


void SPI_write(unsigned char dat)
{
    unsigned char i;
    for(i = 0;i&lt;8;i++)
    {
        if(dat &amp; 0x01)
        {
            MOSI_OUTPUT_H();//MOSI线写高
        }
        else
        {
            MOSI_OUTPUT_L();//MOSI线写低
        }
        dat &gt;&gt;=1;
        //时钟线从低电平到高电平的变化时，MOSI数据线上的数据
        //被写到595芯片的移位寄存器中
        SCK_OUTPUT_L();
        delay_us1(10);
        SCK_OUTPUT_H();
        delay_us1(10);
    }
}</code></pre> 
<p>main.c</p> 
<pre><code class="hljs">#include "spi.h"

extern void printf(const char *fmt,...);

void delay_ms(int ms)

{

	int i,j;

	for(i=0;i&lt;ms;i++)

	for(j=0;j&lt;1800;j++);

}

	//保存0-9编码的数组

	int num[10] = {0xFC,0x60,0xDA,0xF2,0x66,0xB6,0x3E,0xE0,0xFE,0xF6};

	int num2[4] = {0x80,0x40,0x20,0x10};

	int main(void)

	{

		unsigned char i;

		SPI_init();

		//si7006_init();

		while(1)

		{

			for(i=0;i&lt;4;i++)

			{

				SPI_write(num2[i]);//发送数码管的位

				SPI_write(num[i]);//发送数码管的段

				NSS_OUTPUT_L();

				delay_ms(1);

				NSS_OUTPUT_H();//锁存的时钟从低到高的变化

														//将位移寄存器中的数据锁存到锁存寄存器中

				delay_ms(5);

			}

		}

		return 0;

	}



</code></pre> 
<p>将温湿度数据显示到数码</p> 
<p>main.c</p> 
<pre><code class="hljs">#include "spi.h"

#include "si7006.h"

extern void printf(const char *fmt,...);

void delay_ms(int ms)

{

	int i,j;

	for(i=0;i&lt;ms;i++)

	for(j=0;j&lt;1800;j++);

}

	//保存0-9编码的数组

	int num[10] = {0xFC,0x60,0xDA,0xF2,0x66,0xB6,0x3E,0xE0,0xFE,0xF6};

	int num2[4] = {0x80,0x40,0x20,0x10};

	int arr[4];

	 unsigned short hum;

	 short tem;

	int main(void)

	{

		unsigned char i;

		SPI_init();

		si7006_init();

		while(1)

		{

			

				tem=si7006_read_temp_data(0X40,0XE3);

				tem=175.72*tem/65536-46.85;

				hum=si7006_read_hum_data(0X40,0XE5);

				hum=125*hum/65536-6;

				arr[0]=tem/10;

				arr[1]=tem%10;

				arr[2]=hum/10;

				arr[3]=hum%10;

		for(int j=0;j&lt;1000;j++)

		{

			for(i=0;i&lt;4;i++)

			{

				SPI_write(num2[i]);//发送数码管的位

				SPI_write(num[arr[i]]);//发送数码管的段

				NSS_OUTPUT_L();

				delay_ms(1);

				NSS_OUTPUT_H();//锁存的时钟从低到高的变化

														//将位移寄存器中的数据锁存到锁存寄存器中

				

			}

		}

	}

		return 0;

}

</code></pre> 
<p style="text-align:center;"><img alt="" src="https://images2.imgbox.com/ea/4c/B2khuFEK_o.gif"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/20215a41d9879150e4fedba80dc7b5b4/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">02 Deep learning algorithm</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/0fd2c5120a85639e983ea1b6b4a1b520/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Python五种方式实现可视化，包括炫酷的动态图（matplotlib、seaborn、plotly、bokeh、pyecharts）——matplotlib传记</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>