<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>详细说明一下索引下推 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="详细说明一下索引下推" />
<meta property="og:description" content="索引下推（Index condition pushdown）是一种优化数据库查询的技术，它利用了数据库索引的特性，在一定条件下，在索引层面就过滤掉不需要的数据，从而减少查询时需要访问的数据块，提高查询效率。
在普通的查询中，数据库需要先从表中读取所有的数据记录，然后再根据查询条件过滤不需要的记录，最后返回查询结果。而在索引下推中，数据库会在索引树的节点上进行条件过滤，只将满足条件的数据块返回，而不是读取整个数据记录。这样可以避免从磁盘读取不必要的数据，降低IO开销，提升查询速度。
索引下推的主要优点是减少了回表操作，即减少了访问磁盘的次数和需要传输的数据量，从而提高了查询效率和响应速度。具体来说，如果查询条件涉及到的字段都可以通过索引直接获取，而不需要回表操作，那么查询速度将大大提高。
需要注意的是，索引下推并不是适用于所有类型的查询，它涉及到查询中所使用的索引类型和查询条件的限制。通常，只有涉及到等值查询或范围查询的情况下，才能使用索引下推技术实现优化。同时，索引下推也会产生额外的开销，需要消耗更多的CPU资源，因此需要在实际应用中进行评估和优化。
代码说明：
下面是一个使用索引下推进行优化的例子：
假设有一个名为orders的表，其中包含订单编号（order_id）、客户编号（cust_id）、订单金额（amount）等字段，其中order_id、cust_id字段分别创建了索引，现在需要查询订单金额大于等于1000元的订单数量，SQL查询语句为：
SELECT COUNT(*) FROM orders WHERE amount &gt;= 1000; 如果按照传统的查询方式，数据库需要先遍历整个表，找到所有金额大于等于1000元的订单记录，然后再统计符合条件的订单数量。这种方式的查询效率比较低，尤其是在表数据较大的情况下。
而如果使用索引下推技术，数据库就可以在索引树上进行条件过滤，只返回符合条件的订单数量。因为amount字段创建了索引，查询引擎会先在索引树上进行条件过滤，过滤掉所有金额小于1000元的订单记录，只将金额大于等于1000元的订单记录传给查询结果集，最后统计符合条件的订单数量。这种方式的查询效率相对较高，尤其是在数据量较大时效果更加明显。
如果要使用索引下推优化查询，首先需要创建支持索引下推的索引，具体步骤如下：
创建适当的索引：根据实际查询场景以及涉及到的字段创建索引，可以使用普通索引、唯一索引、全文索引等。
查询条件与索引关联：查询条件必须涉及到索引字段，才能进行索引下推优化。如果查询条件没有涉及到索引字段，就不能利用索引下推的优势。
检查查询计划：通过 explain 命令或可视化工具，查看查询计划，确保索引下推优化被使用。
下面以MySQL数据库为例，介绍如何创建索引和使用索引下推进行优化：
创建索引
使用CREATE INDEX语句创建索引。例如，为orders表的amount字段创建索引，可以执行如下命令：
CREATE INDEX idx_amount ON orders (amount); 查询条件与索引关联
查询条件必须涉及到索引字段。例如，查询所有金额大于等于1000元的订单，SQL查询语句为：
SELECT order_id, cust_id FROM orders WHERE amount &gt;= 1000; 这里的查询条件涉及到amount字段，是orders表上的一个索引字段。
检查查询计划
可以使用explain命令查看查询计划，确认是否使用了索引下推。例如，执行如下命令：
explain SELECT order_id, cust_id FROM orders WHERE amount &gt;= 1000; 如果查询计划中出现了Extra列中的Using index condition，则表示使用了索引下推。
需要注意的是，使用索引下推优化查询的效果会受到多个因素的影响，如索引类型、查询条件、数据量等。因此，在实际应用中需要针对具体的查询场景进行评估和优化。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/fea6cfdd727cda3c053d98568cc8700b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-03-23T10:08:47+08:00" />
<meta property="article:modified_time" content="2023-03-23T10:08:47+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">详细说明一下索引下推</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div class="kdocs-document"> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">索引下推（Index condition pushdown）是一种优化数据库查询的技术，它利用了数据库索引的特性，在一定条件下，在索引层面就过滤掉不需要的数据，从而减少查询时需要访问的数据块，提高查询效率。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">在普通的查询中，数据库需要先从表中读取所有的数据记录，然后再根据查询条件过滤不需要的记录，最后返回查询结果。而在索引下推中，数据库会在索引树的节点上进行条件过滤，只将满足条件的数据块返回，而不是读取整个数据记录。这样可以避免从磁盘读取不必要的数据，降低IO开销，提升查询速度。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">索引下推的主要优点是减少了回表操作，即减少了访问磁盘的次数和需要传输的数据量，从而提高了查询效率和响应速度。具体来说，如果查询条件涉及到的字段都可以通过索引直接获取，而不需要回表操作，那么查询速度将大大提高。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">需要注意的是，索引下推并不是适用于所有类型的查询，它涉及到查询中所使用的索引类型和查询条件的限制。通常，只有涉及到等值查询或范围查询的情况下，才能使用索引下推技术实现优化。同时，索引下推也会产生额外的开销，需要消耗更多的CPU资源，因此需要在实际应用中进行评估和优化。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">代码说明：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">下面是一个使用索引下推进行优化的例子：</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">假设有一个名为orders的表，其中包含订单编号（order_id）、客户编号（cust_id）、订单金额（amount）等字段，其中order_id、cust_id字段分别创建了索引，现在需要查询订单金额大于等于1000元的订单数量，SQL查询语句为：</span></p> 
 <pre class="kdocs-sql"><code class="language-sql">SELECT COUNT(*) FROM orders WHERE amount &gt;= 1000;</code></pre> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">如果按照传统的查询方式，数据库需要先遍历整个表，找到所有金额大于等于1000元的订单记录，然后再统计符合条件的订单数量。这种方式的查询效率比较低，尤其是在表数据较大的情况下。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">而如果使用索引下推技术，数据库就可以在索引树上进行条件过滤，只返回符合条件的订单数量。因为amount字段创建了索引，查询引擎会先在索引树上进行条件过滤，过滤掉所有金额小于1000元的订单记录，只将金额大于等于1000元的订单记录传给查询结果集，最后统计符合条件的订单数量。这种方式的查询效率相对较高，尤其是在数据量较大时效果更加明显。</span></p> 
 <p style="text-align:null;"></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">如果要使用索引下推优化查询，首先需要创建支持索引下推的索引，具体步骤如下：</span></p> 
 <ol start="1"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>创建适当的索引：根据实际查询场景以及涉及到的字段创建索引，可以使用普通索引、唯一索引、全文索引等。</p></li></ol> 
 <ol start="2"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>查询条件与索引关联：查询条件必须涉及到索引字段，才能进行索引下推优化。如果查询条件没有涉及到索引字段，就不能利用索引下推的优势。</p></li></ol> 
 <ol start="3"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>检查查询计划：通过 explain 命令或可视化工具，查看查询计划，确保索引下推优化被使用。</p></li></ol> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">下面以MySQL数据库为例，介绍如何创建索引和使用索引下推进行优化：</span></p> 
 <ol start="4"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>创建索引</p></li></ol> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">使用CREATE INDEX语句创建索引。例如，为orders表的amount字段创建索引，可以执行如下命令：</span></p> 
 <pre class="kdocs-sql"><code class="language-sql">CREATE INDEX idx_amount ON orders (amount);</code></pre> 
 <ol start="5"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>查询条件与索引关联</p></li></ol> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">查询条件必须涉及到索引字段。例如，查询所有金额大于等于1000元的订单，SQL查询语句为：</span></p> 
 <pre class="kdocs-sql"><code class="language-sql">SELECT order_id, cust_id FROM orders WHERE amount &gt;= 1000;</code></pre> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">这里的查询条件涉及到amount字段，是orders表上的一个索引字段。</span></p> 
 <ol start="6"><li style="margin-left:1.4em;list-style-type:decimal;text-indent:0;"><p>检查查询计划</p></li></ol> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">可以使用explain命令查看查询计划，确认是否使用了索引下推。例如，执行如下命令：</span></p> 
 <pre class="kdocs-sql"><code class="language-sql">explain SELECT order_id, cust_id FROM orders WHERE amount &gt;= 1000;</code></pre> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">如果查询计划中出现了Extra列中的Using index condition，则表示使用了索引下推。</span></p> 
 <p style="text-align:null;"><span class="kdocs-fontSize" style="font-size:9pt;">需要注意的是，使用索引下推优化查询的效果会受到多个因素的影响，如索引类型、查询条件、数据量等。因此，在实际应用中需要针对具体的查询场景进行评估和优化。</span></p> 
</div>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/5ca468a1061e7758a07d8f70592a78b1/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Anaconda常用命令</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/02011c057aa145fa4d396e0e219d6470/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">markdown图标收藏</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>