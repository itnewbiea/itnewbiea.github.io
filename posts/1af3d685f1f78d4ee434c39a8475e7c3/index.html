<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue3集成electron - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue3集成electron" />
<meta property="og:description" content="当前文章基于创建一个vue3应用 1、安装electron开发依赖 最新版本：npm install --save-dev electron
指定版本：npm install --save-dev electron@22.2.0
2、添加主进程文件main.js、预加载脚本preload.js __dirname 字符串指向当前正在执行脚本的路径 (在本例中，它指向你的项目的根文件夹)。path.join API 将多个路径联结在一起，创建一个跨平台的路径字符串。 项目根目录新建文件electron/main.js:
const { app, protocol, BrowserWindow, globalShortcut } = require(&#39;electron&#39;) // 需在当前文件内开头引入 Node.js 的 &#39;path&#39; 模块 const path = require(&#39;path&#39;) app.commandLine.appendSwitch(&#34;--ignore-certificate-errors&#34;, &#34;true&#34;); // Scheme must be registered before the app is ready protocol.registerSchemesAsPrivileged([ { scheme: &#34;app&#34;, privileges: { secure: true, standard: true } } ]); const createWindow = () =&gt; { const win = new BrowserWindow({ minWidth: 960, minHeight: 540, width: 960, height: 540, //窗口是否在屏幕居中." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/1af3d685f1f78d4ee434c39a8475e7c3/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-18T23:42:08+08:00" />
<meta property="article:modified_time" content="2023-12-18T23:42:08+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue3集成electron</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <h4>当前文章基于<a class="link-info" href="https://blog.csdn.net/I_xuebi/article/details/130736804?spm=1001.2014.3001.5502" title="创建一个vue3应用">创建一个vue3应用</a></h4> 
<h4>1、安装electron开发依赖</h4> 
<blockquote> 
 <p>最新版本：npm install --save-dev electron</p> 
 <p>指定版本：npm install --save-dev <a href="mailto:electron@22.2.0" rel="nofollow">electron@22.2.0</a></p> 
</blockquote> 
<h4>2、添加主进程文件main.js、预加载脚本preload.js</h4> 
<ul><li><a href="https://nodejs.org/api/modules.html#modules_dirname" rel="nofollow" title="__dirname">__dirname</a> 字符串指向当前正在执行脚本的路径 (在本例中，它指向你的项目的根文件夹)。</li><li><a href="https://nodejs.org/api/path.html#path_path_join_paths" rel="nofollow" title="path.join">path.join</a> API 将多个路径联结在一起，创建一个跨平台的路径字符串。</li></ul> 
<p>项目根目录新建文件<strong>electron/main.js:</strong></p> 
<pre><code class="language-javascript">const { app, protocol, BrowserWindow, globalShortcut } = require('electron')
// 需在当前文件内开头引入 Node.js 的 'path' 模块
const path = require('path')

app.commandLine.appendSwitch("--ignore-certificate-errors", "true");
// Scheme must be registered before the app is ready
protocol.registerSchemesAsPrivileged([
    { scheme: "app", privileges: { secure: true, standard: true } }
]);

const createWindow = () =&gt; {
    const win = new BrowserWindow({
        minWidth: 960,
        minHeight: 540,
        width: 960,
        height: 540,
        //窗口是否在屏幕居中. 默认值为 false
        center: true,
        //设置为 false 时可以创建一个无边框窗口 默认值为 true。
        frame: false,
        //窗口是否在创建时显示。 默认值为 true。
        show: true,
        webPreferences: {
            nodeIntegration: true,
            nodeIntegrationInWorker: true,
            preload: path.join(__dirname, 'preload.js'),
            webSecurity: false,
        }
    })
    win.setMenu(null)
    if (app.isPackaged) {
        win.loadURL(`file://${path.join(__dirname, '../dist/index.html')}`)
    } else {
        win.loadURL('http://127.0.0.1:5173/')
           //win.loadURL('http://localhost:5173/')
        win.webContents.openDevTools()
    }
    globalShortcut.register("CommandOrControl+Shift+i", function () {
        win.webContents.openDevTools();
    });

}

app.whenReady().then(() =&gt; {

    createWindow()

    app.on('activate', () =&gt; {
        if (BrowserWindow.getAllWindows().length === 0) createWindow()
    })
})

app.on('window-all-closed', () =&gt; {
    if (process.platform !== 'darwin') app.quit()
})</code></pre> 
<p> 项目根目录新建文件<strong>electron/preload.js</strong>:（示例）</p> 
<pre><code class="language-javascript">// 所有的 Node.js API接口 都可以在 preload 进程中被调用.
// 它拥有与Chrome扩展一样的沙盒。
window.addEventListener('DOMContentLoaded', () =&gt; {
    const replaceText = (selector, text) =&gt; {
      const element = document.getElementById(selector)
      if (element) element.innerText = text
    }
  
    for (const dependency of ['chrome', 'node', 'electron']) {
      replaceText(`${dependency}-version`, process.versions[dependency])
    }
  })</code></pre> 
<h4>3、在package.json指定electron主进程文件路径，在scripts字段下增加一条start命令</h4> 
<p><strong> </strong>添加：</p> 
<blockquote> 
 <p>"main": "electron/main.js"</p> 
 <p>"scripts": {<!-- --></p> 
 <p>"start": "vite | electron ."</p> 
 <p>}</p> 
</blockquote> 
<p><strong>package.json:</strong></p> 
<pre><code class="language-javascript">{
  "name": "job-hopping",
  "version": "0.0.0",
  "private": true,
  "main": "electron/main.js",//指定electron主进程文件路径
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "start": "vite | electron ."
  },
  "dependencies": {
    "vue": "^3.3.2"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.2.3",
    "electron": "^22.2.0",
    "electron-builder": "^23.6.0",
    "vite": "^4.3.5"
  }
}</code></pre> 
<h4>4、启动electron（开发调试时）</h4> 
<blockquote> 
 <p>npm start</p> 
</blockquote> 
<p>若出现下图的情况，可能是<strong>vite启动后的地址不是127.0.0.1，而是localhost</strong>。</p> 
<p>这时可以将<a class="link-info" href="https://blog.csdn.net/I_xuebi/article/details/130736804?spm=1001.2014.3001.5502" title="主进程文件main.js第34行">主进程文件main.js第34行</a> <strong>win.loadURL('http://127.0.0.1:5173/')修改为win.loadURL('http://localhost:5173/')</strong></p> 
<p><img alt="" height="755" src="https://images2.imgbox.com/bf/09/qDwMZAF6_o.png" width="1054"></p> 
<p> 修改后，成功显示</p> 
<p><img alt="" height="541" src="https://images2.imgbox.com/d0/67/Gbq5Kqd4_o.png" width="960"></p> 
<h4> 5、electron打包</h4> 
<p><strong>5.1、安装electron打包开发依赖</strong></p> 
<blockquote> 
 <p>最新版本：npm install --save-dev electron-builder</p> 
 <p>指定版本：npm install --save-dev electron-builder@23.6.0</p> 
</blockquote> 
<p><strong>5.2、引入相关图标文件</strong></p> 
<p>在项目根目录下新建<strong>build\electron-icon</strong>文件夹，然后分别将.icns、.ico、.png类型文件放置此文件夹下</p> 
<p><strong>注意：windows系统中icon需要<span style="color:#fe2c24;">256*256</span>的ico格式图片</strong></p> 
<p><img alt="" height="190" src="https://images2.imgbox.com/e2/bb/qyLPgGWF_o.png" width="578"></p> 
<h4>5.3、在package.json添加author、description、build字段，同时在scripts字段添加electron:build命令</h4> 
<p><strong>package.json:</strong></p> 
<pre><code class="language-javascript">{
  "name": "job-hopping",
  "version": "0.0.0",
  "private": true,
  "author": {
    "name": "lsl",
    "email": "lsl@lsl.com.cn"
  },
  "description": "lsl",
  "main": "electron/main.js",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview",
    "start": "vite | electron .",
    "electron:build": "vite build &amp;&amp; electron-builder"
  },
  "dependencies": {
    "vue": "^3.3.2"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^4.2.3",
    "electron": "^22.2.0",
    "electron-builder": "^23.6.0",
    "vite": "^4.3.5"
  },
  "build": {
    "appId": "lsl.first.app",
    "productName": "ElectronApp",
    "copyright": "Copyright © 2023 lsl",
    "directories": {
      "output": "dist_electron"
    },
    "win": {
      // 图标路径 windows系统中icon需要256*256的ico格式图片，更换应用图标亦在此处
      "icon": "./build/electron-icon/icon.ico",
      "target": [
        {
          "target": "nsis",
          "arch": [
            "x64"
          ]
        }
      ]
    },
    "dmg": {
      "contents": [
        {
          "x": 410,
          "y": 150,
          "type": "link",
          "path": "/Applications"
        },
        {
          "x": 130,
          "y": 150,
          "type": "file"
        }
      ]
    },
    "linux": {
      "icon": "./build/electron-icon/icon.png",
      "target": "AppImage"
    },
    "mac": {
      "icon": "./build/electron-icon/icon.icns"
    },
    "files": [
      "./dist",
      "./electron",
      "!**/node_modules/**"
    ],
    "asar": false, //打包时不进行加密
    "nsis": {
      "oneClick": false,
      "allowElevation": true,
      "allowToChangeInstallationDirectory": true,
      "installerIcon": "./build/electron-icon/icon.ico",
      "uninstallerIcon": "./build/electron-icon/icon.ico",
      "installerHeaderIcon": "./build/electron-icon/icon.ico",
      "createDesktopShortcut": true,
      "createStartMenuShortcut": true
    }
  }
}</code></pre> 
<h4><strong> 5.4、执行打包命令，打包后的文件在当前项目的dist_electron文件夹下</strong></h4> 
<blockquote> 
 <p>打包命令： npm run electron:build</p> 
</blockquote> 
<p><img alt="" height="447" src="https://images2.imgbox.com/13/99/Kkws4lAE_o.png" width="1200"></p> 
<p> 输出位置：</p> 
<p><img alt="" height="192" src="https://images2.imgbox.com/47/d7/SdTl9qHG_o.png" width="635"></p> 
<h4>5.5、此时安装启动后会发现系统又白屏了，此时需要修改vite.config.js,添加base字段</h4> 
<blockquote> 
 <p>添加：base: "./"</p> 
</blockquote> 
<pre><code class="language-javascript">import { fileURLToPath, URL } from 'node:url'

import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

// https://vitejs.dev/config/
export default defineConfig({
  base: "./",
  plugins: [vue()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  }
})</code></pre> 
<h4>5.5、重新打包安装启动，完成</h4> 
<p><img alt="" height="559" src="https://images2.imgbox.com/49/58/DC1rdGL5_o.png" width="976"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a77cb1335a1f7f987ebb539012c69876/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【嵌入式-51单片机】常见位运算和数据类型以及sbit使用</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/a9a7741587e59d21ea2d58d2cffe5fbd/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">github超时解决方法</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>