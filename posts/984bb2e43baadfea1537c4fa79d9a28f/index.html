<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>负载均衡的OJ系统 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="负载均衡的OJ系统" />
<meta property="og:description" content="文章目录 1 项目展示2 项目基本结构3 CompilerServer模块设计3.1 整体结构设计#添加日志功能获取日期时间格式的时间戳 3.2 compiler编译模块#路径工具类 3.3 run运行模块#添加资源限制功能 3.4 compliler_run模块3.4.1 定义结构3.4.2 功能模块的编写3.4.2.1 获取唯一性的文件名3.4.2.2 读写文件操作3.4.2.3 清理临时文件3.4.2.4 获得状态码含义 3.4.3 compiler_run模块的整体代码3.4.4 编译运行模块的整体测试 3.5.compiler_server模块 4 OJServer模块设计4.1 整体结构设计4.2 oj_server模块4.3.oj_model模块4.3.1 整体接口的设计4.3.2 文件版本题库4.3.2.1 题库设计4.3.2.2 oj_model_fd模块4.3.2.2.1 整体结构的设计4.3.2.2.2 字符串切分功能4.3.2.2.3 整体代码的编写 4.3.3 数据库版本题库4.3.3.1 题库设计4.3.3.2 oj_model-db模块 4.4 oj_view模块4.5 oj_control模块4.5.1 整体结构设计4.5.2 构建题目列表和单个题目网页4.5.3 判题功能4.5.3.1 负载均衡模块4.5.3.1.1 整体功能设计4.5.3.1.2 负载均衡模块的实现 4.5.3.2 判题模块的编写 4.5.4 更新主机上线状态 5. 前端页面设计5.1首页5.2题目列表页面5.3指定题目的编写提交页面 6 顶层项目部署Makefile7 项目组件的安装与使用jsoncppcpp-httplibboost库ctemplateMySQL workbenchmysql-connector-c 1 项目展示 启动服务之后，首先访问首页会得到首页界面
点击两个箭头指向的任意地方都可以打开题库
因为我的数据库只录了一道题，所以只显示了一道，后面可以自己再继续录题，最终的题目会根据编号排好序在列表里展示出来，点击题目标题就可以跳转到题目的编辑页面
编辑页面左侧有题目的介绍，右侧是代码编辑区，里面已经预置了一部分代码，用户可以直接在给定的函数里面编写，完成题目要求的函数功能。编辑完成后可以点击保存并提交，会把代码提交到后端进行编译，然后把结果返回，无论是代码编译错误还是运行错误，亦或是超时或者内存超出限制，都会把对应的结果与原因展示在网页的下面。
需要用到的技术栈：C&#43;&#43; STL、boost库的字符串分割，cpp-httplib第三方开源网络库，ctemplate第三方开源前端网页渲染库、jsoncpp序列化反序列化，负载均衡的设计算法，MySQL C语言连接数据库。
开发环境：centos 7云服务器，vscode
项目源码：https://gitee.com/tie-zhuTX/LoadBalancedOJ
2 项目基本结构 项目整体分为三大模块：" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/984bb2e43baadfea1537c4fa79d9a28f/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-08-18T15:40:14+08:00" />
<meta property="article:modified_time" content="2022-08-18T15:40:14+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">负载均衡的OJ系统</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__1" rel="nofollow">1 项目展示</a></li><li><a href="#2__15" rel="nofollow">2 项目基本结构</a></li><li><a href="#3_CompilerServer_25" rel="nofollow">3 CompilerServer模块设计</a></li><li><ul><li><a href="#31__26" rel="nofollow">3.1 整体结构设计</a></li><li><a href="#_37" rel="nofollow">#添加日志功能</a></li><li><ul><li><a href="#_61" rel="nofollow">获取日期时间格式的时间戳</a></li></ul> 
   </li><li><a href="#32_compiler_121" rel="nofollow">3.2 compiler编译模块</a></li><li><ul><li><a href="#_137" rel="nofollow">#路径工具类</a></li></ul> 
   </li><li><a href="#33_run_188" rel="nofollow">3.3 run运行模块</a></li><li><ul><li><a href="#_221" rel="nofollow">#添加资源限制功能</a></li></ul> 
   </li><li><a href="#34_compliler_run_299" rel="nofollow">3.4 compliler_run模块</a></li><li><ul><li><a href="#341__303" rel="nofollow">3.4.1 定义结构</a></li><li><a href="#342__339" rel="nofollow">3.4.2 功能模块的编写</a></li><li><ul><li><a href="#3421__340" rel="nofollow">3.4.2.1 获取唯一性的文件名</a></li><li><a href="#3422__371" rel="nofollow">3.4.2.2 读写文件操作</a></li><li><a href="#3423__418" rel="nofollow">3.4.2.3 清理临时文件</a></li><li><a href="#3424__461" rel="nofollow">3.4.2.4 获得状态码含义</a></li></ul> 
    </li><li><a href="#343_compiler_run_500" rel="nofollow">3.4.3 compiler_run模块的整体代码</a></li><li><a href="#344__507" rel="nofollow">3.4.4 编译运行模块的整体测试</a></li></ul> 
   </li><li><a href="#35compiler_server_540" rel="nofollow">3.5.compiler_server模块</a></li></ul> 
  </li><li><a href="#4_OJServer_548" rel="nofollow">4 OJServer模块设计</a></li><li><ul><li><a href="#41__549" rel="nofollow">4.1 整体结构设计</a></li><li><a href="#42_oj_server_570" rel="nofollow">4.2 oj_server模块</a></li><li><a href="#43oj_model_573" rel="nofollow">4.3.oj_model模块</a></li><li><ul><li><a href="#431__574" rel="nofollow">4.3.1 整体接口的设计</a></li><li><a href="#432__601" rel="nofollow">4.3.2 文件版本题库</a></li><li><ul><li><a href="#4321__602" rel="nofollow">4.3.2.1 题库设计</a></li><li><a href="#4322_oj_model_fd_675" rel="nofollow">4.3.2.2 oj_model_fd模块</a></li><li><ul><li><a href="#43221__676" rel="nofollow">4.3.2.2.1 整体结构的设计</a></li><li><a href="#43222__678" rel="nofollow">4.3.2.2.2 字符串切分功能</a></li><li><a href="#43223__694" rel="nofollow">4.3.2.2.3 整体代码的编写</a></li></ul> 
    </li></ul> 
    </li><li><a href="#433__696" rel="nofollow">4.3.3 数据库版本题库</a></li><li><ul><li><a href="#4331__697" rel="nofollow">4.3.3.1 题库设计</a></li><li><a href="#4332_oj_modeldb_742" rel="nofollow">4.3.3.2 oj_model-db模块</a></li></ul> 
   </li></ul> 
   </li><li><a href="#44_oj_view_745" rel="nofollow">4.4 oj_view模块</a></li><li><a href="#45_oj_control_755" rel="nofollow">4.5 oj_control模块</a></li><li><ul><li><a href="#451__756" rel="nofollow">4.5.1 整体结构设计</a></li><li><a href="#452__760" rel="nofollow">4.5.2 构建题目列表和单个题目网页</a></li><li><a href="#453__766" rel="nofollow">4.5.3 判题功能</a></li><li><ul><li><a href="#4531__767" rel="nofollow">4.5.3.1 负载均衡模块</a></li><li><ul><li><a href="#45311__768" rel="nofollow">4.5.3.1.1 整体功能设计</a></li><li><a href="#45312__784" rel="nofollow">4.5.3.1.2 负载均衡模块的实现</a></li></ul> 
     </li><li><a href="#4532__792" rel="nofollow">4.5.3.2 判题模块的编写</a></li></ul> 
    </li><li><a href="#454__803" rel="nofollow">4.5.4 更新主机上线状态</a></li></ul> 
  </li></ul> 
  </li><li><a href="#5__809" rel="nofollow">5. 前端页面设计</a></li><li><ul><li><a href="#51_811" rel="nofollow">5.1首页</a></li><li><a href="#52_907" rel="nofollow">5.2题目列表页面</a></li><li><a href="#53_1050" rel="nofollow">5.3指定题目的编写提交页面</a></li></ul> 
  </li><li><a href="#6_Makefile_1313" rel="nofollow">6 顶层项目部署Makefile</a></li><li><a href="#7__1353" rel="nofollow">7 项目组件的安装与使用</a></li><li><ul><li><a href="#jsoncpp_1354" rel="nofollow">jsoncpp</a></li><li><a href="#cpphttplib_1403" rel="nofollow">cpp-httplib</a></li><li><a href="#boost_1492" rel="nofollow">boost库</a></li><li><a href="#ctemplate_1521" rel="nofollow">ctemplate</a></li><li><a href="#MySQL_workbench_1601" rel="nofollow">MySQL workbench</a></li><li><a href="#mysqlconnectorc_1620" rel="nofollow">mysql-connector-c</a></li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="1__1"></a>1 项目展示</h2> 
<p>启动服务之后，首先访问首页会得到首页界面<br> <img src="https://images2.imgbox.com/cb/ff/ODsGc22o_o.png" alt="在这里插入图片描述"><br> 点击两个箭头指向的任意地方都可以打开题库<br> <img src="https://images2.imgbox.com/8c/3e/HDz2Fl9Q_o.png" alt="在这里插入图片描述"><br> 因为我的数据库只录了一道题，所以只显示了一道，后面可以自己再继续录题，最终的题目会根据编号排好序在列表里展示出来，点击题目标题就可以跳转到题目的编辑页面<br> <img src="https://images2.imgbox.com/4f/23/QHr6JKi9_o.png" alt="在这里插入图片描述"><br> 编辑页面左侧有题目的介绍，右侧是代码编辑区，里面已经预置了一部分代码，用户可以直接在给定的函数里面编写，完成题目要求的函数功能。编辑完成后可以点击保存并提交，会把代码提交到后端进行编译，然后把结果返回，无论是代码编译错误还是运行错误，亦或是超时或者内存超出限制，都会把对应的结果与原因展示在网页的下面。</p> 
<p>需要用到的技术栈：C++ STL、boost库的字符串分割，cpp-httplib第三方开源网络库，ctemplate第三方开源前端网页渲染库、jsoncpp序列化反序列化，负载均衡的设计算法，MySQL C语言连接数据库。<br> 开发环境：centos 7云服务器，vscode</p> 
<p>项目源码：<a href="https://gitee.com/tie-zhuTX/LoadBalancedOJ" rel="nofollow">https://gitee.com/tie-zhuTX/LoadBalancedOJ</a></p> 
<h2><a id="2__15"></a>2 项目基本结构</h2> 
<p>项目整体分为三大模块：<br> <strong>Comm公共模块</strong>，主要提供一些文件操作，字符串处理，网络请求，日志系统等功能，不做专门的编写，需要用到哪个个功能添加进去就可以。<br> <strong>CompilerServer编译运行模块</strong>，让用户的代码在自己的服务器上形成临时源文件，并且编译，运行，得到运行结果。<br> <strong>OJServer模块</strong>，采用MAC的设计模式，使用算法负载均衡式的调用编译模块以及访问文件或数据库，把题目列表和编辑界面展示给用户。</p> 
<p>用户直接访问的是OJServer模块，OJServer收到请求后会进行功能路由，根据不同的请求给用户返回不同的结果，如果用户是提交代码，那么OJServer模块还会更具后端的CompilerServer服务器的负载负载均衡的选择主机提供的编译服务，然后拿到编译的结果在给用户返回。<br> <img src="https://images2.imgbox.com/78/57/aclXz8fc_o.png" alt="在这里插入图片描述"><br> 编译服务器和OJ服务器，两个模块之间采用网络套接字的方式互相通信，就可以把编译模块部署在服务器的多台机器上，OJ服务只需要一台，能够以集群处理的方式对外输出在线OJ服务</p> 
<h2><a id="3_CompilerServer_25"></a>3 CompilerServer模块设计</h2> 
<h3><a id="31__26"></a>3.1 整体结构设计</h3> 
<p>整体编译运行模块的功能是：编译并运行客户端通过网络提交的代码，并得到运行的结果<br> 把整个模块分为4个部分：<br> <strong>compiler模块</strong>：只负责代码的编译。拿到待编译代码的文件名，进行编译，并形成对应的可执行或者错误保存编译时错误信息的临时文件。<br> <strong>run模块</strong>：只负责运行代码。通过文件名执行指定的可执行程序，并且形成用于保存运行的结果的临时文件方便获得对应的内容。<br> <strong>compiler_run模块</strong>：整合编译模块和运行模块，解析用户发来的json串，得到json串形式的代码内容，形成一个可以用来编译的源文件，调用编译和运行两个模块完成功能，构建结果返回给编译服务模块。<br> <strong>compiler_server模块</strong>：负责搭建http服务，接收客户端发来的请求，提取出json串形式的代码，然后调用compiler_run模块编译运行，得到结构后返回给客户端。</p> 
<p>以下是该模块的整体结构：<br> <img src="https://images2.imgbox.com/f0/27/E368Kaes_o.png" alt="在这里插入图片描述">下面就是每个模块的设计</p> 
<h3><a id="_37"></a>#添加日志功能</h3> 
<p>日志功能整个项目都要使用，所以自然应该<strong>属于Comm公共模块</strong>，在Comm目录下创建一个专属的log.hpp文件。</p> 
<p>首先将日志设计为五个等级，分别为：</p> 
<blockquote> 
 <p><strong>NORMAL</strong>：表示正常的打印信息<br> <strong>DEBUG</strong>：表示用来dubug的信息<br> <strong>WARNING</strong>：//警告，但是不影响继续使用<br> <strong>ERROR</strong>：//错误，用户无法正常使用了<br> <strong>DEADLY</strong>：//致命，别说用户了，服务器自己都不行了</p> 
</blockquote> 
<p>可以定义枚举实现。</p> 
<p>设计的的日志的<strong>使用方法</strong>为：<strong>LOG(level)&lt;&lt;“日志信息”&lt;&lt;endl</strong>;<br> 根据用户输入的日志等级和消息，打印出该条日志打印的时间，等级，打印文件和所在行</p> 
<p>可以编写一个Log函数，参数包括：日志等级，文件名，调用行信息。<br> 然后<strong>构建一个对应的字符串</strong>，用cout打印但是<strong>不刷新</strong>，结果就会<strong>暂存在输出流的缓冲区</strong>中，<strong>返回一个标准输出流</strong>，这样就可以像cout一样调用日志函数，并且调用时还可以添加信息，谈话再刷新，就可以把完整的内容打印到频幕上。</p> 
<p>日志函数就是单纯的给我们构建日志，就可以根据我们设计的结构进行构建，用一个string保存在日志函数构建的所有内容，包括等级，时间，文件和行数等内容，然后再把string输出到标准输出的缓冲区等待调用时拼接后半部分。</p> 
<p>因为调用函数需要三个参数，而文件名和调用行可以用过宏得到，所有可以define一下日志函数，用户只需要输入日志等级，剩下两个参数直接调用宏<br> <img src="https://images2.imgbox.com/4d/d6/kQYOMdHW_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_61"></a>获取日期时间格式的时间戳</h4> 
<p>获取时间属于日志模块需要调用的一个功能，所有它不应该属于日志模块，而应该数据Comm公共模块中的util工具模块。</p> 
<p>获取当前时间首先可以使用time函数或者系统调用gettimeofday接口<strong>获取当前的时间戳</strong>，我这里使用系统调用。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token keyword">struct</span> <span class="token class-name">timeval</span><span class="token operator">*</span> tv<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">timezone</span><span class="token operator">*</span> tz<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>tv：输出形参数，是我们要获取到的时间<br> tz：时区，不关心可以设置为NULL</p> 
<p>参数tv的结构如下</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">timeval</span><span class="token punctuation">{<!-- --></span>
	<span class="token class-name">time_t</span> tv_sec<span class="token punctuation">;</span><span class="token comment">//秒数</span>
	<span class="token class-name">suseconds_t</span> tv_usec<span class="token punctuation">;</span><span class="token comment">//微秒</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>其中的tv_sec就是我们想要的秒数形式的时间戳。</p> 
<p>但是如果想要打印的时间是日期时间格式，则需要用到strftime函数</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token class-name">size_t</span> <span class="token function">strftime</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span> buf<span class="token punctuation">,</span><span class="token class-name">size_t</span> bufsize<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> format<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">tm</span><span class="token operator">*</span> tm<span class="token punctuation">)</span>
</code></pre> 
<p>buf：保存转换过后的结果<br> bufsize：上一个参数的大小<br> format：转换的形式，一般为"%Y-%m-%d %H:%M:%S"<br> tm：是一个struct tm类型的数据，如果要使用这个函数，首先要把时间戳转换成struct tm类型。</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token keyword">struct</span> <span class="token class-name">tm</span><span class="token operator">*</span> <span class="token function">localtime</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token class-name">time_t</span><span class="token operator">*</span> timep<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>timep：就是把time_t类型的时间戳转换成struct tm*类型</p> 
<p>有了这些函数，就可以在buffer里得到调用这个函数的日期时间格式的时间戳了，然后把它转换成string返回出去，这个接口就完成了。</p> 
<pre><code class="prism language-cpp">    <span class="token keyword">class</span> <span class="token class-name">TimeUtil</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">GetTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token comment">//获取时间戳</span>
            <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span>
            <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//localtime把时间戳转换为struct tm类型</span>
            <span class="token comment">//调用strftime将tm类型转换成日期时间格式</span>
            <span class="token keyword">char</span> datetime<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            <span class="token function">strftime</span><span class="token punctuation">(</span>datetime<span class="token punctuation">,</span><span class="token keyword">sizeof</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">"%Y-%m-%d %H:%M:%S"</span><span class="token punctuation">,</span><span class="token function">localtime</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">.</span>tv_sec<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">string</span><span class="token punctuation">(</span>datetime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/11/d2/kcRhTBKC_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32_compiler_121"></a>3.2 compiler编译模块</h3> 
<p>编译服务的核心工作就是<strong>编译</strong>远端提交的代码形成的<strong>临时文件</strong>，得到得到编译结果。</p> 
<p>实现的方法是创建子进程，让<strong>子进程执行程序替换</strong>，替换成<strong>编译代码</strong>，然后通过判断<strong>是否生成了对应的可执行程序</strong>来判断编译是否成功，如果失败就把错误信息保存到一个<strong>专门的错误文件</strong>中以便返回给用户。</p> 
<p>模块拿到的只有对应临时源文件的文件名，在执行过程中可能会生成“错误文件”，可执行程序等临时文件，这些文件总不能乱摆，新建一个<strong>tempfile目录</strong>，里面专门<strong>存放这些临时文件</strong>。</p> 
<p>编译一个文件，源文件名和目标文件名是必不可少的，但是模块的参数只有文件名，就需要通过文件名，拼接出可以用来文件操作或编译的有路径和后缀的完整文件名，可以把这个功能封装成为一个<strong>路径工具类</strong>，属于是一种工具，可以在Comm模块的until模块进行编写</p> 
<p>这里的错误文件时用来存放编译是发送的错误的，代码运行时也有可能发送错误，要把不同的错误消息存放在不同的的文件中，所以这里我规定存放编译时错误的文件名后缀为.cerr<br> 规定三个文件的完整文件名的格式如下:</p> 
<blockquote> 
 <p>源文件：./tempfile/文件名.cpp<br> 可执行：./tempfile/文件名.exe<br> 编译错误文件：./tempfile/文件名.cerr</p> 
</blockquote> 
<h4><a id="_137"></a>#路径工具类</h4> 
<p><img src="https://images2.imgbox.com/7d/21/IBLH97k9_o.png" alt="在这里插入图片描述"><br> 编译模块首先创建子进程，子进程需要执行程序替换函数，但是如果编译失败了，我需要把错误信息存放到错误文件里，所有在执行替换函数之前，子进程首先要以写的方式打开一个对应的错误文件，然后把标准错误重定向到该文件，这样出错的信息就会直接输入到错误文件里面。</p> 
<p><strong>调用文件操作接口</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;fcntl.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">open</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> pathname<span class="token punctuation">,</span><span class="token keyword">int</span> flags<span class="token punctuation">,</span><span class="token class-name">mode_t</span> mode<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>pathname：带路径的文件名，就是我们上面构建的完整文件名<br> flags：打开方式，我们选择只写O_CREAT | O_WRONLY<br> mode：权限，644我们自己可读可写，别人只能读</p> 
<p><strong>重定向接口</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">dup2</span><span class="token punctuation">(</span><span class="token keyword">int</span> oldfd<span class="token punctuation">,</span><span class="token keyword">int</span> newfd<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>让newfd指向的内容变成oldfd指向内容的一份拷贝，也就是说让newfd指向之前oldfd指向的文件，相当于给文件对应的描述符从oldfd换成newfd。</p> 
<p>创建并设置好对应错误文件，子进程就要进行程序替换了<br> <strong>程序替换</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">execlp</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> file<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> arg<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>第一个参数是要进行替换的程序的名字，因为我们是要编译代码，所以这个程序名就是g++。后面的参数是一个可变参数，我们在命令行怎么执行改程序，就怎么把参数传给这个替换函数，这就需要用到上面封装的路径工具类了。每个参数都是字符串类型，最后还有一个nullptr。</p> 
<p>这里的编译选项还有一点需要注意，在编译模块只需要可以编译代码就可以了，但是我们整个代码的设计是分为两部分的，一部分预设代码，即在用户请求编译时已经存在的一部分代码，用户修改哪里的代码，然后提交给后端，后端通过用户提交的代码和题目对应的测试用例拼接起来，才形成一个完整的代码，而为了在测试用例一般会加入条件编译，具体原因我会在题库设计时讲解，所有编译时还要多加一个选项才能让代码正常编译</p> 
<p>子进程执行完程序替换，父进程就等待子进程退出。并且父进程需要对编译的情况进行判断，可以通过可执行程序判断，但是这个判断属于是一种对文件的操作方法，也可以给他封装到工具模块的一个专门对文件操作的类里，将来所有的文件操作都可以封装到一起<br> <strong>获取文件属性</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/stat.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">stat</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> path<span class="token punctuation">,</span><span class="token keyword">struct</span> <span class="token class-name">stat</span><span class="token operator">*</span> buf<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>path：带路径的完整文件名<br> buf：获取文件属性<br> <img src="https://images2.imgbox.com/3e/bd/jjsGJ1qQ_o.png" alt="在这里插入图片描述"><br> 以上就是compiler编译模块的主要内容，还可以在一些地方加入对应的日志信息，就完成了该模块的编写</p> 
<p><img src="https://images2.imgbox.com/af/39/aMS59kIc_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33_run_188"></a>3.3 run运行模块</h3> 
<p>运行模块的功能就是根据文件名，找到对应的可执行程序并且运行。程序运行大致可以分为以下三种情况：</p> 
<blockquote> 
 <p>1.代码执行完，结果正确<br> 2.代码执行完，结果不正确<br> 3.代码没有执行完，中途崩溃*</p> 
</blockquote> 
<p>其中代码的结果是否正确并不是我们运行模块需要考虑的内容，这个要交给上层的OJ模块根据测试用例去判断，所以运行模块<strong>只需要判断我的代码是否正常的执行完成</strong>了。</p> 
<p>除了判断程序的执行情况，一般的在线OJ系统都会给每一道题目设置时间限制和空间限制，这样一是作为题目的一种要求，其次它可以防止用户可能输入的一些恶意代码，避免对服务器产生不利影响。</p> 
<p>所以，该模块一共有两个主要的功能：一是对程序的进行一定的限制，二是判断程序的执行情况并返回给用户。</p> 
<p>首先，要执行可执行程序就需要，<strong>可执行程序的名称</strong>。而要实现对进程的限制，就需要对应的<strong>时间限制</strong>、<strong>空间限制</strong>。这就是我们需要的参数。</p> 
<p>要把结果告知给用户，这个结果在代码运行正常时就是执行后得到的结果，在代码崩溃时就是报错信息，这两个信息在一般情况下是打印在标准输出和标准错误中的，而我要把这些信息返回给用户，就需要进行一下处理，把他们都<strong>保存在对应的临时文件中</strong>，方便上层提取。规定对应的文件格式为：</p> 
<blockquote> 
 <p>xxx.in ---- 程序的输入信息，暂时不处理<br> xxx.out ---- 保存程序正常退出的信息<br> xxx.rerr ---- 保存程序运行时的报错信息</p> 
</blockquote> 
<p>这三个文件分别对应程序默认打开的三个文件：标准输入，标准输出，标准错误。就需要在运行程序之前对上面三个文件进行重定向。</p> 
<p>实际实现时要运行可执行程序，首先就要能够找到对应的程序，那就可以用上面封装好的路径工具，找到对应的可执行程序，和编译模块类似，也是让子进程进行程序替换，父进程通过进程等待得到运行的结果。</p> 
<p>一般程序崩溃终止的原因是因为系统给进行发送了信号杀掉了进程，可以通过父进程等待的方式获取进程退出时得到的信号，得知进程是因为什么原因导致的崩溃，也可以更好的告知上层运行的情况，我们可以用<strong>函数返回值</strong>的方式把这个<strong>信号</strong>返回给上层。规定：如果是我们<strong>模块内部的错误</strong>，比如打开文件失败等等，<strong>返回值就小于0</strong>，如果<strong>执行成功没有异常，返回值就等于0</strong>，如果<strong>代码崩溃</strong>收到信号，就把<strong>返回信号</strong>。</p> 
<p><img src="https://images2.imgbox.com/b1/e4/GuFiBv8d_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="_221"></a>#添加资源限制功能</h4> 
<p>根据两个参数，对进程进行时间和空间上的约束，如果资源不足，系统会给进程发送信号终止进程</p> 
<p>使用的接口：</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/resource.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">setrlimit</span><span class="token punctuation">(</span><span class="token keyword">int</span> resource<span class="token punctuation">,</span><span class="token keyword">const</span> <span class="token keyword">struct</span> <span class="token class-name">rlimit</span><span class="token operator">*</span> rlim<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>resource有以下几种取值，表示你要做什么：</p> 
<blockquote> 
 <p><strong>RLIMIT_AS</strong>：限制进行使用的虚拟地址的大小<br> <strong>RLIMIT_CPU</strong>：限制进程占用CPU的时间<br> RLIMIT_CORE：限制形成的core文件的大小<br> RLIMIT_DATA：限制数据段大小<br> 等等</p> 
</blockquote> 
<p>rlim是一个结构体</p> 
<pre><code class="prism language-c"><span class="token keyword">struct</span> <span class="token class-name">rlimit</span><span class="token punctuation">{<!-- --></span>
	<span class="token class-name">rlim_t</span> rlim_cur<span class="token punctuation">;</span><span class="token comment">//软限制</span>
	<span class="token class-name">rlim_t</span> rlim_max<span class="token punctuation">;</span><span class="token comment">//硬限制</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>软限制设置的值不能超过硬限制，一般把硬限制设置成<strong>RLIM_INFINITY表示无限制</strong>，软限制设置成我想要的值</p> 
<p><strong>限制时间</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/resource.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token class-name">rlimit</span> rt<span class="token punctuation">;</span>
    rt<span class="token punctuation">.</span>rlim_max<span class="token operator">=</span>RLIM_INFINITY<span class="token punctuation">;</span><span class="token comment">//硬上限设置成无穷</span>
    rt<span class="token punctuation">.</span>rlim_cur<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">;</span><span class="token comment">//软上限设置成1秒</span>
    <span class="token function">setrlimit</span><span class="token punctuation">(</span>RLIMIT_CPU<span class="token punctuation">,</span><span class="token operator">&amp;</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>超出限制时间，系统会发送<strong>24</strong>号信号</p> 
<p><strong>限制内存</strong></p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;time.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/resource.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">struct</span> <span class="token class-name">rlimit</span> rt<span class="token punctuation">;</span>
    rt<span class="token punctuation">.</span>rlim_max<span class="token operator">=</span>RLIM_INFINITY<span class="token punctuation">;</span><span class="token comment">//硬上限设置成无穷</span>
    rt<span class="token punctuation">.</span>rlim_cur<span class="token operator">=</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">;</span><span class="token comment">//软上限设置最大虚拟空间</span>
    <span class="token function">setrlimit</span><span class="token punctuation">(</span>RLIMIT_AS<span class="token punctuation">,</span><span class="token operator">&amp;</span>rt<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> cnt<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">while</span><span class="token punctuation">(</span>true<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">int</span><span class="token operator">*</span> p<span class="token operator">=</span>new <span class="token keyword">int</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        std<span class="token operator">::</span>cout<span class="token operator">&lt;&lt;</span>cnt<span class="token operator">++</span><span class="token operator">&lt;&lt;</span>std<span class="token operator">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>超出限制内存，系统会发送<strong>6</strong>号信号</p> 
<p>下面是我们的代码中的限制功能<br> <img src="https://images2.imgbox.com/41/30/OMZDuyOt_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="34_compliler_run_299"></a>3.4 compliler_run模块</h3> 
<p>首先明确该模块的功能：<br> 因为涉及到网络服务，所以用户的代码会以json串的方式传给该模块，首先我要给每一份代码创建一个文件名具有唯一性的源文件，然后调用上面的编译模块和运行模块编译并执行该源文件，然后再把结果构建成json串返回给上层，两个参数，一个输入形的json串，一个输出形的json串。</p> 
<h4><a id="341__303"></a>3.4.1 定义结构</h4> 
<p>因为涉及到程序的资源限制，所以上层提交的参数可能会有很多部分，首先规定输入的json串里面会包含如下一个元素：</p> 
<blockquote> 
 <p>code：对应用户的代码<br> input：对应用户的自测输入<br> maxtime：对应该题目的时间限制<br> maxmem：对应该题目的内存限制</p> 
</blockquote> 
<p>输出json串包含以下内容：</p> 
<blockquote> 
 <p>必有内容：<br> stat：我们规定的状态码<br> mean：状态码对应的含义<br> 可能有：<br> out：运行正常的结果<br> rerr：运行时报错的结果</p> 
</blockquote> 
<p>状态码用来表示编译运行的状态，规定：</p> 
<blockquote> 
 <p>-1：用户没有提交代码<br> -2：各种服务器的内部错误<br> -3：编译失败<br> 0：编译运行成功<br> &gt;0：进程运行崩溃时收到的信号</p> 
</blockquote> 
<p><strong>实现思路</strong><br> 对于拿到的代码json串，首先要更具协议规定进行<strong>反序列化</strong>，提取出对于的字段。</p> 
<p>然后要给每一份提交的代码都生成一个临时源文件用于编译，这个文件的文件名需要具有<strong>唯一性</strong>，避免不同的客户之间相互干扰。</p> 
<p>用获得的文件名，创建并把代码字段写入到该文件中形成源文件。</p> 
<p>然后<strong>调用编译模块和运行模块</strong>，因为要针对每一中错误的情况把状态码和状态描述填写到返回json串的meam字段中并进行序列化，可以把所以的出错情况都集合再一起处理，用编写一个<strong>差错处理接口</strong>，根据状态码，构建对应的错误描述以供填写json串。</p> 
<p>填写完成返回的json串之后进行一次序列化，然后可以编写一个接口用于<strong>清理掉代码执行过程中形成的所有临时文件</strong>。</p> 
<h4><a id="342__339"></a>3.4.2 功能模块的编写</h4> 
<h5><a id="3421__340"></a>3.4.2.1 获取唯一性的文件名</h5> 
<p>获取文件名算是对文件的操作，可以封装在<strong>文件工具类</strong>里</p> 
<p>实现思路是通过<strong>拼接毫秒级别的时间戳和一个原子性递增的序号</strong>，使得拼接的文件名具有唯一性<br> 原子性的序号可以用atomac_uint定义，而毫秒级的时间戳可以用编写日志获得时间戳的接口gettimeofday获得，其参数timeval结构体的第一个元素表示秒，第二个元素表示的就是微秒，可以使用这两个值计算出毫秒级别的时间戳：</p> 
<p><strong>Comm-&gt;util-&gt;TimeUtil</strong></p> 
<pre><code class="prism language-cpp">        <span class="token comment">//获得毫秒级别的时间戳</span>
        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">GetMSTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token keyword">struct</span> <span class="token class-name">timeval</span> tv<span class="token punctuation">;</span>
            <span class="token function">gettimeofday</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>tv<span class="token punctuation">,</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">//毫秒=秒*1000=微秒/1000</span>
            <span class="token keyword">return</span> std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>tv<span class="token punctuation">.</span>tv_sec<span class="token operator">*</span><span class="token number">1000</span><span class="token operator">+</span>tv<span class="token punctuation">.</span>tv_usec<span class="token operator">/</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p><strong>Comm-&gt;util-&gt;FileUtil</strong></p> 
<pre><code class="prism language-cpp">        <span class="token comment">//根据毫秒级时间戳和原子性递增的唯一值构建出一个可以保证唯一性的文件名</span>
        <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">GetUniqueName</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>string ms<span class="token operator">=</span><span class="token class-name">TimeUtil</span><span class="token double-colon punctuation">::</span><span class="token function">GetMSTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>atomic_uint <span class="token function">key</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            key<span class="token operator">++</span><span class="token punctuation">;</span>
            std<span class="token double-colon punctuation">::</span>string key_s<span class="token operator">=</span>std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> ms<span class="token operator">+</span>key_s<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="3422__371"></a>3.4.2.2 读写文件操作</h5> 
<p>无论读取文件还是写入文件，都要使用文件操作，所以头文件必不可少。读写文件也属于工具类里的文件操作，所以他们的位置就应该是Comm-&gt;util-&gt;FileUtil。<br> 下面是他们的实现方法：<br> <strong>向文件中写入内容</strong></p> 
<pre><code class="prism language-cpp">        <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">WriteFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> file<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> code<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            std<span class="token double-colon punctuation">::</span>ofstream <span class="token function">out</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写方式打开文件</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>out<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token comment">//写入</span>
            out<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>code<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>code<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            out<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<p><strong>读取文件的内容</strong></p> 
<pre><code class="prism language-cpp">        <span class="token comment">//用iskeep设定读取的时候是否保留\n</span>
        <span class="token keyword">static</span> <span class="token keyword">bool</span> <span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> file<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">*</span> mean<span class="token punctuation">,</span><span class="token keyword">bool</span> iskeep<span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            <span class="token punctuation">(</span><span class="token operator">*</span>mean<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//先清理一下</span>

            std<span class="token double-colon punctuation">::</span>ifstream <span class="token function">in</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//读方式打开文件</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>in<span class="token punctuation">.</span><span class="token function">is_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>

            <span class="token comment">//构建读取内容</span>
            std<span class="token double-colon punctuation">::</span>string line<span class="token punctuation">;</span>
            <span class="token comment">//getline不保存\n</span>
            <span class="token comment">//getline重载和强制类型转换，所以可以写在while判断语句这里</span>
            <span class="token keyword">while</span><span class="token punctuation">(</span>std<span class="token double-colon punctuation">::</span><span class="token function">getline</span><span class="token punctuation">(</span>in<span class="token punctuation">,</span>line<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                <span class="token punctuation">(</span><span class="token operator">*</span>mean<span class="token punctuation">)</span><span class="token operator">+=</span>line<span class="token punctuation">;</span>
                <span class="token punctuation">(</span><span class="token operator">*</span>mean<span class="token punctuation">)</span><span class="token operator">+=</span><span class="token punctuation">(</span>iskeep <span class="token operator">?</span> <span class="token string">"\n"</span> <span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            in<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
</code></pre> 
<h5><a id="3423__418"></a>3.4.2.3 清理临时文件</h5> 
<p>因为无论是编译还是运行都会生成临时文件，每一个请求生成一组，用不来哦几组临时文件的数量就会变得非常多，并且这些临时文件只要我编译运行模块拿到了其中的内容，就没用了，所以可以在编译运行的最后清理一下这一次服务生成的临时文件，因为这个方法只有当前模块调用，所以就不需要写在工具类了，直接定义在当前模块就可以。</p> 
<p>思路：定义是编译会生成3个临时文件，运行会生成3个临时文件，一共是6个。<br> 可以使用接口<strong>unlink</strong>来删除文件</p> 
<pre><code class="prism language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;unistd.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> pathname<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>参数就是要删除文件的路径+文件名+后缀组成的完整文件名。而路径工具类里面刚好就有得到对应完整文件名的方法，直接调用得到文件名然后删除就可以。</p> 
<p>但是计划情况下是6个文件，还有可能有特殊情况，比如编译失败，就不会生成可执行程序，所以在删除文件的时候还要判断一下文件是否存在，存在了再删。</p> 
<pre><code class="prism language-cpp">   	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">RemoveTempFile</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> file<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        <span class="token comment">//形成的临时文件个是是不确定的，但是最多只有我们定义的6个</span>
        <span class="token comment">//判断是否存在，存在就移除，不存在就删除</span>
        std<span class="token double-colon punctuation">::</span>string src<span class="token operator">=</span><span class="token class-name">PathUtil</span><span class="token double-colon punctuation">::</span><span class="token function">BuildSrc</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token double-colon punctuation">::</span><span class="token function">IsExists</span><span class="token punctuation">(</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span>src<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        std<span class="token double-colon punctuation">::</span>string exe<span class="token operator">=</span><span class="token class-name">PathUtil</span><span class="token double-colon punctuation">::</span><span class="token function">BuildExe</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token double-colon punctuation">::</span><span class="token function">IsExists</span><span class="token punctuation">(</span>exe<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span>exe<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        std<span class="token double-colon punctuation">::</span>string cerr<span class="token operator">=</span><span class="token class-name">PathUtil</span><span class="token double-colon punctuation">::</span><span class="token function">BuildCErr</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token double-colon punctuation">::</span><span class="token function">IsExists</span><span class="token punctuation">(</span>cerr<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span>cerr<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        std<span class="token double-colon punctuation">::</span>string in<span class="token operator">=</span><span class="token class-name">PathUtil</span><span class="token double-colon punctuation">::</span><span class="token function">BuildIn</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token double-colon punctuation">::</span><span class="token function">IsExists</span><span class="token punctuation">(</span>in<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span>in<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        std<span class="token double-colon punctuation">::</span>string out<span class="token operator">=</span><span class="token class-name">PathUtil</span><span class="token double-colon punctuation">::</span><span class="token function">BuildOut</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token double-colon punctuation">::</span><span class="token function">IsExists</span><span class="token punctuation">(</span>out<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        std<span class="token double-colon punctuation">::</span>string rerr<span class="token operator">=</span><span class="token class-name">PathUtil</span><span class="token double-colon punctuation">::</span><span class="token function">BuildRErr</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token class-name">FileUtil</span><span class="token double-colon punctuation">::</span><span class="token function">IsExists</span><span class="token punctuation">(</span>rerr<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token function">unlink</span><span class="token punctuation">(</span>rerr<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> 
</code></pre> 
<h5><a id="3424__461"></a>3.4.2.4 获得状态码含义</h5> 
<p>根据最开始定义的规定，编译运行模块最终给上层返回的json串里面一定要包含状态码字段和状态码描述字段，状态码可以让上层代码得知编译运行的情况，状态码描述则是告诉用户是怎么回事，所以不同的状态码会有不同的含义，需要封装一个接口完成这个功能</p> 
<pre><code class="prism language-cpp">	<span class="token comment">//用来获得状态码的含义</span>
    <span class="token keyword">static</span> std<span class="token double-colon punctuation">::</span>string <span class="token function">MeanOfStat</span><span class="token punctuation">(</span><span class="token keyword">int</span> stat<span class="token punctuation">,</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> filename<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>string mean<span class="token punctuation">;</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>stat<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
        <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
            mean<span class="token operator">=</span><span class="token string">"编译运行成功"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span>
            mean<span class="token operator">=</span><span class="token string">"提交代码为空"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">2</span><span class="token operator">:</span>
            mean<span class="token operator">=</span><span class="token string">"发生了未知错误"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> <span class="token operator">-</span><span class="token number">3</span><span class="token operator">:</span><span class="token comment">//拿到编译错误</span>
            <span class="token class-name">FileUtil</span><span class="token double-colon punctuation">::</span><span class="token function">ReadFile</span><span class="token punctuation">(</span><span class="token class-name">PathUtil</span><span class="token double-colon punctuation">::</span><span class="token function">BuildCErr</span><span class="token punctuation">(</span>filename<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>mean<span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> SIGABRT<span class="token operator">:</span><span class="token comment">//6</span>
            mean<span class="token operator">=</span><span class="token string">"内存超过限制"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> SIGFPE<span class="token operator">:</span><span class="token comment">//8</span>
            mean<span class="token operator">=</span><span class="token string">"除零错误"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">case</span> SIGXCPU<span class="token operator">:</span><span class="token comment">//24</span>
            mean<span class="token operator">=</span><span class="token string">"运行超时"</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token keyword">default</span><span class="token operator">:</span>
            mean<span class="token operator">=</span><span class="token string">"其他错误: "</span><span class="token operator">+</span>std<span class="token double-colon punctuation">::</span><span class="token function">to_string</span><span class="token punctuation">(</span>stat<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> mean<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> 
<p>这个代码中除了指明的一些定义号的错误和超过资源限制对应的两个错误原因之外，起始后期还可以把其他信号对应的崩溃原因添加进来，让用户得到的错误原因更加细致。</p> 
<h4><a id="343_compiler_run_500"></a>3.4.3 compiler_run模块的整体代码</h4> 
<p>给外界提供一个Start方法让上层调用编译运行模块。参数是一个输入形式的json串和一个要给上层返回的json串。</p> 
<p>首先使用jsoncpp反序列化，解析输入的json串。调用形成唯一文件名的方法生成一个唯一的文件名，专门供这一次服务使用。然后使用解析出来的代码部分创建出一个源文件，把文件名交给编译模块进行编译，再把文件名和时间限制，内存限制传给运行模块运行，记录这个过程中的状态码。再最后还要序列化一个json串返还给用户，更具获得状态码含义的接口填写状态码含义，根据状态码判断是否需要填写运行成功结果和运行时报错的结果，然后把填好的结果返还给上层。最终调用一次清理临时文件接口把这一次服务生成的所有临时文件清空即可。<br> <img src="https://images2.imgbox.com/6e/71/hmgemz6m_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="344__507"></a>3.4.4 编译运行模块的整体测试</h4> 
<p>引入网络服务前，首先对编译模块，运行模块，编译运行模块进行一下功能上的测试，可以一个源文件中引入编译运行模块，然后输入代码测试一下：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"compiler_run.hpp"</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> ns_compiler_run<span class="token punctuation">;</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>string json_in<span class="token punctuation">;</span>
    Json<span class="token double-colon punctuation">::</span>Value rootin<span class="token punctuation">;</span>
    rootin<span class="token punctuation">[</span><span class="token string">"code"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token raw-string string">R"(#include&lt;iostream&gt;
    int main(){
        std::cout&lt;&lt;"测试编译运行"&lt;&lt;std::endl;
        int* p=new int[1024*1024*20];
        return 0;
        })"</span><span class="token punctuation">;</span>
    rootin<span class="token punctuation">[</span><span class="token string">"input"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>
    rootin<span class="token punctuation">[</span><span class="token string">"maxtime"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    rootin<span class="token punctuation">[</span><span class="token string">"maxmem"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1024</span><span class="token operator">*</span><span class="token number">30</span><span class="token punctuation">;</span><span class="token comment">//30M</span>

    Json<span class="token double-colon punctuation">::</span>FastWriter writer<span class="token punctuation">;</span>
    json_in<span class="token operator">=</span>writer<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>rootin<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span>json_in<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    std<span class="token double-colon punctuation">::</span>string json_out<span class="token punctuation">;</span><span class="token comment">//给用户返回的</span>
    <span class="token class-name">CompilerRun</span><span class="token double-colon punctuation">::</span><span class="token function">Start</span><span class="token punctuation">(</span>json_in<span class="token punctuation">,</span><span class="token operator">&amp;</span>json_out<span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span>json_out<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>可以更换其中的代码部分来测试不同的模块功能是否正常。</p> 
<h3><a id="35compiler_server_540"></a>3.5.compiler_server模块</h3> 
<p>把整个模块打包成一个网络服务，用户使用POST方法请求服务器上的compiler_run服务，请求的正文就是我们编译运行模块需要的json串。服务器用过json串调用编译运行模块，得到返回的json串后见响应返回给用户。</p> 
<p>CompilerServer作为一个可以在多个主机上部署的服务，我们需要把他的端口号暴露出来，通过命令行参数获取，以便于部署。<br> <img src="https://images2.imgbox.com/1e/3c/ua8PKaeM_o.png" alt="在这里插入图片描述"></p> 
<p>以上就完成了整个CompilerServer模块的编写，OJServer就可以通过网络请求的方式请求编译服务。</p> 
<h2><a id="4_OJServer_548"></a>4 OJServer模块设计</h2> 
<h3><a id="41__549"></a>4.1 整体结构设计</h3> 
<p>OJServer模块是直接和用户交互的，用户访问OJ系统，我需要有一个首页，其次我需要有一个题目列表网页供用户选择题目，再者我还需要一个可以给用户写代码做题的网页，并且可以判断用户提交的代码是否正确。总结用户的请求分为三种：<br> 1.请求题目列表<br> 2.请求一个具体的题目，并且需要有编译区域<br> 3.提交，判题请求<br> 我的OJServer模块主要要更具这三种请求提供对应的功能。</p> 
<p>整个模块采用的是MVC的设计模式进行设计</p> 
<blockquote> 
 <p>M：Model，模型。和数据交互的模块，对题库进行增删改查，专门和数据库沟通<br> V：View，视图。拿到数据之后渲染网页内容，展示给用户（浏览器）<br> C：Control，控制器。就是业务逻辑</p> 
</blockquote> 
<p>通过这个设计模式，把数据，业务逻辑和界面进行了分离。</p> 
<p>所以整个模块就包含四个部分：<br> <strong>oj_model模块</strong>：负责模块前两个功能的数据部分，通过与题库交互，得到所有题目的信息或者某一个题目的信息<br> <strong>oj_view模块</strong>：负责渲染用户得到网页。根据用户提交的不同请求，渲染不同的题目信息<br> <strong>oj_control模块</strong>：负责整个OJServer模块的业务逻辑控制。对下负责负载均衡式的选择主机请求编译服务，对上根据用户的三种请求，配合上面两个模块，完成对应的功能。<br> <strong>oj_server模块</strong>：搭建http服务，根据用户的请求，完成功能路由，调用control模块的对应方法完成功能<br> <img src="https://images2.imgbox.com/b6/80/GRHvwFSx_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="42_oj_server_570"></a>4.2 oj_server模块</h3> 
<p>主要功能就是搭建一个http服务，通过用户请求不同的资源，完成功能路由的任务，调用oj_control模块的功能：<br> <img src="https://images2.imgbox.com/11/8b/j8C8KMF5_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="43oj_model_573"></a>4.3.oj_model模块</h3> 
<h4><a id="431__574"></a>4.3.1 整体接口的设计</h4> 
<p>oj_model模块的主要任务就是和后端的题库交互，主要是为了完成请求题目列表和请求单个题目的功能，得到题库中对应的题目信息。</p> 
<p>为了表示题目的信息，需要使用一个结构体把题目有关的属性都组织起来，结构如下：</p> 
<pre><code class="prism language-cpp">    <span class="token comment">//表示题目的属性信息</span>
    <span class="token keyword">struct</span> <span class="token class-name">attribute</span>
    <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>string number<span class="token punctuation">;</span><span class="token comment">//题目编号</span>
        std<span class="token double-colon punctuation">::</span>string title<span class="token punctuation">;</span><span class="token comment">//题目标题</span>
        std<span class="token double-colon punctuation">::</span>string grade<span class="token punctuation">;</span><span class="token comment">//题目等级</span>
        std<span class="token double-colon punctuation">::</span>string desc<span class="token punctuation">;</span><span class="token comment">//题目描述</span>
        <span class="token comment">//预设代码和测试用例拼接才能构成完整代码进行编译</span>
        std<span class="token double-colon punctuation">::</span>string preset<span class="token punctuation">;</span><span class="token comment">//给用户预设的代码</span>
        std<span class="token double-colon punctuation">::</span>string test<span class="token punctuation">;</span><span class="token comment">//测试用例</span>
        <span class="token keyword">int</span> maxtime<span class="token punctuation">;</span><span class="token comment">//时间限制(s)</span>
        <span class="token keyword">int</span> maxmem<span class="token punctuation">;</span><span class="token comment">//空间限制(KB)</span>

    <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>其中大部分字段都比较好理解，需要注意的是预设代码字段和测试用例字段。其中预设代码字段是用户请求编写题目时我编辑框里面本身就携带的代码，这部分代码一般是根据题目要求设计的一个函数，用户通过题目要求实现该函数，并且提交到服务上，在后端就可以根据包含用户代码的预设部分加上提前添加的测试用例，组合成为一份可以编译的代码，然后再交给后面的编译服务编译。</p> 
<p>但是这部分字段model模块并不关心，最终只需要对外提供两个接口：一个是<strong>返回所有题目信息</strong>的接口，用来给用户构建题目列表，获得题库所有的题目信息用一个vector返回。第二个就是<strong>返回指定编号的题目信息</strong>，通过编号获得题库中对应的题目相关属性返回出去，用来构建用户请求的单个题目网页。</p> 
<p>两个接口的实现都离不开题库，题库的实现有两种方案，一种是<strong>文件版本</strong>的题库，一种是<strong>数据库版本</strong>的题库。两种版本的题库设计会使得oj_model模块的实现有一些差别，但是整体功能和提供接口都是一样的。下面就是两种题库的设计和对应model模块的编写方法</p> 
<h4><a id="432__601"></a>4.3.2 文件版本题库</h4> 
<h5><a id="4321__602"></a>4.3.2.1 题库设计</h5> 
<p>题目的属性大致可以分为2类：<br> 一种是类似题目编号，题目标题，题目难度，时间限制和内存限制这些字段，这些字段都比较小，可以把所有题目的这些信息存在一个文件里面。<br> 还有一种就是题目描述，预置代码，测试用例等等，这类信息一般都比较大，如果和上面的信息存在一个文件里不太方便，就可以更具题目编号给每道题建立一个与编号对应的文件夹，然后用三个文件保存这三个信息，到时候就可以通过题目编号找到题目对应的路径，然后读取对应的文件就可以得到对应的信息，这样不仅读取方便，还便于我们录题。</p> 
<p>我将题库命名为TopicBank，题库的整体结构如下图：<br> <img src="https://images2.imgbox.com/b1/e4/WNchS6o1_o.png" alt="在这里插入图片描述"><br> 其中topic_list.txt的格式规定为每一行包含一个题目的信息，内容从前到后依次为：题目编号，题目标题，题目难度，时间限制，内存限制。每个字段之间用空格分割。</p> 
<p>在录题时，我们要自己设计题目的描述，预设代码和测试用例，尽量让测试用例比较完善，设计方法以一道判断回文数的题为例：<br> preset代码：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;map&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;algorithm&gt;</span></span>

<span class="token keyword">using</span> <span class="token keyword">namespace</span> std<span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{<!-- --></span>
<span class="token keyword">public</span><span class="token operator">:</span>
    <span class="token comment">/**
     * 
     * @param n int整型
     * @return bool布尔类型
     */</span>
    <span class="token keyword">bool</span> <span class="token function">isParlindrome</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token comment">// write code here</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> 
<p>预设代码里面是展示给用户的代码，可以包含头文件，一些解释等内容，最终要的就是让用户实现我们给定的函数，测试用例的写发如下：<br> test代码：</p> 
<pre><code class="prism language-cpp">
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">ifndef</span> <span class="token expression">COMPILER_ONLINE</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"preset.cpp"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">endif</span></span>

<span class="token keyword">void</span> <span class="token function">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//定义临时对象进行调用</span>
    <span class="token keyword">bool</span> ret<span class="token operator">=</span><span class="token function">Solution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isParlindrome</span><span class="token punctuation">(</span><span class="token number">1234321</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>ret<span class="token punctuation">)</span>
        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"测试用例1通过!"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"测试用例1没有通过,用例值: 1234321"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">void</span> <span class="token function">Test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token comment">//定义临时对象进行调用</span>
    <span class="token keyword">bool</span> ret<span class="token operator">=</span><span class="token function">Solution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">isParlindrome</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>ret<span class="token punctuation">)</span>
        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"测试用例2通过!"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token keyword">else</span>
        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span><span class="token string">"测试用例2没有通过,用例值: -10"</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

<span class="token punctuation">}</span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token function">Test1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">Test2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>我们需要调用preset里面的函数，然后添加进测试用例代码，去执行我们设计的测试用例，当然实际上的测试用例可能非常多，并且非常完善，这里只是举个例子，但是同样是两个源文件，测试用例引用其他文件的内容，我就需要include包含该文件，否则代码无法识别我们输入的内容，万一写错了就不好了。但是如果在测试用例里包含了头文件，将来OJ服务把两份代码拼接在一起时中间的这个头文件就会变成一个语法错误，所以选择条件编译的方式包含该头文件，所以编译模块在编译时才需要加上以下两个选项：<br> <img src="https://images2.imgbox.com/21/8d/DwP7T4zy_o.png" alt="在这里插入图片描述"><br> 为的就是在编译时去掉测试用例中包含的preset文件，让代码可以正常编译。</p> 
<h5><a id="4322_oj_model_fd_675"></a>4.3.2.2 oj_model_fd模块</h5> 
<h6><a id="43221__676"></a>4.3.2.2.1 整体结构的设计</h6> 
<p>根据文件题库的设计，我要实现接口的功能，那我每道题我都带读取两个文件某一个时包含题目的小字段信息的topic_list，还有就是每道题目对应的代码，描述信息，我要得到这些信息，首先就需要吧文件的内容都加载到内存，也就是说读取文件，填写没到题目的属性信息。在类内可以使用一个哈希表存储题目编号与题目属性的映射关系，在类创建的时候就自动读取所有题目的信息。然后不同的接口选择哈希表不同的内容给用户返回。</p> 
<h6><a id="43222__678"></a>4.3.2.2.2 字符串切分功能</h6> 
<p>读取题库首先要读topic_list.txt，而它的内容是一行一行分割的，正好可以使用boost库的字符串分割函数，获取其中的每一个字段</p> 
<p><strong>Comm-&gt;util</strong></p> 
<pre><code class="prism language-cpp">    <span class="token keyword">class</span> <span class="token class-name">StringUtil</span>
    <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span><span class="token operator">:</span>
        <span class="token comment">//src:源字符串 ret:切分的结果都保存在vector sep:分隔符</span>
        <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">StringSplit</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string<span class="token operator">&amp;</span> src<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span><span class="token operator">*</span> ret<span class="token punctuation">,</span>std<span class="token double-colon punctuation">::</span>string sep<span class="token punctuation">)</span>
        <span class="token punctuation">{<!-- --></span>
            boost<span class="token double-colon punctuation">::</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token operator">*</span>ret<span class="token punctuation">,</span>src<span class="token punctuation">,</span>boost<span class="token double-colon punctuation">::</span><span class="token function">is_any_of</span><span class="token punctuation">(</span>sep<span class="token punctuation">)</span><span class="token punctuation">,</span>boost<span class="token double-colon punctuation">::</span>algorithm<span class="token double-colon punctuation">::</span>token_compress_on<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h6><a id="43223__694"></a>4.3.2.2.3 整体代码的编写</h6> 
<p><img src="https://images2.imgbox.com/4d/92/RrL0evsk_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="433__696"></a>4.3.3 数据库版本题库</h4> 
<h5><a id="4331__697"></a>4.3.3.1 题库设计</h5> 
<p>和文件不同，数据库的读取比较简单，所有不需要把信息分开存储，可以使用一张表存储一个题目的所有信息，使用的是MySQL实现。</p> 
<p>首先创建一个oj库当作题库，表结构的设计创建如下：</p> 
<pre><code class="prism language-sql">mysql<span class="token operator">&gt;</span> <span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token keyword">if</span> <span class="token operator">not</span> <span class="token keyword">exists</span> <span class="token identifier"><span class="token punctuation">`</span>oj_topics<span class="token punctuation">`</span></span><span class="token punctuation">(</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>number<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">primary</span> <span class="token keyword">key</span> <span class="token keyword">auto_increment</span> <span class="token keyword">comment</span> <span class="token string">'题目编号'</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>title<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'题目标题'</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>grade<span class="token punctuation">`</span></span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'难度等级'</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>desc<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'题目描述'</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>preset<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'预置代码'</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>test<span class="token punctuation">`</span></span> <span class="token keyword">text</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">comment</span> <span class="token string">'测试用例'</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>maxtime<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">1</span> <span class="token keyword">comment</span> <span class="token string">'时间限制'</span><span class="token punctuation">,</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token identifier"><span class="token punctuation">`</span>maxmem<span class="token punctuation">`</span></span> <span class="token keyword">int</span> <span class="token keyword">default</span> <span class="token number">51200</span> <span class="token keyword">comment</span> <span class="token string">'内存限制(50M)'</span>
    <span class="token operator">-</span><span class="token operator">&gt;</span> <span class="token punctuation">)</span><span class="token keyword">engine</span> <span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">default</span> <span class="token keyword">charset</span><span class="token operator">=</span>utf8<span class="token punctuation">;</span>
Query OK<span class="token punctuation">,</span> <span class="token number">0</span> <span class="token keyword">rows</span> affected <span class="token punctuation">(</span><span class="token number">0.03</span> sec<span class="token punctuation">)</span>

mysql<span class="token operator">&gt;</span> <span class="token keyword">desc</span> oj_topics<span class="token punctuation">;</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+------+-----+---------+----------------+</span>
<span class="token operator">|</span> Field   <span class="token operator">|</span> <span class="token keyword">Type</span>         <span class="token operator">|</span> <span class="token boolean">Null</span> <span class="token operator">|</span> <span class="token keyword">Key</span> <span class="token operator">|</span> <span class="token keyword">Default</span> <span class="token operator">|</span> Extra          <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+------+-----+---------+----------------+</span>
<span class="token operator">|</span> number  <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span> PRI <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span> <span class="token keyword">auto_increment</span> <span class="token operator">|</span>
<span class="token operator">|</span> title   <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">128</span><span class="token punctuation">)</span> <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> grade   <span class="token operator">|</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span>   <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> <span class="token keyword">desc</span>    <span class="token operator">|</span> <span class="token keyword">text</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> preset  <span class="token operator">|</span> <span class="token keyword">text</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> test    <span class="token operator">|</span> <span class="token keyword">text</span>         <span class="token operator">|</span> <span class="token keyword">NO</span>   <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token boolean">NULL</span>    <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> maxtime <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token number">1</span>       <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">|</span> maxmem  <span class="token operator">|</span> <span class="token keyword">int</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span>      <span class="token operator">|</span> YES  <span class="token operator">|</span>     <span class="token operator">|</span> <span class="token number">51200</span>   <span class="token operator">|</span>                <span class="token operator">|</span>
<span class="token operator">+</span><span class="token comment">---------+--------------+------+-----+---------+----------------+</span>
<span class="token number">8</span> <span class="token keyword">rows</span> <span class="token operator">in</span> <span class="token keyword">set</span> <span class="token punctuation">(</span><span class="token number">0.00</span> sec<span class="token punctuation">)</span>

</code></pre> 
<p>然后创建一个专门的oj_client用户，把oj数据库的所有权限都给这个用户<br> 创建用户</p> 
<pre><code>mysql&gt; create user oj_client@'%' identified by '123456';
</code></pre> 
<p>赋权</p> 
<pre><code>mysql&gt; grant all on oj.* to oj_client@'%';
</code></pre> 
<p>这里为了方便本地登录也可以创建一个同名的允许本地登录的用户，注意要让别人远程登录需要开放3306端口。</p> 
<p>之后就可以向这里面录题了，可以直接在命令行操作，也可以使用MySQL官方提供的图形化界面程序MySQL bench录题。使用方法在后面。</p> 
<p>题录好了，要在代码里使用还需要在MySQL的官网上下载并安装一些开发包才可以在代码里使用MySQL，安装方法也在后面有说明</p> 
<h5><a id="4332_oj_modeldb_742"></a>4.3.3.2 oj_model-db模块</h5> 
<p>通过连接数据库，那么model模块的两个接口其实就是sql语句的不同，一个数据库的所有记录，一个是某一个记录，那就需要一个执行sql的接口，然后传入不同的sql语句，获得结果即可，代码如下:<br> <img src="https://images2.imgbox.com/51/89/QPG05Wpz_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="44_oj_view_745"></a>4.4 oj_view模块</h3> 
<p>oj_view模块负责渲染给用户显示的网页。比如说用户请求访问题目列表，题目列表里的题目信息是从我们后端的题库中得到的，而把这些信息显示到网页上，这就是渲染网页。所有说view模块也应该提供两个接口，一个<strong>渲染题目列表</strong>，一个<strong>渲染单个题目的网页</strong>。</p> 
<p>渲染网页首先要有对应的网页，所有就要在OJServer模块的目录下新建两个html文件，负责题目列表和单个题目的两张网页，整个模块的功能就是通过上层传来的题目属性attribute，提取出不同网页需要的字段，渲染到网页中。规定题目列表只显示题目的编号，标题，等级即可，而单个题目则需要题目的编号，标题，等级，描述和预设代码字段。</p> 
<p>view模块通过把这些数据交给前端的网页，然后再根据前端部分构建出对应的网页，两者配合起来，形成给用户返回的页面。渲染工作<strong>通过ctemplate库实现</strong>，安装和使用方法在后面有写。</p> 
<p>下面就是整个模块的代码<br> <img src="https://images2.imgbox.com/6b/e2/TRJxD7kO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="45_oj_control_755"></a>4.5 oj_control模块</h3> 
<h4><a id="451__756"></a>4.5.1 整体结构设计</h4> 
<p>首先明确一下功能，oj_control模块是整个OJSever模块的逻辑功能部分，在上层做好了功能路由之后，是通过调用control模块去时间各个功能的，所有oj_control模块既要可以给上传返还对应的网页，还要可以负载均衡的判题。根据这三种请求，就要能够提供三个功能，即：一个可以<strong>构建好题目列表网页</strong>的接口，一个<strong>可以根据题目编号构建好单个题目网页</strong>的接口，还有一个<strong>判题接口</strong>。</p> 
<p>要完成这些功能就需要一些模块的配合，首先网页有关的两个功能肯定需要<strong>model模块</strong>和<strong>view模块</strong>实现，一定要包含这两个类的对象。其中比较复杂的就是这个判题功能，判题功能需要调用CompilerServer模块，使用它的编译服务帮我完成判题，但是我不能单纯的去请求一个服务，根据项目的设计，我是要负载均衡的去选择对应的编译服务，这个<strong>负载均衡功能</strong>可以封装到一个类里面，专门供判题模块去调用。</p> 
<h4><a id="452__760"></a>4.5.2 构建题目列表和单个题目网页</h4> 
<p>这两个模块的功能在model模块和view模块以及基本实现了，control模块的任务就是调用上面的两个模块，首先通过model模块获取到网页需要的题目信息，列表或者是单个题目，然后通过这些信息，调用view模块，渲染对应的网页，然后返还给oj_server模块，再通过网络返还给用户即可。</p> 
<p>只有一个需要注意的是当我构建题目列表的网页时，我通过model模块拿到的题目信息，它不一定是按照题目编号排好序的，有可能是乱序的，所有需要我们拿到题目信息之后，对vector数组根据题目编号进行一下排序，然后再渲染网页，否则用户看到的也是一个乱序的题目列表。下面是两个模块的代码<br> <img src="https://images2.imgbox.com/3f/2b/s0pkBS0h_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="453__766"></a>4.5.3 判题功能</h4> 
<h5><a id="4531__767"></a>4.5.3.1 负载均衡模块</h5> 
<h6><a id="45311__768"></a>4.5.3.1.1 整体功能设计</h6> 
<p><strong>机器类的设计</strong><br> 负载均衡模块，最重要的功能就是可以<strong>负载均衡式的选择主机</strong>，这里面有两个问题，一个是我如何得知有哪些主机可以供我选择，其次我怎么知道怎么选就是负载均衡的。</p> 
<p>所以在模块内部一定需要有一个结构包含了可以提供服务的主机信息，然后有一个数据结构把这些属性组织在一起。用来表述主机的结构我命名为Machine，然后我用一个vector把所有可以提供服务的主机组织起来。</p> 
<p>Machine类里面一定包含的属性有主机的<strong>IP，端口</strong>，还有一个<strong>计数器</strong>表示主机的负载情况。我负载均衡判断的依据就是看主机的负载，所有类里还要提供方法在有新请求请求该机器时<strong>增加负载</strong>，服务结束时<strong>减少负载</strong>，为了调试还可以增加一个<strong>获取负载</strong>，如果中途服务主机突然挂了，还要可以<strong>清空负载</strong>。<br> 因为同一时刻可能有多个执行流在请求同一个主机，所有需要保证我对负载操作的安全性，就需要一个mutex互斥锁保护对负载的操作。<br> <img src="https://images2.imgbox.com/5a/7f/iFTYclPH_o.png" alt="在这里插入图片描述"></p> 
<p><strong>负载均衡模块设计</strong><br> 有了表示所有的主机，那么我首先需要一个<strong>vector来组织起所有的主机</strong>，将来选择主机就可以在vector中选，但是在此之前我需要知道有哪些主机我可以选，规定在当前路径下的conf文件加下的一个.conf文件里面会存放所有的可以提供服务的主机信息，包括了IP和端口，两个字段用”:“分隔，每一行是一个主机的信息，负载均衡模块在构建时就可以读取该文件，<strong>初始化自己的vector结构</strong>。</p> 
<p>然后就是<strong>选择主机功能</strong>，首先在同一时刻可能有很多执行流都在选择主机，所以对主机的选择需要<strong>加锁</strong>，也就是说负载均衡模块也需要一个互斥锁。</p> 
<p>设计在control模块调用负载均衡模块时，如果说后端的编译服务主机出问题挂了，不应该影响我的OJServer服务，OJ服务正常运行，编译服务如果恢复了，那我正常请求，如果有一部分寄了，那我请求别人，全寄我就不请求，提示后端，这个功能就由负载均衡模块负责，就是说负载均衡模块除了可以选择主机，还要能够知道主机的情况，并且能够更具实际情况更新。规定我使用<strong>数组的下标表示每一个主机的编号</strong>，用两个<strong>数组</strong>，一个表示<strong>上线的主机</strong>，元素的值就是主机编号，另一个数组也类似，但是表示的是<strong>下线的主机</strong>。然后我要提供方法，在后端编译服务重启时我要<strong>可以更新状态</strong>让主机上线，当请求主机失败时我要更新状态让主机下线。</p> 
<h6><a id="45312__784"></a>4.5.3.1.2 负载均衡模块的实现</h6> 
<p>负载均衡模块所谓的负载均衡，就是尽量让每一台机器负责的请求都大致一样，那就需要我们从所有在线的主机中选择出对应的主机，选择的方法有两种：<br> 一是随机挑选主机，即每一次都是随机选，这些选中每一台主机的概率就是相等的，但是这种方法你不能排除有时候就是点背一直选中某几台，有几台又一直选不上，需要一定的运气成分。还有一种就比较严格，选择的时候遍历所有在线的主机，找出负载最小的，我使用的就是这种方法。</p> 
<p>还有就是上线下线需要说明一下，负载均衡模块它的功能是掌握机器的状态，选择机器来提供服务，至于如何请求编译服务，这个模块不关心，我<strong>只负责选出那个合适的主机</strong>。编译主机如何上线下线我也不管，我<strong>只负责知道它现在是上线还是下线</strong>。</p> 
<p>下面是代码实现：<br> <img src="https://images2.imgbox.com/84/eb/KJGbW2BA_o.png" alt="在这里插入图片描述"></p> 
<h5><a id="4532__792"></a>4.5.3.2 判题模块的编写</h5> 
<p>有了负载均衡模块，判题模块就比较明了了。首先我得到的参数肯定是我需要判的题目编号和用户传进来的json串形式的代码，我通过题目编号，调用model模块得到题目相关的信息，然后通过反序列化用户传来的代码，得到代码内容。</p> 
<p>有了题目的信息和用户的代码，就可以拼接出可以用来编译的源码内容和对应的资源限制，构建出CompilerServer需要的json串。</p> 
<p>在请求服务之前，需要死循环式的去选择最低负载的主机，因为你选中的主机你不一定知道它是否还在线，可能你选中的时候它已经挂了，那你再请求就会请求失败，如果请求失败，就调用负载均衡模块的下线主机方法更新这个主机的状态，然后重新选择下一个主机，没有找到主机，说明所有主机都挂了，那只能返回了。</p> 
<p>选到主机之后通过主机的IP+端口，使用网络请求的方式发起编译请求，除了通过请求的返回值判断请求是否成功，还需要判断请求的状态码，只有状态呢是200时才表示请求成功。并且需要注意更新请求时机器的负载情况。</p> 
<p>下面是代码内容：<br> <img src="https://images2.imgbox.com/4b/e7/osyZmslE_o.png" alt="在这里插入图片描述"></p> 
<h4><a id="454__803"></a>4.5.4 更新主机上线状态</h4> 
<p>设计时如果编译服务的主机都挂了，OJ服务就无法提供判题服务，但是OJ服务不能挂，如果后端的编译服务被重启了，OJ服务要可以更新主机的状态然后请求，所有涉及当服务重启之后，再后端通过给OJ服务发送信号，来更新OJ服务中记录的编译服务器状态，这个功能已经在负载均衡模块中实现了，可以让oj_srever模块通过调用control模块使用该功能<br> <img src="https://images2.imgbox.com/ac/ce/h5jiOtx5_o.png" alt="在这里插入图片描述"><br> 以上就完成了oj_control模块的编写。</p> 
<p>这部分代码写完，整个项目的 后端部分就基本完成了，剩下的就是前端页面的编写。</p> 
<h2><a id="5__809"></a>5. 前端页面设计</h2> 
<p>主要包含三个网页，一个是首页内容，首页里会包含访问题目列表的连接，通过题目列表的题目访问每一道题，后端会配合view模块和model模块对后面两个网页内容进行渲染响应给用户。因为前端的部分我也不是很熟悉，所有下面的内容就不做详细的解释了，注释会解释一些部分的含义。</p> 
<h3><a id="51_811"></a>5.1首页</h3> 
<p><strong>OJServer-&gt;wwwroot-&gt;index.html</strong></p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>OJ系统<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">*</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span><span class="token comment">/*消除网页默认外边距 */</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span><span class="token comment">/*消除网页默认内边距 */</span>
        <span class="token punctuation">}</span>
        <span class="token selector">html,
        body</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* 给父级别标签设置取消后续浮动带来的影响 */</span>
            <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar a</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">/* 设置成行内块，允许设置宽度 */</span>
            <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
            <span class="token comment">/* 设置每个a标签的宽度 */</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
            <span class="token comment">/* 设置字体颜色 */</span>
            <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* 设置字体大小 */</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> larger<span class="token punctuation">;</span>
            <span class="token comment">/* 设置文字的高度 */</span>
            <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token comment">/* 去掉下划线 */</span>
            <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token comment">/* 设置文字居中 */</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/* 添加鼠标事件 */</span>
        <span class="token selector">.container .navbar a:hover</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> blueviolet<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar .login</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .content</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
            <span class="token comment">/* background-color: rgba(184, 175, 197, 0.947); */</span>
            <span class="token comment">/* 边距居中 */</span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 0px auto<span class="token punctuation">;</span>
            <span class="token comment">/* 文字居中 */</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
            <span class="token comment">/* 设置上外边距 */</span>
            <span class="token property">margin-top</span><span class="token punctuation">:</span> 200px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .content ._font</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">/* 设置标签为块级元素，可以设置高度宽度等属性 */</span>
            <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
            <span class="token property">margin-top</span><span class="token punctuation">:</span> 20px<span class="token punctuation">;</span>
            <span class="token comment">/* 去掉下划线 */</span>
            <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token comment">/* 设置字体大小 */</span>

        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--导航栏--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>navbar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/topic_list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>题库<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>面试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>学习<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>求职<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>讨论区<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>发现<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>login<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!---网页内容--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>content<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_font<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>欢迎来的铁柱同学的OJ平台<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_font<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点击下面的连接，获得题目列表，选择题目进行编程<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>_font<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/topic_list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>点我获得题目列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="52_907"></a>5.2题目列表页面</h3> 
<p><strong>OJSever-&gt;Rendered_html-&gt;List.html</strong></p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>题目列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">*</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span><span class="token comment">/*消除网页默认外边距 */</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span><span class="token comment">/*消除网页默认内边距 */</span>
        <span class="token punctuation">}</span>

        <span class="token selector">html,
        body</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* 给父级别标签设置取消后续浮动带来的影响 */</span>
            <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar a</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">/* 设置成行内块，允许设置宽度 */</span>
            <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
            <span class="token comment">/* 设置每个a标签的宽度 */</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
            <span class="token comment">/* 设置字体颜色 */</span>
            <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* 设置字体大小 */</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> larger<span class="token punctuation">;</span>
            <span class="token comment">/* 设置文字的高度 */</span>
            <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token comment">/* 去掉下划线 */</span>
            <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token comment">/* 设置文字居中 */</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/* 添加鼠标事件 */</span>
        <span class="token selector">.container .navbar a:hover</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> blueviolet<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar .login</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .list</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">padding-top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 800px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 0px auto<span class="token punctuation">;</span>
            <span class="token comment">/* background-color: slategrey; */</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/* 调整表格 */</span>
        <span class="token selector">.container .list table</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> larger<span class="token punctuation">;</span>
            <span class="token property">font-family</span><span class="token punctuation">:</span><span class="token string">'Times New Roman'</span><span class="token punctuation">,</span> Times<span class="token punctuation">,</span> serif<span class="token punctuation">;</span>
            <span class="token property">margin-top</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>247<span class="token punctuation">,</span> 248<span class="token punctuation">,</span> 255<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .list h1</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">color</span><span class="token punctuation">:</span><span class="token function">rgb</span><span class="token punctuation">(</span>22<span class="token punctuation">,</span> 42<span class="token punctuation">,</span> 223<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .list table .item</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 40px<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span><span class="token function">rgb</span><span class="token punctuation">(</span>169<span class="token punctuation">,</span> 169<span class="token punctuation">,</span> 169<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token property">padding-top</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
            <span class="token property">padding-bottom</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> large<span class="token punctuation">;</span>
            <span class="token property">font-family</span><span class="token punctuation">:</span> Georgia<span class="token punctuation">,</span> <span class="token string">'Times New Roman'</span><span class="token punctuation">,</span> Times<span class="token punctuation">,</span> serif<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .list table .item a</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .list table .item a:hover</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
            <span class="token property">text-decoration</span><span class="token punctuation">:</span>underline<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .footer</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 150px<span class="token punctuation">;</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> black<span class="token punctuation">;</span>
            <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span>darkgray<span class="token punctuation">;</span>
            <span class="token property">margin-top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--导航栏--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>navbar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/topic_list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>题库<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>面试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>学习<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>求职<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>讨论区<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>发现<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>login<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>题目列表<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>编号<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>标题<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>难度<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- 循环式的形成多个内容 --&gt;</span>
                {<!-- -->{#topic_list}}
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{number}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/topic/{<!-- -->{number}}<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>item<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{grade}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
                {<!-- -->{/topic_list}}
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>footer<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span>@c铁柱同学<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h3><a id="53_1050"></a>5.3指定题目的编写提交页面</h3> 
<p><strong>OJSever-&gt;Rendered_html-&gt;One.html</strong></p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>{<!-- -->{number}}.{<!-- -->{title}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 引入ACE CDN --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ace.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span>
        <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- CDN的语言工具，识别语言，自动补齐 --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://cdnjs.cloudflare.com/ajax/libs/ace/1.2.6/ext-language_tools.js<span class="token punctuation">"</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span>
        <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 引入jQuery CDN --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://libs.baidu.com/jquery/2.0.0/jquery.min.js<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
        <span class="token selector">*</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">margin</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
            <span class="token property">padding</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">html,
        body</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token selector">div .ace_editor</span> <span class="token punctuation">{<!-- --></span>
            <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>0<span class="token punctuation">,</span> 0<span class="token punctuation">,</span> 0<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* 给父级别标签设置取消后续浮动带来的影响 */</span>
            <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar a</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">/* 设置成行内块，允许设置宽度 */</span>
            <span class="token property">display</span><span class="token punctuation">:</span> inline-block<span class="token punctuation">;</span>
            <span class="token comment">/* 设置每个a标签的宽度 */</span>
            <span class="token property">width</span><span class="token punctuation">:</span> 80px<span class="token punctuation">;</span>
            <span class="token comment">/* 设置字体颜色 */</span>
            <span class="token property">color</span><span class="token punctuation">:</span> <span class="token function">rgb</span><span class="token punctuation">(</span>255<span class="token punctuation">,</span> 255<span class="token punctuation">,</span> 255<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">/* 设置字体大小 */</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> larger<span class="token punctuation">;</span>
            <span class="token comment">/* 设置文字的高度 */</span>
            <span class="token property">line-height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token comment">/* 去掉下划线 */</span>
            <span class="token property">text-decoration</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
            <span class="token comment">/* 设置文字居中 */</span>
            <span class="token property">text-align</span><span class="token punctuation">:</span> center<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">/* 添加鼠标事件 */</span>
        <span class="token selector">.container .navbar a:hover</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> blueviolet<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .navbar .login</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part1</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
            <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part1 .left_desc</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
            <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
            <span class="token property">overflow</span><span class="token punctuation">:</span> scroll<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part1 .left_desc h4</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">padding-top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
            <span class="token property">padding-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part1 .left_desc pre</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">padding-top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
            <span class="token property">padding-left</span><span class="token punctuation">:</span> 10px<span class="token punctuation">;</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> large<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part1 .right_code</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
            <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part1 .right_code .ace_editor</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">height</span><span class="token punctuation">:</span> 600px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part2</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
            <span class="token property">overflow</span><span class="token punctuation">:</span> hidden<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part2 .result</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 300px<span class="token punctuation">;</span>
            <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part2 .btn-submit</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">width</span><span class="token punctuation">:</span> 120px<span class="token punctuation">;</span>
            <span class="token property">height</span><span class="token punctuation">:</span> 50px<span class="token punctuation">;</span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> large<span class="token punctuation">;</span>
            <span class="token property">float</span><span class="token punctuation">:</span> right<span class="token punctuation">;</span>
            <span class="token property">background-color</span><span class="token punctuation">:</span> #26bb9c<span class="token punctuation">;</span>
            <span class="token property">color</span><span class="token punctuation">:</span> #fff<span class="token punctuation">;</span>
            <span class="token comment">/* 按钮带上圆角 */</span>
            <span class="token property">border-radius</span><span class="token punctuation">:</span> 1ch<span class="token punctuation">;</span>
            <span class="token comment">/* 去掉边框 */</span>
            <span class="token property">border</span><span class="token punctuation">:</span> 0px<span class="token punctuation">;</span>

            <span class="token property">margin-top</span><span class="token punctuation">:</span> 8px<span class="token punctuation">;</span>
            <span class="token property">margin-right</span><span class="token punctuation">:</span> 5px<span class="token punctuation">;</span>

        <span class="token punctuation">}</span>
        <span class="token selector">.container .part2 button:hover</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">color</span><span class="token punctuation">:</span> green<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part2 .result</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">margin-top</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
            <span class="token property">margin-left</span><span class="token punctuation">:</span> 15px<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token selector">.container .part2 .result pre</span><span class="token punctuation">{<!-- --></span>
            <span class="token property">font-size</span><span class="token punctuation">:</span> large<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!--导航栏--&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>navbar<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>首页<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>/topic_list<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>题库<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>面试<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>学习<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>求职<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>讨论区<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>发现<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>login<span class="token punctuation">"</span></span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>登录<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 左右呈现 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>part1<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>left_desc<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h4</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>number<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{number}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>.{<!-- -->{title}}.{<!-- -->{grade}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h4</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span><span class="token punctuation">&gt;</span></span>{<!-- -->{desc}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>right_code<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- 代码编辑区 --&gt;</span>
                <span class="token comment">&lt;!-- &lt;textarea name="C++" id="" cols="30" rows="10"&gt;{<!-- -->{preset}}&lt;/textarea&gt; --&gt;</span>
                <span class="token comment">&lt;!-- ACE需要的标签 --&gt;</span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>pre</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>code<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ace_editor<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>textarea</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ace_text-input<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>{<!-- -->{preset}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>textarea</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>pre</span><span class="token punctuation">&gt;</span></span>
                <span class="token comment">&lt;!-- &lt;button class="bt" οnclick="submit()"&gt;提交代码&lt;/button&gt; --&gt;</span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token comment">&lt;!-- 提交并显示结果 --&gt;</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>part2<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>result<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn-submit<span class="token punctuation">"</span></span> <span class="token special-attr"><span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span><span class="token value javascript language-javascript"><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">"</span></span></span><span class="token punctuation">&gt;</span></span>保存并提交<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
        <span class="token comment">//初始化对象 </span>
        editor <span class="token operator">=</span> ace<span class="token punctuation">.</span><span class="token function">edit</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//设置风格和语言（更多风格和语言，请到github上相应目录查看） </span>
        editor<span class="token punctuation">.</span><span class="token function">setTheme</span><span class="token punctuation">(</span><span class="token string">"ace/theme/monokai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置支持的语言</span>
        editor<span class="token punctuation">.</span>session<span class="token punctuation">.</span><span class="token function">setMode</span><span class="token punctuation">(</span><span class="token string">"ace/mode/c_cpp"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 字体大小 </span>
        editor<span class="token punctuation">.</span><span class="token function">setFontSize</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置默认制表符的大小: </span>
        editor<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">setTabSize</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 设置只读（true时只读，用于展示代码） </span>
        editor<span class="token punctuation">.</span><span class="token function">setReadOnly</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 启用提示菜单 </span>
        ace<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"ace/ext/language_tools"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//引入语言包</span>
        editor<span class="token punctuation">.</span><span class="token function">setOptions</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span> <span class="token comment">//设置功能</span>
            <span class="token literal-property property">enableBasicAutocompletion</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">enableSnippets</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token literal-property property">enableLiveAutocompletion</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">function</span> <span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token comment">//alert("你好");</span>
            <span class="token comment">//1.收集当前页面的数据：题号，代码</span>
            <span class="token keyword">var</span> code<span class="token operator">=</span>editor<span class="token punctuation">.</span><span class="token function">getSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//得到用户代码</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>code<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> number<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".container .part1 .left_desc h4 #number"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">text</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//拿到编号</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>number<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> judge_url<span class="token operator">=</span><span class="token string">"/judge/"</span><span class="token operator">+</span>number<span class="token punctuation">;</span>

            <span class="token comment">//2.构建json串给后端并发起请求</span>
            <span class="token comment">// 通过ajax发起请求</span>
            $<span class="token punctuation">.</span><span class="token function">ajax</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                <span class="token literal-property property">method</span><span class="token operator">:</span><span class="token string">'Post'</span><span class="token punctuation">,</span><span class="token comment">//请求的方法</span>
                <span class="token literal-property property">url</span><span class="token operator">:</span>judge_url<span class="token punctuation">,</span><span class="token comment">//向指定的url发起请求</span>
                <span class="token literal-property property">dataType</span><span class="token operator">:</span><span class="token string">'json'</span><span class="token punctuation">,</span><span class="token comment">//告知服务端我需要什么格式</span>
                <span class="token literal-property property">contentType</span><span class="token operator">:</span><span class="token string">'application/json;charset=utf-8'</span><span class="token punctuation">,</span><span class="token comment">//告知服务端我是什么格式</span>
                <span class="token literal-property property">data</span><span class="token operator">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span>
                    <span class="token string-property property">'code'</span><span class="token operator">:</span>code<span class="token punctuation">,</span>
                    <span class="token string-property property">'input'</span><span class="token operator">:</span><span class="token string">''</span><span class="token punctuation">,</span>

                <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function-variable function">success</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//如果成功的到的结果</span>
                    <span class="token comment">//console.log(data);</span>
                    <span class="token function">show_result</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">//3.得到结果，解析并显示到result</span>
            <span class="token keyword">function</span> <span class="token function">show_result</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span>
            <span class="token punctuation">{<!-- --></span>
                <span class="token comment">// console.log(data.stat);</span>
                <span class="token comment">// console.log(data.mean);</span>
                <span class="token comment">//拿到结果标签</span>
                <span class="token keyword">var</span> result_div<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">".container .part2 .result"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                result_div<span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//清空上一次的结果</span>
                <span class="token comment">//先拿到一定有的两部分</span>
                <span class="token keyword">var</span> stat<span class="token operator">=</span>data<span class="token punctuation">.</span>stat<span class="token punctuation">;</span>
                <span class="token keyword">var</span> mean<span class="token operator">=</span>data<span class="token punctuation">.</span>mean<span class="token punctuation">;</span>

                <span class="token keyword">var</span> reason_lable<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;p&gt;"</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
                        <span class="token literal-property property">text</span><span class="token operator">:</span>mean
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                reason_lable<span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span>result_div<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span><span class="token punctuation">(</span>stat<span class="token operator">==</span><span class="token number">0</span><span class="token punctuation">)</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//编译运行是成功的</span>
                    <span class="token keyword">var</span> out<span class="token operator">=</span>data<span class="token punctuation">.</span>out<span class="token punctuation">;</span>
                    <span class="token keyword">var</span> rerr<span class="token operator">=</span>data<span class="token punctuation">.</span>rerr<span class="token punctuation">;</span>

                    <span class="token keyword">var</span> out_lable<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;pre&gt;"</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
                        <span class="token literal-property property">text</span><span class="token operator">:</span>out
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    <span class="token keyword">var</span> rerr_lable<span class="token operator">=</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">"&lt;pre&gt;"</span><span class="token punctuation">,</span><span class="token punctuation">{<!-- --></span>
                        <span class="token literal-property property">text</span><span class="token operator">:</span>rerr
                    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                    out_lable<span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span>result_div<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    rerr_lable<span class="token punctuation">.</span><span class="token function">appendTo</span><span class="token punctuation">(</span>result_div<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span>
                <span class="token punctuation">{<!-- --></span>
                    <span class="token comment">//编译运行出错,显示出错原因</span>
                    <span class="token comment">//把包含错误原因的p标签插入到result_div标签</span>
                    
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<h2><a id="6_Makefile_1313"></a>6 顶层项目部署Makefile</h2> 
<p>在顶层新建一个Makefile文件，该文件的功能就是可以make时可以同时编译CompilerServer服务和OJServer服务，当输入make submit时会自动形成一个output文件，里面包含了compiler_server和oj_server的应用程序和一些运行程序必须的文件，时间打包的功能。最后输入make clean不光会清理掉创建的可执行程序，还会清理掉output的内容。</p> 
<pre><code class="prism language-shell"><span class="token comment"># 编译功能</span>
.PHONY:all
all:
	@cd CompilerServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">make</span><span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token builtin class-name">cd</span> -<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token builtin class-name">cd</span> OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">make</span><span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token builtin class-name">cd</span> -<span class="token punctuation">;</span>

<span class="token comment"># 部署功能</span>
.PHONY:submit
submit:
	@mkdir -p output/CompilerServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">mkdir</span> -p output/OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">cp</span> -rf CompilerServer/compiler_server output/CompilerServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">cp</span> -rf CompilerServer/tempfile output/CompilerServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">cp</span> -rf OJServer/oj_server output/OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">cp</span> -rf OJServer/conf output/OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">cp</span> -rf OJServer/lib output/OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">cp</span> -rf OJServer/TopicBank output/OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">cp</span> -rf OJServer/Rendered_html output/OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">cp</span> -rf OJServer/wwwroot output/OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>

<span class="token comment"># 清除功能</span>
.PHONY:clean
clean:
	@cd CompilerServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">make</span> clean<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token builtin class-name">cd</span> -<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token builtin class-name">cd</span> OJServer<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">make</span> clean<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token builtin class-name">cd</span> -<span class="token punctuation">;</span><span class="token punctuation">\</span>
	<span class="token function">rm</span> -rf output<span class="token punctuation">;</span>
</code></pre> 
<h2><a id="7__1353"></a>7 项目组件的安装与使用</h2> 
<h3><a id="jsoncpp_1354"></a>jsoncpp</h3> 
<p><strong>安装json</strong></p> 
<pre><code>sudo yum install -y jsoncpp-devel
</code></pre> 
<p>使用jsoncpp要在编译时添加-ljsoncpp</p> 
<p><strong>序列化</strong><br> 把一个结构化的数据转化成字符串。</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;jsoncpp/json/json.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    Json<span class="token double-colon punctuation">::</span>Value root<span class="token punctuation">;</span><span class="token comment">//中间类型，以KV形式设置</span>
    root<span class="token punctuation">[</span><span class="token string">"int"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">10</span><span class="token punctuation">;</span>
    root<span class="token punctuation">[</span><span class="token string">"bool"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>
    root<span class="token punctuation">[</span><span class="token string">"string"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"string"</span><span class="token punctuation">;</span>
    
    Json<span class="token double-colon punctuation">::</span>FastWriter fw<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string fs<span class="token operator">=</span>fw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    Json<span class="token double-colon punctuation">::</span>StyledWriter sw<span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string ss<span class="token operator">=</span>sw<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
	
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>反序列化</strong></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;jsoncpp/json/json.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
	<span class="token comment">/*************************
	* jsonstr:
    * {"bool":true,"int":10,"str":"string"}
    * **********************/</span>
    Json<span class="token double-colon punctuation">::</span>Value root<span class="token punctuation">;</span>
    Json<span class="token double-colon punctuation">::</span>Reader rd<span class="token punctuation">;</span>
    rd<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>jsonstr<span class="token punctuation">,</span>root<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">int</span> id<span class="token operator">=</span>root<span class="token punctuation">[</span><span class="token string">"int"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asInt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">bool</span> b<span class="token operator">=</span>root<span class="token punctuation">[</span><span class="token string">"bool"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asBool</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>string str<span class="token operator">=</span>root<span class="token punctuation">[</span><span class="token string">"str"</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">asString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="cpphttplib_1403"></a>cpp-httplib</h3> 
<p><strong>下载安装</strong><br> 在gitee搜索cpp-httplib，建议选择0.7.15版本，比较稳定</p> 
<p>这个库是header-only的，解压出来之后里面只有一个httplib.h的头文件，把这个头文件拷贝到项目中就可以直接使用了。</p> 
<p>注意，使用这个库必须使用高版本的gcc。</p> 
<p><strong>gcc升级方法</strong><br> 搜索scl gcc devsettool</p> 
<p>安装scl工具集的yum源</p> 
<pre><code>sudo yum install centos-release-scl scl-utils-build
</code></pre> 
<p>安装新版本的gcc（7以上的就可以,这里以7为例）</p> 
<pre><code>sudo yum install -y devtoolset-7-gcc devtoolset-7-gcc-c++
</code></pre> 
<p>查看自己安装的版本</p> 
<pre><code>ls /opt/rh
</code></pre> 
<p>启动高版本的gcc</p> 
<pre><code>scl enable devtoolset-7 bash 
</code></pre> 
<p>启动的方式启动高版本只在当前会话有效，如果想要每次登录自动启动高版本，可以把启动命令添加到用户自己的~./bash_profile文件中，添加好保存退出，重新登录，之后每次登录就会自动执行启动高版本的命令。</p> 
<p><strong>使用方法</strong><br> cpp-httplib是一个阻塞式多线程的网络http库，内部使用了原生线程库，所以编译的时候要加-lpthread</p> 
<p><strong>1.创建服务</strong><br> 创建Server对象就可以创建一个服务<br> 通过set_base_dir方法设置首页信息，</p> 
<pre><code class="prism language-cpp"><span class="token keyword">inline</span> <span class="token keyword">bool</span> httplib<span class="token double-colon punctuation">::</span><span class="token class-name">Server</span><span class="token double-colon punctuation">::</span><span class="token function">set_base_dir</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>dir<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>mount_point <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span><span class="token punctuation">)</span><span class="token keyword">nullptr</span><span class="token punctuation">)</span>
</code></pre> 
<p>创建一个根目录，里面创建一个index.html网页，然后把参数dir设置成创建的根目录的地址就完成了设置。</p> 
<p>通过Get方法可以处理客户端通过GET方法提交的http请求</p> 
<pre><code class="prism language-cpp"><span class="token keyword">inline</span> httplib<span class="token double-colon punctuation">::</span>Server <span class="token operator">&amp;</span>httplib<span class="token double-colon punctuation">::</span><span class="token class-name">Server</span><span class="token double-colon punctuation">::</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>pattern<span class="token punctuation">,</span> httplib<span class="token double-colon punctuation">::</span>Server<span class="token double-colon punctuation">::</span>Handler handler<span class="token punctuation">)</span>
</code></pre> 
<p>pattern表示客户端请求的资源，后面是一个回调方法，表示如果用户请求pattern资源，就调用后面的回调方法，一般配合lambda表达式使用，表达式的两个参数分别是httplib::Request表示请求httplib::Response表示响应。</p> 
<p>可以用Response类的set_content方法给客户端构建响应</p> 
<pre><code class="prism language-cpp"><span class="token keyword">inline</span> <span class="token keyword">void</span> httplib<span class="token double-colon punctuation">::</span><span class="token class-name">Response</span><span class="token double-colon punctuation">::</span><span class="token function">set_content</span><span class="token punctuation">(</span><span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>s<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>content_type<span class="token punctuation">)</span>
</code></pre> 
<p>参数s表示响应的内容，参数content_type表示响应的格式。</p> 
<p>然后调用Server对象的listen方法，启动服务</p> 
<pre><code class="prism language-cpp"><span class="token keyword">bool</span> httplib<span class="token double-colon punctuation">::</span><span class="token class-name">Server</span><span class="token double-colon punctuation">::</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>host<span class="token punctuation">,</span> <span class="token keyword">int</span> port<span class="token punctuation">,</span> <span class="token keyword">int</span> socket_flags <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">)</span>
</code></pre> 
<p>host表示IP地址，port表示端口号</p> 
<p>示例：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"httplib.h"</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    httplib<span class="token double-colon punctuation">::</span>Server svr<span class="token punctuation">;</span>
    <span class="token comment">//设置首页</span>
    svr<span class="token punctuation">.</span><span class="token function">set_base_dir</span><span class="token punctuation">(</span><span class="token string">"./wwwroot"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//设置回调，当请求hello资源时，调用lambda表达式，</span>
    svr<span class="token punctuation">.</span><span class="token function">Get</span><span class="token punctuation">(</span><span class="token string">"/hello"</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">const</span> httplib<span class="token double-colon punctuation">::</span>Request<span class="token operator">&amp;</span> req<span class="token punctuation">,</span>httplib<span class="token double-colon punctuation">::</span>Response<span class="token operator">&amp;</span> resp<span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        resp<span class="token punctuation">.</span><span class="token function">set_content</span><span class="token punctuation">(</span><span class="token string">"你好httplib"</span><span class="token punctuation">,</span><span class="token string">"text/plain;charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//设置相应的内容(body)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//启动服务</span>
    svr<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token string">"0.0.0.0"</span><span class="token punctuation">,</span><span class="token number">8848</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p><strong>2.创建客户端</strong><br> 首先创建Client对象用来请求</p> 
<p>可以选择GET或POST方法请求，以POST方法为例</p> 
<pre><code class="prism language-cpp"><span class="token keyword">inline</span> httplib<span class="token double-colon punctuation">::</span>Result httplib<span class="token double-colon punctuation">::</span><span class="token class-name">Client</span><span class="token double-colon punctuation">::</span><span class="token function">Post</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>path<span class="token punctuation">,</span> <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string <span class="token operator">&amp;</span>body<span class="token punctuation">,</span> <span class="token keyword">const</span> <span class="token keyword">char</span> <span class="token operator">*</span>content_type<span class="token punctuation">)</span>
</code></pre> 
<p>path：表示要请求的资源<br> body：表示发起请求的正文部分<br> content_type：表示请求正文的类型<br> 返回值Result里面会包含一个指向Response的智能指针，所以可以通过返回值拿到请求得到的响应。指针如果为空则表示请求失败</p> 
<h3><a id="boost_1492"></a>boost库</h3> 
<p><strong>安装boost库</strong></p> 
<pre><code>sudo yum install -y boost-devel
</code></pre> 
<p><strong>分割字符串</strong></p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;boost/algorithm/string.hpp&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;vector&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    <span class="token keyword">const</span> std<span class="token double-colon punctuation">::</span>string src<span class="token operator">=</span><span class="token string">"1,title,困难,,,1,50000"</span><span class="token punctuation">;</span>
    std<span class="token double-colon punctuation">::</span>vector<span class="token operator">&lt;</span>std<span class="token double-colon punctuation">::</span>string<span class="token operator">&gt;</span> ret<span class="token punctuation">;</span>
    boost<span class="token double-colon punctuation">::</span><span class="token function">split</span><span class="token punctuation">(</span>ret<span class="token punctuation">,</span>src<span class="token punctuation">,</span>boost<span class="token double-colon punctuation">::</span><span class="token function">is_any_of</span><span class="token punctuation">(</span><span class="token string">","</span><span class="token punctuation">)</span><span class="token punctuation">,</span>boost<span class="token double-colon punctuation">::</span>algorithm<span class="token double-colon punctuation">::</span>token_compress_on<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">auto</span> it<span class="token operator">:</span>ret<span class="token punctuation">)</span>
    <span class="token punctuation">{<!-- --></span>
        std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span>it<span class="token punctuation">.</span><span class="token function">c_str</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>第一个参数表示要分割的字符串，该方法不会修改原字符串<br> 第二个参数是分割完的结果，要保存在一个数组中<br> 第三个参数表示分隔符，凡是在is_any_of括号里的字符串里的字符都会被当作分隔符<br> 第四个参数表示是否压缩，如果是token_compress_on，当有多个分隔符连接在一起时，会把这些重复的分隔符当作一个进行分割。如果是token_compress_off，当有多个分隔符时，只会有一个被当作分隔符，其他的每一个重复的分隔符会当作空字符串存入到结果数组中。</p> 
<h3><a id="ctemplate_1521"></a>ctemplate</h3> 
<p>是一个Google开源的C/C++的网页渲染库。</p> 
<p><strong>安装</strong><br> 需要源码安装，首先clone对于的库</p> 
<pre><code> git clone https://hub.fastgit.xyz/OlafvdSpek/ctemplate.git
</code></pre> 
<p>进入ctemplate目录下执行以下指令</p> 
<pre><code>./autogen.sh
./configure
make                     //编译注意使用高版本的gcc
sudo make install  //安装到系统
</code></pre> 
<p>安装完成后，如果使用是报错说找不到动态库，到动态库目录下使用find -name命令找到动态库的目录，有两种方案<br> 方法一：把动态库目录添加到LD_LIBRARY_PATH环境变量</p> 
<pre><code>export LD_LIBRARY_PATH=动态库路径
</code></pre> 
<p>方法二：修改配置文件</p> 
<pre><code>cd /etc/ld.so.conf.d/
</code></pre> 
<p>到该目录下以后touch一个.conf文件，然后把动态库的路径添加到新建的文件中，ldconfig更新一下缓存即可。该过程需要sudo权限。</p> 
<p>注意：路径必须是/home打头的。</p> 
<p><strong>使用</strong><br> 需要两部分内容：一个能够承装数据的KV结构的数据字典，还有一个被渲染的网页内容。渲染功能就是把数据字典的数据替换进网页里</p> 
<p>网页test.html：</p> 
<pre><code class="prism language-html"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>X-UA-Compatible<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>IE=edge<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>测试ctemplate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
    <span class="token comment">&lt;!-- 用双大括号阔起来的内容就表示要被替换的内容  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{key}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{key}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{key}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{key}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>{<!-- -->{key}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> 
<p>渲染代码：</p> 
<pre><code class="prism language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;iostream&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;string&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;ctemplate/template.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">{<!-- --></span>
    std<span class="token double-colon punctuation">::</span>string old_html<span class="token operator">=</span><span class="token string">"./test.html"</span><span class="token punctuation">;</span><span class="token comment">//网页路径加文件名</span>
    std<span class="token double-colon punctuation">::</span>string value<span class="token operator">=</span><span class="token string">"你好"</span><span class="token punctuation">;</span><span class="token comment">//要去替换的值</span>

    ctemplate<span class="token double-colon punctuation">::</span>TemplateDictionary <span class="token function">d</span><span class="token punctuation">(</span><span class="token string">"test"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//定义了一个名叫test的数据字典</span>
    d<span class="token punctuation">.</span><span class="token function">SetValue</span><span class="token punctuation">(</span><span class="token string">"key"</span><span class="token punctuation">,</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//给数据字典插入数据，把网页中的key替换成value值</span>

    <span class="token comment">//获取要被渲染的网页对象</span>
    ctemplate<span class="token double-colon punctuation">::</span>Template<span class="token operator">*</span> tpl<span class="token operator">=</span>ctemplate<span class="token double-colon punctuation">::</span><span class="token class-name">Template</span><span class="token double-colon punctuation">::</span><span class="token function">GetTemplate</span><span class="token punctuation">(</span>old_html<span class="token punctuation">,</span>ctemplate<span class="token double-colon punctuation">::</span>DO_NOT_STRIP<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//第一个参数是被渲染网页的路径加文件名</span>
	<span class="token comment">//第二个参数是选项，选择是否去除空格等，DO_NOT_STRIP表示保持原貌</span>

    <span class="token comment">//添加字典数据到网页，完成渲染</span>
    std<span class="token double-colon punctuation">::</span>string new_html<span class="token punctuation">;</span><span class="token comment">//保存渲染完成的结果</span>
    tpl<span class="token operator">-&gt;</span><span class="token function">Expand</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>new_html<span class="token punctuation">,</span><span class="token operator">&amp;</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//查看结果</span>
    std<span class="token double-colon punctuation">::</span>cout<span class="token operator">&lt;&lt;</span>new_html<span class="token operator">&lt;&lt;</span>std<span class="token double-colon punctuation">::</span>endl<span class="token punctuation">;</span>

    <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>编译时要添加-lctemlpate和-lpthread，因为库里面也用了原生线程库</p> 
<h3><a id="MySQL_workbench_1601"></a>MySQL workbench</h3> 
<p><strong>下载</strong><br> <img src="https://images2.imgbox.com/47/2c/BgY2i1np_o.png" alt="在这里插入图片描述"><br> 按照上面的步骤找到workbench，下载安装即可。</p> 
<p>安装好以后需要连接一下数据库，点击Databases的Connect to Databases…<br> <img src="https://images2.imgbox.com/0c/4f/NB155pu1_o.png" alt="在这里插入图片描述"><br> 填写上对应的信息点击ok即可<br> <img src="https://images2.imgbox.com/22/de/pOOLgWCb_o.png" alt="在这里插入图片描述"><br> 输入你oj_client用户的密码即可完成登录，注意要登录服务器的3306端口必须开放</p> 
<p>然后就可以正常使用该软件<br> <img src="https://images2.imgbox.com/51/1c/A0Qqujfe_o.png" alt="在这里插入图片描述"><br> 输入sql语句，点击上面的按钮执行就可以看待我的表，这里面显示的是我已经插好的一道题。</p> 
<p>要像插入或修改内容，可以选择某一行，然后点击Form Editor<br> <img src="https://images2.imgbox.com/26/f0/cSF4vKth_o.png" alt="在这里插入图片描述"><br> 就可以在框框里面编辑想要插入或修改的内容，完成只会点击apply，就可以把修改同步到数据库上，非常方便。</p> 
<h3><a id="mysqlconnectorc_1620"></a>mysql-connector-c</h3> 
<p><strong>下载</strong><br> <img src="https://images2.imgbox.com/88/cd/3AUdMaTi_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/0d/de/x6POiB0g_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d3/6b/h2MW71wO_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/6d/9d/bwOcvnq5_o.png" alt="在这里插入图片描述"><br> 通过上面的步骤，选择对应的版本下载然后上传到云服务器上就可以了。</p> 
<p><strong>安装使用</strong><br> 拿到压缩包以后，先解压安装包</p> 
<pre><code>tar xzf 安装包名
</code></pre> 
<p>然后在使用该库的项目路径下，建立对应的软连接</p> 
<pre><code>	ln -s ~/thirdpart/xxxxxx/include include
	ls -s ~/thirdpart/xxxxxx/lib lib
</code></pre> 
<p>直接使用库可能在编译时会导致找不到库，和ctemplate一样，要么带修改环境变量，要么待添加配置文件。上面已经说明了，这里就不再重复了。</p> 
<p>上面的工作都做完以后，还要注意编译时要添加三个选项：-I./include -L./lib -lmysqlclient</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/aaed9cc7ad2f266a20e65c205e087d14/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Elasticsearch写入性能、搜索速度调优</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f05af0a0eb2eff5404084289c1652a21/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">flink实时数仓 向hbase建立维度表跟添加数据 scala方式</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>