<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>UmiJS之路由 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="UmiJS之路由" />
<meta property="og:description" content="路由 umi 会根据pages目录自动生成路由配置。
约定式路由 基础路由 假设 pages 目录结构如下：
&#43; pages/ &#43; users/ - index.js - list.js - index.js 那么，umi 会自动生成路由配置如下：
[ { path: &#39;/&#39;, component: &#39;./pages/index.js&#39; }, { path: &#39;/users/&#39;, component: &#39;./pages/users/index.js&#39; }, { path: &#39;/users/list&#39;, component: &#39;./pages/users/list.js&#39; }, ] 动态路由 umi 里约定，带 $ 前缀的目录或文件为动态路由。
比如以下目录结构：
&#43; pages/ &#43; $post/ - index.js - comments.js &#43; users/ $id.js - index.js 会生成路由配置如下：
[ { path: &#39;/&#39;, component: &#39;./pages/index.js&#39; }, { path: &#39;/users/:id&#39;, component: &#39;." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b7c7d2f26181d12d3436878d5c3448cb/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-08-16T17:27:02+08:00" />
<meta property="article:modified_time" content="2019-08-16T17:27:02+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">UmiJS之路由</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-tomorrow-night-eighties">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h5><a id="_0"></a>路由</h5> 
<p>umi 会根据<code>pages</code>目录自动生成路由配置。</p> 
<h6><a id="_5"></a>约定式路由</h6> 
<h6><a id="_6"></a>基础路由</h6> 
<p>假设 <code>pages</code> 目录结构如下：</p> 
<pre><code>+ pages/
  + users/
    - index.js
    - list.js
  - index.js
</code></pre> 
<p>那么，umi 会自动生成路由配置如下：</p> 
<pre><code>[
  { path: '/', component: './pages/index.js' },
  { path: '/users/', component: './pages/users/index.js' },
  { path: '/users/list', component: './pages/users/list.js' },
]
</code></pre> 
<h6><a id="_23"></a>动态路由</h6> 
<p>umi 里约定，带 $ 前缀的目录或文件为动态路由。</p> 
<p>比如以下目录结构：</p> 
<pre><code>+ pages/
  + $post/
    - index.js
    - comments.js
  + users/
    $id.js
  - index.js
</code></pre> 
<p>会生成路由配置如下：</p> 
<pre><code>[
  { path: '/', component: './pages/index.js' },
  { path: '/users/:id', component: './pages/users/$id.js' },
  { path: '/:post/', component: './pages/$post/index.js' },
  { path: '/:post/comments', component: './pages/$post/comments.js' },
]
</code></pre> 
<h6><a id="_45"></a>可选的动态路由</h6> 
<p>umi 里约定动态路由如果带 $ 后缀，则为可选动态路由。</p> 
<p>比如以下结构：</p> 
<pre><code>+ pages/
  + users/
    - $id$.js
  - index.js
</code></pre> 
<p>会生成路由配置如下：</p> 
<pre><code>[
  { path: '/': component: './pages/index.js' },
  { path: '/users/:id?': component: './pages/users/$id$.js' },
]
</code></pre> 
<h6><a id="_62"></a>嵌套路由</h6> 
<p>umi 里约定目录下有<code>_layout.js</code> 时会生成嵌套路由，以<code>_layout.js</code>为该目录的 layout 。</p> 
<p>比如以下目录结构：</p> 
<pre><code>+ pages/
  + users/
    - _layout.js
    - $id.js
    - index.js
</code></pre> 
<p>会生成路由配置如下：</p> 
<pre><code>[
  { path: '/users', component: './pages/users/_layout.js',
    routes: [
     { path: '/users/', component: './pages/users/index.js' },
     { path: '/users/:id', component: './pages/users/$id.js' },
   ],
  },
]
</code></pre> 
<h6><a id="_layout_84"></a>全局 layout</h6> 
<p>约定 <code>src/layouts/index.js</code>为全局路由，返回一个 React 组件，通过 props.children 渲染子组件。</p> 
<p>比如：</p> 
<pre><code>export default function(props) {
  return (
    &lt;&gt;
      &lt;Header /&gt;
      { props.children }
      &lt;Footer /&gt;
    &lt;/&gt;
  );
}
</code></pre> 
<h6><a id="_layout_99"></a>不同的全局 layout</h6> 
<p>你可能需要针对不同路由输出不同的全局 layout，umi 不支持这样的配置，但你仍可以在 <code>layouts/index.js</code> 对 <code>location.path</code> 做区分，渲染不同的 layout 。</p> 
<p>比如想要针对 /login 输出简单布局，</p> 
<pre><code>export default function(props) {
  if (props.location.pathname === '/login') {
    return &lt;SimpleLayout&gt;{ props.children }&lt;/SimpleLayout&gt;
  }

  return (
    &lt;&gt;
      &lt;Header /&gt;
      { props.children }
      &lt;Footer /&gt;
    &lt;/&gt;
  );
}
</code></pre> 
<h6><a id="404__118"></a>404 路由</h6> 
<p>约定 pages/404.js 为 404 页面，需返回 React 组件。</p> 
<p>比如：</p> 
<pre><code>export default () =&gt; {
  return (
    &lt;div&gt;I am a customized 404 page&lt;/div&gt;
  );
};
</code></pre> 
<blockquote> 
 <p>注意：开发模式下，umi 会添加一个默认的 404 页面来辅助开发，但是我们仍然可通过精确地访问 /404 来验证 404 页面。</p> 
</blockquote> 
<h6><a id="_131"></a>通过注释扩展路由</h6> 
<p>约定路由文件的首个注释如果包含 yaml 格式的配置，则会被用于扩展路由。</p> 
<p>比如：</p> 
<pre><code>+ pages/
  - index.js
</code></pre> 
<p>如果 <code>pages/index.js</code> 里包含：</p> 
<pre><code>/**
 * title: Index Page
 * Routes:
 *   - ./src/routes/a.js
 *   - ./src/routes/b.js
 */
</code></pre> 
<p>则会生成路由配置：</p> 
<pre><code>[
  { path: '/', component: './index.js',
    title: 'Index Page',
    Routes: [ './src/routes/a.js', './src/routes/b.js' ],
  },
]
</code></pre> 
<h6><a id="_157"></a>配置式路由</h6> 
<p>如果你倾向于使用配置式的路由，可以配置<code>.umirc.(ts|js)</code>或者 <code>config/config.(ts|js)</code> 配置文件中的 routes 属性，此配置项存在时则不会对 <code>src/pages</code> 目录做约定式的解析。</p> 
<p>比如：</p> 
<pre><code>export default {
  routes: [
    { path: '/', component: './a' },
    { path: '/list', component: './b', Routes: ['./routes/PrivateRoute.js'] },
    { path: '/users', component: './users/_layout',
      routes: [
        { path: '/users/detail', component: './users/detail' },
        { path: '/users/:id', component: './users/id' }
      ]
    },
  ],
};
</code></pre> 
<p>注意：</p> 
<p>component 是相对于 <code>src/pages</code> 目录的</p> 
<h6><a id="_178"></a>权限路由</h6> 
<p>umi 的权限路由是通过配置路由的 Routes 属性来实现。约定式的通过 yaml 注释添加，配置式的直接配上即可。</p> 
<p>比如有以下配置：</p> 
<pre><code>[
  { path: '/', component: './pages/index.js' },
  { path: '/list', component: './pages/list.js', Routes: ['./routes/PrivateRoute.js'] },
]
</code></pre> 
<p>然后 umi 会用 <code>./routes/PrivateRoute.js</code> 来渲染 /list。</p> 
<p><code>./routes/PrivateRoute.js</code>文件示例：</p> 
<pre><code>export default (props) =&gt; {
  return (
    &lt;div&gt;
      &lt;div&gt;PrivateRoute (routes/PrivateRoute.js)&lt;/div&gt;
      { props.children }
    &lt;/div&gt;
  );
}
</code></pre> 
<h6><a id="_201"></a>路由动效</h6> 
<p>路由动效应该是有多种实现方式，这里举 <code>react-transition-group</code> 的例子。</p> 
<p>先安装依赖，</p> 
<pre><code>$ yarn add react-transition-group
</code></pre> 
<p>在 layout 组件（<code>layouts/index.js</code> 或者 pages 子目录下的 <code>_layout.js</code>）里在渲染子组件时用 TransitionGroup 和 CSSTransition 包裹一层，并以<code>location.pathname</code>为 key，</p> 
<pre><code>import withRouter from 'umi/withRouter';
import { TransitionGroup, CSSTransition } from "react-transition-group";

export default withRouter(
  ({ location }) =&gt;
    &lt;TransitionGroup&gt;
      &lt;CSSTransition key={location.pathname} classNames="fade" timeout={300}&gt;
        { children }
      &lt;/CSSTransition&gt;
    &lt;/TransitionGroup&gt;
)
</code></pre> 
<p>上面用到的 fade 样式，可以在 src 下的 global.css 里定义：</p> 
<pre><code>.fade-enter {
  opacity: 0;
  z-index: 1;
}

.fade-enter.fade-enter-active {
  opacity: 1;
  transition: opacity 250ms ease-in;
}
</code></pre> 
<h6><a id="_234"></a>面包屑</h6> 
<p>面包屑也是有多种实现方式，这里举 <code>react-router-breadcrumbs-hoc</code> 的例子。</p> 
<p>先安装依赖，</p> 
<pre><code>$ yarn add react-router-breadcrumbs-hoc
</code></pre> 
<p>然后实现一个 Breakcrumbs.js，比如：</p> 
<pre><code>import NavLink from 'umi/navlink';
import withBreadcrumbs from 'react-router-breadcrumbs-hoc';

// 更多配置请移步 https://github.com/icd2k3/react-router-breadcrumbs-hoc
const routes = [
  { path: '/', breadcrumb: '首页' },
  { path: '/list', breadcrumb: 'List Page' },
];

export default withBreadcrumbs(routes)(({ breadcrumbs }) =&gt; (
  &lt;div&gt;
    {breadcrumbs.map((breadcrumb, index) =&gt; (
      &lt;span key={breadcrumb.key}&gt;
        &lt;NavLink to={breadcrumb.props.match.url}&gt;
          {breadcrumb}
        &lt;/NavLink&gt;
        {(index &lt; breadcrumbs.length - 1) &amp;&amp; &lt;i&gt; / &lt;/i&gt;}
      &lt;/span&gt;
    ))}
  &lt;/div&gt;
));
</code></pre> 
<p>然后在需要的地方引入此 React 组件即可。</p> 
<h6><a id="_Hash__267"></a>启用 Hash 路由</h6> 
<p>umi 默认是用的 Browser History，如果要用 Hash History，需配置：</p> 
<pre><code>export default {
  history: 'hash',
}
</code></pre> 
<h6><a id="Scroll_to_top_274"></a>Scroll to top</h6> 
<p>在 layout 组件（<code>layouts/index.js</code>或者 pages 子目录下的 <code>_layout.js</code>）的 componentDidUpdate 里决定是否 scroll to top，比如：</p> 
<pre><code>import { Component } from 'react';
import withRouter from 'umi/withRouter';

class Layout extends Component {
  componentDidUpdate(prevProps) {
    if (this.props.location !== prevProps.location) {
      window.scrollTo(0, 0);
    }
  }
  render() {
    return this.props.children;
  }
}

export default withRouter(Layout);
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/a3d402020f9ad1c7d58941b163a969b8/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">vue cli3.0怎么回退到原来的版本</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/659e18caabfc1474eb0bb6635e59e281/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">IIS部署“不能在此路径中使用此配置节。如果在父级别上锁定了该节，便会出现这种情况”问题解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>