<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>微信小程序后台数据交互与wxs文件的介绍与使用 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="微信小程序后台数据交互与wxs文件的介绍与使用" />
<meta property="og:description" content="准备后台
后台源代码分享 。。 。。
ssm-oa.rar - 蓝奏云
前端测试代码分享
oa-mini.rar - 蓝奏云
前端发送请求封装
Promise
Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。
所谓Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，Promise 是一个对象，从它可以获取异步操作的消息。Promise 提供统一的 API，各种异步操作都可以用同样的方法进行处理。
promise运行中有三个状态： pending: 等待 (进行中) promise一创建出来，就是pending进行中fulfilled: 成功 (已完成), 调用 resolve, 就会将状态从pending改成fulfilled, 且将来就会执行.thenrejected: 失败 (拒绝), 调用 reject, 就会将状态从pending改成rejected, 且将来就会执行.catch注意点： 一旦promise的状态发生变化, 状态就会被凝固如果再调用reject或resolve,进行状态修改就没有意义了 准配请求接口地址
创建config/api.js
// 以下是业务服务器API地址 // 本机开发API地址 var WxApiRoot = &#39;http://localhost:8080/wx/&#39;; // 测试环境部署api地址 // var WxApiRoot = &#39;http://192.168.0.101:8070/demo/wx/&#39;; // 线上平台api地址 //var WxApiRoot = &#39;https://www.oa-mini.com/demo/wx/&#39;; module.exports = { IndexUrl: WxApiRoot &#43; &#39;home/index&#39;, //首页数据接口 SwiperImgs: WxApiRoot&#43;&#39;swiperImgs&#39;, MettingInfos: WxApiRoot&#43;&#39;meeting/list&#39;, AuthLoginByWeixin: WxApiRoot &#43; &#39;auth/login_by_weixin&#39;, //微信登录 UserIndex: WxApiRoot &#43; &#39;user/index&#39;, //个人页面用户相关信息 AuthLogout: WxApiRoot &#43; &#39;auth/logout&#39;, //账号登出 AuthBindPhone: WxApiRoot &#43; &#39;auth/bindPhone&#39; //绑定微信手机号 }; 封装request" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/4c161ba26bccd2c1131bd7dca2c0b4a8/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-01-10T12:48:39+08:00" />
<meta property="article:modified_time" content="2023-01-10T12:48:39+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">微信小程序后台数据交互与wxs文件的介绍与使用</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p><strong>准备后台</strong></p> 
<p>后台源代码分享 。。 。。</p> 
<p><a href="https://wwyp.lanzoul.com/isOJL0km62wd" rel="nofollow" title="ssm-oa.rar - 蓝奏云">ssm-oa.rar - 蓝奏云</a></p> 
<p>前端测试代码分享</p> 
<p><a href="https://wwyp.lanzoul.com/iOZss0km62xe" rel="nofollow" title="oa-mini.rar - 蓝奏云">oa-mini.rar - 蓝奏云</a></p> 
<p><strong>前端发送请求封装</strong></p> 
<p><strong>Promise</strong></p> 
<p>Promise 是异步编程的一种解决方案，比传统的解决方案——回调函数和事件——更合理和更强大。它由社区最早提出和实现，ES6 将其写进了语言标准，统一了用法，原生提供了Promise对象。</p> 
<p>所谓Promise，简单说就是一个容器，里面保存着某个未来才会结束的事件（通常是一个异步操作）的结果。从语法上说，Promise 是一个对象，从它可以获取异步操作的消息。Promise 提供统一的 API，各种异步操作都可以用同样的方法进行处理。</p> 
<ul><li>promise运行中有三个状态： 
  <ul><li>pending: 等待 (进行中) promise一创建出来，就是pending进行中</li><li>fulfilled: 成功 (已完成), 调用 resolve, 就会将状态从pending改成fulfilled, 且将来就会执行.then</li><li>rejected: 失败 (拒绝), 调用 reject, 就会将状态从pending改成rejected, 且将来就会执行.catch</li></ul></li><li>注意点： 
  <ul><li>一旦promise的状态发生变化, 状态就会被凝固</li><li>如果再调用reject或resolve,进行状态修改就没有意义了</li></ul></li></ul> 
<p><strong>准配请求接口地址</strong></p> 
<p>创建config/api.js</p> 
<p><img alt="" height="930" src="https://images2.imgbox.com/e7/e4/HuB4fvaW_o.png" width="1200"></p> 
<p> </p> 
<pre><code>// 以下是业务服务器API地址
 // 本机开发API地址
 var WxApiRoot = 'http://localhost:8080/wx/';
 // 测试环境部署api地址
 // var WxApiRoot = 'http://192.168.0.101:8070/demo/wx/';
 // 线上平台api地址
 //var WxApiRoot = 'https://www.oa-mini.com/demo/wx/';
 
 module.exports = {
  IndexUrl: WxApiRoot + 'home/index', //首页数据接口
  SwiperImgs: WxApiRoot+'swiperImgs',
  MettingInfos: WxApiRoot+'meeting/list',
  AuthLoginByWeixin: WxApiRoot + 'auth/login_by_weixin', //微信登录
  UserIndex: WxApiRoot + 'user/index', //个人页面用户相关信息
  AuthLogout: WxApiRoot + 'auth/logout', //账号登出
  AuthBindPhone: WxApiRoot + 'auth/bindPhone' //绑定微信手机号
 };</code></pre> 
<p><strong>封装request</strong></p> 
<p>在/utils/util.js中</p> 
<pre><code>/**
 * 封装微信的request请求
 */
function request(url, data = {}, method = "GET") {
  return new Promise(function (resolve, reject) {
    wx.request({
      url: url,
      data: data,
      method: method,
      header: {
        'Content-Type': 'application/json',
      },
      success: function (res) {
        if (res.statusCode == 200) {
            resolve(res.data);//会把进行中改变成已成功
        } else {
          reject(res.errMsg);//会把进行中改变成已失败
        }
      },
      fail: function (err) {
        reject(err)
      }
    })
  });
}</code></pre> 
<p><img alt="" height="917" src="https://images2.imgbox.com/88/4c/zcnXBKZn_o.png" width="1200"></p> 
<p> </p> 
<p><strong>发送请求</strong></p> 
<p>将方法在生命周期函数中使用 页面加载后看后台返回的数据</p> 
<p><img alt="" height="241" src="https://images2.imgbox.com/1e/57/j5jTjiXy_o.png" width="770"></p> 
<p> <img alt="" height="930" src="https://images2.imgbox.com/5c/33/ljKUGL9z_o.png" width="1200"></p> 
<p> </p> 
<p></p> 
<pre><code>loadMeetingInfos(){
    let that=this;
    // wx.request({
    //     url: api.MettingInfos,
    //     dataType: 'json',
    //     success(res) {
    //       console.log(res)
    //       that.setData({
    //           lists:res.data.lists
    //       })
    //     }
    //   })
    util.request(api.IndexUrl).then(res=&gt;{
        console.log(res))
      this.setData({
        lists:res.data.infoList
      })
    }).catch(res=&gt;{
        console.log('服器没有开启，使用模拟数据!')
    })
  }</code></pre> 
<p><strong>WXS模块的使用</strong></p> 
<p><a href="https://developers.weixin.qq.com/miniprogram/dev/reference/wxs/" rel="nofollow" title="微信官方文档地址">微信官方文档地址</a></p> 
<p><img alt="" height="267" src="https://images2.imgbox.com/2b/95/jcdDtFj4_o.png" width="190"></p> 
<p> </p> 
<p>index.wxml</p> 
<pre><code>&lt;view class="container"&gt;
&lt;view&gt;{<!-- -->{common.msg}}&lt;/view&gt;
&lt;view&gt;{<!-- -->{common.foo}}&lt;/view&gt;
&lt;view&gt;{<!-- -->{foo.value}}&lt;/view&gt;
&lt;/view&gt;
&lt;!-- module 当前 &lt;wxs&gt; 标签的模块名。必填字段。 --&gt;
&lt;!-- src 引用 .wxs 文件的相对路径。仅当本标签为单闭合标签或标签的内容为空时有效。 --&gt;
&lt;!-- 单标签 引入wxs文件--&gt;
&lt;wxs src="../wxs/common.wxs" module="common" /&gt;
&lt;!-- 双标签 --&gt;
&lt;wxs module="foo"&gt;
var common = require('../wxs/common.wxs')
// 在.wxs模块中引用其他 wxs 文件模块， 可以使用 require 函数。
module.exports = {
value: common.inArray([1, 2, 3], 1)
}
// 方法一：单行注释
/*
方法二：多行注释
//
方法三：结尾注释。即从 /* 开始往后的所有 WXS 代码均被注释
&lt;/wxs&gt;</code></pre> 
<p>index.wxss</p> 
<pre><code>.container{
height: 100vh;
display: flex;
flex-direction: column;
align-items: center;
justify-content: flex-start;
box-sizing: border-box;
background-color: rgb(240, 240, 240);
}</code></pre> 
<p>common.wxs</p> 
<pre><code>var foo="'hello world' from common.wxs"
//inArray方法  判断数组中是否存在某元素
function inArray(arr,val){
return arr.indexOf(val)&gt;-1
}
var msg="some msg"
//module 对象  每个 wxs 模块均有一个内置的 module 对象。
//属性  exports: 通过该属性，可以对外共享本模块的私有变量与函数。
module.exports={
foo:foo,
inArray:inArray
}
module.exports.msg=msg</code></pre> 
<p><img alt="" height="118" src="https://images2.imgbox.com/37/9f/AnwX3AKj_o.png" width="374"></p> 
<p> </p> 
<p><strong>WXS使用注意</strong></p> 
<p><strong>WXS 模块</strong></p> 
<p>WXS 代码可以编写在 wxml 文件中的 标签内，或以 .wxs 为后缀名的文件内。</p> 
<p><strong>模块</strong></p> 
<ul><li>每一个.wxs文件和 标签都是一个单独的模块。</li><li>每个模块都有自己独立的作用域。即在一个模块里面定义的变量与函数，默认为私有的，对其他模块不可见。</li><li>一个模块要想对外暴露其内部的私有变量与函数，只能通过module.exports实现。</li></ul> 
<p><strong>require函数</strong></p> 
<ul><li>在.wxs模块中引用其他 wxs 文件模块，可以使用 require 函数。</li><li>引用的时候，要注意如下几点：</li><li>只能引用 .wxs 文件模块，且必须使用相对路径。</li><li>wxs 模块均为单例，wxs 模块在第一次被引用时，会自动初始化为单例对象。多个页面，多个地方，多次引用，使用的都是同一个 wxs 模块对象。</li><li>如果一个 wxs 模块在定义之后，一直没有被引用，则该模块不会被解析与运行。</li></ul> 
<p><strong>&lt; wxs&gt; 标签</strong></p> 
<table border="1"><tbody><tr><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>属性名</p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>类型</p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>默认值</p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>说明</p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>module</p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>String</p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p></p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>当前 标签的模块名。必填字段。</p> </td></tr><tr><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>src</p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>String</p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p></p> </td><td colspan="1" rowspan="1" style="vertical-align:top;"> <p>引用 .wxs 文件的相对路径。仅当本标签为单闭合标签或标签的内容为空时有效。</p> </td></tr></tbody></table> 
<p><strong>module 属性</strong></p> 
<ul><li>module 属性是当前 &lt; wxs &gt; 标签的模块名。在单个 wxml 文件内，建议其值唯一。有重复模块名则按照先后顺序覆盖（后者覆盖前者）。不同文件之间的 wxs 模块名不会相互覆盖。</li><li>module 属性值的命名必须符合下面两个规则：</li></ul> 
<p>首字符必须是：字母（a-zA-Z），下划线（<strong>）</strong></p> 
<p><strong>剩余字符可以是：字母（a-zA-Z），下划线（</strong>）， 数字（0-9）</p> 
<p><strong>src 属性</strong></p> 
<ul><li>src 属性可以用来引用其他的 wxs 文件模块。</li><li>引用的时候，要注意如下几点：</li></ul> 
<p>只能引用 .wxs 文件模块，且必须使用相对路径。</p> 
<p>wxs 模块均为单例，wxs 模块在第一次被引用时，会自动初始化为单例对象。多个页面，多个地方，多次引用，使用的都是同一个 wxs 模块对象。</p> 
<p>如果一个 wxs 模块在定义之后，一直没有被引用，则该模块不会被解析与运行。</p> 
<p><strong>注意</strong></p> 
<ul><li>&lt; wxs &gt; 模块只能在定义模块的 WXML 文件中被访问到。使用 或 时， 模块不会被引入到对应的 WXML 文件中。</li><li>&lt; template&gt; 标签中，只能使用定义该 &lt; template&gt; 的 WXML 文件中定义的 &lt; wxs&gt; 模块。</li></ul> 
<p><strong>变量</strong></p> 
<p>概念</p> 
<p>不支持 let const</p> 
<p>WXS 中的变量均为值的引用。</p> 
<p>没有声明的变量直接赋值使用，会被定义为全局变量。</p> 
<p>如果只声明变量而不赋值，则默认值为 undefined。</p> 
<p>var表现与javascript一致，会有变量提升。</p> 
<pre><code>var foo = 1
;var bar = "hello world";
var i; // i === undefined</code></pre> 
<p>上面代码，分别声明了 foo、 bar、 i 三个变量。然后，foo 赋值为数值 1 ，bar 赋值为字符串 “hello world”。</p> 
<p>变量名</p> 
<ul><li>变量命名必须符合下面两个规则：</li><li>首字符必须是：字母（a-zA-Z），下划线（）</li></ul> 
<p>剩余字符可以是：字母（a-zA-Z），下划线（）， 数字（0-9）</p> 
<p>保留标识符</p> 
<p>以下标识符不能作为变量名：</p> 
<pre><code>delete
void
typeof
null
undefined
NaN
Infinity
var
if
else
true
false
require
this
function
arguments
return
for
while
do
break
continue
switch
case
default</code></pre> 
<p><strong>注释</strong></p> 
<pre><code>&lt;!-- wxml --&gt;
&lt;wxs module="sample"&gt;
// 方法一：单行注释
/*
方法二：多行注释
//
方法三：结尾注释。即从 /* 开始往后的所有 WXS 代码均被注释
var a = 1;
var b = 2;
var c = "fake";
&lt;/wxs&gt;</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/9fb3a0b4f7c768fed1b902dde266a5a3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C语言基础一小时复习</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/8f229a586bf8b463774aaae95abea701/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">【简单粗暴】Python导入cv2包</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>