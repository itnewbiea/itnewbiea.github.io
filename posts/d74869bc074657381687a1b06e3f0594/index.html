<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Lamp——mysql组复制协议（全同步机制） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Lamp——mysql组复制协议（全同步机制）" />
<meta property="og:description" content="mysql组复制协议（全同步机制） 搭建MySQL集群，实现组复制成员故障 ** 默认MySQL主从复制方式是异步的，after_commit模式和after_sync模式是半同步方式。**
同步方式复制对数据一致性要求高，速度最慢。
同步方式的部署分为单主模式和多主模式。
多主模式是每个节点都可以对数据写，单主模式是只能master写数据。mysql的主从复制是单主模式，salve不可以对数据写。
当集群中的任何节点在执行的时候，都会将日志发送到集群中所有节点上，然后开始校验。只要有一个节点校验不通过，那么所有节点都不做该操作。
MySQL集群，基于组复制技术，每个节点即是主又是从，每个节点都可以主从复制
实验环境：
server5上安装了MHA管理器，关闭server5.
server2、server3和server4构成MySQL集群。server2为引导节点。
可以根据官方文档进行。
搭建MySQL集群，实现组复制 server3关闭mysqld
server4关闭mysqld
server2关闭mysqld：
将mysql的数据文件清空。（至于数据文件在哪个目录，可以查看/etc/my.cnf中的datadir）
并编写主配置文件
将虚拟机上的mysql卸载，重装了一次，发现 /etc 下没有 my.cnf 文件 !!!
使用mysql --help | grep my.cnf
可以查看到mysql 是从哪些目录读取配置文件的，然后自己 vim my.cnf 并将自己写的 my.cnf 文件放到这个目录中，重启mysql就可以识别自己的配置文件了。
在重启mysql服务之前，一定要确认mysql的数据文件目录是空的。
重启服务之后，进行初始化
server2为引导节点
将server2上的配置文件传到server3上
先将server3的mysqld关闭，并把mysqld的数据文件目录清空。
MySQL初始化
server2为引导节点，server3只需开启组复制即可。
设置server3强制加入
在server2上可以看到集群中成员的状态。
如果看到某个成员，比如server3的状态是RECOVERING，
那么就要查看serve3的日志，cat /var/log/mysqld.log
在做实验的时候，有一次server3的状态是RECOVERING，查看日志，发现是server3和server2上的域名解析没写对。将/etc/hosts文件写正确就好了。
server2将配置文件传给server4
同样地，server4先将mysql服务关闭，并数据文件目录清空。
server4的my.cnf 因为是直接从server2复制来的，直接修改server-id 以及local_address就好
在最后加上，强制加入集群
vim /etc/my.cnf
在server2上查看到集群成员的状态为online
在server2上创建数据库test，并在test中创建表t1，并插入一条数据。
在server3上可以同步到server2上的数据，查看到数据库test，
server3也可以对数据进行写操作
server4上可以读取到server2与server3写的数据
同时，server4也可以写数据
server2上也可以看到server3和server4上写的数据
成员故障 这时，server2突然down。。。
server3看到只有server4和自己是online。
server3再向数据库中写入数据" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d74869bc074657381687a1b06e3f0594/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-30T10:53:38+08:00" />
<meta property="article:modified_time" content="2022-04-30T10:53:38+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Lamp——mysql组复制协议（全同步机制）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>mysql组复制协议（全同步机制）</h4> 
 <ul><li><a href="#MySQL_26" rel="nofollow">搭建MySQL集群，实现组复制</a></li><li><a href="#_90" rel="nofollow">成员故障</a></li></ul> 
</div> 
<p></p> 
<hr> 
<blockquote> 
 <p>** 默认MySQL主从复制方式是异步的，after_commit模式和after_sync模式是半同步方式。**<br> 同步方式复制对数据一致性要求高，速度最慢。<br> <strong>同步方式的部署分为单主模式和多主模式。</strong><br> 多主模式是每个节点都可以对数据写，单主模式是只能master写数据。mysql的主从复制是单主模式，salve不可以对数据写。</p> 
</blockquote> 
<p>当集群中的任何节点在执行的时候，都会将日志发送到集群中所有节点上，然后开始校验。只要有一个节点校验不通过，那么所有节点都不做该操作。</p> 
<p><img src="https://images2.imgbox.com/59/90/NmqYo4mR_o.png" alt="在这里插入图片描述"></p> 
<p><strong>MySQL集群，基于组复制技术，每个节点即是主又是从，每个节点都可以主从复制</strong></p> 
<p>实验环境：<br> server5上安装了MHA管理器，关闭server5.<br> server2、server3和server4构成MySQL集群。server2为引导节点。</p> 
<p>可以根据官方文档进行。<br> <img src="https://images2.imgbox.com/ab/81/EhR7OXE9_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="MySQL_26"></a>搭建MySQL集群，实现组复制</h2> 
<p>server3关闭mysqld</p> 
<p><img src="https://images2.imgbox.com/8f/89/Vqckokha_o.png" alt="在这里插入图片描述">server4关闭mysqld<br> <img src="https://images2.imgbox.com/7a/a1/7NyanfFD_o.png" alt="在这里插入图片描述"><br> server2关闭mysqld：<br> 将mysql的数据文件清空。（至于数据文件在哪个目录，可以查看/etc/my.cnf中的datadir）<br> 并编写主配置文件<br> <img src="https://images2.imgbox.com/f9/aa/wPOIOzjn_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/d7/e8/Efe7PV94_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p><strong>将虚拟机上的mysql卸载，重装了一次，发现 /etc 下没有 my.cnf 文件</strong> !!!<br> 使用mysql --help | grep my.cnf<br> 可以查看到mysql 是从哪些目录读取配置文件的，然后自己 vim my.cnf 并将自己写的 my.cnf 文件放到这个目录中，重启mysql就可以识别自己的配置文件了。</p> 
</blockquote> 
<p><img src="https://images2.imgbox.com/6c/c1/1uFm9JTc_o.png" alt="在这里插入图片描述"><br> <strong>在重启mysql服务之前，一定要确认mysql的数据文件目录是空的。</strong><br> 重启服务之后，进行初始化<br> <img src="https://images2.imgbox.com/93/87/ySVnLKrt_o.png" alt="在这里插入图片描述"><br> server2为引导节点</p> 
<p><img src="https://images2.imgbox.com/dc/86/YjFFOxWw_o.png" alt="在这里插入图片描述">将server2上的配置文件传到server3上<br> <img src="https://images2.imgbox.com/1e/8e/ohlNjjmD_o.png" alt="在这里插入图片描述"><br> 先将server3的mysqld关闭，并把mysqld的数据文件目录清空。<br> <img src="https://images2.imgbox.com/d5/ef/CMOBMK6i_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/16/e5/4gUn3zOr_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/81/e9/gz0ndgPP_o.png" alt="在这里插入图片描述">MySQL初始化<br> <img src="https://images2.imgbox.com/b7/bc/7a7Frotc_o.png" alt="在这里插入图片描述"><br> server2为引导节点，server3只需开启组复制即可。<br> <img src="https://images2.imgbox.com/46/4b/9mCnINjB_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/67/b0/grS1m7tj_o.png" alt="在这里插入图片描述"><br> 设置server3强制加入<br> <img src="https://images2.imgbox.com/f1/e1/5q4st02N_o.png" alt="在这里插入图片描述"><br> <img src="https://images2.imgbox.com/f8/14/oejZXXnh_o.png" alt="在这里插入图片描述"><br> 在server2上可以看到集群中成员的状态。<br> 如果看到某个成员，比如server3的状态是RECOVERING，<br> 那么就要查看serve3的日志，cat /var/log/mysqld.log<br> 在做实验的时候，有一次server3的状态是RECOVERING，查看日志，发现是server3和server2上的域名解析没写对。将/etc/hosts文件写正确就好了。<br> <img src="https://images2.imgbox.com/4b/c5/KEF5CeON_o.png" alt="在这里插入图片描述"><br> server2将配置文件传给server4<br> <img src="https://images2.imgbox.com/fe/14/FbTyQHRX_o.png" alt="在这里插入图片描述">同样地，server4先将mysql服务关闭，并数据文件目录清空。<br> <img src="https://images2.imgbox.com/29/94/RX5osfyz_o.png" alt="在这里插入图片描述"><br> server4的my.cnf 因为是直接从server2复制来的，直接修改server-id 以及local_address就好<br> 在最后加上，强制加入集群<br> vim /etc/my.cnf<br> <img src="https://images2.imgbox.com/25/7d/luKXV0I7_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/38/92/wIg2czZE_o.png" alt="在这里插入图片描述"><br> 在server2上查看到集群成员的状态为online</p> 
<p><img src="https://images2.imgbox.com/73/b9/tweaEvRK_o.png" alt="在这里插入图片描述"><br> 在server2上创建数据库test，并在test中创建表t1，并插入一条数据。<br> <img src="https://images2.imgbox.com/20/9a/cpti4axx_o.png" alt="在这里插入图片描述"></p> 
<p>在server3上可以同步到server2上的数据，查看到数据库test，<br> server3也可以对数据进行写操作</p> 
<p><img src="https://images2.imgbox.com/93/98/kP82opD0_o.png" alt="在这里插入图片描述"><br> server4上可以读取到server2与server3写的数据<br> 同时，server4也可以写数据<br> <img src="https://images2.imgbox.com/6a/81/8s2E4Hoo_o.png" alt="在这里插入图片描述"><br> server2上也可以看到server3和server4上写的数据</p> 
<p><img src="https://images2.imgbox.com/f6/53/GrMEW710_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_90"></a>成员故障</h2> 
<p>这时，server2突然down。。。</p> 
<p><img src="https://images2.imgbox.com/df/b2/LRs18Tyi_o.png" alt="在这里插入图片描述"><br> server3看到只有server4和自己是online。<br> server3再向数据库中写入数据<br> <img src="https://images2.imgbox.com/4b/b6/hEKkjgAR_o.png" alt="在这里插入图片描述">server4还是能查看到数据的更改。<br> <img src="https://images2.imgbox.com/00/96/fLYNArU7_o.png" alt="在这里插入图片描述"><br> server2恢复<br> 需要重新加入组复制<br> 并且server2能查看到自己down时，数据发生的更改。<br> <img src="https://images2.imgbox.com/6b/42/FiriF8jd_o.png" alt="在这里插入图片描述"><br> 集群中的成员能及时查看成员状态。<br> <img src="https://images2.imgbox.com/b7/21/uY4emLfC_o.png" alt="在这里插入图片描述"><br> server2、server3、server4构成一个MySQL集群，该集群中每个成员既是主又是从，每个成员都可以主从复制。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/922256d06de601808acfb14b55946cd7/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">正则匹配yyyy-mm-dd以及数字千分位详解</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/7150341fd518aac31741e2fda10ff87b/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">element-ui分页器设置每一页显示数量(page-size)后页码没有发生变化原因与解决</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>