<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>闭包与作用域再次深究 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="闭包与作用域再次深究" />
<meta property="og:description" content="最近看到一个有意思的函数
function test (arr) { var temp = [] for (var i =0; i&lt;arr.length; i&#43;&#43;) { (function() { var j = i; temp[i] = function () { return j } })() } return temp }　那么以下的结果会打印出什么呢？
var arr = [1,2,3,4,5] var arrFn = test(arr) console.log(arrFn[0])　结果是：0；
那么继续test函数换成以下两种又会是什么结果呢？
function test2 (arr) { var temp = [] for (var i =0; i&lt;arr.length; i&#43;&#43;) { temp[i] = function () { return i } } return temp } function test3 (arr) { var temp = [] for (var i =0; i&lt;arr." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6822550bab8476d83df5c24cbb292927/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-09-23T21:36:00+08:00" />
<meta property="article:modified_time" content="2019-09-23T21:36:00+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">闭包与作用域再次深究</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <div id="cnblogs_post_body" class="blogpost-body"> 
 <p>最近看到一个有意思的函数</p> 
 <div class="cnblogs_Highlighter"> 
  <pre><code class="language-csharp">        function test (arr) {
            var temp = []
            for (var i =0;  i&lt;arr.length; i++) {
                (function() {
                    var j = i;
                    temp[i] = function () {
                        return j
                    }
                })()
                
            }
            return temp
        }　　</code></pre> 
 </div> 
 <p>那么以下的结果会打印出什么呢？</p> 
 <div class="cnblogs_Highlighter"> 
  <pre><code class="language-csharp">var arr = [1,2,3,4,5]
var arrFn = test(arr)
console.log(arrFn[0])　　</code></pre> 
 </div> 
 <p>结果是：0；</p> 
 <p>那么继续test函数换成以下两种又会是什么结果呢？</p> 
 <div class="cnblogs_Highlighter"> 
  <pre><code class="language-csharp">        function test2 (arr) {
            var temp = []
            for (var i =0;  i&lt;arr.length; i++) {
                
                temp[i] = function () {
                    return i
                }
                
            }
            return temp
        }</code></pre> 
 </div> 
 <div class="cnblogs_Highlighter"> 
  <pre><code class="language-csharp">        function test3 (arr) {
            var temp = []
            for (var i =0;  i&lt;arr.length; i++) {
                (function() {
                    temp[i] = function () {
                        return i
                    }
                })()
                
            }
            return temp
        }</code></pre> 
 </div> 
 <p>test2是网上比较常见的，结果是我们在读取i的时候，i已经全部变为5；test3和test只有两行代码不同，但是结果却完全不一样。</p> 
 <p>之前曾经理解是因为我们调用的时候for循环已经执行完，所以会拿到i为5。但是其实这只是表象，最核心的其实只有一句话：</p> 
 <p><strong>闭包通过引用而不是值（非引用）来获取他们外部的变量</strong></p> 
 <p>因为是引用类型，所以在for执行完之后，i变为了5，引用类型也就继而变为5.</p> 
 <p>在test中添加了一行可以验证的代码就是：</p> 
 <div class="cnblogs_Highlighter"> 
  <pre><code class="language-csharp">var j = i;</code></pre> 
 </div> 
 <p>通过在局部作用域声明非引用类型，将单次循环是的引用类型保存下来，那么就能获取我们想要的结果了。</p> 
 <p>还有其他方法，通过自执行函数传递参数，将引用类型变为非引用类型都是一个原理：</p> 
 <div class="cnblogs_Highlighter"> 
  <pre><code class="language-csharp">        function test4 (arr) {
            var temp = []
            for (var i =0;  i&lt;arr.length; i++) {
                (function(j) {
                    temp[i] = function () {
                        return j;
                    }
                })(i)
                
            }
            return temp
        }　　</code></pre> 
 </div> 
 <p><strong>其次就是在IIFE来创建局部作用域的时候，需要注意不能再作用域外部使用break与continue，这样的写法是不合法的。</strong></p> 
 <p> </p> 
</div> 
<p>转载于:https://www.cnblogs.com/pomelott/p/11575027.html</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/6cb58fda65ed318eb12febc7a19ed0bb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Java中文乱码字符集解决大全-(转)阿童沐</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/d58b08cf3d3c71041904413245433394/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">中国最顶级的一批程序员，从首富到首负！</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>