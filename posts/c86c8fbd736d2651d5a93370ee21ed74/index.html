<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>基于layui2和thinkphp5项目开发心得记录（一） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="基于layui2和thinkphp5项目开发心得记录（一）" />
<meta property="og:description" content="写这系列的文章目的无他，仅仅是用以记录自己写项目的一些思路和心得，在开发过程中代码是以实现为首要目的，写得并不会非常美观实用，代码会在后期不断调试更改，文章也会进行不定期更新。未经作者允许请勿转载。
最新更新：2018/7/26
功能需求：选取页面表格信息，批量生成word文件 相关技术点
前端layui表格的数据显示与后台json接口页面与页面之间的参数传递，页面与后台之间的参数传递php批量生成word文件（数组循环遍历、字符串与数组转化、js中window.location.search的用法和作用。）html样式对word影响浏览器文件下载 首先是用一个layui表格对数据进行展示，html页面写个table标签，给个id
&lt;table class=&#34;layui-table&#34; id=&#34;projtb&#34; lay-filter=&#34;filtertb&#34;&gt;&lt;/table&gt; 按照layui框架的规则，在JS中对表格的表头值进行规定，field是与数据库对应的字段值，title是表格的表头
layui.use(&#39;table&#39;, function(){ var table = layui.table; //表格列表 var show_col=[[ {type:&#39;checkbox&#39;, fixed: &#39;left&#39;} ,{field:&#39;id&#39;,width:85, sort: &#39;true&#39;, title: &#39;ID&#39;,style:&#34;font-size:10px;&#34;} ,{field:&#39;name&#39;,width:180, sort: &#39;true&#39;, title: &#39;名称&#39;,style:&#34;font-size:12px&#34;} ,{field:&#39;desc&#39;, width:180, sort: &#39;true&#39; , title: &#39;备注&#39;,style:&#34;font-size:12px&#34;} ,{field:&#39;is_on_duty&#39; ,width:140,sort: &#39;true&#39;, title: &#39;是否管理&#39;,style:&#34;font-size:12px&#34;} ,{field:&#39;status&#39;, width:94, sort: &#39;true&#39; , title: &#39;状态&#39;,style:&#34;font-size:12px&#34;} ,{fixed:&#39;right&#39;, width:114, align:&#39;center&#39;, toolbar: &#39;#op-bar&#39; , title: &#39;操作&#39;,style:&#34;font-size:12px&#34;} ]]; //表格属性 var options={ elem: &#39;#projtb&#39; ,height: 315 ,url: &#39; &#39; //数据接口 ,page: true //开启分页 ,cols: show_col } //渲染 table." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/c86c8fbd736d2651d5a93370ee21ed74/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-07-23T16:10:11+08:00" />
<meta property="article:modified_time" content="2018-07-23T16:10:11+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">基于layui2和thinkphp5项目开发心得记录（一）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <blockquote> 
 <p>写这系列的文章目的无他，仅仅是用以记录自己写项目的一些思路和心得，在开发过程中代码是以实现为首要目的，写得并不会非常美观实用，代码会在后期不断调试更改，<strong>文章也会进行不定期更新。未经作者允许请勿转载。</strong></p> 
 <p><strong>最新更新：2018/7/26</strong></p> 
</blockquote> 
<p><strong>功能需求：选取页面表格信息，批量生成word文件</strong> </p> 
<p>相关技术点</p> 
<ul><li>前端layui表格的数据显示与后台json接口</li><li>页面与页面之间的参数传递，页面与后台之间的参数传递</li><li>php批量生成word文件（数组循环遍历、字符串与数组转化、js中window.location.search的用法和作用。）</li><li>html样式对word影响</li><li>浏览器文件下载</li></ul> 
<p>首先是用一个layui表格对数据进行展示，html页面写个table标签，给个id</p> 
<pre class="has"><code class="language-html">&lt;table class="layui-table"  id="projtb"  lay-filter="filtertb"&gt;&lt;/table&gt;
</code></pre> 
<p> 按照layui框架的规则，在JS中对表格的表头值进行规定，field是与数据库对应的字段值，title是表格的表头</p> 
<pre class="has"><code class="language-javascript">layui.use('table', function(){
  var table = layui.table;
  
  //表格列表
  var show_col=[[
            {type:'checkbox', fixed: 'left'}
            ,{field:'id',width:85, sort: 'true',  title: 'ID',style:"font-size:10px;"}
            ,{field:'name',width:180, sort: 'true',  title: '名称',style:"font-size:12px"}
            ,{field:'desc', width:180, sort: 'true' , title: '备注',style:"font-size:12px"}
            ,{field:'is_on_duty' ,width:140,sort: 'true', title: '是否管理',style:"font-size:12px"}
            ,{field:'status', width:94, sort: 'true' , title: '状态',style:"font-size:12px"}
            ,{fixed:'right', width:114, align:'center', toolbar: '#op-bar' , title: '操作',style:"font-size:12px"}
        ]];

  //表格属性
  var options={
    elem: '#projtb'
    ,height: 315
    ,url: ' '     //数据接口
    ,page: true     //开启分页
    ,cols: show_col
  }
 
  //渲染
  table.render(options);
  
});</code></pre> 
<p>请求后台接口，对表格数据进行渲染。数据来源都是从服务器上的数据库获取，感觉刚上手thinkphp5框架，对数据库的操作还是蛮顺手的。接口以json形式返回。注意layui表格的接口数据有它自己的默认规则（除非是自己定义返回的数据格式），如果只按照自己后台数据去定义json，会导致页面报错说接口异常，或者表格一片空白。<a href="http://www.layui.com/doc/modules/table.html" rel="nofollow">默认接口数据格式以及自定义数据格式的官方文档传送门</a></p> 
<pre class="has"><code class="language-php">/*数据接口*/
    public function getDeptList($keyword = '', $page = 1,$limit=20)
    {
        $map = [];
        if ($keyword) {
            $map['name'] = ['like', "%{$keyword}%"];
        }
        $dept_list_query = $this-&gt;dept_model-&gt;where($map)-&gt;order('id Asc')-&gt;paginate($limit, false, ['page' =&gt; $page]);
        $dept_list_arr = $dept_list_query-&gt;toArray();
        //json数组
        $arr = array();
        $arr['code'] = 0;
        $arr['msg'] = "";
        $arr['count'] = $dept_list_arr['total'];
        $arr['per_page'] = $dept_list_arr['per_page'];
        $arr['current_page'] = $dept_list_arr['current_page'];
        $arr['data'] = $dept_list_arr['data'];
        $arr_json = json($arr);
        return $arr_json;

    }

/* 默认接收的数据格式
    {
      code: 0,
      msg: "",
      count: 1000,
      data: []
    } 
*/</code></pre> 
<p>功能的流程大概思路是：选取需要生成word的项目，勾选第一列的复选框，然后点击页面的生成按钮，弹出一个窗口，进行模板选择（因为需求中有三个word模板），选择了模板之后，跳转新的页面，将生成的doc的链接展示出来，供用户点击下载。</p> 
<p>流程清楚之后，接下来就是数据问题了，首先要获取到所选取的那些项目的对应id，还有模板选择那个页面的模板id，一起传进后台控制里的生成word的函数。因为在经过了两个前端html页面这些参数才传到后台，所以打算把第一个页面的项目id以数组的形式，利用url传参方式get到第二个模板选择页面，然后在第二个页面利用js中window.location.search获取到第一个页面传过来的项目id，再将项目id和模板id一起传入后台。</p> 
<p>那么第一个页面如何获取到项目id呢？利用layui的表格监听，将用户勾选的每一条项目对应的数据存起来。再利用循环，将每条项目的项目id取出来存到一个新的数组，这个数组就是需要传到下一个页面的参数，里面包含了用户勾选到的项目的id，不说那么多，直接上代码。</p> 
<pre class="has"><code class="language-html">&lt;!--第一个页面的生成按钮，点击后将打开弹窗（模板选择），并且将项目id传到下弹窗页面--&gt;
&lt;button class="layui-btn layui-btn-mini layui-bg-red" data-type="exportWords"&gt;生成文档&lt;/button&gt;</code></pre> 
<pre class="has"><code class="language-javascript">    //JS代码
    layui.use(['form', 'layer'], function(){
        var $ = layui.jquery,
                layer = layui.layer,
                table = layui.table;

        //监听表格复选框选择
        table.on('checkbox(filtertb)', function(obj){
            var checkStatus = table.checkStatus('projtb');
            //将用户勾选的项目对应数据存起来
            clicked_project = checkStatus.data;
            //console.log(clicked_project);
        });

        var active = {
            //点击事件绑定
            exportWords:function () {
                //获取勾选的项目id，存入一个新数组，传入生成文档的子窗口
                var selected_project=new Array();
                for(var i=0;i&lt;clicked_project.length;i++){
                    selected_project.push(clicked_project[i].id);
                }
                //检查是否有选择项目，没有选择的话要弹窗提示用户选择
                if(selected_project.length&gt;0)
                {
                    layer.open({
                        shade: [0.8,'#000'],
                        shadeClose: true,
                        title: '请选择您要导出的模板文件',
                        type: 2,
                        area: ['460px', '500px'],
                        //向下个页面传入参数(已勾选的项目id)
                        content: '/chooseWordTemplate?pid='+selected_project,
                        btn: ['确定','取消']
                    });
                }else
                    {
                        layer.alert("您尚未选择需要导出word的项目！");
                    }

            }
        };

        //按钮触发
        $('.layui-btn').on('click', function(){
            var type = $(this).data('type');
            active[type] ? active[type].call(this) : '';
        });

    });</code></pre> 
<pre class="has"><code class="language-php">    /*
     * 控制器
     * 导出word模板选择
     * */
    public function chooseWordTemplate()
    {
        return $this-&gt;fetch('chooseWordTemplate');
    }</code></pre> 
<p>点击按钮之后，打开如下弹窗，进行模板选择</p> 
<p><img alt="" class="has" height="364" src="https://images2.imgbox.com/2b/13/0JZtd2h2_o.png" width="338"></p> 
<p>这是一个新的页面，就三个按钮，对应三个模板，利用data-type属性对每个按钮进行事件绑定</p> 
<pre class="has"><code class="language-html">&lt;body&gt;
    &lt;div class="layui-layer-content"&gt;
        &lt;ul class="site-dir layui-layer-wrap" style="display:block;overflow:hidden"&gt;
            &lt;li&gt; &lt;button class="layui-btn layui-btn-radius" data-type="template1"&gt;****表&lt;/button&gt;&lt;/li&gt;
            &lt;li&gt; &lt;button class="layui-btn layui-btn-radius layui-btn-normal" data-type="template2"&gt;****表&lt;/button&gt;&lt;/li&gt;
            &lt;li&gt; &lt;button class="layui-btn layui-btn-radius layui-btn-warm" data-type="template3"&gt;****表&lt;/button&gt;&lt;/li&gt;
        &lt;/ul&gt;
    &lt;/div&gt;

    &lt;script&gt;
        layui.use(['form', 'layer'], function(){
            var $ = layui.jquery;
            //获取上一个页面传过来的pid参数,与当前页面的tep参数一起传到后台
            var url_pid = window.location.search;
            //console.log(url_pid);    //?pid=400,401,370
            var active= {
                template1:function ()
                {
                    layer.load(1);    //跳转空隙时加载lodaing
                    window.location.href='__ROOT__/admin/project/project2word'+url_pid+'&amp;tep=1';
                },
                template2:function ()
                {
                    layer.load(1);
                    window.location.href='__ROOT__/admin/project/project2word'+url_pid+'&amp;tep=2';
                },
                template3:function ()
                {
                    layer.load(1);
                    window.location.href='__ROOT__/admin/project/project2word'+url_pid+'&amp;tep=3';
                }
            };

            $('.layui-btn').on('click', function(){
                var type = $(this).data('type');
                active[type] ? active[type].call(this) : '';
            });


        });
    &lt;/script&gt;

&lt;/body&gt;</code></pre> 
<p>到此前台部分就完成了。选择模板之后，此时会往后台传入项目id的数组和模板id。控制器方法获取到项目id和模板id之后，便可以着手开始生成word模板了，在这所谓的生成word，其实说白了就是先写好模板的html表格代码，赋值到一个变量中，然后写入文件中，以doc为后缀进行保存。接下来就是批量生成的问题，因为前台传过来的项目id有很多个，而且是字符串，因此要先取出来，将每一个id存进数组里面，再利用foreach循环数组，查询每一个id对应的数据，然后赋值到模板，写入文件，保存，最后echo出链接，大概就是这么一个思路。下面是控制器代码：</p> 
<pre class="has"><code class="language-php">    /*
     * 将项目导出至word，文件存放位置public\uploads\Word文件夹
     * $pid勾选项目的id值，$tep选择需要导出的Word模板id
     * */
    public function project2word($pid,$tep){
        $word = new word;
        //取出pid将其转成数组，进行循环遍历
        $pidArray = explode(",",$pid);
        echo
        "&lt;p style='text-align: center'&gt;生成完毕！请点击下载&lt;/p&gt; ";
        foreach ($pidArray as $value)
        {
            $item = $this-&gt;getProject($value)-&gt;toArray();
            /*表一*/
            $data1 = '&lt;html xmlns:o="urn:schemas-microsoft-com:office:office"
//xmlns:w="urn:schemas-microsoft-com:office:word"
//xmlns="http://www.w3.org/TR/REC-html40"&gt;
&lt;head&gt;
	&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8" /&gt;
	&lt;xml&gt;&lt;w:WordDocument&gt;&lt;w:View&gt;Print&lt;/w:View&gt;&lt;/xml&gt;
	&lt;title&gt;表一&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
	&lt;center&gt;&lt;h2&gt;****表&lt;/h2&gt;&lt;/center&gt;
	&lt;center&gt;
	&lt;table border="1" cellspacing="0" width="660"&gt;
		&lt;tr height="40"&gt;
			&lt;td align="center" width="150"&gt;项目名称&lt;/td&gt;
			&lt;td colspan="3" align="center"&gt;'.$item['name'].'&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr height="40"&gt;
			&lt;td align="center" width="150"&gt;预算金额（元）&lt;/td&gt;
			&lt;td align="center"&gt;'.$item['budget_total'].'&lt;/td&gt;
			&lt;td align="center" width="150"&gt;申请部门&lt;/td&gt;
			&lt;td align="center"&gt;'.$item['dept_name'].'&lt;/td&gt;
		&lt;/tr&gt;
		&lt;tr height="40"&gt;
			&lt;td align="center"&gt;备注&lt;/td&gt;
			&lt;td colspan="3"&gt;&lt;/td&gt;
		&lt;/tr&gt;
	&lt;/table&gt;
	&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;';

        /*表二类似，代码省略*/
        $data2 = '';

        /*表三类似，代码省略*/
        $data3 = '';

            //以每天的日期为一个文件夹，当天生成的word会全部存在一个以日期命名的文件夹中
            $str = date('Ymd');
            //查询文件夹是否已经存在，如果不存在则创建
            $targetFolder = iconv("UTF-8", "GBK", ROOT_PATH."public/uploads/Word/".$str);
            if (!file_exists($targetFolder)){
                mkdir ($targetFolder,0777,true);
            }
            
            //取出tep，判断需要生成哪个模板
            switch ($tep)
            {
                case 1:
                    $name=ROOT_PATH."public/uploads/Word/".$str."/".$item['code']."tep1.doc";
                    $word-&gt;wirtefile($name,$data1);    //保存word并且结束
                    //echo出的链接供给用户点击下载，链接href是word文件所在位置
                    echo "&lt;a href='/public/uploads/Word/".$str."/".$item['code']. "tep1.doc' target='_blank' style='color:rgba(30,173,160,0.72);'&gt;【" .$item['name']."】***表&lt;/a&gt;&lt;br&gt;";
                    break;
                case 2:
                    $name=ROOT_PATH."public/uploads/Word/".$str."/".$item['code']."tep2.doc";
                    $word-&gt;wirtefile($name,$data2);    //保存word并且结束.
                    echo "&lt;a href='/public/uploads/Word/".$str."/".$item['code']."tep2.doc' target='_blank' style='color:rgba(30,173,160,0.72);'&gt;【".$item['name']."】****表&lt;/a&gt;&lt;br&gt;";
                    break;
                case 3:
                    $name=ROOT_PATH."public/uploads/Word/".$str."/".$item['code']."tep3.doc";
                    echo "&lt;a href='/public/uploads/Word/".$str."/".$item['code']."tep3.doc' target='_blank' style='color:rgba(30,173,160,0.72);'&gt;【".$item['name']."】***表&lt;/a&gt;&lt;br&gt;";
                    $word-&gt;wirtefile($name,$data3);    //保存word并且结束.
                    break;
            }
        }


    }</code></pre> 
<p>上面控制器代码中引用了word类中的writefile方法，Word.php代码如下：</p> 
<pre class="has"><code class="language-php">&lt;?php
namespace org;
class Word
{
    function wirtefile ($fn,$data)
    {
        $fp=fopen($fn,"w+");
        fwrite($fp,$data);
        fclose($fp);
    }
}
?&gt;</code></pre> 
<p>至此功能就已经大体实现了。但是这样做其实性能方面会没有那么好，而且给用户的体验不太友好，用户的整个操作流程下来会感觉不太方便，接下来会对此功能进行评测以及代码的改进。文章会不定期更新。</p> 
<p><strong>2018/7/25更新</strong></p> 
<p>出于对使用这一功能的人群考虑，实际使用中用户并不需要一个一个去修改，而是仅仅负责分发给其他人，因此将生成的word打包成压缩包供用户下载。所以决定在原来的基础上，将每一次的批量生成都压缩一下，将压缩包放在存放word的同级目录下，zip名以日期加上时分秒命名，实现起来也很简单，php有专门的ZipArchive类，代码参考：<a href="https://blog.csdn.net/koastal/article/details/51944982">koastal的博客</a>，里面写的很详细，下面是项目修改后的代码</p> 
<pre class="has"><code class="language-php">    /*
     * 将项目导出至word，文件存放位置public\uploads\Word文件夹
     * $pid勾选项目的id值，$tep选择需要导出的Word模板id
     * */
    public function project2word($pid,$tep){
        $word = new word;
        //取出pid将其转成数组，进行循环遍历
        $pidArray = explode(",",$pid);
        echo
        "&lt;p style='text-align: center'&gt;生成完毕！请点击下载&lt;/p&gt; ";
        //创建以当天日期为名的文件夹，用来存放当天所有生成的word
        $str = date('Ymd');
        $targetFolder = iconv("UTF-8", "GBK", ROOT_PATH."public/uploads/Word/".$str);
        if (!file_exists($targetFolder)){
            mkdir ($targetFolder,0777,true);
        }
        //定义zip文件名及路径，创建并打开zip通道
        $zipStr = date('Ymdhis');
        $zipFilename = ROOT_PATH.'public/uploads/Word/'.$str.'/'.$zipStr.'.zip';
        $zip = new \ZipArchive();
        $zip-&gt;open($zipFilename,\ZipArchive::CREATE);

        foreach ($pidArray as $value)
        {
            $item = $this-&gt;getProject($value)-&gt;toArray();
            /*表一、二、三同上，代码省略*/
            $data1 = '';
            $data2 = '';
            $data3 = '';

            switch ($tep)
            {
                case 1:
                    $name=ROOT_PATH."public/uploads/Word/".$str."/".$item['code']."tep1.doc";
                    $word-&gt;wirtefile($name,$data1);    //保存word并且结束.
                    $zip-&gt;addFile($name,basename($name));    //添加到zip
                    echo "&lt;a href='/public/uploads/Word/".$str."/".$item['code']. "tep1.doc' target='_blank' style='color:rgba(30,173,160,0.72);'&gt;【" .$item['name']."】***表&lt;/a&gt;&lt;br&gt;";
                    break;
                case 2:
                    $name=ROOT_PATH."public/uploads/Word/".$str."/".$item['code']."tep2.doc";
                    $word-&gt;wirtefile($name,$data2);    //保存word并且结束.
                    $zip-&gt;addFile($name,basename($name));
                    echo "&lt;a href='/public/uploads/Word/".$str."/".$item['code']."tep2.doc' target='_blank' style='color:rgba(30,173,160,0.72);'&gt;【".$item['name']."】****表&lt;/a&gt;&lt;br&gt;";
                    break;
                case 3:
                    $name=ROOT_PATH."public/uploads/Word/".$str."/".$item['code']."tep3.doc";
                    echo "&lt;a href='/public/uploads/Word/".$str."/".$item['code']."tep3.doc' target='_blank' style='color:rgba(30,173,160,0.72);'&gt;【".$item['name']."】***表&lt;/a&gt;&lt;br&gt;";
                    $word-&gt;wirtefile($name,$data3);    //保存word并且结束.
                    $zip-&gt;addFile($name,basename($name));
                    break;
            }
        }
        //关闭压缩包
        $zip-&gt;close();
        echo "&lt;a href='/public/uploads/Word/".$str."/".$zipStr.".zip' target='_blank' style='color:rgba(30,173,160,0.72);'&gt;压缩包&lt;/a&gt;&lt;br&gt;";
    }</code></pre> 
<p>压缩功能完成。</p> 
<p><strong>2018/7/26更新</strong></p> 
<p>之前在生成模板之前选择的项目id，是通过url参数get到下一个页面的，和下个页面的模板id一起get到后台。这么做虽然简单，但是也有一个致命的问题，就是当用户一次性选择项目过多时，比如几百条几千条，url就会变得很长，但是实际上浏览器对url长度是有上限规定的，因此利用get请求把参数传到下一个页面是不可能了。那不能用get请求，又不能把项目id先传到后台，因为后台函数需要同时接受项目id和模板id，怎么办？ 一开始是想着能不能把模板id通过session存起来，在第二个页面访问。但是后来一想，用post不是更简单吗？可是转眼一想，不可能把项目id直接post到下一个页面吧？查了一下js是没办法获取post过来的数据的。好，那既然post不到下一个页面，那就看看layui有没有提供类似的功能。结果翻了一下官方文档，发现还真的有，就是在主页面利用layer.open打开的子窗口之间，是可以实现数据互通的，主页面可以访问子页面参数、方法，反之子页面也能访问主页面参数、方法。那既然如此，我何不在子页面去获取主页面的项目id，然后利用表单直接和模板id一起post到后台呢？锦上添花的是，layui提供了form表单的初始化赋值的功能，这么以来就省事多了，也不用去考虑主页面子页面谁去访问谁的东西了，直接在主页面的layer.open里面的success回调对子页面的表单进行赋值，完美解决了之前的各种问题，下面贴上部分修改后的代码。</p> 
<p>主页面的layer.open以及对子窗口的表单初始化赋值：</p> 
<pre class="has"><code class="language-javascript">        exportWords:function () {
                //获取勾选的项目信息，提取其中的项目id为一个新数组，方便之后传入生成文档的子窗口
                var selected_project=new Array();
                for(var i=0;i&lt;clicked_project.length;i++){
                    selected_project.push(clicked_project[i].id);
                }
                //检查是否有选择项目，没有选择的话要弹窗提示用户选择
                if(selected_project.length&gt;0)
                {
                    layer.open({
                        shade: [0.8,'#000'],
                        shadeClose: true,
                        title: '请选择您要导出的模板文件',
                        type: 2,
                        area: ['460px', '500px'],
                        //向下个页面传入参数(已勾选的项目id)
                        content: '__ROOT__/admin/project/chooseWordTemplate',
                        btn: '取消',
                        success: function (layero, index) {
                            //找到子窗口的DOM
                            var body = layui.layer.getChildFrame('body',index);
                            //利用对表单的值的初始化，将项目id传到子页面
                            body.find(".pid").val(selected_project);
                        }
                    });
                }else
                    {
                        layer.alert("您尚未选择需要导出word的项目！");
                    }

            }</code></pre> 
<p>子页面即chooseWordTemplate.html原来是三个按钮，现在直接重新写个表单，原来的三个按钮的模板选择变成了下拉框的模板选择，还有一个输入框，输入框里面的值是从父页面就已经初始化好的。chooseWordTemplate.html代码如下：</p> 
<pre class="has"><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html lang="zh-CN"&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;title&gt;选择word模板类型&lt;/title&gt;
    &lt;meta name="renderer" content="webkit"&gt;
    &lt;meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"&gt;
    &lt;link rel="stylesheet" href="__JS__/layui/css/layui.css" media="all"&gt;
    &lt;link rel="stylesheet" href="__CSS__/font-awesome.min.css"&gt;
    &lt;link rel="stylesheet" href="__CSS__/admin.css"&gt;
    &lt;script src="__JS__/layui2/layui.all.js"&gt;&lt;/script&gt;
    &lt;!--[if lt IE 9]&gt;
    &lt;script src="__CSS__/html5shiv.min.js"&gt;&lt;/script&gt;
    &lt;script src="__CSS__/respond.min.js"&gt;&lt;/script&gt;
    &lt;![endif]--&gt;
    &lt;style&gt;
        *{
            margin: 0;
            padding: 0;
        }
        body{
            background-color: #f8f8f8;
        }
        .content{
            width: 440px;
            background-color: #f8f8f8;
            margin-top: 100px;
        }
    &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div class="content"&gt;
&lt;form class="layui-form" method="post" action="__ROOT__/admin/project/project2word"&gt;
    &lt;div class="layui-form-item"&gt;
        &lt;label class="layui-form-label"&gt;所选项目&lt;/label&gt;
        &lt;div class="layui-input-block"&gt;
            &lt;input type="text" name="projid" autocomplete="off" required  lay-verify="required" class="layui-input pid layui-disabled"&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;!--下拉选择模板--&gt;
    &lt;div class="layui-form-item"&gt;
        &lt;label class="layui-form-label"&gt;模板选择&lt;/label&gt;
        &lt;div class="layui-input-block"&gt;
            &lt;select name="template" lay-filter="demo" lay-verify="selectTemplate"&gt;
                &lt;option value="0"&gt;请选择&lt;/option&gt;
                &lt;option value="1"&gt;****表&lt;/option&gt;
                &lt;option value="2"&gt;****表&lt;/option&gt;
                &lt;option value="3"&gt;****表&lt;/option&gt;
            &lt;/select&gt;
        &lt;/div&gt;
    &lt;/div&gt;
    &lt;!--提交表单--&gt;
    &lt;div class="layui-form-item"&gt;
        &lt;div class="layui-input-block"&gt;
            &lt;button class="layui-btn layui-btn-normal" lay-submit lay-filter="*"&gt;立即生成&lt;/button&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/form&gt;
&lt;/div&gt;

&lt;script&gt;
    layui.use('form', function(){
        var form = layui.form; //只有执行了这一步，部分表单元素才会自动修饰成功
        //但是，如果你的HTML是动态生成的，自动渲染就会失效
        //因此你需要在相应的地方，执行下述方法来手动渲染，跟这类似的还有 element.init();
        form.render();       
        //监听下拉框
        form.on('select(demo)', function(data){
            var tep = data.value;
//            console.log(tep); //得到被选中的值
        });
        //验证下拉框
        form.verify({
            selectTemplate:function (value) {
                if(value == 0)
                {
                    return '请先选择模板!';
                }
            }
        });     
        //监听表单提交
        form.on('submit(*)', function(){
            layer.load(1);
        });
    });
&lt;/script&gt;

&lt;/body&gt;
&lt;/html&gt;</code></pre> 
<p>页面效果如下（为了防止用户误操作，我把项目id的文本框禁用了，这里注意一下，layui的禁用是有两种，一种只是样式上的禁用，另一种是表单里禁用，即不会提交）：</p> 
<p><img alt="" class="has" height="329" src="https://images2.imgbox.com/aa/18/axygA3KS_o.png" width="305"></p> 
<p> 然后是后台控制器代码修改：</p> 
<pre class="has"><code class="language-php">    /*
     * 将项目导出至word，文件存放位置public\uploads\Word文件夹
     * $pid勾选项目的id值，$tep选择需要导出的Word模板id
     * */
    public function project2word(){
        $word = new word;
        $request = Request::instance();
/*      //取出pid
        $pidParam = $request-&gt;only('projid');   //获取参数是一个数组，注意是整体为一个value，所以要把相应value转成String类型，方便后面拆分再行转成数组
        $pid = implode($pidParam);      //数组$pidParam转成String类型的$pid    */
        //取出pid第二种方法
        $pidParam = $request-&gt;post('projid');       //这种获取方法直接就是string类型了
        $pidArray = explode(",",$pidParam);     //将其转成数组，进行循环遍历
        //取出tep，方便后面判断需要生成哪个模板
        $tepParam = $request-&gt;post('template');
        
        //后续操作不变...
    }</code></pre> 
<p>url过长问题到这就解决了。</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0f8d646b10fdba8a518d795a5e8d80d3/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">明明apple id 密码 是对的，登陆 iTunes还总提示密码错误</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/4de8f5b535c864cb69cf45c564f41f1a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">从零开始的程序逆向之路 第一章——认识OD(Ollydbg)以及常用汇编扫盲</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>