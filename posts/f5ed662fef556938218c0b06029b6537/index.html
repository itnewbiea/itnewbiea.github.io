<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>java之net.http.HttpClient详解 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="java之net.http.HttpClient详解" />
<meta property="og:description" content="HttpClient的主要特点 支持同步和异步请求：HttpClient可以发送同步和异步的HTTP请求。同步请求会阻塞当前线程，直到收到响应或发生超时。异步请求则不会阻塞线程，可以通过回调函数或Future对象来处理响应。连接管理：HttpClient可以自动管理HTTP连接的生命周期，包括连接的建立、重用和释放。它支持连接池，可以重用已经建立的连接，减少连接的建立和关闭的开销。请求和响应拦截器：HttpClient提供了拦截器机制，可以在发送请求和处理响应的过程中进行自定义操作。拦截器可以用于添加认证信息、修改请求头、处理响应等。支持HTTPS：HttpClient可以与使用SSL/TLS协议保护的HTTPS服务器进行通信。它支持证书验证、主机名验证和安全协议的选择。支持代理：HttpClient可以通过代理服务器发送请求，支持HTTP和SOCKS代理。支持重定向：HttpClient可以自动处理HTTP重定向，包括301和302状态码的重定向。支持Cookie管理：HttpClient可以自动处理HTTP Cookie，包括发送和接收Cookie，以及保存和管理Cookie。支持连接超时和读取超时设置：HttpClient可以设置连接超时和读取超时，以防止请求长时间无响应。 需要手动关闭吗 Java 11（8需要手动）的HttpClient中，不需要手动关闭HttpClient。HttpClient内部使用的是非阻塞的IO，不持有任何需要显式关闭的资源，比如Socket或者文件句柄。这是一个很大的改进，因为它意味着你不再需要在finally块中关闭资源，这样可以使代码更简洁，更易于阅读和维护。
性能问题 **HttpClient的实例是重量级的对象，它的创建和配置都需要消耗一定的系统资源。一般来说，为了提高效率，应该尽可能重用HttpClient实例，而不是为每个请求都新建一个。尤其是在处理大量请求的情况下，重用HttpClient**实例可以显著提高性能。
线程问题 HttpClient实例可以被多个线程共享，但HttpRequest和HttpResponse实例是不可变的，且不应被多个线程共享。所以每个请求要创建新的HttpRequest和HttpResponse实例。
代码实现： 使用HttpClient发送GET请求的示例代码 import org.apache.http.client.HttpClient; import org.apache.http.client.methods.HttpGet; import org.apache.http.impl.client.HttpClientBuilder; import org.apache.http.HttpResponse; import org.apache.http.util.EntityUtils; public class HttpClientExample { public static void main(String[] args) { HttpClient httpClient = HttpClientBuilder.create().build(); HttpGet httpGet = new HttpGet(&#34;https://api.example.com/data&#34;); try { HttpResponse response = httpClient.execute(httpGet); String responseBody = EntityUtils.toString(response.getEntity()); System.out.println(&#34;Response Code: &#34; &#43; response.getStatusLine().getStatusCode()); System.out.println(&#34;Response Body: &#34; &#43; responseBody); } catch (Exception e) { e.printStackTrace(); } } } 使用HttpClient设置重定向请求的示例代码 import java." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/f5ed662fef556938218c0b06029b6537/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-30T16:46:36+08:00" />
<meta property="article:modified_time" content="2023-06-30T16:46:36+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">java之net.http.HttpClient详解</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h4><a id="HttpClient_0"></a>HttpClient的主要特点</h4> 
<ol><li>支持同步和异步请求：HttpClient可以发送同步和异步的HTTP请求。同步请求会阻塞当前线程，直到收到响应或发生超时。异步请求则不会阻塞线程，可以通过回调函数或Future对象来处理响应。</li><li>连接管理：HttpClient可以自动管理HTTP连接的生命周期，包括连接的建立、重用和释放。它支持连接池，可以重用已经建立的连接，减少连接的建立和关闭的开销。</li><li>请求和响应拦截器：HttpClient提供了拦截器机制，可以在发送请求和处理响应的过程中进行自定义操作。拦截器可以用于添加认证信息、修改请求头、处理响应等。</li><li>支持HTTPS：HttpClient可以与使用SSL/TLS协议保护的HTTPS服务器进行通信。它支持证书验证、主机名验证和安全协议的选择。</li><li>支持代理：HttpClient可以通过代理服务器发送请求，支持HTTP和SOCKS代理。</li><li>支持重定向：HttpClient可以自动处理HTTP重定向，包括301和302状态码的重定向。</li><li>支持Cookie管理：HttpClient可以自动处理HTTP Cookie，包括发送和接收Cookie，以及保存和管理Cookie。</li><li>支持连接超时和读取超时设置：HttpClient可以设置连接超时和读取超时，以防止请求长时间无响应。</li></ol> 
<h4><a id="_11"></a>需要手动关闭吗</h4> 
<p>Java 11（8需要手动）的HttpClient中，不需要手动关闭HttpClient。HttpClient内部使用的是非阻塞的IO，不持有任何需要显式关闭的资源，比如Socket或者文件句柄。这是一个很大的改进，因为它意味着你不再需要在finally块中关闭资源，这样可以使代码更简洁，更易于阅读和维护。</p> 
<h4><a id="_15"></a>性能问题</h4> 
<p>**<code>HttpClient</code><strong>的实例是重量级的对象，它的创建和配置都需要消耗一定的系统资源。一般来说，为了提高效率，应该尽可能重用</strong><code>HttpClient</code><strong>实例，而不是为每个请求都新建一个。尤其是在处理大量请求的情况下，重用</strong><code>HttpClient</code>**实例可以显著提高性能。</p> 
<h4><a id="_19"></a>线程问题</h4> 
<p>HttpClient实例可以被多个线程共享，但HttpRequest和HttpResponse实例是不可变的，且不应被多个线程共享。所以每个请求要创建新的HttpRequest和HttpResponse实例。</p> 
<h4><a id="_23"></a>代码实现：</h4> 
<h5><a id="HttpClientGET_25"></a>使用HttpClient发送GET请求的示例代码</h5> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">HttpClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>client<span class="token punctuation">.</span>methods<span class="token punctuation">.</span></span><span class="token class-name">HttpGet</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>impl<span class="token punctuation">.</span>client<span class="token punctuation">.</span></span><span class="token class-name">HttpClientBuilder</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>http<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">EntityUtils</span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">HttpClientExample</span> <span class="token punctuation">{<!-- --></span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpClient</span> httpClient <span class="token operator">=</span> <span class="token class-name">HttpClientBuilder</span><span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">HttpGet</span> httpGet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HttpGet</span><span class="token punctuation">(</span><span class="token string">"https://api.example.com/data"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
            <span class="token class-name">HttpResponse</span> response <span class="token operator">=</span> httpClient<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>httpGet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">String</span> responseBody <span class="token operator">=</span> <span class="token class-name">EntityUtils</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">getEntity</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Response Code: "</span> <span class="token operator">+</span> response<span class="token punctuation">.</span><span class="token function">getStatusLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getStatusCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"Response Body: "</span> <span class="token operator">+</span> responseBody<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
            e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<h5><a id="HttpClient_53"></a>使用HttpClient设置重定向请求的示例代码</h5> 
<pre><code class="prism language-java"><span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpClient</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpRequest</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span><span class="token class-name">HttpResponse</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token namespace">java<span class="token punctuation">.</span>net<span class="token punctuation">.</span></span>URI<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Main</span> <span class="token punctuation">{<!-- --></span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{<!-- --></span>
        <span class="token class-name">HttpClient</span> client <span class="token operator">=</span> <span class="token class-name">HttpClient</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">followRedirects</span><span class="token punctuation">(</span><span class="token class-name">HttpClient<span class="token punctuation">.</span>Redirect</span><span class="token punctuation">.</span>NORMAL<span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HttpRequest</span> request <span class="token operator">=</span> <span class="token class-name">HttpRequest</span><span class="token punctuation">.</span><span class="token function">newBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">uri</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token function">URI</span><span class="token punctuation">(</span><span class="token string">"http://example.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 
            <span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">HttpResponse</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">&gt;</span></span> response <span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token class-name">HttpResponse<span class="token punctuation">.</span>BodyHandlers</span><span class="token punctuation">.</span><span class="token function">ofString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span><span class="token function">body</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/30aece7f0e3f4d3b7bb0973505c46530/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">并发List：CopyOnWriteArrayList</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/199b5b2af8509e4d6688e2c00dd09be3/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">modbus协议Linux嵌入式网关支持二次开发</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>