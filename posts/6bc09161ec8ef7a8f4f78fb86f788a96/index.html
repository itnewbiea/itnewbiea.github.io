<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>大数据毕设选题 - 招聘岗位数据分析可视化（python 爬虫） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="大数据毕设选题 - 招聘岗位数据分析可视化（python 爬虫）" />
<meta property="og:description" content="文章目录 1 前言1 课题背景2 实现效果3 项目实现3.1 概述3.2 数据采集3.3 数据清洗与预处理 4 数据分析与可视化Flask框架介绍 5 最后 1 前言 🔥 Hi，大家好，这里是丹成学长的毕设系列文章！
🔥 对毕设有任何疑问都可以问学长哦!
这两年开始，各个学校对毕设的要求越来越高，难度也越来越大… 毕业设计耗费时间，耗费精力，甚至有些题目即使是专业的老师或者硕士生也需要很长时间，所以一旦发现问题，一定要提前准备，避免到后面措手不及，草草了事。
为了大家能够顺利以及最少的精力通过毕设，学长分享优质毕业设计项目，今天要分享的新项目是
🚩 大数据招聘岗位数据分析与可视化 - 爬虫 python 大屏可视化
🥇学长这里给一个题目综合评分(每项满分5分)
难度系数：4分工作量：4分创新点：3分 🧿 选题指导, 项目分享：
https://gitee.com/yaa-dc/BJH/blob/master/gg/cc/README.md
1 课题背景 随着科技的飞速发展，数据呈现爆发式的增长，任何人都摆脱不了与数据打交道，社会对于“数据”方面的人才需求也在不断增大。因此了解当下企业究竟需要招聘什么样的人才？需要什么样的技能？不管是对于在校生，还是对于求职者来说，都显得很有必要。
本文基于这个问题，针对 boss 直聘网站，使用 Scrapy 框架爬取了全国热门城市大数据、数据分析、数据挖掘、机器学习、人工智能等相关岗位的招聘信息。分析比较了不同岗位的薪资、学历要求；分析比较了不同区域、行业对相关人才的需求情况；分析比较了不同岗位的知识、技能要求等。
2 实现效果 岗位情况分析可视化
3 项目实现 3.1 概述 该项目一共分为三个子任务完成，数据采集—数据预处理—数据分析/可视化。
项目流程图
项目架构图
3.2 数据采集 Scrapy 爬虫介绍
Scrapy是基于Twisted的爬虫框架，它可以从各种数据源中抓取数据。其架构清晰，模块之间的耦合度低，扩展性极强，爬取效率高，可以灵活完成各种需求。能够方便地用来处理绝大多数反爬网站，是目前Python中应用最广泛的爬虫框架。Scrapy框架主要由五大组件组成，它们分别是调度器(Scheduler)、下载器(Downloader)、爬虫（Spider）和实体管道(Item Pipeline)、Scrapy引擎(Scrapy Engine)。各个组件的作用如下：
调度器(Scheduler)：说白了把它假设成为一个URL（抓取网页的网址或者说是链接）的优先队列，由它来决定下一个要抓取的网址是 什么，同时去除重复的网址（不做无用功）。用户可以自己的需求定制调度器。
下载器(Downloader)：是所有组件中负担最大的，它用于高速地下载网络上的资源。Scrapy的下载器代码不会太复杂，但效率高，主要的原因是Scrapy下载器是建立在twisted这个高效的异步模型上的(其实整个框架都在建立在这个模型上的)。
爬虫（Spider）：是用户最关心的部份。用户定制自己的爬虫(通过定制正则表达式等语法)，用于从特定的网页中提取自己需要的信息，即所谓的实体(Item)。 用户也可以从中提取出链接,让Scrapy继续抓取下一个页面。
实体管道(Item Pipeline)：用于处理爬虫(spider)提取的实体。主要的功能是持久化实体、验证实体的有效性、清除不需要的信息。
Scrapy引擎(Scrapy Engine)：Scrapy引擎是整个框架的核心.它用来控制调试器、下载器、爬虫。实际上，引擎相当于计算机的CPU,它控制着整个流程。
Scrapy 官网架构图" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/6bc09161ec8ef7a8f4f78fb86f788a96/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-11-23T10:32:04+08:00" />
<meta property="article:modified_time" content="2022-11-23T10:32:04+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">大数据毕设选题 - 招聘岗位数据分析可视化（python 爬虫）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><a href="#1__2" rel="nofollow">1 前言</a></li><li><a href="#1__26" rel="nofollow">1 课题背景</a></li><li><a href="#2__32" rel="nofollow">2 实现效果</a></li><li><a href="#3__38" rel="nofollow">3 项目实现</a></li><li><ul><li><a href="#31__40" rel="nofollow">3.1 概述</a></li><li><a href="#32__51" rel="nofollow">3.2 数据采集</a></li><li><a href="#33__223" rel="nofollow">3.3 数据清洗与预处理</a></li></ul> 
  </li><li><a href="#4__333" rel="nofollow">4 数据分析与可视化</a></li><li><ul><li><a href="#Flask_338" rel="nofollow">Flask框架介绍</a></li></ul> 
  </li><li><a href="#5__520" rel="nofollow">5 最后</a></li></ul> 
</div> 
<p></p> 
<h2><a id="1__2"></a>1 前言</h2> 
<p>🔥 Hi，大家好，这里是丹成学长的毕设系列文章！</p> 
<p>🔥 对毕设有任何疑问都可以问学长哦!</p> 
<p>这两年开始，各个学校对毕设的要求越来越高，难度也越来越大… 毕业设计耗费时间，耗费精力，甚至有些题目即使是专业的老师或者硕士生也需要很长时间，所以一旦发现问题，一定要提前准备，避免到后面措手不及，草草了事。</p> 
<p>为了大家能够顺利以及最少的精力通过毕设，学长分享优质毕业设计项目，今天要分享的新项目是</p> 
<p>🚩 <strong>大数据招聘岗位数据分析与可视化 - 爬虫 python 大屏可视化</strong></p> 
<p>🥇学长这里给一个题目综合评分(每项满分5分)</p> 
<ul><li>难度系数：4分</li><li>工作量：4分</li><li>创新点：3分</li></ul> 
<p>🧿 <strong>选题指导, 项目分享：</strong></p> 
<p><a href="https://gitee.com/yaa-dc/BJH/blob/master/gg/cc/README.md" rel="nofollow">https://gitee.com/yaa-dc/BJH/blob/master/gg/cc/README.md</a></p> 
<h2><a id="1__26"></a>1 课题背景</h2> 
<p>随着科技的飞速发展，数据呈现爆发式的增长，任何人都摆脱不了与数据打交道，社会对于“数据”方面的人才需求也在不断增大。因此了解当下企业究竟需要招聘什么样的人才？需要什么样的技能？不管是对于在校生，还是对于求职者来说，都显得很有必要。</p> 
<p>本文基于这个问题，针对 boss 直聘网站，使用 Scrapy 框架爬取了全国热门城市大数据、数据分析、数据挖掘、机器学习、人工智能等相关岗位的招聘信息。分析比较了不同岗位的薪资、学历要求；分析比较了不同区域、行业对相关人才的需求情况；分析比较了不同岗位的知识、技能要求等。</p> 
<h2><a id="2__32"></a>2 实现效果</h2> 
<p><strong>岗位情况分析可视化</strong></p> 
<p><img src="https://images2.imgbox.com/47/35/a42xprJZ_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="3__38"></a>3 项目实现</h2> 
<h3><a id="31__40"></a>3.1 概述</h3> 
<p>该项目一共分为三个子任务完成，数据采集—数据预处理—数据分析/可视化。</p> 
<p><strong>项目流程图</strong></p> 
<p><img src="https://images2.imgbox.com/7a/97/ZTJeg1tA_o.png" alt="在这里插入图片描述"><br> <strong>项目架构图</strong></p> 
<p><img src="https://images2.imgbox.com/ab/1c/ahRoAc4h_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="32__51"></a>3.2 数据采集</h3> 
<p><strong>Scrapy 爬虫介绍</strong></p> 
<p>Scrapy是基于Twisted的爬虫框架，它可以从各种数据源中抓取数据。其架构清晰，模块之间的耦合度低，扩展性极强，爬取效率高，可以灵活完成各种需求。能够方便地用来处理绝大多数反爬网站，是目前Python中应用最广泛的爬虫框架。Scrapy框架主要由五大组件组成，它们分别是调度器(Scheduler)、下载器(Downloader)、爬虫（Spider）和实体管道(Item Pipeline)、Scrapy引擎(Scrapy Engine)。各个组件的作用如下：</p> 
<ol><li> <p>调度器(Scheduler)：说白了把它假设成为一个URL（抓取网页的网址或者说是链接）的优先队列，由它来决定下一个要抓取的网址是 什么，同时去除重复的网址（不做无用功）。用户可以自己的需求定制调度器。</p> </li><li> <p>下载器(Downloader)：是所有组件中负担最大的，它用于高速地下载网络上的资源。Scrapy的下载器代码不会太复杂，但效率高，主要的原因是Scrapy下载器是建立在twisted这个高效的异步模型上的(其实整个框架都在建立在这个模型上的)。</p> </li><li> <p>爬虫（Spider）：是用户最关心的部份。用户定制自己的爬虫(通过定制正则表达式等语法)，用于从特定的网页中提取自己需要的信息，即所谓的实体(Item)。 用户也可以从中提取出链接,让Scrapy继续抓取下一个页面。</p> </li><li> <p>实体管道(Item Pipeline)：用于处理爬虫(spider)提取的实体。主要的功能是持久化实体、验证实体的有效性、清除不需要的信息。</p> </li><li> <p>Scrapy引擎(Scrapy Engine)：Scrapy引擎是整个框架的核心.它用来控制调试器、下载器、爬虫。实际上，引擎相当于计算机的CPU,它控制着整个流程。</p> </li></ol> 
<p><strong>Scrapy 官网架构图</strong></p> 
<p><img src="https://images2.imgbox.com/b6/7e/nR1B1mje_o.png" alt="在这里插入图片描述"></p> 
<p>爬取 Boss直聘热门城市岗位数据，并将数据以 CSV 文件格式进行保存。如下图所示：</p> 
<p><img src="https://images2.imgbox.com/1f/21/d3Ys6ejL_o.png" alt="在这里插入图片描述"><br> <strong>编写爬虫程序</strong></p> 
<p>创建和配置好 Scrapy 项目以后，我们就可以编写 Scrapy 爬虫程序了。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> scrapy
<span class="token keyword">import</span> json
<span class="token keyword">import</span> logging
<span class="token keyword">import</span> random
<span class="token keyword">from</span> bosszp<span class="token punctuation">.</span>items <span class="token keyword">import</span> BosszpItem


<span class="token keyword">class</span> <span class="token class-name">BossSpider</span><span class="token punctuation">(</span>scrapy<span class="token punctuation">.</span>Spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
    name <span class="token operator">=</span> <span class="token string">'boss'</span>
    allowed_domains <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'zhipin.com'</span><span class="token punctuation">]</span>
    start_urls <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'https://www.zhipin.com/wapi/zpCommon/data/cityGroup.json'</span><span class="token punctuation">]</span>  <span class="token comment"># 热门城市列表url</span>
    <span class="token comment"># 设置多个 cookie,建议数量为 页数/2 + 1 个cookie.至少 设置 4 个</span>
    <span class="token comment"># 只需复制 __zp_stoken__ 部分即可</span>
    cookies <span class="token operator">=</span> <span class="token punctuation">[</span>     <span class="token string">'__zp_stoken__=f330bOEgsRnsAIS5Bb2FXe250elQKNzAgMBcQZ1hvWyBjUFE1DCpKLWBtBn99Nwd%2BPHtlVRgdOi1vDEAkOz9sag50aRNRfhs6TQ9kWmNYc0cFI3kYKg5fAGVPPX0WO2JCOipvRlwbP1YFBQlHOQ%3D%3D'</span><span class="token punctuation">,</span>       <span class="token string">'__zp_stoken__=f330bOEgsRnsAIUsENEIbe250elRsb2U4Bg0QZ1hvW19mPEdeeSpKLWBtN3Y9QCN%2BPHtlVRgdOilvfTYkSTMiaFN0X3NRAGMjOgENX2krc0cFI3kYKiooQGx%2BPX0WO2I3OipvRlwbP1YFBQlHOQ%3D%3D'</span><span class="token punctuation">,</span>      <span class="token string">'__zp_stoken__=f330bOEgsRnsAITsLNnJIe250elRJMH95DBAQZ1hvW1J1ewdmDCpKLWBtBHZtagV%2BPHtlVRgdOil1LjkkR1MeRAgdY3tXbxVORWVuTxQlc0cFI3kYKgwCEGxNPX0WO2JCOipvRlwbP1YFBQlHOQ%3D%3D'</span>
    <span class="token punctuation">]</span>
    <span class="token comment"># 设置多个请求头</span>
    user_agents <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 11_0_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36'</span><span class="token punctuation">,</span>
        <span class="token string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_6) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/14.0.1 Safari/605.1.15'</span><span class="token punctuation">,</span>
        <span class="token string">'Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Trident/5.0'</span><span class="token punctuation">,</span>
        <span class="token string">'Mozilla/5.0 (Windows NT 6.1; rv:2.0.1) Gecko/20100101 Firefox/4.0.1'</span><span class="token punctuation">,</span>
        <span class="token string">'Opera/9.80 (Windows NT 6.1; U; en) Presto/2.8.131 Version/11.11'</span><span class="token punctuation">,</span>
        <span class="token string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Maxthon 2.0)'</span><span class="token punctuation">,</span>
        <span class="token string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; TencentTraveler 4.0)'</span><span class="token punctuation">,</span>
        <span class="token string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; The World)'</span><span class="token punctuation">,</span>
        <span class="token string">'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; 360SE)'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
    page_no <span class="token operator">=</span> <span class="token number">1</span>  <span class="token comment"># 初始化分页</span>

    <span class="token keyword">def</span> <span class="token function">random_header</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        随机生成请求头
        :return: headers
        """</span>
        headers <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'Referer'</span><span class="token punctuation">:</span> <span class="token string">'https://www.zhipin.com/c101020100/?ka=sel-city-101020100'</span><span class="token punctuation">}</span>
        headers<span class="token punctuation">[</span><span class="token string">'cookie'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>self<span class="token punctuation">.</span>cookies<span class="token punctuation">)</span>
        headers<span class="token punctuation">[</span><span class="token string">'user-agent'</span><span class="token punctuation">]</span> <span class="token operator">=</span> random<span class="token punctuation">.</span>choice<span class="token punctuation">(</span>self<span class="token punctuation">.</span>user_agents<span class="token punctuation">)</span>
        <span class="token keyword">return</span> headers

    <span class="token keyword">def</span> <span class="token function">parse</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        解析首页热门城市列表，选择热门城市进行爬取
        :param response: 热门城市字典数据
        :return:
        """</span>
        <span class="token comment"># 获取服务器返回的内容</span>
        city_group <span class="token operator">=</span> json<span class="token punctuation">.</span>loads<span class="token punctuation">(</span>response<span class="token punctuation">.</span>body<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 获取热门城市列表</span>
        hot_city_list <span class="token operator">=</span> city_group<span class="token punctuation">[</span><span class="token string">'zpData'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'hotCityList'</span><span class="token punctuation">]</span>
        <span class="token comment"># 初始化空列表，存储打印信息</span>
        <span class="token comment"># city_lst = []</span>
        <span class="token comment"># for index,item in enumerate(hot_city_list):</span>
        <span class="token comment">#    city_lst.apend({index+1: item['name']})</span>
        <span class="token comment"># 列表推导式：</span>
        hot_city_names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">{<!-- --></span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">:</span> item<span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token keyword">for</span> index<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>hot_city_list<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"---&gt;"</span><span class="token punctuation">,</span> hot_city_names<span class="token punctuation">)</span>
        <span class="token comment"># 从键盘获取城市编号</span>
        city_no <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span><span class="token builtin">input</span><span class="token punctuation">(</span><span class="token string">'请从上述城市列表中，选择编号开始爬取：'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token comment"># 拼接url https://www.zhipin.com/job_detail/?query=&amp;city=101040100&amp;industry=&amp;position=</span>
        <span class="token comment"># 获取城市编码code</span>
        city_code <span class="token operator">=</span> hot_city_list<span class="token punctuation">[</span>city_no <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span>
        <span class="token comment"># 拼接查询接口</span>
        city_url <span class="token operator">=</span> <span class="token string">'https://www.zhipin.com/job_detail/?query=&amp;city={}&amp;industry=&amp;position='</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>city_code<span class="token punctuation">)</span>
        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;正在爬取第_{}_页岗位数据&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>page_no<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>city_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>random_header<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_city<span class="token punctuation">)</span>

    <span class="token keyword">def</span> <span class="token function">parse_city</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> response<span class="token punctuation">)</span><span class="token punctuation">:</span>

        <span class="token triple-quoted-string string">"""
        解析岗位页数据
        :param response: 岗位页响应数据
        :return:
        """</span>
        <span class="token keyword">if</span> response<span class="token punctuation">.</span>status <span class="token operator">!=</span> <span class="token number">200</span><span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>warning<span class="token punctuation">(</span><span class="token string">"&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;获取城市招聘信息失败，ip已被封禁。请稍后重试&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        li_elements <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="job-list"]/ul/li'</span><span class="token punctuation">)</span>  <span class="token comment"># 定位到所有的li标签</span>
        next_url <span class="token operator">=</span> response<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'//div[@class="page"]/a[last()]/@href'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 获取下一页</span>

        <span class="token keyword">for</span> li <span class="token keyword">in</span> li_elements<span class="token punctuation">:</span>
            job_name <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]//div[@class="job-title"]/span[1]/a/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            job_area <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]//div[@class="job-title"]/span[2]/span[1]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            job_salary <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]//span[@class="red"]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            com_name <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/div[2]//div[@class="company-text"]/h3/a/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            com_type <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/div[2]/div[1]/p/a/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            com_size <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/div[2]/div[1]/p/text()[2]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            finance_stage <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/div[2]/div[1]/p/text()[1]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            work_year <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/div[1]/div[1]/div[2]/p/text()[1]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            education <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[1]/div[1]/div[1]/div[2]/p/text()[2]'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            job_benefits <span class="token operator">=</span> li<span class="token punctuation">.</span>xpath<span class="token punctuation">(</span><span class="token string">'./div/div[2]/div[2]/text()'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token punctuation">)</span>
            item <span class="token operator">=</span> BosszpItem<span class="token punctuation">(</span>job_name<span class="token operator">=</span>job_name<span class="token punctuation">,</span> job_area<span class="token operator">=</span>job_area<span class="token punctuation">,</span> job_salary<span class="token operator">=</span>job_salary<span class="token punctuation">,</span> com_name<span class="token operator">=</span>com_name<span class="token punctuation">,</span>
                              com_type<span class="token operator">=</span>com_type<span class="token punctuation">,</span> com_size<span class="token operator">=</span>com_size<span class="token punctuation">,</span>
                              finance_stage<span class="token operator">=</span>finance_stage<span class="token punctuation">,</span> work_year<span class="token operator">=</span>work_year<span class="token punctuation">,</span> education<span class="token operator">=</span>education<span class="token punctuation">,</span>
                              job_benefits<span class="token operator">=</span>job_benefits<span class="token punctuation">)</span>
            <span class="token keyword">yield</span> item
        <span class="token keyword">if</span> next_url <span class="token operator">==</span> <span class="token string">"javascript:;"</span><span class="token punctuation">:</span>
            logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">'&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;热门城市岗位数据已爬取结束&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;'</span><span class="token punctuation">)</span>
            logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;一共爬取了_{}_页岗位数据&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>page_no<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span>
        next_url <span class="token operator">=</span> response<span class="token punctuation">.</span>urljoin<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>  <span class="token comment"># 网址拼接</span>
        self<span class="token punctuation">.</span>page_no <span class="token operator">+=</span> <span class="token number">1</span>
        logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;正在爬取第_{}_页岗位数据&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;"</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>page_no<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">yield</span> scrapy<span class="token punctuation">.</span>Request<span class="token punctuation">(</span>url<span class="token operator">=</span>next_url<span class="token punctuation">,</span> headers<span class="token operator">=</span>self<span class="token punctuation">.</span>random_header<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> callback<span class="token operator">=</span>self<span class="token punctuation">.</span>parse_city<span class="token punctuation">)</span>
</code></pre> 
<p><strong>保存数据</strong></p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> itemadapter <span class="token keyword">import</span> ItemAdapter


<span class="token keyword">class</span> <span class="token class-name">BosszpPipeline</span><span class="token punctuation">:</span>
    <span class="token keyword">def</span> <span class="token function">process_item</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> item<span class="token punctuation">,</span> spider<span class="token punctuation">)</span><span class="token punctuation">:</span>
        <span class="token triple-quoted-string string">"""
        保存数据到本地 csv 文件
        :param item: 数据项
        :param spider:
        :return: 
        """</span>
        <span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token builtin">file</span><span class="token operator">=</span><span class="token string">'全国-热门城市岗位数据.csv'</span><span class="token punctuation">,</span> mode<span class="token operator">=</span><span class="token string">'a+'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
            f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>
                <span class="token string">'{job_name},{job_area},{job_salary},{com_name},{com_type},{com_size},{finance_stage},{work_year},'</span>
                <span class="token string">'{education},{job_benefits}'</span><span class="token punctuation">.</span><span class="token builtin">format</span><span class="token punctuation">(</span> 
                    <span class="token operator">**</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">return</span> item
</code></pre> 
<p><strong>编辑本地 CSV 文件</strong></p> 
<pre><code class="prism language-python">job_name<span class="token punctuation">,</span>job_area<span class="token punctuation">,</span>job_salary<span class="token punctuation">,</span>com_name<span class="token punctuation">,</span>com_type<span class="token punctuation">,</span>com_size<span class="token punctuation">,</span>finance_stage<span class="token punctuation">,</span>work_year<span class="token punctuation">,</span>education<span class="token punctuation">,</span>job_benefits
</code></pre> 
<p><img src="https://images2.imgbox.com/71/1d/k0TKk3qO_o.png" alt="在这里插入图片描述"></p> 
<h3><a id="33__223"></a>3.3 数据清洗与预处理</h3> 
<p>完成上面爬虫程序的编写与运行，我们就能将 Boss 直聘热门城市岗位数据爬取到本地。通过观察发现爬取到的数据出现了大量的脏数据和高耦合的数据。我们需要对这些脏数据进行清洗与预处理后才能正常使用。</p> 
<pre><code class="prism language-python">需求：

读取 全国<span class="token operator">-</span>热门城市岗位数据<span class="token punctuation">.</span>csv 文件
对重复行进行清洗。
对工作地址字段进行预处理。要求：北京·海淀区·西北旺 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> 北京，海淀区，西北旺。分隔成<span class="token number">3</span>个字段
对薪资字段进行预处理。要求：<span class="token number">30</span><span class="token operator">-</span>60K·<span class="token number">15</span>薪 <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">&gt;</span> 最低：<span class="token number">30</span>，最高：<span class="token number">60</span>
对工作经验字段进行预处理。要求：经验不限<span class="token operator">/</span>在校<span class="token operator">/</span>应届 ：<span class="token number">0</span>，<span class="token number">1</span><span class="token operator">-</span><span class="token number">3</span>年：<span class="token number">1</span>，<span class="token number">3</span><span class="token operator">-</span><span class="token number">5</span>年：<span class="token number">2</span>，<span class="token number">5</span><span class="token operator">-</span><span class="token number">10</span>年：<span class="token number">3</span>，<span class="token number">10</span>年以上<span class="token punctuation">:</span><span class="token number">4</span>
对企业规模字段进行预处理。要求：<span class="token number">500</span>人以下：<span class="token number">0</span>，<span class="token number">500</span><span class="token operator">-</span><span class="token number">999</span>：<span class="token number">1</span>，<span class="token number">1000</span><span class="token operator">-</span><span class="token number">9999</span>：<span class="token number">2</span>，<span class="token number">10000</span>人以上：<span class="token number">3</span>
对岗位福利字段进行预处理。要求：将描述中的中文<span class="token string">'，'</span>（逗号）<span class="token punctuation">,</span>替换成英文<span class="token string">','</span>（逗号）
对缺失值所在行进行清洗。
将处理后的数据保存到 MySQL 数据库
</code></pre> 
<p><strong>编写清洗与预处理的代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
    作者：jhzhong
    功能：对岗位数据进行清洗与预处理
    需求：
        1. 读取 `全国-热门城市岗位数据.csv` 文件
        2. 对重复行进行清洗。
        3. 对`工作地址`字段进行预处理。要求：北京·海淀区·西北旺 --&gt; 北京，海淀区，西北旺。分隔成3个字段
        4. 对`薪资`字段进行预处理。要求：30-60K·15薪 --&gt; 最低：30，最高：60
        5. 对`工作经验`字段进行预处理。要求：经验不限/在校/应届 ：0，1-3年：1，3-5年：2，5-10年：3，10年以上:4
        6. 对`企业规模`字段进行预处理。要求：500人以下：0，500-999：1，1000-9999：2，10000人以上：3
        7. 对`岗位福利`字段进行预处理。要求：将描述中的中文'，'（逗号）,替换成英文','（逗号）
        8. 对缺失值所在行进行清洗。
        9. 将处理后的数据保存到 MySQL 数据库
"""</span>
<span class="token comment"># 导入模块</span>
<span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
<span class="token keyword">from</span> sqlalchemy <span class="token keyword">import</span> create_engine
<span class="token keyword">import</span> logging

<span class="token comment"># 读取 全国-热门城市岗位招聘数据.csv 文件</span>
all_city_zp_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">'../全国-热门城市岗位数据.csv'</span><span class="token punctuation">,</span> encoding<span class="token operator">=</span><span class="token string">'utf8'</span><span class="token punctuation">)</span>

<span class="token comment"># 对重复行进行清洗。</span>
all_city_zp_df<span class="token punctuation">.</span>drop_duplicates<span class="token punctuation">(</span>inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>

<span class="token comment"># 对`工作地址`字段进行预处理。要求：北京·海淀区·西北旺 --&gt; 北京，海淀区，西北旺。分隔成3个字段</span>
all_city_zp_area_df <span class="token operator">=</span> all_city_zp_df<span class="token punctuation">[</span><span class="token string">'job_area'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'·'</span><span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
all_city_zp_area_df <span class="token operator">=</span> all_city_zp_area_df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">"city"</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">"district"</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span> <span class="token string">"street"</span><span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment"># 对`薪资`字段进行预处理。要求：30-60K·15薪 --&gt; 最低：30，最高：60</span>
all_city_zp_salary_df <span class="token operator">=</span> all_city_zp_df<span class="token punctuation">[</span><span class="token string">'job_salary'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'K'</span><span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'-'</span><span class="token punctuation">,</span> expand<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
all_city_zp_salary_df <span class="token operator">=</span> all_city_zp_salary_df<span class="token punctuation">.</span>rename<span class="token punctuation">(</span>columns<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token number">0</span><span class="token punctuation">:</span> <span class="token string">'salary_lower'</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">:</span> <span class="token string">'salary_high'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment"># 对`工作经验`字段进行预处理。要求：经验不限/在校/应届 ：0，1-3年：1，3-5年：2，5-10年：3，10年以上:4</span>
<span class="token keyword">def</span> <span class="token function">fun_work_year</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> x <span class="token keyword">in</span> <span class="token string">"1-3年"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">elif</span> x <span class="token keyword">in</span> <span class="token string">"3-5年"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">2</span>
    <span class="token keyword">elif</span> x <span class="token keyword">in</span> <span class="token string">"5-10年"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">3</span>
    <span class="token keyword">elif</span> x <span class="token keyword">in</span> <span class="token string">"10年以上"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">4</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>


all_city_zp_df<span class="token punctuation">[</span><span class="token string">'work_year'</span><span class="token punctuation">]</span> <span class="token operator">=</span> all_city_zp_df<span class="token punctuation">[</span><span class="token string">'work_year'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">apply</span><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">:</span> fun_work_year<span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment"># 对`企业规模`字段进行预处理。要求：500人以下：0，500-999：1，1000-9999：2，10000人以上：3</span>
<span class="token keyword">def</span> <span class="token function">fun_com_size</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> x <span class="token keyword">in</span> <span class="token string">"500-999人"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">1</span>
    <span class="token keyword">elif</span> x <span class="token keyword">in</span> <span class="token string">"1000-9999人"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">2</span>
    <span class="token keyword">elif</span> x <span class="token keyword">in</span> <span class="token string">"10000人以上"</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">3</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token number">0</span>


<span class="token comment"># 对`岗位福利`字段进行预处理。要求：将描述中的中文'，'（逗号）,替换成英文','（逗号）</span>
all_city_zp_df<span class="token punctuation">[</span><span class="token string">'job_benefits'</span><span class="token punctuation">]</span> <span class="token operator">=</span> all_city_zp_df<span class="token punctuation">[</span><span class="token string">'job_benefits'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token builtin">str</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">'，'</span><span class="token punctuation">,</span> <span class="token string">','</span><span class="token punctuation">)</span>

<span class="token comment"># 合并所有数据集</span>
clean_all_city_zp_df <span class="token operator">=</span> pd<span class="token punctuation">.</span>concat<span class="token punctuation">(</span><span class="token punctuation">[</span>all_city_zp_df<span class="token punctuation">,</span> all_city_zp_salary_df<span class="token punctuation">,</span> all_city_zp_area_df<span class="token punctuation">]</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>

<span class="token comment"># 删除冗余列</span>
clean_all_city_zp_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'job_area'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 删除原区域</span>
clean_all_city_zp_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span><span class="token string">'job_salary'</span><span class="token punctuation">,</span> axis<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 删除原薪资</span>

<span class="token comment"># 对缺失值所在行进行清洗。</span>
clean_all_city_zp_df<span class="token punctuation">.</span>dropna<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> how<span class="token operator">=</span><span class="token string">'any'</span><span class="token punctuation">,</span> inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
clean_all_city_zp_df<span class="token punctuation">.</span>drop<span class="token punctuation">(</span>axis<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span>
                          index<span class="token operator">=</span><span class="token punctuation">(</span>clean_all_city_zp_df<span class="token punctuation">.</span>loc<span class="token punctuation">[</span><span class="token punctuation">(</span>clean_all_city_zp_df<span class="token punctuation">[</span><span class="token string">'job_benefits'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'None'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">.</span>index<span class="token punctuation">)</span><span class="token punctuation">,</span>
                          inplace<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token comment"># 将处理后的数据保存到 MySQL 数据库</span>
engine <span class="token operator">=</span> create_engine<span class="token punctuation">(</span><span class="token string">'mysql+pymysql://root:123456@localhost:3306/bosszp_db?charset=utf8'</span><span class="token punctuation">)</span>
clean_all_city_zp_df<span class="token punctuation">.</span>to_sql<span class="token punctuation">(</span><span class="token string">'t_boss_zp_info'</span><span class="token punctuation">,</span> con<span class="token operator">=</span>engine<span class="token punctuation">,</span> if_exists<span class="token operator">=</span><span class="token string">'replace'</span><span class="token punctuation">)</span>
logging<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token string">"Write to MySQL Successfully!"</span><span class="token punctuation">)</span>
</code></pre> 
<p>运行程序，检查数据是否清洗成功和插入到数据库。<br> <img src="https://images2.imgbox.com/5d/bb/UEIjRlZb_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="4__333"></a>4 数据分析与可视化</h2> 
<p>成功运行上面两个流程后，我们已经得到了可用于数据分析的高质量数据。拿到这些数据以后，我们使用 python + sql 脚本的方式对数据进行多维度分析，并使用 highcharts 工具进行数据可视化。整个分析可视化通过轻量化 WEB 框架 Flask 来进行部署。</p> 
<h3><a id="Flask_338"></a>Flask框架介绍</h3> 
<p>Flask是一个基于Werkzeug和Jinja2的轻量级Web应用程序框架。与其他同类型框架相比，Flask的灵活性、轻便性和安全性更高，而且容易上手，它可以与MVC模式很好地结合进行开发。Flask也有强大的定制性，开发者可以依据实际需要增加相应的功能，在实现丰富的功能和扩展的同时能够保证核心功能的简单。Flask丰富的插件库能够让用户实现网站定制的个性化，从而开发出功能强大的网站。</p> 
<p>本项目在Flask开发后端时，前端请求会遇到跨域的问题，解决该问题有修改数据类型为jsonp，采用GET方法，或者在Flask端加上响应头等方式，在此使用安装Flask-CORS库的方式解决跨域问题。此外需要安装请求库axios。</p> 
<p><strong>Flask框架图</strong></p> 
<p><img src="https://images2.imgbox.com/1a/06/ufNmMSSJ_o.png" alt="在这里插入图片描述"></p> 
<p><strong>编写可视化代码</strong></p> 
<pre><code class="prism language-python"><span class="token comment"># -*- coding:utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
    作者：jhzhong
    功能：数据分析于可视化
"""</span>

<span class="token keyword">from</span> flask <span class="token keyword">import</span> Flask<span class="token punctuation">,</span> render_template
<span class="token keyword">from</span> bosszp<span class="token punctuation">.</span>web<span class="token punctuation">.</span>dbutils <span class="token keyword">import</span> DBUtils
<span class="token keyword">import</span> json

app <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">get_db_conn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取数据库连接
    :return: db_conn 数据库连接对象
    """</span>
    <span class="token keyword">return</span> DBUtils<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'localhost'</span><span class="token punctuation">,</span> user<span class="token operator">=</span><span class="token string">'root'</span><span class="token punctuation">,</span> passw<span class="token operator">=</span><span class="token string">'123456'</span><span class="token punctuation">,</span> db<span class="token operator">=</span><span class="token string">'bosszp_db'</span><span class="token punctuation">)</span>


<span class="token keyword">def</span> <span class="token function">msg</span><span class="token punctuation">(</span>status<span class="token punctuation">,</span> data<span class="token operator">=</span><span class="token string">'未加载到数据'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    :param status: 状态码 200成功，201未找到数据
    :param data: 响应数据
    :return: 字典 如{'status': 201, 'data': ‘未加载到数据’}
    """</span>
    <span class="token keyword">return</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'status'</span><span class="token punctuation">:</span> status<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">:</span> data<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    首页
    :return: index.html 跳转到首页
    """</span>
    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'index.html'</span><span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/getwordcloud'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_word_cloud</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取岗位福利词云数据
    :return:
    """</span>
    db_conn <span class="token operator">=</span> get_db_conn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    text <span class="token operator">=</span> \
        db_conn<span class="token punctuation">.</span>get_one<span class="token punctuation">(</span>sql_str<span class="token operator">=</span><span class="token string">"SELECT GROUP_CONCAT(job_benefits) FROM t_boss_zp_info"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
    <span class="token keyword">if</span> text <span class="token keyword">is</span> <span class="token boolean">None</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> text<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/getjobinfo'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_job_info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取热门岗位招聘区域分布
    :return:
    """</span>
    db_conn <span class="token operator">=</span> get_db_conn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> db_conn<span class="token punctuation">.</span>get_all<span class="token punctuation">(</span>
        sql_str<span class="token operator">=</span><span class="token string">"SELECT city,district,COUNT(1) as num FROM t_boss_zp_info GROUP BY city,district"</span><span class="token punctuation">)</span>
    <span class="token comment"># {"city":"北京","info":[{"district":"朝阳区","num":27},{"海淀区":43}]}</span>

    <span class="token keyword">if</span> results <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    city_detail <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">:</span>
        info <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'value'</span><span class="token punctuation">:</span> r<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">}</span>
        <span class="token keyword">if</span> r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">not</span> <span class="token keyword">in</span> city_detail<span class="token punctuation">:</span>
            city_detail<span class="token punctuation">[</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>info<span class="token punctuation">]</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            city_detail<span class="token punctuation">[</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">.</span>append<span class="token punctuation">(</span>info<span class="token punctuation">)</span>
    <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token keyword">in</span> city_detail<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        temp <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> k<span class="token punctuation">,</span> <span class="token string">'data'</span><span class="token punctuation">:</span> v<span class="token punctuation">}</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span>temp<span class="token punctuation">)</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/getjobnum'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_job_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取个城市岗位数量
    :return:
    """</span>
    db_conn <span class="token operator">=</span> get_db_conn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> db_conn<span class="token punctuation">.</span>get_all<span class="token punctuation">(</span>sql_str<span class="token operator">=</span><span class="token string">"SELECT city,COUNT(1) num FROM t_boss_zp_info GROUP BY city"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> results <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> results <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">:</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>


<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/getcomtypenum'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">get_com_type_num</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取企业类型占比
    :return:
    """</span>
    db_conn <span class="token operator">=</span> get_db_conn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> db_conn<span class="token punctuation">.</span>get_all<span class="token punctuation">(</span>
        sql_str<span class="token operator">=</span><span class="token string">"SELECT com_type, ROUND(COUNT(1)/(SELECT SUM(t1.num) FROM (SELECT COUNT(1) num FROM t_boss_zp_info GROUP BY com_type) t1)*100,2) percent FROM t_boss_zp_info GROUP BY com_type"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> results <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">:</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'name'</span><span class="token punctuation">:</span> r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">:</span> <span class="token builtin">float</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>


<span class="token comment"># 扇形图</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/geteducationnum'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">geteducationnum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取学历占比
    :return:
    """</span>
    db_conn <span class="token operator">=</span> get_db_conn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> db_conn<span class="token punctuation">.</span>get_all<span class="token punctuation">(</span>
        sql_str<span class="token operator">=</span><span class="token string">"SELECT t1.education,ROUND(t1.num/(SELECT SUM(t2.num) FROM(SELECT COUNT(1) num FROM t_boss_zp_info t GROUP BY t.education)t2)*100,2) FROM( SELECT t.education,COUNT(1) num FROM t_boss_zp_info t GROUP BY t.education) t1"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> results <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> r <span class="token keyword">in</span> results<span class="token punctuation">:</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">[</span>r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">float</span><span class="token punctuation">(</span>r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>


<span class="token comment"># 获取排行榜</span>
<span class="token decorator annotation punctuation">@app<span class="token punctuation">.</span>route</span><span class="token punctuation">(</span><span class="token string">'/getorder'</span><span class="token punctuation">)</span>
<span class="token keyword">def</span> <span class="token function">getorder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    获取企业招聘数量排行榜
    :return:
    """</span>
    db_conn <span class="token operator">=</span> get_db_conn<span class="token punctuation">(</span><span class="token punctuation">)</span>
    results <span class="token operator">=</span> db_conn<span class="token punctuation">.</span>get_all<span class="token punctuation">(</span>
        sql_str<span class="token operator">=</span><span class="token string">"SELECT t.com_name,COUNT(1) FROM t_boss_zp_info t GROUP BY t.com_name ORDER BY COUNT(1) DESC LIMIT 10"</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> results <span class="token keyword">is</span> <span class="token boolean">None</span> <span class="token keyword">or</span> <span class="token builtin">len</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">201</span><span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
    <span class="token keyword">for</span> i<span class="token punctuation">,</span> r <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">:</span>
        data<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token punctuation">{<!-- --></span><span class="token string">'id'</span><span class="token punctuation">:</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
                     <span class="token string">'name'</span><span class="token punctuation">:</span> r<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                     <span class="token string">'num'</span><span class="token punctuation">:</span> r<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> msg<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">,</span> data<span class="token punctuation">)</span>


<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>
    app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">,</span> port<span class="token operator">=</span><span class="token number">8080</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
</code></pre> 
<p><strong>运行</strong></p> 
<pre><code>python run --host=0.0.0.0
</code></pre> 
<p>现在在浏览器中打开 http://127.0.0.1:8080/ ，应该可以看到可视化大屏了。</p> 
<p><img src="https://images2.imgbox.com/54/b9/SdtZ7u3x_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="5__520"></a>5 最后</h2>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/b1fd9cbb1ee00d526df474cce7d30ab0/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">[Android Material Design]组件17 - RecyclerView</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/472489f11fe98dca68a96e47fb561f7a/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">vue-element-admin安装依赖报错</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>