<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>vue 中 canvas 和svg合用制作地图 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="vue 中 canvas 和svg合用制作地图" />
<meta property="og:description" content="&lt;template&gt; &lt;div class=&#34;contents&#34;&gt; &lt;div class=&#34;lefttop1-title&#34;&gt;区域&lt;/div&gt; &lt;img id=&#34;police&#34; src=&#34;../assets/police.svg&#34; style=&#34;display:none;&#34; width=&#34;395px&#34; height=&#34;343px&#34;&gt; &lt;div id=&#34;contentMap&#34; style=&#34;width: 100%;height: 95%;&#34;&gt; &lt;canvas id=&#34;areaCanvas&#34; width=&#34;395px&#34; height=&#34;343px&#34; style=&#34;width:90%;height:90%;margin-left:20px;&#34;&gt;&lt;/canvas&gt; &lt;/div&gt; &lt;/div&gt; &lt;/template&gt; &lt;script&gt; //vue中点在不规则图形中的判断 var inside = require( &#39;point-in-polygon&#39; ); import {generatePolygon} from &#39;../api/index.js&#39; export default { data () { return { collectionArr: [], } }, mounted () { // 地图坐标 generatePolygon().then(response =&gt; { this.collectionArr = response.data; this.drawPolygons(); }); }, methods: { //	地图 drawPolygons: function () { var canvas = document." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/5025f1902b6c1dad66c931b4d9ad8105/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2018-08-21T15:41:31+08:00" />
<meta property="article:modified_time" content="2018-08-21T15:41:31+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">vue 中 canvas 和svg合用制作地图</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <pre class="has"><code>&lt;template&gt;
  &lt;div class="contents"&gt;
    &lt;div class="lefttop1-title"&gt;区域&lt;/div&gt;
    &lt;img id="police" src="../assets/police.svg" style="display:none;"  width="395px" height="343px"&gt;
    &lt;div id="contentMap" style="width: 100%;height: 95%;"&gt;
      &lt;canvas id="areaCanvas" width="395px" height="343px" style="width:90%;height:90%;margin-left:20px;"&gt;&lt;/canvas&gt;
    &lt;/div&gt;
  &lt;/div&gt;
&lt;/template&gt;

&lt;script&gt;
  //vue中点在不规则图形中的判断
    var inside = require( 'point-in-polygon' );
    import {generatePolygon} from '../api/index.js'
    export default {
        data () {
            return {
                collectionArr: [],
            }
        },
        mounted () {
            // 地图坐标
          generatePolygon().then(response =&gt; {
            this.collectionArr = response.data;
            this.drawPolygons();
          });

        },
        methods: {
//			地图
            drawPolygons: function () {
              var canvas = document.getElementById( 'areaCanvas' );
              if ( null == canvas || !canvas.getContext ) return;
              var ctx = canvas.getContext( "2d" );

              var  img=document.getElementById("police");
              if(img.complete){
                ctx.drawImage(img, 0, 0);
              }else{
                img.onload = function() {
                  ctx.drawImage(img, 0, 0);
                }
              }

              //鼠标移动事件
              this.canvasMousemoveEvent( canvas, ctx );

              //click事件
              this.canvasClickEvent( canvas );
            },
            canvasMousemoveEvent: function ( canvas, ctx ) {
                var _this = this;
                canvas.onmousemove = function ( e ) {
                  //清除绘制图形
                  _this.clearPolygon(ctx,canvas);
                  //  ctx.clearRect( 0, 0, canvas.width, canvas.height );
                    var location = _this.getLocation( canvas, e.clientX, e.clientY );
                    _this.drawPolygonByPoint( ctx, location, e ,canvas);
                };
            },
            canvasClickEvent: function ( canvas ) {
                var _this = this;
                canvas.onclick = function ( e ) {
                    var location = _this.getLocation( canvas, e.clientX, e.clientY );
                    var count = 0;
                    _this.collectionArr.map( obj =&gt; {
                      var pointsArr = obj.polygon;
                        count++;
                        if ( location != null &amp;&amp; inside( location, pointsArr ) == true ) {
                            alert(obj.name);
                        }
                    } );
                };
            },
            drawPolygonByPoint: function ( ctx, location, e ,canvas) {
                //清除title
                this.clearTitle();
                this.collectionArr.map( obj =&gt; {
                  var pointsArr = obj.polygon;
                    if ( location != null &amp;&amp; inside( location, pointsArr ) == true ) {
                        //绘制高亮图形
                        this.drawHighLightPolygon( ctx, pointsArr,canvas );
                        this.displayTitle(e,obj.name);
                    }
                } );
            },
            clearTitle: function () {
                var div = document.getElementById( 'title' );
                if ( div != null ) {
                  document.body.removeChild(div);
                }
            },
            displayTitle: function ( e ,name) {
                var div = document.createElement( "div" );
                div.setAttribute( "id", "title" );
                div.style.position = "absolute";
                div.style.left = e.clientX + 10 + "px";
                div.style.top = e.clientY + "px"
                div.innerText = name;
                div.style.backgroundColor = "gray";
                div.style.zIndex = "9999";
                document.body.appendChild( div );
            },
            drawHighLightPolygon: function ( ctx, pointsArr ,canvas) {
                ctx.beginPath();
                for ( let i = 0; i &lt; pointsArr.length; i++ ) {
                  var pointX = Math.round(canvas.width * pointsArr[ i ][ 0 ])+1;
                  var pointY = Math.round(canvas.height * pointsArr[ i ][ 1 ])+1;
                  ctx.lineWidth=2;
                    if ( i == 0 ) {
                        ctx.moveTo( pointX, pointY );
                    } else if ( i &lt; pointsArr.length - 1 ) {
                        ctx.lineTo( pointX, pointY );
                    } else {
                        ctx.lineTo( pointX, pointY );
                        ctx.strokeStyle = "#FF7F00";

                        ctx.closePath();
                        ctx.stroke();
                    }
                }
            },
          clearPolygon: function(ctx,canvas){
            ctx.clearRect( 0, 0, canvas.width, canvas.height );
            var  img=document.getElementById("police");
            ctx.drawImage(img, 0, 0);
          },
            getLocation: function ( canvas, x, y ) {
                var bbox = canvas.getBoundingClientRect();
                return [ ( x - bbox.left ) * ( canvas.width / bbox.width )/canvas.width, ( y - bbox.top ) * ( canvas.height / bbox.height )/canvas.height ];
                /*
                 * 此处不用下面两行是为了防止使用CSS和JS改变了canvas的高宽之后是表面积拉大而实际
                 * 显示像素不变而造成的坐标获取不准的情况
                x: (x - bbox.left),
                y: (y - bbox.top)
                */
            },

        }
    }
&lt;/script&gt;
&lt;!-- Add "scoped" attribute to limit CSS to this component only --&gt;
&lt;style scoped&gt;
    .contents {
      float: left;
      height: 98.5%;
      width: 41.3%;
      border: 1px solid rgba(15, 208, 198, 0.50);
      box-shadow: inset 0 2px 19px 0 rgba(15, 208, 198, 0.80);
      margin-left: 1.4%;
      margin-right: 1.4%;
    }
    .lefttop1-title{
      text-align: center;
      color: #0FD0C6;
      font-size: 12px;
      background: url(../assets/Group.png) no-repeat;
      width: 170px;
      line-height: 25px;
      display: inline-block;
    }
&lt;/style&gt;


其中police.svg做地图，鼠标移动到某一区域，高亮显示该区域（在底图上只画出该区域）。
所有区域的坐标点使用svg导出的相对坐标，在画图时要根据canvas画布转换成绝对坐标。
collectionArr数据结构：
collectionArr: [{name:'区域一',polygon:[[0.0123,0.1723],...]},{name:'区域二',polygon:[[0.0123,0.1723],...]},...]</code></pre> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/932503fd56392b5367316be8c0ed40a9/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">mysql查询某一个或几个字段重复值是哪个，重复几条</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/00883391aede09e83c09f346e387e335/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">配置pod与容器--将内存资源分配给容器和Pod</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>