<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>腾讯混元大模型(待续) - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="腾讯混元大模型(待续)" />
<meta property="og:description" content="腾讯混元大模型（Tencent Hunyuan）是由腾讯研发的大语言模型，具备强大的中文创作能力，复杂语境下的逻辑推理能力，以及可靠的任务执行能力。
请求说明 类型
说明
请求协议
HTTPS 协议
请求方式
POST
请求地址
https://hunyuan.cloud.tencent.com/hyllm/v1/chat/completions
接口鉴权
签名鉴权机制
并发限制
默认单账号限制并发连接数为1路
Header参数 名称
值
Content-Type
application/json
Authorization
通过入参以及 SecretKey 加密获取，参考 签名生成﻿
输入参数 参数名称
必填
类型
描述
app_id
是
Integer
腾讯云账号的 APPID﻿
secret_id
是
String
官网 SecretId﻿
timestamp
是
Integer
当前 UNIX 时间戳，单位为秒，可记录发起 API 请求的时间。例如1529223702，如果与当前时间相差过大，会引起签名过期错误
expired
是
Integer
签名的有效期，是一个符合 UNIX Epoch 时间戳规范的数值，单位为秒；Expired 必须与 Timestamp 的差值小于90天
query_id
否
String
请求 ID，用于问题排查
temperature
否
Float
默认1.0，取值区间为[0.0, 2.0]，非必要不建议使用, 不合理的取值会影响效果" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/879adbbebcbd3b3023aa7c8b98df12c0/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-12-27T10:31:26+08:00" />
<meta property="article:modified_time" content="2023-12-27T10:31:26+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">腾讯混元大模型(待续)</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="htmledit_views">
                    <p>腾讯混元大模型（Tencent Hunyuan）是由腾讯研发的大语言模型，具备强大的中文创作能力，复杂语境下的逻辑推理能力，以及可靠的任务执行能力。</p> 
<h3 id="3bd41f45-159b-40fc-a502-ef0f8b4a1cb9">请求说明</h3> 
<table><tbody><tr><td> <p>类型</p> </td><td> <p>说明</p> </td></tr><tr><td> <p>请求协议</p> </td><td> <p>HTTPS 协议</p> </td></tr><tr><td> <p>请求方式</p> </td><td> <p>POST</p> </td></tr><tr><td> <p>请求地址</p> </td><td> <p><code>https://hunyuan.cloud.tencent.com/hyllm/v1/chat/completions</code></p> </td></tr><tr><td> <p>接口鉴权</p> </td><td> <p>签名鉴权机制</p> </td></tr><tr><td> <p>并发限制</p> </td><td> <p>默认单账号限制并发连接数为1路</p> </td></tr></tbody></table> 
<h4 id="e018994c-edec-44f6-9840-8ced55a6fa43">Header参数</h4> 
<table><tbody><tr><td> <p>名称</p> </td><td> <p>值</p> </td></tr><tr><td> <p>Content-Type</p> </td><td> <p>application/json</p> </td></tr><tr><td> <p>Authorization</p> </td><td> <p>通过入参以及 SecretKey 加密获取，参考 <a href="/document/product/1729/97732#532252ce-e960-48a7-8821-940a9ce2ccf3" rel="nofollow">签名生成</a>﻿</p> </td></tr></tbody></table> 
<h4 id="ef3dddf1-e6e1-40bc-b1dc-ab47f7199df2">输入参数</h4> 
<table><tbody><tr><td> <p>参数名称</p> </td><td> <p>必填</p> </td><td> <p>类型</p> </td><td> <p>描述</p> </td></tr><tr><td> <p>app_id</p> </td><td> <p>是</p> </td><td> <p>Integer</p> </td><td> <p>腾讯云账号的 <a href="https://console.cloud.tencent.com/cam/capi" rel="nofollow" title="APPID">APPID</a>﻿</p> </td></tr><tr><td> <p>secret_id</p> </td><td> <p>是</p> </td><td> <p>String</p> </td><td> <p>官网 <a href="https://console.cloud.tencent.com/cam/capi" rel="nofollow" title="SecretId">SecretId</a>﻿</p> </td></tr><tr><td> <p>timestamp</p> </td><td> <p>是</p> </td><td> <p>Integer</p> </td><td> <p>当前 UNIX 时间戳，单位为秒，可记录发起 API 请求的时间。例如1529223702，如果与当前时间相差过大，会引起签名过期错误</p> </td></tr><tr><td> <p>expired</p> </td><td> <p>是</p> </td><td> <p>Integer</p> </td><td> <p>签名的有效期，是一个符合 UNIX Epoch 时间戳规范的数值，单位为秒；Expired 必须与 Timestamp 的差值小于90天</p> </td></tr><tr><td> <p>query_id</p> </td><td> <p>否</p> </td><td> <p>String</p> </td><td> <p>请求 ID，用于问题排查</p> </td></tr><tr><td> <p>temperature</p> </td><td> <p>否</p> </td><td> <p>Float</p> </td><td> <p>默认1.0，取值区间为[0.0, 2.0]，非必要不建议使用, 不合理的取值会影响效果</p> <p>建议该参数和 top_p 只设置1个，不要同时更改</p> <p>较高的数值会使输出更加随机，而较低的数值会使其更加集中和确定</p> </td></tr><tr><td> <p>top_p</p> </td><td> <p>否</p> </td><td> <p>Float</p> </td><td> <p>默认1.0，取值区间为[0.0, 1.0]，非必要不建议使用, 不合理的取值会影响效果 建议该参数和 temperature 只设置1个，不要同时更改</p> <p>影响输出文本的多样性，取值越大，生成文本的多样性越强</p> </td></tr><tr><td> <p>stream</p> </td><td> <p>否</p> </td><td> <p>Integer</p> </td><td> <p>0：同步，1：流式 （默认，协议：SSE)</p> <p>同步请求超时：60s，如果内容较长建议使用流式</p> </td></tr><tr><td> <p>messages</p> </td><td> <p>是</p> </td><td> <p>Array of Message</p> </td><td> <p>会话内容, 按对话时间序排列，长度最多为40</p> <p>最大支持16k tokens上下文</p> </td></tr></tbody></table> 
<h5 id="3df6f4af-a90d-4277-b3a9-92bf84dbffcb">Message</h5> 
<table><tbody><tr><td> <p>参数名称</p> </td><td> <p>必填</p> </td><td> <p>类型</p> </td><td> <p>描述</p> </td></tr><tr><td> <p>role</p> </td><td> <p>是</p> </td><td> <p>String</p> </td><td> <p>当前支持以下：</p> <p>user：表示用户</p> <p>assistant：表示对话助手</p> <p>在 message 中必须是 user 与 assistant 交替(一问一答)</p> </td></tr><tr><td> <p>content</p> </td><td> <p>是</p> </td><td> <p>String</p> </td><td> <p>消息的内容</p> </td></tr></tbody></table> 
<h4 id="ce1700c5-4197-469b-b9f7-af9ddc4be3d9">输出参数</h4> 
<table><tbody><tr><td> <p>参数名称</p> </td><td> <p>类型</p> </td><td> <p>描述</p> </td></tr><tr><td> <p>choices</p> </td><td> <p>Array of ResponseChoices</p> </td><td> <p>结果</p> </td></tr><tr><td> <p>created</p> </td><td> <p>String</p> </td><td> <p>unix 时间戳的字符串</p> </td></tr><tr><td> <p>id</p> </td><td> <p>String</p> </td><td> <p>会话 id</p> </td></tr><tr><td> <p>usage</p> </td><td> <p>ResponseUsage</p> </td><td> <p>token 数量</p> </td></tr><tr><td> <p>error</p> </td><td> <p>ResponseError</p> </td><td> <p>错误信息</p> <p>注意：此字段可能返回 null，表示取不到有效值</p> </td></tr><tr><td> <p>note</p> </td><td> <p>String</p> </td><td> <p>注释</p> </td></tr><tr><td> <p>req_id</p> </td><td> <p>String</p> </td><td> <p>唯一请求 ID，每次请求都会返回。用于反馈接口入参</p> </td></tr></tbody></table> 
<h5 id="35efbdc8-1447-44c8-a4b6-74f5690fd05f">ResponseError</h5> 
<table><tbody><tr><td> <p>参数名称</p> </td><td> <p>类型</p> </td><td> <p>描述</p> </td></tr><tr><td> <p>message</p> </td><td> <p>String</p> </td><td> <p>错误提示信息</p> </td></tr><tr><td> <p>code</p> </td><td> <p>Integer</p> </td><td> <p>错误码</p> </td></tr></tbody></table> 
<h5 id="4f491ead-0483-4cfc-99c3-b6761610dc9e">ResponseUsage</h5> 
<table><tbody><tr><td> <p>参数名称</p> </td><td> <p>类型</p> </td><td> <p>描述</p> </td></tr><tr><td> <p>prompt_tokens</p> </td><td> <p>Integer</p> </td><td> <p>输入 token 数量</p> </td></tr><tr><td> <p>total_tokens</p> </td><td> <p>Integer</p> </td><td> <p>总 token 数量</p> </td></tr><tr><td> <p>completion_tokens</p> </td><td> <p>Integer</p> </td><td> <p>输出 token 数量</p> </td></tr></tbody></table> 
<h5 id="5aa373a3-c58f-4401-8ac4-540c477d6af0">ResponseChoices</h5> 
<table><tbody><tr><td> <p>参数名称</p> </td><td> <p>类型</p> </td><td> <p>描述</p> </td></tr><tr><td> <p>finish_reason</p> </td><td> <p>String</p> </td><td> <p>流式结束标志位，为 stop 则表示尾包</p> </td></tr><tr><td> <p>messages</p> </td><td> <p>Message</p> </td><td> <p>内容，同步模式返回内容，流模式为 null</p> </td></tr><tr><td> <p>delta</p> </td><td> <p>ResponseChoicesDelta</p> </td><td> <p>内容，流模式返回内容，同步模式为 null</p> </td></tr></tbody></table> 
<h5 id="9639ec93-cd55-4cf6-933f-f7b07a1df15f">ResponseChoicesDelta</h5> 
<table><tbody><tr><td> <p>参数名称</p> </td><td> <p>类型</p> </td><td> <p>描述</p> </td></tr><tr><td> <p>content</p> </td><td> <p>String</p> </td><td> <p>响应文本</p> </td></tr></tbody></table> 
<h5 id="ec63dc21-fdc5-4c0e-b71a-e7d6bd5af595">Message</h5> 
<table><tbody><tr><td> <p>参数名称</p> </td><td> <p>必填</p> </td><td> <p>类型</p> </td><td> <p>描述</p> </td></tr><tr><td> <p>role</p> </td><td> <p>否</p> </td><td> <p>String</p> </td><td> <p>当前支持以下：</p> <p>user: 表示用户</p> <p>assistant：表示对话助手</p> <p>在 message 中必须是 user 与 assistant 交替(一问一答)</p> </td></tr><tr><td> <p>content</p> </td><td> <p>是</p> </td><td> <p>String</p> </td><td> <p>消息的内容</p> </td></tr></tbody></table> 
<p> </p> 
<p> </p> 
<h3 id="f5b1ae9d-c04a-4edc-9ea3-1e723d59a3db">接口调用流程</h3> 
<p>1. 请求参数配置</p> 
<blockquote> 
 <p>{"app_id":251139068,"secret_id":"AKIDKXYP*********KCsOgkaBYjfRIxOde3","query_id":"test_query_id_97507240-a7fc-440c-9944-8e7a1254eb84","messages":[{"role":"user","content":"介绍下你自己"}],"temperature":0,"top_p":0.8,"stream":0,"timestamp":1695032592,"expired":1695118992}</p> 
</blockquote> 
<p>2. 根据参数生成签名，签名逻辑参考<a href="/document/product/1729/97732#bac1763f-47e3-4564-8712-9a510b60fabd" rel="nofollow">签名生成</a>，获取到 signature为 asytbZ3Ap4N0ajy8c3C+mqoqTv8=</p> 
<p>3. 通过 http post 方式请求接口，signature 放到 header 中，参数放到 body 中。</p> 
<blockquote> 
 <p>curl -H 'Content-Type: application/json' -H 'Authorization: asytb************3C+mqoqTv8=' -v https://hunyuan.cloud.tencent.com/hyllm/v1/chat/completions -d '{"app_id":251139068,"secret_id":"AKIDK************NKCsOgkaBYjfRIxOde3","query_id":"test_query_id_97507240-a7fc-440c-9944-8e7a1254eb84","messages":[{"role":"user","content":"介绍下你自己"}],"temperature":0,"top_p":0.8,"stream":0,"timestamp":1695032592,"expired":1695118992}'</p> 
</blockquote> 
<h3 id="532252ce-e960-48a7-8821-940a9ce2ccf3">签名生成</h3> 
<p>1. 对所有参数按字典序进行排序，请求 URL <code>hunyuan.cloud.tencent.com/hyllm/v1/chat/completions </code>（不包含协议部分：https://）作为签名原文，这里以 <code>app_id=25*****68, secret_id=AKID3************5sXzIZ</code> 为例拼接签名原文，则拼接的签名原文为：(<strong>注意：float 类型参数需要去掉无效的0；messages 需要通过字符串的方式拼接，不要使用 json 库直接转字符串，json 库可能会对特殊字符进行转义；body 传参时依然是要 Message 类型</strong>)</p> 
<blockquote> 
 <p>#messsage字符串拼接示例</p> 
 <p>messagestr = ','.join(['{<!-- -->{"role":"{}","content":"{}"}}'.format(message["role"], message["content"]) for message in data["messages"]])</p> 
 <p>messagestr = '[{}]'.format(messagestr)</p> 
</blockquote> 
<blockquote> 
 <p> hunyuan.cloud.tencent.com/hyllm/v1/chat/completions?app_id=25*****68&amp;expired=1694838136&amp;messages=[{"role":"user","content":"介绍下你自己"}]&amp;query_id=test_query_id_6a8e4dc8-1c6e-4ece-aceb-d4554cdf4525&amp;secret_id=AKID3************5sXzIZ&amp;stream=1&amp;temperature=0&amp;timestamp=1694751736&amp;top_p=0.8</p> 
</blockquote> 
<p></p> 
<p>2. 对签名原文使用 secret_key 进行 HmacSha1 加密，之后再进行 base64 编码。例如对上一步的签名原文 <code>secret_key=*****PXQ5WihT5ZsxrXylV6b5n******</code>，使用 HmacSha1 算法进行加密并做 base64 编码处理：</p> 
<blockquote> 
 <pre>Base64Encode(HmacSha1("hunyuan.cloud.tencent.com/hyllm/v1/chat/completions?app_id=25*****68&amp;expired=1694838136&amp;messages=[{"role":"user","content":"介绍下你自己"}]&amp;query_id=test_query_id_6a8e4dc8-1c6e-4ece-aceb-d4554cdf4525&amp;secret_id=AKID3************5sXzIZ&amp;stream=1&amp;temperature=0&amp;timestamp=1694751736&amp;top_p=0.8", "*****PXQ5WihT5ZsxrXylV6b5n******"))
</pre> 
</blockquote> 
<p>3. 得到 signature 签名值为：</p> 
<p>psTRsva/*********OhaiDMowic=</p> 
<p>4. 将 signature 作为 header 传入</p> 
<p>header["Authorization"] = "psTRsva/*********OhaiDMowic="</p> 
<h3 id="9f4542b7-fa09-4f23-a533-1b98bfb99783">签名FAQ</h3> 
<p>1. signature calculated is different from client signature</p> 
<p>检查参数拼接顺序是否按照字典序排序、检查 float 类型参数参与签名是否去掉无意义0（比如 temperature=1.0 参与签名应为 temperature=1），检查 messages 内容是否正确，这里需要通过字符串方式进行拼接，<strong>不可使用 json 库转字符串</strong></p> 
<p>检查 secret_key 是否填写正确</p> 
<p>检查签名方法是否正确，签名方法可参考下面代码示例（注意：示例代码中 *****PXQ5WihT5ZsxrXylV6b5n****** 密钥需替换为自己的 secret_key）</p> 
<pre><code class="language-python"># -*- coding: utf-8 -*-
import hmac
import hashlib
import base64

sign_str = 'hunyuan.cloud.tencent.com/hyllm/v1/chat/completions?app_id=251139068&amp;expired=1694838136&amp;messages=' \
           '[{"role":"user","content":"介绍下你自己"}]&amp;query_id=test_query_id_6a8e4dc8-1c6e-4ece-aceb-d4554cdf4525' \
           '&amp;secret_id=AKID3xxxxxxxxxoYL5sXzIZ&amp;stream=1&amp;temperature=0&amp;timestamp=1694751736&amp;top_p=0.8'
hmacstr = hmac.new("*****PXQ5WihT5ZsxrXylV6b5n******".encode('utf-8'),
                   sign_str.encode(
                       'utf-8'), hashlib.sha1).digest()
s = base64.b64encode(hmacstr)
s = s.decode('utf-8')
print(s)</code></pre> 
<p>2. signature is expired</p> 
<p>检查 expired 参数值是否正确，时间戳单位为秒，一般在当前时间基础上加上一定秒数即可</p> 
<p>3. permission verify</p> 
<p>检查 APPID 是否正确，不要把 UIN 当成 APPID</p> 
<p>4. The header 'Authorization' is nil!</p> 
<p>signature 作为 header 传入</p> 
<h3 id="24473af7-7bbd-4ff0-8f4e-90e871114828">错误码</h3> 
<table><tbody><tr><td> <p>错误码</p> </td><td> <p>说明</p> </td></tr><tr><td> <p>1001</p> </td><td> <p>参数不合法，具体详情参考错误信息</p> </td></tr><tr><td> <p>1002</p> </td><td> <p>参数值不合法，具体详情参考错误信息</p> </td></tr><tr><td> <p>1003</p> </td><td> <p>文本内容存在敏感信息</p> </td></tr><tr><td> <p>2000</p> </td><td> <p>服务端未知错误</p> </td></tr><tr><td> <p>2001</p> </td><td> <p>鉴权失败，请参考签名生成</p> </td></tr><tr><td> <p>2002</p> </td><td> <p>非白名单账号，请先申请试用</p> </td></tr><tr><td> <p>2003</p> </td><td> <p>请求限流，如需调整限频请联系产品</p> </td></tr><tr><td> <p>4000</p> </td><td> <p>算法服务未知错误</p> </td></tr><tr><td> <p>4001</p> </td><td> <p>算法服务请求超时</p> </td></tr><tr><td> <p>4002</p> </td><td> <p>算法服务异常</p> </td></tr><tr><td> <p>4003</p> </td><td> <p>模型参数错误</p> </td></tr><tr><td> <p>4004</p> </td><td> <p>模型解析错误</p> </td></tr><tr><td> <p>4005</p> </td><td> <p>模型内部错误</p> </td></tr><tr><td> <p>4006</p> </td><td> <p>算法服务权限错误</p> </td></tr></tbody></table> 
<p> </p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/8dc0cc04ecbe4cd569af0be902b77c13/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Linux入门攻坚——10、Linux程序包管理-2</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/1af06105e240c8a4c8700846fa7c21b2/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">应用于前端的自然断点法：wasm应用示例</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>