<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Docker_tls加密通讯 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Docker_tls加密通讯" />
<meta property="og:description" content="TLS 一.TLS1.docker容器与虚拟机区别1）隔离与共享2）性能与损耗 2.docker存在的安全问题1）Docker自身漏洞2）docker源码问题 3.docker架构缺陷与安全机制1）容器之间的局域网攻击2）DDos攻击耗尽资源3）有漏洞的系统调用4）共享root用户权限 二.docker安全基线标准1.内核级别2.主机级别3.网络级别4.镜像级别5.容器级别6.其他设置 三.docker-TLS加密通信1.加密通信流程2.密钥3.签名4.hash值5.证书6.通讯加密1）生成ca密钥2)生成ca证书3）生成服务器私钥4）生成服务器证书5）生成客户端密钥6）生成客户端证书7）删除多余文件8） 配置docker，指定tls证书的路径、开放的端口、通信的进程等9）将 /tls/ca.pem /tls/cert.pem /tls/key.pem 三个文件复制到另一台主机 10）本地验证 一.TLS 1.docker容器与虚拟机区别 1）隔离与共享 docker 底层的技术–cgroup namespaces Hypervisordocker 底层 aufs(堆叠的文件系统) bootfs rootfs lxc base image GFS VM实现的是操作系统的之前/级别的隔离
共享的是一套物理资源(宿主机内核驱动提供的 kvm qemu）
docker容器通过隔离的方式，将文件系统、进程、设备、网络等资源进行隔离
让容器之间互不影响，容器与宿主机共享内核、文件系统、硬件等资源 2）性能与损耗 与虚拟机相比，容器资源损耗要少(90%),同样的宿主机下，能够建立容器的数量要比虚拟机多，但是虚拟机的安全性要比容器稍好
2.docker存在的安全问题 1）Docker自身漏洞 k8s------生产环境----1.15 1.20&#43;run time --k8s之后会使用自身的一套运行时技术
攻击的方式：代码执行(cron）、权限提升、信息泄露、权限绕过
2）docker源码问题 docker提供了 docker hub 可让用户上传创建的镜像 1.黑客上传恶意镜像
2.镜像使用有漏洞的软件，docker hub 上能下载的镜像里面75%都装了漏洞软件
需要检查里面软件版本信息
3.中间人攻击篡改镜像 镜像在传输过程中可能被篡改
3.docker架构缺陷与安全机制 docker本身架构与机制可能产生问题 1）容器之间的局域网攻击 主机上容器之间可构成局域网，ARP欺骗，嗅探。广播风暴等攻击
2）DDos攻击耗尽资源 cgroups安全机制就是要防止此类攻击的，不要为单一的容器分配过多的资源即可避免此类问题
3）有漏洞的系统调用 docker与虚拟机的一个重要的区别就是要防止此类攻击，不要为单一的容器分配过多的资源即可避免此类的问题 VM:KVM集成在内核，逻辑分割物理资源/抽象化物理资源，拦截一些敏感指定
(I/O），转给Qemu进行处理
操作系统隔离，安全性更高
4）共享root用户权限 如果root用户权限运行容器，容器内的root用户也就有了宿主机的root权限 二.docker安全基线标准 下面从内核、主机、网络、镜像、容器等总结" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/d7867d4b8ead7fcf94064a3b724fd280/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2021-06-08T14:39:09+08:00" />
<meta property="article:modified_time" content="2021-06-08T14:39:09+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Docker_tls加密通讯</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-dracula">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>TLS</h4> 
 <ul><li><a href="#TLS_1" rel="nofollow">一.TLS</a></li><li><ul><li><ul><li><a href="#1docker_3" rel="nofollow">1.docker容器与虚拟机区别</a></li><li><ul><li><a href="#1_5" rel="nofollow">1）隔离与共享</a></li><li><a href="#2_20" rel="nofollow">2）性能与损耗</a></li></ul> 
    </li><li><a href="#2docker_26" rel="nofollow">2.docker存在的安全问题</a></li><li><ul><li><ul><li><a href="#1Docker_29" rel="nofollow">1）Docker自身漏洞</a></li><li><a href="#2docker_37" rel="nofollow">2）docker源码问题</a></li></ul> 
    </li></ul> 
    </li><li><a href="#3docker_53" rel="nofollow">3.docker架构缺陷与安全机制</a></li><li><ul><li><ul><li><a href="#1_57" rel="nofollow">1）容器之间的局域网攻击</a></li><li><a href="#2DDos_61" rel="nofollow">2）DDos攻击耗尽资源</a></li><li><a href="#3_66" rel="nofollow">3）有漏洞的系统调用</a></li><li><a href="#4root_76" rel="nofollow">4）共享root用户权限</a></li></ul> 
    </li></ul> 
   </li></ul> 
   </li><li><a href="#docker_86" rel="nofollow">二.docker安全基线标准</a></li><li><ul><li><ul><li><a href="#1_92" rel="nofollow">1.内核级别</a></li><li><a href="#2_109" rel="nofollow">2.主机级别</a></li><li><a href="#3_138" rel="nofollow">3.网络级别</a></li><li><a href="#4_157" rel="nofollow">4.镜像级别</a></li><li><a href="#5_176" rel="nofollow">5.容器级别</a></li><li><a href="#6_198" rel="nofollow">6.其他设置</a></li></ul> 
    </li><li><a href="#dockerTLS_223" rel="nofollow">三.docker-TLS加密通信</a></li><li><ul><li><a href="#1_225" rel="nofollow">1.加密通信流程</a></li><li><a href="#2_248" rel="nofollow">2.密钥</a></li><li><a href="#3_256" rel="nofollow">3.签名</a></li><li><a href="#4hash_262" rel="nofollow">4.hash值</a></li><li><a href="#5_266" rel="nofollow">5.证书</a></li><li><a href="#6_274" rel="nofollow">6.通讯加密</a></li><li><ul><li><a href="#1ca_304" rel="nofollow">1）生成ca密钥</a></li><li><a href="#2ca_321" rel="nofollow">2)生成ca证书</a></li><li><a href="#3_340" rel="nofollow">3）生成服务器私钥</a></li><li><a href="#4_351" rel="nofollow">4）生成服务器证书</a></li><li><a href="#5_367" rel="nofollow">5）生成客户端密钥</a></li><li><a href="#6_378" rel="nofollow">6）生成客户端证书</a></li><li><a href="#7_399" rel="nofollow">7）删除多余文件</a></li><li><ul><li><a href="#8_dockertls_411" rel="nofollow">8） 配置docker，指定tls证书的路径、开放的端口、通信的进程等</a></li><li><a href="#9_tlscapem_tlscertpem_tlskeypem__425" rel="nofollow">9）将 /tls/ca.pem /tls/cert.pem /tls/key.pem 三个文件复制到另一台主机</a></li></ul> 
      </li><li><a href="#10_438" rel="nofollow">10）本地验证</a></li></ul> 
    </li></ul> 
   </li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h2><a id="TLS_1"></a>一.TLS</h2> 
<h4><a id="1docker_3"></a>1.docker容器与虚拟机区别</h4> 
<h5><a id="1_5"></a>1）隔离与共享</h5> 
<ul><li>docker 底层的技术–cgroup namespaces Hypervisor</li><li>docker 底层 aufs(堆叠的文件系统) bootfs rootfs lxc base image GFS</li></ul> 
<p>VM实现的是操作系统的之前/级别的隔离<br> 共享的是一套物理资源(宿主机内核驱动提供的 kvm qemu）</p> 
<p>docker容器通过隔离的方式，将文件系统、进程、设备、网络等资源进行隔离</p> 
<ul><li>让容器之间互不影响，容器与宿主机共享内核、文件系统、硬件等资源</li></ul> 
<h5><a id="2_20"></a>2）性能与损耗</h5> 
<p>与虚拟机相比，容器资源损耗要少(90%),同样的宿主机下，能够建立容器的数量要比虚拟机多，但是虚拟机的安全性要比容器稍好</p> 
<h4><a id="2docker_26"></a>2.docker存在的安全问题</h4> 
<h6><a id="1Docker_29"></a>1）Docker自身漏洞</h6> 
<ul><li> <p>k8s------生产环境----1.15 1.20+run time --k8s之后会使用自身的一套运行时技术</p> </li><li> <p>攻击的方式：代码执行(cron）、权限提升、信息泄露、权限绕过</p> </li></ul> 
<h6><a id="2docker_37"></a>2）docker源码问题</h6> 
<pre><code> docker提供了 docker hub 可让用户上传创建的镜像
</code></pre> 
<p>1.黑客上传恶意镜像</p> 
<p>2.镜像使用有漏洞的软件，docker hub 上能下载的镜像里面75%都装了漏洞软件<br> 需要检查里面软件版本信息</p> 
<p>3.中间人攻击篡改镜像 镜像在传输过程中可能被篡改</p> 
<h4><a id="3docker_53"></a>3.docker架构缺陷与安全机制</h4> 
<pre><code> docker本身架构与机制可能产生问题
</code></pre> 
<h6><a id="1_57"></a>1）容器之间的局域网攻击</h6> 
<p>主机上容器之间可构成局域网，ARP欺骗，嗅探。广播风暴等攻击</p> 
<h6><a id="2DDos_61"></a>2）DDos攻击耗尽资源</h6> 
<p>cgroups安全机制就是要防止此类攻击的，不要为单一的容器分配过多的资源即可避免此类问题</p> 
<h6><a id="3_66"></a>3）有漏洞的系统调用</h6> 
<pre><code>docker与虚拟机的一个重要的区别就是要防止此类攻击，不要为单一的容器分配过多的资源即可避免此类的问题
</code></pre> 
<p>VM:KVM集成在内核，逻辑分割物理资源/抽象化物理资源，拦截一些敏感指定<br> (I/O），转给Qemu进行处理<br> 操作系统隔离，安全性更高</p> 
<h6><a id="4root_76"></a>4）共享root用户权限</h6> 
<pre><code> 如果root用户权限运行容器，容器内的root用户也就有了宿主机的root权限
</code></pre> 
<h3><a id="docker_86"></a>二.docker安全基线标准</h3> 
<p><mark>下面从内核、主机、网络、镜像、容器等总结</mark></p> 
<h5><a id="1_92"></a>1.内核级别</h5> 
<p>1.及时更新内核</p> 
<p>2.user NameSpace(容器内的root权限在容器之外处于非高权限状态)</p> 
<p>3.cgroups(对资源和配额和度量)DDos</p> 
<p>4.capability(权限划分)</p> 
<p>5.seccomp(限定系统调用)</p> 
<p>6.禁止将容器的命名空间与宿主机进程命名空间共享</p> 
<h5><a id="2_109"></a>2.主机级别</h5> 
<p>1.为容器传镜独立分区</p> 
<p>2.仅运行必要的服务-----docker容器<br> 在linux优化方向------top—正在运行的服务/尤其一些占用资源大的一些服务<br> ----crontab----关闭、停止一些不必要的周期任务(at）、周期性（进行适量的拉长)</p> 
<p>3.禁止将宿主机上敏感目录映射到容器 （mysql数据、核心日志)</p> 
<p>4.对docker守护进程、相关文件和目录进行审计</p> 
<p>5.设置适当的默认文件描述字符</p> 
<p>6.用户权限为root的docker相关文件的访问权限应该为644或者更低权限</p> 
<p>7.周期性检查每个主机的容器清单，并清理不必要的容器</p> 
<h5><a id="3_138"></a>3.网络级别</h5> 
<p>1.通过iptables 设定规则实现禁止或允许容器之间网络流量(docker 0）</p> 
<p>2.允许docker 绑定iptables</p> 
<p>3.禁止docker绑定到其他 ip/port 或者 unix socket</p> 
<p>4.禁止在容器上映射特权端口</p> 
<p>5.容器上只开放所需的端口</p> 
<p>6.禁止在容器上使用主机的网络模式</p> 
<p>7.若宿主机有多个网卡，将容器进入流量绑定到特定的主机网卡上</p> 
<h5><a id="4_157"></a>4.镜像级别</h5> 
<p>1.创建本地镜像仓库服务器 harbor</p> 
<p>2.镜像中软件都为最新版本</p> 
<p>3.使用可信镜像文件，并通过安全通道下载</p> 
<p>4.重新构建镜像而非对容器和镜像进行打标签</p> 
<p>5.合理管理镜像标签，及时移除不再使用的镜像</p> 
<p>6.使用镜像扫描</p> 
<p>7.使用镜像签名</p> 
<h5><a id="5_176"></a>5.容器级别</h5> 
<p>1.容器最小化，操作系统镜像最小集</p> 
<p>2.容器以单一主进程的方式运行</p> 
<p>3.禁止privileged标记使用特权容器</p> 
<p>4禁止在容器上运行ssh服务</p> 
<p>5.以只读的方式挂载容器的根目录系统</p> 
<p>6.明确定义属于容器的数据盘符</p> 
<p>7.通过设置on-failure限制容器尝试重启次数，容器反复重启容易丢失数据</p> 
<h5><a id="6_198"></a>6.其他设置</h5> 
<p>1.定期对宿主机系统及容器进行安全审计</p> 
<p>2.使用最少资源和最低权限运行容器</p> 
<p>3.避免在同一宿主机上部署大量容器，维持在一个能够管理的数量</p> 
<p>4.监控docker容器的使用，性能以及其他各项指标</p> 
<p>5.增加实时威胁监测和事件响应功能</p> 
<p>6.使用中心和远程日志收集服务</p> 
<h4><a id="dockerTLS_223"></a>三.docker-TLS加密通信</h4> 
<h5><a id="1_225"></a>1.加密通信流程</h5> 
<p>先对明文—&gt;对称加密—&gt;形成密文和对称秘钥</p> 
<p>然后将对称秘钥+签名—&gt;非对称加密（私钥加密）—&gt;形成加密的秘钥</p> 
<p>使用hash算法算出hash值</p> 
<p>最后将密文、加密的秘钥、hash值传给对方</p> 
<p>对方收到这三样数据</p> 
<p>对加密的秘钥—&gt;非对称解密（公钥解密）—&gt;解密出对称秘<br> 钥和签名（签名用于身份认证）</p> 
<p>使用对称秘钥—&gt;对称解密—&gt;解密出明文<br> 对明文使用hash算法，对比传来的hash值</p> 
<p>一样说明没有被改动，读取数据；反之被改的，弃掉数据</p> 
<h5><a id="2_248"></a>2.密钥</h5> 
<pre><code>对称密钥（AES、DES、3DES） 相对于家里的锁和对应的钥匙
    效率高，但不安全
非对称密钥（rsa，公钥-私钥）相当于古代的虎符，不能从私钥推导出公钥
    效率不高（需要加密，转换慢）
</code></pre> 
<h5><a id="3_256"></a>3.签名</h5> 
<pre><code>签名就是身份信息
比如：使用支付宝转账时，谁转给了商家，转账的谁就是签名
</code></pre> 
<h5><a id="4hash_262"></a>4.hash值</h5> 
<pre><code>Hash算法是一个广义的算法，在这里做数字签名来保障数据传递的安全性，如何确保数据的安全性，通过hash值对比确定数据完整性和安全性。
</code></pre> 
<h5><a id="5_266"></a>5.证书</h5> 
<pre><code>证书格式：x509（国际标准），需要机构CA颁发
CA：电子认证服务，证书颁发机构，是受信任的第三方，承担公钥体系中的公钥的合法性建议的责任。

 首先CA先颁发ca证书，然后用证书和相关信息找CA颁发server证书、client证书，cilent证书要推送给client
</code></pre> 
<h5><a id="6_274"></a>6.通讯加密</h5> 
<table><thead><tr><th>主机名</th><th>操作系统</th><th>IP地址</th></tr></thead><tbody><tr><td>server</td><td>centos7</td><td>192.168.133.10</td></tr><tr><td>client</td><td>centos7</td><td>192.168.133.20</td></tr></tbody></table> 
<p>为了防止链路劫持、会话劫持等问题导致 Docker 通信时被中间人攻击，c/s 两端应该通过加密方式通讯。</p> 
<p><mark>server:192.168.133.10</mark></p> 
<ul><li>环境准备</li></ul> 
<pre><code class="prism language-powershell">hostnamectl <span class="token function">set-hostname</span> server
su

mkdir <span class="token operator">/</span>tls
cd <span class="token operator">/</span>tls

vim <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
127<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1   server
</code></pre> 
<p><img src="https://images2.imgbox.com/5e/d6/BVne2rXv_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="1ca_304"></a>1）生成ca密钥</h6> 
<pre><code class="prism language-powershell">/<span class="token operator">/</span>创建ca密钥
openssl genrsa <span class="token operator">-</span>aes256 <span class="token operator">-</span>out ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem 4096

相关参数:
genrsa     使用RSA算法产生私钥
<span class="token operator">-</span>aes256    使用256位密钥的AES算法对私钥进行加密
<span class="token operator">-</span>out       输出文件的路径
4096       秘钥的长度
</code></pre> 
<p><img src="https://images2.imgbox.com/3d/42/85RFY5kN_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="2ca_321"></a>2)生成ca证书</h6> 
<pre><code class="prism language-powershell">/<span class="token operator">/</span>创建ca证书；
openssl req <span class="token operator">-</span>new <span class="token operator">-</span>x509 <span class="token operator">-</span>days 1000 <span class="token operator">-</span>key ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem <span class="token operator">-</span>sha256 <span class="token operator">-</span>subj <span class="token string">"/CN=*"</span> <span class="token operator">-</span>out ca<span class="token punctuation">.</span>pem

相关参数:
req     请求证书
<span class="token operator">-</span>new    新证书签发请求
<span class="token operator">-</span>x509   生成x509格式证书
<span class="token operator">-</span>days   证书有效期1000天
<span class="token operator">-</span>key    指定私钥路径
<span class="token operator">-</span>subj   subject的缩写<span class="token punctuation">,</span>可以认为是主题、项目等
</code></pre> 
<p><img src="https://images2.imgbox.com/89/47/RDq1h0o7_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="3_340"></a>3）生成服务器私钥</h6> 
<pre><code class="prism language-powershell">openssl genrsa <span class="token operator">-</span>out server<span class="token operator">-</span>key<span class="token punctuation">.</span>pem 4096
</code></pre> 
<p><img src="https://images2.imgbox.com/42/d0/13zob1c0_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="4_351"></a>4）生成服务器证书</h6> 
<pre><code class="prism language-powershell">/<span class="token operator">/</span>生成服务器签名文件，用于生成服务器证书
openssl req <span class="token operator">-</span>subj <span class="token string">"/CN=*"</span> <span class="token operator">-</span>sha256 <span class="token operator">-</span>new <span class="token operator">-</span>key server<span class="token operator">-</span>key<span class="token punctuation">.</span>pem <span class="token operator">-</span>out server<span class="token punctuation">.</span>csr
<span class="token operator">/</span><span class="token operator">/</span>使用ca证书与私钥证书签名，输入abc123；
openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span>days 1000 <span class="token operator">-</span>sha256 <span class="token operator">-in</span> server<span class="token punctuation">.</span>csr <span class="token operator">-</span>CA ca<span class="token punctuation">.</span>pem <span class="token operator">-</span>CAkey ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem <span class="token operator">-</span>CAcreateserial <span class="token operator">-</span>out server<span class="token operator">-</span>cert<span class="token punctuation">.</span>pem

相关参数:
<span class="token operator">-in</span>   指定输入的证书、秘钥等文件
<span class="token operator">-</span>CAcreateserial  表示创建证书序列号文件（默认为ca<span class="token punctuation">.</span>srl）
</code></pre> 
<p><img src="https://images2.imgbox.com/f6/16/QYchOWry_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="5_367"></a>5）生成客户端密钥</h6> 
<pre><code class="prism language-powershell">openssl genrsa <span class="token operator">-</span>out key<span class="token punctuation">.</span>pem 4096
</code></pre> 
<p><img src="https://images2.imgbox.com/5f/48/OjkPHZYl_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="6_378"></a>6）生成客户端证书</h6> 
<pre><code class="prism language-powershell">/<span class="token operator">/</span>签名客户端
openssl req <span class="token operator">-</span>subj <span class="token string">"/CN=client"</span> <span class="token operator">-</span>new <span class="token operator">-</span>key key<span class="token punctuation">.</span>pem <span class="token operator">-</span>out client<span class="token punctuation">.</span>csr
<span class="token operator">/</span><span class="token operator">/</span>创建配置文件；认证方式使用客户端认证
<span class="token function">echo</span> extendedKeyUsage=clientAuth &gt; extfile<span class="token punctuation">.</span>cnf
<span class="token operator">/</span><span class="token operator">/</span>签名证书，输入abc123，需要（签名客户端，ca证书，ca密钥）
openssl x509 <span class="token operator">-</span>req <span class="token operator">-</span>days 1000 <span class="token operator">-</span>sha256 <span class="token operator">-in</span> client<span class="token punctuation">.</span>csr <span class="token operator">-</span>CA ca<span class="token punctuation">.</span>pem <span class="token operator">-</span>CAkey ca<span class="token operator">-</span>key<span class="token punctuation">.</span>pem <span class="token operator">-</span>CAcreateserial <span class="token operator">-</span>out cert<span class="token punctuation">.</span>pem <span class="token operator">-</span>extfile extfile<span class="token punctuation">.</span>cnf

相关参数:
<span class="token operator">-</span>extfile   添加扩展文件
</code></pre> 
<p><img src="https://images2.imgbox.com/0b/d8/TuBpGgIw_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="7_399"></a>7）删除多余文件</h6> 
<pre><code class="prism language-powershell"><span class="token function">rm</span> <span class="token operator">-</span>rf ca<span class="token punctuation">.</span>srl client<span class="token punctuation">.</span>csr extfile<span class="token punctuation">.</span>cnf server<span class="token punctuation">.</span>csr
</code></pre> 
<p><img src="https://images2.imgbox.com/0f/60/uWOyoRcZ_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="8_dockertls_411"></a>8） 配置docker，指定tls证书的路径、开放的端口、通信的进程等</h6> 
<pre><code class="prism language-powershell">vim <span class="token operator">/</span>lib<span class="token operator">/</span>systemd<span class="token operator">/</span>system<span class="token operator">/</span>docker<span class="token punctuation">.</span>service
ExecStart=<span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>dockerd <span class="token operator">--</span>tlsverify <span class="token operator">--</span>tlscacert=<span class="token operator">/</span>tls<span class="token operator">/</span>ca<span class="token punctuation">.</span>pem <span class="token operator">--</span>tlscert=<span class="token operator">/</span>tls<span class="token operator">/</span>server<span class="token operator">-</span>cert<span class="token punctuation">.</span>pem <span class="token operator">--</span>tlskey=<span class="token operator">/</span>tls<span class="token operator">/</span>server<span class="token operator">-</span>key<span class="token punctuation">.</span>pem <span class="token operator">-</span>H tcp:<span class="token operator">/</span><span class="token operator">/</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0:2376 <span class="token operator">-</span>H unix:<span class="token operator">/</span>/<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>run<span class="token operator">/</span>docker<span class="token punctuation">.</span>sock

systemctl daemon<span class="token operator">-</span>reload
systemctl restart docker
</code></pre> 
<p><img src="https://images2.imgbox.com/d2/e2/Mfmnji7M_o.png" alt="在这里插入图片描述"></p> 
<p><img src="https://images2.imgbox.com/ca/66/ZqjISxJ7_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="9_tlscapem_tlscertpem_tlskeypem__425"></a>9）将 /tls/ca.pem /tls/cert.pem /tls/key.pem 三个文件复制到另一台主机</h6> 
<pre><code class="prism language-powershell">scp ca<span class="token punctuation">.</span>pem root@192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>133<span class="token punctuation">.</span>20:<span class="token operator">/</span>etc<span class="token operator">/</span>docker<span class="token operator">/</span>
scp cert<span class="token punctuation">.</span>pem root@192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>133<span class="token punctuation">.</span>20:<span class="token operator">/</span>etc<span class="token operator">/</span>docker<span class="token operator">/</span>
scp key<span class="token punctuation">.</span>pem root@192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>133<span class="token punctuation">.</span>20:<span class="token operator">/</span>etc<span class="token operator">/</span>docker<span class="token operator">/</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/53/73/qmjRKdUl_o.png" alt="在这里插入图片描述"></p> 
<h6><a id="10_438"></a>10）本地验证</h6> 
<pre><code class="prism language-powershell">docker <span class="token operator">--</span>tlsverify <span class="token operator">--</span>tlscacert=ca<span class="token punctuation">.</span>pem <span class="token operator">--</span>tlscert=cert<span class="token punctuation">.</span>pem <span class="token operator">--</span>tlskey=key<span class="token punctuation">.</span>pem <span class="token operator">-</span>H tcp:<span class="token operator">/</span><span class="token operator">/</span>server:2376 images
docker pull nginx
</code></pre> 
<p><img src="https://images2.imgbox.com/ca/f7/UW82cf8I_o.png" alt="在这里插入图片描述"></p> 
<p><mark>client:192.168.133.20</mark></p> 
<pre><code class="prism language-powershell">hostnamectl <span class="token function">set-hostname</span> client
su

<span class="token function">echo</span> <span class="token string">'192.168.133.10 server'</span> &gt;&gt; <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
或
vim <span class="token operator">/</span>etc<span class="token operator">/</span>hosts
192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>133<span class="token punctuation">.</span>10 server

cd <span class="token operator">/</span>etc<span class="token operator">/</span>docker
docker <span class="token operator">--</span>tlsverify <span class="token operator">--</span>tlscacert=ca<span class="token punctuation">.</span>pem <span class="token operator">--</span>tlscert=cert<span class="token punctuation">.</span>pem <span class="token operator">--</span>tlskey=key<span class="token punctuation">.</span>pem <span class="token operator">-</span>H tcp:<span class="token operator">/</span><span class="token operator">/</span>server:2376 images
</code></pre> 
<p><img src="https://images2.imgbox.com/a8/7b/EjFVET6r_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/c5c53dbd4e9f09afe5b01f1a67f78fc2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">Android Studio顶部标题栏修改名称和删除教程</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e5e8faf95e9249c000ef6cbe048af89e/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">getRequestDispatcher()用法介绍</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>