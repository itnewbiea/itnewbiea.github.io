<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>MySQL的mysql-bin.00xx binlog日志文件的清理 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="MySQL的mysql-bin.00xx binlog日志文件的清理" />
<meta property="og:description" content=" 目录 引言手工清理配置自动清理 引言 公司一个项目生产环境mysql数据盘占用空间增长得特别快，经过排查发现是开启了mysql的binlog日志。如果把binlog日志关闭，如果操作万一出现问题，就没有办法恢复数据，很不安全，只能开启。经查相关资料，binlog日志可以手工消除，也可以配置自动清理。
手工清理 如果binlog文件非常多，推荐使用purge命令予清除历史文件,可以清除某个序号以前的文件，也可以清理某个时间点以前的数据。
清理某个序号以前的binlog日志文件 purge binary logs to &#39;mysql-bin.000430&#39;; mysql-bin.000429文件已被删除
清理某具时间点以前的binlog日志文件 purge binary logs before &#39;2023-08-29 12:00:00&#39;; 可以见把2023-08-29 12:00:00之前的binlog日志文件全部删除了
配置自动清理 配置
修改配置文件my.cnf文件： vim /etc/my.cnf #在[mysqld]标签内增加如下内容 log-bin=mysql-bin binlog_format=mixed max_binlog_size=1024M expire_logs_days=10 expire_logs_days=0：
这里的值如果为0，表示所有binlog日志永久都不会失效，不会自动删除；
这里的值如果为30，表示只保留最近30天。
温馨提示：
修改保存后，以下3种情况才会生效
1)当binlog大小超过max_binlog_size
2)手动执行flush logs
3)重新启动
查看binlog过期时间 show variables like &#39;expire_logs_days&#39;; " />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/059f42f1199b355f459673c9facddf47/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-08-29T17:34:54+08:00" />
<meta property="article:modified_time" content="2023-08-29T17:34:54+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">MySQL的mysql-bin.00xx binlog日志文件的清理</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>目录</h4> 
 <ul><li><a href="#_1" rel="nofollow">引言</a></li><li><a href="#_3" rel="nofollow">手工清理</a></li><li><a href="#_22" rel="nofollow">配置自动清理</a></li></ul> 
</div> 
<p></p> 
<h2><a id="_1"></a>引言</h2> 
<p>公司一个项目生产环境mysql数据盘占用空间增长得特别快，经过排查发现是开启了mysql的binlog日志。如果把binlog日志关闭，如果操作万一出现问题，就没有办法恢复数据，很不安全，只能开启。经查相关资料，binlog日志可以手工消除，也可以配置自动清理。</p> 
<h2><a id="_3"></a>手工清理</h2> 
<p>如果binlog文件非常多，推荐使用purge命令予清除历史文件,可以清除某个序号以前的文件，也可以清理某个时间点以前的数据。<br> <img src="https://images2.imgbox.com/6b/b5/OdgSL2Ih_o.png" alt="在这里插入图片描述"></p> 
<ol><li>清理某个序号以前的binlog日志文件</li></ol> 
<pre><code class="prism language-bash">purge binary logs to <span class="token string">'mysql-bin.000430'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/4c/3a/haGa0wF5_o.png" alt="在这里插入图片描述"><br> mysql-bin.000429文件已被删除<br> <img src="https://images2.imgbox.com/44/d0/xTBQ6SLD_o.png" alt="在这里插入图片描述"></p> 
<ol start="2"><li>清理某具时间点以前的binlog日志文件</li></ol> 
<pre><code class="prism language-bash">purge binary logs before <span class="token string">'2023-08-29 12:00:00'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/ed/55/AuZ5Grab_o.png" alt="在这里插入图片描述"><br> 可以见把2023-08-29 12:00:00之前的binlog日志文件全部删除了<br> <img src="https://images2.imgbox.com/23/f6/MpIvSh6c_o.png" alt="在这里插入图片描述"></p> 
<h2><a id="_22"></a>配置自动清理</h2> 
<ol start="3"><li>配置<br> 修改配置文件my.cnf文件：</li></ol> 
<pre><code class="prism language-bash"><span class="token function">vim</span> /etc/my.cnf
</code></pre> 
<pre><code class="prism language-bash"><span class="token comment">#在[mysqld]标签内增加如下内容</span>
log-bin<span class="token operator">=</span>mysql-bin
<span class="token assign-left variable">binlog_format</span><span class="token operator">=</span>mixed
<span class="token assign-left variable">max_binlog_size</span><span class="token operator">=</span>1024M
<span class="token assign-left variable">expire_logs_days</span><span class="token operator">=</span><span class="token number">10</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/f9/0d/OG8SyPqF_o.png" alt="在这里插入图片描述"></p> 
<blockquote> 
 <p>expire_logs_days=0：<br> 这里的值如果为0，表示所有binlog日志永久都不会失效，不会自动删除；<br> 这里的值如果为30，表示只保留最近30天。</p> 
</blockquote> 
<blockquote> 
 <p>温馨提示：<br> 修改保存后，以下3种情况才会生效<br> 1)当binlog大小超过max_binlog_size<br> 2)手动执行flush logs<br> 3)重新启动</p> 
</blockquote> 
<ol start="2"><li>查看binlog过期时间</li></ol> 
<pre><code class="prism language-bash">show variables like <span class="token string">'expire_logs_days'</span><span class="token punctuation">;</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/09/50/LsKgNQ6V_o.png" alt="在这里插入图片描述"></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/0a893fad0a892af001d6457c21a57a5b/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">C# 中的线程池</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e77b12472fa0e89790ce31a4f4fdea1d/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">Java解决文件在线预览（kkFileView）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>