<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>脑机接口基础学习08----读取.edf文件 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="脑机接口基础学习08----读取.edf文件" />
<meta property="og:description" content="EDF，全称是Eurpean Data Format，是一种标准文件格式，用于交换和存储医疗时间序列，该格式文件能够存储多通道的数据，允许每个信号拥有不同的采样频率，在内部，它包括标题和一个或多个数据记录。标题包含一些一般信息（患者标识，开始时间…等等），以及每个信号的技术规格（校准，采样率，过滤，…等等），编码为ASCII字符。数据记录包含小端16位整数的样本。因此，EDF也是多导睡眠图（PSG）录音的流行格式
在Python中读取edf文件，可以通过mne来实现
#方法原型： &#39;&#39;&#39; mne.io.read_raw_edf(input_fname, montage=&#39;deprecated&#39;, eog=None, misc=None, stim_channel=&#39;auto&#39;, exclude=(), preload=False, verbose=None) 参数解读： input_fname:edf文件存放地址 montage=‘deprecated’:已弃用 eog：通道名称或应指定为EOG通道的索引列表。值对应于文件中的电极。默认为无 misc：通道名称或应指定为MISC通道的索引列表。值对应于文件中的电极。默认为无。 stim_channel：默认为&#39;auto&#39;，这意味着将名为‘status’或‘trigger’（不区分大小写）的通道设置为STIM 如果为str（或str列表），则所有与名称匹配的通道均设置为STIM 如果为int（或int列表），则将对应于索引的通道设置为STIM exclude：要排除的通道名称。这在读取具有不同采样率的数据时会有所帮助，以避免不必要的重采样。 preload：如果为True，则数据将被预加载到内存中（这样可以加快数据的索引） 如果preload是字符串，则该字符串为数据存放在硬盘中的路径地址（速度较慢，需要较少的内存） 来看一个实例
###1.导入工具包 from mne.io import concatenate_raws,read_raw_edf import matplotlib.pyplot as plt import mne ###2.加载本地edf文件 raw=read_raw_edf(&#34;Affaf Ikram 20121020 1839.L1.edf&#34;,preload=False) ###3.获取原始数据中事件 #查看原始edf文件中保存的event id以及events events_from_annot,event_dict=mne.events_from_annotations(raw) print(event_dict) print(events_from_annot) 由上图可以发现，事件ID有1，2，3，4，5，6
每个ID对应着注释：[‘TRSP’,‘bgin’,‘fix&#43;’,‘resp’,‘stm&#43;’,‘stm-’]
共有517个事件
###4.根据事件ID获取对应事件 #下面只选取事件ID为5和6的所对应的事件 custom_mapping={&#39;stm&#43;&#39;:5,&#39;stm-&#39;:6} (events_from_annot, event_dict)=mne.events_from_annotations(raw,event_id=custom_mapping) print(event_id) print(events_from_annot) ###5.绘制事件图 fig=mne.viz.plot_events(events_from_annot,sfreq=raw.info[&#39;sfreq&#39;], first_samp=raw.first_samp,event_id=event_dict) subplots_adjust(right=0.7) epochs=mne.Epochs(raw,events=events_from_annot, event_id=event_dict) epochs.plot_image() &#39;&#39;&#39; 获取采样频率sfreq 知识点： 采样频率，也称为采样速度或采样率，定义了每秒从连续信号中提取并组成离散信号的采样个数，它用赫兹（Hz）来表示。 采样频率的倒数是采样周期或者叫作采样时间，它是采样之间的时间间隔。 通俗的讲采样频率是指计算机每秒钟采集多少个信号样本。 &#39;&#39;&#39; #sfreq=raw." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/298d0787b6c9964991eadd04cb79a6e4/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-10-23T19:59:50+08:00" />
<meta property="article:modified_time" content="2020-10-23T19:59:50+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">脑机接口基础学习08----读取.edf文件</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>EDF，全称是Eurpean Data Format，是一种标准文件格式，用于交换和存储医疗时间序列，该格式文件能够存储多通道的数据，允许每个信号拥有不同的采样频率，在内部，它包括标题和一个或多个数据记录。标题包含一些一般信息（患者标识，开始时间…等等），以及每个信号的技术规格（校准，采样率，过滤，…等等），编码为ASCII字符。数据记录包含小端16位整数的样本。因此，EDF也是多导睡眠图（PSG）录音的流行格式<br> 在Python中读取edf文件，可以通过mne来实现</p> 
<pre><code class="prism language-python"><span class="token comment">#方法原型：</span>
<span class="token string">''</span>'
mne<span class="token punctuation">.</span>io<span class="token punctuation">.</span>read_raw_edf<span class="token punctuation">(</span>input_fname<span class="token punctuation">,</span>
                     montage<span class="token operator">=</span><span class="token string">'deprecated'</span><span class="token punctuation">,</span>
                     eog<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                     misc<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                     stim_channel<span class="token operator">=</span><span class="token string">'auto'</span><span class="token punctuation">,</span>
                     exclude<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                     preload<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span>
                     verbose<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python">参数解读：
input_fname<span class="token punctuation">:</span>edf文件存放地址
montage<span class="token operator">=</span>‘deprecated’<span class="token punctuation">:</span>已弃用
eog：通道名称或应指定为EOG通道的索引列表。值对应于文件中的电极。默认为无
misc：通道名称或应指定为MISC通道的索引列表。值对应于文件中的电极。默认为无。

stim_channel：默认为<span class="token string">'auto'</span>，这意味着将名为‘status’或‘trigger’（不区分大小写）的通道设置为STIM
如果为<span class="token builtin">str</span>（或<span class="token builtin">str</span>列表），则所有与名称匹配的通道均设置为STIM
如果为<span class="token builtin">int</span>（或<span class="token builtin">int</span>列表），则将对应于索引的通道设置为STIM

exclude：要排除的通道名称。这在读取具有不同采样率的数据时会有所帮助，以避免不必要的重采样。

preload：如果为<span class="token boolean">True</span>，则数据将被预加载到内存中（这样可以加快数据的索引）
如果preload是字符串，则该字符串为数据存放在硬盘中的路径地址（速度较慢，需要较少的内存）

</code></pre> 
<p>来看一个实例</p> 
<pre><code class="prism language-python"><span class="token comment">###1.导入工具包</span>
<span class="token keyword">from</span> mne<span class="token punctuation">.</span>io <span class="token keyword">import</span> concatenate_raws<span class="token punctuation">,</span>read_raw_edf
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> mne
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">###2.加载本地edf文件</span>
raw<span class="token operator">=</span>read_raw_edf<span class="token punctuation">(</span><span class="token string">"Affaf Ikram 20121020 1839.L1.edf"</span><span class="token punctuation">,</span>preload<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span>
</code></pre> 
<pre><code class="prism language-python"><span class="token comment">###3.获取原始数据中事件</span>
<span class="token comment">#查看原始edf文件中保存的event id以及events</span>

events_from_annot<span class="token punctuation">,</span>event_dict<span class="token operator">=</span>mne<span class="token punctuation">.</span>events_from_annotations<span class="token punctuation">(</span>raw<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>event_dict<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>events_from_annot<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/65/54/06l1RGCC_o.png" alt="在这里插入图片描述"><br> 由上图可以发现，事件ID有1，2，3，4，5，6<br> 每个ID对应着注释：[‘TRSP’,‘bgin’,‘fix+’,‘resp’,‘stm+’,‘stm-’]<br> 共有517个事件</p> 
<pre><code class="prism language-python"><span class="token comment">###4.根据事件ID获取对应事件</span>
<span class="token comment">#下面只选取事件ID为5和6的所对应的事件</span>

custom_mapping<span class="token operator">=</span><span class="token punctuation">{<!-- --></span><span class="token string">'stm+'</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">,</span><span class="token string">'stm-'</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">}</span>
<span class="token punctuation">(</span>events_from_annot<span class="token punctuation">,</span>
event_dict<span class="token punctuation">)</span><span class="token operator">=</span>mne<span class="token punctuation">.</span>events_from_annotations<span class="token punctuation">(</span>raw<span class="token punctuation">,</span>event_id<span class="token operator">=</span>custom_mapping<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>event_id<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>events_from_annot<span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/dd/e3/d8TZooJX_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token comment">###5.绘制事件图</span>
fig<span class="token operator">=</span>mne<span class="token punctuation">.</span>viz<span class="token punctuation">.</span>plot_events<span class="token punctuation">(</span>events_from_annot<span class="token punctuation">,</span>sfreq<span class="token operator">=</span>raw<span class="token punctuation">.</span>info<span class="token punctuation">[</span><span class="token string">'sfreq'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                       first_samp<span class="token operator">=</span>raw<span class="token punctuation">.</span>first_samp<span class="token punctuation">,</span>event_id<span class="token operator">=</span>event_dict<span class="token punctuation">)</span>
subplots_adjust<span class="token punctuation">(</span>right<span class="token operator">=</span><span class="token number">0.7</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/fe/b4/NRGfQBGc_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python">epochs<span class="token operator">=</span>mne<span class="token punctuation">.</span>Epochs<span class="token punctuation">(</span>raw<span class="token punctuation">,</span>events<span class="token operator">=</span>events_from_annot<span class="token punctuation">,</span>
                 event_id<span class="token operator">=</span>event_dict<span class="token punctuation">)</span>
epochs<span class="token punctuation">.</span>plot_image<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/06/af/bQ3Pj8mz_o.png" alt="在这里插入图片描述"></p> 
<pre><code class="prism language-python"><span class="token triple-quoted-string string">'''
获取采样频率sfreq

知识点：
采样频率，也称为采样速度或采样率，定义了每秒从连续信号中提取并组成离散信号的采样个数，它用赫兹（Hz）来表示。
采样频率的倒数是采样周期或者叫作采样时间，它是采样之间的时间间隔。
通俗的讲采样频率是指计算机每秒钟采集多少个信号样本。

'''</span>
<span class="token comment">#sfreq=raw.info['sfreq']</span>


<span class="token comment">#获取索引为m到n的样本，每个样本从第k次到第h次</span>
<span class="token comment">#data,times=raw[m:n,k:h]</span>


<span class="token comment">#其中data为索引m到n的样本，每个样本从第k次到第h次</span>
<span class="token comment">#times是以第k次采样的时间作为开始时间，第h次采样时的时间为结束时间的时间数组</span>


data<span class="token punctuation">,</span>times<span class="token operator">=</span>raw<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token builtin">int</span><span class="token punctuation">(</span>sfreq<span class="token operator">*</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token builtin">int</span><span class="token punctuation">(</span>sfreq<span class="token operator">*</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>times<span class="token punctuation">,</span>data<span class="token punctuation">.</span>T<span class="token punctuation">)</span>
plot<span class="token punctuation">.</span>title<span class="token punctuation">(</span><span class="token string">'Sample channels'</span><span class="token punctuation">)</span>
</code></pre> 
<p><img src="https://images2.imgbox.com/59/a4/oV3ujynU_o.png" alt="在这里插入图片描述"><br> 今天同样没有找到相应数据文件，里面的图仍然是公众号里的，实在惭愧</p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/41d62c71b81156ee5c0cf5c9fd4ea67a/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">可以轻松将手机投屏到Mac电脑的工具：Reflector 3 mac版</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/e341a3b6a6387d09451abd4e626f1e4c/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">FPGA积沙成塔（目录篇）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>