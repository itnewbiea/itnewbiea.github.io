<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Java Socket实现多人聊天系统（图形界面&#43;文件传输功能） - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Java Socket实现多人聊天系统（图形界面&#43;文件传输功能）" />
<meta property="og:description" content="文章目录 前言 一、多人聊天系统1.1 客户端1.2 服务器端 二、运行效果2.1 初始化2.2 登录成功2.3 发送信息2.4 发送文件 前言 GitHub地址：https://github.com/Samven7/multichat-system
开发环境：Eclipse Java 2019-06
注意：本项目只在单主机运行调试过，没试过在局域网和不同主机之间接发消息和文件（估计不行），有需要的自行查阅资料。
一、多人聊天系统 1.1 客户端 Login.java：登录界面
// Login.java package exp5; import java.awt.*; import javax.swing.*; public class Login { JTextField textField = null; JPasswordField pwdField = null; ClientReadAndPrint.LoginListen listener=null; // 构造函数 public Login() { init(); } void init() { JFrame jf = new JFrame(&#34;登录&#34;); jf.setBounds(500, 250, 310, 210); jf.setResizable(false); // 设置是否缩放 JPanel jp1 = new JPanel(); JLabel headJLabel = new JLabel(&#34;" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/e9dcad148d6a921d8007f9315a42c8ba/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-10-14T21:05:41+08:00" />
<meta property="article:modified_time" content="2019-10-14T21:05:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Java Socket实现多人聊天系统（图形界面&#43;文件传输功能）</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p></p> 
<div class="toc"> 
 <h4>文章目录</h4> 
 <ul><li><ul><li><ul><li><a href="#_2" rel="nofollow">前言</a></li></ul> 
   </li><li><a href="#_10" rel="nofollow">一、多人聊天系统</a></li><li><ul><li><a href="#11__12" rel="nofollow">1.1 客户端</a></li><li><a href="#12__403" rel="nofollow">1.2 服务器端</a></li></ul> 
   </li><li><a href="#_620" rel="nofollow">二、运行效果</a></li><li><ul><li><a href="#21__622" rel="nofollow">2.1 初始化</a></li><li><a href="#22__629" rel="nofollow">2.2 登录成功</a></li><li><a href="#23__632" rel="nofollow">2.3 发送信息</a></li><li><a href="#24__634" rel="nofollow">2.4 发送文件</a></li></ul> 
  </li></ul> 
 </li></ul> 
</div> 
<p></p> 
<h4><a id="_2"></a>前言</h4> 
<p>GitHub地址：<a href="https://github.com/Samven7/multichat-system">https://github.com/Samven7/multichat-system</a></p> 
<p>开发环境：Eclipse Java 2019-06</p> 
<p><font color="red">注意：本项目只在单主机运行调试过，没试过在局域网和不同主机之间接发消息和文件（估计不行），有需要的自行查阅资料。</font></p> 
<h3><a id="_10"></a>一、多人聊天系统</h3> 
<h4><a id="11__12"></a>1.1 客户端</h4> 
<p>Login.java：登录界面</p> 
<pre><code class="prism language-java"><span class="token comment">// Login.java</span>
<span class="token keyword">package</span> exp5<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Login</span> <span class="token punctuation">{<!-- --></span>
	JTextField textField <span class="token operator">=</span> null<span class="token punctuation">;</span>
	JPasswordField pwdField <span class="token operator">=</span> null<span class="token punctuation">;</span>
	ClientReadAndPrint<span class="token punctuation">.</span>LoginListen listener<span class="token operator">=</span>null<span class="token punctuation">;</span>
	
	<span class="token comment">// 构造函数</span>
	<span class="token keyword">public</span> <span class="token function">Login</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		JFrame jf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JFrame</span><span class="token punctuation">(</span><span class="token string">"登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		jf<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token number">250</span><span class="token punctuation">,</span> <span class="token number">310</span><span class="token punctuation">,</span> <span class="token number">210</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		jf<span class="token punctuation">.</span><span class="token function">setResizable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置是否缩放</span>
		
		JPanel jp1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JPanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		JLabel headJLabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JLabel</span><span class="token punctuation">(</span><span class="token string">"登录界面"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		headJLabel<span class="token punctuation">.</span><span class="token function">setFont</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Font</span><span class="token punctuation">(</span>null<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置文本的字体类型、样式 和 大小</span>
		jp1<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>headJLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		JPanel jp2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JPanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		JLabel nameJLabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JLabel</span><span class="token punctuation">(</span><span class="token string">"用户名："</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		textField <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JTextField</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		JLabel pwdJLabel <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JLabel</span><span class="token punctuation">(</span><span class="token string">"密码：    "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		pwdField <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JPasswordField</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		JButton loginButton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JButton</span><span class="token punctuation">(</span><span class="token string">"登录"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		JButton registerButton <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JButton</span><span class="token punctuation">(</span><span class="token string">"注册"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 没设置功能</span>
		jp2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>nameJLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>textField<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pwdJLabel<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pwdField<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>loginButton<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp2<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>registerButton<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		JPanel jp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JPanel</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">BorderLayout</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// BorderLayout布局</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>jp1<span class="token punctuation">,</span> BorderLayout<span class="token punctuation">.</span>NORTH<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>jp2<span class="token punctuation">,</span> BorderLayout<span class="token punctuation">.</span>CENTER<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 设置监控</span>
		listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientReadAndPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">LoginListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 新建监听类</span>
		listener<span class="token punctuation">.</span><span class="token function">setJTextField</span><span class="token punctuation">(</span>textField<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用PoliceListen类的方法</span>
		listener<span class="token punctuation">.</span><span class="token function">setJPasswordField</span><span class="token punctuation">(</span>pwdField<span class="token punctuation">)</span><span class="token punctuation">;</span>
		listener<span class="token punctuation">.</span><span class="token function">setJFrame</span><span class="token punctuation">(</span>jf<span class="token punctuation">)</span><span class="token punctuation">;</span>
		pwdField<span class="token punctuation">.</span><span class="token function">addActionListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 密码框添加监听</span>
		loginButton<span class="token punctuation">.</span><span class="token function">addActionListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 按钮添加监听</span>
		
		jf<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>jp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jf<span class="token punctuation">.</span><span class="token function">setDefaultCloseOperation</span><span class="token punctuation">(</span>JFrame<span class="token punctuation">.</span>EXIT_ON_CLOSE<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置关闭图标作用</span>
		jf<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置可见</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ChatView.java：登录成功后的个人聊天界面</p> 
<pre><code class="prism language-java"><span class="token comment">// ChatView.java</span>
<span class="token keyword">package</span> exp5<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span>ActionEvent<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span>ActionListener<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>File<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>filechooser<span class="token punctuation">.</span>FileNameExtensionFilter<span class="token punctuation">;</span>


<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ChatView</span> <span class="token punctuation">{<!-- --></span>
	String userName<span class="token punctuation">;</span>  <span class="token comment">//由客户端登录时设置</span>
	JTextField text<span class="token punctuation">;</span>
	JTextArea textArea<span class="token punctuation">;</span>
	ClientReadAndPrint<span class="token punctuation">.</span>ChatViewListen listener<span class="token punctuation">;</span>
	
	<span class="token comment">// 构造函数</span>
	<span class="token keyword">public</span> <span class="token function">ChatView</span><span class="token punctuation">(</span>String userName<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>userName <span class="token operator">=</span> userName <span class="token punctuation">;</span>
		<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// 初始化函数</span>
	<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		JFrame jf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JFrame</span><span class="token punctuation">(</span><span class="token string">"客户端"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		jf<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">200</span><span class="token punctuation">,</span><span class="token number">400</span><span class="token punctuation">,</span><span class="token number">330</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//设置坐标和大小</span>
		jf<span class="token punctuation">.</span><span class="token function">setResizable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 缩放为不能缩放</span>
		
		JPanel jp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JPanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		JLabel lable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JLabel</span><span class="token punctuation">(</span><span class="token string">"用户："</span> <span class="token operator">+</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
		textArea <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JTextArea</span><span class="token punctuation">(</span><span class="token string">"***************登录成功，欢迎来到多人聊天室！****************\n"</span><span class="token punctuation">,</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">35</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		textArea<span class="token punctuation">.</span><span class="token function">setEditable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置为不可修改</span>
		JScrollPane scroll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JScrollPane</span><span class="token punctuation">(</span>textArea<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置滚动面板（装入textArea）</span>
		scroll<span class="token punctuation">.</span><span class="token function">setVerticalScrollBarPolicy</span><span class="token punctuation">(</span>JScrollPane<span class="token punctuation">.</span>VERTICAL_SCROLLBAR_ALWAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 显示垂直条</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>lable<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>scroll<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		text <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JTextField</span><span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		JButton button <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JButton</span><span class="token punctuation">(</span><span class="token string">"发送"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		JButton openFileBtn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JButton</span><span class="token punctuation">(</span><span class="token string">"发送文件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>button<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>openFileBtn<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 设置“打开文件”监听</span>
		openFileBtn<span class="token punctuation">.</span><span class="token function">addActionListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ActionListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actionPerformed</span><span class="token punctuation">(</span>ActionEvent e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token function">showFileOpenDialog</span><span class="token punctuation">(</span>jf<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		<span class="token comment">// 设置“发送”监听</span>
		listener <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientReadAndPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">new</span> <span class="token class-name">ChatViewListen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		listener<span class="token punctuation">.</span><span class="token function">setJTextField</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 调用PoliceListen类的方法</span>
		listener<span class="token punctuation">.</span><span class="token function">setJTextArea</span><span class="token punctuation">(</span>textArea<span class="token punctuation">)</span><span class="token punctuation">;</span>
		listener<span class="token punctuation">.</span><span class="token function">setChatViewJf</span><span class="token punctuation">(</span>jf<span class="token punctuation">)</span><span class="token punctuation">;</span>
		text<span class="token punctuation">.</span><span class="token function">addActionListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 文本框添加监听</span>
		button<span class="token punctuation">.</span><span class="token function">addActionListener</span><span class="token punctuation">(</span>listener<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 按钮添加监听</span>
		
		jf<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>jp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jf<span class="token punctuation">.</span><span class="token function">setDefaultCloseOperation</span><span class="token punctuation">(</span>JFrame<span class="token punctuation">.</span>EXIT_ON_CLOSE<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置右上角关闭图标的作用</span>
		jf<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置可见</span>
	<span class="token punctuation">}</span>
	<span class="token comment">// “打开文件”调用函数</span>
	<span class="token keyword">void</span> <span class="token function">showFileOpenDialog</span><span class="token punctuation">(</span>JFrame parent<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token comment">// 创建一个默认的文件选择器</span>
		JFileChooser fileChooser <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JFileChooser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 设置默认显示的文件夹</span>
		fileChooser<span class="token punctuation">.</span><span class="token function">setCurrentDirectory</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:/Users/Samven/Desktop"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 添加可用的文件过滤器（FileNameExtensionFilter 的第一个参数是描述, 后面是需要过滤的文件扩展名）</span>
<span class="token comment">//        fileChooser.addChoosableFileFilter(new FileNameExtensionFilter("(txt)", "txt"));</span>
        <span class="token comment">// 设置默认使用的文件过滤器（FileNameExtensionFilter 的第一个参数是描述, 后面是需要过滤的文件扩展名 可变参数）</span>
        fileChooser<span class="token punctuation">.</span><span class="token function">setFileFilter</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileNameExtensionFilter</span><span class="token punctuation">(</span><span class="token string">"(txt)"</span><span class="token punctuation">,</span> <span class="token string">"txt"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token comment">// 打开文件选择框（线程将被堵塞，知道选择框被关闭）</span>
		<span class="token keyword">int</span> result <span class="token operator">=</span> fileChooser<span class="token punctuation">.</span><span class="token function">showOpenDialog</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 对话框将会尽量显示在靠近 parent 的中心</span>
		<span class="token comment">// 点击确定</span>
		<span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> JFileChooser<span class="token punctuation">.</span>APPROVE_OPTION<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 获取路径</span>
			File file <span class="token operator">=</span> fileChooser<span class="token punctuation">.</span><span class="token function">getSelectedFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			String path <span class="token operator">=</span> file<span class="token punctuation">.</span><span class="token function">getAbsolutePath</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			ClientFileThread<span class="token punctuation">.</span><span class="token function">outFileToServer</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>Client.java：客户端</p> 
<pre><code class="prism language-java"><span class="token comment">// Client.java</span>
<span class="token keyword">package</span> exp5<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Client</span> <span class="token punctuation">{<!-- --></span>
	<span class="token comment">// 主函数，新建登录窗口</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">new</span> <span class="token class-name">Login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 *  负责客户端的读和写，以及登录和发送的监听
 *  之所以把登录和发送的监听放在这里，是因为要共享一些数据，比如mySocket,textArea
 */</span>
<span class="token keyword">class</span> <span class="token class-name">ClientReadAndPrint</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> Socket mySocket <span class="token operator">=</span> null<span class="token punctuation">;</span>  <span class="token comment">// 一定要加上static，否则新建线程时会清空</span>
	<span class="token keyword">static</span> JTextField textInput<span class="token punctuation">;</span>
	<span class="token keyword">static</span> JTextArea textShow<span class="token punctuation">;</span>
	<span class="token keyword">static</span> JFrame chatViewJFrame<span class="token punctuation">;</span>
	<span class="token keyword">static</span> BufferedReader in <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> PrintWriter out <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> String userName<span class="token punctuation">;</span>
	
	<span class="token comment">// 用于接收从服务端发送来的消息</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>mySocket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输入流</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				String str <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取服务端发送的信息</span>
				textShow<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str <span class="token operator">+</span> <span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加进聊天客户端的文本区域</span>
				textShow<span class="token punctuation">.</span><span class="token function">setCaretPosition</span><span class="token punctuation">(</span>textShow<span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置滚动条在最下面</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**********************登录监听(内部类)**********************/</span>
	<span class="token keyword">class</span> <span class="token class-name">LoginListen</span> <span class="token keyword">implements</span> <span class="token class-name">ActionListener</span><span class="token punctuation">{<!-- --></span>
		JTextField textField<span class="token punctuation">;</span>
		JPasswordField pwdField<span class="token punctuation">;</span>
		JFrame loginJFrame<span class="token punctuation">;</span>  <span class="token comment">// 登录窗口本身</span>
		
		ChatView chatView <span class="token operator">=</span> null<span class="token punctuation">;</span>
		
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJTextField</span><span class="token punctuation">(</span>JTextField textField<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>textField <span class="token operator">=</span> textField<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJPasswordField</span><span class="token punctuation">(</span>JPasswordField pwdField<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>pwdField <span class="token operator">=</span> pwdField<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJFrame</span><span class="token punctuation">(</span>JFrame jFrame<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>loginJFrame <span class="token operator">=</span> jFrame<span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actionPerformed</span><span class="token punctuation">(</span>ActionEvent event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			userName <span class="token operator">=</span> textField<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			String userPwd <span class="token operator">=</span> String<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>pwdField<span class="token punctuation">.</span><span class="token function">getPassword</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// getPassword方法获得char数组</span>
			<span class="token keyword">if</span><span class="token punctuation">(</span>userName<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> userPwd<span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token string">"123"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 密码为123并且用户名长度大于等于1</span>
				chatView <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ChatView</span><span class="token punctuation">(</span>userName<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 新建聊天窗口,设置聊天窗口的用户名（静态）</span>
				<span class="token comment">// 建立和服务器的联系</span>
				<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
					InetAddress addr <span class="token operator">=</span> InetAddress<span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取主机地址</span>
					mySocket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span><span class="token number">8081</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 客户端套接字</span>
					loginJFrame<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 隐藏登录窗口</span>
					out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>mySocket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出流</span>
					out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"用户【"</span> <span class="token operator">+</span> userName <span class="token operator">+</span> <span class="token string">"】进入聊天室！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送用户名给服务器</span>
					out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 清空缓冲区out中的数据</span>
				<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 新建普通读写线程并启动</span>
				ClientReadAndPrint readAndPrint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientReadAndPrint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				readAndPrint<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 新建文件读写线程并启动</span>
				ClientFileThread fileThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClientFileThread</span><span class="token punctuation">(</span>userName<span class="token punctuation">,</span> chatViewJFrame<span class="token punctuation">,</span> out<span class="token punctuation">)</span><span class="token punctuation">;</span>
				fileThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>
				JOptionPane<span class="token punctuation">.</span><span class="token function">showMessageDialog</span><span class="token punctuation">(</span>loginJFrame<span class="token punctuation">,</span> <span class="token string">"账号或密码错误，请重新输入！"</span><span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span> JOptionPane<span class="token punctuation">.</span>WARNING_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">/**********************聊天界面监听(内部类)**********************/</span>
	<span class="token keyword">class</span> <span class="token class-name">ChatViewListen</span> <span class="token keyword">implements</span> <span class="token class-name">ActionListener</span><span class="token punctuation">{<!-- --></span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJTextField</span><span class="token punctuation">(</span>JTextField text<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			textInput <span class="token operator">=</span> text<span class="token punctuation">;</span>  <span class="token comment">// 放在外部类，因为其它地方也要用到</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setJTextArea</span><span class="token punctuation">(</span>JTextArea textArea<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			textShow <span class="token operator">=</span> textArea<span class="token punctuation">;</span>  <span class="token comment">// 放在外部类，因为其它地方也要用到</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setChatViewJf</span><span class="token punctuation">(</span>JFrame jFrame<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			chatViewJFrame <span class="token operator">=</span> jFrame<span class="token punctuation">;</span>  <span class="token comment">// 放在外部类，因为其它地方也要用到</span>
			<span class="token comment">// 设置关闭聊天界面的监听</span>
			chatViewJFrame<span class="token punctuation">.</span><span class="token function">addWindowListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WindowAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">windowClosing</span><span class="token punctuation">(</span>WindowEvent e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"用户【"</span> <span class="token operator">+</span> userName <span class="token operator">+</span> <span class="token string">"】离开聊天室！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					System<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token comment">// 监听执行函数</span>
		<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">actionPerformed</span><span class="token punctuation">(</span>ActionEvent event<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
				String str <span class="token operator">=</span> textInput<span class="token punctuation">.</span><span class="token function">getText</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 文本框内容为空</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					textInput<span class="token punctuation">.</span><span class="token function">grabFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置焦点（可行）</span>
					<span class="token comment">// 弹出消息对话框（警告消息）</span>
					JOptionPane<span class="token punctuation">.</span><span class="token function">showMessageDialog</span><span class="token punctuation">(</span>chatViewJFrame<span class="token punctuation">,</span> <span class="token string">"输入为空，请重新输入！"</span><span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span> JOptionPane<span class="token punctuation">.</span>WARNING_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">return</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>userName <span class="token operator">+</span> <span class="token string">"说："</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出给服务端</span>
				out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 清空缓冲区out中的数据</span>
				
				textInput<span class="token punctuation">.</span><span class="token function">setText</span><span class="token punctuation">(</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 清空文本框</span>
				textInput<span class="token punctuation">.</span><span class="token function">grabFocus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置焦点（可行）</span>
<span class="token comment">//				textInput.requestFocus(true);  // 设置焦点（可行）</span>
			<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ClientFileThread.java：文件传输功能（客户端）</p> 
<pre><code class="prism language-java"><span class="token comment">// ClientFileThread.java</span>
<span class="token keyword">package</span> exp5<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClientFileThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> Socket socket <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">private</span> JFrame chatViewJFrame <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> String userName <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> PrintWriter out <span class="token operator">=</span> null<span class="token punctuation">;</span>  <span class="token comment">// 普通消息的发送（Server.java传来的值）</span>
	<span class="token keyword">static</span> DataInputStream fileIn <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> DataOutputStream fileOut <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> DataInputStream fileReader <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> DataOutputStream fileWriter <span class="token operator">=</span> null<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token function">ClientFileThread</span><span class="token punctuation">(</span>String userName<span class="token punctuation">,</span> JFrame chatViewJFrame<span class="token punctuation">,</span> PrintWriter out<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		ClientFileThread<span class="token punctuation">.</span>userName <span class="token operator">=</span> userName<span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>chatViewJFrame <span class="token operator">=</span> chatViewJFrame<span class="token punctuation">;</span>
		ClientFileThread<span class="token punctuation">.</span>out <span class="token operator">=</span> out<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 客户端接收文件</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			InetAddress addr <span class="token operator">=</span> InetAddress<span class="token punctuation">.</span><span class="token function">getByName</span><span class="token punctuation">(</span>null<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 获取主机地址</span>
			socket <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Socket</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token number">8090</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 客户端套接字</span>
			fileIn <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输入流</span>
			fileOut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出流</span>
			<span class="token comment">// 接收文件</span>
			<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				String textName <span class="token operator">=</span> fileIn<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">long</span> totleLength <span class="token operator">=</span> fileIn<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> result <span class="token operator">=</span> JOptionPane<span class="token punctuation">.</span><span class="token function">showConfirmDialog</span><span class="token punctuation">(</span>chatViewJFrame<span class="token punctuation">,</span> <span class="token string">"是否接受？"</span><span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span>
														   JOptionPane<span class="token punctuation">.</span>YES_NO_OPTION<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">long</span> curLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token comment">// 提示框选择结果，0为确定，1位取消</span>
				<span class="token keyword">if</span><span class="token punctuation">(</span>result <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{<!-- --></span>
<span class="token comment">//					out.println("【" + userName + "选择了接收文件！】");</span>
<span class="token comment">//					out.flush();</span>
					File userFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Samven\\Desktop\\接受文件\\"</span> <span class="token operator">+</span> userName<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>userFile<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 新建当前用户的文件夹</span>
						userFile<span class="token punctuation">.</span><span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span><span class="token string">"C:\\Users\\Samven\\Desktop\\接受文件\\"</span> <span class="token operator">+</span> userName <span class="token operator">+</span> <span class="token string">"\\"</span><span class="token operator">+</span> textName<span class="token punctuation">)</span><span class="token punctuation">;</span>
					fileWriter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileOutputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">=</span> fileIn<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 把文件写进本地</span>
						fileWriter<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
						fileWriter<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						curLength <span class="token operator">+=</span> length<span class="token punctuation">;</span>
<span class="token comment">//						out.println("【接收进度:" + curLength/totleLength*100 + "%】");</span>
<span class="token comment">//						out.flush();</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>curLength <span class="token operator">==</span> totleLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 强制结束</span>
							<span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"【"</span> <span class="token operator">+</span> userName <span class="token operator">+</span> <span class="token string">"接收了文件！】"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token comment">// 提示文件存放地址</span>
					JOptionPane<span class="token punctuation">.</span><span class="token function">showMessageDialog</span><span class="token punctuation">(</span>chatViewJFrame<span class="token punctuation">,</span> <span class="token string">"文件存放地址：\n"</span> <span class="token operator">+</span>
							<span class="token string">"C:\\Users\\Samven\\Desktop\\接受文件\\"</span> <span class="token operator">+</span>
							userName <span class="token operator">+</span> <span class="token string">"\\"</span> <span class="token operator">+</span> textName<span class="token punctuation">,</span> <span class="token string">"提示"</span><span class="token punctuation">,</span> JOptionPane<span class="token punctuation">.</span>INFORMATION_MESSAGE<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token punctuation">}</span>
				<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 不接受文件</span>
					<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">=</span> fileIn<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						curLength <span class="token operator">+=</span> length<span class="token punctuation">;</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>curLength <span class="token operator">==</span> totleLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 强制结束</span>
							<span class="token keyword">break</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				fileWriter<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 客户端发送文件</span>
	<span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">outFileToServer</span><span class="token punctuation">(</span>String path<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			File file <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
			fileReader <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">FileInputStream</span><span class="token punctuation">(</span>file<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			fileOut<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送文件名字</span>
			fileOut<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			fileOut<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>file<span class="token punctuation">.</span><span class="token function">length</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 发送文件长度</span>
			fileOut<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
			<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">=</span> fileReader<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 发送内容</span>
				
				fileOut<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
				fileOut<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
			
			out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"【"</span> <span class="token operator">+</span> userName <span class="token operator">+</span> <span class="token string">"已成功发送文件！】"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span><span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h4><a id="12__403"></a>1.2 服务器端</h4> 
<p>MultiChat.java：多人聊天系统界面（服务器端）</p> 
<pre><code class="prism language-java"><span class="token comment">// MultiChat.java</span>
<span class="token keyword">package</span> exp5<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span>WindowAdapter<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>awt<span class="token punctuation">.</span>event<span class="token punctuation">.</span>WindowEvent<span class="token punctuation">;</span>

<span class="token keyword">import</span> javax<span class="token punctuation">.</span>swing<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MultiChat</span> <span class="token punctuation">{<!-- --></span>
	JTextArea textArea<span class="token punctuation">;</span>
	
	<span class="token comment">// 用于向文本区域添加信息</span>
	<span class="token keyword">void</span> <span class="token function">setTextArea</span><span class="token punctuation">(</span>String str<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		textArea<span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>str<span class="token operator">+</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		textArea<span class="token punctuation">.</span><span class="token function">setCaretPosition</span><span class="token punctuation">(</span>textArea<span class="token punctuation">.</span><span class="token function">getDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getLength</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置滚动条在最下面</span>
	<span class="token punctuation">}</span>
	
	<span class="token comment">// 构造函数</span>
	<span class="token keyword">public</span> <span class="token function">MultiChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">void</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		JFrame jf <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JFrame</span><span class="token punctuation">(</span><span class="token string">"服务器端"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		jf<span class="token punctuation">.</span><span class="token function">setBounds</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">,</span><span class="token number">450</span><span class="token punctuation">,</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置窗口坐标和大小</span>
		jf<span class="token punctuation">.</span><span class="token function">setResizable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置为不可缩放</span>
		
		JPanel jp <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JPanel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 新建容器</span>
		JLabel lable <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JLabel</span><span class="token punctuation">(</span><span class="token string">"==欢迎来到多人聊天系统（服务器端）=="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		textArea <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JTextArea</span><span class="token punctuation">(</span><span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">38</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 新建文本区域并设置长宽</span>
		textArea<span class="token punctuation">.</span><span class="token function">setEditable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置为不可修改</span>
		JScrollPane scroll <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">JScrollPane</span><span class="token punctuation">(</span>textArea<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置滚动面板（装入textArea）</span>
		scroll<span class="token punctuation">.</span><span class="token function">setVerticalScrollBarPolicy</span><span class="token punctuation">(</span>ScrollPaneConstants<span class="token punctuation">.</span>VERTICAL_SCROLLBAR_ALWAYS<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 显示垂直条</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>lable<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jp<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>scroll<span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		jf<span class="token punctuation">.</span><span class="token function">addWindowListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">WindowAdapter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">windowClosing</span><span class="token punctuation">(</span>WindowEvent e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				System<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		
		jf<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>jp<span class="token punctuation">)</span><span class="token punctuation">;</span>
		jf<span class="token punctuation">.</span><span class="token function">setDefaultCloseOperation</span><span class="token punctuation">(</span>JFrame<span class="token punctuation">.</span>EXIT_ON_CLOSE<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置关闭图标作用</span>
		jf<span class="token punctuation">.</span><span class="token function">setVisible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 设置可见</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre> 
<p>Server.java：服务器端</p> 
<pre><code class="prism language-java"><span class="token comment">// Server.java</span>
<span class="token keyword">package</span> exp5<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>*<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Server</span><span class="token punctuation">{<!-- --></span>
	<span class="token keyword">static</span> ServerSocket server <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> Socket socket <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>Socket<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>Socket<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 存储客户端</span>
	
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span>String<span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		MultiChat multiChat <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MultiChat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 新建聊天系统界面</span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			<span class="token comment">// 在服务器端对客户端开启文件传输的线程</span>
			ServerFileThread serverFileThread <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerFileThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			serverFileThread<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8081</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 服务器端套接字（只能建立一次）</span>
			<span class="token comment">// 等待连接并开启相应线程</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 等待连接</span>
				list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 添加当前客户端到列表</span>
				<span class="token comment">// 在服务器端对客户端开启相应的线程</span>
				ServerReadAndPrint readAndPrint <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerReadAndPrint</span><span class="token punctuation">(</span>socket<span class="token punctuation">,</span> multiChat<span class="token punctuation">)</span><span class="token punctuation">;</span>
				readAndPrint<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e1<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e1<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 出现异常则打印出异常的位置</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
 *  服务器端读写类线程
 *  用于服务器端读取客户端的信息，并把信息发送给所有客户端
 */</span>
<span class="token keyword">class</span> <span class="token class-name">ServerReadAndPrint</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{<!-- --></span>
	Socket nowSocket <span class="token operator">=</span> null<span class="token punctuation">;</span>
	MultiChat multiChat <span class="token operator">=</span> null<span class="token punctuation">;</span>
	BufferedReader in <span class="token operator">=</span>null<span class="token punctuation">;</span>
	PrintWriter out <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token comment">// 构造函数</span>
	<span class="token keyword">public</span> <span class="token function">ServerReadAndPrint</span><span class="token punctuation">(</span>Socket s<span class="token punctuation">,</span> MultiChat multiChat<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>multiChat <span class="token operator">=</span> multiChat<span class="token punctuation">;</span>  <span class="token comment">// 获取多人聊天系统界面</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>nowSocket <span class="token operator">=</span> s<span class="token punctuation">;</span>  <span class="token comment">// 获取当前客户端</span>
	<span class="token punctuation">}</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			in <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BufferedReader</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InputStreamReader</span><span class="token punctuation">(</span>nowSocket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输入流</span>
			<span class="token comment">// 获取客户端信息并把信息发送给所有客户端</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				String str <span class="token operator">=</span> in<span class="token punctuation">.</span><span class="token function">readLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 发送给所有客户端</span>
				<span class="token keyword">for</span><span class="token punctuation">(</span>Socket socket<span class="token operator">:</span> Server<span class="token punctuation">.</span>list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					out <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PrintWriter</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 对每个客户端新建相应的socket套接字</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>socket <span class="token operator">==</span> nowSocket<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 发送给当前客户端</span>
						out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">"(你)"</span> <span class="token operator">+</span> str<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">else</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 发送给其它客户端</span>
						out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
					out<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 清空out中的缓存</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 调用自定义函数输出到图形界面</span>
				multiChat<span class="token punctuation">.</span><span class="token function">setTextArea</span><span class="token punctuation">(</span>str<span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			Server<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>nowSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 线程关闭，移除相应套接字</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<p>ServerFileThread.java：文件传输功能（服务器端）</p> 
<pre><code class="prism language-java"><span class="token comment">// ServerFileThread.java</span>
<span class="token keyword">package</span> exp5<span class="token punctuation">;</span>

<span class="token keyword">import</span> java<span class="token punctuation">.</span>io<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>net<span class="token punctuation">.</span>*<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>ArrayList<span class="token punctuation">;</span>
<span class="token keyword">import</span> java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>List<span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ServerFileThread</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span><span class="token punctuation">{<!-- --></span>
	ServerSocket server <span class="token operator">=</span> null<span class="token punctuation">;</span>
	Socket socket <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">static</span> List<span class="token generics function"><span class="token punctuation">&lt;</span>Socket<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>Socket<span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 存储客户端</span>
	
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			server <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ServerSocket</span><span class="token punctuation">(</span><span class="token number">8090</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				socket <span class="token operator">=</span> server<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				list<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 开启文件传输线程</span>
				FileReadAndWrite fileReadAndWrite <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileReadAndWrite</span><span class="token punctuation">(</span>socket<span class="token punctuation">)</span><span class="token punctuation">;</span>
				fileReadAndWrite<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">FileReadAndWrite</span> <span class="token keyword">extends</span> <span class="token class-name">Thread</span> <span class="token punctuation">{<!-- --></span>
	<span class="token keyword">private</span> Socket nowSocket <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">private</span> DataInputStream input <span class="token operator">=</span> null<span class="token punctuation">;</span>
	<span class="token keyword">private</span> DataOutputStream output <span class="token operator">=</span> null<span class="token punctuation">;</span>
	
	<span class="token keyword">public</span> <span class="token function">FileReadAndWrite</span><span class="token punctuation">(</span>Socket socket<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>nowSocket <span class="token operator">=</span> socket<span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
		<span class="token keyword">try</span> <span class="token punctuation">{<!-- --></span>
			input <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataInputStream</span><span class="token punctuation">(</span>nowSocket<span class="token punctuation">.</span><span class="token function">getInputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输入流</span>
			<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
				<span class="token comment">// 获取文件名字和文件长度</span>
				String textName <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">readUTF</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token keyword">long</span> textLength <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">readLong</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
				<span class="token comment">// 发送文件名字和文件长度给所有客户端</span>
				<span class="token keyword">for</span><span class="token punctuation">(</span>Socket socket<span class="token operator">:</span> ServerFileThread<span class="token punctuation">.</span>list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出流</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>socket <span class="token operator">!=</span> nowSocket<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 发送给其它客户端</span>
						output<span class="token punctuation">.</span><span class="token function">writeUTF</span><span class="token punctuation">(</span>textName<span class="token punctuation">)</span><span class="token punctuation">;</span>
						output<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						output<span class="token punctuation">.</span><span class="token function">writeLong</span><span class="token punctuation">(</span>textLength<span class="token punctuation">)</span><span class="token punctuation">;</span>
						output<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
				<span class="token comment">// 发送文件内容</span>
				<span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
				<span class="token keyword">long</span> curLength <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
				<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> buff <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">byte</span><span class="token punctuation">[</span><span class="token number">1024</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
				<span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>length <span class="token operator">=</span> input<span class="token punctuation">.</span><span class="token function">read</span><span class="token punctuation">(</span>buff<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
					curLength <span class="token operator">+=</span> length<span class="token punctuation">;</span>
					<span class="token keyword">for</span><span class="token punctuation">(</span>Socket socket<span class="token operator">:</span> ServerFileThread<span class="token punctuation">.</span>list<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
						output <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DataOutputStream</span><span class="token punctuation">(</span>socket<span class="token punctuation">.</span><span class="token function">getOutputStream</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 输出流</span>
						<span class="token keyword">if</span><span class="token punctuation">(</span>socket <span class="token operator">!=</span> nowSocket<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 发送给其它客户端</span>
							output<span class="token punctuation">.</span><span class="token function">write</span><span class="token punctuation">(</span>buff<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> length<span class="token punctuation">)</span><span class="token punctuation">;</span>
							output<span class="token punctuation">.</span><span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
						<span class="token punctuation">}</span>
					<span class="token punctuation">}</span>
					<span class="token keyword">if</span><span class="token punctuation">(</span>curLength <span class="token operator">==</span> textLength<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>  <span class="token comment">// 强制退出</span>
						<span class="token keyword">break</span><span class="token punctuation">;</span>
					<span class="token punctuation">}</span>
				<span class="token punctuation">}</span>
			<span class="token punctuation">}</span>
		<span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{<!-- --></span>
			ServerFileThread<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span>nowSocket<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 线程关闭，移除相应套接字</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> 
<h3><a id="_620"></a>二、运行效果</h3> 
<h4><a id="21__622"></a>2.1 初始化</h4> 
<ul><li>服务器端（先运行Server.java）<br> <img src="https://images2.imgbox.com/66/94/Lb4eFX7N_o.png" alt="Snipaste_2019-10-14_21-07-09"></li><li>登录界面（接着运行Client.java，运行一次生成一个登录界面）<br> <img src="https://images2.imgbox.com/95/48/CQlB7HBq_o.png" alt="Snipaste_2019-10-14_21-08-44"><br> <font color="red">这里我还没有实现注册功能，登录的用户名随意（不为空即可），密码是123。</font></li></ul> 
<h4><a id="22__629"></a>2.2 登录成功</h4> 
<p><img src="https://images2.imgbox.com/ea/18/Wft94hjG_o.png" alt="Snipaste_2019-10-14_21-12-23"><br> <img src="https://images2.imgbox.com/10/6c/K0Yop53J_o.png" alt="Snipaste_2019-10-14_21-13-03"></p> 
<h4><a id="23__632"></a>2.3 发送信息</h4> 
<p><img src="https://images2.imgbox.com/7b/ac/vA04QIY8_o.png" alt="Snipaste_2019-10-14_22-01-35"></p> 
<h4><a id="24__634"></a>2.4 发送文件</h4> 
<p>打开文件我设置了默认路径是在桌面。接受文件需要先在桌面创建一个名为“接受文件”的文件夹，用于存放所有用户接收的文件。<br> <img src="https://images2.imgbox.com/1d/bd/MDSGHm8W_o.png" alt="Snipaste_2019-10-14_22-05-00"><br> <font color="red">如果出现无法发送文件，应该是ClientFileThread.java那里的路径问题，路径包括了电脑用户的名字，比如我的是“Samven”，可以试试修改为自己的真实路径。</font></p>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/07000ff894794fbe0f07866d20b70cd2/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">正则表达式匹配日期，支持闰年，格式为YYYYMMDD</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/646b5f5e1ba29ffc0d1eaffe9c49ecd8/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">利用jieba对已爬取好的中国地名信息进行分词</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>