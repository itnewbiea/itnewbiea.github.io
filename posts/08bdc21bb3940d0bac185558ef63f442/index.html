<!DOCTYPE html>
<html class="no-js" lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Python字符串中提取国家名称 - IT学习者博客</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Python字符串中提取国家名称" />
<meta property="og:description" content="从文本中抽取国家名称，是一个命名实体识别的问题。但是因为国家个数有限，用机器学习大材小用，用直接匹配的方法看起来是快速且准确的选择。Python中也有第三方包可以调用，在这里整理一下相关资源。
Python从字符串串中如何提取国家、地区或者城市信息？中列出了两个方法。一个是Python工具包geotext，另一个是使用数据库自己匹配的方法。
geotext（0.4.0） 一个实用的Python工具包，主要是匹配的方法识别地名，包括国家和城市，可以转换为国家的ISO编码。这个包安装简单，速度非常快，处理一个句子长度的文本大概是 1 0 − 5 s 10^{-5}s 10−5s，可以用于大批量数据的处理。github上给的用法例子就很好了，搬运一下。
from geotext import GeoText places = GeoText(&#34;London is a great city&#34;) places.cities # &#34;London&#34; # filter by country code result = GeoText(&#39;I loved Rio de Janeiro and Havana&#39;, &#39;BR&#39;).cities # &#39;Rio de Janeiro&#39; GeoText(&#39;New York, Texas, and also China&#39;).country_mentions # OrderedDict([(u&#39;US&#39;, 2), (u&#39;CN&#39;, 1)]) 这个包的正确率很高，但是召回率不太行。识别出来的国家基本都是正确的，但是对于一些相对模糊的国家缩写识别不出来，比如USA和America都识别不出来，国家名称的变体比如Chinese也识别不出来。
GeoText(&#39;USA, America&#39;).countries # [] geograpy3（0.2.2） geograpy3是geograpy的一个分支，geograpy已经不再维护了，安装也是一堆报错。geograpy3与Python3兼容，geotext能实现的功能它都能实现，但安装稍微麻烦一些，速度也相对慢，处理一个句子长度的文本大概需要 1 0 − 1 s 10^{-1}s 10−1s，大数据量用起来还是比较慢。" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://itnewbiea.github.io/posts/08bdc21bb3940d0bac185558ef63f442/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-04-18T19:23:41+08:00" />
<meta property="article:modified_time" content="2022-04-18T19:23:41+08:00" />


	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link rel="dns-prefetch" href="//fonts.googleapis.com">
	<link rel="dns-prefetch" href="//fonts.gstatic.com">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700">

	<link rel="stylesheet" href="/css/style.css">
	

	<link rel="shortcut icon" href="/favicon.ico">
		
</head>
<body class="body">
	<div class="container container--outer">
		<header class="header">
	<div class="container header__container">
		
	<div class="logo">
		<a class="logo__link" href="/" title="IT学习者博客" rel="home">
			<div class="logo__item logo__text">
					<div class="logo__title">IT学习者博客</div>
					
				</div>
		</a>
	</div>
		<div class="divider"></div>
	</div>
</header>
		<div class="wrapper flex">
			<div class="primary">
			
<main class="main" role="main">
	<article class="post">
		<header class="post__header">
			<h1 class="post__title">Python字符串中提取国家名称</h1>
			
		</header>
		<div class="content post__content clearfix">
			
<div id="content_views" class="markdown_views prism-atom-one-dark">
                    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
                        <path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path>
                    </svg>
                    <p>从文本中抽取国家名称，是一个命名实体识别的问题。但是因为国家个数有限，用机器学习大材小用，用直接匹配的方法看起来是快速且准确的选择。Python中也有第三方包可以调用，在这里整理一下相关资源。</p> 
<p><a href="https://blog.csdn.net/sxb0841901116/article/details/96328330">Python从字符串串中如何提取国家、地区或者城市信息？</a>中列出了两个方法。一个是Python工具包geotext，另一个是使用数据库自己匹配的方法。</p> 
<h3><a id="geotexthttpsgithubcomelyasegeotext040_4"></a><a href="https://github.com/elyase/geotext">geotext</a>（0.4.0）</h3> 
<p>一个实用的Python工具包，主要是匹配的方法识别地名，包括国家和城市，可以转换为国家的ISO编码。这个包安装简单，速度非常快，处理一个句子长度的文本大概是<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         1 
        
        
        
          0 
         
         
         
           − 
          
         
           5 
          
         
        
       
         s 
        
       
      
        10^{-5}s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">5</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">s</span></span></span></span></span>，可以用于大批量数据的处理。github上给的用法例子就很好了，搬运一下。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> geotext <span class="token keyword">import</span> GeoText

places <span class="token operator">=</span> GeoText<span class="token punctuation">(</span><span class="token string">"London is a great city"</span><span class="token punctuation">)</span>
places<span class="token punctuation">.</span>cities
<span class="token comment"># "London"</span>

<span class="token comment"># filter by country code</span>
result <span class="token operator">=</span> GeoText<span class="token punctuation">(</span><span class="token string">'I loved Rio de Janeiro and Havana'</span><span class="token punctuation">,</span> <span class="token string">'BR'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>cities
<span class="token comment"># 'Rio de Janeiro'</span>

GeoText<span class="token punctuation">(</span><span class="token string">'New York, Texas, and also China'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>country_mentions
<span class="token comment"># OrderedDict([(u'US', 2), (u'CN', 1)])</span>
</code></pre> 
<p>这个包的正确率很高，但是召回率不太行。识别出来的国家基本都是正确的，但是对于一些相对模糊的国家缩写识别不出来，比如USA和America都识别不出来，国家名称的变体比如Chinese也识别不出来。</p> 
<pre><code class="prism language-python">GeoText<span class="token punctuation">(</span><span class="token string">'USA, America'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>countries
<span class="token comment"># []</span>
</code></pre> 
<h3><a id="geograpy3httpsgithubcomsomnathrakshitgeograpy3022_28"></a><a href="https://github.com/somnathrakshit/geograpy3">geograpy3</a>（0.2.2）</h3> 
<p>geograpy3是<a href="https://github.com/ushahidi/geograpy">geograpy</a>的一个分支，geograpy已经不再维护了，安装也是一堆报错。geograpy3与Python3兼容，geotext能实现的功能它都能实现，但安装稍微麻烦一些，速度也相对慢，处理一个句子长度的文本大概需要<span class="katex--inline"><span class="katex"><span class="katex-mathml"> 
     
      
       
       
         1 
        
        
        
          0 
         
         
         
           − 
          
         
           1 
          
         
        
       
         s 
        
       
      
        10^{-1}s 
       
      
    </span><span class="katex-html"><span class="base"><span class="strut" style="height: 0.814108em; vertical-align: 0em;"></span><span class="mord">1</span><span class="mord"><span class="mord">0</span><span class="msupsub"><span class="vlist-t"><span class="vlist-r"><span class="vlist" style="height: 0.814108em;"><span class="" style="top: -3.063em; margin-right: 0.05em;"><span class="pstrut" style="height: 2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">−</span><span class="mord mtight">1</span></span></span></span></span></span></span></span></span><span class="mord mathdefault">s</span></span></span></span></span>，大数据量用起来还是比较慢。</p> 
<p>说一下使用过程中遇到的问题。</p> 
<h4><a id="_33"></a>问题</h4> 
<h5><a id="1_sqlite3OperationalError_no_such_table_countries_34"></a>1. sqlite3.OperationalError: no such table: countries</h5> 
<p>这应该是这个包的一个bug，在github的问题中有提到<a href="https://github.com/somnathrakshit/geograpy3/issues/59">[BUG]OperationalError: no such table: countries #59</a>，也有看到其它同样的提问<a href="https://stackoverflow.com/questions/69108673/geograpy3-sqlite3-operationalerror-no-such-table" rel="nofollow">geograpy3: sqlite3.OperationalError: no such table</a>。是因为某个需要读取数据的数据库是空的，所以从中读取数据表失败。</p> 
<p>解决方法：</p> 
<ol><li>下载<a href="https://github.com/somnathrakshit/geograpy3/wiki/data/locations.db.gz">locations.db</a></li><li>解压后放在<code>$HOME/.geograpy3</code>的文件夹下，并把文件夹中的db文件删除。我用的是windows系统，是在<code>C:\Users\&lt;Username&gt;\.geograpy3</code>这个路径。</li></ol> 
<h5><a id="2_nltk_41"></a>2. nltk下载</h5> 
<p>诸如<code>‘chunkers/maxent_ne_chunker/english_ace_multiclass.pickle’ not found</code>此类。</p> 
<p>因为我nltk下载总是失败，所以需要手动下载。在<a href="http://www.nltk.org/nltk_data/" rel="nofollow">nltk_data网站</a>，下载<code>maxent_ne_chunker</code>压缩包，解压后放在提示缺失的<code>Searched in</code>任意一个文件夹中就可以了。</p> 
<h5><a id="3_UnicodeDecodeError_gbk_codec_cant_decode_byte_0xa6_in_position__46"></a>3. UnicodeDecodeError: ‘gbk’ codec can’t decode byte 0xa6 in position …</h5> 
<p>跳转到出错的源代码中，在<code>open</code>的时候加个<code>encoding=“utf8”</code>就解决了。</p> 
<p>以上就是在初次使用过程中遇到的问题了。</p> 
<h4><a id="_51"></a>使用方法</h4> 
<p>还是搬运一下github给出的示例。</p> 
<h5><a id="_54"></a>方法一</h5> 
<p><code>geograpy.get_geoPlace_context</code>方法可以传入字符串（text参数），也可以传入需要提取信息的网址（url参数）。</p> 
<ol><li>国家、地区、城市等信息：使用<code>places.countries</code>查看国家，类似地可以查看地区<code>places.regions</code>、查看城市<code>places.cities</code>和其它<code>places.other</code>。</li><li>地点之间关系的信息：使用<code>places.country_regions</code>查看按国家划分的地区，类似地可以查看按国家划分的城市<code>places.country_cities</code>和与地理编码相关的字符串<code>places.address_strings</code>。不过直观感受这个不太准。</li><li>国家、地区、城市及频次：使用<code>places.country_mentions</code>查看国家出现的次数，类似地还可以获取地区出现次数<code>places.region_mentions</code>和城市出现次数<code>places.city_mentions</code>。</li></ol> 
<p>这种方法可以识别出“xx国家的”这种所有格形式，比如“Chinese”，但是缩写识别不出来，比如“USA”。</p> 
<pre><code class="prism language-python"><span class="token keyword">import</span> geograpy

text <span class="token operator">=</span> <span class="token string">"China borders 14 nations and extends across much of East Asia, bordering Vietnam, Laos, and Myanmar (Burma) in Southeast Asia; India, Bhutan, Nepal, Afghanistan, and Pakistan in South Asia; Tajikistan, Kyrgyzstan and Kazakhstan in Central Asia; and Russia, Mongolia, and North Korea in Inner Asia and Northeast Asia. Additionally, China shares maritime boundaries with South Korea, Japan, Vietnam, and the Philippines."</span>

places <span class="token operator">=</span> geograpy<span class="token punctuation">.</span>get_geoPlace_context<span class="token punctuation">(</span>text<span class="token operator">=</span>text<span class="token punctuation">)</span>

places<span class="token punctuation">.</span>countries
<span class="token comment"># ['Pakistan', 'Laos', 'Bhutan', 'Kyrgyzstan', 'Tajikistan', 'India', 'Russia', 'Japan', 'Afghanistan', 'South Korea', 'Mongolia', 'North Korea', 'Vietnam', 'Myanmar', 'Philippines', 'Kazakhstan', "People's Republic of China", 'United States of America', 'Indonesia', 'Mexico', 'Georgia', 'Moldova', 'Italy']</span>

places<span class="token punctuation">.</span>country_regions
<span class="token comment"># {'Pakistan': [], 'Laos': [], 'Bhutan': [], 'Kyrgyzstan': [], 'Tajikistan': [], 'India': ['Asia', 'China'], 'Russia': [], 'Japan': [], 'Afghanistan': ['Pakistan'], 'South Korea': ['North Korea', 'South Asia', 'South Korea', 'Bhutan'], 'Mongolia': [], 'North Korea': ['North Korea', 'South Korea'], 'Vietnam': [], 'Myanmar': ['China'], 'Philippines': ['East Asia', 'South Asia', 'South Korea', 'North Korea'], 'Kazakhstan': [], "People's Republic of China": ['Mongolia', 'Inner Asia']}</span>

places<span class="token punctuation">.</span>country_mentions
<span class="token comment"># [("People's Republic of China", 2), ('Myanmar', 2), ('Laos', 1), ('India', 1), ('Bhutan', 1), ('Afghanistan', 1), ('Pakistan', 1), ('Tajikistan', 1), ('Kyrgyzstan', 1), ('Kazakhstan', 1), ('Russia', 1), ('Mongolia', 1), ('North Korea', 1), ('South Korea', 1), ('Japan', 1), ('Vietnam', 1), ('Philippines', 1), ('United States of America', 1), ('Indonesia', 1), ('Mexico', 1), ('Georgia', 1), ('Moldova', 1), ('Italy', 1)]</span>
</code></pre> 
<h5><a id="_79"></a>方法二</h5> 
<p>先用<code>extraction.Extractor</code>中的<code>find_geoEntities()</code>方法找到地理实体，再利用<code>places.PlaceContext</code>中的<code>set_countries()</code>方法获得国家，可以<code>pc.countries</code>获得国家列表，也可以统计出现的次数<code>pc.country_mentions</code>，这种方法得到的地名更准一点。地区<code>pc.set_regions()</code>、城市<code>pc.set_cities()</code>和其它<code>pc.set_other()</code>也可以查看，值得注意的是，这种方法可以识别一些缩写，比如“USA”，会在其它而非国家的列表中。</p> 
<pre><code class="prism language-python"><span class="token keyword">from</span> geograpy <span class="token keyword">import</span> extraction<span class="token punctuation">,</span> places

text <span class="token operator">=</span> <span class="token string">"China borders 14 nations and extends across much of East Asia, bordering Vietnam, Laos, and Myanmar (Burma) in Southeast Asia; India, Bhutan, Nepal, Afghanistan, and Pakistan in South Asia; Tajikistan, Kyrgyzstan and Kazakhstan in Central Asia; and Russia, Mongolia, and North Korea in Inner Asia and Northeast Asia. Additionally, China shares maritime boundaries with South Korea, Japan, Vietnam, and the Philippines."</span>

e <span class="token operator">=</span> extraction<span class="token punctuation">.</span>Extractor<span class="token punctuation">(</span>text<span class="token operator">=</span>text<span class="token punctuation">)</span>
e<span class="token punctuation">.</span>find_geoEntities<span class="token punctuation">(</span><span class="token punctuation">)</span>

pc <span class="token operator">=</span> places<span class="token punctuation">.</span>PlaceContext<span class="token punctuation">(</span>e<span class="token punctuation">.</span>places<span class="token punctuation">)</span>

pc<span class="token punctuation">.</span>set_countries<span class="token punctuation">(</span><span class="token punctuation">)</span>

pc<span class="token punctuation">.</span>countries
<span class="token comment"># ['Kyrgyzstan', 'Nepal', "People's Republic of China", 'South Korea', 'India', 'Myanmar', 'Russia', 'North Korea', 'Kazakhstan', 'Japan', 'Laos', 'Mongolia', 'Bhutan', 'Pakistan', 'Vietnam', 'Afghanistan', 'Tajikistan', 'Philippines']</span>

pc<span class="token punctuation">.</span>country_mentions
<span class="token comment"># [("People's Republic of China", 2), ('Vietnam', 2), ('Myanmar', 2), ('Laos', 1), ('India', 1), ('Bhutan', 1), ('Nepal', 1), ('Afghanistan', 1), ('Pakistan', 1), ('Tajikistan', 1), ('Kyrgyzstan', 1), ('Kazakhstan', 1), ('Russia', 1), ('Mongolia', 1), ('North Korea', 1), ('South Korea', 1), ('Japan', 1), ('Philippines', 1)]</span>
</code></pre>
                </div>
		</div>
	</article>
</main>


<nav class="pager flex">
	<div class="pager__item pager__item--prev">
		<a class="pager__link" href="/posts/3b750931d2ea97d214277a5c55f38dbb/" rel="prev">
			<span class="pager__subtitle">«&thinsp;Previous</span>
			<p class="pager__title">【链表】数据结构与算法——代码随想录</p>
		</a>
	</div>
	<div class="pager__item pager__item--next">
		<a class="pager__link" href="/posts/ae41f007da61ab0a4291f85b7fea3014/" rel="next">
			<span class="pager__subtitle">Next&thinsp;»</span>
			<p class="pager__title">玩转react——通过CDN引入玩转（直接引用）</p>
		</a>
	</div>
</nav>


			</div>
			
		</div>
		<footer class="footer">
	<div class="container footer__container flex">
		
		<div class="footer__copyright">
			&copy; 2024 IT学习者博客.
			<span class="footer__copyright-credits">Generated with <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/Vimux/Mainroad/" rel="nofollow noopener" target="_blank">Mainroad</a> theme.</span>
		</div>
	</div>
</footer>
<script src="https://itnewbiea.github.io/js/foot.js"></script>


	</div>
<script async defer src="/js/menu.js"></script>
</body>
</html>